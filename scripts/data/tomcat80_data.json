[
    {
        "commit": "https://github.com/apache/tomcat80/commit/b4ad971a8b7b46414eacdf653269f4b3117d38a6",
        "file": [
            {
                "patch": "@@ -132,7 +132,11 @@ private void prepare(Node node) throws ELException {\n         try {\n             node.accept(this);\n         } catch (Exception e) {\n-            throw (ELException) e;\n+            if (e instanceof ELException) {\n+                throw (ELException) e;\n+            } else {\n+                throw (new ELException(e));\n+            }\n         }\n         if (this.fnMapper instanceof FunctionMapperFactory) {\n             this.fnMapper = ((FunctionMapperFactory) this.fnMapper).create();",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/b4ad971a8b7b46414eacdf653269f4b3117d38a6/java/org/apache/el/lang/ExpressionBuilder.java",
                "status": "modified",
                "changes": 6,
                "deletions": 1,
                "sha": "006dca9a2aaa0f44606f73f005b0b47574820680",
                "blob_url": "https://github.com/apache/tomcat80/blob/b4ad971a8b7b46414eacdf653269f4b3117d38a6/java/org/apache/el/lang/ExpressionBuilder.java",
                "filename": "java/org/apache/el/lang/ExpressionBuilder.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/el/lang/ExpressionBuilder.java?ref=b4ad971a8b7b46414eacdf653269f4b3117d38a6"
            }
        ],
        "bug_id": "tomcat80_1",
        "parent": "https://github.com/apache/tomcat80/commit/41c85b3dcfc323fbaabcd36e62f35f067305cace",
        "message": "Fix ClassCastException when we try to cast a\n\nNullPointerException to an ELException.\nI still need to investigate where the NPE came from,\nbut simply casting seems unsafe in any case.\n\nUse a cast if possible and recreate exception\notherwise.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@696716 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/9ca2e4ad6029d4dbcb812651723aacffee104972",
        "file": [
            {
                "patch": "@@ -133,8 +133,12 @@ public void publish(LogRecord record) {\n         }\n         \n         try {\n-            writer.write(result);\n-            writer.flush();\n+            if (writer!=null) {\n+                writer.write(result);\n+                writer.flush();\n+            } else {\n+                reportError(\"FileHandler is closed or not yet initialized, unable to log [\"+result+\"]\", null, ErrorManager.WRITE_FAILURE);\n+            }\n         } catch (Exception e) {\n             reportError(null, e, ErrorManager.WRITE_FAILURE);\n             return;",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/9ca2e4ad6029d4dbcb812651723aacffee104972/java/org/apache/juli/FileHandler.java",
                "status": "modified",
                "changes": 8,
                "deletions": 2,
                "sha": "eb23fb564af2f38884597aef7d4dd70aec0eefea",
                "blob_url": "https://github.com/apache/tomcat80/blob/9ca2e4ad6029d4dbcb812651723aacffee104972/java/org/apache/juli/FileHandler.java",
                "filename": "java/org/apache/juli/FileHandler.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/juli/FileHandler.java?ref=9ca2e4ad6029d4dbcb812651723aacffee104972"
            }
        ],
        "bug_id": "tomcat80_2",
        "parent": "https://github.com/apache/tomcat80/commit/d844bc1c705bbb95d4e93b3672931eb8771c2e64",
        "message": "prevent NPE during shutdown where the logger has been shutdown and delayed resources still trying to log\njava.lang.NullPointerException\n\tat org.apache.juli.FileHandler.publish(FileHandler.java:136)\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@666232 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/7f8869cb250cd43fdec66d5342b143c6bd63a339",
        "file": [
            {
                "patch": "@@ -730,7 +730,10 @@ public void removeConnector(String name) throws Exception {\n         ObjectName oname = new ObjectName(name);\n         Service service = getService(oname);\n         String port = oname.getKeyProperty(\"port\");\n-        String address = ObjectName.unquote(oname.getKeyProperty(\"address\"));\n+        String address = oname.getKeyProperty(\"address\");\n+        if (address != null) {\n+            address = ObjectName.unquote(address);\n+        }\n \n         Connector conns[] = service.findConnectors();\n ",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/7f8869cb250cd43fdec66d5342b143c6bd63a339/java/org/apache/catalina/mbeans/MBeanFactory.java",
                "status": "modified",
                "changes": 5,
                "deletions": 1,
                "sha": "c2669144a12bbc576e72c6b7c639770531e159d4",
                "blob_url": "https://github.com/apache/tomcat80/blob/7f8869cb250cd43fdec66d5342b143c6bd63a339/java/org/apache/catalina/mbeans/MBeanFactory.java",
                "filename": "java/org/apache/catalina/mbeans/MBeanFactory.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/mbeans/MBeanFactory.java?ref=7f8869cb250cd43fdec66d5342b143c6bd63a339"
            }
        ],
        "bug_id": "tomcat80_3",
        "parent": "https://github.com/apache/tomcat80/commit/2933c6337ad79a2cab32e05e190dc08838ac5c56",
        "message": "Fix possible NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1833074 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/df1b0ff968f1f03cc661e3837de2eda91bd30c74",
        "file": [
            {
                "patch": "@@ -113,6 +113,11 @@\n         when running the asynchronous stock ticker in the examples web\n         application. (markt)\n       </fix>\n+      <fix>\n+        <bug>61886</bug>: Prevent <code>NullPointerException</code> and other\n+        errors if the stock ticker example is running when the examples web\n+        application is stopped. (markt)\n+      </fix>\n       <fix>\n         <bug>61910</bug>: Clarify the meaning of the <code>allowLinking</code>\n         option in the documentation web application. (markt)",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/df1b0ff968f1f03cc661e3837de2eda91bd30c74/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "34dc6490b274f0e311d1c9719716875b3bcaea95",
                "blob_url": "https://github.com/apache/tomcat80/blob/df1b0ff968f1f03cc661e3837de2eda91bd30c74/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=df1b0ff968f1f03cc661e3837de2eda91bd30c74"
            },
            {
                "patch": "@@ -0,0 +1,44 @@\n+/*\n+ *  Licensed to the Apache Software Foundation (ASF) under one or more\n+ *  contributor license agreements.  See the NOTICE file distributed with\n+ *  this work for additional information regarding copyright ownership.\n+ *  The ASF licenses this file to You under the Apache License, Version 2.0\n+ *  (the \"License\"); you may not use this file except in compliance with\n+ *  the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package async;\n+\n+import javax.servlet.ServletContext;\n+import javax.servlet.ServletContextEvent;\n+import javax.servlet.ServletContextListener;\n+\n+/*\n+ * Ensures the Stockticker is shut down cleanly when the context stops. This\n+ * also covers the case when the server shuts down.\n+ */\n+public class AsyncStockContextListener implements ServletContextListener {\n+\n+    public static final String STOCK_TICKER_KEY = \"StockTicker\";\n+\n+    @Override\n+    public void contextInitialized(ServletContextEvent sce) {\n+        Stockticker stockticker = new Stockticker();\n+        ServletContext sc = sce.getServletContext();\n+        sc.setAttribute(STOCK_TICKER_KEY, stockticker);\n+    }\n+\n+    @Override\n+    public void contextDestroyed(ServletContextEvent sce) {\n+        ServletContext sc = sce.getServletContext();\n+        Stockticker stockticker = (Stockticker) sc.getAttribute(STOCK_TICKER_KEY);\n+        stockticker.shutdown();\n+    }\n+}",
                "additions": 44,
                "raw_url": "https://github.com/apache/tomcat80/raw/df1b0ff968f1f03cc661e3837de2eda91bd30c74/webapps/examples/WEB-INF/classes/async/AsyncStockContextListener.java",
                "status": "added",
                "changes": 44,
                "deletions": 0,
                "sha": "685ac239fb2822c24ff184ff5724d108f4ded2c4",
                "blob_url": "https://github.com/apache/tomcat80/blob/df1b0ff968f1f03cc661e3837de2eda91bd30c74/webapps/examples/WEB-INF/classes/async/AsyncStockContextListener.java",
                "filename": "webapps/examples/WEB-INF/classes/async/AsyncStockContextListener.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/examples/WEB-INF/classes/async/AsyncStockContextListener.java?ref=df1b0ff968f1f03cc661e3837de2eda91bd30c74"
            },
            {
                "patch": "@@ -25,6 +25,7 @@\n import javax.servlet.AsyncContext;\n import javax.servlet.AsyncEvent;\n import javax.servlet.AsyncListener;\n+import javax.servlet.ServletContext;\n import javax.servlet.ServletException;\n import javax.servlet.http.HttpServlet;\n import javax.servlet.http.HttpServletRequest;\n@@ -40,7 +41,6 @@\n     private static final ConcurrentLinkedQueue<AsyncContext> clients =\n             new ConcurrentLinkedQueue<>();\n     private static final AtomicInteger clientcount = new AtomicInteger(0);\n-    private static final Stockticker ticker = new Stockticker();\n \n     public AsyncStockServlet() {\n         System.out.println(\"AsyncStockServlet created\");\n@@ -58,6 +58,8 @@ protected void service(HttpServletRequest req, HttpServletResponse resp)\n             resp.setContentType(\"text/plain\");\n             clients.add(actx);\n             if (clientcount.incrementAndGet()==1) {\n+                Stockticker ticker = (Stockticker) req.getServletContext().getAttribute(\n+                        AsyncStockContextListener.STOCK_TICKER_KEY);\n                 ticker.addTickListener(this);\n             }\n         } else {\n@@ -98,9 +100,28 @@ public void writeStock(AsyncContext actx, Stock stock) throws IOException {\n     }\n \n \n+    @Override\n+    public void shutdown() {\n+        // The web application is shutting down. Complete any AsyncContexts\n+        // associated with an active client.\n+        Iterator<AsyncContext> it = clients.iterator();\n+        while (it.hasNext()) {\n+            AsyncContext actx = it.next();\n+            try {\n+                actx.complete();\n+            } catch (Exception e) {\n+                // Ignore. The async error handling will deal with this.\n+            }\n+        }\n+    }\n+\n+\n     @Override\n     public void onComplete(AsyncEvent event) throws IOException {\n         if (clients.remove(event.getAsyncContext()) && clientcount.decrementAndGet()==0) {\n+            ServletContext sc = event.getAsyncContext().getRequest().getServletContext();\n+            Stockticker ticker = (Stockticker) sc.getAttribute(\n+                    AsyncStockContextListener.STOCK_TICKER_KEY);\n             ticker.removeTickListener(this);\n         }\n     }",
                "additions": 22,
                "raw_url": "https://github.com/apache/tomcat80/raw/df1b0ff968f1f03cc661e3837de2eda91bd30c74/webapps/examples/WEB-INF/classes/async/AsyncStockServlet.java",
                "status": "modified",
                "changes": 23,
                "deletions": 1,
                "sha": "b3013d90639b4fae790f4dcbb9fd3aedf1d4f2f3",
                "blob_url": "https://github.com/apache/tomcat80/blob/df1b0ff968f1f03cc661e3837de2eda91bd30c74/webapps/examples/WEB-INF/classes/async/AsyncStockServlet.java",
                "filename": "webapps/examples/WEB-INF/classes/async/AsyncStockServlet.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/examples/WEB-INF/classes/async/AsyncStockServlet.java?ref=df1b0ff968f1f03cc661e3837de2eda91bd30c74"
            },
            {
                "patch": "@@ -37,6 +37,12 @@ public synchronized void start() {\n         }\n \n         public synchronized void stop() {\n+            // On context stop this can be called multiple times.\n+            // NO-OP is the ticker thread is not set\n+            // (i.e. stop() has already completed)\n+            if (ticker == null) {\n+                return;\n+            }\n             run = false;\n             try {\n                 ticker.join();\n@@ -47,6 +53,17 @@ public synchronized void stop() {\n             ticker = null;\n         }\n \n+        public void shutdown() {\n+            // Notify each listener of the shutdown. This enables them to\n+            // trigger any necessary clean-up.\n+            for (TickListener l : listeners) {\n+                l.shutdown();\n+            }\n+            // Wait for the thread to stop. This prevents warnings in the logs\n+            // that the thread is still active when the context stops.\n+            stop();\n+        }\n+\n         public void addTickListener(TickListener listener) {\n             if (listeners.add(listener)) {\n                 if (counter.incrementAndGet()==1) start();\n@@ -98,6 +115,7 @@ public void run() {\n \n     public static interface TickListener {\n         public void tick(Stock stock);\n+        public void shutdown();\n     }\n \n     public static final class Stock implements Cloneable {",
                "additions": 18,
                "raw_url": "https://github.com/apache/tomcat80/raw/df1b0ff968f1f03cc661e3837de2eda91bd30c74/webapps/examples/WEB-INF/classes/async/Stockticker.java",
                "status": "modified",
                "changes": 18,
                "deletions": 0,
                "sha": "e87744e357e43025795c2172f9c3c48a99dc02a4",
                "blob_url": "https://github.com/apache/tomcat80/blob/df1b0ff968f1f03cc661e3837de2eda91bd30c74/webapps/examples/WEB-INF/classes/async/Stockticker.java",
                "filename": "webapps/examples/WEB-INF/classes/async/Stockticker.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/examples/WEB-INF/classes/async/Stockticker.java?ref=df1b0ff968f1f03cc661e3837de2eda91bd30c74"
            },
            {
                "patch": "@@ -115,6 +115,11 @@\n         <listener-class>listeners.SessionListener</listener-class>\n     </listener>\n \n+    <!-- Define listeners required by examples -->\n+    <listener>\n+        <listener-class>async.AsyncStockContextListener</listener-class>\n+    </listener>\n+\n     <!-- Define servlets that are included in the example application -->\n \n     <servlet>",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/df1b0ff968f1f03cc661e3837de2eda91bd30c74/webapps/examples/WEB-INF/web.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "3e74cb46003dcea3092babb20611a99a7d4b1cfa",
                "blob_url": "https://github.com/apache/tomcat80/blob/df1b0ff968f1f03cc661e3837de2eda91bd30c74/webapps/examples/WEB-INF/web.xml",
                "filename": "webapps/examples/WEB-INF/web.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/examples/WEB-INF/web.xml?ref=df1b0ff968f1f03cc661e3837de2eda91bd30c74"
            }
        ],
        "bug_id": "tomcat80_4",
        "parent": "https://github.com/apache/tomcat80/commit/437947f03b6fbf5bbf0f98f85c26156055ba8121",
        "message": "Prevent NullPointerException and other errors if the stock ticker example is running when the examples web application is stopped.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1820708 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/008da9eeff22400400075638a05afa4f4b0c5b0b",
        "file": [
            {
                "patch": "@@ -123,6 +123,8 @@ public void fireOnComplete() {\n     public boolean timeout() {\n         AtomicBoolean result = new AtomicBoolean();\n         request.getCoyoteRequest().action(ActionCode.ASYNC_TIMEOUT, result);\n+        // Avoids NPEs during shutdown. A call to recycle will null this field.\n+        Context context = this.context;\n \n         if (result.get()) {\n             ClassLoader oldCL = context.bind(false, null);",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/008da9eeff22400400075638a05afa4f4b0c5b0b/java/org/apache/catalina/core/AsyncContextImpl.java",
                "status": "modified",
                "changes": 2,
                "deletions": 0,
                "sha": "6f6855c78f2741e9441094c31b8eeaaac67c28b0",
                "blob_url": "https://github.com/apache/tomcat80/blob/008da9eeff22400400075638a05afa4f4b0c5b0b/java/org/apache/catalina/core/AsyncContextImpl.java",
                "filename": "java/org/apache/catalina/core/AsyncContextImpl.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/AsyncContextImpl.java?ref=008da9eeff22400400075638a05afa4f4b0c5b0b"
            },
            {
                "patch": "@@ -72,6 +72,10 @@\n         ensure that an HTTP session exists when initiating a WebSocket\n         connection. Patch provided by isapir. (markt)\n       </add>\n+      <fix>\n+        Avoid a possible <code>NullPointerException</code> when timing out\n+        <code>AsyncContext</code> instances during shut down. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/008da9eeff22400400075638a05afa4f4b0c5b0b/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "d5fd449bc5c40df585f8b680e2b043fa43b72f01",
                "blob_url": "https://github.com/apache/tomcat80/blob/008da9eeff22400400075638a05afa4f4b0c5b0b/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=008da9eeff22400400075638a05afa4f4b0c5b0b"
            }
        ],
        "bug_id": "tomcat80_5",
        "parent": "https://github.com/apache/tomcat80/commit/2fcc6ab799351f8872836354e39c74c94247d788",
        "message": "Avoid a possible NullPointerException when timing out AsyncContext instances during shut down.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1815507 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/083c4fab768e9c75a742fddab933a5afd4bb117f",
        "file": [
            {
                "patch": "@@ -1519,6 +1519,9 @@ public void setAttribute(String name, Object value) {\n     private void notifyAttributeAssigned(String name, Object value,\n             Object oldValue) {\n         Context context = getContext();\n+        if (context == null) {\n+            return;\n+        }\n         Object listeners[] = context.getApplicationEventListeners();\n         if ((listeners == null) || (listeners.length == 0)) {\n             return;",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/083c4fab768e9c75a742fddab933a5afd4bb117f/java/org/apache/catalina/connector/Request.java",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "bc2402b19769ce39ade98ffa8814bd5d55268766",
                "blob_url": "https://github.com/apache/tomcat80/blob/083c4fab768e9c75a742fddab933a5afd4bb117f/java/org/apache/catalina/connector/Request.java",
                "filename": "java/org/apache/catalina/connector/Request.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/Request.java?ref=083c4fab768e9c75a742fddab933a5afd4bb117f"
            },
            {
                "patch": "@@ -111,6 +111,11 @@\n         of the <code>JreMemoryLeakPreventionListener</code> when running on Java\n         9 and above since the underlying JRE bug has been fixed. (markt)\n       </add>\n+      <fix>\n+        <bug>62263</bug>: Avoid a <code>NullPointerException</code> when the\n+        <code>RemoteIpValve</code> processes a request for which no Context can\n+        be found. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/083c4fab768e9c75a742fddab933a5afd4bb117f/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "990e1d6c8995cfad501fd7c571bbcc583760c030",
                "blob_url": "https://github.com/apache/tomcat80/blob/083c4fab768e9c75a742fddab933a5afd4bb117f/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=083c4fab768e9c75a742fddab933a5afd4bb117f"
            }
        ],
        "bug_id": "tomcat80_6",
        "parent": "https://github.com/apache/tomcat80/commit/be096d832f07a8ea176c6dd59b969ec7b0e02614",
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=62263\nAvoid a NullPointerException when the RemoteIpValve processes a request for which no Context can be found.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1828567 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/ac8ba5965da26cb035e39473482765db0c71a8d6",
        "file": [
            {
                "patch": "@@ -129,8 +129,10 @@ private void registerListenersForServer(Server server) {\n         for (Service service : server.findServices()) {\n             @SuppressWarnings(\"deprecation\")\n             Engine engine = (Engine) service.getContainer();\n-            engine.addContainerListener(this);\n-            registerListenersForEngine(engine);\n+            if (engine != null) {\n+                engine.addContainerListener(this);\n+                registerListenersForEngine(engine);\n+            }\n         }\n \n     }",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/ac8ba5965da26cb035e39473482765db0c71a8d6/java/org/apache/catalina/core/ThreadLocalLeakPreventionListener.java",
                "status": "modified",
                "changes": 6,
                "deletions": 2,
                "sha": "4721731c68951851124fd82e6b230c22703f2197",
                "blob_url": "https://github.com/apache/tomcat80/blob/ac8ba5965da26cb035e39473482765db0c71a8d6/java/org/apache/catalina/core/ThreadLocalLeakPreventionListener.java",
                "filename": "java/org/apache/catalina/core/ThreadLocalLeakPreventionListener.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/ThreadLocalLeakPreventionListener.java?ref=ac8ba5965da26cb035e39473482765db0c71a8d6"
            },
            {
                "patch": "@@ -54,6 +54,10 @@\n       <fix>\n         Avoid duplicate load attempts if one has been made already. (remm)\n       </fix>\n+      <fix>\n+        Avoid NPE in ThreadLocalLeakPreventionListener if there is no Engine.\n+        (remm)\n+      </fix>\n       <fix>\n         <bug>62036</bug>: When caching an authenticated user Principal in the\n         session when the web application is configured with the",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/ac8ba5965da26cb035e39473482765db0c71a8d6/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "a26242e18ffe8f86ada174018c4795b9456fa4fa",
                "blob_url": "https://github.com/apache/tomcat80/blob/ac8ba5965da26cb035e39473482765db0c71a8d6/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=ac8ba5965da26cb035e39473482765db0c71a8d6"
            }
        ],
        "bug_id": "tomcat80_7",
        "parent": "https://github.com/apache/tomcat80/commit/3566da5bf4a56c734385225154b23df6ca61a0b0",
        "message": " Avoid NPE if there is no Engine.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1822138 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/10e7e94f8672c35bb72a7480e3ad679094ef02c4",
        "file": [
            {
                "patch": "@@ -25,6 +25,8 @@\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.atomic.AtomicInteger;\n \n+import org.apache.juli.logging.Log;\n+import org.apache.juli.logging.LogFactory;\n import org.apache.tomcat.jdbc.pool.ConnectionPool;\n import org.apache.tomcat.jdbc.pool.PoolProperties.InterceptorProperty;\n import org.apache.tomcat.jdbc.pool.PooledConnection;\n@@ -34,6 +36,7 @@\n  * {@code CallableStatement} instances on a connection.\n  */\n public class StatementCache extends StatementDecoratorInterceptor {\n+    private static final Log log = LogFactory.getLog(StatementCache.class);\n     protected static final String[] ALL_TYPES = new String[] {PREPARE_STATEMENT,PREPARE_CALL};\n     protected static final String[] CALLABLE_TYPE = new String[] {PREPARE_CALL};\n     protected static final String[] PREPARED_TYPE = new String[] {PREPARE_STATEMENT};\n@@ -198,16 +201,14 @@ public CachedStatement isCached(String sql) {\n     }\n \n     public CachedStatement isCached(Method method, Object[] args) {\n-        @SuppressWarnings(\"unchecked\")\n-        ConcurrentHashMap<CacheKey,CachedStatement> cache =\n-            (ConcurrentHashMap<CacheKey,CachedStatement>)pcon.getAttributes().get(STATEMENT_CACHE_ATTR);\n+        ConcurrentHashMap<CacheKey,CachedStatement> cache = getCache();\n+        if (cache == null) return null;\n         return cache.get(createCacheKey(method, args));\n     }\n \n     public boolean cacheStatement(CachedStatement proxy) {\n-        @SuppressWarnings(\"unchecked\")\n-        ConcurrentHashMap<CacheKey,CachedStatement> cache =\n-            (ConcurrentHashMap<CacheKey,CachedStatement>)pcon.getAttributes().get(STATEMENT_CACHE_ATTR);\n+        ConcurrentHashMap<CacheKey,CachedStatement> cache = getCache();\n+        if (cache == null) return false;\n         if (proxy.getCacheKey()==null) {\n             return false;\n         } else if (cache.containsKey(proxy.getCacheKey())) {\n@@ -225,9 +226,8 @@ public boolean cacheStatement(CachedStatement proxy) {\n     }\n \n     public boolean removeStatement(CachedStatement proxy) {\n-        @SuppressWarnings(\"unchecked\")\n-        ConcurrentHashMap<CacheKey,CachedStatement> cache =\n-            (ConcurrentHashMap<CacheKey,CachedStatement>)pcon.getAttributes().get(STATEMENT_CACHE_ATTR);\n+        ConcurrentHashMap<CacheKey,CachedStatement> cache = getCache();\n+        if (cache == null) return false;\n         if (cache.remove(proxy.getCacheKey()) != null) {\n             cacheSize.decrementAndGet();\n             return true;\n@@ -237,6 +237,17 @@ public boolean removeStatement(CachedStatement proxy) {\n     }\n     /*end the actual statement cache*/\n \n+    protected ConcurrentHashMap<CacheKey,CachedStatement> getCache() {\n+        PooledConnection pCon = this.pcon;\n+        if (pCon == null) {\n+            if (log.isWarnEnabled()) log.warn(\"Connection has already been closed or abandoned\");\n+            return null;\n+        }\n+        @SuppressWarnings(\"unchecked\")\n+        ConcurrentHashMap<CacheKey,CachedStatement> cache =\n+                (ConcurrentHashMap<CacheKey,CachedStatement>)pCon.getAttributes().get(STATEMENT_CACHE_ATTR);\n+        return cache;\n+    }\n \n     protected class CachedStatement extends StatementDecoratorInterceptor.StatementProxy<Statement> {\n         boolean cached = false;",
                "additions": 20,
                "raw_url": "https://github.com/apache/tomcat80/raw/10e7e94f8672c35bb72a7480e3ad679094ef02c4/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/StatementCache.java",
                "status": "modified",
                "changes": 29,
                "deletions": 9,
                "sha": "58bd091fb114a835548b03f7bf5343388aceabef",
                "blob_url": "https://github.com/apache/tomcat80/blob/10e7e94f8672c35bb72a7480e3ad679094ef02c4/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/StatementCache.java",
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/StatementCache.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/StatementCache.java?ref=10e7e94f8672c35bb72a7480e3ad679094ef02c4"
            },
            {
                "patch": "@@ -128,6 +128,14 @@\n       </add>\n     </changelog>\n   </subsection>\n+  <subsection name=\"jdbc-pool\">\n+    <changelog>\n+      <fix>\n+        <bug>61312</bug>: Prevent <code>NullPointerException</code>n when using\n+        the statement cache of connection that has been closed. (kfujino)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection name=\"Other\">\n     <changelog>\n       <update>",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/10e7e94f8672c35bb72a7480e3ad679094ef02c4/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 8,
                "deletions": 0,
                "sha": "78e8bd04b1943de07f4c4e0f628f61bfab031ee6",
                "blob_url": "https://github.com/apache/tomcat80/blob/10e7e94f8672c35bb72a7480e3ad679094ef02c4/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=10e7e94f8672c35bb72a7480e3ad679094ef02c4"
            }
        ],
        "bug_id": "tomcat80_8",
        "parent": "https://github.com/apache/tomcat80/commit/df1b0ff968f1f03cc661e3837de2eda91bd30c74",
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61312\nPrevent NullPointerException when using the statement cache of connection that has been closed.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1820818 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/860e0c31a8b8f2d158e0ed094480d72188b1a18c",
        "file": [
            {
                "patch": "@@ -163,11 +163,15 @@ public void reset() throws IOException {\n         if (multiRelease == null) {\n             if (JreCompat.isJre9Available()) {\n                 Manifest manifest = jarInputStream.getManifest();\n-                String mrValue = manifest.getMainAttributes().getValue(\"Multi-Release\");\n-                if (mrValue == null) {\n+                if (manifest == null) {\n                     multiRelease = Boolean.FALSE;\n                 } else {\n-                    multiRelease = Boolean.valueOf(mrValue);\n+                    String mrValue = manifest.getMainAttributes().getValue(\"Multi-Release\");\n+                    if (mrValue == null) {\n+                        multiRelease = Boolean.FALSE;\n+                    } else {\n+                        multiRelease = Boolean.valueOf(mrValue);\n+                    }\n                 }\n             } else {\n                 multiRelease = Boolean.FALSE;",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/860e0c31a8b8f2d158e0ed094480d72188b1a18c/java/org/apache/tomcat/util/scan/AbstractInputStreamJar.java",
                "status": "modified",
                "changes": 10,
                "deletions": 3,
                "sha": "e765c463b4eef2c4b52da9a78a380ec8ca6802a9",
                "blob_url": "https://github.com/apache/tomcat80/blob/860e0c31a8b8f2d158e0ed094480d72188b1a18c/java/org/apache/tomcat/util/scan/AbstractInputStreamJar.java",
                "filename": "java/org/apache/tomcat/util/scan/AbstractInputStreamJar.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/scan/AbstractInputStreamJar.java?ref=860e0c31a8b8f2d158e0ed094480d72188b1a18c"
            }
        ],
        "bug_id": "tomcat80_9",
        "parent": "https://github.com/apache/tomcat80/commit/59a6d2fa55ac9b4b0457fe949be50628adf998e1",
        "message": "Avoid possible NPE if no manifest is present.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1815327 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/747b321af2365375b11f602e1ccdee3affb54d58",
        "file": [
            {
                "patch": "@@ -25,6 +25,7 @@\n import java.lang.reflect.Proxy;\n import java.sql.CallableStatement;\n import java.sql.PreparedStatement;\n+import java.sql.SQLException;\n import java.sql.Statement;\n \n import org.apache.juli.logging.Log;\n@@ -106,7 +107,7 @@ public Object invoke(Object proxy, Method method, Object[] args) throws Throwabl\n             if (compare(ISCLOSED_VAL, method)) {\n                 if (delegate == null) return Boolean.TRUE;\n             }\n-\n+            if (delegate == null) throw new SQLException(\"Statement closed.\");\n             Object result =  null;\n             try {\n                 //invoke next",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/747b321af2365375b11f602e1ccdee3affb54d58/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/StatementFacade.java",
                "status": "modified",
                "changes": 3,
                "deletions": 1,
                "sha": "eac84838d46b4f07db1748f5b9274b6b341fda34",
                "blob_url": "https://github.com/apache/tomcat80/blob/747b321af2365375b11f602e1ccdee3affb54d58/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/StatementFacade.java",
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/StatementFacade.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/StatementFacade.java?ref=747b321af2365375b11f602e1ccdee3affb54d58"
            },
            {
                "patch": "@@ -60,6 +60,11 @@\n         Refactor the creating a constructor for a proxy class to reduce\n         duplicate code. (kfujino)\n       </scode>\n+      <fix>\n+        In <code>StatementFacade</code>, the method call on the statements that\n+        have been closed throw <code>SQLException</code> rather than\n+        <code>NullPointerException</code>. (kfujino)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Other\">",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/747b321af2365375b11f602e1ccdee3affb54d58/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "5bdaee2462db62e8c9471c241752502faed40fd1",
                "blob_url": "https://github.com/apache/tomcat80/blob/747b321af2365375b11f602e1ccdee3affb54d58/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=747b321af2365375b11f602e1ccdee3affb54d58"
            }
        ],
        "bug_id": "tomcat80_10",
        "parent": "https://github.com/apache/tomcat80/commit/2d64f05eee59135bbaf0192ce9a56d5f72351df0",
        "message": "In StatementFacade, the method call on the statements that have been closed throw SQLException rather than NullPointerException.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1789919 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/13088b8b71b6e06833d3b594bb70ecc86a962efb",
        "file": [
            {
                "patch": "@@ -1830,15 +1830,21 @@ public void run() {\n                             pollerSpace[i] += rv;\n                             connectionCount.addAndGet(-rv);\n                             for (int n = 0; n < rv; n++) {\n-                                long timeout = timeouts.remove(desc[n*2+1]);\n-                                AprSocketWrapper wrapper = connections.get(\n-                                        Long.valueOf(desc[n*2+1]));\n                                 if (getLog().isDebugEnabled()) {\n                                     log.debug(sm.getString(\n                                             \"endpoint.debug.pollerProcess\",\n                                             Long.valueOf(desc[n*2+1]),\n                                             Long.valueOf(desc[n*2])));\n                                 }\n+                                long timeout = timeouts.remove(desc[n*2+1]);\n+                                AprSocketWrapper wrapper = connections.get(\n+                                        Long.valueOf(desc[n*2+1]));\n+                                if (wrapper == null) {\n+                                    // Socket was closed in another thread while still in\n+                                    // the Poller but wasn't removed from the Poller before\n+                                    // new data arrived.\n+                                    continue;\n+                                }\n                                 wrapper.pollerFlags = wrapper.pollerFlags & ~((int) desc[n*2]);\n                                 // Check for failed sockets and hand this socket off to a worker\n                                 if (wrapper.isComet()) {",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/13088b8b71b6e06833d3b594bb70ecc86a962efb/java/org/apache/tomcat/util/net/AprEndpoint.java",
                "status": "modified",
                "changes": 12,
                "deletions": 3,
                "sha": "703f3efea0e4813fbed6890aa2c27fe54821573c",
                "blob_url": "https://github.com/apache/tomcat80/blob/13088b8b71b6e06833d3b594bb70ecc86a962efb/java/org/apache/tomcat/util/net/AprEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/AprEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/AprEndpoint.java?ref=13088b8b71b6e06833d3b594bb70ecc86a962efb"
            },
            {
                "patch": "@@ -89,6 +89,11 @@\n         Fix random <code>SocketTimeoutException</code>s when reading the request\n         <code>InputStream</code>. Based on a patch by Peter Major. (markt)\n       </fix>\n+      <fix>\n+        <bug>60900</bug>: Avoid a <code>NullPointerException</code> in the APR\n+        Poller if a connection is closed at the same time as new data arrives on\n+        that connection. (markt) \n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Web applications\">",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/13088b8b71b6e06833d3b594bb70ecc86a962efb/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "ab54317b3a5f6599f80976e6ccc1e679cf7bd976",
                "blob_url": "https://github.com/apache/tomcat80/blob/13088b8b71b6e06833d3b594bb70ecc86a962efb/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=13088b8b71b6e06833d3b594bb70ecc86a962efb"
            }
        ],
        "bug_id": "tomcat80_11",
        "parent": "https://github.com/apache/tomcat80/commit/9a9bdad5efeac747d043008bac7ee56ae39e064a",
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60900\nAvoid a NullPointerException in the APR Poller if a connection is closed at the same time as new data arrives on that connection.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1806909 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/50d5a4b670a04cfa0aa5749e254bf024bb3a066d",
        "file": [
            {
                "patch": "@@ -409,6 +409,9 @@ public boolean equals(Object o) {\n     }\n \n     public Member[] getMapMembersExcl(Member[] exclude) {\n+        if (exclude == null) {\n+            return null;\n+        }\n         synchronized (mapMembers) {\n             @SuppressWarnings(\"unchecked\") // mapMembers has the correct type\n             HashMap<Member, Long> list = (HashMap<Member, Long>)mapMembers.clone();",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/50d5a4b670a04cfa0aa5749e254bf024bb3a066d/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "acf02722cc4398000817b488ec5e5e319b8b3b0c",
                "blob_url": "https://github.com/apache/tomcat80/blob/50d5a4b670a04cfa0aa5749e254bf024bb3a066d/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "filename": "java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java?ref=50d5a4b670a04cfa0aa5749e254bf024bb3a066d"
            }
        ],
        "bug_id": "tomcat80_12",
        "parent": "https://github.com/apache/tomcat80/commit/8588fed712cc750d80ed9ba2ea4d339c16a85bb1",
        "message": "Fix NPE reported by FindBugs\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1801003 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/eceef193c57cf3864d943771a32b31097bf8ae43",
        "file": [
            {
                "patch": "@@ -562,7 +562,11 @@ public boolean accept(Path path) throws IOException {\n     }\n \n     private String obtainDateFromPath(Path path) {\n-        String date = path.getFileName().toString();\n+        Path fileName = path.getFileName();\n+        if (fileName == null) {\n+            return null;\n+        }\n+        String date = fileName.toString();\n         if (pattern.matcher(date).matches()) {\n             date = date.substring(prefix.length());\n             return date.substring(0, date.length() - suffix.length());",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/eceef193c57cf3864d943771a32b31097bf8ae43/java/org/apache/juli/FileHandler.java",
                "status": "modified",
                "changes": 6,
                "deletions": 1,
                "sha": "5467a32728814c968030a14bede323d70cdf321c",
                "blob_url": "https://github.com/apache/tomcat80/blob/eceef193c57cf3864d943771a32b31097bf8ae43/java/org/apache/juli/FileHandler.java",
                "filename": "java/org/apache/juli/FileHandler.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/juli/FileHandler.java?ref=eceef193c57cf3864d943771a32b31097bf8ae43"
            }
        ],
        "bug_id": "tomcat80_13",
        "parent": "https://github.com/apache/tomcat80/commit/edc67a8bfdb0751a61ff75fb8fc55d170bac2108",
        "message": "Avoid possible NPE.\nReported by FindBugs.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1800983 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/011c6456105a9fc35052043c7aedc3a9814a13e6",
        "file": [
            {
                "patch": "@@ -431,6 +431,10 @@ public void setErrorState(Throwable t, boolean fireOnError) {\n         if (result.get()) {\n             // No listener called dispatch() or complete(). This is an error.\n             // SRV.2.3.3.3 (search for \"error dispatch\")\n+            // Take a local copy to avoid threading issues if another thread\n+            // clears this (can happen during error handling with non-container\n+            // threads)\n+            ServletResponse servletResponse = this.servletResponse;\n             if (servletResponse instanceof HttpServletResponse) {\n                 ((HttpServletResponse) servletResponse).setStatus(\n                         HttpServletResponse.SC_INTERNAL_SERVER_ERROR);",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/011c6456105a9fc35052043c7aedc3a9814a13e6/java/org/apache/catalina/core/AsyncContextImpl.java",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "82a37677c0fc52381ce88975499c1fc3b94a2d6b",
                "blob_url": "https://github.com/apache/tomcat80/blob/011c6456105a9fc35052043c7aedc3a9814a13e6/java/org/apache/catalina/core/AsyncContextImpl.java",
                "filename": "java/org/apache/catalina/core/AsyncContextImpl.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/AsyncContextImpl.java?ref=011c6456105a9fc35052043c7aedc3a9814a13e6"
            }
        ],
        "bug_id": "tomcat80_14",
        "parent": "https://github.com/apache/tomcat80/commit/ff95c6e45429ffa6c98977de5b7441037b6803e5",
        "message": "Avoid NPE during non-container thread error handling\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1799934 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/cfca14d137fb5ba64720b318cd54dba28e0d43c5",
        "file": [
            {
                "patch": "@@ -332,21 +332,23 @@ public static Object coerceToType(Class<?> type, String value) {\n                     throws DeploymentException{\n \n         List<DecoderEntry> result = new ArrayList<>();\n-        for (Class<? extends Decoder> decoderClazz : decoderClazzes) {\n-            // Need to instantiate decoder to ensure it is valid and that\n-            // deployment can be failed if it is not\n-            @SuppressWarnings(\"unused\")\n-            Decoder instance;\n-            try {\n-                instance = decoderClazz.newInstance();\n-            } catch (InstantiationException | IllegalAccessException e) {\n-                throw new DeploymentException(\n-                        sm.getString(\"pojoMethodMapping.invalidDecoder\",\n-                                decoderClazz.getName()), e);\n+        if (decoderClazzes != null) {\n+            for (Class<? extends Decoder> decoderClazz : decoderClazzes) {\n+                // Need to instantiate decoder to ensure it is valid and that\n+                // deployment can be failed if it is not\n+                @SuppressWarnings(\"unused\")\n+                Decoder instance;\n+                try {\n+                    instance = decoderClazz.newInstance();\n+                } catch (InstantiationException | IllegalAccessException e) {\n+                    throw new DeploymentException(\n+                            sm.getString(\"pojoMethodMapping.invalidDecoder\",\n+                                    decoderClazz.getName()), e);\n+                }\n+                DecoderEntry entry = new DecoderEntry(\n+                        Util.getDecoderType(decoderClazz), decoderClazz);\n+                result.add(entry);\n             }\n-            DecoderEntry entry = new DecoderEntry(\n-                    Util.getDecoderType(decoderClazz), decoderClazz);\n-            result.add(entry);\n         }\n \n         return result;",
                "additions": 16,
                "raw_url": "https://github.com/apache/tomcat80/raw/cfca14d137fb5ba64720b318cd54dba28e0d43c5/java/org/apache/tomcat/websocket/Util.java",
                "status": "modified",
                "changes": 30,
                "deletions": 14,
                "sha": "22d3b4514d1a79e8f2407efd3b3235646a1107a0",
                "blob_url": "https://github.com/apache/tomcat80/blob/cfca14d137fb5ba64720b318cd54dba28e0d43c5/java/org/apache/tomcat/websocket/Util.java",
                "filename": "java/org/apache/tomcat/websocket/Util.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/Util.java?ref=cfca14d137fb5ba64720b318cd54dba28e0d43c5"
            }
        ],
        "bug_id": "tomcat80_15",
        "parent": "https://github.com/apache/tomcat80/commit/c9d804dd1c75eb63cb0c7a6e59d85d0c77d67bb1",
        "message": "NPE protection. Note NPE only possible with test code.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1630199 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/9611500d8e8fddb76abd4149d7536d51e7a2ca0a",
        "file": [
            {
                "patch": "@@ -679,7 +679,7 @@ public void processExpires() {\n         if(log.isDebugEnabled())\n             log.debug(\"Start expire sessions \" + getName() + \" at \" + timeNow + \" sessioncount \" + sessions.length);\n         for (int i = 0; i < sessions.length; i++) {\n-            if (!sessions[i].isValid()) {\n+            if (sessions[i]!=null && !sessions[i].isValid()) {\n                 expireHere++;\n             }\n         }",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/9611500d8e8fddb76abd4149d7536d51e7a2ca0a/java/org/apache/catalina/session/ManagerBase.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "ae71cf9dc3bd3ba3a4ccdfcb65679fe0a209d48c",
                "blob_url": "https://github.com/apache/tomcat80/blob/9611500d8e8fddb76abd4149d7536d51e7a2ca0a/java/org/apache/catalina/session/ManagerBase.java",
                "filename": "java/org/apache/catalina/session/ManagerBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/session/ManagerBase.java?ref=9611500d8e8fddb76abd4149d7536d51e7a2ca0a"
            }
        ],
        "bug_id": "tomcat80_16",
        "parent": "https://github.com/apache/tomcat80/commit/41abc2c175ea358dd5a4c0b0bc92203423a9a4b4",
        "message": "fix NPE\njava.lang.NullPointerException at org.apache.catalina.session.ManagerBase.processExpires(ManagerBase.java:682)\n        at org.apache.catalina.session.ManagerBase.backgroundProcess(ManagerBase.java:667)\n        at org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1316)\n        at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1601)\n        at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1610)\n        at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1610)\n        at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1590)\n        at java.lang.Thread.run(Thread.java:619)\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@627689 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/cf5b1344dcd9ccce9435b07b2e20435e493b66a2",
        "file": [
            {
                "patch": "@@ -67,18 +67,21 @@ public void setUp() throws Exception {\n \n     @After\n     public void tearDown() {\n-        for (File file : logsDir.listFiles()) {\n-            file.delete();\n+        File[] files = logsDir.listFiles();\n+        if (files != null) {\n+            for (File file : files) {\n+                file.delete();\n+            }\n+            logsDir.delete();\n         }\n-        logsDir.delete();\n     }\n \n     @SuppressWarnings(\"unused\")\n     @Test\n     public void testCleanOnInitOneHandler() throws Exception {\n         generateLogFiles(logsDir, PREFIX_1, SUFIX_1, 3);\n \n-        FileHandler handler = new FileHandler(logsDir.getAbsolutePath(), PREFIX_1, SUFIX_1, 2);\n+        new FileHandler(logsDir.getAbsolutePath(), PREFIX_1, SUFIX_1, 2);\n \n         Thread.sleep(1000);\n \n@@ -90,10 +93,10 @@ public void testCleanOnInitOneHandler() throws Exception {\n     public void testCleanOnInitMultipleHandlers() throws Exception {\n         generateLogFiles(logsDir, PREFIX_1, SUFIX_1, 3);\n \n-        FileHandler handler1 = new FileHandler(logsDir.getAbsolutePath(), PREFIX_1, SUFIX_1, 2);\n-        FileHandler handler2 = new FileHandler(logsDir.getAbsolutePath(), PREFIX_1, SUFIX_2, 2);\n-        FileHandler handler3 = new FileHandler(logsDir.getAbsolutePath(), PREFIX_2, SUFIX_1, 2);\n-        FileHandler handler4 = new FileHandler(logsDir.getAbsolutePath(), PREFIX_3, SUFIX_1, 2);\n+        new FileHandler(logsDir.getAbsolutePath(), PREFIX_1, SUFIX_1, 2);\n+        new FileHandler(logsDir.getAbsolutePath(), PREFIX_1, SUFIX_2, 2);\n+        new FileHandler(logsDir.getAbsolutePath(), PREFIX_2, SUFIX_1, 2);\n+        new FileHandler(logsDir.getAbsolutePath(), PREFIX_3, SUFIX_1, 2);\n \n         Thread.sleep(1000);\n \n@@ -105,7 +108,7 @@ public void testCleanOnInitMultipleHandlers() throws Exception {\n     public void testCleanDisabled() throws Exception {\n         generateLogFiles(logsDir, PREFIX_1, SUFIX_1, 3);\n \n-        FileHandler handler = new FileHandler(logsDir.getAbsolutePath(), PREFIX_1, SUFIX_1, -1);\n+        new FileHandler(logsDir.getAbsolutePath(), PREFIX_1, SUFIX_1, -1);\n \n         Thread.sleep(1000);\n ",
                "additions": 12,
                "raw_url": "https://github.com/apache/tomcat80/raw/cf5b1344dcd9ccce9435b07b2e20435e493b66a2/test/org/apache/juli/TestFileHandler.java",
                "status": "modified",
                "changes": 21,
                "deletions": 9,
                "sha": "b0969a387f61dce40d3999422c7c040d090deb8a",
                "blob_url": "https://github.com/apache/tomcat80/blob/cf5b1344dcd9ccce9435b07b2e20435e493b66a2/test/org/apache/juli/TestFileHandler.java",
                "filename": "test/org/apache/juli/TestFileHandler.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/juli/TestFileHandler.java?ref=cf5b1344dcd9ccce9435b07b2e20435e493b66a2"
            }
        ],
        "bug_id": "tomcat80_17",
        "parent": "https://github.com/apache/tomcat80/commit/e6a1cd1901713624d8d1ef24e265034aa367e376",
        "message": "Fix NPE and dead store warnings.\nReported by FindBugs.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1800990 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/e864641a42063e10cc14cc71682b722743c529c2",
        "file": [
            {
                "patch": "@@ -106,9 +106,13 @@\n \n                 {\n                     SecurityManager s = System.getSecurityManager();\n-                    this.isSecurityEnabled = s != null;\n-                    this.group = isSecurityEnabled ? s.getThreadGroup()\n-                            : Thread.currentThread().getThreadGroup();\n+                    if (s == null) {\n+                        this.isSecurityEnabled = false;\n+                        this.group = Thread.currentThread().getThreadGroup();\n+                    } else {\n+                        this.isSecurityEnabled = true;\n+                        this.group = s.getThreadGroup();\n+                    }\n                 }\n \n                 @Override",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/e864641a42063e10cc14cc71682b722743c529c2/java/org/apache/juli/FileHandler.java",
                "status": "modified",
                "changes": 10,
                "deletions": 3,
                "sha": "8a1233329e2772b97532ea04d31817bc8f0abcfc",
                "blob_url": "https://github.com/apache/tomcat80/blob/e864641a42063e10cc14cc71682b722743c529c2/java/org/apache/juli/FileHandler.java",
                "filename": "java/org/apache/juli/FileHandler.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/juli/FileHandler.java?ref=e864641a42063e10cc14cc71682b722743c529c2"
            }
        ],
        "bug_id": "tomcat80_18",
        "parent": "https://github.com/apache/tomcat80/commit/f9127cd06f94a2be4b8857d557801bb6979ec615",
        "message": "Refactor.\nIt is more verbose but it stops Eclipse complaining about a possible NPE.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1800314 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/03beb42e1d3990c738aae51b740a94a039ca764d",
        "file": [
            {
                "patch": "@@ -577,45 +577,50 @@ static int readHostIPv6(Reader reader) throws IOException {\n         int h16Size = 0;\n         int pos = 1;\n         boolean parsedDoubleColon = false;\n-        boolean previousWasColon = false;\n+        int precedingColonsCount = 0;\n \n         do {\n             c = reader.read();\n-            if (h16Count == 0 && previousWasColon && c != ':') {\n+            if (h16Count == 0 && precedingColonsCount == 1 && c != ':') {\n                 // Can't start with a single :\n                 throw new IllegalArgumentException();\n             }\n             if (HttpParser.isHex(c)) {\n                 if (h16Size == 0) {\n                     // Start of a new h16 block\n-                    previousWasColon = false;\n+                    precedingColonsCount = 0;\n                     h16Count++;\n-                    reader.mark(4);\n                 }\n                 h16Size++;\n                 if (h16Size > 4) {\n                     throw new IllegalArgumentException();\n                 }\n             } else if (c == ':') {\n-                if (previousWasColon) {\n-                    // End of ::\n-                    if (parsedDoubleColon) {\n-                        // Only allowed one :: sequence\n-                        throw new IllegalArgumentException();\n-                    }\n-                    parsedDoubleColon = true;\n-                    previousWasColon = false;\n-                    // :: represents at least one h16 block\n-                    h16Count++;\n+                if (precedingColonsCount >=2 ) {\n+                    // ::: is not allowed\n+                    throw new IllegalArgumentException();\n                 } else {\n-                    previousWasColon = true;\n+                    if(precedingColonsCount == 1) {\n+                        // End of ::\n+                        if (parsedDoubleColon ) {\n+                            // Only allowed one :: sequence\n+                            throw new IllegalArgumentException();\n+                        }\n+                        parsedDoubleColon = true;\n+                        // :: represents at least one h16 block\n+                        h16Count++;\n+                    }\n+                    precedingColonsCount++;\n+                    // mark if the next symbol is hex before the actual read\n+                    reader.mark(4);\n                 }\n                 h16Size = 0;\n             } else if (c == ']') {\n-                if (previousWasColon) {\n+                if (precedingColonsCount == 1) {\n                     // Can't end on a single ':'\n                     throw new IllegalArgumentException();\n                 }\n+                pos++;\n                 break;\n             } else if (c == '.') {\n                 if (h16Count == 7 || h16Count < 7 && parsedDoubleColon) {\n@@ -641,9 +646,12 @@ static int readHostIPv6(Reader reader) throws IOException {\n \n         c = reader.read();\n         if (c == ':') {\n-            return pos + 1;\n+            return pos;\n         } else {\n-            return -1;\n+            if(c == -1) {\n+                return -1;\n+            }\n+            throw new IllegalArgumentException();\n         }\n     }\n ",
                "additions": 26,
                "raw_url": "https://github.com/apache/tomcat80/raw/03beb42e1d3990c738aae51b740a94a039ca764d/java/org/apache/tomcat/util/http/parser/HttpParser.java",
                "status": "modified",
                "changes": 44,
                "deletions": 18,
                "sha": "a9454935827cc52782656a770924b8c876764831",
                "blob_url": "https://github.com/apache/tomcat80/blob/03beb42e1d3990c738aae51b740a94a039ca764d/java/org/apache/tomcat/util/http/parser/HttpParser.java",
                "filename": "java/org/apache/tomcat/util/http/parser/HttpParser.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/http/parser/HttpParser.java?ref=03beb42e1d3990c738aae51b740a94a039ca764d"
            },
            {
                "patch": "@@ -49,35 +49,18 @@\n     </copy>\n \n     <!--sign the jar, the source and the pom -->\n-    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n-          inputstring=\"${gpg.passphrase}\">\n-      <arg value=\"--batch\"/>\n-      <arg value=\"--passphrase-fd\"/>\n-      <arg value=\"0\"/>\n-      <arg value=\"-a\"/>\n-      <arg value=\"-b\"/>\n-      <arg value=\"${file}\"/>\n-    </exec>\n-    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n-          inputstring=\"${gpg.passphrase}\">\n-      <arg value=\"--batch\"/>\n-      <arg value=\"--passphrase-fd\"/>\n-      <arg value=\"0\"/>\n-      <arg value=\"-a\"/>\n-      <arg value=\"-b\"/>\n-      <arg value=\"${src}\"/>\n-    </exec>\n-    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n-          inputstring=\"${gpg.passphrase}\">\n-      <arg value=\"--batch\"/>\n-      <arg value=\"--passphrase-fd\"/>\n-      <arg value=\"0\"/>\n-      <arg value=\"-a\"/>\n-      <arg value=\"-b\"/>\n-      <arg value=\"-o\"/>\n-      <arg value=\"${pom}.asc\"/>\n-      <arg value=\"${pom}.tmp\"/>\n-    </exec>\n+    <antcall target=\"-sign\" >\n+      <param name=\"file.in\" value=\"@{file}\" />\n+      <param name=\"file.out\" value=\"@{file}.asc\" />\n+    </antcall>\n+    <antcall target=\"-sign\" >\n+      <param name=\"file.in\" value=\"@{src}\" />\n+      <param name=\"file.out\" value=\"@{src}.asc\" />\n+    </antcall>\n+    <antcall target=\"-sign\" >\n+      <param name=\"file.in\" value=\"@{pom}.tmp\" />\n+      <param name=\"file.out\" value=\"@{pom}.asc\" />\n+    </antcall>\n \n     <artifact:deploy file=\"${file}\">\n         <pom file=\"${pom}.tmp\"/>\n@@ -131,26 +114,14 @@\n     </copy>\n \n     <!--sign the file and pom -->\n-    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n-          inputstring=\"${gpg.passphrase}\">\n-      <arg value=\"--batch\"/>\n-      <arg value=\"--passphrase-fd\"/>\n-      <arg value=\"0\"/>\n-      <arg value=\"-a\"/>\n-      <arg value=\"-b\"/>\n-      <arg value=\"${file}\"/>\n-    </exec>\n-    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n-          inputstring=\"${gpg.passphrase}\">\n-      <arg value=\"--batch\"/>\n-      <arg value=\"--passphrase-fd\"/>\n-      <arg value=\"0\"/>\n-      <arg value=\"-a\"/>\n-      <arg value=\"-b\"/>\n-      <arg value=\"-o\"/>\n-      <arg value=\"${pom}.asc\"/>\n-      <arg value=\"${pom}.tmp\"/>\n-    </exec>\n+    <antcall target=\"-sign\" >\n+      <param name=\"file.in\" value=\"@{file}\" />\n+      <param name=\"file.out\" value=\"@{file}.asc\" />\n+    </antcall>\n+    <antcall target=\"-sign\" >\n+      <param name=\"file.in\" value=\"@{pom}.tmp\" />\n+      <param name=\"file.out\" value=\"@{pom}.asc\" />\n+    </antcall>\n \n     <artifact:deploy file=\"${file}\">\n       <pom file=\"${pom}.tmp\"/>\n@@ -198,35 +169,18 @@\n     </copy>\n \n     <!--sign the zip, the tar.gz and the pom -->\n-    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n-          inputstring=\"${gpg.passphrase}\">\n-      <arg value=\"--batch\"/>\n-      <arg value=\"--passphrase-fd\"/>\n-      <arg value=\"0\"/>\n-      <arg value=\"-a\"/>\n-      <arg value=\"-b\"/>\n-      <arg value=\"${file}.zip\"/>\n-    </exec>\n-    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n-          inputstring=\"${gpg.passphrase}\">\n-      <arg value=\"--batch\"/>\n-      <arg value=\"--passphrase-fd\"/>\n-      <arg value=\"0\"/>\n-      <arg value=\"-a\"/>\n-      <arg value=\"-b\"/>\n-      <arg value=\"${file}.tar.gz\"/>\n-    </exec>\n-    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n-          inputstring=\"${gpg.passphrase}\">\n-      <arg value=\"--batch\"/>\n-      <arg value=\"--passphrase-fd\"/>\n-      <arg value=\"0\"/>\n-      <arg value=\"-a\"/>\n-      <arg value=\"-b\"/>\n-      <arg value=\"-o\"/>\n-      <arg value=\"${pom}.asc\"/>\n-      <arg value=\"${pom}.tmp\"/>\n-    </exec>\n+    <antcall target=\"-sign\" >\n+      <param name=\"file.in\" value=\"@{file}\" />\n+      <param name=\"file.out\" value=\"@{file}.asc\" />\n+    </antcall>\n+    <antcall target=\"-sign\" >\n+      <param name=\"file.in\" value=\"@{file}.tar.gz\" />\n+      <param name=\"file.out\" value=\"@{file}.tar.gz.asc\" />\n+    </antcall>\n+    <antcall target=\"-sign\" >\n+      <param name=\"file.in\" value=\"@{pom}.tmp\" />\n+      <param name=\"file.out\" value=\"@{pom}.asc\" />\n+    </antcall>\n \n     <artifact:deploy file=\"${pom}\">\n         <pom file=\"${pom}.tmp\"/>\n@@ -262,7 +216,7 @@\n     </sequential>\n   </macrodef>\n \n-  <target name=\"generic-deploy\" depends=\"init-maven,init-gpg,init-ldap\">\n+  <target name=\"generic-deploy\" depends=\"init-maven,init-gpg-1,init-gpg-2,init-ldap\">\n     <!-- Standard jars in bin directory -->\n     <!-- Skip bootstrap.jar - it is just a subset of catalina.jar -->\n     <doMavenDeploy artifactId=\"tomcat-juli\"\n@@ -413,7 +367,11 @@\n     </antcall>\n   </target>\n \n-  <target name=\"init-gpg\">\n+  <target name=\"init-gpg-1\">\n+    <available file=\"${gpg.exec}\" property=\"gpg.exec.available\"/>\n+  </target>\n+\n+  <target name=\"init-gpg-2\" if=\"${gpg.exec.available}\">\n     <input message=\"Enter GPG pass-phrase\" addproperty=\"gpg.passphrase\" >\n       <handler type=\"secure\"/>\n     </input>\n@@ -426,4 +384,19 @@\n     </input>\n   </target>\n \n+  <target name=\"-sign\" if=\"gpg.passphrase\">\n+    <fail unless=\"file\" />\n+    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n+          inputstring=\"${gpg.passphrase}\">\n+      <arg value=\"--batch\"/>\n+      <arg value=\"--passphrase-fd\"/>\n+      <arg value=\"0\"/>\n+      <arg value=\"-a\"/>\n+      <arg value=\"-b\"/>\n+      <arg value=\"-o\"/>\n+      <arg value=\"${file.out}\"/>\n+      <arg value=\"${file.in}\"/>\n+    </exec>\n+  </target>\n+\n </project>",
                "additions": 53,
                "raw_url": "https://github.com/apache/tomcat80/raw/03beb42e1d3990c738aae51b740a94a039ca764d/res/maven/mvn-pub.xml",
                "status": "modified",
                "changes": 133,
                "deletions": 80,
                "sha": "b8504a51cbfc5aa68eba34469bdcd433a313152a",
                "blob_url": "https://github.com/apache/tomcat80/blob/03beb42e1d3990c738aae51b740a94a039ca764d/res/maven/mvn-pub.xml",
                "filename": "res/maven/mvn-pub.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/res/maven/mvn-pub.xml?ref=03beb42e1d3990c738aae51b740a94a039ca764d"
            },
            {
                "patch": "@@ -66,6 +66,7 @@\n         result.add(new Object[] { TestType.IPv4, \"0.0.0.256\", Integer.valueOf(-1), IAE} );\n         result.add(new Object[] { TestType.IPv4, \"0.a.0.0\", Integer.valueOf(-1), IAE} );\n         result.add(new Object[] { TestType.IPv4, \"0..0.0\", Integer.valueOf(-1), IAE} );\n+        result.add(new Object[] { TestType.IPv4, \"0]\", Integer.valueOf(-1), IAE} );\n         // Domain Name - valid\n         result.add(new Object[] { TestType.DOMAIN_NAME, \"localhost\", Integer.valueOf(-1), null} );\n         result.add(new Object[] { TestType.DOMAIN_NAME, \"localhost:8080\", Integer.valueOf(9), null} );\n@@ -121,6 +122,7 @@\n         result.add(new Object[] { TestType.IPv6, \"[0:0:0:0:0:0:127.0.0.1]\", Integer.valueOf(-1), null} );\n         result.add(new Object[] { TestType.IPv6, \"[0:0:0:0:0:0:127.0.0.1]:8080\",\n                 Integer.valueOf(23), null} );\n+        result.add(new Object[] { TestType.IPv6, \"[::1.2.3.4]\", Integer.valueOf(-1), null} );\n         // IPv6 - invalid\n         result.add(new Object[] { TestType.IPv6, \"[1234:5678:90AB:CDEF:1234:127.0.0.1]\",\n                 Integer.valueOf(-1), IAE} );\n@@ -136,6 +138,18 @@\n         result.add(new Object[] { TestType.IPv6, \"[0::0::127.0.0.1]\", Integer.valueOf(-1), IAE} );\n         result.add(new Object[] { TestType.IPv6, \"[0:0:G:0:0:0:127.0.0.1]\", Integer.valueOf(-1), IAE} );\n         result.add(new Object[] { TestType.IPv6, \"[00000:0:0:0:0:0:127.0.0.1]\", Integer.valueOf(-1), IAE} );\n+        result.add(new Object[] { TestType.IPv6, \"[::1]'\", Integer.valueOf(-1), IAE} );\n+        result.add(new Object[] { TestType.IPv6, \"[:2222:3333:4444:5555:6666:7777:8888]\",\n+                Integer.valueOf(-1), IAE} );\n+        result.add(new Object[] { TestType.IPv6, \"[1111:::3333:4444:5555:6666:7777:8888]\",\n+                Integer.valueOf(-1), IAE} );\n+        result.add(new Object[] { TestType.IPv6, \"::1]\", Integer.valueOf(-1), IAE} );\n+        result.add(new Object[] { TestType.IPv6, \"[1111:2222:3333:4444:5555:6666:7777:8888:9999]\",\n+                Integer.valueOf(-1), IAE} );\n+        result.add(new Object[] { TestType.IPv6, \"[1111:2222:3333:4444:5555:6666:7777:1.2.3.4]\",\n+            Integer.valueOf(-1), IAE} );\n+        result.add(new Object[] { TestType.IPv6, \"[1111:2222:3333]\",\n+            Integer.valueOf(-1), IAE} );\n         return result;\n     }\n \n@@ -165,6 +179,7 @@ public void testHost() {\n         if (expectedException == null) {\n             Assert.assertNull(input, exceptionClass);\n         } else {\n+            Assert.assertNotNull(exceptionClass);\n             Assert.assertTrue(input, expectedException.isAssignableFrom(exceptionClass));\n         }\n     }",
                "additions": 15,
                "raw_url": "https://github.com/apache/tomcat80/raw/03beb42e1d3990c738aae51b740a94a039ca764d/test/org/apache/tomcat/util/http/parser/TestHttpParserHost.java",
                "status": "modified",
                "changes": 15,
                "deletions": 0,
                "sha": "a6f98ba54d53ac329258e403b3875985918e0a6e",
                "blob_url": "https://github.com/apache/tomcat80/blob/03beb42e1d3990c738aae51b740a94a039ca764d/test/org/apache/tomcat/util/http/parser/TestHttpParserHost.java",
                "filename": "test/org/apache/tomcat/util/http/parser/TestHttpParserHost.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/tomcat/util/http/parser/TestHttpParserHost.java?ref=03beb42e1d3990c738aae51b740a94a039ca764d"
            },
            {
                "patch": "@@ -64,7 +64,7 @@\n         when the Valve is configured on a Host or an Engine. (fschumacher)\n       </fix>\n     </changelog>\n-  </subsection>  \n+  </subsection>\n   <subsection name=\"Jasper\">\n     <changelog>\n       <fix>",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/03beb42e1d3990c738aae51b740a94a039ca764d/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "40f60d37f6a6de67f261fcf522d03c39d204dc48",
                "blob_url": "https://github.com/apache/tomcat80/blob/03beb42e1d3990c738aae51b740a94a039ca764d/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=03beb42e1d3990c738aae51b740a94a039ca764d"
            }
        ],
        "bug_id": "tomcat80_19",
        "parent": "https://github.com/apache/tomcat80/commit/c7f74e6c3fc3b1fc197f680262b6fd9ad1a0438b",
        "message": "Correct various edge cases in the new HTTP Host header validation parser.\nPatch provided by Katya Todorova.\n\nFix IPv6/IPv4 parsing for host header:\n    - chars other than : should not be allowed in IPv6 address after ]\n    - ::: should not present in IPv6 address\n    - IPv4 part of IPv6 address was not correctly parsed (1 symbol of IPv4 part was ignored)\n    - tests added to cover IPv4/6 parsing \n    - parsed test class fixed not to throw NPE when an exception is expected but not thrown \n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1830251 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/98b9ead22e60f9b3b7f0412f0f6c318798639e99",
        "file": [
            {
                "patch": "@@ -113,7 +113,12 @@ public Principal authenticate(String username, String credentials) {\n \n         GenericPrincipal principal = principals.get(username);\n \n-        boolean validated = compareCredentials(credentials, principal.getPassword());\n+        boolean validated;\n+        if (principal == null) {\n+            validated = false;\n+        } else {\n+            validated = compareCredentials(credentials, principal.getPassword());\n+        }\n \n         if (validated) {\n             if (log.isDebugEnabled())",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/98b9ead22e60f9b3b7f0412f0f6c318798639e99/java/org/apache/catalina/realm/MemoryRealm.java",
                "status": "modified",
                "changes": 7,
                "deletions": 1,
                "sha": "52aad26752aebdbe7cfa91c5ae100fef9203433d",
                "blob_url": "https://github.com/apache/tomcat80/blob/98b9ead22e60f9b3b7f0412f0f6c318798639e99/java/org/apache/catalina/realm/MemoryRealm.java",
                "filename": "java/org/apache/catalina/realm/MemoryRealm.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/realm/MemoryRealm.java?ref=98b9ead22e60f9b3b7f0412f0f6c318798639e99"
            },
            {
                "patch": "@@ -0,0 +1,37 @@\n+/*\n+* Licensed to the Apache Software Foundation (ASF) under one or more\n+* contributor license agreements.  See the NOTICE file distributed with\n+* this work for additional information regarding copyright ownership.\n+* The ASF licenses this file to You under the Apache License, Version 2.0\n+* (the \"License\"); you may not use this file except in compliance with\n+* the License.  You may obtain a copy of the License at\n+*\n+*     http://www.apache.org/licenses/LICENSE-2.0\n+*\n+* Unless required by applicable law or agreed to in writing, software\n+* distributed under the License is distributed on an \"AS IS\" BASIS,\n+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+* See the License for the specific language governing permissions and\n+* limitations under the License.\n+*/\n+package org.apache.catalina.realm;\n+\n+import java.security.Principal;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+public class TestMemoryRealm {\n+\n+    /**\n+     * Unknown user triggers NPE.\n+     */\n+    @Test\n+    public void testBug56246() {\n+        MemoryRealm memoryRealm = new MemoryRealm();\n+\n+        Principal p = memoryRealm.authenticate(\"foo\", \"bar\");\n+\n+        Assert.assertNull(p);\n+    }\n+}",
                "additions": 37,
                "raw_url": "https://github.com/apache/tomcat80/raw/98b9ead22e60f9b3b7f0412f0f6c318798639e99/test/org/apache/catalina/realm/TestMemoryRealm.java",
                "status": "added",
                "changes": 37,
                "deletions": 0,
                "sha": "27c1af172be84688fe0fdc9028623cefb3626dee",
                "blob_url": "https://github.com/apache/tomcat80/blob/98b9ead22e60f9b3b7f0412f0f6c318798639e99/test/org/apache/catalina/realm/TestMemoryRealm.java",
                "filename": "test/org/apache/catalina/realm/TestMemoryRealm.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/realm/TestMemoryRealm.java?ref=98b9ead22e60f9b3b7f0412f0f6c318798639e99"
            },
            {
                "patch": "@@ -108,6 +108,10 @@\n         Add methods of get the idle time from last client access time to\n         <code>org.apache.catalina.Session</code>. (kfujino)\n       </add>\n+      <fix>\n+        <bug>56246</bug>: Fix NullPointerException in MemoryRealm when\n+        authenticating an unknown user. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/98b9ead22e60f9b3b7f0412f0f6c318798639e99/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "22a882d50443f0e2c73afd58593fac90bc87315e",
                "blob_url": "https://github.com/apache/tomcat80/blob/98b9ead22e60f9b3b7f0412f0f6c318798639e99/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=98b9ead22e60f9b3b7f0412f0f6c318798639e99"
            }
        ],
        "bug_id": "tomcat80_20",
        "parent": "https://github.com/apache/tomcat80/commit/d56fe405c6546e3972dfb074469738f6448a98b2",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56246\nFix NullPointerException in MemoryRealm when authenticating an unknown user.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1576768 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/6cc8e2e4306ad86c7ec71c581f3eb11ff067de59",
        "file": [
            {
                "patch": "@@ -117,6 +117,9 @@ public StandardRoot(Context context) {\n         if (validate) {\n             path = validate(path);\n         }\n+        if (path == null) {\n+            return new String[] {};\n+        }\n \n         // Set because we don't want duplicates\n         // LinkedHashSet to retain the order. It is the order of the\n@@ -140,6 +143,9 @@ public StandardRoot(Context context) {\n     @Override\n     public Set<String> listWebAppPaths(String path) {\n         path = validate(path);\n+        if (path == null) {\n+            return null;\n+        }\n \n         // Set because we don't want duplicates\n         HashSet<String> result = new HashSet<>();\n@@ -159,6 +165,9 @@ public StandardRoot(Context context) {\n     @Override\n     public boolean mkdir(String path) {\n         path = validate(path);\n+        if (path == null) {\n+            return false;\n+        }\n \n         if (preResourceExists(path)) {\n             return false;\n@@ -170,6 +179,9 @@ public boolean mkdir(String path) {\n     @Override\n     public boolean write(String path, InputStream is, boolean overwrite) {\n         path = validate(path);\n+        if (path == null) {\n+            return false;\n+        }\n \n         if (!overwrite && preResourceExists(path)) {\n             return false;\n@@ -198,6 +210,9 @@ private WebResource getResource(String path, boolean validate,\n         if (validate) {\n             path = validate(path);\n         }\n+        if (path == null) {\n+            return null;\n+        }\n \n         if (isCachingAllowed()) {\n             return cache.getResource(path, useClassLoaderResources);\n@@ -280,6 +295,9 @@ protected final WebResource getResourceInternal(String path,\n     private WebResource[] getResources(String path,\n             boolean useClassLoaderResources) {\n         path = validate(path);\n+        if (path == null) {\n+            return new WebResource[] {};\n+        }\n \n         ArrayList<WebResource> result = new ArrayList<>();\n         for (ArrayList<WebResourceSet> list : allResources) {\n@@ -309,6 +327,9 @@ protected final WebResource getResourceInternal(String path,\n         if (validate) {\n             path = validate(path);\n         }\n+        if (path == null) {\n+            return new WebResource[] {};\n+        }\n \n         String[] resources = list(path, false);\n         WebResource[] result = new WebResource[resources.length];",
                "additions": 21,
                "raw_url": "https://github.com/apache/tomcat80/raw/6cc8e2e4306ad86c7ec71c581f3eb11ff067de59/java/org/apache/catalina/webresources/StandardRoot.java",
                "status": "modified",
                "changes": 21,
                "deletions": 0,
                "sha": "16aa5ede9275616a65dac2bc49eaca6b7d0c8c0b",
                "blob_url": "https://github.com/apache/tomcat80/blob/6cc8e2e4306ad86c7ec71c581f3eb11ff067de59/java/org/apache/catalina/webresources/StandardRoot.java",
                "filename": "java/org/apache/catalina/webresources/StandardRoot.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/webresources/StandardRoot.java?ref=6cc8e2e4306ad86c7ec71c581f3eb11ff067de59"
            },
            {
                "patch": "@@ -74,6 +74,10 @@\n         elements and attributes supported by the Servlet version of the merged\n         file. (markt)\n       </fix>\n+      <fix>\n+        Avoid internal <code>NullPointerException</code>s if a resource is\n+        requested from outside the web application root. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/6cc8e2e4306ad86c7ec71c581f3eb11ff067de59/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "bbb5d0efff926a06afebb2083c21e72333c15039",
                "blob_url": "https://github.com/apache/tomcat80/blob/6cc8e2e4306ad86c7ec71c581f3eb11ff067de59/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=6cc8e2e4306ad86c7ec71c581f3eb11ff067de59"
            }
        ],
        "bug_id": "tomcat80_21",
        "parent": "https://github.com/apache/tomcat80/commit/70068f19489d674d04ef09b971ce29b7bdbb4f77",
        "message": "Avoid internal NullPointerExceptions if a resource is requested from outside the web application root.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1573321 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/8027c55543233a44f9e13f270fde2284cee539f6",
        "file": [
            {
                "patch": "@@ -397,6 +397,9 @@ public void scanWebInfClasses() throws IOException {\n             // IDEs.\n \n             Set<String> paths = context.getResourcePaths(WEB_INF + \"classes/META-INF\");\n+            if (paths == null) {\n+                return;\n+            }\n \n             for (String path : paths) {\n                 if (path.endsWith(TLD_EXT)) {",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/8027c55543233a44f9e13f270fde2284cee539f6/java/org/apache/jasper/servlet/TldScanner.java",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "d95f676c2a640e0e09b493aaefbc4197ffca12f1",
                "blob_url": "https://github.com/apache/tomcat80/blob/8027c55543233a44f9e13f270fde2284cee539f6/java/org/apache/jasper/servlet/TldScanner.java",
                "filename": "java/org/apache/jasper/servlet/TldScanner.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/servlet/TldScanner.java?ref=8027c55543233a44f9e13f270fde2284cee539f6"
            },
            {
                "patch": "@@ -74,6 +74,14 @@\n       </fix>\n     </changelog>\n   </subsection>\n+  <subsection name=\"Jasper\">\n+    <changelog>\n+      <fix>\n+        <bug>59567</bug>: Fix NPE scanning webapps for TLDs when an exploded\n+        JAR has an empty WEB-INF/classes/META-INF folder. (remm)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection name=\"Other\">\n     <changelog>\n       <update>",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/8027c55543233a44f9e13f270fde2284cee539f6/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 8,
                "deletions": 0,
                "sha": "54f6c6640de4d25472dd274ed1eb2e640affe6cf",
                "blob_url": "https://github.com/apache/tomcat80/blob/8027c55543233a44f9e13f270fde2284cee539f6/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=8027c55543233a44f9e13f270fde2284cee539f6"
            }
        ],
        "bug_id": "tomcat80_22",
        "parent": "https://github.com/apache/tomcat80/commit/48b2d8ad6cb938f445d2dd009c8bbeb27d470713",
        "message": "59567: Fix a rare NPE scanning for TLDs\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1744434 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/a95730b2e3482971545598f2565b0ddebf205ac1",
        "file": [
            {
                "patch": "@@ -1169,6 +1169,7 @@ public void run() {\n \n     @Test\n     public void testErrorHandling() throws Exception {\n+        resetTracker();\n         // Setup Tomcat instance\n         Tomcat tomcat = getTomcatInstance();\n ",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/a95730b2e3482971545598f2565b0ddebf205ac1/test/org/apache/catalina/core/TestAsyncContextImpl.java",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "e08bd30d57eb03040b63eba51426a7cc5d8ccba0",
                "blob_url": "https://github.com/apache/tomcat80/blob/a95730b2e3482971545598f2565b0ddebf205ac1/test/org/apache/catalina/core/TestAsyncContextImpl.java",
                "filename": "test/org/apache/catalina/core/TestAsyncContextImpl.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/core/TestAsyncContextImpl.java?ref=a95730b2e3482971545598f2565b0ddebf205ac1"
            }
        ],
        "bug_id": "tomcat80_23",
        "parent": "https://github.com/apache/tomcat80/commit/cf777bb2214d00a644217b419b18bf4cdf156a01",
        "message": "Avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1738163 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/9e3f7f1c1950a29ffeafb852424fd92520bd1743",
        "file": [
            {
                "patch": "@@ -327,7 +327,8 @@ private void configure() {\n             try {\n                 setFormatter((Formatter) cl.loadClass(formatterName).newInstance());\n             } catch (Exception e) {\n-                // Ignore\n+                // Ignore and fallback to defaults\n+                setFormatter(new SimpleFormatter());\n             }\n         } else {\n             setFormatter(new SimpleFormatter());",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/9e3f7f1c1950a29ffeafb852424fd92520bd1743/java/org/apache/juli/FileHandler.java",
                "status": "modified",
                "changes": 3,
                "deletions": 1,
                "sha": "500a245c32033c254f0d7947603c117f100e28e9",
                "blob_url": "https://github.com/apache/tomcat80/blob/9e3f7f1c1950a29ffeafb852424fd92520bd1743/java/org/apache/juli/FileHandler.java",
                "filename": "java/org/apache/juli/FileHandler.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/juli/FileHandler.java?ref=9e3f7f1c1950a29ffeafb852424fd92520bd1743"
            },
            {
                "patch": "@@ -112,6 +112,10 @@\n         multiple occurrences of elements that are only allowed to appear once in\n         web.xml and web-fragment.xml. (kfujino)\n       </fix>\n+      <add>\n+        <bug>51403</bug>: Avoid NPE in JULI FileHandler if formatter is\n+        misconfigured. (kkolinko)\n+      </add>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/9e3f7f1c1950a29ffeafb852424fd92520bd1743/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "94d25953a10eb5f3c4eaafc750fbd34c83d7f3f0",
                "blob_url": "https://github.com/apache/tomcat80/blob/9e3f7f1c1950a29ffeafb852424fd92520bd1743/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=9e3f7f1c1950a29ffeafb852424fd92520bd1743"
            }
        ],
        "bug_id": "tomcat80_24",
        "parent": "https://github.com/apache/tomcat80/commit/32b8c82aaf159c4b75142ef2f4e966d699d79209",
        "message": "Avoid NullPointerException in JULI FileHandler if formatter is misconfigured\nFixes https://issues.apache.org/bugzilla/show_bug.cgi?id=51403\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1137996 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/0e093a106531b58c152f0ac458176b163f2a5f9a",
        "file": [
            {
                "patch": "@@ -551,7 +551,8 @@ protected void sendInvalidSessions(ClusterManager manager, CatalinaCluster clust\n      * @return True if no session change\n      */\n     protected boolean isRequestWithoutSessionChange(String uri) {\n-        return filter.matcher(uri).matches();\n+        Pattern f = filter;\n+        return f != null && f.matcher(uri).matches();\n     }\n \n     /**",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/0e093a106531b58c152f0ac458176b163f2a5f9a/java/org/apache/catalina/ha/tcp/ReplicationValve.java",
                "status": "modified",
                "changes": 3,
                "deletions": 1,
                "sha": "e2fca4d94457b05f37ed247dba1270947d47c2c3",
                "blob_url": "https://github.com/apache/tomcat80/blob/0e093a106531b58c152f0ac458176b163f2a5f9a/java/org/apache/catalina/ha/tcp/ReplicationValve.java",
                "filename": "java/org/apache/catalina/ha/tcp/ReplicationValve.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/ha/tcp/ReplicationValve.java?ref=0e093a106531b58c152f0ac458176b163f2a5f9a"
            },
            {
                "patch": "@@ -80,6 +80,9 @@\n   </subsection>\n   <subsection name=\"Cluster\">\n     <changelog>\n+      <fix>\n+        <bug>50591</bug>: Fix NPE in ReplicationValve. (kkolinko)\n+      </fix>\n       <add>\n         Internationalise the log messages for the FarmWarDeployer. (markt)\n       </add>",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/0e093a106531b58c152f0ac458176b163f2a5f9a/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "7075092cc0a790f73a7eeae1f1f257191249654a",
                "blob_url": "https://github.com/apache/tomcat80/blob/0e093a106531b58c152f0ac458176b163f2a5f9a/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=0e093a106531b58c152f0ac458176b163f2a5f9a"
            }
        ],
        "bug_id": "tomcat80_25",
        "parent": "https://github.com/apache/tomcat80/commit/cf4e34988b9606d01c18067ba80b5a85333f7004",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50591\nDo not throw NullPointerException when ReplicationValve#filter is not set.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1059379 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/115867dae0dd5aaaa701522b25298f950d217261",
        "file": [
            {
                "patch": "@@ -846,7 +846,7 @@ protected void deployWAR(String contextPath, File war, String file) {\n                 if (entry != null) {\n                     xmlInWar = true;\n                 }\n-                if (copyXML) {\n+                if (copyXML && xmlInWar) {\n                     istream = jar.getInputStream(entry);\n                     \n                     ostream =",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/115867dae0dd5aaaa701522b25298f950d217261/java/org/apache/catalina/startup/HostConfig.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "f6b6582d4d2373e503a094abf34bdb3e8ba4d467",
                "blob_url": "https://github.com/apache/tomcat80/blob/115867dae0dd5aaaa701522b25298f950d217261/java/org/apache/catalina/startup/HostConfig.java",
                "filename": "java/org/apache/catalina/startup/HostConfig.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/startup/HostConfig.java?ref=115867dae0dd5aaaa701522b25298f950d217261"
            },
            {
                "patch": "@@ -29,6 +29,7 @@\n     <author email=\"rjung@apache.org\">Rainer Jung</author>\n     <author email=\"kkolinko@apache.org\">Konstantin Kolinko</author>\n     <author email=\"pero@apache.org\">Peter Rossbach</author>\n+    <author email=\"kfujino@apache.org\">Keiichi Fujino</author>    \n     <title>Changelog</title>\n   </properties>\n \n@@ -140,6 +141,10 @@\n         Random to generate nonces. Also make the implementation class used user\n         configurable. (markt)\n       </fix>\n+      <fix>\n+        Avoid NullPointerException, when copyXML=true and META-INF/context.xml \n+        does not exist. (kfujino)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Jasper\">",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/115867dae0dd5aaaa701522b25298f950d217261/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "902f392bb3bd0a52d1b4507642bf4eb45ff98d0e",
                "blob_url": "https://github.com/apache/tomcat80/blob/115867dae0dd5aaaa701522b25298f950d217261/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=115867dae0dd5aaaa701522b25298f950d217261"
            }
        ],
        "bug_id": "tomcat80_26",
        "parent": "https://github.com/apache/tomcat80/commit/637dabb93c102297c8f6b4133f030d10efa58e69",
        "message": "Avoid NullPointerException, when copyXML=true and META-INF/context.xml does not exist.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@963599 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/860374d697f00ccf2e1234aabccc7ae0085f4149",
        "file": [
            {
                "patch": "@@ -808,6 +808,23 @@ public Principal authenticate(String username, String credentials) {\n                 // Authenticate the specified username if possible\n                 principal = authenticate(context, username, credentials);\n \n+            } catch (NullPointerException e) {\n+                /* BZ 42449 - Kludge Sun's LDAP provider\n+                   with broken SSL\n+                */\n+                // log the exception so we know it's there.\n+                containerLog.warn(sm.getString(\"jndiRealm.exception\"), e);\n+\n+                // close the connection so we know it will be reopened.\n+                if (context != null)\n+                    close(context);\n+\n+                // open a new directory context.\n+                context = open();\n+\n+                // Try the authentication again.\n+                principal = authenticate(context, username, credentials);\n+\n             } catch (CommunicationException e) {\n \n                 // log the exception so we know it's there.",
                "additions": 17,
                "raw_url": "https://github.com/apache/tomcat80/raw/860374d697f00ccf2e1234aabccc7ae0085f4149/java/org/apache/catalina/realm/JNDIRealm.java",
                "status": "modified",
                "changes": 17,
                "deletions": 0,
                "sha": "6b99df5da97ce176d0d7be1aecf614532afa5d9c",
                "blob_url": "https://github.com/apache/tomcat80/blob/860374d697f00ccf2e1234aabccc7ae0085f4149/java/org/apache/catalina/realm/JNDIRealm.java",
                "filename": "java/org/apache/catalina/realm/JNDIRealm.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/realm/JNDIRealm.java?ref=860374d697f00ccf2e1234aabccc7ae0085f4149"
            },
            {
                "patch": "@@ -18,7 +18,12 @@\n   <subsection name=\"Catalina\">\n     <changelog>\n       <fix>\n-         <bug>42444</bug>: prevent NPE \n+         <bug>42449</bug>:\n+         JNDIRealm does not catch NullPointerException for Sun's\n+         LDAP provider (See bug for details) (funkman)\n+      </fix>\n+      <fix>\n+         <bug>42444</bug>: prevent NPE for AccessLogValve\n          Patch provided by Nils Hammar (funkman)\n       </fix>\n       <fix>",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/860374d697f00ccf2e1234aabccc7ae0085f4149/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 7,
                "deletions": 1,
                "sha": "c45001169d518da437159821b4583ec3daf6fd5a",
                "blob_url": "https://github.com/apache/tomcat80/blob/860374d697f00ccf2e1234aabccc7ae0085f4149/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=860374d697f00ccf2e1234aabccc7ae0085f4149"
            }
        ],
        "bug_id": "tomcat80_27",
        "parent": "https://github.com/apache/tomcat80/commit/a43d6c4e7a0b988e9c2f065d8eab5511dd4bee09",
        "message": "JNDIRealm does not catch NullPointerException for Sun's LDAP provider\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@539907 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/f40e4e2dc135fdc90d122b8c60cfddce5861048d",
        "file": [
            {
                "patch": "@@ -1753,8 +1753,17 @@ protected boolean exclude(String name, Object value) {\n         if (Constants.excludedAttributeNames.contains(name)) {\n             return true;\n         }\n+\n+        // Manager is required for remaining check\n+        Manager manager = getManager();\n+        if (manager == null) {\n+            // Manager may be null during replication of new sessions in a\n+            // cluster. Avoid the NPE.\n+            return false;\n+        }\n+\n         // Last check so use a short-cut\n-        return !getManager().willAttributeDistribute(name, value);\n+        return !manager.willAttributeDistribute(name, value);\n     }\n \n ",
                "additions": 10,
                "raw_url": "https://github.com/apache/tomcat80/raw/f40e4e2dc135fdc90d122b8c60cfddce5861048d/java/org/apache/catalina/session/StandardSession.java",
                "status": "modified",
                "changes": 11,
                "deletions": 1,
                "sha": "b8ba4ca08408492c013891ad3854c3bcc82d8f3c",
                "blob_url": "https://github.com/apache/tomcat80/blob/f40e4e2dc135fdc90d122b8c60cfddce5861048d/java/org/apache/catalina/session/StandardSession.java",
                "filename": "java/org/apache/catalina/session/StandardSession.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/session/StandardSession.java?ref=f40e4e2dc135fdc90d122b8c60cfddce5861048d"
            }
        ],
        "bug_id": "tomcat80_28",
        "parent": "https://github.com/apache/tomcat80/commit/0c65dfcf206332ea684b4378aac6a81ba2a7e956",
        "message": "Avoid NPE when clustering\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1727671 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/c2bd6e13f776c37680851bc9863e9ee291e79910",
        "file": [
            {
                "patch": "@@ -82,6 +82,7 @@ protected void doWrite(SendHandler handler, ByteBuffer... buffers) {\n \n \n     public void onWritePossible(boolean useDispatch) {\n+        ByteBuffer[] buffers = this.buffers;\n         if (buffers == null) {\n             // Servlet 3.1 will call the write listener once even if nothing\n             // was written",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/c2bd6e13f776c37680851bc9863e9ee291e79910/java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "fc1fb7ffb98411f695c17cb728ad2631e22d8f53",
                "blob_url": "https://github.com/apache/tomcat80/blob/c2bd6e13f776c37680851bc9863e9ee291e79910/java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java",
                "filename": "java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java?ref=c2bd6e13f776c37680851bc9863e9ee291e79910"
            }
        ],
        "bug_id": "tomcat80_29",
        "parent": "https://github.com/apache/tomcat80/commit/fd7e6ee3167b4fb43f2ef81edbb9af3841a00425",
        "message": "Avoid NPE causing failure in TestClose\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1719745 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/fd7e6ee3167b4fb43f2ef81edbb9af3841a00425",
        "file": [
            {
                "patch": "@@ -539,7 +539,7 @@ private void handleSendFailure(Throwable t) throws IOException {\n \n     private void handleSendFailureWithEncode(Throwable t) throws IOException, EncodeException {\n         // First, unwrap any execution exception\n-        if (t instanceof ExecutionException) {\n+        if (t instanceof ExecutionException && t.getCause() != null) {\n             t = t.getCause();\n         }\n ",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/fd7e6ee3167b4fb43f2ef81edbb9af3841a00425/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "0154a39902c636de497dd1464bbc1f69acabeb01",
                "blob_url": "https://github.com/apache/tomcat80/blob/fd7e6ee3167b4fb43f2ef81edbb9af3841a00425/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "filename": "java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java?ref=fd7e6ee3167b4fb43f2ef81edbb9af3841a00425"
            }
        ],
        "bug_id": "tomcat80_30",
        "parent": "https://github.com/apache/tomcat80/commit/a4cd00836933aca17e9cf708af0e46c834089050",
        "message": "Avoid NPE causing failure in TestWsSubprotocols\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1719744 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/d84b5f632efed698dd7911091d96c7129293cf55",
        "file": [
            {
                "patch": "@@ -337,9 +337,9 @@ public void breakdown() {\n         if (this.rpcChannel != null) {\n             this.rpcChannel.breakdown();\n         }\n-        try {broadcast(MapMessage.MSG_STOP,false); }catch ( Exception ignore){}\n-        //cleanup\n         if (this.channel != null) {\n+            try {broadcast(MapMessage.MSG_STOP,false); }catch ( Exception ignore){}\n+            //cleanup\n             this.channel.removeChannelListener(this);\n             this.channel.removeMembershipListener(this);\n         }",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/d84b5f632efed698dd7911091d96c7129293cf55/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "status": "modified",
                "changes": 4,
                "deletions": 2,
                "sha": "3e47cc49cdb648069220a43577a41304249b1840",
                "blob_url": "https://github.com/apache/tomcat80/blob/d84b5f632efed698dd7911091d96c7129293cf55/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "filename": "java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java?ref=d84b5f632efed698dd7911091d96c7129293cf55"
            },
            {
                "patch": "@@ -54,6 +54,14 @@\n       </add>\n     </changelog>\n   </subsection>\n+  <subsection name=\"Tribes\">\n+    <changelog>\n+      <fix>\n+        Fix potential NPE in <code>AbstractReplicatedMap.breakdown()</code>.\n+        (kfujino)\n+      </fix>\n+    </changelog>\n+  </subsection>\n </section>\n <section name=\"Tomcat 8.0.30 (markt)\" rtext=\"2015-12-06\">\n   <subsection name=\"Catalina\">",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/d84b5f632efed698dd7911091d96c7129293cf55/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 8,
                "deletions": 0,
                "sha": "47268b355e837c548150d18a4ba7277db6f669ad",
                "blob_url": "https://github.com/apache/tomcat80/blob/d84b5f632efed698dd7911091d96c7129293cf55/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=d84b5f632efed698dd7911091d96c7129293cf55"
            }
        ],
        "bug_id": "tomcat80_31",
        "parent": "https://github.com/apache/tomcat80/commit/e2f7cb9a6eb7e4db53c13c5629bcfe5809656463",
        "message": "Fix potential NPE in AbstractReplicatedMap.breakdown().\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1718248 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/0ec7ef6717eccc88fc14b317db8bb6930db74903",
        "file": [
            {
                "patch": "@@ -632,7 +632,7 @@ static void remove(final LinkedHashSet<Cipher> ciphers, final String alias) {\n                 add(ciphers, element);\n             } else if (element.contains(AND)) {\n                 String[] intersections = element.split(\"\\\\\" + AND);\n-                if(intersections.length > 0) {\n+                if(intersections.length > 0 && aliases.containsKey(intersections[0])) {\n                     List<Cipher> result = new ArrayList<>(aliases.get(intersections[0]));\n                     for(int i = 1; i < intersections.length; i++) {\n                         if(aliases.containsKey(intersections[i])) {",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/0ec7ef6717eccc88fc14b317db8bb6930db74903/java/org/apache/tomcat/util/net/jsse/openssl/OpenSSLCipherConfigurationParser.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "fb6b257d51b31eae8f90dba8cc230f239df5975c",
                "blob_url": "https://github.com/apache/tomcat80/blob/0ec7ef6717eccc88fc14b317db8bb6930db74903/java/org/apache/tomcat/util/net/jsse/openssl/OpenSSLCipherConfigurationParser.java",
                "filename": "java/org/apache/tomcat/util/net/jsse/openssl/OpenSSLCipherConfigurationParser.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/jsse/openssl/OpenSSLCipherConfigurationParser.java?ref=0ec7ef6717eccc88fc14b317db8bb6930db74903"
            },
            {
                "patch": "@@ -45,6 +45,15 @@\n   issues to not \"pop up\" wrt. others).\n -->\n <section name=\"Tomcat 8.0.12 (markt)\">\n+  <subsection name=\"Coyote\">\n+    <changelog>\n+      <fix>\n+        When building a list of JSSE ciphers from an OpenSSL cipher defintiion,\n+        ignore unknown criteria rather than throwing a\n+        <code>NullPointerException</code>. (markt)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection name=\"Jasper\">\n     <changelog>\n       <fix>",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/0ec7ef6717eccc88fc14b317db8bb6930db74903/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 9,
                "deletions": 0,
                "sha": "9a0893553c54c2573f9d77500c5781a230d6d3d6",
                "blob_url": "https://github.com/apache/tomcat80/blob/0ec7ef6717eccc88fc14b317db8bb6930db74903/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=0ec7ef6717eccc88fc14b317db8bb6930db74903"
            }
        ],
        "bug_id": "tomcat80_32",
        "parent": "https://github.com/apache/tomcat80/commit/d506b8acf8612e829284486841e12e4c978977ae",
        "message": "Avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1619765 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/53a74c9f107434f205750a2494a10cebb6c555be",
        "file": [
            {
                "patch": "@@ -440,6 +440,10 @@ public String getPathInfo() {\n      */\n     @Override\n     public String getPathTranslated() {\n+        if (getPathInfo() == null) {\n+            return null;\n+        }\n+\n         return getServletContext().getRealPath(getPathInfo());\n     }\n ",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/53a74c9f107434f205750a2494a10cebb6c555be/java/org/apache/catalina/core/ApplicationHttpRequest.java",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "298ba6c58d439e9f287e3f0fd096a1a71259f99f",
                "blob_url": "https://github.com/apache/tomcat80/blob/53a74c9f107434f205750a2494a10cebb6c555be/java/org/apache/catalina/core/ApplicationHttpRequest.java",
                "filename": "java/org/apache/catalina/core/ApplicationHttpRequest.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/ApplicationHttpRequest.java?ref=53a74c9f107434f205750a2494a10cebb6c555be"
            }
        ],
        "bug_id": "tomcat80_33",
        "parent": "https://github.com/apache/tomcat80/commit/8b407bf98aa2a29932babdc5e3bb3d88b1d16682",
        "message": "Add NPE protection\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1607931 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/3d888aff9703625b76c732b14dc57d7bbccb7ac1",
        "file": [
            {
                "patch": "@@ -260,7 +260,9 @@ void startMessage(byte opCode, ByteBuffer payload, boolean last,\n         messageParts.add(new MessagePart(opCode, payload, last,\n                 new EndMessageHandler(this, handler)));\n \n-        messageParts = transformation.sendMessagePart(messageParts);\n+        if (transformation != null) {\n+            messageParts = transformation.sendMessagePart(messageParts);\n+        }\n \n         MessagePart mp = messageParts.remove(0);\n ",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/3d888aff9703625b76c732b14dc57d7bbccb7ac1/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "status": "modified",
                "changes": 4,
                "deletions": 1,
                "sha": "6d05b28ebe54370a7454f3fef48425de71b51bf8",
                "blob_url": "https://github.com/apache/tomcat80/blob/3d888aff9703625b76c732b14dc57d7bbccb7ac1/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "filename": "java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java?ref=3d888aff9703625b76c732b14dc57d7bbccb7ac1"
            }
        ],
        "bug_id": "tomcat80_34",
        "parent": "https://github.com/apache/tomcat80/commit/a7909d91814ef18afa496ff9568ecdfeb5b3f801",
        "message": "Avoid NPE.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1606147 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/30e1ab1b1653df913b68151cb8dd1c387dcfe49a",
        "file": [
            {
                "patch": "@@ -18,6 +18,7 @@\n \n import java.io.File;\n import java.io.IOException;\n+import java.security.NoSuchAlgorithmException;\n import java.security.Principal;\n import java.util.Map;\n \n@@ -41,8 +42,7 @@\n  * <p>Implementation of the JAAS <strong>LoginModule</strong> interface,\n  * primarily for use in testing <code>JAASRealm</code>.  It utilizes an\n  * XML-format data file of username/password/role information identical to\n- * that supported by <code>org.apache.catalina.realm.MemoryRealm</code>\n- * (except that digested passwords are not supported).</p>\n+ * that supported by <code>org.apache.catalina.realm.MemoryRealm</code>.</p>\n  *\n  * <p>This class recognizes the following string-valued options, which are\n  * specified in the configuration file and passed to {@link\n@@ -54,6 +54,14 @@\n  *     XML file containing our user information, in the format supported by\n  *     {@link MemoryRealm}.  The default value matches the MemoryRealm\n  *     default.</li>\n+ * <li><strong>digest</strong> - Digest used to protect credentials in the XML\n+ *     file. If not specified, the passwords will be assumed to be in clear\n+ *     text.</li>\n+ * <li><strong>iterations</strong> - The number of iterations of the associated\n+ *     algorithm that will be used when creating a new stored credential for a\n+ *     given input credential.</li>\n+ * <li><strong>saltLength</strong> - The salt length that will be used when\n+ *     creating a new stored credential for a given input credential.</li>\n  * </ul>\n  *\n  * <p><strong>IMPLEMENTATION NOTE</strong> - This class implements\n@@ -223,9 +231,24 @@ public void initialize(Subject subject, CallbackHandler callbackHandler,\n         this.options = options;\n \n         // Perform instance-specific initialization\n+        MessageDigestCredentialHandler credentialHandler = new MessageDigestCredentialHandler();\n+        setCredentialHandler(credentialHandler);\n         if (options.get(\"pathname\") != null) {\n             this.pathname = (String) options.get(\"pathname\");\n         }\n+        if (options.get(\"digest\") != null) {\n+            try {\n+                credentialHandler.setAlgorithm((String) options.get(\"digest\"));\n+            } catch (NoSuchAlgorithmException e) {\n+                log.warn(\"Invalid digest algorithm for JAASMemoryLoginModule\", e);\n+            }\n+        }\n+        if (options.get(\"iterations\") != null) {\n+            credentialHandler.setIterations(Integer.parseInt((String) options.get(\"iterations\")));\n+        }\n+        if (options.get(\"saltLength\") != null) {\n+            credentialHandler.setIterations(Integer.parseInt((String) options.get(\"saltLength\")));\n+        }\n \n         // Load our defined Principals\n         load();",
                "additions": 25,
                "raw_url": "https://github.com/apache/tomcat80/raw/30e1ab1b1653df913b68151cb8dd1c387dcfe49a/java/org/apache/catalina/realm/JAASMemoryLoginModule.java",
                "status": "modified",
                "changes": 27,
                "deletions": 2,
                "sha": "4b50932cafa2a7e3007f25f711933c1a7939fbd5",
                "blob_url": "https://github.com/apache/tomcat80/blob/30e1ab1b1653df913b68151cb8dd1c387dcfe49a/java/org/apache/catalina/realm/JAASMemoryLoginModule.java",
                "filename": "java/org/apache/catalina/realm/JAASMemoryLoginModule.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/realm/JAASMemoryLoginModule.java?ref=30e1ab1b1653df913b68151cb8dd1c387dcfe49a"
            },
            {
                "patch": "@@ -165,6 +165,11 @@\n         added additional (and arguably unnecessary) validation to the provided\n         redirect location. (markt)\n       </fix>\n+      <fix>\n+        <bug>59154</bug>: Fix a <code>NullPointerException</code> in the\n+        <code>JASSMemoryLoginModue</code> resulting from the introduction of the\n+        <code>CredentialHandler</code> to <code>Realm</code>s. (schultz/markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/30e1ab1b1653df913b68151cb8dd1c387dcfe49a/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "381a6cceb3ba46f797ccea8b93e02e226e1c88fc",
                "blob_url": "https://github.com/apache/tomcat80/blob/30e1ab1b1653df913b68151cb8dd1c387dcfe49a/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=30e1ab1b1653df913b68151cb8dd1c387dcfe49a"
            }
        ],
        "bug_id": "tomcat80_35",
        "parent": "https://github.com/apache/tomcat80/commit/90feda15102256869cc6a59a96c05aae377f3298",
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59154\nFix a NullPointerException in the JASSMemoryLoginModue resulting from the introduction of the CredentialHandler to Realms\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1734468 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/f03fb0a95d4097f2252df44c4ac97f7eee892f27",
        "file": [
            {
                "patch": "@@ -426,10 +426,12 @@ public boolean asyncDispatch(org.apache.coyote.Request req,\n             if (!request.isAsync() && !comet) {\n                 request.finishRequest();\n                 response.finishResponse();\n-                request.getMappingData().context.logAccess(\n-                        request, response,\n-                        System.currentTimeMillis() - req.getStartTime(),\n-                        false);\n+                if (request.getMappingData().context != null) {\n+                    request.getMappingData().context.logAccess(\n+                            request, response,\n+                            System.currentTimeMillis() - req.getStartTime(),\n+                            false);\n+                }\n             }\n \n         } catch (IOException e) {",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/f03fb0a95d4097f2252df44c4ac97f7eee892f27/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "status": "modified",
                "changes": 10,
                "deletions": 4,
                "sha": "296a7cb3b664bf8dba6b9d6725526462da6c0e48",
                "blob_url": "https://github.com/apache/tomcat80/blob/f03fb0a95d4097f2252df44c4ac97f7eee892f27/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "filename": "java/org/apache/catalina/connector/CoyoteAdapter.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/CoyoteAdapter.java?ref=f03fb0a95d4097f2252df44c4ac97f7eee892f27"
            }
        ],
        "bug_id": "tomcat80_36",
        "parent": "https://github.com/apache/tomcat80/commit/7ece13100bbdf1bacb564b0c790d9f1f63a8ffea",
        "message": "Avoid possible NPE.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1574167 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/55192da8e61ac69e1155af65f7077b97f3f7880f",
        "file": [
            {
                "patch": "@@ -464,11 +464,14 @@ public void setContentType(String type) {\n \n         this.contentType = m.toStringNoCharset();\n \n-        String charsetValue = m.getCharset().trim();\n+        String charsetValue = m.getCharset();\n \n-        if (charsetValue != null && charsetValue.length() > 0) {\n-            charsetSet = true;\n-            this.characterEncoding = charsetValue;\n+        if (charsetValue != null) {\n+            charsetValue = charsetValue.trim();\n+            if (charsetValue.length() > 0) {\n+                charsetSet = true;\n+                this.characterEncoding = charsetValue;\n+            }\n         }\n     }\n ",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/55192da8e61ac69e1155af65f7077b97f3f7880f/java/org/apache/coyote/Response.java",
                "status": "modified",
                "changes": 11,
                "deletions": 4,
                "sha": "b2eca8fe7ffa9fa5fc9d4575a156893ae8f8cc38",
                "blob_url": "https://github.com/apache/tomcat80/blob/55192da8e61ac69e1155af65f7077b97f3f7880f/java/org/apache/coyote/Response.java",
                "filename": "java/org/apache/coyote/Response.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/Response.java?ref=55192da8e61ac69e1155af65f7077b97f3f7880f"
            }
        ],
        "bug_id": "tomcat80_37",
        "parent": "https://github.com/apache/tomcat80/commit/78f1151c1ab540f309dfb61a68252c5a75e0d26a",
        "message": "Avoid possible NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1552804 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/600e0cc13cc4d212bd8c7cb087554944666a49e0",
        "file": [
            {
                "patch": "@@ -590,8 +590,12 @@ public void recycle() {\n \n         public SocketState process(SocketWrapper<S> wrapper,\n                 SocketStatus status) {\n-            S socket = wrapper.getSocket();\n+            if (wrapper == null) {\n+                // Nothing to do. Socket has been closed.\n+                return SocketState.CLOSED;\n+            }\n \n+            S socket = wrapper.getSocket();\n             if (socket == null) {\n                 // Nothing to do. Socket has been closed.\n                 return SocketState.CLOSED;",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/600e0cc13cc4d212bd8c7cb087554944666a49e0/java/org/apache/coyote/AbstractProtocol.java",
                "status": "modified",
                "changes": 6,
                "deletions": 1,
                "sha": "7bd1d95f4c3cea4439ada162e9113bd0d58314d9",
                "blob_url": "https://github.com/apache/tomcat80/blob/600e0cc13cc4d212bd8c7cb087554944666a49e0/java/org/apache/coyote/AbstractProtocol.java",
                "filename": "java/org/apache/coyote/AbstractProtocol.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/AbstractProtocol.java?ref=600e0cc13cc4d212bd8c7cb087554944666a49e0"
            }
        ],
        "bug_id": "tomcat80_38",
        "parent": "https://github.com/apache/tomcat80/commit/4a40277e858660fa79528964d39f17a8bdc5f6a7",
        "message": "Protect against NPE.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1543897 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/ead1fd0f6eedaad199f603bd9358688eb2557af6",
        "file": [
            {
                "patch": "@@ -93,6 +93,7 @@ public InputStream getInputStream(String name) throws IOException {\n \n     @Override\n     public long getLastModified(String name) throws IOException {\n+        reset();\n         JarEntry entry = jarInputStream.getNextJarEntry();\n         while (entry != null) {\n             if (name.equals(entry.getName())) {",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/ead1fd0f6eedaad199f603bd9358688eb2557af6/java/org/apache/tomcat/util/scan/JarFileUrlNestedJar.java",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "be9940fbfb93231aa916d0724d1d690639192931",
                "blob_url": "https://github.com/apache/tomcat80/blob/ead1fd0f6eedaad199f603bd9358688eb2557af6/java/org/apache/tomcat/util/scan/JarFileUrlNestedJar.java",
                "filename": "java/org/apache/tomcat/util/scan/JarFileUrlNestedJar.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/scan/JarFileUrlNestedJar.java?ref=ead1fd0f6eedaad199f603bd9358688eb2557af6"
            }
        ],
        "bug_id": "tomcat80_39",
        "parent": "https://github.com/apache/tomcat80/commit/6a27e5a57983db08bfec87d88175424cff00e726",
        "message": "Fix NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1541963 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/a3fac35988917ddf2a1cd4b71b3387aa2fd17899",
        "file": [
            {
                "patch": "@@ -446,6 +446,10 @@ else if (\"declare\".equals(tname)) {\n     private TagLibraryValidator createValidator(ValidatorXml validatorXml)\n             throws JasperException {\n \n+        if (validatorXml == null) {\n+            return null;\n+        }\n+\n         String validatorClass = validatorXml.getValidatorClass();\n \n         Map<String,Object> initParams = new Hashtable<>();",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/a3fac35988917ddf2a1cd4b71b3387aa2fd17899/java/org/apache/jasper/compiler/TagLibraryInfoImpl.java",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "b59ed76762d0573754549f0e0b4b8b800f11600e",
                "blob_url": "https://github.com/apache/tomcat80/blob/a3fac35988917ddf2a1cd4b71b3387aa2fd17899/java/org/apache/jasper/compiler/TagLibraryInfoImpl.java",
                "filename": "java/org/apache/jasper/compiler/TagLibraryInfoImpl.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/TagLibraryInfoImpl.java?ref=a3fac35988917ddf2a1cd4b71b3387aa2fd17899"
            }
        ],
        "bug_id": "tomcat80_40",
        "parent": "https://github.com/apache/tomcat80/commit/7390fc04ee826f4573acde40216b5530b05e1dda",
        "message": "Fix a NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1541958 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/a0665f4d5bff9408cfc7d32906f14a97e0a6372f",
        "file": [
            {
                "patch": "@@ -639,7 +639,7 @@ public abstract void processSocket(SocketWrapper<S> socketWrapper,\n     public void executeNonBlockingDispatches(SocketWrapper<S> socketWrapper) {\n         Iterator<DispatchType> dispatches = socketWrapper.getIteratorAndClearDispatches();\n \n-        while (dispatches.hasNext()) {\n+        while (dispatches != null && dispatches.hasNext()) {\n             DispatchType dispatchType = dispatches.next();\n             processSocket(socketWrapper, dispatchType.getSocketStatus(), false);\n         }",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/a0665f4d5bff9408cfc7d32906f14a97e0a6372f/java/org/apache/tomcat/util/net/AbstractEndpoint.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "a6f8f4f608b2d8499d76468adb632fadeefc783f",
                "blob_url": "https://github.com/apache/tomcat80/blob/a0665f4d5bff9408cfc7d32906f14a97e0a6372f/java/org/apache/tomcat/util/net/AbstractEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/AbstractEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/AbstractEndpoint.java?ref=a0665f4d5bff9408cfc7d32906f14a97e0a6372f"
            }
        ],
        "bug_id": "tomcat80_41",
        "parent": "https://github.com/apache/tomcat80/commit/7164474ab498c2d605bea804f791a94c6847bee0",
        "message": "Avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1529793 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/12353ac09eeb7db48230474653e9e148817a86a8",
        "file": [
            {
                "patch": "@@ -28,12 +28,13 @@\n \n public class QueryTimeoutInterceptor extends AbstractCreateStatementInterceptor {\n     private static Log log = LogFactory.getLog(QueryTimeoutInterceptor.class);\n-    int timeout;\n+    int timeout = 1;\n \n     @Override\n     public void setProperties(Map<String,InterceptorProperty> properties) {\n         super.setProperties(properties);\n-        timeout = properties.get(\"queryTimeout\").getValueAsInt(-1);\n+        InterceptorProperty p = properties.get(\"queryTimeout\");\n+        if (p!=null) timeout = p.getValueAsInt(timeout);\n     }\n \n     @Override",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/12353ac09eeb7db48230474653e9e148817a86a8/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/QueryTimeoutInterceptor.java",
                "status": "modified",
                "changes": 5,
                "deletions": 2,
                "sha": "3d35cb6eb384218a86fdc7d5567d1e9c7bd1dd2d",
                "blob_url": "https://github.com/apache/tomcat80/blob/12353ac09eeb7db48230474653e9e148817a86a8/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/QueryTimeoutInterceptor.java",
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/QueryTimeoutInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/QueryTimeoutInterceptor.java?ref=12353ac09eeb7db48230474653e9e148817a86a8"
            },
            {
                "patch": "@@ -121,6 +121,9 @@\n         of <code>SlowQueryReport</code> is changed to <code>false</code> so that\n         the failed queries are not logged by default. (kfujino)\n       </fix>\n+      <fix>\n+        Fix potential NPE in <code>QueryTimeoutInterceptor</code>. (kfujino)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Other\">",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/12353ac09eeb7db48230474653e9e148817a86a8/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "0cd49923e78add0138af9ee85c72944d380f6cac",
                "blob_url": "https://github.com/apache/tomcat80/blob/12353ac09eeb7db48230474653e9e148817a86a8/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=12353ac09eeb7db48230474653e9e148817a86a8"
            }
        ],
        "bug_id": "tomcat80_42",
        "parent": "https://github.com/apache/tomcat80/commit/3a5c868535418ef954656366610df2d69d630d7b",
        "message": "Fix potential NPE in QueryTimeoutInterceptor.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1692056 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/78d7976e2c456b312a9aff971721d47c66ca480f",
        "file": [
            {
                "patch": "@@ -859,8 +859,9 @@ public void doFilter(HttpServletRequest request, HttpServletResponse response, F\n             }\n \n             HttpServletResponse xResponse;\n-            if (!xRequest.getScheme().equals(request.getScheme()) ||\n-                    xRequest.getServerPort() != request.getServerPort()) {\n+            if (xRequest.getScheme() != null &&\n+                    (!xRequest.getScheme().equals(request.getScheme()) ||\n+                    xRequest.getServerPort() != request.getServerPort())) {\n                 xResponse = new XForwardedResponse(response, xRequest.getScheme(), xRequest.getServerPort());\n             } else {\n                 xResponse = response;",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/78d7976e2c456b312a9aff971721d47c66ca480f/java/org/apache/catalina/filters/RemoteIpFilter.java",
                "status": "modified",
                "changes": 5,
                "deletions": 2,
                "sha": "6dc2b31f39cd512dd3fa6ff112010aae705ea019",
                "blob_url": "https://github.com/apache/tomcat80/blob/78d7976e2c456b312a9aff971721d47c66ca480f/java/org/apache/catalina/filters/RemoteIpFilter.java",
                "filename": "java/org/apache/catalina/filters/RemoteIpFilter.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/filters/RemoteIpFilter.java?ref=78d7976e2c456b312a9aff971721d47c66ca480f"
            }
        ],
        "bug_id": "tomcat80_43",
        "parent": "https://github.com/apache/tomcat80/commit/d1512649e7996f403be825f949039dd855e455d6",
        "message": "Fix NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1687433 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/5e0742639558185a2a0a63b8ad5d7d75ec6055e0",
        "file": [
            {
                "patch": "@@ -102,9 +102,11 @@ protected String reportFailedQuery(String query, Object[] args, String name, lon\n             long now = System.currentTimeMillis();\n             long delta = now - start;\n             QueryStats qs = this.getQueryStats(sql);\n-            qs.failure(delta, now);\n-            if (isLogFailed() && log.isWarnEnabled()) {\n-                log.warn(\"Failed Query Report SQL=\"+sql+\"; time=\"+delta+\" ms;\");\n+            if (qs != null) {\n+                qs.failure(delta, now);\n+                if (isLogFailed() && log.isWarnEnabled()) {\n+                    log.warn(\"Failed Query Report SQL=\"+sql+\"; time=\"+delta+\" ms;\");\n+                }\n             }\n         }\n         return sql;\n@@ -115,7 +117,7 @@ protected String reportQuery(String query, Object[] args, final String name, lon\n         String sql = super.reportQuery(query, args, name, start, delta);\n         if (this.maxQueries > 0 ) {\n             QueryStats qs = this.getQueryStats(sql);\n-            qs.add(delta, start);\n+            if (qs != null) qs.add(delta, start);\n         }\n         return sql;\n     }\n@@ -125,9 +127,11 @@ protected String reportSlowQuery(String query, Object[] args, String name, long\n         String sql = super.reportSlowQuery(query, args, name, start, delta);\n         if (this.maxQueries > 0 ) {\n             QueryStats qs = this.getQueryStats(sql);\n-            qs.add(delta, start);\n-            if (isLogSlow() && log.isWarnEnabled()) {\n-                log.warn(\"Slow Query Report SQL=\"+sql+\"; time=\"+delta+\" ms;\");\n+            if (qs != null) {\n+                qs.add(delta, start);\n+                if (isLogSlow() && log.isWarnEnabled()) {\n+                    log.warn(\"Slow Query Report SQL=\"+sql+\"; time=\"+delta+\" ms;\");\n+                }\n             }\n         }\n         return sql;\n@@ -145,13 +149,13 @@ public void closeInvoked() {\n     @Override\n     public void prepareStatement(String sql, long time) {\n         QueryStats qs = getQueryStats(sql);\n-        qs.prepare(time);\n+        if (qs != null) qs.prepare(time);\n     }\n \n     @Override\n     public void prepareCall(String sql, long time) {\n         QueryStats qs = getQueryStats(sql);\n-        qs.prepare(time);\n+        if (qs != null) qs.prepare(time);\n     }\n \n     /**\n@@ -186,7 +190,10 @@ public void poolClosed(ConnectionPool pool) {\n     protected QueryStats getQueryStats(String sql) {\n         if (sql==null) sql = \"\";\n         ConcurrentHashMap<String,QueryStats> queries = SlowQueryReport.this.queries;\n-        if (queries==null) return null;\n+        if (queries==null) {\n+            if (log.isWarnEnabled()) log.warn(\"Connection has already been closed or abandoned\");\n+            return null;\n+        }\n         QueryStats qs = queries.get(sql);\n         if (qs == null) {\n             qs = new QueryStats(sql);",
                "additions": 17,
                "raw_url": "https://github.com/apache/tomcat80/raw/5e0742639558185a2a0a63b8ad5d7d75ec6055e0/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java",
                "status": "modified",
                "changes": 27,
                "deletions": 10,
                "sha": "7f7a4021f1c3646d78e49f2fe923b7004f14b4ba",
                "blob_url": "https://github.com/apache/tomcat80/blob/5e0742639558185a2a0a63b8ad5d7d75ec6055e0/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java",
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java?ref=5e0742639558185a2a0a63b8ad5d7d75ec6055e0"
            }
        ],
        "bug_id": "tomcat80_44",
        "parent": "https://github.com/apache/tomcat80/commit/fe1a907ae2f8f1ce32570269a4a848ce2416d3ab",
        "message": "Avoid NPE if connection has been abandoned.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1686975 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/913cb9f866c0a4bc0079991c60c03443637cb43c",
        "file": [
            {
                "patch": "@@ -132,12 +132,15 @@ private UpgradeConnection doUpgrade(\n \n         String status = reader.readLine();\n \n+        Assert.assertNotNull(status);\n         Assert.assertEquals(\"HTTP/1.1 101 Switching Protocols\",\n                 status.substring(0, 32));\n \n         // Skip the remaining response headers\n-        while (reader.readLine().length() > 0) {\n+        String line = reader.readLine();\n+        while (line != null && line.length() > 0) {\n             // Skip\n+            line = reader.readLine();\n         }\n \n         return new UpgradeConnection(writer, reader);",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/913cb9f866c0a4bc0079991c60c03443637cb43c/test/org/apache/coyote/http11/upgrade/TestUpgrade.java",
                "status": "modified",
                "changes": 5,
                "deletions": 1,
                "sha": "f01730925feb2e1abce3670b8cc67e6fad74ad76",
                "blob_url": "https://github.com/apache/tomcat80/blob/913cb9f866c0a4bc0079991c60c03443637cb43c/test/org/apache/coyote/http11/upgrade/TestUpgrade.java",
                "filename": "test/org/apache/coyote/http11/upgrade/TestUpgrade.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/coyote/http11/upgrade/TestUpgrade.java?ref=913cb9f866c0a4bc0079991c60c03443637cb43c"
            }
        ],
        "bug_id": "tomcat80_45",
        "parent": "https://github.com/apache/tomcat80/commit/38a066bf910b9dd215b738b01ca455626f097f8e",
        "message": "FindBugs - avoid NPEs\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1434735 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/e7b1c6d13d2cd1a1578b16f1f13014b795b8d6bf",
        "file": [
            {
                "patch": "@@ -62,6 +62,7 @@ public final boolean isReady() {\n             ready = Boolean.valueOf(doIsReady());\n         } catch (IOException e) {\n             listener.onError(e);\n+            ready = Boolean.FALSE;\n         }\n         return ready.booleanValue();\n     }",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/e7b1c6d13d2cd1a1578b16f1f13014b795b8d6bf/java/org/apache/coyote/http11/upgrade/AbstractServletInputStream.java",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "a5a5db95fbc44c4f588260fdb45a1da6d79ce35f",
                "blob_url": "https://github.com/apache/tomcat80/blob/e7b1c6d13d2cd1a1578b16f1f13014b795b8d6bf/java/org/apache/coyote/http11/upgrade/AbstractServletInputStream.java",
                "filename": "java/org/apache/coyote/http11/upgrade/AbstractServletInputStream.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/http11/upgrade/AbstractServletInputStream.java?ref=e7b1c6d13d2cd1a1578b16f1f13014b795b8d6bf"
            }
        ],
        "bug_id": "tomcat80_46",
        "parent": "https://github.com/apache/tomcat80/commit/e1d9ba79c12631ef9ddbfcc46b83432e12ef762d",
        "message": "Avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1425143 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/e09418a43bac392d849472164449072dda0b1bcc",
        "file": [
            {
                "patch": "@@ -19,6 +19,7 @@\n import java.lang.annotation.Annotation;\n import java.lang.reflect.Method;\n import java.nio.ByteBuffer;\n+import java.util.Collections;\n import java.util.HashMap;\n import java.util.HashSet;\n import java.util.Map;\n@@ -155,6 +156,7 @@ public Method getOnError() {\n             }\n         }\n         if (!foundError) {\n+            // TODO i18n\n             throw new IllegalArgumentException();\n         }\n         return result;\n@@ -165,7 +167,12 @@ public Method getOnError() {\n             UriTemplate template, String pathInfo, Session session,\n             Throwable throwable) {\n         Object[] result = new Object[pathParams.length];\n-        Map<String,String> pathValues = template.match(pathInfo);\n+        Map<String,String> pathValues;\n+        if (template != null && pathInfo != null) {\n+            pathValues = template.match(pathInfo);\n+        } else {\n+            pathValues = Collections.EMPTY_MAP;\n+        }\n         for (int i = 0; i < pathParams.length; i++) {\n             Class<?> type = pathParams[i].getType();\n             if (type.equals(Session.class)) {",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/e09418a43bac392d849472164449072dda0b1bcc/java/org/apache/tomcat/websocket/PojoMethodMapping.java",
                "status": "modified",
                "changes": 9,
                "deletions": 1,
                "sha": "f9abbdf6b8ef9369d575d3cdc40a752e46b3a296",
                "blob_url": "https://github.com/apache/tomcat80/blob/e09418a43bac392d849472164449072dda0b1bcc/java/org/apache/tomcat/websocket/PojoMethodMapping.java",
                "filename": "java/org/apache/tomcat/websocket/PojoMethodMapping.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/PojoMethodMapping.java?ref=e09418a43bac392d849472164449072dda0b1bcc"
            }
        ],
        "bug_id": "tomcat80_47",
        "parent": "https://github.com/apache/tomcat80/commit/5852aebe8c7a1584ba3e0c673736e8abb300842e",
        "message": "More NPE avoidance\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1424173 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/fdd76a4f93511cae356403e8db1ce0930b008a5e",
        "file": [
            {
                "patch": "@@ -117,7 +117,7 @@ public Method getOnError() {\n             Session session) {\n         Set<MessageHandler> result = new HashSet<>();\n         for (MessageMethod messageMethod : onMessage) {\n-            result.add(messageMethod.getMessageHandler(pojo, pathInfo,session));\n+            result.add(messageMethod.getMessageHandler(pojo, pathInfo, session));\n         }\n         return result;\n     }\n@@ -331,7 +331,12 @@ public MessageHandler getMessageHandler(Object pojo, String pathInfo,\n                 Session session) {\n             Object[] params = new Object[m.getParameterTypes().length];\n \n-            Map<String,String> pathParams = template.match(pathInfo);\n+            Map<String,String> pathParams;\n+            if (template == null) {\n+                pathParams = new HashMap<>();\n+            } else {\n+                pathParams = template.match(pathInfo);\n+            }\n \n             for (Map.Entry<Integer,PathParam> entry :\n                     indexPathParams.entrySet()) {",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/fdd76a4f93511cae356403e8db1ce0930b008a5e/java/org/apache/tomcat/websocket/PojoMethodMapping.java",
                "status": "modified",
                "changes": 9,
                "deletions": 2,
                "sha": "457730034d5f9326344d8de62d8dd7237a758a63",
                "blob_url": "https://github.com/apache/tomcat80/blob/fdd76a4f93511cae356403e8db1ce0930b008a5e/java/org/apache/tomcat/websocket/PojoMethodMapping.java",
                "filename": "java/org/apache/tomcat/websocket/PojoMethodMapping.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/PojoMethodMapping.java?ref=fdd76a4f93511cae356403e8db1ce0930b008a5e"
            }
        ],
        "bug_id": "tomcat80_48",
        "parent": "https://github.com/apache/tomcat80/commit/8824131f6bb8d15445051ddc592d03699194a7a4",
        "message": "Avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1422334 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/ea199d749b69c7561b2778f8a0c66253171575dc",
        "file": [
            {
                "patch": "@@ -623,7 +623,10 @@ public void messageReceived(Serializable msg, Member sender) {\n             MapEntry<K,V> entry = innerMap.get(mapmsg.getKey());\n             if ( entry==null ) {\n                 entry = new MapEntry<>((K) mapmsg.getKey(), (V) mapmsg.getValue());\n-                entry = innerMap.putIfAbsent(entry.getKey(), entry);\n+                MapEntry<K,V> old = innerMap.putIfAbsent(entry.getKey(), entry);\n+                if (old != null) {\n+                    entry = old;\n+                }\n             }\n             entry.setProxy(true);\n             entry.setBackup(false);",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/ea199d749b69c7561b2778f8a0c66253171575dc/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "status": "modified",
                "changes": 5,
                "deletions": 1,
                "sha": "f3688efc8df14c85d285eca674f10c07d4de80e0",
                "blob_url": "https://github.com/apache/tomcat80/blob/ea199d749b69c7561b2778f8a0c66253171575dc/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "filename": "java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java?ref=ea199d749b69c7561b2778f8a0c66253171575dc"
            }
        ],
        "bug_id": "tomcat80_49",
        "parent": "https://github.com/apache/tomcat80/commit/fe8b7253941e766b958674e639f034671135fc6c",
        "message": "Avoid NPE.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1393943 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/e7fa400322af857dda52466e3c80fcc2a40a297d",
        "file": [
            {
                "patch": "@@ -740,7 +740,7 @@ private final void internalMap(CharChunk host, CharChunk uri,\n         }\n \n         // Context mapping\n-        if (mappingData.context == null) {\n+        if (mappingData.context == null && contexts != null) {\n             int pos = find(contexts, uri);\n             if (pos == -1) {\n                 return;",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/e7fa400322af857dda52466e3c80fcc2a40a297d/java/org/apache/catalina/mapper/Mapper.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "3dd168d5229dacaf2543a01c30cd8374c7ca56de",
                "blob_url": "https://github.com/apache/tomcat80/blob/e7fa400322af857dda52466e3c80fcc2a40a297d/java/org/apache/catalina/mapper/Mapper.java",
                "filename": "java/org/apache/catalina/mapper/Mapper.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/mapper/Mapper.java?ref=e7fa400322af857dda52466e3c80fcc2a40a297d"
            }
        ],
        "bug_id": "tomcat80_50",
        "parent": "https://github.com/apache/tomcat80/commit/4879b6cdb9b8eeacf757c48a885fe05703b28841",
        "message": "Avoid unlikely NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1367330 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/b96d85aa3485f625749e14d78d5ea442079d2a59",
        "file": [
            {
                "patch": "@@ -668,7 +668,11 @@ public void setSilent(boolean silent) {\n \n     private void silence(Host host, String ctx) {\n         String base = \"org.apache.catalina.core.ContainerBase.[default].[\";\n-        base += host.getName();\n+        if (host == null) {\n+            base += getHost().getName();\n+        } else {\n+            base += host.getName();\n+        }\n         base += \"].[\";\n         base += ctx;\n         base += \"]\";",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/b96d85aa3485f625749e14d78d5ea442079d2a59/java/org/apache/catalina/startup/Tomcat.java",
                "status": "modified",
                "changes": 6,
                "deletions": 1,
                "sha": "dd1385d2bf0599b52eb5b89866a71c512a95ecbe",
                "blob_url": "https://github.com/apache/tomcat80/blob/b96d85aa3485f625749e14d78d5ea442079d2a59/java/org/apache/catalina/startup/Tomcat.java",
                "filename": "java/org/apache/catalina/startup/Tomcat.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/startup/Tomcat.java?ref=b96d85aa3485f625749e14d78d5ea442079d2a59"
            }
        ],
        "bug_id": "tomcat80_51",
        "parent": "https://github.com/apache/tomcat80/commit/ca8c65c09b8610536a7ed312db10a7fe0a078d48",
        "message": "Fix possible NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1226177 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/c0da0bffa75404a1a1da522817c9bb5898b0ade7",
        "file": [
            {
                "patch": "@@ -1190,7 +1190,10 @@ protected void destroyInternal() throws LifecycleException {\n             parent.removeChild(this);\n         }\n \n-        startStopExecutor.shutdownNow();\n+        // If init fails, this may be null\n+        if (startStopExecutor != null) {\n+            startStopExecutor.shutdownNow();\n+        }\n \n         super.destroyInternal();\n     }",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/c0da0bffa75404a1a1da522817c9bb5898b0ade7/java/org/apache/catalina/core/ContainerBase.java",
                "status": "modified",
                "changes": 5,
                "deletions": 1,
                "sha": "6a941a289699e8bfb47f78102046084b509028af",
                "blob_url": "https://github.com/apache/tomcat80/blob/c0da0bffa75404a1a1da522817c9bb5898b0ade7/java/org/apache/catalina/core/ContainerBase.java",
                "filename": "java/org/apache/catalina/core/ContainerBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/ContainerBase.java?ref=c0da0bffa75404a1a1da522817c9bb5898b0ade7"
            }
        ],
        "bug_id": "tomcat80_52",
        "parent": "https://github.com/apache/tomcat80/commit/7efe3ec9d4c0a4b783847caec2b7f0d37a2113c2",
        "message": "Fix potential NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1190279 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/de3b85af37f1860f1b3560fc455b4c21806a70e2",
        "file": [
            {
                "patch": "@@ -270,9 +270,10 @@ protected void deregisterJmx() {\n \n \n     public ObjectName getObjectName(Class<?> clazz, String poolName) throws MalformedObjectNameException {\n-        ObjectName oname = null;\n-        if (getProperties().containsKey(objectNameAttribute)) {\n-            oname = new ObjectName(getProperties().get(objectNameAttribute).getValue());\n+        ObjectName oname;\n+        Map<String,InterceptorProperty> properties = getProperties();\n+        if (properties != null && properties.containsKey(objectNameAttribute)) {\n+            oname = new ObjectName(properties.get(objectNameAttribute).getValue());\n         } else {\n             oname = new ObjectName(ConnectionPool.POOL_JMX_TYPE_PREFIX+clazz.getName()+\",name=\" + poolName);\n         }",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/de3b85af37f1860f1b3560fc455b4c21806a70e2/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReportJmx.java",
                "status": "modified",
                "changes": 7,
                "deletions": 3,
                "sha": "2630768bc3b2784f3831a028782cfccb3aee8a85",
                "blob_url": "https://github.com/apache/tomcat80/blob/de3b85af37f1860f1b3560fc455b4c21806a70e2/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReportJmx.java",
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReportJmx.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReportJmx.java?ref=de3b85af37f1860f1b3560fc455b4c21806a70e2"
            }
        ],
        "bug_id": "tomcat80_53",
        "parent": "https://github.com/apache/tomcat80/commit/2f879ed296f551f6c09ec9f29d6aaf4e174abf87",
        "message": "Fix NPE in TestSlowQueryReport test\n\nThe TestSlowQueryReport L107 calls \"new SlowQueryReportJmx().getObjectName(..)\",\nand thus properties field in new SlowQueryReportJmx is never set\nand accessing it caused NPE in getObjectName(..).\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1460313 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/e6400120808b9c10b58f5553b9be76aee970b888",
        "file": [
            {
                "patch": "@@ -27,6 +27,7 @@\n import javax.servlet.http.HttpSessionBindingEvent;\n import javax.servlet.http.HttpSessionBindingListener;\n \n+import org.apache.catalina.LifecycleException;\n import org.apache.catalina.connector.Request;\n import org.apache.catalina.connector.Response;\n import org.apache.juli.logging.Log;\n@@ -113,6 +114,14 @@ public int getSessionInactiveInterval() {\n     }\n \n \n+    @Override\n+    protected void initInternal() throws LifecycleException {\n+        super.initInternal();\n+        \n+        uaPattern = Pattern.compile(crawlerUserAgents);\n+    }\n+\n+\n     @Override\n     public void invoke(Request request, Response response) throws IOException,\n             ServletException {",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/e6400120808b9c10b58f5553b9be76aee970b888/java/org/apache/catalina/valves/CrawlerSessionManagerValve.java",
                "status": "modified",
                "changes": 9,
                "deletions": 0,
                "sha": "bf4268cbc3a5e2ea17d6b4044ba36aa9e7b7428b",
                "blob_url": "https://github.com/apache/tomcat80/blob/e6400120808b9c10b58f5553b9be76aee970b888/java/org/apache/catalina/valves/CrawlerSessionManagerValve.java",
                "filename": "java/org/apache/catalina/valves/CrawlerSessionManagerValve.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/valves/CrawlerSessionManagerValve.java?ref=e6400120808b9c10b58f5553b9be76aee970b888"
            },
            {
                "patch": "@@ -54,6 +54,15 @@\n   issues to not \"pop up\" wrt. others).\n -->\n <section name=\"Tomcat 7.0.18 (markt)\">\n+  <subsection name=\"Catalina\">\n+    <changelog>\n+      <fix>\n+        Correct regression introduced in 7.0.17 that triggered an NPE if a\n+        CrawlerSessionManagerValve was used without setting crawlerUserAgents.\n+        (markt)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection name=\"Other\">\n     <changelog>\n       <fix>",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/e6400120808b9c10b58f5553b9be76aee970b888/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 9,
                "deletions": 0,
                "sha": "2e8efcb055ce5d635c37aa373d80e2129c267caf",
                "blob_url": "https://github.com/apache/tomcat80/blob/e6400120808b9c10b58f5553b9be76aee970b888/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=e6400120808b9c10b58f5553b9be76aee970b888"
            }
        ],
        "bug_id": "tomcat80_54",
        "parent": "https://github.com/apache/tomcat80/commit/74c0af23a385f2fbae6378229a16be7ba84fe2b0",
        "message": "Fix possible NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1142430 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/3c3f7db0a6da802e7f31e00622f80eaee2656c8c",
        "file": [
            {
                "patch": "@@ -26,6 +26,7 @@\n import javax.servlet.SessionTrackingMode;\n \n import org.apache.catalina.Context;\n+import org.apache.catalina.Host;\n import org.apache.catalina.Wrapper;\n import org.apache.catalina.comet.CometEvent;\n import org.apache.catalina.comet.CometEvent.EventType;\n@@ -642,7 +643,11 @@ protected boolean postParseRequest(org.apache.coyote.Request req,\n                 res.setStatus(404);\n                 res.setMessage(\"Not found\");\n                 // No context, so use host\n-                request.getHost().logAccess(request, response, 0, true);\n+                Host host = request.getHost();\n+                // Make sure there is a host (might not be during shutdown)\n+                if (host != null) {\n+                    host.logAccess(request, response, 0, true);\n+                }\n                 return false;\n             }\n         ",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/3c3f7db0a6da802e7f31e00622f80eaee2656c8c/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "status": "modified",
                "changes": 7,
                "deletions": 1,
                "sha": "7fef9b9690741c10c79096b58c266fcf310a4ebf",
                "blob_url": "https://github.com/apache/tomcat80/blob/3c3f7db0a6da802e7f31e00622f80eaee2656c8c/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "filename": "java/org/apache/catalina/connector/CoyoteAdapter.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/CoyoteAdapter.java?ref=3c3f7db0a6da802e7f31e00622f80eaee2656c8c"
            },
            {
                "patch": "@@ -67,6 +67,10 @@\n         Enable remaining valves for Servlet 3 asynchronous processing support.\n         (markt)\n       </fix>\n+      <fix>\n+        Avoid possible NPE when logging requests received during embedded Tomcat\n+        shutdown. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/3c3f7db0a6da802e7f31e00622f80eaee2656c8c/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "34374e6a6470a8bd70256a1f9539d4a4a724121a",
                "blob_url": "https://github.com/apache/tomcat80/blob/3c3f7db0a6da802e7f31e00622f80eaee2656c8c/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=3c3f7db0a6da802e7f31e00622f80eaee2656c8c"
            }
        ],
        "bug_id": "tomcat80_55",
        "parent": "https://github.com/apache/tomcat80/commit/eb0e7af0917978a82653a41af6ffd5651ea2c24e",
        "message": "Avoid possible NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1133401 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/4733d60734853e3aff03b16292b6b07fefa53617",
        "file": [
            {
                "patch": "@@ -174,8 +174,14 @@ public TagLibraryInfoImpl(JspCompilationContext ctxt, ParserController pc,\n             }\n \n             // Get the representation of the TLD\n+            if (tldResourcePath.getUrl() == null) {\n+                err.jspError(\"jsp.error.tld.missing\", prefix, uri);\n+            }\n             TaglibXml taglibXml =\n                     ctxt.getOptions().getTldCache().getTaglibXml(tldResourcePath);\n+            if (taglibXml == null) {\n+                err.jspError(\"jsp.error.tld.missing\", prefix, uri);\n+            }\n \n             // Populate the TagLibraryInfo attributes\n             this.jspversion = taglibXml.getJspVersion();",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/4733d60734853e3aff03b16292b6b07fefa53617/java/org/apache/jasper/compiler/TagLibraryInfoImpl.java",
                "status": "modified",
                "changes": 6,
                "deletions": 0,
                "sha": "3699af1b45dd3a9f6db51b2c1ee2359c2b695c55",
                "blob_url": "https://github.com/apache/tomcat80/blob/4733d60734853e3aff03b16292b6b07fefa53617/java/org/apache/jasper/compiler/TagLibraryInfoImpl.java",
                "filename": "java/org/apache/jasper/compiler/TagLibraryInfoImpl.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/TagLibraryInfoImpl.java?ref=4733d60734853e3aff03b16292b6b07fefa53617"
            },
            {
                "patch": "@@ -93,6 +93,9 @@ public TldResourcePath getTldResourcePath(String uri) {\n \n     public TaglibXml getTaglibXml(TldResourcePath tldResourcePath) throws JasperException {\n         TaglibXmlCacheEntry cacheEntry = tldResourcePathTaglibXmlMap.get(tldResourcePath);\n+        if (cacheEntry == null) {\n+            return null;\n+        }\n         long lastModified[] = getLastModified(tldResourcePath);\n         if (lastModified[0] != cacheEntry.getWebAppPathLastModified() ||\n                 lastModified[1] != cacheEntry.getEntryLastModified()) {",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/4733d60734853e3aff03b16292b6b07fefa53617/java/org/apache/jasper/compiler/TldCache.java",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "60daed583daf61a1fc617b29cd05008988ac040a",
                "blob_url": "https://github.com/apache/tomcat80/blob/4733d60734853e3aff03b16292b6b07fefa53617/java/org/apache/jasper/compiler/TldCache.java",
                "filename": "java/org/apache/jasper/compiler/TldCache.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/TldCache.java?ref=4733d60734853e3aff03b16292b6b07fefa53617"
            },
            {
                "patch": "@@ -140,6 +140,7 @@ jsp.error.file.not.found=File [{0}] not found\n jsp.error.missing_attribute=According to the TLD or the tag file, attribute {0} is mandatory for tag {1}\n jsp.error.bad_attribute=Attribute {0} invalid for tag {1} according to TLD\n jsp.error.tld.unable_to_get_jar=Unable to get JAR resource \\\"{0}\\\" containing TLD: {1}\n+jsp.error.tld.missing=Unable to find taglib \\\"{0}\\\" for URI: {1}\n jsp.error.tld.missing_jar=Missing JAR resource \\\"{0}\\\" containing TLD\n jsp.error.unable.to_find_method=Unable to find setter method for attribute: {0}\n jsp.error.bad_tag=No tag \\\"{0}\\\" defined in tag library imported with prefix \\\"{1}\\\"",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/4733d60734853e3aff03b16292b6b07fefa53617/java/org/apache/jasper/resources/LocalStrings.properties",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "7b497486c9e0ec10592f1496f2164f42438cebdb",
                "blob_url": "https://github.com/apache/tomcat80/blob/4733d60734853e3aff03b16292b6b07fefa53617/java/org/apache/jasper/resources/LocalStrings.properties",
                "filename": "java/org/apache/jasper/resources/LocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/resources/LocalStrings.properties?ref=4733d60734853e3aff03b16292b6b07fefa53617"
            },
            {
                "patch": "@@ -95,6 +95,9 @@\n         the class loader of the first web application to use expressions to be\n         pinned in memory. (markt)\n       </fix>\n+      <fix>\n+        <bug>59640</bug>: NPEs with not found TLDs. (remm)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Web applications\">",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/4733d60734853e3aff03b16292b6b07fefa53617/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "4cbc9b96a085b3ad9c753841293132aa4d380959",
                "blob_url": "https://github.com/apache/tomcat80/blob/4733d60734853e3aff03b16292b6b07fefa53617/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=4733d60734853e3aff03b16292b6b07fefa53617"
            }
        ],
        "bug_id": "tomcat80_56",
        "parent": "https://github.com/apache/tomcat80/commit/4e00d79dd51d81663caf707e5a1cee1bac48cad3",
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59640\nBack port remm's NPE fix for missing TLDs\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1746475 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/ba618c9565772e293c1b15e7c7836a1e5ad60b39",
        "file": [
            {
                "patch": "@@ -266,5 +266,10 @@ public String getQueryString() {\n         public String getRequestURI() {\n             return CONTEXT_PATH + URI;\n         }\n+\n+        @Override\n+        public org.apache.coyote.Request getCoyoteRequest() {\n+            return new org.apache.coyote.Request();\n+        }\n     }\n }",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/ba618c9565772e293c1b15e7c7836a1e5ad60b39/test/org/apache/catalina/authenticator/TesterDigestAuthenticatorPerformance.java",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "68a4d59f6a01ecfedf70001601dba09ef5817253",
                "blob_url": "https://github.com/apache/tomcat80/blob/ba618c9565772e293c1b15e7c7836a1e5ad60b39/test/org/apache/catalina/authenticator/TesterDigestAuthenticatorPerformance.java",
                "filename": "test/org/apache/catalina/authenticator/TesterDigestAuthenticatorPerformance.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/authenticator/TesterDigestAuthenticatorPerformance.java?ref=ba618c9565772e293c1b15e7c7836a1e5ad60b39"
            }
        ],
        "bug_id": "tomcat80_57",
        "parent": "https://github.com/apache/tomcat80/commit/f027684137ac50da01e203d6cadb8a4b40921123",
        "message": "Fix NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1667633 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/d3acfc8454df59b060666bca334694a324a1d555",
        "file": [
            {
                "patch": "@@ -481,8 +481,10 @@ public void invoke(Request request, Response response)\n \n         // The Servlet may specify security constraints through annotations.\n         // Ensure that they have been processed before constraints are checked\n-        Wrapper wrapper = (Wrapper) request.getMappingData().wrapper; \n-        wrapper.servletSecurityAnnotationScan();\n+        Wrapper wrapper = (Wrapper) request.getMappingData().wrapper;\n+        if (wrapper != null) {\n+            wrapper.servletSecurityAnnotationScan();\n+        }\n \n         Realm realm = this.context.getRealm();\n         // Is this request URI subject to a security constraint?",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/d3acfc8454df59b060666bca334694a324a1d555/java/org/apache/catalina/authenticator/AuthenticatorBase.java",
                "status": "modified",
                "changes": 6,
                "deletions": 2,
                "sha": "92a768f8fecf6ca0ad6b8ba3796ea809df9843a5",
                "blob_url": "https://github.com/apache/tomcat80/blob/d3acfc8454df59b060666bca334694a324a1d555/java/org/apache/catalina/authenticator/AuthenticatorBase.java",
                "filename": "java/org/apache/catalina/authenticator/AuthenticatorBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/authenticator/AuthenticatorBase.java?ref=d3acfc8454df59b060666bca334694a324a1d555"
            }
        ],
        "bug_id": "tomcat80_58",
        "parent": "https://github.com/apache/tomcat80/commit/ee627412570268df47a075f5d4dc5f7debf39fad",
        "message": "Avoid npe\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1078004 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/544398ce22679b1a5e3f565ecdc3240ee54bc584",
        "file": [
            {
                "patch": "@@ -317,7 +317,9 @@ public void logAccess(Request request, Response response, long time,\n                 if (defaultAccessLog == null) {\n                     // Try the ROOT context of default host\n                     Context context = (Context) host.findChild(\"\");\n-                    defaultAccessLog = context.getAccessLog();\n+                    if (context != null) {\n+                        defaultAccessLog = context.getAccessLog();\n+                    }\n \n                     if (defaultAccessLog == null) {\n                         defaultAccessLog = new NoopAccessLog();",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/544398ce22679b1a5e3f565ecdc3240ee54bc584/java/org/apache/catalina/core/StandardEngine.java",
                "status": "modified",
                "changes": 4,
                "deletions": 1,
                "sha": "a463f449cc05d4fd5c2c34c847e927cf771efd3d",
                "blob_url": "https://github.com/apache/tomcat80/blob/544398ce22679b1a5e3f565ecdc3240ee54bc584/java/org/apache/catalina/core/StandardEngine.java",
                "filename": "java/org/apache/catalina/core/StandardEngine.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/StandardEngine.java?ref=544398ce22679b1a5e3f565ecdc3240ee54bc584"
            }
        ],
        "bug_id": "tomcat80_59",
        "parent": "https://github.com/apache/tomcat80/commit/ef8dcc74b346cd2a84563e9a23a0f4539eb7c269",
        "message": "Fix possible NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@966570 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/3f25db73ce1f57cea2fe3bc5481df9770ddd22fc",
        "file": [
            {
                "patch": "@@ -899,6 +899,10 @@ public void invoke(Request request, Response response)\n      */\n     public void removeChild(Container child) {\n \n+        if (child == null) {\n+            return;\n+        }\n+        \n         synchronized(children) {\n             if (children.get(child.getName()) == null)\n                 return;",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/3f25db73ce1f57cea2fe3bc5481df9770ddd22fc/java/org/apache/catalina/core/ContainerBase.java",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "c9d61b81d657e0f1cd9c6a88581e1dc680ab9e82",
                "blob_url": "https://github.com/apache/tomcat80/blob/3f25db73ce1f57cea2fe3bc5481df9770ddd22fc/java/org/apache/catalina/core/ContainerBase.java",
                "filename": "java/org/apache/catalina/core/ContainerBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/ContainerBase.java?ref=3f25db73ce1f57cea2fe3bc5481df9770ddd22fc"
            }
        ],
        "bug_id": "tomcat80_60",
        "parent": "https://github.com/apache/tomcat80/commit/d2ea59b11f7a2bb8da2a37fe920d9c8b0c721c7d",
        "message": "NPE protection\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@943112 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/917106163e077b03a6ec2d4c22a17904aa286611",
        "file": [
            {
                "patch": "@@ -1934,7 +1934,9 @@ private static boolean mergeServlet(ServletDef src, ServletDef dest,\n         }\n         \n         if (dest.getLoadOnStartup() == null) {\n-            dest.setLoadOnStartup(src.getLoadOnStartup().toString());\n+            if (src.getLoadOnStartup() != null) {\n+                dest.setLoadOnStartup(src.getLoadOnStartup().toString());\n+            }\n         } else if (src.getLoadOnStartup() != null) {\n             if (failOnConflict &&\n                     !src.getLoadOnStartup().equals(dest.getLoadOnStartup())) {\n@@ -1943,7 +1945,9 @@ private static boolean mergeServlet(ServletDef src, ServletDef dest,\n         }\n         \n         if (dest.getEnabled() == null) {\n-            dest.setEnabled(src.getEnabled().toString());\n+            if (src.getEnabled() != null) {\n+                dest.setEnabled(src.getEnabled().toString());\n+            }\n         } else if (src.getEnabled() != null) {\n             if (failOnConflict &&\n                     !src.getEnabled().equals(dest.getEnabled())) {\n@@ -1971,7 +1975,9 @@ private static boolean mergeServlet(ServletDef src, ServletDef dest,\n         }\n         \n         if (dest.getAsyncSupported() == null) {\n-            dest.setAsyncSupported(src.getAsyncSupported().toString());\n+            if (src.getAsyncSupported() != null) {\n+                dest.setAsyncSupported(src.getAsyncSupported().toString());\n+            }\n         } else if (src.getAsyncSupported() != null) {\n             if (failOnConflict &&\n                     !src.getAsyncSupported().equals(dest.getAsyncSupported())) {",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/917106163e077b03a6ec2d4c22a17904aa286611/java/org/apache/catalina/deploy/WebXml.java",
                "status": "modified",
                "changes": 12,
                "deletions": 3,
                "sha": "8b3b528294f3709a01f4af847ab9ea3163999ecf",
                "blob_url": "https://github.com/apache/tomcat80/blob/917106163e077b03a6ec2d4c22a17904aa286611/java/org/apache/catalina/deploy/WebXml.java",
                "filename": "java/org/apache/catalina/deploy/WebXml.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/deploy/WebXml.java?ref=917106163e077b03a6ec2d4c22a17904aa286611"
            }
        ],
        "bug_id": "tomcat80_61",
        "parent": "https://github.com/apache/tomcat80/commit/8e6eb7dba173480d22de0f8beca422aea807f809",
        "message": "Avoid NPEs\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@907497 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/818f4795be292bd44effaf1964543716afac8c28",
        "file": [
            {
                "patch": "@@ -64,7 +64,7 @@\n     /*\n      * Counts how many times the webapp's JSPs have been reloaded.\n      */\n-    private AtomicInteger jspReloadCount;\n+    private AtomicInteger jspReloadCount = new AtomicInteger(0);\n \n     /**\n      * Preload classes required at runtime by a JSP servlet so that",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/818f4795be292bd44effaf1964543716afac8c28/java/org/apache/jasper/compiler/JspRuntimeContext.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "397e1bbd767f588e54a0a6a3b74a6799b5758673",
                "blob_url": "https://github.com/apache/tomcat80/blob/818f4795be292bd44effaf1964543716afac8c28/java/org/apache/jasper/compiler/JspRuntimeContext.java",
                "filename": "java/org/apache/jasper/compiler/JspRuntimeContext.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/JspRuntimeContext.java?ref=818f4795be292bd44effaf1964543716afac8c28"
            }
        ],
        "bug_id": "tomcat80_62",
        "parent": "https://github.com/apache/tomcat80/commit/81cef28e8084e41c2deab356316a74adff03e352",
        "message": "Fix NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@882004 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/ef3e99885c357a4f999d8487dfad5cae5879e43d",
        "file": [
            {
                "patch": "@@ -834,10 +834,10 @@ protected void list(PrintWriter writer) {\n         Container[] contexts = host.findChildren();\n         for (int i = 0; i < contexts.length; i++) {\n             Context context = (Context) contexts[i];\n-            String displayPath = context.getPath();\n-            if( displayPath.equals(\"\") )\n-                displayPath = \"/\";\n             if (context != null ) {\n+                String displayPath = context.getPath();\n+                if( displayPath.equals(\"\") )\n+                    displayPath = \"/\";\n                 if (context.getAvailable()) {\n                     writer.println(sm.getString(\"managerServlet.listitem\",\n                                                 displayPath,",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/ef3e99885c357a4f999d8487dfad5cae5879e43d/java/org/apache/catalina/manager/ManagerServlet.java",
                "status": "modified",
                "changes": 6,
                "deletions": 3,
                "sha": "39d623b908a9c0177cd01c7af98189d8a861f015",
                "blob_url": "https://github.com/apache/tomcat80/blob/ef3e99885c357a4f999d8487dfad5cae5879e43d/java/org/apache/catalina/manager/ManagerServlet.java",
                "filename": "java/org/apache/catalina/manager/ManagerServlet.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/manager/ManagerServlet.java?ref=ef3e99885c357a4f999d8487dfad5cae5879e43d"
            }
        ],
        "bug_id": "tomcat80_63",
        "parent": "https://github.com/apache/tomcat80/commit/ff58621997947ea4cd6675f15f62d00b7df88fb9",
        "message": "Fix unlikely NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@763190 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/61094bf646fa5d81ecde5381aec7555f02925521",
        "file": [
            {
                "patch": "@@ -270,8 +270,9 @@ public void setUserTable( String userTable ) {\n      */\n     public Principal authenticate(String username, String credentials) {\n     \t\n-    \t// No user - can't possibly authenticate, don't bother the database then\n-    \tif (username == null) {\n+    \t// No user or no credentials\n+        // Can't possibly authenticate, don't bother the database then\n+    \tif (username == null || credentials == null) {\n     \t\treturn null;\n     \t}\n         ",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/61094bf646fa5d81ecde5381aec7555f02925521/java/org/apache/catalina/realm/DataSourceRealm.java",
                "status": "modified",
                "changes": 5,
                "deletions": 2,
                "sha": "c6ec6e93aed329c3441d60d1da00f22e085265db",
                "blob_url": "https://github.com/apache/tomcat80/blob/61094bf646fa5d81ecde5381aec7555f02925521/java/org/apache/catalina/realm/DataSourceRealm.java",
                "filename": "java/org/apache/catalina/realm/DataSourceRealm.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/realm/DataSourceRealm.java?ref=61094bf646fa5d81ecde5381aec7555f02925521"
            },
            {
                "patch": "@@ -393,9 +393,10 @@ public synchronized Principal authenticate(Connection dbConnection,\n                                                String username,\n                                                String credentials) {\n \n-        // No user - can't possibly authenticate\n-        if (username == null) {\n-            return (null);\n+        // No user or no credentials\n+        // Can't possibly authenticate, don't bother the database then\n+        if (username == null || credentials == null) {\n+            return null;\n         }\n \n         // Look up the user's credentials",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/61094bf646fa5d81ecde5381aec7555f02925521/java/org/apache/catalina/realm/JDBCRealm.java",
                "status": "modified",
                "changes": 7,
                "deletions": 3,
                "sha": "05fd1fa888a0d373cabfd89824428bdd60a7b59a",
                "blob_url": "https://github.com/apache/tomcat80/blob/61094bf646fa5d81ecde5381aec7555f02925521/java/org/apache/catalina/realm/JDBCRealm.java",
                "filename": "java/org/apache/catalina/realm/JDBCRealm.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/realm/JDBCRealm.java?ref=61094bf646fa5d81ecde5381aec7555f02925521"
            },
            {
                "patch": "@@ -147,7 +147,7 @@ public Principal authenticate(String username, String credentials) {\n         GenericPrincipal principal = principals.get(username);\n \n         boolean validated = false;\n-        if (principal != null) {\n+        if (principal != null && credentials != null) {\n             if (hasMessageDigest()) {\n                 // Hex hashes should be compared case-insensitive\n                 validated = (digest(credentials)",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/61094bf646fa5d81ecde5381aec7555f02925521/java/org/apache/catalina/realm/MemoryRealm.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "343a8d45d4fc0d1f108722d3b9d0385e48b81f78",
                "blob_url": "https://github.com/apache/tomcat80/blob/61094bf646fa5d81ecde5381aec7555f02925521/java/org/apache/catalina/realm/MemoryRealm.java",
                "filename": "java/org/apache/catalina/realm/MemoryRealm.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/realm/MemoryRealm.java?ref=61094bf646fa5d81ecde5381aec7555f02925521"
            }
        ],
        "bug_id": "tomcat80_64",
        "parent": "https://github.com/apache/tomcat80/commit/47580377b5d7608e641b772a802c425a875d3dff",
        "message": "Fix possible NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@747834 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/729e4350973dba0ad2b2b2b2db800b13083f59e3",
        "file": [
            {
                "patch": "@@ -1208,6 +1208,7 @@ public void action(ActionCode actionCode, Object param) {\n         } else if (actionCode == ActionCode.ACTION_COMET_END) {\n             comet = false;\n         }  else if (actionCode == ActionCode.ACTION_COMET_CLOSE) {\n+            if (socket==null || socket.getAttachment(false)==null) return;\n             NioEndpoint.KeyAttachment attach = (NioEndpoint.KeyAttachment)socket.getAttachment(false);\n             attach.setCometOps(NioEndpoint.OP_CALLBACK);\n             //notify poller if not on a tomcat thread\n@@ -1216,6 +1217,7 @@ public void action(ActionCode actionCode, Object param) {\n                 socket.getPoller().cometInterest(socket);\n         } else if (actionCode == ActionCode.ACTION_COMET_SETTIMEOUT) {\n             if (param==null) return;\n+            if (socket==null || socket.getAttachment(false)==null) return;\n             NioEndpoint.KeyAttachment attach = (NioEndpoint.KeyAttachment)socket.getAttachment(false);\n             long timeout = ((Long)param).longValue();\n             //if we are not piggy backing on a worker thread, set the timeout",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/729e4350973dba0ad2b2b2b2db800b13083f59e3/java/org/apache/coyote/http11/Http11NioProcessor.java",
                "status": "modified",
                "changes": 2,
                "deletions": 0,
                "sha": "818b594403bf59594b839616208b0207bd5a4d53",
                "blob_url": "https://github.com/apache/tomcat80/blob/729e4350973dba0ad2b2b2b2db800b13083f59e3/java/org/apache/coyote/http11/Http11NioProcessor.java",
                "filename": "java/org/apache/coyote/http11/Http11NioProcessor.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/http11/Http11NioProcessor.java?ref=729e4350973dba0ad2b2b2b2db800b13083f59e3"
            }
        ],
        "bug_id": "tomcat80_65",
        "parent": "https://github.com/apache/tomcat80/commit/2886275af68a21d6de2f51c7222f33d2055d87f3",
        "message": "Fix NPE\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@720173 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/7eb353016adb79d70f64463f6c0065510db52af9",
        "file": [
            {
                "patch": "@@ -1429,7 +1429,8 @@ public void cancelledKey(SelectionKey key, SocketStatus status, boolean dispatch\n                         processSocket(ka.getChannel(), status, false); //don't dispatch if the lines below are cancelling the key\n                     }                    \n                 }\n-                handler.release(ka.getChannel());\n+                \n+                if (ka!=null) handler.release(ka.getChannel());\n                 if (key.isValid()) key.cancel();\n                 if (key.channel().isOpen()) try {key.channel().close();}catch (Exception ignore){}\n                 try {ka.channel.close(true);}catch (Exception ignore){}\n@@ -1610,13 +1611,26 @@ public boolean processSendfile(SelectionKey sk, KeyAttachment attachment, boolea\n                     sd.length -= written;\n                 }\n                 if ( sd.length <= 0 ) {\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send file complete for:\"+sd.fileName);\n+                    }\n                     attachment.setSendfileData(null);\n                     if ( sd.keepAlive ) {\n+                        if (log.isDebugEnabled()) {\n+                            log.debug(\"Connection is keep alive, registering back for OP_READ\");\n+                        }\n                         if (reg) reg(sk,attachment,SelectionKey.OP_READ);\n                     } else {\n+                        if (log.isDebugEnabled()) {\n+                            log.debug(\"Send file connection is being closed\");\n+                        }\n                         cancelledKey(sk,SocketStatus.STOP,false);\n                     }\n                 } else if ( attachment.interestOps() == 0 && reg ) {\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"OP_WRITE for sendilfe:\"+sd.fileName);\n+                    }\n+\n                     reg(sk,attachment,SelectionKey.OP_WRITE);\n                 }\n             }catch ( IOException x ) {",
                "additions": 15,
                "raw_url": "https://github.com/apache/tomcat80/raw/7eb353016adb79d70f64463f6c0065510db52af9/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "status": "modified",
                "changes": 16,
                "deletions": 1,
                "sha": "ce5941a82853b8720fb3095cecee7724fbd05d16",
                "blob_url": "https://github.com/apache/tomcat80/blob/7eb353016adb79d70f64463f6c0065510db52af9/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/NioEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/NioEndpoint.java?ref=7eb353016adb79d70f64463f6c0065510db52af9"
            }
        ],
        "bug_id": "tomcat80_66",
        "parent": "https://github.com/apache/tomcat80/commit/351be13ad1eb556d19347aedcc507e0c51423097",
        "message": "fix NPE risk\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@719096 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/eb4a6a19f5428646f5ebeba2b56e37a6396ccbe9",
        "file": [
            {
                "patch": "@@ -1182,9 +1182,11 @@ protected void parseSessionSslId(Request request) {\n                 SSL_ONLY.equals(request.getServletContext()\n                         .getEffectiveSessionTrackingModes()) &&\n                         request.connector.secure) {\n-            request.setRequestedSessionId(\n-                    request.getAttribute(SSLSupport.SESSION_ID_KEY).toString());\n-            request.setRequestedSessionSSL(true);\n+            String sessionId = (String) request.getAttribute(SSLSupport.SESSION_ID_KEY);\n+            if (sessionId != null) {\n+                request.setRequestedSessionId(sessionId.toString());\n+                request.setRequestedSessionSSL(true);\n+            }\n         }\n     }\n ",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/eb4a6a19f5428646f5ebeba2b56e37a6396ccbe9/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "status": "modified",
                "changes": 8,
                "deletions": 3,
                "sha": "408a534ad2540f320314f9d441dd6b659de8f55d",
                "blob_url": "https://github.com/apache/tomcat80/blob/eb4a6a19f5428646f5ebeba2b56e37a6396ccbe9/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "filename": "java/org/apache/catalina/connector/CoyoteAdapter.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/CoyoteAdapter.java?ref=eb4a6a19f5428646f5ebeba2b56e37a6396ccbe9"
            },
            {
                "patch": "@@ -57,6 +57,10 @@\n         by the <code>Rfc6265CookieProcessor</code> are aligned with the\n         specification. Patch provided by Jim Griswold. (markt)\n       </fix>\n+      <fix>\n+        <bug>60911</bug>: Ensure NPE will not be thrown when looking for SSL\n+        session ID. Based on a patch by Didier Gutacker. (violetagg)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/eb4a6a19f5428646f5ebeba2b56e37a6396ccbe9/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "67f535077bcaec714989787a0e0aaeebdbeee162",
                "blob_url": "https://github.com/apache/tomcat80/blob/eb4a6a19f5428646f5ebeba2b56e37a6396ccbe9/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=eb4a6a19f5428646f5ebeba2b56e37a6396ccbe9"
            }
        ],
        "bug_id": "tomcat80_67",
        "parent": "https://github.com/apache/tomcat80/commit/07034b7019be3542fd29cb5b64cf4be78ea76fff",
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60911\nEnsure NPE will not be thrown when looking for SSL session ID. Based on a patch by Didier Gutacker.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1788745 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/9c26a10513ba19a167c1e0dd3d5a976f351f324a",
        "file": [
            {
                "patch": "@@ -375,7 +375,8 @@ public void service(org.apache.coyote.Request req,\n             // Parse and set Catalina and configuration specific \n             // request parameters\n             req.getRequestProcessor().setWorkerThreadName(Thread.currentThread().getName());\n-            if (postParseRequest(req, request, res, response)) {\n+            boolean postParseSuccess = postParseRequest(req, request, res, response);\n+            if (postParseSuccess) {\n                 //check valves if we support async\n                 request.setAsyncSupported(connector.getService().getContainer().getPipeline().isAsyncSupported());\n                 // Calling the container\n@@ -406,9 +407,14 @@ public void service(org.apache.coyote.Request req,\n                 async = true;\n             } else if (!comet) {\n                 response.finishResponse();\n-                ((Context) request.getMappingData().context).logAccess(request,\n-                        response,\n-                        System.currentTimeMillis() - req.getStartTime(), false);\n+                if (postParseSuccess) {\n+                    // Log only if processing was invoked.\n+                    // If postParseRequest() failed, it has already logged it.\n+                    ((Context) request.getMappingData().context).logAccess(\n+                            request, response,\n+                            System.currentTimeMillis() - req.getStartTime(),\n+                            false);\n+                }\n                 req.action(ActionCode.POST_REQUEST , null);\n             }\n ",
                "additions": 10,
                "raw_url": "https://github.com/apache/tomcat80/raw/9c26a10513ba19a167c1e0dd3d5a976f351f324a/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "status": "modified",
                "changes": 14,
                "deletions": 4,
                "sha": "153788f91449be1349457c63c925f30a8e21ee6b",
                "blob_url": "https://github.com/apache/tomcat80/blob/9c26a10513ba19a167c1e0dd3d5a976f351f324a/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "filename": "java/org/apache/catalina/connector/CoyoteAdapter.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/CoyoteAdapter.java?ref=9c26a10513ba19a167c1e0dd3d5a976f351f324a"
            },
            {
                "patch": "@@ -41,6 +41,15 @@\n <!--\n   General, Catalina, Coyote, Jasper, Cluster, Web applications, Extras, Other\n -->\n+<section name=\"Tomcat 7.0.8 (markt)\">\n+  <subsection name=\"Catalina\">\n+    <changelog>\n+      <fix>\n+        Fix NPE in CoyoteAdapter when postParseRequest() call fails. (kkolinko)\n+      </fix>\n+    </changelog>\n+  </subsection>\n+</section>\n <section name=\"Tomcat 7.0.7 (markt)\">\n   <subsection name=\"Catalina\">\n     <changelog>",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/9c26a10513ba19a167c1e0dd3d5a976f351f324a/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 9,
                "deletions": 0,
                "sha": "c0f994d8d5e44c83186a8e2b3015e847b37fb76b",
                "blob_url": "https://github.com/apache/tomcat80/blob/9c26a10513ba19a167c1e0dd3d5a976f351f324a/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=9c26a10513ba19a167c1e0dd3d5a976f351f324a"
            }
        ],
        "bug_id": "tomcat80_68",
        "parent": "https://github.com/apache/tomcat80/commit/b917ed40248458a5f5f6ef15b28288bec4399386",
        "message": "Fix NPE in CoyoteAdapter when postParseRequest() call fails.\n\nThat was caused by mappingData.context being null.\nThis NPE occurence in 7.0.7 was reported on the users list.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1067072 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/382709243cc18f0e599af83c2a79633fa89a00a6",
        "file": [
            {
                "patch": "@@ -48,7 +48,7 @@\n     /**\n      * The listen host for this member\n      */\n-    protected volatile byte[] host;\n+    protected volatile byte[] host = new byte[0];\n     protected transient volatile String hostname;\n     /**\n      * The tcp listen port for this member",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/382709243cc18f0e599af83c2a79633fa89a00a6/java/org/apache/catalina/tribes/membership/MemberImpl.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "54e6eac74302f764c269fe8ac9b4122ff12919ef",
                "blob_url": "https://github.com/apache/tomcat80/blob/382709243cc18f0e599af83c2a79633fa89a00a6/java/org/apache/catalina/tribes/membership/MemberImpl.java",
                "filename": "java/org/apache/catalina/tribes/membership/MemberImpl.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/tribes/membership/MemberImpl.java?ref=382709243cc18f0e599af83c2a79633fa89a00a6"
            },
            {
                "patch": "@@ -163,6 +163,10 @@\n       <add>\n         Add the flag indicating that member is a localMember. (kfujino)\n       </add>\n+      <fix>\n+        Fix potential NPE that depends on the setting order of attributes of\n+        static member when using the static cluster. (kfujino)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Other\">",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/382709243cc18f0e599af83c2a79633fa89a00a6/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "a4e967765cee9edb2fbebded945ab06eb805fb8b",
                "blob_url": "https://github.com/apache/tomcat80/blob/382709243cc18f0e599af83c2a79633fa89a00a6/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=382709243cc18f0e599af83c2a79633fa89a00a6"
            }
        ],
        "bug_id": "tomcat80_69",
        "parent": "https://github.com/apache/tomcat80/commit/0150ec854b434abf58706d0171f9daca0325f7b1",
        "message": "Fix potential NPE that depends on the setting order of attributes of static member when using the static cluster.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1738709 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/ce664906aaeae4ed836e7b8252c820fecdb5cf15",
        "file": [
            {
                "patch": "@@ -878,7 +878,7 @@ private final void internalMapWrapper(ContextVersion contextVersion,\n         }\n \n         if(mappingData.wrapper == null && noServletPath &&\n-                mappingData.context.getMapperContextRootRedirectEnabled()) {\n+                contextVersion.object.getMapperContextRootRedirectEnabled()) {\n             // The path is empty, redirect to \"/\"\n             path.append('/');\n             pathEnd = path.getEnd();\n@@ -1006,7 +1006,7 @@ private final void internalMapWrapper(ContextVersion contextVersion,\n                     file = contextVersion.resources.getResource(pathStr);\n                 }\n                 if (file != null && file.isDirectory() &&\n-                        mappingData.context.getMapperDirectoryRedirectEnabled()) {\n+                        contextVersion.object.getMapperDirectoryRedirectEnabled()) {\n                     // Note: this mutates the path: do not do any processing\n                     // after this (since we set the redirectPath, there\n                     // shouldn't be any)",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/ce664906aaeae4ed836e7b8252c820fecdb5cf15/java/org/apache/catalina/mapper/Mapper.java",
                "status": "modified",
                "changes": 4,
                "deletions": 2,
                "sha": "6de03dd32a7b25354ce1105e6f7abe5cfe6a9b54",
                "blob_url": "https://github.com/apache/tomcat80/blob/ce664906aaeae4ed836e7b8252c820fecdb5cf15/java/org/apache/catalina/mapper/Mapper.java",
                "filename": "java/org/apache/catalina/mapper/Mapper.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/mapper/Mapper.java?ref=ce664906aaeae4ed836e7b8252c820fecdb5cf15"
            },
            {
                "patch": "@@ -69,6 +69,9 @@\n         and <code>javax.servlet.AsyncEvent.getSuppliedResponse</code>\n         (violetagg)\n       </fix>\n+      <fix>\n+        <bug>59255</bug>: Fix posible NPE in mapper. (kkolinko/remm)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/ce664906aaeae4ed836e7b8252c820fecdb5cf15/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "acf322adeef7d1dc81824d42c33b80b9a02a9ae5",
                "blob_url": "https://github.com/apache/tomcat80/blob/ce664906aaeae4ed836e7b8252c820fecdb5cf15/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=ce664906aaeae4ed836e7b8252c820fecdb5cf15"
            }
        ],
        "bug_id": "tomcat80_70",
        "parent": "https://github.com/apache/tomcat80/commit/92ddade6536af5079bee484bd51fb00e66f3ca48",
        "message": "59255: Fix posible NPE in mapper, using Konstantin Kolinko's idea.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1737278 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/cd8bf160c6e47fa60f78003279dd7351aeff88cd",
        "file": [
            {
                "patch": "@@ -939,7 +939,7 @@ public V get(Object key) {\n                     msg = new MapMessage(getMapContextName(), MapMessage.MSG_RETRIEVE_BACKUP, false,\n                                          (Serializable) key, null, null, null,null);\n                     Response[] resp = getRpcChannel().send(entry.getBackupNodes(),msg, RpcChannel.FIRST_REPLY, Channel.SEND_OPTIONS_DEFAULT, getRpcTimeout());\n-                    if (resp == null || resp.length == 0) {\n+                    if (resp == null || resp.length == 0 || resp[0].getMessage() == null) {\n                         //no responses\n                         log.warn(sm.getString(\"abstractReplicatedMap.unable.retrieve\", key));\n                         return null;",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/cd8bf160c6e47fa60f78003279dd7351aeff88cd/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "1be1b27a9ca388367360405e1cd454c4b5943506",
                "blob_url": "https://github.com/apache/tomcat80/blob/cd8bf160c6e47fa60f78003279dd7351aeff88cd/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "filename": "java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java?ref=cd8bf160c6e47fa60f78003279dd7351aeff88cd"
            },
            {
                "patch": "@@ -45,6 +45,13 @@\n   issues do not \"pop up\" wrt. others).\n -->\n <section name=\"Tomcat 8.0.34 (markt)\" rtext=\"development in progress\">\n+  <subsection name=\"Tribes\">\n+    <changelog>\n+      <fix>\n+        Avoid NPE when a proxy node failed to retrieve a backup entry. (kfujino)\n+      </fix>\n+    </changelog>\n+  </subsection>\n </section>\n <section name=\"Tomcat 8.0.33 (markt)\" rtext=\"release in progress\">\n   <subsection name=\"Catalina\">",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/cd8bf160c6e47fa60f78003279dd7351aeff88cd/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 7,
                "deletions": 0,
                "sha": "da93b6ba9e1d5a16156f0dc915196c02f5875513",
                "blob_url": "https://github.com/apache/tomcat80/blob/cd8bf160c6e47fa60f78003279dd7351aeff88cd/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=cd8bf160c6e47fa60f78003279dd7351aeff88cd"
            }
        ],
        "bug_id": "tomcat80_71",
        "parent": "https://github.com/apache/tomcat80/commit/5713849aa397e14913cfcd84f8a92c0f4f7daf38",
        "message": "Avoid NPE when a proxy node failed to retrieve a backup entry.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1736131 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/283a30571cdd6a4499052f6b9e667d351e314bf1",
        "file": [
            {
                "patch": "@@ -255,10 +255,12 @@ public void init(JspCompilationContext ctxt, JspServletWrapper jsw) {\n             // to be GC'd and save memory.\n             ctxt.setWriter(null);\n \n-            // Need to know if the JSP is an error page at runtime to determine\n-            // which HTTP methods are permitted. Error pages permit any. Normal\n-            // pages only permit GET, POST or HEAD.\n-            jsw.setErrorPage(pageInfo.isErrorPage());\n+            if (jsw != null) {\n+                // Need to know if the JSP is an error page at runtime to determine\n+                // which HTTP methods are permitted. Error pages permit any. Normal\n+                // pages only permit GET, POST or HEAD.\n+                jsw.setErrorPage(pageInfo.isErrorPage());\n+            }\n \n             if (log.isDebugEnabled()) {\n                 t4 = System.currentTimeMillis();",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/283a30571cdd6a4499052f6b9e667d351e314bf1/java/org/apache/jasper/compiler/Compiler.java",
                "status": "modified",
                "changes": 10,
                "deletions": 4,
                "sha": "6d2182273ea420c83c5977ecf890f681c346a046",
                "blob_url": "https://github.com/apache/tomcat80/blob/283a30571cdd6a4499052f6b9e667d351e314bf1/java/org/apache/jasper/compiler/Compiler.java",
                "filename": "java/org/apache/jasper/compiler/Compiler.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/Compiler.java?ref=283a30571cdd6a4499052f6b9e667d351e314bf1"
            }
        ],
        "bug_id": "tomcat80_72",
        "parent": "https://github.com/apache/tomcat80/commit/bfc7550283277ad20b347dd94f85abbc3e578059",
        "message": "Avoid NPE when using JspC\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1620822 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/7c552c14a1217ce2e14d899e956fe60a55c10398",
        "file": [
            {
                "patch": "@@ -22,11 +22,11 @@\n \n public class ClassLoaderUtil {\n     private static final Log log = LogFactory.getLog(ClassLoaderUtil.class);\n-    \n-    private static final boolean onlyAttemptFirstLoader = \n-        Boolean.getBoolean(System.getProperty(\"org.apache.tomcat.jdbc.pool.onlyAttemptCurrentClassLoader\", \"false\")); \n-    \n-    public static Class loadClass(String className, ClassLoader... classLoaders) throws ClassNotFoundException {\n+\n+    private static final boolean onlyAttemptFirstLoader =\n+        Boolean.getBoolean(System.getProperty(\"org.apache.tomcat.jdbc.pool.onlyAttemptCurrentClassLoader\", \"false\"));\n+\n+    public static Class<?> loadClass(String className, ClassLoader... classLoaders) throws ClassNotFoundException {\n         ClassNotFoundException last = null;\n         StringBuffer errorMsg = null;\n         for (ClassLoader cl : classLoaders) {\n@@ -47,7 +47,11 @@ public static Class loadClass(String className, ClassLoader... classLoaders) thr\n                     errorMsg.append(\";\");\n                 }\n                 errorMsg.append(\"ClassLoader:\");\n-                errorMsg.append(cl.toString());\n+                if (cl == null) {\n+                    errorMsg.append(\"null\");\n+                } else {\n+                    errorMsg.append(cl.toString());\n+                }\n             }\n             if (onlyAttemptFirstLoader) {\n                 break;",
                "additions": 10,
                "raw_url": "https://github.com/apache/tomcat80/raw/7c552c14a1217ce2e14d899e956fe60a55c10398/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ClassLoaderUtil.java",
                "status": "modified",
                "changes": 16,
                "deletions": 6,
                "sha": "f67a9c27c98d159f77dfc5c6e6d1911bd6b55af8",
                "blob_url": "https://github.com/apache/tomcat80/blob/7c552c14a1217ce2e14d899e956fe60a55c10398/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ClassLoaderUtil.java",
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ClassLoaderUtil.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ClassLoaderUtil.java?ref=7c552c14a1217ce2e14d899e956fe60a55c10398"
            }
        ],
        "bug_id": "tomcat80_73",
        "parent": "https://github.com/apache/tomcat80/commit/2ffb2508a2616eab96c9c1615ffcbb6f4c48b99a",
        "message": "Fix possible NPE highlighted by Eclipse\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1616759 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872",
        "file": [
            {
                "patch": "@@ -21,6 +21,8 @@ error.unreachable.base=Target Unreachable, identifier ''{0}'' resolved to null\n error.unreachable.property=Target Unreachable, ''{0}'' returned null\n error.resolver.unhandled=ELResolver did not handle type: {0} with property of ''{1}''\n error.resolver.unhandled.null=ELResolver cannot handle a null base Object with identifier ''{0}''\n+error.invoke.wrongParams=The method [{0}] was called with [{1}] parameter(s) when it expected [{2}]\n+error.invoke.tooFewParams=The method [{0}] was called with [{1}] parameter(s) when it expected at least [{2}]\n \n # ValueExpressionLiteral\n error.value.literal.write=ValueExpression is a literal and not writable: {0}",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872/java/org/apache/el/Messages.properties",
                "status": "modified",
                "changes": 2,
                "deletions": 0,
                "sha": "f3d87089a630e3d8ad8e85cb821429b123d29731",
                "blob_url": "https://github.com/apache/tomcat80/blob/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872/java/org/apache/el/Messages.properties",
                "filename": "java/org/apache/el/Messages.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/el/Messages.properties?ref=cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872"
            },
            {
                "patch": "@@ -237,7 +237,7 @@ public Object invoke(EvaluationContext ctx,\n         }\n         m = ReflectionUtil.getMethod(ctx, t.base, t.property, types, values);\n \n-        // Handle varArgs and any co-ercion required\n+        // Handle varArgs and any coercion required\n         values = convertArgs(ctx, values, m);\n \n         Object result = null;\n@@ -268,6 +268,24 @@ public Object invoke(EvaluationContext ctx,\n \n         int paramCount = types.length;\n \n+        if (paramCount > 0 && src == null ||\n+                m.isVarArgs() && src.length < paramCount ||\n+                !m.isVarArgs() && src.length != paramCount) {\n+            String inputParamCount = null;\n+            if (src != null) {\n+                inputParamCount = Integer.toString(src.length);\n+            }\n+            String msg;\n+            if (m.isVarArgs()) {\n+                msg = MessageFactory.get(\"error.invoke.tooFewParams\",\n+                        m.getName(), inputParamCount, Integer.toString(paramCount));\n+            } else {\n+                msg = MessageFactory.get(\"error.invoke.wrongParams\",\n+                        m.getName(), inputParamCount, Integer.toString(paramCount));\n+            }\n+            throw new IllegalArgumentException(msg);\n+        }\n+\n         Object[] dest = new Object[paramCount];\n \n         for (int i = 0; i < paramCount - 1; i++) {",
                "additions": 19,
                "raw_url": "https://github.com/apache/tomcat80/raw/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872/java/org/apache/el/parser/AstValue.java",
                "status": "modified",
                "changes": 20,
                "deletions": 1,
                "sha": "f20b170200e3a1f2a086ebf5d986f8e66be43a39",
                "blob_url": "https://github.com/apache/tomcat80/blob/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872/java/org/apache/el/parser/AstValue.java",
                "filename": "java/org/apache/el/parser/AstValue.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/el/parser/AstValue.java?ref=cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872"
            },
            {
                "patch": "@@ -482,4 +482,20 @@ public void testBug56797b() {\n         Object r = me.invoke(context, null);\n         assertEquals(\"AA2Hello World!\", r.toString());\n     }\n+\n+\n+    @Test(expected=IllegalArgumentException.class)\n+    public void testBug57855a() {\n+        MethodExpression me = factory.createMethodExpression(context,\n+                \"${beanAA.echo2}\", null , new Class[]{String.class});\n+        me.invoke(context, new Object[0]);\n+    }\n+\n+\n+    @Test(expected=IllegalArgumentException.class)\n+    public void testBug57855b() {\n+        MethodExpression me = factory.createMethodExpression(context,\n+                \"${beanAA.echo2}\", null , new Class[]{String.class});\n+        me.invoke(context, null);\n+    }\n }",
                "additions": 16,
                "raw_url": "https://github.com/apache/tomcat80/raw/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872/test/org/apache/el/TestMethodExpressionImpl.java",
                "status": "modified",
                "changes": 16,
                "deletions": 0,
                "sha": "1ddea069db1e1c93866cc17bf603e3e1851fcf6e",
                "blob_url": "https://github.com/apache/tomcat80/blob/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872/test/org/apache/el/TestMethodExpressionImpl.java",
                "filename": "test/org/apache/el/TestMethodExpressionImpl.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/el/TestMethodExpressionImpl.java?ref=cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872"
            },
            {
                "patch": "@@ -146,6 +146,15 @@\n         the JSP are visible (subject to the normal rules on re-compilation)\n         regardless of how the JSP is accessed. (markt)\n       </fix>\n+      <fix>\n+        <bug>57855</bug>: Explicitly handle the case where a\n+        <code>MethodExpression</code> is invoked with null or the wrong number\n+        of parameters. Rather than failing with an\n+        <code>ArrayIndexOutOfBoundsException</code> or a\n+        <code>NullPointerException</code> throw an\n+        <code>IllegalArgumentException</code> with a useful error message.\n+        (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Cluster\">",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 9,
                "deletions": 0,
                "sha": "9d61b709064f58ffd31689fb7fcdd7c564db5ad5",
                "blob_url": "https://github.com/apache/tomcat80/blob/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872"
            }
        ],
        "bug_id": "tomcat80_74",
        "parent": "https://github.com/apache/tomcat80/commit/caf7e49f3aeef05c8bbd49fb58ce2141c23b7d52",
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57855\nExplicitly handle the case where a MethodExpression is invoked with null or the wrong number of parameters. Rather than failing with ArrayIndexOutOfBoundsException or NullPointerException throw an IllegalArgumentException with a useful error message.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1676232 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/a758994ab119e8e690722fc5d98709247bfcf221",
        "file": [
            {
                "patch": "@@ -449,7 +449,7 @@ public String getPathInfo() {\n      */\n     @Override\n     public String getPathTranslated() {\n-        if (getPathInfo() == null) {\n+        if (getPathInfo() == null || getServletContext() == null) {\n             return null;\n         }\n ",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/a758994ab119e8e690722fc5d98709247bfcf221/java/org/apache/catalina/core/ApplicationHttpRequest.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "c0fabf5e6d7464d10b8dbb03243243b1d304bb3b",
                "blob_url": "https://github.com/apache/tomcat80/blob/a758994ab119e8e690722fc5d98709247bfcf221/java/org/apache/catalina/core/ApplicationHttpRequest.java",
                "filename": "java/org/apache/catalina/core/ApplicationHttpRequest.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/ApplicationHttpRequest.java?ref=a758994ab119e8e690722fc5d98709247bfcf221"
            }
        ],
        "bug_id": "tomcat80_75",
        "parent": "https://github.com/apache/tomcat80/commit/f21f8acdef8e459c25b10d3344343eea8dbd7e18",
        "message": "kkolinko review: Extend NPE protection\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1608301 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/5051dcda5ab12e461bed38ff77d64f9f6aa83ce9",
        "file": [
            {
                "patch": "@@ -37,7 +37,10 @@ public WsFrameClient(ByteBuffer response, AsyncChannelWrapper channel,\n         this.response = response;\n         this.channel = channel;\n         this.handler = new WsFrameClientCompletionHandler();\n+    }\n+\n \n+    void startInputProcessing() {\n         try {\n             processSocketRead();\n         } catch (IOException e) {",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/5051dcda5ab12e461bed38ff77d64f9f6aa83ce9/java/org/apache/tomcat/websocket/WsFrameClient.java",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "41cf71287fe18937d559e046ea7a06e1a0d5ead2",
                "blob_url": "https://github.com/apache/tomcat80/blob/5051dcda5ab12e461bed38ff77d64f9f6aa83ce9/java/org/apache/tomcat/websocket/WsFrameClient.java",
                "filename": "java/org/apache/tomcat/websocket/WsFrameClient.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsFrameClient.java?ref=5051dcda5ab12e461bed38ff77d64f9f6aa83ce9"
            },
            {
                "patch": "@@ -260,9 +260,7 @@ void startMessage(byte opCode, ByteBuffer payload, boolean last,\n         messageParts.add(new MessagePart(opCode, payload, last,\n                 new EndMessageHandler(this, handler)));\n \n-        if (transformation != null) {\n-            messageParts = transformation.sendMessagePart(messageParts);\n-        }\n+        messageParts = transformation.sendMessagePart(messageParts);\n \n         MessagePart mp = messageParts.remove(0);\n ",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/5051dcda5ab12e461bed38ff77d64f9f6aa83ce9/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "status": "modified",
                "changes": 4,
                "deletions": 3,
                "sha": "e4a16e04bad51ca96b4ea09611ea255bb279576c",
                "blob_url": "https://github.com/apache/tomcat80/blob/5051dcda5ab12e461bed38ff77d64f9f6aa83ce9/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "filename": "java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java?ref=5051dcda5ab12e461bed38ff77d64f9f6aa83ce9"
            },
            {
                "patch": "@@ -316,22 +316,24 @@ public Session connectToServer(Endpoint endpoint,\n                     sm.getString(\"wsWebSocketContainer.httpRequestFailed\"), e);\n         }\n \n-        // TODO Add extension/transformation support to the client\n-\n         // Switch to WebSocket\n         WsRemoteEndpointImplClient wsRemoteEndpointClient = new WsRemoteEndpointImplClient(channel);\n \n         WsSession wsSession = new WsSession(endpoint, wsRemoteEndpointClient,\n                 this, null, null, null, null, null, subProtocol,\n                 Collections.<String, String> emptyMap(), secure,\n                 clientEndpointConfiguration);\n-        endpoint.onOpen(wsSession, clientEndpointConfiguration);\n-        registerSession(endpoint, wsSession);\n \n-        // Object creation will trigger input processing\n-        @SuppressWarnings(\"unused\")\n         WsFrameClient wsFrameClient = new WsFrameClient(response, channel,\n                 wsSession);\n+        // WsFrame adds the necessary final transformations. Copy the\n+        // completed transformation chain to the remote end point.\n+        wsRemoteEndpointClient.setTransformation(wsFrameClient.getTransformation());\n+\n+        endpoint.onOpen(wsSession, clientEndpointConfiguration);\n+        registerSession(endpoint, wsSession);\n+\n+        wsFrameClient.startInputProcessing();\n \n         return wsSession;\n     }",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/5051dcda5ab12e461bed38ff77d64f9f6aa83ce9/java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "status": "modified",
                "changes": 14,
                "deletions": 6,
                "sha": "591e42965df958a2121c2f99a9e8590fbe99dd56",
                "blob_url": "https://github.com/apache/tomcat80/blob/5051dcda5ab12e461bed38ff77d64f9f6aa83ce9/java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "filename": "java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsWebSocketContainer.java?ref=5051dcda5ab12e461bed38ff77d64f9f6aa83ce9"
            }
        ],
        "bug_id": "tomcat80_76",
        "parent": "https://github.com/apache/tomcat80/commit/59a648d056f9d4db4f76360b32cb15c1ad2e73b6",
        "message": "Fix root cause of NPE when using WebSocket clients.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1606653 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/edf5091642d2c0d32b49ec5f9dd718d241529f3f",
        "file": [
            {
                "patch": "@@ -592,7 +592,7 @@ public void deregisterTrackedResource(TrackedWebResource trackedResource) {\n     // ----------------------------------------------------------- JMX Lifecycle\n     @Override\n     protected String getDomainInternal() {\n-        return context.getDomain();\n+        return (context != null) ? context.getDomain() : null;\n     }\n \n     @Override",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/edf5091642d2c0d32b49ec5f9dd718d241529f3f/java/org/apache/catalina/webresources/StandardRoot.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "07f90d40f3234bc389ba42f3360a9e496129018b",
                "blob_url": "https://github.com/apache/tomcat80/blob/edf5091642d2c0d32b49ec5f9dd718d241529f3f/java/org/apache/catalina/webresources/StandardRoot.java",
                "filename": "java/org/apache/catalina/webresources/StandardRoot.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/webresources/StandardRoot.java?ref=edf5091642d2c0d32b49ec5f9dd718d241529f3f"
            }
        ],
        "bug_id": "tomcat80_77",
        "parent": "https://github.com/apache/tomcat80/commit/d6bea5551b41bc44ddaaa9eb9d294982fba3bf8d",
        "message": "Avoid NPE with storeconfig.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1605723 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/bd204ebca1660fc13dff557399ae5f0afd64ed67",
        "file": [
            {
                "patch": "@@ -263,8 +263,9 @@ public String getSessionAttributeNameFilter() {\n     public void setSessionAttributeNameFilter(String sessionAttributeNameFilter) {\n         if (sessionAttributeNameFilter == null || sessionAttributeNameFilter.length() == 0) {\n             sessionAttributeNamePattern = null;\n+        } else {\n+            sessionAttributeNamePattern = Pattern.compile(sessionAttributeNameFilter);\n         }\n-        sessionAttributeNamePattern = Pattern.compile(sessionAttributeNameFilter);\n     }\n \n \n@@ -322,9 +323,10 @@ public void setSessionAttributeValueClassNameFilter(String sessionAttributeValue\n         if (sessionAttributeValueClassNameFilter == null ||\n                 sessionAttributeValueClassNameFilter.length() == 0) {\n             sessionAttributeValueClassNamePattern = null;\n+        } else {\n+            sessionAttributeValueClassNamePattern =\n+                    Pattern.compile(sessionAttributeValueClassNameFilter);\n         }\n-        sessionAttributeValueClassNamePattern =\n-                Pattern.compile(sessionAttributeValueClassNameFilter);\n     }\n \n ",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/bd204ebca1660fc13dff557399ae5f0afd64ed67/java/org/apache/catalina/session/ManagerBase.java",
                "status": "modified",
                "changes": 8,
                "deletions": 3,
                "sha": "95ea4805eaef6bb5a02ddf1c08f776bb80d1290c",
                "blob_url": "https://github.com/apache/tomcat80/blob/bd204ebca1660fc13dff557399ae5f0afd64ed67/java/org/apache/catalina/session/ManagerBase.java",
                "filename": "java/org/apache/catalina/session/ManagerBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/session/ManagerBase.java?ref=bd204ebca1660fc13dff557399ae5f0afd64ed67"
            }
        ],
        "bug_id": "tomcat80_78",
        "parent": "https://github.com/apache/tomcat80/commit/5e04f73a023729424fc624da0cf32b2da6cd2304",
        "message": "Fix NPE when sessionAttributeNameFilter and sessionAttributeValueClassNameFilter is unset in cluster environment.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1726576 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/659fff8236b3cc70f76dd10f3fcc3a4afc8f93fa",
        "file": [
            {
                "patch": "@@ -234,7 +234,9 @@ void startMessageBlock(byte opCode, ByteBuffer payload, boolean last)\n             } else {\n                 f2sh.get(timeout, TimeUnit.MILLISECONDS);\n             }\n-            payload.clear();\n+            if (payload != null) {\n+                payload.clear();\n+            }\n         } catch (InterruptedException | ExecutionException |\n                 TimeoutException e) {\n             throw new IOException(e);",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/659fff8236b3cc70f76dd10f3fcc3a4afc8f93fa/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "status": "modified",
                "changes": 4,
                "deletions": 1,
                "sha": "29cc2403629bbb6f675a1d0bba0afdd8d7c3b747",
                "blob_url": "https://github.com/apache/tomcat80/blob/659fff8236b3cc70f76dd10f3fcc3a4afc8f93fa/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "filename": "java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java?ref=659fff8236b3cc70f76dd10f3fcc3a4afc8f93fa"
            },
            {
                "patch": "@@ -116,6 +116,9 @@\n         Avoid a possible deadlock when one thread is shutting down a connection\n         while another thread is trying to write to it. (markt)\n       </fix>\n+      <fix>\n+        Avoid NPE when flushing batched messages. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Web Applications\">",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/659fff8236b3cc70f76dd10f3fcc3a4afc8f93fa/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "409aafcf1032ee0a9feec107c6ee928f6ab10e9a",
                "blob_url": "https://github.com/apache/tomcat80/blob/659fff8236b3cc70f76dd10f3fcc3a4afc8f93fa/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=659fff8236b3cc70f76dd10f3fcc3a4afc8f93fa"
            }
        ],
        "bug_id": "tomcat80_79",
        "parent": "https://github.com/apache/tomcat80/commit/bccdb8b7701f2073e2262731ff10528a117b14d7",
        "message": "FindBugs: Avoid NPE when flushing batched WebSocket messages.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1574493 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/ebf39fcf413d14dbb16bb9128dd4d971cf7d497f",
        "file": [
            {
                "patch": "@@ -20,9 +20,7 @@\n \n import javax.servlet.ServletException;\n \n-import org.apache.catalina.Container;\n-import org.apache.catalina.Engine;\n-import org.apache.catalina.Host;\n+import org.apache.catalina.Cluster;\n import org.apache.catalina.LifecycleException;\n import org.apache.catalina.Manager;\n import org.apache.catalina.Session;\n@@ -380,24 +378,9 @@ protected void changeRequestSessionID(Request request, String sessionId, String\n     protected synchronized void startInternal() throws LifecycleException {\n \n         if (cluster == null) {\n-            Container hostContainer = getContainer();\n-            // compatibility with JvmRouteBinderValve version 1.1\n-            // ( setup at context.xml or context.xml.default )\n-            if (!(hostContainer instanceof Host)) {\n-                if (log.isWarnEnabled()) {\n-                    log.warn(sm.getString(\"jvmRoute.configure.warn\"));\n-                }\n-                hostContainer = hostContainer.getParent();\n-            }\n-            if (hostContainer instanceof Host\n-                    && ((Host) hostContainer).getCluster() != null) {\n-                cluster = (CatalinaCluster) ((Host) hostContainer).getCluster();\n-            } else {\n-                Container engine = hostContainer.getParent() ;\n-                if (engine instanceof Engine\n-                        && ((Engine) engine).getCluster() != null) {\n-                    cluster = (CatalinaCluster) ((Engine) engine).getCluster();\n-                }\n+            Cluster containerCluster = getContainer().getCluster();\n+            if (containerCluster instanceof CatalinaCluster) {\n+                setCluster((CatalinaCluster)containerCluster);\n             }\n         }\n ",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/ebf39fcf413d14dbb16bb9128dd4d971cf7d497f/java/org/apache/catalina/ha/session/JvmRouteBinderValve.java",
                "status": "modified",
                "changes": 25,
                "deletions": 21,
                "sha": "b52f1d27512e5189212745a4a1f78d1e0adcc212",
                "blob_url": "https://github.com/apache/tomcat80/blob/ebf39fcf413d14dbb16bb9128dd4d971cf7d497f/java/org/apache/catalina/ha/session/JvmRouteBinderValve.java",
                "filename": "java/org/apache/catalina/ha/session/JvmRouteBinderValve.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/ha/session/JvmRouteBinderValve.java?ref=ebf39fcf413d14dbb16bb9128dd4d971cf7d497f"
            },
            {
                "patch": "@@ -140,6 +140,11 @@\n         set to <code>true</code>, ensure that the heartbeat thread does not\n         start. (kfujino)\n       </fix>\n+      <scode>\n+        Simplify the code of <code>JvmRouteBinderValve.startInternal()</code>.\n+        Avoid potential NPE when <code>JvmRouteBinderValve</code> is configured\n+        directly at <code>Engine</code> element. (kfujino)\n+      </scode>\n     </changelog>\n   </subsection>\n   <subsection name=\"WebSocket\">",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/ebf39fcf413d14dbb16bb9128dd4d971cf7d497f/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "1a0b1bb21581cb433a30c86c9c2ba9e68d9fd796",
                "blob_url": "https://github.com/apache/tomcat80/blob/ebf39fcf413d14dbb16bb9128dd4d971cf7d497f/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=ebf39fcf413d14dbb16bb9128dd4d971cf7d497f"
            }
        ],
        "bug_id": "tomcat80_80",
        "parent": "https://github.com/apache/tomcat80/commit/c79b558abc7438280a166a0fca32488996bb90a3",
        "message": "Simplify the code of JvmRouteBinderValve.startInternal().\nAvoid potential NPE when JvmRouteBinderValve is configured directly at Engine element.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1724367 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/29aa2849e35b29cf2334aeeb984c330287b3c737",
        "file": [
            {
                "patch": "@@ -24,6 +24,7 @@\n import org.apache.catalina.Wrapper;\n import org.apache.catalina.startup.Tomcat;\n import org.apache.catalina.startup.TomcatBaseTest;\n+import org.apache.jasper.servlet.JasperInitializer;\n \n \n public class TestDefaultInstanceManager extends TomcatBaseTest {\n@@ -73,6 +74,8 @@ private DefaultInstanceManager doClassUnloadingPrep() throws Exception {\n         StandardContext ctxt = (StandardContext) tomcat.addContext(\n                 null, \"/test\", appDir.getAbsolutePath());\n \n+        ctxt.addServletContainerInitializer(new JasperInitializer(), null);\n+\n         // Configure the defaults and then tweak the JSP servlet settings\n         // Note: Min value for maxLoadedJsps is 2\n         Tomcat.initWebappDefaults(ctxt);",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/29aa2849e35b29cf2334aeeb984c330287b3c737/test/org/apache/catalina/core/TestDefaultInstanceManager.java",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "c5c37b6376fec08c89c58bcf49f21cfec0c3cefc",
                "blob_url": "https://github.com/apache/tomcat80/blob/29aa2849e35b29cf2334aeeb984c330287b3c737/test/org/apache/catalina/core/TestDefaultInstanceManager.java",
                "filename": "test/org/apache/catalina/core/TestDefaultInstanceManager.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/core/TestDefaultInstanceManager.java?ref=29aa2849e35b29cf2334aeeb984c330287b3c737"
            }
        ],
        "bug_id": "tomcat80_81",
        "parent": "https://github.com/apache/tomcat80/commit/6b9081da8a4dca82c749cbeaae9e035e72c55714",
        "message": "Fix NPEs in test\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1553605 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/e775419f0bdf7b226d2af1f3b5d3622d9ec619d4",
        "file": [
            {
                "patch": "@@ -451,6 +451,9 @@ ExecutorService getExecutorService() {\n \n \n     void shutdownExecutor() {\n+        if (executorService == null) {\n+            return;\n+        }\n         executorService.shutdown();\n         try {\n             executorService.awaitTermination(10, TimeUnit.SECONDS);",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/e775419f0bdf7b226d2af1f3b5d3622d9ec619d4/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "ff3f636e01b3284957340c2bf860662b9b218f11",
                "blob_url": "https://github.com/apache/tomcat80/blob/e775419f0bdf7b226d2af1f3b5d3622d9ec619d4/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "filename": "java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/server/WsServerContainer.java?ref=e775419f0bdf7b226d2af1f3b5d3622d9ec619d4"
            }
        ],
        "bug_id": "tomcat80_82",
        "parent": "https://github.com/apache/tomcat80/commit/779c15f2cd38624b1086e1a562d0f9a0e51059c5",
        "message": "Avoid NPE on shutdown if application doesn't use WebSocket\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1551481 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/66cbdeaa71d345aa35c776e9c08921b2929efbc2",
        "file": [
            {
                "patch": "@@ -403,7 +403,10 @@ private void registerAuthenticatedSession(WsSession wsSession,\n     private void unregisterAuthenticatedSession(WsSession wsSession,\n             String httpSessionId) {\n         Set<WsSession> wsSessions = authenticatedSessions.get(httpSessionId);\n-        wsSessions.remove(wsSession);\n+        // wsSessions will be null if the HTTP session has ended\n+        if (wsSessions != null) {\n+            wsSessions.remove(wsSession);\n+        }\n     }\n \n ",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/66cbdeaa71d345aa35c776e9c08921b2929efbc2/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "status": "modified",
                "changes": 5,
                "deletions": 1,
                "sha": "4f196825dcd3b43783345bbaf7b851cf60b86bc2",
                "blob_url": "https://github.com/apache/tomcat80/blob/66cbdeaa71d345aa35c776e9c08921b2929efbc2/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "filename": "java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/server/WsServerContainer.java?ref=66cbdeaa71d345aa35c776e9c08921b2929efbc2"
            }
        ],
        "bug_id": "tomcat80_83",
        "parent": "https://github.com/apache/tomcat80/commit/9b33cb8ad7d2e9c60a51234db274321f15d9ef1c",
        "message": "Fix NPE reported on users list when HTTP session ends\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1546372 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/89751070d7066131b84fc57adaf4aa6c0aae237b",
        "file": [
            {
                "patch": "@@ -25,6 +25,7 @@\n import javax.servlet.ReadListener;\n import javax.servlet.RequestDispatcher;\n import javax.servlet.SessionTrackingMode;\n+import javax.servlet.WriteListener;\n import javax.servlet.http.HttpServletResponse;\n \n import org.apache.catalina.Context;\n@@ -313,14 +314,15 @@ public boolean asyncDispatch(org.apache.coyote.Request req,\n                 Throwable t = (Throwable)req.getAttribute(\n                         RequestDispatcher.ERROR_EXCEPTION);\n                 req.getAttributes().remove(RequestDispatcher.ERROR_EXCEPTION);\n-                if (req.getReadListener() != null) {\n+                ReadListener readListener = req.getReadListener();\n+                if (readListener != null) {\n                     ClassLoader oldCL =\n                             Thread.currentThread().getContextClassLoader();\n                     ClassLoader newCL =\n                             request.getContext().getLoader().getClassLoader();\n                     try {\n                         Thread.currentThread().setContextClassLoader(newCL);\n-                        req.getReadListener().onError(t);\n+                        readListener.onError(t);\n                     } finally {\n                         Thread.currentThread().setContextClassLoader(oldCL);\n                     }\n@@ -355,41 +357,42 @@ public boolean asyncDispatch(org.apache.coyote.Request req,\n \n             // Check to see if non-blocking writes or reads are being used\n             if (!request.isAsyncDispatching() && request.isAsync()) {\n-                if (res.getWriteListener() != null &&\n-                        status == SocketStatus.OPEN_WRITE) {\n+                WriteListener writeListener = res.getWriteListener();\n+                ReadListener readListener = req.getReadListener();\n+                if (writeListener != null && status == SocketStatus.OPEN_WRITE) {\n                     ClassLoader oldCL =\n                             Thread.currentThread().getContextClassLoader();\n                     ClassLoader newCL =\n                             request.getContext().getLoader().getClassLoader();\n                     try {\n                         Thread.currentThread().setContextClassLoader(newCL);\n                         res.onWritePossible();\n-                        if (request.isFinished() && req.sendAllDataReadEvent()) {\n-                            req.getReadListener().onAllDataRead();\n+                        if (request.isFinished() && req.sendAllDataReadEvent() &&\n+                                readListener != null) {\n+                            readListener.onAllDataRead();\n                         }\n                     } catch (Throwable t) {\n                         ExceptionUtils.handleThrowable(t);\n-                        res.getWriteListener().onError(t);\n+                        writeListener.onError(t);\n                         throw t;\n                     } finally {\n                         Thread.currentThread().setContextClassLoader(oldCL);\n                     }\n                     success = true;\n-                } else if (req.getReadListener() != null &&\n-                        status == SocketStatus.OPEN_READ) {\n+                } else if (readListener != null && status == SocketStatus.OPEN_READ) {\n                     ClassLoader oldCL =\n                             Thread.currentThread().getContextClassLoader();\n                     ClassLoader newCL =\n                             request.getContext().getLoader().getClassLoader();\n                     try {\n                         Thread.currentThread().setContextClassLoader(newCL);\n-                        req.getReadListener().onDataAvailable();\n+                        readListener.onDataAvailable();\n                         if (request.isFinished() && req.sendAllDataReadEvent()) {\n-                            req.getReadListener().onAllDataRead();\n+                            readListener.onAllDataRead();\n                         }\n                     } catch (Throwable t) {\n                         ExceptionUtils.handleThrowable(t);\n-                        req.getReadListener().onError(t);\n+                        readListener.onError(t);\n                         throw t;\n                     } finally {\n                         Thread.currentThread().setContextClassLoader(oldCL);",
                "additions": 15,
                "raw_url": "https://github.com/apache/tomcat80/raw/89751070d7066131b84fc57adaf4aa6c0aae237b/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "status": "modified",
                "changes": 27,
                "deletions": 12,
                "sha": "c59b5ffdbf48fdcef108e76cf5bda99fe3ead964",
                "blob_url": "https://github.com/apache/tomcat80/blob/89751070d7066131b84fc57adaf4aa6c0aae237b/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "filename": "java/org/apache/catalina/connector/CoyoteAdapter.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/CoyoteAdapter.java?ref=89751070d7066131b84fc57adaf4aa6c0aae237b"
            }
        ],
        "bug_id": "tomcat80_84",
        "parent": "https://github.com/apache/tomcat80/commit/0e4aa717854539253ed67b4818fb86015a787ab6",
        "message": "Avoid NPEs if asyncContext is completed by listener\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1545801 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/890dbaf7828696dbc697d087bdfcb9dbed404345",
        "file": [
            {
                "patch": "@@ -480,7 +480,7 @@ public void handleDrawMessage(DrawMessage msg, long msgId) {\n          */\n         private void sendRoomMessage(MessageType type, String content) {\n             if (content == null || type == null)\n-                throw null;\n+                throw new NullPointerException();\n \n             String completeMsg = String.valueOf(type.flag) + content;\n ",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/890dbaf7828696dbc697d087bdfcb9dbed404345/webapps/examples/WEB-INF/classes/websocket/drawboard/Room.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "0aab7ecd0529d07363dac9c2611907dbcac04414",
                "blob_url": "https://github.com/apache/tomcat80/blob/890dbaf7828696dbc697d087bdfcb9dbed404345/webapps/examples/WEB-INF/classes/websocket/drawboard/Room.java",
                "filename": "webapps/examples/WEB-INF/classes/websocket/drawboard/Room.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/examples/WEB-INF/classes/websocket/drawboard/Room.java?ref=890dbaf7828696dbc697d087bdfcb9dbed404345"
            }
        ],
        "bug_id": "tomcat80_85",
        "parent": "https://github.com/apache/tomcat80/commit/140a1ac185dea4952da91a16d32f989d2048aeae",
        "message": "Fix a FindBugs warning.\nThrow NPE rather than triggering one.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1542841 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/55708b5d1b5a221321b75d6a82866564fcb186af",
        "file": [
            {
                "patch": "@@ -170,8 +170,12 @@ public String getName() {\n     public long getContentLength() {\n         Long cachedContentLength = this.cachedContentLength;\n         if (cachedContentLength == null) {\n-            cachedContentLength = Long.valueOf(webResource.getContentLength());\n-            this.cachedContentLength = cachedContentLength;\n+            long result = 0;\n+            if (webResource != null) {\n+                cachedContentLength = Long.valueOf(webResource.getContentLength());\n+                this.cachedContentLength = cachedContentLength;\n+            }\n+            return result;\n         }\n         return cachedContentLength.longValue();\n     }",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/55708b5d1b5a221321b75d6a82866564fcb186af/java/org/apache/catalina/webresources/CachedResource.java",
                "status": "modified",
                "changes": 8,
                "deletions": 2,
                "sha": "c98df7235fa85e916764f4320b357cacebafb383",
                "blob_url": "https://github.com/apache/tomcat80/blob/55708b5d1b5a221321b75d6a82866564fcb186af/java/org/apache/catalina/webresources/CachedResource.java",
                "filename": "java/org/apache/catalina/webresources/CachedResource.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/webresources/CachedResource.java?ref=55708b5d1b5a221321b75d6a82866564fcb186af"
            }
        ],
        "bug_id": "tomcat80_86",
        "parent": "https://github.com/apache/tomcat80/commit/d4365ae10bc4f7bc1eb7453fd31d2bca36b19fdb",
        "message": "Protect against possible NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1539872 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/1892b21efea8db605aa0c2279381fce1b5aacf7c",
        "file": [
            {
                "patch": "@@ -905,7 +905,10 @@ private void destroySocket(long socket) {\n         // countDownConnection(). Once the connector is stopped, the latch is\n         // removed so it does not matter that destroySocket() does not call\n         // countDownConnection() in that case\n-        poller.removeFromPoller(socket);\n+        Poller poller = this.poller;\n+        if (poller != null) {\n+            poller.removeFromPoller(socket);\n+        }\n         connections.remove(Long.valueOf(socket));\n         destroySocket(socket, running);\n     }",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/1892b21efea8db605aa0c2279381fce1b5aacf7c/java/org/apache/tomcat/util/net/AprEndpoint.java",
                "status": "modified",
                "changes": 5,
                "deletions": 1,
                "sha": "473e0233b44b9cb8ec40943b9b1a81928e79d382",
                "blob_url": "https://github.com/apache/tomcat80/blob/1892b21efea8db605aa0c2279381fce1b5aacf7c/java/org/apache/tomcat/util/net/AprEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/AprEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/AprEndpoint.java?ref=1892b21efea8db605aa0c2279381fce1b5aacf7c"
            }
        ],
        "bug_id": "tomcat80_87",
        "parent": "https://github.com/apache/tomcat80/commit/5488b86fbcb6226fee1be1ae1358697dfeb18745",
        "message": "Avoid possible NPE during shutdown.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1523788 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/07522d67922429dd8827eaea8d0b1cf2e10be3c8",
        "file": [
            {
                "patch": "@@ -618,6 +618,9 @@ public SocketState process(SocketWrapper<S> wrapper,\n                 SocketState state = SocketState.CLOSED;\n                 do {\n                     if (wrapper.hasNextDispatch()) {\n+                        // Associate with the processor with the connection as\n+                        // these calls may result in a nested call to process()\n+                        connections.put(socket, processor);\n                         DispatchType nextDispatch = wrapper.getNextDispatch();\n                         state = processor.asyncDispatch(\n                                 nextDispatch.getSocketStatus());",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/07522d67922429dd8827eaea8d0b1cf2e10be3c8/java/org/apache/coyote/AbstractProtocol.java",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "a66d48d1149639842cb966dc6bcd240ecb68875e",
                "blob_url": "https://github.com/apache/tomcat80/blob/07522d67922429dd8827eaea8d0b1cf2e10be3c8/java/org/apache/coyote/AbstractProtocol.java",
                "filename": "java/org/apache/coyote/AbstractProtocol.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/AbstractProtocol.java?ref=07522d67922429dd8827eaea8d0b1cf2e10be3c8"
            }
        ],
        "bug_id": "tomcat80_88",
        "parent": "https://github.com/apache/tomcat80/commit/091e50b90709aa261bf03c3c6a7d52d196445b7f",
        "message": "Prevent NPE if dispatch results in a nested call to process()\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1519501 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/3919ff0921cc33530961d386d9953e3f84851bd1",
        "file": [
            {
                "patch": "@@ -191,7 +191,9 @@ private static String getThreadName(int logRecordThreadId) {\n             }\n             ThreadInfo threadInfo =\n                     threadMxBean.getThreadInfo(logRecordThreadId);\n-            result = threadInfo.getThreadName();\n+            if (threadInfo == null) {\n+                return Long.toString(logRecordThreadId);\n+            }\n         }\n \n         cache.put(Integer.valueOf(logRecordThreadId), result);",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/3919ff0921cc33530961d386d9953e3f84851bd1/java/org/apache/juli/OneLineFormatter.java",
                "status": "modified",
                "changes": 4,
                "deletions": 1,
                "sha": "53fbe57e0060948319d21a73b3df741705dcb3f2",
                "blob_url": "https://github.com/apache/tomcat80/blob/3919ff0921cc33530961d386d9953e3f84851bd1/java/org/apache/juli/OneLineFormatter.java",
                "filename": "java/org/apache/juli/OneLineFormatter.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/juli/OneLineFormatter.java?ref=3919ff0921cc33530961d386d9953e3f84851bd1"
            }
        ],
        "bug_id": "tomcat80_89",
        "parent": "https://github.com/apache/tomcat80/commit/306f905755d8efa0910610176b5f4d89eeff98f3",
        "message": "Fix NPE observed in testing logs\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1516416 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/2d0ae1427811833638ea6fcd757b2dac1696694f",
        "file": [
            {
                "patch": "@@ -374,6 +374,10 @@ public static void main(String[] args) throws Exception {\n         FileMessageFactory write = getInstance(new File(args[1]), true);\n         FileMessage msg = new FileMessage(null, args[0], args[0]);\n         msg = read.readMessage(msg);\n+        if (msg == null) {\n+            System.out.println(\"Empty input file : \" + args[0]);\n+            return;\n+        }\n         System.out.println(\"Expecting to write \" + msg.getTotalNrOfMsgs()\n                 + \" messages.\");\n         int cnt = 0;",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/2d0ae1427811833638ea6fcd757b2dac1696694f/java/org/apache/catalina/ha/deploy/FileMessageFactory.java",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "36eb7152d38ad7150a6f6b823425fd84f07b3dce",
                "blob_url": "https://github.com/apache/tomcat80/blob/2d0ae1427811833638ea6fcd757b2dac1696694f/java/org/apache/catalina/ha/deploy/FileMessageFactory.java",
                "filename": "java/org/apache/catalina/ha/deploy/FileMessageFactory.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/ha/deploy/FileMessageFactory.java?ref=2d0ae1427811833638ea6fcd757b2dac1696694f"
            }
        ],
        "bug_id": "tomcat80_90",
        "parent": "https://github.com/apache/tomcat80/commit/0584473dda252cb2ba5da20d7056093faf9db75f",
        "message": "Fix NPE in FileMessageFactory.main when specify empty file as arguments.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1509134 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/8f94be66bc2411cbe400d0e8003b8961456eba89",
        "file": [
            {
                "patch": "@@ -409,13 +409,13 @@ protected void deployApps() {\n      * Filter the list of application file paths to remove those that match\n      * the regular expression defined by {@link Host#getDeployIgnore()}.\n      *\n-     * @param unfilteredAppPaths    The list of application paths to filtert\n+     * @param unfilteredAppPaths    The list of application paths to filter\n      *\n      * @return  The filtered list of application paths\n      */\n     protected String[] filterAppPaths(String[] unfilteredAppPaths) {\n         Pattern filter = host.getDeployIgnorePattern();\n-        if (filter == null) {\n+        if (filter == null || unfilteredAppPaths == null) {\n             return unfilteredAppPaths;\n         }\n ",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/8f94be66bc2411cbe400d0e8003b8961456eba89/java/org/apache/catalina/startup/HostConfig.java",
                "status": "modified",
                "changes": 4,
                "deletions": 2,
                "sha": "354eebc8ccf7f1e5ffbcf2fc605b3e32db35699f",
                "blob_url": "https://github.com/apache/tomcat80/blob/8f94be66bc2411cbe400d0e8003b8961456eba89/java/org/apache/catalina/startup/HostConfig.java",
                "filename": "java/org/apache/catalina/startup/HostConfig.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/startup/HostConfig.java?ref=8f94be66bc2411cbe400d0e8003b8961456eba89"
            },
            {
                "patch": "@@ -66,6 +66,10 @@\n         that moved the redirection for context roots from the Mapper to the\n         Default Servlet. (markt)\n       </fix>\n+      <fix>\n+        Fixed potential NPE in <code>HostConfig</code> while deploying an\n+        application. Issue reported by coverity scan. (violetagg)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/8f94be66bc2411cbe400d0e8003b8961456eba89/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "e461e03237281bd9fd34aeb8a23503b142db015d",
                "blob_url": "https://github.com/apache/tomcat80/blob/8f94be66bc2411cbe400d0e8003b8961456eba89/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=8f94be66bc2411cbe400d0e8003b8961456eba89"
            }
        ],
        "bug_id": "tomcat80_91",
        "parent": "https://github.com/apache/tomcat80/commit/5c389122048ad609d8fd3c924196811faafc959a",
        "message": "Merged revision 1717264 from tomcat/trunk:\nFixed potential NPE in HostConfig while deploying an application. Issue reported by coverity scan.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1717267 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/41442daa8a3992aa76b3c979c70ff2ee737b30ab",
        "file": [
            {
                "patch": "@@ -149,12 +149,14 @@ public int getSize() throws IOException {\n \n         // Figure out which files are sessions\n         int keycount = 0;\n-        for (int i = 0; i < files.length; i++) {\n-            if (files[i].endsWith(FILE_EXT)) {\n-                keycount++;\n+        if (files != null) {\n+            for (int i = 0; i < files.length; i++) {\n+                if (files[i].endsWith(FILE_EXT)) {\n+                    keycount++;\n+                }\n             }\n         }\n-        return (keycount);\n+        return keycount;\n \n     }\n ",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/41442daa8a3992aa76b3c979c70ff2ee737b30ab/java/org/apache/catalina/session/FileStore.java",
                "status": "modified",
                "changes": 10,
                "deletions": 4,
                "sha": "43f903b5688993c47c236349609b9a50d147f15e",
                "blob_url": "https://github.com/apache/tomcat80/blob/41442daa8a3992aa76b3c979c70ff2ee737b30ab/java/org/apache/catalina/session/FileStore.java",
                "filename": "java/org/apache/catalina/session/FileStore.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/session/FileStore.java?ref=41442daa8a3992aa76b3c979c70ff2ee737b30ab"
            }
        ],
        "bug_id": "tomcat80_92",
        "parent": "https://github.com/apache/tomcat80/commit/5353c75abedc72cbf99c903e7df5fd11bb7974c8",
        "message": "Merged revision 1716640 from tomcat/trunk:\nFix potential NPE reported by FindBugs\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1717106 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/3cdd2091fcaf564092f4b0fb3f70f9f5d409513a",
        "file": [
            {
                "patch": "@@ -875,6 +875,7 @@ private void registerMember(Member member) {\n     }\n \n     private void unregisterMember(Member member) {\n+        if (member == null) return;\n         ObjectName oname = memberOnameMap.remove(member);\n         if (oname != null) {\n             unregister(oname);",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/3cdd2091fcaf564092f4b0fb3f70f9f5d409513a/java/org/apache/catalina/ha/tcp/SimpleTcpCluster.java",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "0efd660a9eb327a053d406602a5473c3ef33b7ad",
                "blob_url": "https://github.com/apache/tomcat80/blob/3cdd2091fcaf564092f4b0fb3f70f9f5d409513a/java/org/apache/catalina/ha/tcp/SimpleTcpCluster.java",
                "filename": "java/org/apache/catalina/ha/tcp/SimpleTcpCluster.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/ha/tcp/SimpleTcpCluster.java?ref=3cdd2091fcaf564092f4b0fb3f70f9f5d409513a"
            }
        ],
        "bug_id": "tomcat80_93",
        "parent": "https://github.com/apache/tomcat80/commit/113b471e05c7859de82f16c91584713365523092",
        "message": "Avoid NPE. If the channel fails to start, localMember is null.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1505637 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/18f315750c375c12f1a75d55f867d39ddb9ade57",
        "file": [
            {
                "patch": "@@ -375,7 +375,7 @@ public MessageHandlerInfo(Method m, List<DecoderEntry> decoderEntries) {\n                                 m.getName(), m.getDeclaringClass().getName()));\n                     }\n                 } else {\n-                    if (decoderMatch != null || decoderMatch.hasMatches()) {\n+                    if (decoderMatch != null && decoderMatch.hasMatches()) {\n                         throw new IllegalArgumentException(sm.getString(\n                                 \"pojoMethodMapping.duplicateMessageParam\",\n                                 m.getName(), m.getDeclaringClass().getName()));",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/18f315750c375c12f1a75d55f867d39ddb9ade57/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "6729ff22c7c902819b4fcad35e686cb9cf952c4d",
                "blob_url": "https://github.com/apache/tomcat80/blob/18f315750c375c12f1a75d55f867d39ddb9ade57/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "filename": "java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java?ref=18f315750c375c12f1a75d55f867d39ddb9ade57"
            }
        ],
        "bug_id": "tomcat80_94",
        "parent": "https://github.com/apache/tomcat80/commit/a67468d744261b0b635b46ec5bd91237efa423ac",
        "message": "Fix logic error that triggered an NPE and associated test failures\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1497308 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/08ec16b1f5deb54d0c8bfc965d079bd3bf50b071",
        "file": [
            {
                "patch": "@@ -1600,9 +1600,12 @@ public void run() {\n                                         info.socket);\n                             }\n                             timeouts.remove(info.socket);\n+                            AprSocketWrapper wrapper = connections.get(\n+                                    Long.valueOf(info.socket));\n+                            if (wrapper == null) {\n+                                continue;\n+                            }\n                             if (info.read() || info.write()) {\n-                                AprSocketWrapper wrapper = connections.get(\n-                                        Long.valueOf(info.socket));\n                                 boolean comet = wrapper.isComet();\n                                 if (comet || wrapper.pollerFlags != 0) {\n                                     removeFromPoller(info.socket);",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/08ec16b1f5deb54d0c8bfc965d079bd3bf50b071/java/org/apache/tomcat/util/net/AprEndpoint.java",
                "status": "modified",
                "changes": 7,
                "deletions": 2,
                "sha": "c5dc5caefc35d4d579e989ecdad54cebbad9da79",
                "blob_url": "https://github.com/apache/tomcat80/blob/08ec16b1f5deb54d0c8bfc965d079bd3bf50b071/java/org/apache/tomcat/util/net/AprEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/AprEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/AprEndpoint.java?ref=08ec16b1f5deb54d0c8bfc965d079bd3bf50b071"
            }
        ],
        "bug_id": "tomcat80_95",
        "parent": "https://github.com/apache/tomcat80/commit/0a3cf7642ded410c5b46327d8d4ebad0764960dc",
        "message": "Add some NPE protection\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1485847 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/0a3cf7642ded410c5b46327d8d4ebad0764960dc",
        "file": [
            {
                "patch": "@@ -35,6 +35,7 @@\n \n import org.junit.Test;\n \n+import org.apache.catalina.Context;\n import org.apache.catalina.startup.Tomcat;\n import org.apache.catalina.startup.TomcatBaseTest;\n import org.apache.tomcat.util.buf.ByteChunk;\n@@ -167,7 +168,9 @@ public void testRenegotiateWorks() throws Exception {\n \n         File appDir = new File(getBuildDirectory(), \"webapps/examples\");\n         // app dir is relative to server home\n-        tomcat.addWebapp(null, \"/examples\", appDir.getAbsolutePath());\n+        Context ctx = tomcat.addWebapp(null, \"/examples\",\n+                appDir.getAbsolutePath());\n+        ctx.addApplicationListener(WsListener.class.getName());\n \n         TesterSupport.initSsl(tomcat);\n ",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/0a3cf7642ded410c5b46327d8d4ebad0764960dc/test/org/apache/tomcat/util/net/TestSsl.java",
                "status": "modified",
                "changes": 5,
                "deletions": 1,
                "sha": "651b178e8dc4066bb80c6b2bc1c56d7c0a4b5e65",
                "blob_url": "https://github.com/apache/tomcat80/blob/0a3cf7642ded410c5b46327d8d4ebad0764960dc/test/org/apache/tomcat/util/net/TestSsl.java",
                "filename": "test/org/apache/tomcat/util/net/TestSsl.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/tomcat/util/net/TestSsl.java?ref=0a3cf7642ded410c5b46327d8d4ebad0764960dc"
            }
        ],
        "bug_id": "tomcat80_96",
        "parent": "https://github.com/apache/tomcat80/commit/cee3cf2488a977536a765b0118220685cce1ae43",
        "message": "Correctly init WebSocket to avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1485833 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/c267e9bcf0c14e4fa95d2c3aac793a3db5090e55",
        "file": [
            {
                "patch": "@@ -5755,7 +5755,7 @@ protected ClassLoader bindThread() {\n         ClassLoader oldContextClassLoader =\n             Thread.currentThread().getContextClassLoader();\n \n-        if (getLoader().getClassLoader() != null) {\n+        if (getLoader() != null && getLoader().getClassLoader() != null) {\n             Thread.currentThread().setContextClassLoader\n                 (getLoader().getClassLoader());\n         }",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/c267e9bcf0c14e4fa95d2c3aac793a3db5090e55/java/org/apache/catalina/core/StandardContext.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "ceee4af447aa6a75bcc2e909e76eeb75f3a3ee05",
                "blob_url": "https://github.com/apache/tomcat80/blob/c267e9bcf0c14e4fa95d2c3aac793a3db5090e55/java/org/apache/catalina/core/StandardContext.java",
                "filename": "java/org/apache/catalina/core/StandardContext.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/StandardContext.java?ref=c267e9bcf0c14e4fa95d2c3aac793a3db5090e55"
            },
            {
                "patch": "@@ -486,7 +486,9 @@ protected void stopInternal() throws LifecycleException {\n             }\n         }\n \n-        main.destroy();\n+        if (main != null) {\n+            main.destroy();\n+        }\n         mainResources.clear();\n \n         for (WebResourceSet webResourceSet : jarResources) {",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/c267e9bcf0c14e4fa95d2c3aac793a3db5090e55/java/org/apache/catalina/webresources/StandardRoot.java",
                "status": "modified",
                "changes": 4,
                "deletions": 1,
                "sha": "047783c0be32542cb60f028a39d3fa5deec040b4",
                "blob_url": "https://github.com/apache/tomcat80/blob/c267e9bcf0c14e4fa95d2c3aac793a3db5090e55/java/org/apache/catalina/webresources/StandardRoot.java",
                "filename": "java/org/apache/catalina/webresources/StandardRoot.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/webresources/StandardRoot.java?ref=c267e9bcf0c14e4fa95d2c3aac793a3db5090e55"
            }
        ],
        "bug_id": "tomcat80_97",
        "parent": "https://github.com/apache/tomcat80/commit/d6c14fd6bad608a68bc9cff712ee17a5359d86c1",
        "message": "Avoid NPEs when attempting to destroy contexts that failed to start.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1482602 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/075eea914134cf3ced3fcd3f34b861151f5a8c08",
        "file": [
            {
                "patch": "@@ -789,6 +789,10 @@ protected void init(SocketWrapper<NioChannel> socketWrapper,\n             AbstractEndpoint endpoint) throws IOException {\n \n         socket = socketWrapper.getSocket();\n+        if (socket == null) {\n+            // Socket has been closed in another thread\n+            throw new IOException(sm.getString(\"iib.socketClosed\"));\n+        }\n         socketReadBufferSize =\n             socket.getBufHandler().getReadBuffer().capacity();\n ",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/075eea914134cf3ced3fcd3f34b861151f5a8c08/java/org/apache/coyote/http11/InternalNioInputBuffer.java",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "2d0eacd9e367f765f1433b8883a77b94a79c632e",
                "blob_url": "https://github.com/apache/tomcat80/blob/075eea914134cf3ced3fcd3f34b861151f5a8c08/java/org/apache/coyote/http11/InternalNioInputBuffer.java",
                "filename": "java/org/apache/coyote/http11/InternalNioInputBuffer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/http11/InternalNioInputBuffer.java?ref=075eea914134cf3ced3fcd3f34b861151f5a8c08"
            },
            {
                "patch": "@@ -30,5 +30,6 @@ iib.invalidheader=The HTTP header line [{0}] does not conform to RFC 2616 and ha\n iib.invalidmethod=Invalid character (CR or LF) found in method name\n iib.parseheaders.ise.error=Unexpected state: headers already parsed. Buffer not recycled?\n iib.requestheadertoolarge.error=Request header is too large\n+iib.socketClosed=The socket has been closed in another thread\n \n iob.responseheadertoolarge.error=An attempt was made to write more data to the response headers than there was room available in the buffer. Increase maxHttpHeaderSize on the connector or write less data into the response headers.",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/075eea914134cf3ced3fcd3f34b861151f5a8c08/java/org/apache/coyote/http11/LocalStrings.properties",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "3e06e144e8a3ddb2b756c169bc9209a75ca933e9",
                "blob_url": "https://github.com/apache/tomcat80/blob/075eea914134cf3ced3fcd3f34b861151f5a8c08/java/org/apache/coyote/http11/LocalStrings.properties",
                "filename": "java/org/apache/coyote/http11/LocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/http11/LocalStrings.properties?ref=075eea914134cf3ced3fcd3f34b861151f5a8c08"
            }
        ],
        "bug_id": "tomcat80_98",
        "parent": "https://github.com/apache/tomcat80/commit/dcf64617fcfa881b73869febd54f41317352d135",
        "message": "Another NPE in the WebSocket tests.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1476177 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/93c69fe8b6a3e61e3eaa58674321446e9a727eb4",
        "file": [
            {
                "patch": "@@ -582,11 +582,16 @@ public void recycle() {\n         public SocketState process(SocketWrapper<S> wrapper,\n                 SocketStatus status) {\n             S socket = wrapper.getSocket();\n-            Processor<S> processor = connections.get(socket);\n \n+            if (socket == null) {\n+                // Nothing to do. Socket has been closed.\n+                return SocketState.CLOSED;\n+            }\n+\n+            Processor<S> processor = connections.get(socket);\n             if (status == SocketStatus.DISCONNECT && processor == null) {\n-                //nothing more to be done endpoint requested a close\n-                //and there are no object associated with this connection\n+                // Nothing to do. Endpoint requested a close and there is no\n+                // longer a processor associated with this socket.\n                 return SocketState.CLOSED;\n             }\n ",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/93c69fe8b6a3e61e3eaa58674321446e9a727eb4/java/org/apache/coyote/AbstractProtocol.java",
                "status": "modified",
                "changes": 11,
                "deletions": 3,
                "sha": "21011fd27892065f65d75242b5436b525d9827f9",
                "blob_url": "https://github.com/apache/tomcat80/blob/93c69fe8b6a3e61e3eaa58674321446e9a727eb4/java/org/apache/coyote/AbstractProtocol.java",
                "filename": "java/org/apache/coyote/AbstractProtocol.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/AbstractProtocol.java?ref=93c69fe8b6a3e61e3eaa58674321446e9a727eb4"
            },
            {
                "patch": "@@ -234,7 +234,7 @@ public SocketState process(SocketWrapper<NioChannel> socketWrapper) throws IOExc\n         SocketState state = super.process(socketWrapper);\n         final NioEndpoint.KeyAttachment attach = (NioEndpoint.KeyAttachment)socket.getSocket().getAttachment(false);\n         //return if we have more data to write\n-        if (isRegisteredForWrite(attach)) {\n+        if (attach != null && isRegisteredForWrite(attach)) {\n             return SocketState.LONG;\n         } else {\n             return state;",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/93c69fe8b6a3e61e3eaa58674321446e9a727eb4/java/org/apache/coyote/http11/Http11NioProcessor.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "6a2755c95f0963b6ccfc3697ba2ea5726244a7f1",
                "blob_url": "https://github.com/apache/tomcat80/blob/93c69fe8b6a3e61e3eaa58674321446e9a727eb4/java/org/apache/coyote/http11/Http11NioProcessor.java",
                "filename": "java/org/apache/coyote/http11/Http11NioProcessor.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/http11/Http11NioProcessor.java?ref=93c69fe8b6a3e61e3eaa58674321446e9a727eb4"
            }
        ],
        "bug_id": "tomcat80_99",
        "parent": "https://github.com/apache/tomcat80/commit/6dda0fc8106952938da17f0a2c71403883d20bc1",
        "message": "Fix some NPEs observed while investigating some unit test failures.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1475900 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/21bbb8104184459b02f57e208bdf34630703e157",
        "file": [
            {
                "patch": "@@ -92,8 +92,17 @@ public void onStartup(Set<Class<?>> clazzes, ServletContext ctx)\n             filteredPojoEndpoints.addAll(scannedPojoEndpoints);\n         } else {\n             for (ServerApplicationConfig config : serverApplicationConfigs) {\n-                filteredEndpointConfigs.addAll(\n-                        config.getEndpointConfigs(scannedEndpointClazzes));\n+                Set<ServerEndpointConfig> configFilteredEndpoints =\n+                        config.getEndpointConfigs(scannedEndpointClazzes);\n+                if (configFilteredEndpoints != null) {\n+                    filteredEndpointConfigs.addAll(configFilteredEndpoints);\n+                }\n+                Set<Class<?>> configFilteredPojos =\n+                        config.getAnnotatedEndpointClasses(\n+                                scannedPojoEndpoints);\n+                if (configFilteredPojos != null) {\n+                    filteredPojoEndpoints.addAll(configFilteredPojos);\n+                }\n             }\n         }\n ",
                "additions": 11,
                "raw_url": "https://github.com/apache/tomcat80/raw/21bbb8104184459b02f57e208bdf34630703e157/java/org/apache/tomcat/websocket/server/WsSci.java",
                "status": "modified",
                "changes": 13,
                "deletions": 2,
                "sha": "097fe35453742baadd16d8ac2e927c1be9c82743",
                "blob_url": "https://github.com/apache/tomcat80/blob/21bbb8104184459b02f57e208bdf34630703e157/java/org/apache/tomcat/websocket/server/WsSci.java",
                "filename": "java/org/apache/tomcat/websocket/server/WsSci.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/server/WsSci.java?ref=21bbb8104184459b02f57e208bdf34630703e157"
            }
        ],
        "bug_id": "tomcat80_100",
        "parent": "https://github.com/apache/tomcat80/commit/a4bd5b9c60913581b3a5f5781b6e88fee2a46fa0",
        "message": "Add NPE protection and add missing filtering of POJOs.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1459677 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/eacc263964b46ee32e77eb99d7bcdd074cc5a2bb",
        "file": [
            {
                "patch": "@@ -2965,6 +2965,10 @@ protected void convertCookies() {\n \n         cookiesConverted = true;\n \n+        if (getContext() == null) {\n+            return;\n+        }\n+\n         parseCookies();\n \n         ServerCookies serverCookies = coyoteRequest.getCookies();",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/eacc263964b46ee32e77eb99d7bcdd074cc5a2bb/java/org/apache/catalina/connector/Request.java",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "ed061c2806becc7b68e397180e5c8758bb5baa50",
                "blob_url": "https://github.com/apache/tomcat80/blob/eacc263964b46ee32e77eb99d7bcdd074cc5a2bb/java/org/apache/catalina/connector/Request.java",
                "filename": "java/org/apache/catalina/connector/Request.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/Request.java?ref=eacc263964b46ee32e77eb99d7bcdd074cc5a2bb"
            },
            {
                "patch": "@@ -134,6 +134,10 @@\n         to occur even in blocking mode, which caused problems with NIO2.\n         (remm)\n       </fix>\n+      <fix>\n+        <bug>58578</bug>: Avoid NPE accessing cookies during access logging\n+        for request that had no context mapping. (remm)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/eacc263964b46ee32e77eb99d7bcdd074cc5a2bb/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "20f0390d45a4f362ed27fe5af851b2bfb7821759",
                "blob_url": "https://github.com/apache/tomcat80/blob/eacc263964b46ee32e77eb99d7bcdd074cc5a2bb/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=eacc263964b46ee32e77eb99d7bcdd074cc5a2bb"
            }
        ],
        "bug_id": "tomcat80_101",
        "parent": "https://github.com/apache/tomcat80/commit/1a03e76aa8ee5c08f731b0f827c35b8d33ce260a",
        "message": "58578: Avoid NPE when trying to do access logging on cookies for an unmapped request.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1712358 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/ff2a783bcad849b704380c7db63db5469d8606fc",
        "file": [
            {
                "patch": "@@ -65,7 +65,7 @@ public void storeChilds(PrintWriter aWriter, int indent, Object aResourceRoot,\n                             + \".[JarResources]\");\n             if (jarResourcesElementDesc != null) {\n                 for (WebResourceSet jarResources : jarResourcesArray) {\n-                    preResourcesElementDesc.getStoreFactory().store(aWriter, indent,\n+                    jarResourcesElementDesc.getStoreFactory().store(aWriter, indent,\n                             jarResources);\n                 }\n             }\n@@ -77,7 +77,7 @@ public void storeChilds(PrintWriter aWriter, int indent, Object aResourceRoot,\n                             + \".[PostResources]\");\n             if (postResourcesElementDesc != null) {\n                 for (WebResourceSet postResources : postResourcesArray) {\n-                    preResourcesElementDesc.getStoreFactory().store(aWriter, indent,\n+                    postResourcesElementDesc.getStoreFactory().store(aWriter, indent,\n                             postResources);\n                 }\n             }",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/ff2a783bcad849b704380c7db63db5469d8606fc/java/org/apache/catalina/storeconfig/WebResourceRootSF.java",
                "status": "modified",
                "changes": 4,
                "deletions": 2,
                "sha": "a1d663b518b57d310894c8e1991fb52a03b720ca",
                "blob_url": "https://github.com/apache/tomcat80/blob/ff2a783bcad849b704380c7db63db5469d8606fc/java/org/apache/catalina/storeconfig/WebResourceRootSF.java",
                "filename": "java/org/apache/catalina/storeconfig/WebResourceRootSF.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/storeconfig/WebResourceRootSF.java?ref=ff2a783bcad849b704380c7db63db5469d8606fc"
            }
        ],
        "bug_id": "tomcat80_102",
        "parent": "https://github.com/apache/tomcat80/commit/e0ad237721448970f3d2ec0ff5b8aa190c820c59",
        "message": "Fix copy and paste error highlighted by Eclipse NPE warnings\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1444611 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/a8b950f2d5f4783215c12d4448bdb743c1ab5315",
        "file": [
            {
                "patch": "@@ -1960,10 +1960,13 @@ protected void processAnnotationsFile(File file, WebXml fragment,\n             boolean handlesTypesOnly) {\n \n         if (file.isDirectory()) {\n+            // Returns null if directory is not readable\n             String[] dirs = file.list();\n-            for (String dir : dirs) {\n-                processAnnotationsFile(\n-                        new File(file,dir), fragment, handlesTypesOnly);\n+            if (dirs != null) {\n+                for (String dir : dirs) {\n+                    processAnnotationsFile(\n+                            new File(file,dir), fragment, handlesTypesOnly);\n+                }\n             }\n         } else if (file.canRead() && file.getName().endsWith(\".class\")) {\n             try (FileInputStream fis = new FileInputStream(file)) {",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/a8b950f2d5f4783215c12d4448bdb743c1ab5315/java/org/apache/catalina/startup/ContextConfig.java",
                "status": "modified",
                "changes": 9,
                "deletions": 3,
                "sha": "82e5ed9e0f869e7a33934b463b100c555e3d03c6",
                "blob_url": "https://github.com/apache/tomcat80/blob/a8b950f2d5f4783215c12d4448bdb743c1ab5315/java/org/apache/catalina/startup/ContextConfig.java",
                "filename": "java/org/apache/catalina/startup/ContextConfig.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/startup/ContextConfig.java?ref=a8b950f2d5f4783215c12d4448bdb743c1ab5315"
            },
            {
                "patch": "@@ -80,6 +80,11 @@\n         and it need not be fatal when the Realm starts. Based on a patch by\n         C\u00e9dric Couralet. (markt)\n       </fix>\n+      <fix>\n+        <bug>56785</bug>: Avoid <code>NullPointerException</code> if directory\n+        exists on the class path that is not readable by the Tomcat user.\n+        (markt)\n+      </fix>\n       <fix>\n         <bug>56796</bug>: Remove unnecessary sleep when stopping a web\n         application. (markt)",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/a8b950f2d5f4783215c12d4448bdb743c1ab5315/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "a2c78120754d345073ac9fa34416ee866128ca5c",
                "blob_url": "https://github.com/apache/tomcat80/blob/a8b950f2d5f4783215c12d4448bdb743c1ab5315/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=a8b950f2d5f4783215c12d4448bdb743c1ab5315"
            }
        ],
        "bug_id": "tomcat80_103",
        "parent": "https://github.com/apache/tomcat80/commit/e5816721ded13fde916818a4dac2afdc9c399839",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56785\nAvoid NullPointerException if directory exists on the class path that is not readable by the Tomcat user.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1615920 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/88578d0f59472ff809bc5937408d5d168bc1e2ac",
        "file": [
            {
                "patch": "@@ -101,7 +101,7 @@ public int read(byte[] b, int off, int len) throws IOException {\n \r\n \r\n     private void preReadChecks() {\r\n-        if (ready == null || !ready.booleanValue()) {\r\n+        if (listener != null && (ready == null || !ready.booleanValue())) {\r\n             // TODO i18n\r\n             throw new IllegalStateException();\r\n         }\r",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/88578d0f59472ff809bc5937408d5d168bc1e2ac/java/org/apache/coyote/http11/upgrade/UpgradeServletInputStream.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "cd74260edee9f018ddc51eeea6798d6711812d19",
                "blob_url": "https://github.com/apache/tomcat80/blob/88578d0f59472ff809bc5937408d5d168bc1e2ac/java/org/apache/coyote/http11/upgrade/UpgradeServletInputStream.java",
                "filename": "java/org/apache/coyote/http11/upgrade/UpgradeServletInputStream.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/http11/upgrade/UpgradeServletInputStream.java?ref=88578d0f59472ff809bc5937408d5d168bc1e2ac"
            }
        ],
        "bug_id": "tomcat80_104",
        "parent": "https://github.com/apache/tomcat80/commit/3c55cf90dc6f79ae413e6e74837280a2002ea130",
        "message": "Fix NPE when in blocking mode\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1413236 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/916e53ff6b45cb69e0698acb4bab614c4bd27bc1",
        "file": [
            {
                "patch": "@@ -222,7 +222,9 @@ public void readResponse(boolean wantBody) throws IOException {\n         // clear any residual data before starting on this response\n         responseHeaders.clear();\n         responseBody = null;\n-        bodyUriElements.clear();\n+        if (bodyUriElements != null) {\n+            bodyUriElements.clear();\n+        }\n \n         // Read the response status line\n         responseLine = readLine();",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/916e53ff6b45cb69e0698acb4bab614c4bd27bc1/test/org/apache/catalina/startup/SimpleHttpClient.java",
                "status": "modified",
                "changes": 4,
                "deletions": 1,
                "sha": "7beef4ca3b012952d0f756b5b158b97f8ded153a",
                "blob_url": "https://github.com/apache/tomcat80/blob/916e53ff6b45cb69e0698acb4bab614c4bd27bc1/test/org/apache/catalina/startup/SimpleHttpClient.java",
                "filename": "test/org/apache/catalina/startup/SimpleHttpClient.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/startup/SimpleHttpClient.java?ref=916e53ff6b45cb69e0698acb4bab614c4bd27bc1"
            }
        ],
        "bug_id": "tomcat80_105",
        "parent": "https://github.com/apache/tomcat80/commit/ea091803171217c48dffa99f8cd95f6f8804936e",
        "message": "Fix an NPE caused by r1408517\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1408562 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/4318120a6a4d5f25a097f46eb9dcc87794033669",
        "file": [
            {
                "patch": "@@ -58,6 +58,7 @@\n import org.apache.catalina.Wrapper;\n import org.apache.catalina.connector.Request;\n import org.apache.catalina.connector.Response;\n+import org.apache.catalina.startup.FailedContext;\n import org.apache.catalina.util.ContextName;\n import org.apache.catalina.util.LifecycleMBeanBase;\n import org.apache.juli.logging.Log;\n@@ -1342,6 +1343,9 @@ protected void processChildren(Container container) {\n \n             try {\n                 if (container instanceof Context) {\n+                    if (container instanceof FailedContext) {\n+                        return;\n+                    }\n                     // Ensure background processing for Contexts and Wrappers\n                     // is performed under the web app's class loader\n                     originalClassLoader =",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/4318120a6a4d5f25a097f46eb9dcc87794033669/java/org/apache/catalina/core/ContainerBase.java",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "3c6b28bd4cfd54614ee70b92a93a74262d40e2f7",
                "blob_url": "https://github.com/apache/tomcat80/blob/4318120a6a4d5f25a097f46eb9dcc87794033669/java/org/apache/catalina/core/ContainerBase.java",
                "filename": "java/org/apache/catalina/core/ContainerBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/ContainerBase.java?ref=4318120a6a4d5f25a097f46eb9dcc87794033669"
            }
        ],
        "bug_id": "tomcat80_106",
        "parent": "https://github.com/apache/tomcat80/commit/64e74055a3a088cd5f7b96d3f985f177eb08ce36",
        "message": "Prevent NPEs with background processing and a failed deployment.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1408162 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/5b5829f2326b88d9a56668f6102755269f5671bc",
        "file": [
            {
                "patch": "@@ -678,7 +678,7 @@ public SocketState process(SocketWrapper<S> socket,\n                         sm.getString(\"abstractConnectionHandler.error\"), e);\n             }\n             // Don't try to add upgrade processors back into the pool\n-            if (!processor.isUpgrade()) {\n+            if (processor !=null && !processor.isUpgrade()) {\n                 release(socket, processor, true, false);\n             }\n             return SocketState.CLOSED;",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/5b5829f2326b88d9a56668f6102755269f5671bc/java/org/apache/coyote/AbstractProtocol.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "6aa560d58f28726227e90c02cb3b31224cd2f936",
                "blob_url": "https://github.com/apache/tomcat80/blob/5b5829f2326b88d9a56668f6102755269f5671bc/java/org/apache/coyote/AbstractProtocol.java",
                "filename": "java/org/apache/coyote/AbstractProtocol.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/AbstractProtocol.java?ref=5b5829f2326b88d9a56668f6102755269f5671bc"
            }
        ],
        "bug_id": "tomcat80_107",
        "parent": "https://github.com/apache/tomcat80/commit/e2e46e9abfa6b7e319f51d9e44e63d18862aac5e",
        "message": "FindBugs: Protect against NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1401104 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/9bf702b76dfa5b6736dcc49486349209ad0b3964",
        "file": [
            {
                "patch": "@@ -765,7 +765,11 @@ public String getURIEncodingLower() {\n       */\n      public void setURIEncoding(String URIEncoding) {\n          this.URIEncoding = URIEncoding;\n-         this.URIEncodingLower = URIEncoding.toLowerCase(Locale.US);\n+         if (URIEncoding == null) {\n+             URIEncodingLower = null;\n+         } else {\n+             this.URIEncodingLower = URIEncoding.toLowerCase(Locale.US);\n+         }\n          setProperty(\"uRIEncoding\", URIEncoding);\n      }\n ",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/9bf702b76dfa5b6736dcc49486349209ad0b3964/java/org/apache/catalina/connector/Connector.java",
                "status": "modified",
                "changes": 6,
                "deletions": 1,
                "sha": "05a66365a5177b055e7ad8c776df3843efaf54a4",
                "blob_url": "https://github.com/apache/tomcat80/blob/9bf702b76dfa5b6736dcc49486349209ad0b3964/java/org/apache/catalina/connector/Connector.java",
                "filename": "java/org/apache/catalina/connector/Connector.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/Connector.java?ref=9bf702b76dfa5b6736dcc49486349209ad0b3964"
            }
        ],
        "bug_id": "tomcat80_108",
        "parent": "https://github.com/apache/tomcat80/commit/26ad376ce7cb0c5991742414c5bf72da2d4bd30d",
        "message": "FindBugs: Avoid possible NPE.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1401092 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/8ddca884a7e84f8ae3aa3a2aacddf1ea900dd536",
        "file": [
            {
                "patch": "@@ -104,7 +104,12 @@ public ReplicationStream(InputStream stream,\n     protected Class<?> resolveProxyClass(String[] interfaces)\n             throws IOException, ClassNotFoundException {\n \n-        ClassLoader latestLoader = (classLoaders!=null && classLoaders.length==0)?null:classLoaders[0];\n+        ClassLoader latestLoader;\n+        if (classLoaders != null && classLoaders.length > 0) {\n+            latestLoader = classLoaders[0];\n+        } else {\n+            latestLoader = null;\n+        }\n         ClassLoader nonPublicLoader = null;\n         boolean hasNonPublicInterface = false;\n ",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/8ddca884a7e84f8ae3aa3a2aacddf1ea900dd536/java/org/apache/catalina/tribes/io/ReplicationStream.java",
                "status": "modified",
                "changes": 7,
                "deletions": 1,
                "sha": "3ce3f04137af023627d7c459645e58c5277a02d6",
                "blob_url": "https://github.com/apache/tomcat80/blob/8ddca884a7e84f8ae3aa3a2aacddf1ea900dd536/java/org/apache/catalina/tribes/io/ReplicationStream.java",
                "filename": "java/org/apache/catalina/tribes/io/ReplicationStream.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/tribes/io/ReplicationStream.java?ref=8ddca884a7e84f8ae3aa3a2aacddf1ea900dd536"
            }
        ],
        "bug_id": "tomcat80_109",
        "parent": "https://github.com/apache/tomcat80/commit/0d21abb4c839b226a29b5bdff184525647424030",
        "message": "FindBugs: Fix potential NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1366910 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/b7dab9715c995cef69ee3fa547a2c9a8740b98ae",
        "file": [
            {
                "patch": "@@ -122,13 +122,14 @@ public boolean getStaticOnly() {\n     }\n \n     protected void sendPing() {\n-        if (failureDetector.get()!=null) {\n-            //we have a reference to the failure detector\n-            //piggy back on that dude\n+        if (failureDetector.get() != null) {\n+            // We have a reference to the failure detector\n+            // Piggy back on it\n             failureDetector.get().checkMembers(true);\n-        }else {\n-            if (staticOnly && staticMembers.get()!=null) {\n-                sendPingMessage(staticMembers.get().getMembers());\n+        } else {\n+            StaticMembershipInterceptor smi = staticMembers.get();\n+            if (staticOnly && smi != null) {\n+                sendPingMessage(smi.getMembers());\n             } else {\n                 sendPingMessage(getMembers());\n             }",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/b7dab9715c995cef69ee3fa547a2c9a8740b98ae/java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java",
                "status": "modified",
                "changes": 13,
                "deletions": 6,
                "sha": "3fc157f7472a035ca22dcd9672852a1dbd24f520",
                "blob_url": "https://github.com/apache/tomcat80/blob/b7dab9715c995cef69ee3fa547a2c9a8740b98ae/java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java",
                "filename": "java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java?ref=b7dab9715c995cef69ee3fa547a2c9a8740b98ae"
            }
        ],
        "bug_id": "tomcat80_110",
        "parent": "https://github.com/apache/tomcat80/commit/2ecceb762386ab7af1eea19c864c2cd32fcd0c9c",
        "message": "Fingbugs: Fix possible NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1364419 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/ece942f245bf77de2afe54bafc09c2b159326c27",
        "file": [
            {
                "patch": "@@ -48,6 +48,7 @@ webappLoader.deploy=Deploying class repositories to work directory {0}\n webappLoader.jarDeploy=Deploy JAR {0} to {1}\n webappLoader.classDeploy=Deploy class files {0} to {1}\n webappLoader.reloadable=Cannot set reloadable property to {0}\n+webappLoader.setContext.ise=Setting the Context is not permitted while the loader is started.\n webappLoader.starting=Starting this Loader\n webappLoader.stopping=Stopping this Loader\n webappLoader.copyFailure=Failed to copy resources",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/ece942f245bf77de2afe54bafc09c2b159326c27/java/org/apache/catalina/loader/LocalStrings.properties",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "4f9df6661291b693ff65e4dc32eddc25dc804bff",
                "blob_url": "https://github.com/apache/tomcat80/blob/ece942f245bf77de2afe54bafc09c2b159326c27/java/org/apache/catalina/loader/LocalStrings.properties",
                "filename": "java/org/apache/catalina/loader/LocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/loader/LocalStrings.properties?ref=ece942f245bf77de2afe54bafc09c2b159326c27"
            },
            {
                "patch": "@@ -215,6 +215,15 @@ public Context getContext() {\n     @Override\n     public void setContext(Context context) {\n \n+        if (this.context == context) {\n+            return;\n+        }\n+\n+        if (getState().isAvailable()) {\n+            throw new IllegalStateException(\n+                    sm.getString(\"webappLoader.setContext.ise\"));\n+        }\n+\n         // Deregister from the old Context (if any)\n         if (this.context != null) {\n             this.context.removePropertyChangeListener(this);\n@@ -391,7 +400,7 @@ public void backgroundProcess() {\n                     context.reload();\n                 }\n             } finally {\n-                if (context.getLoader() != null) {\n+                if (context != null && context.getLoader() != null) {\n                     Thread.currentThread().setContextClassLoader\n                         (context.getLoader().getClassLoader());\n                 }\n@@ -602,10 +611,8 @@ protected void stopInternal() throws LifecycleException {\n         setState(LifecycleState.STOPPING);\n \n         // Remove context attributes as appropriate\n-        if (context != null) {\n-            ServletContext servletContext = context.getServletContext();\n-            servletContext.removeAttribute(Globals.CLASS_PATH_ATTR);\n-        }\n+        ServletContext servletContext = context.getServletContext();\n+        servletContext.removeAttribute(Globals.CLASS_PATH_ATTR);\n \n         // Throw away our current class loader\n         ((Lifecycle) classLoader).stop();",
                "additions": 12,
                "raw_url": "https://github.com/apache/tomcat80/raw/ece942f245bf77de2afe54bafc09c2b159326c27/java/org/apache/catalina/loader/WebappLoader.java",
                "status": "modified",
                "changes": 17,
                "deletions": 5,
                "sha": "6f74adf973a3c2e2ab00478b907d1978c01ae475",
                "blob_url": "https://github.com/apache/tomcat80/blob/ece942f245bf77de2afe54bafc09c2b159326c27/java/org/apache/catalina/loader/WebappLoader.java",
                "filename": "java/org/apache/catalina/loader/WebappLoader.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/loader/WebappLoader.java?ref=ece942f245bf77de2afe54bafc09c2b159326c27"
            }
        ],
        "bug_id": "tomcat80_111",
        "parent": "https://github.com/apache/tomcat80/commit/a4f1255c44576ac145ee7edf9e4153449137081c",
        "message": "FindBugs. Fix some possible NPEs.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1361435 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/84ce249369c22647b73279dd9a67565fcfdfc6cd",
        "file": [
            {
                "patch": "@@ -280,10 +280,13 @@ protected void longPoll(SocketWrapper<Long> socket,\n             if (processor.isAsync()) {\n                 // Async\n                 socket.setAsync(true);\n-            } else if (processor.isComet() && proto.endpoint.isRunning()) {\n-                ((AprEndpoint) proto.endpoint).getCometPoller().add(\n-                        socket.getSocket().longValue(),\n-                        proto.endpoint.getSoTimeout());\n+            } else if (processor.isComet()) {\n+                // Comet\n+                if (proto.endpoint.isRunning()) {\n+                    ((AprEndpoint) proto.endpoint).getCometPoller().add(\n+                            socket.getSocket().longValue(),\n+                            proto.endpoint.getSoTimeout());\n+                }\n             } else {\n                 // Upgraded\n                 ((AprEndpoint) proto.endpoint).getPoller().add(",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/84ce249369c22647b73279dd9a67565fcfdfc6cd/java/org/apache/coyote/http11/Http11AprProtocol.java",
                "status": "modified",
                "changes": 11,
                "deletions": 4,
                "sha": "c0ecf7910241966fd6eabcf61ce84305504deb94",
                "blob_url": "https://github.com/apache/tomcat80/blob/84ce249369c22647b73279dd9a67565fcfdfc6cd/java/org/apache/coyote/http11/Http11AprProtocol.java",
                "filename": "java/org/apache/coyote/http11/Http11AprProtocol.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/http11/Http11AprProtocol.java?ref=84ce249369c22647b73279dd9a67565fcfdfc6cd"
            }
        ],
        "bug_id": "tomcat80_112",
        "parent": "https://github.com/apache/tomcat80/commit/315e2e32bf24f16de0c4a718df6db7a1d4dfdeab",
        "message": "Fix NPE observed running unit tests with APR on Linux\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1359102 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/62958f89b8d4a9a7800b5588e509685aa8bb23b9",
        "file": [
            {
                "patch": "@@ -304,7 +304,7 @@ public int getLength() {\n \n             @Override\n             public int available() {\n-                if (done) return 0;\n+                if (done || body == null) return 0;\n                 else return body.length;\n             }\n         };",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/62958f89b8d4a9a7800b5588e509685aa8bb23b9/test/org/apache/catalina/startup/TomcatBaseTest.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "fd03a912861a28bfb1d8d07e9aea05a29005bbec",
                "blob_url": "https://github.com/apache/tomcat80/blob/62958f89b8d4a9a7800b5588e509685aa8bb23b9/test/org/apache/catalina/startup/TomcatBaseTest.java",
                "filename": "test/org/apache/catalina/startup/TomcatBaseTest.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/startup/TomcatBaseTest.java?ref=62958f89b8d4a9a7800b5588e509685aa8bb23b9"
            }
        ],
        "bug_id": "tomcat80_113",
        "parent": "https://github.com/apache/tomcat80/commit/3c0f43e97054f374c0bfcfa6d17820ad0ba4c7a9",
        "message": "Fix NPE triggered by r1356852\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1356867 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/4743b2c350adf97aca22571e1aae91d7e3fbf3d0",
        "file": [
            {
                "patch": "@@ -61,6 +61,10 @@ public WsOutbound(UpgradeOutbound upgradeOutbound) {\n      *                      the WebSocket frame to the client\n      */\n     public void writeBinaryData(int b) throws IOException {\n+        if (closed) {\n+            throw new IOException(\"Closed\");\n+        }\n+\n         if (bb.position() == bb.capacity()) {\n             doFlush(false);\n         }\n@@ -87,6 +91,10 @@ public void writeBinaryData(int b) throws IOException {\n      *                      the WebSocket frame to the client\n      */\n     public void writeTextData(char c) throws IOException {\n+        if (closed) {\n+            throw new IOException(\"Closed\");\n+        }\n+\n         if (cb.position() == cb.capacity()) {\n             doFlush(false);\n         }\n@@ -112,6 +120,10 @@ public void writeTextData(char c) throws IOException {\n      * @throws IOException  If an error occurs writing to the client\n      */\n     public void writeBinaryMessage(ByteBuffer msgBb) throws IOException {\n+        if (closed) {\n+            throw new IOException(\"Closed\");\n+        }\n+\n         if (text != null) {\n             // Empty the buffer\n             flush();\n@@ -131,6 +143,10 @@ public void writeBinaryMessage(ByteBuffer msgBb) throws IOException {\n      * @throws IOException  If an error occurs writing to the client\n      */\n     public void writeTextMessage(CharBuffer msgCb) throws IOException {\n+        if (closed) {\n+            throw new IOException(\"Closed\");\n+        }\n+\n         if (text != null) {\n             // Empty the buffer\n             flush();\n@@ -146,6 +162,9 @@ public void writeTextMessage(CharBuffer msgCb) throws IOException {\n      * @throws IOException  If an error occurs writing to the client\n      */\n     public void flush() throws IOException {\n+        if (closed) {\n+            throw new IOException(\"Closed\");\n+        }\n         doFlush(true);\n     }\n \n@@ -264,7 +283,7 @@ public void pong(ByteBuffer data) throws IOException {\n         // TODO Think about threading requirements for writing. This is not\n         // currently thread safe and writing almost certainly needs to be.\n         if (closed) {\n-            // TODO - handle this - ISE?\n+            throw new IOException(\"Closed\");\n         }\n \n         doFlush(true);",
                "additions": 20,
                "raw_url": "https://github.com/apache/tomcat80/raw/4743b2c350adf97aca22571e1aae91d7e3fbf3d0/java/org/apache/catalina/websocket/WsOutbound.java",
                "status": "modified",
                "changes": 21,
                "deletions": 1,
                "sha": "3acfc7d40bb25753076fe5f4dfbc7399975ddb63",
                "blob_url": "https://github.com/apache/tomcat80/blob/4743b2c350adf97aca22571e1aae91d7e3fbf3d0/java/org/apache/catalina/websocket/WsOutbound.java",
                "filename": "java/org/apache/catalina/websocket/WsOutbound.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/websocket/WsOutbound.java?ref=4743b2c350adf97aca22571e1aae91d7e3fbf3d0"
            }
        ],
        "bug_id": "tomcat80_114",
        "parent": "https://github.com/apache/tomcat80/commit/3b9112f150b281dad59cc37b9393b0f2cec8ee06",
        "message": "Fix NPE in tests\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1293016 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/76998644c2465473e886211fbf9bc42932d07be5",
        "file": [
            {
                "patch": "@@ -2101,6 +2101,9 @@ private void populateJavaClassCache(String className) {\n             String name = className.replace('.', '/') + \".class\";\n             InputStream is =\n                     context.getLoader().getClassLoader().getResourceAsStream(name);\n+            if (is == null) {\n+                return;\n+            }\n             ClassParser parser = new ClassParser(is, null);\n             try {\n                 JavaClass clazz = parser.parse();",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/76998644c2465473e886211fbf9bc42932d07be5/java/org/apache/catalina/startup/ContextConfig.java",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "cf4887b9113bdad2cdc6c9dd8434d1456dc197da",
                "blob_url": "https://github.com/apache/tomcat80/blob/76998644c2465473e886211fbf9bc42932d07be5/java/org/apache/catalina/startup/ContextConfig.java",
                "filename": "java/org/apache/catalina/startup/ContextConfig.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/startup/ContextConfig.java?ref=76998644c2465473e886211fbf9bc42932d07be5"
            }
        ],
        "bug_id": "tomcat80_115",
        "parent": "https://github.com/apache/tomcat80/commit/858dc0a4f7f8069237abda6454e1536270880b59",
        "message": "Avoid NPE if class / interface is not present\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1239024 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/39a5d138b59f84575045bf81c79c21a028c8700f",
        "file": [
            {
                "patch": "@@ -122,6 +122,9 @@ public void addParameterValues( String key, String[] newValues) {\n         handleQueryParameters();\n         // no \"facade\"\n         ArrayList<String> values = paramHashValues.get(name);\n+        if (values == null) {\n+            return null;\n+        }\n         return values.toArray(new String[values.size()]);\n     }\n ",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/39a5d138b59f84575045bf81c79c21a028c8700f/java/org/apache/tomcat/util/http/Parameters.java",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "8270e1e55b213d46aa3979f2c2a2271290a5c577",
                "blob_url": "https://github.com/apache/tomcat80/blob/39a5d138b59f84575045bf81c79c21a028c8700f/java/org/apache/tomcat/util/http/Parameters.java",
                "filename": "java/org/apache/tomcat/util/http/Parameters.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/http/Parameters.java?ref=39a5d138b59f84575045bf81c79c21a028c8700f"
            }
        ],
        "bug_id": "tomcat80_116",
        "parent": "https://github.com/apache/tomcat80/commit/7085f3a599852a958412c6a5330e3dda73ba11c7",
        "message": "Fix NPE in parameter re-factoring identified by JSP TCK.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1190481 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/2a58500195702d9397d387214d02fad2b12293ac",
        "file": [
            {
                "patch": "@@ -179,13 +179,15 @@ protected void postConstruct(Object instance, final Class<?> clazz)\n         // At the end the postconstruct annotated\n         // method is invoked\n         List<AnnotationCacheEntry> annotations = annotationCache.get(clazz);\n-        for (AnnotationCacheEntry entry : annotations) {\n-            if (entry.getType() == AnnotationCacheEntryType.POST_CONSTRUCT) {\n-                Method postConstruct = (Method) entry.getAccessibleObject();\n-                boolean accessibility = postConstruct.isAccessible();\n-                postConstruct.setAccessible(true);\n-                postConstruct.invoke(instance);\n-                postConstruct.setAccessible(accessibility);\n+        if (annotations != null) {\n+            for (AnnotationCacheEntry entry : annotations) {\n+                if (entry.getType() == AnnotationCacheEntryType.POST_CONSTRUCT) {\n+                    Method postConstruct = (Method) entry.getAccessibleObject();\n+                    boolean accessibility = postConstruct.isAccessible();\n+                    postConstruct.setAccessible(true);\n+                    postConstruct.invoke(instance);\n+                    postConstruct.setAccessible(accessibility);\n+                }\n             }\n         }\n     }",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/2a58500195702d9397d387214d02fad2b12293ac/java/org/apache/catalina/core/DefaultInstanceManager.java",
                "status": "modified",
                "changes": 16,
                "deletions": 7,
                "sha": "a542e3db19058e12311a4964ce7d2a2d259a39e9",
                "blob_url": "https://github.com/apache/tomcat80/blob/2a58500195702d9397d387214d02fad2b12293ac/java/org/apache/catalina/core/DefaultInstanceManager.java",
                "filename": "java/org/apache/catalina/core/DefaultInstanceManager.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/DefaultInstanceManager.java?ref=2a58500195702d9397d387214d02fad2b12293ac"
            }
        ],
        "bug_id": "tomcat80_117",
        "parent": "https://github.com/apache/tomcat80/commit/14f40548acf4add3ec3a2e89aed447da5fee3077",
        "message": "Prevent NPE if JNDI is disabled.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1172546 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/4da15b07aa5f0c79462c254f75f2c4c14d0136df",
        "file": [
            {
                "patch": "@@ -119,6 +119,7 @@ public static void checkAttributes(String typeOfTag, Node n,\n         int tempLength = (attrs == null) ? 0 : attrs.getLength();\n         Vector<String> temp = new Vector<String>(tempLength, 1);\n         for (int i = 0; i < tempLength; i++) {\n+            @SuppressWarnings(\"null\")  // If attrs==null, tempLength == 0\n             String qName = attrs.getQName(i);\n             if ((!qName.equals(\"xmlns\")) && (!qName.startsWith(\"xmlns:\")))\n                 temp.addElement(qName);",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/4da15b07aa5f0c79462c254f75f2c4c14d0136df/java/org/apache/jasper/compiler/JspUtil.java",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "1383f16d3d109da1c02a96a59a2d3ad1e97e6079",
                "blob_url": "https://github.com/apache/tomcat80/blob/4da15b07aa5f0c79462c254f75f2c4c14d0136df/java/org/apache/jasper/compiler/JspUtil.java",
                "filename": "java/org/apache/jasper/compiler/JspUtil.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/JspUtil.java?ref=4da15b07aa5f0c79462c254f75f2c4c14d0136df"
            },
            {
                "patch": "@@ -510,6 +510,7 @@ private void appendPageDirective(Node.PageDirective n) {\n             Attributes attrs = n.getAttributes();\n             int len = (attrs == null) ? 0 : attrs.getLength();\n             for (int i=0; i<len; i++) {\n+                @SuppressWarnings(\"null\")  // If attrs==null, len == 0\n                 String attrName = attrs.getQName(i);\n                 if (!\"pageEncoding\".equals(attrName)\n                         && !\"contentType\".equals(attrName)) {\n@@ -530,6 +531,7 @@ private void appendPageDirective(Node.PageDirective n) {\n \n             // append remaining attributes\n             for (int i=0; i<len; i++) {\n+                @SuppressWarnings(\"null\")  // If attrs==null, len == 0\n                 String attrName = attrs.getQName(i);\n                 if (\"import\".equals(attrName) || \"contentType\".equals(attrName)\n                         || \"pageEncoding\".equals(attrName)) {\n@@ -601,6 +603,7 @@ private void appendTagDirective(Node.TagDirective n)\n             Attributes attrs = n.getAttributes();\n             int len = (attrs == null) ? 0 : attrs.getLength();\n             for (int i=0; i<len; i++) {\n+                @SuppressWarnings(\"null\")  // If attrs==null, len == 0\n                 String attrName = attrs.getQName(i);\n                 if (!\"pageEncoding\".equals(attrName)) {\n                     append = true;\n@@ -696,6 +699,7 @@ private void printAttributes(Node n, boolean addDefaultNS) {\n             Attributes attrs = n.getTaglibAttributes();\n             int len = (attrs == null) ? 0 : attrs.getLength();\n             for (int i=0; i<len; i++) {\n+                @SuppressWarnings(\"null\")  // If attrs==null, len == 0\n                 String name = attrs.getQName(i);\n                 String value = attrs.getValue(i);\n                 buf.append(\"  \").append(name).append(\"=\\\"\").append(value).append(\"\\\"\\n\");\n@@ -708,6 +712,7 @@ private void printAttributes(Node n, boolean addDefaultNS) {\n             len = (attrs == null) ? 0 : attrs.getLength();\n             boolean defaultNSSeen = false;\n             for (int i=0; i<len; i++) {\n+                @SuppressWarnings(\"null\")  // If attrs==null, len == 0\n                 String name = attrs.getQName(i);\n                 String value = attrs.getValue(i);\n                 buf.append(\"  \").append(name).append(\"=\\\"\").append(value).append(\"\\\"\\n\");\n@@ -724,6 +729,7 @@ private void printAttributes(Node n, boolean addDefaultNS) {\n             attrs = n.getAttributes();\n             len = (attrs == null) ? 0 : attrs.getLength();\n             for (int i=0; i<len; i++) {\n+                @SuppressWarnings(\"null\")  // If attrs==null, len == 0\n                 String name = attrs.getQName(i);\n                 String value = attrs.getValue(i);\n                 buf.append(\"  \").append(name).append(\"=\\\"\");",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/4da15b07aa5f0c79462c254f75f2c4c14d0136df/java/org/apache/jasper/compiler/PageDataImpl.java",
                "status": "modified",
                "changes": 6,
                "deletions": 0,
                "sha": "665d74393d9042d9ef8be44f36a455bb7734a8b2",
                "blob_url": "https://github.com/apache/tomcat80/blob/4da15b07aa5f0c79462c254f75f2c4c14d0136df/java/org/apache/jasper/compiler/PageDataImpl.java",
                "filename": "java/org/apache/jasper/compiler/PageDataImpl.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/PageDataImpl.java?ref=4da15b07aa5f0c79462c254f75f2c4c14d0136df"
            },
            {
                "patch": "@@ -896,6 +896,7 @@ public void visit(Node.JspElement n) throws JasperException {\n             if (attrs == null) {\n                 err.jspError(n, \"jsp.error.jspelement.missing.name\");\n             }\n+            @SuppressWarnings(\"null\") // Exception will have been thrown above\n             int xmlAttrLen = attrs.getLength();\n \n             Node.Nodes namedAttrs = n.getNamedAttributeNodes();",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/4da15b07aa5f0c79462c254f75f2c4c14d0136df/java/org/apache/jasper/compiler/Validator.java",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "ce6ee9f3b9f9a41b5cbabd0ec743d376328cdbd6",
                "blob_url": "https://github.com/apache/tomcat80/blob/4da15b07aa5f0c79462c254f75f2c4c14d0136df/java/org/apache/jasper/compiler/Validator.java",
                "filename": "java/org/apache/jasper/compiler/Validator.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/Validator.java?ref=4da15b07aa5f0c79462c254f75f2c4c14d0136df"
            }
        ],
        "bug_id": "tomcat80_118",
        "parent": "https://github.com/apache/tomcat80/commit/d158eee63a5cc96df3d597b0814de186afd6287a",
        "message": "Fix some false npe warnings\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1154579 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/0bac6949b2008a3d03d37b1dba13eecd778d5282",
        "file": [
            {
                "patch": "@@ -20,26 +20,17 @@\n \n public class TestLimitLatch extends TestCase {\n \n-    private volatile LimitLatch latch = null;\n-\n-    @Override\n-    public void tearDown() {\n-        LimitLatch temp = latch;\n-        if (temp!=null) temp.releaseAll();\n-        latch = null;\n-    }\n-\n     public void testNoThreads() throws Exception {\n-        latch = new LimitLatch(0);\n+        LimitLatch latch = new LimitLatch(0);\n         assertEquals(\"No threads should be waiting\", false,\n                 latch.hasQueuedThreads());\n     }\n \n     public void testOneThreadNoWait() throws Exception {\n-        latch = new LimitLatch(1);\n+        LimitLatch latch = new LimitLatch(1);\n         assertEquals(\"No threads should be waiting\", false,\n                 latch.hasQueuedThreads());\n-        Thread testThread = new TestThread();\n+        Thread testThread = new TestThread(latch);\n         testThread.start();\n         Thread.sleep(50);\n         assertEquals(\"0 threads should be waiting\", 0,\n@@ -51,10 +42,10 @@ public void testOneThreadNoWait() throws Exception {\n     }\n \n     public void testOneThreadWaitCountUp() throws Exception {\n-        latch = new LimitLatch(1);\n+        LimitLatch latch = new LimitLatch(1);\n         assertEquals(\"No threads should be waiting\", false,\n                 latch.hasQueuedThreads());\n-        Thread testThread = new TestThread();\n+        Thread testThread = new TestThread(latch);\n         latch.countUpOrAwait();\n         testThread.start();\n         Thread.sleep(50);\n@@ -67,10 +58,10 @@ public void testOneThreadWaitCountUp() throws Exception {\n     }\n \n     public void testOneRelease() throws Exception {\n-        latch = new LimitLatch(1);\n+        LimitLatch latch = new LimitLatch(1);\n         assertEquals(\"No threads should be waiting\", false,\n                 latch.hasQueuedThreads());\n-        Thread testThread = new TestThread();\n+        Thread testThread = new TestThread(latch);\n         latch.countUpOrAwait();\n         testThread.start();\n         Thread.sleep(50);\n@@ -83,12 +74,12 @@ public void testOneRelease() throws Exception {\n     }\n \n     public void testTenWait() throws Exception {\n-        latch = new LimitLatch(10);\n+        LimitLatch latch = new LimitLatch(10);\n         assertEquals(\"No threads should be waiting\", false,\n                 latch.hasQueuedThreads());\n         Thread[] testThread = new TestThread[30];\n         for (int i = 0; i < 30; i++) {\n-            testThread[i] = new TestThread(1000);\n+            testThread[i] = new TestThread(latch, 1000);\n             testThread[i].start();\n         }\n         Thread.sleep(50);\n@@ -105,12 +96,14 @@ public void testTenWait() throws Exception {\n     private class TestThread extends Thread {\n         \n         private int holdTime;\n-        \n-        public TestThread() {\n-            this(100);\n+        private LimitLatch latch;\n+\n+        public TestThread(LimitLatch latch) {\n+            this(latch, 100);\n         }\n         \n-        public TestThread(int holdTime) {\n+        public TestThread(LimitLatch latch, int holdTime) {\n+            this.latch = latch;\n             this.holdTime = holdTime;\n         }\n  \n@@ -120,6 +113,8 @@ public void run() {\n                 latch.countUpOrAwait();\n                 Thread.sleep(holdTime);\n                 latch.countDown();\n+            } catch (NullPointerException npe) {\n+                npe.printStackTrace();\n             } catch (InterruptedException x) {\n                 x.printStackTrace();\n             }",
                "additions": 17,
                "raw_url": "https://github.com/apache/tomcat80/raw/0bac6949b2008a3d03d37b1dba13eecd778d5282/test/org/apache/tomcat/util/threads/TestLimitLatch.java",
                "status": "modified",
                "changes": 39,
                "deletions": 22,
                "sha": "1c9559604df4cfb9ff78c7230af5204b59de5902",
                "blob_url": "https://github.com/apache/tomcat80/blob/0bac6949b2008a3d03d37b1dba13eecd778d5282/test/org/apache/tomcat/util/threads/TestLimitLatch.java",
                "filename": "test/org/apache/tomcat/util/threads/TestLimitLatch.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/tomcat/util/threads/TestLimitLatch.java?ref=0bac6949b2008a3d03d37b1dba13eecd778d5282"
            }
        ],
        "bug_id": "tomcat80_119",
        "parent": "https://github.com/apache/tomcat80/commit/bf5c51ee3e6e6b7db667b17aa14a38088f830ce7",
        "message": "Refactor to avoid NPEs during test\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1143488 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/d4ab3162002c6cf37f73e36875e3eb704ad74537",
        "file": [
            {
                "patch": "@@ -1115,10 +1115,11 @@ public synchronized Servlet loadServlet() throws ServletException {\n \n             classLoadTime=(int) (System.currentTimeMillis() -t1);\n \n-            singleThreadModel = servlet instanceof SingleThreadModel;\n-            if (singleThreadModel) {\n-                if (instancePool == null)\n+            if (servlet instanceof SingleThreadModel) {\n+                if (instancePool == null) {\n                     instancePool = new Stack<Servlet>();\n+                }\n+                singleThreadModel = true;\n             }\n \n             initServlet(servlet);",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/d4ab3162002c6cf37f73e36875e3eb704ad74537/java/org/apache/catalina/core/StandardWrapper.java",
                "status": "modified",
                "changes": 7,
                "deletions": 3,
                "sha": "95d857fb8822fa5d3581093ba8920243fe92460d",
                "blob_url": "https://github.com/apache/tomcat80/blob/d4ab3162002c6cf37f73e36875e3eb704ad74537/java/org/apache/catalina/core/StandardWrapper.java",
                "filename": "java/org/apache/catalina/core/StandardWrapper.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/StandardWrapper.java?ref=d4ab3162002c6cf37f73e36875e3eb704ad74537"
            },
            {
                "patch": "@@ -186,6 +186,10 @@\n         support (enhancement <bug>12428</bug>) that could trigger authentication\n         even if preemptive authentication was disabled. (markt) \n       </fix>\n+      <fix>\n+        Prevent possible NPE when serving Servlets that implement the\n+        SingleThreadModel interface. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/d4ab3162002c6cf37f73e36875e3eb704ad74537/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "1408706322c26e2bf4cada206b61ea90e1eacfac",
                "blob_url": "https://github.com/apache/tomcat80/blob/d4ab3162002c6cf37f73e36875e3eb704ad74537/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=d4ab3162002c6cf37f73e36875e3eb704ad74537"
            }
        ],
        "bug_id": "tomcat80_120",
        "parent": "https://github.com/apache/tomcat80/commit/385a83b9408c2cf7738eeecaa911a4ca2f651ff3",
        "message": "Fix possible NPE when serving STM servlets\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1141948 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/8738f5f1c9cd96c67fdd9a4bc7f455e2875cba04",
        "file": [
            {
                "patch": "@@ -114,8 +114,10 @@ public SocketProperties getSocketProperties() {\n     public void setMaxConnections(int maxCon) {\n         this.maxConnections = maxCon;\n         LimitLatch latch = this.connectionLimitLatch;\n-        // Update the latch that enforces this\n-        latch.setLimit(maxCon);\n+        if (latch != null) {\n+            // Update the latch that enforces this\n+            latch.setLimit(maxCon);\n+        }\n     }\n \n     public int  getMaxConnections() { return this.maxConnections; }",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/8738f5f1c9cd96c67fdd9a4bc7f455e2875cba04/java/org/apache/tomcat/util/net/AbstractEndpoint.java",
                "status": "modified",
                "changes": 6,
                "deletions": 2,
                "sha": "84fa371cd4deeeba3d21dcf6ba8d1430c2a96e56",
                "blob_url": "https://github.com/apache/tomcat80/blob/8738f5f1c9cd96c67fdd9a4bc7f455e2875cba04/java/org/apache/tomcat/util/net/AbstractEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/AbstractEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/AbstractEndpoint.java?ref=8738f5f1c9cd96c67fdd9a4bc7f455e2875cba04"
            }
        ],
        "bug_id": "tomcat80_121",
        "parent": "https://github.com/apache/tomcat80/commit/a6366d71b367d86dc0ad87502863b1a298349c6c",
        "message": "Fix NPE triggered by r1127962\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1128386 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/c8872e5ab58755f7477717d550c0f0465ea19b2b",
        "file": [
            {
                "patch": "@@ -92,7 +92,7 @@ public int write(ByteBuffer buf, NioChannel socket, long writeTimeout,MutableInt\n             while ( (!timedout) && buf.hasRemaining()) {\n                 if (keycount > 0) { //only write if we were registered for a write\n                     int cnt = socket.write(buf); //write the data\n-                    lastWrite.set(cnt);\n+                    if (lastWrite != null) lastWrite.set(cnt);\n                     if (cnt == -1)\n                         throw new EOFException();\n                     written += cnt;",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/c8872e5ab58755f7477717d550c0f0465ea19b2b/java/org/apache/tomcat/util/net/NioBlockingSelector.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "cc0b1d84ddc07f6a6ed0d23f85cd3ce1d43cbb86",
                "blob_url": "https://github.com/apache/tomcat80/blob/c8872e5ab58755f7477717d550c0f0465ea19b2b/java/org/apache/tomcat/util/net/NioBlockingSelector.java",
                "filename": "java/org/apache/tomcat/util/net/NioBlockingSelector.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/NioBlockingSelector.java?ref=c8872e5ab58755f7477717d550c0f0465ea19b2b"
            }
        ],
        "bug_id": "tomcat80_122",
        "parent": "https://github.com/apache/tomcat80/commit/aa8a26efb7528bfc059a10c5574d9b2d768f49d7",
        "message": "Avoid NPE is lastWrite is not being used\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1103228 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/5ec588528d46151977dd3f195d676db0095038ec",
        "file": [
            {
                "patch": "@@ -143,7 +143,7 @@ public String getCipherSuite() throws IOException {\n         }\n         if (jsseCerts == null)\n             jsseCerts = new X509Certificate[0];\n-        if(jsseCerts.length <= 0 && force) {\n+        if(jsseCerts.length <= 0 && force && ssl != null) {\n             session.invalidate();\n             handShake();\n             session = ssl.getSession();",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/5ec588528d46151977dd3f195d676db0095038ec/java/org/apache/tomcat/util/net/jsse/JSSESupport.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "757b7b8805ff50f120aa09284e98449ffd5c089d",
                "blob_url": "https://github.com/apache/tomcat80/blob/5ec588528d46151977dd3f195d676db0095038ec/java/org/apache/tomcat/util/net/jsse/JSSESupport.java",
                "filename": "java/org/apache/tomcat/util/net/jsse/JSSESupport.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/jsse/JSSESupport.java?ref=5ec588528d46151977dd3f195d676db0095038ec"
            }
        ],
        "bug_id": "tomcat80_123",
        "parent": "https://github.com/apache/tomcat80/commit/8f3dc550be11839e8da55b244c312678d9d6c5ca",
        "message": "Avoid NPEs trying to re-negotiate with NIO\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1074597 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/95aa0280d3e40b166177d483118b3848a25fb699",
        "file": [
            {
                "patch": "@@ -125,10 +125,13 @@ public void invoke(Request request, Response response) throws IOException,\n \n             // Is this a crawler - cheack the UA headers\n             Enumeration<String> uaHeaders = request.getHeaders(\"user-agent\");\n-            String uaHeader = uaHeaders.nextElement();\n+            String uaHeader = null;\n+            if (uaHeaders.hasMoreElements()) {\n+                uaHeader = uaHeaders.nextElement();\n+            }\n             \n             // If more than one UA header - assume not a bot\n-            if (!uaHeaders.hasMoreElements()) {\n+            if (uaHeader != null && !uaHeaders.hasMoreElements()) {\n \n                 if (log.isDebugEnabled()) {\n                     log.debug(request.hashCode() + \": UserAgent=\" + uaHeader);",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/95aa0280d3e40b166177d483118b3848a25fb699/java/org/apache/catalina/valves/CrawlerSessionManagerValve.java",
                "status": "modified",
                "changes": 7,
                "deletions": 2,
                "sha": "c0f88818a937c0a9acfb104ed69381a2e7f52451",
                "blob_url": "https://github.com/apache/tomcat80/blob/95aa0280d3e40b166177d483118b3848a25fb699/java/org/apache/catalina/valves/CrawlerSessionManagerValve.java",
                "filename": "java/org/apache/catalina/valves/CrawlerSessionManagerValve.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/valves/CrawlerSessionManagerValve.java?ref=95aa0280d3e40b166177d483118b3848a25fb699"
            }
        ],
        "bug_id": "tomcat80_124",
        "parent": "https://github.com/apache/tomcat80/commit/9e6928af15369e67a5b05cf8d8a8682376143fd2",
        "message": "Avoid NPE if no u-a header\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1074159 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/2e793b3151fda0e67e19cca835a225887073f69e",
        "file": [
            {
                "patch": "@@ -70,7 +70,14 @@ public void invoke(Request request, Response response) throws IOException, Servl\n             this.serverPort = request.getServerPort();\n         }\n     }\n-    \n+\n+    public static class MockRequest extends Request {\n+        @Override\n+        public void setAttribute(String name, Object value) {\n+            // NOOP. Prevents NPE during testing.\n+        }\n+    }\n+\n     public void testListToCommaDelimitedString() {\n         List<String> elements = Arrays.asList(\"element1\", \"element2\", \"element3\");\n         String actual = RemoteIpValve.listToCommaDelimitedString(elements);\n@@ -98,7 +105,7 @@ public void testInvokeAllowedRemoteAddrWithNullRemoteIpHeader() throws Exception\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         request.setRemoteAddr(\"192.168.0.10\");\n         request.setRemoteHost(\"remote-host-original-value\");\n@@ -138,7 +145,7 @@ public void testInvokeAllProxiesAreTrusted() throws Exception {\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         request.setRemoteAddr(\"192.168.0.10\");\n         request.setRemoteHost(\"remote-host-original-value\");\n@@ -178,7 +185,7 @@ public void testInvokeAllProxiesAreTrustedOrInternal() throws Exception {\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         request.setRemoteAddr(\"192.168.0.10\");\n         request.setRemoteHost(\"remote-host-original-value\");\n@@ -219,7 +226,7 @@ public void testInvokeAllProxiesAreInternal() throws Exception {\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         request.setRemoteAddr(\"192.168.0.10\");\n         request.setRemoteHost(\"remote-host-original-value\");\n@@ -259,7 +266,7 @@ public void testInvokeAllProxiesAreTrustedAndRemoteAddrMatchRegexp() throws Exce\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         request.setRemoteAddr(\"192.168.0.10\");\n         request.setRemoteHost(\"remote-host-original-value\");\n@@ -299,7 +306,7 @@ public void testInvokeXforwardedProtoSaysHttpsForIncomingHttpRequest() throws Ex\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         // client ip\n         request.setRemoteAddr(\"192.168.0.10\");\n@@ -363,7 +370,7 @@ public void testInvokeXforwardedProtoIsNullForIncomingHttpRequest() throws Excep\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         // client ip\n         request.setRemoteAddr(\"192.168.0.10\");\n@@ -427,7 +434,7 @@ public void testInvokeXforwardedProtoSaysHttpForIncomingHttpsRequest() throws Ex\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         // client ip\n         request.setRemoteAddr(\"192.168.0.10\");\n@@ -491,7 +498,7 @@ public void testInvokeXforwardedProtoIsNullForIncomingHttpsRequest() throws Exce\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         // client ip\n         request.setRemoteAddr(\"192.168.0.10\");\n@@ -556,7 +563,7 @@ public void testInvokeNotAllowedRemoteAddr() throws Exception {\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         request.setRemoteAddr(\"not-allowed-internal-proxy\");\n         request.setRemoteHost(\"not-allowed-internal-proxy-host\");\n@@ -595,7 +602,7 @@ public void testInvokeUntrustedProxyInTheChain() throws Exception {\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         request.setRemoteAddr(\"192.168.0.10\");\n         request.setRemoteHost(\"remote-host-original-value\");",
                "additions": 19,
                "raw_url": "https://github.com/apache/tomcat80/raw/2e793b3151fda0e67e19cca835a225887073f69e/test/org/apache/catalina/valves/TestRemoteIpValve.java",
                "status": "modified",
                "changes": 31,
                "deletions": 12,
                "sha": "13812533fe71d2e464b1fe4275c5a7af6b37448d",
                "blob_url": "https://github.com/apache/tomcat80/blob/2e793b3151fda0e67e19cca835a225887073f69e/test/org/apache/catalina/valves/TestRemoteIpValve.java",
                "filename": "test/org/apache/catalina/valves/TestRemoteIpValve.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/valves/TestRemoteIpValve.java?ref=2e793b3151fda0e67e19cca835a225887073f69e"
            }
        ],
        "bug_id": "tomcat80_125",
        "parent": "https://github.com/apache/tomcat80/commit/e30f94e3d0e263dfae4d4801b8340cdbb22e34b2",
        "message": "Prevent NPE in unit tests as a result of r1067718\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1071559 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/9c088d6c4bae793af1a4fbf1402a996ef0821bf1",
        "file": [
            {
                "patch": "@@ -118,6 +118,11 @@ public void addHeader(String name, String value) {\n         public void setScheme(String scheme) {\n             getCoyoteRequest().scheme().setString(scheme);\n         }\n+\n+        @Override\n+        public void setAttribute(String name, Object value) {\n+            // NOOP. Prevents NPE during testing.\n+        }\n     }\n \n     public static final String TEMP_DIR = System.getProperty(\"java.io.tmpdir\");",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/9c088d6c4bae793af1a4fbf1402a996ef0821bf1/test/org/apache/catalina/filters/TestRemoteIpFilter.java",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "4c3be0f9cc392f791a8e73aac02ae5dab3ef0071",
                "blob_url": "https://github.com/apache/tomcat80/blob/9c088d6c4bae793af1a4fbf1402a996ef0821bf1/test/org/apache/catalina/filters/TestRemoteIpFilter.java",
                "filename": "test/org/apache/catalina/filters/TestRemoteIpFilter.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/filters/TestRemoteIpFilter.java?ref=9c088d6c4bae793af1a4fbf1402a996ef0821bf1"
            }
        ],
        "bug_id": "tomcat80_126",
        "parent": "https://github.com/apache/tomcat80/commit/3ffa3bd00398bf3ea88be7b04c9b791e0b55e04c",
        "message": "Prevent NPE in unit tests as a result of r1067718\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1071556 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/7752a105d4444c41eaa22cee0b796147245788f3",
        "file": [
            {
                "patch": "@@ -111,10 +111,16 @@ public MimePartDataSource run() {\n                     MimeMessage message = new MimeMessage(\n                         Session.getInstance(props));\n                     try {\n-                        String from = (String)ref.get(\"mail.from\").getContent();\n-                        message.setFrom(new InternetAddress(from));\n+                        RefAddr fromAddr = ref.get(\"mail.from\");\n+                        String from = null;\n+                        if (fromAddr != null) {\n+                            from = (String)ref.get(\"mail.from\").getContent();\n+                        }\n+                        if (from != null) {\n+                            message.setFrom(new InternetAddress(from));\n+                        }\n                         message.setSubject(\"\");\n-                    } catch (Exception e) {}\n+                    } catch (Exception e) {/*Ignore*/}\n                     MimePartDataSource mds = new MimePartDataSource(message);\n                     return mds;\n                 }",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/7752a105d4444c41eaa22cee0b796147245788f3/java/org/apache/naming/factory/SendMailFactory.java",
                "status": "modified",
                "changes": 12,
                "deletions": 3,
                "sha": "16aeb79031197547be2dd41165acc28a65f2c145",
                "blob_url": "https://github.com/apache/tomcat80/blob/7752a105d4444c41eaa22cee0b796147245788f3/java/org/apache/naming/factory/SendMailFactory.java",
                "filename": "java/org/apache/naming/factory/SendMailFactory.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/naming/factory/SendMailFactory.java?ref=7752a105d4444c41eaa22cee0b796147245788f3"
            },
            {
                "patch": "@@ -48,6 +48,13 @@\n     <Method name=\"run\"/>\n     <Bug code=\"NS\"/>\n   </Match>\n+  <Match>\n+    <!-- Simpler to catch Exception than to create dummy implementations of the\n+         necessary exception hierarchy -->\n+    <Class name=\"org.apache.naming.factory.SendMailFactory$1\" />\n+    <Method name=\"run\" />\n+    <Bug code=\"DE\" />\n+  </Match>\n   <Match>\n     <!-- Class name needs to start with a lower case letter in this case -->\n     <Class name=\"org.apache.naming.java.javaURLContextFactory\" />",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/7752a105d4444c41eaa22cee0b796147245788f3/res/findbugs/filter-false-positives.xml",
                "status": "modified",
                "changes": 7,
                "deletions": 0,
                "sha": "27d436837317d488fc7840a5835dc58a2b69d727",
                "blob_url": "https://github.com/apache/tomcat80/blob/7752a105d4444c41eaa22cee0b796147245788f3/res/findbugs/filter-false-positives.xml",
                "filename": "res/findbugs/filter-false-positives.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/res/findbugs/filter-false-positives.xml?ref=7752a105d4444c41eaa22cee0b796147245788f3"
            }
        ],
        "bug_id": "tomcat80_127",
        "parent": "https://github.com/apache/tomcat80/commit/894677d433c98bc08b4ce590115de3e3c032d2e1",
        "message": "Avoid NPEs\nRemove FindBugs warning\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1059587 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/0ec545001e52bdbb63155f36166f40abd3e530a6",
        "file": [
            {
                "patch": "@@ -1648,7 +1648,7 @@ public static String getDomain(Container container) {\n         \n         Container c = container;\n         \n-        while (!(c instanceof Engine)) {\n+        while (!(c instanceof Engine) && c != null) {\n             c = c.getParent();\n         }\n         ",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/0ec545001e52bdbb63155f36166f40abd3e530a6/java/org/apache/catalina/mbeans/MBeanUtils.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "7a62c2d24f19632b82ef86da5ec9d6f9e997b43e",
                "blob_url": "https://github.com/apache/tomcat80/blob/0ec545001e52bdbb63155f36166f40abd3e530a6/java/org/apache/catalina/mbeans/MBeanUtils.java",
                "filename": "java/org/apache/catalina/mbeans/MBeanUtils.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/mbeans/MBeanUtils.java?ref=0ec545001e52bdbb63155f36166f40abd3e530a6"
            }
        ],
        "bug_id": "tomcat80_128",
        "parent": "https://github.com/apache/tomcat80/commit/80a3055f01ee1d792c43a0b7b1634373034a2887",
        "message": "Protect against unlikely NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1041458 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/f95f9d9faf31925b7acb1bf457670ed2a047d954",
        "file": [
            {
                "patch": "@@ -905,9 +905,9 @@ public Session findSession(String id) throws IOException {\n      */\n     @Override\n     public void remove(Session session) {\n-\n-        sessions.remove(session.getIdInternal());\n-\n+        if (session.getIdInternal() != null) {\n+            sessions.remove(session.getIdInternal());\n+        }\n     }\n \n ",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/f95f9d9faf31925b7acb1bf457670ed2a047d954/java/org/apache/catalina/session/ManagerBase.java",
                "status": "modified",
                "changes": 6,
                "deletions": 3,
                "sha": "4b2acd5f8546d1877b102f3029e5a2c8057519f8",
                "blob_url": "https://github.com/apache/tomcat80/blob/f95f9d9faf31925b7acb1bf457670ed2a047d954/java/org/apache/catalina/session/ManagerBase.java",
                "filename": "java/org/apache/catalina/session/ManagerBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/session/ManagerBase.java?ref=f95f9d9faf31925b7acb1bf457670ed2a047d954"
            }
        ],
        "bug_id": "tomcat80_129",
        "parent": "https://github.com/apache/tomcat80/commit/a97ffc5a50b14e06ba1b3e414e7a81887a8c5c65",
        "message": "Avoid NPE when removing sessions\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1035685 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/930b628f0b9e1ec07f150e48ad3468d13621e421",
        "file": [
            {
                "patch": "@@ -551,7 +551,7 @@ public void load() {\n                     Exception exception = ex.getException();\n                     log.error(\"Exception in the Store during load: \"\n                               + exception);\n-                    exception.printStackTrace();                        \n+                    return;\n                 }\n             } else {\n                 ids = store.keys();",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/930b628f0b9e1ec07f150e48ad3468d13621e421/java/org/apache/catalina/session/PersistentManagerBase.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "8a7d3c8bf04e0df5f8fa13a8896c71ae83ff6f08",
                "blob_url": "https://github.com/apache/tomcat80/blob/930b628f0b9e1ec07f150e48ad3468d13621e421/java/org/apache/catalina/session/PersistentManagerBase.java",
                "filename": "java/org/apache/catalina/session/PersistentManagerBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/session/PersistentManagerBase.java?ref=930b628f0b9e1ec07f150e48ad3468d13621e421"
            }
        ],
        "bug_id": "tomcat80_130",
        "parent": "https://github.com/apache/tomcat80/commit/b24893eb9641a85d759bcdf4489bd43054132b63",
        "message": "Avoid NPE\nDon't use exception.printStackTrace()\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1026784 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/a1356afa8985eb90df9d52a77016b850f575f324",
        "file": [
            {
                "patch": "@@ -144,8 +144,10 @@ public void flush() throws IOException {\n     @Override\n     public void recycle() {\n         super.recycle();\n-        socket.getBufHandler().getWriteBuffer().clear();\n-        socket = null;\n+        if (socket != null) {\n+            socket.getBufHandler().getWriteBuffer().clear();\n+            socket = null;\n+        }\n         lastWrite.set(1);\n     }\n ",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/a1356afa8985eb90df9d52a77016b850f575f324/java/org/apache/coyote/http11/InternalNioOutputBuffer.java",
                "status": "modified",
                "changes": 6,
                "deletions": 2,
                "sha": "4468b0d900eddc93d9dfba0fb2ff3e5ec886f093",
                "blob_url": "https://github.com/apache/tomcat80/blob/a1356afa8985eb90df9d52a77016b850f575f324/java/org/apache/coyote/http11/InternalNioOutputBuffer.java",
                "filename": "java/org/apache/coyote/http11/InternalNioOutputBuffer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/http11/InternalNioOutputBuffer.java?ref=a1356afa8985eb90df9d52a77016b850f575f324"
            }
        ],
        "bug_id": "tomcat80_131",
        "parent": "https://github.com/apache/tomcat80/commit/463c022fc0f7576fc3168dc971a1886421db728a",
        "message": "Avoid NPE triggered when running TCK tests\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1022478 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/ba8e75b4785051d18644d732d89ce6c183c18f54",
        "file": [
            {
                "patch": "@@ -902,7 +902,7 @@ public Object get(Object key) {\n                 entry.setBackupNodes(backup);\n                 entry.setBackup(false);\n                 entry.setProxy(false);\n-                getMapOwner().objectMadePrimay(key, entry.getValue());\n+                if ( getMapOwner()!=null ) getMapOwner().objectMadePrimay(key, entry.getValue());\n \n             } catch (Exception x) {\n                 log.error(\"Unable to replicate out data for a LazyReplicatedMap.get operation\", x);",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/ba8e75b4785051d18644d732d89ce6c183c18f54/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "2c9afd6d51682b8eb6ab77a98ceca8826e022eb1",
                "blob_url": "https://github.com/apache/tomcat80/blob/ba8e75b4785051d18644d732d89ce6c183c18f54/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "filename": "java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java?ref=ba8e75b4785051d18644d732d89ce6c183c18f54"
            }
        ],
        "bug_id": "tomcat80_132",
        "parent": "https://github.com/apache/tomcat80/commit/32e522b6d779f0a2b8be2251e8547d02ce35be6e",
        "message": "Avoid NPE when mapOwner is null.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1002935 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/b96e77a1a89a74337fedccbf024a67483e6d1843",
        "file": [
            {
                "patch": "@@ -508,11 +508,10 @@ protected boolean processSocket(Socket socket) {\n             SocketWrapper<Socket> wrapper = new SocketWrapper<Socket>(socket);\n             wrapper.setKeepAliveLeft(getMaxKeepAliveRequests());\n             // During shutdown, executor may be null - avoid NPE\n-            if (running) {\n-                getExecutor().execute(new SocketProcessor(wrapper));\n-                return true;\n+            if (!running) {\n+                return false;\n             }\n-            return false;\n+            getExecutor().execute(new SocketProcessor(wrapper));\n         } catch (RejectedExecutionException x) {\n             log.warn(\"Socket processing request was rejected for:\"+socket,x);\n             return false;\n@@ -522,6 +521,7 @@ protected boolean processSocket(Socket socket) {\n             log.error(sm.getString(\"endpoint.process.fail\"), t);\n             return false;\n         }\n+        return true;\n     }\n     \n     \n@@ -553,6 +553,10 @@ public boolean processSocket(SocketWrapper<Socket> socket, SocketStatus status)\n                         Thread.currentThread().setContextClassLoader(\n                                 getClass().getClassLoader());\n                     }\n+                    // During shutdown, executor may be null - avoid NPE\n+                    if (!running) {\n+                        return false;\n+                    }\n                     getExecutor().execute(proc);\n                 }finally {\n                     if (Globals.IS_SECURITY_ENABLED) {",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/b96e77a1a89a74337fedccbf024a67483e6d1843/java/org/apache/tomcat/util/net/JIoEndpoint.java",
                "status": "modified",
                "changes": 12,
                "deletions": 4,
                "sha": "6d5dc613edbbd39200bf6a905a8c5fd0b759983d",
                "blob_url": "https://github.com/apache/tomcat80/blob/b96e77a1a89a74337fedccbf024a67483e6d1843/java/org/apache/tomcat/util/net/JIoEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/JIoEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/JIoEndpoint.java?ref=b96e77a1a89a74337fedccbf024a67483e6d1843"
            }
        ],
        "bug_id": "tomcat80_133",
        "parent": "https://github.com/apache/tomcat80/commit/c89f3f500b579a92d0f8131914069ecfd882f4d2",
        "message": "More NPE avoidance.\nKeep process methods aligned.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1001552 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/d752cfad8b982bf75549b0480e4cd373e31066ff",
        "file": [
            {
                "patch": "@@ -1033,6 +1033,11 @@ public ClusterMessage requestCompleted(String sessionId, boolean expires) {\n         DeltaSession session = null;\n         try {\n             session = (DeltaSession) findSession(sessionId);\n+            if (session == null) {\n+                // A parallel request has called session.invalidate() which has\n+                // remove the session from the Manager.\n+                return null;\n+            }\n             DeltaRequest deltaRequest = session.getDeltaRequest();\n             session.lock();\n             SessionMessage msg = null;",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/d752cfad8b982bf75549b0480e4cd373e31066ff/java/org/apache/catalina/ha/session/DeltaManager.java",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "1388efdbe42dcc428f290798ab7ce319f6d4859e",
                "blob_url": "https://github.com/apache/tomcat80/blob/d752cfad8b982bf75549b0480e4cd373e31066ff/java/org/apache/catalina/ha/session/DeltaManager.java",
                "filename": "java/org/apache/catalina/ha/session/DeltaManager.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/ha/session/DeltaManager.java?ref=d752cfad8b982bf75549b0480e4cd373e31066ff"
            },
            {
                "patch": "@@ -186,6 +186,11 @@\n         Add support for LAST_ACCESS_AT_START system property to DeltaSession. \n         (kfujino)\n       </fix>\n+      <fix>\n+        Avoid a NPE in the DeltaManager when a parallel request invalidates the\n+        session before the current request has a chance to send the replication\n+        message. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Web applications\">",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/d752cfad8b982bf75549b0480e4cd373e31066ff/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "4c4cbf86a5d72e8de36476b928f09b62eafe048d",
                "blob_url": "https://github.com/apache/tomcat80/blob/d752cfad8b982bf75549b0480e4cd373e31066ff/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=d752cfad8b982bf75549b0480e4cd373e31066ff"
            }
        ],
        "bug_id": "tomcat80_134",
        "parent": "https://github.com/apache/tomcat80/commit/7f9880912d6db075fd715327fc9c1350da215921",
        "message": "Avoid NPE when a parallel request invalidates the current session\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@993042 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/fe5f290bd0c8e8b4fb949d4e097dbbc418187a68",
        "file": [
            {
                "patch": "@@ -483,17 +483,15 @@ public String getClasspath() {\n      * such that the loaded classes should be reloaded?\n      */\n     public boolean modified() {\n-\n-        return (classLoader.modified());\n-\n+        return classLoader != null ? classLoader.modified() : false ;\n     }\n \n \n     /**\n      * Used to periodically signal to the classloader to release JAR resources.\n      */\n     public void closeJARs(boolean force) {\n-        if (classLoader !=null){\n+        if (classLoader !=null) {\n             classLoader.closeJARs(force);\n         }\n     }",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/fe5f290bd0c8e8b4fb949d4e097dbbc418187a68/java/org/apache/catalina/loader/WebappLoader.java",
                "status": "modified",
                "changes": 6,
                "deletions": 4,
                "sha": "f5bcac311ded08843a0f5fc87b6ae560a2ed02a1",
                "blob_url": "https://github.com/apache/tomcat80/blob/fe5f290bd0c8e8b4fb949d4e097dbbc418187a68/java/org/apache/catalina/loader/WebappLoader.java",
                "filename": "java/org/apache/catalina/loader/WebappLoader.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/loader/WebappLoader.java?ref=fe5f290bd0c8e8b4fb949d4e097dbbc418187a68"
            },
            {
                "patch": "@@ -0,0 +1,67 @@\n+/*\n+ *  Licensed to the Apache Software Foundation (ASF) under one or more\n+ *  contributor license agreements.  See the NOTICE file distributed with\n+ *  this work for additional information regarding copyright ownership.\n+ *  The ASF licenses this file to You under the Apache License, Version 2.0\n+ *  (the \"License\"); you may not use this file except in compliance with\n+ *  the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package org.apache.catalina.loader;\n+\n+import java.io.File;\n+\n+import org.apache.catalina.core.StandardContext;\n+import org.apache.catalina.startup.Tomcat;\n+import org.apache.catalina.startup.TomcatBaseTest;\n+import org.apache.naming.resources.FileDirContext;\n+\n+public class TestVirtualWebappLoader extends TomcatBaseTest {\n+\n+    public void testModified() throws Exception {\n+        WebappLoader loader = new WebappLoader();\n+        assertNull(loader.getClassLoader());\n+        assertFalse(loader.modified());\n+    }\n+    \n+    public void testStartInternal() throws Exception {\n+        Tomcat tomcat = getTomcatInstance();\n+        File appDir = new File(\"test/webapp-3.0\");      \n+        // Must have a real docBase - just use temp\n+        StandardContext ctx = \n+            (StandardContext)tomcat.addContext(\"/\",  appDir.getAbsolutePath());\n+\n+        VirtualWebappLoader loader = new VirtualWebappLoader();\n+         \n+        loader.setContainer(ctx);\n+        ctx.setLoader(loader);\n+        ctx.setResources(new FileDirContext());\n+        ctx.resourcesStart();\n+        File dir = new File(\"test/webapp-3.0-fragments/WEB-INF/lib\");\n+        loader.setVirtualClasspath(dir.getAbsolutePath() + \"/*.jar\");\n+        loader.startInternal();\n+        String[] repos = loader.getRepositories();\n+        assertEquals(2,repos.length);\n+        loader.stopInternal();\n+        // ToDo: Why doesn't remove repositories?\n+        repos = loader.getRepositories();\n+        assertEquals(2, repos.length);\n+        \n+        // no leak\n+        loader.startInternal();\n+        repos = loader.getRepositories();\n+        assertEquals(2,repos.length);\n+        \n+        // clear loader\n+        ctx.setLoader(null);\n+        // see tearDown()!\n+        tomcat.start();\n+    }\n+}",
                "additions": 67,
                "raw_url": "https://github.com/apache/tomcat80/raw/fe5f290bd0c8e8b4fb949d4e097dbbc418187a68/test/org/apache/catalina/loader/TestVirtualWebappLoader.java",
                "status": "added",
                "changes": 67,
                "deletions": 0,
                "sha": "4e3cdb7d2d46094f1b6a67ac5ebc2efd668776f1",
                "blob_url": "https://github.com/apache/tomcat80/blob/fe5f290bd0c8e8b4fb949d4e097dbbc418187a68/test/org/apache/catalina/loader/TestVirtualWebappLoader.java",
                "filename": "test/org/apache/catalina/loader/TestVirtualWebappLoader.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/loader/TestVirtualWebappLoader.java?ref=fe5f290bd0c8e8b4fb949d4e097dbbc418187a68"
            }
        ],
        "bug_id": "tomcat80_135",
        "parent": "https://github.com/apache/tomcat80/commit/ac3378c67d22428573a27053b8f02614191021a1",
        "message": "Fix NPE and add small test case to check VirtualWebappLoader.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@960284 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/818a9a962bdfab5bf66d330734c0225c0877f64a",
        "file": [
            {
                "patch": "@@ -2513,9 +2513,13 @@ private void parseParts() {\n                 parts.add(part);\n                 if (part.getFilename() == null) {\n                     try {\n-                        parameters.addParameterValues(part.getName(),\n+                        String encoding = parameters.getEncoding();\n+                        if(encoding == null) {\n+                        \tencoding = Parameters.DEFAULT_ENCODING;\n+                        }\n+ \t\t\t\t\t\tparameters.addParameterValues(part.getName(),\n                                 new String[] {part.getString(\n-                                        parameters.getEncoding())});\n+                                        encoding)});\n                     } catch (UnsupportedEncodingException uee) {\n                         try {\n                             parameters.addParameterValues(part.getName(),\n@@ -2533,7 +2537,7 @@ private void parseParts() {\n         } catch (FileUploadBase.SizeException e) {\n             partsParseException = new IllegalStateException(e);\n         } catch (FileUploadException e) {\n-            partsParseException = new IOException();\n+            partsParseException = new IOException(e);\n         }\n         \n         return;",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/818a9a962bdfab5bf66d330734c0225c0877f64a/java/org/apache/catalina/connector/Request.java",
                "status": "modified",
                "changes": 10,
                "deletions": 3,
                "sha": "f187eacdfc96caed57f84524c4057d2297eb2755",
                "blob_url": "https://github.com/apache/tomcat80/blob/818a9a962bdfab5bf66d330734c0225c0877f64a/java/org/apache/catalina/connector/Request.java",
                "filename": "java/org/apache/catalina/connector/Request.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/Request.java?ref=818a9a962bdfab5bf66d330734c0225c0877f64a"
            }
        ],
        "bug_id": "tomcat80_136",
        "parent": "https://github.com/apache/tomcat80/commit/7b2dc061c7e6483cde3dbc51ee7f7df9f1fc9832",
        "message": "Fix NPE if no encoding parameter exists at request!\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@939639 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/997471832bd5bac0055b7bfaedb6f0db24ea42cd",
        "file": [
            {
                "patch": "@@ -36,7 +36,8 @@ public void testTimerThreadLeak() throws Exception {\n         // If the thread still exists, we have a thread/memory leak\n         Thread[] threads = getThreads();\n         for (Thread thread : threads) {\n-            if (thread.getName().equals(TaskServlet.TIMER_THREAD_NAME)) {\n+            if (thread != null &&\n+                    TaskServlet.TIMER_THREAD_NAME.equals(thread.getName())) {\n                 fail(\"Timer thread still running\");\n             }\n         }",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/997471832bd5bac0055b7bfaedb6f0db24ea42cd/test/org/apache/catalina/loader/TestWebappClassLoaderMemoryLeak.java",
                "status": "modified",
                "changes": 3,
                "deletions": 1,
                "sha": "52882bd68e7d16e8979e67509f705814e8ebb113",
                "blob_url": "https://github.com/apache/tomcat80/blob/997471832bd5bac0055b7bfaedb6f0db24ea42cd/test/org/apache/catalina/loader/TestWebappClassLoaderMemoryLeak.java",
                "filename": "test/org/apache/catalina/loader/TestWebappClassLoaderMemoryLeak.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/loader/TestWebappClassLoaderMemoryLeak.java?ref=997471832bd5bac0055b7bfaedb6f0db24ea42cd"
            }
        ],
        "bug_id": "tomcat80_137",
        "parent": "https://github.com/apache/tomcat80/commit/0d4d9996af1be0bf038fcb0ec64dd10d70793941",
        "message": "Protect against NPE whilst running the test\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@907651 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/bea00bb9065b096e2b26e2e1603fd2e6ebb50200",
        "file": [
            {
                "patch": "@@ -109,7 +109,10 @@ public String getString(String key) {\n         String str = null;\n \n         try {\n-            str = bundle.getString(key);\n+            // Avoid NPE if bundle is null and treat it like an MRE\n+            if (bundle != null) {\n+                str = bundle.getString(key);\n+            }\n         } catch(MissingResourceException mre) {\n             //bad: shouldn't mask an exception the following way:\n             //   str = \"[cannot find message associated with key '\" + key + \"' due to \" + mre + \"]\";",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/bea00bb9065b096e2b26e2e1603fd2e6ebb50200/java/org/apache/tomcat/util/res/StringManager.java",
                "status": "modified",
                "changes": 5,
                "deletions": 1,
                "sha": "4f3eb189e803b275d44db891ed3ede214229e8de",
                "blob_url": "https://github.com/apache/tomcat80/blob/bea00bb9065b096e2b26e2e1603fd2e6ebb50200/java/org/apache/tomcat/util/res/StringManager.java",
                "filename": "java/org/apache/tomcat/util/res/StringManager.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/res/StringManager.java?ref=bea00bb9065b096e2b26e2e1603fd2e6ebb50200"
            }
        ],
        "bug_id": "tomcat80_138",
        "parent": "https://github.com/apache/tomcat80/commit/1d2db306032e5e3ef0d69ed1ee1d3c3dd0e71545",
        "message": "Avoid NPE if bundle is missing\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@898297 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/33f2b557bc35f0f379a2f201c20ae66e6f5d78d0",
        "file": [
            {
                "patch": "@@ -706,15 +706,19 @@ public boolean merge(Set<WebXml> fragments) {\n                     mergeFilter(entry.getValue(),\n                             filters.get(entry.getKey()), false);\n                 } else {\n-                    if (!(mergeFilter(entry.getValue(),\n-                            temp.getFilters().get(entry.getKey()), true))) {\n-                        log.error(sm.getString(\n-                                \"webXml.mergeConflictFilter\",\n-                                entry.getKey(),\n-                                fragment.getName(),\n-                                fragment.getURL()));\n-\n-                        return false;\n+                    if (temp.getFilters().containsKey(entry.getKey())) {\n+                        if (!(mergeFilter(entry.getValue(),\n+                                temp.getFilters().get(entry.getKey()), true))) {\n+                            log.error(sm.getString(\n+                                    \"webXml.mergeConflictFilter\",\n+                                    entry.getKey(),\n+                                    fragment.getName(),\n+                                    fragment.getURL()));\n+    \n+                            return false;\n+                        }\n+                    } else {\n+                        temp.getFilters().put(entry.getKey(), entry.getValue());\n                     }\n                 }\n             }\n@@ -845,15 +849,19 @@ public boolean merge(Set<WebXml> fragments) {\n                     mergeServlet(entry.getValue(),\n                             servlets.get(entry.getKey()), false);\n                 } else {\n-                    if (!(mergeServlet(entry.getValue(),\n-                            temp.getServlets().get(entry.getKey()), true))) {\n-                        log.error(sm.getString(\n-                                \"webXml.mergeConflictServlet\",\n-                                entry.getKey(),\n-                                fragment.getName(),\n-                                fragment.getURL()));\n-\n-                        return false;\n+                    if (temp.getServlets().containsKey(entry.getKey())) {\n+                        if (!(mergeServlet(entry.getValue(),\n+                                temp.getServlets().get(entry.getKey()), true))) {\n+                            log.error(sm.getString(\n+                                    \"webXml.mergeConflictServlet\",\n+                                    entry.getKey(),\n+                                    fragment.getName(),\n+                                    fragment.getURL()));\n+    \n+                            return false;\n+                        }\n+                    } else {\n+                        temp.getServlets().put(entry.getKey(), entry.getValue());\n                     }\n                 }\n             }",
                "additions": 26,
                "raw_url": "https://github.com/apache/tomcat80/raw/33f2b557bc35f0f379a2f201c20ae66e6f5d78d0/java/org/apache/catalina/startup/WebXml.java",
                "status": "modified",
                "changes": 44,
                "deletions": 18,
                "sha": "f258459e5de670dd42ccf9682718cdc81bf36588",
                "blob_url": "https://github.com/apache/tomcat80/blob/33f2b557bc35f0f379a2f201c20ae66e6f5d78d0/java/org/apache/catalina/startup/WebXml.java",
                "filename": "java/org/apache/catalina/startup/WebXml.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/startup/WebXml.java?ref=33f2b557bc35f0f379a2f201c20ae66e6f5d78d0"
            }
        ],
        "bug_id": "tomcat80_139",
        "parent": "https://github.com/apache/tomcat80/commit/59167839576902a959bd97fcdf73077be3084f54",
        "message": "Fix a couple of potential NPEs\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@888203 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/84cac67c7ebdaebe71aa14ab60973379c63720d1",
        "file": [
            {
                "patch": "@@ -1191,9 +1191,14 @@ protected InputSource getGlobalWebXmlSource() {\n     protected InputSource getHostWebXmlSource() {\n         String resourceName = getHostConfigPath(Constants.HostWebXml);\n         \n+        // In an embedded environment, configBase might not be set\n+        File configBase = getConfigBase();\n+        if (configBase == null)\n+            return null;\n+        \n         String basePath = null;\n         try {\n-            basePath = getConfigBase().getCanonicalPath();\n+            basePath = configBase.getCanonicalPath();\n         } catch (IOException e) {\n             log.error(sm.getString(\"contectConfig.baseError\"), e);\n             return null;",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/84cac67c7ebdaebe71aa14ab60973379c63720d1/java/org/apache/catalina/startup/ContextConfig.java",
                "status": "modified",
                "changes": 7,
                "deletions": 1,
                "sha": "97f3951c6a53a81b4ade2f45bc90c2d9f46d4ba9",
                "blob_url": "https://github.com/apache/tomcat80/blob/84cac67c7ebdaebe71aa14ab60973379c63720d1/java/org/apache/catalina/startup/ContextConfig.java",
                "filename": "java/org/apache/catalina/startup/ContextConfig.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/startup/ContextConfig.java?ref=84cac67c7ebdaebe71aa14ab60973379c63720d1"
            }
        ],
        "bug_id": "tomcat80_140",
        "parent": "https://github.com/apache/tomcat80/commit/5790502e1d2695814392d3fa49e138b1348dd106",
        "message": "Fix possible NPE when embedded\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@817204 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/441acad794b09e7fbfec66af8766575228ec3f9f",
        "file": [
            {
                "patch": "@@ -199,7 +199,9 @@ public final void invoke(Request request, Response response)\n         // Reset comet flag value after creating the filter chain\n         request.setComet(false);\n         //check filters to see if we support async or not.\n-        request.setAsyncSupported(filterChain.isAsyncSupported());\n+        if (filterChain != null) {\n+            request.setAsyncSupported(filterChain.isAsyncSupported());\n+        }\n \n         // Call the filter chain for this request\n         // NOTE: This also calls the servlet's service() method",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/441acad794b09e7fbfec66af8766575228ec3f9f/java/org/apache/catalina/core/StandardWrapperValve.java",
                "status": "modified",
                "changes": 4,
                "deletions": 1,
                "sha": "d9dbc1bcfdc20c68dd0be1526cce88321ad4b890",
                "blob_url": "https://github.com/apache/tomcat80/blob/441acad794b09e7fbfec66af8766575228ec3f9f/java/org/apache/catalina/core/StandardWrapperValve.java",
                "filename": "java/org/apache/catalina/core/StandardWrapperValve.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/StandardWrapperValve.java?ref=441acad794b09e7fbfec66af8766575228ec3f9f"
            }
        ],
        "bug_id": "tomcat80_141",
        "parent": "https://github.com/apache/tomcat80/commit/f0851261bbc3816e670732dc20d7f236f0d4e300",
        "message": "Fix NPE if no filters are configured.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@815290 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/9468ff9afd028c7cb66abba0ada843ef9dcd0c68",
        "file": [
            {
                "patch": "@@ -510,6 +510,16 @@ protected boolean postParseRequest(org.apache.coyote.Request req,\n         }\n \n         // Parse session Id\n+        if (!request.getServletContext().getEffectiveSessionTrackingModes()\n+                .contains(SessionTrackingMode.URL)) {\n+            /* \n+             * If we saw an ID in the URL but this is disabled - remove it\n+             * Can't handle it when we parse the URL as we don't have the\n+             * context at that point\n+             */\n+            request.setRequestedSessionId(null);\n+            request.setRequestedSessionURL(false);\n+        }\n         parseSessionCookiesId(req, request);\n         parseSessionSslId(request);\n         return true;\n@@ -543,9 +553,7 @@ protected void parseSessionId(org.apache.coyote.Request req, Request request) {\n         ByteChunk uriBC = req.requestURI().getByteChunk();\n         int semicolon = uriBC.indexOf(match, 0, match.length(), 0);\n \n-        if (semicolon > 0 &&\n-                request.getServletContext().getEffectiveSessionTrackingModes()\n-                        .contains(SessionTrackingMode.URL)) {\n+        if (semicolon > 0) {\n \n             // Parse session ID, and extract it from the decoded request URI\n             int start = uriBC.getStart();",
                "additions": 11,
                "raw_url": "https://github.com/apache/tomcat80/raw/9468ff9afd028c7cb66abba0ada843ef9dcd0c68/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "status": "modified",
                "changes": 14,
                "deletions": 3,
                "sha": "ad9995784ad66a5d478e67a8b2ece3778b8e56bf",
                "blob_url": "https://github.com/apache/tomcat80/blob/9468ff9afd028c7cb66abba0ada843ef9dcd0c68/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "filename": "java/org/apache/catalina/connector/CoyoteAdapter.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/CoyoteAdapter.java?ref=9468ff9afd028c7cb66abba0ada843ef9dcd0c68"
            }
        ],
        "bug_id": "tomcat80_142",
        "parent": "https://github.com/apache/tomcat80/commit/4f5ddf594035196fef32b9e3358afc494491e00d",
        "message": "Fix NPE when not using cookies for session IDs\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@763322 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/505cb336fd5200b9830ab7612c38734508b86c6c",
        "file": [
            {
                "patch": "@@ -68,9 +68,11 @@ public static BufferPool getBufferPool() {\n                        log.warn(\"Unable to initilize BufferPool, not pooling XByteBuffer objects:\"+x.getMessage());\n                        if ( log.isDebugEnabled() ) log.debug(\"Unable to initilize BufferPool, not pooling XByteBuffer objects:\",x);\n                    }\n-                   pool.setMaxSize(DEFAULT_POOL_SIZE);\n-                   log.info(\"Created a buffer pool with max size:\"+DEFAULT_POOL_SIZE+\" bytes of type:\"+(clazz!=null?clazz.getName():\"null\"));\n-                   instance = new BufferPool(pool);\n+                   if (pool != null) {\n+                       pool.setMaxSize(DEFAULT_POOL_SIZE);\n+                       log.info(\"Created a buffer pool with max size:\"+DEFAULT_POOL_SIZE+\" bytes of type:\"+(clazz!=null?clazz.getName():\"null\"));\n+                       instance = new BufferPool(pool);\n+                   }\n                 }//end if\n             }//sync\n         }//end if",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/505cb336fd5200b9830ab7612c38734508b86c6c/java/org/apache/catalina/tribes/io/BufferPool.java",
                "status": "modified",
                "changes": 8,
                "deletions": 3,
                "sha": "bd236b92c3c7f1a3def6447bbb9b13cc7f341f64",
                "blob_url": "https://github.com/apache/tomcat80/blob/505cb336fd5200b9830ab7612c38734508b86c6c/java/org/apache/catalina/tribes/io/BufferPool.java",
                "filename": "java/org/apache/catalina/tribes/io/BufferPool.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/tribes/io/BufferPool.java?ref=505cb336fd5200b9830ab7612c38734508b86c6c"
            }
        ],
        "bug_id": "tomcat80_143",
        "parent": "https://github.com/apache/tomcat80/commit/cd1089d7a7f6548068b87e8940a4d7a179004595",
        "message": "Fix possible NPE reported by Eclipse\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@734507 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/9d41b6d6489fe95f61a6a50e7410c61df5f2664a",
        "file": [
            {
                "patch": "@@ -761,8 +761,8 @@ public SocketState process(NioChannel socket) {\n \n         public Http11NioProcessor createProcessor() {\n             Http11NioProcessor processor = new Http11NioProcessor(\n-              proto.ep.getSocketProperties().getRxBufSize(),\n-              proto.ep.getSocketProperties().getTxBufSize(), \n+              0,\n+              0, \n               proto.maxHttpHeaderSize,\n               proto.ep);\n             processor.setAdapter(proto.adapter);",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/9d41b6d6489fe95f61a6a50e7410c61df5f2664a/java/org/apache/coyote/http11/Http11NioProtocol.java",
                "status": "modified",
                "changes": 4,
                "deletions": 2,
                "sha": "a49567fcecb3ba7ea3171c58ce2116af39f214f8",
                "blob_url": "https://github.com/apache/tomcat80/blob/9d41b6d6489fe95f61a6a50e7410c61df5f2664a/java/org/apache/coyote/http11/Http11NioProtocol.java",
                "filename": "java/org/apache/coyote/http11/Http11NioProtocol.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/http11/Http11NioProtocol.java?ref=9d41b6d6489fe95f61a6a50e7410c61df5f2664a"
            },
            {
                "patch": "@@ -134,9 +134,9 @@\n     protected Integer soLingerTime = null;\n \n     /**\n-     * SO_TIMEOUT option. JVM default used if not set.\n+     * SO_TIMEOUT option. default is 20000.\n      */\n-    protected Integer soTimeout = null;\n+    protected Integer soTimeout = new Integer(20000);\n \n     /**\n      * Traffic class option, value between 0 and 255",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/9d41b6d6489fe95f61a6a50e7410c61df5f2664a/java/org/apache/tomcat/util/net/SocketProperties.java",
                "status": "modified",
                "changes": 4,
                "deletions": 2,
                "sha": "d061baa39300325db0be1441d4b6012f209b93f3",
                "blob_url": "https://github.com/apache/tomcat80/blob/9d41b6d6489fe95f61a6a50e7410c61df5f2664a/java/org/apache/tomcat/util/net/SocketProperties.java",
                "filename": "java/org/apache/tomcat/util/net/SocketProperties.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/SocketProperties.java?ref=9d41b6d6489fe95f61a6a50e7410c61df5f2664a"
            }
        ],
        "bug_id": "tomcat80_144",
        "parent": "https://github.com/apache/tomcat80/commit/718e0f9e7cd1b6d2b496306d6b88f36b1bf5644c",
        "message": "socket properties NPE fixes\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@718428 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/47cbff667bbf3b6679d626ba45de0fc769884aac",
        "file": [
            {
                "patch": "@@ -341,7 +341,7 @@ public final static void checkType(final Object obj, final Class type)\n     public final static Object coerceToType(final Object obj, final Class type)\n             throws IllegalArgumentException {\n         if (type == null || Object.class.equals(type) ||\n-                type.equals(obj.getClass())) {\n+                (obj != null && type.equals(obj.getClass()))) {\n             return obj;\n         }\n         if (String.class.equals(type)) {",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/47cbff667bbf3b6679d626ba45de0fc769884aac/java/org/apache/el/lang/ELSupport.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "5bddf4fc91bde4bca552c233ccad267ffce59ce0",
                "blob_url": "https://github.com/apache/tomcat80/blob/47cbff667bbf3b6679d626ba45de0fc769884aac/java/org/apache/el/lang/ELSupport.java",
                "filename": "java/org/apache/el/lang/ELSupport.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/el/lang/ELSupport.java?ref=47cbff667bbf3b6679d626ba45de0fc769884aac"
            }
        ],
        "bug_id": "tomcat80_145",
        "parent": "https://github.com/apache/tomcat80/commit/1b708c4027a1bb56c4e06d62575130b317e59ee8",
        "message": "Add Remy's NPE fix to trunk.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@653038 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/5f6ac3bf092435bb4b0d9954b902a7b882a35073",
        "file": [
            {
                "patch": "@@ -43,12 +43,12 @@ compile.source=1.5\n compile.target=1.5\n compile.debug=true\n \n-base-jakarta.loc=http://archive.apache.org/dist/jakarta\n+base-commons.loc=http://archive.apache.org/dist/commons\n base-tomcat.loc=http://archive.apache.org/dist/tomcat\n \n # ----- Commons Logging, version 1.1 or later -----\n commons-logging-version=1.1.1\n-commons-logging-src.loc=${base-jakarta.loc}/commons/logging/source/commons-logging-${commons-logging-version}-src.tar.gz\n+commons-logging-src.loc=${base-commons.loc}/logging/source/commons-logging-${commons-logging-version}-src.tar.gz\n \n # ----- Webservices -----\n jaxrpc-src.loc=http://repo1.maven.org/maven2/geronimo-spec/geronimo-spec-jaxrpc/1.1-rc4/geronimo-spec-jaxrpc-1.1-rc4.jar\n@@ -68,18 +68,18 @@ tomcat-native.loc=${base-tomcat.loc}/tomcat-connectors/native/tomcat-native-1.1.\n # ----- Commons DBCP, version 1.1 or later -----\n commons-dbcp.version=1.2.2\n commons-dbcp.home=${base.path}/commons-dbcp-1.2.2-src\n-commons-dbcp-src.loc=${base-jakarta.loc}/commons/dbcp/source/commons-dbcp-1.2.2-src.tar.gz\n+commons-dbcp-src.loc=${base-commons.loc}/dbcp/source/commons-dbcp-1.2.2-src.tar.gz\n \n # ----- Commons Pool, version 1.1 or later -----\n-commons-pool.home=${base.path}/commons-pool-1.3-src\n-commons-pool-src.loc=${base-jakarta.loc}/commons/pool/source/commons-pool-1.3-src.tar.gz\n+commons-pool.home=${base.path}/commons-pool-1.4-src\n+commons-pool-src.loc=${base-commons.loc}/pool/source/commons-pool-1.4-src.tar.gz\n \n # ----- Commons Collections, version 2.0 or later -----\n commons-collections.home=${base.path}/commons-collections-3.2-src\n commons-collections.lib=${commons-collections.home}\n commons-collections.jar=${commons-collections.lib}/commons-collections-3.2.jar\n commons-collections.loc=${base-jakarta.loc}/commons/collections/binaries/commons-collections-3.2.tar.gz\n-commons-collections-src.loc=${base-jakarta.loc}/commons/collections/source/commons-collections-3.2-src.tar.gz\n+commons-collections-src.loc=${base-commons.loc}/collections/source/commons-collections-3.2-src.tar.gz\n \n # ----- NSIS, version 2.0 or later -----\n nsis.home=${base.path}/nsis-2.34\n@@ -93,5 +93,5 @@ nsis.loc=${base-sf.loc}/nsis/nsis-2.34-setup.exe\n commons-daemon.home=${base.path}/commons-daemon-1.0.1\n commons-daemon.lib=${commons-daemon.home}\n commons-daemon.jar=${commons-daemon.lib}/commons-daemon.jar\n-commons-daemon.loc=${base-jakarta.loc}/commons/daemon/binaries/commons-daemon-1.0.1.tar.gz\n+commons-daemon.loc=${base-commons.loc}/daemon/binaries/commons-daemon-1.0.1.tar.gz\n commons-daemon.jsvc.tar.gz=${commons-daemon.lib}/bin/jsvc.tar.gz",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/5f6ac3bf092435bb4b0d9954b902a7b882a35073/build.properties.default",
                "status": "modified",
                "changes": 14,
                "deletions": 7,
                "sha": "5ed8ebb54f376af5f16f0780739bd3a7ad56be2c",
                "blob_url": "https://github.com/apache/tomcat80/blob/5f6ac3bf092435bb4b0d9954b902a7b882a35073/build.properties.default",
                "filename": "build.properties.default",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/build.properties.default?ref=5f6ac3bf092435bb4b0d9954b902a7b882a35073"
            },
            {
                "patch": "@@ -38,6 +38,7 @@\n \n import org.apache.catalina.Container;\n import org.apache.catalina.Context;\n+import org.apache.catalina.Manager;\n import org.apache.catalina.Session;\n import org.apache.catalina.manager.util.BaseSessionComparator;\n import org.apache.catalina.manager.util.ReverseComparator;\n@@ -440,7 +441,13 @@ public void list(HttpServletRequest request,\n                      \"/html/expire?path=\" + displayPath);\n                 args[9] = appsExpire;\n                 args[10] = sm.getString(\"htmlManagerServlet.expire.explain\");\n-                args[11] = new Integer(context.getManager().getMaxInactiveInterval()/60);\n+                Manager manager = context.getManager();\n+                if (manager == null) {\n+                    args[11] = sm.getString(\"htmlManagerServlet.noManager\");\n+                } else {\n+                    args[11] = new Integer(\n+                            context.getManager().getMaxInactiveInterval()/60);\n+                }\n                 args[12] = sm.getString(\"htmlManagerServlet.expire.unit\");\n                 \n                 args[13] = highlightColor;",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/5f6ac3bf092435bb4b0d9954b902a7b882a35073/java/org/apache/catalina/manager/HTMLManagerServlet.java",
                "status": "modified",
                "changes": 9,
                "deletions": 1,
                "sha": "79ef115c94349fcb88da53d51df63b313f8a5ca5",
                "blob_url": "https://github.com/apache/tomcat80/blob/5f6ac3bf092435bb4b0d9954b902a7b882a35073/java/org/apache/catalina/manager/HTMLManagerServlet.java",
                "filename": "java/org/apache/catalina/manager/HTMLManagerServlet.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/manager/HTMLManagerServlet.java?ref=5f6ac3bf092435bb4b0d9954b902a7b882a35073"
            },
            {
                "patch": "@@ -46,6 +46,7 @@ htmlManagerServlet.deployWar=WAR or Directory URL:\n htmlManagerServlet.list=List Applications\n htmlManagerServlet.manager=Manager\n htmlManagerServlet.messageLabel=Message:\n+htmlManagerServlet.noManager=N/A\n htmlManagerServlet.serverJVMVendor=JVM Vendor\n htmlManagerServlet.serverJVMVersion=JVM Version\n htmlManagerServlet.serverOSArch=OS Architecture",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/5f6ac3bf092435bb4b0d9954b902a7b882a35073/java/org/apache/catalina/manager/LocalStrings.properties",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "bf9916812f79e9f4302935b504273fba6934e1a2",
                "blob_url": "https://github.com/apache/tomcat80/blob/5f6ac3bf092435bb4b0d9954b902a7b882a35073/java/org/apache/catalina/manager/LocalStrings.properties",
                "filename": "java/org/apache/catalina/manager/LocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/manager/LocalStrings.properties?ref=5f6ac3bf092435bb4b0d9954b902a7b882a35073"
            }
        ],
        "bug_id": "tomcat80_146",
        "parent": "https://github.com/apache/tomcat80/commit/88169ce9273229c4e3a635c0ebeed84f80eebd1b",
        "message": "Fix bug 43468. Prevent NPE.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@612632 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/b396f28e3abadfca0b9f071dde1155a546c4e103",
        "file": [
            {
                "patch": "@@ -82,11 +82,10 @@ public void setVirtualClasspath(String path) {\n \n     @Override\n     public void start() throws LifecycleException {\n-\n         // just add any jar/directory set in virtual classpath to the\n         // repositories list before calling start on the standard WebappLoader\n         StringTokenizer tkn = new StringTokenizer(virtualClasspath, \";\");\n-        while (tkn.hasMoreTokens()) {\n+        while (tkn!=null && tkn.hasMoreTokens()) {\n             File file = new File(tkn.nextToken());\n             if (!file.exists()) {\n                 continue;",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/b396f28e3abadfca0b9f071dde1155a546c4e103/java/org/apache/catalina/loader/VirtualWebappLoader.java",
                "status": "modified",
                "changes": 3,
                "deletions": 2,
                "sha": "b218e50bd2c49d59aa1e4511c29074762456f359",
                "blob_url": "https://github.com/apache/tomcat80/blob/b396f28e3abadfca0b9f071dde1155a546c4e103/java/org/apache/catalina/loader/VirtualWebappLoader.java",
                "filename": "java/org/apache/catalina/loader/VirtualWebappLoader.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/loader/VirtualWebappLoader.java?ref=b396f28e3abadfca0b9f071dde1155a546c4e103"
            }
        ],
        "bug_id": "tomcat80_147",
        "parent": "https://github.com/apache/tomcat80/commit/c681ab19636fb5041f150d453cb7165c7e1c7183",
        "message": "Fix NPE if no classpath is set\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@567163 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/60bf63eb55348853e505eff687cb38deae66b941",
        "file": [
            {
                "patch": "@@ -511,7 +511,7 @@ public Serializable replyRequest(Serializable msg, final Member sender) {\n                 while (i.hasNext()) {\n                     Map.Entry e = (Map.Entry) i.next();\n                     MapEntry entry = (MapEntry) super.get(e.getKey());\n-                    if ( entry.isSerializable() ) {\n+                    if ( entry != null && entry.isSerializable() ) {\n                         boolean copy = (mapmsg.getMsgType() == mapmsg.MSG_STATE_COPY);\n                         MapMessage me = new MapMessage(mapContextName, \n                                                        copy?MapMessage.MSG_COPY:MapMessage.MSG_PROXY,\n@@ -719,6 +719,7 @@ public void memberDisappeared(Member member) {\n         while (i.hasNext()) {\n             Map.Entry e = (Map.Entry) i.next();\n             MapEntry entry = (MapEntry) super.get(e.getKey());\n+            if (entry==null) continue;\n             if (entry.isPrimary() && inSet(member,entry.getBackupNodes())) {\n                 if (log.isDebugEnabled()) log.debug(\"[1] Primary choosing a new backup\");\n                 try {\n@@ -977,7 +978,7 @@ public boolean containsValue(Object value) {\n                 while (i.hasNext()) {\n                     Map.Entry e = (Map.Entry) i.next();\n                     MapEntry entry = (MapEntry) super.get(e.getKey());\n-                    if (entry.isPrimary() && value.equals(entry.getValue())) return true;\n+                    if (entry!=null && entry.isPrimary() && value.equals(entry.getValue())) return true;\n                 }//while\n                 return false;\n             }//end if\n@@ -1062,7 +1063,7 @@ public Collection values() {\n             while ( i.hasNext() ) {\n                 Map.Entry e = (Map.Entry)i.next();\n                 MapEntry entry = (MapEntry)super.get(e.getKey());\n-                if ( entry.isPrimary() && entry.getValue()!=null) values.add(entry.getValue());\n+                if (entry!=null && entry.isPrimary() && entry.getValue()!=null) values.add(entry.getValue());\n             }\n             return Collections.unmodifiableCollection(values);\n         }",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/60bf63eb55348853e505eff687cb38deae66b941/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "status": "modified",
                "changes": 7,
                "deletions": 3,
                "sha": "f6acac5e9bdc3ec86a2cb980aabf9a0bacb36f88",
                "blob_url": "https://github.com/apache/tomcat80/blob/60bf63eb55348853e505eff687cb38deae66b941/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "filename": "java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java?ref=60bf63eb55348853e505eff687cb38deae66b941"
            }
        ],
        "bug_id": "tomcat80_148",
        "parent": "https://github.com/apache/tomcat80/commit/5a8fbc0a5a46d75d5bd9d0424f8666eaadaf410a",
        "message": "protect against a NPE when a member disappears\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@565433 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/b186f4b53d9d2c3119792b2af2e693701f4d3f86",
        "file": [
            {
                "patch": "@@ -16,17 +16,17 @@\n \n package org.apache.catalina.tribes.group.interceptors;\n \n+import java.text.DecimalFormat;\n+import java.util.concurrent.atomic.AtomicInteger;\n+import java.util.concurrent.atomic.AtomicLong;\n+\n import org.apache.catalina.tribes.ChannelException;\n import org.apache.catalina.tribes.ChannelMessage;\n import org.apache.catalina.tribes.Member;\n import org.apache.catalina.tribes.group.ChannelInterceptorBase;\n import org.apache.catalina.tribes.group.InterceptorPayload;\n import org.apache.catalina.tribes.io.ChannelData;\n import org.apache.catalina.tribes.io.XByteBuffer;\n-import java.text.DecimalFormat;\n-import org.apache.catalina.tribes.membership.MemberImpl;\n-import java.util.concurrent.atomic.AtomicInteger;\n-import java.util.concurrent.atomic.AtomicLong;\n \n \n \n@@ -61,7 +61,7 @@ public void sendMessage(Member[] destination, ChannelMessage msg, InterceptorPay\n             super.sendMessage(destination, msg, payload);\n         }catch ( ChannelException x ) {\n             msgTxErr.addAndGet(1);\n-            access.addAndGet(-1);\n+            if ( access.get() == 1 ) access.addAndGet(-1);\n             throw x;\n         } \n         mbTx += ((double)(bytes*destination.length))/(1024d*1024d);\n@@ -117,4 +117,44 @@ public int getInterval() {\n         return interval;\n     }\n \n+    public double getLastCnt() {\n+        return lastCnt;\n+    }\n+\n+    public double getMbAppTx() {\n+        return mbAppTx;\n+    }\n+\n+    public double getMbRx() {\n+        return mbRx;\n+    }\n+\n+    public double getMbTx() {\n+        return mbTx;\n+    }\n+\n+    public AtomicLong getMsgRxCnt() {\n+        return msgRxCnt;\n+    }\n+\n+    public AtomicLong getMsgTxCnt() {\n+        return msgTxCnt;\n+    }\n+\n+    public AtomicLong getMsgTxErr() {\n+        return msgTxErr;\n+    }\n+\n+    public long getRxStart() {\n+        return rxStart;\n+    }\n+\n+    public double getTimeTx() {\n+        return timeTx;\n+    }\n+\n+    public long getTxStart() {\n+        return txStart;\n+    }\n+\n }",
                "additions": 45,
                "raw_url": "https://github.com/apache/tomcat80/raw/b186f4b53d9d2c3119792b2af2e693701f4d3f86/java/org/apache/catalina/tribes/group/interceptors/ThroughputInterceptor.java",
                "status": "modified",
                "changes": 50,
                "deletions": 5,
                "sha": "2d4935fdddf6b452258bbba8f1c45a97d08a0b43",
                "blob_url": "https://github.com/apache/tomcat80/blob/b186f4b53d9d2c3119792b2af2e693701f4d3f86/java/org/apache/catalina/tribes/group/interceptors/ThroughputInterceptor.java",
                "filename": "java/org/apache/catalina/tribes/group/interceptors/ThroughputInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/tribes/group/interceptors/ThroughputInterceptor.java?ref=b186f4b53d9d2c3119792b2af2e693701f4d3f86"
            },
            {
                "patch": "@@ -511,7 +511,7 @@ public Serializable replyRequest(Serializable msg, final Member sender) {\n                 while (i.hasNext()) {\n                     Map.Entry e = (Map.Entry) i.next();\n                     MapEntry entry = (MapEntry) super.get(e.getKey());\n-                    if ( entry.isSerializable() ) {\n+                    if ( entry != null && entry.isSerializable() ) {\n                         boolean copy = (mapmsg.getMsgType() == mapmsg.MSG_STATE_COPY);\n                         MapMessage me = new MapMessage(mapContextName, \n                                                        copy?MapMessage.MSG_COPY:MapMessage.MSG_PROXY,\n@@ -719,6 +719,7 @@ public void memberDisappeared(Member member) {\n         while (i.hasNext()) {\n             Map.Entry e = (Map.Entry) i.next();\n             MapEntry entry = (MapEntry) super.get(e.getKey());\n+            if (entry==null) continue;\n             if (entry.isPrimary() && inSet(member,entry.getBackupNodes())) {\n                 if (log.isDebugEnabled()) log.debug(\"[1] Primary choosing a new backup\");\n                 try {\n@@ -977,7 +978,7 @@ public boolean containsValue(Object value) {\n                 while (i.hasNext()) {\n                     Map.Entry e = (Map.Entry) i.next();\n                     MapEntry entry = (MapEntry) super.get(e.getKey());\n-                    if (entry.isPrimary() && value.equals(entry.getValue())) return true;\n+                    if (entry!=null && entry.isPrimary() && value.equals(entry.getValue())) return true;\n                 }//while\n                 return false;\n             }//end if\n@@ -1062,7 +1063,7 @@ public Collection values() {\n             while ( i.hasNext() ) {\n                 Map.Entry e = (Map.Entry)i.next();\n                 MapEntry entry = (MapEntry)super.get(e.getKey());\n-                if ( entry.isPrimary() && entry.getValue()!=null) values.add(entry.getValue());\n+                if (entry!=null && entry.isPrimary() && entry.getValue()!=null) values.add(entry.getValue());\n             }\n             return Collections.unmodifiableCollection(values);\n         }",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/b186f4b53d9d2c3119792b2af2e693701f4d3f86/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "status": "modified",
                "changes": 7,
                "deletions": 3,
                "sha": "f6acac5e9bdc3ec86a2cb980aabf9a0bacb36f88",
                "blob_url": "https://github.com/apache/tomcat80/blob/b186f4b53d9d2c3119792b2af2e693701f4d3f86/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "filename": "java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java?ref=b186f4b53d9d2c3119792b2af2e693701f4d3f86"
            }
        ],
        "bug_id": "tomcat80_149",
        "parent": "https://github.com/apache/tomcat80/commit/fc972943d8473f01a809af1c8b4dae747ddc60f8",
        "message": "Fix NPE in the map, add accessors to stats information\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@565352 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/931df301bf8fdf2387895fb82a2f6653bc5d9335",
        "file": [
            {
                "patch": "@@ -261,7 +261,7 @@ public int getCurrentThreadCount() {\n     }\n     \n     public int getCurrentThreadsBusy() {\n-        return curThreads - workers.size();\n+        return workers!=null?curThreads - workers.size():0;\n     }\n     \n ",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/931df301bf8fdf2387895fb82a2f6653bc5d9335/java/org/apache/tomcat/util/net/JIoEndpoint.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "7f2af0fb4efcb750343451cd47b1fa5b203bc6fb",
                "blob_url": "https://github.com/apache/tomcat80/blob/931df301bf8fdf2387895fb82a2f6653bc5d9335/java/org/apache/tomcat/util/net/JIoEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/JIoEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/JIoEndpoint.java?ref=931df301bf8fdf2387895fb82a2f6653bc5d9335"
            }
        ],
        "bug_id": "tomcat80_150",
        "parent": "https://github.com/apache/tomcat80/commit/b578910c59c5ee955ea16d8d8fd7bd004992ec04",
        "message": "Fix NPE when using Executor\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@521342 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/c3033ab0b34916b3751fb5fb781bbd5764a5cded",
        "file": [
            {
                "patch": "@@ -2774,9 +2774,7 @@ private String evaluateAttribute(TagHandlerInfo handlerInfo,\n                 StringBuffer sb = new StringBuffer(64);\n \n                 TagAttributeInfo tai = attr.getTagAttributeInfo();\n-                String type = tai.getTypeName();\n-                String returnType = JspUtil.toJavaSourceTypeFromTld(attr\n-                        .getExpectedTypeName());\n+                String returnType = JspUtil.toJavaSourceTypeFromTld(attr.getExpectedTypeName());\n \n                 // generate elContext reference\n                 sb.append(getJspContextVar());\n@@ -2807,7 +2805,7 @@ private String evaluateAttribute(TagHandlerInfo handlerInfo,\n \n                 // depending on type\n                 if (attr.isDeferredInput()\n-                        || ValueExpression.class.getName().equals(type)) {\n+                        || ((tai != null) && ValueExpression.class.getName().equals(tai.getTypeName()))) {\n                     sb.append(\"new org.apache.jasper.el.JspValueExpression(\");\n                     sb.append(quote(mark));\n                     sb.append(',');\n@@ -2841,7 +2839,7 @@ private String evaluateAttribute(TagHandlerInfo handlerInfo,\n                     }\n                     attrValue = sb.toString();\n                 } else if (attr.isDeferredMethodInput()\n-                        || MethodExpression.class.getName().equals(type)) {\n+                        || ((tai != null) && MethodExpression.class.getName().equals(tai.getTypeName()))) {\n                     sb.append(\"new org.apache.jasper.el.JspMethodExpression(\");\n                     sb.append(quote(mark));\n                     sb.append(',');",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/c3033ab0b34916b3751fb5fb781bbd5764a5cded/java/org/apache/jasper/compiler/Generator.java",
                "status": "modified",
                "changes": 8,
                "deletions": 5,
                "sha": "6532f27104d5ffd20bacfe2f3fddffdda9d58610",
                "blob_url": "https://github.com/apache/tomcat80/blob/c3033ab0b34916b3751fb5fb781bbd5764a5cded/java/org/apache/jasper/compiler/Generator.java",
                "filename": "java/org/apache/jasper/compiler/Generator.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/Generator.java?ref=c3033ab0b34916b3751fb5fb781bbd5764a5cded"
            }
        ],
        "bug_id": "tomcat80_151",
        "parent": "https://github.com/apache/tomcat80/commit/34edfb336d6def59faf4f69ed86fc8d4f1bb23c1",
        "message": "- Avoid NPE (quick fix).\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@492182 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/027ab6bdfab77c69b1dd246c0d4f41d0dd2efbf8",
        "file": [
            {
                "patch": "@@ -698,7 +698,8 @@ public void setVersion(long version) {\n     }\n \n     protected void setAccessCount(int count) {\n-        super.accessCount.set(count);\n+        if ( accessCount == null && ACTIVITY_CHECK ) accessCount = new AtomicInteger();\n+        if ( accessCount != null ) super.accessCount.set(count);\n     }\n }\n ",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/027ab6bdfab77c69b1dd246c0d4f41d0dd2efbf8/java/org/apache/catalina/ha/session/DeltaSession.java",
                "status": "modified",
                "changes": 3,
                "deletions": 1,
                "sha": "683e2da1fffebedec58e3243df6d5529b9f5eae5",
                "blob_url": "https://github.com/apache/tomcat80/blob/027ab6bdfab77c69b1dd246c0d4f41d0dd2efbf8/java/org/apache/catalina/ha/session/DeltaSession.java",
                "filename": "java/org/apache/catalina/ha/session/DeltaSession.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/ha/session/DeltaSession.java?ref=027ab6bdfab77c69b1dd246c0d4f41d0dd2efbf8"
            }
        ],
        "bug_id": "tomcat80_152",
        "parent": "https://github.com/apache/tomcat80/commit/da3556bb6ab5f0e0323814e4f6307b35409ac62a",
        "message": "Fix NPE on session state transfer\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@465031 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/bfda05544d3fe91a5fa06ffd99f48b27ba5fcb8c",
        "file": [
            {
                "patch": "@@ -57,7 +57,7 @@\n     /**\n      * <code>;</code> separated list of additional path elements.\n      */\n-    private String virtualClasspath;\n+    private String virtualClasspath = \"\";\n \n     /**\n      * Construct a new WebappLoader with no defined parent class loader (so that",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/bfda05544d3fe91a5fa06ffd99f48b27ba5fcb8c/java/org/apache/catalina/loader/VirtualWebappLoader.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "2d69c4cee05ad8c69f5e84a525852e0476fba7a5",
                "blob_url": "https://github.com/apache/tomcat80/blob/bfda05544d3fe91a5fa06ffd99f48b27ba5fcb8c/java/org/apache/catalina/loader/VirtualWebappLoader.java",
                "filename": "java/org/apache/catalina/loader/VirtualWebappLoader.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/loader/VirtualWebappLoader.java?ref=bfda05544d3fe91a5fa06ffd99f48b27ba5fcb8c"
            }
        ],
        "bug_id": "tomcat80_153",
        "parent": "https://github.com/apache/tomcat80/commit/34e0ec91253747c000605210f190b1c96f518df2",
        "message": "Fix NPE in unconfigured VirtualWebappLoader.\nStringTokenizer throws the NPE if the virtualClassPath\nwasn't explicitely configured (null by default).\n\nThis might not be observed in the wild because a\nVirtualWebappLoader without a configured virtualClassPath\nisn't expected. But if you extend the class and add\nfeatures, then this might well happen.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1401472 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/104d174591704638510ef47afd61c4d33fc3fc9b",
        "file": [
            {
                "patch": "@@ -208,6 +208,10 @@ static CloseCode getCloseCode(int code) {\n         @SuppressWarnings(\"unchecked\")\n         Class<? extends T> superClazz =\n                 (Class<? extends T>) clazz.getSuperclass();\n+        if (superClazz == null) {\n+            // Finished looking up the class hierarchy without finding anything\n+            return null;\n+        }\n \n         TypeResult superClassTypeResult = getGenericType(type, superClazz);\n         int dimension = superClassTypeResult.getDimension();",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/104d174591704638510ef47afd61c4d33fc3fc9b/java/org/apache/tomcat/websocket/Util.java",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "05d5d3d4fe966987a587add5f1f3c5f3e72c72e7",
                "blob_url": "https://github.com/apache/tomcat80/blob/104d174591704638510ef47afd61c4d33fc3fc9b/java/org/apache/tomcat/websocket/Util.java",
                "filename": "java/org/apache/tomcat/websocket/Util.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/Util.java?ref=104d174591704638510ef47afd61c4d33fc3fc9b"
            },
            {
                "patch": "@@ -158,6 +158,10 @@\n         Fix log name typo in <code>WsRemoteEndpointImplServer</code> class,\n         caused by a copy-paste. (markt/kkolinko)\n       </fix>\n+      <fix>\n+        <bug>57788</bug>: Avoid NPE when looking up a class hierarchy without\n+        finding anything. (remm)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Web applications\">",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/104d174591704638510ef47afd61c4d33fc3fc9b/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "7212ee92e6fc686c1b3475708ce2cd91edaed9a2",
                "blob_url": "https://github.com/apache/tomcat80/blob/104d174591704638510ef47afd61c4d33fc3fc9b/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=104d174591704638510ef47afd61c4d33fc3fc9b"
            }
        ],
        "bug_id": "tomcat80_154",
        "parent": "https://github.com/apache/tomcat80/commit/81ac2d3e66941c3e8bb464a768f8b3054da8e41c",
        "message": "Merge r1672628\n57788: Avoid NPE if nothing is found after going through the whole class hierarchy.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1672629 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/15d5f38d83423ff2169b25dca9db1a7fb26e21ca",
        "file": [
            {
                "patch": "@@ -32,6 +32,8 @@\n \n import org.apache.coyote.OutputBuffer;\n import org.apache.coyote.Response;\n+import org.apache.juli.logging.Log;\n+import org.apache.juli.logging.LogFactory;\n import org.apache.tomcat.util.buf.ByteChunk;\n import org.apache.tomcat.util.net.AbstractEndpoint;\n import org.apache.tomcat.util.net.Nio2Channel;\n@@ -44,6 +46,8 @@\n  */\n public class InternalNio2OutputBuffer extends AbstractOutputBuffer<Nio2Channel> {\n \n+    private static final Log log = LogFactory.getLog(InternalNio2OutputBuffer.class);\n+\n     // ----------------------------------------------------------- Constructors\n \n     /**\n@@ -151,6 +155,11 @@ public void completed(Integer nBytes, ByteBuffer attachment) {\n \n             @Override\n             public void failed(Throwable exc, ByteBuffer attachment) {\n+                if (socket == null) {\n+                    log.warn(sm.getString(\"iob.nio2.nullSocket\"), exc);\n+                    // Can't do anything else with a null socket\n+                    return;\n+                }\n                 socket.setError(true);\n                 if (exc instanceof IOException) {\n                     e = (IOException) exc;\n@@ -202,6 +211,11 @@ public void completed(Long nBytes, ByteBuffer[] attachment) {\n \n             @Override\n             public void failed(Throwable exc, ByteBuffer[] attachment) {\n+                if (socket == null) {\n+                    log.warn(sm.getString(\"iob.nio2.nullSocket\"), exc);\n+                    // Can't do anything else with a null socket\n+                    return;\n+                }\n                 socket.setError(true);\n                 if (exc instanceof IOException) {\n                     e = (IOException) exc;",
                "additions": 14,
                "raw_url": "https://github.com/apache/tomcat80/raw/15d5f38d83423ff2169b25dca9db1a7fb26e21ca/java/org/apache/coyote/http11/InternalNio2OutputBuffer.java",
                "status": "modified",
                "changes": 14,
                "deletions": 0,
                "sha": "ce405ddf5a27ea4f2b09dbaaa33aee52104117a0",
                "blob_url": "https://github.com/apache/tomcat80/blob/15d5f38d83423ff2169b25dca9db1a7fb26e21ca/java/org/apache/coyote/http11/InternalNio2OutputBuffer.java",
                "filename": "java/org/apache/coyote/http11/InternalNio2OutputBuffer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/http11/InternalNio2OutputBuffer.java?ref=15d5f38d83423ff2169b25dca9db1a7fb26e21ca"
            },
            {
                "patch": "@@ -42,3 +42,5 @@ iob.failedwrite=Failed write\n iob.failedwrite.ack=Failed to send HTTP 100 continue response\n iob.illegalreset=The response may not be reset once it has been committed\n iob.responseheadertoolarge.error=An attempt was made to write more data to the response headers than there was room available in the buffer. Increase maxHttpHeaderSize on the connector or write less data into the response headers.\n+\n+iob.nio2.nullSocket=Socket was null while trying to process exception. See Bug 57749\n\\ No newline at end of file",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/15d5f38d83423ff2169b25dca9db1a7fb26e21ca/java/org/apache/coyote/http11/LocalStrings.properties",
                "status": "modified",
                "changes": 2,
                "deletions": 0,
                "sha": "6a1120cfd56089100b2609993a0ee8b58ed011e3",
                "blob_url": "https://github.com/apache/tomcat80/blob/15d5f38d83423ff2169b25dca9db1a7fb26e21ca/java/org/apache/coyote/http11/LocalStrings.properties",
                "filename": "java/org/apache/coyote/http11/LocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/http11/LocalStrings.properties?ref=15d5f38d83423ff2169b25dca9db1a7fb26e21ca"
            }
        ],
        "bug_id": "tomcat80_155",
        "parent": "https://github.com/apache/tomcat80/commit/1514922b463f9397b172040b3f55306abe74e6c1",
        "message": "Avoid NPE reported in https://bz.apache.org/bugzilla/show_bug.cgi?id=57749 and log the exception.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1668873 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/ec79a19422e6502879aeb3747549677431f9fd79",
        "file": [
            {
                "patch": "@@ -1681,6 +1681,7 @@ public void run() {\n                         // Close socket and pool\n                         destroySocket(socket.getSocket().longValue());\n                         socket = null;\n+                        return;\n                     }\n                     // Process the request from this socket\n                     Handler.SocketState state = handler.process(socket);",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/ec79a19422e6502879aeb3747549677431f9fd79/java/org/apache/tomcat/util/net/AprEndpoint.java",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "e26a9388d7bf48dfea8cb7b423635f20a2fe6317",
                "blob_url": "https://github.com/apache/tomcat80/blob/ec79a19422e6502879aeb3747549677431f9fd79/java/org/apache/tomcat/util/net/AprEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/AprEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/AprEndpoint.java?ref=ec79a19422e6502879aeb3747549677431f9fd79"
            },
            {
                "patch": "@@ -120,6 +120,11 @@\n         calculating connection and keep-alive timeouts for the HTTP BIO\n         connector. (markt)\n       </fix>\n+      <fix>\n+        <bug>51095</bug>: Don&apos;t trigger a NullPointerException when the SSL\n+        handshake fails with the HTTP-APR connector. Patch provided by Mike\n+        Glazer. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Jasper\">",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/ec79a19422e6502879aeb3747549677431f9fd79/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "c1a5647ae6e25bfa89ecd5db4e324239ec19f179",
                "blob_url": "https://github.com/apache/tomcat80/blob/ec79a19422e6502879aeb3747549677431f9fd79/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=ec79a19422e6502879aeb3747549677431f9fd79"
            }
        ],
        "bug_id": "tomcat80_156",
        "parent": "https://github.com/apache/tomcat80/commit/cf65238535f910929261bfa79d8e4c767019920f",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51095\nDon't trigger a NullPointerException when the SSL handshake fails with the HTTP-APR connector.\nPatch provided by Mike Glazer.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1096244 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/d75ddafcc629ae61fc024252ddbc86305283954a",
        "file": [
            {
                "patch": "@@ -83,13 +83,15 @@ protected synchronized void startInternal() throws LifecycleException {\n     @Override\n     protected synchronized void stopInternal() throws LifecycleException {\n \n+        Map<String, Object> map = ((ReplApplContext) this.context)\n+                .getAttributeMap();\n+\n         super.stopInternal();\n \n-        Map<String,Object> map =\n-                ((ReplApplContext)this.context).getAttributeMap();\n         if ( map!=null && map instanceof ReplicatedMap) {\n-            ((ReplicatedMap<?,?>)map).breakdown();\n+            ((ReplicatedMap<?, ?>) map).breakdown();\n         }\n+\n     }\n \n \n@@ -160,6 +162,13 @@ public void removeAttribute(String name) {\n \n         @Override\n         public void setAttribute(String name, Object value) {\n+            if (name == null) {\n+                throw new IllegalArgumentException(sm.getString(\"applicationContext.setAttribute.namenull\"));\n+            }\n+            if (value == null) {\n+                removeAttribute(name);\n+                return;\n+            }\n             if ( (!getParent().getState().isAvailable()) || \"org.apache.jasper.runtime.JspApplicationContextImpl\".equals(name) ){\n                 tomcatAttributes.put(name,value);\n             } else",
                "additions": 12,
                "raw_url": "https://github.com/apache/tomcat80/raw/d75ddafcc629ae61fc024252ddbc86305283954a/java/org/apache/catalina/ha/context/ReplicatedContext.java",
                "status": "modified",
                "changes": 15,
                "deletions": 3,
                "sha": "7349bd92b27c718f0804d56532c0ba93596f5146",
                "blob_url": "https://github.com/apache/tomcat80/blob/d75ddafcc629ae61fc024252ddbc86305283954a/java/org/apache/catalina/ha/context/ReplicatedContext.java",
                "filename": "java/org/apache/catalina/ha/context/ReplicatedContext.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/ha/context/ReplicatedContext.java?ref=d75ddafcc629ae61fc024252ddbc86305283954a"
            },
            {
                "patch": "@@ -0,0 +1,56 @@\n+package org.apache.catalina.ha.context;\n+\n+import java.io.File;\n+import java.io.IOException;\n+\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServlet;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+\n+import org.apache.catalina.Context;\n+import org.apache.catalina.Host;\n+import org.apache.catalina.LifecycleException;\n+import org.apache.catalina.core.StandardHost;\n+import org.apache.catalina.startup.Tomcat;\n+import org.apache.catalina.startup.TomcatBaseTest;\n+import org.apache.tomcat.util.buf.ByteChunk;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+public class TestReplicatedContext extends TomcatBaseTest {\n+\n+    @Test\n+    public void testBug57425() throws LifecycleException, IOException, ServletException {\n+        Tomcat tomcat = getTomcatInstance();\n+        Host host = tomcat.getHost();\n+        if (host instanceof StandardHost) {\n+            ((StandardHost) host).setContextClass(ReplicatedContext.class.getName());\n+        }\n+\n+        File root = new File(\"test/webapp\");\n+        Context context = tomcat.addWebapp(host, \"\", \"\", root.getAbsolutePath());\n+\n+        Tomcat.addServlet(context, \"test\", new AccessContextServlet());\n+        context.addServletMapping(\"/access\", \"test\");\n+\n+        tomcat.start();\n+\n+        ByteChunk result = getUrl(\"http://localhost:\" + getPort() + \"/access\");\n+\n+        Assert.assertEquals(\"OK\", result.toString());\n+\n+    }\n+\n+    private static class AccessContextServlet extends HttpServlet {\n+\n+        private static final long serialVersionUID = 1L;\n+\n+        @Override\n+        protected void doGet(HttpServletRequest req, HttpServletResponse resp)\n+                throws ServletException, IOException {\n+            getServletContext().setAttribute(\"NULL\", null);\n+            resp.getWriter().print(\"OK\");\n+        }\n+    }\n+}",
                "additions": 56,
                "raw_url": "https://github.com/apache/tomcat80/raw/d75ddafcc629ae61fc024252ddbc86305283954a/test/org/apache/catalina/ha/context/TestReplicatedContext.java",
                "status": "added",
                "changes": 56,
                "deletions": 0,
                "sha": "ab0c978e4961bb7fb2a9079b4cd3779effc4459b",
                "blob_url": "https://github.com/apache/tomcat80/blob/d75ddafcc629ae61fc024252ddbc86305283954a/test/org/apache/catalina/ha/context/TestReplicatedContext.java",
                "filename": "test/org/apache/catalina/ha/context/TestReplicatedContext.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/ha/context/TestReplicatedContext.java?ref=d75ddafcc629ae61fc024252ddbc86305283954a"
            },
            {
                "patch": "@@ -47,6 +47,9 @@\n <section name=\"Tomcat 8.0.18 (markt)\">\n   <subsection name=\"Catalina\">\n     <changelog>\n+      <fix>\n+        <bug>57425</bug> Don't add attributes with null value or name to the replicated context. (fschumacher)\n+      </fix>\n       <add>\n         <bug>57431</bug> Enable usage of custom class for context creation when using embedded tomcat. (fschumacher)\n       </add>",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/d75ddafcc629ae61fc024252ddbc86305283954a/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "b4b668eca31d6dee3bb5948db1f892e6ada6b151",
                "blob_url": "https://github.com/apache/tomcat80/blob/d75ddafcc629ae61fc024252ddbc86305283954a/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=d75ddafcc629ae61fc024252ddbc86305283954a"
            }
        ],
        "bug_id": "tomcat80_157",
        "parent": "https://github.com/apache/tomcat80/commit/5355d7f2104b627527b389eb341073d9147fc586",
        "message": "Don't add orderedLibs attribute if it is null.\nReplicatedContext will fail otherwise.\n\nAvoid NPE on shutdown of ReplicatedContext.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1651421 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/40e130e02b66993a5178a5ac72f938e69bb62462",
        "file": [
            {
                "patch": "@@ -24,6 +24,7 @@\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.fail;\n \n+import org.junit.Assert;\n import org.junit.Test;\n \n import org.apache.catalina.Context;\n@@ -97,9 +98,7 @@ private void oneTest(String allow, String deny, boolean denyStatus,\n         request.getMappingData().context = context;\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n \n-        if (type == null) {\n-            fail(\"Invalid test with null type\");\n-        }\n+        Assert.assertNotNull(\"Invalid test with null type\", type);\n         if (property != null) {\n             if (type.equals(\"Addr\")) {\n                 valve = new RemoteAddrValve();\n@@ -109,10 +108,9 @@ private void oneTest(String allow, String deny, boolean denyStatus,\n                 valve = new RemoteHostValve();\n                 request.setRemoteHost(property);\n                 msg.append(\" host='\" + property + \"'\");\n-            } else {\n-                fail(\"Invalid test type\" + type);\n             }\n         }\n+        Assert.assertNotNull(\"Invalid test type\" + type, valve);\n         valve.setNext(new TerminatingValve());\n \n         if (allow != null) {",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/40e130e02b66993a5178a5ac72f938e69bb62462/test/org/apache/catalina/valves/TestRequestFilterValve.java",
                "status": "modified",
                "changes": 8,
                "deletions": 5,
                "sha": "3ddcf2f7acdba50c8ceeb05d74eaacb5ce38efef",
                "blob_url": "https://github.com/apache/tomcat80/blob/40e130e02b66993a5178a5ac72f938e69bb62462/test/org/apache/catalina/valves/TestRequestFilterValve.java",
                "filename": "test/org/apache/catalina/valves/TestRequestFilterValve.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/valves/TestRequestFilterValve.java?ref=40e130e02b66993a5178a5ac72f938e69bb62462"
            }
        ],
        "bug_id": "tomcat80_158",
        "parent": "https://github.com/apache/tomcat80/commit/53ddb093650360dfe1cc1e47458035294f7b8451",
        "message": "Refactor test to stop IDE complaining about possible NPEs.\nAlso requires slightly less code.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1644525 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/81b36625d33f1e25c416dfd9dd1c92e139d7582e",
        "file": [
            {
                "patch": "@@ -63,6 +63,8 @@ coyoteResponse.setBufferSize.ise=Cannot change buffer size after data has been w\n \n inputBuffer.streamClosed=Stream closed\n \n+outputBuffer.writeNull=The String argument to write(String,int,int) may not be null\n+\n request.asyncNotSupported=A filter or servlet of the current chain does not support asynchronous operations.\n \n requestFacade.nullRequest=The request object has been recycled and is no longer associated with this facade",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/81b36625d33f1e25c416dfd9dd1c92e139d7582e/java/org/apache/catalina/connector/LocalStrings.properties",
                "status": "modified",
                "changes": 2,
                "deletions": 0,
                "sha": "14c40ad98bf9feda3bd156d5a1c021ad9413a07c",
                "blob_url": "https://github.com/apache/tomcat80/blob/81b36625d33f1e25c416dfd9dd1c92e139d7582e/java/org/apache/catalina/connector/LocalStrings.properties",
                "filename": "java/org/apache/catalina/connector/LocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/LocalStrings.properties?ref=81b36625d33f1e25c416dfd9dd1c92e139d7582e"
            },
            {
                "patch": "@@ -32,6 +32,7 @@\n import org.apache.tomcat.util.buf.ByteChunk;\n import org.apache.tomcat.util.buf.C2BConverter;\n import org.apache.tomcat.util.buf.CharChunk;\n+import org.apache.tomcat.util.res.StringManager;\n \n /**\n  * The buffer used by Tomcat response. This is a derivative of the Tomcat 3.3\n@@ -44,6 +45,9 @@\n public class OutputBuffer extends Writer\n     implements ByteChunk.ByteOutputChannel, CharChunk.CharOutputChannel {\n \n+    private static final StringManager sm =\n+            StringManager.getManager(Constants.Package);\n+\n     // -------------------------------------------------------------- Constants\n \n     public static final String DEFAULT_ENCODING =\n@@ -524,7 +528,7 @@ public void write(String s, int off, int len)\n         }\n \n         if (s == null) {\n-            s = \"null\";\n+            throw new NullPointerException(sm.getString(\"outputBuffer.writeNull\"));\n         }\n         cb.append(s, off, len);\n         charsWritten += len;",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/81b36625d33f1e25c416dfd9dd1c92e139d7582e/java/org/apache/catalina/connector/OutputBuffer.java",
                "status": "modified",
                "changes": 6,
                "deletions": 1,
                "sha": "4a3265061517afd1bb17440d500d5fda7c4c6739",
                "blob_url": "https://github.com/apache/tomcat80/blob/81b36625d33f1e25c416dfd9dd1c92e139d7582e/java/org/apache/catalina/connector/OutputBuffer.java",
                "filename": "java/org/apache/catalina/connector/OutputBuffer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/OutputBuffer.java?ref=81b36625d33f1e25c416dfd9dd1c92e139d7582e"
            },
            {
                "patch": "@@ -169,6 +169,12 @@\n         Update storeconfig with newly introduced elements: SessionIdGenerator,\n         CookieProcessor, JarScanner and JarScanFilter. (remm)\n       </fix>\n+      <fix>\n+        Throw a <code>NullPointerException</code> if a null string is passed to\n+        the <code>write(String,int,int)</code> method of the\n+        <code>PrintWriter</code> obtained from the <code>ServletResponse</code>.\n+        (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/81b36625d33f1e25c416dfd9dd1c92e139d7582e/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 6,
                "deletions": 0,
                "sha": "00aaa1221e7e43a8336b52a060929aead5c53f1a",
                "blob_url": "https://github.com/apache/tomcat80/blob/81b36625d33f1e25c416dfd9dd1c92e139d7582e/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=81b36625d33f1e25c416dfd9dd1c92e139d7582e"
            }
        ],
        "bug_id": "tomcat80_159",
        "parent": "https://github.com/apache/tomcat80/commit/69ea86fe54e7bd929e053703129c1ba1ccecce95",
        "message": "Throw a NPE if a null string is passed to the write(String,int,int) method of the PrintWriter obtained from the ServletResponse.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1634139 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/a6d676cda9f0c65a57ac521f0705473e964c89ab",
        "file": [
            {
                "patch": "@@ -1280,6 +1280,13 @@ protected User getUser(DirContext context, String username,\n             user = getUserBySearch(context, username, attrIds);\n         }\n \n+        if (userPassword == null && credentials != null) {\n+            // The password is available. Insert it since it may be required for\n+            // role searches.\n+            return new User(user.getUserName(), user.getDN(), credentials,\n+                    user.getRoles(), user.getUserRoleId());\n+        }\n+\n         return user;\n     }\n \n@@ -1708,6 +1715,8 @@ private void userCredentialsRemove(DirContext context)\n                 nameParts[i] = name.get(i);\n             }\n             base = roleBaseFormat.format(nameParts);\n+        } else {\n+            base = \"\";\n         }\n \n         // Perform the configured search and process the results",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/a6d676cda9f0c65a57ac521f0705473e964c89ab/java/org/apache/catalina/realm/JNDIRealm.java",
                "status": "modified",
                "changes": 9,
                "deletions": 0,
                "sha": "5b0b92a30b7c9c5abd7a8b7d234ab50b6e1cceb4",
                "blob_url": "https://github.com/apache/tomcat80/blob/a6d676cda9f0c65a57ac521f0705473e964c89ab/java/org/apache/catalina/realm/JNDIRealm.java",
                "filename": "java/org/apache/catalina/realm/JNDIRealm.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/realm/JNDIRealm.java?ref=a6d676cda9f0c65a57ac521f0705473e964c89ab"
            },
            {
                "patch": "@@ -90,6 +90,10 @@\n         it in the web application class loader to set the correct code base for\n         resources loaded from JARs and WARs. (markt)\n       </fix>\n+      <fix>\n+        Correct a couple of NPEs in the JNDI Realm that could be triggered with\n+        when not specifying a roleBase and enabling roleSearchAsUser. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Web applications\">",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/a6d676cda9f0c65a57ac521f0705473e964c89ab/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "31b918871f52fba66fb0206e5451521b6162b251",
                "blob_url": "https://github.com/apache/tomcat80/blob/a6d676cda9f0c65a57ac521f0705473e964c89ab/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=a6d676cda9f0c65a57ac521f0705473e964c89ab"
            }
        ],
        "bug_id": "tomcat80_160",
        "parent": "https://github.com/apache/tomcat80/commit/1777489710d8575fd728dd2fb014298c0997f663",
        "message": "Correct a couple of NPEs in the JNDI Realm that could be triggered with when not specifying a roleBase and enabling roleSearchAsUser.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1628524 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/e87faf42a998e7bb59d43ceb3daa7deb15b40b93",
        "file": [
            {
                "patch": "@@ -1200,7 +1200,7 @@ protected String digest(String credentials)  {\n     }\n \n     protected boolean hasMessageDigest() {\n-        return !(getDigest() == null && getDigest().length() > 0);\n+        return getDigest() != null;\n     }\n \n     /**",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/e87faf42a998e7bb59d43ceb3daa7deb15b40b93/java/org/apache/catalina/realm/RealmBase.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "cedb63a5457f817521ea549e6d31c6fc1f0887af",
                "blob_url": "https://github.com/apache/tomcat80/blob/e87faf42a998e7bb59d43ceb3daa7deb15b40b93/java/org/apache/catalina/realm/RealmBase.java",
                "filename": "java/org/apache/catalina/realm/RealmBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/realm/RealmBase.java?ref=e87faf42a998e7bb59d43ceb3daa7deb15b40b93"
            }
        ],
        "bug_id": "tomcat80_161",
        "parent": "https://github.com/apache/tomcat80/commit/ea9f7f787a1ff7aa6b31c25c9441fa337af957a0",
        "message": "Doh! Fix NPE.\nNote digest isn't tested for zero length anywhere else so don't introduce a test here.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1623851 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/881e4d4e67d81ad9a297fcc9bae753557a5b0604",
        "file": [
            {
                "patch": "@@ -898,7 +898,10 @@ public final void action(ActionCode actionCode, Object param) {\n             break;\n         }\n         case DISPATCH_EXECUTE: {\n-            getEndpoint().executeNonBlockingDispatches(socketWrapper);\n+            SocketWrapper<S> wrapper = socketWrapper;\n+            if (wrapper != null) {\n+                getEndpoint().executeNonBlockingDispatches(wrapper);\n+            }\n             break;\n         }\n         case CLOSE_NOW: {",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/881e4d4e67d81ad9a297fcc9bae753557a5b0604/java/org/apache/coyote/http11/AbstractHttp11Processor.java",
                "status": "modified",
                "changes": 5,
                "deletions": 1,
                "sha": "57f66cb542f1d301e6730d8c55abc6705773c0ae",
                "blob_url": "https://github.com/apache/tomcat80/blob/881e4d4e67d81ad9a297fcc9bae753557a5b0604/java/org/apache/coyote/http11/AbstractHttp11Processor.java",
                "filename": "java/org/apache/coyote/http11/AbstractHttp11Processor.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/http11/AbstractHttp11Processor.java?ref=881e4d4e67d81ad9a297fcc9bae753557a5b0604"
            }
        ],
        "bug_id": "tomcat80_162",
        "parent": "https://github.com/apache/tomcat80/commit/c5bf93a6dd4d7ba2cc92e948d9c9124fa89db1a9",
        "message": "Avoid possible NPE (unlikely but observed while stepping through code investogating BZ 56739)\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1616204 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/f7488dd796cdb2c033458c16a4cac98f92ee14d8",
        "file": [
            {
                "patch": "@@ -1354,7 +1354,6 @@ public void run() {\n                 t = e;\n                 throw e;\n             } finally {\n-                thread = null;\n                 if (!threadDone) {\n                     log.error(unexpectedDeathMessage, t);\n                 }",
                "additions": 0,
                "raw_url": "https://github.com/apache/tomcat80/raw/f7488dd796cdb2c033458c16a4cac98f92ee14d8/java/org/apache/catalina/core/ContainerBase.java",
                "status": "modified",
                "changes": 1,
                "deletions": 1,
                "sha": "475fe796caeee2e7f78b6eb4a3dd1a7abc06f461",
                "blob_url": "https://github.com/apache/tomcat80/blob/f7488dd796cdb2c033458c16a4cac98f92ee14d8/java/org/apache/catalina/core/ContainerBase.java",
                "filename": "java/org/apache/catalina/core/ContainerBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/ContainerBase.java?ref=f7488dd796cdb2c033458c16a4cac98f92ee14d8"
            }
        ],
        "bug_id": "tomcat80_163",
        "parent": "https://github.com/apache/tomcat80/commit/ab59c25320dae815417bbcbdd5f601916d614f2d",
        "message": "Fix regression with r1611506: NPE on stop (only threadStop should set thread to null, or it needs a sync).\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1611551 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/7a450a6f04418ec1eebf0f5791ca6bf06e3d9a9d",
        "file": [
            {
                "patch": "@@ -190,8 +190,12 @@ public Session connectToServer(Object pojo, URI path)\n             }\n         }\n \n-        ClientEndpointConfig config = ClientEndpointConfig.Builder.create().\n-                configurator(configurator).\n+        ClientEndpointConfig.Builder builder = ClientEndpointConfig.Builder.create();\n+        // Avoid NPE when using RI API JAR - see BZ 56343\n+        if (configurator != null) {\n+            builder.configurator(configurator);\n+        }\n+        ClientEndpointConfig config = builder.\n                 decoders(Arrays.asList(annotation.decoders())).\n                 encoders(Arrays.asList(annotation.encoders())).\n                 build();",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/7a450a6f04418ec1eebf0f5791ca6bf06e3d9a9d/java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "status": "modified",
                "changes": 8,
                "deletions": 2,
                "sha": "8d099367c75fceb5ba77fece996007e6080e819b",
                "blob_url": "https://github.com/apache/tomcat80/blob/7a450a6f04418ec1eebf0f5791ca6bf06e3d9a9d/java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "filename": "java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsWebSocketContainer.java?ref=7a450a6f04418ec1eebf0f5791ca6bf06e3d9a9d"
            },
            {
                "patch": "@@ -138,6 +138,15 @@\n       </fix>\n     </changelog>\n   </subsection>\n+  <subsection name=\"WebSocket\">\n+    <changelog>\n+      <fix>\n+        <bug>56343</bug>: Avoid a NPE if Tomcat&apos;s Java WebSocket 1.0\n+        implementation is used with the Java WebSocket 1.0 API JAR from the\n+        reference implementation. (markt)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection name=\"Web applications\">\n     <changelog>\n       <fix>",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/7a450a6f04418ec1eebf0f5791ca6bf06e3d9a9d/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 9,
                "deletions": 0,
                "sha": "a3f18a11f9e8b3b84a5585c01460fc289f8dc5f7",
                "blob_url": "https://github.com/apache/tomcat80/blob/7a450a6f04418ec1eebf0f5791ca6bf06e3d9a9d/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=7a450a6f04418ec1eebf0f5791ca6bf06e3d9a9d"
            }
        ],
        "bug_id": "tomcat80_164",
        "parent": "https://github.com/apache/tomcat80/commit/7e59abe631c91819505c3d2961bee62dce3a286b",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56343\nAvoid NPE if WebSocket API JAR from RI is used.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1584922 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/9e2e2b517d4ce71a2d37214b80985f2ac75e51f7",
        "file": [
            {
                "patch": "@@ -55,12 +55,12 @@ public void setParent(ThreadPoolExecutor tp) {\n     }\n \n     public boolean force(Runnable o) {\n-        if ( parent.isShutdown() ) throw new RejectedExecutionException(\"Executor not running, can't force a command into the queue\");\n+        if ( parent==null || parent.isShutdown() ) throw new RejectedExecutionException(\"Executor not running, can't force a command into the queue\");\n         return super.offer(o); //forces the item onto the queue, to be used if the task is rejected\n     }\n \n     public boolean force(Runnable o, long timeout, TimeUnit unit) throws InterruptedException {\n-        if ( parent.isShutdown() ) throw new RejectedExecutionException(\"Executor not running, can't force a command into the queue\");\n+        if ( parent==null || parent.isShutdown() ) throw new RejectedExecutionException(\"Executor not running, can't force a command into the queue\");\n         return super.offer(o,timeout,unit); //forces the item onto the queue, to be used if the task is rejected\n     }\n ",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/9e2e2b517d4ce71a2d37214b80985f2ac75e51f7/java/org/apache/tomcat/util/threads/TaskQueue.java",
                "status": "modified",
                "changes": 4,
                "deletions": 2,
                "sha": "ad67f28e4305114fdacef11dbc74fc2a4c901541",
                "blob_url": "https://github.com/apache/tomcat80/blob/9e2e2b517d4ce71a2d37214b80985f2ac75e51f7/java/org/apache/tomcat/util/threads/TaskQueue.java",
                "filename": "java/org/apache/tomcat/util/threads/TaskQueue.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/threads/TaskQueue.java?ref=9e2e2b517d4ce71a2d37214b80985f2ac75e51f7"
            }
        ],
        "bug_id": "tomcat80_165",
        "parent": "https://github.com/apache/tomcat80/commit/765dab1e8718a6d0c66ac230a4bf484a5e03b25e",
        "message": "Avoid possible NPE (it really needs to throw a rejected execution instead anyway).\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1574162 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/9531d972240b60a336d3a86e738161623943b042",
        "file": [
            {
                "patch": "@@ -145,9 +145,7 @@ protected void backgroundProcess() {\n \n     private boolean noCache(String path) {\n         // Don't cache resources used by the class loader (it has its own cache)\n-        // TODO. Review these exclusions once class loader resource handling is\n-        // complete\n-        if (path.startsWith(\"/WEB-INF/classes\") ||\n+        if (path == null || path.startsWith(\"/WEB-INF/classes\") ||\n                 path.startsWith(\"/WEB-INF/lib\")) {\n             return true;\n         }",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/9531d972240b60a336d3a86e738161623943b042/java/org/apache/catalina/webresources/Cache.java",
                "status": "modified",
                "changes": 4,
                "deletions": 3,
                "sha": "186734ed0a6cfe19eb6574442cdfd6a5dc100657",
                "blob_url": "https://github.com/apache/tomcat80/blob/9531d972240b60a336d3a86e738161623943b042/java/org/apache/catalina/webresources/Cache.java",
                "filename": "java/org/apache/catalina/webresources/Cache.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/webresources/Cache.java?ref=9531d972240b60a336d3a86e738161623943b042"
            },
            {
                "patch": "@@ -74,6 +74,10 @@\n         elements and attributes supported by the Servlet version of the merged\n         file. (markt)\n       </fix>\n+      <fix>\n+        Avoid <code>NullPointerException</code> in resource cache when making an\n+        invalid request for a resource outside of the web application. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/9531d972240b60a336d3a86e738161623943b042/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "087cc7d3039c94044e5ec8e03eb3be127cfe4eff",
                "blob_url": "https://github.com/apache/tomcat80/blob/9531d972240b60a336d3a86e738161623943b042/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=9531d972240b60a336d3a86e738161623943b042"
            }
        ],
        "bug_id": "tomcat80_166",
        "parent": "https://github.com/apache/tomcat80/commit/1de6f6cbab1a4f2fd0393c5a48821ebea2d16eb9",
        "message": "Avoid NPE in resource cache when making an invalid request for a resource outside of the web application.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1573368 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/f469d86a6738ead7283c974e1c7ee2a81e82f32b",
        "file": [
            {
                "patch": "@@ -152,7 +152,7 @@ private boolean parseFunction() {\n                 if (hasNext()) {\n                     Token t2 = nextToken();\n                     if (t2 instanceof Id) {\n-                        s1 = s2;\n+                        s1 = s2.trim();\n                         s2 = t2.toString();\n                         if (hasNext()) {\n                             curToken = nextToken();\n@@ -161,7 +161,7 @@ private boolean parseFunction() {\n                 }\n             }\n             if (curToken.toChar() == '(') {\n-                ELexpr.add(new ELNode.Function(s1.trim(), s2.trim()));\n+                ELexpr.add(new ELNode.Function(s1, s2.trim()));\n                 return true;\n             }\n             curToken = original;",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/f469d86a6738ead7283c974e1c7ee2a81e82f32b/java/org/apache/jasper/compiler/ELParser.java",
                "status": "modified",
                "changes": 4,
                "deletions": 2,
                "sha": "c4e22b3ee3d297135b3c61de2f04212c3498f9e5",
                "blob_url": "https://github.com/apache/tomcat80/blob/f469d86a6738ead7283c974e1c7ee2a81e82f32b/java/org/apache/jasper/compiler/ELParser.java",
                "filename": "java/org/apache/jasper/compiler/ELParser.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/ELParser.java?ref=f469d86a6738ead7283c974e1c7ee2a81e82f32b"
            }
        ],
        "bug_id": "tomcat80_167",
        "parent": "https://github.com/apache/tomcat80/commit/56f5dd9c8549b135e77ba5fc60d23c140ac6b2cb",
        "message": "Fix for NPE introduced by r1559707 that caused ELParser test to fail.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1559798 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/0472c8b228fdbc4e2ab3362ec83d0e2cc30062b7",
        "file": [
            {
                "patch": "@@ -402,4 +402,4 @@ org.apache.jasper.compiler.TldCache.servletContextNull=The provided SevletContex\n org.apache.jasper.servlet.JasperInitializer.onStartup=Initializing Jasper for context [{0}]\n org.apache.jasper.servlet.TldScanner.webxmlSkip=Skipping load of TLD for URI {1} from resource path {0} as it has already been defined in <jsp-config>\n org.apache.jasper.servlet.TldScanner.webxmlAdd=Loading TLD for URI {1} from resource path {0}\n-\n+org.apache.jasper.servlet.TldScanner.webxmlFailPathDoesNotExist=Failed to process TLD with path [{0}] and URI [{1}]. The specified path does not exist.",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/0472c8b228fdbc4e2ab3362ec83d0e2cc30062b7/java/org/apache/jasper/resources/LocalStrings.properties",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "cc26ee3847a5aff98468701412ce27b9cb6e7da7",
                "blob_url": "https://github.com/apache/tomcat80/blob/0472c8b228fdbc4e2ab3362ec83d0e2cc30062b7/java/org/apache/jasper/resources/LocalStrings.properties",
                "filename": "java/org/apache/jasper/resources/LocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/resources/LocalStrings.properties?ref=0472c8b228fdbc4e2ab3362ec83d0e2cc30062b7"
            },
            {
                "patch": "@@ -175,21 +175,27 @@ protected void scanJspConfig() throws IOException, SAXException {\n             }\n \n             URL url = context.getResource(resourcePath);\n-            TldResourcePath tldResourcePath;\n-            if (resourcePath.endsWith(\".jar\")) {\n-                // if the path points to a jar file, the TLD is presumed to be\n-                // inside at META-INF/taglib.tld\n-                tldResourcePath = new TldResourcePath(\n-                        url, resourcePath, \"META-INF/taglib.tld\");\n+            if (url != null) {\n+                TldResourcePath tldResourcePath;\n+                if (resourcePath.endsWith(\".jar\")) {\n+                    // if the path points to a jar file, the TLD is presumed to be\n+                    // inside at META-INF/taglib.tld\n+                    tldResourcePath = new TldResourcePath(url, resourcePath, \"META-INF/taglib.tld\");\n+                } else {\n+                    tldResourcePath = new TldResourcePath(url, resourcePath);\n+                }\n+                // parse TLD but store using the URI supplied in the descriptor\n+                TaglibXml tld = tldParser.parse(tldResourcePath);\n+                uriTldResourcePathMap.put(taglibURI, tldResourcePath);\n+                tldResourcePathTaglibXmlMap.put(tldResourcePath, tld);\n+                if (tld.getListeners() != null) {\n+                    listeners.addAll(tld.getListeners());\n+                }\n             } else {\n-                tldResourcePath = new TldResourcePath(url, resourcePath);\n-            }\n-            // parse TLD but store using the URI supplied in the descriptor\n-            TaglibXml tld = tldParser.parse(tldResourcePath);\n-            uriTldResourcePathMap.put(taglibURI, tldResourcePath);\n-            tldResourcePathTaglibXmlMap.put(tldResourcePath, tld);\n-            if (tld.getListeners() != null) {\n-                listeners.addAll(tld.getListeners());\n+                log.warn(Localizer.getMessage(MSG + \".webxmlFailPathDoesNotExist\",\n+                        resourcePath,\n+                        taglibURI));\n+                continue;\n             }\n         }\n     }",
                "additions": 20,
                "raw_url": "https://github.com/apache/tomcat80/raw/0472c8b228fdbc4e2ab3362ec83d0e2cc30062b7/java/org/apache/jasper/servlet/TldScanner.java",
                "status": "modified",
                "changes": 34,
                "deletions": 14,
                "sha": "8d56b5f1ed5c1420302d9d4e28d7ccfcee8c5347",
                "blob_url": "https://github.com/apache/tomcat80/blob/0472c8b228fdbc4e2ab3362ec83d0e2cc30062b7/java/org/apache/jasper/servlet/TldScanner.java",
                "filename": "java/org/apache/jasper/servlet/TldScanner.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/servlet/TldScanner.java?ref=0472c8b228fdbc4e2ab3362ec83d0e2cc30062b7"
            }
        ],
        "bug_id": "tomcat80_168",
        "parent": "https://github.com/apache/tomcat80/commit/8e6eeab4915980d96fd50d4dfb178ca285c98823",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55905\nPrevent NPE when the specified tld resource does not exists.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1552071 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/3c1dc52bac8f3c5e307342aa1fa99d475ebec580",
        "file": [
            {
                "patch": "@@ -366,40 +366,42 @@ private static void processManifest(Jar jar, boolean isWebapp,\n         }\n \n         Manifest manifest = jar.getManifest();\n-        Attributes attributes = manifest.getMainAttributes();\n-        String classPathAttribute = attributes.getValue(\"Class-Path\");\n-        if (classPathAttribute == null) {\n-            return;\n-        }\n-        String[] classPathEntries = classPathAttribute.split(\" \");\n-        for (String classPathEntry : classPathEntries) {\n-            classPathEntry = classPathEntry.trim();\n-            if (classPathEntry.length() == 0) {\n-                continue;\n+        if (manifest != null) {\n+            Attributes attributes = manifest.getMainAttributes();\n+            String classPathAttribute = attributes.getValue(\"Class-Path\");\n+            if (classPathAttribute == null) {\n+                return;\n             }\n-            URL jarURL = jar.getJarFileURL();\n-            URI jarURI;\n-            try {\n-                jarURI = jarURL.toURI();\n-            } catch (URISyntaxException e) {\n-                if (log.isDebugEnabled()) {\n-                    log.debug(sm.getString(\"jarScan.invalidUri\", jarURL));\n+            String[] classPathEntries = classPathAttribute.split(\" \");\n+            for (String classPathEntry : classPathEntries) {\n+                classPathEntry = classPathEntry.trim();\n+                if (classPathEntry.length() == 0) {\n+                    continue;\n+                }\n+                URL jarURL = jar.getJarFileURL();\n+                URI jarURI;\n+                try {\n+                    jarURI = jarURL.toURI();\n+                } catch (URISyntaxException e) {\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(sm.getString(\"jarScan.invalidUri\", jarURL));\n+                    }\n+                    continue;\n                 }\n-                continue;\n+                /*\n+                 * Note: Resolving the relative URLs from the manifest has the\n+                 *       potential to introduce security concerns. However, since\n+                 *       only JARs provided by the container and NOT those provided\n+                 *       by web applications are processed, there should be no\n+                 *       issues.\n+                 *       If this feature is ever extended to include JARs provided\n+                 *       by web applications, checks should be added to ensure that\n+                 *       any relative URL does not step outside the web application.\n+                 */\n+                URI classPathEntryURI = jarURI.resolve(classPathEntry);\n+                URL classPathEntryURL = classPathEntryURI.toURL();\n+                classPathUrlsToProcess.add(classPathEntryURL);\n             }\n-            /*\n-             * Note: Resolving the relative URLs from the manifest has the\n-             *       potential to introduce security concerns. However, since\n-             *       only JARs provided by the container and NOT those provided\n-             *       by web applications are processed, there should be no\n-             *       issues.\n-             *       If this feature is ever extended to include JARs provided\n-             *       by web applications, checks should be added to ensure that\n-             *       any relative URL does not step outside the web application.\n-             */\n-            URI classPathEntryURI = jarURI.resolve(classPathEntry);\n-            URL classPathEntryURL = classPathEntryURI.toURL();\n-            classPathUrlsToProcess.add(classPathEntryURL);\n         }\n     }\n ",
                "additions": 33,
                "raw_url": "https://github.com/apache/tomcat80/raw/3c1dc52bac8f3c5e307342aa1fa99d475ebec580/java/org/apache/tomcat/util/scan/StandardJarScanner.java",
                "status": "modified",
                "changes": 64,
                "deletions": 31,
                "sha": "45a82633ff6a087baf9917160f03fc0eb96674ba",
                "blob_url": "https://github.com/apache/tomcat80/blob/3c1dc52bac8f3c5e307342aa1fa99d475ebec580/java/org/apache/tomcat/util/scan/StandardJarScanner.java",
                "filename": "java/org/apache/tomcat/util/scan/StandardJarScanner.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/scan/StandardJarScanner.java?ref=3c1dc52bac8f3c5e307342aa1fa99d475ebec580"
            },
            {
                "patch": "@@ -53,6 +53,10 @@\n         around. Therefore, start logging RMI Target related memory leaks on web\n         application stop. (markt)\n       </fix>\n+      <fix>\n+        Ensure NPE will not be thrown during deployment when scanning jar files\n+        without MANIFEST.MF file. (violetagg)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/3c1dc52bac8f3c5e307342aa1fa99d475ebec580/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "d917e821dbf419538f964fca5225d1750d815ba7",
                "blob_url": "https://github.com/apache/tomcat80/blob/3c1dc52bac8f3c5e307342aa1fa99d475ebec580/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=3c1dc52bac8f3c5e307342aa1fa99d475ebec580"
            }
        ],
        "bug_id": "tomcat80_169",
        "parent": "https://github.com/apache/tomcat80/commit/1d1a64b2925f2ba77bba86fd99b6c69f5445b19e",
        "message": "Merged revision 1744194 from tomcat/trunk:\nEnsure NPE will not be thrown during deployment when scanning jar files without MANIFEST.MF file.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1744197 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/3df633a4332bec9f33a57ba189258c5d359c35a0",
        "file": [
            {
                "patch": "@@ -208,11 +208,13 @@ public static MediaType parseMediaType(StringReader input)\n         while (lookForSemiColon == SkipConstantResult.FOUND) {\n             String attribute = readToken(input);\n \n+            String value = \"\";\n             if (skipConstant(input, \"=\") == SkipConstantResult.FOUND) {\n-                String value = readTokenOrQuotedString(input, true);\n+                value = readTokenOrQuotedString(input, true);\n+            }\n+\n+            if (attribute != null) {\n                 parameters.put(attribute.toLowerCase(Locale.ENGLISH), value);\n-            } else {\n-                parameters.put(attribute.toLowerCase(Locale.ENGLISH), \"\");\n             }\n \n             lookForSemiColon = skipConstant(input, \";\");",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/3df633a4332bec9f33a57ba189258c5d359c35a0/java/org/apache/tomcat/util/http/parser/HttpParser.java",
                "status": "modified",
                "changes": 8,
                "deletions": 3,
                "sha": "69654048060c2d3872049a646932ad002f5e3c49",
                "blob_url": "https://github.com/apache/tomcat80/blob/3df633a4332bec9f33a57ba189258c5d359c35a0/java/org/apache/tomcat/util/http/parser/HttpParser.java",
                "filename": "java/org/apache/tomcat/util/http/parser/HttpParser.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/http/parser/HttpParser.java?ref=3df633a4332bec9f33a57ba189258c5d359c35a0"
            },
            {
                "patch": "@@ -212,6 +212,25 @@ public void testBug53353() throws IOException {\n     }\n \n \n+    @Test\n+    public void testBug55454() throws IOException {\n+        String input = \"text/html;;charset=UTF-8\";\n+\n+        StringReader sr = new StringReader(input);\n+        MediaType m = HttpParser.parseMediaType(sr);\n+\n+        assertEquals(\"text\", m.getType());\n+        assertEquals(\"html\", m.getSubtype());\n+\n+        assertTrue(m.getParameterCount() == 1);\n+\n+        assertEquals(\"UTF-8\", m.getParameterValue(\"charset\"));\n+        assertEquals(\"UTF-8\", m.getCharset());\n+\n+        assertEquals(\"text/html; charset=UTF-8\", m.toString());\n+    }\n+\n+\n     private void doTest(Parameter... parameters) throws IOException {\n         for (String lws : LWS_VALUES) {\n             doTest(lws, parameters);",
                "additions": 19,
                "raw_url": "https://github.com/apache/tomcat80/raw/3df633a4332bec9f33a57ba189258c5d359c35a0/test/org/apache/tomcat/util/http/parser/TestMediaType.java",
                "status": "modified",
                "changes": 19,
                "deletions": 0,
                "sha": "b564ed8afa327430cdb919d8ec196a78bab1a500",
                "blob_url": "https://github.com/apache/tomcat80/blob/3df633a4332bec9f33a57ba189258c5d359c35a0/test/org/apache/tomcat/util/http/parser/TestMediaType.java",
                "filename": "test/org/apache/tomcat/util/http/parser/TestMediaType.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/tomcat/util/http/parser/TestMediaType.java?ref=3df633a4332bec9f33a57ba189258c5d359c35a0"
            }
        ],
        "bug_id": "tomcat80_170",
        "parent": "https://github.com/apache/tomcat80/commit/e454ea98e12f5190ae18da7587389a4c6e2a2d7c",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55454\nFixed NPE thrown when parsing an invalid content type.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1515841 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/8036b1905fc2cfdfd200873c7c7da1d03ba5dc3b",
        "file": [
            {
                "patch": "@@ -347,7 +347,7 @@ protected void unregisterSession(Endpoint endpoint, WsSession wsSession) {\n     private void registerAuthenticatedSession(WsSession wsSession,\n             String httpSessionId) {\n         Set<WsSession> wsSessions = authenticatedSessions.get(httpSessionId);\n-        if (wsSession == null) {\n+        if (wsSessions == null) {\n             wsSessions = Collections.newSetFromMap(\n                      new ConcurrentHashMap<WsSession,Boolean>());\n              authenticatedSessions.putIfAbsent(httpSessionId, wsSessions);",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/8036b1905fc2cfdfd200873c7c7da1d03ba5dc3b/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "d111cb4917321692eae7b72265bc657c89787e37",
                "blob_url": "https://github.com/apache/tomcat80/blob/8036b1905fc2cfdfd200873c7c7da1d03ba5dc3b/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "filename": "java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/server/WsServerContainer.java?ref=8036b1905fc2cfdfd200873c7c7da1d03ba5dc3b"
            }
        ],
        "bug_id": "tomcat80_171",
        "parent": "https://github.com/apache/tomcat80/commit/f830be1c9709dc0aa1a0859e983f5d3c1abfb1aa",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55291\nAvoid NPE when registering a session. Patch provided by rstoyanchev.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1505689 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/daf7e8028f678e127e56a95a437df40ddf0d00a7",
        "file": [
            {
                "patch": "@@ -675,10 +675,14 @@ public void write() {\n \n             // Write the payload\n             while (payload.hasRemaining() && outputBuffer.hasRemaining()) {\n-                outputBuffer.put(\n-                        (byte) (payload.get() ^ (mask[maskIndex++] & 0xFF)));\n-                if (maskIndex > 3) {\n-                    maskIndex = 0;\n+                if (mask == null) {\n+                    outputBuffer.put(payload.get());\n+                } else {\n+                    outputBuffer.put(\n+                            (byte) (payload.get() ^ (mask[maskIndex++] & 0xFF)));\n+                    if (maskIndex > 3) {\n+                        maskIndex = 0;\n+                    }\n                 }\n             }\n             if (payload.hasRemaining()) {",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/daf7e8028f678e127e56a95a437df40ddf0d00a7/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "status": "modified",
                "changes": 12,
                "deletions": 4,
                "sha": "aac37bd29a4c0aec5efc776300e69b952c18599d",
                "blob_url": "https://github.com/apache/tomcat80/blob/daf7e8028f678e127e56a95a437df40ddf0d00a7/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "filename": "java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java?ref=daf7e8028f678e127e56a95a437df40ddf0d00a7"
            }
        ],
        "bug_id": "tomcat80_172",
        "parent": "https://github.com/apache/tomcat80/commit/45596d842c8c14ec67aa0f2f9c1a252b147f6076",
        "message": "Avoid NPE when sending buffered data from the server (there is no mask in this case).\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1502175 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/98c01e9780dfb628dbb19bea0f07b080bb55c318",
        "file": [
            {
                "patch": "@@ -83,6 +83,7 @@ private void processWebDotXml() {\n             return;\n         }\n \n+        jspProperties = new Vector<>();\n         Collection<JspPropertyGroupDescriptor> jspPropertyGroups =\n                 jspConfig.getJspPropertyGroups();\n ",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/98c01e9780dfb628dbb19bea0f07b080bb55c318/java/org/apache/jasper/compiler/JspConfig.java",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "2d7f05c0af347c75f92813c4c34aa48eb2cfb08b",
                "blob_url": "https://github.com/apache/tomcat80/blob/98c01e9780dfb628dbb19bea0f07b080bb55c318/java/org/apache/jasper/compiler/JspConfig.java",
                "filename": "java/org/apache/jasper/compiler/JspConfig.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/JspConfig.java?ref=98c01e9780dfb628dbb19bea0f07b080bb55c318"
            }
        ],
        "bug_id": "tomcat80_173",
        "parent": "https://github.com/apache/tomcat80/commit/6375510e8e4dd9466fa8a708a9ffa40459342d5f",
        "message": "Another NPE fox after the switch to obtaining the JspConfigDescription from the ServletContext\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1501926 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/c0df5fab662abc752b4b63ac00a16987d0c2ab2c",
        "file": [
            {
                "patch": "@@ -77,7 +77,14 @@ public void putContext(@SuppressWarnings(\"rawtypes\") Class key,\n     }\n \n     // Can't use Class<?> because API needs to match specification\n+    /**\n+     * @throws NullPointerException\n+     *              If the key is <code>null</code>\n+     */\n     public Object getContext(@SuppressWarnings(\"rawtypes\") Class key) {\n+        if (key == null) {\n+            throw new NullPointerException();\n+        }\n         if (this.map == null) {\n             return null;\n         }",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/c0df5fab662abc752b4b63ac00a16987d0c2ab2c/java/javax/el/ELContext.java",
                "status": "modified",
                "changes": 7,
                "deletions": 0,
                "sha": "014e802d4c259b4bd78b48fa5aed7fe3153a27af",
                "blob_url": "https://github.com/apache/tomcat80/blob/c0df5fab662abc752b4b63ac00a16987d0c2ab2c/java/javax/el/ELContext.java",
                "filename": "java/javax/el/ELContext.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/javax/el/ELContext.java?ref=c0df5fab662abc752b4b63ac00a16987d0c2ab2c"
            },
            {
                "patch": "@@ -0,0 +1,32 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package javax.el;\n+\n+import org.junit.Test;\n+\n+public class TestELContext {\n+\n+    /**\n+     * Tests that a null key results in an NPE as per EL Javadoc.\n+     */\n+    @Test(expected = NullPointerException.class)\n+    public void testGetContext() {\n+        ELContext elContext = new TesterELContext();\n+        elContext.getContext(null);\n+    }\n+\n+}",
                "additions": 32,
                "raw_url": "https://github.com/apache/tomcat80/raw/c0df5fab662abc752b4b63ac00a16987d0c2ab2c/test/javax/el/TestELContext.java",
                "status": "added",
                "changes": 32,
                "deletions": 0,
                "sha": "d59b19a5e46b738878505df81ea0a2c0605feb64",
                "blob_url": "https://github.com/apache/tomcat80/blob/c0df5fab662abc752b4b63ac00a16987d0c2ab2c/test/javax/el/TestELContext.java",
                "filename": "test/javax/el/TestELContext.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/javax/el/TestELContext.java?ref=c0df5fab662abc752b4b63ac00a16987d0c2ab2c"
            },
            {
                "patch": "@@ -0,0 +1,36 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package javax.el;\n+\n+public class TesterELContext extends ELContext {\n+\n+    @Override\n+    public ELResolver getELResolver() {\n+        return null;\n+    }\n+\n+    @Override\n+    public FunctionMapper getFunctionMapper() {\n+        return null;\n+    }\n+\n+    @Override\n+    public VariableMapper getVariableMapper() {\n+        return null;\n+    }\n+\n+}",
                "additions": 36,
                "raw_url": "https://github.com/apache/tomcat80/raw/c0df5fab662abc752b4b63ac00a16987d0c2ab2c/test/javax/el/TesterELContext.java",
                "status": "added",
                "changes": 36,
                "deletions": 0,
                "sha": "c0fd1a2f7c1ddf2cac43c0f64463a1888da788ce",
                "blob_url": "https://github.com/apache/tomcat80/blob/c0df5fab662abc752b4b63ac00a16987d0c2ab2c/test/javax/el/TesterELContext.java",
                "filename": "test/javax/el/TesterELContext.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/javax/el/TesterELContext.java?ref=c0df5fab662abc752b4b63ac00a16987d0c2ab2c"
            }
        ],
        "bug_id": "tomcat80_174",
        "parent": "https://github.com/apache/tomcat80/commit/732f6f3c82166c81710a0dbe1ecbdbf02f5a0561",
        "message": "Since EL 2.2 javadoc ELContext.getContext must throw NPE when the key that is provided in NULL.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1499953 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/bc74aeacaa80733ddaca728fdda44e1a92c94711",
        "file": [
            {
                "patch": "@@ -367,12 +367,14 @@ private void unregisterAuthenticatedSession(WsSession wsSession,\n     public void closeAuthenticatedSession(String httpSessionId) {\n         Set<WsSession> wsSessions = authenticatedSessions.remove(httpSessionId);\n \n-        for (WsSession wsSession : wsSessions) {\n-            try {\n-                wsSession.close(AUTHENTICATED_HTTP_SESSION_CLOSED);\n-            } catch (IOException e) {\n-                // Any IOExceptions during close will have been caught and the\n-                // onError method called.\n+        if (wsSessions != null && !wsSessions.isEmpty()) {\n+            for (WsSession wsSession : wsSessions) {\n+                try {\n+                    wsSession.close(AUTHENTICATED_HTTP_SESSION_CLOSED);\n+                } catch (IOException e) {\n+                    // Any IOExceptions during close will have been caught and the\n+                    // onError method called.\n+                }\n             }\n         }\n     }",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/bc74aeacaa80733ddaca728fdda44e1a92c94711/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "status": "modified",
                "changes": 14,
                "deletions": 6,
                "sha": "c704d9fd21cc8b1e28272c9700230f6c0fd681ad",
                "blob_url": "https://github.com/apache/tomcat80/blob/bc74aeacaa80733ddaca728fdda44e1a92c94711/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "filename": "java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/server/WsServerContainer.java?ref=bc74aeacaa80733ddaca728fdda44e1a92c94711"
            }
        ],
        "bug_id": "tomcat80_175",
        "parent": "https://github.com/apache/tomcat80/commit/df74e687dea4ddc8afd05222487702ece4572627",
        "message": "Avoid NPE when a background thread tries to expire the HTTP sessions.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1499534 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/1303e336c1ba34a1b82374347483a2c5fe4221e9",
        "file": [
            {
                "patch": "@@ -553,7 +553,7 @@ public MessageHandlerInfo(Method m, List<DecoderEntry> decoderEntries) {\n                             m, session, config, null, params, indexInputStream,\n                             true, indexSession, true, maxMessageSize);\n                     results.add(mh);\n-                } else if (decoderMatch.hasMatches()) {\n+                } else if (decoderMatch != null && decoderMatch.hasMatches()) {\n                     if (decoderMatch.getBinaryDecoders().size() > 0) {\n                         MessageHandler mh = new PojoMessageHandlerWholeBinary(\n                                 pojo, m, session, config,",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/1303e336c1ba34a1b82374347483a2c5fe4221e9/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "9ade75aa3ec7057f38640c99ebd460349b8b202b",
                "blob_url": "https://github.com/apache/tomcat80/blob/1303e336c1ba34a1b82374347483a2c5fe4221e9/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "filename": "java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java?ref=1303e336c1ba34a1b82374347483a2c5fe4221e9"
            }
        ],
        "bug_id": "tomcat80_176",
        "parent": "https://github.com/apache/tomcat80/commit/753e52c1fc82230138c475ebe9345d0601760810",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55184\nAvoid NPE.\nPatch provided by Niki Dokovski.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1499011 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/f71574428e5bdd0aa0db2e33d288770dcfe012e8",
        "file": [
            {
                "patch": "@@ -307,11 +307,11 @@ private String parseCmd(StringBuilder cmd) {\n                 break;\n             }\n         }\n-        String command = null;\n-        if (firstLetter != -1) {\n-            command = cmd.substring(firstLetter, lastLetter + 1);\n+        if (firstLetter == -1) {\n+            return \"\";\n+        } else {\n+            return cmd.substring(firstLetter, lastLetter + 1);\n         }\n-        return command;\n     }\n \n ",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/f71574428e5bdd0aa0db2e33d288770dcfe012e8/java/org/apache/catalina/ssi/SSIProcessor.java",
                "status": "modified",
                "changes": 8,
                "deletions": 4,
                "sha": "420972834a5c80cee002a7af8f058649a8a31c5e",
                "blob_url": "https://github.com/apache/tomcat80/blob/f71574428e5bdd0aa0db2e33d288770dcfe012e8/java/org/apache/catalina/ssi/SSIProcessor.java",
                "filename": "java/org/apache/catalina/ssi/SSIProcessor.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/ssi/SSIProcessor.java?ref=f71574428e5bdd0aa0db2e33d288770dcfe012e8"
            }
        ],
        "bug_id": "tomcat80_177",
        "parent": "https://github.com/apache/tomcat80/commit/88058f19d4fb81dadc52dcb1f24cf66752a7d9b7",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54382\nAvoid NPE with an empty SSI directive\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1430550 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/6a067b521d9a04cac0f75565b1eac00713fc4d6b",
        "file": [
            {
                "patch": "@@ -174,7 +174,7 @@ public synchronized T pop() {\n      * Removes any element of the list and returns its content.\n      **/\n     public synchronized void remove(final Entry element) {\n-        if (!element.getValid()) {\n+        if (element == null || !element.getValid()) {\n             return;\n         }\n         Entry next = element.getNext();",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/6a067b521d9a04cac0f75565b1eac00713fc4d6b/java/org/apache/jasper/util/FastRemovalDequeue.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "3a7cc220f182bfd692b74aa515cc47ffecf97791",
                "blob_url": "https://github.com/apache/tomcat80/blob/6a067b521d9a04cac0f75565b1eac00713fc4d6b/java/org/apache/jasper/util/FastRemovalDequeue.java",
                "filename": "java/org/apache/jasper/util/FastRemovalDequeue.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/util/FastRemovalDequeue.java?ref=6a067b521d9a04cac0f75565b1eac00713fc4d6b"
            }
        ],
        "bug_id": "tomcat80_178",
        "parent": "https://github.com/apache/tomcat80/commit/91fc32b77f019a6f75ce4f20b4186973bb1291f3",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54260\nAvoid NPE when using JSP unloading and tag files.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1428355 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/7acc743426720d9a3da7d5cd48c722bad3a27d69",
        "file": [
            {
                "patch": "@@ -1617,7 +1617,9 @@ public void run() {\n                 } catch (OutOfMemoryError oom) {\n                     try {\n                         oomParachuteData = null;\n-                        socket.getPoller().cancelledKey(key,SocketStatus.ERROR);\n+                        if (socket != null) {\n+                            socket.getPoller().cancelledKey(key,SocketStatus.ERROR);\n+                        }\n                         releaseCaches();\n                         log.error(\"\", oom);\n                     }catch ( Throwable oomt ) {",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/7acc743426720d9a3da7d5cd48c722bad3a27d69/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "status": "modified",
                "changes": 4,
                "deletions": 1,
                "sha": "bc62b153d9524ea3e2d7b5f3c41fd0804823a657",
                "blob_url": "https://github.com/apache/tomcat80/blob/7acc743426720d9a3da7d5cd48c722bad3a27d69/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/NioEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/NioEndpoint.java?ref=7acc743426720d9a3da7d5cd48c722bad3a27d69"
            }
        ],
        "bug_id": "tomcat80_179",
        "parent": "https://github.com/apache/tomcat80/commit/67e4848d0036bdfcdf5fa03e588cc34e1509b89d",
        "message": "Fix FindBugs warning\nAvoid NPE (although given an OOME has occurred I'm not sure it matters)\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1417201 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/5d34a659c558bcf45db808fa16a4c741ba862388",
        "file": [
            {
                "patch": "@@ -40,6 +40,8 @@\n     public static boolean setProperty(Object o, String name, String value) {\n         return setProperty(o,name,value,true);\n     }\n+\n+    @SuppressWarnings(\"null\") // setPropertyMethodVoid is not null when used\n     public static boolean setProperty(Object o, String name, String value,\n             boolean invokeSetProperty) {\n         if (log.isDebugEnabled())\n@@ -308,6 +310,8 @@ public static void clear() {\n         return methods;\n     }\n \n+    @SuppressWarnings(\"null\") // Neither params nor methodParams can be null\n+                              // when comparing their lengths\n     public static Method findMethod(Class<?> c, String name,\n             Class<?> params[]) {\n         Method methods[] = findMethods(c);\n@@ -341,9 +345,9 @@ public static Method findMethod(Class<?> c, String name,\n     public static Object callMethod1(Object target, String methodN,\n             Object param1, String typeParam1, ClassLoader cl) throws Exception {\n         if (target == null || param1 == null) {\n-            if (log.isDebugEnabled())\n-                log.debug(\"IntrospectionUtils: Assert: Illegal params \" +\n-                        target + \" \" + param1);\n+            throw new IllegalArgumentException(\n+                    \"IntrospectionUtils: Assert: Illegal params \" +\n+                    target + \" \" + param1);\n         }\n         if (log.isDebugEnabled())\n             log.debug(\"IntrospectionUtils: callMethod1 \" +",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/5d34a659c558bcf45db808fa16a4c741ba862388/java/org/apache/tomcat/util/IntrospectionUtils.java",
                "status": "modified",
                "changes": 10,
                "deletions": 3,
                "sha": "bc3b9c334857b46a5f3d30a9bb1d5bfa7c30220b",
                "blob_url": "https://github.com/apache/tomcat80/blob/5d34a659c558bcf45db808fa16a4c741ba862388/java/org/apache/tomcat/util/IntrospectionUtils.java",
                "filename": "java/org/apache/tomcat/util/IntrospectionUtils.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/IntrospectionUtils.java?ref=5d34a659c558bcf45db808fa16a4c741ba862388"
            }
        ],
        "bug_id": "tomcat80_180",
        "parent": "https://github.com/apache/tomcat80/commit/92a64fb2e307c6bba92c44e1edad248c70f90235",
        "message": "Fix warnings in IntrospectionUtils.\nOne functional change to replace a debug message and a subsequent NPE with an IAE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1406394 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/f29d3b392560f59c1f9a3a0a8d82b6dcee3a8219",
        "file": [
            {
                "patch": "@@ -46,6 +46,7 @@\n import org.apache.catalina.Globals;\n import org.apache.catalina.LifecycleException;\n import org.apache.catalina.LifecycleState;\n+import org.apache.catalina.Session;\n import org.apache.catalina.connector.Request;\n import org.apache.catalina.connector.Response;\n import org.apache.coyote.RequestInfo;\n@@ -1860,15 +1861,15 @@ public void addElement(CharArrayWriter buf, Date date, Request request,\n         @Override\n         public void addElement(CharArrayWriter buf, Date date, Request request,\n                 Response response, long time) {\n-            if (request != null) {\n-                if (request.getSession(false) != null) {\n-                    buf.append(request.getSessionInternal(false)\n-                            .getIdInternal());\n-                } else {\n+            if (request == null) {\n+                buf.append('-');\n+            } else {\n+                Session session = request.getSessionInternal(false);\n+                if (session == null) {\n                     buf.append('-');\n+                } else {\n+                    buf.append(session.getIdInternal());\n                 }\n-            } else {\n-                buf.append('-');\n             }\n         }\n     }",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/f29d3b392560f59c1f9a3a0a8d82b6dcee3a8219/java/org/apache/catalina/valves/AccessLogValve.java",
                "status": "modified",
                "changes": 15,
                "deletions": 7,
                "sha": "b795ddd6117fb4b010957ce99774a307ec878769",
                "blob_url": "https://github.com/apache/tomcat80/blob/f29d3b392560f59c1f9a3a0a8d82b6dcee3a8219/java/org/apache/catalina/valves/AccessLogValve.java",
                "filename": "java/org/apache/catalina/valves/AccessLogValve.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/valves/AccessLogValve.java?ref=f29d3b392560f59c1f9a3a0a8d82b6dcee3a8219"
            }
        ],
        "bug_id": "tomcat80_181",
        "parent": "https://github.com/apache/tomcat80/commit/b4d2185670014983da86d90384ed319d2a491644",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53993\nAvoid NPE when the session is invalidated\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1397868 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/ee83f85a29a4c0b67425c00eedea454ce320b82a",
        "file": [
            {
                "patch": "@@ -24,19 +24,30 @@\n import java.net.URI;\n import java.net.URL;\n \n+import org.apache.tomcat.util.res.StringManager;\n+\n /**\n  * This class is used to obtain {@link InputStream}s for configuration files\n  * from a given location String. This allows greater flexibility than these\n  * files having to be loaded directly from a file system.\n  */\n public class ConfigFileLoader {\n \n+    private static final StringManager sm = StringManager.getManager(ConfigFileLoader.class\n+            .getPackage().getName());\n+\n     private static final File CATALINA_BASE_FILE;\n     private static final URI CATALINA_BASE_URI;\n \n     static {\n-        CATALINA_BASE_FILE = new File(System.getProperty(\"catalina.base\"));\n-        CATALINA_BASE_URI = CATALINA_BASE_FILE.toURI();\n+        String catalinaBase = System.getProperty(\"catalina.base\");\n+        if (catalinaBase != null) {\n+            CATALINA_BASE_FILE = new File(catalinaBase);\n+            CATALINA_BASE_URI = CATALINA_BASE_FILE.toURI();\n+        } else {\n+            CATALINA_BASE_FILE = null;\n+            CATALINA_BASE_URI = null;\n+        }\n     }\n \n     private ConfigFileLoader() {\n@@ -72,10 +83,19 @@ public static InputStream getInputStream(String location) throws IOException {\n         // File didn't work so try URI.\n         // Using resolve() enables the code to handle relative paths that did\n         // not point to a file\n-        URI uri = CATALINA_BASE_URI.resolve(location);\n+        URI uri;\n+        if (CATALINA_BASE_URI != null) {\n+            uri = CATALINA_BASE_URI.resolve(location);\n+        } else {\n+            uri = URI.create(location);\n+        }\n \n         // Obtain the input stream we need\n-        URL url = uri.toURL();\n-        return url.openConnection().getInputStream();\n+        try {\n+            URL url = uri.toURL();\n+            return url.openConnection().getInputStream();\n+        } catch (IllegalArgumentException e) {\n+            throw new IOException(sm.getString(\"configFileLoader.cannotObtainURL\", location), e);\n+        }\n     }\n }",
                "additions": 25,
                "raw_url": "https://github.com/apache/tomcat80/raw/ee83f85a29a4c0b67425c00eedea454ce320b82a/java/org/apache/tomcat/util/file/ConfigFileLoader.java",
                "status": "modified",
                "changes": 30,
                "deletions": 5,
                "sha": "12cc533276d87c05e47a32b2ea7b74afd4f239c4",
                "blob_url": "https://github.com/apache/tomcat80/blob/ee83f85a29a4c0b67425c00eedea454ce320b82a/java/org/apache/tomcat/util/file/ConfigFileLoader.java",
                "filename": "java/org/apache/tomcat/util/file/ConfigFileLoader.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/file/ConfigFileLoader.java?ref=ee83f85a29a4c0b67425c00eedea454ce320b82a"
            },
            {
                "patch": "@@ -0,0 +1,16 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+configFileLoader.cannotObtainURL=Cannot obtain URL for the relative path [{0}]. Check that catalina.base is set.\n\\ No newline at end of file",
                "additions": 16,
                "raw_url": "https://github.com/apache/tomcat80/raw/ee83f85a29a4c0b67425c00eedea454ce320b82a/java/org/apache/tomcat/util/file/LocalStrings.properties",
                "status": "added",
                "changes": 16,
                "deletions": 0,
                "sha": "5bbf626ba2a62320493984e1086fb0ba9da612e1",
                "blob_url": "https://github.com/apache/tomcat80/blob/ee83f85a29a4c0b67425c00eedea454ce320b82a/java/org/apache/tomcat/util/file/LocalStrings.properties",
                "filename": "java/org/apache/tomcat/util/file/LocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/file/LocalStrings.properties?ref=ee83f85a29a4c0b67425c00eedea454ce320b82a"
            },
            {
                "patch": "@@ -45,6 +45,15 @@\n   issues do not \"pop up\" wrt. others).\n -->\n <section name=\"Tomcat 8.0.34 (markt)\" rtext=\"development in progress\">\n+  <subsection name=\"Catalina\">\n+    <changelog>\n+      <fix>\n+        <bug>59206</bug>: Ensure NPE will not be thrown by\n+        <code>o.a.tomcat.util.file.ConfigFileLoader</code> when\n+        <code>catalina.base</code> is not specified. (violetagg)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection name=\"Tribes\">\n     <changelog>\n       <fix>",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/ee83f85a29a4c0b67425c00eedea454ce320b82a/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 9,
                "deletions": 0,
                "sha": "575f896e978d37aa76b5a2ff8b6da184cdff6b10",
                "blob_url": "https://github.com/apache/tomcat80/blob/ee83f85a29a4c0b67425c00eedea454ce320b82a/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=ee83f85a29a4c0b67425c00eedea454ce320b82a"
            }
        ],
        "bug_id": "tomcat80_182",
        "parent": "https://github.com/apache/tomcat80/commit/b94eeb9c81a521577a3443200fbce8dad75b3c4f",
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59206\nMerged revision 1736209 from tomcat/trunk:\nEnsure NPE will not be thrown by when catalina.base is not specified.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1736239 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/13d22d1ac89adff79145b5e4e87c719df868a873",
        "file": [
            {
                "patch": "@@ -337,9 +337,6 @@ public void pushPrefixMapping(String prefix, String uri) {\n      */\n     public void popPrefixMapping(String prefix) {\n         LinkedList<String> stack = xmlPrefixMapper.get(prefix);\n-        if (stack == null || stack.size() == 0) {\n-            // XXX throw new Exception(\"XXX\");\n-        }\n         stack.removeFirst();\n     }\n \n@@ -465,6 +462,7 @@ public void setBufferValue(String value, Node n, ErrorDispatcher err)\n                 }\n             }\n             try {\n+                @SuppressWarnings(\"null\") // value can't be null here\n                 Integer k = new Integer(value.substring(0, value.length()-2));\n                 buffer = k.intValue() * 1024;\n             } catch (NumberFormatException e) {",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/13d22d1ac89adff79145b5e4e87c719df868a873/java/org/apache/jasper/compiler/PageInfo.java",
                "status": "modified",
                "changes": 4,
                "deletions": 3,
                "sha": "2f99c32f8b9de80c2b524183472744e0890d5644",
                "blob_url": "https://github.com/apache/tomcat80/blob/13d22d1ac89adff79145b5e4e87c719df868a873/java/org/apache/jasper/compiler/PageInfo.java",
                "filename": "java/org/apache/jasper/compiler/PageInfo.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/PageInfo.java?ref=13d22d1ac89adff79145b5e4e87c719df868a873"
            }
        ],
        "bug_id": "tomcat80_183",
        "parent": "https://github.com/apache/tomcat80/commit/00ee85d234cc83d3738c00758a695310fa9b4a52",
        "message": "Clean-up\n- fix false positive NPE warnings by removing redundant code and suppressing remaining warning\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1380381 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/00ee85d234cc83d3738c00758a695310fa9b4a52",
        "file": [
            {
                "patch": "@@ -652,6 +652,7 @@ public void visit(Node.UseBean n) throws JasperException {\n             visitBody(n);\n         }\n \n+        @SuppressWarnings(\"null\") // type can't be null after initial test\n         @Override\n         public void visit(Node.PlugIn n) throws JasperException {\n             JspUtil.checkAttributes(\"Plugin\", n, plugInAttrs, err);\n@@ -803,6 +804,7 @@ private boolean containsDeferredSyntax(String value) {\n             return false;\n         }\n \n+        @SuppressWarnings(\"null\") // tagInfo can't be null after initial test\n         @Override\n         public void visit(Node.CustomTag n) throws JasperException {\n \n@@ -1071,9 +1073,6 @@ private void checkXmlAttributes(Node.CustomTag n,\n                 throws JasperException {\n \n             TagInfo tagInfo = n.getTagInfo();\n-            if (tagInfo == null) {\n-                err.jspError(n, \"jsp.error.missing.tagInfo\", n.getQName());\n-            }\n             TagAttributeInfo[] tldAttrs = tagInfo.getAttributes();\n             Attributes attrs = n.getAttributes();\n \n@@ -1279,9 +1278,6 @@ private void checkNamedAttributes(Node.CustomTag n,\n                 throws JasperException {\n \n             TagInfo tagInfo = n.getTagInfo();\n-            if (tagInfo == null) {\n-                err.jspError(n, \"jsp.error.missing.tagInfo\", n.getQName());\n-            }\n             TagAttributeInfo[] tldAttrs = tagInfo.getAttributes();\n             Node.Nodes naNodes = n.getNamedAttributeNodes();\n \n@@ -1663,6 +1659,7 @@ public Method resolveFunction(String prefix, String localName) {\n                     this.fmapper = fmapper;\n                 }\n \n+                @SuppressWarnings(\"null\") // c can't be null after catch block\n                 @Override\n                 public void visit(ELNode.Function n) throws JasperException {\n \n@@ -1726,6 +1723,7 @@ public void visit(Node.CustomTag n) throws JasperException {\n                 err.jspError(n, \"jsp.error.missing.tagInfo\", n.getQName());\n             }\n \n+            @SuppressWarnings(\"null\") // tagInfo can't be null here\n             ValidationMessage[] errors = tagInfo.validate(n.getTagData());\n             if (errors != null && errors.length != 0) {\n                 StringBuilder errMsg = new StringBuilder();",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/00ee85d234cc83d3738c00758a695310fa9b4a52/java/org/apache/jasper/compiler/Validator.java",
                "status": "modified",
                "changes": 10,
                "deletions": 6,
                "sha": "0d3a5ad6147a25c30dfaa0caa00dd2439389a929",
                "blob_url": "https://github.com/apache/tomcat80/blob/00ee85d234cc83d3738c00758a695310fa9b4a52/java/org/apache/jasper/compiler/Validator.java",
                "filename": "java/org/apache/jasper/compiler/Validator.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/Validator.java?ref=00ee85d234cc83d3738c00758a695310fa9b4a52"
            }
        ],
        "bug_id": "tomcat80_184",
        "parent": "https://github.com/apache/tomcat80/commit/bb797dfa08a2569694eb768545b4de1dcfaf5ae3",
        "message": "Clean-up\n- fix false positive NPE warnings by removing redundant tests and suppressing remaining warnings\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1380380 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/d03ccdc1609048791c6efaf6a1a70ff1a36afa91",
        "file": [
            {
                "patch": "@@ -38,10 +38,7 @@\n import javax.naming.NamingException;\n import javax.servlet.http.HttpServletRequest;\n \n-import static org.junit.Assert.assertEquals;\n-import static org.junit.Assert.assertFalse;\n-import static org.junit.Assert.assertTrue;\n-\n+import org.junit.Assert;\n import org.junit.Test;\n \n import org.apache.catalina.Context;\n@@ -84,19 +81,20 @@ public void testSimple() throws Exception {\n \n         // Make sure we got an upgrade response\n         String responseLine = client.reader.readLine();\n-        assertTrue(responseLine.startsWith(\"HTTP/1.1 101\"));\n+        Assert.assertNotNull(responseLine);\n+        Assert.assertTrue(responseLine.startsWith(\"HTTP/1.1 101\"));\n \n         // Swallow the headers\n         String responseHeaderLine = client.reader.readLine();\n-        while (!responseHeaderLine.equals(\"\")) {\n+        while (!\"\".equals(responseHeaderLine)) {\n             responseHeaderLine = client.reader.readLine();\n         }\n \n         // Now we can do WebSocket\n         client.sendMessage(\"foo\", false);\n         client.sendMessage(\"foo\", true);\n \n-        assertEquals(\"foofoo\", client.readMessage());\n+        Assert.assertEquals(\"foofoo\", client.readMessage());\n \n         // Finished with the socket\n         client.close();\n@@ -123,17 +121,18 @@ public void testDetectWrongVersion() throws Exception {\n \n         // Make sure we got an upgrade response\n         String responseLine = client.reader.readLine();\n-        assertTrue(responseLine.startsWith(\"HTTP/1.1 426\"));\n+        Assert.assertNotNull(responseLine);\n+        Assert.assertTrue(responseLine.startsWith(\"HTTP/1.1 426\"));\n \n-        List<String> headerlines = new ArrayList<String>();\n+        List<String> headerlines = new ArrayList<>();\n \n         String responseHeaderLine = client.reader.readLine();\n-        while (!responseHeaderLine.equals(\"\")) {\n+        while (!\"\".equals(responseHeaderLine)) {\n             headerlines.add(responseHeaderLine);\n             responseHeaderLine = client.reader.readLine();\n         }\n \n-        assertTrue(headerlines.contains(\"Sec-WebSocket-Version: 13\"));\n+        Assert.assertTrue(headerlines.contains(\"Sec-WebSocket-Version: 13\"));\n         // Finished with the socket\n         client.close();\n     }\n@@ -159,7 +158,8 @@ public void testNoConnection() throws Exception {\n \n         // Make sure we got an upgrade response\n         String responseLine = client.reader.readLine();\n-        assertTrue(responseLine.startsWith(\"HTTP/1.1 400\"));\n+        Assert.assertNotNull(responseLine);\n+        Assert.assertTrue(responseLine.startsWith(\"HTTP/1.1 400\"));\n \n         // Finished with the socket\n         client.close();\n@@ -186,7 +186,8 @@ public void testNoUpgrade() throws Exception {\n \n         // Make sure we got an upgrade response\n         String responseLine = client.reader.readLine();\n-        assertTrue(responseLine.startsWith(\"HTTP/1.1 400\"));\n+        Assert.assertNotNull(responseLine);\n+        Assert.assertTrue(responseLine.startsWith(\"HTTP/1.1 400\"));\n \n         // Finished with the socket\n         client.close();\n@@ -213,28 +214,29 @@ public void testKey() throws Exception {\n \n         // Make sure we got an upgrade response\n         String responseLine = client.reader.readLine();\n-        assertTrue(responseLine.startsWith(\"HTTP/1.1 101\"));\n+        Assert.assertNotNull(responseLine);\n+        Assert.assertTrue(responseLine.startsWith(\"HTTP/1.1 101\"));\n \n         String accept = null;\n         String responseHeaderLine = client.reader.readLine();\n-        while (!responseHeaderLine.equals(\"\")) {\n+        while (!\"\".equals(responseHeaderLine)) {\n             if(responseHeaderLine.startsWith(\"Sec-WebSocket-Accept: \")) {\n                 accept = responseHeaderLine.substring(responseHeaderLine.indexOf(\":\")+2);\n                 break;\n             }\n             responseHeaderLine = client.reader.readLine();\n         }\n-        assertTrue(accept != null);\n+        Assert.assertTrue(accept != null);\n         MessageDigest sha1Helper = MessageDigest.getInstance(\"SHA1\");\n         sha1Helper.reset();\n         sha1Helper.update(\"TODO\".getBytes(B2CConverter.ISO_8859_1));\n         String source = Base64.encode(sha1Helper.digest(WS_ACCEPT));\n-        assertEquals(source,accept);\n+        Assert.assertEquals(source,accept);\n \n         sha1Helper.reset();\n         sha1Helper.update(\"TOD\".getBytes(B2CConverter.ISO_8859_1));\n         source = Base64.encode(sha1Helper.digest(WS_ACCEPT));\n-        assertFalse(source.equals(accept));\n+        Assert.assertFalse(source.equals(accept));\n         // Finished with the socket\n         client.close();\n     }\n@@ -275,17 +277,18 @@ public void testBug53339() throws Exception {\n \n         // Make sure we got an upgrade response\n         String responseLine = client.reader.readLine();\n-        assertTrue(responseLine.startsWith(\"HTTP/1.1 101\"));\n+        Assert.assertNotNull(responseLine);\n+        Assert.assertTrue(responseLine.startsWith(\"HTTP/1.1 101\"));\n \n         // Swallow the headers\n         String responseHeaderLine = client.reader.readLine();\n-        while (!responseHeaderLine.equals(\"\")) {\n+        while (!\"\".equals(responseHeaderLine)) {\n             responseHeaderLine = client.reader.readLine();\n         }\n \n         // Now we can do WebSocket\n         String msg = client.readMessage();\n-        assertEquals(Bug53339WsInbound.TEST_MESSAGE, msg);\n+        Assert.assertEquals(Bug53339WsInbound.TEST_MESSAGE, msg);\n \n         // Finished with the socket\n         client.close();\n@@ -377,7 +380,7 @@ private void sendMessage(String message, boolean finalFragment)\n             c2b.flushBuffer();\n \n             int len = bc.getLength();\n-            assertTrue(len < 126);\n+            Assert.assertTrue(len < 126);\n \n             byte first;\n             if (isContinuation) {\n@@ -416,7 +419,7 @@ private String readMessage() throws IOException {\n \n             // Get payload length\n             int len = is.read() & 0x7F;\n-            assertTrue(len < 126);\n+            Assert.assertTrue(len < 126);\n \n             // Read payload\n             int read = 0;",
                "additions": 26,
                "raw_url": "https://github.com/apache/tomcat80/raw/d03ccdc1609048791c6efaf6a1a70ff1a36afa91/test/org/apache/catalina/websocket/TestWebSocket.java",
                "status": "modified",
                "changes": 49,
                "deletions": 23,
                "sha": "0f4b4e4a0a02cc05bb12adee9611e936f3952d0d",
                "blob_url": "https://github.com/apache/tomcat80/blob/d03ccdc1609048791c6efaf6a1a70ff1a36afa91/test/org/apache/catalina/websocket/TestWebSocket.java",
                "filename": "test/org/apache/catalina/websocket/TestWebSocket.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/websocket/TestWebSocket.java?ref=d03ccdc1609048791c6efaf6a1a70ff1a36afa91"
            }
        ],
        "bug_id": "tomcat80_185",
        "parent": "https://github.com/apache/tomcat80/commit/f126dbec60acfa91c03e0c16bc770bafaf9ac4c5",
        "message": "Clean-up\n- Fix FindBugs NPE warnings\n- Java 7 <>\n- Remove static imports (auto completes are easier without them)\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1377835 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/76e849f5b55cf94574c572ab4a3d249209a710a9",
        "file": [
            {
                "patch": "@@ -27,6 +27,7 @@\n import org.apache.catalina.tribes.Member;\n import org.apache.catalina.tribes.group.ChannelInterceptorBase;\n import org.apache.catalina.tribes.io.ChannelData;\n+import org.apache.catalina.tribes.io.XByteBuffer;\n import org.apache.juli.logging.Log;\n import org.apache.juli.logging.LogFactory;\n \n@@ -145,6 +146,7 @@ protected void sendPingMessage(Member[] members) {\n         data.setAddress(getLocalMember(false));\n         data.setTimestamp(System.currentTimeMillis());\n         data.setOptions(getOptionFlag());\n+        data.setMessage(new XByteBuffer(TCP_PING_DATA, false));\n         try {\n             super.sendMessage(members, data, null);\n         }catch (ChannelException x) {",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/76e849f5b55cf94574c572ab4a3d249209a710a9/java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java",
                "status": "modified",
                "changes": 2,
                "deletions": 0,
                "sha": "211c3308f2fd229e0a4bcfdb90e9dd029ac4a20b",
                "blob_url": "https://github.com/apache/tomcat80/blob/76e849f5b55cf94574c572ab4a3d249209a710a9/java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java",
                "filename": "java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java?ref=76e849f5b55cf94574c572ab4a3d249209a710a9"
            }
        ],
        "bug_id": "tomcat80_186",
        "parent": "https://github.com/apache/tomcat80/commit/b6f7c02b2a90242036022ebb7da7cafe29d924cc",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53607.\nTo avoid NPE, set TCP PING data to ChannelMessage.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1367454 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/cf323596cd798be366fe49a3645aa249cd46bb32",
        "file": [
            {
                "patch": "@@ -547,8 +547,10 @@ protected void deployDescriptor(ContextName cn, File contextXml) {\n                     log.error(sm.getString(\n                             \"hostConfig.deployDescriptor.error\",\n                             contextXml.getAbsolutePath()));\n-                    context = new FailedContext();\n                 } finally {\n+                    if (context == null) {\n+                        context = new FailedContext();\n+                    }\n                     digester.reset();\n                 }\n             }\n@@ -598,7 +600,7 @@ protected void deployDescriptor(ContextName cn, File contextXml) {\n \n             // default to appBase dir + name\n             expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n-            if (context != null && context.getDocBase() != null) {\n+            if (context.getDocBase() != null) {\n                 // first assume docBase is absolute\n                 expandedDocBase = new File(context.getDocBase());\n                 if (!expandedDocBase.isAbsolute()) {\n@@ -644,7 +646,7 @@ protected void deployDescriptor(ContextName cn, File contextXml) {\n             addGlobalRedeployResources(deployedApp);\n         }\n \n-        if (context != null && host.findChild(context.getName()) != null) {\n+        if (host.findChild(context.getName()) != null) {\n             deployed.put(context.getName(), deployedApp);\n         }\n     }\n@@ -834,8 +836,10 @@ protected void deployWAR(ContextName cn, File war) {\n                         log.error(sm.getString(\n                                 \"hostConfig.deployDescriptor.error\",\n                                 war.getAbsolutePath()));\n-                        context = new FailedContext();\n                     } finally {\n+                        if (context == null) {\n+                            context = new FailedContext();\n+                        }\n                         digester.reset();\n                     }\n                 }\n@@ -995,8 +999,10 @@ protected void deployDirectory(ContextName cn, File dir) {\n                         log.error(sm.getString(\n                                 \"hostConfig.deployDescriptor.error\",\n                                 xml));\n-                        context = new FailedContext();\n                     } finally {\n+                        if (context == null) {\n+                            context = new FailedContext();\n+                        }\n                         digester.reset();\n                     }\n                 }",
                "additions": 11,
                "raw_url": "https://github.com/apache/tomcat80/raw/cf323596cd798be366fe49a3645aa249cd46bb32/java/org/apache/catalina/startup/HostConfig.java",
                "status": "modified",
                "changes": 16,
                "deletions": 5,
                "sha": "6ef867d7855004ba5fe9a4a38bac4dbf03e30726",
                "blob_url": "https://github.com/apache/tomcat80/blob/cf323596cd798be366fe49a3645aa249cd46bb32/java/org/apache/catalina/startup/HostConfig.java",
                "filename": "java/org/apache/catalina/startup/HostConfig.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/startup/HostConfig.java?ref=cf323596cd798be366fe49a3645aa249cd46bb32"
            }
        ],
        "bug_id": "tomcat80_187",
        "parent": "https://github.com/apache/tomcat80/commit/ab6f0e93803c5e770d75a1731e611f2139e0c5dc",
        "message": "FindBugs - Possible NPE\nUse consistent approach to exception handling and the creation of the FailedContext instance\ncontext cannot be null\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1364154 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/abe1bbd278b2c088484e3bd77e0f12f59e9d6c6f",
        "file": [
            {
                "patch": "@@ -42,11 +42,17 @@ public void init() throws ServletException {\n \n     public int getInitParameterIntValue(String name, int defaultValue) {\n         String val = this.getInitParameter(name);\n-        int result = defaultValue;\n-        try {\n-            result = Integer.parseInt(val);\n-        }catch (Exception x) {\n+        int result;\n+        if(null != val) {\n+            try {\n+                result = Integer.parseInt(val);\n+            }catch (Exception x) {\n+                result = defaultValue;\n+            }\n+        } else {\n+            result = defaultValue;\n         }\n+\n         return result;\n     }\n ",
                "additions": 10,
                "raw_url": "https://github.com/apache/tomcat80/raw/abe1bbd278b2c088484e3bd77e0f12f59e9d6c6f/webapps/examples/WEB-INF/classes/websocket/echo/EchoMessage.java",
                "status": "modified",
                "changes": 14,
                "deletions": 4,
                "sha": "1806dd5e2458641a3a1fb763a0ebd4107ae76838",
                "blob_url": "https://github.com/apache/tomcat80/blob/abe1bbd278b2c088484e3bd77e0f12f59e9d6c6f/webapps/examples/WEB-INF/classes/websocket/echo/EchoMessage.java",
                "filename": "webapps/examples/WEB-INF/classes/websocket/echo/EchoMessage.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/examples/WEB-INF/classes/websocket/echo/EchoMessage.java?ref=abe1bbd278b2c088484e3bd77e0f12f59e9d6c6f"
            }
        ],
        "bug_id": "tomcat80_188",
        "parent": "https://github.com/apache/tomcat80/commit/8eb5c13709ea8eb569a7bbdecd2b5ac04d94c8ab",
        "message": "Clean-up: avoid NPE and immediate catch when init parameter does not exist. Also do not assign default value unless necessary.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1346683 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/988cc3cf976e87003300d9dbc90205c8e8ef00ae",
        "file": [
            {
                "patch": "@@ -20,10 +20,12 @@\n import java.util.Iterator;\n import java.util.Set;\n \n+import org.apache.catalina.Cluster;\n import org.apache.catalina.DistributedManager;\n import org.apache.catalina.LifecycleException;\n import org.apache.catalina.LifecycleState;\n import org.apache.catalina.Session;\n+import org.apache.catalina.ha.CatalinaCluster;\n import org.apache.catalina.ha.ClusterManager;\n import org.apache.catalina.ha.ClusterMessage;\n import org.apache.catalina.tribes.Channel;\n@@ -143,6 +145,15 @@ protected synchronized void startInternal() throws LifecycleException {\n         super.startInternal();\n \n         try {\n+            if (getCluster() == null) {\n+                Cluster cluster = getContainer().getCluster();\n+                if (cluster instanceof CatalinaCluster) {\n+                    setCluster((CatalinaCluster)cluster);\n+                } else {\n+                    throw new LifecycleException(\n+                            \"no cluster associated with this context: \" + getName());\n+                }\n+            }\n             cluster.registerManager(this);\n             LazyReplicatedMap<String,Session> map =\n                     new LazyReplicatedMap<String,Session>(this,",
                "additions": 11,
                "raw_url": "https://github.com/apache/tomcat80/raw/988cc3cf976e87003300d9dbc90205c8e8ef00ae/java/org/apache/catalina/ha/session/BackupManager.java",
                "status": "modified",
                "changes": 11,
                "deletions": 0,
                "sha": "174792119a323c27def5d29069c75cef4262c820",
                "blob_url": "https://github.com/apache/tomcat80/blob/988cc3cf976e87003300d9dbc90205c8e8ef00ae/java/org/apache/catalina/ha/session/BackupManager.java",
                "filename": "java/org/apache/catalina/ha/session/BackupManager.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/ha/session/BackupManager.java?ref=988cc3cf976e87003300d9dbc90205c8e8ef00ae"
            }
        ],
        "bug_id": "tomcat80_189",
        "parent": "https://github.com/apache/tomcat80/commit/3e6780831fa61c95b7e0748c24a17bc1a69b0a97",
        "message": "Avoid NPE when reload if a state of a BackupManager is FAILED.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1324575 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/c52fc2252a9bf807c2bddf5b5f8aab37fe515f19",
        "file": [
            {
                "patch": "@@ -49,7 +49,8 @@ public void testTimerThreadLeak() throws Exception {\n             ((StandardContext) ctx).setClearReferencesStopThreads(true);\n         }\n \n-        Tomcat.addServlet(ctx, \"taskServlet\", new ExecutorServlet());\n+        ExecutorServlet executorServlet = new ExecutorServlet();\n+        Tomcat.addServlet(ctx, \"taskServlet\", executorServlet);\n         ctx.addServletMapping(\"/\", \"taskServlet\");\n \n         tomcat.start();\n@@ -67,8 +68,8 @@ public void testTimerThreadLeak() throws Exception {\n             // ignore\n         }\n \n-        Assert.assertTrue(ExecutorServlet.tpe.isShutdown());\n-        Assert.assertTrue(ExecutorServlet.tpe.isTerminated());\n+        Assert.assertTrue(executorServlet.tpe.isShutdown());\n+        Assert.assertTrue(executorServlet.tpe.isTerminated());\n     }\n \n     static class ExecutorServlet extends HttpServlet {\n@@ -79,7 +80,7 @@ public void testTimerThreadLeak() throws Exception {\n         long n = 1000L;\n         int tpSize = 10;\n \n-        public static ThreadPoolExecutor tpe;\n+        public volatile ThreadPoolExecutor tpe;\n \n         @Override\n         protected void doGet(HttpServletRequest req, HttpServletResponse resp)",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/c52fc2252a9bf807c2bddf5b5f8aab37fe515f19/test/org/apache/catalina/loader/TestWebappClassLoaderExecutorMemoryLeak.java",
                "status": "modified",
                "changes": 9,
                "deletions": 4,
                "sha": "641066980b548bd7f4d25c01b88c7f2b664d3366",
                "blob_url": "https://github.com/apache/tomcat80/blob/c52fc2252a9bf807c2bddf5b5f8aab37fe515f19/test/org/apache/catalina/loader/TestWebappClassLoaderExecutorMemoryLeak.java",
                "filename": "test/org/apache/catalina/loader/TestWebappClassLoaderExecutorMemoryLeak.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/loader/TestWebappClassLoaderExecutorMemoryLeak.java?ref=c52fc2252a9bf807c2bddf5b5f8aab37fe515f19"
            }
        ],
        "bug_id": "tomcat80_190",
        "parent": "https://github.com/apache/tomcat80/commit/a86c3e93c401f5a3beba487f312fbf57dd471e58",
        "message": "Observed strange NPE while running tests. This isn't much more than a guess at what might have caused it.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1304037 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/c33f5d9816aae4ece82df8774d1ba7868b7003df",
        "file": [
            {
                "patch": "@@ -85,6 +85,9 @@ public static String dumpBeans(MBeanServer mbeanServer, Set<ObjectName> names)\n                         if (cause instanceof UnsupportedOperationException) {\n                             log.debug(\"Error getting attribute \" + oname +\n                                     \" \" + attName, rme);\n+                        } else if (cause instanceof NullPointerException) {\n+                            log.debug(\"Error getting attribute \" + oname +\n+                                    \" \" + attName, rme);\n                         } else {\n                             log.error(\"Error getting attribute \" + oname +\n                                     \" \" + attName, rme);",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/c33f5d9816aae4ece82df8774d1ba7868b7003df/java/org/apache/catalina/mbeans/MBeanDumper.java",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "9f94eea1040f3173d320bfb3cfb28e3e0cbd4899",
                "blob_url": "https://github.com/apache/tomcat80/blob/c33f5d9816aae4ece82df8774d1ba7868b7003df/java/org/apache/catalina/mbeans/MBeanDumper.java",
                "filename": "java/org/apache/catalina/mbeans/MBeanDumper.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/mbeans/MBeanDumper.java?ref=c33f5d9816aae4ece82df8774d1ba7868b7003df"
            }
        ],
        "bug_id": "tomcat80_191",
        "parent": "https://github.com/apache/tomcat80/commit/9714da1e5c4083354d673e64d42427f3bb43bb25",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52671\nLog NPEs for attributes that are not set at debug.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1244719 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/c0cfc7b9d3a94383b764b2e0737a01eddf7a3163",
        "file": [
            {
                "patch": "@@ -236,6 +236,10 @@ protected void listen() throws Exception {\n         }\n \n         setListen(true);\n+\n+        // Avoid NPEs if selector is set to null on stop.\n+        Selector selector = this.selector;\n+\n         if (selector!=null && datagramChannel!=null) {\n             ObjectReader oreader = new ObjectReader(MAX_UDP_SIZE); //max size for a datagram packet\n             datagramChannel.socket().setSendBufferSize(getUdpTxBufSize());\n@@ -267,7 +271,7 @@ protected void listen() throws Exception {\n                     continue; // nothing to do\n                 }\n                 // get an iterator over the set of selected keys\n-                Iterator<SelectionKey> it = (selector!=null)?selector.selectedKeys().iterator():null;\n+                Iterator<SelectionKey> it = selector.selectedKeys().iterator();\n                 // look at each key in the selected set\n                 while (it!=null && it.hasNext()) {\n                     SelectionKey key = it.next();\n@@ -298,7 +302,7 @@ protected void listen() throws Exception {\n                     }\n \n                     // remove key from selected set, it's been handled\n-                    if (selector!=null) it.remove();\n+                    it.remove();\n                 }\n             } catch (java.nio.channels.ClosedSelectorException cse) {\n                 // ignore is normal at shutdown or stop listen socket",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/c0cfc7b9d3a94383b764b2e0737a01eddf7a3163/java/org/apache/catalina/tribes/transport/nio/NioReceiver.java",
                "status": "modified",
                "changes": 8,
                "deletions": 2,
                "sha": "6ff701130240776089552f63bdc3d436f0468e20",
                "blob_url": "https://github.com/apache/tomcat80/blob/c0cfc7b9d3a94383b764b2e0737a01eddf7a3163/java/org/apache/catalina/tribes/transport/nio/NioReceiver.java",
                "filename": "java/org/apache/catalina/tribes/transport/nio/NioReceiver.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/tribes/transport/nio/NioReceiver.java?ref=c0cfc7b9d3a94383b764b2e0737a01eddf7a3163"
            }
        ],
        "bug_id": "tomcat80_192",
        "parent": "https://github.com/apache/tomcat80/commit/fa2596519eff86c2eb2e96bec0880757069ee426",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52208\nAvoid possible NPEs if stopListening is called in a different thread\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1212118 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/d5772fae484f57153fa73006ab56f4118be0207b",
        "file": [
            {
                "patch": "@@ -277,41 +277,47 @@ public String getSSLEngine() {\n     }\n \n     public void setSSLEngine(String SSLEngine) {\n-        // Ensure that the SSLEngine is consistent with that used for SSL init\n-        if (sslInitialized) {\n-            throw new IllegalStateException(\n-                    sm.getString(\"aprListener.tooLateForSSLEngine\"));\n-        }\n+        if (!SSLEngine.equals(AprLifecycleListener.SSLEngine)) {\n+            // Ensure that the SSLEngine is consistent with that used for SSL init\n+            if (sslInitialized) {\n+                throw new IllegalStateException(\n+                        sm.getString(\"aprListener.tooLateForSSLEngine\"));\n+            }\n \n-        AprLifecycleListener.SSLEngine = SSLEngine;\n+            AprLifecycleListener.SSLEngine = SSLEngine;\n+        }\n     }\n \n     public String getSSLRandomSeed() {\n         return SSLRandomSeed;\n     }\n \n     public void setSSLRandomSeed(String SSLRandomSeed) {\n-        // Ensure that the random seed is consistent with that used for SSL init\n-        if (sslInitialized) {\n-            throw new IllegalStateException(\n-                    sm.getString(\"aprListener.tooLateForSSLRandomSeed\"));\n-        }\n+        if (!SSLRandomSeed.equals(AprLifecycleListener.SSLRandomSeed)) {\n+            // Ensure that the random seed is consistent with that used for SSL init\n+            if (sslInitialized) {\n+                throw new IllegalStateException(\n+                        sm.getString(\"aprListener.tooLateForSSLRandomSeed\"));\n+            }\n \n-        AprLifecycleListener.SSLRandomSeed = SSLRandomSeed;\n+            AprLifecycleListener.SSLRandomSeed = SSLRandomSeed;\n+        }\n     }\n \n     public String getFIPSMode() {\n         return FIPSMode;\n     }\n \n     public void setFIPSMode(String FIPSMode) {\n-        // Ensure that the FIPS mode is consistent with that used for SSL init\n-        if (sslInitialized) {\n-            throw new IllegalStateException(\n-                    sm.getString(\"aprListener.tooLateForFIPSMode\"));\n-        }\n+        if (!FIPSMode.equals(AprLifecycleListener.FIPSMode)) {\n+            // Ensure that the FIPS mode is consistent with that used for SSL init\n+            if (sslInitialized) {\n+                throw new IllegalStateException(\n+                        sm.getString(\"aprListener.tooLateForFIPSMode\"));\n+            }\n \n-        AprLifecycleListener.FIPSMode = FIPSMode;\n+            AprLifecycleListener.FIPSMode = FIPSMode;\n+        }\n     }\n \n     public boolean isFIPSModeActive() {",
                "additions": 24,
                "raw_url": "https://github.com/apache/tomcat80/raw/d5772fae484f57153fa73006ab56f4118be0207b/java/org/apache/catalina/core/AprLifecycleListener.java",
                "status": "modified",
                "changes": 42,
                "deletions": 18,
                "sha": "ac5bc0f839d3ce10721588cd198c76118bd15c1b",
                "blob_url": "https://github.com/apache/tomcat80/blob/d5772fae484f57153fa73006ab56f4118be0207b/java/org/apache/catalina/core/AprLifecycleListener.java",
                "filename": "java/org/apache/catalina/core/AprLifecycleListener.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/AprLifecycleListener.java?ref=d5772fae484f57153fa73006ab56f4118be0207b"
            }
        ],
        "bug_id": "tomcat80_193",
        "parent": "https://github.com/apache/tomcat80/commit/97040c2176aaeb465b57de074a4575de7870dcf7",
        "message": "Check state and throw ISE only if the new value differs from the old one.\nThrows NPE for invalid null values.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1201180 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/20edee908bea0b7e84056f3375bbd3128b1ff51c",
        "file": [
            {
                "patch": "@@ -215,7 +215,7 @@ public void release(SocketWrapper<Long> socket,\n                 boolean addToPoller) {\n             processor.recycle();\n             recycledProcessors.offer(processor);\n-            if (addToPoller) {\n+            if (addToPoller && proto.endpoint.isRunning()) {\n                 ((AprEndpoint)proto.endpoint).getPoller().add(\n                         socket.getSocket().longValue(), true);\n             }\n@@ -234,7 +234,7 @@ protected void longPoll(SocketWrapper<Long> socket,\n \n             if (processor.isAsync()) {\n                 socket.setAsync(true);\n-            } else if (processor.comet) {\n+            } else if (processor.comet && proto.endpoint.isRunning()) {\n                 ((AprEndpoint) proto.endpoint).getCometPoller().add(\n                         socket.getSocket().longValue(), false);\n             }",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/20edee908bea0b7e84056f3375bbd3128b1ff51c/java/org/apache/coyote/http11/Http11AprProtocol.java",
                "status": "modified",
                "changes": 4,
                "deletions": 2,
                "sha": "163c4a489b0fa752a80494a48e8154964b93cf51",
                "blob_url": "https://github.com/apache/tomcat80/blob/20edee908bea0b7e84056f3375bbd3128b1ff51c/java/org/apache/coyote/http11/Http11AprProtocol.java",
                "filename": "java/org/apache/coyote/http11/Http11AprProtocol.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/http11/Http11AprProtocol.java?ref=20edee908bea0b7e84056f3375bbd3128b1ff51c"
            }
        ],
        "bug_id": "tomcat80_194",
        "parent": "https://github.com/apache/tomcat80/commit/3ce615225688b74ac33ab3cc6013ae7e3c0b5c14",
        "message": "Don't add to Poller when socket is closing to prevent NPEs.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1172711 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/9b843201d4ecab087c1d403f3766f1a7fc4bb8a7",
        "file": [
            {
                "patch": "@@ -205,6 +205,10 @@ protected void preDestroy(Object instance, final Class<?> clazz)\n         // At the end the postconstruct annotated\n         // method is invoked\n         List<AnnotationCacheEntry> annotations = annotationCache.get(clazz);\n+        if (annotations == null) {\n+            // instance not created through the instance manager\n+            return;\n+        }\n         for (AnnotationCacheEntry entry : annotations) {\n             if (entry.getType() == AnnotationCacheEntryType.PRE_DESTROY) {\n                 Method preDestroy = (Method) entry.getAccessibleObject();",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/9b843201d4ecab087c1d403f3766f1a7fc4bb8a7/java/org/apache/catalina/core/DefaultInstanceManager.java",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "b354fc26b1a981db821f3b2093c9d68f0f29bc78",
                "blob_url": "https://github.com/apache/tomcat80/blob/9b843201d4ecab087c1d403f3766f1a7fc4bb8a7/java/org/apache/catalina/core/DefaultInstanceManager.java",
                "filename": "java/org/apache/catalina/core/DefaultInstanceManager.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/DefaultInstanceManager.java?ref=9b843201d4ecab087c1d403f3766f1a7fc4bb8a7"
            }
        ],
        "bug_id": "tomcat80_195",
        "parent": "https://github.com/apache/tomcat80/commit/ce12d924c83cce186fddabc20d67b8cc746f0203",
        "message": "Fix possible NPE if instances aren't created through the DefaultInstanceManager but are destroyed through it.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1166752 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/65a46388d124139fd5792a3953b136099f61aae0",
        "file": [
            {
                "patch": "@@ -1337,13 +1337,15 @@ protected void doLock(HttpServletRequest req, HttpServletResponse resp)\n             LockInfo toRenew = resourceLocks.get(path);\n             Enumeration<String> tokenList = null;\n \n-            // At least one of the tokens of the locks must have been given\n-            tokenList = toRenew.tokens.elements();\n-            while (tokenList.hasMoreElements()) {\n-                String token = tokenList.nextElement();\n-                if (ifHeader.indexOf(token) != -1) {\n-                    toRenew.expiresAt = lock.expiresAt;\n-                    lock = toRenew;\n+            if (toRenew != null) {\n+                // At least one of the tokens of the locks must have been given\n+                tokenList = toRenew.tokens.elements();\n+                while (tokenList.hasMoreElements()) {\n+                    String token = tokenList.nextElement();\n+                    if (ifHeader.indexOf(token) != -1) {\n+                        toRenew.expiresAt = lock.expiresAt;\n+                        lock = toRenew;\n+                    }\n                 }\n             }\n ",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/65a46388d124139fd5792a3953b136099f61aae0/java/org/apache/catalina/servlets/WebdavServlet.java",
                "status": "modified",
                "changes": 16,
                "deletions": 7,
                "sha": "d08dbd0207b2d76f9ef28e2dec898005cf6d3fbb",
                "blob_url": "https://github.com/apache/tomcat80/blob/65a46388d124139fd5792a3953b136099f61aae0/java/org/apache/catalina/servlets/WebdavServlet.java",
                "filename": "java/org/apache/catalina/servlets/WebdavServlet.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/servlets/WebdavServlet.java?ref=65a46388d124139fd5792a3953b136099f61aae0"
            },
            {
                "patch": "@@ -85,6 +85,9 @@\n         <bug>51344</bug>: Fix problem with Lifecycle re-factoring for deprecated\n         embedded class that prevented events being triggered. (markt) \n       </fix>\n+      <fix>\n+        Prevent possible NPE when processing WebDAV locks. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/65a46388d124139fd5792a3953b136099f61aae0/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "9545dcecf1d6c72dcce4376492ae69b7d70d4da4",
                "blob_url": "https://github.com/apache/tomcat80/blob/65a46388d124139fd5792a3953b136099f61aae0/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=65a46388d124139fd5792a3953b136099f61aae0"
            }
        ],
        "bug_id": "tomcat80_196",
        "parent": "https://github.com/apache/tomcat80/commit/b49117759b180a1b2c04138e4f636530b4f6ea4f",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51348\nPrevent possible NPE when processing WebDAV locks.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1134048 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/e3a494d5ca38e69fc9a3fa56db785966deb92394",
        "file": [
            {
                "patch": "@@ -686,9 +686,11 @@ public void register(Request request, HttpServletResponse response,\n                             Principal principal, String authType,\n                             String username, String password) {\n \n-        if (log.isDebugEnabled())\n-            log.debug(\"Authenticated '\" + principal.getName() + \"' with type '\"\n-                + authType + \"'\");\n+        if (log.isDebugEnabled()) {\n+            String name = (principal == null) ? \"none\" : principal.getName(); \n+            log.debug(\"Authenticated '\" + name + \"' with type '\" + authType +\n+                    \"'\");\n+        }\n \n         // Cache the authentication information in our request\n         request.setAuthType(authType);",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/e3a494d5ca38e69fc9a3fa56db785966deb92394/java/org/apache/catalina/authenticator/AuthenticatorBase.java",
                "status": "modified",
                "changes": 8,
                "deletions": 3,
                "sha": "e40587f5ddc6aa62911a1599c14ab3bfcd92436e",
                "blob_url": "https://github.com/apache/tomcat80/blob/e3a494d5ca38e69fc9a3fa56db785966deb92394/java/org/apache/catalina/authenticator/AuthenticatorBase.java",
                "filename": "java/org/apache/catalina/authenticator/AuthenticatorBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/authenticator/AuthenticatorBase.java?ref=e3a494d5ca38e69fc9a3fa56db785966deb92394"
            },
            {
                "patch": "@@ -43,6 +43,14 @@\n   Other\n -->\n <section name=\"Tomcat 7.0.11 (markt)\">\n+  <subsection name=\"Catalina\">\n+    <changelog>\n+      <fix>\n+        <bug>50855</bug>: Fix NPE on HttpServletRequest.logout() when debug\n+        logging is enabled. (markt)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection name=\"Jasper\">\n     <changelog>\n       <fix>",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/e3a494d5ca38e69fc9a3fa56db785966deb92394/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 8,
                "deletions": 0,
                "sha": "c7e43d37cf4eac2fc7dc913517426451d5481761",
                "blob_url": "https://github.com/apache/tomcat80/blob/e3a494d5ca38e69fc9a3fa56db785966deb92394/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=e3a494d5ca38e69fc9a3fa56db785966deb92394"
            }
        ],
        "bug_id": "tomcat80_197",
        "parent": "https://github.com/apache/tomcat80/commit/a6021911c64ae7de8ee91eb189f0c11535f080e7",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50855\nFix NPE on HttpServletRequest.logout() when debug logging is enabled.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1078412 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/8f6f6bae9cf22967a06f9603fdf34a45050f02e0",
        "file": [
            {
                "patch": "@@ -959,8 +959,6 @@ public void removeChild(Container child) {\n         \n         fireContainerEvent(REMOVE_CHILD_EVENT, child);\n         \n-        // Set child's parent to null to prevent a loop\n-        child.setParent(null);\n         try {\n             // child.destroy() may have already been called which would have\n             // triggered this call. If that is the case, no need to destroy the",
                "additions": 0,
                "raw_url": "https://github.com/apache/tomcat80/raw/8f6f6bae9cf22967a06f9603fdf34a45050f02e0/java/org/apache/catalina/core/ContainerBase.java",
                "status": "modified",
                "changes": 2,
                "deletions": 2,
                "sha": "a2e6200fc8b37c315b4f631584695ca493364dbc",
                "blob_url": "https://github.com/apache/tomcat80/blob/8f6f6bae9cf22967a06f9603fdf34a45050f02e0/java/org/apache/catalina/core/ContainerBase.java",
                "filename": "java/org/apache/catalina/core/ContainerBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/ContainerBase.java?ref=8f6f6bae9cf22967a06f9603fdf34a45050f02e0"
            }
        ],
        "bug_id": "tomcat80_198",
        "parent": "https://github.com/apache/tomcat80/commit/551ca8254af383d26b884d99ea5a29050c955103",
        "message": "Fix NPEs on shutdown. Loop is prevented above when the child is removed.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1071601 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/06d60d103a181440541340faadd14e07e5a1eef4",
        "file": [
            {
                "patch": "@@ -263,7 +263,7 @@ protected void openRedirector() {\n      */\n     protected void closeRedirector() {\n         try {\n-            if (redirectOutput) {\n+            if (redirectOutput && redirectOutPrintStream != null) {\n                 redirector.complete();\n             }\n         } catch (IOException ioe) {",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/06d60d103a181440541340faadd14e07e5a1eef4/java/org/apache/catalina/ant/BaseRedirectorHelperTask.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "26685b317be7c75b7f83d8ba6f5b4f408b20e6e3",
                "blob_url": "https://github.com/apache/tomcat80/blob/06d60d103a181440541340faadd14e07e5a1eef4/java/org/apache/catalina/ant/BaseRedirectorHelperTask.java",
                "filename": "java/org/apache/catalina/ant/BaseRedirectorHelperTask.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/ant/BaseRedirectorHelperTask.java?ref=06d60d103a181440541340faadd14e07e5a1eef4"
            },
            {
                "patch": "@@ -305,6 +305,10 @@\n         <bug>14416</bug>: Make <code>TagLibraryInfo.getTag()</code> more robust\n         at handling <code>null</code>s. (markt)\n       </fix>\n+      <fix>\n+        <bug>50552</bug>: Avoid NPE that hides error message when using Ant\n+        tasks. (schultz)\n+      </fix>\n     </changelog>\n   </subsection>\n </section>",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/06d60d103a181440541340faadd14e07e5a1eef4/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "2a89d92d65e4edcf7ca614c201547d1b0ca035d5",
                "blob_url": "https://github.com/apache/tomcat80/blob/06d60d103a181440541340faadd14e07e5a1eef4/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=06d60d103a181440541340faadd14e07e5a1eef4"
            }
        ],
        "bug_id": "tomcat80_199",
        "parent": "https://github.com/apache/tomcat80/commit/77850156171bafc18461184f3da59063a3154bda",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50552\nAvoid NPE that hides error when using Ant tasks (schultz)\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1056264 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/d17998f294726d2d530a714c401819f5967bef77",
        "file": [
            {
                "patch": "@@ -1141,9 +1141,15 @@ public void run() {\n                     while (iterator != null && iterator.hasNext()) {\n                         SelectionKey sk = iterator.next();\n                         KeyAttachment attachment = (KeyAttachment)sk.attachment();\n-                        attachment.access();\n-                        iterator.remove();\n-                        processKey(sk, attachment);\n+                        // Attachment may be null if another thread has called\n+                        // cancelledKey()\n+                        if (attachment == null) {\n+                            iterator.remove();\n+                        } else {\n+                            attachment.access();\n+                            iterator.remove();\n+                            processKey(sk, attachment);\n+                        }\n                     }//while\n \n                     //process timeouts",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/d17998f294726d2d530a714c401819f5967bef77/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "status": "modified",
                "changes": 12,
                "deletions": 3,
                "sha": "e37712164eee14a669b1543e58708db0a1464186",
                "blob_url": "https://github.com/apache/tomcat80/blob/d17998f294726d2d530a714c401819f5967bef77/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/NioEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/NioEndpoint.java?ref=d17998f294726d2d530a714c401819f5967bef77"
            },
            {
                "patch": "@@ -195,6 +195,11 @@\n         Remove a huge memory leak in the NIO connector introduced by the fix\n         for <bug>49884</bug>. (markt)\n       </fix>\n+      <fix>\n+        <bug>50467</bug>: Protected against NPE triggered by a race condition\n+        that causes the NIO poller to fail, preventing the processing of further\n+        requests. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Jasper\">",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/d17998f294726d2d530a714c401819f5967bef77/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "f655372f3a1fcd27408520089a828e7162538541",
                "blob_url": "https://github.com/apache/tomcat80/blob/d17998f294726d2d530a714c401819f5967bef77/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=d17998f294726d2d530a714c401819f5967bef77"
            }
        ],
        "bug_id": "tomcat80_200",
        "parent": "https://github.com/apache/tomcat80/commit/5b433d36eaf2b14c4ad4281b0b9d85cb4c9c89f0",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50467\nProtect against NPE that will cause Poller to fail\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1055458 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/4b34ab1a33066b8cffafdf33d908619f6d1d30bf",
        "file": [
            {
                "patch": "@@ -137,12 +137,12 @@ public String getRequiredVersion() {\n     public TagInfo getTag(String shortname) {\n         TagInfo tags[] = getTags();\n \n-        if (tags == null || tags.length == 0) {\n+        if (tags == null || tags.length == 0 || shortname == null) {\n             return null;\n         }\n \n         for (int i = 0; i < tags.length; i++) {\n-            if (tags[i].getTagName().equals(shortname)) {\n+            if (shortname.equals(tags[i].getTagName())) {\n                 return tags[i];\n             }\n         }",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/4b34ab1a33066b8cffafdf33d908619f6d1d30bf/java/javax/servlet/jsp/tagext/TagLibraryInfo.java",
                "status": "modified",
                "changes": 4,
                "deletions": 2,
                "sha": "ac9720d1d19f197dbfb896ae276ec1ab4d4b023d",
                "blob_url": "https://github.com/apache/tomcat80/blob/4b34ab1a33066b8cffafdf33d908619f6d1d30bf/java/javax/servlet/jsp/tagext/TagLibraryInfo.java",
                "filename": "java/javax/servlet/jsp/tagext/TagLibraryInfo.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/javax/servlet/jsp/tagext/TagLibraryInfo.java?ref=4b34ab1a33066b8cffafdf33d908619f6d1d30bf"
            },
            {
                "patch": "@@ -230,6 +230,10 @@\n         removed when the service stops which prevents the service from starting.\n         (markt)\n       </fix>\n+      <fix>\n+        <bug>14416</bug>: Make <code>TagLibraryInfo.getTag()</code> more robust\n+        at handling <code>null</code>s. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n </section>",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/4b34ab1a33066b8cffafdf33d908619f6d1d30bf/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "b19926acd80f24d23f73b37945963a452b54c73a",
                "blob_url": "https://github.com/apache/tomcat80/blob/4b34ab1a33066b8cffafdf33d908619f6d1d30bf/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=4b34ab1a33066b8cffafdf33d908619f6d1d30bf"
            }
        ],
        "bug_id": "tomcat80_201",
        "parent": "https://github.com/apache/tomcat80/commit/d5e665be45d13bc3ac4b040bc30be6d5cd3dddc3",
        "message": "Avoid a possible NPE that in turn was masking the root cause from JspC\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1050384 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/fe7f629121f796e1665fdf47bbb75d25515974ab",
        "file": [
            {
                "patch": "@@ -290,31 +290,35 @@\n         Improve Tomcat Logging documentation. (kkolinko)\n       </update>\n       <fix>\n-        <bug>50303</bug>: Update JNDI how-to to reflect new JavaMail download\n-        location and that JAF is now included in Java SE 6. (markt) \n+        <bug>50303</bug>: Update JNDI how-to to reflect the new JavaMail\n+        download location and that JAF is now included in Java SE 6. (markt) \n       </fix>\n       <fix>\n-        Fix ordering functionality on sessions page for HTML Manager \n+        Fix ordering functionality on sessions page for the HTML Manager \n         application. (markt)\n       </fix>\n       <fix>\n-        Fix primary sessions not always being treated as such in HTML Manager \n-        application. (markt)\n+        Fix primary sessions not always being treated as such in the HTML\n+        Manager application. (markt)\n       </fix>\n       <fix>\n-        Fix message not being displayed after session attribute removal in HTML\n-        Manager application. (markt)\n+        Fix message not being displayed after session attribute removal in the\n+        HTML Manager application. (markt)\n       </fix>\n       <fix>\n-        <bug>50310</bug>: Fix display of Servlet information in Manager\n+        <bug>50310</bug>: Fix display of Servlet information in the Manager\n         application. (markt)\n       </fix>\n       <fix>\n-        CVE-2010-4172: Multiple XSS in Manager application. (markt/kkolinko)\n+        CVE-2010-4172: Multiple XSS in the Manager application. (markt/kkolinko)\n       </fix>\n       <fix>\n-        <bug>50316</bug>: Fix display of negative values in Manager application.\n-        (kkolinko)\n+        <bug>50316</bug>: Fix display of negative values in the Manager \n+        application. (kkolinko)\n+      </fix>\n+      <fix>\n+        <bug>50318</bug>: Avoid NPE when trying to view session detail for an\n+        expired session in the Manager application. (markt)\n       </fix>\n     </changelog>\n   </subsection>",
                "additions": 15,
                "raw_url": "https://github.com/apache/tomcat80/raw/fe7f629121f796e1665fdf47bbb75d25515974ab/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 26,
                "deletions": 11,
                "sha": "6d72bcb33e0bad7e86f40a1d0b68f689315caf62",
                "blob_url": "https://github.com/apache/tomcat80/blob/fe7f629121f796e1665fdf47bbb75d25515974ab/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=fe7f629121f796e1665fdf47bbb75d25515974ab"
            },
            {
                "patch": "@@ -32,8 +32,14 @@\n    String version = (String) request.getAttribute(\"version\");\n    ContextName cn = new ContextName(path, version);\n    Session currentSession = (Session)request.getAttribute(\"currentSession\");\n-   HttpSession currentHttpSession = currentSession.getSession();\n-   String currentSessionId = JspHelper.escapeXml(currentSession.getId());\n+   String currentSessionId = null;\n+   HttpSession currentHttpSession = null;\n+   if (currentSession != null) {\n+       currentHttpSession = currentSession.getSession();\n+       currentSessionId = JspHelper.escapeXml(currentSession.getId());\n+   } else {\n+       currentSessionId = \"Session invalidated\";\n+   }\n    String submitUrl = JspHelper.escapeXml(response.encodeURL(\n            ((HttpServletRequest) pageContext.getRequest()).getRequestURI() +\n            \"?path=\" + path + \"&version=\" + version));\n@@ -50,118 +56,122 @@\n     <title>Sessions Administration: details for <%= currentSessionId %></title>\n </head>\n <body>\n-<h1>Details for Session <%= currentSessionId %></h1>\n-\n-<table style=\"text-align: left;\" border=\"0\">\n-  <tr>\n-    <th>Session Id</th>\n-    <td><%= currentSessionId %></td>\n-  </tr>\n-  <tr>\n-    <th>Guessed Locale</th>\n-    <td><%= JspHelper.guessDisplayLocaleFromSession(currentSession) %></td>\n-  </tr>\n-  <tr>\n-    <th>Guessed User</th>\n-    <td><%= JspHelper.guessDisplayUserFromSession(currentSession) %></td>\n-  </tr>\n-  <tr>\n-    <th>Creation Time</th>\n-    <td><%= JspHelper.getDisplayCreationTimeForSession(currentSession) %></td>\n-  </tr>\n-  <tr>\n-    <th>Last Accessed Time</th>\n-    <td><%= JspHelper.getDisplayLastAccessedTimeForSession(currentSession) %></td>\n-  </tr>\n-  <tr>\n-    <th>Session Max Inactive Interval</th>\n-    <td><%= JspHelper.secondsToTimeString(currentSession.getMaxInactiveInterval()) %></td>\n-  </tr>\n-  <tr>\n-    <th>Used Time</th>\n-    <td><%= JspHelper.getDisplayUsedTimeForSession(currentSession) %></td>\n-  </tr>\n-  <tr>\n-    <th>Inactive Time</th>\n-    <td><%= JspHelper.getDisplayInactiveTimeForSession(currentSession) %></td>\n-  </tr>\n-  <tr>\n-    <th>TTL</th>\n-    <td><%= JspHelper.getDisplayTTLForSession(currentSession) %></td>\n-  </tr>\n-</table>\n-\n-<form method=\"post\" action=\"<%= submitUrl %>\">\n-  <div>\n-    <input type=\"hidden\" name=\"sessionId\" value=\"<%= currentSessionId %>\" />\n-    <input type=\"hidden\" name=\"action\" value=\"sessionDetail\" />\n-    <%\n-    if (\"Primary\".equals(request.getParameter(\"sessionType\"))) {\n-    %>\n-      <input type=\"hidden\" name=\"sessionType\" value=\"Primary\" />\n-    <%\n-    }\n-    %>    <input type=\"submit\" value=\"Refresh\" />\n-  </div>\n-</form>\n+<% if (currentHttpSession == null) { %>\n+   <h1><%=currentSessionId%></h1>\n+<% } else { %>\n+   <h1>Details for Session <%= currentSessionId %></h1>\n \n-<div class=\"error\"><%= JspHelper.escapeXml(request.getAttribute(\"error\")) %></div>\n-<div class=\"message\"><%= JspHelper.escapeXml(request.getAttribute(\"message\")) %></div>\n-\n-<table style=\"text-align: left;\" border=\"1\" cellpadding=\"2\" cellspacing=\"2\">\n-<% int nAttributes = 0;\n-   Enumeration attributeNamesEnumeration = currentHttpSession.getAttributeNames();\n-   while (attributeNamesEnumeration.hasMoreElements()) {\n-       attributeNamesEnumeration.nextElement();\n-       ++nAttributes;\n-   }\n-%>\n-    <caption style=\"font-variant: small-caps;\"><%= JspHelper.formatNumber(nAttributes) %> attributes</caption>\n-    <thead>\n-        <tr>\n-            <th>Remove Attribute</th>\n-            <th>Attribute name</th>\n-            <th>Attribute value</th>\n-        </tr>\n-    </thead>\n-    <%--tfoot>\n-        <tr>\n-            <td colspan=\"3\" style=\"text-align: center;\">\n-                TODO: set Max Inactive Interval on sessions\n-            </td>\n-        </tr>\n-    </tfoot--%>\n-    <tbody>\n-<% attributeNamesEnumeration = currentHttpSession.getAttributeNames();\n-   while (attributeNamesEnumeration.hasMoreElements()) {\n-       String attributeName = (String) attributeNamesEnumeration.nextElement();\n-%>\n-        <tr>\n-            <td align=\"center\">\n-                <form method=\"post\" action=\"<%= submitUrl %>\">\n-                    <div>\n-                        <input type=\"hidden\" name=\"action\" value=\"removeSessionAttribute\" />\n-                        <input type=\"hidden\" name=\"sessionId\" value=\"<%= currentSessionId %>\" />\n-                        <input type=\"hidden\" name=\"attributeName\" value=\"<%= JspHelper.escapeXml(attributeName) %>\" />\n-                        <%\n-                          if (\"Primary\".equals(request.getParameter(\"sessionType\"))) {\n-                        %>\n-                          <input type=\"submit\" value=\"Remove\" />\n-                          <input type=\"hidden\" name=\"sessionType\" value=\"Primary\" />\n-                        <%\n-                          } else {\n-                            out.print(\"Primary sessions only\");\n-                          }\n-                        %>\n-                    </div>\n-                </form>\n-            </td>\n-            <td><%= JspHelper.escapeXml(attributeName) %></td>\n-            <td><% Object attributeValue = currentHttpSession.getAttribute(attributeName); %><span title=\"<%= attributeValue == null ? \"\" : attributeValue.getClass().toString() %>\"><%= JspHelper.escapeXml(attributeValue) %></span></td>\n-        </tr>\n-<% } // end while %>\n-    </tbody>\n-</table>\n+   <table style=\"text-align: left;\" border=\"0\">\n+     <tr>\n+       <th>Session Id</th>\n+       <td><%= currentSessionId %></td>\n+     </tr>\n+     <tr>\n+       <th>Guessed Locale</th>\n+       <td><%= JspHelper.guessDisplayLocaleFromSession(currentSession) %></td>\n+     </tr>\n+     <tr>\n+       <th>Guessed User</th>\n+       <td><%= JspHelper.guessDisplayUserFromSession(currentSession) %></td>\n+     </tr>\n+     <tr>\n+       <th>Creation Time</th>\n+       <td><%= JspHelper.getDisplayCreationTimeForSession(currentSession) %></td>\n+     </tr>\n+     <tr>\n+       <th>Last Accessed Time</th>\n+       <td><%= JspHelper.getDisplayLastAccessedTimeForSession(currentSession) %></td>\n+     </tr>\n+     <tr>\n+       <th>Session Max Inactive Interval</th>\n+       <td><%= JspHelper.secondsToTimeString(currentSession.getMaxInactiveInterval()) %></td>\n+     </tr>\n+     <tr>\n+       <th>Used Time</th>\n+       <td><%= JspHelper.getDisplayUsedTimeForSession(currentSession) %></td>\n+     </tr>\n+     <tr>\n+       <th>Inactive Time</th>\n+       <td><%= JspHelper.getDisplayInactiveTimeForSession(currentSession) %></td>\n+     </tr>\n+     <tr>\n+       <th>TTL</th>\n+       <td><%= JspHelper.getDisplayTTLForSession(currentSession) %></td>\n+     </tr>\n+   </table>\n+   \n+   <form method=\"post\" action=\"<%= submitUrl %>\">\n+     <div>\n+       <input type=\"hidden\" name=\"sessionId\" value=\"<%= currentSessionId %>\" />\n+       <input type=\"hidden\" name=\"action\" value=\"sessionDetail\" />\n+       <%\n+       if (\"Primary\".equals(request.getParameter(\"sessionType\"))) {\n+       %>\n+         <input type=\"hidden\" name=\"sessionType\" value=\"Primary\" />\n+       <%\n+       }\n+       %>    <input type=\"submit\" value=\"Refresh\" />\n+     </div>\n+   </form>\n+    \n+   <div class=\"error\"><%= JspHelper.escapeXml(request.getAttribute(\"error\")) %></div>\n+   <div class=\"message\"><%= JspHelper.escapeXml(request.getAttribute(\"message\")) %></div>\n+   \n+   <table style=\"text-align: left;\" border=\"1\" cellpadding=\"2\" cellspacing=\"2\">\n+   <% int nAttributes = 0;\n+      Enumeration attributeNamesEnumeration = currentHttpSession.getAttributeNames();\n+      while (attributeNamesEnumeration.hasMoreElements()) {\n+          attributeNamesEnumeration.nextElement();\n+          ++nAttributes;\n+      }\n+   %>\n+       <caption style=\"font-variant: small-caps;\"><%= JspHelper.formatNumber(nAttributes) %> attributes</caption>\n+       <thead>\n+           <tr>\n+               <th>Remove Attribute</th>\n+               <th>Attribute name</th>\n+               <th>Attribute value</th>\n+           </tr>\n+       </thead>\n+       <%--tfoot>\n+           <tr>\n+               <td colspan=\"3\" style=\"text-align: center;\">\n+                   TODO: set Max Inactive Interval on sessions\n+               </td>\n+           </tr>\n+       </tfoot--%>\n+       <tbody>\n+   <% attributeNamesEnumeration = currentHttpSession.getAttributeNames();\n+      while (attributeNamesEnumeration.hasMoreElements()) {\n+          String attributeName = (String) attributeNamesEnumeration.nextElement();\n+   %>\n+           <tr>\n+               <td align=\"center\">\n+                   <form method=\"post\" action=\"<%= submitUrl %>\">\n+                       <div>\n+                           <input type=\"hidden\" name=\"action\" value=\"removeSessionAttribute\" />\n+                           <input type=\"hidden\" name=\"sessionId\" value=\"<%= currentSessionId %>\" />\n+                           <input type=\"hidden\" name=\"attributeName\" value=\"<%= JspHelper.escapeXml(attributeName) %>\" />\n+                           <%\n+                             if (\"Primary\".equals(request.getParameter(\"sessionType\"))) {\n+                           %>\n+                             <input type=\"submit\" value=\"Remove\" />\n+                             <input type=\"hidden\" name=\"sessionType\" value=\"Primary\" />\n+                           <%\n+                             } else {\n+                               out.print(\"Primary sessions only\");\n+                             }\n+                           %>\n+                       </div>\n+                   </form>\n+               </td>\n+               <td><%= JspHelper.escapeXml(attributeName) %></td>\n+               <td><% Object attributeValue = currentHttpSession.getAttribute(attributeName); %><span title=\"<%= attributeValue == null ? \"\" : attributeValue.getClass().toString() %>\"><%= JspHelper.escapeXml(attributeValue) %></span></td>\n+           </tr>\n+   <% } // end while %>\n+       </tbody>\n+   </table>\n+<% } // endif%>\n \n <form method=\"post\" action=\"<%=submitUrl%>\">\n   <p style=\"text-align: center;\">",
                "additions": 123,
                "raw_url": "https://github.com/apache/tomcat80/raw/fe7f629121f796e1665fdf47bbb75d25515974ab/webapps/manager/WEB-INF/jsp/sessionDetail.jsp",
                "status": "modified",
                "changes": 236,
                "deletions": 113,
                "sha": "d711f7f6c0ec33dc60dc3aff21af1730034181f9",
                "blob_url": "https://github.com/apache/tomcat80/blob/fe7f629121f796e1665fdf47bbb75d25515974ab/webapps/manager/WEB-INF/jsp/sessionDetail.jsp",
                "filename": "webapps/manager/WEB-INF/jsp/sessionDetail.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/manager/WEB-INF/jsp/sessionDetail.jsp?ref=fe7f629121f796e1665fdf47bbb75d25515974ab"
            }
        ],
        "bug_id": "tomcat80_202",
        "parent": "https://github.com/apache/tomcat80/commit/4b1b6ee263f8e584d825cc9c98daf851af97b9b9",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50318\nAvoid NPE when viewing session detail for expired sessions\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1038235 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/b9ea75942a6e65ab67ded5005175ab56d4f8d758",
        "file": [
            {
                "patch": "@@ -1868,18 +1868,24 @@ public void visit(Node.JspElement n) throws JasperException {\n                 if (attrs[i].isNamedAttribute()) {\n                     NamedAttribute attr = attrs[i].getNamedAttributeNode();\n                     Node.JspAttribute omitAttr = attr.getOmit();\n-                    String omit = attributeValue(omitAttr, false, boolean.class);\n-                    if (\"true\".equals(omit)) {\n-                        continue;\n+                    String omit;\n+                    if (omitAttr == null) {\n+                        omit = \"false\";\n+                    } else {\n+                        omit = attributeValue(omitAttr, false, boolean.class);\n+                        if (\"true\".equals(omit)) {\n+                            continue;\n+                        }\n                     }\n                     value = generateNamedAttributeValue(\n                             attrs[i].getNamedAttributeNode());\n                     if (\"false\".equals(omit)) {\n                         nvp = \" + \\\" \" + attrs[i].getName() + \"=\\\\\\\"\\\" + \" +\n                                 value + \" + \\\"\\\\\\\"\\\"\";\n                     } else {\n-                        nvp = \" + (Boolean.valueOf(\" + omit + \")?\\\"\\\":\\\" \" + attrs[i].getName() +\n-                                \"=\\\\\\\"\\\" + \" + value + \" + \\\"\\\\\\\"\\\")\";\n+                        nvp = \" + (Boolean.valueOf(\" + omit + \")?\\\"\\\":\\\" \" +\n+                                attrs[i].getName() + \"=\\\\\\\"\\\" + \" + value +\n+                                \" + \\\"\\\\\\\"\\\")\";\n                     }\n                 } else {\n                     value = attributeValue(attrs[i], false, Object.class);",
                "additions": 11,
                "raw_url": "https://github.com/apache/tomcat80/raw/b9ea75942a6e65ab67ded5005175ab56d4f8d758/java/org/apache/jasper/compiler/Generator.java",
                "status": "modified",
                "changes": 16,
                "deletions": 5,
                "sha": "0d4321e10adbe300b26fc378a515bb33f7e092c3",
                "blob_url": "https://github.com/apache/tomcat80/blob/b9ea75942a6e65ab67ded5005175ab56d4f8d758/java/org/apache/jasper/compiler/Generator.java",
                "filename": "java/org/apache/jasper/compiler/Generator.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/Generator.java?ref=b9ea75942a6e65ab67ded5005175ab56d4f8d758"
            }
        ],
        "bug_id": "tomcat80_203",
        "parent": "https://github.com/apache/tomcat80/commit/f6e4352c347b3e0f11d5cf75c47922c0a2987c47",
        "message": "Fix NPE and TCK failures caused by previous fix for bug 49799.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1003891 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/01ee912cf8005f8bd46da4ef12c37b40fc793f4c",
        "file": [
            {
                "patch": "@@ -193,18 +193,20 @@ public void run() {\n                             // Ignore\n                         }\n                     }\n-                }catch ( IOException x ) {\n-                    if ( running ) log.error(sm.getString(\"endpoint.accept.fail\"), x);\n+                } catch (IOException x) {\n+                    if (running) {\n+                        log.error(sm.getString(\"endpoint.accept.fail\"), x);\n+                    }\n+                } catch (NullPointerException npe) {\n+                    if (running) {\n+                        log.error(sm.getString(\"endpoint.accept.fail\"), npe);\n+                    }\n                 } catch (Throwable t) {\n                     log.error(sm.getString(\"endpoint.accept.fail\"), t);\n                 }\n-\n                 // The processor will recycle itself when it finishes\n-\n             }\n-\n         }\n-\n     }\n \n ",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/01ee912cf8005f8bd46da4ef12c37b40fc793f4c/java/org/apache/tomcat/util/net/JIoEndpoint.java",
                "status": "modified",
                "changes": 14,
                "deletions": 6,
                "sha": "8371449f83b46fddcbc85d382a9de0151c814ebf",
                "blob_url": "https://github.com/apache/tomcat80/blob/01ee912cf8005f8bd46da4ef12c37b40fc793f4c/java/org/apache/tomcat/util/net/JIoEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/JIoEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/JIoEndpoint.java?ref=01ee912cf8005f8bd46da4ef12c37b40fc793f4c"
            }
        ],
        "bug_id": "tomcat80_204",
        "parent": "https://github.com/apache/tomcat80/commit/c21859bc7caf437d7cc2117327b529a35d811903",
        "message": "Also handle NPEs (seen during testing of new async re-factoring) and ignore them if the endpoint is shutting down.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@998190 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/0656fc7a775bdde7ca883483d71057c149f317ee",
        "file": [
            {
                "patch": "@@ -513,10 +513,18 @@ public BodyContent pushBody() {\n      * @since 2.0\n      */\n     public ErrorData getErrorData() {\n+        int status = 0;\n+        \n+        Integer status_code = (Integer)getRequest().getAttribute( \n+                \"javax.servlet.error.status_code\");\n+        // Avoid NPE if attribute is not set\n+        if (status_code != null) {\n+            status = status_code.intValue();\n+        }\n+\n         return new ErrorData( \n             (Throwable)getRequest().getAttribute( \"javax.servlet.error.exception\" ),\n-            ((Integer)getRequest().getAttribute( \n-                \"javax.servlet.error.status_code\" )).intValue(),\n+            status,\n             (String)getRequest().getAttribute( \"javax.servlet.error.request_uri\" ),\n             (String)getRequest().getAttribute( \"javax.servlet.error.servlet_name\" ) );\n     }",
                "additions": 10,
                "raw_url": "https://github.com/apache/tomcat80/raw/0656fc7a775bdde7ca883483d71057c149f317ee/java/javax/servlet/jsp/PageContext.java",
                "status": "modified",
                "changes": 12,
                "deletions": 2,
                "sha": "b3507fa7ff596be198368dbb58e92cf67a349125",
                "blob_url": "https://github.com/apache/tomcat80/blob/0656fc7a775bdde7ca883483d71057c149f317ee/java/javax/servlet/jsp/PageContext.java",
                "filename": "java/javax/servlet/jsp/PageContext.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/javax/servlet/jsp/PageContext.java?ref=0656fc7a775bdde7ca883483d71057c149f317ee"
            }
        ],
        "bug_id": "tomcat80_205",
        "parent": "https://github.com/apache/tomcat80/commit/c695e9d02b6e10c7061b69a24690fe3934a2352f",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49196\nAvoid NPE on PageContext.getErrorData()\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@948057 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/22c1430b4fd1d665c8a3011972e7f4c726bf8115",
        "file": [
            {
                "patch": "@@ -218,6 +218,14 @@ public void event(Request request, Response response, CometEvent event)\n     }\n \n \n+    @Override\n+    protected void initInternal() throws LifecycleException {\n+        super.initInternal();\n+        \n+        containerLog = getContainer().getLogger();\n+    }\n+    \n+    \n     /**\n      * Start this component and implement the requirements\n      * of {@link LifecycleBase#startInternal()}.",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/22c1430b4fd1d665c8a3011972e7f4c726bf8115/java/org/apache/catalina/valves/ValveBase.java",
                "status": "modified",
                "changes": 8,
                "deletions": 0,
                "sha": "64c0b1133225a3d00bb8fdecdb0953f3cfcaf81a",
                "blob_url": "https://github.com/apache/tomcat80/blob/22c1430b4fd1d665c8a3011972e7f4c726bf8115/java/org/apache/catalina/valves/ValveBase.java",
                "filename": "java/org/apache/catalina/valves/ValveBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/valves/ValveBase.java?ref=22c1430b4fd1d665c8a3011972e7f4c726bf8115"
            }
        ],
        "bug_id": "tomcat80_206",
        "parent": "https://github.com/apache/tomcat80/commit/075e18b77f65b4da4cf7bdf80c7ec3255157bad2",
        "message": "Fix TCK failure\nRestore initialisation of logger that was triggering an NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@943664 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/a32096c97e0e0878242480a584781c2a25af7a36",
        "file": [
            {
                "patch": "@@ -2229,14 +2229,16 @@ protected String getDistinguishedName(DirContext context, String base,\n          final private String username;\n          final private String dn;\n          final private String password;\n-         final private List<String> roles;\n+         final private List<String> roles = new ArrayList<String>();\n \n          public User(String username, String dn, String password,\n                  List<String> roles) {\n              this.username = username;\n              this.dn = dn;\n              this.password = password;\n-             this.roles = Collections.unmodifiableList(roles);\n+             if (roles != null) {\n+                 this.roles.addAll(roles);\n+             }\n          }\n     \n          public String getUserName() {",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/a32096c97e0e0878242480a584781c2a25af7a36/java/org/apache/catalina/realm/JNDIRealm.java",
                "status": "modified",
                "changes": 6,
                "deletions": 2,
                "sha": "bf5a21e27431a70ea3d1b96ac5092b379d5cb590",
                "blob_url": "https://github.com/apache/tomcat80/blob/a32096c97e0e0878242480a584781c2a25af7a36/java/org/apache/catalina/realm/JNDIRealm.java",
                "filename": "java/org/apache/catalina/realm/JNDIRealm.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/realm/JNDIRealm.java?ref=a32096c97e0e0878242480a584781c2a25af7a36"
            }
        ],
        "bug_id": "tomcat80_207",
        "parent": "https://github.com/apache/tomcat80/commit/10d99058af830ec08da2b51351bbf28c0c35ae31",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49075\nNPE protection if roles is null and roles needs to be modifiable\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@932357 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/37cfa90132455d49aee5cb741c8b96a037140b22",
        "file": [
            {
                "patch": "@@ -162,7 +162,7 @@ public Servlet getServlet() throws ServletException {\n     }\n \n     public ServletContext getServletContext() {\n-        return config.getServletContext();\n+        return ctxt.getServletContext();\n     }\n \n     /**",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/37cfa90132455d49aee5cb741c8b96a037140b22/java/org/apache/jasper/servlet/JspServletWrapper.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "8f16a574c2b90876af16454490e8a62d587be2dc",
                "blob_url": "https://github.com/apache/tomcat80/blob/37cfa90132455d49aee5cb741c8b96a037140b22/java/org/apache/jasper/servlet/JspServletWrapper.java",
                "filename": "java/org/apache/jasper/servlet/JspServletWrapper.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/servlet/JspServletWrapper.java?ref=37cfa90132455d49aee5cb741c8b96a037140b22"
            }
        ],
        "bug_id": "tomcat80_208",
        "parent": "https://github.com/apache/tomcat80/commit/0fb4d50e450b835c21f8b241a2f0885360e6415c",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48582\nAvoid NPE as config may be null but ctxt won't be\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@910471 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/9fab7b2bfc3f889549ff8a80acc8ee1fc9252e8d",
        "file": [
            {
                "patch": "@@ -77,9 +77,12 @@ private void processWebDotXml() throws JasperException {\n         try {\n             webXml = new WebXml(ctxt);\n             \n-            ParserUtils pu = new ParserUtils();\n-            TreeNode webApp = pu.parseXMLDocument(webXml.getSystemId(),\n-                    webXml.getInputSource());\n+            TreeNode webApp = null;\n+            if (webXml.getInputSource() != null) {\n+                ParserUtils pu = new ParserUtils();\n+                webApp = pu.parseXMLDocument(webXml.getSystemId(),\n+                        webXml.getInputSource());\n+            }\n \n             if (webApp == null\n                     || getVersion(webApp) < 2.4) {",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/9fab7b2bfc3f889549ff8a80acc8ee1fc9252e8d/java/org/apache/jasper/compiler/JspConfig.java",
                "status": "modified",
                "changes": 9,
                "deletions": 3,
                "sha": "944cda60ee7a1e463b943f9c890a05fc622bc40f",
                "blob_url": "https://github.com/apache/tomcat80/blob/9fab7b2bfc3f889549ff8a80acc8ee1fc9252e8d/java/org/apache/jasper/compiler/JspConfig.java",
                "filename": "java/org/apache/jasper/compiler/JspConfig.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/JspConfig.java?ref=9fab7b2bfc3f889549ff8a80acc8ee1fc9252e8d"
            }
        ],
        "bug_id": "tomcat80_209",
        "parent": "https://github.com/apache/tomcat80/commit/91c5dc50546a4c7098070bf0608655c67371abef",
        "message": "Prevent NPE in emebedded case when no web.xml is provided at all\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@896622 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/b81e43db98fee839dbdd5a6e3e608986af0ad5c2",
        "file": [
            {
                "patch": "@@ -476,9 +476,12 @@ protected JasperException handleJspException(Exception ex) {\n                 }\n             }\n \n-            if (jspFrame == null) {\n+            \n+            if (jspFrame == null ||\n+                    this.ctxt.getCompiler().getPageNodes() == null) {\n                 // If we couldn't find a frame in the stack trace corresponding\n-                // to the generated servlet class, we can't really add anything\n+                // to the generated servlet class or we don't have a copy of the\n+                // parsed JSP to hand, we can't really add anything\n                 return new JasperException(ex);\n             }\n             else {",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/b81e43db98fee839dbdd5a6e3e608986af0ad5c2/java/org/apache/jasper/servlet/JspServletWrapper.java",
                "status": "modified",
                "changes": 7,
                "deletions": 2,
                "sha": "b0267ec76a142de64b50975cbe8fec0f3ae52325",
                "blob_url": "https://github.com/apache/tomcat80/blob/b81e43db98fee839dbdd5a6e3e608986af0ad5c2/java/org/apache/jasper/servlet/JspServletWrapper.java",
                "filename": "java/org/apache/jasper/servlet/JspServletWrapper.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/servlet/JspServletWrapper.java?ref=b81e43db98fee839dbdd5a6e3e608986af0ad5c2"
            }
        ],
        "bug_id": "tomcat80_210",
        "parent": "https://github.com/apache/tomcat80/commit/e0e0bc30a468decc10a09e5d9d8ccc481f4093fb",
        "message": "Test for null rather than waiting for the NPE ot be thrown.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@890265 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/d53f32225d1794c6fab5332ea388c12d146d3a9a",
        "file": [
            {
                "patch": "@@ -429,8 +429,10 @@ public ManagedBean findManagedBean(String name) {\n         Iterator<ManagedBean> items = descriptors.values().iterator();\n         while (items.hasNext()) {\n             ManagedBean item = items.next();\n-            if ((group == null) && (item.getGroup() == null)) {\n-                results.add(item.getName());\n+            if ((group == null)) {\n+                if (item.getGroup() == null){\n+                    results.add(item.getName());\n+                }\n             } else if (group.equals(item.getGroup())) {\n                 results.add(item.getName());\n             }\n@@ -678,7 +680,7 @@ public Object convertValue(String type, String value)\n         } else if( source instanceof InputStream ) {\n             type=param;\n             inputsource=source;\n-        } else if( source instanceof Class ) {\n+        } else if( source instanceof Class<?> ) {\n             location=((Class<?>)source).getName();\n             type=param;\n             inputsource=source;",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/d53f32225d1794c6fab5332ea388c12d146d3a9a/java/org/apache/tomcat/util/modeler/Registry.java",
                "status": "modified",
                "changes": 8,
                "deletions": 3,
                "sha": "2ac06d208e01ca750dc46c4ad90624161dde1a97",
                "blob_url": "https://github.com/apache/tomcat80/blob/d53f32225d1794c6fab5332ea388c12d146d3a9a/java/org/apache/tomcat/util/modeler/Registry.java",
                "filename": "java/org/apache/tomcat/util/modeler/Registry.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/modeler/Registry.java?ref=d53f32225d1794c6fab5332ea388c12d146d3a9a"
            }
        ],
        "bug_id": "tomcat80_211",
        "parent": "https://github.com/apache/tomcat80/commit/1e4ede68753e47b101d07233ab47d7256c259af9",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48282\nCorrect possible NPE\nPatch provided by sebb\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@884914 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/e52ceb44fd607cc48d7fae0890aa945fce7394c7",
        "file": [
            {
                "patch": "@@ -26,6 +26,7 @@\n import org.apache.juli.logging.Log;\n import org.apache.juli.logging.LogFactory;\n import org.apache.tomcat.util.IntrospectionUtils;\n+import org.apache.tomcat.util.net.jsse.JSSESocketFactory;\n import org.apache.tomcat.util.res.StringManager;\n import org.apache.tomcat.util.threads.ResizableExecutor;\n import org.apache.tomcat.util.threads.TaskQueue;\n@@ -503,7 +504,7 @@ public void setCiphers(String s) {\n     public String getKeyAlias() { return keyAlias;}\n     public void setKeyAlias(String s ) { keyAlias = s;}\n     \n-    private String keyPass = \"changeit\";\n+    private String keyPass = JSSESocketFactory.DEFAULT_KEY_PASS;\n     public String getKeyPass() { return keyPass;}\n     public void setKeyPass(String s ) { this.keyPass = s;}\n ",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/e52ceb44fd607cc48d7fae0890aa945fce7394c7/java/org/apache/tomcat/util/net/AbstractEndpoint.java",
                "status": "modified",
                "changes": 3,
                "deletions": 1,
                "sha": "7796e71eea846b6e9a1b8ce7c675bdcee6127be3",
                "blob_url": "https://github.com/apache/tomcat80/blob/e52ceb44fd607cc48d7fae0890aa945fce7394c7/java/org/apache/tomcat/util/net/AbstractEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/AbstractEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/AbstractEndpoint.java?ref=e52ceb44fd607cc48d7fae0890aa945fce7394c7"
            },
            {
                "patch": "@@ -53,6 +53,7 @@\n import org.apache.juli.logging.LogFactory;\n import org.apache.tomcat.util.IntrospectionUtils;\n import org.apache.tomcat.util.net.SecureNioChannel.ApplicationBufferHandler;\n+import org.apache.tomcat.util.net.jsse.JSSESocketFactory;\n import org.apache.tomcat.util.net.jsse.NioX509KeyManager;\n \n /**\n@@ -504,7 +505,11 @@ public void init()\n         // Initialize SSL if needed\n         if (isSSLEnabled()) {\n             // Initialize SSL\n-            char[] passphrase = getKeystorePass().toCharArray();\n+            String keystorePass = getKeystorePass();\n+            if (keystorePass == null) {\n+                keystorePass = JSSESocketFactory.DEFAULT_KEY_PASS;\n+            }\n+            char[] passphrase = keystorePass.toCharArray();\n \n             char[] tpassphrase = (getTruststorePass()!=null)?getTruststorePass().toCharArray():passphrase;\n             String ttype = (getTruststoreType()!=null)?getTruststoreType():getKeystoreType();",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/e52ceb44fd607cc48d7fae0890aa945fce7394c7/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "status": "modified",
                "changes": 7,
                "deletions": 1,
                "sha": "808808f9b16ac5aa1a4b9e5a579fed60e4f181ef",
                "blob_url": "https://github.com/apache/tomcat80/blob/e52ceb44fd607cc48d7fae0890aa945fce7394c7/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/NioEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/NioEndpoint.java?ref=e52ceb44fd607cc48d7fae0890aa945fce7394c7"
            },
            {
                "patch": "@@ -84,15 +84,15 @@\n     private static final StringManager sm =\n         StringManager.getManager(\"org.apache.tomcat.util.net.jsse.res\");\n \n-    // defaults\n+    // Defaults - made public where re-used\n     static String defaultProtocol = \"TLS\";\n     static boolean defaultClientAuth = false;\n     static String defaultKeystoreType = \"JKS\";\n     private static final String defaultKeystoreFile\n         = System.getProperty(\"user.home\") + \"/.keystore\";\n-    private static final String defaultKeyPass = \"changeit\";\n     private static final int defaultSessionCacheSize = 0;\n     private static final int defaultSessionTimeout = 86400;\n+    public static final String DEFAULT_KEY_PASS = \"changeit\";\n     \n     static final org.apache.juli.logging.Log log =\n         org.apache.juli.logging.LogFactory.getLog(JSSESocketFactory.class);\n@@ -259,7 +259,7 @@ protected String getKeystorePassword() {\n         String keyPass = (String)attributes.get(\n                 AbstractEndpoint.SSL_ATTR_KEY_PASS);\n         if (keyPass == null) {\n-            keyPass = defaultKeyPass;\n+            keyPass = DEFAULT_KEY_PASS;\n         }\n         String keystorePass = (String)attributes.get(\n                 AbstractEndpoint.SSL_ATTR_KEYSTORE_PASS);",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/e52ceb44fd607cc48d7fae0890aa945fce7394c7/java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java",
                "status": "modified",
                "changes": 6,
                "deletions": 3,
                "sha": "a6d54e8dd740a51e24a242a21b74fbb0ac3fbcd8",
                "blob_url": "https://github.com/apache/tomcat80/blob/e52ceb44fd607cc48d7fae0890aa945fce7394c7/java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java",
                "filename": "java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java?ref=e52ceb44fd607cc48d7fae0890aa945fce7394c7"
            }
        ],
        "bug_id": "tomcat80_212",
        "parent": "https://github.com/apache/tomcat80/commit/4088aa5859b309237c466c27ee389df462e2e783",
        "message": "Fix failing SSL test\nPrevent NPE in NIO connector when using SSL and the default keystore password\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@883196 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/f7325015a0805d9e9f370e86502883533d83f5f0",
        "file": [
            {
                "patch": "@@ -1472,7 +1472,7 @@ public void scan(JarURLConnection urlConn) throws IOException {\n             \n             JarFile jarFile = null;\n             InputStream stream = null;\n-            WebXml fragment = null;\n+            WebXml fragment = new WebXml();\n \n             try {\n                 urlConn.setUseCaches(false);\n@@ -1485,7 +1485,6 @@ public void scan(JarURLConnection urlConn) throws IOException {\n                             urlConn.getJarFileURL().toString() +\n                             File.separatorChar + FRAGMENT_LOCATION);\n                     source.setByteStream(stream);\n-                    fragment = new WebXml();\n                     parseWebXml(source, fragment, true);\n                 }\n             } finally {\n@@ -1503,15 +1502,11 @@ public void scan(JarURLConnection urlConn) throws IOException {\n                         // ignore\n                     }\n                 }\n-                if (fragment == null) {\n-                    fragments.put(urlConn.getURL().toString(), fragment);\n-                } else {\n-                    fragment.setURL(urlConn.getURL());\n-                    if (fragment.getName() == null) {\n-                        fragment.setName(fragment.getURL().toString());\n-                    }\n-                    fragments.put(fragment.getName(), fragment);\n+                fragment.setURL(urlConn.getURL());\n+                if (fragment.getName() == null) {\n+                    fragment.setName(fragment.getURL().toString());\n                 }\n+                fragments.put(fragment.getName(), fragment);\n             }\n         }\n ",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/f7325015a0805d9e9f370e86502883533d83f5f0/java/org/apache/catalina/startup/ContextConfig.java",
                "status": "modified",
                "changes": 15,
                "deletions": 10,
                "sha": "2a1378c6d9164abbd4323e99415eed3596a893fa",
                "blob_url": "https://github.com/apache/tomcat80/blob/f7325015a0805d9e9f370e86502883533d83f5f0/java/org/apache/catalina/startup/ContextConfig.java",
                "filename": "java/org/apache/catalina/startup/ContextConfig.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/startup/ContextConfig.java?ref=f7325015a0805d9e9f370e86502883533d83f5f0"
            }
        ],
        "bug_id": "tomcat80_213",
        "parent": "https://github.com/apache/tomcat80/commit/dfdd51ada5ed8367a19feb514a9ab41b2623328f",
        "message": "Fix NPEs on startup with relative ordering and provide somewhere to store results of annotation scanning when that is implemented\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@835567 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/cb6acc81cfc75ce60698ccc710fe78f909d8c8ed",
        "file": [
            {
                "patch": "@@ -471,6 +471,11 @@ public void backgroundProcess() {\n \n         // Check each defined security constraint\n         String uri = request.getRequestPathMB().toString();\n+        // Bug47080 - in rare cases this may be null\n+        // Mapper treats as '/' do the same to prevent NPE\n+        if (uri == null) {\n+            uri = \"/\";\n+        }\n         \n         String method = request.getMethod();\n         int i;",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/cb6acc81cfc75ce60698ccc710fe78f909d8c8ed/java/org/apache/catalina/realm/RealmBase.java",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "c5de0b11b7c9f229c71023b64cb8b31796c382fe",
                "blob_url": "https://github.com/apache/tomcat80/blob/cb6acc81cfc75ce60698ccc710fe78f909d8c8ed/java/org/apache/catalina/realm/RealmBase.java",
                "filename": "java/org/apache/catalina/realm/RealmBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/realm/RealmBase.java?ref=cb6acc81cfc75ce60698ccc710fe78f909d8c8ed"
            }
        ],
        "bug_id": "tomcat80_214",
        "parent": "https://github.com/apache/tomcat80/commit/6f2a0621257bbc2cc1d5773a3f4e22e2b1385409",
        "message": "Fix 47080: NPE in RealmBase.findSecurityConstraints when uri is null \nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=47080\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@770809 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/d6e8a14bce4b95c55007c3b97ee4a707e1e32a1b",
        "file": [
            {
                "patch": "@@ -1794,7 +1794,11 @@ protected boolean openJARs() {\n             return clazz;\n \n         synchronized (this) {\n-            if (entry.binaryContent == null && entry.loadedClass == null)\n+            clazz = entry.loadedClass;\n+            if (clazz != null)\n+                return clazz;\n+\n+            if (entry.binaryContent == null)\n                 throw new ClassNotFoundException(name);\n \n             // Looking up the package\n@@ -1843,26 +1847,22 @@ protected boolean openJARs() {\n     \n             }\n \n-            if (entry.loadedClass == null) {\n-                try {\n-                    clazz = defineClass(name, entry.binaryContent, 0,\n-                            entry.binaryContent.length, \n-                            new CodeSource(entry.codeBase, entry.certificates));\n-                } catch (UnsupportedClassVersionError ucve) {\n-                    throw new UnsupportedClassVersionError(\n-                            ucve.getLocalizedMessage() + \" \" +\n-                            sm.getString(\"webappClassLoader.wrongVersion\",\n-                                    name));\n-                }\n-                entry.loadedClass = clazz;\n-                entry.binaryContent = null;\n-                entry.source = null;\n-                entry.codeBase = null;\n-                entry.manifest = null;\n-                entry.certificates = null;\n-            } else {\n-                clazz = entry.loadedClass;\n+            try {\n+                clazz = defineClass(name, entry.binaryContent, 0,\n+                        entry.binaryContent.length, \n+                        new CodeSource(entry.codeBase, entry.certificates));\n+            } catch (UnsupportedClassVersionError ucve) {\n+                throw new UnsupportedClassVersionError(\n+                        ucve.getLocalizedMessage() + \" \" +\n+                        sm.getString(\"webappClassLoader.wrongVersion\",\n+                                name));\n             }\n+            entry.loadedClass = clazz;\n+            entry.binaryContent = null;\n+            entry.source = null;\n+            entry.codeBase = null;\n+            entry.manifest = null;\n+            entry.certificates = null;\n         }\n         \n         return clazz;",
                "additions": 20,
                "raw_url": "https://github.com/apache/tomcat80/raw/d6e8a14bce4b95c55007c3b97ee4a707e1e32a1b/java/org/apache/catalina/loader/WebappClassLoader.java",
                "status": "modified",
                "changes": 40,
                "deletions": 20,
                "sha": "6988bc105ced75b454516bbd3d2d184e2c5f990b",
                "blob_url": "https://github.com/apache/tomcat80/blob/d6e8a14bce4b95c55007c3b97ee4a707e1e32a1b/java/org/apache/catalina/loader/WebappClassLoader.java",
                "filename": "java/org/apache/catalina/loader/WebappClassLoader.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/loader/WebappClassLoader.java?ref=d6e8a14bce4b95c55007c3b97ee4a707e1e32a1b"
            }
        ],
        "bug_id": "tomcat80_215",
        "parent": "https://github.com/apache/tomcat80/commit/812c11719f5a0543171a5ff418a87c80371b6b4d",
        "message": "Fix https://issues.apache.org/bugzilla/attachment.cgi?id=23066\nSync issue leads to NPE in rare circumstances\nPatch provided by Konstantin Kolinko\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@730735 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/2d14b55fa2105d286c67298e1ec94c53b1f52938",
        "file": [
            {
                "patch": "@@ -47,7 +47,7 @@\n     /**\n      * Loaded class.\n      */\n-    public Class loadedClass = null;\n+    public Class<?> loadedClass = null;\n \n \n     /**",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/2d14b55fa2105d286c67298e1ec94c53b1f52938/java/org/apache/catalina/loader/ResourceEntry.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "b4098a7733170d2a03e8e3d04dc27dc6719b3441",
                "blob_url": "https://github.com/apache/tomcat80/blob/2d14b55fa2105d286c67298e1ec94c53b1f52938/java/org/apache/catalina/loader/ResourceEntry.java",
                "filename": "java/org/apache/catalina/loader/ResourceEntry.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/loader/ResourceEntry.java?ref=2d14b55fa2105d286c67298e1ec94c53b1f52938"
            },
            {
                "patch": "@@ -50,6 +50,7 @@\n import java.util.jar.Manifest;\n import java.util.jar.Attributes.Name;\n \n+import javax.naming.Binding;\n import javax.naming.NameClassPair;\n import javax.naming.NamingEnumeration;\n import javax.naming.NamingException;\n@@ -114,7 +115,7 @@\n         Boolean.valueOf(System.getProperty(\"org.apache.catalina.loader.WebappClassLoader.ENABLE_CLEAR_REFERENCES\", \"true\")).booleanValue();\n     \n     protected class PrivilegedFindResource\n-        implements PrivilegedAction {\n+        implements PrivilegedAction<ResourceEntry> {\n \n         protected File file;\n         protected String path;\n@@ -124,7 +125,7 @@\n             this.path = path;\n         }\n \n-        public Object run() {\n+        public ResourceEntry run() {\n             return findResourceInternal(file, path);\n         }\n \n@@ -239,13 +240,13 @@ public WebappClassLoader(ClassLoader parent) {\n      * The cache of ResourceEntry for classes and resources we have loaded,\n      * keyed by resource name.\n      */\n-    protected HashMap resourceEntries = new HashMap();\n+    protected HashMap<String, ResourceEntry> resourceEntries = new HashMap<String, ResourceEntry>();\n \n \n     /**\n      * The list of not found resources.\n      */\n-    protected HashMap notFoundResources = new HashMap();\n+    protected HashMap<String, String> notFoundResources = new HashMap<String, String>();\n \n \n     /**\n@@ -331,7 +332,8 @@ public WebappClassLoader(ClassLoader parent) {\n      * A list of read File and Jndi Permission's required if this loader\n      * is for a web application context.\n      */\n-    protected ArrayList permissionList = new ArrayList();\n+    protected ArrayList<Permission> permissionList =\n+        new ArrayList<Permission>();\n \n \n     /**\n@@ -344,7 +346,7 @@ public WebappClassLoader(ClassLoader parent) {\n      * The PermissionCollection for each CodeSource for a web\n      * application context.\n      */\n-    protected HashMap loaderPC = new HashMap();\n+    protected HashMap<String, PermissionCollection> loaderPC = new HashMap<String, PermissionCollection>();\n \n \n     /**\n@@ -706,7 +708,7 @@ synchronized void addJar(String jar, JarFile jarFile, File file)\n      */\n     public String[] findRepositories() {\n \n-        return ((String[])repositories.clone());\n+        return (repositories.clone());\n \n     }\n \n@@ -755,10 +757,11 @@ public boolean modified() {\n         if (getJarPath() != null) {\n \n             try {\n-                NamingEnumeration enumeration = resources.listBindings(getJarPath());\n+                NamingEnumeration<Binding> enumeration =\n+                    resources.listBindings(getJarPath());\n                 int i = 0;\n                 while (enumeration.hasMoreElements() && (i < length)) {\n-                    NameClassPair ncPair = (NameClassPair) enumeration.nextElement();\n+                    NameClassPair ncPair = enumeration.nextElement();\n                     String name = ncPair.getName();\n                     // Ignore non JARs present in the lib folder\n                     if (!name.endsWith(\".jar\"))\n@@ -773,8 +776,7 @@ public boolean modified() {\n                 }\n                 if (enumeration.hasMoreElements()) {\n                     while (enumeration.hasMoreElements()) {\n-                        NameClassPair ncPair = \n-                            (NameClassPair) enumeration.nextElement();\n+                        NameClassPair ncPair = enumeration.nextElement();\n                         String name = ncPair.getName();\n                         // Additional non-JAR files are allowed\n                         if (name.endsWith(\".jar\")) {\n@@ -853,7 +855,7 @@ protected void addURL(URL url) {\n      *\n      * @exception ClassNotFoundException if the class was not found\n      */\n-    public Class findClass(String name) throws ClassNotFoundException {\n+    public Class<?> findClass(String name) throws ClassNotFoundException {\n \n         if (log.isDebugEnabled())\n             log.debug(\"    findClass(\" + name + \")\");\n@@ -881,7 +883,7 @@ public Class findClass(String name) throws ClassNotFoundException {\n \n         // Ask our superclass to locate this class, if possible\n         // (throws ClassNotFoundException if it is not found)\n-        Class clazz = null;\n+        Class<?> clazz = null;\n         try {\n             if (log.isTraceEnabled())\n                 log.trace(\"      findClassInternal(\" + name + \")\");\n@@ -926,7 +928,7 @@ public Class findClass(String name) throws ClassNotFoundException {\n         if (log.isTraceEnabled())\n             log.debug(\"      Returning class \" + clazz);\n         \n-        if ((log.isTraceEnabled()) && (clazz != null)) {\n+        if (log.isTraceEnabled()) {\n             ClassLoader cl;\n             if (Globals.IS_SECURITY_ENABLED){\n                 cl = AccessController.doPrivileged(\n@@ -955,7 +957,7 @@ public URL findResource(final String name) {\n \n         URL url = null;\n \n-        ResourceEntry entry = (ResourceEntry) resourceEntries.get(name);\n+        ResourceEntry entry = resourceEntries.get(name);\n         if (entry == null) {\n             entry = findResourceInternal(name, name);\n         }\n@@ -986,12 +988,12 @@ public URL findResource(final String name) {\n      *\n      * @exception IOException if an input/output error occurs\n      */\n-    public Enumeration findResources(String name) throws IOException {\n+    public Enumeration<URL> findResources(String name) throws IOException {\n \n         if (log.isDebugEnabled())\n             log.debug(\"    findResources(\" + name + \")\");\n \n-        Vector result = new Vector();\n+        Vector<URL> result = new Vector<URL>();\n \n         int jarFilesLength = jarFiles.length;\n         int repositoriesLength = repositories.length;\n@@ -1035,7 +1037,7 @@ public Enumeration findResources(String name) throws IOException {\n         // Adding the results of a call to the superclass\n         if (hasExternalRepositories) {\n \n-            Enumeration otherResourcePaths = super.findResources(name);\n+            Enumeration<URL> otherResourcePaths = super.findResources(name);\n \n             while (otherResourcePaths.hasMoreElements()) {\n                 result.addElement(otherResourcePaths.nextElement());\n@@ -1097,7 +1099,7 @@ public URL getResource(String name) {\n             // Locating the repository for special handling in the case \n             // of a JAR\n             if (antiJARLocking) {\n-                ResourceEntry entry = (ResourceEntry) resourceEntries.get(name);\n+                ResourceEntry entry = resourceEntries.get(name);\n                 try {\n                     String repository = entry.codeBase.toString();\n                     if ((repository.endsWith(\".jar\")) \n@@ -1188,7 +1190,7 @@ public InputStream getResourceAsStream(String name) {\n                 if (hasExternalRepositories && (stream == null))\n                     stream = url.openStream();\n             } catch (IOException e) {\n-                ; // Ignore\n+                // Ignore\n             }\n             if (stream != null)\n                 return (stream);\n@@ -1227,7 +1229,7 @@ public InputStream getResourceAsStream(String name) {\n      *\n      * @exception ClassNotFoundException if the class was not found\n      */\n-    public Class loadClass(String name) throws ClassNotFoundException {\n+    public Class<?> loadClass(String name) throws ClassNotFoundException {\n \n         return (loadClass(name, false));\n \n@@ -1259,12 +1261,12 @@ public Class loadClass(String name) throws ClassNotFoundException {\n      *\n      * @exception ClassNotFoundException if the class was not found\n      */\n-    public Class loadClass(String name, boolean resolve)\n+    public Class<?> loadClass(String name, boolean resolve)\n         throws ClassNotFoundException {\n \n         if (log.isDebugEnabled())\n             log.debug(\"loadClass(\" + name + \", \" + resolve + \")\");\n-        Class clazz = null;\n+        Class<?> clazz = null;\n \n         // Log access to stopped classloader\n         if (!started) {\n@@ -1342,7 +1344,7 @@ public Class loadClass(String name, boolean resolve)\n                     return (clazz);\n                 }\n             } catch (ClassNotFoundException e) {\n-                ;\n+                // Ignore\n             }\n         }\n \n@@ -1359,7 +1361,7 @@ public Class loadClass(String name, boolean resolve)\n                 return (clazz);\n             }\n         } catch (ClassNotFoundException e) {\n-            ;\n+            // Ignore\n         }\n \n         // (3) Delegate to parent unconditionally\n@@ -1379,7 +1381,7 @@ public Class loadClass(String name, boolean resolve)\n                     return (clazz);\n                 }\n             } catch (ClassNotFoundException e) {\n-                ;\n+                // Ignore\n             }\n         }\n \n@@ -1401,12 +1403,12 @@ protected PermissionCollection getPermissions(CodeSource codeSource) {\n \n         String codeUrl = codeSource.getLocation().toString();\n         PermissionCollection pc;\n-        if ((pc = (PermissionCollection)loaderPC.get(codeUrl)) == null) {\n+        if ((pc = loaderPC.get(codeUrl)) == null) {\n             pc = super.getPermissions(codeSource);\n             if (pc != null) {\n-                Iterator perms = permissionList.iterator();\n+                Iterator<Permission> perms = permissionList.iterator();\n                 while (perms.hasNext()) {\n-                    Permission p = (Permission)perms.next();\n+                    Permission p = perms.next();\n                     pc.add(p);\n                 }\n                 loaderPC.put(codeUrl,pc);\n@@ -1602,9 +1604,9 @@ public void closeJARs(boolean force) {\n     protected void clearReferences() {\n \n         // Unregister any JDBC drivers loaded by this classloader\n-        Enumeration drivers = DriverManager.getDrivers();\n+        Enumeration<Driver> drivers = DriverManager.getDrivers();\n         while (drivers.hasMoreElements()) {\n-            Driver driver = (Driver) drivers.nextElement();\n+            Driver driver = drivers.nextElement();\n             if (driver.getClass().getClassLoader() == this) {\n                 try {\n                     DriverManager.deregisterDriver(driver);\n@@ -1617,11 +1619,11 @@ protected void clearReferences() {\n         // Null out any static or final fields from loaded classes,\n         // as a workaround for apparent garbage collection bugs\n         if (ENABLE_CLEAR_REFERENCES) {\n-            Iterator loadedClasses = ((HashMap) resourceEntries.clone()).values().iterator();\n+            Iterator<ResourceEntry> loadedClasses = ((HashMap<String, ResourceEntry>) resourceEntries.clone()).values().iterator();\n             while (loadedClasses.hasNext()) {\n-                ResourceEntry entry = (ResourceEntry) loadedClasses.next();\n+                ResourceEntry entry = loadedClasses.next();\n                 if (entry.loadedClass != null) {\n-                    Class clazz = entry.loadedClass;\n+                    Class<?> clazz = entry.loadedClass;\n                     try {\n                         Field[] fields = clazz.getDeclaredFields();\n                         for (int i = 0; i < fields.length; i++) {\n@@ -1695,7 +1697,7 @@ protected void nullInstance(Object instance) {\n                 } else {\n                     Object value = field.get(instance);\n                     if (null != value) {\n-                        Class valueClass = value.getClass();\n+                        Class<? extends Object> valueClass = value.getClass();\n                         if (!loadedByThisOrChild(valueClass)) {\n                             if (log.isDebugEnabled()) {\n                                 log.debug(\"Not setting field \" + field.getName() +\n@@ -1729,7 +1731,7 @@ protected void nullInstance(Object instance) {\n      * Determine whether a class was loaded by this class loader or one of\n      * its child class loaders.\n      */\n-    protected boolean loadedByThisOrChild(Class clazz)\n+    protected boolean loadedByThisOrChild(Class<? extends Object> clazz)\n     {\n         boolean result = false;\n         for (ClassLoader classLoader = clazz.getClassLoader();\n@@ -1771,7 +1773,7 @@ protected boolean openJARs() {\n      *\n      * @return the loaded class, or null if the class isn't found\n      */\n-    protected Class findClassInternal(String name)\n+    protected Class<?> findClassInternal(String name)\n         throws ClassNotFoundException {\n \n         if (!validate(name))\n@@ -1787,7 +1789,7 @@ protected Class findClassInternal(String name)\n         if (entry == null)\n             throw new ClassNotFoundException(name);\n \n-        Class clazz = entry.loadedClass;\n+        Class<?> clazz = entry.loadedClass;\n         if (clazz != null)\n             return clazz;\n \n@@ -1900,7 +1902,7 @@ protected ResourceEntry findResourceInternal(String name, String path) {\n         if ((name == null) || (path == null))\n             return null;\n \n-        ResourceEntry entry = (ResourceEntry) resourceEntries.get(name);\n+        ResourceEntry entry = resourceEntries.get(name);\n         if (entry != null)\n             return entry;\n \n@@ -1929,9 +1931,9 @@ protected ResourceEntry findResourceInternal(String name, String path) {\n                 // Note : Not getting an exception here means the resource was\n                 // found\n                  if (securityManager != null) {\n-                    PrivilegedAction dp =\n+                    PrivilegedAction<ResourceEntry> dp =\n                         new PrivilegedFindResource(files[i], path);\n-                    entry = (ResourceEntry)AccessController.doPrivileged(dp);\n+                    entry = AccessController.doPrivileged(dp);\n                  } else {\n                     entry = findResourceInternal(files[i], path);\n                  }\n@@ -2025,10 +2027,10 @@ protected ResourceEntry findResourceInternal(String name, String path) {\n                         File resourceFile = new File\n                             (loaderDir, jarEntry.getName());\n                         if (!resourceFile.exists()) {\n-                            Enumeration entries = jarFiles[i].entries();\n+                            Enumeration<JarEntry> entries =\n+                                jarFiles[i].entries();\n                             while (entries.hasMoreElements()) {\n-                                JarEntry jarEntry2 = \n-                                    (JarEntry) entries.nextElement();\n+                                JarEntry jarEntry2 =  entries.nextElement();\n                                 if (!(jarEntry2.isDirectory()) \n                                     && (!jarEntry2.getName().endsWith\n                                         (\".class\"))) {\n@@ -2129,7 +2131,7 @@ protected ResourceEntry findResourceInternal(String name, String path) {\n             // Ensures that all the threads which may be in a race to load\n             // a particular class all end up with the same ResourceEntry\n             // instance\n-            ResourceEntry entry2 = (ResourceEntry) resourceEntries.get(name);\n+            ResourceEntry entry2 = resourceEntries.get(name);\n             if (entry2 == null) {\n                 resourceEntries.put(name, entry);\n             } else {\n@@ -2174,7 +2176,7 @@ protected boolean isPackageSealed(String name, Manifest man) {\n      */\n     protected InputStream findLoadedResource(String name) {\n \n-        ResourceEntry entry = (ResourceEntry) resourceEntries.get(name);\n+        ResourceEntry entry = resourceEntries.get(name);\n         if (entry != null) {\n             if (entry.binaryContent != null)\n                 return new ByteArrayInputStream(entry.binaryContent);\n@@ -2191,9 +2193,9 @@ protected InputStream findLoadedResource(String name) {\n      *\n      * @param name Name of the resource to return\n      */\n-    protected Class findLoadedClass0(String name) {\n+    protected Class<?> findLoadedClass0(String name) {\n \n-        ResourceEntry entry = (ResourceEntry) resourceEntries.get(name);\n+        ResourceEntry entry = resourceEntries.get(name);\n         if (entry != null) {\n             return entry.loadedClass;\n         }\n@@ -2287,7 +2289,7 @@ protected boolean validateJarFile(File jarfile)\n             return (true);\n         JarFile jarFile = new JarFile(jarfile);\n         for (int i = 0; i < triggers.length; i++) {\n-            Class clazz = null;\n+            Class<?> clazz = null;\n             try {\n                 if (parent != null) {\n                     clazz = parent.loadClass(triggers[i]);\n@@ -2332,7 +2334,7 @@ protected URL getURL(File file, boolean encoded)\n         if(encoded) {\n             return getURI(realFile);\n         } else {\n-            return realFile.toURL();\n+            return realFile.toURI().toURL();\n         }\n \n     }",
                "additions": 52,
                "raw_url": "https://github.com/apache/tomcat80/raw/2d14b55fa2105d286c67298e1ec94c53b1f52938/java/org/apache/catalina/loader/WebappClassLoader.java",
                "status": "modified",
                "changes": 102,
                "deletions": 50,
                "sha": "5a911453b1f0113f3e1a094636718c40867a688e",
                "blob_url": "https://github.com/apache/tomcat80/blob/2d14b55fa2105d286c67298e1ec94c53b1f52938/java/org/apache/catalina/loader/WebappClassLoader.java",
                "filename": "java/org/apache/catalina/loader/WebappClassLoader.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/loader/WebappClassLoader.java?ref=2d14b55fa2105d286c67298e1ec94c53b1f52938"
            },
            {
                "patch": "@@ -49,7 +49,6 @@\n \n import org.apache.catalina.Container;\n import org.apache.catalina.Context;\n-import org.apache.catalina.Engine;\n import org.apache.catalina.Globals;\n import org.apache.catalina.Lifecycle;\n import org.apache.catalina.LifecycleException;\n@@ -207,7 +206,7 @@ public WebappLoader(ClassLoader parent) {\n     /**\n      * Repositories that are set in the loader, for JMX.\n      */\n-    private ArrayList loaderRepositories = null;\n+    private ArrayList<String> loaderRepositories = null;\n \n \n     // ------------------------------------------------------------- Properties\n@@ -218,7 +217,7 @@ public WebappLoader(ClassLoader parent) {\n      */\n     public ClassLoader getClassLoader() {\n \n-        return ((ClassLoader) classLoader);\n+        return classLoader;\n \n     }\n \n@@ -423,12 +422,12 @@ public void backgroundProcess() {\n      */\n     public String[] findRepositories() {\n \n-        return ((String[])repositories.clone());\n+        return repositories.clone();\n \n     }\n \n     public String[] getRepositories() {\n-        return ((String[])repositories.clone());\n+        return repositories.clone();\n     }\n \n     /** Extra repositories for this loader\n@@ -564,7 +563,6 @@ public void init() {\n                 // Register ourself. The container must be a webapp\n                 try {\n                     StandardContext ctx=(StandardContext)container;\n-                    Engine eng=(Engine)ctx.getParent().getParent();\n                     String path = ctx.getPath();\n                     if (path.equals(\"\")) {\n                         path = \"/\";\n@@ -652,15 +650,13 @@ public void start() throws LifecycleException {\n \n             setPermissions();\n \n-            if (classLoader instanceof Lifecycle)\n-                ((Lifecycle) classLoader).start();\n+            ((Lifecycle) classLoader).start();\n \n             // Binding the Webapp class loader to the directory context\n-            DirContextURLStreamHandler.bind\n-                ((ClassLoader) classLoader, this.container.getResources());\n+            DirContextURLStreamHandler.bind(classLoader,\n+                    this.container.getResources());\n \n             StandardContext ctx=(StandardContext)container;\n-            Engine eng=(Engine)ctx.getParent().getParent();\n             String path = ctx.getPath();\n             if (path.equals(\"\")) {\n                 path = \"/\";\n@@ -703,13 +699,11 @@ public void stop() throws LifecycleException {\n         }\n \n         // Throw away our current class loader\n-        if (classLoader instanceof Lifecycle)\n-            ((Lifecycle) classLoader).stop();\n-        DirContextURLStreamHandler.unbind((ClassLoader) classLoader);\n+        ((Lifecycle) classLoader).stop();\n+        DirContextURLStreamHandler.unbind(classLoader);\n \n         try {\n             StandardContext ctx=(StandardContext)container;\n-            Engine eng=(Engine)ctx.getParent().getParent();\n             String path = ctx.getPath();\n             if (path.equals(\"\")) {\n                 path = \"/\";\n@@ -742,7 +736,6 @@ public void propertyChange(PropertyChangeEvent event) {\n         // Validate the source of this event\n         if (!(event.getSource() instanceof Context))\n             return;\n-        Context context = (Context) event.getSource();\n \n         // Process a relevant property change\n         if (event.getPropertyName().equals(\"reloadable\")) {\n@@ -767,15 +760,15 @@ public void propertyChange(PropertyChangeEvent event) {\n     private WebappClassLoader createClassLoader()\n         throws Exception {\n \n-        Class clazz = Class.forName(loaderClass);\n+        Class<?> clazz = Class.forName(loaderClass);\n         WebappClassLoader classLoader = null;\n \n         if (parentClassLoader == null) {\n             parentClassLoader = container.getParentClassLoader();\n         }\n-        Class[] argTypes = { ClassLoader.class };\n+        Class<?>[] argTypes = { ClassLoader.class };\n         Object[] args = { parentClassLoader };\n-        Constructor constr = clazz.getConstructor(argTypes);\n+        Constructor<?> constr = clazz.getConstructor(argTypes);\n         classLoader = (WebappClassLoader) constr.newInstance(args);\n \n         return classLoader;\n@@ -887,15 +880,15 @@ private void setRepositories() {\n         if (servletContext == null)\n             return;\n \n-        loaderRepositories=new ArrayList();\n+        loaderRepositories=new ArrayList<String>();\n         // Loading the work directory\n         File workDir =\n             (File) servletContext.getAttribute(Globals.WORK_DIR_ATTR);\n         if (workDir == null) {\n             log.info(\"No work dir for \" + servletContext);\n         }\n \n-        if( log.isDebugEnabled()) \n+        if( log.isDebugEnabled() && workDir != null) \n             log.debug(sm.getString(\"webappLoader.deploy\", workDir.getAbsolutePath()));\n \n         classLoader.setWorkDir(workDir);\n@@ -981,10 +974,11 @@ private void setRepositories() {\n \n             // Looking up directory /WEB-INF/lib in the context\n             try {\n-                NamingEnumeration enumeration = resources.listBindings(libPath);\n+                NamingEnumeration<Binding> enumeration =\n+                    resources.listBindings(libPath);\n                 while (enumeration.hasMoreElements()) {\n \n-                    Binding binding = (Binding) enumeration.nextElement();\n+                    Binding binding = enumeration.nextElement();\n                     String filename = libPath + \"/\" + binding.getName();\n                     if (!filename.endsWith(\".jar\"))\n                         continue;\n@@ -1139,10 +1133,9 @@ private boolean copyDir(DirContext srcDir, File destDir) {\n \n         try {\n \n-            NamingEnumeration enumeration = srcDir.list(\"\");\n+            NamingEnumeration<NameClassPair> enumeration = srcDir.list(\"\");\n             while (enumeration.hasMoreElements()) {\n-                NameClassPair ncPair =\n-                    (NameClassPair) enumeration.nextElement();\n+                NameClassPair ncPair = enumeration.nextElement();\n                 String name = ncPair.getName();\n                 Object object = srcDir.lookup(name);\n                 File currentFile = new File(destDir, name);\n@@ -1201,16 +1194,11 @@ private boolean copy(InputStream is, OutputStream os) {\n         org.apache.juli.logging.LogFactory.getLog( WebappLoader.class );\n \n     private ObjectName oname;\n-    private MBeanServer mserver;\n-    private String domain;\n     private ObjectName controller;\n \n     public ObjectName preRegister(MBeanServer server,\n                                   ObjectName name) throws Exception {\n         oname=name;\n-        mserver=server;\n-        domain=name.getDomain();\n-\n         return name;\n     }\n ",
                "additions": 19,
                "raw_url": "https://github.com/apache/tomcat80/raw/2d14b55fa2105d286c67298e1ec94c53b1f52938/java/org/apache/catalina/loader/WebappLoader.java",
                "status": "modified",
                "changes": 50,
                "deletions": 31,
                "sha": "753b995d83007f48d614cfacc32d7f22739204b4",
                "blob_url": "https://github.com/apache/tomcat80/blob/2d14b55fa2105d286c67298e1ec94c53b1f52938/java/org/apache/catalina/loader/WebappLoader.java",
                "filename": "java/org/apache/catalina/loader/WebappLoader.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/loader/WebappLoader.java?ref=2d14b55fa2105d286c67298e1ec94c53b1f52938"
            }
        ],
        "bug_id": "tomcat80_216",
        "parent": "https://github.com/apache/tomcat80/commit/96f53e9a7eae57602e55cb1671394075dca7600e",
        "message": "Generics for o.a.c.loader\nFix various eclipse warnings (remove unused code, fix possible NPE)\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@729634 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/c6759d3ffb5724c87e34eb9e15533216f00347db",
        "file": [
            {
                "patch": "@@ -345,24 +345,26 @@ public void invoke(Request request, Response response)\n                 crossContextSessions.set(new ArrayList());\n             }\n             getNext().invoke(request, response);\n-            Manager manager = request.getContext().getManager();\n-            if (manager != null && manager instanceof ClusterManager) {\n-                ClusterManager clusterManager = (ClusterManager) manager;\n-                CatalinaCluster containerCluster = (CatalinaCluster) getContainer().getCluster();\n-                if (containerCluster == null) {\n-                    if (log.isWarnEnabled())\n-                        log.warn(sm.getString(\"ReplicationValve.nocluster\"));\n-                    return;\n+            if(context != null) {\n+                Manager manager = context.getManager();            \n+                if (manager != null && manager instanceof ClusterManager) {\n+                    ClusterManager clusterManager = (ClusterManager) manager;\n+                    CatalinaCluster containerCluster = (CatalinaCluster) getContainer().getCluster();\n+                    if (containerCluster == null) {\n+                        if (log.isWarnEnabled())\n+                            log.warn(sm.getString(\"ReplicationValve.nocluster\"));\n+                        return;\n+                    }\n+                    // valve cluster can access manager - other cluster handle replication \n+                    // at host level - hopefully!\n+                    if(containerCluster.getManager(clusterManager.getName()) == null)\n+                        return ;\n+                    if(containerCluster.hasMembers()) {\n+                        sendReplicationMessage(request, totalstart, isCrossContext, clusterManager, containerCluster);\n+                    } else {\n+                        resetReplicationRequest(request,isCrossContext);\n+                    }        \n                 }\n-                // valve cluster can access manager - other cluster handle replication \n-                // at host level - hopefully!\n-                if(containerCluster.getManager(clusterManager.getName()) == null)\n-                    return ;\n-                if(containerCluster.hasMembers()) {\n-                    sendReplicationMessage(request, totalstart, isCrossContext, clusterManager, containerCluster);\n-                } else {\n-                    resetReplicationRequest(request,isCrossContext);\n-                }        \n             }\n         } finally {\n             // Array must be remove: Current master request send endAccess at recycle. ",
                "additions": 19,
                "raw_url": "https://github.com/apache/tomcat80/raw/c6759d3ffb5724c87e34eb9e15533216f00347db/java/org/apache/catalina/ha/tcp/ReplicationValve.java",
                "status": "modified",
                "changes": 36,
                "deletions": 17,
                "sha": "0c17f36f0ed66018938015052c5128e4e6710f06",
                "blob_url": "https://github.com/apache/tomcat80/blob/c6759d3ffb5724c87e34eb9e15533216f00347db/java/org/apache/catalina/ha/tcp/ReplicationValve.java",
                "filename": "java/org/apache/catalina/ha/tcp/ReplicationValve.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/ha/tcp/ReplicationValve.java?ref=c6759d3ffb5724c87e34eb9e15533216f00347db"
            }
        ],
        "bug_id": "tomcat80_217",
        "parent": "https://github.com/apache/tomcat80/commit/beb777160b7905da9aacf90c4f347e344e22c4b4",
        "message": "FIX possible NPE as Engine level configuration, as context dosen't exists!\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@712274 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/59530d3fa9677cc8baf3ce6d45eae7cd6ff4ea73",
        "file": [
            {
                "patch": "@@ -676,9 +676,12 @@ public void postDeregister() {\n     }\n \n     public void pause() throws Exception {\n-        for( int i=0; i<wEnv.getHandlerCount(); i++ ) {\n-            if( wEnv.getHandler(i) != null ) {\n-                wEnv.getHandler(i).pause();\n+        // wEnv sometime null at shutdown - bug45591\n+        if (wEnv != null) {\n+            for( int i=0; i<wEnv.getHandlerCount(); i++ ) {\n+                if( wEnv.getHandler(i) != null ) {\n+                    wEnv.getHandler(i).pause();\n+                }\n             }\n         }\n     }",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/59530d3fa9677cc8baf3ce6d45eae7cd6ff4ea73/java/org/apache/jk/server/JkMain.java",
                "status": "modified",
                "changes": 9,
                "deletions": 3,
                "sha": "079ee9f9693ac5d6c10c12853bf155c0670cd628",
                "blob_url": "https://github.com/apache/tomcat80/blob/59530d3fa9677cc8baf3ce6d45eae7cd6ff4ea73/java/org/apache/jk/server/JkMain.java",
                "filename": "java/org/apache/jk/server/JkMain.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jk/server/JkMain.java?ref=59530d3fa9677cc8baf3ce6d45eae7cd6ff4ea73"
            }
        ],
        "bug_id": "tomcat80_218",
        "parent": "https://github.com/apache/tomcat80/commit/b5f83bbf60aa7e8c315b49e9ceea646693fd45ff",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45591 - NPE on start-up failure in some cases\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@683982 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/5da51a974575f09293e792691d8b8d450a99d93a",
        "file": [
            {
                "patch": "@@ -1728,8 +1728,10 @@ public void run () {\n                     }\n                 } //replacement for Process.waitFor()\n     \n-                // Close the output stream used\n-                cgiOutput.close();\n+                // Close the output stream if used\n+                if (cgiOutput != null) {\n+                    cgiOutput.close();\n+                }\n             }\n             catch (IOException e){\n                 log (\"Caught exception \" + e);",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/5da51a974575f09293e792691d8b8d450a99d93a/java/org/apache/catalina/servlets/CGIServlet.java",
                "status": "modified",
                "changes": 6,
                "deletions": 2,
                "sha": "1de39acd17e6f2e99cc3bc25f6ae340286112ffa",
                "blob_url": "https://github.com/apache/tomcat80/blob/5da51a974575f09293e792691d8b8d450a99d93a/java/org/apache/catalina/servlets/CGIServlet.java",
                "filename": "java/org/apache/catalina/servlets/CGIServlet.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/servlets/CGIServlet.java?ref=5da51a974575f09293e792691d8b8d450a99d93a"
            }
        ],
        "bug_id": "tomcat80_219",
        "parent": "https://github.com/apache/tomcat80/commit/0ac5e92708142e496d1efe1bbb4db862b3cdcb64",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42722\nPossible NPE in CGIServlet.java\nPatch provided by Nils Hammar\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@675751 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/2201f74b3a724fad5bb4f55c5b512815509f1a07",
        "file": [
            {
                "patch": "@@ -1032,6 +1032,8 @@ public Object getAttribute(String name) {\n             throw new IllegalStateException\n                 (sm.getString(\"standardSession.getAttribute.ise\"));\n \n+        if (name == null) return null;\n+\n         return (attributes.get(name));\n \n     }",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/2201f74b3a724fad5bb4f55c5b512815509f1a07/java/org/apache/catalina/session/StandardSession.java",
                "status": "modified",
                "changes": 2,
                "deletions": 0,
                "sha": "3f9e4610f12222affa8c32f9f1bdff863c15035a",
                "blob_url": "https://github.com/apache/tomcat80/blob/2201f74b3a724fad5bb4f55c5b512815509f1a07/java/org/apache/catalina/session/StandardSession.java",
                "filename": "java/org/apache/catalina/session/StandardSession.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/session/StandardSession.java?ref=2201f74b3a724fad5bb4f55c5b512815509f1a07"
            }
        ],
        "bug_id": "tomcat80_220",
        "parent": "https://github.com/apache/tomcat80/commit/2e46ab75c55a091ab63145fac82b81f129af0832",
        "message": "Fix bug 45195. NPE when calling getAttribute(null).\nThe spec is unclear but this is a regression from 5.0.x\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@667604 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/bbd6772c723490d09dbc60a8cfd567eecee23441",
        "file": [
            {
                "patch": "@@ -136,13 +136,6 @@ public final void invoke(Request request, Response response)\n \n         // Select the Wrapper to be used for this Request\n         Wrapper wrapper = request.getWrapper();\n-\n-        if (wrapper.isUnavailable()) {\n-            // May be as a result of a reload\n-            // Try and find the new wrapper\n-            wrapper = (Wrapper) container.findChild(wrapper.getName());\n-        }\n-\n         if (wrapper == null) {\n             String requestURI = request.getDecodedRequestURI();\n             notFound(requestURI, response);",
                "additions": 0,
                "raw_url": "https://github.com/apache/tomcat80/raw/bbd6772c723490d09dbc60a8cfd567eecee23441/java/org/apache/catalina/core/StandardContextValve.java",
                "status": "modified",
                "changes": 7,
                "deletions": 7,
                "sha": "c473590a0abcdc0bd4171fe0ce76f6ffcb032273",
                "blob_url": "https://github.com/apache/tomcat80/blob/bbd6772c723490d09dbc60a8cfd567eecee23441/java/org/apache/catalina/core/StandardContextValve.java",
                "filename": "java/org/apache/catalina/core/StandardContextValve.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/StandardContextValve.java?ref=bbd6772c723490d09dbc60a8cfd567eecee23441"
            }
        ],
        "bug_id": "tomcat80_221",
        "parent": "https://github.com/apache/tomcat80/commit/f815348a0eaed7152a71906859416b3af813fac8",
        "message": "Revert previous patch to fix obvious potential NPE as pointed out by Remy.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@650645 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/9d459c67976f699f6f920648841b0357a3e6e0a5",
        "file": [
            {
                "patch": "@@ -120,6 +120,8 @@ public Function() {\n         public void writeExternal(ObjectOutput out) throws IOException {\n             out.writeUTF((this.prefix != null) ? this.prefix : \"\");\n             out.writeUTF(this.localName);\n+            // make sure m isn't null\n+            getMethod();\n             out.writeUTF((this.owner != null) ? \n                      this.owner : \n                      this.m.getDeclaringClass().getName());",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/9d459c67976f699f6f920648841b0357a3e6e0a5/java/org/apache/el/lang/FunctionMapperImpl.java",
                "status": "modified",
                "changes": 2,
                "deletions": 0,
                "sha": "de60ddb015e05bc9323bed3c24a519772ffde920",
                "blob_url": "https://github.com/apache/tomcat80/blob/9d459c67976f699f6f920648841b0357a3e6e0a5/java/org/apache/el/lang/FunctionMapperImpl.java",
                "filename": "java/org/apache/el/lang/FunctionMapperImpl.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/el/lang/FunctionMapperImpl.java?ref=9d459c67976f699f6f920648841b0357a3e6e0a5"
            }
        ],
        "bug_id": "tomcat80_222",
        "parent": "https://github.com/apache/tomcat80/commit/3b5b11625ed2adbd3239297c7f825e254d4dda99",
        "message": "Fix bug 44428. Make sure m is not null to prevent NPE.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@646574 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/6c3a42d78ee5e34e6131f182eab7323a217448d3",
        "file": [
            {
                "patch": "@@ -551,7 +551,8 @@ protected void parseSessionCookiesId(org.apache.coyote.Request req, Request requ\n         // context, don't go looking for a session ID in a cookie as a cookie\n         // from a parent context with a session ID may be present which would\n         // overwrite the valid session ID encoded in the URL\n-        if (!((Context)request.getMappingData().context).getCookies())\n+        Context context = (Context) request.getMappingData().context;\n+        if (context != null && !context.getCookies())\n             return;\n         \n         // Parse session id from cookies",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/6c3a42d78ee5e34e6131f182eab7323a217448d3/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "status": "modified",
                "changes": 3,
                "deletions": 1,
                "sha": "e3ce60b5e1b031cc02a2ef5a6bc80ad16197221f",
                "blob_url": "https://github.com/apache/tomcat80/blob/6c3a42d78ee5e34e6131f182eab7323a217448d3/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "filename": "java/org/apache/catalina/connector/CoyoteAdapter.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/CoyoteAdapter.java?ref=6c3a42d78ee5e34e6131f182eab7323a217448d3"
            }
        ],
        "bug_id": "tomcat80_223",
        "parent": "https://github.com/apache/tomcat80/commit/c88cfbc084c413904056165e3827ae0c041c11d3",
        "message": "Fix possible NPE when no ROOT application is deployed in fix for bug 43839.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@609003 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/3c61e0a9f3662ee27a657db78613f30565b89858",
        "file": [
            {
                "patch": "@@ -831,12 +831,17 @@ public ScriptingElement(String qName, String localName,\n          */\n         public String getText() {\n             String ret = text;\n-            if ((ret == null) && (body != null)) {\n-                StringBuffer buf = new StringBuffer();\n-                for (int i = 0; i < body.size(); i++) {\n-                    buf.append(body.getNode(i).getText());\n+            if (ret == null) {\n+                if (body != null) {\n+                    StringBuffer buf = new StringBuffer();\n+                    for (int i = 0; i < body.size(); i++) {\n+                        buf.append(body.getNode(i).getText());\n+                    }\n+                    ret = buf.toString();\n+                } else {\n+                    // Nulls cause NPEs further down the line\n+                    ret = \"\";\n                 }\n-                ret = buf.toString();\n             }\n             return ret;\n         }",
                "additions": 10,
                "raw_url": "https://github.com/apache/tomcat80/raw/3c61e0a9f3662ee27a657db78613f30565b89858/java/org/apache/jasper/compiler/Node.java",
                "status": "modified",
                "changes": 15,
                "deletions": 5,
                "sha": "f4a8d8f8762f6c90a80e3dee1247e2c9bd809ee3",
                "blob_url": "https://github.com/apache/tomcat80/blob/3c61e0a9f3662ee27a657db78613f30565b89858/java/org/apache/jasper/compiler/Node.java",
                "filename": "java/org/apache/jasper/compiler/Node.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/Node.java?ref=3c61e0a9f3662ee27a657db78613f30565b89858"
            }
        ],
        "bug_id": "tomcat80_224",
        "parent": "https://github.com/apache/tomcat80/commit/6930b1a8ac1addc634b41fd932b308db6b4f086f",
        "message": "Fix bug 43758. Return empty string rather than null to prevent the NPEs that happen otherwise.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@607903 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/a3cce6c85db2c3d62766cef3e1239d2bd976165b",
        "file": [
            {
                "patch": "@@ -144,7 +144,7 @@ public void readExternal(ObjectInput in) throws IOException,\n         public Method getMethod() {\n             if (this.m == null) {\n                 try {\n-                    Class t = Class.forName(this.owner);\n+                    Class t = ReflectionUtil.forName(this.owner);\n                     Class[] p = ReflectionUtil.toTypeArray(this.types);\n                     this.m = t.getMethod(this.name, p);\n                 } catch (Exception e) {",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/a3cce6c85db2c3d62766cef3e1239d2bd976165b/java/org/apache/el/lang/FunctionMapperImpl.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "a101994f92eeae7333c5464164f9e905921eda52",
                "blob_url": "https://github.com/apache/tomcat80/blob/a3cce6c85db2c3d62766cef3e1239d2bd976165b/java/org/apache/el/lang/FunctionMapperImpl.java",
                "filename": "java/org/apache/el/lang/FunctionMapperImpl.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/el/lang/FunctionMapperImpl.java?ref=a3cce6c85db2c3d62766cef3e1239d2bd976165b"
            },
            {
                "patch": "@@ -98,6 +98,10 @@\n         <bug>43338</bug>: Support '*' servlet-name mapping at filter-mapping.\n         Patch provided by Keiichi Fujino. (pero)\n       </fix>\n+      <fix>\n+        <bug>41797</bug>: CNFE/NPE thrown from function mapper when externalizing\n+        Patch by Tuomas Kiviaho- tuomas.kiviahos at ikis fi\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/a3cce6c85db2c3d62766cef3e1239d2bd976165b/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "66ce17dfcaa38d412cdca0bebf51cd06c85b656a",
                "blob_url": "https://github.com/apache/tomcat80/blob/a3cce6c85db2c3d62766cef3e1239d2bd976165b/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=a3cce6c85db2c3d62766cef3e1239d2bd976165b"
            }
        ],
        "bug_id": "tomcat80_225",
        "parent": "https://github.com/apache/tomcat80/commit/a2f6b4e34c0a1a732f9e98e37cccc66a3dbadb33",
        "message": "bug 41797: CNFE/NPE thrown from function mapper when externalizing\nPatch by Tuomas Kiviaho- tuomas.kiviahos at ikis fi\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@578466 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/52a1f5513d4eba3e000e2625ab3ec92702568451",
        "file": [
            {
                "patch": "@@ -16,7 +16,6 @@\n */\n package sessions;\n \n-import javax.servlet.http.*;\n import java.util.Vector;\n \n public class DummyCart {\n@@ -46,13 +45,10 @@ public void setSubmit(String s) {\n         return s;\n     }\n     \n-    public void processRequest(HttpServletRequest request) {\n+    public void processRequest() {\n         // null value for submit - user hit enter instead of clicking on \n         // \"add\" or \"remove\"\n-        if (submit == null) \n-            addItem(item);\n-\n-        if (submit.equals(\"add\"))\n+        if (submit == null || submit.equals(\"add\"))\n             addItem(item);\n         else if (submit.equals(\"remove\")) \n             removeItem(item);",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/52a1f5513d4eba3e000e2625ab3ec92702568451/webapps/examples/WEB-INF/classes/sessions/DummyCart.java",
                "status": "modified",
                "changes": 8,
                "deletions": 6,
                "sha": "3e5023a9d5d1db322c0a1b8f436a87582835f450",
                "blob_url": "https://github.com/apache/tomcat80/blob/52a1f5513d4eba3e000e2625ab3ec92702568451/webapps/examples/WEB-INF/classes/sessions/DummyCart.java",
                "filename": "webapps/examples/WEB-INF/classes/sessions/DummyCart.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/examples/WEB-INF/classes/sessions/DummyCart.java?ref=52a1f5513d4eba3e000e2625ab3ec92702568451"
            },
            {
                "patch": "@@ -20,7 +20,7 @@\n \n <jsp:setProperty name=\"cart\" property=\"*\" />\n <%\n-\tcart.processRequest(request);\n+\tcart.processRequest();\n %>\n \n ",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/52a1f5513d4eba3e000e2625ab3ec92702568451/webapps/examples/jsp/sessions/carts.jsp",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "187d50182713dee56353f8337368daec6d75e68e",
                "blob_url": "https://github.com/apache/tomcat80/blob/52a1f5513d4eba3e000e2625ab3ec92702568451/webapps/examples/jsp/sessions/carts.jsp",
                "filename": "webapps/examples/jsp/sessions/carts.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/examples/jsp/sessions/carts.jsp?ref=52a1f5513d4eba3e000e2625ab3ec92702568451"
            }
        ],
        "bug_id": "tomcat80_226",
        "parent": "https://github.com/apache/tomcat80/commit/c65a02eca6423444ddadcd5ad476d9ea4c90a331",
        "message": "Port fix for 39212. Possible NPE and redundant code.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@561077 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/02396726b8c5d6612dfb7c233c951d8262743d1a",
        "file": [
            {
                "patch": "@@ -25,6 +25,8 @@\n import java.util.Hashtable;\n import java.io.Serializable;\n \n+import org.apache.catalina.ServerFactory;\n+\n \n /**\n  * Holds and manages the naming resources defined in the J2EE Enterprise \n@@ -191,9 +193,27 @@ public void addEjb(ContextEjb ejb) {\n     public void addEnvironment(ContextEnvironment environment) {\n \n         if (entries.containsKey(environment.getName())) {\n-            if (findEnvironment(environment.getName()).getOverride()) {\n-                removeEnvironment(environment.getName());\n+            ContextEnvironment ce = findEnvironment(environment.getName());\n+            ContextResourceLink rl = findResourceLink(environment.getName());\n+            if (ce != null) {\n+                if (ce.getOverride()) {\n+                    removeEnvironment(environment.getName());\n+                } else {\n+                    return;\n+                }\n+            } else if (rl != null) {\n+                // Link. Need to look at the global resources\n+                NamingResources global =\n+                    ServerFactory.getServer().getGlobalNamingResources();\n+                if (global.findEnvironment(rl.getGlobal()) != null) {\n+                    if (global.findEnvironment(rl.getGlobal()).getOverride()) {\n+                        removeResourceLink(environment.getName());\n+                    } else {\n+                        return;\n+                    }\n+                }\n             } else {\n+                // It exists but it isn't an env or a res link...\n                 return;\n             }\n         }",
                "additions": 22,
                "raw_url": "https://github.com/apache/tomcat80/raw/02396726b8c5d6612dfb7c233c951d8262743d1a/java/org/apache/catalina/deploy/NamingResources.java",
                "status": "modified",
                "changes": 24,
                "deletions": 2,
                "sha": "cff59666df054788be9b79ef0731ac5f933e53c0",
                "blob_url": "https://github.com/apache/tomcat80/blob/02396726b8c5d6612dfb7c233c951d8262743d1a/java/org/apache/catalina/deploy/NamingResources.java",
                "filename": "java/org/apache/catalina/deploy/NamingResources.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/deploy/NamingResources.java?ref=02396726b8c5d6612dfb7c233c951d8262743d1a"
            },
            {
                "patch": "@@ -51,6 +51,10 @@\n         Fix XSS security vulnerability (CVE-2007-2450) in the Manager and Host\n         Manager. Reported by Daiki Fukumori. (markt)\n       </fix>\n+      <fix>\n+        <bug>42547</bug>: Fix NPE when a ResourceLink in context.xml tries to\n+        override an env-entry in web.xml.\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Jasper\">",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/02396726b8c5d6612dfb7c233c951d8262743d1a/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "2b7ad50a9bbe0f468c3c2d432a3cc5f4c7c56628",
                "blob_url": "https://github.com/apache/tomcat80/blob/02396726b8c5d6612dfb7c233c951d8262743d1a/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=02396726b8c5d6612dfb7c233c951d8262743d1a"
            }
        ],
        "bug_id": "tomcat80_227",
        "parent": "https://github.com/apache/tomcat80/commit/2765ce872f8cb27fc38e4482dfae1bdd6f386195",
        "message": "Port fix for bug 42547. Fix NPE when a ResourceLink tries to override an env-entry.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@550048 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/04fb6796596a091c2e38f466da30e65859480d94",
        "file": [
            {
                "patch": "@@ -1875,6 +1875,9 @@ public void setCharsetMapperClass(String mapper) {\n      * @return The work path\n      */ \n     public String getWorkPath() {\n+        if (getWorkDir() == null) {\n+            return null;\n+        }\n         File workDir = new File(getWorkDir());\n         if (!workDir.isAbsolute()) {\n             File catalinaHome = engineBase();",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/04fb6796596a091c2e38f466da30e65859480d94/java/org/apache/catalina/core/StandardContext.java",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "b5b218419bc63ad44290afb5b28e96f2a9b0b2da",
                "blob_url": "https://github.com/apache/tomcat80/blob/04fb6796596a091c2e38f466da30e65859480d94/java/org/apache/catalina/core/StandardContext.java",
                "filename": "java/org/apache/catalina/core/StandardContext.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/StandardContext.java?ref=04fb6796596a091c2e38f466da30e65859480d94"
            }
        ],
        "bug_id": "tomcat80_228",
        "parent": "https://github.com/apache/tomcat80/commit/e6b737f75d715bff429fe4b6b32f753803712209",
        "message": "- NPE check (when using JMX, if I remember correctly).\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@540979 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/f1979c90bafcbc29676897af9ee3b2ee61e4f9a0",
        "file": [
            {
                "patch": "@@ -1035,7 +1035,6 @@ public void addElement(StringBuffer buf, Date date, Request request,\n                 buf.append(request.getProtocol());\n             } else {\n                 buf.append(\"- - \");\n-                buf.append(request.getProtocol());\n             }\n         }\n     }",
                "additions": 0,
                "raw_url": "https://github.com/apache/tomcat80/raw/f1979c90bafcbc29676897af9ee3b2ee61e4f9a0/java/org/apache/catalina/valves/AccessLogValve.java",
                "status": "modified",
                "changes": 1,
                "deletions": 1,
                "sha": "3556e74b8ef0f07bda3be77854ff061c224f99c7",
                "blob_url": "https://github.com/apache/tomcat80/blob/f1979c90bafcbc29676897af9ee3b2ee61e4f9a0/java/org/apache/catalina/valves/AccessLogValve.java",
                "filename": "java/org/apache/catalina/valves/AccessLogValve.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/valves/AccessLogValve.java?ref=f1979c90bafcbc29676897af9ee3b2ee61e4f9a0"
            },
            {
                "patch": "@@ -17,6 +17,10 @@\n <section name=\"Tomcat 6.0.14 (remm)\">\n   <subsection name=\"Catalina\">\n     <changelog>\n+      <fix>\n+         <bug>42444</bug>: prevent NPE \n+         Patch provided by Nils Hammar (funkman)\n+      </fix>\n       <fix>\n          <bug>42361</bug>: Handle multi-part forms when saving requests during\n          FORM authentication process. Patch provided by Peter Runge. (markt)",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/f1979c90bafcbc29676897af9ee3b2ee61e4f9a0/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "dcf8dec913867568063c3f6e7f177c616101e813",
                "blob_url": "https://github.com/apache/tomcat80/blob/f1979c90bafcbc29676897af9ee3b2ee61e4f9a0/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=f1979c90bafcbc29676897af9ee3b2ee61e4f9a0"
            }
        ],
        "bug_id": "tomcat80_229",
        "parent": "https://github.com/apache/tomcat80/commit/11144e75a91c9fd842df3ff49bad024a9f5246b4",
        "message": "bug 42444: prevent NPE \nPatch provided by Nils Hammar (funkman)\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@539787 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/b14f0fd8a435439041df98cfbf60c2584e33db20",
        "file": [
            {
                "patch": "@@ -1862,7 +1862,7 @@ public void run() {\n                         SelectionKey key = socket.getIOChannel().keyFor(socket.getPoller().getSelector());\n                         int handshake = -1;\n                         try {\n-                            handshake = socket.handshake(key.isReadable(), key.isWritable());\n+                            if (key!=null) handshake = socket.handshake(key.isReadable(), key.isWritable());\n                         }catch ( IOException x ) {\n                             handshake = -1;\n                             if ( log.isDebugEnabled() ) log.debug(\"Error during SSL handshake\",x);",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/b14f0fd8a435439041df98cfbf60c2584e33db20/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "1bd8a1eaa56db44a2c1a39d3ca3cef4054fc1602",
                "blob_url": "https://github.com/apache/tomcat80/blob/b14f0fd8a435439041df98cfbf60c2584e33db20/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/NioEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/NioEndpoint.java?ref=b14f0fd8a435439041df98cfbf60c2584e33db20"
            }
        ],
        "bug_id": "tomcat80_230",
        "parent": "https://github.com/apache/tomcat80/commit/9552e01368132b1c6594e34cc238b97a89791493",
        "message": "Prevent NPE on a key that was cancelled by the poller\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@528528 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/2185620729da216f7d3355e2bb51c4997d30a785",
        "file": [
            {
                "patch": "@@ -710,7 +710,9 @@ public void expire(boolean notify) {\n                     }\n                 }\n             }\n-            accessCount = null;\n+            if (ACTIVITY_CHECK) {\n+                accessCount.set(0);\n+            }\n             setValid(false);\n \n             /*",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/2185620729da216f7d3355e2bb51c4997d30a785/java/org/apache/catalina/session/StandardSession.java",
                "status": "modified",
                "changes": 4,
                "deletions": 1,
                "sha": "fcec6ee9a21a285714e9c3e4d3dc8111ba78acde",
                "blob_url": "https://github.com/apache/tomcat80/blob/2185620729da216f7d3355e2bb51c4997d30a785/java/org/apache/catalina/session/StandardSession.java",
                "filename": "java/org/apache/catalina/session/StandardSession.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/session/StandardSession.java?ref=2185620729da216f7d3355e2bb51c4997d30a785"
            }
        ],
        "bug_id": "tomcat80_231",
        "parent": "https://github.com/apache/tomcat80/commit/76b28b54a2c0154abac487e97dc56c57665ae58b",
        "message": "- Fix NPE on isValid for an expired session when activity check is enabled.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@465195 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/98c9eab4f066c1545c524547c36858db185badec",
        "file": [
            {
                "patch": "@@ -15,6 +15,7 @@\n   <!-- Comment these entries out to disable JMX MBeans support used for the \n        administration web application -->\n   <Listener className=\"org.apache.catalina.core.AprLifecycleListener\" />\n+  <Listener className=\"org.apache.catalina.core.JasperListener\" />\n   <Listener className=\"org.apache.catalina.mbeans.ServerLifecycleListener\" />\n   <Listener className=\"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\" />\n   <!--<Listener className=\"org.apache.catalina.storeconfig.StoreConfigLifecycleListener\"/>-->",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/98c9eab4f066c1545c524547c36858db185badec/conf/server.xml",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "671e8eeced754ade12afd97483f17582813fbae7",
                "blob_url": "https://github.com/apache/tomcat80/blob/98c9eab4f066c1545c524547c36858db185badec/conf/server.xml",
                "filename": "conf/server.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/conf/server.xml?ref=98c9eab4f066c1545c524547c36858db185badec"
            },
            {
                "patch": "@@ -218,16 +218,18 @@ public void service(org.apache.coyote.Request req,\n \n             // Parse and set Catalina and configuration specific \n             // request parameters\n-            if ( postParseRequest(req, request, res, response) ) {\n+            if (postParseRequest(req, request, res, response)) {\n+\n                 // Calling the container\n                 connector.getContainer().getPipeline().getFirst().invoke(request, response);\n-            }\n \n-            if (request.getWrapper().getServlet() instanceof CometProcessor \n-                    && !response.isClosed()\n-                    && req.getAttribute(\"org.apache.tomcat.comet.support\") == Boolean.TRUE) {\n-                comet = true;\n-                res.action(ActionCode.ACTION_COMET_BEGIN, null);\n+                if (request.getWrapper().getServlet() instanceof CometProcessor \n+                        && !response.isClosed()\n+                        && req.getAttribute(\"org.apache.tomcat.comet.support\") == Boolean.TRUE) {\n+                    comet = true;\n+                    res.action(ActionCode.ACTION_COMET_BEGIN, null);\n+                }\n+\n             }\n \n             if (!comet) {",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/98c9eab4f066c1545c524547c36858db185badec/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "status": "modified",
                "changes": 16,
                "deletions": 7,
                "sha": "70e202b1fd429f0c8801efcfbdf4983305ce7561",
                "blob_url": "https://github.com/apache/tomcat80/blob/98c9eab4f066c1545c524547c36858db185badec/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "filename": "java/org/apache/catalina/connector/CoyoteAdapter.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/CoyoteAdapter.java?ref=98c9eab4f066c1545c524547c36858db185badec"
            },
            {
                "patch": "@@ -15,6 +15,7 @@\n   <!-- Comment these entries out to disable JMX MBeans support used for the \n        administration web application -->\n   <Listener className=\"org.apache.catalina.core.AprLifecycleListener\" />\n+  <Listener className=\"org.apache.catalina.core.JasperListener\" />\n   <Listener className=\"org.apache.catalina.mbeans.ServerLifecycleListener\" />\n   <Listener className=\"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\" />\n   <!--<Listener className=\"org.apache.catalina.storeconfig.StoreConfigLifecycleListener\"/>-->",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/98c9eab4f066c1545c524547c36858db185badec/res/confinstall/server_1.xml",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "425e7d82882e2f6d443b787ce83948b330b4a5e4",
                "blob_url": "https://github.com/apache/tomcat80/blob/98c9eab4f066c1545c524547c36858db185badec/res/confinstall/server_1.xml",
                "filename": "res/confinstall/server_1.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/res/confinstall/server_1.xml?ref=98c9eab4f066c1545c524547c36858db185badec"
            }
        ],
        "bug_id": "tomcat80_232",
        "parent": "https://github.com/apache/tomcat80/commit/749604b1b6c923372e2215ceb09552fdc15d1cc4",
        "message": "- Add the Jasper listener in the config.\n- Fix (harmless) NPE when request processing doesn't proceed (ex: empty path).\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@432584 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/482896eda00a43cac282a2f7735e0f0e7a7e3fcd",
        "file": [
            {
                "patch": "@@ -179,6 +179,7 @@ standardHost.noContext=No Context configured to process this request\n standardHost.notContext=Child of a Host must be a Context\n standardHost.nullName=Host name is required\n standardHost.problematicAppBase=Using an empty string for appBase on host [{0}] will set it to CATALINA_BASE, which is a bad idea\n+standardHostValue.customStatusFailed=Custom error page [{0}] could not be dispatched correctly\n standardServer.accept.timeout=The socket listening for the shutdown command experienced an unexpected timeout [{0}] milliseconds after the call to accept(). Is this an instance of bug 56684?\n standardServer.shutdownViaPort=A valid shutdown command was received via the shutdown port. Stopping the Server instance.\n standardServer.storeConfig.notAvailable=No StoreConfig implementation was registered as an MBean named [{0}] so no configuration could be saved. A suitable MBean is normally registered via the StoreConfigLifecyleListener.",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/482896eda00a43cac282a2f7735e0f0e7a7e3fcd/java/org/apache/catalina/core/LocalStrings.properties",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "b0b8ff2c619ed73f58fb14e3a3088d5497549493",
                "blob_url": "https://github.com/apache/tomcat80/blob/482896eda00a43cac282a2f7735e0f0e7a7e3fcd/java/org/apache/catalina/core/LocalStrings.properties",
                "filename": "java/org/apache/catalina/core/LocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/LocalStrings.properties?ref=482896eda00a43cac282a2f7735e0f0e7a7e3fcd"
            },
            {
                "patch": "@@ -278,7 +278,7 @@ private void status(Request request, Response response) {\n             // Look for a default error page\n             errorPage = context.findErrorPage(0);\n         }\n-        if (errorPage != null && response.setErrorReported()) {\n+        if (errorPage != null && response.isErrorReportRequired()) {\n             response.setAppCommitted(false);\n             request.setAttribute(RequestDispatcher.ERROR_STATUS_CODE,\n                               Integer.valueOf(statusCode));\n@@ -302,6 +302,7 @@ private void status(Request request, Response response) {\n             request.setAttribute(RequestDispatcher.ERROR_REQUEST_URI,\n                                  request.getRequestURI());\n             if (custom(request, response, errorPage)) {\n+                response.setErrorReported();\n                 try {\n                     response.finishResponse();\n                 } catch (ClientAbortException e) {\n@@ -426,6 +427,12 @@ private boolean custom(Request request, Response response,\n             RequestDispatcher rd =\n                 servletContext.getRequestDispatcher(errorPage.getLocation());\n \n+            if (rd == null) {\n+                container.getLogger().error(\n+                    sm.getString(\"standardHostValue.customStatusFailed\", errorPage.getLocation()));\n+                return false;\n+            }\n+\n             if (response.isCommitted()) {\n                 // Response is committed - including the error page is the\n                 // best we can do",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/482896eda00a43cac282a2f7735e0f0e7a7e3fcd/java/org/apache/catalina/core/StandardHostValve.java",
                "status": "modified",
                "changes": 9,
                "deletions": 1,
                "sha": "ee635c0d9b0f065a8099e7d850849750ce1cee35",
                "blob_url": "https://github.com/apache/tomcat80/blob/482896eda00a43cac282a2f7735e0f0e7a7e3fcd/java/org/apache/catalina/core/StandardHostValve.java",
                "filename": "java/org/apache/catalina/core/StandardHostValve.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/StandardHostValve.java?ref=482896eda00a43cac282a2f7735e0f0e7a7e3fcd"
            },
            {
                "patch": "@@ -148,6 +148,11 @@\n         Avoid UnsupportedOperationException when releasing an user-provided\n         URLStreamHandlerFactory. Patch provided by Cristian Talau. (violetagg)\n       </fix>\n+      <fix>\n+        <bug>58581</bug>: If a custom error page fails, fall back to the\n+        standard error page rather than throwing an NPE. Based on a patch by\n+        Huxing Zhang. (markt)\n+      </fix>\n       <fix>\n         <bug>58582</bug>: Combined realm should perform background processing\n         on its sub-realms. Based upon a patch provided by Aidan. (schultz)",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/482896eda00a43cac282a2f7735e0f0e7a7e3fcd/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "f35d06ba67349b8f2ee4c9e20de2804679c38532",
                "blob_url": "https://github.com/apache/tomcat80/blob/482896eda00a43cac282a2f7735e0f0e7a7e3fcd/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=482896eda00a43cac282a2f7735e0f0e7a7e3fcd"
            }
        ],
        "bug_id": "tomcat80_233",
        "parent": "https://github.com/apache/tomcat80/commit/a7884bdf779828052415258bbbf3becd62141f25",
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58581\nIf custom error page fails, fall back to standard error page rather than throwing an NPE.\nBased on a patch by Huxing Zhang.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1712975 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/04df311069738ac186f44ab619fe1921dc8a0794",
        "file": [
            {
                "patch": "@@ -34,6 +34,7 @@\n import javax.servlet.ServletContext;\n \n import org.apache.catalina.Context;\n+import org.apache.tomcat.util.scan.JarFactory;\n \n /**\n  * A variation of Java's JAR ServiceLoader that respects exclusion rules for\n@@ -112,7 +113,7 @@ public WebappServiceLoader(Context context) {\n                 if (base.endsWith(\"/\")) {\n                     url = new URL(base + configFile);\n                 } else {\n-                    url = new URL(\"jar:\" + base + \"!/\" + configFile);\n+                    url = JarFactory.getJarEntryURL(jarUrl, configFile);\n                 }\n                 try {\n                     parseConfigFile(applicationServicesFound, url);",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/04df311069738ac186f44ab619fe1921dc8a0794/java/org/apache/catalina/startup/WebappServiceLoader.java",
                "status": "modified",
                "changes": 3,
                "deletions": 1,
                "sha": "03811a4eb23c9823e84f67624011375f13642a0c",
                "blob_url": "https://github.com/apache/tomcat80/blob/04df311069738ac186f44ab619fe1921dc8a0794/java/org/apache/catalina/startup/WebappServiceLoader.java",
                "filename": "java/org/apache/catalina/startup/WebappServiceLoader.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/startup/WebappServiceLoader.java?ref=04df311069738ac186f44ab619fe1921dc8a0794"
            },
            {
                "patch": "@@ -45,6 +45,15 @@\n   issues do not \"pop up\" wrt. others).\n -->\n <section name=\"Tomcat 8.0.29 (markt)\" rtext=\"in development\">\n+  <subsection name=\"Catalina\">\n+    <changelog>\n+      <fix>\n+        <bug>58490</bug>: Fixed NPE thrown when scanning for\n+        <code>javax.servlet.ServletContainerInitializer</code> in case the web\n+        application is not extracted. (violetagg)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection name=\"Cluster\">\n     <changelog>\n       <fix>",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/04df311069738ac186f44ab619fe1921dc8a0794/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 9,
                "deletions": 0,
                "sha": "1ec09ba1cce0c942ba851eda1e94bed268fa8145",
                "blob_url": "https://github.com/apache/tomcat80/blob/04df311069738ac186f44ab619fe1921dc8a0794/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=04df311069738ac186f44ab619fe1921dc8a0794"
            }
        ],
        "bug_id": "tomcat80_234",
        "parent": "https://github.com/apache/tomcat80/commit/799454d1a9b09f23f0751d8927761069cba92aca",
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58490\nMerged revision 1710134 from tomcat/trunk:\nFix NPE when searching for SCIs in case the web app is not extracted \n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1710136 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/37f1edee6a1f0d2911ec5b7bdf53d10b919cb7dd",
        "file": [
            {
                "patch": "@@ -172,6 +172,10 @@ public URL getCodeBase() {\n \n         int pos = 0;\n         try (JarInputStreamWrapper jisw = getJarInputStreamWrapper()) {\n+            if (jisw == null) {\n+                // An error occurred, don't return corrupted content\n+                return null;\n+            }\n             while (pos < size) {\n                 int n = jisw.read(result, pos, size - pos);\n                 if (n < 0) {\n@@ -187,6 +191,8 @@ public URL getCodeBase() {\n                 getLog().debug(sm.getString(\"abstractResource.getContentFail\",\n                         getWebappPath()), ioe);\n             }\n+            // Don't return corrupted content\n+            return null;\n         }\n \n         return result;",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/37f1edee6a1f0d2911ec5b7bdf53d10b919cb7dd/java/org/apache/catalina/webresources/AbstractArchiveResource.java",
                "status": "modified",
                "changes": 6,
                "deletions": 0,
                "sha": "3365982550082cd12e8af63dbec5f51b16aa830c",
                "blob_url": "https://github.com/apache/tomcat80/blob/37f1edee6a1f0d2911ec5b7bdf53d10b919cb7dd/java/org/apache/catalina/webresources/AbstractArchiveResource.java",
                "filename": "java/org/apache/catalina/webresources/AbstractArchiveResource.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/webresources/AbstractArchiveResource.java?ref=37f1edee6a1f0d2911ec5b7bdf53d10b919cb7dd"
            }
        ],
        "bug_id": "tomcat80_235",
        "parent": "https://github.com/apache/tomcat80/commit/fd3599e408ad58ad0cde2f4ad0b21ead0ab5223d",
        "message": "Related to BZ57528: improve the algorithm to handle an exception or null return value in getContent and avoid NPE or returning corrupted data.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1657806 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/2ecb9892e7bcb9c2c3f9ff1baa0c1ac50fafc2b3",
        "file": [
            {
                "patch": "@@ -1276,11 +1276,17 @@ protected User getUser(DirContext context, String username,\n         // Use pattern or search for user entry\n         if (userPatternFormatArray != null && curUserPattern >= 0) {\n             user = getUserByPattern(context, username, credentials, attrIds, curUserPattern);\n+            if (containerLog.isDebugEnabled()) {\n+                containerLog.debug(\"Found user by pattern [\" + user + \"]\");\n+            }\n         } else {\n             user = getUserBySearch(context, username, attrIds);\n+            if (containerLog.isDebugEnabled()) {\n+                containerLog.debug(\"Found user by search [\" + user + \"]\");\n+            }\n         }\n \n-        if (userPassword == null && credentials != null) {\n+        if (userPassword == null && credentials != null && user != null) {\n             // The password is available. Insert it since it may be required for\n             // role searches.\n             return new User(user.getUserName(), user.getDN(), credentials,",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/2ecb9892e7bcb9c2c3f9ff1baa0c1ac50fafc2b3/java/org/apache/catalina/realm/JNDIRealm.java",
                "status": "modified",
                "changes": 8,
                "deletions": 1,
                "sha": "451f45a4c46b9d5e34dabac34d25499797878975",
                "blob_url": "https://github.com/apache/tomcat80/blob/2ecb9892e7bcb9c2c3f9ff1baa0c1ac50fafc2b3/java/org/apache/catalina/realm/JNDIRealm.java",
                "filename": "java/org/apache/catalina/realm/JNDIRealm.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/realm/JNDIRealm.java?ref=2ecb9892e7bcb9c2c3f9ff1baa0c1ac50fafc2b3"
            },
            {
                "patch": "@@ -50,6 +50,11 @@\n       <fix>\n         <bug>57187</bug>: Regression handling the special * URL. (remm)\n       </fix>\n+      <fix>\n+        <bug>57208</bug>: Prevent NPE in JNDI Realm when no results are found\n+        in a directory context for a user with specified user name. Based on\n+        a patch provided by Jason McIntosh. (violetagg)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/2ecb9892e7bcb9c2c3f9ff1baa0c1ac50fafc2b3/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "918d8864829d5072f424c86f7c9ffb9229e82956",
                "blob_url": "https://github.com/apache/tomcat80/blob/2ecb9892e7bcb9c2c3f9ff1baa0c1ac50fafc2b3/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=2ecb9892e7bcb9c2c3f9ff1baa0c1ac50fafc2b3"
            }
        ],
        "bug_id": "tomcat80_236",
        "parent": "https://github.com/apache/tomcat80/commit/21e65cb95d0fb66f21d748fc3d6d5284fbc63bb5",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57208\nMerged revision(s) 1639653 from tomcat/trunk:\nFixed NPE in JNDIRealm when \"getUserBySearch\" is performed, and no results are found. Based on a patch made by Jason McIntosh.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1639660 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/6ee4cde71608226a15768c8220261b406a80a657",
        "file": [
            {
                "patch": "@@ -24,7 +24,7 @@\n  */\n public interface PongMessage {\n     /**\n-     * Get the payload of the Pong message..\n+     * Get the payload of the Pong message.\n      *\n      * @return  The payload of the Pong message.\n      */",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/6ee4cde71608226a15768c8220261b406a80a657/java/javax/websocket/PongMessage.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "7e9e3b6a33a23dc1bee3f60245e8db59a0c2a73f",
                "blob_url": "https://github.com/apache/tomcat80/blob/6ee4cde71608226a15768c8220261b406a80a657/java/javax/websocket/PongMessage.java",
                "filename": "java/javax/websocket/PongMessage.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/javax/websocket/PongMessage.java?ref=6ee4cde71608226a15768c8220261b406a80a657"
            },
            {
                "patch": "@@ -68,6 +68,7 @@\n          * when the message has been sent.\n          * @param data          The text message to send\n          * @return A Future that signals when the message has been sent.\n+         * @throws IllegalArgumentException if {@code data} is {@code null}.\n          */\n         Future<Void> sendBinary(ByteBuffer data);\n \n@@ -77,11 +78,29 @@\n          * @param data          The text message to send\n          * @param completion    Used to signal to the client when the message has\n          *                      been sent\n+         * @throws IllegalArgumentException if {@code data} or {@code completion}\n+         *                      is {@code null}.\n          */\n         void sendBinary(ByteBuffer data, SendHandler completion);\n \n+        /**\n+         * Encodes object as a message and sends it asynchronously, using the\n+         * Future to signal to the client when the message has been sent.\n+         * @param obj           The object to be sent.\n+         * @return A Future that signals when the message has been sent.\n+         * @throws IllegalArgumentException if {@code obj} is {@code null}.\n+         */\n         Future<Void> sendObject(Object obj);\n \n+        /**\n+         * Encodes object as a message and sends it asynchronously, using the\n+         * SendHandler to signal to the client when the message has been sent.\n+         * @param obj           The object to be sent.\n+         * @param completion    Used to signal to the client when the message has\n+         *                      been sent\n+         * @throws IllegalArgumentException if {@code obj} or\n+         *                      {@code completion} is {@code null}.\n+         */\n         void sendObject(Object obj, SendHandler completion);\n \n     }\n@@ -91,6 +110,7 @@\n         /**\n          * Send the message, blocking until the message is sent.\n          * @param text  The text message to send.\n+         * @throws IllegalArgumentException if {@code text} is {@code null}.\n          * @throws IOException if an I/O error occurs during the sending of the\n          *                     message.\n          */\n@@ -99,6 +119,7 @@\n         /**\n          * Send the message, blocking until the message is sent.\n          * @param data  The binary message to send\n+         * @throws IllegalArgumentException if {@code data} is {@code null}.\n          * @throws IOException if an I/O error occurs during the sending of the\n          *                     message.\n          */\n@@ -112,6 +133,7 @@\n          * @param fragment  The partial message to send\n          * @param isLast    <code>true</code> if this is the last part of the\n          *                  message, otherwise <code>false</code>\n+         * @throws IllegalArgumentException if {@code fragment} is {@code null}.\n          * @throws IOException if an I/O error occurs during the sending of the\n          *                     message.\n          */\n@@ -125,6 +147,8 @@\n          * @param partialByte   The partial message to send\n          * @param isLast        <code>true</code> if this is the last part of the\n          *                      message, otherwise <code>false</code>\n+         * @throws IllegalArgumentException if {@code partialByte} is\n+         *                     {@code null}.\n          * @throws IOException if an I/O error occurs during the sending of the\n          *                     message.\n          */\n@@ -134,7 +158,16 @@\n \n         Writer getSendWriter() throws IOException;\n \n-        void sendObject(Object o) throws IOException, EncodeException;\n+        /**\n+         * Encodes object as a message and sends it to the remote endpoint.\n+         * @param data  The object to be sent.\n+         * @throws EncodeException if there was a problem encoding the\n+         *                     {@code data} object as a websocket message.\n+         * @throws IllegalArgumentException if {@code data} is {@code null}.\n+         * @throws IOException if an I/O error occurs during the sending of the\n+         *                     message.\n+         */\n+        void sendObject(Object data) throws IOException, EncodeException;\n \n     }\n     /**",
                "additions": 34,
                "raw_url": "https://github.com/apache/tomcat80/raw/6ee4cde71608226a15768c8220261b406a80a657/java/javax/websocket/RemoteEndpoint.java",
                "status": "modified",
                "changes": 35,
                "deletions": 1,
                "sha": "19c7a10028bb5673bb7e1da28d3b7238a2bb5c40",
                "blob_url": "https://github.com/apache/tomcat80/blob/6ee4cde71608226a15768c8220261b406a80a657/java/javax/websocket/RemoteEndpoint.java",
                "filename": "java/javax/websocket/RemoteEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/javax/websocket/RemoteEndpoint.java?ref=6ee4cde71608226a15768c8220261b406a80a657"
            },
            {
                "patch": "@@ -528,6 +528,13 @@ public void sendObject(Object obj) throws IOException {\n     @SuppressWarnings({\"unchecked\", \"rawtypes\"})\n     public void sendObjectByCompletion(Object obj, SendHandler completion) {\n \n+        if (obj == null) {\n+            throw new IllegalArgumentException(sm.getString(\"wsRemoteEndpoint.nullData\"));\n+        }\n+        if (completion == null) {\n+            throw new IllegalArgumentException(sm.getString(\"wsRemoteEndpoint.nullHandler\"));\n+        }\n+\n         if (Util.isPrimitive(obj.getClass())) {\n             String msg = obj.toString();\n             sendStringByCompletion(msg, completion);",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/6ee4cde71608226a15768c8220261b406a80a657/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "status": "modified",
                "changes": 7,
                "deletions": 0,
                "sha": "e053bc09d5cd0c054ca5051d97bcb5dd02c2b370",
                "blob_url": "https://github.com/apache/tomcat80/blob/6ee4cde71608226a15768c8220261b406a80a657/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "filename": "java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java?ref=6ee4cde71608226a15768c8220261b406a80a657"
            },
            {
                "patch": "@@ -213,7 +213,7 @@\n         Fix client subprotocol handling. (remm)\n       </fix>\n       <fix>\n-        Add null checks for arguments in remote endpoint. (remm)\n+        Add null checks for arguments in remote endpoint. (remm/kkolinko)\n       </fix>\n     </changelog>\n   </subsection>",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/6ee4cde71608226a15768c8220261b406a80a657/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "2bd34d763e5a881a8ffc152df5c79a9d2ea9291c",
                "blob_url": "https://github.com/apache/tomcat80/blob/6ee4cde71608226a15768c8220261b406a80a657/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=6ee4cde71608226a15768c8220261b406a80a657"
            }
        ],
        "bug_id": "tomcat80_237",
        "parent": "https://github.com/apache/tomcat80/commit/accae113be60d834b47aeb155d39894fbc7ef624",
        "message": "Further improve processing of null arguments in remote endpoint (followup to r1632625):\n1) Document IllegalArgumentException in javadoc\n2) Handle null arguments in sendObject() methods to throw IllegalArgumentException instead of NPE.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1632965 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/0d017092c42e18dcab7dccddd90cd42db973edc6",
        "file": [
            {
                "patch": "@@ -49,7 +49,6 @@\n      * @throws ClassFormatException\n      */\n     ConstantPool(DataInputStream file) throws IOException, ClassFormatException {\n-        byte tag;\n         constant_pool_count = file.readUnsignedShort();\n         constant_pool = new Constant[constant_pool_count];\n         /* constant_pool[0] is unused by the compiler and may be used freely\n@@ -64,9 +63,11 @@\n              *\n              * Thus we have to increment the index counter.\n              */\n-            tag = constant_pool[i].getTag();\n-            if ((tag == Constants.CONSTANT_Double) || (tag == Constants.CONSTANT_Long)) {\n-                i++;\n+            if (constant_pool[i] != null) {\n+                byte tag = constant_pool[i].getTag();\n+                if ((tag == Constants.CONSTANT_Double) || (tag == Constants.CONSTANT_Long)) {\n+                    i++;\n+                }\n             }\n         }\n     }",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/0d017092c42e18dcab7dccddd90cd42db973edc6/java/org/apache/tomcat/util/bcel/classfile/ConstantPool.java",
                "status": "modified",
                "changes": 9,
                "deletions": 4,
                "sha": "28b337822247a68240225f1989961fb854d80e6b",
                "blob_url": "https://github.com/apache/tomcat80/blob/0d017092c42e18dcab7dccddd90cd42db973edc6/java/org/apache/tomcat/util/bcel/classfile/ConstantPool.java",
                "filename": "java/org/apache/tomcat/util/bcel/classfile/ConstantPool.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/bcel/classfile/ConstantPool.java?ref=0d017092c42e18dcab7dccddd90cd42db973edc6"
            }
        ],
        "bug_id": "tomcat80_238",
        "parent": "https://github.com/apache/tomcat80/commit/8cfe2f30d48c9793160324b9686dce4d3dd195a2",
        "message": "Some constant types are never used so they can be swallowed which means returning null. That could trigger an NPE so make sure it doesn't.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1624139 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/78392db6f5b6cc1ae57420b4fcbed73d861811a8",
        "file": [
            {
                "patch": "@@ -33,6 +33,7 @@\n import org.apache.catalina.Loader;\n import org.apache.catalina.Session;\n import org.apache.catalina.util.CustomObjectInputStream;\n+import org.apache.juli.logging.Log;\n \n /**\n  * Concrete implementation of the <b>Store</b> interface that utilizes\n@@ -217,9 +218,12 @@ public Session load(String id) throws ClassNotFoundException, IOException {\n         if (!file.exists()) {\n             return null;\n         }\n-        if (manager.getContext().getLogger().isDebugEnabled()) {\n-            manager.getContext().getLogger().debug(sm.getString(getStoreName()+\".loading\",\n-                             id, file.getAbsolutePath()));\n+\n+        Context context = getManager().getContext();\n+        Log contextLog = context.getLogger();\n+\n+        if (contextLog.isDebugEnabled()) {\n+            contextLog.debug(sm.getString(getStoreName()+\".loading\", id, file.getAbsolutePath()));\n         }\n \n         ObjectInputStream ois = null;\n@@ -228,10 +232,7 @@ public Session load(String id) throws ClassNotFoundException, IOException {\n         ClassLoader oldThreadContextCL = Thread.currentThread().getContextClassLoader();\n         try (FileInputStream fis = new FileInputStream(file.getAbsolutePath());\n                 BufferedInputStream bis = new BufferedInputStream(fis)) {\n-            Context context = manager.getContext();\n-            if (context != null) {\n-                loader = context.getLoader();\n-            }\n+            loader = context.getLoader();\n             if (loader != null) {\n                 classLoader = loader.getClassLoader();\n             }\n@@ -247,8 +248,8 @@ public Session load(String id) throws ClassNotFoundException, IOException {\n             session.setManager(manager);\n             return session;\n         } catch (FileNotFoundException e) {\n-            if (manager.getContext().getLogger().isDebugEnabled()) {\n-                manager.getContext().getLogger().debug(\"No persisted data file found\");\n+            if (contextLog.isDebugEnabled()) {\n+                contextLog.debug(\"No persisted data file found\");\n             }\n             return null;\n         } finally {",
                "additions": 10,
                "raw_url": "https://github.com/apache/tomcat80/raw/78392db6f5b6cc1ae57420b4fcbed73d861811a8/java/org/apache/catalina/session/FileStore.java",
                "status": "modified",
                "changes": 19,
                "deletions": 9,
                "sha": "1146d0c3c44fc5266db44f9afea6fc5641aefd1f",
                "blob_url": "https://github.com/apache/tomcat80/blob/78392db6f5b6cc1ae57420b4fcbed73d861811a8/java/org/apache/catalina/session/FileStore.java",
                "filename": "java/org/apache/catalina/session/FileStore.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/session/FileStore.java?ref=78392db6f5b6cc1ae57420b4fcbed73d861811a8"
            },
            {
                "patch": "@@ -43,6 +43,7 @@\n import org.apache.catalina.Loader;\n import org.apache.catalina.Session;\n import org.apache.catalina.util.CustomObjectInputStream;\n+import org.apache.juli.logging.Log;\n import org.apache.tomcat.util.ExceptionUtils;\n \n /**\n@@ -595,7 +596,8 @@ public Session load(String id) throws ClassNotFoundException, IOException {\n         ClassLoader classLoader = null;\n         ObjectInputStream ois = null;\n         BufferedInputStream bis = null;\n-        org.apache.catalina.Context context = manager.getContext();\n+        org.apache.catalina.Context context = getManager().getContext();\n+        Log contextLog = context.getLogger();\n \n         synchronized (this) {\n             int numberOfTries = 2;\n@@ -620,10 +622,7 @@ public Session load(String id) throws ClassNotFoundException, IOException {\n                     try (ResultSet rst = preparedLoadSql.executeQuery()) {\n                         if (rst.next()) {\n                             bis = new BufferedInputStream(rst.getBinaryStream(2));\n-\n-                            if (context != null) {\n-                                loader = context.getLoader();\n-                            }\n+                            loader = context.getLoader();\n                             if (loader != null) {\n                                 classLoader = loader.getClassLoader();\n                             }\n@@ -634,22 +633,22 @@ public Session load(String id) throws ClassNotFoundException, IOException {\n                             }\n                             ois = new CustomObjectInputStream(bis, classLoader);\n \n-                            if (manager.getContext().getLogger().isDebugEnabled()) {\n-                                manager.getContext().getLogger().debug(sm.getString(getStoreName() + \".loading\",\n-                                        id, sessionTable));\n+                            if (contextLog.isDebugEnabled()) {\n+                                contextLog.debug(\n+                                        sm.getString(getStoreName() + \".loading\", id, sessionTable));\n                             }\n \n                             _session = (StandardSession) manager.createEmptySession();\n                             _session.readObjectData(ois);\n                             _session.setManager(manager);\n-                          } else if (manager.getContext().getLogger().isDebugEnabled()) {\n-                            manager.getContext().getLogger().debug(getStoreName() + \": No persisted data object found\");\n+                        } else if (context.getLogger().isDebugEnabled()) {\n+                            contextLog.debug(getStoreName() + \": No persisted data object found\");\n                         }\n                         // Break out after the finally block\n                         numberOfTries = 0;\n                     }\n                 } catch (SQLException e) {\n-                    manager.getContext().getLogger().error(sm.getString(getStoreName() + \".SQLException\", e));\n+                    contextLog.error(sm.getString(getStoreName() + \".SQLException\", e));\n                     if (dbConnection != null)\n                         close(dbConnection);\n                 } finally {",
                "additions": 10,
                "raw_url": "https://github.com/apache/tomcat80/raw/78392db6f5b6cc1ae57420b4fcbed73d861811a8/java/org/apache/catalina/session/JDBCStore.java",
                "status": "modified",
                "changes": 21,
                "deletions": 11,
                "sha": "8ab2cb1a8e538e73e608006fc4d6018fd5db1ed7",
                "blob_url": "https://github.com/apache/tomcat80/blob/78392db6f5b6cc1ae57420b4fcbed73d861811a8/java/org/apache/catalina/session/JDBCStore.java",
                "filename": "java/org/apache/catalina/session/JDBCStore.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/session/JDBCStore.java?ref=78392db6f5b6cc1ae57420b4fcbed73d861811a8"
            }
        ],
        "bug_id": "tomcat80_239",
        "parent": "https://github.com/apache/tomcat80/commit/a3a777bfa1bdf495cae6cad0e2aa73a1101b7480",
        "message": "Store.load() implementations assume (in places) that getManager().getContext() always returns a non-null and we haven't had reports of NPEs so make the assumption consistently throughout the method.\nAdd a local reference to the Context's logger to shorten some of the logging lines\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1725974 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/576432721d795d9cc1d0e32ce2dbfdc3228f492d",
        "file": [
            {
                "patch": "@@ -260,7 +260,9 @@ void startMessage(byte opCode, ByteBuffer payload, boolean last,\n         messageParts.add(new MessagePart(opCode, payload, last,\n                 new EndMessageHandler(this, handler)));\n \n-        messageParts = transformation.sendMessagePart(messageParts);\n+        if (transformation != null) {\n+            messageParts = transformation.sendMessagePart(messageParts);\n+        }\n \n         MessagePart mp = messageParts.remove(0);\n ",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/576432721d795d9cc1d0e32ce2dbfdc3228f492d/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "status": "modified",
                "changes": 4,
                "deletions": 1,
                "sha": "6d05b28ebe54370a7454f3fef48425de71b51bf8",
                "blob_url": "https://github.com/apache/tomcat80/blob/576432721d795d9cc1d0e32ce2dbfdc3228f492d/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "filename": "java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java?ref=576432721d795d9cc1d0e32ce2dbfdc3228f492d"
            }
        ],
        "bug_id": "tomcat80_240",
        "parent": "https://github.com/apache/tomcat80/commit/e02a715255fe28cbd0acd24985365eceb5fdc87c",
        "message": "Add back the NPE check for now since the testsuite confirms it with all connectors.\nhttp://ci.apache.org/builders/tomcat-trunk/builds/224/steps/compile_1/logs/stdio\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1606271 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/00f225772e7b9a0397ee2116478ff4ee10294787",
        "file": [
            {
                "patch": "@@ -39,7 +39,8 @@\n \n     protected final void checkPath(String path) {\n         if (path == null || path.length() == 0 || path.charAt(0) != '/') {\n-            throw new IllegalArgumentException();\n+            throw new IllegalArgumentException(\n+                    sm.getString(\"abstractResourceSet.checkPath\", path));\n         }\n     }\n ",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/00f225772e7b9a0397ee2116478ff4ee10294787/java/org/apache/catalina/webresources/AbstractResourceSet.java",
                "status": "modified",
                "changes": 3,
                "deletions": 1,
                "sha": "05e14eb705d13530dda9760a17448c25cfa7eb14",
                "blob_url": "https://github.com/apache/tomcat80/blob/00f225772e7b9a0397ee2116478ff4ee10294787/java/org/apache/catalina/webresources/AbstractResourceSet.java",
                "filename": "java/org/apache/catalina/webresources/AbstractResourceSet.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/webresources/AbstractResourceSet.java?ref=00f225772e7b9a0397ee2116478ff4ee10294787"
            },
            {
                "patch": "@@ -145,7 +145,7 @@ protected void backgroundProcess() {\n \n     private boolean noCache(String path) {\n         // Don't cache resources used by the class loader (it has its own cache)\n-        if (path == null || path.startsWith(\"/WEB-INF/classes\") ||\n+        if (path.startsWith(\"/WEB-INF/classes\") ||\n                 path.startsWith(\"/WEB-INF/lib\")) {\n             return true;\n         }",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/00f225772e7b9a0397ee2116478ff4ee10294787/java/org/apache/catalina/webresources/Cache.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "f5abdbf0c3af67a7e08b393b9f91a333cd3b1adf",
                "blob_url": "https://github.com/apache/tomcat80/blob/00f225772e7b9a0397ee2116478ff4ee10294787/java/org/apache/catalina/webresources/Cache.java",
                "filename": "java/org/apache/catalina/webresources/Cache.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/webresources/Cache.java?ref=00f225772e7b9a0397ee2116478ff4ee10294787"
            },
            {
                "patch": "@@ -14,9 +14,12 @@\n # limitations under the License.\n \n abstractArchiveResourceSet.setReadOnlyFalse=Archive based WebResourceSets such as those based on JARs are hard-coded to be read-only and may not be configured to be read-write\n+\n abstractResource.getContentFail=Unable to return [{0}] as a byte array\n abstractResource.getContentTooLarge=Unable to return [{0}] as a byte array since the resource is [{1}] bytes in size which is larger than the maximum size of a byte array\n \n+abstractResourceSet.checkPath=The requested path [{0}] is not valid. It must begin with \"/\".\n+\n cache.addFail=Unable to add the resource at [{0}] to the cache because there was insufficient free space available after evicting expired cache entries - consider increasing the maximum size of the cache\n cache.backgroundEvictFail=The background cache eviction process was unable to free [{0}] percent of the cache for Context [{1}] - consider increasing the maximum size of the cache. After eviction approximately [{2}] KB of data remained in the cache.\n cache.objectMaxSizeTooBig=The value of [{0}]kB for objectMaxSize is larger than the limit of maxSize/20 so has been reduced to [{1}]kB\n@@ -37,6 +40,7 @@ standardRoot.createInvalidFile=Unable to create WebResourceSet from [{0}]\n standardRoot.createNoFileResourceSet=The FileResourceSet feature has not yet been implemented\n standardRoot.createUnknownType=Unable to create WebResourceSet of unknown type [{0}]\n standardRoot.invalidPath=The resource path [{0}] is not valid\n+standardRoot.invalidPathNormal=The resource path [{0}] has been normalized to [{1}] which is not valid\n standardRoot.lockedFile=The web application [{0}] failed to close the file [{1}] opened via the following stack trace\n standardRoot.noContext=A Context has not been configured for this WebResourceRoot\n standardRoot.startInvalidMain=The main resource set specified [{0}] is not valid",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/00f225772e7b9a0397ee2116478ff4ee10294787/java/org/apache/catalina/webresources/LocalStrings.properties",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "770b5e83125334114b9313d762a6593d2d3de2e6",
                "blob_url": "https://github.com/apache/tomcat80/blob/00f225772e7b9a0397ee2116478ff4ee10294787/java/org/apache/catalina/webresources/LocalStrings.properties",
                "filename": "java/org/apache/catalina/webresources/LocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/webresources/LocalStrings.properties?ref=00f225772e7b9a0397ee2116478ff4ee10294787"
            },
            {
                "patch": "@@ -237,7 +237,14 @@ private String validate(String path) {\n             throw new IllegalArgumentException(\n                     sm.getString(\"standardRoot.invalidPath\", path));\n         }\n-        return RequestUtil.normalize(path);\n+\n+        String result = RequestUtil.normalize(path);\n+        if (result == null || result.length() == 0 || !result.startsWith(\"/\")) {\n+            throw new IllegalArgumentException(\n+                    sm.getString(\"standardRoot.invalidPathNormal\", path, result));\n+        }\n+\n+        return result;\n     }\n \n     protected final WebResource getResourceInternal(String path,",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/00f225772e7b9a0397ee2116478ff4ee10294787/java/org/apache/catalina/webresources/StandardRoot.java",
                "status": "modified",
                "changes": 9,
                "deletions": 1,
                "sha": "0020ddb67e88fe8386547ff6c05d260b80743495",
                "blob_url": "https://github.com/apache/tomcat80/blob/00f225772e7b9a0397ee2116478ff4ee10294787/java/org/apache/catalina/webresources/StandardRoot.java",
                "filename": "java/org/apache/catalina/webresources/StandardRoot.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/webresources/StandardRoot.java?ref=00f225772e7b9a0397ee2116478ff4ee10294787"
            }
        ],
        "bug_id": "tomcat80_241",
        "parent": "https://github.com/apache/tomcat80/commit/9531d972240b60a336d3a86e738161623943b042",
        "message": "Better way to avoid NPE in resource cache - don't let the request get that far when we know we are going to fail it anyway.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1573370 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/3f7992b17576e3f93ac931e9d4524d7e3e8f9945",
        "file": [
            {
                "patch": "@@ -121,14 +121,19 @@ public TaglibXml getTaglibXml(TldResourcePath tldResourcePath) throws JasperExce\n         result[0] = -1;\n         result[1] = -1;\n         try {\n-            URL url = servletContext.getResource(tldResourcePath.getWebappPath());\n-            URLConnection conn = url.openConnection();\n-            result[0] = conn.getLastModified();\n-            if (\"file\".equals(url.getProtocol())) {\n-                // Reading the last modified time opens an input stream so we\n-                // need to make sure it is closed again otherwise the TLD file\n-                // will be locked until GC runs.\n-                conn.getInputStream().close();\n+            String webappPath = tldResourcePath.getWebappPath();\n+            if (webappPath != null) {\n+                // webappPath will be null for JARs containing TLDs that are on\n+                // the class path but not part of the web application\n+                URL url = servletContext.getResource(tldResourcePath.getWebappPath());\n+                URLConnection conn = url.openConnection();\n+                result[0] = conn.getLastModified();\n+                if (\"file\".equals(url.getProtocol())) {\n+                    // Reading the last modified time opens an input stream so we\n+                    // need to make sure it is closed again otherwise the TLD file\n+                    // will be locked until GC runs.\n+                    conn.getInputStream().close();\n+                }\n             }\n             Jar jar = tldResourcePath.getJar();\n             if (jar != null) {",
                "additions": 13,
                "raw_url": "https://github.com/apache/tomcat80/raw/3f7992b17576e3f93ac931e9d4524d7e3e8f9945/java/org/apache/jasper/compiler/TldCache.java",
                "status": "modified",
                "changes": 21,
                "deletions": 8,
                "sha": "cfa046518bdf5ed8d351de7c9062524803930ae4",
                "blob_url": "https://github.com/apache/tomcat80/blob/3f7992b17576e3f93ac931e9d4524d7e3e8f9945/java/org/apache/jasper/compiler/TldCache.java",
                "filename": "java/org/apache/jasper/compiler/TldCache.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/TldCache.java?ref=3f7992b17576e3f93ac931e9d4524d7e3e8f9945"
            }
        ],
        "bug_id": "tomcat80_242",
        "parent": "https://github.com/apache/tomcat80/commit/c4804727bb387eda2dd0fa2be3f70278949363f2",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55995\nFix NPE when using JspC and there are JARs containing TLDs on the classpath\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1558019 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/856b28186141781e36fbdbe59112a56a88e113d6",
        "file": [
            {
                "patch": "@@ -274,6 +274,15 @@\n          Example values are <code>SELECT 1</code>(mysql), <code>select 1 from dual</code>(oracle), <code>SELECT 1</code>(MS Sql Server)\n       </p>\n     </attribute>\n+    \n+    <attribute name=\"validationQueryTimeout\" required=\"false\">\n+      <p>(int) The timeout in seconds before a connection validation queries fail.  This works by calling \n+         <code>java.sql.Statement.setQueryTimeout(seconds)</code> on the statement that executes the <code>validationQuery</code>.\n+         The pool itself doesn't timeout the query, it is still up to the JDBC driver to enforce query timeouts. \n+         A value less than or equal to zero will disable this feature. \n+         The default value is <code>-1</code>.\n+      </p>\n+    </attribute>\n \n     <attribute name=\"validatorClassName\" required=\"false\">\n       <p>(String) The name of a class which implements the",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/doc/jdbc-pool.xml",
                "status": "modified",
                "changes": 9,
                "deletions": 0,
                "sha": "81eecf25d44ef6f2c942da19eddd330ac26e8d99",
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/doc/jdbc-pool.xml",
                "filename": "modules/jdbc-pool/doc/jdbc-pool.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/doc/jdbc-pool.xml?ref=856b28186141781e36fbdbe59112a56a88e113d6"
            },
            {
                "patch": "@@ -712,7 +712,7 @@ protected PooledConnection createConnection(long now, PooledConnection notUsed,\n             } else {\n                 //validation failed, make sure we disconnect\n                 //and clean up\n-                error =true;\n+                throw new SQLException(\"Validation Query Failed, enable logValidationErrors for more details.\");\n             } //end if\n         } catch (Exception e) {\n             error = true;\n@@ -732,7 +732,6 @@ protected PooledConnection createConnection(long now, PooledConnection notUsed,\n             }\n             con.unlock();\n         }//catch\n-        return null;\n     }\n \n     /**",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java",
                "status": "modified",
                "changes": 3,
                "deletions": 2,
                "sha": "0b2dcdb4b323466be340ff9f678b30c5c7ea32f4",
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java",
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java?ref=856b28186141781e36fbdbe59112a56a88e113d6"
            },
            {
                "patch": "@@ -80,6 +80,7 @@\n     protected static final String PROP_TESTWHILEIDLE = \"testWhileIdle\";\n     protected static final String PROP_TESTONCONNECT = \"testOnConnect\";\n     protected static final String PROP_VALIDATIONQUERY = \"validationQuery\";\n+    protected static final String PROP_VALIDATIONQUERY_TIMEOUT = \"validationQueryTimeout\";\n     protected static final String PROP_VALIDATOR_CLASS_NAME = \"validatorClassName\";\n \n     protected static final String PROP_NUMTESTSPEREVICTIONRUN = \"numTestsPerEvictionRun\";\n@@ -151,6 +152,7 @@\n         PROP_URL,\n         PROP_USERNAME,\n         PROP_VALIDATIONQUERY,\n+        PROP_VALIDATIONQUERY_TIMEOUT,\n         PROP_VALIDATOR_CLASS_NAME,\n         PROP_VALIDATIONINTERVAL,\n         PROP_ACCESSTOUNDERLYINGCONNECTIONALLOWED,\n@@ -369,6 +371,11 @@ public static PoolConfiguration parsePoolProperties(Properties properties) {\n         if (value != null) {\n             poolProperties.setValidationQuery(value);\n         }\n+        \n+        value = properties.getProperty(PROP_VALIDATIONQUERY_TIMEOUT);\n+        if (value != null) {\n+            poolProperties.setValidationQueryTimeout(Integer.parseInt(value));\n+        }\n \n         value = properties.getProperty(PROP_VALIDATOR_CLASS_NAME);\n         if (value != null) {",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java",
                "status": "modified",
                "changes": 7,
                "deletions": 0,
                "sha": "6d204ee7d6af4397485488620d583a96c57f432a",
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java",
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java?ref=856b28186141781e36fbdbe59112a56a88e113d6"
            },
            {
                "patch": "@@ -452,6 +452,15 @@ public void setValidationQuery(String validationQuery) {\n     public void setValidatorClassName(String className) {\n         this.poolProperties.setValidatorClassName(className);\n     }\n+    \n+    /**\n+     * {@inheritDoc}\n+     */\n+    \n+    @Override\n+    public void setValidationQueryTimeout(int validationQueryTimeout) {\n+        this.poolProperties.setValidationQueryTimeout(validationQueryTimeout);\n+    }\n \n     /**\n      * {@inheritDoc}\n@@ -925,6 +934,15 @@ public String getValidationQuery() {\n         return getPoolProperties().getValidationQuery();\n     }\n \n+    /**\n+     * {@inheritDoc}\n+     */\n+    \n+    @Override\n+    public int getValidationQueryTimeout() {\n+        return getPoolProperties().getValidationQueryTimeout();\n+    }\n+    \n     /**\n      * {@inheritDoc}\n      */",
                "additions": 18,
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java",
                "status": "modified",
                "changes": 18,
                "deletions": 0,
                "sha": "3e3af9ada851b61fda4329a3aa10621e1e1de22d",
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java",
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java?ref=856b28186141781e36fbdbe59112a56a88e113d6"
            },
            {
                "patch": "@@ -523,6 +523,19 @@\n      */\n     public void setValidationQuery(String validationQuery);\n \n+    /**\n+     * The timeout in seconds before a connection validation queries fail.\n+     * A value less than or equal to zero will disable this feature.  Defaults to -1. \n+     * @return the timeout value in seconds \n+     */\n+    public int getValidationQueryTimeout();\n+    \n+    /**\n+     * The timeout in seconds before a connection validation queries fail.\n+     * A value less than or equal to zero will disable this feature.  Defaults to -1. \n+     */\n+    public void setValidationQueryTimeout(int validationQueryTimeout);\n+    \n     /**\n      * Return the name of the optional validator class - may be null.\n      *",
                "additions": 13,
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java",
                "status": "modified",
                "changes": 13,
                "deletions": 0,
                "sha": "bc854cc7440da9a03bcc6f98cb978384c3a16caa",
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java",
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java?ref=856b28186141781e36fbdbe59112a56a88e113d6"
            },
            {
                "patch": "@@ -57,6 +57,7 @@\n     private volatile int minIdle = initialSize;\n     private volatile int maxWait = 30000;\n     private volatile String validationQuery;\n+    private volatile int validationQueryTimeout = -1;\n     private volatile String validatorClassName;\n     private volatile Validator validator;\n     private volatile boolean testOnBorrow = false;\n@@ -379,6 +380,22 @@ public String getValidationQuery() {\n         return validationQuery;\n     }\n \n+    /**\n+     * {@inheritDoc}\n+     */\n+    @Override\n+    public int getValidationQueryTimeout() {\n+        return validationQueryTimeout;\n+    }\n+    \n+    /**\n+     * {@inheritDoc}\n+     */\n+    @Override\n+    public void setValidationQueryTimeout(int validationQueryTimeout) {\n+        this.validationQueryTimeout = validationQueryTimeout;\n+    }\n+    \n     /**\n      * {@inheritDoc}\n      */",
                "additions": 17,
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java",
                "status": "modified",
                "changes": 17,
                "deletions": 0,
                "sha": "136a2c5fdcfbdd9a019036d93727e3164d70b686",
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java",
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java?ref=856b28186141781e36fbdbe59112a56a88e113d6"
            },
            {
                "patch": "@@ -451,6 +451,12 @@ public boolean validate(int validateAction,String sql) {\n         Statement stmt = null;\n         try {\n             stmt = connection.createStatement();\n+            \n+            int validationQueryTimeout = poolProperties.getValidationQueryTimeout();\n+            if (validationQueryTimeout > 0) {\n+                stmt.setQueryTimeout(validationQueryTimeout);\n+            }\n+            \n             stmt.execute(query);\n             stmt.close();\n             this.lastValidated = now;",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java",
                "status": "modified",
                "changes": 6,
                "deletions": 0,
                "sha": "02a986896348af8594d1038f89d43f9c3d907c59",
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java",
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java?ref=856b28186141781e36fbdbe59112a56a88e113d6"
            },
            {
                "patch": "@@ -310,6 +310,11 @@ public long getValidationInterval() {\n     public String getValidationQuery() {\n         return getPoolProperties().getValidationQuery();\n     }\n+    \n+    @Override\n+    public int getValidationQueryTimeout() {\n+        return getPoolProperties().getValidationQueryTimeout();\n+    }\n \n     /**\n      * {@inheritDoc}\n@@ -664,6 +669,11 @@ public void setValidationQuery(String validationQuery) {\n         getPoolProperties().setValidationQuery(validationQuery);\n     }\n \n+    @Override\n+    public void setValidationQueryTimeout(int validationQueryTimeout) {\n+        getPoolProperties().setValidationQueryTimeout(validationQueryTimeout);\n+    }\n+    \n     /**\n      * {@inheritDoc}\n      */",
                "additions": 10,
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java",
                "status": "modified",
                "changes": 10,
                "deletions": 0,
                "sha": "66013d9a30b8dd9bab9343151cdc183618c663c5",
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java",
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java?ref=856b28186141781e36fbdbe59112a56a88e113d6"
            },
            {
                "patch": "@@ -125,6 +125,11 @@\n            description=\"The query to run during validation\"\n                   type=\"java.lang.String\"\n              writeable=\"false\"/>\n+             \n+    <attribute    name=\"validationQueryTimeout\"\n+           description=\"The timeout in seconds before a connection validation queries fail\"\n+                  type=\"java.lang.Integer\"\n+             writeable=\"false\" />\n \n     <attribute    name=\"testOnBorrow\"\n            description=\"True if validation happens when a connection is requested\"",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/mbeans-descriptors.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "0e6682ebdd6085491af58b824ec4fccb37d994c2",
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/mbeans-descriptors.xml",
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/mbeans-descriptors.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/mbeans-descriptors.xml?ref=856b28186141781e36fbdbe59112a56a88e113d6"
            },
            {
                "patch": "@@ -0,0 +1,249 @@\n+package org.apache.tomcat.jdbc.test;\n+\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.DriverPropertyInfo;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.sql.SQLFeatureNotSupportedException;\n+import java.sql.Statement;\n+import java.util.Properties;\n+import java.util.logging.Logger;\n+\n+import junit.framework.Assert;\n+\n+import org.apache.tomcat.jdbc.pool.interceptor.QueryTimeoutInterceptor;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+public class TestValidationQueryTimeout extends DefaultTestCase {\n+    \n+    private static int TIMEOUT = 10;\n+    private static boolean isTimeoutSet;\n+    private static final String longQuery = \"select * from test as A, test as B, test as C, test as D, test as E\";\n+    \n+    @Before\n+    public void setUp() throws SQLException {\n+        DriverManager.registerDriver(new MockDriver());\n+        \n+        // use our mock driver\n+        this.datasource.setDriverClassName(MockDriver.class.getName());\n+        this.datasource.setUrl(MockDriver.url);\n+        \n+        // Required to trigger validation query's execution \n+        this.datasource.setInitialSize(1);\n+        this.datasource.setTestOnBorrow(true);\n+        this.datasource.setValidationInterval(-1);\n+        this.datasource.setValidationQuery(\"SELECT 1\");\n+        this.datasource.setValidationQueryTimeout(TIMEOUT);\n+        \n+        TIMEOUT = 10;\n+        isTimeoutSet = false;\n+    }\n+    \n+    @After\n+    public void tearDown() throws SQLException {\n+        DriverManager.deregisterDriver(new MockDriver());\n+    }\n+    \n+    @Test\n+    public void testValidationQueryTimeoutEnabled() throws Exception {\n+        // because testOnBorrow is true, this triggers the validation query\n+        this.datasource.getConnection();\n+        Assert.assertTrue(isTimeoutSet);\n+    }\n+    \n+    @Test\n+    public void testValidationQueryTimeoutDisabled() throws Exception {\n+        this.datasource.setValidationQueryTimeout(-1);\n+        \n+        // because testOnBorrow is true, this triggers the validation query\n+        this.datasource.getConnection();\n+        Assert.assertFalse(isTimeoutSet);\n+    }\n+    \n+    @Test\n+    public void testValidationQueryTimeoutWithQueryTimeoutInterceptor() throws Exception {\n+        int interceptorTimeout = 30;\n+        this.datasource.setJdbcInterceptors(\n+                            QueryTimeoutInterceptor.class.getName()+\n+                            \"(queryTimeout=\"+ interceptorTimeout +\")\");\n+        \n+        // because testOnBorrow is true, this triggers the validation query\n+        Connection con = this.datasource.getConnection();\n+        Assert.assertTrue(isTimeoutSet);\n+        \n+        // increase the expected timeout to 30, which is what we set for the interceptor\n+        TIMEOUT = 30;\n+        \n+        // now create a statement, make sure the query timeout is set by the interceptor\n+        Statement st = con.createStatement();\n+        Assert.assertEquals(interceptorTimeout, st.getQueryTimeout());\n+        st.close();\n+        st = con.prepareStatement(\"\");\n+        Assert.assertEquals(interceptorTimeout, st.getQueryTimeout());\n+        st.close();\n+        st = con.prepareCall(\"\");\n+        Assert.assertEquals(interceptorTimeout, st.getQueryTimeout());\n+        st.close();\n+        con.close();\n+        \n+        // pull another connection and check it\n+        TIMEOUT = 10;\n+        isTimeoutSet = false;\n+        this.datasource.getConnection();\n+        Assert.assertTrue(isTimeoutSet);\n+    }\n+    \n+    // this test depends on the execution time of the validation query\n+    //   specifically, it needs to run for longer than 1 second to pass\n+    //   if this fails\n+    @Test(expected=SQLException.class) \n+    public void testValidationQueryTimeoutOnConnection() throws Exception {\n+        // use our mock driver\n+        this.datasource.setDriverClassName(\"org.h2.Driver\");\n+        this.datasource.setUrl(\"jdbc:h2:~/.h2/test;QUERY_TIMEOUT=0;DB_CLOSE_ON_EXIT=FALSE\");\n+        \n+        // Required to trigger validation query's execution \n+        this.datasource.setTestOnConnect(true);\n+        this.datasource.setValidationInterval(-1);\n+        this.datasource.setValidationQuery(longQuery);\n+        this.datasource.setValidationQueryTimeout(1);\n+        \n+        this.datasource.getConnection();\n+    }\n+    \n+    @Test(expected=SQLException.class)\n+    public void testValidationInvalidOnConnection() throws Exception {\n+        // use our mock driver\n+        this.datasource.setDriverClassName(\"org.h2.Driver\");\n+        this.datasource.setUrl(\"jdbc:h2:~/.h2/test;QUERY_TIMEOUT=0;DB_CLOSE_ON_EXIT=FALSE\");\n+        \n+        // Required to trigger validation query's execution \n+        this.datasource.setTestOnBorrow(true);\n+        this.datasource.setInitialSize(1);\n+        this.datasource.setTestOnConnect(true);\n+        this.datasource.setValidationInterval(-1);\n+        this.datasource.setValidationQuery(\"SELECT\");\n+        this.datasource.setValidationQueryTimeout(1);\n+        \n+        this.datasource.getConnection();\n+    }\n+    \n+    @Test\n+    public void testLongValidationQueryTime() throws Exception {\n+        // use our mock driver\n+        this.datasource.setDriverClassName(\"org.h2.Driver\");\n+        this.datasource.setUrl(\"jdbc:h2:~/.h2/test;QUERY_TIMEOUT=0;DB_CLOSE_ON_EXIT=FALSE\");\n+        Connection con = this.datasource.getConnection();\n+        Statement stmt = null;\n+        long start = 0, end = 0;\n+        try {\n+            stmt = con.createStatement();\n+            // set the query timeout to 2 sec\n+            //  this keeps this test from slowing things down too much\n+            stmt.setQueryTimeout(2);\n+            // assert that our long query takes longer than one second to run\n+            //  this is a requirement for other tests to run properly\n+            start = System.currentTimeMillis();\n+            stmt.execute(longQuery);\n+        } catch (SQLException ex) {}\n+        finally {\n+            end = System.currentTimeMillis();\n+        \n+            if (stmt != null) { stmt.close(); }\n+            if (con != null) { con.close(); }\n+            \n+            Assert.assertTrue(start != 0 && end != 0);\n+            Assert.assertTrue((end - start) > 1000);\n+        }\n+    }\n+    \n+    @Test\n+    public void testValidationQueryTimeoutOnBorrow() throws Exception {\n+        // use our mock driver\n+        this.datasource.setDriverClassName(\"org.h2.Driver\");\n+        this.datasource.setUrl(\"jdbc:h2:~/.h2/test;QUERY_TIMEOUT=0;DB_CLOSE_ON_EXIT=FALSE\");\n+        \n+        // Required to trigger validation query's execution \n+        this.datasource.setTestOnBorrow(true);\n+        this.datasource.setValidationInterval(-1);\n+        this.datasource.setValidationQuery(longQuery);\n+        this.datasource.setValidationQueryTimeout(1);\n+        \n+        // assert that even though the validation query times out, we still get a connection\n+        Connection con = this.datasource.getConnection();\n+        Assert.assertNotNull(con);\n+        Statement st = con.createStatement();\n+        ResultSet rs = st.executeQuery(\"SELECT 1\");\n+        rs.close();\n+        st.close();\n+        con.close();\n+    }\n+    \n+    /**\n+     * Mock Driver, Connection and Statement implementations use to verify setQueryTimeout was called.\n+     */\n+    public static class MockDriver implements java.sql.Driver {\n+        public static final String url = \"jdbc:tomcat:mock\";\n+\n+        public MockDriver() {\n+        }\n+\n+        @Override\n+        public boolean acceptsURL(String url) throws SQLException {\n+            return url!=null && url.equals(MockDriver.url);\n+        }\n+\n+        @Override\n+        public Connection connect(String url, Properties info) throws SQLException {\n+            return new MockConnection(info);\n+        }\n+\n+        @Override\n+        public int getMajorVersion() {\n+            return 0;\n+        }\n+\n+        @Override\n+        public int getMinorVersion() {\n+            return 0;\n+        }\n+\n+        @Override\n+        public DriverPropertyInfo[] getPropertyInfo(String url, Properties info) throws SQLException {\n+            return null;\n+        }\n+\n+        @Override\n+        public boolean jdbcCompliant() {\n+            return false;\n+        }\n+\n+        @Override\n+        public Logger getParentLogger() throws SQLFeatureNotSupportedException {\n+            return null;\n+        }\n+    }\n+    \n+    public static class MockConnection extends org.apache.tomcat.jdbc.test.driver.Connection {\n+        public MockConnection(Properties info) {\n+            super(info);\n+        }\n+\n+        @Override\n+        public Statement createStatement() throws SQLException {\n+            return new MockStatement();\n+        }\n+    }\n+    \n+    public static class MockStatement extends org.apache.tomcat.jdbc.test.driver.Statement {\n+        @Override\n+        public void setQueryTimeout(int seconds) throws SQLException {\n+            super.setQueryTimeout(seconds);\n+            Assert.assertEquals(TIMEOUT, seconds);\n+            isTimeoutSet = true;\n+        }\n+    }\n+}",
                "additions": 249,
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/test/java/org/apache/tomcat/jdbc/test/TestValidationQueryTimeout.java",
                "status": "added",
                "changes": 249,
                "deletions": 0,
                "sha": "c681e52828c5818f982d82473635d7ea65f99204",
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/test/java/org/apache/tomcat/jdbc/test/TestValidationQueryTimeout.java",
                "filename": "modules/jdbc-pool/src/test/java/org/apache/tomcat/jdbc/test/TestValidationQueryTimeout.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/test/java/org/apache/tomcat/jdbc/test/TestValidationQueryTimeout.java?ref=856b28186141781e36fbdbe59112a56a88e113d6"
            }
        ],
        "bug_id": "tomcat80_243",
        "parent": "https://github.com/apache/tomcat80/commit/591de4be74f0ea552b124f3be8e9d395664ff389",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54693.\n- Add a validationQueryTimeout property\n- Avoid NPE caused by createConnection(..) returns null. (see Comment 6)\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1521024 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/91b8d8cb9c950672c69bfa41ba883ff93d2f4912",
        "file": [
            {
                "patch": "@@ -205,10 +205,6 @@ public boolean isReadOnly(ELContext context, Object base, Object property) {\n \n     @Override\n     public Iterator<FeatureDescriptor> getFeatureDescriptors(ELContext context, Object base) {\n-        if (context == null) {\n-            throw new NullPointerException();\n-        }\n-\n         if (base == null) {\n             return null;\n         }\n@@ -230,10 +226,6 @@ public boolean isReadOnly(ELContext context, Object base, Object property) {\n \n     @Override\n     public Class<?> getCommonPropertyType(ELContext context, Object base) {\n-        if (context == null) {\n-            throw new NullPointerException();\n-        }\n-\n         if (base != null) {\n             return Object.class;\n         }\n@@ -319,7 +311,7 @@ private Method write(ELContext ctx) {\n             if (this.write == null) {\n                 this.write = Util.getMethod(this.owner, descriptor.getWriteMethod());\n                 if (this.write == null) {\n-                    throw new PropertyNotFoundException(Util.message(ctx,\n+                    throw new PropertyNotWritableException(Util.message(ctx,\n                             \"propertyNotWritable\", new Object[] {\n                                     owner.getName(), descriptor.getName() }));\n                 }",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/91b8d8cb9c950672c69bfa41ba883ff93d2f4912/java/javax/el/BeanELResolver.java",
                "status": "modified",
                "changes": 10,
                "deletions": 9,
                "sha": "8a6c02f1325afeb35eea09a0700ba8255da6fdea",
                "blob_url": "https://github.com/apache/tomcat80/blob/91b8d8cb9c950672c69bfa41ba883ff93d2f4912/java/javax/el/BeanELResolver.java",
                "filename": "java/javax/el/BeanELResolver.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/javax/el/BeanELResolver.java?ref=91b8d8cb9c950672c69bfa41ba883ff93d2f4912"
            },
            {
                "patch": "@@ -16,14 +16,26 @@\n  */\n package javax.el;\n \n-import org.junit.Assert;\n+import java.beans.FeatureDescriptor;\n+import java.beans.PropertyDescriptor;\n+import java.util.Iterator;\n \n+import org.junit.Assert;\n import org.junit.Test;\n \n import org.apache.jasper.el.ELContextImpl;\n \n public class TestBeanELResolver {\n \n+    private static final String METHOD01_NAME = \"toString\";\n+    private static final String METHOD02_NAME = \"<init>\";\n+    private static final String METHOD03_NAME = \"nonExistingMethod\";\n+    private static final String BEAN_NAME = \"test\";\n+    private static final String PROPERTY01_NAME = \"valueA\";\n+    private static final String PROPERTY02_NAME = \"valueB\";\n+    private static final String PROPERTY03_NAME = \"name\";\n+    private static final String PROPERTY_VALUE = \"test1\";\n+\n     @Test\n     public void testBug53421() {\n         ExpressionFactory factory = ExpressionFactory.newInstance();\n@@ -54,11 +66,443 @@ public void testBug53421() {\n                 msg.contains(type));\n     }\n \n+    /**\n+     * Tests that a null context results in an NPE as per EL Javadoc.\n+     */\n+    @Test(expected = NullPointerException.class)\n+    public void testGetType01() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        resolver.getType(null, new Object(), new Object());\n+    }\n+\n+    /**\n+     * Tests that a valid property is not resolved if base is null.\n+     */\n+    @Test\n+    public void testGetType02() {\n+        doNegativeTest(null, new Object(), MethodUnderTest.GET_TYPE, true);\n+    }\n+\n+    /**\n+     * Tests that a valid property is resolved.\n+     */\n+    @Test\n+    public void testGetType03() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        Class<?> result = resolver.getType(context, new Bean(), PROPERTY01_NAME);\n+\n+        Assert.assertEquals(String.class, result);\n+        Assert.assertTrue(context.isPropertyResolved());\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when the property does not exist.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testGetType04() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.getType(context, new Bean(), PROPERTY02_NAME);\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when a coercion cannot be\n+     * performed.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testGetType05() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.getType(context, new Bean(), new Object());\n+    }\n+\n+    /**\n+     * Tests that a null context results in an NPE as per EL Javadoc.\n+     */\n+    @Test(expected = NullPointerException.class)\n+    public void testGetValue01() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        resolver.getValue(null, new Object(), new Object());\n+    }\n+\n+    /**\n+     * Tests that a valid property is not resolved if base is null.\n+     */\n+    @Test\n+    public void testGetValue02() {\n+        doNegativeTest(null, new Object(), MethodUnderTest.GET_VALUE, true);\n+    }\n+\n+    /**\n+     * Tests that a valid property is resolved.\n+     */\n+    @Test\n+    public void testGetValue03() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        Object result = resolver.getValue(context, new TesterBean(BEAN_NAME), PROPERTY03_NAME);\n+\n+        Assert.assertEquals(BEAN_NAME, result);\n+        Assert.assertTrue(context.isPropertyResolved());\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when the property does not exist.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testGetValue04() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.getValue(context, new Bean(), PROPERTY02_NAME);\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when a coercion cannot be\n+     * performed.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testGetValue05() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.getValue(context, new Bean(), new Object());\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when the property is not readable.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testGetValue06() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.getValue(context, new Bean(), PROPERTY01_NAME);\n+    }\n+\n+    /**\n+     * Tests that getter method throws exception which should be propagated.\n+     */\n+    @Test(expected = ELException.class)\n+    public void testGetValue07() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.getValue(context, new TesterBean(BEAN_NAME), PROPERTY01_NAME);\n+    }\n+\n+    /**\n+     * Tests that a null context results in an NPE as per EL Javadoc.\n+     */\n+    @Test(expected = NullPointerException.class)\n+    public void testSetValue01() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        resolver.setValue(null, new Object(), new Object(), new Object());\n+    }\n+\n+    /**\n+     * Tests that a valid property is not resolved if base is null.\n+     */\n+    @Test\n+    public void testSetValue02() {\n+        doNegativeTest(null, new Object(), MethodUnderTest.SET_VALUE, true);\n+    }\n+\n+    /**\n+     * Tests that an exception is thrown when readOnly is true.\n+     */\n+    @Test(expected = PropertyNotWritableException.class)\n+    public void testSetValue03() {\n+        BeanELResolver resolver = new BeanELResolver(true);\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.setValue(context, new Bean(), new Object(), new Object());\n+    }\n+\n+    /**\n+     * Tests that a valid property is resolved.\n+     */\n+    @Test\n+    public void testSetValue04() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        TesterBean bean = new TesterBean(BEAN_NAME);\n+        resolver.setValue(context, bean, PROPERTY03_NAME, PROPERTY_VALUE);\n+\n+        Assert.assertEquals(PROPERTY_VALUE, resolver.getValue(context, bean, PROPERTY03_NAME));\n+        Assert.assertTrue(context.isPropertyResolved());\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when a coercion cannot be\n+     * performed.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testSetValue05() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.setValue(context, new Bean(), new Object(), PROPERTY_VALUE);\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when the property does not exist.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testSetValue06() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.setValue(context, new Bean(), PROPERTY02_NAME, PROPERTY_VALUE);\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when the property does not have\n+     * setter method.\n+     */\n+    @Test(expected = PropertyNotWritableException.class)\n+    public void testSetValue07() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.setValue(context, new TesterBean(BEAN_NAME), PROPERTY01_NAME, PROPERTY_VALUE);\n+    }\n+\n+    /**\n+     * Tests that a null context results in an NPE as per EL Javadoc.\n+     */\n+    @Test(expected = NullPointerException.class)\n+    public void testIsReadOnly01() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        resolver.isReadOnly(null, new Object(), new Object());\n+    }\n+\n+    /**\n+     * Tests that the propertyResolved is false if base is null.\n+     */\n+    @Test\n+    public void testIsReadOnly02() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.isReadOnly(context, null, new Object());\n+\n+        Assert.assertFalse(context.isPropertyResolved());\n+\n+        resolver = new BeanELResolver(true);\n+\n+        resolver.isReadOnly(context, null, new Object());\n+\n+        Assert.assertFalse(context.isPropertyResolved());\n+    }\n+\n+    /**\n+     * Tests that if the BeanELResolver is constructed with readOnly the method\n+     * will return always true.\n+     */\n+    @Test\n+    public void testIsReadOnly03() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        boolean result = resolver.isReadOnly(context, new TesterBean(BEAN_NAME), PROPERTY03_NAME);\n+\n+        Assert.assertFalse(result);\n+        Assert.assertTrue(context.isPropertyResolved());\n+\n+        resolver = new BeanELResolver(true);\n+\n+        result = resolver.isReadOnly(context, new TesterBean(BEAN_NAME), PROPERTY03_NAME);\n+\n+        Assert.assertTrue(result);\n+        Assert.assertTrue(context.isPropertyResolved());\n+    }\n+\n+    /**\n+     * Tests that an exception is thrown when a coercion cannot be performed.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testIsReadOnly04() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.isReadOnly(context, new TesterBean(BEAN_NAME), new Integer(0));\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when the property does not exist.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testIsReadOnly05() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.isReadOnly(context, new Bean(), PROPERTY02_NAME);\n+    }\n+\n+    /**\n+     * Tests that true will be returned when the property does not have setter\n+     * method.\n+     */\n+    @Test\n+    public void testIsReadOnly06() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        boolean result = resolver.isReadOnly(context, new TesterBean(BEAN_NAME), PROPERTY01_NAME);\n+\n+        Assert.assertTrue(result);\n+        Assert.assertTrue(context.isPropertyResolved());\n+    }\n+\n+    /**\n+     * Tests that a valid FeatureDescriptors are not returned if base is not\n+     * Map.\n+     */\n+    @Test\n+    public void testGetFeatureDescriptors01() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        Iterator<FeatureDescriptor> result = resolver.getFeatureDescriptors(context, null);\n+\n+        Assert.assertNull(result);\n+    }\n+\n+    /**\n+     * Tests that a valid FeatureDescriptors are returned.\n+     */\n+    @Test\n+    public void testGetFeatureDescriptors02() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        Iterator<FeatureDescriptor> result = resolver.getFeatureDescriptors(context, new Bean());\n+\n+        while (result.hasNext()) {\n+            PropertyDescriptor featureDescriptor = (PropertyDescriptor) result.next();\n+            Assert.assertEquals(featureDescriptor.getPropertyType(),\n+                    featureDescriptor.getValue(ELResolver.TYPE));\n+            Assert.assertEquals(Boolean.TRUE,\n+                    featureDescriptor.getValue(ELResolver.RESOLVABLE_AT_DESIGN_TIME));\n+        }\n+    }\n+\n+    /**\n+     * Tests that a null context results in an NPE as per EL Javadoc.\n+     */\n+    @Test(expected = NullPointerException.class)\n+    public void testInvoke01() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        resolver.invoke(null, new Object(), new Object(), new Class<?>[0], new Object[0]);\n+    }\n+\n+    /**\n+     * Tests that a valid property is not resolved if base is null.\n+     */\n+    @Test\n+    public void testInvoke02() {\n+        doNegativeTest(null, new Object(), MethodUnderTest.INVOKE, true);\n+    }\n+\n+    /**\n+     * Tests a method invocation.\n+     */\n+    @Test\n+    public void testInvoke03() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        Object result = resolver.invoke(context, new TesterBean(BEAN_NAME), METHOD01_NAME,\n+                new Class<?>[] {}, new Object[] {});\n+\n+        Assert.assertEquals(BEAN_NAME, result);\n+        Assert.assertTrue(context.isPropertyResolved());\n+    }\n+\n+    /**\n+     * Tests that the method name cannot be coerced to String.\n+     */\n+    @Test\n+    public void testInvoke04() {\n+        doNegativeTest(new Bean(), null, MethodUnderTest.INVOKE, true);\n+    }\n+\n+    /**\n+     * Tests that a call to &lt;init&gt; as a method name will throw an exception.\n+     */\n+    @Test(expected = MethodNotFoundException.class)\n+    public void testInvoke05() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.invoke(context, new TesterBean(BEAN_NAME), METHOD02_NAME, new Class<?>[] {},\n+                new Object[] {});\n+    }\n+\n+    /**\n+     * Tests that a call to a non existing method will throw an exception.\n+     */\n+    @Test(expected = MethodNotFoundException.class)\n+    public void testInvoke06() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.invoke(context, new TesterBean(BEAN_NAME), METHOD03_NAME, new Class<?>[] {},\n+                new Object[] {});\n+    }\n+\n     private static class Bean {\n \n         @SuppressWarnings(\"unused\")\n         public void setValueA(String valueA) {\n             // NOOP\n         }\n     }\n+\n+    private void doNegativeTest(Object base, Object trigger, MethodUnderTest method,\n+            boolean checkResult) {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        Object result = null;\n+        switch (method) {\n+        case GET_VALUE: {\n+            result = resolver.getValue(context, base, trigger);\n+            break;\n+        }\n+        case SET_VALUE: {\n+            resolver.setValue(context, base, trigger, new Object());\n+            break;\n+        }\n+        case GET_TYPE: {\n+            result = resolver.getType(context, base, trigger);\n+            break;\n+        }\n+        case INVOKE: {\n+            result = resolver.invoke(context, base, trigger, new Class<?>[0], new Object[0]);\n+            break;\n+        }\n+        default: {\n+            // Should never happen\n+            Assert.fail(\"Missing case for method\");\n+        }\n+        }\n+\n+        if (checkResult) {\n+            Assert.assertNull(result);\n+        }\n+        Assert.assertFalse(context.isPropertyResolved());\n+    }\n+\n+    private static enum MethodUnderTest {\n+        GET_VALUE, SET_VALUE, GET_TYPE, INVOKE\n+    }\n+\n }",
                "additions": 445,
                "raw_url": "https://github.com/apache/tomcat80/raw/91b8d8cb9c950672c69bfa41ba883ff93d2f4912/test/javax/el/TestBeanELResolver.java",
                "status": "modified",
                "changes": 446,
                "deletions": 1,
                "sha": "44fbdc32bb9d60a5f332e105910c161bfa3e3747",
                "blob_url": "https://github.com/apache/tomcat80/blob/91b8d8cb9c950672c69bfa41ba883ff93d2f4912/test/javax/el/TestBeanELResolver.java",
                "filename": "test/javax/el/TestBeanELResolver.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/javax/el/TestBeanELResolver.java?ref=91b8d8cb9c950672c69bfa41ba883ff93d2f4912"
            },
            {
                "patch": "@@ -18,7 +18,7 @@\n \n public class TesterBean {\n \n-    private final String name;\n+    private String name;\n \n     public TesterBean(String name) {\n         this.name = name;\n@@ -28,8 +28,16 @@ public String getName() {\n         return name;\n     }\n \n+    public void setName(String name) {\n+        this.name = name;\n+    }\n+\n     @Override\n     public String toString() {\n         return getName();\n     }\n+\n+    public String getValueA() throws Exception {\n+        throw new Exception();\n+    }\n }",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/91b8d8cb9c950672c69bfa41ba883ff93d2f4912/test/javax/el/TesterBean.java",
                "status": "modified",
                "changes": 10,
                "deletions": 1,
                "sha": "2169d5952f514fc4ebf28b31168b4e113a4783c3",
                "blob_url": "https://github.com/apache/tomcat80/blob/91b8d8cb9c950672c69bfa41ba883ff93d2f4912/test/javax/el/TesterBean.java",
                "filename": "test/javax/el/TesterBean.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/javax/el/TesterBean.java?ref=91b8d8cb9c950672c69bfa41ba883ff93d2f4912"
            }
        ],
        "bug_id": "tomcat80_244",
        "parent": "https://github.com/apache/tomcat80/commit/5e29adf957b1e9cef7a0b39dc073d31609d9f06b",
        "message": "javax.el.BeanELResolver:\n- getFeatureDescriptors, getCommonPropertyType do not throw NPE when the supplied context is null.\n- setValue will throw PropertyNotWritableException instead of PropertyNotFoundException when there is no setter for the property.\n- unit test is added\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1517536 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/28f66ce9b55e338e2c9fcebb2439200ff1886493",
        "file": [
            {
                "patch": "@@ -142,18 +142,22 @@ protected long getTimeoutExpiry() {\n \n \n     protected void onTimeout() {\n-        clearHandler(new SocketTimeoutException());\n+        if (handler != null) {\n+            clearHandler(new SocketTimeoutException());\n+        }\n         close();\n     }\n \n \n     private void clearHandler(Throwable t) {\n         SendHandler sh = handler;\n         handler = null;\n-        if (t == null) {\n-            sh.onResult(new SendResult());\n-        } else {\n-            sh.onResult(new SendResult(t));\n+        if (sh != null) {\n+            if (t == null) {\n+                sh.onResult(new SendResult());\n+            } else {\n+                sh.onResult(new SendResult(t));\n+            }\n         }\n     }\n }",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/28f66ce9b55e338e2c9fcebb2439200ff1886493/java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java",
                "status": "modified",
                "changes": 14,
                "deletions": 5,
                "sha": "8816933e7205dc8491842d46e9d0e2896f959652",
                "blob_url": "https://github.com/apache/tomcat80/blob/28f66ce9b55e338e2c9fcebb2439200ff1886493/java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java",
                "filename": "java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java?ref=28f66ce9b55e338e2c9fcebb2439200ff1886493"
            }
        ],
        "bug_id": "tomcat80_245",
        "parent": "https://github.com/apache/tomcat80/commit/4bd7633b680686cdba4c8a707f6ea64648888f13",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55238\nAvoid possible NPE.\nPatch by Niki Dokovski.\nAlso added a check to onTimeout() to save creating an Exception unnecessarily\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1502265 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/7c88cc41565556909e9461f7875bad86d921f9cd",
        "file": [
            {
                "patch": "@@ -78,7 +78,7 @@ public void doFilter(ServletRequest request, ServletResponse response,\n                 !headerContainsToken((HttpServletRequest) request,\n                         Constants.UPGRADE_HEADER_NAME,\n                         Constants.UPGRADE_HEADER_VALUE)) {\n-            // Note an HTTP request that includes a valid upgrade request to\n+            // Not an HTTP request that includes a valid upgrade request to\n             // web socket\n             chain.doFilter(request, response);\n             return;\n@@ -122,6 +122,13 @@ public void doFilter(ServletRequest request, ServletResponse response,\n         }\n         WsMappingResult mappingResult = sc.findMapping(path);\n \n+        if (mappingResult == null) {\n+            // No endpoint registered for the requested path. Let the\n+            // application handle it (it might redirect or forward for example)\n+            chain.doFilter(request, response);\n+            return;\n+        }\n+\n         ServerEndpointConfig sec = mappingResult.getConfig();\n \n         // Origin check",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/7c88cc41565556909e9461f7875bad86d921f9cd/java/org/apache/tomcat/websocket/server/WsFilter.java",
                "status": "modified",
                "changes": 9,
                "deletions": 1,
                "sha": "1770a819789ccd8485b2d3e1cca809c5dfafa21d",
                "blob_url": "https://github.com/apache/tomcat80/blob/7c88cc41565556909e9461f7875bad86d921f9cd/java/org/apache/tomcat/websocket/server/WsFilter.java",
                "filename": "java/org/apache/tomcat/websocket/server/WsFilter.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/server/WsFilter.java?ref=7c88cc41565556909e9461f7875bad86d921f9cd"
            },
            {
                "patch": "@@ -19,12 +19,14 @@\n import java.util.Arrays;\n import java.util.Collections;\n import java.util.Comparator;\n+import java.util.EnumSet;\n import java.util.HashMap;\n import java.util.Map;\n import java.util.SortedSet;\n import java.util.TreeSet;\n import java.util.WeakHashMap;\n \n+import javax.servlet.DispatcherType;\n import javax.servlet.FilterRegistration;\n import javax.servlet.ServletContext;\n import javax.websocket.DeploymentException;\n@@ -111,7 +113,11 @@ public void setServletContext(ServletContext servletContext) {\n \n         FilterRegistration fr = servletContext.addFilter(\n                 WsFilter.class.getName(), WsFilter.class);\n-        fr.addMappingForUrlPatterns(null, false, \"/*\");\n+\n+        EnumSet<DispatcherType> types = EnumSet.of(DispatcherType.REQUEST,\n+                DispatcherType.FORWARD);\n+\n+        fr.addMappingForUrlPatterns(types, false, \"/*\");\n     }\n \n \n@@ -233,6 +239,12 @@ public WsMappingResult findMapping(String path) {\n         SortedSet<TemplatePathMatch> templateMatches =\n                 configTemplateMatchMap.get(key);\n \n+        if (templateMatches == null) {\n+            // No templates with an equal number of segments so there will be\n+            // no matches\n+            return null;\n+        }\n+\n         // List is in alphabetical order of normalised templates.\n         // Correct match is the first one that matches.\n         Map<String,String> pathParams = null;",
                "additions": 13,
                "raw_url": "https://github.com/apache/tomcat80/raw/7c88cc41565556909e9461f7875bad86d921f9cd/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "status": "modified",
                "changes": 14,
                "deletions": 1,
                "sha": "7102a9561812c17d108821e1d12244472d046358",
                "blob_url": "https://github.com/apache/tomcat80/blob/7c88cc41565556909e9461f7875bad86d921f9cd/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "filename": "java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/server/WsServerContainer.java?ref=7c88cc41565556909e9461f7875bad86d921f9cd"
            }
        ],
        "bug_id": "tomcat80_246",
        "parent": "https://github.com/apache/tomcat80/commit/ff799f439306cd45c4141bb84c85e2dc1fc584c0",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54781\nFix NPE if no matching Endpoint is found.\nHandle forwarded requests as well.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1471123 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/5e6bb3f57008cab73a2dca0046a21108c80da06c",
        "file": [
            {
                "patch": "@@ -71,7 +71,7 @@ public void register(BackgroundProcess process) {\n     public void unregister(BackgroundProcess process) {\n         synchronized (processesLock) {\n             processes.remove(process);\n-            if (processes.size() == 0) {\n+            if (wsBackgroundThread != null && processes.size() == 0) {\n                 wsBackgroundThread.halt();\n                 wsBackgroundThread = null;\n             }",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/5e6bb3f57008cab73a2dca0046a21108c80da06c/java/org/apache/tomcat/websocket/BackgroundProcessManager.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "ccb6d868b77052ae0be5a2621a08760585bff352",
                "blob_url": "https://github.com/apache/tomcat80/blob/5e6bb3f57008cab73a2dca0046a21108c80da06c/java/org/apache/tomcat/websocket/BackgroundProcessManager.java",
                "filename": "java/org/apache/tomcat/websocket/BackgroundProcessManager.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/BackgroundProcessManager.java?ref=5e6bb3f57008cab73a2dca0046a21108c80da06c"
            },
            {
                "patch": "@@ -256,6 +256,10 @@ public Session connectToServer(Endpoint endpoint,\n \n \n     protected void registerSession(Class<?> endpoint, WsSession wsSession) {\n+        if (!wsSession.isOpen()) {\n+            // The session was closed during onOpen. No need to register it.\n+            return;\n+        }\n         synchronized (endPointSessionMapLock) {\n             if (endpointSessionMap.size() == 0) {\n                 BackgroundProcessManager.getInstance().register(this);",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/5e6bb3f57008cab73a2dca0046a21108c80da06c/java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "b7ff5d6f5fb239276aba824d9b5b0ffb4f9b4623",
                "blob_url": "https://github.com/apache/tomcat80/blob/5e6bb3f57008cab73a2dca0046a21108c80da06c/java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "filename": "java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsWebSocketContainer.java?ref=5e6bb3f57008cab73a2dca0046a21108c80da06c"
            }
        ],
        "bug_id": "tomcat80_247",
        "parent": "https://github.com/apache/tomcat80/commit/928e645c6105d80ed74d858b7188cb057adfa98c",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54716\nAdditional fix. Avoid NPE on session de-registration.\nBased on a patch by Nick Williams.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1458484 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/d515e5f76c50ea1453a1f653df1bdf05a0b71b0c",
        "file": [
            {
                "patch": "@@ -68,17 +68,19 @@ protected final boolean isCloseRequired() {\n \n     @Override\n     public void write(int b) throws IOException {\n-        preWriteChecks();\n-\n-        writeInternal(new byte[] { (byte) b }, 0, 1);\n+        synchronized (writeLock) {\n+            preWriteChecks();\n+            writeInternal(new byte[] { (byte) b }, 0, 1);\n+        }\n     }\n \n \n     @Override\n     public void write(byte[] b, int off, int len) throws IOException {\n-        preWriteChecks();\n-\n-        writeInternal(b, off, len);\n+        synchronized (writeLock) {\n+            preWriteChecks();\n+            writeInternal(b, off, len);\n+        }\n     }\n \n \n@@ -97,51 +99,50 @@ private void preWriteChecks() {\n \n \n     private void writeInternal(byte[] b, int off, int len) throws IOException {\n-        synchronized (writeLock) {\n-            if (listener == null) {\n-                // Simple case - blocking IO\n-                doWrite(true, b, off, len);\n+        if (listener == null) {\n+            // Simple case - blocking IO\n+            doWrite(true, b, off, len);\n+        } else {\n+            // Non-blocking IO\n+            // If the non-blocking read does not complete, doWrite() will add\n+            // the socket back into the poller. The poller way trigger a new\n+            // write event before this method has finished updating buffer. This\n+            // sync makes sure that buffer is updated before the next write\n+            // executes.\n+            int written = doWrite(false, b, off, len);\n+            if (written < len) {\n+                // TODO: - Reuse the buffer\n+                //       - Only reallocate if it gets too big (>8k?)\n+                buffer = new byte[len - written];\n+                System.arraycopy(b, off + written, buffer, 0, len - written);\n             } else {\n-                // Non-blocking IO\n-                // If the non-blocking read does not complete, doWrite() will add\n-                // the socket back into the poller. The poller way trigger a new\n-                // write event before this method has finished updating buffer. This\n-                // sync makes sure that buffer is updated before the next write\n-                // executes.\n-                int written = doWrite(false, b, off, len);\n-                if (written < len) {\n-                    // TODO: - Reuse the buffer\n-                    //       - Only reallocate if it gets too big (>8k?)\n-                    buffer = new byte[len - written];\n-                    System.arraycopy(b, off + written, buffer, 0, len - written);\n-                } else {\n-                    buffer = null;\n-                }\n+                buffer = null;\n             }\n         }\n     }\n \n \n     protected final void onWritePossible() {\n-        try {\n-            writeInternal(buffer, 0, buffer.length);\n-        } catch (IOException ioe) {\n-            throw new RuntimeException(ioe);\n-        }\n-        // Make sure isReady() and onWritePossible() have a consistent view of\n-        // buffer and fireListener when determining if the listener should fire\n-        boolean fire = false;\n-\n-        synchronized (fireListenerLock) {\n-            if (buffer == null && fireListener) {\n-                fireListener = false;\n-                fire = true;\n+        synchronized (writeLock) {\n+            try {\n+                writeInternal(buffer, 0, buffer.length);\n+            } catch (IOException ioe) {\n+                throw new RuntimeException(ioe);\n+            }\n+            // Make sure isReady() and onWritePossible() have a consistent view of\n+            // buffer and fireListener when determining if the listener should fire\n+            boolean fire = false;\n+\n+            synchronized (fireListenerLock) {\n+                if (buffer == null && fireListener) {\n+                    fireListener = false;\n+                    fire = true;\n+                }\n+            }\n+            if (fire) {\n+                listener.onWritePossible();\n             }\n         }\n-        if (fire) {\n-            listener.onWritePossible();\n-        }\n-\n     }\n \n     /**",
                "additions": 43,
                "raw_url": "https://github.com/apache/tomcat80/raw/d515e5f76c50ea1453a1f653df1bdf05a0b71b0c/java/org/apache/coyote/http11/upgrade/AbstractServletOutputStream.java",
                "status": "modified",
                "changes": 85,
                "deletions": 42,
                "sha": "bb5aa4150cfb56a1c49c20883dab17fc7a043fbc",
                "blob_url": "https://github.com/apache/tomcat80/blob/d515e5f76c50ea1453a1f653df1bdf05a0b71b0c/java/org/apache/coyote/http11/upgrade/AbstractServletOutputStream.java",
                "filename": "java/org/apache/coyote/http11/upgrade/AbstractServletOutputStream.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/http11/upgrade/AbstractServletOutputStream.java?ref=d515e5f76c50ea1453a1f653df1bdf05a0b71b0c"
            }
        ],
        "bug_id": "tomcat80_248",
        "parent": "https://github.com/apache/tomcat80/commit/bde2f9c7a2bcde894b8f654e33f583e347f08aa7",
        "message": "Fix concurrency issue.\ndoWrite() add the socket to the poller if there are bytes left to wrote. The may poller fire and execution could reach onWritePossible() before the remaining bytes have been copied to the buffer thereby triggering an NPE.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1455201 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/30a5a4ea8d2888f19138ffd90c312e283f6cc805",
        "file": [
            {
                "patch": "@@ -376,9 +376,10 @@ public Principal authenticate(String username, String clientDigest,\n                                   String md5a2) {\n \n         // In digest auth, digests are always lower case\n-        String md5a1 = getDigest(username, realm).toLowerCase(Locale.ENGLISH);\n+        String md5a1 = getDigest(username, realm);\n         if (md5a1 == null)\n             return null;\n+        md5a1 = md5a1.toLowerCase(Locale.ENGLISH);\n         String serverDigestValue;\n         if (qop == null) {\n             serverDigestValue = md5a1 + \":\" + nonce + \":\" + md5a2;",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/30a5a4ea8d2888f19138ffd90c312e283f6cc805/java/org/apache/catalina/realm/RealmBase.java",
                "status": "modified",
                "changes": 3,
                "deletions": 1,
                "sha": "8a0369a6f10639cf8ef19dfa6052fd6f6e1cea6a",
                "blob_url": "https://github.com/apache/tomcat80/blob/30a5a4ea8d2888f19138ffd90c312e283f6cc805/java/org/apache/catalina/realm/RealmBase.java",
                "filename": "java/org/apache/catalina/realm/RealmBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/realm/RealmBase.java?ref=30a5a4ea8d2888f19138ffd90c312e283f6cc805"
            }
        ],
        "bug_id": "tomcat80_249",
        "parent": "https://github.com/apache/tomcat80/commit/a0e1a2f045342df9499c188815ba193920ecef30",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54438\nFix a regression in the fix for BZ 52953 that triggered an NPE when digested passwords were used and an authentication attempt was made for a user that did not exist in the realm.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1434685 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/e2cf8739888fa7cf01f7beba4ef50906044217e2",
        "file": [
            {
                "patch": "@@ -487,7 +487,9 @@ protected void stopInternal() throws LifecycleException {\n         servletContext.removeAttribute(Globals.CLASS_PATH_ATTR);\n \n         // Throw away our current class loader\n-        ((Lifecycle) classLoader).stop();\n+        if (classLoader != null) {\n+            ((Lifecycle) classLoader).stop();\n+        }\n \n         try {\n             String contextName = context.getName();",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/e2cf8739888fa7cf01f7beba4ef50906044217e2/java/org/apache/catalina/loader/WebappLoader.java",
                "status": "modified",
                "changes": 4,
                "deletions": 1,
                "sha": "be429bdf1fdc65de0bf6e0cdc292196d2d0a7aa1",
                "blob_url": "https://github.com/apache/tomcat80/blob/e2cf8739888fa7cf01f7beba4ef50906044217e2/java/org/apache/catalina/loader/WebappLoader.java",
                "filename": "java/org/apache/catalina/loader/WebappLoader.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/loader/WebappLoader.java?ref=e2cf8739888fa7cf01f7beba4ef50906044217e2"
            },
            {
                "patch": "@@ -49,12 +49,17 @@\n import org.junit.Test;\n \n import org.apache.catalina.Context;\n+import org.apache.catalina.Lifecycle;\n+import org.apache.catalina.LifecycleEvent;\n+import org.apache.catalina.LifecycleException;\n+import org.apache.catalina.LifecycleListener;\n import org.apache.catalina.LifecycleState;\n import org.apache.catalina.Wrapper;\n import org.apache.catalina.authenticator.BasicAuthenticator;\n import org.apache.catalina.deploy.FilterDef;\n import org.apache.catalina.deploy.FilterMap;\n import org.apache.catalina.deploy.LoginConfig;\n+import org.apache.catalina.loader.WebappLoader;\n import org.apache.catalina.startup.SimpleHttpClient;\n import org.apache.catalina.startup.TestTomcat.MapRealm;\n import org.apache.catalina.startup.Tomcat;\n@@ -166,13 +171,113 @@ public void doFilter(ServletRequest request, ServletResponse response,\n         public void init(FilterConfig filterConfig) throws ServletException {\n             boolean fail = filterConfig.getInitParameter(\"fail\").equals(\"true\");\n             if (fail) {\n-                throw new ServletException(\"Init fail\",\n+                throw new ServletException(\"Init fail (test)\",\n                         new ClassNotFoundException());\n             }\n         }\n \n     }\n \n+    @Test\n+    public void testWebappLoaderStartFail() throws Exception {\n+        // Test that if WebappLoader start() fails and if the cause of\n+        // the failure is gone, the context can be started without\n+        // a need to redeploy it.\n+\n+        // Set up a container\n+        Tomcat tomcat = getTomcatInstance();\n+        tomcat.start();\n+        // To not start Context automatically, as we have to configure it first\n+        ((ContainerBase) tomcat.getHost()).setStartChildren(false);\n+\n+        FailingWebappLoader loader = new FailingWebappLoader();\n+        File root = new File(\"test/webapp-3.0\");\n+        Context context = tomcat.addWebapp(\"\", root.getAbsolutePath());\n+        context.setLoader(loader);\n+\n+        try {\n+            context.start();\n+            fail();\n+        } catch (LifecycleException ex) {\n+            // As expected\n+        }\n+        assertEquals(LifecycleState.FAILED, context.getState());\n+\n+        // The second attempt\n+        loader.setFail(false);\n+        context.start();\n+        assertEquals(LifecycleState.STARTED, context.getState());\n+\n+        // Using a test from testBug49922() to check that the webapp is running\n+        ByteChunk result = getUrl(\"http://localhost:\" + getPort() +\n+                \"/bug49922/target\");\n+        assertEquals(\"Target\", result.toString());\n+    }\n+\n+    @Test\n+    public void testWebappListenerConfigureFail() throws Exception {\n+        // Test that if LifecycleListener on webapp fails during\n+        // configure_start event and if the cause of the failure is gone,\n+        // the context can be started without a need to redeploy it.\n+\n+        // Set up a container\n+        Tomcat tomcat = getTomcatInstance();\n+        tomcat.start();\n+        // To not start Context automatically, as we have to configure it first\n+        ((ContainerBase) tomcat.getHost()).setStartChildren(false);\n+\n+        FailingLifecycleListener listener = new FailingLifecycleListener();\n+        File root = new File(\"test/webapp-3.0\");\n+        Context context = tomcat.addWebapp(\"\", root.getAbsolutePath());\n+        context.addLifecycleListener(listener);\n+\n+        try {\n+            context.start();\n+            fail();\n+        } catch (LifecycleException ex) {\n+            // As expected\n+        }\n+        assertEquals(LifecycleState.FAILED, context.getState());\n+\n+        // The second attempt\n+        listener.setFail(false);\n+        context.start();\n+        assertEquals(LifecycleState.STARTED, context.getState());\n+\n+        // Using a test from testBug49922() to check that the webapp is running\n+        ByteChunk result = getUrl(\"http://localhost:\" + getPort() +\n+                \"/bug49922/target\");\n+        assertEquals(\"Target\", result.toString());\n+    }\n+\n+    private static class FailingWebappLoader extends WebappLoader {\n+        private boolean fail = true;\n+        protected void setFail(boolean fail) {\n+            this.fail = fail;\n+        }\n+        @Override\n+        protected void startInternal() throws LifecycleException {\n+            if (fail) {\n+                throw new RuntimeException(\"Start fail (test)\");\n+            }\n+            super.startInternal();\n+        }\n+    }\n+\n+    private static class FailingLifecycleListener implements LifecycleListener {\n+        private final String failEvent = Lifecycle.CONFIGURE_START_EVENT;\n+        private boolean fail = true;\n+        protected void setFail(boolean fail) {\n+            this.fail = fail;\n+        }\n+        @Override\n+        public void lifecycleEvent(LifecycleEvent event) {\n+            if (fail && event.getType().equals(failEvent)) {\n+                throw new RuntimeException(failEvent + \" fail (test)\");\n+            }\n+        }\n+    }\n+\n     @Test\n     public void testBug49922() throws Exception {\n         // Test that filter mapping works. Test that the same filter is",
                "additions": 106,
                "raw_url": "https://github.com/apache/tomcat80/raw/e2cf8739888fa7cf01f7beba4ef50906044217e2/test/org/apache/catalina/core/TestStandardContext.java",
                "status": "modified",
                "changes": 107,
                "deletions": 1,
                "sha": "47f9ddc3f752949bcdc6d77460760480ab3ae7cb",
                "blob_url": "https://github.com/apache/tomcat80/blob/e2cf8739888fa7cf01f7beba4ef50906044217e2/test/org/apache/catalina/core/TestStandardContext.java",
                "filename": "test/org/apache/catalina/core/TestStandardContext.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/core/TestStandardContext.java?ref=e2cf8739888fa7cf01f7beba4ef50906044217e2"
            }
        ],
        "bug_id": "tomcat80_250",
        "parent": "https://github.com/apache/tomcat80/commit/77d990ec578deb7e65f59e0a1c2e3d29db4be282",
        "message": "Fix NPE in WebappLoader that happens when stop() is called after a failed start.\nAdd tests that a context can be started again after a failure.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1430165 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/f4f7c689ab35decffdd57f50773651ec547c9e46",
        "file": [
            {
                "patch": "@@ -155,6 +155,9 @@ private void doCollection(TagPluginContext ctxt) {\n         ctxt.generateJavaSource(\"else if (\" + itemsV + \" instanceof Map)\");\n         ctxt.generateJavaSource(iterV + \"=((Map)\" + itemsV + \").entrySet().iterator();\");\n \n+        // Not null\n+        ctxt.generateJavaSource(\"if (\" + iterV + \" != null) {\");\n+\n         if (hasBegin) {\n             String tV = ctxt.getTemporaryVariableName();\n             ctxt.generateJavaSource(\"for (int \" + tV + \"=\" + beginV + \";\" +\n@@ -196,6 +199,7 @@ private void doCollection(TagPluginContext ctxt) {\n             ctxt.generateJavaSource(\"break;\");\n         }\n         ctxt.generateJavaSource(\"}\"); // while\n+        ctxt.generateJavaSource(\"}\"); // Not Null\n     }\n \n     /**",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/f4f7c689ab35decffdd57f50773651ec547c9e46/java/org/apache/jasper/tagplugins/jstl/core/ForEach.java",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "6c25497bd39baa25ff49376f056dd0e5aa62111b",
                "blob_url": "https://github.com/apache/tomcat80/blob/f4f7c689ab35decffdd57f50773651ec547c9e46/java/org/apache/jasper/tagplugins/jstl/core/ForEach.java",
                "filename": "java/org/apache/jasper/tagplugins/jstl/core/ForEach.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/tagplugins/jstl/core/ForEach.java?ref=f4f7c689ab35decffdd57f50773651ec547c9e46"
            }
        ],
        "bug_id": "tomcat80_251",
        "parent": "https://github.com/apache/tomcat80/commit/59f3a1301959ed795aab20b66afed864ac66892c",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54242\nFix NPE in tagPlugins:ForEach when iteration is null. JSTL spec says it should be treated like an empty iteration.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1427846 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/7ab8becebb630544e2b8c6e9945ff81bbdfa03d1",
        "file": [
            {
                "patch": "@@ -122,13 +122,16 @@ public boolean getStaticOnly() {\n     }\n \n     protected void sendPing() {\n-        if (failureDetector.get() != null) {\n+        TcpFailureDetector tcpFailureDetector =\n+                failureDetector != null ? failureDetector.get() : null;\n+        if (tcpFailureDetector != null) {\n             // We have a reference to the failure detector\n             // Piggy back on it\n-            failureDetector.get().checkMembers(true);\n+            tcpFailureDetector.checkMembers(true);\n         } else {\n-            StaticMembershipInterceptor smi = staticMembers.get();\n-            if (staticOnly && smi != null) {\n+            StaticMembershipInterceptor smi =\n+                    staticOnly && staticMembers != null ? staticMembers.get() : null;\n+            if (smi != null) {\n                 sendPingMessage(smi.getMembers());\n             } else {\n                 sendPingMessage(getMembers());",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/7ab8becebb630544e2b8c6e9945ff81bbdfa03d1/java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java",
                "status": "modified",
                "changes": 11,
                "deletions": 4,
                "sha": "b7b5ebd524af6fb1be27489436bc1a27a5bf1a11",
                "blob_url": "https://github.com/apache/tomcat80/blob/7ab8becebb630544e2b8c6e9945ff81bbdfa03d1/java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java",
                "filename": "java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java?ref=7ab8becebb630544e2b8c6e9945ff81bbdfa03d1"
            }
        ],
        "bug_id": "tomcat80_252",
        "parent": "https://github.com/apache/tomcat80/commit/5a9dac447be9531a8b86764cc4e6937bf5a0cc5f",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53606\nFix possible NPE when sending pings between cluster nodes\nBased on a patch by F.Arnoud\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1366959 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/3225c197cc032b9a143f89999354a71fe943a65d",
        "file": [
            {
                "patch": "@@ -332,7 +332,7 @@ public static Object coerceToType(Class<?> type, String value) {\n \n \n     public static List<DecoderEntry> getDecoders(\n-            Class<? extends Decoder>[] decoderClazzes)\n+            List<Class<? extends Decoder>> decoderClazzes)\n                     throws DeploymentException{\n \n         List<DecoderEntry> result = new ArrayList<>();\n@@ -465,9 +465,7 @@ private static DecoderMatch matchDecoders(Class<?> target,\n         try {\n             List<Class<? extends Decoder>> decoders =\n                     endpointConfig.getDecoders();\n-            @SuppressWarnings(\"unchecked\")\n-            List<DecoderEntry> decoderEntries = getDecoders(\n-                    decoders.toArray(new Class[decoders.size()]));\n+            List<DecoderEntry> decoderEntries = getDecoders(decoders);\n             decoderMatch = new DecoderMatch(target, decoderEntries);\n         } catch (DeploymentException e) {\n             throw new IllegalArgumentException(e);",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/Util.java",
                "status": "modified",
                "changes": 6,
                "deletions": 4,
                "sha": "0288868ad432a7a0bc4e47cfb2df26ad2ebbee85",
                "blob_url": "https://github.com/apache/tomcat80/blob/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/Util.java",
                "filename": "java/org/apache/tomcat/websocket/Util.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/Util.java?ref=3225c197cc032b9a143f89999354a71fe943a65d"
            },
            {
                "patch": "@@ -140,7 +140,7 @@ public Session connectToServer(Object pojo, URI path)\n                             pojo.getClass().getName()));\n         }\n \n-        Endpoint ep = new PojoEndpointClient(pojo, annotation.decoders());\n+        Endpoint ep = new PojoEndpointClient(pojo, Arrays.asList(annotation.decoders()));\n \n         Class<? extends ClientEndpointConfig.Configurator> configuratorClazz =\n                 annotation.configurator();",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "53058e74f38d1c75842fd1794a5e042be89b2641",
                "blob_url": "https://github.com/apache/tomcat80/blob/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "filename": "java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsWebSocketContainer.java?ref=3225c197cc032b9a143f89999354a71fe943a65d"
            },
            {
                "patch": "@@ -17,6 +17,7 @@\n package org.apache.tomcat.websocket.pojo;\n \n import java.util.Collections;\n+import java.util.List;\n \n import javax.websocket.Decoder;\n import javax.websocket.DeploymentException;\n@@ -32,7 +33,7 @@\n public class PojoEndpointClient extends PojoEndpointBase {\n \n     public PojoEndpointClient(Object pojo,\n-            Class<? extends Decoder>[] decoders) throws DeploymentException {\n+            List<Class<? extends Decoder>> decoders) throws DeploymentException {\n         setPojo(pojo);\n         setMethodMapping(\n                 new PojoMethodMapping(pojo.getClass(), decoders, null));",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/pojo/PojoEndpointClient.java",
                "status": "modified",
                "changes": 3,
                "deletions": 1,
                "sha": "f4d0567a3b1dd23c78a6ac1e1e6204ad2c38569c",
                "blob_url": "https://github.com/apache/tomcat80/blob/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/pojo/PojoEndpointClient.java",
                "filename": "java/org/apache/tomcat/websocket/pojo/PojoEndpointClient.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/pojo/PojoEndpointClient.java?ref=3225c197cc032b9a143f89999354a71fe943a65d"
            },
            {
                "patch": "@@ -71,7 +71,7 @@\n \n \n     public PojoMethodMapping(Class<?> clazzPojo,\n-            Class<? extends Decoder>[] decoderClazzes, String wsPath)\n+            List<Class<? extends Decoder>> decoderClazzes, String wsPath)\n                     throws DeploymentException {\n \n         this.wsPath = wsPath;",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "d6f8cc0303739e3c1ba6d26f19db50329f2fcf06",
                "blob_url": "https://github.com/apache/tomcat80/blob/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "filename": "java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java?ref=3225c197cc032b9a143f89999354a71fe943a65d"
            },
            {
                "patch": "@@ -184,6 +184,13 @@ public void addEndpoint(ServerEndpointConfig sec)\n         }\n         String path = sec.getPath();\n \n+        // Add method mapping to user properties\n+        PojoMethodMapping methodMapping = new PojoMethodMapping(sec.getEndpointClass(),\n+                sec.getDecoders(), path);\n+        sec.getUserProperties().put(\n+                PojoEndpointServer.POJO_METHOD_MAPPING_KEY,\n+                methodMapping);\n+\n         UriTemplate uriTemplate = new UriTemplate(path);\n         if (uriTemplate.hasParameters()) {\n             Integer key = Integer.valueOf(uriTemplate.getSegmentCount());\n@@ -241,10 +248,6 @@ public void addEndpoint(Class<?> pojo) throws DeploymentException {\n         // Validate encoders\n         validateEncoders(annotation.encoders());\n \n-        // Method mapping\n-        PojoMethodMapping methodMapping = new PojoMethodMapping(pojo,\n-                annotation.decoders(), path);\n-\n         // ServerEndpointConfig\n         ServerEndpointConfig sec;\n         Class<? extends Configurator> configuratorClazz =\n@@ -266,9 +269,6 @@ public void addEndpoint(Class<?> pojo) throws DeploymentException {\n                 subprotocols(Arrays.asList(annotation.subprotocols())).\n                 configurator(configurator).\n                 build();\n-        sec.getUserProperties().put(\n-                PojoEndpointServer.POJO_METHOD_MAPPING_KEY,\n-                methodMapping);\n \n         addEndpoint(sec);\n     }",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "status": "modified",
                "changes": 14,
                "deletions": 7,
                "sha": "9e578d52eea0826f81b69dca17f7a9789417613a",
                "blob_url": "https://github.com/apache/tomcat80/blob/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "filename": "java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/server/WsServerContainer.java?ref=3225c197cc032b9a143f89999354a71fe943a65d"
            },
            {
                "patch": "@@ -16,8 +16,16 @@\n  */\n package org.apache.tomcat.websocket.server;\n \n+import java.net.URI;\n+import java.util.Queue;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n import javax.servlet.ServletContextEvent;\n+import javax.websocket.ContainerProvider;\n import javax.websocket.DeploymentException;\n+import javax.websocket.Session;\n+import javax.websocket.WebSocketContainer;\n import javax.websocket.server.ServerContainer;\n import javax.websocket.server.ServerEndpointConfig;\n \n@@ -31,6 +39,8 @@\n import org.apache.catalina.startup.Tomcat;\n import org.apache.catalina.startup.TomcatBaseTest;\n import org.apache.tomcat.websocket.TesterEchoServer;\n+import org.apache.tomcat.websocket.TesterMessageCountClient.BasicText;\n+import org.apache.tomcat.websocket.pojo.TesterUtil.SimpleClient;\n \n \n public class TestWsServerContainer extends TomcatBaseTest {\n@@ -50,6 +60,43 @@ public void testBug54807() throws Exception {\n     }\n \n \n+    @Test\n+    public void testBug58232() throws Exception {\n+        Tomcat tomcat = getTomcatInstance();\n+        // No file system docBase required\n+        Context ctx = tomcat.addContext(\"\", null);\n+        ctx.addApplicationListener(Bug54807Config.class.getName());\n+        Tomcat.addServlet(ctx, \"default\", new DefaultServlet());\n+        ctx.addServletMapping(\"/\", \"default\");\n+\n+        WebSocketContainer wsContainer =\n+                ContainerProvider.getWebSocketContainer();\n+\n+        tomcat.start();\n+\n+        Assert.assertEquals(LifecycleState.STARTED, ctx.getState());\n+\n+        SimpleClient client = new SimpleClient();\n+        URI uri = new URI(\"ws://localhost:\" + getPort() + \"/echoBasic\");\n+\n+        try (Session session = wsContainer.connectToServer(client, uri);) {\n+            CountDownLatch latch = new CountDownLatch(1);\n+            BasicText handler = new BasicText(latch);\n+            session.addMessageHandler(handler);\n+            session.getBasicRemote().sendText(\"echoBasic\");\n+\n+            boolean latchResult = handler.getLatch().await(10, TimeUnit.SECONDS);\n+            Assert.assertTrue(latchResult);\n+\n+            Queue<String> messages = handler.getMessages();\n+            Assert.assertEquals(1, messages.size());\n+            for (String message : messages) {\n+                Assert.assertEquals(\"echoBasic\", message);\n+            }\n+        }\n+    }\n+\n+\n     public static class Bug54807Config extends WsContextListener {\n \n         @Override",
                "additions": 47,
                "raw_url": "https://github.com/apache/tomcat80/raw/3225c197cc032b9a143f89999354a71fe943a65d/test/org/apache/tomcat/websocket/server/TestWsServerContainer.java",
                "status": "modified",
                "changes": 47,
                "deletions": 0,
                "sha": "558c70a9523f1b2d9a0a792c97680e6029ff8b26",
                "blob_url": "https://github.com/apache/tomcat80/blob/3225c197cc032b9a143f89999354a71fe943a65d/test/org/apache/tomcat/websocket/server/TestWsServerContainer.java",
                "filename": "test/org/apache/tomcat/websocket/server/TestWsServerContainer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/tomcat/websocket/server/TestWsServerContainer.java?ref=3225c197cc032b9a143f89999354a71fe943a65d"
            },
            {
                "patch": "@@ -103,7 +103,7 @@\n       <fix>\n         <bug>58192</bug>: Correct a regression in the previous fix for\n         <bug>58023</bug>. Ensure that classes are associated with their manifest\n-        even if the class file is frist read (and cached) without the manifest.\n+        even if the class file is first read (and cached) without the manifest.\n         (markt)\n       </fix>\n       <fix>\n@@ -123,7 +123,7 @@\n         <bug>58230</bug>: Fix input stream corruption if non-blocking I/O is\n         used and the first read is made immediately after the switch to async\n         mode rather than in response to <code>onDataAvaiable()</code> and that\n-        read does not read all the avaiable data. (markt)\n+        read does not read all the available data. (markt)\n       </fix>\n     </changelog>\n   </subsection>\n@@ -173,7 +173,7 @@\n       </fix>\n       <fix>\n         Following on from the fix for <bug>58178</bug>, expressions in a tag\n-        file should use the tag file&apos;s improts rather than those of the\n+        file should use the tag file&apos;s imports rather than those of the\n         containing page. (markt)\n       </fix>\n     </changelog>\n@@ -184,6 +184,12 @@\n         <bug>58166</bug>: Allow applications to send close codes in the range\n         3000-4999 inclusive. (markt)\n       </fix>\n+      <fix>\n+        <bug>58232</bug>: Avoid possible NPE when adding endpoints\n+        programmatically to the\n+        <code>javax.websocket.server.ServerContainer</code>.\n+        Based on a patch provided by bastian.(violetagg)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Web applications\">",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/3225c197cc032b9a143f89999354a71fe943a65d/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 12,
                "deletions": 3,
                "sha": "5cae80c0781bbd53f012a575a2fbe1fcf26bdcf7",
                "blob_url": "https://github.com/apache/tomcat80/blob/3225c197cc032b9a143f89999354a71fe943a65d/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=3225c197cc032b9a143f89999354a71fe943a65d"
            }
        ],
        "bug_id": "tomcat80_253",
        "parent": "https://github.com/apache/tomcat80/commit/ac1f1cbb4f3b79f1c7339be571fb140578a4a1bd",
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58232\nMerged revision 1695706 from tomcat/trunk:\nWhen ServerEndpointConfig is added programatically and the endpoint class that it provides is annotated, NPE is thrown while initializing HTTP upgrade handler. Based on a patch provided by bastian at diqube dot org\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1695721 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/0928dea7dcd4a3d47dc86e2c07e531e634c1af65",
        "file": [
            {
                "patch": "@@ -796,11 +796,10 @@ protected void initInternal() throws LifecycleException {\n         // Populate the extension validator with JARs from common and shared\n         // class loaders\n         if (getCatalina() != null) {\n-            ClassLoader cl =\n-                    getCatalina().getParentClassLoader();\n+            ClassLoader cl = getCatalina().getParentClassLoader();\n             // Walk the class loader hierarchy. Stop at the system class loader.\n             // This will add the shared (if present) and common class loaders\n-            while (cl != ClassLoader.getSystemClassLoader()) {\n+            while (cl != null && cl != ClassLoader.getSystemClassLoader()) {\n                 if (cl instanceof URLClassLoader) {\n                     URL[] urls = ((URLClassLoader) cl).getURLs();\n                     for (URL url : urls) {",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/0928dea7dcd4a3d47dc86e2c07e531e634c1af65/java/org/apache/catalina/core/StandardServer.java",
                "status": "modified",
                "changes": 5,
                "deletions": 3,
                "sha": "03e55db4548a48c4056ee2566f7f8d604968258e",
                "blob_url": "https://github.com/apache/tomcat80/blob/0928dea7dcd4a3d47dc86e2c07e531e634c1af65/java/org/apache/catalina/core/StandardServer.java",
                "filename": "java/org/apache/catalina/core/StandardServer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/StandardServer.java?ref=0928dea7dcd4a3d47dc86e2c07e531e634c1af65"
            }
        ],
        "bug_id": "tomcat80_254",
        "parent": "https://github.com/apache/tomcat80/commit/6aac98b55de378aed3aa3981d865038f624fce64",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52833\nFix NPE in some embedded / osgi scenarios where the class loader my not have the system class loader as a parent.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1305943 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/81e6985aa25f3dcdf3026660d1a7073e4255f5fd",
        "file": [
            {
                "patch": "@@ -718,6 +718,9 @@ protected boolean isWorkerAvailable() {\n     public boolean processSocket(NioChannel socket, SocketStatus status, boolean dispatch) {\n         try {\n             KeyAttachment attachment = (KeyAttachment)socket.getAttachment(false);\n+            if (attachment == null) {\n+                return false;\n+            }\n             attachment.setCometNotify(false); //will get reset upon next reg\n             SocketProcessor sc = processorCache.poll();\n             if ( sc == null ) sc = new SocketProcessor(socket,status);",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/81e6985aa25f3dcdf3026660d1a7073e4255f5fd/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "69bc1106843ae03eed563254c14cb625e5b3c360",
                "blob_url": "https://github.com/apache/tomcat80/blob/81e6985aa25f3dcdf3026660d1a7073e4255f5fd/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/NioEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/NioEndpoint.java?ref=81e6985aa25f3dcdf3026660d1a7073e4255f5fd"
            }
        ],
        "bug_id": "tomcat80_255",
        "parent": "https://github.com/apache/tomcat80/commit/17ee7f883891a59982150b3df26362d8198e107c",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52926\nProtect against a NPE if the socket has been closed on another thread\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1302837 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/6033526aa54a3b6ceb6a7d2f48db01a403f529a1",
        "file": [
            {
                "patch": "@@ -149,6 +149,7 @@ public void poolClosed(ConnectionPool pool) {\n     }\n \n     protected QueryStats getQueryStats(String sql) {\n+        if (sql==null) sql = \"\";\n         ConcurrentHashMap<String,QueryStats> queries = SlowQueryReport.this.queries;\n         if (queries==null) return null;\n         QueryStats qs = queries.get(sql);",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/6033526aa54a3b6ceb6a7d2f48db01a403f529a1/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "585ea18bbf4e370d323ed1ccee655761255a00b9",
                "blob_url": "https://github.com/apache/tomcat80/blob/6033526aa54a3b6ceb6a7d2f48db01a403f529a1/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java",
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java?ref=6033526aa54a3b6ceb6a7d2f48db01a403f529a1"
            }
        ],
        "bug_id": "tomcat80_256",
        "parent": "https://github.com/apache/tomcat80/commit/8cc3df2973be5f564bbbc1a8f0c5ff51e41da5ae",
        "message": "https://issues.apache.org/bugzilla/show_bug.cgi?id=51582\nFix NPE when the query is not available. This is a temporary work around until we know why SQL is null\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1189978 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/81be4f6f86eca01102721a3b5de6913b5ef6eb49",
        "file": [
            {
                "patch": "@@ -423,11 +423,6 @@ protected void populateAnnotationsCache(Class<?> clazz,\n                             new WeakReference<List<AnnotationCacheEntry>>(\n                                     annotations));\n                 }\n-            } else {\n-                // If the annotations for this class have been cached, the\n-                // annotations for all the super classes will have been cachced\n-                // as well\n-                break;\n             }\n             clazz = clazz.getSuperclass();\n         }",
                "additions": 0,
                "raw_url": "https://github.com/apache/tomcat80/raw/81be4f6f86eca01102721a3b5de6913b5ef6eb49/java/org/apache/catalina/core/DefaultInstanceManager.java",
                "status": "modified",
                "changes": 5,
                "deletions": 5,
                "sha": "eaac06f76936b5d27e37ac7727e42ee140deaf3b",
                "blob_url": "https://github.com/apache/tomcat80/blob/81be4f6f86eca01102721a3b5de6913b5ef6eb49/java/org/apache/catalina/core/DefaultInstanceManager.java",
                "filename": "java/org/apache/catalina/core/DefaultInstanceManager.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/DefaultInstanceManager.java?ref=81be4f6f86eca01102721a3b5de6913b5ef6eb49"
            }
        ],
        "bug_id": "tomcat80_257",
        "parent": "https://github.com/apache/tomcat80/commit/1cbec226c87bda22f05d792e47847e793b24447a",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52042\nCorrect threading issue in annotation caching that could lead to an\nNPE if multiple threads were processing the same class hierarchy for\nannotations\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1186042 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/63a92a6343e2c5574e184a3be7350e7463290a4c",
        "file": [
            {
                "patch": "@@ -249,6 +249,10 @@ public boolean event(org.apache.coyote.Request req,\n             req.getRequestProcessor().setWorkerThreadName(null);\n             // Recycle the wrapper request and response\n             if (error || response.isClosed() || !request.isComet()) {\n+                ((Context) request.getMappingData().context).logAccess(\n+                        request, response,\n+                        System.currentTimeMillis() - req.getStartTime(),\n+                        false);\n                 request.recycle();\n                 request.setFilterChain(null);\n                 response.recycle();\n@@ -430,9 +434,12 @@ public void service(org.apache.coyote.Request req,\n             } else if (!comet) {\n                 request.finishRequest();\n                 response.finishResponse();\n-                if (postParseSuccess) {\n+                if (postParseSuccess &&\n+                        request.getMappingData().context != null) {\n                     // Log only if processing was invoked.\n                     // If postParseRequest() failed, it has already logged it.\n+                    // If context is null this was the start of a comet request\n+                    // that failed and has already been logged.\n                     ((Context) request.getMappingData().context).logAccess(\n                             request, response,\n                             System.currentTimeMillis() - req.getStartTime(),",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/63a92a6343e2c5574e184a3be7350e7463290a4c/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "status": "modified",
                "changes": 9,
                "deletions": 1,
                "sha": "e38fcdcb86439a4f0301e5c575e4ca0bb12f03b4",
                "blob_url": "https://github.com/apache/tomcat80/blob/63a92a6343e2c5574e184a3be7350e7463290a4c/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "filename": "java/org/apache/catalina/connector/CoyoteAdapter.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/CoyoteAdapter.java?ref=63a92a6343e2c5574e184a3be7350e7463290a4c"
            },
            {
                "patch": "@@ -36,12 +36,14 @@\n import org.junit.Test;\n \n import org.apache.catalina.Context;\n+import org.apache.catalina.Wrapper;\n import org.apache.catalina.comet.CometEvent.EventType;\n import org.apache.catalina.connector.CometEventImpl;\n import org.apache.catalina.connector.Request;\n import org.apache.catalina.connector.Response;\n import org.apache.catalina.startup.Tomcat;\n import org.apache.catalina.startup.TomcatBaseTest;\n+import org.apache.catalina.valves.TesterAccessLogValve;\n import org.apache.catalina.valves.ValveBase;\n \n public class TestCometProcessor extends TomcatBaseTest {\n@@ -116,16 +118,41 @@ public void testAsyncClose() throws Exception {\n \n     @Test\n     public void testSimpleCometClient() throws Exception {\n+        doSimpleCometTest(null);\n+    }\n+\n+    @Test\n+    public void testSimpleCometClientBeginFail() throws Exception {\n+        doSimpleCometTest(SimpleCometServlet.FAIL_ON_BEGIN);\n+    }\n \n+    @Test\n+    public void testSimpleCometClientReadFail() throws Exception {\n+        doSimpleCometTest(SimpleCometServlet.FAIL_ON_READ);\n+    }\n+\n+    @Test\n+    public void testSimpleCometClientEndFail() throws Exception {\n+        doSimpleCometTest(SimpleCometServlet.FAIL_ON_END);\n+    }\n+\n+    private void doSimpleCometTest(String initParam) throws Exception {\n         if (!isCometSupported()) {\n             return;\n         }\n \n         // Setup Tomcat instance\n         Tomcat tomcat = getTomcatInstance();\n         Context root = tomcat.addContext(\"\", TEMP_DIR);\n-        Tomcat.addServlet(root, \"comet\", new SimpleCometServlet());\n+        Wrapper w = Tomcat.addServlet(root, \"comet\", new SimpleCometServlet());\n+        if (initParam != null) {\n+            w.addInitParameter(initParam, \"true\");\n+        }\n         root.addServletMapping(\"/\", \"comet\");\n+\n+        TesterAccessLogValve alv = new TesterAccessLogValve();\n+        root.getPipeline().addValve(alv);\n+\n         tomcat.start();\n \n         // Create connection to Comet servlet\n@@ -151,36 +178,51 @@ public void testSimpleCometClient() throws Exception {\n         os.close();\n         is.close();\n \n-        // Validate response\n         String[] response = readThread.getResponse().split(\"\\r\\n\");\n-        assertEquals(\"HTTP/1.1 200 OK\", response[0]);\n-        assertEquals(\"Server: Apache-Coyote/1.1\", response[1]);\n-        assertTrue(response[2].startsWith(\"Set-Cookie: JSESSIONID=\"));\n-        assertEquals(\"Content-Type: text/plain;charset=ISO-8859-1\", response[3]);\n-        assertEquals(\"Transfer-Encoding: chunked\", response[4]);\n-        assertTrue(response[5].startsWith(\"Date: \"));\n-        assertEquals(\"\", response[6]);\n-        assertEquals(\"7\", response[7]);\n-        assertEquals(\"BEGIN\", response[8]);\n-        assertEquals(\"\", response[9]);\n-        assertEquals(\"17\", response[10]);\n-        assertEquals(\"Client: READ: 4 bytes\", response[11]);\n-        assertEquals(\"\", response[12]);\n-        assertEquals(\"17\", response[13]);\n-        assertEquals(\"Client: READ: 4 bytes\", response[14]);\n-        assertEquals(\"\", response[15]);\n-        assertEquals(\"17\", response[16]);\n-        assertEquals(\"Client: READ: 4 bytes\", response[17]);\n-        assertEquals(\"\", response[18]);\n-        assertEquals(\"17\", response[19]);\n-        assertEquals(\"Client: READ: 4 bytes\", response[20]);\n-        assertEquals(\"\", response[21]);\n-        assertEquals(\"d\", response[22]);\n-        assertEquals(\"Client: END\", response[23]);\n-        assertEquals(\"\", response[24]);\n-        assertEquals(\"0\", response[25]);\n-        // Expect 26 lines\n-        assertEquals(26, response.length);\n+        if (initParam == null) {\n+            // Normal response expected\n+            // Validate response\n+            assertEquals(\"HTTP/1.1 200 OK\", response[0]);\n+            assertEquals(\"Server: Apache-Coyote/1.1\", response[1]);\n+            assertTrue(response[2].startsWith(\"Set-Cookie: JSESSIONID=\"));\n+            assertEquals(\"Content-Type: text/plain;charset=ISO-8859-1\", response[3]);\n+            assertEquals(\"Transfer-Encoding: chunked\", response[4]);\n+            assertTrue(response[5].startsWith(\"Date: \"));\n+            assertEquals(\"\", response[6]);\n+            assertEquals(\"7\", response[7]);\n+            assertEquals(\"BEGIN\", response[8]);\n+            assertEquals(\"\", response[9]);\n+            assertEquals(\"17\", response[10]);\n+            assertEquals(\"Client: READ: 4 bytes\", response[11]);\n+            assertEquals(\"\", response[12]);\n+            assertEquals(\"17\", response[13]);\n+            assertEquals(\"Client: READ: 4 bytes\", response[14]);\n+            assertEquals(\"\", response[15]);\n+            assertEquals(\"17\", response[16]);\n+            assertEquals(\"Client: READ: 4 bytes\", response[17]);\n+            assertEquals(\"\", response[18]);\n+            assertEquals(\"17\", response[19]);\n+            assertEquals(\"Client: READ: 4 bytes\", response[20]);\n+            assertEquals(\"\", response[21]);\n+            assertEquals(\"d\", response[22]);\n+            assertEquals(\"Client: END\", response[23]);\n+            assertEquals(\"\", response[24]);\n+            assertEquals(\"0\", response[25]);\n+            // Expect 26 lines\n+            assertEquals(26, response.length);\n+        } else {\n+            // Failure expected only expected for the fail on begin\n+            // Failure at any later stage and the reponse headers (including the\n+            // 200 response code will already have been sent to the client\n+            if (initParam == SimpleCometServlet.FAIL_ON_BEGIN) {\n+                assertEquals(\"HTTP/1.1 500 Internal Server Error\", response[0]);\n+                alv.validateAccessLog(1, 500, 0, 1000);\n+            } else {\n+                assertEquals(\"HTTP/1.1 200 OK\", response[0]);\n+                alv.validateAccessLog(1, 200, 0, 5000);\n+            }\n+\n+        }\n     }\n \n     /**\n@@ -267,6 +309,26 @@ private boolean isCometSupported() {\n \n         private static final long serialVersionUID = 1L;\n \n+        public static final String FAIL_ON_BEGIN = \"failOnBegin\";\n+        public static final String FAIL_ON_READ = \"failOnRead\";\n+        public static final String FAIL_ON_END = \"failOnEnd\";\n+\n+        private boolean failOnBegin = false;\n+        private boolean failOnRead = false;\n+        private boolean failOnEnd = false;\n+\n+\n+        @Override\n+        public void init() throws ServletException {\n+            failOnBegin = Boolean.valueOf(getServletConfig().getInitParameter(\n+                    FAIL_ON_BEGIN)).booleanValue();\n+            failOnRead = Boolean.valueOf(getServletConfig().getInitParameter(\n+                    FAIL_ON_READ)).booleanValue();\n+            failOnEnd = Boolean.valueOf(getServletConfig().getInitParameter(\n+                    FAIL_ON_END)).booleanValue();\n+        }\n+\n+\n         @Override\n         public void event(CometEvent event) throws IOException,\n                 ServletException {\n@@ -278,9 +340,15 @@ public void event(CometEvent event) throws IOException,\n             session.setMaxInactiveInterval(30);\n \n             if (event.getEventType() == EventType.BEGIN) {\n+                if (failOnBegin) {\n+                    throw new IOException(\"Fail on begin\");\n+                }\n                 response.setContentType(\"text/plain\");\n                 response.getWriter().print(\"BEGIN\" + \"\\r\\n\");\n             } else if (event.getEventType() == EventType.READ) {\n+                if (failOnRead) {\n+                    throw new IOException(\"Fail on read\");\n+                }\n                 InputStream is = request.getInputStream();\n                 int count = 0;\n                 while (is.available() > 0) {\n@@ -290,6 +358,9 @@ public void event(CometEvent event) throws IOException,\n                 String msg = \"READ: \" + count + \" bytes\";\n                 response.getWriter().print(\"Client: \" + msg + \"\\r\\n\");\n             } else if (event.getEventType() == EventType.END) {\n+                if (failOnEnd) {\n+                    throw new IOException(\"Fail on end\");\n+                }\n                 String msg = \"END\";\n                 response.getWriter().print(\"Client: \" + msg + \"\\r\\n\");\n                 event.close();",
                "additions": 101,
                "raw_url": "https://github.com/apache/tomcat80/raw/63a92a6343e2c5574e184a3be7350e7463290a4c/test/org/apache/catalina/comet/TestCometProcessor.java",
                "status": "modified",
                "changes": 131,
                "deletions": 30,
                "sha": "481bdd3bf4243671392c32ca3c96670c4953f6fc",
                "blob_url": "https://github.com/apache/tomcat80/blob/63a92a6343e2c5574e184a3be7350e7463290a4c/test/org/apache/catalina/comet/TestCometProcessor.java",
                "filename": "test/org/apache/catalina/comet/TestCometProcessor.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/comet/TestCometProcessor.java?ref=63a92a6343e2c5574e184a3be7350e7463290a4c"
            }
        ],
        "bug_id": "tomcat80_258",
        "parent": "https://github.com/apache/tomcat80/commit/660456b211bf806107fdc23632f4b53e99a64534",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52009\nFix the NPE if an error occurs during comet processing\nAdd test cases for errors during comet processing\nEnsure access log entries are made if an error occurs\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1183494 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/b5d40104595e08ddaff20a592c4387049126301a",
        "file": [
            {
                "patch": "@@ -500,7 +500,7 @@ public void log(org.apache.coyote.Request req,\n                             request, response, time, true);\n                 } else if (request.mappingData.host != null) {\n                     logged = true;\n-                    ((Context) request.mappingData.context).logAccess(\n+                    ((Host) request.mappingData.host).logAccess(\n                             request, response, time, true);\n                 }\n             }",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/b5d40104595e08ddaff20a592c4387049126301a/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "428868164369c064569838e5b54b2554ca35dbf3",
                "blob_url": "https://github.com/apache/tomcat80/blob/b5d40104595e08ddaff20a592c4387049126301a/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "filename": "java/org/apache/catalina/connector/CoyoteAdapter.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/CoyoteAdapter.java?ref=b5d40104595e08ddaff20a592c4387049126301a"
            }
        ],
        "bug_id": "tomcat80_259",
        "parent": "https://github.com/apache/tomcat80/commit/b45452785335a2c442abfb59348e80fbc0ea7594",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51658\nFix copy/paste error that could trigger an NPE.\nBased on a suggestion by Felix Schumacher\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1158155 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/9d283b20e0ab05a1fdeb03fa38016ebda7bfedf0",
        "file": [
            {
                "patch": "@@ -180,7 +180,12 @@ public final void invoke(Request request, Response response)\n             // place\n             if (!(request.isAsync() || (asyncAtStart && request.getAttribute(\n                         RequestDispatcher.ERROR_EXCEPTION) != null))) {\n-                context.fireRequestDestroyEvent(request);\n+                // Protect against NPEs if context was destroyed during a long\n+                // running request.\n+                StandardContext c = context;\n+                if (c != null && c.getState().isAvailable()) {\n+                    context.fireRequestDestroyEvent(request);\n+                }\n             }\n         }\n     }",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/9d283b20e0ab05a1fdeb03fa38016ebda7bfedf0/java/org/apache/catalina/core/StandardContextValve.java",
                "status": "modified",
                "changes": 7,
                "deletions": 1,
                "sha": "bdaa792ab11237d98d17cd66b56209d752e6ecf4",
                "blob_url": "https://github.com/apache/tomcat80/blob/9d283b20e0ab05a1fdeb03fa38016ebda7bfedf0/java/org/apache/catalina/core/StandardContextValve.java",
                "filename": "java/org/apache/catalina/core/StandardContextValve.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/StandardContextValve.java?ref=9d283b20e0ab05a1fdeb03fa38016ebda7bfedf0"
            },
            {
                "patch": "@@ -62,6 +62,11 @@\n       <fix>\n         Fix regression in year number formatting for AccessLogValve. (rjung)\n       </fix>\n+      <fix>\n+        <bug>51494</bug>: Prevent an NPE when a long running request completes\n+        if the associated web application was destroyed while the request was\n+        processing. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/9d283b20e0ab05a1fdeb03fa38016ebda7bfedf0/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "14c653f640a29cfff860283405bc421e42092ba4",
                "blob_url": "https://github.com/apache/tomcat80/blob/9d283b20e0ab05a1fdeb03fa38016ebda7bfedf0/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=9d283b20e0ab05a1fdeb03fa38016ebda7bfedf0"
            }
        ],
        "bug_id": "tomcat80_260",
        "parent": "https://github.com/apache/tomcat80/commit/114e9adfb588e664934c09a1822b108786b16234",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51494\nPrevent an NPE when a long running request completes if the associated web application was destroyed while the request was processing\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1145160 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/2d13074fe9080148395447aee5c26bb1266e6f56",
        "file": [
            {
                "patch": "@@ -48,6 +48,7 @@\n import org.apache.juli.logging.Log;\n import org.apache.juli.logging.LogFactory;\n import org.apache.tomcat.InstanceManager;\n+import org.apache.tomcat.util.res.StringManager;\n /**\n  * \n  * @author fhanik\n@@ -57,6 +58,9 @@\n     \n     private static final Log log = LogFactory.getLog(AsyncContextImpl.class);\n     \n+    protected static final StringManager sm =\n+        StringManager.getManager(Constants.Package);\n+\n     private ServletRequest servletRequest = null;\n     private ServletResponse servletResponse = null;\n     private List<AsyncListenerWrapper> listeners = new ArrayList<AsyncListenerWrapper>();\n@@ -80,6 +84,7 @@ public void complete() {\n         if (log.isDebugEnabled()) {\n             logDebug(\"complete   \");\n         }\n+        check();\n         request.getCoyoteRequest().action(ActionCode.COMMIT, null);\n         request.getCoyoteRequest().action(ActionCode.ASYNC_COMPLETE, null);\n     }\n@@ -126,6 +131,7 @@ public boolean timeout() throws IOException {\n \n     @Override\n     public void dispatch() {\n+        check();\n         HttpServletRequest sr = (HttpServletRequest)getRequest();\n         String path = sr.getRequestURI();\n         String cpath = sr.getContextPath();\n@@ -135,6 +141,7 @@ public void dispatch() {\n \n     @Override\n     public void dispatch(String path) {\n+        check();\n         dispatch(request.getServletContext(),path);\n     }\n \n@@ -143,6 +150,7 @@ public void dispatch(ServletContext context, String path) {\n         if (log.isDebugEnabled()) {\n             logDebug(\"dispatch   \");\n         }\n+        check();\n         if (request.getAttribute(ASYNC_REQUEST_URI)==null) {\n             request.setAttribute(ASYNC_REQUEST_URI, request.getRequestURI()+\"?\"+request.getQueryString());\n             request.setAttribute(ASYNC_CONTEXT_PATH, request.getContextPath());\n@@ -178,11 +186,13 @@ public void run() {\n \n     @Override\n     public ServletRequest getRequest() {\n+        check();\n         return servletRequest;\n     }\n \n     @Override\n     public ServletResponse getResponse() {\n+        check();\n         return servletResponse;\n     }\n \n@@ -191,13 +201,14 @@ public void start(final Runnable run) {\n         if (log.isDebugEnabled()) {\n             logDebug(\"start      \");\n         }\n-\n+        check();\n         Runnable wrapper = new RunnableWrapper(run, context);\n         this.request.getCoyoteRequest().action(ActionCode.ASYNC_RUN, wrapper);\n     }\n     \n     @Override\n     public void addListener(AsyncListener listener) {\n+        check();\n         AsyncListenerWrapper wrapper = new AsyncListenerWrapper();\n         wrapper.setListener(listener);\n         listeners.add(wrapper);\n@@ -206,6 +217,7 @@ public void addListener(AsyncListener listener) {\n     @Override\n     public void addListener(AsyncListener listener, ServletRequest servletRequest,\n             ServletResponse servletResponse) {\n+        check();\n         AsyncListenerWrapper wrapper = new AsyncListenerWrapper();\n         wrapper.setListener(listener);\n         listeners.add(wrapper);\n@@ -215,6 +227,7 @@ public void addListener(AsyncListener listener, ServletRequest servletRequest,\n     @Override\n     public <T extends AsyncListener> T createListener(Class<T> clazz)\n             throws ServletException {\n+        check();\n         T listener = null;\n         try {\n              listener = (T) getInstanceManager().newInstance(clazz.getName(),\n@@ -242,12 +255,16 @@ public void recycle() {\n         if (log.isDebugEnabled()) {\n             logDebug(\"recycle    \");\n         }\n+        context = null;\n+        dispatch = null;\n+        event = null;\n+        hasOriginalRequestAndResponse = true;\n+        instanceManager = null;\n+        listeners.clear();\n+        request = null;\n         servletRequest = null;\n         servletResponse = null;\n-        hasOriginalRequestAndResponse = true;\n-        context = null;\n         timeout = -1;\n-        event = null;\n     }\n \n     public boolean isStarted() {\n@@ -285,6 +302,7 @@ public void setStarted(Context context, ServletRequest request,\n \n     @Override\n     public boolean hasOriginalRequestAndResponse() {\n+        check();\n         return hasOriginalRequestAndResponse;\n     }\n \n@@ -309,12 +327,14 @@ protected void doInternalDispatch() throws ServletException, IOException {\n     \n     @Override\n     public long getTimeout() {\n+        check();\n         return timeout;\n     }\n \n \n     @Override\n     public void setTimeout(long timeout) {\n+        check();\n         this.timeout = timeout;\n         request.getCoyoteRequest().action(ActionCode.ASYNC_SETTIMEOUT,\n                 Long.valueOf(timeout));\n@@ -407,6 +427,13 @@ private InstanceManager getInstanceManager() {\n         return instanceManager;\n     }\n \n+    private void check() {\n+        if (request == null) {\n+            // AsyncContext has been recycled and should not be being used\n+            throw new IllegalStateException(sm.getString(\n+                    \"asyncContextImpl.requestEnded\"));\n+        }\n+    }\n     private static class DebugException extends Exception {\n         private static final long serialVersionUID = 1L;\n     }",
                "additions": 31,
                "raw_url": "https://github.com/apache/tomcat80/raw/2d13074fe9080148395447aee5c26bb1266e6f56/java/org/apache/catalina/core/AsyncContextImpl.java",
                "status": "modified",
                "changes": 35,
                "deletions": 4,
                "sha": "2e6d6e0ca33eb2b9d77e6d8340e97788d2b1e188",
                "blob_url": "https://github.com/apache/tomcat80/blob/2d13074fe9080148395447aee5c26bb1266e6f56/java/org/apache/catalina/core/AsyncContextImpl.java",
                "filename": "java/org/apache/catalina/core/AsyncContextImpl.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/AsyncContextImpl.java?ref=2d13074fe9080148395447aee5c26bb1266e6f56"
            },
            {
                "patch": "@@ -59,6 +59,7 @@ aprListener.aprDestroy=Failed shutdown of APR based Apache Tomcat Native library\n aprListener.sslInit=Failed to initialize the SSLEngine.\n aprListener.tcnValid=Loaded APR based Apache Tomcat Native library {0}.\n aprListener.flags=APR capabilities: IPv6 [{0}], sendfile [{1}], accept filters [{2}], random [{3}].\n+asyncContextImpl.requestEnded=The request associated with the AsyncContext has already completed processing.\n containerBase.alreadyStarted=Container {0} has already been started\n containerBase.notConfigured=No basic Valve has been configured\n containerBase.notStarted=Container {0} has not been started",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/2d13074fe9080148395447aee5c26bb1266e6f56/java/org/apache/catalina/core/LocalStrings.properties",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "f49e83198edb8ca1d7ceb9a96a9fdd053804ec61",
                "blob_url": "https://github.com/apache/tomcat80/blob/2d13074fe9080148395447aee5c26bb1266e6f56/java/org/apache/catalina/core/LocalStrings.properties",
                "filename": "java/org/apache/catalina/core/LocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/LocalStrings.properties?ref=2d13074fe9080148395447aee5c26bb1266e6f56"
            }
        ],
        "bug_id": "tomcat80_261",
        "parent": "https://github.com/apache/tomcat80/commit/c616e9e1211ddaff0e72a1de06fdd885de6beb4c",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50353\nRather than the eventual NPE, throw an ISE if an application attempts to access an AsyncContext after the request processing has ended.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1140738 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/44225d31bd2f27e5e87ea9c49ef6252b63ccbefa",
        "file": [
            {
                "patch": "@@ -1385,7 +1385,7 @@ protected void handleSESSION_CREATED(SessionMessage msg,Member sender) {\n         session.setPrimarySession(false);\n         session.setCreationTime(msg.getTimestamp());\n         // use container maxInactiveInterval so that session will expire correctly in case of primary transfer\n-        session.setMaxInactiveInterval(getMaxInactiveInterval());\n+        session.setMaxInactiveInterval(getMaxInactiveInterval(), false);\n         session.access();\n         session.setId(msg.getSessionID(), notifySessionListenersOnReplication);\n         session.resetDeltaRequest();",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/44225d31bd2f27e5e87ea9c49ef6252b63ccbefa/java/org/apache/catalina/ha/session/DeltaManager.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "9521272258c7bc32d4cb556d49f9d15d675da8d2",
                "blob_url": "https://github.com/apache/tomcat80/blob/44225d31bd2f27e5e87ea9c49ef6252b63ccbefa/java/org/apache/catalina/ha/session/DeltaManager.java",
                "filename": "java/org/apache/catalina/ha/session/DeltaManager.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/ha/session/DeltaManager.java?ref=44225d31bd2f27e5e87ea9c49ef6252b63ccbefa"
            },
            {
                "patch": "@@ -429,7 +429,7 @@ public void expire(boolean notify, boolean notifyCluster) {\n             return;\n         String expiredId = getIdInternal();\n \n-        if(expiredId != null && manager != null &&\n+        if(notifyCluster && expiredId != null && manager != null &&\n            manager instanceof DeltaManager) {\n             DeltaManager dmanager = (DeltaManager)manager;\n             CatalinaCluster cluster = dmanager.getCluster();",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/44225d31bd2f27e5e87ea9c49ef6252b63ccbefa/java/org/apache/catalina/ha/session/DeltaSession.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "acea43272dc10634b12d19e681389013d4240afa",
                "blob_url": "https://github.com/apache/tomcat80/blob/44225d31bd2f27e5e87ea9c49ef6252b63ccbefa/java/org/apache/catalina/ha/session/DeltaSession.java",
                "filename": "java/org/apache/catalina/ha/session/DeltaSession.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/ha/session/DeltaSession.java?ref=44225d31bd2f27e5e87ea9c49ef6252b63ccbefa"
            },
            {
                "patch": "@@ -55,6 +55,14 @@\n       </fix>\n     </changelog>\n   </subsection>\n+  <subsection name=\"Cluster\">\n+    <changelog>\n+      <fix>\n+        <bug>51306</bug>: Avoid NPE when handleSESSION_EXPIRED is processed \n+        while handleSESSION_CREATED is being processed. (kfujino)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection>\n     <changelog name=\"Web applications\">\n       <fix>",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/44225d31bd2f27e5e87ea9c49ef6252b63ccbefa/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 8,
                "deletions": 0,
                "sha": "ffb336a39ca6c10cfcf80cf440e81484e9322d55",
                "blob_url": "https://github.com/apache/tomcat80/blob/44225d31bd2f27e5e87ea9c49ef6252b63ccbefa/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=44225d31bd2f27e5e87ea9c49ef6252b63ccbefa"
            }
        ],
        "bug_id": "tomcat80_262",
        "parent": "https://github.com/apache/tomcat80/commit/4e45764435d92b4f945fc4f8471a5b02a85c8b01",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51306.\nAvoid NPE when handleSESSION_EXPIRED is processed while handleSESSION_CREATED is being processed. \n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1135069 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/ea07f70b66e4fcb6b0b0370d23dba4f8680fab04",
        "file": [
            {
                "patch": "@@ -122,7 +122,12 @@ public Object invoke(Object proxy, Method method, Object[] args) throws Throwabl\n             return this.isWrapperFor((Class<?>)args[0]);\n         }\n         try {\n-            return method.invoke(connection.getConnection(),args);\n+            PooledConnection poolc = connection;\n+            if (poolc!=null) {\n+                return method.invoke(poolc.getConnection(),args);    \n+            } else {\n+                throw new SQLException(\"Connection has already been closed.\");\n+            }\n         }catch (Throwable t) {\n             if (t instanceof InvocationTargetException) {\n                 InvocationTargetException it = (InvocationTargetException)t;",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/ea07f70b66e4fcb6b0b0370d23dba4f8680fab04/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ProxyConnection.java",
                "status": "modified",
                "changes": 7,
                "deletions": 1,
                "sha": "76d17e34146dc43ddcd1002ef68266efbf4b0d68",
                "blob_url": "https://github.com/apache/tomcat80/blob/ea07f70b66e4fcb6b0b0370d23dba4f8680fab04/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ProxyConnection.java",
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ProxyConnection.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ProxyConnection.java?ref=ea07f70b66e4fcb6b0b0370d23dba4f8680fab04"
            }
        ],
        "bug_id": "tomcat80_263",
        "parent": "https://github.com/apache/tomcat80/commit/95833d622d78f4db6dc4759b2a22eea3d9d57e2a",
        "message": "Fix NPE that can happen during concurrency (connection being abandoned, misconfiguration in abandon timeout or lack of ResetAbandonedTimer interceptor)\nhttp://markmail.org/message/yhshyvyunddb5ngt\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1087442 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/17e0afc236b6307c2d42500724adf5565576dd8b",
        "file": [
            {
                "patch": "@@ -626,10 +626,15 @@ public void visit(Node.CustomTag n) throws JasperException {\n                         compiler.getCompilationContext().getTldLocation(\n                             tagFileInfo.getTagInfo().getTagLibrary().getURI());\n                     JarResource jarResource = location.getJarResource();\n-                    // Add TLD\n-                    pageInfo.addDependant(jarResource.getEntry(location.getName()).toString());\n-                    // Add Tag\n-                    pageInfo.addDependant(jarResource.getEntry(tagFilePath.substring(1)).toString());\n+                    if (jarResource != null) {\n+                        // Add TLD\n+                        pageInfo.addDependant(jarResource.getEntry(location.getName()).toString());\n+                        // Add Tag\n+                        pageInfo.addDependant(jarResource.getEntry(tagFilePath.substring(1)).toString());\n+                    }\n+                    else {\n+                        pageInfo.addDependant(tagFilePath);\n+                    }\n                 } else {\n                     pageInfo.addDependant(tagFilePath);\n                 }",
                "additions": 9,
                "raw_url": "https://github.com/apache/tomcat80/raw/17e0afc236b6307c2d42500724adf5565576dd8b/java/org/apache/jasper/compiler/TagFileProcessor.java",
                "status": "modified",
                "changes": 13,
                "deletions": 4,
                "sha": "9da39788c3bea208f323c865fc80f5449f5d8a7d",
                "blob_url": "https://github.com/apache/tomcat80/blob/17e0afc236b6307c2d42500724adf5565576dd8b/java/org/apache/jasper/compiler/TagFileProcessor.java",
                "filename": "java/org/apache/jasper/compiler/TagFileProcessor.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/TagFileProcessor.java?ref=17e0afc236b6307c2d42500724adf5565576dd8b"
            },
            {
                "patch": "@@ -150,6 +150,11 @@\n         Improve error message when EL identifiers are not valid Java identifiers\n         and use i18n for the error message. (markt)\n       </update>\n+      <fix>\n+        <bug>50680</bug>: Prevent an NPE when using tag files from an exploded\n+        JAR file, e.g. from within an IDE. Patch provided by Larry Isaacs.\n+        (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Cluster\">",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/17e0afc236b6307c2d42500724adf5565576dd8b/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "957e3473b5caf424e2380c017a51fa603b67b850",
                "blob_url": "https://github.com/apache/tomcat80/blob/17e0afc236b6307c2d42500724adf5565576dd8b/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=17e0afc236b6307c2d42500724adf5565576dd8b"
            }
        ],
        "bug_id": "tomcat80_264",
        "parent": "https://github.com/apache/tomcat80/commit/c572d34e4fe3ba61294206156d0e936b6e494fe4",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50680\nPrevent an NPE when using tag files from an exploded JAR file, e.g. from within an IDE.\nPatch provided by Larry Isaacs.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1064890 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/c5ff1950c3dcc3b1579aa54d8983b66a3007a23a",
        "file": [
            {
                "patch": "@@ -224,7 +224,7 @@ private boolean isAllowed(String property) {\n         }\n      \n         // Check the allow patterns, if any\n-        if (allow != null & allow.matcher(property).matches()) {\n+        if (allow != null && allow.matcher(property).matches()) {\n             return true;\n         }\n ",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/c5ff1950c3dcc3b1579aa54d8983b66a3007a23a/java/org/apache/catalina/filters/RequestFilter.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "a417ebc2c925fb4ca2be229a045ed203b8d4e37f",
                "blob_url": "https://github.com/apache/tomcat80/blob/c5ff1950c3dcc3b1579aa54d8983b66a3007a23a/java/org/apache/catalina/filters/RequestFilter.java",
                "filename": "java/org/apache/catalina/filters/RequestFilter.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/filters/RequestFilter.java?ref=c5ff1950c3dcc3b1579aa54d8983b66a3007a23a"
            },
            {
                "patch": "@@ -62,6 +62,9 @@\n         Provide additional control over component class loaders, primarily for\n         use when embedding. (markt)\n       </add>\n+      <fix>\n+        Fix NPE in RemoteAddrFilter, RemoteHostFilter. (kkolinko)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Jasper\">",
                "additions": 3,
                "raw_url": "https://github.com/apache/tomcat80/raw/c5ff1950c3dcc3b1579aa54d8983b66a3007a23a/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 3,
                "deletions": 0,
                "sha": "0c1d8bbce24808f274ddb1b131cce07d6534447f",
                "blob_url": "https://github.com/apache/tomcat80/blob/c5ff1950c3dcc3b1579aa54d8983b66a3007a23a/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=c5ff1950c3dcc3b1579aa54d8983b66a3007a23a"
            }
        ],
        "bug_id": "tomcat80_265",
        "parent": "https://github.com/apache/tomcat80/commit/3a189f9970bfd7d10b2a67d4fe40ab76feb88ecc",
        "message": "Correct a typo in RequestFilter, that would lead to an NPE in RemoteAddrFilter, RemoteHostFilter when \"allow\" attribute is empty.\nThe RequestFilterValve class is not affected by this issue.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1059409 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/208c18d4e6c980fe5b6676a93e2cac3a13a2ebec",
        "file": [
            {
                "patch": "@@ -1760,9 +1760,13 @@ public void setNamingResources(NamingResources namingResources) {\n         support.firePropertyChange(\"namingResources\",\n                                    oldNamingResources, this.namingResources);\n         \n-        unregister(onameNamingResources);\n-        onameNamingResources = register(namingResources,\n-                \"type=NamingResources,\" + getObjectKeyPropertiesNameOnly());\n+        // If set from server.xml, getObjectKeyPropertiesNameOnly() will\n+        // trigger an NPE. Initial registration takes place on INIT. \n+        if (getState() != LifecycleState.NEW) {\n+            unregister(onameNamingResources);\n+            onameNamingResources = register(namingResources,\n+                    \"type=NamingResources,\" + getObjectKeyPropertiesNameOnly());\n+        }\n     }\n \n ",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/208c18d4e6c980fe5b6676a93e2cac3a13a2ebec/java/org/apache/catalina/core/StandardContext.java",
                "status": "modified",
                "changes": 10,
                "deletions": 3,
                "sha": "e810ebf38dba7291a070d21b9eac83438571cf5e",
                "blob_url": "https://github.com/apache/tomcat80/blob/208c18d4e6c980fe5b6676a93e2cac3a13a2ebec/java/org/apache/catalina/core/StandardContext.java",
                "filename": "java/org/apache/catalina/core/StandardContext.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/StandardContext.java?ref=208c18d4e6c980fe5b6676a93e2cac3a13a2ebec"
            },
            {
                "patch": "@@ -103,6 +103,10 @@\n         <bug>50017</bug>: Code clean-up. No functional change. Patch provided by\n         sebb. (markt)\n       </update>\n+      <fix>\n+        <bug>50027</bug>: Avoid NPE on start when a Context is defined in\n+        server.xml with one or more JNDI resources. (markt)\n+      </fix>\n       <fix>\n         <bug>50059</bug>: JARs should always be searched for static resources\n         even if the web application is marked as meta-data complete. (markt)",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/208c18d4e6c980fe5b6676a93e2cac3a13a2ebec/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "9175867b56af57c14d57ae5d8a1b9d882f578dc3",
                "blob_url": "https://github.com/apache/tomcat80/blob/208c18d4e6c980fe5b6676a93e2cac3a13a2ebec/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=208c18d4e6c980fe5b6676a93e2cac3a13a2ebec"
            }
        ],
        "bug_id": "tomcat80_266",
        "parent": "https://github.com/apache/tomcat80/commit/1525c85670ba7033c3d6272896334eb47bf1fd2d",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50027\nAvoid NPE on start when a Context is defined in server.xml with one or more JNDI resources.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1006037 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/2df2b2d7fd7b652cee7c4428154bf387c2702bbf",
        "file": [
            {
                "patch": "@@ -2818,7 +2818,9 @@ protected void parseParameters() {\n                 }\n                 return;\n             }\n-            parameters.processParameters(formData, 0, formData.length);\n+            if (formData != null) {\n+                parameters.processParameters(formData, 0, formData.length);\n+            }\n         }\n \n     }\n@@ -2864,6 +2866,9 @@ protected int readPostBody(byte body[], int len)\n                 body.append(buffer, 0, len);\n             }\n         }\n+        if (body.getLength() == 0) {\n+            return null;\n+        }\n         if (body.getLength() < body.getBuffer().length) {\n             int length = body.getLength();\n             byte[] result = new byte[length];",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/2df2b2d7fd7b652cee7c4428154bf387c2702bbf/java/org/apache/catalina/connector/Request.java",
                "status": "modified",
                "changes": 7,
                "deletions": 1,
                "sha": "4ed0f6061b2c98e1652c71ea421b901c561a4adc",
                "blob_url": "https://github.com/apache/tomcat80/blob/2df2b2d7fd7b652cee7c4428154bf387c2702bbf/java/org/apache/catalina/connector/Request.java",
                "filename": "java/org/apache/catalina/connector/Request.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/Request.java?ref=2df2b2d7fd7b652cee7c4428154bf387c2702bbf"
            }
        ],
        "bug_id": "tomcat80_267",
        "parent": "https://github.com/apache/tomcat80/commit/2b9ee088b2eeb182bfabe9ad9b680f2e2d98a9d9",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49424\nAvoid NPE if no input data is provided in a chunked POST request\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@953434 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/0975012593a348dbab56b054c9cbc4d99de08e40",
        "file": [
            {
                "patch": "@@ -1929,8 +1929,12 @@ protected synchronized Principal getPrincipal(DirContext context,\n \n         User user = getUser(context, username);\n \n-        return new GenericPrincipal(user.username, user.password ,\n-                getRoles(context, user));\n+        if (user != null) {\n+            return new GenericPrincipal(user.username, user.password,\n+                    getRoles(context, user));\n+        }\n+        \n+        return null;\n     }\n \n     /**",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/0975012593a348dbab56b054c9cbc4d99de08e40/java/org/apache/catalina/realm/JNDIRealm.java",
                "status": "modified",
                "changes": 8,
                "deletions": 2,
                "sha": "72a07171c70019f59f3af585b08de710cd42b4de",
                "blob_url": "https://github.com/apache/tomcat80/blob/0975012593a348dbab56b054c9cbc4d99de08e40/java/org/apache/catalina/realm/JNDIRealm.java",
                "filename": "java/org/apache/catalina/realm/JNDIRealm.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/realm/JNDIRealm.java?ref=0975012593a348dbab56b054c9cbc4d99de08e40"
            }
        ],
        "bug_id": "tomcat80_268",
        "parent": "https://github.com/apache/tomcat80/commit/ac0eda7c04944bfd1801af3579c598fd1b1a1c7e",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48516\nFix possible NPE when user does not exist in directory\nPatch provided by Kevin Conaway\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@898558 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/8ea34734e24362e84be84325b88690e9e5f87f1a",
        "file": [
            {
                "patch": "@@ -590,9 +590,11 @@ public String toXml() {\n             appendElement(sb, INDENT4, \"enabled\", servletDef.getEnabled());\n             appendElement(sb, INDENT4, \"async-supported\",\n                     servletDef.getAsyncSupported());\n-            sb.append(\"    <run-as>\\n\");\n-            appendElement(sb, INDENT6, \"role-name\", servletDef.getRunAs());\n-            sb.append(\"    </run-as>\\n\");\n+            if (servletDef.getRunAs() != null) {\n+                sb.append(\"    <run-as>\\n\");\n+                appendElement(sb, INDENT6, \"role-name\", servletDef.getRunAs());\n+                sb.append(\"    </run-as>\\n\");\n+            }\n             for (SecurityRoleRef roleRef : servletDef.getSecurityRoleRefs()) {\n                 sb.append(\"    <security-role-ref>\\n\");\n                 appendElement(sb, INDENT6, \"role-name\", roleRef.getName());\n@@ -1491,8 +1493,10 @@ public boolean merge(Set<WebXml> fragments) {\n                     }\n                 }\n             }\n-            sessionConfig.setSessionTimeout(\n-                    temp.getSessionConfig().getSessionTimeout().toString());\n+            if (temp.getSessionConfig().getSessionTimeout() != null) {\n+                sessionConfig.setSessionTimeout(\n+                        temp.getSessionConfig().getSessionTimeout().toString());\n+            }\n         }\n         \n         if (sessionConfig.getCookieName() == null) {\n@@ -1597,8 +1601,10 @@ public boolean merge(Set<WebXml> fragments) {\n                     }\n                 }\n             }\n-            sessionConfig.setCookieHttpOnly(\n-                    temp.getSessionConfig().getCookieHttpOnly().toString());\n+            if (temp.getSessionConfig().getCookieHttpOnly() != null) {\n+                sessionConfig.setCookieHttpOnly(\n+                        temp.getSessionConfig().getCookieHttpOnly().toString());\n+            }\n         }\n         if (sessionConfig.getCookieSecure() == null) {\n             for (WebXml fragment : fragments) {\n@@ -1618,8 +1624,10 @@ public boolean merge(Set<WebXml> fragments) {\n                     }\n                 }\n             }\n-            sessionConfig.setCookieSecure(\n-                    temp.getSessionConfig().getCookieSecure().toString());\n+            if (temp.getSessionConfig().getCookieSecure() != null) {\n+                sessionConfig.setCookieSecure(\n+                        temp.getSessionConfig().getCookieSecure().toString());\n+            }\n         }\n         if (sessionConfig.getCookieMaxAge() == null) {\n             for (WebXml fragment : fragments) {\n@@ -1639,8 +1647,10 @@ public boolean merge(Set<WebXml> fragments) {\n                     }\n                 }\n             }\n-            sessionConfig.setCookieMaxAge(\n-                    temp.getSessionConfig().getCookieMaxAge().toString());\n+            if (temp.getSessionConfig().getCookieMaxAge() != null) {\n+                sessionConfig.setCookieMaxAge(\n+                        temp.getSessionConfig().getCookieMaxAge().toString());\n+            }\n         }\n \n         if (sessionConfig.getSessionTrackingModes().size() == 0) {\n@@ -1662,8 +1672,8 @@ public boolean merge(Set<WebXml> fragments) {\n                     }\n                 }\n             }\n-            sessionConfig.setSessionTimeout(\n-                    temp.getSessionConfig().getSessionTimeout().toString());\n+            sessionConfig.getSessionTrackingModes().addAll(\n+                    temp.getSessionConfig().getSessionTrackingModes());\n         }\n         \n         for (WebXml fragment : fragments) {",
                "additions": 23,
                "raw_url": "https://github.com/apache/tomcat80/raw/8ea34734e24362e84be84325b88690e9e5f87f1a/java/org/apache/catalina/startup/WebXml.java",
                "status": "modified",
                "changes": 36,
                "deletions": 13,
                "sha": "64d0d91826f6d0968cfc8366c740866a401a8592",
                "blob_url": "https://github.com/apache/tomcat80/blob/8ea34734e24362e84be84325b88690e9e5f87f1a/java/org/apache/catalina/startup/WebXml.java",
                "filename": "java/org/apache/catalina/startup/WebXml.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/startup/WebXml.java?ref=8ea34734e24362e84be84325b88690e9e5f87f1a"
            }
        ],
        "bug_id": "tomcat80_269",
        "parent": "https://github.com/apache/tomcat80/commit/f08f71991df0b26681a2dd22363e48640e1fb90c",
        "message": "XML output tweaks\nFix some NPEs in the merge of session-config elements\nFix a copy and paste error in the merge of session-config elements\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@894457 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/4d0c0c7bd77f392195a22828358b8e0f49628a08",
        "file": [
            {
                "patch": "@@ -797,7 +797,7 @@ protected void loadEntries() {\n      * Entry tree lookup.\n      */\n     protected Entry treeLookup(Name name) {\n-        if (name.isEmpty())\n+        if (name.isEmpty() || entries == null)\n             return entries;\n         Entry currentEntry = entries;\n         for (int i = 0; i < name.size(); i++) {",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/4d0c0c7bd77f392195a22828358b8e0f49628a08/java/org/apache/naming/resources/WARDirContext.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "9a4293feb573fc11e61b1d6c83c284a284522783",
                "blob_url": "https://github.com/apache/tomcat80/blob/4d0c0c7bd77f392195a22828358b8e0f49628a08/java/org/apache/naming/resources/WARDirContext.java",
                "filename": "java/org/apache/naming/resources/WARDirContext.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/naming/resources/WARDirContext.java?ref=4d0c0c7bd77f392195a22828358b8e0f49628a08"
            }
        ],
        "bug_id": "tomcat80_270",
        "parent": "https://github.com/apache/tomcat80/commit/2ca4a49cd65fb512cd7a84a6f081c0473b55f5ab",
        "message": "Fix NPE if something tries to access resources accessed during a stop.\nThis was seen when unpackWARs=\"false\" and the JDBC clean up code tried to load the leak prevention class during a context stop.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@805153 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/1529a6dcf0fd8a8ad48a73b38844ae04dbcc7f14",
        "file": [
            {
                "patch": "@@ -158,6 +158,7 @@ public void start() throws Exception {\n         }else {\n             engine = (Engine)parent;\n             hostname = engine.getDefaultHost();\n+            host = (Host) engine.findChild(hostname);\n         }\n         try {\n             oname = new ObjectName(engine.getName() + \":type=Deployer,host=\"",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/1529a6dcf0fd8a8ad48a73b38844ae04dbcc7f14/java/org/apache/catalina/ha/deploy/FarmWarDeployer.java",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "ce31bb3999412c071d6b80ae7c03d3390cb9b23b",
                "blob_url": "https://github.com/apache/tomcat80/blob/1529a6dcf0fd8a8ad48a73b38844ae04dbcc7f14/java/org/apache/catalina/ha/deploy/FarmWarDeployer.java",
                "filename": "java/org/apache/catalina/ha/deploy/FarmWarDeployer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/ha/deploy/FarmWarDeployer.java?ref=1529a6dcf0fd8a8ad48a73b38844ae04dbcc7f14"
            },
            {
                "patch": "@@ -22,6 +22,9 @@\n import java.io.FileInputStream;\n import java.io.FileOutputStream;\n import java.io.FileNotFoundException;\n+import java.util.Map;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.atomic.AtomicLong;\n \n /**\n  * This factory is used to read files and write files by splitting them up into\n@@ -74,7 +77,7 @@\n     protected FileOutputStream out;\n \n     /**\n-     * The number of messages we have read or written\n+     * The number of messages we have written\n      */\n     protected int nrOfMessagesProcessed = 0;\n \n@@ -87,12 +90,31 @@\n      * The total number of packets that we split this file into\n      */\n     protected long totalNrOfMessages = 0;\n+    \n+    /**\n+     * The number of the last message procssed. Message IDs are 1 based.\n+     */\n+    protected AtomicLong lastMessageProcessed = new AtomicLong(0);\n+    \n+    /**\n+     * Messages received out of order are held in the buffer until required. If\n+     * everything is worked as expected, messages will spend very little time in\n+     * the buffer.\n+     */\n+    protected Map<Long, FileMessage> msgBuffer =\n+        new ConcurrentHashMap<Long, FileMessage>();\n \n     /**\n      * The bytes that we hold the data in, not thread safe.\n      */\n     protected byte[] data = new byte[READ_SIZE];\n \n+    /**\n+     * Flag that indicates if a thread is writing messages to disk. Access to\n+     * this flag must be synchronised.\n+     */\n+    protected boolean isWriting = false;\n+\n     /**\n      * Private constructor, either instantiates a factory to read or write. <BR>\n      * When openForWrite==true, then a the file, f, will be created and an\n@@ -205,25 +227,65 @@ public boolean writeMessage(FileMessage msg)\n         if (log.isDebugEnabled())\n             log.debug(\"Message \" + msg + \" data \" + msg.getData()\n                     + \" data length \" + msg.getDataLength() + \" out \" + out);\n-        if (out != null) {\n-            out.write(msg.getData(), 0, msg.getDataLength());\n-            nrOfMessagesProcessed++;\n+        \n+        if (msg.getMessageNumber() <= lastMessageProcessed.get()) {\n+            // Duplicate of message already processed\n+            log.warn(\"Receive Message again -- Sender ActTimeout too short [ path: \"\n+                    + msg.getContextPath()\n+                    + \" war: \"\n+                    + msg.getFileName()\n+                    + \" data: \"\n+                    + msg.getData()\n+                    + \" data length: \" + msg.getDataLength() + \" ]\");\n+            return false;\n+        }\n+        \n+        FileMessage previous =\n+            msgBuffer.put(new Long(msg.getMessageNumber()), msg);\n+        if (previous !=null) {\n+            // Duplicate of message not yet processed\n+            log.warn(\"Receive Message again -- Sender ActTimeout too short [ path: \"\n+                    + msg.getContextPath()\n+                    + \" war: \"\n+                    + msg.getFileName()\n+                    + \" data: \"\n+                    + msg.getData()\n+                    + \" data length: \" + msg.getDataLength() + \" ]\");\n+            return false;\n+        }\n+        \n+        FileMessage next = null;\n+        synchronized (this) {\n+            if (!isWriting) {\n+                next = msgBuffer.get(new Long(lastMessageProcessed.get() + 1));\n+                if (next != null) {\n+                    isWriting = true;\n+                } else {\n+                    return false;\n+                }\n+            } else {\n+                return false;\n+            }\n+        }\n+        \n+        while (next != null) {\n+            out.write(next.getData(), 0, next.getDataLength());\n+            lastMessageProcessed.incrementAndGet();\n             out.flush();\n-            if (msg.getMessageNumber() == msg.getTotalNrOfMsgs()) {\n+            if (next.getMessageNumber() == next.getTotalNrOfMsgs()) {\n                 out.close();\n                 cleanup();\n                 return true;\n-            }//end if\n-        } else {\n-            if (log.isWarnEnabled())\n-                log.warn(\"Receive Message again -- Sender ActTimeout to short [ path: \"\n-                                + msg.getContextPath()\n-                                + \" war: \"\n-                                + msg.getFileName()\n-                                + \" data: \"\n-                                + msg.getData()\n-                                + \" data length: \" + msg.getDataLength() + \" ]\");\n+            }\n+            synchronized(this) {\n+                next =\n+                    msgBuffer.get(new Long(lastMessageProcessed.get() + 1));\n+                if (next == null) {\n+                    isWriting = false;\n+                }\n+            }\n         }\n+        \n         return false;\n     }//writeMessage\n \n@@ -248,6 +310,8 @@ public void cleanup() {\n         data = null;\n         nrOfMessagesProcessed = 0;\n         totalNrOfMessages = 0;\n+        msgBuffer.clear();\n+        lastMessageProcessed = null;\n     }\n \n     /**\n@@ -309,4 +373,4 @@ public File getFile() {\n         return file;\n     }\n \n-}\n\\ No newline at end of file\n+}",
                "additions": 80,
                "raw_url": "https://github.com/apache/tomcat80/raw/1529a6dcf0fd8a8ad48a73b38844ae04dbcc7f14/java/org/apache/catalina/ha/deploy/FileMessageFactory.java",
                "status": "modified",
                "changes": 96,
                "deletions": 16,
                "sha": "971e11a1da9c2e4ec6541b53f46a9bdd4ff70aa1",
                "blob_url": "https://github.com/apache/tomcat80/blob/1529a6dcf0fd8a8ad48a73b38844ae04dbcc7f14/java/org/apache/catalina/ha/deploy/FileMessageFactory.java",
                "filename": "java/org/apache/catalina/ha/deploy/FileMessageFactory.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/ha/deploy/FileMessageFactory.java?ref=1529a6dcf0fd8a8ad48a73b38844ae04dbcc7f14"
            }
        ],
        "bug_id": "tomcat80_271",
        "parent": "https://github.com/apache/tomcat80/commit/5c515b8f1e5b33079d5c468a0b1eebde1c7ddc91",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45851\nCorrect NPE when cluster is defined at engine level\nEnsure that only 1 thread writes the replicated WAR to disk and that the messages containing the WAR are processed in the correct order.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@699427 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/f36d5db13341a37c86aabb356716b2503230cb63",
        "file": [
            {
                "patch": "@@ -326,7 +326,7 @@ private String comparePageEncodings(String thePageDirEnc,\n                 Node.PageDirective pageDir) throws JasperException {\n \n             Node.Root root = pageDir.getRoot();\n-            String configEnc = root.getJspConfigPageEncoding().toUpperCase();\n+            String configEnc = root.getJspConfigPageEncoding();\n             String pageDirEnc = thePageDirEnc.toUpperCase();\n \n             /*\n@@ -336,6 +336,7 @@ private String comparePageEncodings(String thePageDirEnc,\n              * \"UTF-16LE\" as identical.\n              */\n             if (configEnc != null) {\n+                configEnc = configEnc.toUpperCase();\n                 if (!pageDirEnc.equals(configEnc)\n                         && (!pageDirEnc.startsWith(\"UTF-16\") || !configEnc\n                                 .startsWith(\"UTF-16\"))) {",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/f36d5db13341a37c86aabb356716b2503230cb63/java/org/apache/jasper/compiler/Validator.java",
                "status": "modified",
                "changes": 3,
                "deletions": 1,
                "sha": "cbc9fd69bd3829e59d2495b4c8ef0e2e964c6160",
                "blob_url": "https://github.com/apache/tomcat80/blob/f36d5db13341a37c86aabb356716b2503230cb63/java/org/apache/jasper/compiler/Validator.java",
                "filename": "java/org/apache/jasper/compiler/Validator.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/Validator.java?ref=f36d5db13341a37c86aabb356716b2503230cb63"
            }
        ],
        "bug_id": "tomcat80_272",
        "parent": "https://github.com/apache/tomcat80/commit/de1f214f2cde0a82b90f259af1c10c0b4f9b424b",
        "message": "Fix NPE reported on the dev list. The other toUpperCase() calls should be safe since the String will be non-null when the method is called.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@657149 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/63a9f376979f46bcc54eb33b17203d2e4bc85116",
        "file": [
            {
                "patch": "@@ -138,6 +138,16 @@ public Object run() throws ServletException, IOException {\n          * Are we performing an include() instead of a forward()?\n          */\n         boolean including = false;\n+\n+        /**\n+         * Outer most HttpServletRequest in the chain\n+         */\n+        HttpServletRequest hrequest = null;\n+\n+        /**\n+         * Outermost HttpServletResponse in the chain\n+         */\n+        HttpServletResponse hresponse = null;\n     }\n \n     // ----------------------------------------------------------- Constructors\n@@ -316,24 +326,13 @@ private void doForward(ServletRequest request, ServletResponse response)\n             checkSameObjects(request, response);\n         }\n \n-        // Identify the HTTP-specific request and response objects (if any)\n-        HttpServletRequest hrequest = null;\n-        if (request instanceof HttpServletRequest)\n-            hrequest = (HttpServletRequest) request;\n-        HttpServletResponse hresponse = null;\n-        if (response instanceof HttpServletResponse)\n-            hresponse = (HttpServletResponse) response;\n-\n-        // Handle a non-HTTP forward by passing the existing request/response\n-        if ((hrequest == null) || (hresponse == null)) {\n-            processRequest(hrequest,hresponse,state);\n-        }\n-\n+        wrapResponse(state);\n         // Handle an HTTP named dispatcher forward\n-        else if ((servletPath == null) && (pathInfo == null)) {\n+        if ((servletPath == null) && (pathInfo == null)) {\n \n             ApplicationHttpRequest wrequest =\n                 (ApplicationHttpRequest) wrapRequest(state);\n+            HttpServletRequest hrequest = state.hrequest;\n             wrequest.setRequestURI(hrequest.getRequestURI());\n             wrequest.setContextPath(hrequest.getContextPath());\n             wrequest.setServletPath(hrequest.getServletPath());\n@@ -349,7 +348,7 @@ else if ((servletPath == null) && (pathInfo == null)) {\n             ApplicationHttpRequest wrequest =\n                 (ApplicationHttpRequest) wrapRequest(state);\n             String contextPath = context.getPath();\n-\n+            HttpServletRequest hrequest = state.hrequest;\n             if (hrequest.getAttribute(Globals.FORWARD_REQUEST_URI_ATTR) == null) {\n                 wrequest.setAttribute(Globals.FORWARD_REQUEST_URI_ATTR,\n                                       hrequest.getRequestURI());\n@@ -488,19 +487,8 @@ private void doInclude(ServletRequest request, ServletResponse response)\n         // Create a wrapped response to use for this request\n         wrapResponse(state);\n \n-        // Handle a non-HTTP include\n-        if (!(request instanceof HttpServletRequest) ||\n-            !(response instanceof HttpServletResponse)) {\n-            request.setAttribute(ApplicationFilterFactory.DISPATCHER_TYPE_ATTR,\n-                    Integer.valueOf(ApplicationFilterFactory.INCLUDE));\n-            request.setAttribute(\n-                    ApplicationFilterFactory.DISPATCHER_REQUEST_PATH_ATTR,\n-                    servletPath);\n-            invoke(request, state.outerResponse, state);\n-        }\n-\n         // Handle an HTTP named dispatcher include\n-        else if (name != null) {\n+        if (name != null) {\n \n             ApplicationHttpRequest wrequest =\n                 (ApplicationHttpRequest) wrapRequest(state);\n@@ -584,7 +572,7 @@ private void invoke(ServletRequest request, ServletResponse response,\n         }\n \n         // Initialize local variables we may need\n-        HttpServletResponse hresponse = (HttpServletResponse) response;\n+        HttpServletResponse hresponse = state.hresponse;\n         Servlet servlet = null;\n         IOException ioException = null;\n         ServletException servletException = null;\n@@ -817,6 +805,8 @@ private ServletRequest wrapRequest(State state) {\n         ServletRequest previous = null;\n         ServletRequest current = state.outerRequest;\n         while (current != null) {\n+            if(state.hrequest == null && (current instanceof HttpServletRequest))\n+                state.hrequest = (HttpServletRequest)current;\n             if (\"org.apache.catalina.servlets.InvokerHttpRequest\".\n                 equals(current.getClass().getName()))\n                 break; // KLUDGE - Make nested RD.forward() using invoker work\n@@ -878,6 +868,11 @@ private ServletResponse wrapResponse(State state) {\n         ServletResponse previous = null;\n         ServletResponse current = state.outerResponse;\n         while (current != null) {\n+            if(state.hresponse == null && (current instanceof HttpServletResponse)) {\n+                state.hresponse = (HttpServletResponse)current;\n+                if(!state.including) // Forward only needs hresponse\n+                    return null;\n+            }\n             if (!(current instanceof ServletResponseWrapper))\n                 break;\n             if (current instanceof ApplicationHttpResponse)",
                "additions": 23,
                "raw_url": "https://github.com/apache/tomcat80/raw/63a9f376979f46bcc54eb33b17203d2e4bc85116/java/org/apache/catalina/core/ApplicationDispatcher.java",
                "status": "modified",
                "changes": 51,
                "deletions": 28,
                "sha": "d7225bdb72661aa709e6e63346574b139925b245",
                "blob_url": "https://github.com/apache/tomcat80/blob/63a9f376979f46bcc54eb33b17203d2e4bc85116/java/org/apache/catalina/core/ApplicationDispatcher.java",
                "filename": "java/org/apache/catalina/core/ApplicationDispatcher.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/ApplicationDispatcher.java?ref=63a9f376979f46bcc54eb33b17203d2e4bc85116"
            }
        ],
        "bug_id": "tomcat80_273",
        "parent": "https://github.com/apache/tomcat80/commit/e856b3e725dcfa52f786f7dc48ef51f977ae9992",
        "message": "Continue to give Remy a headache by fixing the problem where when the outer most wrapper is a ServetRequest/ResponseWrapper, but not a HttpServletRequest/ResponseWrapper would cause an NPE.\n\nFix for bug: #43668\nReported by:   Mailmur  \n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@588477 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/c654a4c3d638fb3fe3f099981ff3cd8a2cc08989",
        "file": [
            {
                "patch": "@@ -120,9 +120,16 @@ public Function() {\n         public void writeExternal(ObjectOutput out) throws IOException {\n             out.writeUTF((this.prefix != null) ? this.prefix : \"\");\n             out.writeUTF(this.localName);\n-            out.writeUTF(this.m.getDeclaringClass().getName());\n-            out.writeUTF(this.m.getName());\n-            out.writeObject(ReflectionUtil.toTypeNameArray(this.m.getParameterTypes()));\n+            out.writeUTF((this.owner != null) ? \n+                     this.owner : \n+                     this.m.getDeclaringClass().getName());\n+            out.writeUTF((this.name != null) ? \n+                     this.name : \n+                     this.m.getName());\n+            out.writeObject((this.types != null) ? \n+                     this.types : \n+                     ReflectionUtil.toTypeNameArray(this.m.getParameterTypes()));\n+\n         }\n     \n         /*",
                "additions": 10,
                "raw_url": "https://github.com/apache/tomcat80/raw/c654a4c3d638fb3fe3f099981ff3cd8a2cc08989/java/org/apache/el/lang/FunctionMapperImpl.java",
                "status": "modified",
                "changes": 13,
                "deletions": 3,
                "sha": "a225e3b73aadc651f4c273a0d4335b653a92e6f9",
                "blob_url": "https://github.com/apache/tomcat80/blob/c654a4c3d638fb3fe3f099981ff3cd8a2cc08989/java/org/apache/el/lang/FunctionMapperImpl.java",
                "filename": "java/org/apache/el/lang/FunctionMapperImpl.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/el/lang/FunctionMapperImpl.java?ref=c654a4c3d638fb3fe3f099981ff3cd8a2cc08989"
            }
        ],
        "bug_id": "tomcat80_274",
        "parent": "https://github.com/apache/tomcat80/commit/a3cce6c85db2c3d62766cef3e1239d2bd976165b",
        "message": "bug 41797: CNFE/NPE thrown from function mapper when externalizing\nPatch by Tuomas Kiviaho- tuomas.kiviahos at ikis fi\n(submit part2 of the patch as seem in comment #3)\n\n(Format police - help!!! I did my best)\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@578610 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/d35b1abd8ad9cbc144f8a7614201dce652f2bfeb",
        "file": [
            {
                "patch": "@@ -2063,8 +2063,9 @@ public void run() {\n             try {\n                 key = socket.getIOChannel().keyFor(socket.getPoller().getSelector());\n                 int handshake = -1;\n+                \n                 try {\n-                    handshake = socket.handshake(key.isReadable(), key.isWritable());\n+                    if (key!=null) handshake = socket.handshake(key.isReadable(), key.isWritable());\n                 }catch ( IOException x ) {\n                     handshake = -1;\n                     if ( log.isDebugEnabled() ) log.debug(\"Error during SSL handshake\",x);\n@@ -2091,8 +2092,11 @@ public void run() {\n                         }\n                     } \n                 } else if (handshake == -1 ) {\n-                    KeyAttachment ka = (KeyAttachment)key.attachment();\n-                    socket.getPoller().cancelledKey(key,SocketStatus.DISCONNECT,false);\n+                    KeyAttachment ka = null;\n+                    if (key!=null) {\n+                        ka = (KeyAttachment) key.attachment();\n+                        socket.getPoller().cancelledKey(key, SocketStatus.DISCONNECT, false);\n+                    }\n                     try {socket.close(true);}catch (IOException ignore){}\n                     nioChannels.offer(socket);\n                     if ( ka!=null ) keyCache.offer(ka);",
                "additions": 7,
                "raw_url": "https://github.com/apache/tomcat80/raw/d35b1abd8ad9cbc144f8a7614201dce652f2bfeb/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "status": "modified",
                "changes": 10,
                "deletions": 3,
                "sha": "34716c5fc4a35a779f1b67c7f0f569a7cc282e34",
                "blob_url": "https://github.com/apache/tomcat80/blob/d35b1abd8ad9cbc144f8a7614201dce652f2bfeb/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/NioEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/NioEndpoint.java?ref=d35b1abd8ad9cbc144f8a7614201dce652f2bfeb"
            },
            {
                "patch": "@@ -126,7 +126,11 @@ public void open() throws IOException {\n      * @throws IOException if an IO Exception occurs in the underlying socket logic\n      */\n     public int write(ByteBuffer buf, NioChannel socket, Selector selector, long writeTimeout) throws IOException {\n-        if ( SHARED ) {\n+        return write(buf,socket,selector,writeTimeout,true);\n+    }\n+    \n+    public int write(ByteBuffer buf, NioChannel socket, Selector selector, long writeTimeout, boolean block) throws IOException {\n+        if ( SHARED && block) {\n             return NioBlockingSelector.write(buf,socket,writeTimeout);\n         }\n         SelectionKey key = null;\n@@ -140,14 +144,16 @@ public int write(ByteBuffer buf, NioChannel socket, Selector selector, long writ\n         }\n         try {\n             while ( (!timedout) && buf.hasRemaining() ) {\n+                int cnt = 0;\n                 if ( keycount > 0 ) { //only write if we were registered for a write\n-                    int cnt = socket.write(buf); //write the data\n+                    cnt = socket.write(buf); //write the data\n                     if (cnt == -1) throw new EOFException();\n                     written += cnt;\n                     if (cnt > 0) {\n                         time = System.currentTimeMillis(); //reset our timeout timer\n                         continue; //we successfully wrote, try again without a selector\n                     }\n+                    if (cnt==0 && (!block)) break; //don't block\n                 }\n                 if ( selector != null ) {\n                     //register OP_WRITE to the selector\n@@ -181,7 +187,25 @@ public int write(ByteBuffer buf, NioChannel socket, Selector selector, long writ\n      * @throws IOException if an IO Exception occurs in the underlying socket logic\n      */\n     public int read(ByteBuffer buf, NioChannel socket, Selector selector, long readTimeout) throws IOException {\n-        if ( SHARED ) {\n+        return read(buf,socket,selector,readTimeout,true);\n+    }\n+    /**\n+     * Performs a read using the bytebuffer for data to be read and a selector to register for events should \n+     * you have the block=true.\n+     * If the <code>selector</code> parameter is null, then it will perform a busy read that could\n+     * take up a lot of CPU cycles.\n+     * @param buf ByteBuffer - the buffer containing the data, we will read as until we have read at least one byte or we timed out\n+     * @param socket SocketChannel - the socket to write data to\n+     * @param selector Selector - the selector to use for blocking, if null then a busy read will be initiated\n+     * @param readTimeout long - the timeout for this read operation in milliseconds, -1 means no timeout\n+     * @param block - true if you want to block until data becomes available or timeout time has been reached\n+     * @return int - returns the number of bytes read\n+     * @throws EOFException if read returns -1\n+     * @throws SocketTimeoutException if the read times out\n+     * @throws IOException if an IO Exception occurs in the underlying socket logic\n+     */\n+    public int read(ByteBuffer buf, NioChannel socket, Selector selector, long readTimeout, boolean block) throws IOException {\n+        if ( SHARED && block) {\n             return NioBlockingSelector.read(buf,socket,readTimeout);\n         }\n         SelectionKey key = null;\n@@ -190,14 +214,16 @@ public int read(ByteBuffer buf, NioChannel socket, Selector selector, long readT\n         int keycount = 1; //assume we can write\n         long time = System.currentTimeMillis(); //start the timeout timer\n         try {\n-            while ( (!timedout) && read == 0 ) {\n+            while ( (!timedout) ) {\n+                int cnt = 0;\n                 if ( keycount > 0 ) { //only read if we were registered for a read\n-                    int cnt = socket.read(buf);\n+                    cnt = socket.read(buf);\n                     if (cnt == -1) throw new EOFException();\n                     read += cnt;\n-                    if (cnt > 0) break;\n-                }\n-                if ( selector != null ) {\n+                    if (cnt > 0) continue; //read some more\n+                    if (cnt==0 && (read>0 || (!block) ) ) break; //we are done reading\n+                } \n+                if ( selector != null ) {//perform a blocking read\n                     //register OP_WRITE to the selector\n                     if (key==null) key = socket.getIOChannel().register(selector, SelectionKey.OP_READ);\n                     else key.interestOps(SelectionKey.OP_READ);",
                "additions": 34,
                "raw_url": "https://github.com/apache/tomcat80/raw/d35b1abd8ad9cbc144f8a7614201dce652f2bfeb/java/org/apache/tomcat/util/net/NioSelectorPool.java",
                "status": "modified",
                "changes": 42,
                "deletions": 8,
                "sha": "0910d919e3288b6f0ce10631fc091b7079797a15",
                "blob_url": "https://github.com/apache/tomcat80/blob/d35b1abd8ad9cbc144f8a7614201dce652f2bfeb/java/org/apache/tomcat/util/net/NioSelectorPool.java",
                "filename": "java/org/apache/tomcat/util/net/NioSelectorPool.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/NioSelectorPool.java?ref=d35b1abd8ad9cbc144f8a7614201dce652f2bfeb"
            }
        ],
        "bug_id": "tomcat80_275",
        "parent": "https://github.com/apache/tomcat80/commit/965cdfe13802df29b8d90a81ecb95281192b8c15",
        "message": "Start preparing for non blocking writes, the underlying code has to have the ability if there is ever gonna be a need\nfix NPE\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@526577 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/f00eff1b9891ca0ca872bb68c826e101502bbfaa",
        "file": [
            {
                "patch": "@@ -1758,63 +1758,58 @@ protected Class findClassInternal(String name)\n         if (clazz != null)\n             return clazz;\n \n-        synchronized (this) {\n+        synchronized (entry) {\n             if (entry.binaryContent == null && entry.loadedClass == null)\n                 throw new ClassNotFoundException(name);\n-        }\n-\n-        // Looking up the package\n-        String packageName = null;\n-        int pos = name.lastIndexOf('.');\n-        if (pos != -1)\n-            packageName = name.substring(0, pos);\n \n-        Package pkg = null;\n-\n-        if (packageName != null) {\n-\n-            pkg = getPackage(packageName);\n-\n-            // Define the package (if null)\n-            if (pkg == null) {\n-                if (entry.manifest == null) {\n-                    definePackage(packageName, null, null, null, null, null,\n-                                  null, null);\n-                } else {\n-                    definePackage(packageName, entry.manifest, entry.codeBase);\n+            // Looking up the package\n+            String packageName = null;\n+            int pos = name.lastIndexOf('.');\n+            if (pos != -1)\n+                packageName = name.substring(0, pos);\n+        \n+            Package pkg = null;\n+        \n+            if (packageName != null) {\n+                synchronized (this) {\n+                    pkg = getPackage(packageName);\n+            \n+                    // Define the package (if null)\n+                    if (pkg == null) {\n+                        if (entry.manifest == null) {\n+                            definePackage(packageName, null, null, null, null,\n+                                    null, null, null);\n+                        } else {\n+                            definePackage(packageName, entry.manifest,\n+                                    entry.codeBase);\n+                        }\n+                    }\n                 }\n             }\n-\n-        }\n-\n-        // Create the code source object\n-        CodeSource codeSource =\n-            new CodeSource(entry.codeBase, entry.certificates);\n-\n-        if (securityManager != null) {\n-\n-            // Checking sealing\n-            if (pkg != null) {\n-                boolean sealCheck = true;\n-                if (pkg.isSealed()) {\n-                    sealCheck = pkg.isSealed(entry.codeBase);\n-                } else {\n-                    sealCheck = (entry.manifest == null)\n-                        || !isPackageSealed(packageName, entry.manifest);\n+    \n+            if (securityManager != null) {\n+\n+                // Checking sealing\n+                if (pkg != null) {\n+                    boolean sealCheck = true;\n+                    if (pkg.isSealed()) {\n+                        sealCheck = pkg.isSealed(entry.codeBase);\n+                    } else {\n+                        sealCheck = (entry.manifest == null)\n+                            || !isPackageSealed(packageName, entry.manifest);\n+                    }\n+                    if (!sealCheck)\n+                        throw new SecurityException\n+                            (\"Sealing violation loading \" + name + \" : Package \"\n+                             + packageName + \" is sealed.\");\n                 }\n-                if (!sealCheck)\n-                    throw new SecurityException\n-                        (\"Sealing violation loading \" + name + \" : Package \"\n-                         + packageName + \" is sealed.\");\n+    \n             }\n \n-        }\n-\n-        synchronized (this) {\n             if (entry.loadedClass == null) {\n                 clazz = defineClass(name, entry.binaryContent, 0,\n                         entry.binaryContent.length, \n-                        codeSource);\n+                        new CodeSource(entry.codeBase, entry.certificates));\n                 entry.loadedClass = clazz;\n                 entry.binaryContent = null;\n                 entry.source = null;",
                "additions": 41,
                "raw_url": "https://github.com/apache/tomcat80/raw/f00eff1b9891ca0ca872bb68c826e101502bbfaa/java/org/apache/catalina/loader/WebappClassLoader.java",
                "status": "modified",
                "changes": 87,
                "deletions": 46,
                "sha": "8b29ffe3343c1b4f93a42de5bb0a5559390308ee",
                "blob_url": "https://github.com/apache/tomcat80/blob/f00eff1b9891ca0ca872bb68c826e101502bbfaa/java/org/apache/catalina/loader/WebappClassLoader.java",
                "filename": "java/org/apache/catalina/loader/WebappClassLoader.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/loader/WebappClassLoader.java?ref=f00eff1b9891ca0ca872bb68c826e101502bbfaa"
            }
        ],
        "bug_id": "tomcat80_276",
        "parent": "https://github.com/apache/tomcat80/commit/4a3947eca9504887024b39497a494ede89f00b08",
        "message": "Port fix bug 37458. Remove the possibility of some NPE and IAE issues.\nNote for Remy - you had some ideas to improve this patch.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@471263 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/4210f7699291523d8de3e7ddaf583122053915b7",
        "file": [
            {
                "patch": "@@ -1248,16 +1248,18 @@ public void addListener(Class<? extends EventListener> listenerClass) {\n     public void addListener(String className) {\n \n         try {\n-            Object obj = context.getInstanceManager().newInstance(className);\n+            if (context.getInstanceManager() != null) {\n+                Object obj = context.getInstanceManager().newInstance(className);\n \n-            if (!(obj instanceof EventListener)) {\n-                throw new IllegalArgumentException(sm.getString(\n-                        \"applicationContext.addListener.iae.wrongType\",\n-                        className));\n-            }\n+                if (!(obj instanceof EventListener)) {\n+                    throw new IllegalArgumentException(sm.getString(\n+                            \"applicationContext.addListener.iae.wrongType\",\n+                            className));\n+                }\n \n-            EventListener listener = (EventListener) obj;\n-            addListener(listener);\n+                EventListener listener = (EventListener) obj;\n+                addListener(listener);\n+            }\n         } catch (IllegalAccessException e) {\n             throw new IllegalArgumentException(sm.getString(\n                     \"applicationContext.addListener.iae.cnfe\", className),",
                "additions": 10,
                "raw_url": "https://github.com/apache/tomcat80/raw/4210f7699291523d8de3e7ddaf583122053915b7/java/org/apache/catalina/core/ApplicationContext.java",
                "status": "modified",
                "changes": 18,
                "deletions": 8,
                "sha": "4c8805f2d9dae74ddd552aa23891d9c648a45798",
                "blob_url": "https://github.com/apache/tomcat80/blob/4210f7699291523d8de3e7ddaf583122053915b7/java/org/apache/catalina/core/ApplicationContext.java",
                "filename": "java/org/apache/catalina/core/ApplicationContext.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/ApplicationContext.java?ref=4210f7699291523d8de3e7ddaf583122053915b7"
            },
            {
                "patch": "@@ -4647,7 +4647,7 @@ public boolean listenerStart() {\n                     listeners[i] + \"'\");\n             try {\n                 String listener = listeners[i];\n-                results[i] = instanceManager.newInstance(listener);\n+                results[i] = getInstanceManager().newInstance(listener);\n             } catch (Throwable t) {\n                 t = ExceptionUtils.unwrapInvocationTargetException(t);\n                 ExceptionUtils.handleThrowable(t);\n@@ -4785,7 +4785,9 @@ public boolean listenerStop() {\n                     }\n                 }\n                 try {\n-                    getInstanceManager().destroyInstance(listeners[j]);\n+                    if (getInstanceManager() != null) {\n+                        getInstanceManager().destroyInstance(listeners[j]);\n+                    }\n                 } catch (Throwable t) {\n                     t = ExceptionUtils.unwrapInvocationTargetException(t);\n                     ExceptionUtils.handleThrowable(t);\n@@ -4805,7 +4807,9 @@ public boolean listenerStop() {\n                 if (listeners[j] == null)\n                     continue;\n                 try {\n-                    getInstanceManager().destroyInstance(listeners[j]);\n+                    if (getInstanceManager() != null) {\n+                        getInstanceManager().destroyInstance(listeners[j]);\n+                    }\n                 } catch (Throwable t) {\n                     t = ExceptionUtils.unwrapInvocationTargetException(t);\n                     ExceptionUtils.handleThrowable(t);\n@@ -5453,7 +5457,7 @@ protected synchronized void stopInternal() throws LifecycleException {\n         }\n \n         //reset the instance manager\n-        instanceManager = null;\n+        setInstanceManager(null);\n \n         if (log.isDebugEnabled())\n             log.debug(\"Stopping complete\");",
                "additions": 8,
                "raw_url": "https://github.com/apache/tomcat80/raw/4210f7699291523d8de3e7ddaf583122053915b7/java/org/apache/catalina/core/StandardContext.java",
                "status": "modified",
                "changes": 12,
                "deletions": 4,
                "sha": "9a21f8ee63c06ccff930e6089dd7e65fb20e3b92",
                "blob_url": "https://github.com/apache/tomcat80/blob/4210f7699291523d8de3e7ddaf583122053915b7/java/org/apache/catalina/core/StandardContext.java",
                "filename": "java/org/apache/catalina/core/StandardContext.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/StandardContext.java?ref=4210f7699291523d8de3e7ddaf583122053915b7"
            },
            {
                "patch": "@@ -114,6 +114,11 @@\n         <bug>57675</bug>: Correctly quote strings when using the extended\n         access log. (markt)\n       </fix>\n+      <fix>\n+        <bug>57704</bug>: Fix potential NPEs during web application start/stop\n+        when <code>org.apache.tomcat.InstanceManager</code> is not initialized.\n+        (violetagg)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/4210f7699291523d8de3e7ddaf583122053915b7/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "ec01ba7a231309a1060be68fc0b89ec49a156f97",
                "blob_url": "https://github.com/apache/tomcat80/blob/4210f7699291523d8de3e7ddaf583122053915b7/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=4210f7699291523d8de3e7ddaf583122053915b7"
            }
        ],
        "bug_id": "tomcat80_277",
        "parent": "https://github.com/apache/tomcat80/commit/3d1a2bb161686246caca796d4fdfcea9fce23ba2",
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57704\nMerged revision 1666649 from tomcat/trunk:\nAccess instanceManager via get/set methods.\nFix potential NPEs. In web app start if a problem occur prior to instanceManager initialization then:\n- SCI.onStart will fail if it tries to use instanceManager\n- During web app stop, StandardContext.listenerStop will fail if it tries to use instanceManager\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1666650 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/66527ec4e2afcd5090f94c78bc158a3e370eecdc",
        "file": [
            {
                "patch": "@@ -345,11 +345,6 @@ public void startInternal() throws Exception {\n             running = true;\n             paused = false;\n \n-            // Create worker collection\n-            if ( getExecutor() == null ) {\n-                createExecutor();\n-            }\n-\n             if (useCaches) {\n                 processorCache = new SynchronizedStack<>(SynchronizedStack.DEFAULT_SIZE,\n                         socketProperties.getProcessorCache());\n@@ -359,6 +354,11 @@ public void startInternal() throws Exception {\n                         socketProperties.getBufferPool());\n             }\n \n+            // Create worker collection\n+            if ( getExecutor() == null ) {\n+                createExecutor();\n+            }\n+\n             initializeConnectionLatch();\n             startAcceptorThreads();\n \n@@ -384,30 +384,30 @@ public void stopInternal() {\n             running = false;\n             getAsyncTimeout().stop();\n             unlockAccept();\n-        }\n-        // Use the executor to avoid binding the main thread if something bad\n-        // occurs and unbind will also wait for a bit for it to complete\n-        getExecutor().execute(new Runnable() {\n-            @Override\n-            public void run() {\n-                // Timeout any pending async request\n-                for (SocketWrapper<Nio2Channel> socket : waitingRequests) {\n-                    processSocket(socket, SocketStatus.TIMEOUT, false);\n-                }\n-                // Then close all active connections if any remains\n-                try {\n-                    handler.closeAll();\n-                } catch (Throwable t) {\n-                    ExceptionUtils.handleThrowable(t);\n-                } finally {\n-                    allClosed = true;\n+            // Use the executor to avoid binding the main thread if something bad\n+            // occurs and unbind will also wait for a bit for it to complete\n+            getExecutor().execute(new Runnable() {\n+                @Override\n+                public void run() {\n+                    // Timeout any pending async request\n+                    for (SocketWrapper<Nio2Channel> socket : waitingRequests) {\n+                        processSocket(socket, SocketStatus.TIMEOUT, false);\n+                    }\n+                    // Then close all active connections if any remains\n+                    try {\n+                        handler.closeAll();\n+                    } catch (Throwable t) {\n+                        ExceptionUtils.handleThrowable(t);\n+                    } finally {\n+                        allClosed = true;\n+                    }\n                 }\n+            });\n+            if (useCaches) {\n+                socketWrapperCache.clear();\n+                nioChannels.clear();\n+                processorCache.clear();\n             }\n-        });\n-        if (useCaches) {\n-            socketWrapperCache.clear();\n-            nioChannels.clear();\n-            processorCache.clear();\n         }\n     }\n ",
                "additions": 27,
                "raw_url": "https://github.com/apache/tomcat80/raw/66527ec4e2afcd5090f94c78bc158a3e370eecdc/java/org/apache/tomcat/util/net/Nio2Endpoint.java",
                "status": "modified",
                "changes": 54,
                "deletions": 27,
                "sha": "a653409dc989ea6f566275fef9221fa49f0395e7",
                "blob_url": "https://github.com/apache/tomcat80/blob/66527ec4e2afcd5090f94c78bc158a3e370eecdc/java/org/apache/tomcat/util/net/Nio2Endpoint.java",
                "filename": "java/org/apache/tomcat/util/net/Nio2Endpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/Nio2Endpoint.java?ref=66527ec4e2afcd5090f94c78bc158a3e370eecdc"
            },
            {
                "patch": "@@ -401,11 +401,6 @@ public void startInternal() throws Exception {\n             running = true;\n             paused = false;\n \n-            // Create worker collection\n-            if ( getExecutor() == null ) {\n-                createExecutor();\n-            }\n-\n             processorCache = new SynchronizedStack<>(SynchronizedStack.DEFAULT_SIZE,\n                     socketProperties.getProcessorCache());\n             keyCache = new SynchronizedStack<>(SynchronizedStack.DEFAULT_SIZE,\n@@ -415,6 +410,11 @@ public void startInternal() throws Exception {\n             nioChannels = new SynchronizedStack<>(SynchronizedStack.DEFAULT_SIZE,\n                     socketProperties.getBufferPool());\n \n+            // Create worker collection\n+            if ( getExecutor() == null ) {\n+                createExecutor();\n+            }\n+\n             initializeConnectionLatch();\n \n             // Start poller threads\n@@ -453,12 +453,12 @@ public void stopInternal() {\n                 stopLatch.await(selectorTimeout + 100, TimeUnit.MILLISECONDS);\n             } catch (InterruptedException ignore) {\n             }\n+            shutdownExecutor();\n+            eventCache.clear();\n+            keyCache.clear();\n+            nioChannels.clear();\n+            processorCache.clear();\n         }\n-        eventCache.clear();\n-        keyCache.clear();\n-        nioChannels.clear();\n-        processorCache.clear();\n-        shutdownExecutor();\n \n     }\n ",
                "additions": 10,
                "raw_url": "https://github.com/apache/tomcat80/raw/66527ec4e2afcd5090f94c78bc158a3e370eecdc/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "status": "modified",
                "changes": 20,
                "deletions": 10,
                "sha": "e64586f1b46879292cefe2ccdb5fca522c80e36f",
                "blob_url": "https://github.com/apache/tomcat80/blob/66527ec4e2afcd5090f94c78bc158a3e370eecdc/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/NioEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/NioEndpoint.java?ref=66527ec4e2afcd5090f94c78bc158a3e370eecdc"
            },
            {
                "patch": "@@ -131,6 +131,10 @@\n         to data available, remaining and extra write events, mostly occurring\n         with non blocking Servlet 3.1. (remm)\n       </fix>\n+      <fix>\n+        Avoid possible NPE stopping endpoints that are not started (stop\n+        shouldn't do anything in that case). (remm)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Jasper\">",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/66527ec4e2afcd5090f94c78bc158a3e370eecdc/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "5adf618a53e08911f6b6d1e05d2e890b8053af74",
                "blob_url": "https://github.com/apache/tomcat80/blob/66527ec4e2afcd5090f94c78bc158a3e370eecdc/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=66527ec4e2afcd5090f94c78bc158a3e370eecdc"
            }
        ],
        "bug_id": "tomcat80_278",
        "parent": "https://github.com/apache/tomcat80/commit/69fd9ad3c8e4a563ee57085b605e1f4a5e03b4c4",
        "message": "Avoid doing anything if the endpoint is not running (avoids possible NPE with the caches (?) ) and create caches first in start (just in case).\nNote: I still don't see much real benefit in these caches, and their configuration is even more questionable (but it is there and documented).\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1608737 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/0ab1d39039d78860653b15d73d46eb403a838ee0",
        "file": [
            {
                "patch": "@@ -83,6 +83,11 @@ protected void doWrite(SendHandler handler, ByteBuffer... buffers) {\n \n \n     public void onWritePossible(boolean useDispatch) {\n+        if (buffers == null) {\n+            // Servlet 3.1 will call the write listener once even if nothing\n+            // was written\n+            return;\n+        }\n         boolean complete = true;\n         try {\n             // If this is false there will be a call back when it is true",
                "additions": 5,
                "raw_url": "https://github.com/apache/tomcat80/raw/0ab1d39039d78860653b15d73d46eb403a838ee0/java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java",
                "status": "modified",
                "changes": 5,
                "deletions": 0,
                "sha": "998bafd59d931d7edfc6a2cce9dae54629af68a6",
                "blob_url": "https://github.com/apache/tomcat80/blob/0ab1d39039d78860653b15d73d46eb403a838ee0/java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java",
                "filename": "java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java?ref=0ab1d39039d78860653b15d73d46eb403a838ee0"
            }
        ],
        "bug_id": "tomcat80_279",
        "parent": "https://github.com/apache/tomcat80/commit/c252543b4f3b237e780e6feb7b006ed35235ea57",
        "message": "Avoid NPE if the write listener is called once immediately after being set, even if no data was written (= the app doesn't send any message during the init of the connection).\nI don't think Tomcat does it yet (this doesn't need to be ported to Tomcat 7 since it is not a Servlet 3.1 impl).\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1556071 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/37b90114415b0b02cc9435167d7f88adb41a5a17",
        "file": [
            {
                "patch": "@@ -293,9 +293,16 @@ protected void longPoll(SocketWrapper<Long> socket,\n                 socket.setAsync(true);\n             } else if (processor.isComet()) {\n                 // Comet\n-                ((AprEndpoint) proto.endpoint).getCometPoller().add(\n-                        socket.getSocket().longValue(),\n-                        proto.endpoint.getSoTimeout());\n+                if (proto.endpoint.isRunning()) {\n+                    ((AprEndpoint) proto.endpoint).getCometPoller().add(\n+                            socket.getSocket().longValue(),\n+                            proto.endpoint.getSoTimeout());\n+                } else {\n+                    // Process a STOP directly\n+                    ((AprEndpoint) proto.endpoint).processSocket(\n+                            socket.getSocket().longValue(),\n+                            SocketStatus.STOP);\n+                }\n             } else {\n                 // Upgraded\n                 ((AprEndpoint) proto.endpoint).getPoller().add(",
                "additions": 10,
                "raw_url": "https://github.com/apache/tomcat80/raw/37b90114415b0b02cc9435167d7f88adb41a5a17/java/org/apache/coyote/http11/Http11AprProtocol.java",
                "status": "modified",
                "changes": 13,
                "deletions": 3,
                "sha": "ca430954d9d6990bfeb7239b4e7df91ee4960855",
                "blob_url": "https://github.com/apache/tomcat80/blob/37b90114415b0b02cc9435167d7f88adb41a5a17/java/org/apache/coyote/http11/Http11AprProtocol.java",
                "filename": "java/org/apache/coyote/http11/Http11AprProtocol.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/http11/Http11AprProtocol.java?ref=37b90114415b0b02cc9435167d7f88adb41a5a17"
            },
            {
                "patch": "@@ -23,6 +23,7 @@\n import java.util.HashMap;\n import java.util.Iterator;\n import java.util.concurrent.ConcurrentLinkedQueue;\n+import java.util.concurrent.Executor;\n import java.util.concurrent.RejectedExecutionException;\n \n import org.apache.juli.logging.Log;\n@@ -845,9 +846,15 @@ protected boolean processSocketWithOptions(long socket) {\n      */\n     protected boolean processSocket(long socket) {\n         try {\n-            SocketWrapper<Long> wrapper =\n-                new SocketWrapper<Long>(Long.valueOf(socket));\n-            getExecutor().execute(new SocketProcessor(wrapper, null));\n+            Executor executor = getExecutor();\n+            if (executor == null) {\n+                log.warn(sm.getString(\"endpoint.warn.noExector\",\n+                        Long.valueOf(socket), null));\n+            } else {\n+                SocketWrapper<Long> wrapper =\n+                    new SocketWrapper<Long>(Long.valueOf(socket));\n+                executor.execute(new SocketProcessor(wrapper, null));\n+            }\n         } catch (RejectedExecutionException x) {\n             log.warn(\"Socket processing request was rejected for:\"+socket,x);\n             return false;\n@@ -865,11 +872,17 @@ protected boolean processSocket(long socket) {\n     /**\n      * Process given socket for an event.\n      */\n-    protected boolean processSocket(long socket, SocketStatus status) {\n+    public boolean processSocket(long socket, SocketStatus status) {\n         try {\n-            SocketWrapper<Long> wrapper =\n-                    new SocketWrapper<Long>(Long.valueOf(socket));\n-            getExecutor().execute(new SocketEventProcessor(wrapper, status));\n+            Executor executor = getExecutor();\n+            if (executor == null) {\n+                log.warn(sm.getString(\"endpoint.warn.noExector\",\n+                        Long.valueOf(socket), status));\n+            } else {\n+                SocketWrapper<Long> wrapper =\n+                        new SocketWrapper<Long>(Long.valueOf(socket));\n+                executor.execute(new SocketEventProcessor(wrapper, status));\n+            }\n         } catch (RejectedExecutionException x) {\n             log.warn(\"Socket processing request was rejected for:\"+socket,x);\n             return false;\n@@ -900,11 +913,14 @@ public boolean processSocketAsync(SocketWrapper<Long> socket,\n                             Thread.currentThread().setContextClassLoader(\n                                     getClass().getClassLoader());\n                         }\n-                        // During shutdown, executor may be null - avoid NPE\n-                        if (!running) {\n+                        Executor executor = getExecutor();\n+                        if (executor == null) {\n+                            log.warn(sm.getString(\"endpoint.warn.noExector\",\n+                                    socket, status));\n                             return false;\n+                        } else {\n+                            executor.execute(proc);\n                         }\n-                        getExecutor().execute(proc);\n                     } finally {\n                         if (Constants.IS_SECURITY_ENABLED) {\n                             PrivilegedAction<Void> pa = new PrivilegedSetTccl(loader);",
                "additions": 26,
                "raw_url": "https://github.com/apache/tomcat80/raw/37b90114415b0b02cc9435167d7f88adb41a5a17/java/org/apache/tomcat/util/net/AprEndpoint.java",
                "status": "modified",
                "changes": 36,
                "deletions": 10,
                "sha": "552f0ac889032722ef6ecc6eaae7256709e4a5eb",
                "blob_url": "https://github.com/apache/tomcat80/blob/37b90114415b0b02cc9435167d7f88adb41a5a17/java/org/apache/tomcat/util/net/AprEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/AprEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/AprEndpoint.java?ref=37b90114415b0b02cc9435167d7f88adb41a5a17"
            },
            {
                "patch": "@@ -38,3 +38,4 @@ endpoint.debug.socketCloseFail=Failed to close socket\n endpoint.apr.noSslCertFile=Connector attribute SSLCertificateFile must be defined when using SSL with APR\n endpoint.apr.invalidSslProtocol=An invalid value [{0}] was provided for the SSLProtocol attribute\n endpoint.nio.selectorCloseFail=Failed to close selector when closing the poller\n+endpoint.warn.noExector=Failed to process socket [{0}] in state [{1}] because the executor had already been shutdown",
                "additions": 1,
                "raw_url": "https://github.com/apache/tomcat80/raw/37b90114415b0b02cc9435167d7f88adb41a5a17/java/org/apache/tomcat/util/net/res/LocalStrings.properties",
                "status": "modified",
                "changes": 1,
                "deletions": 0,
                "sha": "56f4a1560272f4922650bed5f6503140a9fcd4cb",
                "blob_url": "https://github.com/apache/tomcat80/blob/37b90114415b0b02cc9435167d7f88adb41a5a17/java/org/apache/tomcat/util/net/res/LocalStrings.properties",
                "filename": "java/org/apache/tomcat/util/net/res/LocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/res/LocalStrings.properties?ref=37b90114415b0b02cc9435167d7f88adb41a5a17"
            }
        ],
        "bug_id": "tomcat80_280",
        "parent": "https://github.com/apache/tomcat80/commit/f653944bce136286e6860e2cdce74538b8c0bbe2",
        "message": "Yet another attempt to fix Comet test failures for Connector stop.\nIf the endpoint is stopped - don't add sockets to the poller (it may have been stopped already) and process the STOP event directly.\nIf the connector stop has completed then the executor may be null so protect against NPEs and log when a socket couldn't be processed.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1379580 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/9a71130909fefe27420e7741713f7d67267c0992",
        "file": [
            {
                "patch": "@@ -321,41 +321,54 @@ public void logAccess(Request request, Response response, long time,\n         }\n \n         if (!logged && useDefault) {\n-            if (defaultAccessLog == null) {\n+            AccessLog newDefaultAccessLog = defaultAccessLog;\n+            if (newDefaultAccessLog == null) {\n                 // If we reached this point, this Engine can't have an AccessLog\n                 // Look in the defaultHost\n                 Host host = (Host) findChild(getDefaultHost());\n+                Context context = null;\n                 if (host != null && host.getState().isAvailable()) {\n-                    defaultAccessLog = host.getAccessLog();\n+                    newDefaultAccessLog = host.getAccessLog();\n \n-                    if (defaultAccessLog != null) {\n+                    if (newDefaultAccessLog != null) {\n                         AccessLogListener l = new AccessLogListener(this);\n-                        host.addPropertyChangeListener(l);\n+                        this.addPropertyChangeListener(l);\n                         host.addContainerListener(l);\n                         host.addLifecycleListener(l);\n                     } else {\n                         // Try the ROOT context of default host\n-                        Context context = (Context) host.findChild(\"\");\n+                        context = (Context) host.findChild(\"\");\n                         if (context != null &&\n                                 context.getState().isAvailable()) {\n-                            defaultAccessLog = context.getAccessLog();\n+                            newDefaultAccessLog = context.getAccessLog();\n                             \n-                            if (defaultAccessLog != null) {\n+                            if (newDefaultAccessLog != null) {\n                                 AccessLogListener l =\n                                     new AccessLogListener(this);\n-                                context.addPropertyChangeListener(l);\n+                                this.addPropertyChangeListener(l);\n                                 context.addLifecycleListener(l);\n                             }\n                         }\n                     }\n                 }\n \n-                if (defaultAccessLog == null) {\n-                    defaultAccessLog = new NoopAccessLog();\n+                if (newDefaultAccessLog == null) {\n+                    newDefaultAccessLog = new NoopAccessLog();\n+                    AccessLogListener l = new AccessLogListener(this);\n+                    this.addPropertyChangeListener(l);\n+                    if (host != null) {\n+                        host.addContainerListener(l);\n+                        host.addLifecycleListener(l);\n+                    }\n+                    if (context != null) {\n+                        context.addLifecycleListener(l);\n+                    }\n+                    \n                 }\n+                defaultAccessLog = newDefaultAccessLog;\n             }\n \n-            defaultAccessLog.log(request, response, time);\n+            newDefaultAccessLog.log(request, response, time);\n         }\n     }\n ",
                "additions": 24,
                "raw_url": "https://github.com/apache/tomcat80/raw/9a71130909fefe27420e7741713f7d67267c0992/java/org/apache/catalina/core/StandardEngine.java",
                "status": "modified",
                "changes": 35,
                "deletions": 11,
                "sha": "eebb93727d51b10d6b143ce0c3d5eb7e1071b7b4",
                "blob_url": "https://github.com/apache/tomcat80/blob/9a71130909fefe27420e7741713f7d67267c0992/java/org/apache/catalina/core/StandardEngine.java",
                "filename": "java/org/apache/catalina/core/StandardEngine.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/StandardEngine.java?ref=9a71130909fefe27420e7741713f7d67267c0992"
            }
        ],
        "bug_id": "tomcat80_281",
        "parent": "https://github.com/apache/tomcat80/commit/662859fad04dbe18caf0f9a7c1f9bdc37e383ee6",
        "message": "Address some review comments:\n1. Avoid possible NPEs by using a local variable for the newDefaultAccessLog\n2. PropertyChangeListener should be added to the Engine\n3. Add the listener when the Noop logger is used so changes can be detected that could cause a different logger to be used.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1042413 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/4a6e2bbab1c34f84d3677c7e9b9d0944efb4f2a7",
        "file": [
            {
                "patch": "@@ -2177,15 +2177,13 @@ private void clearThreadLocalMap(Object map, Field internalTableField)\n                         ThreadLocal.class);\n             mapRemove.setAccessible(true);\n             Object[] table = (Object[]) internalTableField.get(map);\n+            int staleEntriesCount = 0;\n             if (table != null) {\n                 for (int j =0; j < table.length; j++) {\n                     if (table[j] != null) {\n                         boolean remove = false;\n                         // Check the key\n-                        Field keyField =\n-                            Reference.class.getDeclaredField(\"referent\");\n-                        keyField.setAccessible(true);\n-                        Object key = keyField.get(table[j]);\n+                        Object key = ((Reference<?>) table[j]).get();\n                         if (this.equals(key) || (key != null &&\n                                 this == key.getClass().getClassLoader())) {\n                             remove = true;\n@@ -2200,7 +2198,6 @@ private void clearThreadLocalMap(Object map, Field internalTableField)\n                             remove = true;\n                         }\n                         if (remove) {\n-                            Object entry = ((Reference<?>) table[j]).get();\n                             Object[] args = new Object[4];\n                             if (key != null) {\n                                 args[0] = key.getClass().getCanonicalName();\n@@ -2221,11 +2218,21 @@ private void clearThreadLocalMap(Object map, Field internalTableField)\n                                         \"webappClassLoader.clearThreadLocal\",\n                                         args));\n                             }\n-                            mapRemove.invoke(map, entry);\n+                            if (key == null) {\n+                              staleEntriesCount++;\n+                            } else {\n+                              mapRemove.invoke(map, key);\n+                            }\n                         }\n                     }\n                 }\n             }\n+            if (staleEntriesCount > 0) {\n+                Method mapRemoveStale =\n+                    map.getClass().getDeclaredMethod(\"expungeStaleEntries\");\n+                mapRemoveStale.setAccessible(true);\n+                mapRemoveStale.invoke(map);\n+            }\n         }\n     }\n ",
                "additions": 13,
                "raw_url": "https://github.com/apache/tomcat80/raw/4a6e2bbab1c34f84d3677c7e9b9d0944efb4f2a7/java/org/apache/catalina/loader/WebappClassLoader.java",
                "status": "modified",
                "changes": 19,
                "deletions": 6,
                "sha": "4e98b1bfad902754c9ab24a644016997cb15400b",
                "blob_url": "https://github.com/apache/tomcat80/blob/4a6e2bbab1c34f84d3677c7e9b9d0944efb4f2a7/java/org/apache/catalina/loader/WebappClassLoader.java",
                "filename": "java/org/apache/catalina/loader/WebappClassLoader.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/loader/WebappClassLoader.java?ref=4a6e2bbab1c34f84d3677c7e9b9d0944efb4f2a7"
            }
        ],
        "bug_id": "tomcat80_282",
        "parent": "https://github.com/apache/tomcat80/commit/b34f401246d50720c75f99b11c12939f01c90a1b",
        "message": "When the key is null (i.e., a stale entry), it cannot be removed with an explicit remove(key) call: you'll get an NPE. Those can be removed with expungeStaleEntries() call.\nAlso, simplified the code: Reference.referent can be accessed by calling get() - no need to use reflection for that.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@909212 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/545263b686a4ffdc03b24a5775446254104f22f3",
        "file": [
            {
                "patch": "@@ -156,8 +156,8 @@\n  * </p>\n  * <code><pre>\n  * &lt;filter&gt;\n- *    &lt;filter-name&gt;XForwardedFilter&lt;/filter-name&gt;\n- *    &lt;filter-class&gt;fr.xebia.servlet.filter.XForwardedFilter&lt;/filter-class&gt;\n+ *    &lt;filter-name&gt;RemoteIpFilter&lt;/filter-name&gt;\n+ *    &lt;filter-class&gt;org.apache.catalina.filters.RemoteIpFilter&lt;/filter-class&gt;\n  *    &lt;init-param&gt;\n  *       &lt;param-name&gt;internalProxies&lt;/param-name&gt;&lt;param-value&gt;192\\.168\\.0\\.10, 192\\.168\\.0\\.11&lt;/param-value&gt;\n  *    &lt;/init-param&gt;\n@@ -173,7 +173,7 @@\n  * &lt;/filter&gt;\n  * \n  * &lt;filter-mapping&gt;\n- *    &lt;filter-name&gt;XForwardedFilter&lt;/filter-name&gt;\n+ *    &lt;filter-name&gt;RemoteIpFilter&lt;/filter-name&gt;\n  *    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;\n  *    &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;\n  * &lt;/filter-mapping&gt;</pre></code>\n@@ -182,8 +182,8 @@\n  * <table border=\"1\">\n  * <tr>\n  * <th>property</th>\n- * <th>Value Before XForwardedFilter</th>\n- * <th>Value After XForwardedFilter</th>\n+ * <th>Value Before RemoteIpFilter</th>\n+ * <th>Value After RemoteIpFilter</th>\n  * </tr>\n  * <tr>\n  * <td>request.remoteAddr</td>\n@@ -229,12 +229,12 @@\n  * <strong>Sample with trusted proxies</strong>\n  * </p>\n  * <p>\n- * XForwardedFilter configuration:\n+ * RemoteIpFilter configuration:\n  * </p>\n  * <code><pre>\n  * &lt;filter&gt;\n- *    &lt;filter-name&gt;XForwardedFilter&lt;/filter-name&gt;\n- *    &lt;filter-class&gt;fr.xebia.servlet.filter.XForwardedFilter&lt;/filter-class&gt;\n+ *    &lt;filter-name&gt;RemoteIpFilter&lt;/filter-name&gt;\n+ *    &lt;filter-class&gt;org.apache.catalina.filters.RemoteIpFilter&lt;/filter-class&gt;\n  *    &lt;init-param&gt;\n  *       &lt;param-name&gt;internalProxies&lt;/param-name&gt;&lt;param-value&gt;192\\.168\\.0\\.10, 192\\.168\\.0\\.11&lt;/param-value&gt;\n  *    &lt;/init-param&gt;\n@@ -250,7 +250,7 @@\n  * &lt;/filter&gt;\n  * \n  * &lt;filter-mapping&gt;\n- *    &lt;filter-name&gt;XForwardedFilter&lt;/filter-name&gt;\n+ *    &lt;filter-name&gt;RemoteIpFilter&lt;/filter-name&gt;\n  *    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;\n  *    &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;\n  * &lt;/filter-mapping&gt;</pre></code>\n@@ -259,8 +259,8 @@\n  * <table border=\"1\">\n  * <tr>\n  * <th>property</th>\n- * <th>Value Before XForwardedFilter</th>\n- * <th>Value After XForwardedFilter</th>\n+ * <th>Value Before RemoteIpFilter</th>\n+ * <th>Value After RemoteIpFilter</th>\n  * </tr>\n  * <tr>\n  * <td>request.remoteAddr</td>\n@@ -286,12 +286,12 @@\n  * <strong>Sample with internal and trusted proxies</strong>\n  * </p>\n  * <p>\n- * XForwardedFilter configuration:\n+ * RemoteIpFilter configuration:\n  * </p>\n  * <code><pre>\n  * &lt;filter&gt;\n- *    &lt;filter-name&gt;XForwardedFilter&lt;/filter-name&gt;\n- *    &lt;filter-class&gt;fr.xebia.servlet.filter.XForwardedFilter&lt;/filter-class&gt;\n+ *    &lt;filter-name&gt;RemoteIpFilter&lt;/filter-name&gt;\n+ *    &lt;filter-class&gt;org.apache.catalina.filters.RemoteIpFilter&lt;/filter-class&gt;\n  *    &lt;init-param&gt;\n  *       &lt;param-name&gt;internalProxies&lt;/param-name&gt;&lt;param-value&gt;192\\.168\\.0\\.10, 192\\.168\\.0\\.11&lt;/param-value&gt;\n  *    &lt;/init-param&gt;\n@@ -307,7 +307,7 @@\n  * &lt;/filter&gt;\n  * \n  * &lt;filter-mapping&gt;\n- *    &lt;filter-name&gt;XForwardedFilter&lt;/filter-name&gt;\n+ *    &lt;filter-name&gt;RemoteIpFilter&lt;/filter-name&gt;\n  *    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;\n  *    &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;\n  * &lt;/filter-mapping&gt;</pre></code>\n@@ -316,8 +316,8 @@\n  * <table border=\"1\">\n  * <tr>\n  * <th>property</th>\n- * <th>Value Before XForwardedFilter</th>\n- * <th>Value After XForwardedFilter</th>\n+ * <th>Value Before RemoteIpFilter</th>\n+ * <th>Value After RemoteIpFilter</th>\n  * </tr>\n  * <tr>\n  * <td>request.remoteAddr</td>\n@@ -344,12 +344,12 @@\n  * <strong>Sample with an untrusted proxy</strong>\n  * </p>\n  * <p>\n- * XForwardedFilter configuration:\n+ * RemoteIpFilter configuration:\n  * </p>\n  * <code><pre>\n  * &lt;filter&gt;\n- *    &lt;filter-name&gt;XForwardedFilter&lt;/filter-name&gt;\n- *    &lt;filter-class&gt;fr.xebia.servlet.filter.XForwardedFilter&lt;/filter-class&gt;\n+ *    &lt;filter-name&gt;RemoteIpFilter&lt;/filter-name&gt;\n+ *    &lt;filter-class&gt;org.apache.catalina.filters.RemoteIpFilter&lt;/filter-class&gt;\n  *    &lt;init-param&gt;\n  *       &lt;param-name&gt;internalProxies&lt;/param-name&gt;&lt;param-value&gt;192\\.168\\.0\\.10, 192\\.168\\.0\\.11&lt;/param-value&gt;\n  *    &lt;/init-param&gt;\n@@ -365,7 +365,7 @@\n  * &lt;/filter&gt;\n  * \n  * &lt;filter-mapping&gt;\n- *    &lt;filter-name&gt;XForwardedFilter&lt;/filter-name&gt;\n+ *    &lt;filter-name&gt;RemoteIpFilter&lt;/filter-name&gt;\n  *    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;\n  *    &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;\n  * &lt;/filter-mapping&gt;</pre></code>\n@@ -374,8 +374,8 @@\n  * <table border=\"1\">\n  * <tr>\n  * <th>property</th>\n- * <th>Value Before XForwardedFilter</th>\n- * <th>Value After XForwardedFilter</th>\n+ * <th>Value Before RemoteIpFilter</th>\n+ * <th>Value After RemoteIpFilter</th>\n  * </tr>\n  * <tr>\n  * <td>request.remoteAddr</td>\n@@ -460,19 +460,17 @@ public long getDateHeader(String name) {\n             }\n             if (date == null) {\n                 throw new IllegalArgumentException(value);\n-            } else {\n-                return date.getTime();\n             }\n+            return date.getTime();\n         }\n         \n         @Override\n         public String getHeader(String name) {\n             Map.Entry<String, List<String>> header = getHeaderEntry(name);\n             if (header == null || header.getValue() == null || header.getValue().isEmpty()) {\n                 return null;\n-            } else {\n-                return header.getValue().get(0);\n             }\n+            return header.getValue().get(0);\n         }\n         \n         protected Map.Entry<String, List<String>> getHeaderEntry(String name) {\n@@ -494,19 +492,17 @@ public String getHeader(String name) {\n             Map.Entry<String, List<String>> header = getHeaderEntry(name);\n             if (header == null || header.getValue() == null) {\n                 return Collections.enumeration(Collections.<String>emptyList());\n-            } else {\n-                return Collections.enumeration(header.getValue());\n             }\n+            return Collections.enumeration(header.getValue());\n         }\n         \n         @Override\n         public int getIntHeader(String name) {\n             String value = getHeader(name);\n             if (value == null) {\n                 return -1;\n-            } else {\n-                return Integer.parseInt(value);\n             }\n+            return Integer.parseInt(value);\n         }\n         \n         @Override\n@@ -580,7 +576,7 @@ public void setServerPort(int serverPort) {\n     \n     protected static final String HTTPS_SERVER_PORT_PARAMETER = \"httpsServerPort\";\n     \n-    protected static final String INTERNAL_PROXIES_PARAMETER = \"allowedInternalProxies\";\n+    protected static final String INTERNAL_PROXIES_PARAMETER = \"internalProxies\";\n     \n     /**\n      * Logger\n@@ -756,13 +752,13 @@ public void doFilter(HttpServletRequest request, HttpServletResponse response, F\n             \n             if (log.isDebugEnabled()) {\n                 log.debug(\"Incoming request \" + request.getRequestURI() + \" with originalRemoteAddr '\" + request.getRemoteAddr()\n-                          + \"', originalRemoteHost='\" + request.getRemoteHost() + \"', originalSecure='\" + request.isSecure()\n-                          + \"', originalScheme='\" + request.getScheme() + \"', original[\" + remoteIPHeader + \"]='\"\n-                          + request.getHeader(remoteIPHeader) + \", original[\" + protocolHeader + \"]='\"\n-                          + request.getHeader(protocolHeader) + \"' will be seen as newRemoteAddr='\" + xRequest.getRemoteAddr()\n-                          + \"', newRemoteHost='\" + xRequest.getRemoteHost() + \"', newScheme='\" + xRequest.getScheme() + \"', newSecure='\"\n-                          + xRequest.isSecure() + \"', new[\" + remoteIPHeader + \"]='\" + xRequest.getHeader(remoteIPHeader) + \", new[\"\n-                          + proxiesHeader + \"]='\" + xRequest.getHeader(proxiesHeader) + \"'\");\n+                        + \"', originalRemoteHost='\" + request.getRemoteHost() + \"', originalSecure='\" + request.isSecure()\n+                        + \"', originalScheme='\" + request.getScheme() + \"', original[\" + remoteIPHeader + \"]='\"\n+                        + request.getHeader(remoteIPHeader) + \", original[\" + protocolHeader + \"]='\"\n+                        + (protocolHeader == null ? null : request.getHeader(protocolHeader)) + \"' will be seen as newRemoteAddr='\"\n+                        + xRequest.getRemoteAddr() + \"', newRemoteHost='\" + xRequest.getRemoteHost() + \"', newScheme='\"\n+                        + xRequest.getScheme() + \"', newSecure='\" + xRequest.isSecure() + \"', new[\" + remoteIPHeader + \"]='\"\n+                        + xRequest.getHeader(remoteIPHeader) + \", new[\" + proxiesHeader + \"]='\" + xRequest.getHeader(proxiesHeader) + \"'\");\n             }\n             chain.doFilter(xRequest, response);\n         } else {",
                "additions": 35,
                "raw_url": "https://github.com/apache/tomcat80/raw/545263b686a4ffdc03b24a5775446254104f22f3/java/org/apache/catalina/filters/RemoteIpFilter.java",
                "status": "modified",
                "changes": 74,
                "deletions": 39,
                "sha": "7710febf9e1a3a1158888adaf3b7c2403e824a9d",
                "blob_url": "https://github.com/apache/tomcat80/blob/545263b686a4ffdc03b24a5775446254104f22f3/java/org/apache/catalina/filters/RemoteIpFilter.java",
                "filename": "java/org/apache/catalina/filters/RemoteIpFilter.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/filters/RemoteIpFilter.java?ref=545263b686a4ffdc03b24a5775446254104f22f3"
            }
        ],
        "bug_id": "tomcat80_283",
        "parent": "https://github.com/apache/tomcat80/commit/1ff0272733a40293f9f6ef73b27edcb4a33599e5",
        "message": "Patch provided by Cyrille Le Clerc\n* fix NPE in log statement if protocolHeader has not been defined and the servlet container does not support request.getHeader(null)\n* fix mismatch between javadoc  and code for filter parameter name \"allowedInternalProxies\" -> \"internalProxies\"\n* finish javadoc refactoring \"XForwardedFilter\" -> \"RemoteIpFilter\"\nAlso fix some Eclipse warnings\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@834081 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/a1fef662d43e056695a16aad03a89298b8b011e4",
        "file": [
            {
                "patch": "@@ -1009,6 +1009,10 @@ public Void run(){\n      */\n     public void addDateHeader(String name, long value) {\n \n+        if (name == null || name.length() == 0) {\n+            return;\n+        }\n+\n         if (isCommitted())\n             return;\n \n@@ -1036,6 +1040,10 @@ public void addDateHeader(String name, long value) {\n      */\n     public void addHeader(String name, String value) {\n \n+        if (name == null || name.length() == 0 || value == null) {\n+            return;\n+        }\n+\n         if (isCommitted())\n             return;\n \n@@ -1056,6 +1064,10 @@ public void addHeader(String name, String value) {\n      */\n     public void addIntHeader(String name, int value) {\n \n+        if (name == null || name.length() == 0) {\n+            return;\n+        }\n+\n         if (isCommitted())\n             return;\n \n@@ -1281,6 +1293,10 @@ public void sendRedirect(String location)\n      */\n     public void setDateHeader(String name, long value) {\n \n+        if (name == null || name.length() == 0) {\n+            return;\n+        }\n+\n         if (isCommitted())\n             return;\n \n@@ -1308,6 +1324,10 @@ public void setDateHeader(String name, long value) {\n      */\n     public void setHeader(String name, String value) {\n \n+        if (name == null || name.length() == 0 || value == null) {\n+            return;\n+        }\n+\n         if (isCommitted())\n             return;\n \n@@ -1328,6 +1348,10 @@ public void setHeader(String name, String value) {\n      */\n     public void setIntHeader(String name, int value) {\n \n+        if (name == null || name.length() == 0) {\n+            return;\n+        }\n+\n         if (isCommitted())\n             return;\n ",
                "additions": 24,
                "raw_url": "https://github.com/apache/tomcat80/raw/a1fef662d43e056695a16aad03a89298b8b011e4/java/org/apache/catalina/connector/Response.java",
                "status": "modified",
                "changes": 24,
                "deletions": 0,
                "sha": "dbfbeaa1ed09aa0bc7f500ca4240d7f8c5eafb7c",
                "blob_url": "https://github.com/apache/tomcat80/blob/a1fef662d43e056695a16aad03a89298b8b011e4/java/org/apache/catalina/connector/Response.java",
                "filename": "java/org/apache/catalina/connector/Response.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/Response.java?ref=a1fef662d43e056695a16aad03a89298b8b011e4"
            }
        ],
        "bug_id": "tomcat80_284",
        "parent": "https://github.com/apache/tomcat80/commit/3f97d9b8672859d4273121eb7cfd32fecbfaf99c",
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47451\nDon't trigger an NPE if headers with null or zero length name or set or if a null value is specified. Silently ignore any such calls in the same way the calls are ignored if the response has already been committed.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@831774 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/ace6a0068e955a07a136535a85480af0de7c68c9",
        "file": [
            {
                "patch": "@@ -735,7 +735,12 @@ public void init()\n             return;\n \n         serverSock = ServerSocketChannel.open();\n-        serverSock.socket().setPerformancePreferences(socketProperties.getPerformanceConnectionTime(),\n+        int performanceConnectionTime = socketProperties.getPerformanceConnectionTime();\n+        int performanceLatency= socketProperties.getPerformanceLatency();\n+        int performanceBandwidth = socketProperties.getPerformanceBandwidth();\n+        if (performanceConnectionTime != -1 && performanceLatency != -1 &&\n+                performanceBandwidth != -1)\n+            serverSock.socket().setPerformancePreferences(socketProperties.getPerformanceConnectionTime(),\n                                                       socketProperties.getPerformanceLatency(),\n                                                       socketProperties.getPerformanceBandwidth());\n         InetSocketAddress addr = (address!=null?new InetSocketAddress(address,port):new InetSocketAddress(port));",
                "additions": 6,
                "raw_url": "https://github.com/apache/tomcat80/raw/ace6a0068e955a07a136535a85480af0de7c68c9/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "status": "modified",
                "changes": 7,
                "deletions": 1,
                "sha": "57f61ddd7f26ec7e4a0cc34736d681d4a3ef5650",
                "blob_url": "https://github.com/apache/tomcat80/blob/ace6a0068e955a07a136535a85480af0de7c68c9/java/org/apache/tomcat/util/net/NioEndpoint.java",
                "filename": "java/org/apache/tomcat/util/net/NioEndpoint.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/NioEndpoint.java?ref=ace6a0068e955a07a136535a85480af0de7c68c9"
            },
            {
                "patch": "@@ -210,55 +210,82 @@ public boolean getDirectBuffer() {\n     }\n \n     public boolean getOoBInline() {\n-        return ooBInline.booleanValue();\n+        if(ooBInline != null)\n+            return ooBInline.booleanValue();\n+        return false;\n     }\n \n     public int getPerformanceBandwidth() {\n-        return performanceBandwidth.intValue();\n+        if(performanceBandwidth != null)\n+            return performanceBandwidth.intValue();\n+        return -1;\n     }\n \n     public int getPerformanceConnectionTime() {\n-        return performanceConnectionTime.intValue();\n+        if(performanceConnectionTime!= null)\n+            return performanceConnectionTime.intValue();\n+        return -1;\n+          \n     }\n \n     public int getPerformanceLatency() {\n-        return performanceLatency.intValue();\n+        if(performanceLatency != null)\n+            return performanceLatency.intValue();\n+        return -1 ;\n     }\n \n     public int getRxBufSize() {\n-        return rxBufSize.intValue();\n+        if(rxBufSize != null)\n+            return rxBufSize.intValue();\n+        return -1;\n     }\n \n     public boolean getSoKeepAlive() {\n-        return soKeepAlive.booleanValue();\n+        if(soKeepAlive != null)\n+            return soKeepAlive.booleanValue();\n+        return false;\n     }\n \n     public boolean getSoLingerOn() {\n-        return soLingerOn.booleanValue();\n+        if(soLingerOn != null)\n+            return soLingerOn.booleanValue();\n+        return false;\n     }\n \n     public int getSoLingerTime() {\n-        return soLingerTime.intValue();\n+        if(soLingerTime != null)\n+            return soLingerTime.intValue();\n+        return -1;\n     }\n \n     public boolean getSoReuseAddress() {\n-        return soReuseAddress.booleanValue();\n+        if(soReuseAddress != null)\n+            return soReuseAddress.booleanValue();\n+        return false;\n     }\n \n     public int getSoTimeout() {\n-        return soTimeout.intValue();\n+        if(soTimeout != null)\n+            return soTimeout.intValue();\n+        return -1;\n     }\n \n     public int getSoTrafficClass() {\n-        return soTrafficClass.intValue();\n+        if(soTrafficClass != null)\n+            return soTrafficClass.intValue();\n+        return -1;\n     }\n \n     public boolean getTcpNoDelay() {\n-        return tcpNoDelay.booleanValue();\n+        if(tcpNoDelay != null)\n+            return tcpNoDelay.booleanValue();\n+        return false;\n     }\n \n     public int getTxBufSize() {\n-        return txBufSize.intValue();\n+        if(txBufSize != null)\n+            return txBufSize.intValue();\n+        return -1;\n     }\n \n     public int getBufferPool() {",
                "additions": 40,
                "raw_url": "https://github.com/apache/tomcat80/raw/ace6a0068e955a07a136535a85480af0de7c68c9/java/org/apache/tomcat/util/net/SocketProperties.java",
                "status": "modified",
                "changes": 53,
                "deletions": 13,
                "sha": "1a39718a2ceb3047eab7b543ce88fecddc8776b8",
                "blob_url": "https://github.com/apache/tomcat80/blob/ace6a0068e955a07a136535a85480af0de7c68c9/java/org/apache/tomcat/util/net/SocketProperties.java",
                "filename": "java/org/apache/tomcat/util/net/SocketProperties.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/SocketProperties.java?ref=ace6a0068e955a07a136535a85480af0de7c68c9"
            }
        ],
        "bug_id": "tomcat80_285",
        "parent": "https://github.com/apache/tomcat80/commit/c6759d3ffb5724c87e34eb9e15533216f00347db",
        "message": "Fix NPE to use Http11NioProtocol handler with default parameters!\n# example:\n<Executor name=\"tomcatThreadPool\" namePrefix=\"catalina-exec-\" \n        maxThreads=\"150\" minSpareThreads=\"4\"/>\n<Connector executor=\"tomcatThreadPool\"\n               port=\"8080\" protocol=\"org.apache.coyote.http11.Http11NioProtocol\" \n               connectionTimeout=\"20000\" \n               redirectPort=\"8443\" />\n\nUsed at MAC OS X with \"-Djava.net.preferIPv4Stack=true\"\n\nI am not sure that default returns are correct!\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@712278 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    },
    {
        "commit": "https://github.com/apache/tomcat80/commit/48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6",
        "file": [
            {
                "patch": "@@ -14,6 +14,8 @@\n # limitations under the License.\n \n mapper.removeWrapper=Removing wrapper from Context [{0}] with path [{1}]\n+mapper.duplicateHost=Duplicate Host [{0}]. The name is already used by Host [{1}]. This Host will be ignored.\n+mapper.duplicateHostAlias=Duplicate host Alias [{0}] in Host [{1}]. The name is already used by Host [{2}]. This Alias will be ignored.\n \n mapperListener.unknownDefaultHost=Unknown default host [{0}] for service [{1}]\n mapperListener.registerHost=Register host [{0}] at domain [{1}] for service [{2}]",
                "additions": 2,
                "raw_url": "https://github.com/apache/tomcat80/raw/48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6/java/org/apache/catalina/mapper/LocalStrings.properties",
                "status": "modified",
                "changes": 2,
                "deletions": 0,
                "sha": "df0734c091c3b386e6e96faf69794d24e0626a8d",
                "blob_url": "https://github.com/apache/tomcat80/blob/48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6/java/org/apache/catalina/mapper/LocalStrings.properties",
                "filename": "java/org/apache/catalina/mapper/LocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/mapper/LocalStrings.properties?ref=48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6"
            },
            {
                "patch": "@@ -94,16 +94,16 @@ public synchronized void addHost(String name, String[] aliases,\n         newHost.object = host;\n         if (insertMap(hosts, newHosts, newHost)) {\n             hosts = newHosts;\n+        } else {\n+            MappedHost duplicate = hosts[find(hosts, name)];\n+            String duplicateHostName = duplicate.object.getName();\n+            log.error(sm.getString(\"mapper.duplicateHost\", name,\n+                    duplicateHostName));\n+            // Do not add aliases, as removeHost(hostName) won't be able to remove them\n+            return;\n         }\n-        for (int i = 0; i < aliases.length; i++) {\n-            newHosts = new MappedHost[hosts.length + 1];\n-            newHost = new MappedHost();\n-            newHost.name = aliases[i];\n-            newHost.contextList = contextList;\n-            newHost.object = host;\n-            if (insertMap(hosts, newHosts, newHost)) {\n-                hosts = newHosts;\n-            }\n+        for (String alias : aliases) {\n+            addHostAliasImpl(newHost, alias);\n         }\n     }\n \n@@ -115,15 +115,16 @@ public synchronized void addHost(String name, String[] aliases,\n      */\n     public synchronized void removeHost(String name) {\n         // Find and remove the old host\n-        int pos = find(hosts, name);\n-        if (pos < 0) {\n+        MappedHost mappedHost = exactFind(hosts, name);\n+        if (mappedHost == null) {\n             return;\n         }\n-        Host host = hosts[pos].object;\n+        Host host = mappedHost.object;\n         MappedHost[] newHosts = new MappedHost[hosts.length - 1];\n         if (removeMap(hosts, newHosts, name)) {\n             hosts = newHosts;\n         }\n+\n         // Remove all aliases (they will map to the same host object)\n         for (int i = 0; i < newHosts.length; i++) {\n             if (newHosts[i].object == host) {\n@@ -141,21 +142,34 @@ public synchronized void removeHost(String name) {\n      * @param alias The alias to add\n      */\n     public synchronized void addHostAlias(String name, String alias) {\n-        int pos = find(hosts, name);\n-        if (pos < 0) {\n+        MappedHost realHost = exactFind(hosts, name);\n+        if (realHost == null) {\n             // Should not be adding an alias for a host that doesn't exist but\n             // just in case...\n             return;\n         }\n-        MappedHost realHost = hosts[pos];\n+        addHostAliasImpl(realHost, alias);\n+    }\n \n+    private void addHostAliasImpl(MappedHost realHost, String alias) {\n+        if (alias.equals(realHost.name)) {\n+            // An Alias with the same name as its own Host.\n+            // A harmless redundancy. E.g.\n+            // <Host name=\"localhost\"><Alias>localhost</Alias></Host>\n+            return;\n+        }\n         MappedHost[] newHosts = new MappedHost[hosts.length + 1];\n         MappedHost newHost = new MappedHost();\n         newHost.name = alias;\n         newHost.contextList = realHost.contextList;\n         newHost.object = realHost.object;\n         if (insertMap(hosts, newHosts, newHost)) {\n             hosts = newHosts;\n+        } else {\n+            MappedHost duplicate = hosts[find(hosts, alias)];\n+            String duplicateHostName = duplicate.object.getName();\n+            log.error(sm.getString(\"mapper.duplicateHostAlias\", alias,\n+                    realHost.name, duplicateHostName));\n         }\n     }\n \n@@ -165,8 +179,7 @@ public synchronized void addHostAlias(String name, String alias) {\n      */\n     public synchronized void removeHostAlias(String alias) {\n         // Find and remove the alias\n-        int pos = find(hosts, alias);\n-        if (pos < 0) {\n+        if (exactFind(hosts, alias) == null) {\n             return;\n         }\n         MappedHost[] newHosts = new MappedHost[hosts.length - 1];\n@@ -193,52 +206,51 @@ public void addContextVersion(String hostName, Host host, String path,\n             WebResourceRoot resources) {\n \n         MappedHost[] hosts = this.hosts;\n-        int pos = find(hosts, hostName);\n-        if( pos <0 ) {\n+        MappedHost mappedHost = exactFind(hosts, hostName);\n+        if (mappedHost == null) {\n             addHost(hostName, new String[0], host);\n             hosts = this.hosts;\n-            pos = find(hosts, hostName);\n-        }\n-        if (pos < 0) {\n-            log.error(\"No host found: \" + hostName);\n+            mappedHost = exactFind(hosts, hostName);\n+            if (mappedHost == null) {\n+                log.error(\"No host found: \" + hostName);\n+                return;\n+            }\n         }\n-        MappedHost mappedHost = hosts[pos];\n-        if (mappedHost.name.equals(hostName)) {\n-            int slashCount = slashCount(path);\n-            synchronized (mappedHost) {\n+        int slashCount = slashCount(path);\n+        synchronized (mappedHost) {\n+            // Update nesting\n+            if (slashCount > mappedHost.contextList.nesting) {\n+                mappedHost.contextList.nesting = slashCount;\n+            }\n+            MappedContext mappedContext;\n+            {\n                 MappedContext[] contexts = mappedHost.contextList.contexts;\n-                // Update nesting\n-                if (slashCount > mappedHost.contextList.nesting) {\n-                    mappedHost.contextList.nesting = slashCount;\n-                }\n-                int pos2 = find(contexts, path);\n-                if (pos2 < 0 || !path.equals(contexts[pos2].name)) {\n-                    MappedContext newContext = new MappedContext();\n-                    newContext.name = path;\n+                mappedContext = exactFind(contexts, path);\n+                if (mappedContext == null) {\n+                    mappedContext = new MappedContext();\n+                    mappedContext.name = path;\n                     MappedContext[] newContexts = new MappedContext[contexts.length + 1];\n-                    if (insertMap(contexts, newContexts, newContext)) {\n+                    if (insertMap(contexts, newContexts, mappedContext)) {\n                         mappedHost.contextList.contexts = newContexts;\n+                        // contexts = newContexts;\n                     }\n-                    pos2 = find(newContexts, path);\n                 }\n+            }\n \n-                MappedContext mappedContext = mappedHost.contextList.contexts[pos2];\n-\n-                ContextVersion[] contextVersions = mappedContext.versions;\n-                ContextVersion[] newContextVersions =\n-                    new ContextVersion[contextVersions.length + 1];\n-                ContextVersion newContextVersion = new ContextVersion();\n-                newContextVersion.path = path;\n-                newContextVersion.slashCount = slashCount;\n-                newContextVersion.name = version;\n-                newContextVersion.object = context;\n-                newContextVersion.welcomeResources = welcomeResources;\n-                newContextVersion.resources = resources;\n-                if (insertMap(contextVersions, newContextVersions, newContextVersion)) {\n-                    mappedContext.versions = newContextVersions;\n-                    contextObjectToContextVersionMap.put(\n-                            context, newContextVersion);\n-                }\n+            ContextVersion[] contextVersions = mappedContext.versions;\n+            ContextVersion[] newContextVersions =\n+                new ContextVersion[contextVersions.length + 1];\n+            ContextVersion newContextVersion = new ContextVersion();\n+            newContextVersion.path = path;\n+            newContextVersion.slashCount = slashCount;\n+            newContextVersion.name = version;\n+            newContextVersion.object = context;\n+            newContextVersion.welcomeResources = welcomeResources;\n+            newContextVersion.resources = resources;\n+            if (insertMap(contextVersions, newContextVersions, newContextVersion)) {\n+                mappedContext.versions = newContextVersions;\n+                contextObjectToContextVersionMap.put(\n+                        context, newContextVersion);\n             }\n         }\n \n@@ -258,43 +270,39 @@ public void removeContextVersion(Context ctxt, String hostName,\n \n         contextObjectToContextVersionMap.remove(ctxt);\n \n-        MappedHost[] hosts = this.hosts;\n-        int pos = find(hosts, hostName);\n-        if (pos < 0) {\n+        MappedHost host = exactFind(this.hosts, hostName);\n+        if (host == null) {\n             return;\n         }\n-        MappedHost host = hosts[pos];\n-        if (host.name.equals(hostName)) {\n-            synchronized (host) {\n-                MappedContext[] contexts = host.contextList.contexts;\n-                if (contexts.length == 0 ){\n-                    return;\n-                }\n \n-                int pos2 = find(contexts, path);\n-                if (pos2 < 0 || !path.equals(contexts[pos2].name)) {\n-                    return;\n-                }\n-                MappedContext context = contexts[pos2];\n-\n-                ContextVersion[] contextVersions = context.versions;\n-                ContextVersion[] newContextVersions =\n-                    new ContextVersion[contextVersions.length - 1];\n-                if (removeMap(contextVersions, newContextVersions, version)) {\n-                    context.versions = newContextVersions;\n-\n-                    if (context.versions.length == 0) {\n-                        // Remove the context\n-                        MappedContext[] newContexts = new MappedContext[contexts.length -1];\n-                        if (removeMap(contexts, newContexts, path)) {\n-                            host.contextList.contexts = newContexts;\n-                            // Recalculate nesting\n-                            host.contextList.nesting = 0;\n-                            for (int i = 0; i < newContexts.length; i++) {\n-                                int slashCount = slashCount(newContexts[i].name);\n-                                if (slashCount > host.contextList.nesting) {\n-                                    host.contextList.nesting = slashCount;\n-                                }\n+        synchronized (host) {\n+            MappedContext[] contexts = host.contextList.contexts;\n+            if (contexts.length == 0 ){\n+                return;\n+            }\n+\n+            MappedContext context = exactFind(contexts, path);\n+            if (context == null) {\n+                return;\n+            }\n+\n+            ContextVersion[] contextVersions = context.versions;\n+            ContextVersion[] newContextVersions =\n+                new ContextVersion[contextVersions.length - 1];\n+            if (removeMap(contextVersions, newContextVersions, version)) {\n+                context.versions = newContextVersions;\n+\n+                if (context.versions.length == 0) {\n+                    // Remove the context\n+                    MappedContext[] newContexts = new MappedContext[contexts.length -1];\n+                    if (removeMap(contexts, newContexts, path)) {\n+                        host.contextList.contexts = newContexts;\n+                        // Recalculate nesting\n+                        host.contextList.nesting = 0;\n+                        for (int i = 0; i < newContexts.length; i++) {\n+                            int slashCount = slashCount(newContexts[i].name);\n+                            if (slashCount > host.contextList.nesting) {\n+                                host.contextList.nesting = slashCount;\n                             }\n                         }\n                     }\n@@ -308,34 +316,24 @@ public void addWrapper(String hostName, String contextPath, String version,\n                            String path, Wrapper wrapper, boolean jspWildCard,\n                            boolean resourceOnly) {\n         MappedHost[] hosts = this.hosts;\n-        int pos = find(hosts, hostName);\n-        if (pos < 0) {\n+        MappedHost host = exactFind(hosts, hostName);\n+        if (host == null) {\n             return;\n         }\n-        MappedHost host = hosts[pos];\n-        if (host.name.equals(hostName)) {\n-            MappedContext[] contexts = host.contextList.contexts;\n-            int pos2 = find(contexts, contextPath);\n-            if (pos2 < 0) {\n-                log.error(\"No context found: \" + contextPath );\n-                return;\n-            }\n-            MappedContext context = contexts[pos2];\n-            if (context.name.equals(contextPath)) {\n-                ContextVersion[] contextVersions = context.versions;\n-                int pos3 = find(contextVersions, version);\n-                if( pos3<0 ) {\n-                    log.error(\"No context version found: \" + contextPath + \" \" +\n-                            version);\n-                    return;\n-                }\n-                ContextVersion contextVersion = contextVersions[pos3];\n-                if (contextVersion.name.equals(version)) {\n-                    addWrapper(contextVersion, path, wrapper, jspWildCard,\n-                            resourceOnly);\n-                }\n-            }\n+        MappedContext[] contexts = host.contextList.contexts;\n+        MappedContext context = exactFind(contexts, contextPath);\n+        if (context == null) {\n+            log.error(\"No context found: \" + contextPath );\n+            return;\n+        }\n+        ContextVersion[] contextVersions = context.versions;\n+        ContextVersion contextVersion = exactFind(contextVersions, version);\n+        if (contextVersion == null) {\n+            log.error(\"No context version found: \" + contextPath + \" \" +\n+                    version);\n+            return;\n         }\n+        addWrapper(contextVersion, path, wrapper, jspWildCard, resourceOnly);\n     }\n \n \n@@ -411,33 +409,24 @@ protected void addWrapper(ContextVersion context, String path,\n      * @param contextPath Context path this wrapper belongs to\n      * @param path Wrapper mapping\n      */\n-    public void removeWrapper\n-        (String hostName, String contextPath, String version, String path) {\n+    public void removeWrapper(String hostName, String contextPath,\n+            String version, String path) {\n         MappedHost[] hosts = this.hosts;\n-        int pos = find(hosts, hostName);\n-        if (pos < 0) {\n+        MappedHost host = exactFind(hosts, hostName);\n+        if (host == null) {\n             return;\n         }\n-        MappedHost host = hosts[pos];\n-        if (host.name.equals(hostName)) {\n-            MappedContext[] contexts = host.contextList.contexts;\n-            int pos2 = find(contexts, contextPath);\n-            if (pos2 < 0) {\n-                return;\n-            }\n-            MappedContext context = contexts[pos2];\n-            if (context.name.equals(contextPath)) {\n-                ContextVersion[] contextVersions = context.versions;\n-                int pos3 = find(contextVersions, version);\n-                if( pos3<0 ) {\n-                    return;\n-                }\n-                ContextVersion contextVersion = contextVersions[pos3];\n-                if (contextVersion.name.equals(version)) {\n-                    removeWrapper(contextVersion, path);\n-                }\n-            }\n+        MappedContext[] contexts = host.contextList.contexts;\n+        MappedContext context = exactFind(contexts, contextPath);\n+        if (context == null) {\n+            return;\n+        }\n+        ContextVersion[] contextVersions = context.versions;\n+        ContextVersion contextVersion = exactFind(contextVersions, version);\n+        if (contextVersion == null) {\n+            return;\n         }\n+        removeWrapper(contextVersion, path);\n     }\n \n     protected void removeWrapper(ContextVersion context, String path) {\n@@ -516,41 +505,31 @@ protected void removeWrapper(ContextVersion context, String path) {\n     public void addWelcomeFile(String hostName, String contextPath,\n             String version, String welcomeFile) {\n         MappedHost[] hosts = this.hosts;\n-        int pos = find(hosts, hostName);\n-        if (pos < 0) {\n+        MappedHost host = exactFind(hosts, hostName);\n+        if (host == null) {\n             return;\n         }\n-        MappedHost host = hosts[pos];\n-        if (host.name.equals(hostName)) {\n-            MappedContext[] contexts = host.contextList.contexts;\n-            int pos2 = find(contexts, contextPath);\n-            if (pos2 < 0) {\n-                log.error(\"No context found: \" + contextPath );\n-                return;\n-            }\n-            MappedContext context = contexts[pos2];\n-            if (context.name.equals(contextPath)) {\n-                ContextVersion[] contextVersions = context.versions;\n-                int pos3 = find(contextVersions, version);\n-                if( pos3<0 ) {\n-                    log.error(\"No context version found: \" + contextPath + \" \" +\n-                            version);\n-                    return;\n-                }\n-                ContextVersion contextVersion = contextVersions[pos3];\n-                if (contextVersion.name.equals(version)) {\n-                    int len = contextVersion.welcomeResources.length + 1;\n-                    String[] newWelcomeResources = new String[len];\n-                    System.arraycopy(contextVersion.welcomeResources, 0,\n-                            newWelcomeResources, 0, len - 1);\n-                    newWelcomeResources[len - 1] = welcomeFile;\n-                    contextVersion.welcomeResources = newWelcomeResources;\n-                }\n-            }\n+        MappedContext[] contexts = host.contextList.contexts;\n+        MappedContext context = exactFind(contexts, contextPath);\n+        if (context == null) {\n+            log.error(\"No context found: \" + contextPath);\n+            return;\n         }\n+        ContextVersion[] contextVersions = context.versions;\n+        ContextVersion contextVersion = exactFind(contextVersions, version);\n+        if (contextVersion == null) {\n+            log.error(\"No context version found: \" + contextPath + \" \"\n+                    + version);\n+            return;\n+        }\n+        int len = contextVersion.welcomeResources.length + 1;\n+        String[] newWelcomeResources = new String[len];\n+        System.arraycopy(contextVersion.welcomeResources, 0,\n+                newWelcomeResources, 0, len - 1);\n+        newWelcomeResources[len - 1] = welcomeFile;\n+        contextVersion.welcomeResources = newWelcomeResources;\n     }\n \n-\n     /**\n      * Remove a welcome file from the given context.\n      *\n@@ -561,53 +540,43 @@ public void addWelcomeFile(String hostName, String contextPath,\n     public void removeWelcomeFile(String hostName, String contextPath,\n             String version, String welcomeFile) {\n         MappedHost[] hosts = this.hosts;\n-        int pos = find(hosts, hostName);\n-        if (pos < 0) {\n+        MappedHost host = exactFind(hosts, hostName);\n+        if (host == null) {\n             return;\n         }\n-        MappedHost host = hosts[pos];\n-        if (host.name.equals(hostName)) {\n-            MappedContext[] contexts = host.contextList.contexts;\n-            int pos2 = find(contexts, contextPath);\n-            if (pos2 < 0) {\n-                log.error(\"No context found: \" + contextPath );\n-                return;\n+        MappedContext[] contexts = host.contextList.contexts;\n+        MappedContext context = exactFind(contexts, contextPath);\n+        if (context == null) {\n+            log.error(\"No context found: \" + contextPath);\n+            return;\n+        }\n+        ContextVersion[] contextVersions = context.versions;\n+        ContextVersion contextVersion = exactFind(contextVersions, version);\n+        if (contextVersion == null) {\n+            log.error(\"No context version found: \" + contextPath + \" \"\n+                    + version);\n+            return;\n+        }\n+        int match = -1;\n+        for (int i = 0; i < contextVersion.welcomeResources.length; i++) {\n+            if (welcomeFile.equals(contextVersion.welcomeResources[i])) {\n+                match = i;\n+                break;\n             }\n-            MappedContext context = contexts[pos2];\n-            if (context.name.equals(contextPath)) {\n-                ContextVersion[] contextVersions = context.versions;\n-                int pos3 = find(contextVersions, version);\n-                if( pos3<0 ) {\n-                    log.error(\"No context version found: \" + contextPath + \" \" +\n-                            version);\n-                    return;\n-                }\n-                ContextVersion contextVersion = contextVersions[pos3];\n-                if (contextVersion.name.equals(version)) {\n-                    int match = -1;\n-                    for (int i = 0; i < contextVersion.welcomeResources.length; i++) {\n-                        if (welcomeFile.equals(contextVersion.welcomeResources[i])) {\n-                            match = i;\n-                            break;\n-                        }\n-                    }\n-                    if (match > -1) {\n-                        int len = contextVersion.welcomeResources.length - 1;\n-                        String[] newWelcomeResources = new String[len];\n-                        System.arraycopy(contextVersion.welcomeResources, 0,\n-                                newWelcomeResources, 0, match);\n-                        if (match < len) {\n-                            System.arraycopy(contextVersion.welcomeResources, match + 1,\n-                                    newWelcomeResources, match, len - match);\n-                        }\n-                        contextVersion.welcomeResources = newWelcomeResources;\n-                    }\n-                }\n+        }\n+        if (match > -1) {\n+            int len = contextVersion.welcomeResources.length - 1;\n+            String[] newWelcomeResources = new String[len];\n+            System.arraycopy(contextVersion.welcomeResources, 0,\n+                    newWelcomeResources, 0, match);\n+            if (match < len) {\n+                System.arraycopy(contextVersion.welcomeResources, match + 1,\n+                        newWelcomeResources, match, len - match);\n             }\n+            contextVersion.welcomeResources = newWelcomeResources;\n         }\n     }\n \n-\n     /**\n      * Clear the welcome files for the given context.\n      *\n@@ -617,36 +586,26 @@ public void removeWelcomeFile(String hostName, String contextPath,\n     public void clearWelcomeFiles(String hostName, String contextPath,\n             String version) {\n         MappedHost[] hosts = this.hosts;\n-        int pos = find(hosts, hostName);\n-        if (pos < 0) {\n+        MappedHost host = exactFind(hosts, hostName);\n+        if (host == null) {\n             return;\n         }\n-        MappedHost host = hosts[pos];\n-        if (host.name.equals(hostName)) {\n-            MappedContext[] contexts = host.contextList.contexts;\n-            int pos2 = find(contexts, contextPath);\n-            if (pos2 < 0) {\n-                log.error(\"No context found: \" + contextPath );\n-                return;\n-            }\n-            MappedContext context = contexts[pos2];\n-            if (context.name.equals(contextPath)) {\n-                ContextVersion[] contextVersions = context.versions;\n-                int pos3 = find(contextVersions, version);\n-                if( pos3<0 ) {\n-                    log.error(\"No context version found: \" + contextPath + \" \" +\n-                            version);\n-                    return;\n-                }\n-                ContextVersion contextVersion = contextVersions[pos3];\n-                if (contextVersion.name.equals(version)) {\n-                    contextVersion.welcomeResources = new String[0];\n-                }\n-            }\n+        MappedContext[] contexts = host.contextList.contexts;\n+        MappedContext context = exactFind(contexts, contextPath);\n+        if (context == null) {\n+            log.error(\"No context found: \" + contextPath);\n+            return;\n+        }\n+        ContextVersion[] contextVersions = context.versions;\n+        ContextVersion contextVersion = exactFind(contextVersions, version);\n+        if (contextVersion == null) {\n+            log.error(\"No context version found: \" + contextPath + \" \"\n+                    + version);\n+            return;\n         }\n+        contextVersion.welcomeResources = new String[0];\n     }\n \n-\n     /**\n      * Map the specified host name and URI, mutating the given mapping data.\n      *\n@@ -712,24 +671,19 @@ private final void internalMap(CharChunk host, CharChunk uri,\n         // Virtual host mapping\n         if (mappingData.host == null) {\n             MappedHost[] hosts = this.hosts;\n-            int pos = findIgnoreCase(hosts, host);\n-            if ((pos != -1) && (host.equalsIgnoreCase(hosts[pos].name))) {\n-                mappingData.host = hosts[pos].object;\n-                contexts = hosts[pos].contextList.contexts;\n-                nesting = hosts[pos].contextList.nesting;\n-            } else {\n+            MappedHost mappedHost = exactFindIgnoreCase(hosts, host);\n+            if (mappedHost == null) {\n                 if (defaultHostName == null) {\n                     return;\n                 }\n-                pos = find(hosts, defaultHostName);\n-                if ((pos != -1) && (defaultHostName.equals(hosts[pos].name))) {\n-                    mappingData.host = hosts[pos].object;\n-                    contexts = hosts[pos].contextList.contexts;\n-                    nesting = hosts[pos].contextList.nesting;\n-                } else {\n+                mappedHost = exactFind(hosts, defaultHostName);\n+                if (mappedHost == null) {\n                     return;\n                 }\n             }\n+            mappingData.host = mappedHost.object;\n+            contexts = mappedHost.contextList.contexts;\n+            nesting = mappedHost.contextList.nesting;\n         }\n \n         // Context mapping\n@@ -764,13 +718,12 @@ private final void internalMap(CharChunk host, CharChunk uri,\n             }\n             uri.setEnd(uriEnd);\n \n-            if (!found) {\n-                if (contexts[0].name.equals(\"\")) {\n-                    context = contexts[0];\n-                }\n-            } else {\n+            if (found) {\n                 context = contexts[pos];\n+            } else if (contexts[0].name.equals(\"\")) {\n+                context = contexts[0];\n             }\n+\n             if (context != null) {\n                 mappingData.contextPath.setString(context.name);\n             }\n@@ -787,17 +740,12 @@ private final void internalMap(CharChunk host, CharChunk uri,\n                 mappingData.contexts = contextObjects;\n             }\n \n-            if (version == null) {\n+            if (version != null) {\n+                contextVersion = exactFind(contextVersions, version);\n+            }\n+            if (contextVersion == null) {\n                 // Return the latest version\n                 contextVersion = contextVersions[versionCount - 1];\n-            } else {\n-                int pos = find(contextVersions, version);\n-                if (pos < 0 || !contextVersions[pos].name.equals(version)) {\n-                    // Return the latest version\n-                    contextVersion = contextVersions[versionCount - 1];\n-                } else {\n-                    contextVersion = contextVersions[pos];\n-                }\n             }\n             mappingData.context = contextVersion.object;\n             mappingData.contextSlashCount = contextVersion.slashCount;\n@@ -1015,18 +963,18 @@ private final void internalMapWrapper(ContextVersion contextVersion,\n      */\n     private final void internalMapExactWrapper\n         (MappedWrapper[] wrappers, CharChunk path, MappingData mappingData) {\n-        int pos = find(wrappers, path);\n-        if ((pos != -1) && (path.equals(wrappers[pos].name))) {\n-            mappingData.requestPath.setString(wrappers[pos].name);\n-            mappingData.wrapper = wrappers[pos].object;\n+        MappedWrapper wrapper = exactFind(wrappers, path);\n+        if (wrapper != null) {\n+            mappingData.requestPath.setString(wrapper.name);\n+            mappingData.wrapper = wrapper.object;\n             if (path.equals(\"/\")) {\n                 // Special handling for Context Root mapped servlet\n                 mappingData.pathInfo.setString(\"/\");\n                 mappingData.wrapperPath.setString(\"\");\n                 // This seems wrong but it is what the spec says...\n                 mappingData.contextPath.setString(\"\");\n             } else {\n-                mappingData.wrapperPath.setString(wrappers[pos].name);\n+                mappingData.wrapperPath.setString(wrapper.name);\n             }\n         }\n     }\n@@ -1114,14 +1062,14 @@ private final void internalMapExtensionWrapper(MappedWrapper[] wrappers,\n             if (period >= 0) {\n                 path.setOffset(period + 1);\n                 path.setEnd(pathEnd);\n-                int pos = find(wrappers, path);\n-                if ((pos != -1) && (path.equals(wrappers[pos].name)) &&\n-                        (resourceExpected || !wrappers[pos].resourceOnly)) {\n-                    mappingData.wrapperPath.setChars\n-                        (buf, servletPath, pathEnd - servletPath);\n-                    mappingData.requestPath.setChars\n-                        (buf, servletPath, pathEnd - servletPath);\n-                    mappingData.wrapper = wrappers[pos].object;\n+                MappedWrapper wrapper = exactFind(wrappers, path);\n+                if (wrapper != null\n+                        && (resourceExpected || !wrapper.resourceOnly)) {\n+                    mappingData.wrapperPath.setChars(buf, servletPath, pathEnd\n+                            - servletPath);\n+                    mappingData.requestPath.setChars(buf, servletPath, pathEnd\n+                            - servletPath);\n+                    mappingData.wrapper = wrapper.object;\n                 }\n                 path.setOffset(servletPath);\n                 path.setEnd(pathEnd);\n@@ -1246,6 +1194,7 @@ private final void internalMapExtensionWrapper(MappedWrapper[] wrappers,\n      * Find a map element given its name in a sorted array of map elements.\n      * This will return the index for the closest inferior or equal item in the\n      * given array.\n+     * @see #exactFind(MapElement[], String)\n      */\n     private static final <T> int find(MapElement<T>[] map, String name) {\n \n@@ -1288,6 +1237,60 @@ private final void internalMapExtensionWrapper(MappedWrapper[] wrappers,\n     }\n \n \n+    /**\n+     * Find a map element given its name in a sorted array of map elements. This\n+     * will return the element that you were searching for. Otherwise it will\n+     * return <code>null</code>.\n+     * @see #find(MapElement[], String)\n+     */\n+    private static final <T, E extends MapElement<T>> E exactFind(E[] map,\n+            String name) {\n+        int pos = find(map, name);\n+        if (pos >= 0) {\n+            E result = map[pos];\n+            if (name.equals(result.name)) {\n+                return result;\n+            }\n+        }\n+        return null;\n+    }\n+\n+    /**\n+     * Find a map element given its name in a sorted array of map elements. This\n+     * will return the element that you were searching for. Otherwise it will\n+     * return <code>null</code>.\n+     */\n+    private static final <T, E extends MapElement<T>> E exactFind(E[] map,\n+            CharChunk name) {\n+        int pos = find(map, name);\n+        if (pos >= 0) {\n+            E result = map[pos];\n+            if (name.equals(result.name)) {\n+                return result;\n+            }\n+        }\n+        return null;\n+    }\n+\n+    /**\n+     * Find a map element given its name in a sorted array of map elements. This\n+     * will return the element that you were searching for. Otherwise it will\n+     * return <code>null</code>.\n+     * @see #findIgnoreCase(MapElement[], CharChunk)\n+     */\n+    private static final <T, E extends MapElement<T>> E exactFindIgnoreCase(\n+            E[] map, CharChunk name) {\n+        int pos = findIgnoreCase(map, name);\n+        if (pos >= 0) {\n+            E result = map[pos];\n+            if (name.equalsIgnoreCase(result.name)) {\n+                return result;\n+            }\n+        }\n+        return null;\n+    }\n+\n+\n     /**\n      * Compare given char chunk with String.\n      * Return -1, 0 or +1 if inferior, equal, or superior to the String.",
                "additions": 273,
                "raw_url": "https://github.com/apache/tomcat80/raw/48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6/java/org/apache/catalina/mapper/Mapper.java",
                "status": "modified",
                "changes": 543,
                "deletions": 270,
                "sha": "7a963a558edf777b189ef5019e2e76332a8e76f4",
                "blob_url": "https://github.com/apache/tomcat80/blob/48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6/java/org/apache/catalina/mapper/Mapper.java",
                "filename": "java/org/apache/catalina/mapper/Mapper.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/mapper/Mapper.java?ref=48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6"
            },
            {
                "patch": "@@ -47,6 +47,10 @@\n <section name=\"Tomcat 8.0.10 (markt)\">\n   <subsection name=\"Catalina\">\n     <changelog>\n+      <fix>\n+        <bug>44312</bug>: Log an error if there is a conflict between Host and\n+        Alias names. (kkolinko)\n+      </fix>\n       <scode>\n         <bug>56611</bug>: Refactor code to remove inefficient calls to\n         <code>Method.isAnnotationPresent()</code>. Based on a patch by Jian Mou.",
                "additions": 4,
                "raw_url": "https://github.com/apache/tomcat80/raw/48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6/webapps/docs/changelog.xml",
                "status": "modified",
                "changes": 4,
                "deletions": 0,
                "sha": "5e0c393e9c202cce1b93ce4852c03c2361ac66c4",
                "blob_url": "https://github.com/apache/tomcat80/blob/48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6/webapps/docs/changelog.xml",
                "filename": "webapps/docs/changelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6"
            }
        ],
        "bug_id": "tomcat80_286",
        "parent": "https://github.com/apache/tomcat80/commit/068893a5c8080b224cbac54e832984b37a40ac64",
        "message": "Fix http://issues.apache.org/bugzilla/show_bug.cgi?id=44312\nLog an error if there is a conflict between Host and Alias names.\n\nThis also includes the following:\n\n1. Implemented exactFind() methods that combine find() with a check that an exact match was found.\nThis allows to simplify the code.\n\n2. Fixed behaviour of Mapper.removeHost() in case if the host is not found. Now it won't throw an NPE.\n\n3. Fixed error logging of various Mapper.removeXxx() methods, where only \"(pos<0)\" case was logged as \"not found\". The change is that now it logs in wrong-match-found case as well.\nI did not introduce i18n there, as I do not see a real use case for those messages.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1604066 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "tomcat80"
    }
]