{
    "karaf_05fbd39": {
        "bug_id": "karaf_05fbd39",
        "commit": "https://github.com/apache/karaf/commit/05fbd3907eb580fdab1cc8e2738a421f59ab53e9",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/karaf/blob/05fbd3907eb580fdab1cc8e2738a421f59ab53e9/gshell/gshell-features/src/main/java/org/apache/servicemix/gshell/features/internal/FeaturesServiceImpl.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/gshell/gshell-features/src/main/java/org/apache/servicemix/gshell/features/internal/FeaturesServiceImpl.java?ref=05fbd3907eb580fdab1cc8e2738a421f59ab53e9",
                "deletions": 1,
                "filename": "gshell/gshell-features/src/main/java/org/apache/servicemix/gshell/features/internal/FeaturesServiceImpl.java",
                "patch": "@@ -173,7 +173,7 @@ protected Bundle installBundleIfNeeded(String bundleLocation) throws IOException\n             Version v = vStr == null ? Version.emptyVersion : Version.parseVersion(vStr);\n             boolean install = true;\n             for (Bundle b : bundleContext.getBundles()) {\n-                if (b.getSymbolicName().equals(sn)) {\n+                if (b.getSymbolicName() != null && b.getSymbolicName().equals(sn)) {\n                     vStr = (String) b.getHeaders().get(Constants.BUNDLE_VERSION);\n                     Version bv = vStr == null ? Version.emptyVersion : Version.parseVersion(vStr);\n                     if (v.equals(bv)) {",
                "raw_url": "https://github.com/apache/karaf/raw/05fbd3907eb580fdab1cc8e2738a421f59ab53e9/gshell/gshell-features/src/main/java/org/apache/servicemix/gshell/features/internal/FeaturesServiceImpl.java",
                "sha": "3fad0ac98c43f5ff776035450b5c3b331aa936e3",
                "status": "modified"
            }
        ],
        "message": "SMX4-72: NPE when doing 'features install'\n\ngit-svn-id: https://svn.apache.org/repos/asf/servicemix/smx4/kernel/trunk@679694 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/karaf/commit/ed06101aa6f2e0e394bbabc260f24c45dd7c2963",
        "patched_files": [
            "FeaturesServiceImpl.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "FeaturesServiceImplTest.java"
        ]
    },
    "karaf_0b6a673": {
        "bug_id": "karaf_0b6a673",
        "commit": "https://github.com/apache/karaf/commit/0b6a6736cb461f098e9d59f1986e25e2a480c460",
        "file": [
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/karaf/blob/0b6a6736cb461f098e9d59f1986e25e2a480c460/client/src/main/java/org/apache/karaf/client/Main.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/client/src/main/java/org/apache/karaf/client/Main.java?ref=0b6a6736cb461f098e9d59f1986e25e2a480c460",
                "deletions": 2,
                "filename": "client/src/main/java/org/apache/karaf/client/Main.java",
                "patch": "@@ -51,8 +51,6 @@\n import org.apache.sshd.client.channel.PtyCapableChannelSession;\n import org.apache.sshd.client.future.ConnectFuture;\n import org.apache.sshd.client.session.ClientSession;\n-import org.apache.sshd.common.FactoryManager;\n-import org.apache.sshd.common.PropertyResolverUtils;\n import org.apache.sshd.common.RuntimeSshException;\n import org.apache.sshd.common.channel.PtyMode;\n import org.apache.sshd.common.config.keys.FilePasswordProvider;\n@@ -178,8 +176,16 @@ else if (console != null) {\n             session.auth().verify();\n \n             int exitStatus = 0;\n+            String type = System.getProperty(TerminalBuilder.PROP_TYPE);\n+            if (type == null) {\n+                type = System.getenv(\"TERM\");\n+            }\n+            if (type == null) {\n+                type = Terminal.TYPE_DUMB;\n+            }\n             try (Terminal terminal = TerminalBuilder.builder()\n                         .nativeSignals(true)\n+                        .type(type)\n                         .signalHandler(Terminal.SignalHandler.SIG_IGN)\n                         .build()) {\n                 if (config.getCommand().length() > 0) {",
                "raw_url": "https://github.com/apache/karaf/raw/0b6a6736cb461f098e9d59f1986e25e2a480c460/client/src/main/java/org/apache/karaf/client/Main.java",
                "sha": "3e90b1a9f678e1e4b2168d557955aba822ac684b",
                "status": "modified"
            }
        ],
        "message": "[KARAF-5778] NPE in the ssh client if TERM is null",
        "parent": "https://github.com/apache/karaf/commit/c1af4ffcd53cda555056df792aedeccc5de1b880",
        "patched_files": [
            "Main.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "MainTest.java"
        ]
    },
    "karaf_0c12184": {
        "bug_id": "karaf_0c12184",
        "commit": "https://github.com/apache/karaf/commit/0c1218406bf44d8501aaba531cb4437d474dc843",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/karaf/blob/0c1218406bf44d8501aaba531cb4437d474dc843/profile/src/main/java/org/apache/karaf/profile/impl/Profiles.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/profile/src/main/java/org/apache/karaf/profile/impl/Profiles.java?ref=0c1218406bf44d8501aaba531cb4437d474dc843",
                "deletions": 1,
                "filename": "profile/src/main/java/org/apache/karaf/profile/impl/Profiles.java",
                "patch": "@@ -52,7 +52,8 @@\n                 ProfileBuilder builder;\n                 @Override\n                 public FileVisitResult preVisitDirectory(Path dir, BasicFileAttributes attrs) throws IOException {\n-                    if (dir.getFileName().toString().endsWith(PROFILE_FOLDER_SUFFIX)) {\n+                    Path fileName = dir.getFileName();\n+                    if (fileName != null && fileName.toString().endsWith(PROFILE_FOLDER_SUFFIX)) {\n                         String profileId = root.relativize(dir).toString();\n                         profileId = profileId.replaceAll(root.getFileSystem().getSeparator(), \"-\");\n                         profileId = profileId.substring(0, profileId.length() - PROFILE_FOLDER_SUFFIX.length());",
                "raw_url": "https://github.com/apache/karaf/raw/0c1218406bf44d8501aaba531cb4437d474dc843/profile/src/main/java/org/apache/karaf/profile/impl/Profiles.java",
                "sha": "7f8d483cb1fe9f626678b0ba58438a6009bd604d",
                "status": "modified"
            }
        ],
        "message": "[KARAF-3404] Fix possible NPE",
        "parent": "https://github.com/apache/karaf/commit/db1143e8966acd535d039cd2b2dbd61ffe9e2092",
        "patched_files": [
            "Profiles.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "ProfilesTest.java"
        ]
    },
    "karaf_1996fca": {
        "bug_id": "karaf_1996fca",
        "commit": "https://github.com/apache/karaf/commit/1996fca4587053dc4ef7b135e64ae3c62559aa6b",
        "file": [
            {
                "additions": 53,
                "blob_url": "https://github.com/apache/karaf/blob/1996fca4587053dc4ef7b135e64ae3c62559aa6b/features/core/src/main/java/org/apache/karaf/features/internal/region/SubsystemResolver.java",
                "changes": 100,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/src/main/java/org/apache/karaf/features/internal/region/SubsystemResolver.java?ref=1996fca4587053dc4ef7b135e64ae3c62559aa6b",
                "deletions": 47,
                "filename": "features/core/src/main/java/org/apache/karaf/features/internal/region/SubsystemResolver.java",
                "patch": "@@ -21,14 +21,7 @@\n import java.nio.file.Files;\n import java.nio.file.Paths;\n import java.nio.file.StandardOpenOption;\n-import java.util.ArrayList;\n-import java.util.Collection;\n-import java.util.Collections;\n-import java.util.HashMap;\n-import java.util.Iterator;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.Set;\n+import java.util.*;\n \n import org.apache.felix.utils.collections.DictionaryAsMap;\n import org.apache.karaf.features.BundleInfo;\n@@ -172,7 +165,10 @@ public void prepare(\n     }\n \n     public Set<String> collectPrerequisites() throws Exception {\n-        return root.collectPrerequisites();\n+        if (root != null) {\n+            return root.collectPrerequisites();\n+        }\n+        return new HashSet<String>();\n     }\n \n     public Map<Resource, List<Wire>> resolve(\n@@ -279,15 +275,17 @@ private Object toJson(Resource resource) {\n     }\n \n     private void addBundleInfos(Subsystem subsystem) {\n-        String region = getFlatSubsystemsMap().get(subsystem.getName());\n-        Map<String, BundleInfo> bis = bundleInfos.get(region);\n-        if (bis == null) {\n-            bis = new HashMap<>();\n-            bundleInfos.put(region, bis);\n-        }\n-        bis.putAll(subsystem.getBundleInfos());\n-        for (Subsystem child : subsystem.getChildren()) {\n-            addBundleInfos(child);\n+        if (subsystem != null) {\n+            String region = getFlatSubsystemsMap().get(subsystem.getName());\n+            Map<String, BundleInfo> bis = bundleInfos.get(region);\n+            if (bis == null) {\n+                bis = new HashMap<>();\n+                bundleInfos.put(region, bis);\n+            }\n+            bis.putAll(subsystem.getBundleInfos());\n+            for (Subsystem child : subsystem.getChildren()) {\n+                addBundleInfos(child);\n+            }\n         }\n     }\n \n@@ -303,28 +301,30 @@ public RegionDigraph getFlatDigraph() throws BundleException, InvalidSyntaxExcep\n         if (flatDigraph == null) {\n             flatDigraph = new StandardRegionDigraph(null, null);\n             Map<String, String> flats = getFlatSubsystemsMap();\n-            for (Region r : digraph.getRegions()) {\n-                if (r.getName().equals(flats.get(r.getName()))) {\n-                    flatDigraph.createRegion(r.getName());\n+            if (digraph != null) {\n+                for (Region r : digraph.getRegions()) {\n+                    if (r.getName().equals(flats.get(r.getName()))) {\n+                        flatDigraph.createRegion(r.getName());\n+                    }\n                 }\n-            }\n-            for (Region r : digraph.getRegions()) {\n-                for (RegionDigraph.FilteredRegion fr : digraph.getEdges(r)) {\n-                    String rt = flats.get(r.getName());\n-                    String rh = flats.get(fr.getRegion().getName());\n-                    if (!rh.equals(rt)) {\n-                        Region tail = flatDigraph.getRegion(rt);\n-                        Region head = flatDigraph.getRegion(rh);\n-                        RegionFilterBuilder rfb = flatDigraph.createRegionFilterBuilder();\n-                        for (Map.Entry<String, Collection<String>> entry : fr.getFilter().getSharingPolicy().entrySet()) {\n-                            // Discard osgi.identity namespace\n-                            if (!IDENTITY_NAMESPACE.equals(entry.getKey())) {\n-                                for (String f : entry.getValue()) {\n-                                    rfb.allow(entry.getKey(), f);\n+                for (Region r : digraph.getRegions()) {\n+                    for (RegionDigraph.FilteredRegion fr : digraph.getEdges(r)) {\n+                        String rt = flats.get(r.getName());\n+                        String rh = flats.get(fr.getRegion().getName());\n+                        if (!rh.equals(rt)) {\n+                            Region tail = flatDigraph.getRegion(rt);\n+                            Region head = flatDigraph.getRegion(rh);\n+                            RegionFilterBuilder rfb = flatDigraph.createRegionFilterBuilder();\n+                            for (Map.Entry<String, Collection<String>> entry : fr.getFilter().getSharingPolicy().entrySet()) {\n+                                // Discard osgi.identity namespace\n+                                if (!IDENTITY_NAMESPACE.equals(entry.getKey())) {\n+                                    for (String f : entry.getValue()) {\n+                                        rfb.allow(entry.getKey(), f);\n+                                    }\n                                 }\n                             }\n+                            flatDigraph.connect(tail, rfb.build(), head);\n                         }\n-                        flatDigraph.connect(tail, rfb.build(), head);\n                     }\n                 }\n             }\n@@ -390,14 +390,16 @@ public RegionDigraph getFlatDigraph() throws BundleException, InvalidSyntaxExcep\n         Map<Resource, String> resources = new HashMap<>();\n         SimpleFilter sf = createFilter(IDENTITY_NAMESPACE, \"*\",\n                 CAPABILITY_TYPE_ATTRIBUTE, TYPE_SUBSYSTEM);\n-        for (Resource resource : wiring.keySet()) {\n-            if (findMatchingCapability(resourceFilter, resource.getCapabilities(null)) != null) {\n-                // Find the subsystem where this feature is installed\n-                Wire wire = findMatchingWire(sf, wiring.get(resource));\n-                if (wire != null) {\n-                    String region = (String) wire.getCapability().getAttributes().get(IDENTITY_NAMESPACE);\n-                    region = flats.get(region);\n-                    resources.put(resource, region);\n+        if (wiring != null) {\n+            for (Resource resource : wiring.keySet()) {\n+                if (findMatchingCapability(resourceFilter, resource.getCapabilities(null)) != null) {\n+                    // Find the subsystem where this feature is installed\n+                    Wire wire = findMatchingWire(sf, wiring.get(resource));\n+                    if (wire != null) {\n+                        String region = (String) wire.getCapability().getAttributes().get(IDENTITY_NAMESPACE);\n+                        region = flats.get(region);\n+                        resources.put(resource, region);\n+                    }\n                 }\n             }\n         }\n@@ -483,13 +485,17 @@ private void findSubsystemsToFlatten(Subsystem subsystem, Map<String, String> to\n         while (isFlat(nonFlat)) {\n             nonFlat = nonFlat.getParent();\n         }\n-        toFlatten.put(subsystem.getName(), nonFlat.getName());\n-        for (Subsystem child : subsystem.getChildren()) {\n-            findSubsystemsToFlatten(child, toFlatten);\n+        if (subsystem != null) {\n+            toFlatten.put(subsystem.getName(), nonFlat.getName());\n+            for (Subsystem child : subsystem.getChildren()) {\n+                findSubsystemsToFlatten(child, toFlatten);\n+            }\n         }\n     }\n \n     private boolean isFlat(Subsystem subsystem) {\n+        if (subsystem == null || subsystem.getFeature() == null)\n+            return false;\n         return subsystem.getFeature() != null && subsystem.getFeature().getScoping() == null;\n     }\n ",
                "raw_url": "https://github.com/apache/karaf/raw/1996fca4587053dc4ef7b135e64ae3c62559aa6b/features/core/src/main/java/org/apache/karaf/features/internal/region/SubsystemResolver.java",
                "sha": "d162e9e43a92aaf4a79ee1172001e5a4684c9cf0",
                "status": "modified"
            },
            {
                "additions": 22,
                "blob_url": "https://github.com/apache/karaf/blob/1996fca4587053dc4ef7b135e64ae3c62559aa6b/features/core/src/main/java/org/apache/karaf/features/internal/service/Deployer.java",
                "changes": 38,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/src/main/java/org/apache/karaf/features/internal/service/Deployer.java?ref=1996fca4587053dc4ef7b135e64ae3c62559aa6b",
                "deletions": 16,
                "filename": "features/core/src/main/java/org/apache/karaf/features/internal/service/Deployer.java",
                "patch": "@@ -345,20 +345,24 @@ public void deploy(DeploymentState dstate, DeploymentRequest request) throws Exc\n             Set<? extends Resource> unmanaged = apply(flatten(unmanagedBundles), adapt(BundleRevision.class));\n             Set<Resource> requested = new HashSet<>();\n             // Gather bundles required by a feature\n-            for (List<Wire> wires : resolver.getWiring().values()) {\n-                for (Wire wire : wires) {\n-                    if (features.contains(wire.getRequirer()) && unmanaged.contains(wire.getProvider())) {\n-                        requested.add(wire.getProvider());\n+            if (resolver != null && resolver.getWiring() != null) {\n+                for (List<Wire> wires : resolver.getWiring().values()) {\n+                    for (Wire wire : wires) {\n+                        if (features.contains(wire.getRequirer()) && unmanaged.contains(wire.getProvider())) {\n+                            requested.add(wire.getProvider());\n+                        }\n                     }\n                 }\n             }\n             // Now, we know which bundles are completely unmanaged\n             unmanaged.removeAll(requested);\n             // Check if bundles have wires from really unmanaged bundles\n-            for (List<Wire> wires : resolver.getWiring().values()) {\n-                for (Wire wire : wires) {\n-                    if (requested.contains(wire.getProvider()) && unmanaged.contains(wire.getRequirer())) {\n-                        requested.remove(wire.getProvider());\n+            if (resolver != null && resolver.getWiring() != null) {\n+                for (List<Wire> wires : resolver.getWiring().values()) {\n+                    for (Wire wire : wires) {\n+                        if (requested.contains(wire.getProvider()) && unmanaged.contains(wire.getRequirer())) {\n+                            requested.remove(wire.getProvider());\n+                        }\n                     }\n                 }\n             }\n@@ -919,14 +923,16 @@ private void computeBundlesToRefresh(Map<Bundle, String> toRefresh, Collection<B\n         for (Bundle bundle : bundles) {\n             newFragments.put(bundle, new HashSet<Resource>());\n         }\n-        for (Resource res : resolution.keySet()) {\n-            for (Wire wire : resolution.get(res)) {\n-                if (HOST_NAMESPACE.equals(wire.getCapability().getNamespace())) {\n-                    Bundle bundle = resources.get(wire.getProvider());\n-                    if (bundle != null) {\n-                        Bundle b = resources.get(wire.getRequirer());\n-                        Resource r = b != null ? b.adapt(BundleRevision.class) : wire.getRequirer();\n-                        newFragments.get(bundle).add(r);\n+        if (resolution != null) {\n+            for (Resource res : resolution.keySet()) {\n+                for (Wire wire : resolution.get(res)) {\n+                    if (HOST_NAMESPACE.equals(wire.getCapability().getNamespace())) {\n+                        Bundle bundle = resources.get(wire.getProvider());\n+                        if (bundle != null) {\n+                            Bundle b = resources.get(wire.getRequirer());\n+                            Resource r = b != null ? b.adapt(BundleRevision.class) : wire.getRequirer();\n+                            newFragments.get(bundle).add(r);\n+                        }\n                     }\n                 }\n             }",
                "raw_url": "https://github.com/apache/karaf/raw/1996fca4587053dc4ef7b135e64ae3c62559aa6b/features/core/src/main/java/org/apache/karaf/features/internal/service/Deployer.java",
                "sha": "1414b70630a6682c930fc920c9a5841d7d6f1c85",
                "status": "modified"
            }
        ],
        "message": "KARAF-4254 - Prevent NPE in deployer and subsystem resolver",
        "parent": "https://github.com/apache/karaf/commit/2831b0f873aeefa6444a791b1b832a4130bff090",
        "patched_files": [
            "Deployer.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "DeployerTest.java"
        ]
    },
    "karaf_2b501cf": {
        "bug_id": "karaf_2b501cf",
        "commit": "https://github.com/apache/karaf/commit/2b501cf411006983759fcc392f965fd719c3d8c3",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/karaf/blob/2b501cf411006983759fcc392f965fd719c3d8c3/main/src/main/java/org/apache/karaf/main/BootstrapLogManager.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/main/src/main/java/org/apache/karaf/main/BootstrapLogManager.java?ref=2b501cf411006983759fcc392f965fd719c3d8c3",
                "deletions": 0,
                "filename": "main/src/main/java/org/apache/karaf/main/BootstrapLogManager.java",
                "patch": "@@ -65,6 +65,12 @@ public static Handler getDefaultHandler () {\n                     }\n                 }\n             }\n+\n+            if (props.getProperty(\"log4j.appender.out.file\") == null) {\n+                // manage if the log4j.appender.out.file property is not present in\n+                // the etc/org.ops4j.pax.logging.cfg file\n+                props.setProperty(\"log4j.appender.out.file\", \"${karaf.data}/log/karaf.log\");\n+            }\n             filename = Main.substVars(props.getProperty(\"log4j.appender.out.file\"),\"log4j.appender.out.file\", null, null);\n             log = new File(filename);\n         }",
                "raw_url": "https://github.com/apache/karaf/raw/2b501cf411006983759fcc392f965fd719c3d8c3/main/src/main/java/org/apache/karaf/main/BootstrapLogManager.java",
                "sha": "964bdaad08c61721a1a40c8b58a356f0c714373f",
                "status": "modified"
            }
        ],
        "message": "[KARAF-625] Missing property log4j.appender.out.file in the file etc/org.ops4j.pax.logging.cfg cause a NPE.\n\ngit-svn-id: https://svn.apache.org/repos/asf/karaf/trunk@1101562 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/karaf/commit/dd7879adaa30b2f3797e579911e50ebc84f5afbc",
        "patched_files": [
            "BootstrapLogManager.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "BootstrapLogManagerTest.java"
        ]
    },
    "karaf_2c27a5d": {
        "bug_id": "karaf_2c27a5d",
        "commit": "https://github.com/apache/karaf/commit/2c27a5dabb359e59a5e3b8610a41210f166bd17c",
        "file": [
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/karaf/blob/2c27a5dabb359e59a5e3b8610a41210f166bd17c/jaas/modules/src/main/java/org/apache/felix/karaf/jaas/modules/properties/PropertiesLoginModule.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/jaas/modules/src/main/java/org/apache/felix/karaf/jaas/modules/properties/PropertiesLoginModule.java?ref=2c27a5dabb359e59a5e3b8610a41210f166bd17c",
                "deletions": 4,
                "filename": "jaas/modules/src/main/java/org/apache/felix/karaf/jaas/modules/properties/PropertiesLoginModule.java",
                "patch": "@@ -93,13 +93,19 @@ public boolean login() throws LoginException {\n             tmpPassword = new char[0];\n         }\n \n-        String userInfos = (String) users.get(user);\n+        String userInfos = null;\n+\n+        try {\n+            userInfos = (String) users.get(user);\n+        } catch (NullPointerException e) {\n+            //error handled in the next statement\n+        }\n         if (userInfos == null) {\n-            throw new FailedLoginException(\"User does not exist\");\n+            throw new FailedLoginException(\"User \" + user + \" does not exist\");\n         }\n         String[] infos = userInfos.split(\",\");\n         if (!new String(tmpPassword).equals(infos[0])) {\n-            throw new FailedLoginException(\"Password does not match\");\n+            throw new FailedLoginException(\"Password for \" + user + \" does not match\");\n         }\n \n         principals = new HashSet<Principal>();\n@@ -111,7 +117,7 @@ public boolean login() throws LoginException {\n         users.clear();\n \n         if (debug) {\n-            LOG.debug(\"login \" + user);\n+            LOG.debug(\"Successfully logged in \" + user);\n         }\n         return true;\n     }",
                "raw_url": "https://github.com/apache/karaf/raw/2c27a5dabb359e59a5e3b8610a41210f166bd17c/jaas/modules/src/main/java/org/apache/felix/karaf/jaas/modules/properties/PropertiesLoginModule.java",
                "sha": "8219b4e910228cfb682131abc71245d52f27ad97",
                "status": "modified"
            }
        ],
        "message": "FELIX-2326: NullPointerException thrown from PropertiesLoginModule if a user doesn't exist in the properties file\n\ngit-svn-id: https://svn.apache.org/repos/asf/felix/trunk/karaf@945085 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/karaf/commit/391ba990865997933e7ea74c3628e58fdb819c50",
        "patched_files": [
            "PropertiesLoginModule.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "PropertiesLoginModuleTest.java"
        ]
    },
    "karaf_2d04de2": {
        "bug_id": "karaf_2d04de2",
        "commit": "https://github.com/apache/karaf/commit/2d04de2a7b06d6f39ecb670f217ad0606f884139",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/karaf/blob/2d04de2a7b06d6f39ecb670f217ad0606f884139/service/guard/src/main/java/org/apache/karaf/service/guard/tools/ACLConfigurationParser.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/service/guard/src/main/java/org/apache/karaf/service/guard/tools/ACLConfigurationParser.java?ref=2d04de2a7b06d6f39ecb670f217ad0606f884139",
                "deletions": 1,
                "filename": "service/guard/src/main/java/org/apache/karaf/service/guard/tools/ACLConfigurationParser.java",
                "patch": "@@ -202,7 +202,8 @@ private static Object getExactArgSignature(String methodName, String[] signature\n             else\n                 sb.append(',');\n             sb.append('\"');\n-            sb.append(param.toString().trim());\n+            if (param != null)\n+                sb.append(param.toString().trim());\n             sb.append('\"');\n         }\n         sb.append(']');\n@@ -295,6 +296,8 @@ private static boolean allParamsMatch(List<String> regexArgs, Object[] params) {\n             return false;\n \n         for (int i = 0; i < regexArgs.size(); i++) {\n+            if (params[i] == null)\n+                return false;\n             if (!params[i].toString().trim().matches(regexArgs.get(i))) {\n                 return false;\n             }",
                "raw_url": "https://github.com/apache/karaf/raw/2d04de2a7b06d6f39ecb670f217ad0606f884139/service/guard/src/main/java/org/apache/karaf/service/guard/tools/ACLConfigurationParser.java",
                "sha": "5a5af3eb0595d17b8b0290cca2671d4fe8b47d13",
                "status": "modified"
            }
        ],
        "message": "Prevent NPE in Guard ACLConfigurationParser when an argument is null\n\ngit-svn-id: https://svn.apache.org/repos/asf/karaf/trunk@1546593 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/karaf/commit/f680f9c720892f26e2308d197fe6efeec24e5063",
        "patched_files": [
            "ACLConfigurationParser.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "ACLConfigurationParserTest.java"
        ]
    },
    "karaf_4eed514": {
        "bug_id": "karaf_4eed514",
        "commit": "https://github.com/apache/karaf/commit/4eed5140dd6af7f4ab857a8aa54339e9621a4d9f",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/karaf/blob/4eed5140dd6af7f4ab857a8aa54339e9621a4d9f/features/core/src/main/java/org/apache/karaf/features/internal/service/Deployer.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/src/main/java/org/apache/karaf/features/internal/service/Deployer.java?ref=4eed5140dd6af7f4ab857a8aa54339e9621a4d9f",
                "deletions": 1,
                "filename": "features/core/src/main/java/org/apache/karaf/features/internal/service/Deployer.java",
                "patch": "@@ -961,7 +961,7 @@ private void computeBundlesToRefresh(Map<Bundle, String> toRefresh, Collection<B\n                     continue;\n                 }\n                 // Ignore bundles that won't be wired\n-                List<Wire> newWires = resolution.get(resource);\n+                List<Wire> newWires = resolution != null ? resolution.get(resource) : null;\n                 if (newWires == null) {\n                     continue;\n                 }",
                "raw_url": "https://github.com/apache/karaf/raw/4eed5140dd6af7f4ab857a8aa54339e9621a4d9f/features/core/src/main/java/org/apache/karaf/features/internal/service/Deployer.java",
                "sha": "b7b7af6b27b8b819e63e99a3b8c6caaef7eedf3e",
                "status": "modified"
            }
        ],
        "message": "Fix possible NPE",
        "parent": "https://github.com/apache/karaf/commit/01ffa23d4ea446e5985bb4287eb87af3785146ef",
        "patched_files": [
            "Deployer.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "DeployerTest.java"
        ]
    },
    "karaf_58f6fb7": {
        "bug_id": "karaf_58f6fb7",
        "commit": "https://github.com/apache/karaf/commit/58f6fb73dd261e2fe1e4880ceb7fd571673ac1fb",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/karaf/blob/58f6fb73dd261e2fe1e4880ceb7fd571673ac1fb/tooling/karaf-maven-plugin/src/main/java/org/apache/karaf/tooling/features/GenerateDescriptorMojo.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/tooling/karaf-maven-plugin/src/main/java/org/apache/karaf/tooling/features/GenerateDescriptorMojo.java?ref=58f6fb73dd261e2fe1e4880ceb7fd571673ac1fb",
                "deletions": 0,
                "filename": "tooling/karaf-maven-plugin/src/main/java/org/apache/karaf/tooling/features/GenerateDescriptorMojo.java",
                "patch": "@@ -386,6 +386,7 @@ private Manifest getManifest(File file) throws IOException {\n             is = new BufferedInputStream(new FileInputStream(file));\n         } catch (Exception e) {\n             getLogger().warn(\"Error while opening artifact\", e);\n+            return null;\n         }\n \n         try {",
                "raw_url": "https://github.com/apache/karaf/raw/58f6fb73dd261e2fe1e4880ceb7fd571673ac1fb/tooling/karaf-maven-plugin/src/main/java/org/apache/karaf/tooling/features/GenerateDescriptorMojo.java",
                "sha": "2aa483bf0bf0bd02d373b592088a88cd6a04efcb",
                "status": "modified"
            }
        ],
        "message": "Fixing NPE in build as is may have been null below\n\ngit-svn-id: https://svn.apache.org/repos/asf/karaf/trunk@1341020 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/karaf/commit/74b9fddfbbf7bc17240ace93c902089dd3885428",
        "patched_files": [
            "GenerateDescriptorMojo.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "GenerateDescriptorMojoTest.java"
        ]
    },
    "karaf_59a8a8b": {
        "bug_id": "karaf_59a8a8b",
        "commit": "https://github.com/apache/karaf/commit/59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a",
        "file": [
            {
                "additions": 178,
                "blob_url": "https://github.com/apache/karaf/blob/59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/BundleSelector.java",
                "changes": 178,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/BundleSelector.java?ref=59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a",
                "deletions": 0,
                "filename": "shell/osgi/src/main/java/org/apache/karaf/shell/osgi/BundleSelector.java",
                "patch": "@@ -0,0 +1,178 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.karaf.shell.osgi;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import org.apache.felix.service.command.CommandSession;\n+import org.osgi.framework.Bundle;\n+import org.osgi.framework.BundleContext;\n+import org.osgi.framework.Constants;\n+\n+public class BundleSelector {\n+\n+    private final CommandSession session;\n+    private final BundleContext bundleContext;\n+    \n+    public BundleSelector(BundleContext bundleContext, CommandSession session) {\n+        this.bundleContext = bundleContext;\n+        this.session = session;\n+    }\n+    \n+    public List<Bundle> selectBundles(List<String> ids, boolean force) throws Exception {\n+        List<Bundle> bundles = new ArrayList<Bundle>();\n+        if (ids != null && !ids.isEmpty()) {\n+            for (String id : ids) {\n+\n+                // id is a number\n+                Pattern pattern = Pattern.compile(\"^\\\\d+$\");\n+                Matcher matcher = pattern.matcher(id);\n+                if (matcher.find()) {\n+                    Bundle bundle = this.getBundleById(id);\n+                    addBundle(bundle, id, force, bundles);\n+                    continue;\n+                }\n+\n+                // id as a number range\n+                pattern = Pattern.compile(\"^(\\\\d+)-(\\\\d+)$\");\n+                matcher = pattern.matcher(id);\n+                if (matcher.find()) {\n+                    int index = id.indexOf('-');\n+                    long startId = Long.parseLong(id.substring(0, index));\n+                    long endId = Long.parseLong(id.substring(index + 1));\n+                    if (startId < endId) {\n+                        for (long i = startId; i <= endId; i++) {\n+                            Bundle bundle = bundleContext.getBundle(i);\n+                            addBundle(bundle, String.valueOf(i), force, bundles);\n+                        }\n+                    }\n+                    continue;\n+                }\n+\n+                int index = id.indexOf('/');\n+                List<Bundle> bundlesByName = null;\n+                if (index != -1) {\n+                    // user has provided name and version\n+                    bundlesByName = getBundleByNameAndVersion(id.substring(0, index), id.substring(index + 1));\n+                } else {\n+                    // user has provided only the name\n+                    bundlesByName = getBundleByName(id);\n+                }\n+                for (Bundle bundleByName : bundlesByName) {\n+                    addBundle(bundleByName, id, force, bundles);\n+                }\n+            }\n+\n+        }\n+\n+        return bundles;\n+    }\n+\n+    private void addBundle(Bundle bundle, String id, boolean force, List<Bundle> bundles) throws Exception {\n+        if (bundle == null) {\n+            // if the bundle is null here, it's because we didn't find it\n+            System.err.println(\"Bundle \" + id + \" is invalid\");\n+        } else {\n+            if (force || !Util.isASystemBundle(bundleContext, bundle) || Util.accessToSystemBundleIsAllowed(bundle.getBundleId(), session)) {\n+                bundles.add(bundle);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Get a bundle identified by an id number.\n+     *\n+     * @param id the id number.\n+     * @return the bundle or null if not found.\n+     */\n+    private Bundle getBundleById(String id) {\n+        Bundle bundle = null;\n+        try {\n+            long idNumber = Long.parseLong(id);\n+            bundle = bundleContext.getBundle(idNumber);\n+        } catch (NumberFormatException nfe) {\n+            // ignore\n+        }\n+        return bundle;\n+    }\n+\n+    /**\n+     * Get a bundles list with the name or symbolic name matching the pattern.\n+     *\n+     * @param name the bundle name or symbolic name pattern to match.\n+     * @return the bundles list.\n+     */\n+    private List<Bundle> getBundleByName(String name) {\n+        return getBundleByNameAndVersion(name, null);\n+    }\n+\n+    /**\n+     * Get a bundles list with the name or symbolic name matching the name pattern and version matching the version pattern.\n+     *\n+     * @param name    the bundle name or symbolic name regex to match.\n+     * @param version the bundle version regex to match.\n+     * @return the bundles list.\n+     */\n+    private List<Bundle> getBundleByNameAndVersion(String name, String version) {\n+        Bundle[] bundles = bundleContext.getBundles();\n+\n+        ArrayList<Bundle> result = new ArrayList<Bundle>();\n+\n+        Pattern namePattern = Pattern.compile(name);\n+\n+        for (int i = 0; i < bundles.length; i++) {\n+\n+            String bundleSymbolicName = bundles[i].getSymbolicName();\n+            // skip bundles without Bundle-SymbolicName header\n+            if (bundleSymbolicName == null) {\n+                continue;\n+            }\n+            \n+            Matcher symbolicNameMatcher = namePattern.matcher(bundleSymbolicName);\n+            \n+            Matcher nameMatcher = null;\n+            String bundleName = (String) bundles[i].getHeaders().get(Constants.BUNDLE_NAME);\n+            if (bundleName != null) {\n+                nameMatcher = namePattern.matcher(bundleName);\n+            }\n+\n+            if (version != null) {\n+                String bundleVersion = (String) bundles[i].getHeaders().get(Constants.BUNDLE_VERSION);\n+                if (bundleVersion != null) {\n+                    boolean nameMatch = (nameMatcher != null && nameMatcher.find()) || symbolicNameMatcher.find();\n+                    if (nameMatch) {\n+                        Pattern versionPattern = Pattern.compile(version);\n+                        Matcher versionMatcher = versionPattern.matcher(bundleVersion);                    \n+                        if (versionMatcher.find()) {\n+                            result.add(bundles[i]);\n+                        }\n+                    }\n+                }\n+            } else {\n+                boolean nameMatch = (nameMatcher != null && nameMatcher.find()) || symbolicNameMatcher.find();\n+                if (nameMatch) {\n+                    result.add(bundles[i]);\n+                }\n+            }\n+        }\n+        return result;\n+    }\n+\n+}",
                "raw_url": "https://github.com/apache/karaf/raw/59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/BundleSelector.java",
                "sha": "afb04e08d6829e0b6fee9bf0f90d206d895b8bf7",
                "status": "added"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/karaf/blob/59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/BundlesCommand.java",
                "changes": 136,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/BundlesCommand.java?ref=59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a",
                "deletions": 132,
                "filename": "shell/osgi/src/main/java/org/apache/karaf/shell/osgi/BundlesCommand.java",
                "patch": "@@ -16,17 +16,12 @@\n  */\n package org.apache.karaf.shell.osgi;\n \n-import java.util.ArrayList;\n import java.util.List;\n-import java.util.regex.Matcher;\n-import java.util.regex.Pattern;\n \n-import org.apache.karaf.shell.console.OsgiCommandSupport;\n import org.apache.felix.gogo.commands.Argument;\n import org.apache.felix.gogo.commands.Option;\n+import org.apache.karaf.shell.console.OsgiCommandSupport;\n import org.osgi.framework.Bundle;\n-import org.osgi.framework.BundleContext;\n-import org.osgi.framework.Constants;\n \n public abstract class BundlesCommand extends OsgiCommandSupport {\n \n@@ -37,134 +32,11 @@\n     boolean force;\n \n     protected Object doExecute() throws Exception {\n-        List<Bundle> bundles = new ArrayList<Bundle>();\n-        if (ids != null && !ids.isEmpty()) {\n-            for (String id : ids) {\n-\n-                // id is a number\n-                Pattern pattern = Pattern.compile(\"^\\\\d+$\");\n-                Matcher matcher = pattern.matcher(id);\n-                if (matcher.find()) {\n-                    Bundle bundle = this.getBundleById(id);\n-                    this.addBundle(bundle, id, force, bundles);\n-                    continue;\n-                }\n-\n-                // id as a number range\n-                pattern = Pattern.compile(\"^(\\\\d+)-(\\\\d+)$\");\n-                matcher = pattern.matcher(id);\n-                if (matcher.find()) {\n-                    int index = id.indexOf('-');\n-                    Long startId = Long.valueOf(id.substring(0, index));\n-                    Long endId = Long.valueOf(id.substring(index + 1));\n-                    if (startId < endId) {\n-                        for (long i = startId; i <= endId; i++) {\n-                            Bundle bundle = getBundleContext().getBundle(i);\n-                            this.addBundle(bundle, id, force, bundles);\n-                        }\n-                    }\n-                    continue;\n-                }\n-\n-                Bundle bundle = null;\n-                int index = id.indexOf('/');\n-                List<Bundle> bundlesByName = null;\n-                if (index != -1) {\n-                    // user has provided name and version\n-                    bundlesByName = this.getBundleByNameAndVersion(id.substring(0, index), id.substring(index + 1));\n-                } else {\n-                    // user has provided only the name\n-                    bundlesByName = this.getBundleByName(id);\n-                }\n-                for (Bundle bundleByName : bundlesByName) {\n-                    this.addBundle(bundleByName, id, force, bundles);\n-                }\n-            }\n-\n-        }\n+        BundleSelector selector = new BundleSelector(getBundleContext(), session);      \n+        List<Bundle> bundles = selector.selectBundles(ids, force);\n         doExecute(bundles);\n         return null;\n     }\n-\n-    private void addBundle(Bundle bundle, String id, boolean force, List bundles) throws Exception {\n-        if (bundle == null) {\n-            // if the bundle is null here, it's because we didn't find it\n-            System.err.println(\"Bundle \" + id + \" is invalid\");\n-        } else {\n-            if (force || !Util.isASystemBundle(getBundleContext(), bundle) || Util.accessToSystemBundleIsAllowed(bundle.getBundleId(), session)) {\n-                bundles.add(bundle);\n-            }\n-        }\n-    }\n-\n-    /**\n-     * Get a bundle identified by an id number.\n-     *\n-     * @param id the id number.\n-     * @return the bundle or null if not found.\n-     */\n-    private Bundle getBundleById(String id) {\n-        Bundle bundle = null;\n-        try {\n-            long idNumber = Long.valueOf(id);\n-            bundle = getBundleContext().getBundle(idNumber);\n-        } catch (NumberFormatException nfe) {\n-            // ignore\n-        }\n-        return bundle;\n-    }\n-\n-    /**\n-     * Get a bundles list with the name or symbolic name matching the pattern.\n-     *\n-     * @param name the bundle name or symbolic name pattern to match.\n-     * @return the bundles list.\n-     */\n-    private List<Bundle> getBundleByName(String name) {\n-        return this.getBundleByNameAndVersion(name, null);\n-    }\n-\n-    /**\n-     * Get a bundles list with the name or symbolic name matching the name pattern and version matching the version pattern.\n-     *\n-     * @param name    the bundle name or symbolic name regex to match.\n-     * @param version the bundle version regex to match.\n-     * @return the bundles list.\n-     */\n-    private List<Bundle> getBundleByNameAndVersion(String name, String version) {\n-        Bundle[] bundles = getBundleContext().getBundles();\n-\n-        ArrayList<Bundle> result = new ArrayList<Bundle>();\n-\n-        Pattern namePattern = Pattern.compile(name);\n-\n-        for (int i = 0; i < bundles.length; i++) {\n-\n-            String bundleName = (String) bundles[i].getHeaders().get(Constants.BUNDLE_NAME);\n-            String bundleSymbolicName = bundles[i].getSymbolicName();\n-\n-            Matcher nameMatcher = namePattern.matcher(bundleName);\n-            Matcher symbolicNameMatcher = namePattern.matcher(bundleSymbolicName);\n-\n-            if (version != null) {\n-\n-                Pattern versionPattern = Pattern.compile(version);\n-\n-                String bundleVersion = (String) bundles[i].getHeaders().get(Constants.BUNDLE_VERSION);\n-                Matcher versionMatcher = versionPattern.matcher(bundleVersion);\n-\n-                if ((nameMatcher.find() || symbolicNameMatcher.find()) && versionMatcher.find()) {\n-                    result.add(bundles[i]);\n-                }\n-\n-            } else {\n-                if (nameMatcher.find() || symbolicNameMatcher.find()) {\n-                    result.add(bundles[i]);\n-                }\n-            }\n-        }\n-        return result;\n-    }\n-\n+      \n     protected abstract void doExecute(List<Bundle> bundles) throws Exception;\n }",
                "raw_url": "https://github.com/apache/karaf/raw/59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/BundlesCommand.java",
                "sha": "a08048b25e78acada4ff93520fdd8ed1a70718f5",
                "status": "modified"
            },
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/karaf/blob/59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/BundlesCommandOptional.java",
                "changes": 26,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/BundlesCommandOptional.java?ref=59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a",
                "deletions": 15,
                "filename": "shell/osgi/src/main/java/org/apache/karaf/shell/osgi/BundlesCommandOptional.java",
                "patch": "@@ -16,7 +16,6 @@\n  */\n package org.apache.karaf.shell.osgi;\n \n-import java.util.ArrayList;\n import java.util.List;\n \n import org.apache.felix.gogo.commands.Argument;\n@@ -25,30 +24,27 @@\n import org.osgi.framework.Bundle;\n \n public abstract class BundlesCommandOptional extends OsgiCommandSupport {\n-\n-    @Argument(index = 0, name = \"ids\", description = \"The list of bundle IDs separated by whitespaces\", required = false, multiValued = true)\n-    List<Long> ids;\n+    \n+    @Argument(index = 0, name = \"ids\", description = \"The list of bundle (identified by IDs or name or name/version) separated by whitespaces\", required = false, multiValued = true)\n+    List<String> ids;\n \n     @Option(name = \"--force\", aliases = {}, description = \"Forces the command to execute\", required = false, multiValued = false)\n     boolean force;\n \n     protected Object doExecute() throws Exception {\n-        List<Bundle> bundles = new ArrayList<Bundle>();\n+        List<Bundle> bundles = null;\n         if (ids != null && !ids.isEmpty()) {\n-            for (long id : ids) {\n-                Bundle bundle = getBundleContext().getBundle(id);\n-                if (bundle == null) {\n-                    System.err.println(\"Bundle ID\" + id + \" is invalid\");\n-                } else {\n-                    if (force || !Util.isASystemBundle(getBundleContext(), bundle) || Util.accessToSystemBundleIsAllowed(bundle.getBundleId(), session)) {\n-                        bundles.add(bundle);\n-                    }\n-                }\n-            }\n+            BundleSelector selector = new BundleSelector(getBundleContext(), session);      \n+            bundles = selector.selectBundles(ids, force);\n         }\n         doExecute(bundles);\n         return null;\n     }\n \n+    /**\n+     * \n+     * @param bundles null if no bundle ids or names were specified.\n+     * @throws Exception\n+     */\n     protected abstract void doExecute(List<Bundle> bundles) throws Exception;\n }",
                "raw_url": "https://github.com/apache/karaf/raw/59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/BundlesCommandOptional.java",
                "sha": "85ba12e4d7a6f3a33edf4463ec896cb9f919f823",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/karaf/blob/59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/Headers.java",
                "changes": 32,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/Headers.java?ref=59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a",
                "deletions": 22,
                "filename": "shell/osgi/src/main/java/org/apache/karaf/shell/osgi/Headers.java",
                "patch": "@@ -26,23 +26,21 @@\n import java.util.Map;\n \n import jline.Terminal;\n-import org.apache.felix.gogo.commands.Argument;\n import org.apache.felix.gogo.commands.Command;\n import org.apache.felix.gogo.commands.Option;\n import org.apache.felix.utils.manifest.Attribute;\n import org.apache.felix.utils.manifest.Clause;\n import org.apache.felix.utils.manifest.Directive;\n import org.apache.felix.utils.manifest.Parser;\n import org.apache.felix.utils.version.VersionRange;\n-import org.apache.karaf.shell.console.OsgiCommandSupport;\n import org.fusesource.jansi.Ansi;\n import org.osgi.framework.Bundle;\n import org.osgi.framework.ServiceReference;\n import org.osgi.service.packageadmin.ExportedPackage;\n import org.osgi.service.packageadmin.PackageAdmin;\n \n @Command(scope = \"osgi\", name = \"headers\", description = \"Displays OSGi headers of a given bundle.\")\n-public class Headers extends OsgiCommandSupport {\n+public class Headers extends BundlesCommandOptional {\n \n     protected final static String BUNDLE_PREFIX = \"Bundle-\";\n     protected final static String PACKAGE_SUFFFIX = \"-Package\";\n@@ -56,44 +54,34 @@\n     @Option(name = \"--indent\", description = \"Indentation method\")\n     int indent = -1;\n \n-    @Argument(index = 0, name = \"ids\", description = \"A list of bundle IDs separated by whitespaces\", required = false, multiValued = true)\n-    List<Long> ids;\n-\n-    protected Object doExecute() throws Exception {\n+    protected void doExecute(List<Bundle> bundles) throws Exception {\n         // Get package admin service.\n         ref = getBundleContext().getServiceReference(PackageAdmin.class.getName());\n         if (ref == null) {\n             System.out.println(\"PackageAdmin service is unavailable.\");\n-            return null;\n+            return;\n         }\n \n         try {\n             admin = (PackageAdmin) getBundleContext().getService(ref);\n             if (admin == null) {\n                 System.out.println(\"PackageAdmin service is unavailable.\");\n-                return null;\n+                return;\n             }\n \n-            if (ids != null && !ids.isEmpty()) {\n-                for (long id : ids) {\n-                    Bundle bundle = getBundleContext().getBundle(id);\n-                    if (bundle != null) {\n-                        printHeaders(bundle);\n-                    } else {\n-                        System.err.println(\"Bundle ID \" + id + \" is invalid.\");\n-                    }\n+            if (bundles == null) {\n+                Bundle[] allBundles = getBundleContext().getBundles();\n+                for (int i = 0; i < allBundles.length; i++) {\n+                    printHeaders(allBundles[i]);\n                 }\n             } else {\n-                Bundle[] bundles = getBundleContext().getBundles();\n-                for (int i = 0; i < bundles.length; i++) {\n-                    printHeaders(bundles[i]);\n+                for (Bundle bundle : bundles) {\n+                    printHeaders(bundle);\n                 }\n             }\n         } finally {\n             getBundleContext().ungetService(ref);\n         }\n-\n-        return null;\n     }\n \n     protected void printHeaders(Bundle bundle) throws Exception {",
                "raw_url": "https://github.com/apache/karaf/raw/59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/Headers.java",
                "sha": "c3ccd5a5ec20899d043a339b091a76df4592eca6",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/karaf/blob/59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/Info.java",
                "changes": 31,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/Info.java?ref=59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a",
                "deletions": 21,
                "filename": "shell/osgi/src/main/java/org/apache/karaf/shell/osgi/Info.java",
                "patch": "@@ -16,40 +16,29 @@\n  */\n package org.apache.karaf.shell.osgi;\n \n-import org.apache.felix.gogo.commands.Argument;\n-import org.apache.felix.gogo.commands.Command;\n-import org.apache.karaf.shell.console.OsgiCommandSupport;\n-import org.apache.karaf.util.StringEscapeUtils;\n-import org.osgi.framework.Bundle;\n-\n import java.io.BufferedReader;\n import java.io.InputStreamReader;\n import java.net.URL;\n import java.util.List;\n \n-@Command(scope = \"osgi\", name = \"info\", description = \"Displays detailed information of a given bundle.\")\n-public class Info extends OsgiCommandSupport {\n+import org.apache.felix.gogo.commands.Command;\n+import org.apache.karaf.util.StringEscapeUtils;\n+import org.osgi.framework.Bundle;\n \n-    @Argument(index = 0, name = \"ids\", description = \"A list of bundle IDs separated by whitespaces\", required = false, multiValued = true)\n-    List<Long> ids;\n+@Command(scope = \"osgi\", name = \"info\", description = \"Displays detailed information of a given bundle.\")\n+public class Info extends BundlesCommandOptional {\n \n-    protected Object doExecute() throws Exception {\n-        if (ids != null && !ids.isEmpty()) {\n-            for (long id : ids) {\n-                Bundle bundle = getBundleContext().getBundle(id);\n-                if (bundle != null) {\n-                    printInfo(bundle);\n-                } else {\n-                    System.err.println(\"Bundle ID \" + id + \" is invalid.\");\n-                }\n+    protected void doExecute(List<Bundle> bundles) throws Exception {\n+        if (bundles == null) {\n+            Bundle[] allBundles = getBundleContext().getBundles();\n+            for (int i = 0; i < allBundles.length; i++) {\n+                printInfo(allBundles[i]);\n             }\n         } else {\n-            Bundle[] bundles = getBundleContext().getBundles();\n             for (Bundle bundle : bundles) {\n                 printInfo(bundle);\n             }\n         }\n-        return null;\n     }\n \n     /**",
                "raw_url": "https://github.com/apache/karaf/raw/59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/Info.java",
                "sha": "d101c2d1279466bed7f6c9150bc8b1c529a5a14b",
                "status": "modified"
            },
            {
                "additions": 98,
                "blob_url": "https://github.com/apache/karaf/blob/59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/ListServices.java",
                "changes": 232,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/ListServices.java?ref=59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a",
                "deletions": 134,
                "filename": "shell/osgi/src/main/java/org/apache/karaf/shell/osgi/ListServices.java",
                "patch": "@@ -18,159 +18,123 @@\n \n import java.util.List;\n \n-import org.apache.felix.service.command.Function;\n-import org.apache.karaf.shell.console.OsgiCommandSupport;\n-import org.apache.felix.gogo.commands.Argument;\n-import org.apache.felix.gogo.commands.Option;\n import org.apache.felix.gogo.commands.Command;\n+import org.apache.felix.gogo.commands.Option;\n+import org.apache.felix.service.command.Function;\n import org.osgi.framework.Bundle;\n import org.osgi.framework.ServiceReference;\n \n @Command(scope = \"osgi\", name = \"ls\", description = \"Lists OSGi services.\")\n-public class ListServices extends OsgiCommandSupport {\n+public class ListServices extends BundlesCommandOptional {\n \n     @Option(name = \"-a\", aliases = {}, description = \"Shows all services\", required = false, multiValued = false)\n     boolean showAll;\n \n     @Option(name = \"-u\", aliases = {}, description = \"Shows services which are in use\", required = false, multiValued = false)\n     boolean inUse;\n \n-    @Argument(index = 0, name = \"ids\", description = \"Show only services for the given bundle ids\", required = false, multiValued = true)\n-    List<Long> ids;\n-\n-    protected Object doExecute() throws Exception {\n-        if (ids != null && !ids.isEmpty()) {\n-            for (long id : ids) {\n-                Bundle bundle = getBundleContext().getBundle(id);\n-                if (bundle != null) {\n-                    boolean headerPrinted = false;\n-                    boolean needSeparator = false;\n-                    ServiceReference[] refs = null;\n-\n-                    // Get registered or in-use services.\n-                    if (inUse) {\n-                        refs = bundle.getServicesInUse();\n-                    } else {\n-                        refs = bundle.getRegisteredServices();\n-                    }\n-\n-                    // Print properties for each service.\n-                    for (int refIdx = 0;\n-                         (refs != null) && (refIdx < refs.length);\n-                         refIdx++) {\n-                        String[] objectClass = (String[])\n-                                refs[refIdx].getProperty(\"objectClass\");\n-\n-                        // Determine if we need to print the service, depending\n-                        // on whether it is a command service or not.\n-                        boolean print = true;\n-                        for (int ocIdx = 0;\n-                             !showAll && (ocIdx < objectClass.length);\n-                             ocIdx++) {\n-                            if (objectClass[ocIdx].equals(Function.class.getName())) {\n-                                print = false;\n-                            }\n-                        }\n-\n-                        // Print header if we have not already done so.\n-                        if (!headerPrinted) {\n-                            headerPrinted = true;\n-                            String title = Util.getBundleName(bundle);\n-                            title = (inUse)\n-                                    ? title + \" uses:\"\n-                                    : title + \" provides:\";\n-                            System.out.println(\"\");\n-                            System.out.println(title);\n-                            System.out.println(Util.getUnderlineString(title));\n-                        }\n-\n-                        if (showAll || print) {\n-                            // Print service separator if necessary.\n-                            if (needSeparator) {\n-                                System.out.println(\"----\");\n-                            }\n-\n-                            // Print service properties.\n-                            String[] keys = refs[refIdx].getPropertyKeys();\n-                            for (int keyIdx = 0;\n-                                 (keys != null) && (keyIdx < keys.length);\n-                                 keyIdx++) {\n-                                Object v = refs[refIdx].getProperty(keys[keyIdx]);\n-                                System.out.println(\n-                                        keys[keyIdx] + \" = \" + Util.getValueString(v));\n-                            }\n-\n-                            needSeparator = true;\n-                        }\n-                    }\n-                } else {\n-                    System.err.println(\"Bundle ID \" + id + \" is invalid.\");\n+    protected void doExecute(List<Bundle> bundles) throws Exception {\n+        if (bundles == null) {\n+            Bundle[] allBundles = getBundleContext().getBundles();\n+            for (int i = 0; i < allBundles.length; i++) {\n+                printServicesShort(allBundles[i]);\n+            }\n+        } else {\n+            for (Bundle bundle : bundles) {\n+                printServices(bundle);\n+            }\n+        }\n+    }\n+\n+    private void printServices(Bundle bundle) {\n+        boolean headerPrinted = false;\n+        boolean needSeparator = false;\n+        ServiceReference[] refs = null;\n+\n+        // Get registered or in-use services.\n+        if (inUse) {\n+            refs = bundle.getServicesInUse();\n+        } else {\n+            refs = bundle.getRegisteredServices();\n+        }\n+\n+        // Print properties for each service.\n+        for (int refIdx = 0; (refs != null) && (refIdx < refs.length); refIdx++) {\n+            String[] objectClass = (String[]) refs[refIdx].getProperty(\"objectClass\");\n+\n+            // Determine if we need to print the service, depending\n+            // on whether it is a command service or not.\n+            boolean print = true;\n+            for (int ocIdx = 0; !showAll && (ocIdx < objectClass.length); ocIdx++) {\n+                if (objectClass[ocIdx].equals(Function.class.getName())) {\n+                    print = false;\n+                }\n+            }\n+\n+            // Print header if we have not already done so.\n+            if (!headerPrinted) {\n+                headerPrinted = true;\n+                String title = Util.getBundleName(bundle);\n+                title = (inUse) ? title + \" uses:\" : title + \" provides:\";\n+                System.out.println(\"\");\n+                System.out.println(title);\n+                System.out.println(Util.getUnderlineString(title));\n+            }\n+\n+            if (showAll || print) {\n+                // Print service separator if necessary.\n+                if (needSeparator) {\n+                    System.out.println(\"----\");\n+                }\n+\n+                // Print service properties.\n+                String[] keys = refs[refIdx].getPropertyKeys();\n+                for (int keyIdx = 0; (keys != null) && (keyIdx < keys.length); keyIdx++) {\n+                    Object v = refs[refIdx].getProperty(keys[keyIdx]);\n+                    System.out.println(keys[keyIdx] + \" = \" + Util.getValueString(v));\n                 }\n+\n+                needSeparator = true;\n             }\n         }\n-        else\n-        {\n-            Bundle[] bundles = getBundleContext().getBundles();\n-            if (bundles != null)\n-            {\n-                // TODO: Sort list.\n-                for (int bundleIdx = 0; bundleIdx < bundles.length; bundleIdx++)\n-                {\n-                    boolean headerPrinted = false;\n-                    ServiceReference[] refs = null;\n-\n-                    // Get registered or in-use services.\n-                    if (inUse)\n-                    {\n-                        refs = bundles[bundleIdx].getServicesInUse();\n-                    }\n-                    else\n-                    {\n-                        refs = bundles[bundleIdx].getRegisteredServices();\n-                    }\n-\n-                    for (int refIdx = 0; (refs != null) && (refIdx < refs.length); refIdx++)\n-                    {\n-                        String[] objectClass = (String[])\n-                            refs[refIdx].getProperty(\"objectClass\");\n-\n-                        // Determine if we need to print the service, depending\n-                        // on whether it is a command service or not.\n-                        boolean print = true;\n-                        for (int ocIdx = 0;\n-                            !showAll && (ocIdx < objectClass.length);\n-                            ocIdx++)\n-                        {\n-                            if (objectClass[ocIdx].equals(Function.class.getName()))\n-                            {\n-                                print = false;\n-                            }\n-                        }\n-\n-                        // Print the service if necessary.\n-                        if (showAll || print)\n-                        {\n-                            if (!headerPrinted)\n-                            {\n-                                headerPrinted = true;\n-                                String title = Util.getBundleName(bundles[bundleIdx]);\n-                                title = (inUse)\n-                                    ? title + \" uses:\"\n-                                    : title + \" provides:\";\n-                                System.out.println(\"\\n\" + title);\n-                                System.out.println(Util.getUnderlineString(title));\n-                            }\n-                            System.out.println(Util.getValueString(objectClass));\n-                        }\n-                    }\n+    }\n+\n+    private void printServicesShort(Bundle bundle) {\n+        boolean headerPrinted = false;\n+        ServiceReference[] refs = null;\n+\n+        // Get registered or in-use services.\n+        if (inUse) {\n+            refs = bundle.getServicesInUse();\n+        } else {\n+            refs = bundle.getRegisteredServices();\n+        }\n+\n+        for (int refIdx = 0; (refs != null) && (refIdx < refs.length); refIdx++) {\n+            String[] objectClass = (String[]) refs[refIdx].getProperty(\"objectClass\");\n+\n+            // Determine if we need to print the service, depending\n+            // on whether it is a command service or not.\n+            boolean print = true;\n+            for (int ocIdx = 0; !showAll && (ocIdx < objectClass.length); ocIdx++) {\n+                if (objectClass[ocIdx].equals(Function.class.getName())) {\n+                    print = false;\n                 }\n             }\n-            else\n-            {\n-                System.out.println(\"There are no registered services.\");\n+\n+            // Print the service if necessary.\n+            if (showAll || print) {\n+                if (!headerPrinted) {\n+                    headerPrinted = true;\n+                    String title = Util.getBundleName(bundle);\n+                    title = (inUse) ? title + \" uses:\" : title + \" provides:\";\n+                    System.out.println(\"\\n\" + title);\n+                    System.out.println(Util.getUnderlineString(title));\n+                }\n+                System.out.println(Util.getValueString(objectClass));\n             }\n         }\n-        return null;\n+\n     }\n \n }",
                "raw_url": "https://github.com/apache/karaf/raw/59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/ListServices.java",
                "sha": "591ae9846770a49e1cda96959f1cb2d14c8009c4",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/karaf/blob/59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/RefreshBundle.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/RefreshBundle.java?ref=59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a",
                "deletions": 5,
                "filename": "shell/osgi/src/main/java/org/apache/karaf/shell/osgi/RefreshBundle.java",
                "patch": "@@ -18,8 +18,6 @@\n \n import java.util.List;\n \n-import org.apache.karaf.shell.console.OsgiCommandSupport;\n-import org.apache.felix.gogo.commands.Argument;\n import org.apache.felix.gogo.commands.Command;\n import org.osgi.framework.Bundle;\n import org.osgi.framework.ServiceReference;\n@@ -41,10 +39,9 @@ protected void doExecute(List<Bundle> bundles) throws Exception {\n                 System.out.println(\"PackageAdmin service is unavailable.\");\n                 return;\n             }\n-            if (bundles.isEmpty()) {\n+            if (bundles == null) {\n                 pa.refreshPackages(null);\n-            }\n-            else {\n+            } else {\n                 pa.refreshPackages(bundles.toArray(new Bundle[bundles.size()]));\n             }\n         }",
                "raw_url": "https://github.com/apache/karaf/raw/59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/RefreshBundle.java",
                "sha": "5c784e10a14cfa5ece055f7e74456fef90289477",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/karaf/blob/59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/ResolveBundle.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/ResolveBundle.java?ref=59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a",
                "deletions": 1,
                "filename": "shell/osgi/src/main/java/org/apache/karaf/shell/osgi/ResolveBundle.java",
                "patch": "@@ -39,7 +39,7 @@ protected void doExecute(List<Bundle> bundles) throws Exception {\n                 System.out.println(\"PackageAdmin service is unavailable.\");\n                 return;\n             }\n-            if (bundles.isEmpty()) {\n+            if (bundles == null) {\n                 pa.resolveBundles(null);\n             } else {\n                 pa.resolveBundles(bundles.toArray(new Bundle[bundles.size()]));",
                "raw_url": "https://github.com/apache/karaf/raw/59a8a8b1c1dd6ad53fd96644f4d020250e3cc48a/shell/osgi/src/main/java/org/apache/karaf/shell/osgi/ResolveBundle.java",
                "sha": "45853e3d488511c409c39bfff74821daa742f90f",
                "status": "modified"
            }
        ],
        "message": "KARAF-452: Add bundle range support to headers, ls, info, refresh, resolve commands. Also, fix some additional NPEs\n\ngit-svn-id: https://svn.apache.org/repos/asf/karaf/trunk@1091989 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/karaf/commit/9ff7825e3dde646a6f602b9fbc0d09bedcde112d",
        "patched_files": [
            "ListServices.java",
            "Info.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "ListServicesTest.java",
            "InfoTest.java"
        ]
    },
    "karaf_5ab0681": {
        "bug_id": "karaf_5ab0681",
        "commit": "https://github.com/apache/karaf/commit/5ab0681619c287688885ed7bb06ba78690cc981a",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/karaf/blob/5ab0681619c287688885ed7bb06ba78690cc981a/features/core/src/main/java/org/apache/karaf/features/internal/osgi/Activator.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/src/main/java/org/apache/karaf/features/internal/osgi/Activator.java?ref=5ab0681619c287688885ed7bb06ba78690cc981a",
                "deletions": 2,
                "filename": "features/core/src/main/java/org/apache/karaf/features/internal/osgi/Activator.java",
                "patch": "@@ -303,8 +303,12 @@ public void modifiedService(ServiceReference<FeaturesListener> reference, Featur\n     \n                     @Override\n                     public void removedService(ServiceReference<FeaturesListener> reference, FeaturesListener service) {\n-                        featuresService.unregisterListener(service);\n-                        bundleContext.ungetService(reference);\n+                        if (featuresService != null && service != null) {\n+                            featuresService.unregisterListener(service);\n+                        }\n+                        if (bundleContext != null && reference != null) {\n+                            bundleContext.ungetService(reference);\n+                        }\n                     }\n                 }\n         );",
                "raw_url": "https://github.com/apache/karaf/raw/5ab0681619c287688885ed7bb06ba78690cc981a/features/core/src/main/java/org/apache/karaf/features/internal/osgi/Activator.java",
                "sha": "28226e6d359257472af188d24f562a4408c58c67",
                "status": "modified"
            }
        ],
        "message": "Merge pull request #877 from jbonofre/KARAF-6329\n\n[KARAF-6329] Prevent NPE on shutdown in features service",
        "parent": "https://github.com/apache/karaf/commit/a0629fac921754e0254eee3305bd85a6fa7d2925",
        "patched_files": [
            "Activator.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "ActivatorTest.java"
        ]
    },
    "karaf_5dcbf17": {
        "bug_id": "karaf_5dcbf17",
        "commit": "https://github.com/apache/karaf/commit/5dcbf1779c7060cbd75b69289a79260fe09503eb",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/karaf/blob/5dcbf1779c7060cbd75b69289a79260fe09503eb/jaas/modules/src/main/java/org/apache/karaf/jaas/modules/syncope/SyncopeLoginModule.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/jaas/modules/src/main/java/org/apache/karaf/jaas/modules/syncope/SyncopeLoginModule.java?ref=5dcbf1779c7060cbd75b69289a79260fe09503eb",
                "deletions": 3,
                "filename": "jaas/modules/src/main/java/org/apache/karaf/jaas/modules/syncope/SyncopeLoginModule.java",
                "patch": "@@ -84,7 +84,9 @@ public boolean login() throws LoginException {\n         Credentials creds = new UsernamePasswordCredentials(user, password);\n         client.getCredentialsProvider().setCredentials(AuthScope.ANY, creds);\n         HttpGet get = new HttpGet(address + \"/users/self\");\n-        if (version.equals(\"2.x\") || version.equals(\"2\")) {\n+\n+        boolean version2 = version != null && (version.equals(\"2.x\") || version.equals(\"2\"));\n+        if (version2) {\n             get.setHeader(\"Content-Type\", \"application/json\");\n         } else {\n             get.setHeader(\"Content-Type\", \"application/xml\");\n@@ -102,7 +104,7 @@ public boolean login() throws LoginException {\n             principals.add(new UserPrincipal(user));\n             LOGGER.debug(\"Retrieving user {} roles\", user);\n             String responseSt = EntityUtils.toString(response.getEntity());\n-            if (version.equals(\"2.x\") || version.equals(\"2\")) {\n+            if (version2) {\n                 roles = extractingRolesSyncope2(responseSt);\n             } else {\n                 roles = extractingRolesSyncope1(responseSt);\n@@ -136,7 +138,7 @@ public boolean login() throws LoginException {\n                 response = response.substring(index + \"<memberships>\".length());\n                 index = response.indexOf(\"</memberships>\");\n                 response = response.substring(0, index);\n-    \n+\n                 // looking for the roleName elements\n                 index = response.indexOf(\"<roleName>\");\n                 while (index != -1) {",
                "raw_url": "https://github.com/apache/karaf/raw/5dcbf1779c7060cbd75b69289a79260fe09503eb/jaas/modules/src/main/java/org/apache/karaf/jaas/modules/syncope/SyncopeLoginModule.java",
                "sha": "0e4ae973333ee90acda938f5c6b33faf69fd1d28",
                "status": "modified"
            }
        ],
        "message": "Merge pull request #398 from coheigea/KARAF-5496\n\nKARAF-5496 - NPEs in SyncopeLoginModule if \"version\" is not specified",
        "parent": "https://github.com/apache/karaf/commit/a23ee51742dbefab22810d0803ffd1aeff2b8df8",
        "patched_files": [
            "SyncopeLoginModule.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "SyncopeLoginModuleTest.java"
        ]
    },
    "karaf_63bce35": {
        "bug_id": "karaf_63bce35",
        "commit": "https://github.com/apache/karaf/commit/63bce35cda6bf662e779db63fe8e418ee527a037",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/karaf/blob/63bce35cda6bf662e779db63fe8e418ee527a037/main/src/main/java/org/apache/karaf/main/Main.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/main/src/main/java/org/apache/karaf/main/Main.java?ref=63bce35cda6bf662e779db63fe8e418ee527a037",
                "deletions": 2,
                "filename": "main/src/main/java/org/apache/karaf/main/Main.java",
                "patch": "@@ -469,8 +469,10 @@ public static void main(String[] args) throws Exception {\n \t\t\ttry {\n \t\t\t\tmanager = main.launch();\n \t\t\t} catch (Throwable ex) {\n-\t\t\t\tmain.lifecycleManager.destroyKaraf();\n-\t\t\t\texitCode = -1;\n+                if (main.lifecycleManager != null) {\n+                    main.lifecycleManager.destroyKaraf();\n+                }\n+                exitCode = -1;\n \t\t\t\tSystem.err.println(\"Could not create framework: \" + ex);\n \t\t\t\tex.printStackTrace();\n \t\t\t}",
                "raw_url": "https://github.com/apache/karaf/raw/63bce35cda6bf662e779db63fe8e418ee527a037/main/src/main/java/org/apache/karaf/main/Main.java",
                "sha": "1f227adbfa50160e630c0a39b8ddfb5a53307ced",
                "status": "modified"
            }
        ],
        "message": "try to avoid an npe for early start failures\n\ngit-svn-id: https://svn.apache.org/repos/asf/karaf/trunk@1173914 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/karaf/commit/397a0c3557041da41af358d3a33c9e582d24ac44",
        "patched_files": [
            "Main.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "MainTest.java"
        ]
    },
    "karaf_735580d": {
        "bug_id": "karaf_735580d",
        "commit": "https://github.com/apache/karaf/commit/735580d25a83e350bd40de63f00d567c9b40a298",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/karaf/blob/735580d25a83e350bd40de63f00d567c9b40a298/features/core/src/main/java/org/apache/karaf/features/internal/FeaturesServiceImpl.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/src/main/java/org/apache/karaf/features/internal/FeaturesServiceImpl.java?ref=735580d25a83e350bd40de63f00d567c9b40a298",
                "deletions": 1,
                "filename": "features/core/src/main/java/org/apache/karaf/features/internal/FeaturesServiceImpl.java",
                "patch": "@@ -650,7 +650,12 @@ public void uninstallFeature(String name, String version) throws Exception {\n \n         //Also remove bundles installed as conditionals\n         for (Conditional conditional : feature.getConditional()) {\n-            bundles.addAll(installed.remove(conditional.asFeature(feature.getName(),feature.getVersion())));\n+            Feature conditionalFeature = conditional.asFeature(feature.getName(),feature.getVersion());\n+            if (installed.containsKey(conditionalFeature)) {\n+            \tbundles.addAll(installed.remove(conditionalFeature));\n+            } else {\n+            \tLOGGER.info(\"Conditional feature {}, hasn't been installed!\");\n+            }\n         }\n \n         for (Set<Long> b : installed.values()) {",
                "raw_url": "https://github.com/apache/karaf/raw/735580d25a83e350bd40de63f00d567c9b40a298/features/core/src/main/java/org/apache/karaf/features/internal/FeaturesServiceImpl.java",
                "sha": "1412e4b4c370fa9d3e54070b11fc0b6274b84103",
                "status": "modified"
            }
        ],
        "message": "test fixes: checked for NPE ... \n\ngit-svn-id: https://svn.apache.org/repos/asf/karaf/trunk@1496022 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/karaf/commit/595de92418350e3a2e6cc1e5ede8cb7c682c3759",
        "patched_files": [
            "FeaturesServiceImpl.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "FeaturesServiceImplTest.java"
        ]
    },
    "karaf_78ead5e": {
        "bug_id": "karaf_78ead5e",
        "commit": "https://github.com/apache/karaf/commit/78ead5e1c6cd57b41ee85096dbabedbcbe454bcc",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/karaf/blob/78ead5e1c6cd57b41ee85096dbabedbcbe454bcc/features/core/src/main/java/org/apache/karaf/features/internal/service/FeaturesServiceImpl.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/src/main/java/org/apache/karaf/features/internal/service/FeaturesServiceImpl.java?ref=78ead5e1c6cd57b41ee85096dbabedbcbe454bcc",
                "deletions": 1,
                "filename": "features/core/src/main/java/org/apache/karaf/features/internal/service/FeaturesServiceImpl.java",
                "patch": "@@ -423,7 +423,11 @@ public void removeRepository(URI uri, boolean uninstall) throws Exception {\n             for (String r : state.repositories) {\n                 if (!uri.toString().equals(r)) {\n                     Repository rep = repositories.getRepository(r);\n-                    repos.addAll(repositories.getRepositoryClosure(rep));\n+                    if (rep != null) {\n+                        repos.addAll(repositories.getRepositoryClosure(rep));\n+                    } else {\n+                        throw new IllegalArgumentException(\"Repository URI \" + uri + \" seems to have changed, can't remove repository\");\n+                    }\n                 }\n             }\n             for (Repository rep : repos) {",
                "raw_url": "https://github.com/apache/karaf/raw/78ead5e1c6cd57b41ee85096dbabedbcbe454bcc/features/core/src/main/java/org/apache/karaf/features/internal/service/FeaturesServiceImpl.java",
                "sha": "1924973d94379b4c2bccafd75ffad6bb94068af1",
                "status": "modified"
            }
        ],
        "message": "Merge pull request #845 from jbonofre/KARAF-6252\n\n[KARAF-6252] Avoid NullPointerException while removing a features repository with location changed locally",
        "parent": "https://github.com/apache/karaf/commit/3fca012f5eafe87792612d24380cef22a9760358",
        "patched_files": [
            "FeaturesServiceImpl.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "FeaturesServiceImplTest.java"
        ]
    },
    "karaf_7bba56d": {
        "bug_id": "karaf_7bba56d",
        "commit": "https://github.com/apache/karaf/commit/7bba56d4cccfefa5bf7bf760e97023b1e71ee692",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/karaf/blob/7bba56d4cccfefa5bf7bf760e97023b1e71ee692/client/src/main/java/org/apache/karaf/client/Main.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/client/src/main/java/org/apache/karaf/client/Main.java?ref=7bba56d4cccfefa5bf7bf760e97023b1e71ee692",
                "deletions": 1,
                "filename": "client/src/main/java/org/apache/karaf/client/Main.java",
                "patch": "@@ -80,7 +80,9 @@ public static void main(String[] args) throws Exception {\n             client.start();\n             ClientSession session = connectWithRetries(client, config);\n             Console console = System.console();\n-            console.printf(\"Logging in as %s\\n\", config.getUser());\n+            if (console != null) {\n+                console.printf(\"Logging in as %s\\n\", config.getUser());\n+            }\n             if (!session.authAgent(config.getUser()).await().isSuccess()) {\n                 AuthFuture authFuture;\n                 boolean useDefault = config.getPassword() != null;",
                "raw_url": "https://github.com/apache/karaf/raw/7bba56d4cccfefa5bf7bf760e97023b1e71ee692/client/src/main/java/org/apache/karaf/client/Main.java",
                "sha": "81e0cf1dd98d1287187acc3c56ca27615bb3b5d7",
                "status": "modified"
            }
        ],
        "message": "[KARAF-2663]client fails with NullPointerException",
        "parent": "https://github.com/apache/karaf/commit/2405a8eacc899f9a4d97ab8a0d45cc9d4ff0a205",
        "patched_files": [
            "Main.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "MainTest.java"
        ]
    },
    "karaf_8263abe": {
        "bug_id": "karaf_8263abe",
        "commit": "https://github.com/apache/karaf/commit/8263abe51985988e9eaf259500b936103048b857",
        "file": [
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/karaf/blob/8263abe51985988e9eaf259500b936103048b857/assembly/src/main/descriptors/unix-bin.xml",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/assembly/src/main/descriptors/unix-bin.xml?ref=8263abe51985988e9eaf259500b936103048b857",
                "deletions": 0,
                "filename": "assembly/src/main/descriptors/unix-bin.xml",
                "patch": "@@ -170,6 +170,15 @@\n                 <include>org.ops4j.pax.url:pax-url-wrap</include>\n             </includes>\n         </dependencySet>\n+       <dependencySet>\n+            <outputDirectory>/system</outputDirectory>\n+            <unpack>false</unpack>\n+            <useProjectArtifact>false</useProjectArtifact>\n+            <outputFileNameMapping>org/apache/felix/karaf/${artifact.artifactId}/${artifact.baseVersion}/${artifact.artifactId}-${artifact.baseVersion}${dashClassifier?}.${artifact.extension}</outputFileNameMapping>\n+            <includes>\n+                <include>org.apache.felix.karaf:org.apache.felix.karaf.commons</include>\n+            </includes>\n+        </dependencySet>\n         <dependencySet>\n             <outputDirectory>/system</outputDirectory>\n             <unpack>false</unpack>",
                "raw_url": "https://github.com/apache/karaf/raw/8263abe51985988e9eaf259500b936103048b857/assembly/src/main/descriptors/unix-bin.xml",
                "sha": "d148c4803ed48977ed06e9273ed84adacd51c664",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/karaf/blob/8263abe51985988e9eaf259500b936103048b857/assembly/src/main/descriptors/windows-bin.xml",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/assembly/src/main/descriptors/windows-bin.xml?ref=8263abe51985988e9eaf259500b936103048b857",
                "deletions": 0,
                "filename": "assembly/src/main/descriptors/windows-bin.xml",
                "patch": "@@ -162,6 +162,15 @@\n                 <include>org.ops4j.pax.url:pax-url-wrap</include>\n             </includes>\n         </dependencySet>\n+        <dependencySet>\n+            <outputDirectory>/system</outputDirectory>\n+            <unpack>false</unpack>\n+            <useProjectArtifact>false</useProjectArtifact>\n+            <outputFileNameMapping>org/apache/felix/karaf/${artifact.artifactId}/${artifact.baseVersion}/${artifact.artifactId}-${artifact.baseVersion}${dashClassifier?}.${artifact.extension}</outputFileNameMapping>\n+            <includes>\n+                <include>org.apache.felix.karaf:org.apache.felix.karaf.commons</include>\n+            </includes>\n+        </dependencySet>\n         <dependencySet>\n             <outputDirectory>/system</outputDirectory>\n             <unpack>false</unpack>",
                "raw_url": "https://github.com/apache/karaf/raw/8263abe51985988e9eaf259500b936103048b857/assembly/src/main/descriptors/windows-bin.xml",
                "sha": "995eed193ac1f1de3781a198b35d2e452e3cb2ed",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/karaf/blob/8263abe51985988e9eaf259500b936103048b857/assembly/src/main/filtered-resources/etc/startup.properties",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/assembly/src/main/filtered-resources/etc/startup.properties?ref=8263abe51985988e9eaf259500b936103048b857",
                "deletions": 0,
                "filename": "assembly/src/main/filtered-resources/etc/startup.properties",
                "patch": "@@ -36,6 +36,7 @@ org/apache/felix/org.apache.felix.fileinstall/${felix.fileinstall.version}/org.a\n #\n org/apache/aries/blueprint/org.apache.aries.blueprint/${aries.blueprint.version}/org.apache.aries.blueprint-${aries.blueprint.version}.jar=20\n \n+org/apache/felix/karaf/org.apache.felix.karaf.commons/${pom.version}/org.apache.felix.karaf.commons-${pom.version}.jar=30\n org/apache/felix/gogo/org.apache.felix.gogo.runtime/${felix.gogo.version}/org.apache.felix.gogo.runtime-${felix.gogo.version}.jar=30\n org/apache/felix/karaf/shell/org.apache.felix.karaf.shell.console/${pom.version}/org.apache.felix.karaf.shell.console-${pom.version}.jar=30\n org/apache/felix/karaf/deployer/org.apache.felix.karaf.deployer.spring/${pom.version}/org.apache.felix.karaf.deployer.spring-${pom.version}.jar=30",
                "raw_url": "https://github.com/apache/karaf/raw/8263abe51985988e9eaf259500b936103048b857/assembly/src/main/filtered-resources/etc/startup.properties",
                "sha": "63c3cd0ada9fbdd813a46ca3073eb7674d6f6c35",
                "status": "modified"
            },
            {
                "additions": 70,
                "blob_url": "https://github.com/apache/karaf/blob/8263abe51985988e9eaf259500b936103048b857/commons/pom.xml",
                "changes": 70,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/commons/pom.xml?ref=8263abe51985988e9eaf259500b936103048b857",
                "deletions": 0,
                "filename": "commons/pom.xml",
                "patch": "@@ -0,0 +1,70 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+  <!--\n+\n+      Licensed to the Apache Software Foundation (ASF) under one or more\n+      contributor license agreements.  See the NOTICE file distributed with\n+      this work for additional information regarding copyright ownership.\n+      The ASF licenses this file to You under the Apache License, Version 2.0\n+      (the \"License\"); you may not use this file except in compliance with\n+      the License.  You may obtain a copy of the License at\n+\n+         http://www.apache.org/licenses/LICENSE-2.0\n+\n+      Unless required by applicable law or agreed to in writing, software\n+      distributed under the License is distributed on an \"AS IS\" BASIS,\n+      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+      See the License for the specific language governing permissions and\n+      limitations under the License.\n+  -->\n+\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <parent>\n+    <artifactId>karaf</artifactId>\n+    <groupId>org.apache.felix.karaf</groupId>\n+    <version>1.5.0-SNAPSHOT</version>\n+  </parent>\n+\n+  <groupId>org.apache.felix.karaf</groupId>\n+  <artifactId>org.apache.felix.karaf.commons</artifactId>\n+  <version>1.5.0-SNAPSHOT</version>\n+  <packaging>bundle</packaging>\n+  <name>Apache Felix Karaf :: Commons</name>\n+\n+  <properties>\n+    <appendedResourcesDirectory>${basedir}/../etc/appended-resources</appendedResourcesDirectory>\n+  </properties>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>org.apache.felix</groupId>\n+      <artifactId>org.osgi.core</artifactId>\n+      <scope>provided</scope>\n+    </dependency>    \n+  </dependencies>\n+\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.apache.felix</groupId>\n+        <artifactId>maven-bundle-plugin</artifactId>\n+        <configuration>\n+          <instructions>\n+            <Bundle-SymbolicName>${pom.artifactId}</Bundle-SymbolicName>\n+            <Export-Package>${pom.artifactId}*;version=${project.version}</Export-Package>\n+            <Import-Package>\n+                !${pom.artifactId}*,\n+                *\n+            </Import-Package>\n+            <_versionpolicy>${bnd.version.policy}</_versionpolicy>\n+          </instructions>\n+        </configuration>\n+      </plugin>\n+    </plugins>\n+  </build>\n+\n+</project>\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/karaf/raw/8263abe51985988e9eaf259500b936103048b857/commons/pom.xml",
                "sha": "f491e69987d42efbf384deaf9c91e7c00cf25048",
                "status": "added"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/karaf/blob/8263abe51985988e9eaf259500b936103048b857/commons/src/main/java/org/apache/felix/karaf/commons/osgi/VersionRange.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/commons/src/main/java/org/apache/felix/karaf/commons/osgi/VersionRange.java?ref=8263abe51985988e9eaf259500b936103048b857",
                "deletions": 1,
                "filename": "commons/src/main/java/org/apache/felix/karaf/commons/osgi/VersionRange.java",
                "patch": "@@ -16,7 +16,7 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-package org.apache.felix.karaf.features.internal;\n+package org.apache.felix.karaf.commons.osgi;\n \n import org.osgi.framework.Version;\n ",
                "previous_filename": "features/core/src/main/java/org/apache/felix/karaf/features/internal/VersionRange.java",
                "raw_url": "https://github.com/apache/karaf/raw/8263abe51985988e9eaf259500b936103048b857/commons/src/main/java/org/apache/felix/karaf/commons/osgi/VersionRange.java",
                "sha": "47045deefc36bc8e74695906c9d4c1ed449d59e6",
                "status": "renamed"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/karaf/blob/8263abe51985988e9eaf259500b936103048b857/features/core/pom.xml",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/pom.xml?ref=8263abe51985988e9eaf259500b936103048b857",
                "deletions": 0,
                "filename": "features/core/pom.xml",
                "patch": "@@ -54,6 +54,11 @@\n             <artifactId>org.apache.felix.bundlerepository</artifactId>\n         </dependency>\n \n+        <dependency>\n+            <groupId>org.apache.felix.karaf</groupId>\n+            <artifactId>org.apache.felix.karaf.commons</artifactId>\n+        </dependency>\n+\n         <dependency>\n             <groupId>org.apache.felix.karaf.shell</groupId>\n             <artifactId>org.apache.felix.karaf.shell.console</artifactId>",
                "raw_url": "https://github.com/apache/karaf/raw/8263abe51985988e9eaf259500b936103048b857/features/core/pom.xml",
                "sha": "58c19ea8d6d1a27ea7583e686f44345523574d90",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/karaf/blob/8263abe51985988e9eaf259500b936103048b857/features/core/src/main/java/org/apache/felix/karaf/features/internal/FeaturesServiceImpl.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/src/main/java/org/apache/felix/karaf/features/internal/FeaturesServiceImpl.java?ref=8263abe51985988e9eaf259500b936103048b857",
                "deletions": 0,
                "filename": "features/core/src/main/java/org/apache/felix/karaf/features/internal/FeaturesServiceImpl.java",
                "patch": "@@ -40,6 +40,7 @@\n import java.util.regex.Matcher;\n import java.util.regex.Pattern;\n \n+import org.apache.felix.karaf.commons.osgi.VersionRange;\n import org.apache.felix.karaf.features.FeaturesService;\n import org.apache.felix.karaf.features.Feature;\n import org.apache.felix.karaf.features.Repository;",
                "raw_url": "https://github.com/apache/karaf/raw/8263abe51985988e9eaf259500b936103048b857/features/core/src/main/java/org/apache/felix/karaf/features/internal/FeaturesServiceImpl.java",
                "sha": "5bbf00067fdb2e6fd50fbf9612df1f1f2e4c0abc",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/karaf/blob/8263abe51985988e9eaf259500b936103048b857/pom.xml",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/pom.xml?ref=8263abe51985988e9eaf259500b936103048b857",
                "deletions": 0,
                "filename": "pom.xml",
                "patch": "@@ -35,6 +35,7 @@\n \n     <modules>\n         <module>main</module>\n+        <module>commons</module>\n         <module>features</module>\n         <module>admin</module>\n         <module>deployer</module>\n@@ -170,6 +171,11 @@\n                 <artifactId>org.apache.felix.karaf.client</artifactId>\n                 <version>${pom.version}</version>\n             </dependency>\n+            <dependency>\n+                <groupId>org.apache.felix.karaf</groupId>\n+                <artifactId>org.apache.felix.karaf.commons</artifactId>\n+                <version>${pom.version}</version>\n+            </dependency>\n             <dependency>\n                 <groupId>org.apache.felix.karaf.deployer</groupId>\n                 <artifactId>org.apache.felix.karaf.deployer.spring</artifactId>",
                "raw_url": "https://github.com/apache/karaf/raw/8263abe51985988e9eaf259500b936103048b857/pom.xml",
                "sha": "88eeb5cd6b2c98fd5ec18dcd938a887f9218067e",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/karaf/blob/8263abe51985988e9eaf259500b936103048b857/shell/dev/pom.xml",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/shell/dev/pom.xml?ref=8263abe51985988e9eaf259500b936103048b857",
                "deletions": 0,
                "filename": "shell/dev/pom.xml",
                "patch": "@@ -36,6 +36,11 @@\n         <artifactId>org.apache.felix.karaf.shell.console</artifactId>\n     </dependency>\n \n+    <dependency>\n+        <groupId>org.apache.felix.karaf</groupId>\n+        <artifactId>org.apache.felix.karaf.commons</artifactId>\n+    </dependency>\n+\n     <dependency>\n         <groupId>org.ops4j.pax.url</groupId>\n         <artifactId>pax-url-wrap</artifactId>",
                "raw_url": "https://github.com/apache/karaf/raw/8263abe51985988e9eaf259500b936103048b857/shell/dev/pom.xml",
                "sha": "406df26f0c3b83d47c8713cead0a2d20e5a2b693",
                "status": "modified"
            },
            {
                "additions": 51,
                "blob_url": "https://github.com/apache/karaf/blob/8263abe51985988e9eaf259500b936103048b857/shell/dev/src/main/java/org/apache/felix/karaf/shell/dev/ShowBundleTree.java",
                "changes": 74,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/shell/dev/src/main/java/org/apache/felix/karaf/shell/dev/ShowBundleTree.java?ref=8263abe51985988e9eaf259500b936103048b857",
                "deletions": 23,
                "filename": "shell/dev/src/main/java/org/apache/felix/karaf/shell/dev/ShowBundleTree.java",
                "patch": "@@ -48,16 +48,19 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(ShowBundleTree.class);\n \n-    // a cache of all exported packages\n-    private ExportedPackage[] allExportedPackages;\n+    private Tree<Bundle> tree;\n \n     @Override\n     protected void doExecute(Bundle bundle) throws Exception {\n+        long start = System.currentTimeMillis();\n         // let's do the real work here\n         printHeader(bundle);\n-        Tree<Bundle> tree = createTree(bundle);\n+        tree = new Tree<Bundle>(bundle);\n+        createTree(bundle);\n         printTree(tree);\n         printDuplicatePackages(tree);\n+        LOGGER.debug(format(\"Dependency tree calculated in %d ms\",\n+                            System.currentTimeMillis() - start));\n     }\n \n     /*\n@@ -119,44 +122,69 @@ private void printDuplicatePackages(Tree<Bundle> tree) {\n     /*\n      * Creates the bundle tree\n      */\n-    protected Tree<Bundle> createTree(Bundle bundle) {\n-        Tree<Bundle> tree = new Tree<Bundle>(bundle);\n-        Set<Bundle> trail = new HashSet<Bundle>();\n+    protected void createTree(Bundle bundle) {\n         if (bundle.getState() >= Bundle.RESOLVED) {\n-            createNode(tree, trail);\n+            createNode(tree);\n         } else {\n-            for (Import i : Import.parse(String.valueOf(bundle.getHeaders().get(\"Import-Package\")))) {\n-                for (ExportedPackage ep : getPackageAdmin().getExportedPackages(i.getPackage())) {\n-                    if (ep.getVersion().compareTo(i.getVersion()) >= 0) {\n-                        if (!bundle.equals(ep.getExportingBundle())) {\n-                            Node child = tree.addChild(ep.getExportingBundle());\n-                            System.out.printf(\"- using %s to resolve import %s%n\", ep.getExportingBundle(), i);\n-                            createNode(child, trail);\n-                        }\n+            createNodesForImports(tree, bundle);\n+        }\n+    }\n+\n+    /*\n+     * Creates nodes for the imports of the bundle (instead of reporting wiring information\n+     */\n+    private void createNodesForImports(Node node, Bundle bundle) {\n+        for (Import i : Import.parse(String.valueOf(bundle.getHeaders().get(\"Import-Package\")),\n+                                     String.valueOf(bundle.getHeaders().get(\"Export-Package\")))) {\n+            createNodeForImport(node, bundle, i);\n+        }\n+    }\n+\n+    /*\n+     * Create a child node for a given import (by finding a matching export in the currently installed bundles)\n+     */\n+    private void createNodeForImport(Node node, Bundle bundle, Import i) {\n+        ExportedPackage[] exporters = getPackageAdmin().getExportedPackages(i.getPackage());\n+        boolean foundMatch = false;\n+        if (exporters != null) {\n+            for (ExportedPackage ep : exporters) {\n+                if (i.getVersion().isInRange(ep.getVersion())) {\n+                    if (bundle.equals(ep.getExportingBundle())) {\n+                        foundMatch = true;\n+                    } else {\n+                        Node child = node.addChild(ep.getExportingBundle());\n+                        System.out.printf(\"- import %s: resolved using %s%n\", i, ep.getExportingBundle());\n+                        foundMatch = true;\n+                        createNode(child);\n                     }\n                 }\n             }\n         }\n-        return tree;\n+        if (!foundMatch) {\n+            System.out.printf(\"- import %s: WARNING - unable to find matching export%n\", i);            \n+        }\n     }\n \n     /*\n      * Creates a node in the bundle tree\n      */\n-    private void createNode(Node<Bundle> node, Set<Bundle> trail) {\n+    private void createNode(Node<Bundle> node) {\n         Bundle bundle = node.getValue();\n         Collection<Bundle> exporters = new HashSet<Bundle>();\n         exporters.addAll(getWiredBundles(bundle).values());\n \n         for (Bundle exporter : exporters) {\n-            if (trail.contains(exporter)) {\n-                LOGGER.debug(format(\"Skipping %s because it already exists in the current tree branch\", exporter));\n+            if (node.hasAncestor(exporter)) {                \n+                LOGGER.debug(format(\"Skipping %s (already exists in the current branch)\", exporter));\n             } else {\n-                trail.add(exporter);\n-                Node child = node.addChild(exporter);\n+                boolean existing = tree.flatten().contains(exporter);\n                 LOGGER.debug(format(\"Adding %s as a dependency for %s\", exporter, bundle));\n-                createNode(child, trail);\n-                trail.remove(exporter);\n+                Node child = node.addChild(exporter);\n+                if (existing) {\n+                    LOGGER.debug(format(\"Skipping children of %s (already exists in another branch)\", exporter));\n+                } else {\n+                    createNode(child);\n+                }\n             }\n         }\n     }",
                "raw_url": "https://github.com/apache/karaf/raw/8263abe51985988e9eaf259500b936103048b857/shell/dev/src/main/java/org/apache/felix/karaf/shell/dev/ShowBundleTree.java",
                "sha": "c46127489156039713eb3df35b37155dedf70c47",
                "status": "modified"
            },
            {
                "additions": 67,
                "blob_url": "https://github.com/apache/karaf/blob/8263abe51985988e9eaf259500b936103048b857/shell/dev/src/main/java/org/apache/felix/karaf/shell/dev/util/Import.java",
                "changes": 80,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/shell/dev/src/main/java/org/apache/felix/karaf/shell/dev/util/Import.java?ref=8263abe51985988e9eaf259500b936103048b857",
                "deletions": 13,
                "filename": "shell/dev/src/main/java/org/apache/felix/karaf/shell/dev/util/Import.java",
                "patch": "@@ -19,15 +19,15 @@\n import java.util.LinkedList;\n import java.util.List;\n \n-import org.osgi.framework.Version;\n+import org.apache.felix.karaf.commons.osgi.VersionRange;\n \n /**\n  * Simple class to model an OSGi Import-Package\n  */\n public class Import {\n \n     private final String packageName;\n-    private final Version version;\n+    private final VersionRange version;\n     private final String value;\n \n     /**\n@@ -38,28 +38,24 @@\n     protected Import(String value) {\n         super();\n         this.value = value;\n-        if (value.contains(\";\")) {\n-            this.packageName = value.split(\";\")[0];\n-        } else {\n-            this.packageName = value;\n-        }\n+        this.packageName = extractPackageName(value);\n         if (value.contains(\"version=\")) {\n             this.version = extractVersion(value);\n         } else {\n-            this.version = Version.emptyVersion;\n+            this.version = VersionRange.infiniteRange;\n         }\n     }\n \n     /*\n      * Extract the version from the string\n      */\n-    private Version extractVersion(String value) {\n+    private VersionRange extractVersion(String value) {\n         int begin = value.indexOf(\"version=\") + 8;\n         int end = value.indexOf(\";\", begin);\n         if (end < 0) {\n-            return Version.parseVersion(unquote(value.substring(begin)));\n+            return VersionRange.parse(unquote(value.substring(begin)));\n         } else {\n-            return Version.parseVersion(unquote(value.substring(begin, end)));\n+            return VersionRange.parse(unquote(value.substring(begin, end)));\n         }\n     }\n \n@@ -74,7 +70,7 @@ public String getPackage() {\n         return packageName;  \n     }\n \n-    public Version getVersion() {\n+    public VersionRange getVersion() {\n         return version;\n     }\n \n@@ -89,9 +85,67 @@ public String toString() {\n      */\n     public static List<Import> parse(String value) {\n         LinkedList<Import> imports = new LinkedList<Import>();\n-        for (String imp : value.split(\",\")) {\n+        for (String imp : split(value)) {\n             imports.add(new Import(imp));\n         }\n         return imports;\n     }\n+\n+    /**\n+     * Parse the value of an Import-Package META-INF header and return\n+     * a list of Import instances, filtering out packages that are in the\n+     * Export-Package META-INF header\n+     *\n+     * @param importValue the value of the Import-Package header\n+     * @param exportValue the value of the Export-Package header\n+     */\n+    public static List<Import> parse(String importValue, String exportValue) {\n+        LinkedList<String> exports = new LinkedList<String>();\n+        for (String exp : split(exportValue)) {\n+            exports.add(extractPackageName(exp));\n+        }\n+        LinkedList<Import> imports = new LinkedList<Import>();\n+        for (Import imp : parse(importValue)) {\n+            if (!exports.contains(imp.getPackage())) {\n+                imports.add(imp);\n+            }\n+        }\n+        return imports;\n+    }\n+\n+    /*\n+     * Extract the package name from the value\n+     * e.g. org.apache.felix.karaf;version=\"1.x\" -> org.apache.felix.karaf\n+     */\n+    private static String extractPackageName(String value) {\n+        if (value.contains(\";\")) {\n+            return value.split(\";\")[0];\n+        } else {\n+            return value;\n+        }\n+    }\n+\n+    /*\n+     * Counts the number of quotes in a String value\n+     */\n+    private static int quotes(String value) {\n+        return value.replaceAll(\"[^\\\"]\", \"\").length();\n+    }\n+\n+    /*\n+     * Split the OSGi headers on the , symbol\n+     */\n+    private static List<String> split(String value) {\n+        List<String> result = new LinkedList<String>();\n+        String[] elements = value.split(\",\");\n+        for (int i = 0; i < elements.length ; i++) {\n+            if (quotes(elements[i]) % 2 == 1) {\n+                // we probably split a version range, so joining it again with the next element\n+                result.add(elements[i] + \",\" + elements[++i]);\n+            } else {\n+                result.add(elements[i]);\n+            }\n+        }\n+        return result;\n+    }\n }",
                "raw_url": "https://github.com/apache/karaf/raw/8263abe51985988e9eaf259500b936103048b857/shell/dev/src/main/java/org/apache/felix/karaf/shell/dev/util/Import.java",
                "sha": "321570773787d56e6cdc918b4b7993696fd407aa",
                "status": "modified"
            },
            {
                "additions": 14,
                "blob_url": "https://github.com/apache/karaf/blob/8263abe51985988e9eaf259500b936103048b857/shell/dev/src/main/java/org/apache/felix/karaf/shell/dev/util/Node.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/shell/dev/src/main/java/org/apache/felix/karaf/shell/dev/util/Node.java?ref=8263abe51985988e9eaf259500b936103048b857",
                "deletions": 0,
                "filename": "shell/dev/src/main/java/org/apache/felix/karaf/shell/dev/util/Node.java",
                "patch": "@@ -93,6 +93,20 @@ public Node addChild(T value) {\n         return result;\n     }\n \n+    /**\n+     * Check if the node has an ancestor that represents the given value\n+     *\n+     * @param value the node value\n+     * @return <code>true</code> it there's an ancestor that represents the value\n+     */\n+    public boolean hasAncestor(T value) {\n+        if (parent == null) {\n+            return false;\n+        } else {\n+            return value.equals(parent.value) || parent.hasAncestor(value);\n+        }\n+    }\n+\n     /*\n      * Write this node to the PrintWriter.  It should be indented one step\n      * further for every element in the indents array.  If an element in the",
                "raw_url": "https://github.com/apache/karaf/raw/8263abe51985988e9eaf259500b936103048b857/shell/dev/src/main/java/org/apache/felix/karaf/shell/dev/util/Node.java",
                "sha": "b266fe4cab76df6335706672e0310c71a435f531",
                "status": "modified"
            },
            {
                "additions": 21,
                "blob_url": "https://github.com/apache/karaf/blob/8263abe51985988e9eaf259500b936103048b857/shell/dev/src/test/java/org/apache/felix/karaf/shell/dev/util/ImportTest.java",
                "changes": 23,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/shell/dev/src/test/java/org/apache/felix/karaf/shell/dev/util/ImportTest.java?ref=8263abe51985988e9eaf259500b936103048b857",
                "deletions": 2,
                "filename": "shell/dev/src/test/java/org/apache/felix/karaf/shell/dev/util/ImportTest.java",
                "patch": "@@ -20,8 +20,9 @@\n \n import static junit.framework.Assert.assertEquals;\n import static org.junit.Assert.assertNotNull;\n+\n+import org.apache.felix.karaf.commons.osgi.VersionRange;\n import org.junit.Test;\n-import org.osgi.framework.Version;\n \n /**\n  * Test cases for {@link org.apache.felix.karaf.shell.dev.util.Import}\n@@ -38,7 +39,7 @@ public void createWithPackageName() {\n     public void createWithPackageNameAndVersion() {\n         Import i = new Import(\"org.wip.bar;version=\\\"2.0.0\\\"\");\n         assertEquals(\"org.wip.bar\", i.getPackage());\n-        assertEquals(new Version(\"2.0.0\"), i.getVersion());\n+        assertEquals(VersionRange.parse(\"2.0.0\"), i.getVersion());\n     }\n \n     @Test\n@@ -49,4 +50,22 @@ public void createListOfImports() {\n         assertEquals(\"org.wip.bar\", imports.get(0).getPackage());\n         assertEquals(\"org.wip.foo\", imports.get(1).getPackage());\n     }\n+\n+    @Test\n+    public void createListOfImportsWithVersionRanges() {\n+        List<Import> imports =\n+                Import.parse(\"javax.activation;version=\\\"[0.0,2)\\\",javax.annotation;version=\\\"[0.0,2)\\\"\");\n+        assertNotNull(imports);\n+        assertEquals(2, imports.size());\n+        assertEquals(\"javax.activation\", imports.get(0).getPackage());\n+        assertEquals(\"javax.annotation\", imports.get(1).getPackage());\n+    }\n+\n+    @Test\n+    public void createListOfImportsWithExports() {\n+        List<Import> imports = Import.parse(\"org.wip.bar;version=\\\"2.0.0\\\",org.wip.foo\", \"org.wip.bar;version=\\\"2.0.0\\\"\");\n+        assertNotNull(imports);\n+        assertEquals(1, imports.size());\n+        assertEquals(\"org.wip.foo\", imports.get(0).getPackage());\n+    }\n }",
                "raw_url": "https://github.com/apache/karaf/raw/8263abe51985988e9eaf259500b936103048b857/shell/dev/src/test/java/org/apache/felix/karaf/shell/dev/util/ImportTest.java",
                "sha": "8a2aa14234f8d2d6c4a3555786462c574a0dc83f",
                "status": "modified"
            },
            {
                "additions": 14,
                "blob_url": "https://github.com/apache/karaf/blob/8263abe51985988e9eaf259500b936103048b857/shell/dev/src/test/java/org/apache/felix/karaf/shell/dev/util/TreeTest.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/shell/dev/src/test/java/org/apache/felix/karaf/shell/dev/util/TreeTest.java?ref=8263abe51985988e9eaf259500b936103048b857",
                "deletions": 0,
                "filename": "shell/dev/src/test/java/org/apache/felix/karaf/shell/dev/util/TreeTest.java",
                "patch": "@@ -24,6 +24,7 @@\n import java.util.Set;\n \n import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n import static org.junit.Assert.assertNotNull;\n import static org.junit.Assert.assertTrue;\n import org.junit.Test;\n@@ -108,6 +109,19 @@ public void flattenTree() throws IOException {\n         assertTrue(elements.contains(\"grandchild\"));\n     }\n \n+    @Test\n+    public void hasAncestor() throws IOException {\n+        Tree<String> tree = new Tree<String>(\"root\");\n+        Node<String> child1 = tree.addChild(\"child1\");\n+        child1.addChild(\"grandchild\");\n+        Node child2 = tree.addChild(\"child2\");\n+        Node node = child2.addChild(\"grandchild2\");\n+\n+        assertTrue(node.hasAncestor(\"child2\"));\n+        assertTrue(node.hasAncestor(\"root\"));\n+        assertFalse(node.hasAncestor(\"child1\"));\n+    }\n+\n     private BufferedReader read(Tree<String> tree) {\n         StringWriter writer = new StringWriter();\n         tree.write(new PrintWriter(writer));",
                "raw_url": "https://github.com/apache/karaf/raw/8263abe51985988e9eaf259500b936103048b857/shell/dev/src/test/java/org/apache/felix/karaf/shell/dev/util/TreeTest.java",
                "sha": "c11e2c36c84b6d57225720552221ec8112bc54ff",
                "status": "modified"
            }
        ],
        "message": "FELIX-2169: Improve dev:show-tree performance and avoid NPE when no matching export is found\n\ngit-svn-id: https://svn.apache.org/repos/asf/felix/trunk/karaf@918963 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/karaf/commit/5a2fd3b1e9501106347dc62748987b9a648850e4",
        "patched_files": [
            "FeaturesServiceImpl.java",
            "VersionRange.java",
            "ShowBundleTree.java",
            "unix-bin.java",
            "Node.java",
            "pom.java",
            "windows-bin.java",
            "startup.java",
            "Tree.java",
            "Import.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "TreeTest.java",
            "ImportTest.java",
            "FeaturesServiceImplTest.java"
        ]
    },
    "karaf_85111be": {
        "bug_id": "karaf_85111be",
        "commit": "https://github.com/apache/karaf/commit/85111bea15554f795a08773f3184aabc8733e54c",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/karaf/blob/85111bea15554f795a08773f3184aabc8733e54c/features/extension/src/main/java/org/apache/karaf/features/extension/StoredWiringResolver.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/extension/src/main/java/org/apache/karaf/features/extension/StoredWiringResolver.java?ref=85111bea15554f795a08773f3184aabc8733e54c",
                "deletions": 1,
                "filename": "features/extension/src/main/java/org/apache/karaf/features/extension/StoredWiringResolver.java",
                "patch": "@@ -108,6 +108,8 @@ synchronized void update(Bundle bundle) {\n     }\n \n     synchronized void delete(Bundle bundle) {\n-        wiring.get(bundle.getBundleId()).delete(path);\n+        if (wiring.get(bundle.getBundleId()) != null) {\n+            wiring.get(bundle.getBundleId()).delete(path);\n+        }\n     }\n }",
                "raw_url": "https://github.com/apache/karaf/raw/85111bea15554f795a08773f3184aabc8733e54c/features/extension/src/main/java/org/apache/karaf/features/extension/StoredWiringResolver.java",
                "sha": "0d7de172ca005697d8ed0b8d279b4e1e6a00b4bf",
                "status": "modified"
            }
        ],
        "message": "[KARAF-5211] Prevent NPE in StoredWiringResolver when trying to delete bundle wiring",
        "parent": "https://github.com/apache/karaf/commit/bf2a9e90b6204a5917b26e66b722e91603daff69",
        "patched_files": [
            "StoredWiringResolver.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "StoredWiringResolverTest.java"
        ]
    },
    "karaf_915894b": {
        "bug_id": "karaf_915894b",
        "commit": "https://github.com/apache/karaf/commit/915894b5d10f2cd3ca14d537291dc9365003d6a1",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/karaf/blob/915894b5d10f2cd3ca14d537291dc9365003d6a1/jaas/modules/src/main/java/org/apache/karaf/jaas/modules/syncope/SyncopeLoginModule.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/jaas/modules/src/main/java/org/apache/karaf/jaas/modules/syncope/SyncopeLoginModule.java?ref=915894b5d10f2cd3ca14d537291dc9365003d6a1",
                "deletions": 3,
                "filename": "jaas/modules/src/main/java/org/apache/karaf/jaas/modules/syncope/SyncopeLoginModule.java",
                "patch": "@@ -84,7 +84,9 @@ public boolean login() throws LoginException {\n         Credentials creds = new UsernamePasswordCredentials(user, password);\n         client.getCredentialsProvider().setCredentials(AuthScope.ANY, creds);\n         HttpGet get = new HttpGet(address + \"/users/self\");\n-        if (version.equals(\"2.x\") || version.equals(\"2\")) {\n+\n+        boolean version2 = version != null && (version.equals(\"2.x\") || version.equals(\"2\"));\n+        if (version2) {\n             get.setHeader(\"Content-Type\", \"application/json\");\n         } else {\n             get.setHeader(\"Content-Type\", \"application/xml\");\n@@ -102,7 +104,7 @@ public boolean login() throws LoginException {\n             principals.add(new UserPrincipal(user));\n             LOGGER.debug(\"Retrieving user {} roles\", user);\n             String responseSt = EntityUtils.toString(response.getEntity());\n-            if (version.equals(\"2.x\") || version.equals(\"2\")) {\n+            if (version2) {\n                 roles = extractingRolesSyncope2(responseSt);\n             } else {\n                 roles = extractingRolesSyncope1(responseSt);\n@@ -136,7 +138,7 @@ public boolean login() throws LoginException {\n                 response = response.substring(index + \"<memberships>\".length());\n                 index = response.indexOf(\"</memberships>\");\n                 response = response.substring(0, index);\n-    \n+\n                 // looking for the roleName elements\n                 index = response.indexOf(\"<roleName>\");\n                 while (index != -1) {",
                "raw_url": "https://github.com/apache/karaf/raw/915894b5d10f2cd3ca14d537291dc9365003d6a1/jaas/modules/src/main/java/org/apache/karaf/jaas/modules/syncope/SyncopeLoginModule.java",
                "sha": "0e4ae973333ee90acda938f5c6b33faf69fd1d28",
                "status": "modified"
            }
        ],
        "message": "KARAF-5496 - NPEs in SyncopeLoginModule if \"version\" is not specified",
        "parent": "https://github.com/apache/karaf/commit/75f345cbf990134f9dad551591380e76d887bb36",
        "patched_files": [
            "SyncopeLoginModule.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "SyncopeLoginModuleTest.java"
        ]
    },
    "karaf_9b4a050": {
        "bug_id": "karaf_9b4a050",
        "commit": "https://github.com/apache/karaf/commit/9b4a050ec78869f4e690c81d06a4b129ce3defca",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/karaf/blob/9b4a050ec78869f4e690c81d06a4b129ce3defca/service/core/src/main/java/org/apache/karaf/service/command/ListServices.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/service/core/src/main/java/org/apache/karaf/service/command/ListServices.java?ref=9b4a050ec78869f4e690c81d06a4b129ce3defca",
                "deletions": 3,
                "filename": "service/core/src/main/java/org/apache/karaf/service/command/ListServices.java",
                "patch": "@@ -122,9 +122,10 @@ private void printServiceRef(ServiceReference<?> serviceRef) {\n         String bundleName = ShellUtil.getBundleName(serviceRef.getBundle());\n         System.out.println(\"Provided by : \");\n         System.out.println(\" \" + bundleName);\n-        if (serviceRef.getUsingBundles() != null) {\n-        System.out.println(\"Used by: \");\n-            for (Bundle bundle : serviceRef.getUsingBundles()) {\n+        Bundle[] usingBundles = serviceRef.getUsingBundles();\n+        if (usingBundles != null) {\n+            System.out.println(\"Used by: \");\n+            for (Bundle bundle : usingBundles) {\n                 System.out.println(\" \" + ShellUtil.getBundleName(bundle));\n             }\n         }",
                "raw_url": "https://github.com/apache/karaf/raw/9b4a050ec78869f4e690c81d06a4b129ce3defca/service/core/src/main/java/org/apache/karaf/service/command/ListServices.java",
                "sha": "aed352ef1ef5be9d666da6ed34d160471856ce53",
                "status": "modified"
            }
        ],
        "message": "Fix possible NPE",
        "parent": "https://github.com/apache/karaf/commit/981239128f69f31dbd89cb6ddabf8a416d1606e1",
        "patched_files": [
            "ListServices.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "ListServicesTest.java"
        ]
    },
    "karaf_9ebb25a": {
        "bug_id": "karaf_9ebb25a",
        "commit": "https://github.com/apache/karaf/commit/9ebb25a9d7578d7ee278f26c4fddd851c669a651",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/karaf/blob/9ebb25a9d7578d7ee278f26c4fddd851c669a651/features/core/src/main/java/org/apache/karaf/features/internal/service/Deployer.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/src/main/java/org/apache/karaf/features/internal/service/Deployer.java?ref=9ebb25a9d7578d7ee278f26c4fddd851c669a651",
                "deletions": 2,
                "filename": "features/core/src/main/java/org/apache/karaf/features/internal/service/Deployer.java",
                "patch": "@@ -727,8 +727,8 @@ public void deploy(DeploymentState dstate, DeploymentRequest request) throws Exc\n                             && isUpdateable(resource) && !deployment.bundleChecksums.containsKey(bundle.getBundleId())) {\n                         deployment.bundleChecksums.put(bundle.getBundleId(), crc);\n                     }\n-                    int startLevel = startLevels.get(resource);\n-                    if (startLevel != dstate.initialBundleStartLevel) {\n+                    Integer startLevel = startLevels.get(resource);\n+                    if (startLevel != null && startLevel != dstate.initialBundleStartLevel) {\n                         callback.setBundleStartLevel(bundle, startLevel);\n                     }\n                     FeatureState reqState = states.get(resource);",
                "raw_url": "https://github.com/apache/karaf/raw/9ebb25a9d7578d7ee278f26c4fddd851c669a651/features/core/src/main/java/org/apache/karaf/features/internal/service/Deployer.java",
                "sha": "aded8af4acb0ccd59b90b9649bbbd64ac68e6989",
                "status": "modified"
            }
        ],
        "message": "Avoid NPE",
        "parent": "https://github.com/apache/karaf/commit/210af29312197178a44c03ea1b439ce63a1c83fa",
        "patched_files": [
            "Deployer.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "DeployerTest.java"
        ]
    },
    "karaf_a2789e1": {
        "bug_id": "karaf_a2789e1",
        "commit": "https://github.com/apache/karaf/commit/a2789e10b9204cbd269de4e1ec1965ddffa3750d",
        "file": [
            {
                "additions": 38,
                "blob_url": "https://github.com/apache/karaf/blob/a2789e10b9204cbd269de4e1ec1965ddffa3750d/itests/src/test/java/org/apache/felix/karaf/shell/itests/AbstractIntegrationTest.java",
                "changes": 44,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/itests/src/test/java/org/apache/felix/karaf/shell/itests/AbstractIntegrationTest.java?ref=a2789e10b9204cbd269de4e1ec1965ddffa3750d",
                "deletions": 6,
                "filename": "itests/src/test/java/org/apache/felix/karaf/shell/itests/AbstractIntegrationTest.java",
                "patch": "@@ -16,7 +16,11 @@\n  */\n package org.apache.felix.karaf.shell.itests;\n \n+import java.util.Collection;\n import java.util.Dictionary;\n+import java.util.Enumeration;\n+import java.util.LinkedList;\n+import java.util.List;\n \n import org.ops4j.pax.exam.CoreOptions;\n import org.ops4j.pax.exam.Inject;\n@@ -65,15 +69,14 @@\n             // This is buggy, as the service reference may change i think\n             Object svc = type.cast(tracker.waitForService(timeout));\n             if (svc == null) {\n-\n                 Dictionary dic = bundleContext.getBundle().getHeaders();\n-                System.err.println(\"Test bundle headers: \" + dic);\n-                ServiceReference[] refs = bundleContext.getAllServiceReferences(null, null);\n-                for (ServiceReference ref : refs) {\n+                System.err.println(\"Test bundle headers: \" + explode(dic));\n+\n+                for (ServiceReference ref : asCollection(bundleContext.getAllServiceReferences(null, null))) {\n                     System.err.println(\"ServiceReference: \" + ref);\n                 }\n-                refs = bundleContext.getAllServiceReferences(null, flt);\n-                for (ServiceReference ref : refs) {\n+\n+                for (ServiceReference ref : asCollection(bundleContext.getAllServiceReferences(null, flt))) {\n                     System.err.println(\"Filtered ServiceReference: \" + ref);\n                 }\n \n@@ -105,4 +108,33 @@ public static MavenArtifactProvisionOption mavenBundle(String groupId, String ar\n         return CoreOptions.mavenBundle().groupId(groupId).artifactId(artifactId).versionAsInProject();\n     }\n \n+    /*\n+     * Explode the dictionary into a ,-delimited list of key=value pairs\n+     */\n+    private static String explode(Dictionary dictionary) {\n+        Enumeration keys = dictionary.keys();\n+        StringBuffer result = new StringBuffer();\n+        while (keys.hasMoreElements()) {\n+            Object key = keys.nextElement();\n+            result.append(String.format(\"%s=%s\", key, dictionary.get(key)));\n+            if (keys.hasMoreElements()) {\n+                result.append(\", \");\n+            }\n+        }\n+        return result.toString();\n+    }\n+\n+    /*\n+     * Provides an iterable collection of references, even if the original array is null\n+     */\n+    private static final Collection<ServiceReference> asCollection(ServiceReference[] references) {\n+        List<ServiceReference> result = new LinkedList<ServiceReference>();\n+        if (references != null) {\n+            for (ServiceReference reference : references) {\n+                result.add(reference);\n+            }\n+        }\n+        return result;\n+    }\n+\n }",
                "raw_url": "https://github.com/apache/karaf/raw/a2789e10b9204cbd269de4e1ec1965ddffa3750d/itests/src/test/java/org/apache/felix/karaf/shell/itests/AbstractIntegrationTest.java",
                "sha": "950a6609d5518a13431a2a305d91d7d3c4f9760b",
                "status": "modified"
            }
        ],
        "message": "FELIX-1932: Ensure that a missing reference in an itest gets logged without throwing NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/felix/trunk/karaf@888961 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/karaf/commit/c8ed4402cfa36c0e30790b9db5ea68dea9fcba7f",
        "patched_files": [],
        "repo": "karaf",
        "unit_tests": [
            "AbstractIntegrationTest.java"
        ]
    },
    "karaf_a8562f0": {
        "bug_id": "karaf_a8562f0",
        "commit": "https://github.com/apache/karaf/commit/a8562f09711da32f0094d4edaf77377c16277118",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/karaf/blob/a8562f09711da32f0094d4edaf77377c16277118/features/core/src/main/java/org/apache/karaf/features/internal/FeaturesServiceImpl.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/src/main/java/org/apache/karaf/features/internal/FeaturesServiceImpl.java?ref=a8562f09711da32f0094d4edaf77377c16277118",
                "deletions": 0,
                "filename": "features/core/src/main/java/org/apache/karaf/features/internal/FeaturesServiceImpl.java",
                "patch": "@@ -557,6 +557,9 @@ protected Bundle installBundleIfNeeded(InstallationState state, BundleInfo bundl\n             is.mark(256 * 1024);\n             JarInputStream jar = new JarInputStream(is);\n             Manifest m = jar.getManifest();\n+            if(m == null) {\n+                throw new BundleException(\"Manifest not present in the first entry of the zip\");\n+            }\n             String sn = m.getMainAttributes().getValue(Constants.BUNDLE_SYMBOLICNAME);\n             String vStr = m.getMainAttributes().getValue(Constants.BUNDLE_VERSION);\n             Version v = vStr == null ? Version.emptyVersion : Version.parseVersion(vStr);",
                "raw_url": "https://github.com/apache/karaf/raw/a8562f09711da32f0094d4edaf77377c16277118/features/core/src/main/java/org/apache/karaf/features/internal/FeaturesServiceImpl.java",
                "sha": "8e971a894b421d1f7f1385408310d4a562d42b6e",
                "status": "modified"
            }
        ],
        "message": "KARAF-133: NPE when installing a bundle with a MANIFEST.MF not in the first entry of the zip\nPatch provided by Ioannis Canellos\n\ngit-svn-id: https://svn.apache.org/repos/asf/karaf/trunk@985818 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/karaf/commit/0605a289bc98a0d1dbde2b9b98052c4c23a4d3bc",
        "patched_files": [
            "FeaturesServiceImpl.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "FeaturesServiceImplTest.java"
        ]
    },
    "karaf_ab4c9e8": {
        "bug_id": "karaf_ab4c9e8",
        "commit": "https://github.com/apache/karaf/commit/ab4c9e857c5b5a0938622efc6a457b145644bfe8",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/karaf/blob/ab4c9e857c5b5a0938622efc6a457b145644bfe8/http/src/main/java/org/apache/karaf/http/core/internal/osgi/Activator.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/http/src/main/java/org/apache/karaf/http/core/internal/osgi/Activator.java?ref=ab4c9e857c5b5a0938622efc6a457b145644bfe8",
                "deletions": 1,
                "filename": "http/src/main/java/org/apache/karaf/http/core/internal/osgi/Activator.java",
                "patch": "@@ -98,6 +98,8 @@ protected void doStop() {\n \n     @Override\n     public void updated(Dictionary<String, ?> properties) {\n-        proxyService.initProxies();\n+        if (proxyService != null) {\n+            proxyService.initProxies();\n+        }\n     }\n }",
                "raw_url": "https://github.com/apache/karaf/raw/ab4c9e857c5b5a0938622efc6a457b145644bfe8/http/src/main/java/org/apache/karaf/http/core/internal/osgi/Activator.java",
                "sha": "6be368ba05ff7e27488d72bfefcc3c26d6599f48",
                "status": "modified"
            }
        ],
        "message": "add NPE guard for proxyService",
        "parent": "https://github.com/apache/karaf/commit/cc06aeb296a1866727692280a6907ef563ce8e42",
        "patched_files": [
            "Activator.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "ActivatorTest.java"
        ]
    },
    "karaf_b220722": {
        "bug_id": "karaf_b220722",
        "commit": "https://github.com/apache/karaf/commit/b220722c3652bf02ca00150d0decb2509b83adc0",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/karaf/blob/b220722c3652bf02ca00150d0decb2509b83adc0/jaas/modules/src/main/java/org/apache/karaf/jaas/modules/properties/PropertiesLoginModule.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/jaas/modules/src/main/java/org/apache/karaf/jaas/modules/properties/PropertiesLoginModule.java?ref=b220722c3652bf02ca00150d0decb2509b83adc0",
                "deletions": 2,
                "filename": "jaas/modules/src/main/java/org/apache/karaf/jaas/modules/properties/PropertiesLoginModule.java",
                "patch": "@@ -59,9 +59,10 @@ public void initialize(Subject sub, CallbackHandler handler, Map sharedState, Ma\n             LOGGER.debug(\"Initialized debug={} usersFile={}\", debug, usersFile);\n         }\n        \n-        if (propertiesInstaller == null || !usersFile.equals(propertiesInstaller.getUsersFileName()) ) {\n+        if (propertiesInstaller == null \n+            || (usersFile != null && !usersFile.equals(propertiesInstaller.getUsersFileName())) ) {\n        \n-            LOG.debug(\"Register PropertiesInstaller service\");\n+            LOGGER.debug(\"Register PropertiesInstaller service\");\n             \n             propertiesInstaller = new PropertiesInstaller(this, usersFile);\n             if (this.bundleContext != null) {",
                "raw_url": "https://github.com/apache/karaf/raw/b220722c3652bf02ca00150d0decb2509b83adc0/jaas/modules/src/main/java/org/apache/karaf/jaas/modules/properties/PropertiesLoginModule.java",
                "sha": "c11d54a473f211ce8fc6b8de7f7feb5bf4c44e37",
                "status": "modified"
            }
        ],
        "message": "add a NPE checker",
        "parent": "https://github.com/apache/karaf/commit/f74a1dcdcf28f0615ab28519716b844c20b84edc",
        "patched_files": [
            "PropertiesLoginModule.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "PropertiesLoginModuleTest.java"
        ]
    },
    "karaf_b867058": {
        "bug_id": "karaf_b867058",
        "commit": "https://github.com/apache/karaf/commit/b867058ed1b875778382b4fb241a24efb5158bd5",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/karaf/blob/b867058ed1b875778382b4fb241a24efb5158bd5/config/src/main/java/org/apache/karaf/config/command/EditCommand.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/config/src/main/java/org/apache/karaf/config/command/EditCommand.java?ref=b867058ed1b875778382b4fb241a24efb5158bd5",
                "deletions": 0,
                "filename": "config/src/main/java/org/apache/karaf/config/command/EditCommand.java",
                "patch": "@@ -50,6 +50,9 @@ protected Object doExecute() throws Exception {\n         \n         if (pid.startsWith(\"(\")) {\n         \tConfiguration[] configs = this.configRepository.getConfigAdmin().listConfigurations(pid);\n+            if (configs == null) {\n+                throw new RuntimeException(\"No config found\");\n+            }\n         \tif (configs.length == 0) {\n         \t\tthrow new RuntimeException(\"Filter matches no config\");\n         \t}",
                "raw_url": "https://github.com/apache/karaf/raw/b867058ed1b875778382b4fb241a24efb5158bd5/config/src/main/java/org/apache/karaf/config/command/EditCommand.java",
                "sha": "3fcd82063133c0d865a16bc517d88e6473129f1d",
                "status": "modified"
            }
        ],
        "message": "[KARAF-3487] Fix NPE on config:edit command",
        "parent": "https://github.com/apache/karaf/commit/afbd611de8a9d728f50c67bd8c627ce47c0a8f50",
        "patched_files": [
            "EditCommand.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "EditCommandTest.java"
        ]
    },
    "karaf_bb6b274": {
        "bug_id": "karaf_bb6b274",
        "commit": "https://github.com/apache/karaf/commit/bb6b2744d51da2834eea9da3718aff19bb526481",
        "file": [
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/karaf/blob/bb6b2744d51da2834eea9da3718aff19bb526481/management/mbeans/config/src/main/java/org/apache/karaf/management/mbeans/config/internal/ConfigMBeanImpl.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/management/mbeans/config/src/main/java/org/apache/karaf/management/mbeans/config/internal/ConfigMBeanImpl.java?ref=bb6b2744d51da2834eea9da3718aff19bb526481",
                "deletions": 0,
                "filename": "management/mbeans/config/src/main/java/org/apache/karaf/management/mbeans/config/internal/ConfigMBeanImpl.java",
                "patch": "@@ -85,6 +85,8 @@ public void delete(String pid) throws Exception {\n             throw new IllegalArgumentException(\"Configuration PID \" + pid + \" doesn't exist\");\n         }\n         Dictionary dictionary = configuration.getProperties();\n+        if (dictionary == null)\n+            dictionary = new java.util.Properties();\n         Map<String, String> propertiesMap = new HashMap<String, String>();\n         for (Enumeration e = dictionary.keys(); e.hasMoreElements(); ) {\n             Object key = e.nextElement();\n@@ -100,6 +102,8 @@ public void propdel(String pid, String key) throws Exception {\n             throw new IllegalArgumentException(\"Configuration PID \" + pid + \" doesn't exist\");\n         }\n         Dictionary dictionary = configuration.getProperties();\n+        if (dictionary == null)\n+            dictionary = new java.util.Properties();\n         dictionary.remove(key);\n         store(pid, dictionary, false);\n     }\n@@ -110,6 +114,8 @@ public void propappend(String pid, String key, String value) throws Exception {\n             throw new IllegalArgumentException(\"Configuration PID \" + pid + \" doesn't exist\");\n         }\n         Dictionary dictionary = configuration.getProperties();\n+        if (dictionary == null)\n+            dictionary = new java.util.Properties();\n         Object currentValue = dictionary.get(key);\n         if (currentValue == null) {\n             dictionary.put(key, value);\n@@ -127,6 +133,8 @@ public void propset(String pid, String key, String value) throws Exception {\n             throw new IllegalArgumentException(\"Configuration PID \" + pid + \" doesn't exist\");\n         }\n         Dictionary dictionary = configuration.getProperties();\n+        if (dictionary == null)\n+            dictionary = new java.util.Properties();\n         dictionary.put(key, value);\n         store(pid, dictionary, false);\n     }",
                "raw_url": "https://github.com/apache/karaf/raw/bb6b2744d51da2834eea9da3718aff19bb526481/management/mbeans/config/src/main/java/org/apache/karaf/management/mbeans/config/internal/ConfigMBeanImpl.java",
                "sha": "7d7de01f47503ca4462b1cc01b294b0979c7cca7",
                "status": "modified"
            }
        ],
        "message": "[KARAF-932] Initialize the config properties if null to avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/karaf/trunk@1182538 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/karaf/commit/45891db199958664a3e224ac786899842a694d87",
        "patched_files": [
            "ConfigMBeanImpl.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "ConfigMBeanImplTest.java"
        ]
    },
    "karaf_c7860d7": {
        "bug_id": "karaf_c7860d7",
        "commit": "https://github.com/apache/karaf/commit/c7860d7d36b46f890c8e24b7ac058891b7bb9aa1",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/karaf/blob/c7860d7d36b46f890c8e24b7ac058891b7bb9aa1/features/core/src/main/java/org/apache/felix/karaf/features/internal/FeaturesServiceImpl.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/src/main/java/org/apache/felix/karaf/features/internal/FeaturesServiceImpl.java?ref=c7860d7d36b46f890c8e24b7ac058891b7bb9aa1",
                "deletions": 1,
                "filename": "features/core/src/main/java/org/apache/felix/karaf/features/internal/FeaturesServiceImpl.java",
                "patch": "@@ -301,7 +301,10 @@ public void uninstallFeature(String name, String version) throws Exception {\n             bundles.removeAll(b);\n         }\n         for (long bundleId : bundles) {\n-            getBundleContext().getBundle(bundleId).uninstall();\n+            Bundle b = getBundleContext().getBundle(bundleId);\n+            if (b != null) {\n+                b.uninstall();\n+            }\n         }\n         callListeners(new FeatureEvent(feature, FeatureEvent.EventType.FeatureInstalled, false));\n         saveState();",
                "raw_url": "https://github.com/apache/karaf/raw/c7860d7d36b46f890c8e24b7ac058891b7bb9aa1/features/core/src/main/java/org/apache/felix/karaf/features/internal/FeaturesServiceImpl.java",
                "sha": "421de12863716757b6f8c661543a3a20bf60f590",
                "status": "modified"
            }
        ],
        "message": "FELIX-1566: Possible NPE when uninstalling a feature\n\ngit-svn-id: https://svn.apache.org/repos/asf/felix/trunk/karaf@812386 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/karaf/commit/789dcc99f087965aef0e816e364495c18784bea6",
        "patched_files": [
            "FeaturesServiceImpl.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "FeaturesServiceImplTest.java"
        ]
    },
    "karaf_c892504": {
        "bug_id": "karaf_c892504",
        "commit": "https://github.com/apache/karaf/commit/c892504ac9a9eafaf01e2d8bbe90c88bc4f86541",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/karaf/blob/c892504ac9a9eafaf01e2d8bbe90c88bc4f86541/features/core/src/main/java/org/apache/karaf/features/internal/service/FeaturesServiceImpl.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/src/main/java/org/apache/karaf/features/internal/service/FeaturesServiceImpl.java?ref=c892504ac9a9eafaf01e2d8bbe90c88bc4f86541",
                "deletions": 1,
                "filename": "features/core/src/main/java/org/apache/karaf/features/internal/service/FeaturesServiceImpl.java",
                "patch": "@@ -423,7 +423,11 @@ public void removeRepository(URI uri, boolean uninstall) throws Exception {\n             for (String r : state.repositories) {\n                 if (!uri.toString().equals(r)) {\n                     Repository rep = repositories.getRepository(r);\n-                    repos.addAll(repositories.getRepositoryClosure(rep));\n+                    if (rep != null) {\n+                        repos.addAll(repositories.getRepositoryClosure(rep));\n+                    } else {\n+                        throw new IllegalArgumentException(\"Repository URI \" + uri + \" seems to have changed, can't remove repository\");\n+                    }\n                 }\n             }\n             for (Repository rep : repos) {",
                "raw_url": "https://github.com/apache/karaf/raw/c892504ac9a9eafaf01e2d8bbe90c88bc4f86541/features/core/src/main/java/org/apache/karaf/features/internal/service/FeaturesServiceImpl.java",
                "sha": "1924973d94379b4c2bccafd75ffad6bb94068af1",
                "status": "modified"
            }
        ],
        "message": "[KARAF-6252] Avoid NullPointerException while removing a features repository with location changed locally",
        "parent": "https://github.com/apache/karaf/commit/3fca012f5eafe87792612d24380cef22a9760358",
        "patched_files": [
            "FeaturesServiceImpl.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "FeaturesServiceImplTest.java"
        ]
    },
    "karaf_da4aa4c": {
        "bug_id": "karaf_da4aa4c",
        "commit": "https://github.com/apache/karaf/commit/da4aa4c59698c39929d565ae83cf0696311ab671",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/karaf/blob/da4aa4c59698c39929d565ae83cf0696311ab671/jaas/modules/src/main/java/org/apache/karaf/jaas/modules/impl/KarafRealm.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/jaas/modules/src/main/java/org/apache/karaf/jaas/modules/impl/KarafRealm.java?ref=da4aa4c59698c39929d565ae83cf0696311ab671",
                "deletions": 3,
                "filename": "jaas/modules/src/main/java/org/apache/karaf/jaas/modules/impl/KarafRealm.java",
                "patch": "@@ -67,9 +67,11 @@ private void populateDefault(Map<String, Object> props) {\n     public void updated(Dictionary<String, ?> properties) throws ConfigurationException {\n         Map<String, Object> props = new HashMap<String, Object>();\n         populateDefault(props);\n-        for (Enumeration<String> keyEnum = properties.keys(); keyEnum.hasMoreElements(); ) {\n-            String key = keyEnum.nextElement();\n-            props.put(key, properties.get(key));\n+        if (properties != null) {\n+            for (Enumeration<String> keyEnum = properties.keys(); keyEnum.hasMoreElements(); ) {\n+                String key = keyEnum.nextElement();\n+                props.put(key, properties.get(key));\n+            }\n         }\n         this.properties = props;\n     }",
                "raw_url": "https://github.com/apache/karaf/raw/da4aa4c59698c39929d565ae83cf0696311ab671/jaas/modules/src/main/java/org/apache/karaf/jaas/modules/impl/KarafRealm.java",
                "sha": "a04d5ac8277fa31b043d8867dd6f036812e35ef2",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/karaf/blob/da4aa4c59698c39929d565ae83cf0696311ab671/shell/core/src/main/java/org/apache/karaf/shell/impl/console/osgi/Activator.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/shell/core/src/main/java/org/apache/karaf/shell/impl/console/osgi/Activator.java?ref=da4aa4c59698c39929d565ae83cf0696311ab671",
                "deletions": 2,
                "filename": "shell/core/src/main/java/org/apache/karaf/shell/impl/console/osgi/Activator.java",
                "patch": "@@ -80,11 +80,13 @@ public void start(BundleContext context) throws Exception {\n     @Override\n     public void stop(BundleContext context) throws Exception {\n         sessionFactoryRegistration.unregister();\n-        localConsoleManager.stop();\n+        if (localConsoleManager != null) {\n+            localConsoleManager.stop();\n+            terminalFactory.destroy();\n+        }\n         sessionFactory.stop();\n         actionExtender.stop(context);\n         threadIO.stop();\n-        terminalFactory.destroy();\n         if (eventAdminListener != null) {\n             eventAdminListener.close();\n         }",
                "raw_url": "https://github.com/apache/karaf/raw/da4aa4c59698c39929d565ae83cf0696311ab671/shell/core/src/main/java/org/apache/karaf/shell/impl/console/osgi/Activator.java",
                "sha": "9c328d4e05cd354c1dc73324badbff2ace645012",
                "status": "modified"
            }
        ],
        "message": "Fix possible NPE",
        "parent": "https://github.com/apache/karaf/commit/687ba286974f1edd15c5bae0330864d3502b8339",
        "patched_files": [
            "Activator.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "ActivatorTest.java"
        ]
    },
    "karaf_dee71a6": {
        "bug_id": "karaf_dee71a6",
        "commit": "https://github.com/apache/karaf/commit/dee71a697036dfedcac7f3617f373ff06f7d5fbb",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/karaf/blob/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/main/java/org/apache/karaf/main/InstanceHelper.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/main/src/main/java/org/apache/karaf/main/InstanceHelper.java?ref=dee71a697036dfedcac7f3617f373ff06f7d5fbb",
                "deletions": 1,
                "filename": "main/src/main/java/org/apache/karaf/main/InstanceHelper.java",
                "patch": "@@ -152,7 +152,9 @@ static void setupShutdown(ConfigProperties config, Framework framework) {\n                     port = shutdownSocket.getLocalPort();\r\n                 }\r\n                 if (portFile != null) {\r\n-                    Writer w = new OutputStreamWriter(new FileOutputStream(portFile));\r\n+                    File portF = new File(portFile);\r\n+                    portF.getParentFile().mkdirs();\r\n+                    Writer w = new OutputStreamWriter(new FileOutputStream(portF));\r\n                     w.write(Integer.toString(port));\r\n                     w.close();\r\n                 }\r",
                "raw_url": "https://github.com/apache/karaf/raw/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/main/java/org/apache/karaf/main/InstanceHelper.java",
                "sha": "8b9ebaa028bdab71779bc1e3307c8f71f07ddeb1",
                "status": "modified"
            },
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/karaf/blob/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/main/java/org/apache/karaf/main/lock/DefaultJDBCLock.java",
                "changes": 41,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/main/src/main/java/org/apache/karaf/main/lock/DefaultJDBCLock.java?ref=dee71a697036dfedcac7f3617f373ff06f7d5fbb",
                "deletions": 22,
                "filename": "main/src/main/java/org/apache/karaf/main/lock/DefaultJDBCLock.java",
                "patch": "@@ -152,30 +152,20 @@ boolean schemaExists() {\n      * @return true, if the table exists else false\n      */\n     boolean schemaExist(String tableName) {\n-        ResultSet rs = null;\n-        boolean schemaExists = false;\n         try {\n             DatabaseMetaData metadata = getConnection().getMetaData();\n-            rs = metadata.getTables(null, null, tableName, new String[] {\"TABLE\"});\n-            schemaExists = rs.next();\n-            if (schemaExists == false) {\n-                // try table name in lower case\n-                rs = metadata.getTables(null, null, tableName.toLowerCase(), new String[] {\"TABLE\"});\n-                schemaExists = rs.next();\n-            }\n-            /*\n-            if (schemaExists == false) {\n-                // try table name in upper case\n-                rs = getConnection().getMetaData().getTables(null, null, tableName.toUpperCase(), new String[] {\"TABLE\"});\n-                schemaExists = rs.next();\n-            }\n-            */\n+            return metadata != null && (checkTableExists(tableName.toLowerCase(), metadata) //\n+                || checkTableExists(tableName.toLowerCase(), metadata));\n         } catch (Exception ignore) {\n-            LOG.log(Level.SEVERE, \"Error testing for db table\", ignore);\n-        } finally {\n-            closeSafely(rs);\n+            return false;\n+            //throw new RuntimeException(\"Error testing for db table\", ignore);\n+        }\n+    }\n+\n+    private boolean checkTableExists(String tableName, DatabaseMetaData metadata) throws SQLException {\n+        try (ResultSet rs = metadata.getTables(null, null, tableName, new String[] {\"TABLE\"})) {\n+            return rs.next();\n         }\n-        return schemaExists;\n     }\n \n     /*\n@@ -203,7 +193,7 @@ boolean aquireLock() {\n             lockAquired = preparedStatement.execute();\n         } catch (Exception e) {\n             // Do we want to display this message everytime???\n-            LOG.log(Level.WARNING, \"Failed to acquire database lock\", e);\n+            log(Level.WARNING, \"Failed to acquire database lock\", e);\n         } finally {\n             closeSafely(preparedStatement);\n         }\n@@ -222,13 +212,20 @@ boolean updateLock() {\n             int rows = preparedStatement.executeUpdate();\n             lockUpdated = (rows == 1);\n         } catch (Exception e) {\n-            LOG.log(Level.WARNING, \"Failed to update database lock\", e);\n+            log(Level.WARNING, \"Failed to update database lock\", e);\n         } finally {\n             closeSafely(preparedStatement);\n         }\n         \n         return lockUpdated;\n     }\n+    \n+    /**\n+     * Can be overridden to suppress logs in tests\n+     */\n+    public void log(Level level, String msg, Exception e) {\n+        LOG.log(level, msg, e);\n+    }\n \n     /*\n      * (non-Javadoc)",
                "raw_url": "https://github.com/apache/karaf/raw/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/main/java/org/apache/karaf/main/lock/DefaultJDBCLock.java",
                "sha": "1fe4fe95df2fda2c98326a064aceb60a500806c8",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/karaf/blob/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/test/java/org/apache/karaf/main/MainLockingTest.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/main/src/test/java/org/apache/karaf/main/MainLockingTest.java?ref=dee71a697036dfedcac7f3617f373ff06f7d5fbb",
                "deletions": 2,
                "filename": "main/src/test/java/org/apache/karaf/main/MainLockingTest.java",
                "patch": "@@ -63,8 +63,6 @@ public void testLostMasterLock() throws Exception {\n         \n         bundle.start();       \n         \n-        Thread.sleep(2000);\n-        \n         FrameworkStartLevel sl = framework.adapt(FrameworkStartLevel.class);\n         \n         MockLock lock = (MockLock) main.getLock();",
                "raw_url": "https://github.com/apache/karaf/raw/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/test/java/org/apache/karaf/main/MainLockingTest.java",
                "sha": "78d5a328b479da9c43516c5b58044370aa7d4ad2",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/karaf/blob/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/test/java/org/apache/karaf/main/TimeoutShutdownActivator.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/main/src/test/java/org/apache/karaf/main/TimeoutShutdownActivator.java?ref=dee71a697036dfedcac7f3617f373ff06f7d5fbb",
                "deletions": 1,
                "filename": "main/src/test/java/org/apache/karaf/main/TimeoutShutdownActivator.java",
                "patch": "@@ -23,7 +23,7 @@\n \n public class TimeoutShutdownActivator implements BundleActivator {\n \n-    public static int TIMEOUT = 10000;\n+    public static int TIMEOUT = 1000;\n \n     public void start(BundleContext context) throws Exception {\n         System.err.println(\"Starting timeout activator\");",
                "raw_url": "https://github.com/apache/karaf/raw/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/test/java/org/apache/karaf/main/TimeoutShutdownActivator.java",
                "sha": "cd063dcb0d9a8acc3270937e71678d74d7938b99",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/karaf/blob/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/test/java/org/apache/karaf/main/lock/BaseJDBCLockTest.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/main/src/test/java/org/apache/karaf/main/lock/BaseJDBCLockTest.java?ref=dee71a697036dfedcac7f3617f373ff06f7d5fbb",
                "deletions": 3,
                "filename": "main/src/test/java/org/apache/karaf/main/lock/BaseJDBCLockTest.java",
                "patch": "@@ -68,7 +68,7 @@ public static void setUpTestSuite() {\n     \n     @Before\n     public void setUp() throws Exception {\n-        connection = EasyMock.createMock(Connection.class);\n+        connection = EasyMock.createNiceMock(Connection.class);\n         metaData = EasyMock.createMock(DatabaseMetaData.class);\n         resultSet = EasyMock.createMock(ResultSet.class);\n         preparedStatement = EasyMock.createMock(PreparedStatement.class);\n@@ -88,12 +88,13 @@ public void setUp() throws Exception {\n     public void initShouldCreateTheSchemaIfItNotExists() throws Exception {\n         expect(connection.isClosed()).andReturn(false);\n         connection.setAutoCommit(false);\n-        expect(connection.getMetaData()).andReturn(metaData);\n+        expect(connection.getMetaData()).andReturn(metaData).anyTimes();\n         expect(metaData.getTables((String) isNull(), (String) isNull(), anyString(), aryEq(new String[]{\"TABLE\"}))).andReturn(resultSet);\n         expect(metaData.getTables((String) isNull(), (String) isNull(), anyString(), aryEq(new String[]{\"TABLE\"}))).andReturn(resultSet);\n         expect(resultSet.next()).andReturn(false);\n         expect(resultSet.next()).andReturn(false);\n         resultSet.close();\n+        expectLastCall().atLeastOnce();\n         expect(connection.isClosed()).andReturn(false);\n         expect(connection.createStatement()).andReturn(statement);\n         expect(statement.execute(\"CREATE TABLE \" + tableName + \" (MOMENT \" + momentDatatype + \", NODE \" + nodeDatatype + \")\" + createTableStmtSuffix)).andReturn(false);\n@@ -115,7 +116,7 @@ public void initShouldNotCreateTheSchemaIfItAlreadyExists() throws Exception {\n         expect(metaData.getTables((String) isNull(), (String) isNull(), anyString(), aryEq(new String[]{\"TABLE\"}))).andReturn(resultSet);\n         expect(resultSet.next()).andReturn(true);\n         resultSet.close();\n-        \n+        expectLastCall().atLeastOnce();\n         replay(connection, metaData, statement, preparedStatement, resultSet);\n         \n         lock = createLock(props);",
                "raw_url": "https://github.com/apache/karaf/raw/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/test/java/org/apache/karaf/main/lock/BaseJDBCLockTest.java",
                "sha": "d4d697e4e75002dd9518f14a61c0db5ed8431c8c",
                "status": "modified"
            },
            {
                "additions": 14,
                "blob_url": "https://github.com/apache/karaf/blob/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/test/java/org/apache/karaf/main/lock/DefaultJDBCLockTest.java",
                "changes": 15,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/main/src/test/java/org/apache/karaf/main/lock/DefaultJDBCLockTest.java?ref=dee71a697036dfedcac7f3617f373ff06f7d5fbb",
                "deletions": 1,
                "filename": "main/src/test/java/org/apache/karaf/main/lock/DefaultJDBCLockTest.java",
                "patch": "@@ -21,6 +21,9 @@\n import static org.junit.Assert.assertEquals;\n \n import java.sql.Connection;\n+import java.sql.SQLException;\n+import java.util.logging.Level;\n+\n import org.apache.felix.utils.properties.Properties;\n \n import org.junit.Before;\n@@ -54,14 +57,24 @@ Connection doCreateConnection(String driver, String url, String username, String\n             long getCurrentTimeMillis() {\n                 return 1;\n             }\n+            \n+            @Override\n+            public void log(Level level, String msg, Exception e) {\n+                // Suppress log\n+            }\n         };\n     }\n     \n     @Test\n-    public void createConnectionShouldConcatinateOptionsCorrect() {\n+    public void createConnectionShouldConcatinateOptionsCorrect() throws SQLException {\n         props.put(\"karaf.lock.jdbc.url\", this.url + \";dataEncryption=false\");\n         \n         lock = new DefaultJDBCLock(props) {\n+            @Override\n+            boolean schemaExists() {\n+                return true;\n+            }\n+\n             @Override\n             Connection doCreateConnection(String driver, String url, String username, String password) {\n                 assertEquals(this.driver, driver);",
                "raw_url": "https://github.com/apache/karaf/raw/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/test/java/org/apache/karaf/main/lock/DefaultJDBCLockTest.java",
                "sha": "951c45825048f30938e4c811aea2040b4423c2b3",
                "status": "modified"
            },
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/karaf/blob/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/test/java/org/apache/karaf/main/lock/DerbyJDBCLockTest.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/main/src/test/java/org/apache/karaf/main/lock/DerbyJDBCLockTest.java?ref=dee71a697036dfedcac7f3617f373ff06f7d5fbb",
                "deletions": 0,
                "filename": "main/src/test/java/org/apache/karaf/main/lock/DerbyJDBCLockTest.java",
                "patch": "@@ -21,6 +21,8 @@\n import static org.junit.Assert.assertEquals;\n \n import java.sql.Connection;\n+import java.util.logging.Level;\n+\n import org.apache.felix.utils.properties.Properties;\n \n import org.junit.Before;\n@@ -54,6 +56,11 @@ Connection doCreateConnection(String driver, String url, String username, String\n             long getCurrentTimeMillis() {\n                 return 1;\n             }\n+            \n+            @Override\n+            public void log(Level level, String msg, Exception e) {\n+                // Suppress log\n+            }\n         };\n     }\n     \n@@ -62,6 +69,11 @@ public void createConnectionShouldConcatinateOptionsCorrect() {\n         props.put(\"karaf.lock.jdbc.url\", this.url + \";dataEncryption=false\");\n         \n         lock = new DerbyJDBCLock(props) {\n+            @Override\n+            boolean schemaExists() {\n+                return true;\n+            }\n+            \n             @Override\n             Connection doCreateConnection(String driver, String url, String username, String password) {\n                 assertEquals(this.driver, driver);",
                "raw_url": "https://github.com/apache/karaf/raw/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/test/java/org/apache/karaf/main/lock/DerbyJDBCLockTest.java",
                "sha": "fd96dcce26657a8e45185f81441a032d5c64db87",
                "status": "modified"
            },
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/karaf/blob/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/test/java/org/apache/karaf/main/lock/MySQLJDBCLockTest.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/main/src/test/java/org/apache/karaf/main/lock/MySQLJDBCLockTest.java?ref=dee71a697036dfedcac7f3617f373ff06f7d5fbb",
                "deletions": 0,
                "filename": "main/src/test/java/org/apache/karaf/main/lock/MySQLJDBCLockTest.java",
                "patch": "@@ -21,6 +21,8 @@\n import static org.junit.Assert.assertEquals;\n \n import java.sql.Connection;\n+import java.util.logging.Level;\n+\n import org.apache.felix.utils.properties.Properties;\n \n import org.junit.Before;\n@@ -54,6 +56,11 @@ Connection doCreateConnection(String driver, String url, String username, String\n             long getCurrentTimeMillis() {\n                 return 1;\n             }\n+            \n+            @Override\n+            public void log(Level level, String msg, Exception e) {\n+                // Suppress log\n+            }\n         };\n     }\n     \n@@ -62,6 +69,11 @@ public void createConnectionShouldConcatinateOptionsCorrect() {\n         props.put(\"karaf.lock.jdbc.url\", this.url + \"?connectTimeout=10000\");\n         \n         lock = new MySQLJDBCLock(props) {\n+            @Override\n+            boolean schemaExists() {\n+                return true;\n+            }\n+            \n             @Override\n             Connection doCreateConnection(String driver, String url, String username, String password) {\n                 assertEquals(this.driver, driver);",
                "raw_url": "https://github.com/apache/karaf/raw/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/test/java/org/apache/karaf/main/lock/MySQLJDBCLockTest.java",
                "sha": "f9daad1a8830000a55bec4d20df5bf1a3395a7c0",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/karaf/blob/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/test/java/org/apache/karaf/main/lock/OracleJDBCLockTest.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/main/src/test/java/org/apache/karaf/main/lock/OracleJDBCLockTest.java?ref=dee71a697036dfedcac7f3617f373ff06f7d5fbb",
                "deletions": 0,
                "filename": "main/src/test/java/org/apache/karaf/main/lock/OracleJDBCLockTest.java",
                "patch": "@@ -26,6 +26,8 @@\n \n import java.sql.Connection;\n import java.sql.SQLException;\n+import java.util.logging.Level;\n+\n import org.apache.felix.utils.properties.Properties;\n \n import org.junit.Before;\n@@ -60,6 +62,11 @@ Connection doCreateConnection(String driver, String url, String username, String\n             long getCurrentTimeMillis() {\n                 return 1;\n             }\n+            \n+            @Override\n+            public void log(Level level, String msg, Exception e) {\n+                // Suppress log\n+            }\n         };\n     }\n     ",
                "raw_url": "https://github.com/apache/karaf/raw/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/test/java/org/apache/karaf/main/lock/OracleJDBCLockTest.java",
                "sha": "120946456c892ae53b788aaffd5c932a0ff40713",
                "status": "modified"
            },
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/karaf/blob/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/test/java/org/apache/karaf/main/lock/PostgreSQLJDBCLockTest.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/main/src/test/java/org/apache/karaf/main/lock/PostgreSQLJDBCLockTest.java?ref=dee71a697036dfedcac7f3617f373ff06f7d5fbb",
                "deletions": 0,
                "filename": "main/src/test/java/org/apache/karaf/main/lock/PostgreSQLJDBCLockTest.java",
                "patch": "@@ -23,6 +23,8 @@\n \n import java.sql.Connection;\n import java.sql.SQLException;\n+import java.util.logging.Level;\n+\n import org.apache.felix.utils.properties.Properties;\n \n import static org.easymock.EasyMock.*;\n@@ -58,6 +60,11 @@ Connection doCreateConnection(String driver, String url, String username, String\n             long getCurrentTimeMillis() {\n                 return 1;\n             }\n+            \n+            @Override\n+            public void log(Level level, String msg, Exception e) {\n+                // Suppress log\n+            }\n         };\n     }\n     \n@@ -66,6 +73,11 @@ public void createConnectionShouldConcatinateOptionsCorrect() {\n         props.put(\"karaf.lock.jdbc.url\", this.url + \";dataEncryption=false\");\n         \n         lock = new PostgreSQLJDBCLock(props) {\n+            @Override\n+            boolean schemaExists() {\n+                return true;\n+            }\n+            \n             @Override\n             Connection doCreateConnection(String driver, String url, String username, String password) {\n                 assertEquals(this.driver, driver);",
                "raw_url": "https://github.com/apache/karaf/raw/dee71a697036dfedcac7f3617f373ff06f7d5fbb/main/src/test/java/org/apache/karaf/main/lock/PostgreSQLJDBCLockTest.java",
                "sha": "079c7f13d69289dd1870667c87913d33b8775d14",
                "status": "modified"
            }
        ],
        "message": "[KARAF-4597] Avoid npe and exception logging in main module tests",
        "parent": "https://github.com/apache/karaf/commit/0f3b48bba87cc5293f634df6b1dfc5fe3f161e96",
        "patched_files": [
            "InstanceHelper.java",
            "DefaultJDBCLock.java",
            "OracleJDBCLock.java",
            "PostgreSQLJDBCLock.java",
            "MySQLJDBCLock.java",
            "DerbyJDBCLock.java",
            "TimeoutShutdownActivator.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "MySQLJDBCLockTest.java",
            "MainLockingTest.java",
            "DerbyJDBCLockTest.java",
            "OracleJDBCLockTest.java",
            "DefaultJDBCLockTest.java",
            "BaseJDBCLockTest.java",
            "PostgreSQLJDBCLockTest.java"
        ]
    },
    "karaf_e192fff": {
        "bug_id": "karaf_e192fff",
        "commit": "https://github.com/apache/karaf/commit/e192fffc3f8a0ae894e78cd37b0a1387075756e5",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/karaf/blob/e192fffc3f8a0ae894e78cd37b0a1387075756e5/features/core/src/main/java/org/apache/karaf/features/internal/service/FeatureConfigInstaller.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/src/main/java/org/apache/karaf/features/internal/service/FeatureConfigInstaller.java?ref=e192fffc3f8a0ae894e78cd37b0a1387075756e5",
                "deletions": 1,
                "filename": "features/core/src/main/java/org/apache/karaf/features/internal/service/FeatureConfigInstaller.java",
                "patch": "@@ -112,7 +112,7 @@ public void installFeatureConfigs(Feature feature) throws IOException, InvalidSy\n             if (cfg == null) {\n             \t\n             \tFile cfgFile = null;\n-            \t if (storage != null && configCfgStore) {\n+            \t if (storage != null) {\n             \t\t cfgFile = new File(storage, cid.fullPid + \".cfg\");\n             \t }\n             \t if (!cfgFile.exists()) {",
                "raw_url": "https://github.com/apache/karaf/raw/e192fffc3f8a0ae894e78cd37b0a1387075756e5/features/core/src/main/java/org/apache/karaf/features/internal/service/FeatureConfigInstaller.java",
                "sha": "66ec66dc951529800f05812b0c6b59394290bae8",
                "status": "modified"
            }
        ],
        "message": "[KARAF-6160] Avoid NPE when configCfgStore=false in etc/org.apache.karaf.features.cfg",
        "parent": "https://github.com/apache/karaf/commit/386940d9f3ae59d153c9d4b4875fe52b0eb98212",
        "patched_files": [
            "FeatureConfigInstaller.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "FeatureConfigInstallerTest.java"
        ]
    },
    "karaf_e390a81": {
        "bug_id": "karaf_e390a81",
        "commit": "https://github.com/apache/karaf/commit/e390a81eaf89c408a2ba8c5c3671b82d99ae5fac",
        "file": [
            {
                "additions": 18,
                "blob_url": "https://github.com/apache/karaf/blob/e390a81eaf89c408a2ba8c5c3671b82d99ae5fac/client/src/main/java/org/apache/karaf/client/Main.java",
                "changes": 32,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/client/src/main/java/org/apache/karaf/client/Main.java?ref=e390a81eaf89c408a2ba8c5c3671b82d99ae5fac",
                "deletions": 14,
                "filename": "client/src/main/java/org/apache/karaf/client/Main.java",
                "patch": "@@ -77,31 +77,35 @@ public static void main(String[] args) throws Exception {\n         Terminal terminal = null;\n         int exitStatus = 0;\n         try {\n-            final Console console = System.console();\n             client = SshClient.setUpDefaultClient();\n             setupAgent(config.getUser(), config.getKeyFile(), client);\n-            client.setUserInteraction(new UserInteraction() {\n-                public void welcome(String banner) {\n-                    System.out.println(banner);\n-                }\n+            final Console console = System.console();\n+            if (console != null) {\n+                client.setUserInteraction(new UserInteraction() {\n+                    public void welcome(String banner) {\n+                        System.out.println(banner);\n+                    }\n \n-                public String[] interactive(String destination, String name, String instruction, String[] prompt, boolean[] echo) {\n-                    String[] answers = new String[prompt.length];\n-                    try {\n-                        for (int i = 0; i < prompt.length; i++) {\n-                            if (console != null) {\n+                    public String[] interactive(String destination, String name, String instruction, String[] prompt, boolean[] echo) {\n+                        String[] answers = new String[prompt.length];\n+                        try {\n+                            for (int i = 0; i < prompt.length; i++) {\n                                 if (echo[i]) {\n                                     answers[i] = console.readLine(prompt[i] + \" \");\n                                 } else {\n                                     answers[i] = new String(console.readPassword(prompt[i] + \" \"));\n                                 }\n+                                if (answers[i] == null) {\n+                                    return null;\n+                                }\n                             }\n+                            return answers;\n+                        } catch (IOError e) {\n+                            return null;\n                         }\n-                    } catch (IOError e) {\n                     }\n-                    return answers;\n-                }\n-            });\n+                });\n+            }\n             client.start();\n             if (console != null) {\n                 console.printf(\"Logging in as %s\\n\", config.getUser());",
                "raw_url": "https://github.com/apache/karaf/raw/e390a81eaf89c408a2ba8c5c3671b82d99ae5fac/client/src/main/java/org/apache/karaf/client/Main.java",
                "sha": "65bcedf83ae6cd5bf9fe4fe01ed16aa96f549899",
                "status": "modified"
            }
        ],
        "message": "[kARAF-3651] The karaf client can cause a NPE in org.apache.sshd.common.util.Buffer.putString(Buffer.java:434)",
        "parent": "https://github.com/apache/karaf/commit/762bae6e85932bfc059a32bbb4aa98894cb3f366",
        "patched_files": [
            "Main.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "MainTest.java"
        ]
    },
    "karaf_e8fd84c": {
        "bug_id": "karaf_e8fd84c",
        "commit": "https://github.com/apache/karaf/commit/e8fd84c993fe208d2666cb71ff0495724927cdcf",
        "file": [
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/karaf/blob/e8fd84c993fe208d2666cb71ff0495724927cdcf/features/core/src/main/java/org/apache/karaf/features/internal/osgi/Activator.java",
                "changes": 23,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/src/main/java/org/apache/karaf/features/internal/osgi/Activator.java?ref=e8fd84c993fe208d2666cb71ff0495724927cdcf",
                "deletions": 11,
                "filename": "features/core/src/main/java/org/apache/karaf/features/internal/osgi/Activator.java",
                "patch": "@@ -123,16 +123,16 @@ protected void doStart() throws Exception {\n         }\n \n         // RegionDigraph\n-        digraph = DigraphHelper.loadDigraph(bundleContext);\n-        register(ResolverHookFactory.class, digraph.getResolverHookFactory());\n-        register(CollisionHook.class, CollisionHookHelper.getCollisionHook(digraph));\n-        register(org.osgi.framework.hooks.bundle.FindHook.class, digraph.getBundleFindHook());\n-        register(org.osgi.framework.hooks.bundle.EventHook.class, digraph.getBundleEventHook());\n-        register(org.osgi.framework.hooks.service.FindHook.class, digraph.getServiceFindHook());\n-        register(org.osgi.framework.hooks.service.EventHook.class, digraph.getServiceEventHook());\n-        register(RegionDigraph.class, digraph);\n-        digraphMBean = new StandardManageableRegionDigraph(digraph, \"org.apache.karaf\", bundleContext);\n-        digraphMBean.registerMBean();\n+        StandardRegionDigraph dg = digraph = DigraphHelper.loadDigraph(bundleContext);\n+        register(ResolverHookFactory.class, dg.getResolverHookFactory());\n+        register(CollisionHook.class, CollisionHookHelper.getCollisionHook(dg));\n+        register(org.osgi.framework.hooks.bundle.FindHook.class, dg.getBundleFindHook());\n+        register(org.osgi.framework.hooks.bundle.EventHook.class, dg.getBundleEventHook());\n+        register(org.osgi.framework.hooks.service.FindHook.class, dg.getServiceFindHook());\n+        register(org.osgi.framework.hooks.service.EventHook.class, dg.getServiceEventHook());\n+        register(RegionDigraph.class, dg);\n+        StandardManageableRegionDigraph dgmb = digraphMBean = new StandardManageableRegionDigraph(dg, \"org.apache.karaf\", bundleContext);\n+        dgmb.registerMBean();\n \n \n         FeatureFinder featureFinder = new FeatureFinder();\n@@ -204,13 +204,14 @@ protected OutputStream getOutputStream() throws IOException {\n         }\n         featuresService = new FeaturesServiceImpl(\n                 bundleContext.getBundle(),\n+                bundleContext,\n                 bundleContext.getBundle(0).getBundleContext(),\n                 stateStorage,\n                 featureFinder,\n                 eventAdminListener,\n                 configurationAdmin,\n                 resolver,\n-                digraph,\n+                dg,\n                 overrides,\n                 featureResolutionRange,\n                 bundleUpdateRange,",
                "raw_url": "https://github.com/apache/karaf/raw/e8fd84c993fe208d2666cb71ff0495724927cdcf/features/core/src/main/java/org/apache/karaf/features/internal/osgi/Activator.java",
                "sha": "f89dc70a987ae50f5f9b6170718775d2580530e9",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/karaf/blob/e8fd84c993fe208d2666cb71ff0495724927cdcf/features/core/src/main/java/org/apache/karaf/features/internal/service/FeaturesServiceImpl.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/src/main/java/org/apache/karaf/features/internal/service/FeaturesServiceImpl.java?ref=e8fd84c993fe208d2666cb71ff0495724927cdcf",
                "deletions": 5,
                "filename": "features/core/src/main/java/org/apache/karaf/features/internal/service/FeaturesServiceImpl.java",
                "patch": "@@ -184,6 +184,7 @@\n     private Map<String, Map<String, Feature>> featureCache;\n \n     public FeaturesServiceImpl(Bundle bundle,\n+                               BundleContext bundleContext,\n                                BundleContext systemBundleContext,\n                                StateStorage storage,\n                                FeatureFinder featureFinder,\n@@ -202,6 +203,7 @@ public FeaturesServiceImpl(Bundle bundle,\n                                int scheduleMaxRun,\n                                String blacklisted) {\n         this.bundle = bundle;\n+        this.bundleContext = bundleContext;\n         this.systemBundleContext = systemBundleContext;\n         this.storage = storage;\n         this.featureFinder = featureFinder;\n@@ -227,6 +229,7 @@ public FeaturesServiceImpl(Bundle bundle,\n     }\n \n     public FeaturesServiceImpl(Bundle bundle,\n+                               BundleContext bundleContext,\n                                BundleContext systemBundleContext,\n                                StateStorage storage,\n                                FeatureFinder featureFinder,\n@@ -246,6 +249,7 @@ public FeaturesServiceImpl(Bundle bundle,\n                                String blacklisted,\n                                boolean configCfgStore) {\n         this.bundle = bundle;\n+        this.bundleContext = bundleContext;\n         this.systemBundleContext = systemBundleContext;\n         this.storage = storage;\n         this.featureFinder = featureFinder;\n@@ -279,10 +283,10 @@ public void stop() {\n \n     @SuppressWarnings({\"unchecked\", \"rawtypes\"})\n     private void checkResolve() {\n-        if (bundle == null) {\n+        if (bundleContext == null) {\n             return; // Most certainly in unit tests\n         }\n-        File resolveFile = bundle.getBundleContext().getDataFile(\"resolve\");\n+        File resolveFile = bundleContext.getDataFile(\"resolve\");\n         if (!resolveFile.exists()) {\n             return;\n         }\n@@ -311,7 +315,7 @@ private void checkResolve() {\n     }\n \n     private void writeResolve(Map<String, Set<String>> requestedFeatures, EnumSet<Option> options) throws IOException {\n-        File resolveFile = bundle.getBundleContext().getDataFile(\"resolve\");\n+        File resolveFile = bundleContext.getDataFile(\"resolve\");\n         Map<String, Object> request = new HashMap<>();\n         List<String> opts = new ArrayList<>();\n         for (Option opt : options) {\n@@ -350,8 +354,8 @@ protected void saveState() {\n                     state.bundleChecksums.clear();\n                 }\n                 storage.save(state);\n-                if (bundle != null) { // For tests, this should never happen at runtime\n-                    DigraphHelper.saveDigraph(bundle.getBundleContext(), digraph);\n+                if (bundleContext != null) { // For tests, this should never happen at runtime\n+                    DigraphHelper.saveDigraph(bundleContext, digraph);\n                 }\n             }\n         } catch (IOException e) {",
                "raw_url": "https://github.com/apache/karaf/raw/e8fd84c993fe208d2666cb71ff0495724927cdcf/features/core/src/main/java/org/apache/karaf/features/internal/service/FeaturesServiceImpl.java",
                "sha": "7ade50ced4b31c2da20d9e24913f372190a3d157",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/karaf/blob/e8fd84c993fe208d2666cb71ff0495724927cdcf/features/core/src/test/java/org/apache/karaf/features/FeaturesServiceTest.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/src/test/java/org/apache/karaf/features/FeaturesServiceTest.java?ref=e8fd84c993fe208d2666cb71ff0495724927cdcf",
                "deletions": 4,
                "filename": "features/core/src/test/java/org/apache/karaf/features/FeaturesServiceTest.java",
                "patch": "@@ -349,7 +349,7 @@ public void testGetFeaturesShouldHandleDifferentVersionPatterns() throws Excepti\n                 + \"  <feature name='f2' version='0.2'><bundle>bundle2</bundle></feature>\"\n                 + \"</features>\");\n \n-        FeaturesServiceImpl svc = new FeaturesServiceImpl(null, null, new Storage(), null, null, null, resolver, null, null, null, null, null, null, null, 0, 0, 0, null);\n+        FeaturesServiceImpl svc = new FeaturesServiceImpl(null, null, null, new Storage(), null, null, null, resolver, null, null, null, null, null, null, null, 0, 0, 0, null);\n         svc.addRepository(uri);\n \n         assertEquals(feature(\"f2\", \"0.2\"), svc.getFeatures(\"f2\", \"[0.1,0.3)\")[0]);\n@@ -375,7 +375,7 @@ public void testInstallBatchFeatureWithFailure() throws Exception {\n         expect(fsl.getStartLevel()).andReturn(100);\n         replay(bundleContext, bundle, fsl);\n \n-        FeaturesServiceImpl svc = new FeaturesServiceImpl(null, bundleContext, new Storage(), null, null, null, resolver, null, null, null, null, null, null, null, 0, 0, 0, null);\n+        FeaturesServiceImpl svc = new FeaturesServiceImpl(null, null, bundleContext, new Storage(), null, null, null, resolver, null, null, null, null, null, null, null, 0, 0, 0, null);\n         svc.addRepository(uri);\n         try {\n             List<String> features = new ArrayList<String>();\n@@ -400,7 +400,7 @@ public void testSchemaValidation() throws Exception {\n         URI uri = createTempRepo(\"<features name='test' xmlns='http://karaf.apache.org/xmlns/features/v1.0.0'>\"\n                 + \"  <featur><bundle>somebundle</bundle></featur></features>\");\n \n-        FeaturesServiceImpl svc = new FeaturesServiceImpl(null, null, new Storage(), null, null, null, resolver, null, null, null, null, null, null, null, 0, 0, 0, null);\n+        FeaturesServiceImpl svc = new FeaturesServiceImpl(null, null, null, new Storage(), null, null, null, resolver, null, null, null, null, null, null, null, 0, 0, 0, null);\n         try {\n             svc.addRepository(uri);\n             fail(\"exception expected\");\n@@ -418,7 +418,7 @@ public void testLoadOldFeatureFile() throws Exception {\n                 + \"  <feature name='f1'><bundle>file:bundle1</bundle><bundle>file:bundle2</bundle></feature>\"\n                 + \"</features>\");\n \n-        FeaturesServiceImpl svc = new FeaturesServiceImpl(null, null, new Storage(), null, null, null, resolver, null, null, null, null, null, null, null, 0, 0, 0, null);\n+        FeaturesServiceImpl svc = new FeaturesServiceImpl(null, null, null, new Storage(), null, null, null, resolver, null, null, null, null, null, null, null, 0, 0, 0, null);\n         svc.addRepository(uri);\n         Feature[] features = svc.getFeatures(\"f1\");\n         Assert.assertEquals(1, features.length);",
                "raw_url": "https://github.com/apache/karaf/raw/e8fd84c993fe208d2666cb71ff0495724927cdcf/features/core/src/test/java/org/apache/karaf/features/FeaturesServiceTest.java",
                "sha": "40ce48362da98c099007356c18c6b20c47727109",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/karaf/blob/e8fd84c993fe208d2666cb71ff0495724927cdcf/features/core/src/test/java/org/apache/karaf/features/internal/service/FeaturesServiceImplTest.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/src/test/java/org/apache/karaf/features/internal/service/FeaturesServiceImplTest.java?ref=e8fd84c993fe208d2666cb71ff0495724927cdcf",
                "deletions": 4,
                "filename": "features/core/src/test/java/org/apache/karaf/features/internal/service/FeaturesServiceImplTest.java",
                "patch": "@@ -54,7 +54,7 @@ public void setUp() throws IOException {\n     public void testGetFeature() throws Exception {\n         Feature transactionFeature = feature(\"transaction\", \"1.0.0\");\n         final Map<String, Map<String, Feature>> features = features(transactionFeature);\n-        final FeaturesServiceImpl impl = new FeaturesServiceImpl(null, null, new Storage(), null, null, null, this.resolver, null, \"\", null, null, null, null, null, 0, 0, 0, null) {\n+        final FeaturesServiceImpl impl = new FeaturesServiceImpl(null, null, null, new Storage(), null, null, null, this.resolver, null, \"\", null, null, null, null, null, 0, 0, 0, null) {\n             protected Map<String,Map<String,Feature>> getFeatures() throws Exception {\n                 return features;\n             }\n@@ -65,7 +65,7 @@ public void testGetFeature() throws Exception {\n     \n     @Test\n     public void testGetFeatureStripVersion() throws Exception {\n-        final FeaturesServiceImpl impl = new FeaturesServiceImpl(null, null, new Storage(), null, null, null, this.resolver, null, \"\", null, null, null, null, null, 0, 0, 0, null) {\n+        final FeaturesServiceImpl impl = new FeaturesServiceImpl(null, null, null, new Storage(), null, null, null, this.resolver, null, \"\", null, null, null, null, null, 0, 0, 0, null) {\n             protected Map<String,Map<String,Feature>> getFeatures() throws Exception {\n                 return features(feature(\"transaction\", \"1.0.0\"));\n             }\n@@ -79,7 +79,7 @@ public void testGetFeatureStripVersion() throws Exception {\n     \n     @Test\n     public void testGetFeatureNotAvailable() throws Exception {\n-        final FeaturesServiceImpl impl = new FeaturesServiceImpl(null, null, new Storage(), null, null, null, this.resolver, null, \"\", null, null, null, null, null, 0, 0, 0, null) {\n+        final FeaturesServiceImpl impl = new FeaturesServiceImpl(null, null, null, new Storage(), null, null, null, this.resolver, null, \"\", null, null, null, null, null, 0, 0, 0, null) {\n             protected Map<String,Map<String,Feature>> getFeatures() throws Exception {\n                 return features(feature(\"transaction\", \"1.0.0\"));\n             }\n@@ -93,7 +93,7 @@ public void testGetFeatureHighestAvailable() throws Exception {\n                 feature(\"transaction\", \"1.0.0\"),\n                 feature(\"transaction\", \"2.0.0\")\n         );\n-        final FeaturesServiceImpl impl = new FeaturesServiceImpl(null, null, new Storage(), null, null, null, this.resolver, null, \"\", null, null, null, null, null, 0, 0, 0, null) {\n+        final FeaturesServiceImpl impl = new FeaturesServiceImpl(null, null, null, new Storage(), null, null, null, this.resolver, null, \"\", null, null, null, null, null, 0, 0, 0, null) {\n             protected Map<String,Map<String,Feature>> getFeatures() throws Exception {\n                 return features;\n             }",
                "raw_url": "https://github.com/apache/karaf/raw/e8fd84c993fe208d2666cb71ff0495724927cdcf/features/core/src/test/java/org/apache/karaf/features/internal/service/FeaturesServiceImplTest.java",
                "sha": "8e3cdfe3a5975c39561374794e0cd7a0ce4258dd",
                "status": "modified"
            },
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/karaf/blob/e8fd84c993fe208d2666cb71ff0495724927cdcf/util/src/main/java/org/apache/karaf/util/tracker/BaseActivator.java",
                "changes": 16,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/util/src/main/java/org/apache/karaf/util/tracker/BaseActivator.java?ref=e8fd84c993fe208d2666cb71ff0495724927cdcf",
                "deletions": 8,
                "filename": "util/src/main/java/org/apache/karaf/util/tracker/BaseActivator.java",
                "patch": "@@ -25,6 +25,8 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Properties;\n+import java.util.Queue;\n+import java.util.concurrent.ConcurrentLinkedQueue;\n import java.util.concurrent.ExecutorService;\n import java.util.concurrent.LinkedBlockingQueue;\n import java.util.concurrent.ThreadPoolExecutor;\n@@ -50,7 +52,7 @@\n \n     private long schedulerStopTimeout = TimeUnit.MILLISECONDS.convert(30, TimeUnit.SECONDS);\n \n-    private List<ServiceRegistration> registrations;\n+    private final Queue<ServiceRegistration> registrations = new ConcurrentLinkedQueue<>();\n     private Map<String, SingleServiceTracker> trackers = new HashMap<>();\n     private ServiceRegistration managedServiceRegistration;\n     private Dictionary<String, ?> configuration;\n@@ -120,11 +122,12 @@ protected void doStart() throws Exception {\n     }\n \n     protected void doStop() {\n-        if (registrations != null) {\n-            for (ServiceRegistration reg : registrations) {\n-                reg.unregister();\n+        while (true) {\n+            ServiceRegistration reg = registrations.poll();\n+            if (reg == null) {\n+                break;\n             }\n-            registrations = null;\n+            reg.unregister();\n         }\n     }\n \n@@ -357,9 +360,6 @@ protected void register(Class[] clazz, Object service, Dictionary<String, ?> pro\n     }\n \n     private void trackRegistration(ServiceRegistration registration) {\n-        if (registrations == null) {\n-            registrations = new ArrayList<>();\n-        }\n         registrations.add(registration);\n     }\n ",
                "raw_url": "https://github.com/apache/karaf/raw/e8fd84c993fe208d2666cb71ff0495724927cdcf/util/src/main/java/org/apache/karaf/util/tracker/BaseActivator.java",
                "sha": "b6e457d0f42c5a3e55b082961b5386bcb5f37ec7",
                "status": "modified"
            }
        ],
        "message": "KARAF-4652 - ConcurrentModificationException and NullPointerException when starting Karaf",
        "parent": "https://github.com/apache/karaf/commit/2de853be964b58ea1a7d56acd1c968a0516c923f",
        "patched_files": [
            "FeaturesServiceImpl.java",
            "Activator.java",
            "FeaturesService.java",
            "BaseActivator.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "FeaturesServiceImplTest.java",
            "FeaturesServiceTest.java",
            "ActivatorTest.java"
        ]
    },
    "karaf_ea78c61": {
        "bug_id": "karaf_ea78c61",
        "commit": "https://github.com/apache/karaf/commit/ea78c61ef44d60f2f7234157b11cce9e2ea9cdc6",
        "file": [
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/karaf/blob/ea78c61ef44d60f2f7234157b11cce9e2ea9cdc6/main/src/main/java/org/apache/karaf/main/Main.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/main/src/main/java/org/apache/karaf/main/Main.java?ref=ea78c61ef44d60f2f7234157b11cce9e2ea9cdc6",
                "deletions": 5,
                "filename": "main/src/main/java/org/apache/karaf/main/Main.java",
                "patch": "@@ -32,6 +32,7 @@\n import java.util.List;\n import java.util.Properties;\n import java.util.StringTokenizer;\n+import java.util.logging.Level;\n import java.util.logging.Logger;\n \n import org.apache.karaf.info.ServerInfo;\n@@ -167,10 +168,9 @@ public static void main(String[] args) throws Exception {\n             try {\n                 main.launch();\n             } catch (Throwable ex) {\n+                main.LOG.log(Level.SEVERE, \"Could not launch framework\", ex);\n                 main.destroy();\n                 main.setExitCode(-1);\n-                System.err.println(\"Could not create framework: \" + ex);\n-                ex.printStackTrace();\n             }\n             try {\n                 main.awaitShutdown();\n@@ -206,6 +206,8 @@ public void setShutdownCallback(ShutdownCallback shutdownCallback) {\n \n     public void launch() throws Exception {\n         config = new ConfigProperties();\n+        Lock lock = createLock();\n+        lockManager = new LockManager(lock, new KarafLockCallback(), config.lockDelay);\n         InstanceHelper.updateInstancePid(config.karafHome, config.karafBase);\n         BootstrapLogManager.setProperties(config.props);\n         LOG.addHandler(BootstrapLogManager.getDefaultHandler());\n@@ -235,8 +237,6 @@ public void launch() throws Exception {\n         activatorManager = new KarafActivatorManager(classLoader, framework);\n         activatorManager.startKarafActivators();\n         \n-        Lock lock = createLock();\n-        lockManager = new LockManager(lock, new KarafLockCallback(), config.lockDelay);\n         setStartLevel(config.lockStartLevel);\n         lockManager.startLockMonitor();\n     }\n@@ -441,7 +441,9 @@ public void run() {\n             }\n             return false;\n         } finally {\n-            lockManager.stopLockMonitor();\n+            if (lockManager != null) {\n+                lockManager.stopLockMonitor();\n+            }\n         }\n     }\n     ",
                "raw_url": "https://github.com/apache/karaf/raw/ea78c61ef44d60f2f7234157b11cce9e2ea9cdc6/main/src/main/java/org/apache/karaf/main/Main.java",
                "sha": "bea1e37e667d378eebfa80a5311cc29ed46315d0",
                "status": "modified"
            }
        ],
        "message": "KARAF-1296 Bugfix. Avoid NPE when there is an exception in launch and lockManager is not yet initialized\n\ngit-svn-id: https://svn.apache.org/repos/asf/karaf/trunk@1334999 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/karaf/commit/ca2286f899e1847672b61463882ffa6cce6fe89c",
        "patched_files": [
            "Main.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "MainTest.java"
        ]
    },
    "karaf_f1c1711": {
        "bug_id": "karaf_f1c1711",
        "commit": "https://github.com/apache/karaf/commit/f1c17118548c62c9f6b99555ba54abf1fd1d0dd9",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/karaf/blob/f1c17118548c62c9f6b99555ba54abf1fd1d0dd9/features/management/src/main/java/org/apache/karaf/features/management/internal/FeaturesServiceMBeanImpl.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/management/src/main/java/org/apache/karaf/features/management/internal/FeaturesServiceMBeanImpl.java?ref=f1c17118548c62c9f6b99555ba54abf1fd1d0dd9",
                "deletions": 6,
                "filename": "features/management/src/main/java/org/apache/karaf/features/management/internal/FeaturesServiceMBeanImpl.java",
                "patch": "@@ -61,12 +61,7 @@\n     private FeaturesService featuresService;\n \n     public FeaturesServiceMBeanImpl() throws NotCompliantMBeanException {\n-        super(FeaturesServiceMBean.class, new NotificationBroadcasterSupport() {\n-            @Override\n-            public MBeanNotificationInfo[] getNotificationInfo() {\n-                return getBroadcastInfo();\n-            }\n-        });\n+        super(FeaturesServiceMBean.class);\n     }\n \n     public ObjectName preRegister(MBeanServer server, ObjectName name) throws Exception {\n@@ -175,6 +170,9 @@ public void repositoryEvent(RepositoryEvent event) {\n         };\n     }\n \n+    public MBeanNotificationInfo[] getNotificationInfo() {\n+        return getBroadcastInfo();\n+    }\n \n     private static MBeanNotificationInfo[] getBroadcastInfo() {\n         String type = Notification.class.getCanonicalName();",
                "raw_url": "https://github.com/apache/karaf/raw/f1c17118548c62c9f6b99555ba54abf1fd1d0dd9/features/management/src/main/java/org/apache/karaf/features/management/internal/FeaturesServiceMBeanImpl.java",
                "sha": "487b4b09f44a37959e38d293501fed037d09f56d",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/karaf/blob/f1c17118548c62c9f6b99555ba54abf1fd1d0dd9/features/management/src/main/java/org/apache/karaf/features/management/internal/StandardEmitterMBean.java",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/management/src/main/java/org/apache/karaf/features/management/internal/StandardEmitterMBean.java?ref=f1c17118548c62c9f6b99555ba54abf1fd1d0dd9",
                "deletions": 4,
                "filename": "features/management/src/main/java/org/apache/karaf/features/management/internal/StandardEmitterMBean.java",
                "patch": "@@ -17,11 +17,16 @@\n \n public class StandardEmitterMBean extends StandardMBean implements NotificationEmitter {\n \n-    private NotificationBroadcasterSupport emitter;\n+    private final NotificationBroadcasterSupport emitter;\n \n-    public StandardEmitterMBean(Class mbeanInterface, NotificationBroadcasterSupport emitter) throws NotCompliantMBeanException {\n+    public StandardEmitterMBean(Class mbeanInterface) throws NotCompliantMBeanException {\n         super(mbeanInterface);\n-        this.emitter = emitter;\n+        this.emitter = new NotificationBroadcasterSupport() {\n+            @Override\n+            public MBeanNotificationInfo[] getNotificationInfo() {\n+                return StandardEmitterMBean.this.getNotificationInfo();\n+            }\n+        };\n     }\n \n     public void sendNotification(Notification notification) {\n@@ -42,7 +47,7 @@ public void removeNotificationListener(NotificationListener listener) throws Lis\n     }\n \n     public MBeanNotificationInfo[] getNotificationInfo() {\n-        return emitter.getNotificationInfo();\n+        return new MBeanNotificationInfo[0];\n     }\n \n     @Override",
                "raw_url": "https://github.com/apache/karaf/raw/f1c17118548c62c9f6b99555ba54abf1fd1d0dd9/features/management/src/main/java/org/apache/karaf/features/management/internal/StandardEmitterMBean.java",
                "sha": "58f587c6f4d5ddbc90603492d1365c4beaea85e1",
                "status": "modified"
            },
            {
                "additions": 24,
                "blob_url": "https://github.com/apache/karaf/blob/f1c17118548c62c9f6b99555ba54abf1fd1d0dd9/features/management/src/test/java/org/apache/karaf/features/management/internal/FeaturesServiceMBeanImplTest.java",
                "changes": 24,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/management/src/test/java/org/apache/karaf/features/management/internal/FeaturesServiceMBeanImplTest.java?ref=f1c17118548c62c9f6b99555ba54abf1fd1d0dd9",
                "deletions": 0,
                "filename": "features/management/src/test/java/org/apache/karaf/features/management/internal/FeaturesServiceMBeanImplTest.java",
                "patch": "@@ -0,0 +1,24 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package org.apache.karaf.features.management.internal;\n+\n+import org.junit.Test;\n+\n+public class FeaturesServiceMBeanImplTest {\n+\n+    @Test\n+    public void testInstantiation() throws Exception {\n+        new FeaturesServiceMBeanImpl();\n+    }\n+}",
                "raw_url": "https://github.com/apache/karaf/raw/f1c17118548c62c9f6b99555ba54abf1fd1d0dd9/features/management/src/test/java/org/apache/karaf/features/management/internal/FeaturesServiceMBeanImplTest.java",
                "sha": "0a8a00e992544108fc2f9c43755e2a9225d9e355",
                "status": "added"
            }
        ],
        "message": "KARAF-65: NPE in StandardEmitterMBean on JDK 6\n\ngit-svn-id: https://svn.apache.org/repos/asf/karaf/trunk@958959 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/karaf/commit/cc9e07d28f6d2af79a1ba5176fdc53de311db413",
        "patched_files": [
            "StandardEmitterMBean.java",
            "FeaturesServiceMBeanImpl.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "FeaturesServiceMBeanImplTest.java"
        ]
    },
    "karaf_f734dfc": {
        "bug_id": "karaf_f734dfc",
        "commit": "https://github.com/apache/karaf/commit/f734dfc42fb705d91a3df0a2e1f3ee2a5047c856",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/karaf/blob/f734dfc42fb705d91a3df0a2e1f3ee2a5047c856/features/core/src/main/java/org/apache/karaf/features/internal/osgi/Activator.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/karaf/contents/features/core/src/main/java/org/apache/karaf/features/internal/osgi/Activator.java?ref=f734dfc42fb705d91a3df0a2e1f3ee2a5047c856",
                "deletions": 2,
                "filename": "features/core/src/main/java/org/apache/karaf/features/internal/osgi/Activator.java",
                "patch": "@@ -303,8 +303,12 @@ public void modifiedService(ServiceReference<FeaturesListener> reference, Featur\n     \n                     @Override\n                     public void removedService(ServiceReference<FeaturesListener> reference, FeaturesListener service) {\n-                        featuresService.unregisterListener(service);\n-                        bundleContext.ungetService(reference);\n+                        if (featuresService != null && service != null) {\n+                            featuresService.unregisterListener(service);\n+                        }\n+                        if (bundleContext != null && reference != null) {\n+                            bundleContext.ungetService(reference);\n+                        }\n                     }\n                 }\n         );",
                "raw_url": "https://github.com/apache/karaf/raw/f734dfc42fb705d91a3df0a2e1f3ee2a5047c856/features/core/src/main/java/org/apache/karaf/features/internal/osgi/Activator.java",
                "sha": "28226e6d359257472af188d24f562a4408c58c67",
                "status": "modified"
            }
        ],
        "message": "[KARAF-6329] Prevent NPE on shutdown in features service",
        "parent": "https://github.com/apache/karaf/commit/c5cd8e5522b5f64c267fe8d10b4e0c1a181b6c64",
        "patched_files": [
            "Activator.java"
        ],
        "repo": "karaf",
        "unit_tests": [
            "ActivatorTest.java"
        ]
    }
}