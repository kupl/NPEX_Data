{
    "velocity-tools_0f94aa6": {
        "bug_id": "velocity-tools_0f94aa6",
        "commit": "https://github.com/apache/velocity-tools/commit/0f94aa6f73d4c83ffde98a9b12628e85d2541b83",
        "file": [
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/velocity-tools/blob/0f94aa6f73d4c83ffde98a9b12628e85d2541b83/velocity-tools-generic/src/main/java/org/apache/velocity/tools/generic/XmlTool.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/velocity-tools/contents/velocity-tools-generic/src/main/java/org/apache/velocity/tools/generic/XmlTool.java?ref=0f94aa6f73d4c83ffde98a9b12628e85d2541b83",
                "deletions": 2,
                "filename": "velocity-tools-generic/src/main/java/org/apache/velocity/tools/generic/XmlTool.java",
                "patch": "@@ -468,6 +468,10 @@ public XmlTool getFirst()\n         {\n             return this;\n         }\n+        else if (isEmpty())\n+        {\n+            return null;\n+        }\n         return new XmlTool(node());\n     }\n \n@@ -482,6 +486,10 @@ public XmlTool getLast()\n         {\n             return this;\n         }\n+        else if (isEmpty())\n+        {\n+            return null;\n+        }\n         return new XmlTool(nodes.get(size() - 1));\n     }\n \n@@ -493,7 +501,7 @@ public XmlTool getLast()\n      */\n     public XmlTool get(Number n)\n     {\n-        if (n == null)\n+        if (n == null || isEmpty())\n         {\n             return null;\n         }\n@@ -552,7 +560,7 @@ public XmlTool find(Object o)\n      */\n     public XmlTool find(String xpath)\n     {\n-        if (xpath == null || xpath.length() == 0)\n+        if (xpath == null || xpath.length() == 0 || isEmpty())\n         {\n             return null;\n         }",
                "raw_url": "https://github.com/apache/velocity-tools/raw/0f94aa6f73d4c83ffde98a9b12628e85d2541b83/velocity-tools-generic/src/main/java/org/apache/velocity/tools/generic/XmlTool.java",
                "sha": "0fd75e63ae47db2ff69c1567bad35c19a77bc830",
                "status": "modified"
            }
        ],
        "message": "[tools/generic] Add missing NPE protections\n\ngit-svn-id: https://svn.apache.org/repos/asf/velocity/tools/trunk@1854318 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/velocity-tools/commit/cf7d9668c8f5d46dc2b566e8f41ca26ec1483449",
        "patched_files": [
            "XmlTool.java"
        ],
        "repo": "velocity-tools",
        "unit_tests": [
            "XmlToolTests.java"
        ]
    },
    "velocity-tools_12231cc": {
        "bug_id": "velocity-tools_12231cc",
        "commit": "https://github.com/apache/velocity-tools/commit/12231ccb40aa1099cc9f2ca9b94660f32f0336c8",
        "file": [
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/velocity-tools/blob/12231ccb40aa1099cc9f2ca9b94660f32f0336c8/src/main/java/org/apache/velocity/tools/struts/StrutsUtils.java",
                "changes": 20,
                "contents_url": "https://api.github.com/repos/apache/velocity-tools/contents/src/main/java/org/apache/velocity/tools/struts/StrutsUtils.java?ref=12231ccb40aa1099cc9f2ca9b94660f32f0336c8",
                "deletions": 10,
                "filename": "src/main/java/org/apache/velocity/tools/struts/StrutsUtils.java",
                "patch": "@@ -413,18 +413,18 @@ public static String getForwardURL(HttpServletRequest request,\n         if(actionConfig != null)\n         {\n             fc = actionConfig.findForwardConfig(forward);\n+        }\n \n-            // No ActionConfig forward?\n-            // Find the ForwardConfig in the global-forwards.\n-            if(fc == null)\n-            {\n-                fc = moduleConfig.findForwardConfig(forward);\n+        // No ActionConfig forward?\n+        // Find the ForwardConfig in the global-forwards.\n+        if(fc == null)\n+        {\n+            fc = moduleConfig.findForwardConfig(forward);\n \n-                // ok, give up\n-                if (fc == null)\n-                {\n-                    return null;\n-                }\n+            // ok, give up\n+            if (fc == null)\n+            {\n+                return null;\n             }\n         }\n ",
                "raw_url": "https://github.com/apache/velocity-tools/raw/12231ccb40aa1099cc9f2ca9b94660f32f0336c8/src/main/java/org/apache/velocity/tools/struts/StrutsUtils.java",
                "sha": "d7b52cdad5ea12d4fa3aa2501690d5aac29facc1",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/velocity-tools/blob/12231ccb40aa1099cc9f2ca9b94660f32f0336c8/src/main/java/org/apache/velocity/tools/view/ContextTool.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/velocity-tools/contents/src/main/java/org/apache/velocity/tools/view/ContextTool.java?ref=12231ccb40aa1099cc9f2ca9b94660f32f0336c8",
                "deletions": 5,
                "filename": "src/main/java/org/apache/velocity/tools/view/ContextTool.java",
                "patch": "@@ -89,12 +89,12 @@ public void configure(Map params)\n         {\n             ValueParser parser = new ValueParser(params);\n             safeMode = parser.getBoolean(SAFE_MODE_KEY, true);\n-        }\n \n-        this.context = (ViewContext)params.get(ViewToolContext.CONTEXT_KEY);\n-        this.request = (HttpServletRequest)params.get(ViewContext.REQUEST);\n-        this.session = request.getSession(false);\n-        this.application = (ServletContext)params.get(ViewContext.SERVLET_CONTEXT_KEY);\n+            this.context = (ViewContext)params.get(ViewToolContext.CONTEXT_KEY);\n+            this.request = (HttpServletRequest)params.get(ViewContext.REQUEST);\n+            this.session = request.getSession(false);\n+            this.application = (ServletContext)params.get(ViewContext.SERVLET_CONTEXT_KEY);\n+        }\n     }\n \n ",
                "raw_url": "https://github.com/apache/velocity-tools/raw/12231ccb40aa1099cc9f2ca9b94660f32f0336c8/src/main/java/org/apache/velocity/tools/view/ContextTool.java",
                "sha": "8c966b272a87c5c5e01f158f0866aa0ee76457fa",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/velocity-tools/blob/12231ccb40aa1099cc9f2ca9b94660f32f0336c8/src/main/java/org/apache/velocity/tools/view/VelocityView.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/velocity-tools/contents/src/main/java/org/apache/velocity/tools/view/VelocityView.java?ref=12231ccb40aa1099cc9f2ca9b94660f32f0336c8",
                "deletions": 0,
                "filename": "src/main/java/org/apache/velocity/tools/view/VelocityView.java",
                "patch": "@@ -688,6 +688,10 @@ else if (path.endsWith(\".properties\"))\n             {\n                 throw new UnsupportedOperationException(msg);\n             }\n+            else\n+            {\n+                return null;\n+            }\n         }\n \n         // now, try to read the file",
                "raw_url": "https://github.com/apache/velocity-tools/raw/12231ccb40aa1099cc9f2ca9b94660f32f0336c8/src/main/java/org/apache/velocity/tools/view/VelocityView.java",
                "sha": "8db6a017e8eeae4c4de460bf703f6a0cb0032a95",
                "status": "modified"
            }
        ],
        "message": "fix NPEs found by FindBugs\n\ngit-svn-id: https://svn.apache.org/repos/asf/velocity/tools/branches/2.x@563977 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/velocity-tools/commit/e9874faa28b7cbda39450dc915000479ea54ab04",
        "patched_files": [
            "VelocityView.java"
        ],
        "repo": "velocity-tools",
        "unit_tests": [
            "VelocityViewTest.java"
        ]
    },
    "velocity-tools_cf730fa": {
        "bug_id": "velocity-tools_cf730fa",
        "commit": "https://github.com/apache/velocity-tools/commit/cf730fa5d038375418ae2e9f7dc0bc87e04d073d",
        "file": [
            {
                "additions": 140,
                "blob_url": "https://github.com/apache/velocity-tools/blob/cf730fa5d038375418ae2e9f7dc0bc87e04d073d/src/java/org/apache/velocity/tools/view/tools/LinkTool.java",
                "changes": 144,
                "contents_url": "https://api.github.com/repos/apache/velocity-tools/contents/src/java/org/apache/velocity/tools/view/tools/LinkTool.java?ref=cf730fa5d038375418ae2e9f7dc0bc87e04d073d",
                "deletions": 4,
                "filename": "src/java/org/apache/velocity/tools/view/tools/LinkTool.java",
                "patch": "@@ -33,6 +33,7 @@\n \n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n+import org.apache.velocity.tools.generic.ValueParser;\n import org.apache.velocity.tools.view.context.ViewContext;\n import org.apache.velocity.tools.view.servlet.ServletUtils;\n \n@@ -63,6 +64,18 @@\n {\n     protected static final Log LOG = LogFactory.getLog(LinkTool.class);\n \n+    /**\n+     * Parameter key for configuring {@link #setSelfAbsolute} state\n+     * @since VelocityTools 1.3\n+     */\n+    public static final String SELF_ABSOLUTE_KEY = \"self-absolute\";\n+\n+    /**\n+     * Parameter key for configuring {@link #setSelfIncludeParameters} state\n+     * @since VelocityTools 1.3\n+     */\n+    public static final String SELF_INCLUDE_PARAMETERS_KEY = \"self-include-parameters\";\n+\n     /** Standard HTML delimiter for query data ('&') */\n     public static final String HTML_QUERY_DELIMITER = \"&\";\n \n@@ -92,6 +105,12 @@\n     /** The current delimiter for query data */\n     private String queryDataDelim;\n \n+    /** The self-absolute status */\n+    private boolean selfAbsolute;\n+\n+    /** The self-include-parameters status */\n+    private boolean selfParams;\n+\n \n     /** Java 1.4 encode method to use instead of deprecated 1.3 version. */\n     private static Method encode = null;\n@@ -122,6 +141,8 @@ public LinkTool()\n         anchor = null;\n         queryData = null;\n         queryDataDelim = HTML_QUERY_DELIMITER;\n+        selfAbsolute = false;\n+        selfParams = false;\n     }\n \n \n@@ -145,6 +166,36 @@ protected void setXhtml(boolean useXhtml)\n             (useXhtml) ? XHTML_QUERY_DELIMITER : HTML_QUERY_DELIMITER;\n     }\n \n+    /**\n+     * <p>Controls whether or not the {@link #getSelf()} method will return\n+     *    a duplicate with a URI in absolute or relative form.</p>\n+     *\n+     * @param selfAbsolute if true, the {@link #getSelf()} method will return\n+     *        a duplicate of this tool with an absolute self-referencing URI;\n+     *        if false, a duplicate with a relative self-referencing URI will\n+     *        be returned\n+     * @see #getSelf()\n+     * @since VelocityTools 1.3\n+     */\n+    protected void setSelfAbsolute(boolean selfAbsolute)\n+    {\n+        this.selfAbsolute = selfAbsolute;\n+    }\n+\n+    /**\n+     * <p>Controls whether or not the {@link #getSelf()} method will return\n+     *    a duplicate that includes current request parameters.</p>\n+     *\n+     * @param selfParams if true, the {@link #getSelf()} method will return\n+     *        a duplicate of this tool that includes current request parameters\n+     * @see #getSelf()\n+     * @since VelocityTools 1.3\n+     */\n+    protected void setSelfIncludeParameters(boolean selfParams)\n+    {\n+        this.selfParams = selfParams;\n+    }\n+\n \n     /**\n      * For internal use.\n@@ -266,11 +317,36 @@ protected LinkTool duplicate()\n             copy.anchor = this.anchor;\n             copy.queryData = this.queryData;\n             copy.queryDataDelim = this.queryDataDelim;\n+            copy.selfAbsolute = this.selfAbsolute;\n+            copy.selfParams = this.selfParams;\n             return copy;\n         }\n     }\n \n \n+    // --------------------------------------- Toolbox Methods -------------\n+\n+    /**\n+     * Configures this tool\n+     *\n+     * @param params Map of configuration parameters\n+     * @since VelocityTools 1.3\n+     */\n+    public void configure(Map params)\n+    {\n+        ValueParser parser = new ValueParser(params);\n+        Boolean selfAbsolute = parser.getBoolean(SELF_ABSOLUTE_KEY);\n+        if (selfAbsolute != null)\n+        {\n+            setSelfAbsolute(selfAbsolute.booleanValue());\n+        }\n+        Boolean selfParams = parser.getBoolean(SELF_INCLUDE_PARAMETERS_KEY);\n+        if (selfParams != null)\n+        {\n+            setSelfIncludeParameters(selfParams.booleanValue());\n+        }\n+    }\n+\n     /**\n      * Initializes this tool.\n      *\n@@ -601,6 +677,21 @@ public String getContextPath()\n     }\n \n \n+    /**\n+     * <p>Retrieves the path for the current request regardless of\n+     * whether this is a direct request or an include by the\n+     * RequestDispatcher. Note! This will not\n+     * represent any URI reference or query data set for this\n+     * LinkTool.</p>\n+     *\n+     * @since VelocityTools 1.3\n+     */\n+    public String getRequestPath()\n+    {\n+        return ServletUtils.getPath(request);\n+    }\n+\n+\n     /**\n      * Returns the full URI of this template without any query data.\n      * e.g. <code>http://myserver.net/myapp/stuff/View.vm</code>\n@@ -613,11 +704,47 @@ public String getBaseRef()\n     {\n         StringBuffer out = new StringBuffer();\n         out.append(getContextURL());\n-        out.append(ServletUtils.getPath(request));\n+        out.append(getRequestPath());\n         return out.toString();\n     }\n \n \n+    /**\n+     * This method returns a new \"self-referencing\" LinkTool for the current\n+     * request. By default, this is merely a shortcut for calling\n+     * {@link #relative(String uri)} using the result of\n+     * {@link #getRequestPath()}.  However, this tool can be configured\n+     * to return an absolute URI and/or to include the parameters of the\n+     * current request (in addition to any others set so far).\n+     *\n+     * @see {@link #uri(String uri)}\n+     * @see {@link #configure(Map params)}\n+     * @see {@link #setSelfAbsolute(boolean selfAbsolute)}\n+     * @see {@link #setSelfIncludeParameters(boolean selfParams)}\n+     * @since VelocityTools 1.3\n+     */\n+    public LinkTool getSelf()\n+    {\n+        // first set the uri per configuration\n+        LinkTool dupe;\n+        if (this.selfAbsolute)\n+        {\n+            dupe = uri(getBaseRef());\n+        }\n+        else\n+        {\n+            dupe = relative(getRequestPath());\n+        }\n+\n+        // then add the params (if so configured)\n+        if (this.selfParams)\n+        {\n+            dupe.params(request.getParameterMap());\n+        }\n+        return dupe;\n+    }\n+\n+\n     /**\n      * Returns the full URI reference that's been built with this tool,\n      * including the query string and anchor, e.g.\n@@ -658,9 +785,18 @@ public String toString()\n             out.append(encodeURL(anchor));\n         }\n \n-        // encode session ID into URL if sessions are used but cookies are\n-        // not supported\n-        return response.encodeURL(out.toString());\n+        String str = out.toString();\n+        if (str.length() == 0)\n+        {\n+            // avoid a potential NPE from Tomcat's response.encodeURL impl\n+            return str;\n+        }\n+        else\n+        {\n+            // encode session ID into URL if sessions are used but cookies are\n+            // not supported\n+            return response.encodeURL(str);\n+        }\n     }\n \n ",
                "raw_url": "https://github.com/apache/velocity-tools/raw/cf730fa5d038375418ae2e9f7dc0bc87e04d073d/src/java/org/apache/velocity/tools/view/tools/LinkTool.java",
                "sha": "d1d226e6f657cbb57b77e277994a97facde3e8db",
                "status": "modified"
            }
        ],
        "message": "add getSelf() method and support for configuring default behavior of it, also fix NPE problem with toString() for default $link\n\ngit-svn-id: https://svn.apache.org/repos/asf/velocity/tools/trunk@483622 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/velocity-tools/commit/d4f327b3d27bd48accf039f954161fa7b1654da4",
        "patched_files": [
            "LinkTool.java"
        ],
        "repo": "velocity-tools",
        "unit_tests": [
            "LinkToolTests.java"
        ]
    }
}