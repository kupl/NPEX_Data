[
    {
        "commit": "https://github.com/apache/sling-org-apache-sling-servlets-post/commit/817987e9bc5b951ae615f4a841f2c26805225eef",
        "file": [
            {
                "patch": "@@ -40,9 +40,14 @@\n public class HtmlResponseProxy extends HtmlResponse {\n \n     private final PostResponse postResponse;\n+    private boolean createRequest;\n \n     public HtmlResponseProxy(final PostResponse postResponse) {\n+        if(postResponse == null) {\n+            throw new IllegalArgumentException(\"Null PostResponse, cannot build HtmlResponseProxy\");\n+        }\n         this.postResponse = postResponse;\n+        postResponse.setCreateRequest(createRequest);\n     }\n \n     public PostResponse getPostResponse() {\n@@ -129,7 +134,12 @@ public void send(HttpServletResponse response, boolean setStatus)\n     }\n \n     public void setCreateRequest(boolean isCreateRequest) {\n-        postResponse.setCreateRequest(isCreateRequest);\n+        createRequest = isCreateRequest;\n+        if(postResponse != null) {\n+            // ugly...needed because of SLING-2453, this is called\n+            // by the base class's constructor before postResponse is set\n+            postResponse.setCreateRequest(isCreateRequest);\n+        }\n     }\n \n     public void setError(Throwable error) {",
                "additions": 11,
                "raw_url": "https://github.com/apache/sling-org-apache-sling-servlets-post/raw/817987e9bc5b951ae615f4a841f2c26805225eef/src/main/java/org/apache/sling/servlets/post/impl/helper/HtmlResponseProxy.java",
                "status": "modified",
                "changes": 12,
                "deletions": 1,
                "sha": "492b9f00f3ce831e2f5326167b9c58086d523664",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-servlets-post/blob/817987e9bc5b951ae615f4a841f2c26805225eef/src/main/java/org/apache/sling/servlets/post/impl/helper/HtmlResponseProxy.java",
                "filename": "src/main/java/org/apache/sling/servlets/post/impl/helper/HtmlResponseProxy.java",
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-servlets-post/contents/src/main/java/org/apache/sling/servlets/post/impl/helper/HtmlResponseProxy.java?ref=817987e9bc5b951ae615f4a841f2c26805225eef"
            },
            {
                "patch": "@@ -0,0 +1,116 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.sling.servlets.post.impl.helper;\n+\n+import java.io.IOException;\n+\n+import javax.servlet.http.HttpServletResponse;\n+\n+import org.apache.sling.servlets.post.PostResponse;\n+import org.junit.Test;\n+\n+public class HtmlResponseProxyTest {\n+    \n+    @Test\n+    public void testConstructor() {\n+        new HtmlResponseProxy(POST_RESPONSE);\n+    }\n+    \n+    private static final PostResponse POST_RESPONSE = new PostResponse() {\n+        \n+        public void setTitle(String title) {\n+        }\n+        \n+        public void setStatus(int code, String message) {\n+        }\n+        \n+        public void setReferer(String referer) {\n+        }\n+        \n+        public void setPath(String path) {\n+        }\n+        \n+        public void setParentLocation(String parentLocation) {\n+        }\n+        \n+        public void setLocation(String location) {\n+        }\n+        \n+        public void setError(Throwable error) {\n+        }\n+        \n+        public void setCreateRequest(boolean isCreateRequest) {\n+        }\n+        \n+        public void send(HttpServletResponse response, boolean setStatus) throws IOException {\n+        }\n+        \n+        public void onMoved(String srcPath, String dstPath) {\n+        }\n+        \n+        public void onModified(String path) {\n+        }\n+        \n+        public void onDeleted(String path) {\n+        }\n+        \n+        public void onCreated(String path) {\n+        }\n+        \n+        public void onCopied(String srcPath, String dstPath) {\n+        }\n+        \n+        public void onChange(String type, String... arguments) {\n+        }\n+        \n+        public boolean isSuccessful() {\n+            return false;\n+        }\n+        \n+        public boolean isCreateRequest() {\n+            return false;\n+        }\n+        \n+        public String getStatusMessage() {\n+            return null;\n+        }\n+        \n+        public int getStatusCode() {\n+            return 0;\n+        }\n+        \n+        public String getReferer() {\n+            return null;\n+        }\n+        \n+        public String getPath() {\n+            return null;\n+        }\n+        \n+        public String getParentLocation() {\n+            return null;\n+        }\n+        \n+        public String getLocation() {\n+            return null;\n+        }\n+        \n+        public Throwable getError() {\n+            return null;\n+        }\n+    };\n+}",
                "additions": 116,
                "raw_url": "https://github.com/apache/sling-org-apache-sling-servlets-post/raw/817987e9bc5b951ae615f4a841f2c26805225eef/src/test/java/org/apache/sling/servlets/post/impl/helper/HtmlResponseProxyTest.java",
                "status": "added",
                "changes": 116,
                "deletions": 0,
                "sha": "2249e18168f7b2242bc48b887dd9a048c11786ed",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-servlets-post/blob/817987e9bc5b951ae615f4a841f2c26805225eef/src/test/java/org/apache/sling/servlets/post/impl/helper/HtmlResponseProxyTest.java",
                "filename": "src/test/java/org/apache/sling/servlets/post/impl/helper/HtmlResponseProxyTest.java",
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-servlets-post/contents/src/test/java/org/apache/sling/servlets/post/impl/helper/HtmlResponseProxyTest.java?ref=817987e9bc5b951ae615f4a841f2c26805225eef"
            }
        ],
        "bug_id": "sling-org-apache-sling-servlets-post_1",
        "parent": "https://github.com/apache/sling-org-apache-sling-servlets-post/commit/0d08eb073d4ad395858f2b8827abf0869bc62992",
        "message": "SLING-2453 - fix NPE in constructor\n\ngit-svn-id: https://svn.apache.org/repos/asf/sling/trunk@1308838 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "sling-org-apache-sling-servlets-post"
    },
    {
        "commit": "https://github.com/apache/sling-org-apache-sling-servlets-post/commit/7ceda6db0da9581bf1a691f4cd736dd90602625c",
        "file": [
            {
                "patch": "@@ -215,7 +215,7 @@ protected void doPost(SlingHttpServletRequest request,\n      HtmlResponse createHtmlResponse(SlingHttpServletRequest req) {\n         @SuppressWarnings({\"MismatchedQueryAndUpdateOfCollection\"})\n         MediaRangeList mediaRangeList = new MediaRangeList(req);\n-        if (mediaRangeList.prefer(\"text/html\", JSONResponse.RESPONSE_CONTENT_TYPE).equals(JSONResponse.RESPONSE_CONTENT_TYPE)) {\n+        if (JSONResponse.RESPONSE_CONTENT_TYPE.equals(mediaRangeList.prefer(\"text/html\", JSONResponse.RESPONSE_CONTENT_TYPE))) {\n             return new JSONResponse();\n         } else {\n             return new HtmlResponse();",
                "additions": 1,
                "raw_url": "https://github.com/apache/sling-org-apache-sling-servlets-post/raw/7ceda6db0da9581bf1a691f4cd736dd90602625c/src/main/java/org/apache/sling/servlets/post/impl/SlingPostServlet.java",
                "status": "modified",
                "changes": 2,
                "deletions": 1,
                "sha": "3ff104babe35c76779814c770a57231effcf2dff",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-servlets-post/blob/7ceda6db0da9581bf1a691f4cd736dd90602625c/src/main/java/org/apache/sling/servlets/post/impl/SlingPostServlet.java",
                "filename": "src/main/java/org/apache/sling/servlets/post/impl/SlingPostServlet.java",
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-servlets-post/contents/src/main/java/org/apache/sling/servlets/post/impl/SlingPostServlet.java?ref=7ceda6db0da9581bf1a691f4cd736dd90602625c"
            },
            {
                "patch": "@@ -145,7 +145,8 @@ public String prefer(String... mediaRanges) {\n         for (String mediaRange : mediaRanges) {\n             ranges.add(new MediaRange(mediaRange));\n         }\n-        return prefer(ranges).toString();\n+        final MediaRange preferred = prefer(ranges);\n+        return(preferred == null ? null : preferred.toString());\n     }\n \n     /**",
                "additions": 2,
                "raw_url": "https://github.com/apache/sling-org-apache-sling-servlets-post/raw/7ceda6db0da9581bf1a691f4cd736dd90602625c/src/main/java/org/apache/sling/servlets/post/impl/helper/MediaRangeList.java",
                "status": "modified",
                "changes": 3,
                "deletions": 1,
                "sha": "4e8ac6a27851291b95d4f4c450a0bf0c8e995569",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-servlets-post/blob/7ceda6db0da9581bf1a691f4cd736dd90602625c/src/main/java/org/apache/sling/servlets/post/impl/helper/MediaRangeList.java",
                "filename": "src/main/java/org/apache/sling/servlets/post/impl/helper/MediaRangeList.java",
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-servlets-post/contents/src/main/java/org/apache/sling/servlets/post/impl/helper/MediaRangeList.java?ref=7ceda6db0da9581bf1a691f4cd736dd90602625c"
            }
        ],
        "bug_id": "sling-org-apache-sling-servlets-post_2",
        "parent": "https://github.com/apache/sling-org-apache-sling-servlets-post/commit/ab9bb79e5fde0094f4fd2620b493c1d69f3e35ec",
        "message": "SLING-1336 - avoid NPE if no Accept header\n\ngit-svn-id: https://svn.apache.org/repos/asf/sling/trunk@921422 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "sling-org-apache-sling-servlets-post"
    },
    {
        "commit": "https://github.com/apache/sling-org-apache-sling-servlets-post/commit/ac27ffafbc42486636a1bce8491f2ced5fc85cd9",
        "file": [
            {
                "patch": "@@ -32,7 +32,6 @@\n import javax.jcr.Value;\n import javax.jcr.ValueFactory;\n import javax.jcr.nodetype.NodeType;\n-import javax.jcr.nodetype.NodeTypeIterator;\n import javax.jcr.nodetype.PropertyDefinition;\n \n import org.apache.sling.api.resource.ModifiableValueMap;\n@@ -281,9 +280,6 @@ private void setPropertyAsIs(final Modifiable parent, final RequestProperty prop\n                 }\n             }\n \n-            // TODO - we should check for session\n-            final ValueFactory valFac = parent.resource.getResourceResolver().adaptTo(Session.class).getValueFactory();\n-\n             final boolean multiValue = isMultiValue(parent, prop, values);\n             final int type = getType(parent, prop);\n \n@@ -292,13 +288,17 @@ private void setPropertyAsIs(final Modifiable parent, final RequestProperty prop\n                 removeIfSingleValueProperty(parent, prop);\n             }\n \n-            if (type == PropertyType.DATE) {\n-                if (storeAsDate(parent, prop.getName(), values, multiValue, valFac)) {\n-                    return;\n-                }\n-            } else if (isReferencePropertyType(type)) {\n-                if (storeAsReference(parent, prop.getName(), values, type, multiValue, valFac)) {\n-                    return;\n+            Session s = parent.resource.getResourceResolver().adaptTo(Session.class);\n+            if (s != null) {\n+                final ValueFactory valFac = s.getValueFactory();\n+                if (type == PropertyType.DATE) {\n+                    if (storeAsDate(parent, prop.getName(), values, multiValue, valFac)) {\n+                        return;\n+                    }\n+                } else if (isReferencePropertyType(type)) {\n+                    if (storeAsReference(parent, prop.getName(), values, type, multiValue, valFac)) {\n+                        return;\n+                    }\n                 }\n             }\n ",
                "additions": 11,
                "raw_url": "https://github.com/apache/sling-org-apache-sling-servlets-post/raw/ac27ffafbc42486636a1bce8491f2ced5fc85cd9/src/main/java/org/apache/sling/servlets/post/impl/helper/SlingPropertyValueHandler.java",
                "status": "modified",
                "changes": 22,
                "deletions": 11,
                "sha": "f36974bd5271b4951008883ebf231b64cc0f16d5",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-servlets-post/blob/ac27ffafbc42486636a1bce8491f2ced5fc85cd9/src/main/java/org/apache/sling/servlets/post/impl/helper/SlingPropertyValueHandler.java",
                "filename": "src/main/java/org/apache/sling/servlets/post/impl/helper/SlingPropertyValueHandler.java",
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-servlets-post/contents/src/main/java/org/apache/sling/servlets/post/impl/helper/SlingPropertyValueHandler.java?ref=ac27ffafbc42486636a1bce8491f2ced5fc85cd9"
            }
        ],
        "bug_id": "sling-org-apache-sling-servlets-post_3",
        "parent": "https://github.com/apache/sling-org-apache-sling-servlets-post/commit/cd3f7e93dbe58319cad452b7f142b5b77d0db1a4",
        "message": "SLING-4007 Prevent NPE if Session is not available. Also don't call any code which makes use\n   of the ValueFactory.\n\ngit-svn-id: https://svn.apache.org/repos/asf/sling/trunk@1629608 13f79535-47bb-0310-9956-ffa450edef68",
        "repo": "sling-org-apache-sling-servlets-post"
    }
]