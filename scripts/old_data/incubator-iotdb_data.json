[
    {
        "commit": "https://github.com/apache/incubator-iotdb/commit/20b42cd1af03b689d85bd2ba6c50a4cca1ebbdde",
        "repo": "incubator-iotdb",
        "parent": "https://github.com/apache/incubator-iotdb/commit/cd776ce2b5e8dc0a1cb5f3b00985e8a3ee9903e8",
        "message": "Merge pull request #693 from LeiRui/IOTDB-159\n\n[IOTDB-159] Fix NullPointerException in SeqTsFileRecoverTest and UnseqTsFileRecoverTest",
        "bug_id": "incubator-iotdb_1",
        "file": [
            {
                "sha": "cbfd1fa2aa0bf14f31d719a3d4d84f33b5d021f4",
                "filename": "server/src/test/java/org/apache/iotdb/db/writelog/recover/SeqTsFileRecoverTest.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/apache/incubator-iotdb/blob/20b42cd1af03b689d85bd2ba6c50a4cca1ebbdde/server/src/test/java/org/apache/iotdb/db/writelog/recover/SeqTsFileRecoverTest.java",
                "raw_url": "https://github.com/apache/incubator-iotdb/raw/20b42cd1af03b689d85bd2ba6c50a4cca1ebbdde/server/src/test/java/org/apache/iotdb/db/writelog/recover/SeqTsFileRecoverTest.java",
                "contents_url": "https://api.github.com/repos/apache/incubator-iotdb/contents/server/src/test/java/org/apache/iotdb/db/writelog/recover/SeqTsFileRecoverTest.java?ref=20b42cd1af03b689d85bd2ba6c50a4cca1ebbdde",
                "patch": "@@ -28,6 +28,7 @@\n import org.apache.commons.io.FileUtils;\n import org.apache.iotdb.db.conf.adapter.ActiveTimeSeriesCounter;\n import org.apache.iotdb.db.engine.fileSystem.SystemFileFactory;\n+import org.apache.iotdb.db.engine.flush.pool.FlushSubTaskPoolManager;\n import org.apache.iotdb.db.engine.storagegroup.TsFileResource;\n import org.apache.iotdb.db.engine.version.VersionController;\n import org.apache.iotdb.db.exception.storageGroup.StorageGroupProcessorException;\n@@ -78,6 +79,7 @@ public long currVersion() {\n \n   @Before\n   public void setup() throws IOException, WriteProcessException {\n+    FlushSubTaskPoolManager.getInstance().start();\n     tsF = SystemFileFactory.INSTANCE.getFile(logNodePrefix, \"test.ts\");\n     tsF.getParentFile().mkdirs();\n \n@@ -130,6 +132,7 @@ public void tearDown() throws IOException {\n     FileUtils.deleteDirectory(tsF.getParentFile());\n     resource.close();\n     node.delete();\n+    FlushSubTaskPoolManager.getInstance().stop();\n   }\n \n   @Test"
            },
            {
                "sha": "351228c3a5b0f3b9fea8e835d82287554f758ffe",
                "filename": "server/src/test/java/org/apache/iotdb/db/writelog/recover/UnseqTsFileRecoverTest.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/apache/incubator-iotdb/blob/20b42cd1af03b689d85bd2ba6c50a4cca1ebbdde/server/src/test/java/org/apache/iotdb/db/writelog/recover/UnseqTsFileRecoverTest.java",
                "raw_url": "https://github.com/apache/incubator-iotdb/raw/20b42cd1af03b689d85bd2ba6c50a4cca1ebbdde/server/src/test/java/org/apache/iotdb/db/writelog/recover/UnseqTsFileRecoverTest.java",
                "contents_url": "https://api.github.com/repos/apache/incubator-iotdb/contents/server/src/test/java/org/apache/iotdb/db/writelog/recover/UnseqTsFileRecoverTest.java?ref=20b42cd1af03b689d85bd2ba6c50a4cca1ebbdde",
                "patch": "@@ -26,6 +26,7 @@\n import org.apache.commons.io.FileUtils;\n import org.apache.iotdb.db.conf.adapter.ActiveTimeSeriesCounter;\n import org.apache.iotdb.db.engine.fileSystem.SystemFileFactory;\n+import org.apache.iotdb.db.engine.flush.pool.FlushSubTaskPoolManager;\n import org.apache.iotdb.db.engine.storagegroup.TsFileResource;\n import org.apache.iotdb.db.engine.version.VersionController;\n import org.apache.iotdb.db.exception.storageGroup.StorageGroupProcessorException;\n@@ -80,6 +81,7 @@ public long currVersion() {\n \n   @Before\n   public void setup() throws IOException, WriteProcessException {\n+    FlushSubTaskPoolManager.getInstance().start();\n     tsF = SystemFileFactory.INSTANCE.getFile(logNodePrefix, \"test.ts\");\n     tsF.getParentFile().mkdirs();\n \n@@ -138,6 +140,7 @@ public void setup() throws IOException, WriteProcessException {\n   public void tearDown() throws IOException {\n     FileUtils.deleteDirectory(tsF.getParentFile());\n     node.delete();\n+    FlushSubTaskPoolManager.getInstance().stop();\n   }\n \n   @Test"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/incubator-iotdb/commit/122fba054fc825b88b29e3d00736a35e5fe5d678",
        "repo": "incubator-iotdb",
        "parent": "https://github.com/apache/incubator-iotdb/commit/901012a0608c4f348fec930aea39704c9eb95487",
        "message": "Merge pull request #642 from apache/fix_jira_357\n\n[IOTDB-357]Fix NullPointerException in tsfile recover performer",
        "bug_id": "incubator-iotdb_2",
        "file": [
            {
                "sha": "b191fa829ee29d2d1b33ec29ada9be8d9847d7cb",
                "filename": "server/src/main/java/org/apache/iotdb/db/service/IoTDB.java",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/apache/incubator-iotdb/blob/122fba054fc825b88b29e3d00736a35e5fe5d678/server/src/main/java/org/apache/iotdb/db/service/IoTDB.java",
                "raw_url": "https://github.com/apache/incubator-iotdb/raw/122fba054fc825b88b29e3d00736a35e5fe5d678/server/src/main/java/org/apache/iotdb/db/service/IoTDB.java",
                "contents_url": "https://api.github.com/repos/apache/incubator-iotdb/contents/server/src/main/java/org/apache/iotdb/db/service/IoTDB.java?ref=122fba054fc825b88b29e3d00736a35e5fe5d678",
                "patch": "@@ -120,7 +120,6 @@ private void deactivate() {\n   private void initMManager(){\n     MManager.getInstance().init();\n     IoTDBConfigDynamicAdapter.getInstance().setInitialized(true);\n-    logger.debug(\"After initializing, \");\n     logger.debug(\n         \"After initializing, max memTable num is {}, tsFile threshold is {}, memtableSize is {}\",\n         IoTDBDescriptor.getInstance().getConfig().getMaxMemtableNumber(),"
            },
            {
                "sha": "148cf733ee3f61ba9f3245211e39fec56b0d3c43",
                "filename": "server/src/main/java/org/apache/iotdb/db/writelog/recover/TsFileRecoverPerformer.java",
                "status": "modified",
                "additions": 2,
                "deletions": 4,
                "changes": 6,
                "blob_url": "https://github.com/apache/incubator-iotdb/blob/122fba054fc825b88b29e3d00736a35e5fe5d678/server/src/main/java/org/apache/iotdb/db/writelog/recover/TsFileRecoverPerformer.java",
                "raw_url": "https://github.com/apache/incubator-iotdb/raw/122fba054fc825b88b29e3d00736a35e5fe5d678/server/src/main/java/org/apache/iotdb/db/writelog/recover/TsFileRecoverPerformer.java",
                "contents_url": "https://api.github.com/repos/apache/incubator-iotdb/contents/server/src/main/java/org/apache/iotdb/db/writelog/recover/TsFileRecoverPerformer.java?ref=122fba054fc825b88b29e3d00736a35e5fe5d678",
                "patch": "@@ -50,8 +50,7 @@\n  * TsFileRecoverPerformer recovers a SeqTsFile to correct status, redoes the WALs since last crash\n  * and removes the redone logs.\n  */\n-public class\n-TsFileRecoverPerformer {\n+public class TsFileRecoverPerformer {\n \n   private static final Logger logger = LoggerFactory.getLogger(TsFileRecoverPerformer.class);\n \n@@ -208,8 +207,7 @@ private void redoLogs(RestorableTsFileIOWriter restorableTsFileIOWriter)\n         // flush logs\n \n         MemTableFlushTask tableFlushTask = new MemTableFlushTask(recoverMemTable, schema,\n-            restorableTsFileIOWriter,\n-            logNodePrefix);\n+            restorableTsFileIOWriter, tsFileResource.getFile().getParentFile().getName());\n         tableFlushTask.syncFlushMemTable();\n       }\n       // close file"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/incubator-iotdb/commit/4baa36eb3f143f79e12e7754e38b6acb918bb7ae",
        "repo": "incubator-iotdb",
        "parent": "https://github.com/apache/incubator-iotdb/commit/8cd144f3121398ddda6e70bd31e69e24de6345d7",
        "message": "fix an NPE when closing mergeLogger",
        "bug_id": "incubator-iotdb_3",
        "file": [
            {
                "sha": "efaf53497f1672191c830dec6ca3e87cdcd368a4",
                "filename": "iotdb/src/main/java/org/apache/iotdb/db/engine/merge/task/MergeTask.java",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/apache/incubator-iotdb/blob/4baa36eb3f143f79e12e7754e38b6acb918bb7ae/iotdb/src/main/java/org/apache/iotdb/db/engine/merge/task/MergeTask.java",
                "raw_url": "https://github.com/apache/incubator-iotdb/raw/4baa36eb3f143f79e12e7754e38b6acb918bb7ae/iotdb/src/main/java/org/apache/iotdb/db/engine/merge/task/MergeTask.java",
                "contents_url": "https://api.github.com/repos/apache/incubator-iotdb/contents/iotdb/src/main/java/org/apache/iotdb/db/engine/merge/task/MergeTask.java?ref=4baa36eb3f143f79e12e7754e38b6acb918bb7ae",
                "patch": "@@ -127,7 +127,9 @@ void cleanUp(boolean executeCallback) throws IOException {\n     unmergedChunkCnt.clear();\n     unmergedChunkStartTimes.clear();\n \n-    mergeLogger.close();\n+    if (mergeLogger != null) {\n+      mergeLogger.close();\n+    }\n \n     for (TsFileResource seqFile : resource.getSeqFiles()) {\n       File mergeFile = new File(seqFile.getFile().getPath() + MERGE_SUFFIX);"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/incubator-iotdb/commit/e24236d2a1f3585d6c92e24c3e11c0245514682b",
        "repo": "incubator-iotdb",
        "parent": "https://github.com/apache/incubator-iotdb/commit/c6362f15d77823ceccf5c6849785b678ee38a90d",
        "message": "fix an NPE in SGP during recovery",
        "bug_id": "incubator-iotdb_4",
        "file": [
            {
                "sha": "f9841e4662f31d498a35c8e78e9ef3262a2087ce",
                "filename": "iotdb/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java",
                "status": "modified",
                "additions": 8,
                "deletions": 4,
                "changes": 12,
                "blob_url": "https://github.com/apache/incubator-iotdb/blob/e24236d2a1f3585d6c92e24c3e11c0245514682b/iotdb/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java",
                "raw_url": "https://github.com/apache/incubator-iotdb/raw/e24236d2a1f3585d6c92e24c3e11c0245514682b/iotdb/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java",
                "contents_url": "https://api.github.com/repos/apache/incubator-iotdb/contents/iotdb/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java?ref=e24236d2a1f3585d6c92e24c3e11c0245514682b",
                "patch": "@@ -780,20 +780,24 @@ private void mergeEndAction(List<TsFileResource> seqFiles, List<TsFileResource>\n         try {\n           // remove old modifications and write modifications generated during merge\n           seqFile.removeModFile();\n-          for (Modification modification : mergingModification.getModifications()) {\n-            seqFile.getModFile().write(modification);\n+          if (mergingModification != null) {\n+            for (Modification modification : mergingModification.getModifications()) {\n+              seqFile.getModFile().write(modification);\n+            }\n           }\n         } catch (IOException e) {\n           logger.error(\"{} cannot clean the ModificationFile of {} after merge\", storageGroupName,\n               seqFile.getFile(), e);\n         }\n         if (i == seqFiles.size() - 1) {\n           try {\n-            mergingModification.remove();\n+            if (mergingModification != null) {\n+              mergingModification.remove();\n+              mergingModification = null;\n+            }\n           } catch (IOException e) {\n             logger.error(\"{} cannot remove merging modification \", storageGroupName, e);\n           }\n-          mergingModification = null;\n           isMerging = false;\n         }\n       } finally {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/incubator-iotdb/commit/9e6b1d6d903d6ccfbd89de820df77f686c430401",
        "repo": "incubator-iotdb",
        "parent": "https://github.com/apache/incubator-iotdb/commit/49132a6b804ae0d8b3ad22e92d1e4da8facca374",
        "message": "flip string equals to avoid NPE",
        "bug_id": "incubator-iotdb_5",
        "file": [
            {
                "sha": "a541598dfbcb60449c856a4c0dcb78aee5fca165",
                "filename": "iotdb/src/main/java/org/apache/iotdb/db/engine/merge/recover/LogAnalyzer.java",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/apache/incubator-iotdb/blob/9e6b1d6d903d6ccfbd89de820df77f686c430401/iotdb/src/main/java/org/apache/iotdb/db/engine/merge/recover/LogAnalyzer.java",
                "raw_url": "https://github.com/apache/incubator-iotdb/raw/9e6b1d6d903d6ccfbd89de820df77f686c430401/iotdb/src/main/java/org/apache/iotdb/db/engine/merge/recover/LogAnalyzer.java",
                "contents_url": "https://api.github.com/repos/apache/incubator-iotdb/contents/iotdb/src/main/java/org/apache/iotdb/db/engine/merge/recover/LogAnalyzer.java?ref=9e6b1d6d903d6ccfbd89de820df77f686c430401",
                "patch": "@@ -75,13 +75,13 @@ public Status analyze() throws IOException {\n         new BufferedReader(new FileReader(logFile))) {\n       currLine = bufferedReader.readLine();\n       if (currLine != null) {\n-        if (currLine.equals(MergeLogger.STR_SEQ_FILES)) {\n+        if (MergeLogger.STR_SEQ_FILES.equals(currLine)) {\n           analyzeSeqFiles(bufferedReader);\n         }\n-        if (currLine.equals(MergeLogger.STR_UNSEQ_FILES)) {\n+        if (MergeLogger.STR_UNSEQ_FILES.equals(currLine)) {\n           analyzeUnseqFiles(bufferedReader);\n         }\n-        if (currLine.equals(MergeLogger.STR_MERGE_START)) {\n+        if (MergeLogger.STR_MERGE_START.equals(currLine)) {\n           status = Status.FILES_LOGGED;\n           for (TsFileResource seqFile : resource.getSeqFiles()) {\n             File mergeFile = new File(seqFile.getFile().getPath() + MergeTask.MERGE_SUFFIX);\n@@ -90,12 +90,12 @@ public Status analyze() throws IOException {\n           unmergedPaths = MergeUtils.collectPaths(resource);\n           analyzeMergedSeries(bufferedReader, unmergedPaths);\n         }\n-        if (currLine.equals(MergeLogger.STR_ALL_TS_END)) {\n+        if (MergeLogger.STR_ALL_TS_END.equals(currLine)) {\n           status = Status.ALL_TS_MERGED;\n           unmergedFiles = resource.getSeqFiles();\n           analyzeMergedFiles(bufferedReader);\n         }\n-        if (currLine.equals(MergeLogger.STR_MERGE_END)) {\n+        if (MergeLogger.STR_MERGE_END.equals(currLine)) {\n           status = Status.MERGE_END;\n         }\n       }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/incubator-iotdb/commit/bec56b7bbe6da764275a6ba287618fa06e8f50c2",
        "repo": "incubator-iotdb",
        "parent": "https://github.com/apache/incubator-iotdb/commit/33c605614e61667185bc43fb0cf5bc62fe2f232e",
        "message": "fix a NPE in merge recovery",
        "bug_id": "incubator-iotdb_6",
        "file": [
            {
                "sha": "6c92d3c1c2390554481ff1ea314de54f2360882f",
                "filename": "iotdb/src/main/java/org/apache/iotdb/db/engine/merge/task/RecoverMergeTask.java",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/apache/incubator-iotdb/blob/bec56b7bbe6da764275a6ba287618fa06e8f50c2/iotdb/src/main/java/org/apache/iotdb/db/engine/merge/task/RecoverMergeTask.java",
                "raw_url": "https://github.com/apache/incubator-iotdb/raw/bec56b7bbe6da764275a6ba287618fa06e8f50c2/iotdb/src/main/java/org/apache/iotdb/db/engine/merge/task/RecoverMergeTask.java",
                "contents_url": "https://api.github.com/repos/apache/incubator-iotdb/contents/iotdb/src/main/java/org/apache/iotdb/db/engine/merge/task/RecoverMergeTask.java?ref=bec56b7bbe6da764275a6ba287618fa06e8f50c2",
                "patch": "@@ -47,9 +47,11 @@\n \n   private LogAnalyzer analyzer;\n \n-  public RecoverMergeTask(String storageGroupDir, MergeCallback callback, String taskName,\n+  public RecoverMergeTask(List<TsFileResource> seqFiles,\n+      List<TsFileResource> unseqFiles, String storageGroupDir,\n+      MergeCallback callback, String taskName,\n       boolean fullMerge) throws IOException {\n-    super(null, null, storageGroupDir, callback, taskName, fullMerge);\n+    super(seqFiles, unseqFiles, storageGroupDir, callback, taskName, fullMerge);\n   }\n \n   public void recoverMerge(boolean continueMerge) throws IOException {"
            },
            {
                "sha": "29c1146787e300358ab0e3acf66cd50585794aa3",
                "filename": "iotdb/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/apache/incubator-iotdb/blob/bec56b7bbe6da764275a6ba287618fa06e8f50c2/iotdb/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java",
                "raw_url": "https://github.com/apache/incubator-iotdb/raw/bec56b7bbe6da764275a6ba287618fa06e8f50c2/iotdb/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java",
                "contents_url": "https://api.github.com/repos/apache/incubator-iotdb/contents/iotdb/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java?ref=bec56b7bbe6da764275a6ba287618fa06e8f50c2",
                "patch": "@@ -201,8 +201,9 @@ private void recover() throws ProcessorException {\n       if (mergingMods.exists()) {\n         mergingModification = new ModificationFile(storageGroupSysDir + File.separator + MERGING_MODIFICAITON_FILE_NAME);\n       }\n-      RecoverMergeTask recoverMergeTask = new RecoverMergeTask(storageGroupSysDir.getPath(),\n-          this::mergeEndAction, taskName, IoTDBDescriptor.getInstance().getConfig().isForceFullMerge());\n+      RecoverMergeTask recoverMergeTask = new RecoverMergeTask(seqTsFiles, unseqTsFiles,\n+          storageGroupSysDir.getPath(), this::mergeEndAction, taskName,\n+          IoTDBDescriptor.getInstance().getConfig().isForceFullMerge());\n       logger.info(\"{} a RecoverMergeTask {} starts...\", storageGroupName, taskName);\n       recoverMergeTask.recoverMerge(IoTDBDescriptor.getInstance().getConfig().isContinueMergeAfterReboot());\n       if (!IoTDBDescriptor.getInstance().getConfig().isContinueMergeAfterReboot()) {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/incubator-iotdb/commit/26578c87163f77eefdfbf2fcb52f119ffd389345",
        "repo": "incubator-iotdb",
        "parent": "https://github.com/apache/incubator-iotdb/commit/d88cd8361f0e72ac4118f54e9014fedc2805c175",
        "message": "fix an NPE in updating device min time",
        "bug_id": "incubator-iotdb_7",
        "file": [
            {
                "sha": "d19eed351221c25db6ef5939bba7ed0600f64140",
                "filename": "server/src/main/java/org/apache/iotdb/db/engine/merge/task/MergeMultiChunkTask.java",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/apache/incubator-iotdb/blob/26578c87163f77eefdfbf2fcb52f119ffd389345/server/src/main/java/org/apache/iotdb/db/engine/merge/task/MergeMultiChunkTask.java",
                "raw_url": "https://github.com/apache/incubator-iotdb/raw/26578c87163f77eefdfbf2fcb52f119ffd389345/server/src/main/java/org/apache/iotdb/db/engine/merge/task/MergeMultiChunkTask.java",
                "contents_url": "https://api.github.com/repos/apache/incubator-iotdb/contents/server/src/main/java/org/apache/iotdb/db/engine/merge/task/MergeMultiChunkTask.java?ref=26578c87163f77eefdfbf2fcb52f119ffd389345",
                "patch": "@@ -182,8 +182,10 @@ private void pathsMergeOneFile(int seqFileIdx, List<IPointReader> unseqReader)\n     mergeFileWriter.startChunkGroup(deviceId);\n     boolean dataWritten = false;\n     for (int pathIdx : unskippedPathIndices) {\n-      currDeviceMinTime = currDeviceMinTime > currTimeValuePairs[pathIdx].getTimestamp() ?\n-          currTimeValuePairs[pathIdx].getTimestamp() : currDeviceMinTime;\n+      if (currTimeValuePairs[pathIdx] != null) {\n+        currDeviceMinTime = currDeviceMinTime > currTimeValuePairs[pathIdx].getTimestamp() ?\n+            currTimeValuePairs[pathIdx].getTimestamp() : currDeviceMinTime;\n+      }\n       dataWritten = mergeChunks(seqChunkMeta[pathIdx], isLastFile,\n           fileSequenceReader, unseqReader.get(pathIdx), mergeFileWriter, currTsFile, pathIdx)\n           || dataWritten;"
            }
        ]
    }
]
