[
    {
        "commit": "https://github.com/apache/sling-org-apache-sling-jcr-resourcesecurity/commit/d14584aaae03fef0c6bedf902ff9721961ca2314",
        "repo": "sling-org-apache-sling-jcr-resourcesecurity",
        "parent": "https://github.com/apache/sling-org-apache-sling-jcr-resourcesecurity/commit/dfe8376e838fbf48760a7bbd13c812710735d77c",
        "message": "SLING-4291 : NPE if optional prefix is not configured\n\ngit-svn-id: https://svn.apache.org/repos/asf/sling/trunk@1650513 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "sling-org-apache-sling-jcr-resourcesecurity_1",
        "file": [
            {
                "sha": "a2171f756b88b2f53fd16b5c6294a80e15a987ae",
                "filename": "src/main/java/org/apache/sling/jcr/resourcesecurity/impl/ResourceAccessGateFactory.java",
                "status": "modified",
                "additions": 3,
                "deletions": 6,
                "changes": 9,
                "blob_url": "https://github.com/apache/sling-org-apache-sling-jcr-resourcesecurity/blob/d14584aaae03fef0c6bedf902ff9721961ca2314/src/main/java/org/apache/sling/jcr/resourcesecurity/impl/ResourceAccessGateFactory.java",
                "raw_url": "https://github.com/apache/sling-org-apache-sling-jcr-resourcesecurity/raw/d14584aaae03fef0c6bedf902ff9721961ca2314/src/main/java/org/apache/sling/jcr/resourcesecurity/impl/ResourceAccessGateFactory.java",
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-jcr-resourcesecurity/contents/src/main/java/org/apache/sling/jcr/resourcesecurity/impl/ResourceAccessGateFactory.java?ref=d14584aaae03fef0c6bedf902ff9721961ca2314",
                "patch": "@@ -73,11 +73,8 @@\n     protected void activate(final Map<String, Object> props) {\n         this.jcrPath = PropertiesUtil.toString(props.get(PROP_JCR_PATH), null);\n         this.prefix = PropertiesUtil.toString(props.get(PROP_PREFIX), null);\n-        if ( this.prefix != null ) {\n-            if ( !this.prefix.endsWith(\"/\") ) {\n-                this.prefix = this.prefix + \"/\";\n-            }\n-            this.jcrPath = this.jcrPath + \"/\";\n+        if ( this.prefix != null && !this.prefix.endsWith(\"/\") ) {\n+             this.prefix = this.prefix + \"/\";\n         }\n     }\n \n@@ -92,7 +89,7 @@ private GateResult checkPermission(final ResourceResolver resolver,\n         if ( session != null ) {\n             String checkPath = this.jcrPath;\n             if ( this.prefix != null && path.startsWith(this.prefix) ) {\n-                checkPath = this.jcrPath + path.substring(this.prefix.length());\n+                checkPath = this.jcrPath + path.substring(this.prefix.length() - 1);\n             }\n             try {\n                 granted = session.hasPermission(checkPath, permission);"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/sling-org-apache-sling-jcr-resourcesecurity/commit/dfe8376e838fbf48760a7bbd13c812710735d77c",
        "repo": "sling-org-apache-sling-jcr-resourcesecurity",
        "parent": "https://github.com/apache/sling-org-apache-sling-jcr-resourcesecurity/commit/bee0b2cb8ffa8db0a584d98ca7004d3eb6ab5fad",
        "message": "SLING-4291 : NPE if optional prefix is not configured\n\ngit-svn-id: https://svn.apache.org/repos/asf/sling/trunk@1650508 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "sling-org-apache-sling-jcr-resourcesecurity_2",
        "file": [
            {
                "sha": "4cfe4eb1d8fde980152430048194396c40872c7e",
                "filename": "src/main/java/org/apache/sling/jcr/resourcesecurity/impl/ResourceAccessGateFactory.java",
                "status": "modified",
                "additions": 6,
                "deletions": 3,
                "changes": 9,
                "blob_url": "https://github.com/apache/sling-org-apache-sling-jcr-resourcesecurity/blob/dfe8376e838fbf48760a7bbd13c812710735d77c/src/main/java/org/apache/sling/jcr/resourcesecurity/impl/ResourceAccessGateFactory.java",
                "raw_url": "https://github.com/apache/sling-org-apache-sling-jcr-resourcesecurity/raw/dfe8376e838fbf48760a7bbd13c812710735d77c/src/main/java/org/apache/sling/jcr/resourcesecurity/impl/ResourceAccessGateFactory.java",
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-jcr-resourcesecurity/contents/src/main/java/org/apache/sling/jcr/resourcesecurity/impl/ResourceAccessGateFactory.java?ref=dfe8376e838fbf48760a7bbd13c812710735d77c",
                "patch": "@@ -73,8 +73,11 @@\n     protected void activate(final Map<String, Object> props) {\n         this.jcrPath = PropertiesUtil.toString(props.get(PROP_JCR_PATH), null);\n         this.prefix = PropertiesUtil.toString(props.get(PROP_PREFIX), null);\n-        if ( !this.prefix.endsWith(\"/\") ) {\n-            this.prefix = this.prefix + \"/\";\n+        if ( this.prefix != null ) {\n+            if ( !this.prefix.endsWith(\"/\") ) {\n+                this.prefix = this.prefix + \"/\";\n+            }\n+            this.jcrPath = this.jcrPath + \"/\";\n         }\n     }\n \n@@ -89,7 +92,7 @@ private GateResult checkPermission(final ResourceResolver resolver,\n         if ( session != null ) {\n             String checkPath = this.jcrPath;\n             if ( this.prefix != null && path.startsWith(this.prefix) ) {\n-                checkPath = this.jcrPath + path.substring(this.prefix.length() - 1);\n+                checkPath = this.jcrPath + path.substring(this.prefix.length());\n             }\n             try {\n                 granted = session.hasPermission(checkPath, permission);"
            }
        ]
    }
]
