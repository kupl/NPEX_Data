[
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/30320fe2f4cadb605e15438307b7d49c543b5898",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/0c862432d80cc64d19421c382cd6c4298103c711",
        "message": "Fixed NPE in case of a missing Max-Forwards header",
        "bug_id": "httpcomponents-client_1",
        "file": [
            {
                "sha": "1ab84d66699a4ec967f10b2255b8195465c7ade5",
                "filename": "httpclient5-cache/src/main/java/org/apache/hc/client5/http/impl/cache/CachingExecBase.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/30320fe2f4cadb605e15438307b7d49c543b5898/httpclient5-cache/src/main/java/org/apache/hc/client5/http/impl/cache/CachingExecBase.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/30320fe2f4cadb605e15438307b7d49c543b5898/httpclient5-cache/src/main/java/org/apache/hc/client5/http/impl/cache/CachingExecBase.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient5-cache/src/main/java/org/apache/hc/client5/http/impl/cache/CachingExecBase.java?ref=30320fe2f4cadb605e15438307b7d49c543b5898",
                "patch": "@@ -354,7 +354,8 @@ boolean clientRequestsOurOptions(final HttpRequest request) {\n             return false;\n         }\n \n-        if (!\"0\".equals(request.getFirstHeader(HeaderConstants.MAX_FORWARDS).getValue())) {\n+        final Header h = request.getFirstHeader(HeaderConstants.MAX_FORWARDS);\n+        if (!\"0\".equals(h != null ? h.getValue() : null)) {\n             return false;\n         }\n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/272ea1fa8337756e4e15b8c92745ec0a57293de3",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/a10967a427394844e9b90b9630f7f71f2ee0319a",
        "message": "Fixed NPE PoolingAsyncClientConnectionManager\n\nPoolingAsyncClientConnectionManager.validateAfterInactivity causes\nan NPE when PoolEntries are initially created with no Connection.\n\nAdded logic to avoid checking the connection on every pool\ncheckout similar to the blocking pool.\n\nAdded an connection.isOpen check to http1.x connections leased\nfrom the pool, although I'm unsure if it's at all effective.\n\nCloses PR #82",
        "bug_id": "httpcomponents-client_2",
        "file": [
            {
                "sha": "25dbae90d2b71c561764b291aa210ded0f43e7d6",
                "filename": "httpclient5/src/main/java/org/apache/hc/client5/http/impl/nio/PoolingAsyncClientConnectionManager.java",
                "status": "modified",
                "additions": 9,
                "deletions": 2,
                "changes": 11,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/272ea1fa8337756e4e15b8c92745ec0a57293de3/httpclient5/src/main/java/org/apache/hc/client5/http/impl/nio/PoolingAsyncClientConnectionManager.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/272ea1fa8337756e4e15b8c92745ec0a57293de3/httpclient5/src/main/java/org/apache/hc/client5/http/impl/nio/PoolingAsyncClientConnectionManager.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient5/src/main/java/org/apache/hc/client5/http/impl/nio/PoolingAsyncClientConnectionManager.java?ref=272ea1fa8337756e4e15b8c92745ec0a57293de3",
                "patch": "@@ -164,8 +164,9 @@ void leaseCompleted(final PoolEntry<HttpRoute, ManagedAsyncClientConnection> poo\n \n                     @Override\n                     public void completed(final PoolEntry<HttpRoute, ManagedAsyncClientConnection> poolEntry) {\n-                        if (TimeValue.isPositive(validateAfterInactivity)) {\n-                            final ManagedAsyncClientConnection connection = poolEntry.getConnection();\n+                        final ManagedAsyncClientConnection connection = poolEntry.getConnection();\n+                        if (TimeValue.isPositive(validateAfterInactivity) && connection != null &&\n+                                poolEntry.getUpdated() + validateAfterInactivity.toMillis() <= System.currentTimeMillis()) {\n                             final ProtocolVersion protocolVersion = connection.getProtocolVersion();\n                             if (HttpVersion.HTTP_2_0.greaterEquals(protocolVersion)) {\n                                 connection.submitPriorityCommand(new PingCommand(new BasicPingHandler(new Callback<Boolean>() {\n@@ -183,6 +184,12 @@ public void execute(final Boolean result) {\n \n                                 })));\n                             } else {\n+                                if (!connection.isOpen()) {\n+                                    if (log.isDebugEnabled()) {\n+                                        log.debug(\"Connection \" + ConnPoolSupport.getId(connection) + \" is closed\");\n+                                    }\n+                                    poolEntry.discardConnection(ShutdownType.IMMEDIATE);\n+                                }\n                                 leaseCompleted(poolEntry);\n                             }\n                         } else {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/b40661e45ec12fb1c7ef52b1891a9b677331f48d",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/92b5d6d09d9705bc69b6ccb77de9df7cf97fb6b7",
        "message": "HTTPCLIENT-1498: empty host in redirect location causes NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1591221 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_3",
        "file": [
            {
                "sha": "d485cfe1051ac45a48ca8ba4c19770a2f47b4351",
                "filename": "httpclient/src/main/java/org/apache/http/client/utils/URIUtils.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/b40661e45ec12fb1c7ef52b1891a9b677331f48d/httpclient/src/main/java/org/apache/http/client/utils/URIUtils.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/b40661e45ec12fb1c7ef52b1891a9b677331f48d/httpclient/src/main/java/org/apache/http/client/utils/URIUtils.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/client/utils/URIUtils.java?ref=b40661e45ec12fb1c7ef52b1891a9b677331f48d",
                "patch": "@@ -366,7 +366,7 @@ public static HttpHost extractHost(final URI uri) {\n                 }\n             }\n             final String scheme = uri.getScheme();\n-            if (host != null) {\n+            if (!TextUtils.isBlank(host)) {\n                 target = new HttpHost(host, port, scheme);\n             }\n         }"
            },
            {
                "sha": "a0fb7eb6198423cd663019b3f7c5b31bf5a46db8",
                "filename": "httpclient/src/test/java/org/apache/http/client/utils/TestURIUtils.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/b40661e45ec12fb1c7ef52b1891a9b677331f48d/httpclient/src/test/java/org/apache/http/client/utils/TestURIUtils.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/b40661e45ec12fb1c7ef52b1891a9b677331f48d/httpclient/src/test/java/org/apache/http/client/utils/TestURIUtils.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/test/java/org/apache/http/client/utils/TestURIUtils.java?ref=b40661e45ec12fb1c7ef52b1891a9b677331f48d",
                "patch": "@@ -229,6 +229,8 @@ public void testExtractHost() throws Exception {\n                 URIUtils.extractHost(new URI(\"http://localhost:8080;sessionid=stuff/abcd\")));\n         Assert.assertEquals(new HttpHost(\"localhost\",-1),\n                 URIUtils.extractHost(new URI(\"http://localhost:;sessionid=stuff/abcd\")));\n+        Assert.assertEquals(null,\n+                URIUtils.extractHost(new URI(\"http://:80/robots.txt\")));\n     }\n \n     @Test"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/2dea804f67633c1a3021788eecf1e073dc0057a9",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/79c90bd159bb9aeee3d1783508fcd263a2e63a2f",
        "message": "Avoid possible NPE warning\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1571437 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_4",
        "file": [
            {
                "sha": "40d08523385600b26fd5901064e4c240c066a647",
                "filename": "httpclient/src/test/java/org/apache/http/localserver/LocalTestServer.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/2dea804f67633c1a3021788eecf1e073dc0057a9/httpclient/src/test/java/org/apache/http/localserver/LocalTestServer.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/2dea804f67633c1a3021788eecf1e073dc0057a9/httpclient/src/test/java/org/apache/http/localserver/LocalTestServer.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/test/java/org/apache/http/localserver/LocalTestServer.java?ref=2dea804f67633c1a3021788eecf1e073dc0057a9",
                "patch": "@@ -310,7 +310,7 @@ public String toString() {\n      */\n     public InetSocketAddress getServiceAddress() {\n         final ServerSocket ssock = servicedSocket; // avoid synchronization\n-        Asserts.check(ssock != null, \"Not running\");\n+        Asserts.notNull(ssock, \"Not running\");\n         return (InetSocketAddress) ssock.getLocalSocketAddress();\n     }\n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/df36e1087cb3673ff7aac01fe7ff08f91e43422c",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/b83c1b93589ec9b3ade0f7455d02a83ad51aeff1",
        "message": "HTTPCLIENT-1416: Fixed NPE in CachingHttpClientBuilder#build()\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1529812 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_5",
        "file": [
            {
                "sha": "5b6bff59a9e8c7f3a825478b6220abf27d8dd21c",
                "filename": "RELEASE_NOTES.txt",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/df36e1087cb3673ff7aac01fe7ff08f91e43422c/RELEASE_NOTES.txt",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/df36e1087cb3673ff7aac01fe7ff08f91e43422c/RELEASE_NOTES.txt",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/RELEASE_NOTES.txt?ref=df36e1087cb3673ff7aac01fe7ff08f91e43422c",
                "patch": "@@ -1,3 +1,11 @@\n+Changes sicne 4.3.1\n+-------------------\n+\n+* [HTTPCLIENT-1416] Fixed NPE in CachingHttpClientBuilder#build().\n+  Contributed by Oleg Kalnichevski <olegk at apache.org>\n+\n+\n+\n Release 4.3.1\n -------------------\n "
            },
            {
                "sha": "04377dec3e6e9227d3036251ba2575adaa84277f",
                "filename": "httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CachingHttpClientBuilder.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/df36e1087cb3673ff7aac01fe7ff08f91e43422c/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CachingHttpClientBuilder.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/df36e1087cb3673ff7aac01fe7ff08f91e43422c/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CachingHttpClientBuilder.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CachingHttpClientBuilder.java?ref=df36e1087cb3673ff7aac01fe7ff08f91e43422c",
                "patch": "@@ -107,9 +107,9 @@ protected ClientExecChain decorateMainExec(final ClientExecChain mainExec) {\n         HttpCacheStorage storage = this.storage;\n         if (storage == null) {\n             if (this.cacheDir == null) {\n-                storage = new BasicHttpCacheStorage(cacheConfig);\n+                storage = new BasicHttpCacheStorage(config);\n             } else {\n-                final ManagedHttpCacheStorage managedStorage = new ManagedHttpCacheStorage(cacheConfig);\n+                final ManagedHttpCacheStorage managedStorage = new ManagedHttpCacheStorage(config);\n                 addCloseable(managedStorage);\n                 storage = managedStorage;\n             }"
            },
            {
                "sha": "c32b16f3bc5f473af9934daf97033850c1c4b7ea",
                "filename": "httpclient-cache/src/test/java/org/apache/http/impl/client/cache/TestCachingHttpClientBuilder.java",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/df36e1087cb3673ff7aac01fe7ff08f91e43422c/httpclient-cache/src/test/java/org/apache/http/impl/client/cache/TestCachingHttpClientBuilder.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/df36e1087cb3673ff7aac01fe7ff08f91e43422c/httpclient-cache/src/test/java/org/apache/http/impl/client/cache/TestCachingHttpClientBuilder.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient-cache/src/test/java/org/apache/http/impl/client/cache/TestCachingHttpClientBuilder.java?ref=df36e1087cb3673ff7aac01fe7ff08f91e43422c",
                "patch": "@@ -40,4 +40,9 @@ public void testAsynchronousWorkersMax0() throws Exception {\n         CachingHttpClientBuilder.create().setCacheConfig(cacheConfig).build();\n     }\n \n+    @Test\n+    public void testNullCacheConfig() throws Exception {\n+        CachingHttpClientBuilder.create().setCacheConfig(null).build();\n+    }\n+\n }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/11536d3d075c82a12e708e9b07a5f5f11192d24a",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/eff62c7a6ea113702bdf6f120cc518bf3c00fb31",
        "message": "HTTPCLIENT-1399: fixed NPE in RequestBuilder\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1523642 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_6",
        "file": [
            {
                "sha": "4621a331cda75c6d74b95cf14b0f79b1c908cfa0",
                "filename": "RELEASE_NOTES.txt",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/11536d3d075c82a12e708e9b07a5f5f11192d24a/RELEASE_NOTES.txt",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/11536d3d075c82a12e708e9b07a5f5f11192d24a/RELEASE_NOTES.txt",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/RELEASE_NOTES.txt?ref=11536d3d075c82a12e708e9b07a5f5f11192d24a",
                "patch": "@@ -1,3 +1,12 @@\n+Changes since 4.3\n+-------------------\n+\n+* [HTTPCLIENT-1399] Fixed NPE in RequestBuilder.\n+  Contributed by Oleg Kalnichevski <olegk at apache.org>\n+\n+\n+\n+\n Release 4.3 Final\n -------------------\n "
            },
            {
                "sha": "6ac5b96fb8ca1b3306e2f118a030ec0d6c71f352",
                "filename": "httpclient/src/main/java/org/apache/http/client/methods/RequestBuilder.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/11536d3d075c82a12e708e9b07a5f5f11192d24a/httpclient/src/main/java/org/apache/http/client/methods/RequestBuilder.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/11536d3d075c82a12e708e9b07a5f5f11192d24a/httpclient/src/main/java/org/apache/http/client/methods/RequestBuilder.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/client/methods/RequestBuilder.java?ref=11536d3d075c82a12e708e9b07a5f5f11192d24a",
                "patch": "@@ -226,15 +226,15 @@ public RequestBuilder removeHeaders(final String name) {\n     }\n \n     public RequestBuilder setHeader(final Header header) {\n-        if (headergroup != null) {\n+        if (headergroup == null) {\n             headergroup = new HeaderGroup();\n         }\n         this.headergroup.updateHeader(header);\n         return this;\n     }\n \n     public RequestBuilder setHeader(final String name, final String value) {\n-        if (headergroup != null) {\n+        if (headergroup == null) {\n             headergroup = new HeaderGroup();\n         }\n         this.headergroup.updateHeader(new BasicHeader(name, value));"
            },
            {
                "sha": "e27c6e3d7f146250b4686a4f7eb42cb1e5835bff",
                "filename": "httpclient/src/test/java/org/apache/http/client/methods/TestRequestBuilder.java",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/11536d3d075c82a12e708e9b07a5f5f11192d24a/httpclient/src/test/java/org/apache/http/client/methods/TestRequestBuilder.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/11536d3d075c82a12e708e9b07a5f5f11192d24a/httpclient/src/test/java/org/apache/http/client/methods/TestRequestBuilder.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/test/java/org/apache/http/client/methods/TestRequestBuilder.java?ref=11536d3d075c82a12e708e9b07a5f5f11192d24a",
                "patch": "@@ -195,6 +195,11 @@ public void testGettersAndMutators() throws Exception {\n         Assert.assertEquals(0, builder.getHeaders(\"header1\").length);\n         Assert.assertSame(null, builder.getEntity());\n         Assert.assertSame(null, builder.getConfig());\n+\n+        builder.setHeader(h2)\n+            .setHeader(\"header1\", \"a-lot-more-stuff\");\n+        Assert.assertSame(\"a-lot-more-stuff\", builder.getLastHeader(\"header1\").getValue());\n+        Assert.assertEquals(1, builder.getHeaders(\"header1\").length);\n     }\n \n     @Test(expected=IllegalArgumentException.class)"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/26241e51e2295e6151a5ea9115fca57820a79e51",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/a9c95e057fea80d3621117d9b04545e0bf064359",
        "message": "HTTPCLIENT-1180: Fixed NPE in ClientGZipContentCompression sample\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1311952 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_7",
        "file": [
            {
                "sha": "318d961907b1776ad88205b066da0f2a2e251cd6",
                "filename": "httpclient/src/examples/org/apache/http/examples/client/ClientGZipContentCompression.java",
                "status": "modified",
                "additions": 11,
                "deletions": 35,
                "changes": 46,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/26241e51e2295e6151a5ea9115fca57820a79e51/httpclient/src/examples/org/apache/http/examples/client/ClientGZipContentCompression.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/26241e51e2295e6151a5ea9115fca57820a79e51/httpclient/src/examples/org/apache/http/examples/client/ClientGZipContentCompression.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/examples/org/apache/http/examples/client/ClientGZipContentCompression.java?ref=26241e51e2295e6151a5ea9115fca57820a79e51",
                "patch": "@@ -28,8 +28,6 @@\n package org.apache.http.examples.client;\n \n import java.io.IOException;\n-import java.io.InputStream;\n-import java.util.zip.GZIPInputStream;\n \n import org.apache.http.Header;\n import org.apache.http.HeaderElement;\n@@ -39,8 +37,8 @@\n import org.apache.http.HttpRequestInterceptor;\n import org.apache.http.HttpResponse;\n import org.apache.http.HttpResponseInterceptor;\n+import org.apache.http.client.entity.GzipDecompressingEntity;\n import org.apache.http.client.methods.HttpGet;\n-import org.apache.http.entity.HttpEntityWrapper;\n import org.apache.http.impl.client.DefaultHttpClient;\n import org.apache.http.protocol.HttpContext;\n import org.apache.http.util.EntityUtils;\n@@ -81,14 +79,16 @@ public void process(\n                         final HttpResponse response,\n                         final HttpContext context) throws HttpException, IOException {\n                     HttpEntity entity = response.getEntity();\n-                    Header ceheader = entity.getContentEncoding();\n-                    if (ceheader != null) {\n-                        HeaderElement[] codecs = ceheader.getElements();\n-                        for (int i = 0; i < codecs.length; i++) {\n-                            if (codecs[i].getName().equalsIgnoreCase(\"gzip\")) {\n-                                response.setEntity(\n-                                        new GzipDecompressingEntity(response.getEntity()));\n-                                return;\n+                    if (entity != null) {\n+                        Header ceheader = entity.getContentEncoding();\n+                        if (ceheader != null) {\n+                            HeaderElement[] codecs = ceheader.getElements();\n+                            for (int i = 0; i < codecs.length; i++) {\n+                                if (codecs[i].getName().equalsIgnoreCase(\"gzip\")) {\n+                                    response.setEntity(\n+                                            new GzipDecompressingEntity(response.getEntity()));\n+                                    return;\n+                                }\n                             }\n                         }\n                     }\n@@ -125,29 +125,5 @@ public void process(\n         }\n     }\n \n-    static class GzipDecompressingEntity extends HttpEntityWrapper {\n-\n-        public GzipDecompressingEntity(final HttpEntity entity) {\n-            super(entity);\n-        }\n-\n-        @Override\n-        public InputStream getContent()\n-            throws IOException, IllegalStateException {\n-\n-            // the wrapped entity's getContent() decides about repeatability\n-            InputStream wrappedin = wrappedEntity.getContent();\n-\n-            return new GZIPInputStream(wrappedin);\n-        }\n-\n-        @Override\n-        public long getContentLength() {\n-            // length of ungzipped content is not known\n-            return -1;\n-        }\n-\n-    }\n-\n }\n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/70d37431ec9b4260d0d221de5b08dbc714fc615a",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/471c2b3ae97309f3961c19c5c14a669cb9707629",
        "message": "Suppress NPE warning\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1099905 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_8",
        "file": [
            {
                "sha": "469f41e9bedac39059965067fc65867640824b9c",
                "filename": "httpclient/src/main/java/org/apache/http/impl/client/DefaultRequestDirector.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/70d37431ec9b4260d0d221de5b08dbc714fc615a/httpclient/src/main/java/org/apache/http/impl/client/DefaultRequestDirector.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/70d37431ec9b4260d0d221de5b08dbc714fc615a/httpclient/src/main/java/org/apache/http/impl/client/DefaultRequestDirector.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/impl/client/DefaultRequestDirector.java?ref=70d37431ec9b4260d0d221de5b08dbc714fc615a",
                "patch": "@@ -883,7 +883,8 @@ protected boolean createTunnelToTarget(HttpRoute route,\n             }\n         }\n \n-        int status = response.getStatusLine().getStatusCode(); // can't be null\n+        @SuppressWarnings(\"null\") // can't be null\n+        int status = response.getStatusLine().getStatusCode();\n \n         if (status > 299) {\n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/955f47e6f592a97735ac80ff4fd265a9ba041430",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/1a26a94f9509d9044e2973c1779f10e7916e950f",
        "message": "HTTPCLIENT-932 Fix possible NPE - use sslsock rather than sock\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@940069 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_9",
        "file": [
            {
                "sha": "9c77b90ca7d0c7ec7723ddc38b92ccd05ec888e1",
                "filename": "httpclient/src/main/java/org/apache/http/conn/ssl/SSLSocketFactory.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/955f47e6f592a97735ac80ff4fd265a9ba041430/httpclient/src/main/java/org/apache/http/conn/ssl/SSLSocketFactory.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/955f47e6f592a97735ac80ff4fd265a9ba041430/httpclient/src/main/java/org/apache/http/conn/ssl/SSLSocketFactory.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/conn/ssl/SSLSocketFactory.java?ref=955f47e6f592a97735ac80ff4fd265a9ba041430",
                "patch": "@@ -364,7 +364,7 @@ public Socket connectSocket(\n         }\n         SSLSocket sslsock = (SSLSocket) (sock != null ? sock : createSocket());\n         if (localAddress != null) {\n-            sock.setReuseAddress(HttpConnectionParams.getSoReuseaddr(params));\n+            sslsock.setReuseAddress(HttpConnectionParams.getSoReuseaddr(params));\n             sslsock.bind(localAddress);\n         }\n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/a5814c279cbba399b6c153a4e60bfaad1cd535ad",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/fd513425a1f87c9ee9b9c7d4700d72f9ffa827fb",
        "message": "Avoid possible NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@940062 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_10",
        "file": [
            {
                "sha": "e5c2cf6fdf4e20856872ccff0a67441de2290458",
                "filename": "httpclient-cache/src/test/java/org/apache/http/client/cache/impl/HttpTestUtils.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/a5814c279cbba399b6c153a4e60bfaad1cd535ad/httpclient-cache/src/test/java/org/apache/http/client/cache/impl/HttpTestUtils.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/a5814c279cbba399b6c153a4e60bfaad1cd535ad/httpclient-cache/src/test/java/org/apache/http/client/cache/impl/HttpTestUtils.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient-cache/src/test/java/org/apache/http/client/cache/impl/HttpTestUtils.java?ref=a5814c279cbba399b6c153a4e60bfaad1cd535ad",
                "patch": "@@ -97,6 +97,8 @@ public static boolean equivalent(HttpEntity e1, HttpEntity e2) throws Exception\n         InputStream i2 = e2.getContent();\n         if (i1 == null && i2 == null)\n             return true;\n+        if (i1 == null || i2 == null)\n+            return false; // avoid possible NPEs below\n         int b1 = -1;\n         while ((b1 = i1.read()) != -1) {\n             if (b1 != i2.read())"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/aaf723d2bed524498cbbdffaf2180ae7ab75cfa1",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/416085813efd1e764a2af8e880f7ef0f762e9d44",
        "message": "Avoid possible NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@939859 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_11",
        "file": [
            {
                "sha": "cb7f3d4550ce62633db4e81666b10ff5da3704bd",
                "filename": "httpclient-cache/src/main/java/org/apache/http/client/cache/impl/DefaultCacheEntrySerializer.java",
                "status": "modified",
                "additions": 6,
                "deletions": 2,
                "changes": 8,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/aaf723d2bed524498cbbdffaf2180ae7ab75cfa1/httpclient-cache/src/main/java/org/apache/http/client/cache/impl/DefaultCacheEntrySerializer.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/aaf723d2bed524498cbbdffaf2180ae7ab75cfa1/httpclient-cache/src/main/java/org/apache/http/client/cache/impl/DefaultCacheEntrySerializer.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient-cache/src/main/java/org/apache/http/client/cache/impl/DefaultCacheEntrySerializer.java?ref=aaf723d2bed524498cbbdffaf2180ae7ab75cfa1",
                "patch": "@@ -62,7 +62,9 @@ public void writeTo(CacheEntry cacheEntry, OutputStream os) throws IOException {\n             // oos.writeObject(sheaders);\n         } finally {\n             try {\n-                oos.close();\n+                if (oos != null) {\n+                    oos.close();\n+                }\n             } catch (Exception ignore) {\n             }\n             try {\n@@ -95,7 +97,9 @@ public CacheEntry readFrom(InputStream is) throws IOException {\n             throw new RuntimeException(cnfe);\n         } finally {\n             try {\n-                ois.close();\n+                if (ois != null) {\n+                    ois.close();\n+                }\n             } catch (Exception ignore) {\n             }\n             try {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/bb15e4d9b3f473d108249716f399ed4a96eab53f",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/72eedbe0ea507e86af66f202e6ae300979781420",
        "message": "HTTPCLIENT-833: fixed possible NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@754998 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_12",
        "file": [
            {
                "sha": "04cc0671bba75572ddfce90a68e3161dcbd00734",
                "filename": "httpclient/src/main/java/org/apache/http/conn/ssl/SSLSocketFactory.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/bb15e4d9b3f473d108249716f399ed4a96eab53f/httpclient/src/main/java/org/apache/http/conn/ssl/SSLSocketFactory.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/bb15e4d9b3f473d108249716f399ed4a96eab53f/httpclient/src/main/java/org/apache/http/conn/ssl/SSLSocketFactory.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/conn/ssl/SSLSocketFactory.java?ref=bb15e4d9b3f473d108249716f399ed4a96eab53f",
                "patch": "@@ -321,7 +321,7 @@ public Socket connectSocket(\n             remoteAddress = new InetSocketAddress(host, port);            \n         }\n         try {\n-            sock.connect(remoteAddress, connTimeout);\n+            sslsock.connect(remoteAddress, connTimeout);\n         } catch (SocketTimeoutException ex) {\n             throw new ConnectTimeoutException(\"Connect to \" + remoteAddress + \" timed out\");\n         }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/72eedbe0ea507e86af66f202e6ae300979781420",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/0483252843bacec314c47f9825ac5dd505f03b88",
        "message": "Avoid possible NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@753460 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_13",
        "file": [
            {
                "sha": "a9a1b75cb7a826e682c9c957bee023095b820dbf",
                "filename": "httpclient/src/examples/org/apache/http/examples/client/ClientCustomContext.java",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/72eedbe0ea507e86af66f202e6ae300979781420/httpclient/src/examples/org/apache/http/examples/client/ClientCustomContext.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/72eedbe0ea507e86af66f202e6ae300979781420/httpclient/src/examples/org/apache/http/examples/client/ClientCustomContext.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/examples/org/apache/http/examples/client/ClientCustomContext.java?ref=72eedbe0ea507e86af66f202e6ae300979781420",
                "patch": "@@ -83,7 +83,9 @@ public final static void main(String[] args) throws Exception {\n         }\n         \n         // Consume response content\n-        entity.consumeContent();\n+        if (entity != null) {\n+            entity.consumeContent();\n+        }\n         \n         System.out.println(\"----------------------------------------\");\n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/e8dbce5f9be283e3f4b77a3a465e98850ef3ef91",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/683bb070fdbfecec4521fe7efac7a8d03a3cc309",
        "message": "HTTPCLIENT-1544: Fixed NPE in ResponseProcessCookies when running with DEBUG priority\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1618328 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_14",
        "file": [
            {
                "sha": "5f3cfaba0bb66d355e402aaeb0be50ac890ae5b2",
                "filename": "httpclient/src/main/java/org/apache/http/client/protocol/ResponseProcessCookies.java",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/e8dbce5f9be283e3f4b77a3a465e98850ef3ef91/httpclient/src/main/java/org/apache/http/client/protocol/ResponseProcessCookies.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/e8dbce5f9be283e3f4b77a3a465e98850ef3ef91/httpclient/src/main/java/org/apache/http/client/protocol/ResponseProcessCookies.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/client/protocol/ResponseProcessCookies.java?ref=e8dbce5f9be283e3f4b77a3a465e98850ef3ef91",
                "patch": "@@ -138,10 +138,12 @@ private static String formatCooke(final Cookie cookie) {\n         buf.append(cookie.getName());\n         buf.append(\"=\\\"\");\n         String v = cookie.getValue();\n-        if (v.length() > 100) {\n-            v = v.substring(0, 100) + \"...\";\n+        if (v != null) {\n+            if (v.length() > 100) {\n+                v = v.substring(0, 100) + \"...\";\n+            }\n+            buf.append(v);\n         }\n-        buf.append(v);\n         buf.append(\"\\\"\");\n         buf.append(\", version:\");\n         buf.append(Integer.toString(cookie.getVersion()));"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/3220bbf633e74e05d32a62005d1c9251974b88d1",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/57c6856702348677f7331d7f5512fb04b118faa7",
        "message": "HTTPCLIENT-1479: fixed NPE in RequestAuthCache caused by incorrect context initialization\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1575902 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_15",
        "file": [
            {
                "sha": "eaf784b4f04bf9a2c3e3e411745bf848fc09bc75",
                "filename": "httpclient/src/main/java-deprecated/org/apache/http/impl/client/DefaultRequestDirector.java",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/3220bbf633e74e05d32a62005d1c9251974b88d1/httpclient/src/main/java-deprecated/org/apache/http/impl/client/DefaultRequestDirector.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/3220bbf633e74e05d32a62005d1c9251974b88d1/httpclient/src/main/java-deprecated/org/apache/http/impl/client/DefaultRequestDirector.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java-deprecated/org/apache/http/impl/client/DefaultRequestDirector.java?ref=3220bbf633e74e05d32a62005d1c9251974b88d1",
                "patch": "@@ -867,6 +867,7 @@ protected boolean createTunnelToTarget(final HttpRoute route,\n \n             // Populate the execution context\n             context.setAttribute(ExecutionContext.HTTP_TARGET_HOST, target);\n+            context.setAttribute(ClientContext.ROUTE, route);\n             context.setAttribute(ExecutionContext.HTTP_PROXY_HOST, proxy);\n             context.setAttribute(ExecutionContext.HTTP_CONNECTION, managedConn);\n             context.setAttribute(ExecutionContext.HTTP_REQUEST, connect);"
            },
            {
                "sha": "fa6a362998e8a99f72ea6a019cb532861c4db699",
                "filename": "httpclient/src/main/java/org/apache/http/client/protocol/RequestAuthCache.java",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/3220bbf633e74e05d32a62005d1c9251974b88d1/httpclient/src/main/java/org/apache/http/client/protocol/RequestAuthCache.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/3220bbf633e74e05d32a62005d1c9251974b88d1/httpclient/src/main/java/org/apache/http/client/protocol/RequestAuthCache.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/client/protocol/RequestAuthCache.java?ref=3220bbf633e74e05d32a62005d1c9251974b88d1",
                "patch": "@@ -84,7 +84,17 @@ public void process(final HttpRequest request, final HttpContext context)\n         }\n \n         final RouteInfo route = clientContext.getHttpRoute();\n+        if (route == null) {\n+            this.log.debug(\"Route info not set in the context\");\n+            return;\n+        }\n+\n         HttpHost target = clientContext.getTargetHost();\n+        if (target == null) {\n+            this.log.debug(\"Target host not set in the context\");\n+            return;\n+        }\n+\n         if (target.getPort() < 0) {\n             target = new HttpHost(\n                     target.getHostName(),"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/67a1cc719969e0f4604cb3a34cb2ba42e1c4caa1",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/50b27ac7908615d8e5cf9e13b9a9a7b67cb4c1af",
        "message": "HTTPCLIENT-1470 CachingExec(ClientExecChain, HttpCache, CacheConfig, AsynchronousValidator) throws NPE if config is null\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1570963 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_16",
        "file": [
            {
                "sha": "607fc3e86259bb3b7d26aa8a5ec3c515488bea5c",
                "filename": "RELEASE_NOTES.txt",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/67a1cc719969e0f4604cb3a34cb2ba42e1c4caa1/RELEASE_NOTES.txt",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/67a1cc719969e0f4604cb3a34cb2ba42e1c4caa1/RELEASE_NOTES.txt",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/RELEASE_NOTES.txt?ref=67a1cc719969e0f4604cb3a34cb2ba42e1c4caa1",
                "patch": "@@ -4,6 +4,8 @@ Changes for 4.4-alpha1\n Changelog:\n -------------------\n \n+* [HTTPCLIENT-1470] CachingExec(ClientExecChain, HttpCache, CacheConfig, AsynchronousValidator) throws NPE if config is null\n+\n * [HTTPCLIENT-1466] FileBodyPart#generateContentType() ignores custom ContentType values.\n   Contributed by Oleg Kalnichevski <olegk at apache.org>\n "
            },
            {
                "sha": "cc267cf73fa0f0f28a30858af7180b59150d2580",
                "filename": "httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CachingExec.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/67a1cc719969e0f4604cb3a34cb2ba42e1c4caa1/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CachingExec.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/67a1cc719969e0f4604cb3a34cb2ba42e1c4caa1/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CachingExec.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CachingExec.java?ref=67a1cc719969e0f4604cb3a34cb2ba42e1c4caa1",
                "patch": "@@ -136,10 +136,10 @@ public CachingExec(\n         this.validityPolicy = new CacheValidityPolicy();\n         this.responseGenerator = new CachedHttpResponseGenerator(this.validityPolicy);\n         this.cacheableRequestPolicy = new CacheableRequestPolicy();\n-        this.suitabilityChecker = new CachedResponseSuitabilityChecker(this.validityPolicy, config);\n+        this.suitabilityChecker = new CachedResponseSuitabilityChecker(this.validityPolicy, this.cacheConfig);\n         this.conditionalRequestBuilder = new ConditionalRequestBuilder();\n         this.responseCompliance = new ResponseProtocolCompliance();\n-        this.requestCompliance = new RequestProtocolCompliance(config.isWeakETagOnPutDeleteAllowed());\n+        this.requestCompliance = new RequestProtocolCompliance(this.cacheConfig.isWeakETagOnPutDeleteAllowed());\n         this.responseCachingPolicy = new ResponseCachingPolicy(\n                 this.cacheConfig.getMaxObjectSize(), this.cacheConfig.isSharedCache(),\n                 this.cacheConfig.isNeverCacheHTTP10ResponsesWithQuery(), this.cacheConfig.is303CachingEnabled());"
            },
            {
                "sha": "aacd68c035cacdceee9364d0edfd6c4c77b1e749",
                "filename": "httpclient-cache/src/test/java/org/apache/http/impl/client/cache/TestRFC5861Compliance.java",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/67a1cc719969e0f4604cb3a34cb2ba42e1c4caa1/httpclient-cache/src/test/java/org/apache/http/impl/client/cache/TestRFC5861Compliance.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/67a1cc719969e0f4604cb3a34cb2ba42e1c4caa1/httpclient-cache/src/test/java/org/apache/http/impl/client/cache/TestRFC5861Compliance.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient-cache/src/test/java/org/apache/http/impl/client/cache/TestRFC5861Compliance.java?ref=67a1cc719969e0f4604cb3a34cb2ba42e1c4caa1",
                "patch": "@@ -366,6 +366,11 @@ public void testStaleWhileRevalidateReturnsStaleEntryWithWarning()\n         assertTrue(warning110Found);\n     }\n \n+    @Test\n+    public void testHTTPCLIENT1470() {\n+        impl = new CachingExec(mockBackend, cache, null, new AsynchronousValidator(config));\n+    }\n+\n     @Test\n     public void testStaleWhileRevalidateReturnsStaleNonRevalidatableEntryWithWarning()\n         throws Exception {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/9cc7c1acecb5ce7af867718f0d1933b3bdf3c3f1",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/037b915bd094e1c1c17b442cda92e822e90c0f59",
        "message": "HTTPCLIENT-1440: 'file' scheme in redirect location URI causes NPE.\nContributed by James Leigh <james at 3roundstones dot com>\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1546315 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_17",
        "file": [
            {
                "sha": "706677632793bf5a7b45c9a49f4e76d2f98a5bcb",
                "filename": "RELEASE_NOTES.txt",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/9cc7c1acecb5ce7af867718f0d1933b3bdf3c3f1/RELEASE_NOTES.txt",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/9cc7c1acecb5ce7af867718f0d1933b3bdf3c3f1/RELEASE_NOTES.txt",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/RELEASE_NOTES.txt?ref=9cc7c1acecb5ce7af867718f0d1933b3bdf3c3f1",
                "patch": "@@ -1,6 +1,9 @@\n Changes since 4.3.1\n -------------------\n \n+* [HTTPCLIENT-1440] 'file' scheme in redirect location URI causes NPE.\n+  Contributed by James Leigh <james at 3roundstones dot com>\n+\n * [HTTPCLIENT-1437] Made Executor#execute thread safe.\n   Contributed by Oleg Kalnichevski <olegk at apache.org>\n "
            },
            {
                "sha": "131f20d7af630579aa8b34cd041ca26578679f63",
                "filename": "httpclient/src/main/java/org/apache/http/client/utils/URIUtils.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/9cc7c1acecb5ce7af867718f0d1933b3bdf3c3f1/httpclient/src/main/java/org/apache/http/client/utils/URIUtils.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/9cc7c1acecb5ce7af867718f0d1933b3bdf3c3f1/httpclient/src/main/java/org/apache/http/client/utils/URIUtils.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/client/utils/URIUtils.java?ref=9cc7c1acecb5ce7af867718f0d1933b3bdf3c3f1",
                "patch": "@@ -259,7 +259,8 @@ private static URI resolveReferenceStartingWithQueryString(\n      * @return the URI without dot segments\n      */\n     private static URI normalizeSyntax(final URI uri) {\n-        if (uri.isOpaque()) {\n+        if (uri.isOpaque() || uri.getAuthority() == null) {\n+            // opaque and file: URIs\n             return uri;\n         }\n         Args.check(uri.isAbsolute(), \"Base URI must be absolute\");"
            },
            {
                "sha": "6050061a6808c7a90fb8e7b409253a537c9d87a2",
                "filename": "httpclient/src/test/java/org/apache/http/client/utils/TestURIUtils.java",
                "status": "modified",
                "additions": 14,
                "deletions": 0,
                "changes": 14,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/9cc7c1acecb5ce7af867718f0d1933b3bdf3c3f1/httpclient/src/test/java/org/apache/http/client/utils/TestURIUtils.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/9cc7c1acecb5ce7af867718f0d1933b3bdf3c3f1/httpclient/src/test/java/org/apache/http/client/utils/TestURIUtils.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/test/java/org/apache/http/client/utils/TestURIUtils.java?ref=9cc7c1acecb5ce7af867718f0d1933b3bdf3c3f1",
                "patch": "@@ -173,6 +173,20 @@ public void testResolve() {\n                 \"http://s/mid/content=5/../6\").toString());\n     }\n \n+    @Test\n+    public void testResolveOpaque() {\n+        Assert.assertEquals(\"example://a/b/c/%7Bfoo%7D\", URIUtils.resolve(this.baseURI, \"eXAMPLE://a/./b/../b/%63/%7bfoo%7d\").toString());\n+        Assert.assertEquals(\"file://localhost/etc/fstab\", URIUtils.resolve(this.baseURI, \"file://localhost/etc/fstab\").toString());\n+        Assert.assertEquals(\"file:///etc/fstab\", URIUtils.resolve(this.baseURI, \"file:///etc/fstab\").toString());\n+        Assert.assertEquals(\"file://localhost/c:/WINDOWS/clock.avi\", URIUtils.resolve(this.baseURI, \"file://localhost/c:/WINDOWS/clock.avi\").toString());\n+        Assert.assertEquals(\"file:///c:/WINDOWS/clock.avi\", URIUtils.resolve(this.baseURI, \"file:///c:/WINDOWS/clock.avi\").toString());\n+        Assert.assertEquals(\"file://hostname/path/to/the%20file.txt\", URIUtils.resolve(this.baseURI, \"file://hostname/path/to/the%20file.txt\").toString());\n+        Assert.assertEquals(\"file:///c:/path/to/the%20file.txt\", URIUtils.resolve(this.baseURI, \"file:///c:/path/to/the%20file.txt\").toString());\n+        Assert.assertEquals(\"urn:issn:1535-3613\", URIUtils.resolve(this.baseURI, \"urn:issn:1535-3613\").toString());\n+        Assert.assertEquals(\"mailto:user@example.com\", URIUtils.resolve(this.baseURI, \"mailto:user@example.com\").toString());\n+        Assert.assertEquals(\"ftp://example.org/resource.txt\", URIUtils.resolve(this.baseURI, \"ftp://example.org/resource.txt\").toString());\n+    }\n+\n     @Test\n     public void testExtractHost() throws Exception {\n         Assert.assertEquals(new HttpHost(\"localhost\"),"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/4f03bedbf81d4a94d31542464598138243e255f8",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/df36e1087cb3673ff7aac01fe7ff08f91e43422c",
        "message": "HTTPCLIENT-1417: Fixed NPE in BrowserCompatSpec#formatCookies caused by version 1 cookies with null cookie value\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1530218 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_18",
        "file": [
            {
                "sha": "ad9b5ee8fb1c20056311ca09410599b01adbd962",
                "filename": "RELEASE_NOTES.txt",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/4f03bedbf81d4a94d31542464598138243e255f8/RELEASE_NOTES.txt",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/4f03bedbf81d4a94d31542464598138243e255f8/RELEASE_NOTES.txt",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/RELEASE_NOTES.txt?ref=4f03bedbf81d4a94d31542464598138243e255f8",
                "patch": "@@ -1,6 +1,10 @@\n-Changes sicne 4.3.1\n+Changes since 4.3.1\n -------------------\n \n+* [HTTPCLIENT-1417] Fixed NPE in BrowserCompatSpec#formatCookies caused by version 1\n+  cookies with null cookie value.\n+  Contributed by Oleg Kalnichevski <olegk at apache.org>\n+\n * [HTTPCLIENT-1416] Fixed NPE in CachingHttpClientBuilder#build().\n   Contributed by Oleg Kalnichevski <olegk at apache.org>\n "
            },
            {
                "sha": "ce5e2830d0fd48f61d3550384716da3a3bb3918d",
                "filename": "httpclient/src/main/java/org/apache/http/impl/cookie/BrowserCompatSpec.java",
                "status": "modified",
                "additions": 5,
                "deletions": 2,
                "changes": 7,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/4f03bedbf81d4a94d31542464598138243e255f8/httpclient/src/main/java/org/apache/http/impl/cookie/BrowserCompatSpec.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/4f03bedbf81d4a94d31542464598138243e255f8/httpclient/src/main/java/org/apache/http/impl/cookie/BrowserCompatSpec.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/impl/cookie/BrowserCompatSpec.java?ref=4f03bedbf81d4a94d31542464598138243e255f8",
                "patch": "@@ -168,6 +168,10 @@ public BrowserCompatSpec() {\n         return parse(helems, origin);\n     }\n \n+    private static boolean isQuoteEnclosed(final String s) {\n+        return s != null && s.startsWith(\"\\\"\") && s.endsWith(\"\\\"\");\n+    }\n+\n     public List<Header> formatCookies(final List<Cookie> cookies) {\n         Args.notEmpty(cookies, \"List of cookies\");\n         final CharArrayBuffer buffer = new CharArrayBuffer(20 * cookies.size());\n@@ -180,8 +184,7 @@ public BrowserCompatSpec() {\n             }\n             final String cookieName = cookie.getName();\n             final String cookieValue = cookie.getValue();\n-            if (cookie.getVersion() > 0 &&\n-                    !(cookieValue.startsWith(\"\\\"\") && cookieValue.endsWith(\"\\\"\"))) {\n+            if (cookie.getVersion() > 0 && !isQuoteEnclosed(cookieValue)) {\n                 BasicHeaderValueFormatter.INSTANCE.formatHeaderElement(\n                         buffer,\n                         new BasicHeaderElement(cookieName, cookieValue),"
            },
            {
                "sha": "3cb0c92af1210a8dd6e3877ab45b9342b6367fc2",
                "filename": "httpclient/src/test/java/org/apache/http/impl/cookie/TestBrowserCompatSpec.java",
                "status": "modified",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/4f03bedbf81d4a94d31542464598138243e255f8/httpclient/src/test/java/org/apache/http/impl/cookie/TestBrowserCompatSpec.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/4f03bedbf81d4a94d31542464598138243e255f8/httpclient/src/test/java/org/apache/http/impl/cookie/TestBrowserCompatSpec.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/test/java/org/apache/http/impl/cookie/TestBrowserCompatSpec.java?ref=4f03bedbf81d4a94d31542464598138243e255f8",
                "patch": "@@ -922,6 +922,24 @@ public void testNullCookieValueFormatting() {\n         Assert.assertEquals(\"name=\", headers.get(0).getValue());\n     }\n \n+    @Test\n+    public void testNullCookieValueFormattingCookieVersion1() {\n+        final BasicClientCookie cookie = new BasicClientCookie(\"name\", null);\n+        cookie.setVersion(1);\n+        cookie.setDomain(\".whatever.com\");\n+        cookie.setAttribute(ClientCookie.DOMAIN_ATTR, cookie.getDomain());\n+        cookie.setPath(\"/\");\n+        cookie.setAttribute(ClientCookie.PATH_ATTR, cookie.getPath());\n+\n+        final CookieSpec cookiespec = new BrowserCompatSpec();\n+        final List<Cookie> cookies = new ArrayList<Cookie>(1);\n+        cookies.add(cookie);\n+        final List<Header> headers = cookiespec.formatCookies(cookies);\n+        Assert.assertNotNull(headers);\n+        Assert.assertEquals(1, headers.size());\n+        Assert.assertEquals(\"name\", headers.get(0).getValue());\n+    }\n+\n     /**\n      * Tests generic cookie formatting.\n      */"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/bb902afa4fb4b6575e500c965c31cabf82791ec1",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/f17ef0ad1159c60933ba41adb927839f238d8fc3",
        "message": "Follow up to HTTPCLIENT-1381: fixes another NPE\nContributed by Ricardo Pereira <thc202 at gmail.com>\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1500401 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_19",
        "file": [
            {
                "sha": "b2fb4c9572ddbd9aff54fa60748425310d38f600",
                "filename": "httpclient/src/main/java/org/apache/http/impl/auth/NTLMEngineImpl.java",
                "status": "modified",
                "additions": 11,
                "deletions": 7,
                "changes": 18,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/bb902afa4fb4b6575e500c965c31cabf82791ec1/httpclient/src/main/java/org/apache/http/impl/auth/NTLMEngineImpl.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/bb902afa4fb4b6575e500c965c31cabf82791ec1/httpclient/src/main/java/org/apache/http/impl/auth/NTLMEngineImpl.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/impl/auth/NTLMEngineImpl.java?ref=bb902afa4fb4b6575e500c965c31cabf82791ec1",
                "patch": "@@ -624,7 +624,7 @@ public CipherGen(final String domain, final String user, final String password,\n             final MD4 md4 = new MD4();\n             md4.update(unicodePassword);\n             return md4.getOutput();\n-        } catch (java.io.UnsupportedEncodingException e) {\n+        } catch (UnsupportedEncodingException e) {\n             throw new NTLMEngineException(\"Unicode not supported: \" + e.getMessage(), e);\n         }\n     }\n@@ -641,9 +641,11 @@ public CipherGen(final String domain, final String user, final String password,\n             final HMACMD5 hmacMD5 = new HMACMD5(ntlmHash);\n             // Upper case username, upper case domain!\n             hmacMD5.update(user.toUpperCase(Locale.US).getBytes(\"UnicodeLittleUnmarked\"));\n-            hmacMD5.update(domain.toUpperCase(Locale.US).getBytes(\"UnicodeLittleUnmarked\"));\n+            if (domain != null) {\n+                hmacMD5.update(domain.toUpperCase(Locale.US).getBytes(\"UnicodeLittleUnmarked\"));\n+            }\n             return hmacMD5.getOutput();\n-        } catch (java.io.UnsupportedEncodingException e) {\n+        } catch (UnsupportedEncodingException e) {\n             throw new NTLMEngineException(\"Unicode not supported! \" + e.getMessage(), e);\n         }\n     }\n@@ -660,9 +662,11 @@ public CipherGen(final String domain, final String user, final String password,\n             final HMACMD5 hmacMD5 = new HMACMD5(ntlmHash);\n             // Upper case username, mixed case target!!\n             hmacMD5.update(user.toUpperCase(Locale.US).getBytes(\"UnicodeLittleUnmarked\"));\n-            hmacMD5.update(domain.getBytes(\"UnicodeLittleUnmarked\"));\n+            if (domain != null) {\n+                hmacMD5.update(domain.getBytes(\"UnicodeLittleUnmarked\"));\n+            }\n             return hmacMD5.getOutput();\n-        } catch (java.io.UnsupportedEncodingException e) {\n+        } catch (UnsupportedEncodingException e) {\n             throw new NTLMEngineException(\"Unicode not supported! \" + e.getMessage(), e);\n         }\n     }\n@@ -981,7 +985,7 @@ String getResponse() {\n                 hostBytes = unqualifiedHost != null? unqualifiedHost.getBytes(\"ASCII\") : null;\n                 domainBytes = unqualifiedDomain != null ? unqualifiedDomain\n                         .toUpperCase(Locale.US).getBytes(\"ASCII\") : null;\n-            } catch (java.io.UnsupportedEncodingException e) {\n+            } catch (UnsupportedEncodingException e) {\n                 throw new NTLMEngineException(\"Unicode unsupported: \" + e.getMessage(), e);\n             }\n         }\n@@ -1104,7 +1108,7 @@ String getResponse() {\n                 if (bytes.length != 0) {\n                     try {\n                         target = new String(bytes, \"UnicodeLittleUnmarked\");\n-                    } catch (java.io.UnsupportedEncodingException e) {\n+                    } catch (UnsupportedEncodingException e) {\n                         throw new NTLMEngineException(e.getMessage(), e);\n                     }\n                 }"
            },
            {
                "sha": "684b39bdc69152cf5bbfa44794492fce58a6274b",
                "filename": "httpclient/src/test/java/org/apache/http/impl/client/integration/TestClientAuthenticationFakeNTLM.java",
                "status": "modified",
                "additions": 38,
                "deletions": 6,
                "changes": 44,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/bb902afa4fb4b6575e500c965c31cabf82791ec1/httpclient/src/test/java/org/apache/http/impl/client/integration/TestClientAuthenticationFakeNTLM.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/bb902afa4fb4b6575e500c965c31cabf82791ec1/httpclient/src/test/java/org/apache/http/impl/client/integration/TestClientAuthenticationFakeNTLM.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/test/java/org/apache/http/impl/client/integration/TestClientAuthenticationFakeNTLM.java?ref=bb902afa4fb4b6575e500c965c31cabf82791ec1",
                "patch": "@@ -99,7 +99,13 @@ public void testNTLMAuthenticationFailure() throws Exception {\n                 response.getStatusLine().getStatusCode());\n     }\n \n-    static class NtlmType2ResponseHandler implements HttpRequestHandler {\n+    static class NtlmType2MessageResponseHandler implements HttpRequestHandler {\n+\n+        private final String authenticateHeaderValue;\n+\n+        public NtlmType2MessageResponseHandler(final String type2Message) {\n+            this.authenticateHeaderValue = \"NTLM \" + type2Message;\n+        }\n \n         public void handle(\n                 final HttpRequest request,\n@@ -113,16 +119,42 @@ public void handle(\n             if (!request.containsHeader(HttpHeaders.AUTHORIZATION)) {\n                 response.setHeader(HttpHeaders.WWW_AUTHENTICATE, \"NTLM\");\n             } else {\n-                response.setHeader(HttpHeaders.WWW_AUTHENTICATE, \"NTLM TlRMTVNTUAACAA\" +\n-                        \"AADAAMADgAAAAzwoICLgEjRWfCicKrw43DrwAAAAAAAAAAAAAAAAAAAAAGAHAX\" +\n-                        \"AAAAD1MAZQByAHYAZQByAA==\");\n+                response.setHeader(HttpHeaders.WWW_AUTHENTICATE, authenticateHeaderValue);\n             }\n         }\n     }\n \n     @Test\n-    public void testNTLMType2() throws Exception {\n-        this.localServer.register(\"*\", new NtlmType2ResponseHandler());\n+    public void testNTLMv1Type2Message() throws Exception {\n+        this.localServer.register(\"*\", new NtlmType2MessageResponseHandler(\"TlRMTVNTUAACAA\" +\n+                \"AADAAMADgAAAAzggLiASNFZ4mrze8AAAAAAAAAAAAAAAAAAAAABgBwFwAAAA9T\" +\n+                \"AGUAcgB2AGUAcgA=\"));\n+        this.localServer.start();\n+\n+        final BasicCredentialsProvider credsProvider = new BasicCredentialsProvider();\n+        credsProvider.setCredentials(AuthScope.ANY,\n+                new NTCredentials(\"test\", \"test\", null, null));\n+\n+        this.httpclient = HttpClients.custom()\n+                .setDefaultCredentialsProvider(credsProvider)\n+                .build();\n+\n+        final HttpContext context = HttpClientContext.create();\n+\n+        final HttpHost targethost = getServerHttp();\n+        final HttpGet httpget = new HttpGet(\"/\");\n+\n+        final HttpResponse response = this.httpclient.execute(targethost, httpget, context);\n+        EntityUtils.consume(response.getEntity());\n+        Assert.assertEquals(HttpStatus.SC_UNAUTHORIZED,\n+                response.getStatusLine().getStatusCode());\n+    }\n+\n+    @Test\n+    public void testNTLMv2Type2Message() throws Exception {\n+        this.localServer.register(\"*\", new NtlmType2MessageResponseHandler(\"TlRMTVNTUAACAA\" +\n+                \"AADAAMADgAAAAzgoriASNFZ4mrze8AAAAAAAAAACQAJABEAAAABgBwFwAAAA9T\" +\n+                \"AGUAcgB2AGUAcgACAAwARABvAG0AYQBpAG4AAQAMAFMAZQByAHYAZQByAAAAAAA=\"));\n         this.localServer.start();\n \n         final BasicCredentialsProvider credsProvider = new BasicCredentialsProvider();"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/3956b9f30fad4dced92ec5c68c7f14a4fd4d5d46",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/0533ce7c5315ae9a899664cc2066b788172b7417",
        "message": "Wrong field used; config parameter can be null which would cause NPE here\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1493755 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_20",
        "file": [
            {
                "sha": "72b837612f5a89101bb37f34a2ac9205648c40d9",
                "filename": "httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CachingExec.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/3956b9f30fad4dced92ec5c68c7f14a4fd4d5d46/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CachingExec.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/3956b9f30fad4dced92ec5c68c7f14a4fd4d5d46/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CachingExec.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CachingExec.java?ref=3956b9f30fad4dced92ec5c68c7f14a4fd4d5d46",
                "patch": "@@ -139,7 +139,7 @@ public CachingExec(\n         this.requestCompliance = new RequestProtocolCompliance();\n         this.responseCachingPolicy = new ResponseCachingPolicy(\n                 this.cacheConfig.getMaxObjectSize(), this.cacheConfig.isSharedCache(),\n-                this.cacheConfig.isNeverCacheHTTP10ResponsesWithQuery(), config.is303CachingEnabled());\n+                this.cacheConfig.isNeverCacheHTTP10ResponsesWithQuery(), this.cacheConfig.is303CachingEnabled());\n         this.asynchRevalidator = asynchRevalidator;\n     }\n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/52ddef91faef5529bbb4d3d358dfbf5f2a10c56e",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/531ac65cc9f22873a0954e52520c532516267999",
        "message": "[HTTPCLIENT-1365] NPE when ManagedHttpClientConnectionFactory.create(ConnectionConfig) is called with null. Contributed by Gary Gregory <ggregory at apache.org>\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1490299 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_21",
        "file": [
            {
                "sha": "6a10ed5c61fd879cf02948647a0ebd8a7f1c2576",
                "filename": "RELEASE_NOTES.txt",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/52ddef91faef5529bbb4d3d358dfbf5f2a10c56e/RELEASE_NOTES.txt",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/52ddef91faef5529bbb4d3d358dfbf5f2a10c56e/RELEASE_NOTES.txt",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/RELEASE_NOTES.txt?ref=52ddef91faef5529bbb4d3d358dfbf5f2a10c56e",
                "patch": "@@ -1,6 +1,9 @@\n Changes since release 4.3 BETA2\n -------------------\n \n+* [HTTPCLIENT-1365] NPE when ManagedHttpClientConnectionFactory.create(ConnectionConfig) is called with null.\n+  Contributed by Gary Gregory <ggregory at apache.org>\n+\n * [HTTPCLIENT-1362] Better error messages for connect timed out and connection refused \n   exceptions.\n   Contributed by Oleg Kalnichevski <olegk at apache.org>"
            },
            {
                "sha": "332449fbb38657b8dd848d08764a26ce800d510b",
                "filename": "httpclient/src/main/java/org/apache/http/impl/conn/ManagedHttpClientConnectionFactory.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/52ddef91faef5529bbb4d3d358dfbf5f2a10c56e/httpclient/src/main/java/org/apache/http/impl/conn/ManagedHttpClientConnectionFactory.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/52ddef91faef5529bbb4d3d358dfbf5f2a10c56e/httpclient/src/main/java/org/apache/http/impl/conn/ManagedHttpClientConnectionFactory.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/impl/conn/ManagedHttpClientConnectionFactory.java?ref=52ddef91faef5529bbb4d3d358dfbf5f2a10c56e",
                "patch": "@@ -104,8 +104,8 @@ public ManagedHttpClientConnection create(final ConnectionConfig config) {\n                 log,\n                 headerlog,\n                 wirelog,\n-                config.getBufferSize(),\n-                config.getFragmentSizeHint(),\n+                cconfig.getBufferSize(),\n+                cconfig.getFragmentSizeHint(),\n                 chardecoder,\n                 charencoder,\n                 cconfig.getMessageConstraints(),"
            },
            {
                "sha": "f09c5bbe9e90d4e35de81d19b939189df78dc1ca",
                "filename": "httpclient/src/test/java/org/apache/http/impl/conn/TestManagedHttpClientConnectionFactory.java",
                "status": "added",
                "additions": 52,
                "deletions": 0,
                "changes": 52,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/52ddef91faef5529bbb4d3d358dfbf5f2a10c56e/httpclient/src/test/java/org/apache/http/impl/conn/TestManagedHttpClientConnectionFactory.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/52ddef91faef5529bbb4d3d358dfbf5f2a10c56e/httpclient/src/test/java/org/apache/http/impl/conn/TestManagedHttpClientConnectionFactory.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/test/java/org/apache/http/impl/conn/TestManagedHttpClientConnectionFactory.java?ref=52ddef91faef5529bbb4d3d358dfbf5f2a10c56e",
                "patch": "@@ -0,0 +1,52 @@\n+/*\n+ * ====================================================================\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ * ====================================================================\n+ *\n+ * This software consists of voluntary contributions made by many\n+ * individuals on behalf of the Apache Software Foundation.  For more\n+ * information on the Apache Software Foundation, please see\n+ * <http://www.apache.org/>.\n+ *\n+ */\n+package org.apache.http.impl.conn;\n+\n+import junit.framework.Assert;\n+\n+import org.apache.http.config.ConnectionConfig;\n+import org.apache.http.conn.ManagedHttpClientConnection;\n+import org.junit.Test;\n+\n+public class TestManagedHttpClientConnectionFactory {\n+\n+    @Test\n+    public void testDefaultConnectionConfig() throws Exception {\n+        validateDefault(ManagedHttpClientConnectionFactory.INSTANCE.create(ConnectionConfig.DEFAULT));\n+    }\n+\n+    private void validateDefault(ManagedHttpClientConnection managedHttpClientConnection) {\n+        // Nothing really interesting to check here\n+        Assert.assertNotNull(managedHttpClientConnection.getId());\n+    }\n+\n+    @Test\n+    public void testNullConnectionConfig() throws Exception {\n+        // Should not NPE\n+        validateDefault(ManagedHttpClientConnectionFactory.INSTANCE.create(null));\n+    }\n+}"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/0730d6c7c97c8d3936ccb51af663757157002163",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/5bdd456c8c5c32accfecf086b264961ea29e4ceb",
        "message": "target cannot be null here otherwise the earlier invocation of target.getPort() would fail with NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1435320 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_22",
        "file": [
            {
                "sha": "214d87f24eb39a3989c704b1c4d30a50c7927d70",
                "filename": "httpclient/src/main/java/org/apache/http/client/protocol/RequestAuthCache.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/0730d6c7c97c8d3936ccb51af663757157002163/httpclient/src/main/java/org/apache/http/client/protocol/RequestAuthCache.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/0730d6c7c97c8d3936ccb51af663757157002163/httpclient/src/main/java/org/apache/http/client/protocol/RequestAuthCache.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/client/protocol/RequestAuthCache.java?ref=0730d6c7c97c8d3936ccb51af663757157002163",
                "patch": "@@ -92,7 +92,7 @@ public void process(final HttpRequest request, final HttpContext context)\n         }\n \n         final AuthState targetState = clientContext.getTargetAuthState();\n-        if (target != null && targetState != null && targetState.getState() == AuthProtocolState.UNCHALLENGED) {\n+        if (targetState != null && targetState.getState() == AuthProtocolState.UNCHALLENGED) {\n             final AuthScheme authScheme = authCache.get(target);\n             if (authScheme != null) {\n                 doPreemptiveAuth(target, authScheme, targetState, credsProvider);"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/2aa1fc14004a1669d00d4d50aebb1ecabe5b3fa3",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/12d11324c0c45725e5c7ed4ec068983b1115f956",
        "message": "HTTPCLIENT-1279: Target host responding with status 407 (proxy authentication required) causes an NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1423172 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_23",
        "file": [
            {
                "sha": "3b586fad7b03d69224eed521c51189c217cab724",
                "filename": "RELEASE_NOTES.txt",
                "status": "modified",
                "additions": 6,
                "deletions": 2,
                "changes": 8,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/2aa1fc14004a1669d00d4d50aebb1ecabe5b3fa3/RELEASE_NOTES.txt",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/2aa1fc14004a1669d00d4d50aebb1ecabe5b3fa3/RELEASE_NOTES.txt",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/RELEASE_NOTES.txt?ref=2aa1fc14004a1669d00d4d50aebb1ecabe5b3fa3",
                "patch": "@@ -1,8 +1,12 @@\n Changes in trunk\n -------------------\n \n-* [HTTPCLIENT-1281] GzipDecompressingEntity does not release InputStream when an IOException occurs \n-  while reading the Gzip header.\n+* [HTTPCLIENT-1279] Target host responding with status 407 (proxy authentication required)\n+  causes an NPE.\n+  Contributed by Oleg Kalnichevski <olegk at apache.org>\n+\n+* [HTTPCLIENT-1281] GzipDecompressingEntity does not release InputStream when an IOException\n+  occurs while reading the Gzip header.\n   Contributed by Francois-Xavier Bonnet <francois-xavier.bonnet at centraliens.net> \n \n * [HTTPCLIENT-1277] Caching client sends a 304 to an unconditional request. "
            },
            {
                "sha": "ddd9ab39ff58fdf0e2f9e9b576434b0de42e59ea",
                "filename": "httpclient/src/main/java/org/apache/http/impl/client/DefaultRequestDirector.java",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/2aa1fc14004a1669d00d4d50aebb1ecabe5b3fa3/httpclient/src/main/java/org/apache/http/impl/client/DefaultRequestDirector.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/2aa1fc14004a1669d00d4d50aebb1ecabe5b3fa3/httpclient/src/main/java/org/apache/http/impl/client/DefaultRequestDirector.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/impl/client/DefaultRequestDirector.java?ref=2aa1fc14004a1669d00d4d50aebb1ecabe5b3fa3",
                "patch": "@@ -1075,6 +1075,10 @@ protected RoutedRequest handleResponse(RoutedRequest roureq,\n             HttpHost proxy = route.getProxyHost();\n             if (this.authenticator.isAuthenticationRequested(proxy, response,\n                     this.proxyAuthStrategy, this.proxyAuthState, context)) {\n+                // if proxy is not set use target host instead\n+                if (proxy == null) {\n+                    proxy = route.getTargetHost();\n+                }\n                 if (this.authenticator.authenticate(proxy, response,\n                         this.proxyAuthStrategy, this.proxyAuthState, context)) {\n                     // Re-try the same request via the same route"
            },
            {
                "sha": "924b3880c38b0940737bec6b4eb89b1fd5630086",
                "filename": "httpclient/src/main/java/org/apache/http/impl/client/execchain/MainClientExec.java",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/2aa1fc14004a1669d00d4d50aebb1ecabe5b3fa3/httpclient/src/main/java/org/apache/http/impl/client/execchain/MainClientExec.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/2aa1fc14004a1669d00d4d50aebb1ecabe5b3fa3/httpclient/src/main/java/org/apache/http/impl/client/execchain/MainClientExec.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/impl/client/execchain/MainClientExec.java?ref=2aa1fc14004a1669d00d4d50aebb1ecabe5b3fa3",
                "patch": "@@ -567,6 +567,10 @@ private boolean needAuthentication(\n             HttpHost proxy = route.getProxyHost();\n             if (this.authenticator.isAuthenticationRequested(proxy, response,\n                     this.proxyAuthStrategy, proxyAuthState, context)) {\n+                // if proxy is not set use target host instead\n+                if (proxy == null) {\n+                    proxy = route.getTargetHost();\n+                }\n                 return this.authenticator.handleAuthChallenge(proxy, response,\n                         this.proxyAuthStrategy, proxyAuthState, context);\n             }"
            },
            {
                "sha": "7d884bcdc7510a7707d8be02f2ffcf4d6945aa6d",
                "filename": "httpclient/src/test/java/org/apache/http/impl/client/integration/TestClientAuthentication.java",
                "status": "modified",
                "additions": 34,
                "deletions": 0,
                "changes": 34,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/2aa1fc14004a1669d00d4d50aebb1ecabe5b3fa3/httpclient/src/test/java/org/apache/http/impl/client/integration/TestClientAuthentication.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/2aa1fc14004a1669d00d4d50aebb1ecabe5b3fa3/httpclient/src/test/java/org/apache/http/impl/client/integration/TestClientAuthentication.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/test/java/org/apache/http/impl/client/integration/TestClientAuthentication.java?ref=2aa1fc14004a1669d00d4d50aebb1ecabe5b3fa3",
                "patch": "@@ -513,4 +513,38 @@ public void testPreemptiveAuthenticationFailure() throws Exception {\n         Assert.assertEquals(1, requestHandler.getCount());\n     }\n \n+    static class ProxyAuthHandler implements HttpRequestHandler {\n+\n+        public void handle(\n+                final HttpRequest request,\n+                final HttpResponse response,\n+                final HttpContext context) throws HttpException, IOException {\n+            String creds = (String) context.getAttribute(\"creds\");\n+            if (creds == null || !creds.equals(\"test:test\")) {\n+                response.setStatusCode(HttpStatus.SC_PROXY_AUTHENTICATION_REQUIRED);\n+            } else {\n+                response.setStatusCode(HttpStatus.SC_OK);\n+                StringEntity entity = new StringEntity(\"success\", Consts.ASCII);\n+                response.setEntity(entity);\n+            }\n+        }\n+\n+    }\n+\n+    @Test\n+    public void testAuthenticationTargetAsProxy() throws Exception {\n+        this.localServer.register(\"*\", new ProxyAuthHandler());\n+\n+        TestCredentialsProvider credsProvider = new TestCredentialsProvider(null);\n+        this.httpclient = HttpClients.custom().setCredentialsProvider(credsProvider).build();\n+\n+        HttpGet httpget = new HttpGet(\"/\");\n+\n+        HttpResponse response = this.httpclient.execute(getServerHttp(), httpget);\n+        HttpEntity entity = response.getEntity();\n+        Assert.assertEquals(HttpStatus.SC_PROXY_AUTHENTICATION_REQUIRED,\n+                response.getStatusLine().getStatusCode());\n+        EntityUtils.consume(entity);\n+    }\n+\n }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/1779158a4f24b524d51216b656176c74dd23d6b4",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/bfbc573cbddfe2c607771faf02c905b837769eb9",
        "message": "HTTPCLIENT-1276: cache update on a 304 response causes NPE\nContributed by Francois-Xavier Bonnet <francois-xavier.bonnet at centraliens.net>\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1421330 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_24",
        "file": [
            {
                "sha": "abb953d2fe42f88141cd185be1ab91c191ef8f27",
                "filename": "RELEASE_NOTES.txt",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/1779158a4f24b524d51216b656176c74dd23d6b4/RELEASE_NOTES.txt",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/1779158a4f24b524d51216b656176c74dd23d6b4/RELEASE_NOTES.txt",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/RELEASE_NOTES.txt?ref=1779158a4f24b524d51216b656176c74dd23d6b4",
                "patch": "@@ -1,6 +1,9 @@\n Changes in trunk\n -------------------\n \n+* [HTTPCLIENT-1276] Cache update on a 304 response causes NPE. \n+  Contributed by Francois-Xavier Bonnet <francois-xavier.bonnet at centraliens.net> \n+\n * [HTTPCLIENT-1273] DecompressingHttpClient does not automatically consume response \n   content in case of an i/o, HTTP or runtime exception thrown by the decompressing \n   protocol interceptor leading to a potential connection leak. "
            },
            {
                "sha": "5987e499df295944fa103a751fd09167833680ad",
                "filename": "httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CacheEntity.java",
                "status": "modified",
                "additions": 1,
                "deletions": 3,
                "changes": 4,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/1779158a4f24b524d51216b656176c74dd23d6b4/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CacheEntity.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/1779158a4f24b524d51216b656176c74dd23d6b4/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CacheEntity.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CacheEntity.java?ref=1779158a4f24b524d51216b656176c74dd23d6b4",
                "patch": "@@ -35,7 +35,6 @@\n import org.apache.http.HttpEntity;\n import org.apache.http.annotation.Immutable;\n import org.apache.http.client.cache.HttpCacheEntry;\n-import org.apache.http.client.cache.Resource;\n import org.apache.http.protocol.HTTP;\n \n @Immutable\n@@ -67,8 +66,7 @@ public boolean isRepeatable() {\n     }\n \n     public long getContentLength() {\n-        Resource resource = this.cacheEntry.getResource();\n-\t\treturn (resource != null) ? resource.length() : 0L;\n+\t\treturn this.cacheEntry.getResource().length();\n     }\n \n     public InputStream getContent() throws IOException {"
            },
            {
                "sha": "87a8f152ae05cb961907d7afe87428c31cc3fd47",
                "filename": "httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CacheEntryUpdater.java",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/1779158a4f24b524d51216b656176c74dd23d6b4/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CacheEntryUpdater.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/1779158a4f24b524d51216b656176c74dd23d6b4/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CacheEntryUpdater.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CacheEntryUpdater.java?ref=1779158a4f24b524d51216b656176c74dd23d6b4",
                "patch": "@@ -87,7 +87,12 @@ public HttpCacheEntry updateCacheEntry(\n         if (response.getStatusLine().getStatusCode() != HttpStatus.SC_NOT_MODIFIED)\n             throw new IllegalArgumentException(\"Response must have 304 status code\");\n         Header[] mergedHeaders = mergeHeaders(entry, response);\n-        Resource resource = resourceFactory.copy(requestId, entry.getResource());\n+        Resource oldResource = entry.getResource();\n+        Resource resource = null;\n+        if (oldResource != null) {\n+            resource = resourceFactory.copy(requestId, entry.getResource());\n+            oldResource.dispose();\n+        }\n         return new HttpCacheEntry(\n                 requestDate,\n                 responseDate,"
            },
            {
                "sha": "51981dba7daba0dbee73bbe32d3a222fd3402713",
                "filename": "httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CachedHttpResponseGenerator.java",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/1779158a4f24b524d51216b656176c74dd23d6b4/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CachedHttpResponseGenerator.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/1779158a4f24b524d51216b656176c74dd23d6b4/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CachedHttpResponseGenerator.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient-cache/src/main/java/org/apache/http/impl/client/cache/CachedHttpResponseGenerator.java?ref=1779158a4f24b524d51216b656176c74dd23d6b4",
                "patch": "@@ -73,11 +73,13 @@ HttpResponse generateResponse(HttpCacheEntry entry) {\n         HttpResponse response = new BasicHttpResponse(HttpVersion.HTTP_1_1, entry\n                 .getStatusCode(), entry.getReasonPhrase());\n \n-        HttpEntity entity = new CacheEntity(entry);\n         response.setHeaders(entry.getAllHeaders());\n-        addMissingContentLengthHeader(response, entity);\n-        response.setEntity(entity);\n \n+        if (entry.getResource() != null) {\n+            HttpEntity entity = new CacheEntity(entry);\n+            addMissingContentLengthHeader(response, entity);\n+            response.setEntity(entity);\n+        }\n \n         long age = this.validityStrategy.getCurrentAgeSecs(entry, now);\n         if (age > 0) {"
            },
            {
                "sha": "004e16f92389fa502da7b217ef7bbd5e89762c14",
                "filename": "httpclient-cache/src/test/java/org/apache/http/impl/client/cache/TestCachingExec.java",
                "status": "modified",
                "additions": 67,
                "deletions": 1,
                "changes": 68,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/1779158a4f24b524d51216b656176c74dd23d6b4/httpclient-cache/src/test/java/org/apache/http/impl/client/cache/TestCachingExec.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/1779158a4f24b524d51216b656176c74dd23d6b4/httpclient-cache/src/test/java/org/apache/http/impl/client/cache/TestCachingExec.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient-cache/src/test/java/org/apache/http/impl/client/cache/TestCachingExec.java?ref=1779158a4f24b524d51216b656176c74dd23d6b4",
                "patch": "@@ -27,12 +27,12 @@\n package org.apache.http.impl.client.cache;\n \n import static org.easymock.EasyMock.anyObject;\n+import static org.easymock.EasyMock.eq;\n import static org.easymock.EasyMock.expect;\n import static org.easymock.EasyMock.expectLastCall;\n import static org.easymock.EasyMock.isA;\n import static org.easymock.EasyMock.isNull;\n import static org.easymock.EasyMock.same;\n-import static org.easymock.EasyMock.eq;\n import static org.easymock.classextension.EasyMock.createMockBuilder;\n import static org.easymock.classextension.EasyMock.createNiceMock;\n import static org.easymock.classextension.EasyMock.replay;\n@@ -1527,6 +1527,72 @@ public void testCanCacheAResponseWithoutABody() throws Exception {\n         assertEquals(1, backend.getExecutions());\n     }\n \n+\t@Test\n+\tpublic void testNoEntityForIfNoneMatchRequestNotYetInCache() throws Exception {\n+\n+\t\tDate now = new Date();\n+\t\tDate tenSecondsAgo = new Date(now.getTime() - 10 * 1000L);\n+\n+\t\timpl = new CachingExec(mockBackend, new BasicHttpCache(),\n+\t\t\t\tCacheConfig.DEFAULT);\n+\t\tHttpRequestWrapper req1 = HttpRequestWrapper.wrap(new HttpGet(\n+\t\t\t\t\"http://foo.example.com/\"));\n+\t\treq1.addHeader(\"If-None-Match\", \"\\\"etag\\\"\");\n+\n+\t\tHttpResponse resp1 = new BasicHttpResponse(HttpVersion.HTTP_1_1,\n+\t\t\t\tHttpStatus.SC_NOT_MODIFIED, \"Not modified\");\n+\t\tresp1.setHeader(\"Content-Length\", \"128\");\n+\t\tresp1.setHeader(\"ETag\", \"\\\"etag\\\"\");\n+\t\tresp1.setHeader(\"Date\", DateUtils.formatDate(tenSecondsAgo));\n+\t\tresp1.setHeader(\"Cache-Control\", \"public, max-age=5\");\n+\n+\t\tbackendExpectsAnyRequestAndReturn(resp1);\n+\t\treplayMocks();\n+\t\tHttpResponse result = impl.execute(route, req1);\n+\t\tverifyMocks();\n+\n+\t\tassertEquals(HttpStatus.SC_NOT_MODIFIED, result.getStatusLine()\n+\t\t\t\t.getStatusCode());\n+\t\tassertNull(\"The 304 response messages MUST NOT contain a message-body\",\n+\t\t\t\tresult.getEntity());\n+\t}\n+\n+\t@Test\n+\tpublic void testNotModifiedResponseUpdatesCacheEntryWhenNoEntity() throws Exception {\n+\n+\t\tDate now = new Date();\n+\n+\t\timpl = new CachingExec(mockBackend, new BasicHttpCache(),CacheConfig.DEFAULT);\n+\n+\t\tHttpRequestWrapper req1 = HttpRequestWrapper.wrap(new HttpGet(\"http://foo.example.com/\"));\n+\t\treq1.addHeader(\"If-None-Match\", \"etag\");\n+\n+\t\tHttpRequestWrapper req2 = HttpRequestWrapper.wrap(new HttpGet(\"http://foo.example.com/\"));\n+\t\treq2.addHeader(\"If-None-Match\", \"etag\");\n+\n+\t\tHttpResponse resp1 = new BasicHttpResponse(HttpVersion.HTTP_1_1, HttpStatus.SC_NOT_MODIFIED, \"Not modified\");\n+\t\tresp1.setHeader(\"Date\", DateUtils.formatDate(now));\n+\t\tresp1.setHeader(\"Cache-Control\",\"max-age=0\");\n+\t\tresp1.setHeader(\"Etag\", \"etag\");\n+\n+\t\tHttpResponse resp2 = new BasicHttpResponse(HttpVersion.HTTP_1_1, HttpStatus.SC_NOT_MODIFIED, \"Not modified\");\n+\t\tresp2.setHeader(\"Date\", DateUtils.formatDate(now));\n+\t\tresp2.setHeader(\"Cache-Control\",\"max-age=0\");\n+\t\tresp1.setHeader(\"Etag\", \"etag\");\n+\n+\t\tbackendExpectsAnyRequestAndReturn(resp1);\n+\t\tbackendExpectsAnyRequestAndReturn(resp2);\n+\t\treplayMocks();\n+\t\tHttpResponse result1 = impl.execute(route, req1);\n+\t\tHttpResponse result2 = impl.execute(route, req2);\n+\t\tverifyMocks();\n+\n+\t\tassertEquals(HttpStatus.SC_NOT_MODIFIED, result1.getStatusLine().getStatusCode());\n+\t\tassertEquals(\"etag\", result1.getFirstHeader(\"Etag\").getValue());\n+\t\tassertEquals(HttpStatus.SC_NOT_MODIFIED, result2.getStatusLine().getStatusCode());\n+\t\tassertEquals(\"etag\", result2.getFirstHeader(\"Etag\").getValue());\n+\t}\n+\n     private IExpectationSetters<CloseableHttpResponse> backendExpectsAnyRequestAndReturn(\n             HttpResponse response) throws Exception {\n         CloseableHttpResponse resp = mockBackend.execute("
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/4d38bede89b4c3112c8258a7833c2a16d59133b4",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/e42006ea27aed09f96324b13018cea50898a135a",
        "message": "HTTPCLIENT-1229: Fixed NPE in BasicClientConnectionManager that can be triggered by releasing connection after the connection manager has already been shut down\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1382442 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_25",
        "file": [
            {
                "sha": "b725a6a8d55e9542073f04bfb90e4238fb097f7a",
                "filename": "RELEASE_NOTES.txt",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/4d38bede89b4c3112c8258a7833c2a16d59133b4/RELEASE_NOTES.txt",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/4d38bede89b4c3112c8258a7833c2a16d59133b4/RELEASE_NOTES.txt",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/RELEASE_NOTES.txt?ref=4d38bede89b4c3112c8258a7833c2a16d59133b4",
                "patch": "@@ -1,6 +1,10 @@\n Changes since 4.2.1 \n -------------------\n \n+* [HTTPCLIENT-1229] Fixed NPE in BasicClientConnectionManager that can be triggered by releasing\n+  connection after the connection manager has already been shut down. \n+  Contributed by Oleg Kalnichevski <olegk at apache.org>\n+\n * [HTTPCLIENT-1227] Date parsing in DateUtils made more efficient.\n   Contributed by Patrick Linskey <pcl at apache.org>\n "
            },
            {
                "sha": "8dc990105f036c6af3e053f0e385f8d57ca0b127",
                "filename": "httpclient/src/main/java/org/apache/http/impl/conn/BasicClientConnectionManager.java",
                "status": "modified",
                "additions": 26,
                "deletions": 18,
                "changes": 44,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/4d38bede89b4c3112c8258a7833c2a16d59133b4/httpclient/src/main/java/org/apache/http/impl/conn/BasicClientConnectionManager.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/4d38bede89b4c3112c8258a7833c2a16d59133b4/httpclient/src/main/java/org/apache/http/impl/conn/BasicClientConnectionManager.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/impl/conn/BasicClientConnectionManager.java?ref=4d38bede89b4c3112c8258a7833c2a16d59133b4",
                "patch": "@@ -33,6 +33,7 @@\n \n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n+import org.apache.http.HttpClientConnection;\n import org.apache.http.annotation.GuardedBy;\n import org.apache.http.annotation.ThreadSafe;\n import org.apache.http.conn.ClientConnectionManager;\n@@ -152,11 +153,11 @@ ManagedClientConnection getConnection(final HttpRoute route, final Object state)\n         if (route == null) {\n             throw new IllegalArgumentException(\"Route may not be null.\");\n         }\n-        assertNotShutdown();\n-        if (this.log.isDebugEnabled()) {\n-            this.log.debug(\"Get connection for route \" + route);\n-        }\n         synchronized (this) {\n+            assertNotShutdown();\n+            if (this.log.isDebugEnabled()) {\n+                this.log.debug(\"Get connection for route \" + route);\n+            }\n             if (this.conn != null) {\n                 throw new IllegalStateException(MISUSE_MESSAGE);\n             }\n@@ -179,17 +180,26 @@ ManagedClientConnection getConnection(final HttpRoute route, final Object state)\n         }\n     }\n \n+    private void shutdownConnection(final HttpClientConnection conn) {\n+        try {\n+            conn.shutdown();\n+        } catch (IOException iox) {\n+            if (this.log.isDebugEnabled()) {\n+                this.log.debug(\"I/O exception shutting down connection\", iox);\n+            }\n+        }\n+    }\n+    \n     public void releaseConnection(final ManagedClientConnection conn, long keepalive, TimeUnit tunit) {\n-        assertNotShutdown();\n         if (!(conn instanceof ManagedClientConnectionImpl)) {\n             throw new IllegalArgumentException(\"Connection class mismatch, \" +\n                  \"connection not obtained from this manager\");\n         }\n-        if (this.log.isDebugEnabled()) {\n-            this.log.debug(\"Releasing connection \" + conn);\n-        }\n         ManagedClientConnectionImpl managedConn = (ManagedClientConnectionImpl) conn;\n         synchronized (managedConn) {\n+            if (this.log.isDebugEnabled()) {\n+                this.log.debug(\"Releasing connection \" + conn);\n+            }\n             if (managedConn.getPoolEntry() == null) {\n                 return; // already released\n             }\n@@ -198,15 +208,13 @@ public void releaseConnection(final ManagedClientConnection conn, long keepalive\n                 throw new IllegalStateException(\"Connection not obtained from this manager\");\n             }\n             synchronized (this) {\n+                if (this.shutdown) {\n+                    shutdownConnection(managedConn);\n+                    return;\n+                }\n                 try {\n                     if (managedConn.isOpen() && !managedConn.isMarkedReusable()) {\n-                        try {\n-                            managedConn.shutdown();\n-                        } catch (IOException iox) {\n-                            if (this.log.isDebugEnabled()) {\n-                                this.log.debug(\"I/O exception shutting down released connection\", iox);\n-                            }\n-                        }\n+                        shutdownConnection(managedConn);\n                     }\n                     this.poolEntry.updateExpiry(keepalive, tunit != null ? tunit : TimeUnit.MILLISECONDS);\n                     if (this.log.isDebugEnabled()) {\n@@ -230,8 +238,8 @@ public void releaseConnection(final ManagedClientConnection conn, long keepalive\n     }\n \n     public void closeExpiredConnections() {\n-        assertNotShutdown();\n         synchronized (this) {\n+            assertNotShutdown();\n             long now = System.currentTimeMillis();\n             if (this.poolEntry != null && this.poolEntry.isExpired(now)) {\n                 this.poolEntry.close();\n@@ -244,8 +252,8 @@ public void closeIdleConnections(long idletime, TimeUnit tunit) {\n         if (tunit == null) {\n             throw new IllegalArgumentException(\"Time unit must not be null.\");\n         }\n-        assertNotShutdown();\n         synchronized (this) {\n+            assertNotShutdown();\n             long time = tunit.toMillis(idletime);\n             if (time < 0) {\n                 time = 0;\n@@ -259,8 +267,8 @@ public void closeIdleConnections(long idletime, TimeUnit tunit) {\n     }\n \n     public void shutdown() {\n-        this.shutdown = true;\n         synchronized (this) {\n+            this.shutdown = true;\n             try {\n                 if (this.poolEntry != null) {\n                     this.poolEntry.close();"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/13f31eb2dbeee32367558692ee9ab0a59d7b2d14",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/bb0ecdbcb43d8c36e3df95f67c6b1f3fe77e1d84",
        "message": "HTTPCLIENT-936: Fixed bug causing NPE or an infinite loop in the authentication code in case of a SPNEGO authentication failure\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@943620 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_26",
        "file": [
            {
                "sha": "4ace86fd2a2e14d5fe948a9080f2b48a410e9079",
                "filename": "RELEASE_NOTES.txt",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/13f31eb2dbeee32367558692ee9ab0a59d7b2d14/RELEASE_NOTES.txt",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/13f31eb2dbeee32367558692ee9ab0a59d7b2d14/RELEASE_NOTES.txt",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/RELEASE_NOTES.txt?ref=13f31eb2dbeee32367558692ee9ab0a59d7b2d14",
                "patch": "@@ -22,6 +22,10 @@ maintained as of 4.1 GA release.\n Changelog\n -------------------\n \n+* [HTTPCLIENT-936] Fixed bug causing NPE or an infinite loop in \n+  the authentication code in case of a SPNEGO authentication failure. \n+  Contributed by Oleg Kalnichevski <olegk at apache.org>\n+\n * [HTTPCLIENT-427] HTTP caching support\n   Contributed by Joe Campbell, David Cleaver, David Mays, Jon Moore, Brad Spenla\n "
            },
            {
                "sha": "74b458c3f78e33af48ac08007d297fc4996f550c",
                "filename": "httpclient-cache/src/test/java/org/apache/http/client/cache/impl/HttpTestUtils.java",
                "status": "modified",
                "additions": 11,
                "deletions": 1,
                "changes": 12,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/13f31eb2dbeee32367558692ee9ab0a59d7b2d14/httpclient-cache/src/test/java/org/apache/http/client/cache/impl/HttpTestUtils.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/13f31eb2dbeee32367558692ee9ab0a59d7b2d14/httpclient-cache/src/test/java/org/apache/http/client/cache/impl/HttpTestUtils.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient-cache/src/test/java/org/apache/http/client/cache/impl/HttpTestUtils.java?ref=13f31eb2dbeee32367558692ee9ab0a59d7b2d14",
                "patch": "@@ -78,6 +78,17 @@ public static boolean isHopByHopHeader(String name) {\n         return false;\n     }\n \n+    /*\n+     * Determines whether a given header name may appear multiple times.\n+     */\n+    public static boolean isMultiHeader(String name) {\n+        for (String s : MULTI_HEADERS) {\n+            if (s.equalsIgnoreCase(name))\n+                return true;\n+        }\n+        return false;\n+    }\n+\n     /*\n      * Determines whether a given header name may only appear once in a message.\n      */\n@@ -88,7 +99,6 @@ public static boolean isSingleHeader(String name) {\n         }\n         return false;\n     }\n-\n     /*\n      * Assert.asserts that two request or response bodies are byte-equivalent.\n      */"
            },
            {
                "sha": "2a458a7a8633be69ff037b798e17003a6de240ee",
                "filename": "httpclient-cache/src/test/java/org/apache/http/client/cache/impl/TestCacheEntry.java",
                "status": "modified",
                "additions": 1,
                "deletions": 4,
                "changes": 5,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/13f31eb2dbeee32367558692ee9ab0a59d7b2d14/httpclient-cache/src/test/java/org/apache/http/client/cache/impl/TestCacheEntry.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/13f31eb2dbeee32367558692ee9ab0a59d7b2d14/httpclient-cache/src/test/java/org/apache/http/client/cache/impl/TestCacheEntry.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient-cache/src/test/java/org/apache/http/client/cache/impl/TestCacheEntry.java?ref=13f31eb2dbeee32367558692ee9ab0a59d7b2d14",
                "patch": "@@ -26,8 +26,6 @@\n  */\n package org.apache.http.client.cache.impl;\n \n-import static junit.framework.Assert.assertFalse;\n-\n import java.util.Date;\n import java.util.Set;\n \n@@ -376,8 +374,7 @@ public void testCacheEntryIsNotRevalidatableIfNoAppropriateHeaders() {\n                 new BasicHeader(\"Cache-Control\", \"public\") };\n \n         CacheEntry entry = getEntry(headers);\n-\n-        assertFalse(entry.isRevalidatable());\n+        Assert.assertFalse(entry.isRevalidatable());\n     }\n \n "
            },
            {
                "sha": "c790f3ebae66b9eb1003c1eef9027bb693034f07",
                "filename": "httpclient/src/main/java/org/apache/http/impl/auth/AuthSchemeBase.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/13f31eb2dbeee32367558692ee9ab0a59d7b2d14/httpclient/src/main/java/org/apache/http/impl/auth/AuthSchemeBase.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/13f31eb2dbeee32367558692ee9ab0a59d7b2d14/httpclient/src/main/java/org/apache/http/impl/auth/AuthSchemeBase.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/impl/auth/AuthSchemeBase.java?ref=13f31eb2dbeee32367558692ee9ab0a59d7b2d14",
                "patch": "@@ -125,7 +125,7 @@ public Header authenticate(\n     }\n \n     protected abstract void parseChallenge(\n-            CharArrayBuffer buffer, int pos, int len) throws MalformedChallengeException;\n+            CharArrayBuffer buffer, int beginIndex, int endIndex) throws MalformedChallengeException;\n \n     /**\n      * Returns <code>true</code> if authenticating against a proxy, <code>false</code>"
            },
            {
                "sha": "4f616a5c2bdc2aaab54f9037f13c8c6f896f5314",
                "filename": "httpclient/src/main/java/org/apache/http/impl/auth/NTLMScheme.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/13f31eb2dbeee32367558692ee9ab0a59d7b2d14/httpclient/src/main/java/org/apache/http/impl/auth/NTLMScheme.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/13f31eb2dbeee32367558692ee9ab0a59d7b2d14/httpclient/src/main/java/org/apache/http/impl/auth/NTLMScheme.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/impl/auth/NTLMScheme.java?ref=13f31eb2dbeee32367558692ee9ab0a59d7b2d14",
                "patch": "@@ -99,8 +99,9 @@ public boolean isConnectionBased() {\n \n     @Override\n     protected void parseChallenge(\n-            final CharArrayBuffer buffer, int pos, int len) throws MalformedChallengeException {\n-        String challenge = buffer.substringTrimmed(pos, len);\n+            final CharArrayBuffer buffer, \n+            int beginIndex, int endIndex) throws MalformedChallengeException {\n+        String challenge = buffer.substringTrimmed(beginIndex, endIndex);\n         if (challenge.length() == 0) {\n             if (this.state == State.UNINITIATED) {\n                 this.state = State.CHALLENGE_RECEIVED;"
            },
            {
                "sha": "df2e9c326b06b9bfd9eb4076feee1daa34baefba",
                "filename": "httpclient/src/main/java/org/apache/http/impl/auth/NegotiateScheme.java",
                "status": "modified",
                "additions": 35,
                "deletions": 61,
                "changes": 96,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/13f31eb2dbeee32367558692ee9ab0a59d7b2d14/httpclient/src/main/java/org/apache/http/impl/auth/NegotiateScheme.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/13f31eb2dbeee32367558692ee9ab0a59d7b2d14/httpclient/src/main/java/org/apache/http/impl/auth/NegotiateScheme.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/impl/auth/NegotiateScheme.java?ref=13f31eb2dbeee32367558692ee9ab0a59d7b2d14",
                "patch": "@@ -33,15 +33,14 @@\n import org.apache.http.Header;\n import org.apache.http.HttpHost;\n import org.apache.http.HttpRequest;\n-import org.apache.http.auth.AUTH;\n import org.apache.http.auth.AuthenticationException;\n-import org.apache.http.auth.ContextAwareAuthScheme;\n import org.apache.http.auth.Credentials;\n import org.apache.http.auth.InvalidCredentialsException;\n import org.apache.http.auth.MalformedChallengeException;\n import org.apache.http.message.BasicHeader;\n import org.apache.http.protocol.ExecutionContext;\n import org.apache.http.protocol.HttpContext;\n+import org.apache.http.util.CharArrayBuffer;\n import org.ietf.jgss.GSSContext;\n import org.ietf.jgss.GSSException;\n import org.ietf.jgss.GSSManager;\n@@ -54,28 +53,28 @@\n  *\n  * @since 4.1\n  */\n-public class NegotiateScheme implements ContextAwareAuthScheme {\n+public class NegotiateScheme extends AuthSchemeBase {\n \n-    private static final int UNINITIATED         = 0;\n-    private static final int INITIATED           = 1;\n-    private static final int NEGOTIATING         = 3;\n-    private static final int ESTABLISHED         = 4;\n-    private static final int FAILED              = Integer.MAX_VALUE;\n-    private static final String SPNEGO_OID        = \"1.3.6.1.5.5.2\";\n-    private static final String KERBEROS_OID        = \"1.2.840.113554.1.2.2\";\n+    enum State {\n+        UNINITIATED,\n+        CHALLENGE_RECEIVED,\n+        TOKEN_GENERATED,\n+        FAILED,\n+    }\n+    \n+    private static final String SPNEGO_OID       = \"1.3.6.1.5.5.2\";\n+    private static final String KERBEROS_OID     = \"1.2.840.113554.1.2.2\";\n \n     private final Log log = LogFactory.getLog(getClass());\n \n     private final SpnegoTokenGenerator spengoGenerator;\n \n     private final boolean stripPort;\n \n-    private boolean proxy;\n-\n     private GSSContext gssContext = null;\n \n     /** Authentication process state */\n-    private int state;\n+    private State state;\n \n     /** base64 decoded challenge **/\n     private byte[] token;\n@@ -88,7 +87,7 @@\n      */\n     public NegotiateScheme(final SpnegoTokenGenerator spengoGenerator, boolean stripPort) {\n         super();\n-        this.state = UNINITIATED;\n+        this.state = State.UNINITIATED;\n         this.spengoGenerator = spengoGenerator;\n         this.stripPort = stripPort;\n     }\n@@ -109,7 +108,7 @@ public NegotiateScheme() {\n      *\n      */\n     public boolean isComplete() {\n-        return this.state == ESTABLISHED || this.state == FAILED;\n+        return this.state == State.TOKEN_GENERATED || this.state == State.FAILED;\n     }\n \n     /**\n@@ -152,7 +151,7 @@ public Header authenticate(\n         if (request == null) {\n             throw new IllegalArgumentException(\"HTTP request may not be null\");\n         }\n-        if (state == UNINITIATED) {\n+        if (state != State.CHALLENGE_RECEIVED) {\n             throw new IllegalStateException(\n                     \"Negotiation authentication process has not been initiated\");\n         }\n@@ -227,19 +226,13 @@ public Header authenticate(\n                 gssContext.requestMutualAuth(true);\n                 gssContext.requestCredDeleg(true);\n             }\n-            state = INITIATED;\n-\n             if (token == null) {\n                 token = new byte[0];                \n             }\n-            // HTTP 1.1 issue:\n-            // Mutual auth will never complete to do 200 instead of 401 in\n-            // return from server. \"state\" will never reach ESTABLISHED\n-            // but it works anyway\n-\n             token = gssContext.initSecContext(token, 0, token.length);\n             if (token == null) {\n-                throw new AuthenticationException(\"Failed to initialize security context\");\n+                state = State.FAILED;\n+                throw new AuthenticationException(\"GSS security context initialization failed\");\n             }\n \n             /*\n@@ -250,11 +243,14 @@ public Header authenticate(\n                 token = spengoGenerator.generateSpnegoDERObject(token);\n             }\n \n+            state = State.TOKEN_GENERATED;\n+            String tokenstr = new String(Base64.encodeBase64(token, false));\n             if (log.isDebugEnabled()) {\n-                log.debug(\"got token, sending \" + token.length + \" bytes to server\");\n+                log.debug(\"Sending response '\" + tokenstr + \"' back to the auth server\");\n             }\n+            return new BasicHeader(\"Authorization\", \"Negotiate \" + tokenstr);\n         } catch (GSSException gsse) {\n-            state = FAILED;\n+            state = State.FAILED;\n             if (gsse.getMajor() == GSSException.DEFECTIVE_CREDENTIAL\n                     || gsse.getMajor() == GSSException.CREDENTIALS_EXPIRED)\n                 throw new InvalidCredentialsException(gsse.getMessage(), gsse);\n@@ -267,11 +263,9 @@ public Header authenticate(\n             // other error\n             throw new AuthenticationException(gsse.getMessage());\n         } catch (IOException ex){\n-            state = FAILED;\n+            state = State.FAILED;\n             throw new AuthenticationException(ex.getMessage());\n         }\n-        return new BasicHeader(\"Authorization\", \"Negotiate \" +\n-                new String(Base64.encodeBase64(token, false)) );\n     }\n \n \n@@ -312,41 +306,21 @@ public boolean isConnectionBased() {\n         return true;\n     }\n \n-    /**\n-     * Processes the Negotiate challenge.\n-     *\n-     */\n-    public void processChallenge(final Header header) throws MalformedChallengeException {\n+    @Override\n+    protected void parseChallenge(\n+            final CharArrayBuffer buffer, \n+            int beginIndex, int endIndex) throws MalformedChallengeException {\n+        String challenge = buffer.substringTrimmed(beginIndex, endIndex);\n         if (log.isDebugEnabled()) {\n-            log.debug(\"Challenge header: \" + header);\n+            log.debug(\"Received challenge '\" + challenge + \"' from the auth server\");\n         }\n-        String authheader = header.getName();\n-        String challenge = header.getValue();\n-        if (authheader.equalsIgnoreCase(AUTH.WWW_AUTH)) {\n-            this.proxy = false;\n-        } else if (authheader.equalsIgnoreCase(AUTH.PROXY_AUTH)) {\n-            this.proxy = true;\n+        if (state == State.UNINITIATED) {\n+            token = new Base64().decode(challenge.getBytes());\n+            state = State.CHALLENGE_RECEIVED;\n         } else {\n-            throw new MalformedChallengeException(\"Unexpected header name: \" + authheader);\n-        }\n-\n-        if (challenge.startsWith(\"Negotiate\")) {\n-            if(isComplete() == false)\n-                state = NEGOTIATING;\n-\n-            if (challenge.startsWith(\"Negotiate \")){\n-                token = new Base64().decode(challenge.substring(10).getBytes());\n-                if (log.isDebugEnabled()) {\n-                    log.debug(\"challenge = \" + challenge.substring(10));\n-                }\n-            } else {\n-                token = new byte[0];\n-            }\n+            log.debug(\"Authentication already attempted\");\n+            state = State.FAILED;\n         }\n     }\n-\n-    public boolean isProxy() {\n-        return this.proxy;\n-    }\n-\n+    \n }"
            },
            {
                "sha": "315d032697b9f1de89c2115831fd4d1d4ac0b5fe",
                "filename": "httpclient/src/test/java/org/apache/http/impl/auth/TestNegotiateScheme.java",
                "status": "modified",
                "additions": 42,
                "deletions": 28,
                "changes": 70,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/13f31eb2dbeee32367558692ee9ab0a59d7b2d14/httpclient/src/test/java/org/apache/http/impl/auth/TestNegotiateScheme.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/13f31eb2dbeee32367558692ee9ab0a59d7b2d14/httpclient/src/test/java/org/apache/http/impl/auth/TestNegotiateScheme.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/test/java/org/apache/http/impl/auth/TestNegotiateScheme.java?ref=13f31eb2dbeee32367558692ee9ab0a59d7b2d14",
                "patch": "@@ -26,26 +26,24 @@\n  */\n package org.apache.http.impl.auth;\n \n-import static org.mockito.Matchers.*;\n-import static org.mockito.Mockito.*;\n-\n import java.io.IOException;\n import java.security.Principal;\n \n+import junit.framework.Assert;\n+\n import org.apache.http.HttpEntity;\n import org.apache.http.HttpException;\n import org.apache.http.HttpHost;\n import org.apache.http.HttpRequest;\n import org.apache.http.HttpResponse;\n+import org.apache.http.HttpStatus;\n import org.apache.http.auth.AuthScheme;\n import org.apache.http.auth.AuthScope;\n import org.apache.http.auth.Credentials;\n import org.apache.http.client.methods.HttpGet;\n import org.apache.http.client.params.AuthPolicy;\n import org.apache.http.client.params.ClientPNames;\n import org.apache.http.entity.StringEntity;\n-import org.apache.http.impl.auth.NegotiateScheme;\n-import org.apache.http.impl.auth.NegotiateSchemeFactory;\n import org.apache.http.impl.client.DefaultHttpClient;\n import org.apache.http.localserver.BasicServerTestBase;\n import org.apache.http.localserver.LocalTestServer;\n@@ -59,8 +57,9 @@\n import org.ietf.jgss.GSSName;\n import org.ietf.jgss.Oid;\n import org.junit.Before;\n-import org.junit.Ignore;\n import org.junit.Test;\n+import org.mockito.Matchers;\n+import org.mockito.Mockito;\n \n /**\n  * Tests for {@link NegotiateScheme}.\n@@ -79,13 +78,15 @@ public void setUp() throws Exception {\n      * This service will continue to ask for authentication.\n      */\n     private static class PleaseNegotiateService implements HttpRequestHandler {\n-        public void handle(final HttpRequest request,\n+\n+        public void handle(\n+                final HttpRequest request,\n                 final HttpResponse response,\n                 final HttpContext context) throws HttpException, IOException {\n-            response.setStatusCode(401);\n+            response.setStatusCode(HttpStatus.SC_UNAUTHORIZED);\n             response.addHeader(new BasicHeader(\"WWW-Authenticate\", \"Negotiate blablabla\"));\n-            response.setEntity(new StringEntity(\"auth required \"));\n             response.addHeader(new BasicHeader(\"Connection\", \"Keep-Alive\"));\n+            response.setEntity(new StringEntity(\"auth required \"));\n         }\n     }\n \n@@ -96,55 +97,64 @@ public void handle(final HttpRequest request,\n      *\n      */\n     private static class NegotiateSchemeWithMockGssManager extends NegotiateScheme {\n-        GSSManager manager = mock(GSSManager.class);\n-        GSSName name = mock(GSSName.class);\n-        GSSContext context = mock(GSSContext.class);\n+        \n+        GSSManager manager = Mockito.mock(GSSManager.class);\n+        GSSName name = Mockito.mock(GSSName.class);\n+        GSSContext context = Mockito.mock(GSSContext.class);\n \n         NegotiateSchemeWithMockGssManager() throws Exception {\n             super(null, true);\n-\n-            when(context.initSecContext(any(byte[].class), anyInt(), anyInt()))\n-                .thenReturn(\"12345678\".getBytes());\n-            when(manager.createName(any(String.class), any(Oid.class)))\n-                .thenReturn(name);\n-            when(manager.createContext(any(GSSName.class), any(Oid.class), any(GSSCredential.class), anyInt()))\n-                .thenReturn(context);\n-\n+            Mockito.when(context.initSecContext(\n+                    Matchers.any(byte[].class), Matchers.anyInt(), Matchers.anyInt()))\n+                    .thenReturn(\"12345678\".getBytes());\n+            Mockito.when(manager.createName(\n+                    Matchers.any(String.class), Matchers.any(Oid.class)))\n+                    .thenReturn(name);\n+            Mockito.when(manager.createContext(\n+                    Matchers.any(GSSName.class), Matchers.any(Oid.class), \n+                    Matchers.any(GSSCredential.class), Matchers.anyInt()))\n+                    .thenReturn(context);\n         }\n \n         @Override\n         protected GSSManager getManager() {\n             return manager;\n         }\n+        \n     }\n \n     private static class UseJaasCredentials implements Credentials {\n+        \n         public String getPassword() {\n             return null;\n         }\n \n         public Principal getUserPrincipal() {\n             return null;\n         }\n+        \n     }\n \n     private static class NegotiateSchemeFactoryWithMockGssManager extends NegotiateSchemeFactory {\n+        \n         NegotiateSchemeWithMockGssManager scheme;\n+        \n         NegotiateSchemeFactoryWithMockGssManager() throws Exception {\n             scheme = new NegotiateSchemeWithMockGssManager();\n         }\n+        \n         @Override\n         public AuthScheme newInstance(HttpParams params) {\n             return scheme;\n         }\n+        \n     }\n \n     /**\n      * Tests that the client will stop connecting to the server if\n      * the server still keep asking for a valid ticket.\n      */\n     @Test\n-    @Ignore\n     public void testDontTryToAuthenticateEndlessly() throws Exception {\n         int port = this.localServer.getServiceAddress().getPort();\n         this.localServer.register(\"*\", new PleaseNegotiateService());\n@@ -163,25 +173,26 @@ public void testDontTryToAuthenticateEndlessly() throws Exception {\n         HttpGet httpget = new HttpGet(s);\n         HttpResponse response = client.execute(httpget);\n         HttpEntity e = response.getEntity();\n-        e.consumeContent();\n+        if (e != null) {\n+            e.consumeContent();\n+        }\n+        Assert.assertEquals(HttpStatus.SC_UNAUTHORIZED, response.getStatusLine().getStatusCode());\n     }\n \n-\n     /**\n      * Javadoc specifies that {@link GSSContext#initSecContext(byte[], int, int)} can return null\n      * if no token is generated. Client should be able to deal with this response.\n-     *\n      */\n     @Test\n-    @Ignore\n-    public void testNoTokenGeneratedGenerateAnError() throws Exception {\n+    public void testNoTokenGeneratedError() throws Exception {\n         int port = this.localServer.getServiceAddress().getPort();\n         this.localServer.register(\"*\", new PleaseNegotiateService());\n \n         HttpHost target = new HttpHost(\"localhost\", port);\n         DefaultHttpClient client = new DefaultHttpClient();\n         NegotiateSchemeFactoryWithMockGssManager nsf = new NegotiateSchemeFactoryWithMockGssManager();\n-        when(nsf.scheme.context.initSecContext(any(byte[].class), anyInt(), anyInt())).thenReturn(null);\n+        Mockito.when(nsf.scheme.context.initSecContext(\n+                Matchers.any(byte[].class), Matchers.anyInt(), Matchers.anyInt())).thenReturn(null);\n         client.getAuthSchemes().register(AuthPolicy.SPNEGO, nsf);\n \n         Credentials use_jaas_creds = new UseJaasCredentials();\n@@ -193,7 +204,10 @@ public void testNoTokenGeneratedGenerateAnError() throws Exception {\n         HttpGet httpget = new HttpGet(s);\n         HttpResponse response = client.execute(httpget);\n         HttpEntity e = response.getEntity();\n-        e.consumeContent();\n+        if (e != null) {\n+            e.consumeContent();\n+        }\n+        Assert.assertEquals(HttpStatus.SC_UNAUTHORIZED, response.getStatusLine().getStatusCode());\n     }\n \n }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/c6769986beda3ef412ddd0888bec67266c919eff",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/9570849f9c9b81f6664376dac41c40b72599fbbe",
        "message": "Fixed NPE in DefaultRequestDirector thrown when retrying a failed request over a proxied connection\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@723813 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_27",
        "file": [
            {
                "sha": "6f1d66f8bd6b7933cf87d7a0165de297c603f888",
                "filename": "RELEASE_NOTES.txt",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/c6769986beda3ef412ddd0888bec67266c919eff/RELEASE_NOTES.txt",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/c6769986beda3ef412ddd0888bec67266c919eff/RELEASE_NOTES.txt",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/RELEASE_NOTES.txt?ref=c6769986beda3ef412ddd0888bec67266c919eff",
                "patch": "@@ -9,6 +9,10 @@ bundle combining HttpClient and HttpMime jars.\n \n All upstream projects are strongly encouraged to upgrade.\n \n+* Fixed NPE in DefaultRequestDirector thrown when retrying a failed \n+  request over a proxied connection. \n+  Contributed by Oleg Kalnichevski <olegk at apache.org>\n+\n * [HTTPCLIENT-803] Fixed bug in SSL host verifier implementations \n   causing the SSL certificate to be rejected as invalid if the connection \n   is established using an IP address."
            },
            {
                "sha": "752259ddf66ee4f5ac9b12343c9b12519606583e",
                "filename": "module-client/src/main/java/org/apache/http/impl/client/DefaultRequestDirector.java",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/c6769986beda3ef412ddd0888bec67266c919eff/module-client/src/main/java/org/apache/http/impl/client/DefaultRequestDirector.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/c6769986beda3ef412ddd0888bec67266c919eff/module-client/src/main/java/org/apache/http/impl/client/DefaultRequestDirector.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/module-client/src/main/java/org/apache/http/impl/client/DefaultRequestDirector.java?ref=c6769986beda3ef412ddd0888bec67266c919eff",
                "patch": "@@ -434,12 +434,18 @@ public HttpResponse execute(HttpHost target, HttpRequest request,\n                             managedConn.open(route, context, params);\n                         } else {\n                             // otherwise give up\n+                            this.log.debug(\"Proxied connection. Need to start over.\");\n                             retrying = false;\n                         }\n                         \n                     }\n \n                 }\n+                \n+                if (response == null) {\n+                    // Need to start over\n+                    continue;\n+                }\n \n                 // Run response protocol interceptors\n                 response.setParams(params);"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/542ccae5022fae8f94d2024b3c51058f49fd67cc",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/d1da745d036068d1cd69ba57b63c994780dde522",
        "message": "HTTPCLIENT-1621: Possible NPE/incorrect type in HttpClientBuilder#evictIdleConnections\n\nMethod has been deprecated and a new one has been added with a simple type. Old method merely calls the new one now.\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1663151 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_28",
        "file": [
            {
                "sha": "d997c100b08bd199d911556d92e22b5d66950b97",
                "filename": "httpclient/src/main/java/org/apache/http/impl/client/HttpClientBuilder.java",
                "status": "modified",
                "additions": 31,
                "deletions": 1,
                "changes": 32,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/542ccae5022fae8f94d2024b3c51058f49fd67cc/httpclient/src/main/java/org/apache/http/impl/client/HttpClientBuilder.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/542ccae5022fae8f94d2024b3c51058f49fd67cc/httpclient/src/main/java/org/apache/http/impl/client/HttpClientBuilder.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/impl/client/HttpClientBuilder.java?ref=542ccae5022fae8f94d2024b3c51058f49fd67cc",
                "patch": "@@ -796,14 +796,44 @@ public final HttpClientBuilder evictExpiredConnections() {\n      * @see #setConnectionManagerShared(boolean)\n      * @see org.apache.http.conn.HttpClientConnectionManager#closeExpiredConnections()\n      *\n-     * @param maxIdleTime maxium time persistent connections can stay idle while kept alive\n+     * @param maxIdleTime maximum time persistent connections can stay idle while kept alive\n      * in the connection pool. Connections whose inactivity period exceeds this value will\n      * get closed and evicted from the pool.\n      * @param maxIdleTimeUnit time unit for the above parameter.\n      *\n+     * @deprecated (4.5) use {@link #evictIdleConnections(long, TimeUnit)}\n+     *\n      * @since 4.4\n      */\n+    @Deprecated\n     public final HttpClientBuilder evictIdleConnections(final Long maxIdleTime, final TimeUnit maxIdleTimeUnit) {\n+        return evictIdleConnections(maxIdleTime.longValue(), maxIdleTimeUnit);\n+    }\n+\n+    /**\n+     * Makes this instance of HttpClient proactively evict idle connections from the\n+     * connection pool using a background thread.\n+     * <p>\n+     * One MUST explicitly close HttpClient with {@link CloseableHttpClient#close()} in order\n+     * to stop and release the background thread.\n+     * <p>\n+     * Please note this method has no effect if the instance of HttpClient is configuted to\n+     * use a shared connection manager.\n+     * <p>\n+     * Please note this method may not be used when the instance of HttpClient is created\n+     * inside an EJB container.\n+     *\n+     * @see #setConnectionManagerShared(boolean)\n+     * @see org.apache.http.conn.HttpClientConnectionManager#closeExpiredConnections()\n+     *\n+     * @param maxIdleTime maximum time persistent connections can stay idle while kept alive\n+     * in the connection pool. Connections whose inactivity period exceeds this value will\n+     * get closed and evicted from the pool.\n+     * @param maxIdleTimeUnit time unit for the above parameter.\n+     *\n+     * @since 4.4\n+     */\n+    public final HttpClientBuilder evictIdleConnections(final long maxIdleTime, final TimeUnit maxIdleTimeUnit) {\n         this.evictIdleConnections = true;\n         this.maxIdleTime = maxIdleTime;\n         this.maxIdleTimeUnit = maxIdleTimeUnit;"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/28a6d5c481f31cee11585493826322ac210e2aaf",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/f779a4b65d04ef3ad8ab766d041e36eb4da0b564",
        "message": "HTTPCLIENT-1767: Null pointer dereference in EofSensorInputStream and ResponseEntityProxy\n\nEofSensorInputStream is generating NullPointerExceptions in some rare situations. This commit fixes that behaviour for the check methods by dereferencing the instance variable to a final local variable to ensure that if it is not null at the null guard, that it will be not null after that point also to successfully close/abort the stream\n\nIn some rare cases, null parameters are sent to ReponseEntityProxy methods, this adds checks on those to ensure that the connections are still released, but the null variable is not dereferenced.\n\nContributed by Peter Ansell <p_ansell@yahoo.com>\n\nConflicts:\n\thttpclient5/src/main/java/org/apache/hc/client5/http/impl/sync/ResponseEntityProxy.java\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1760585 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_29",
        "file": [
            {
                "sha": "27845165d4818ea356e5b1c17529c1fe94118bef",
                "filename": "httpclient5/src/main/java/org/apache/hc/client5/http/impl/sync/ResponseEntityProxy.java",
                "status": "modified",
                "additions": 9,
                "deletions": 3,
                "changes": 12,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/28a6d5c481f31cee11585493826322ac210e2aaf/httpclient5/src/main/java/org/apache/hc/client5/http/impl/sync/ResponseEntityProxy.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/28a6d5c481f31cee11585493826322ac210e2aaf/httpclient5/src/main/java/org/apache/hc/client5/http/impl/sync/ResponseEntityProxy.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient5/src/main/java/org/apache/hc/client5/http/impl/sync/ResponseEntityProxy.java?ref=28a6d5c481f31cee11585493826322ac210e2aaf",
                "patch": "@@ -92,7 +92,9 @@ public InputStream getContent() throws IOException {\n     @Override\n     public void writeTo(final OutputStream outstream) throws IOException {\n         try {\n-            super.writeTo(outstream);\n+            if (outstream != null) {\n+                super.writeTo(outstream);\n+            }\n             releaseConnection();\n         } catch (IOException | RuntimeException ex) {\n             abortConnection();\n@@ -107,7 +109,9 @@ public boolean eofDetected(final InputStream wrapped) throws IOException {\n         try {\n             // there may be some cleanup required, such as\n             // reading trailers after the response body:\n-            wrapped.close();\n+            if (wrapped != null) {\n+                wrapped.close();\n+            }\n             releaseConnection();\n         } catch (IOException | RuntimeException ex) {\n             abortConnection();\n@@ -125,7 +129,9 @@ public boolean streamClosed(final InputStream wrapped) throws IOException {\n             // this assumes that closing the stream will\n             // consume the remainder of the response body:\n             try {\n-                wrapped.close();\n+                if (wrapped != null) {\n+                    wrapped.close();\n+                }\n                 releaseConnection();\n             } catch (final SocketException ex) {\n                 if (open) {"
            },
            {
                "sha": "66aa1a2cde30452444edb8956f32fabf3c364ca2",
                "filename": "httpclient5/src/main/java/org/apache/hc/client5/http/io/EofSensorInputStream.java",
                "status": "modified",
                "additions": 12,
                "deletions": 9,
                "changes": 21,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/28a6d5c481f31cee11585493826322ac210e2aaf/httpclient5/src/main/java/org/apache/hc/client5/http/io/EofSensorInputStream.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/28a6d5c481f31cee11585493826322ac210e2aaf/httpclient5/src/main/java/org/apache/hc/client5/http/io/EofSensorInputStream.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient5/src/main/java/org/apache/hc/client5/http/io/EofSensorInputStream.java?ref=28a6d5c481f31cee11585493826322ac210e2aaf",
                "patch": "@@ -193,14 +193,15 @@ public void close() throws IOException {\n      */\n     protected void checkEOF(final int eof) throws IOException {\n \n-        if ((wrappedStream != null) && (eof < 0)) {\n+        final InputStream toCheckStream = wrappedStream;\n+        if ((toCheckStream != null) && (eof < 0)) {\n             try {\n                 boolean scws = true; // should close wrapped stream?\n                 if (eofWatcher != null) {\n-                    scws = eofWatcher.eofDetected(wrappedStream);\n+                    scws = eofWatcher.eofDetected(toCheckStream);\n                 }\n                 if (scws) {\n-                    wrappedStream.close();\n+                    toCheckStream.close();\n                 }\n             } finally {\n                 wrappedStream = null;\n@@ -221,14 +222,15 @@ protected void checkEOF(final int eof) throws IOException {\n      */\n     protected void checkClose() throws IOException {\n \n-        if (wrappedStream != null) {\n+        final InputStream toCloseStream = wrappedStream;\n+        if (toCloseStream != null) {\n             try {\n                 boolean scws = true; // should close wrapped stream?\n                 if (eofWatcher != null) {\n-                    scws = eofWatcher.streamClosed(wrappedStream);\n+                    scws = eofWatcher.streamClosed(toCloseStream);\n                 }\n                 if (scws) {\n-                    wrappedStream.close();\n+                    toCloseStream.close();\n                 }\n             } finally {\n                 wrappedStream = null;\n@@ -251,14 +253,15 @@ protected void checkClose() throws IOException {\n      */\n     protected void checkAbort() throws IOException {\n \n-        if (wrappedStream != null) {\n+        final InputStream toAbortStream = wrappedStream;\n+        if (toAbortStream != null) {\n             try {\n                 boolean scws = true; // should close wrapped stream?\n                 if (eofWatcher != null) {\n-                    scws = eofWatcher.streamAbort(wrappedStream);\n+                    scws = eofWatcher.streamAbort(toAbortStream);\n                 }\n                 if (scws) {\n-                    wrappedStream.close();\n+                    toAbortStream.close();\n                 }\n             } finally {\n                 wrappedStream = null;"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/8f91869343991dd47add61bcdaf6beb234750d2b",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/6921a32fa66bea61206ff7b5e7d6872639f7d7ad",
        "message": "Not sure that instream can be null, but assuming it can, there's no point entering the try block if it's null. This avoids NPE warning\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1206734 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_30",
        "file": [
            {
                "sha": "505e2455d792c09c7aa70a60b19832080f5870a2",
                "filename": "httpclient-benchmark/src/main/java/org/apache/http/client/benchmark/TestHttpClient4.java",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/8f91869343991dd47add61bcdaf6beb234750d2b/httpclient-benchmark/src/main/java/org/apache/http/client/benchmark/TestHttpClient4.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/8f91869343991dd47add61bcdaf6beb234750d2b/httpclient-benchmark/src/main/java/org/apache/http/client/benchmark/TestHttpClient4.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient-benchmark/src/main/java/org/apache/http/client/benchmark/TestHttpClient4.java?ref=8f91869343991dd47add61bcdaf6beb234750d2b",
                "patch": "@@ -139,16 +139,16 @@ public void run() {\n                     HttpEntity entity = response.getEntity();\n                     if (entity != null) {\n                         InputStream instream = entity.getContent();\n-                        try {\n-                            contentLen = 0;\n-                            if (instream != null) {\n+                        contentLen = 0;\n+                        if (instream != null) {\n+                            try {\n                                 int l = 0;\n                                 while ((l = instream.read(buffer)) != -1) {\n                                     contentLen += l;\n                                 }\n+                            } finally {\n+                                instream.close();\n                             }\n-                        } finally {\n-                            instream.close();\n                         }\n                     }\n                     if (response.getStatusLine().getStatusCode() == 200) {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/httpcomponents-client/commit/6921a32fa66bea61206ff7b5e7d6872639f7d7ad",
        "repo": "httpcomponents-client",
        "parent": "https://github.com/apache/httpcomponents-client/commit/d7ce4582e2d35b7cef81c75864dcde693349be0b",
        "message": "Not sure that instream can be null, but assuming it can, there's no point entering the try block if it's null. This avoids NPE warning\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1206731 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "httpcomponents-client_31",
        "file": [
            {
                "sha": "4d07b0050fc91e9201b9432bf03a3728abf12c3c",
                "filename": "httpclient-benchmark/src/main/java/org/apache/http/client/benchmark/TestHttpCore.java",
                "status": "modified",
                "additions": 9,
                "deletions": 9,
                "changes": 18,
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/6921a32fa66bea61206ff7b5e7d6872639f7d7ad/httpclient-benchmark/src/main/java/org/apache/http/client/benchmark/TestHttpCore.java",
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/6921a32fa66bea61206ff7b5e7d6872639f7d7ad/httpclient-benchmark/src/main/java/org/apache/http/client/benchmark/TestHttpCore.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient-benchmark/src/main/java/org/apache/http/client/benchmark/TestHttpCore.java?ref=6921a32fa66bea61206ff7b5e7d6872639f7d7ad",
                "patch": "@@ -180,18 +180,18 @@ public void run() {\n                         httpexecutor.postProcess(response, httpproc, context);\n \n                         HttpEntity entity = response.getEntity();\n-                        if (entity != null) {\n+                        if (entity != null) { // TODO can this be null?\n                             InputStream instream = entity.getContent();\n-                            try {\n+                            if (instream != null) {\n                                 contentLen = 0;\n-                                if (instream != null) {\n-                                    int l = 0;\n-                                    while ((l = instream.read(buffer)) != -1) {\n-                                        contentLen += l;\n-                                    }\n+                                try {\n+                                        int l = 0;\n+                                        while ((l = instream.read(buffer)) != -1) {\n+                                            contentLen += l;\n+                                        }\n+                                } finally {\n+                                    instream.close();\n                                 }\n-                            } finally {\n-                                instream.close();\n                             }\n                         }\n                         if (connStrategy.keepAlive(response, context)) {"
            }
        ]
    }
]
