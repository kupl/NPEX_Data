[
    {
        "commit": "https://github.com/apache/directory-server/commit/4a0a6b018bed916e718127c0ad868d380b3a990a",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/cc016df901a23ac60ed766f4c9941e2cde3b0c91",
        "message": "Fix for DIRSERVER-2231. If the entryDnCache is not existing, we don't\ntry to read it and get a NPE...",
        "bug_id": "directory-server_1",
        "file": [
            {
                "sha": "a3e06abe0476a5a2912b36a4cd4dc5cbca036ef5",
                "filename": "xdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/AbstractBTreePartition.java",
                "status": "modified",
                "additions": 7,
                "deletions": 4,
                "changes": 11,
                "blob_url": "https://github.com/apache/directory-server/blob/4a0a6b018bed916e718127c0ad868d380b3a990a/xdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/AbstractBTreePartition.java",
                "raw_url": "https://github.com/apache/directory-server/raw/4a0a6b018bed916e718127c0ad868d380b3a990a/xdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/AbstractBTreePartition.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/xdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/AbstractBTreePartition.java?ref=4a0a6b018bed916e718127c0ad868d380b3a990a",
                "patch": "@@ -2654,11 +2654,14 @@ protected Dn buildEntryDn( PartitionTxn partitionTxn, String id ) throws LdapExc\n         {\n             rwLock.readLock().lock();\n \n-            Element el = entryDnCache.get( id );\n-            \n-            if ( el != null )\n+            if ( entryDnCache != null )\n             {\n-                return ( Dn ) el.getObjectValue();\n+                Element el = entryDnCache.get( id );\n+                \n+                if ( el != null )\n+                {\n+                    return ( Dn ) el.getObjectValue();\n+                }\n             }\n             \n             do"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/bba29ac066158c17d30049b24dd2dce54405d0d8",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/2602ec8c125383f9eae0e74332fbaaa913f997ab",
        "message": "Made the \"ads-baseDn\" attribute not mandatory to avoid NPEs\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/apacheds-value@1805964 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_2",
        "file": [
            {
                "sha": "504c1edb75cd8f2c928bd65032dbd5de5cc31fca",
                "filename": "server-config/src/main/java/org/apache/directory/server/config/beans/AuthenticatorBean.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/bba29ac066158c17d30049b24dd2dce54405d0d8/server-config/src/main/java/org/apache/directory/server/config/beans/AuthenticatorBean.java",
                "raw_url": "https://github.com/apache/directory-server/raw/bba29ac066158c17d30049b24dd2dce54405d0d8/server-config/src/main/java/org/apache/directory/server/config/beans/AuthenticatorBean.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-config/src/main/java/org/apache/directory/server/config/beans/AuthenticatorBean.java?ref=bba29ac066158c17d30049b24dd2dce54405d0d8",
                "patch": "@@ -35,7 +35,7 @@\n     private String authenticatorId;\n \n     /** The base DN which will be the starting point from which we use the authenticator */\n-    @ConfigurationElement(attributeType = \"ads-baseDn\")\n+    @ConfigurationElement(attributeType = \"ads-baseDn\", isOptional = true)\n     protected String baseDn;\n \n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/67fa25501888994efaf3d3320aae31c55b37a73a",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/83139581d9a90744f8343a54b32aabf86c5804de",
        "message": "Replaced the throw new NullPointerException by throw new IllegalArgumentException\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@951408 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_3",
        "file": [
            {
                "sha": "10451bef7a018c80674214fa2ee8c7270df13aab",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/interceptor/InterceptorChain.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/67fa25501888994efaf3d3320aae31c55b37a73a/core-api/src/main/java/org/apache/directory/server/core/interceptor/InterceptorChain.java",
                "raw_url": "https://github.com/apache/directory-server/raw/67fa25501888994efaf3d3320aae31c55b37a73a/core-api/src/main/java/org/apache/directory/server/core/interceptor/InterceptorChain.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/interceptor/InterceptorChain.java?ref=67fa25501888994efaf3d3320aae31c55b37a73a",
                "patch": "@@ -1017,7 +1017,7 @@ private Element( String name, Element prevEntry, Element nextEntry, Interceptor\n \n             if ( interceptor == null )\n             {\n-                throw new NullPointerException( \"interceptor\" );\n+                throw new IllegalArgumentException( \"interceptor\" );\n             }\n \n             this.prevEntry = prevEntry;"
            },
            {
                "sha": "537b2d6f80b555ee72d2f60cf81017023c6f240e",
                "filename": "core-avl/src/main/java/org/apache/directory/server/core/avltree/SingletonOrOrderedSet.java",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/apache/directory-server/blob/67fa25501888994efaf3d3320aae31c55b37a73a/core-avl/src/main/java/org/apache/directory/server/core/avltree/SingletonOrOrderedSet.java",
                "raw_url": "https://github.com/apache/directory-server/raw/67fa25501888994efaf3d3320aae31c55b37a73a/core-avl/src/main/java/org/apache/directory/server/core/avltree/SingletonOrOrderedSet.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-avl/src/main/java/org/apache/directory/server/core/avltree/SingletonOrOrderedSet.java?ref=67fa25501888994efaf3d3320aae31c55b37a73a",
                "patch": "@@ -43,7 +43,7 @@ public SingletonOrOrderedSet( V singleton )\n     {\n         if ( singleton == null )\n         {\n-            throw new NullPointerException( I18n.err( I18n.ERR_447 ) );\n+            throw new IllegalArgumentException( I18n.err( I18n.ERR_447 ) );\n         }\n         \n         this.singleton = singleton;\n@@ -60,7 +60,7 @@ public SingletonOrOrderedSet( AvlTree<V> orderedSet )\n     {\n         if ( orderedSet == null )\n         {\n-            throw new NullPointerException( I18n.err( I18n.ERR_448 ) );\n+            throw new IllegalArgumentException( I18n.err( I18n.ERR_448 ) );\n         }\n         \n         this.orderedSet = orderedSet;\n@@ -116,7 +116,7 @@ public V setSingleton( V singleton )\n     {\n         if ( singleton == null )\n         {\n-            throw new NullPointerException( I18n.err( I18n.ERR_447 ) );\n+            throw new IllegalArgumentException( I18n.err( I18n.ERR_447 ) );\n         }\n         \n         if ( this.orderedSet != null )\n@@ -142,7 +142,7 @@ public V setSingleton( V singleton )\n     {\n         if ( singleton == null )\n         {\n-            throw new NullPointerException( I18n.err( I18n.ERR_447 ) );\n+            throw new IllegalArgumentException( I18n.err( I18n.ERR_447 ) );\n         }\n         \n         if ( this.singleton != null )\n@@ -185,7 +185,7 @@ public V setSingleton( V singleton )\n     {\n         if ( orderedSet == null )\n         {\n-            throw new NullPointerException( I18n.err( I18n.ERR_448 ) );\n+            throw new IllegalArgumentException( I18n.err( I18n.ERR_448 ) );\n         }\n         \n         if ( this.singleton != null )\n@@ -211,7 +211,7 @@ public V switchToOrderedSet( AvlTree<V> orderedSet )\n     {\n         if ( orderedSet == null )\n         {\n-            throw new NullPointerException( I18n.err( I18n.ERR_448 ) );\n+            throw new IllegalArgumentException( I18n.err( I18n.ERR_448 ) );\n         }\n         \n         if ( this.orderedSet != null )"
            },
            {
                "sha": "7c03f4f308efcf94b9a0a009e9350afe9c85521e",
                "filename": "core/src/main/java/org/apache/directory/server/core/authz/support/ACDFEngine.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/67fa25501888994efaf3d3320aae31c55b37a73a/core/src/main/java/org/apache/directory/server/core/authz/support/ACDFEngine.java",
                "raw_url": "https://github.com/apache/directory-server/raw/67fa25501888994efaf3d3320aae31c55b37a73a/core/src/main/java/org/apache/directory/server/core/authz/support/ACDFEngine.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/authz/support/ACDFEngine.java?ref=67fa25501888994efaf3d3320aae31c55b37a73a",
                "patch": "@@ -199,7 +199,7 @@ public boolean hasPermission(\n     {\n         if ( entryName == null )\n         {\n-            throw new NullPointerException( \"entryName\" );\n+            throw new IllegalArgumentException( \"entryName\" );\n         }\n \n         Entry userEntry = opContext.lookup( userName, USER_LOOKUP_BYPASS );"
            },
            {
                "sha": "6dc859a5e3d0f0db9436a424e4b6a1ecb289d961",
                "filename": "jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmTable.java",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/apache/directory-server/blob/67fa25501888994efaf3d3320aae31c55b37a73a/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmTable.java",
                "raw_url": "https://github.com/apache/directory-server/raw/67fa25501888994efaf3d3320aae31c55b37a73a/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmTable.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmTable.java?ref=67fa25501888994efaf3d3320aae31c55b37a73a",
                "patch": "@@ -141,7 +141,7 @@ public JdbmTable( SchemaManager schemaManager, String name, int numDupLimit, Rec\n \n         if ( keyComparator == null )\n         {\n-            throw new NullPointerException( I18n.err( I18n.ERR_591 ) );\n+            throw new IllegalArgumentException( I18n.err( I18n.ERR_591 ) );\n         }\n         else\n         {\n@@ -150,7 +150,7 @@ public JdbmTable( SchemaManager schemaManager, String name, int numDupLimit, Rec\n \n         if ( valueComparator == null )\n         {\n-            throw new NullPointerException( I18n.err( I18n.ERR_592 ) );\n+            throw new IllegalArgumentException( I18n.err( I18n.ERR_592 ) );\n         }\n         else\n         {\n@@ -217,7 +217,7 @@ public JdbmTable( SchemaManager schemaManager, String name, RecordManager manage\n \n         if ( keyComparator == null )\n         {\n-            throw new NullPointerException( I18n.err( I18n.ERR_591 ) );\n+            throw new IllegalArgumentException( I18n.err( I18n.ERR_591 ) );\n         }\n         else\n         {\n@@ -1000,7 +1000,7 @@ boolean isKeyUsingBTree( K key ) throws Exception\n     {\n         if ( key == null )\n         {\n-            throw new NullPointerException( \"key is null\" );\n+            throw new IllegalArgumentException( \"key is null\" );\n         }\n \n         if ( ! allowsDuplicates )"
            },
            {
                "sha": "274acb294878d997d5d45c137355db0f3502c75e",
                "filename": "jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/MarshallerSerializerBridge.java",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/apache/directory-server/blob/67fa25501888994efaf3d3320aae31c55b37a73a/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/MarshallerSerializerBridge.java",
                "raw_url": "https://github.com/apache/directory-server/raw/67fa25501888994efaf3d3320aae31c55b37a73a/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/MarshallerSerializerBridge.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/MarshallerSerializerBridge.java?ref=67fa25501888994efaf3d3320aae31c55b37a73a",
                "patch": "@@ -20,12 +20,12 @@\n package org.apache.directory.server.core.partition.impl.btree.jdbm;\n \n \n-import org.apache.directory.server.core.avltree.Marshaller;\n-\n import java.io.IOException;\n \n import jdbm.helper.Serializer;\n \n+import org.apache.directory.server.core.avltree.Marshaller;\n+\n \n /**\n  * A Marshaller which adapts a JDBM Serializer.\n@@ -47,7 +47,7 @@ public MarshallerSerializerBridge( Serializer serializer )\n     {\n         if ( serializer == null )\n         {\n-            throw new NullPointerException( \"serializer\" );\n+            throw new IllegalArgumentException( \"serializer\" );\n         }\n         this.serializer = serializer;\n     }"
            },
            {
                "sha": "a7c2837685f8162115919afbe355664e6cd1014a",
                "filename": "jdbm-store/src/test/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmTableWithDuplicatesTest.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/directory-server/blob/67fa25501888994efaf3d3320aae31c55b37a73a/jdbm-store/src/test/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmTableWithDuplicatesTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/67fa25501888994efaf3d3320aae31c55b37a73a/jdbm-store/src/test/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmTableWithDuplicatesTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/jdbm-store/src/test/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmTableWithDuplicatesTest.java?ref=67fa25501888994efaf3d3320aae31c55b37a73a",
                "patch": "@@ -174,7 +174,7 @@ public void testCountOneArg() throws Exception\n     }\n \n \n-    @Test( expected = NullPointerException.class )\n+    @Test( expected = IllegalArgumentException.class )\n     public void testNullKeyComparator() throws Exception\n     {\n         assertNotNull( table.getKeyComparator() );\n@@ -187,7 +187,7 @@ public void testNullKeyComparator() throws Exception\n     }\n \n \n-    @Test( expected = NullPointerException.class )\n+    @Test( expected = IllegalArgumentException.class )\n     public void testNullValueComparator() throws Exception\n     {\n         assertNotNull( table.getValueComparator() );"
            },
            {
                "sha": "0c99ed21dc0bbdf15a90c792fc581c917edf071f",
                "filename": "jdbm/src/main/java/jdbm/helper/SoftCache.java",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/apache/directory-server/blob/67fa25501888994efaf3d3320aae31c55b37a73a/jdbm/src/main/java/jdbm/helper/SoftCache.java",
                "raw_url": "https://github.com/apache/directory-server/raw/67fa25501888994efaf3d3320aae31c55b37a73a/jdbm/src/main/java/jdbm/helper/SoftCache.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/jdbm/src/main/java/jdbm/helper/SoftCache.java?ref=67fa25501888994efaf3d3320aae31c55b37a73a",
                "patch": "@@ -47,12 +47,12 @@\n package jdbm.helper;\n \n \n+import java.lang.ref.Reference;\n import java.lang.ref.ReferenceQueue;\n import java.lang.ref.SoftReference;\n-import java.lang.ref.Reference;\n import java.util.Enumeration;\n-import java.util.Map;\n import java.util.HashMap;\n+import java.util.Map;\n \n import org.apache.directory.server.i18n.I18n;\n \n@@ -136,7 +136,7 @@ public SoftCache( float loadFactor, CachePolicy internal ) throws IllegalArgumen\n     {\n         if ( internal == null )\n         {\n-            throw new NullPointerException( I18n.err( I18n.ERR_531 ) );\n+            throw new IllegalArgumentException( I18n.err( I18n.ERR_531 ) );\n         }\n         \n         this.internal = internal;"
            },
            {
                "sha": "1578ee4f3efbceec4f72fe1597631eb117e5e57d",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/LdapRequestHandler.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/67fa25501888994efaf3d3320aae31c55b37a73a/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/LdapRequestHandler.java",
                "raw_url": "https://github.com/apache/directory-server/raw/67fa25501888994efaf3d3320aae31c55b37a73a/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/LdapRequestHandler.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/LdapRequestHandler.java?ref=67fa25501888994efaf3d3320aae31c55b37a73a",
                "patch": "@@ -168,7 +168,7 @@ public final void handleMessage( IoSession session, T message ) throws Exception\n                 // Reject all extended operations except StartTls  \n                 InternalExtendedRequest req = ( InternalExtendedRequest ) message;\n                 \n-                if ( ! req.getID().equals( StartTlsHandler.EXTENSION_OID ) )\n+                if ( ! req.getOid().equals( StartTlsHandler.EXTENSION_OID ) )\n                 {\n                     rejectWithoutConfidentiality( session, req.getResultResponse() );\n                     return;"
            },
            {
                "sha": "e18008c3c3c9733dd12869dd95863c105eae1e75",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/SearchAbandonListener.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/67fa25501888994efaf3d3320aae31c55b37a73a/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/SearchAbandonListener.java",
                "raw_url": "https://github.com/apache/directory-server/raw/67fa25501888994efaf3d3320aae31c55b37a73a/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/SearchAbandonListener.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/SearchAbandonListener.java?ref=67fa25501888994efaf3d3320aae31c55b37a73a",
                "patch": "@@ -50,7 +50,7 @@ public SearchAbandonListener( LdapServer ldapServer, EntryFilteringCursor cursor\n     {\n         if ( ldapServer == null )\n         {\n-            throw new NullPointerException( \"ldapServer\" );\n+            throw new IllegalArgumentException( \"ldapServer\" );\n         }\n         \n         this.ldapServer = ldapServer;"
            },
            {
                "sha": "5ccd6f674d0e68e141a174bd7dcbf12345d791a3",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/ntlm/NtlmSaslServer.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/67fa25501888994efaf3d3320aae31c55b37a73a/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/ntlm/NtlmSaslServer.java",
                "raw_url": "https://github.com/apache/directory-server/raw/67fa25501888994efaf3d3320aae31c55b37a73a/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/ntlm/NtlmSaslServer.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/ntlm/NtlmSaslServer.java?ref=67fa25501888994efaf3d3320aae31c55b37a73a",
                "patch": "@@ -127,7 +127,7 @@ protected void responseSent()\n     {\n         if ( response == null )\n         {\n-            throw new NullPointerException( I18n.err( I18n.ERR_666 ) );\n+            throw new IllegalArgumentException( I18n.err( I18n.ERR_666 ) );\n         }\n \n         if ( response.length == 0 )"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/a6b0bd36604c52a80446fa5cec084b9c7524e92d",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/dd57c43dbdfa09f5329104030758a161b25549f0",
        "message": "Fixed a NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/apacheds-value@1778711 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_4",
        "file": [
            {
                "sha": "de577050413b7b34d00c2dede577550ac1ed98b0",
                "filename": "core/src/main/java/org/apache/directory/server/core/DefaultOperationManager.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/a6b0bd36604c52a80446fa5cec084b9c7524e92d/core/src/main/java/org/apache/directory/server/core/DefaultOperationManager.java",
                "raw_url": "https://github.com/apache/directory-server/raw/a6b0bd36604c52a80446fa5cec084b9c7524e92d/core/src/main/java/org/apache/directory/server/core/DefaultOperationManager.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/DefaultOperationManager.java?ref=a6b0bd36604c52a80446fa5cec084b9c7524e92d",
                "patch": "@@ -444,7 +444,7 @@ public void bind( BindOperationContext bindContext ) throws LdapException\n         // Normalize the addContext Dn\n         Dn dn = bindContext.getDn();\n         \n-        if ( !dn.isSchemaAware() )\n+        if ( ( dn != null ) && !dn.isSchemaAware() )\n         {\n             dn = new Dn( directoryService.getSchemaManager(), dn );\n             bindContext.setDn( dn );"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/03792f1a12e49088f154b8039e6b51318493e5a8",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/b96e096d25cf2268685dc657c899eac84c7651eb",
        "message": "Added test to demonstrate DIRAPI-30 (Sporadic NullPointerException during SASL bind)\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@999091 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_5",
        "file": [
            {
                "sha": "3ef9136a9e22ed6ffb0645ea70a75cdf1013c995",
                "filename": "server-integ/src/test/java/org/apache/directory/server/operations/bind/SaslBindIT.java",
                "status": "modified",
                "additions": 46,
                "deletions": 1,
                "changes": 47,
                "blob_url": "https://github.com/apache/directory-server/blob/03792f1a12e49088f154b8039e6b51318493e5a8/server-integ/src/test/java/org/apache/directory/server/operations/bind/SaslBindIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/03792f1a12e49088f154b8039e6b51318493e5a8/server-integ/src/test/java/org/apache/directory/server/operations/bind/SaslBindIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-integ/src/test/java/org/apache/directory/server/operations/bind/SaslBindIT.java?ref=03792f1a12e49088f154b8039e6b51318493e5a8",
                "patch": "@@ -22,7 +22,6 @@\n \n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertTrue;\n-import static org.junit.Assert.fail;\n \n import java.lang.reflect.Field;\n import java.net.InetAddress;\n@@ -73,6 +72,7 @@\n import org.apache.directory.shared.ldap.message.ResultCodeEnum;\n import org.apache.directory.shared.ldap.message.spi.BinaryAttributeDetector;\n import org.apache.directory.shared.ldap.name.DN;\n+import org.junit.Ignore;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n import org.slf4j.Logger;\n@@ -416,6 +416,51 @@ public void testGssSpnegoBind() throws Exception\n         assertTrue( ArrayUtils.isEquals( \"type3_test\".getBytes(), provider.getType3Response() ) );\n     }\n \n+\n+    /**\n+     * Test for DIRAPI-30 (Sporadic NullPointerException during SASL bind).\n+     * Tests multiple connect/bind/unbind/disconnect.\n+     */\n+    @Ignore(\"Activate when DIRAPI-30 is solved\")\n+    @Test\n+    public void testSequentialBinds() throws Exception\n+    {\n+        LdapNetworkConnection connection;\n+        BindResponse resp;\n+        Entry entry;\n+        DN userDn = new DN( \"uid=hnelson,ou=users,dc=example,dc=com\" );\n+\n+        for ( int i = 0; i < 1000; i++ )\n+        {\n+            System.out.println( \"try \" + i );\n+            // Digest-MD5\n+            connection = new LdapNetworkConnection( \"localhost\", ldapServer.getPort() );\n+            resp = connection.bindDigestMd5( userDn.getName(), \"secret\", null, ldapServer.getSaslRealms()\n+                .get( 0 ) );\n+            assertEquals( ResultCodeEnum.SUCCESS, resp.getLdapResult().getResultCode() );\n+            entry = connection.lookup( userDn );\n+            assertEquals( \"hnelson\", entry.get( \"uid\" ).getString() );\n+            connection.close();\n+\n+            // Cram-MD5\n+            connection = new LdapNetworkConnection( \"localhost\", ldapServer.getPort() );\n+            resp = connection.bindCramMd5( userDn.getName(), \"secret\", null );\n+            assertEquals( ResultCodeEnum.SUCCESS, resp.getLdapResult().getResultCode() );\n+            entry = connection.lookup( userDn );\n+            assertEquals( \"hnelson\", entry.get( \"uid\" ).getString() );\n+            connection.close();\n+\n+            // GSSAPI\n+            connection = new LdapNetworkConnection( \"localhost\", ldapServer.getPort() );\n+            resp = connection.bindGssApi( userDn.getName(), \"secret\", ldapServer.getSaslRealms().get( 0 )\n+                .toUpperCase(), \"localhost\", 6088 );\n+            assertEquals( ResultCodeEnum.SUCCESS, resp.getLdapResult().getResultCode() );\n+            entry = connection.lookup( userDn );\n+            assertEquals( \"hnelson\", entry.get( \"uid\" ).getString() );\n+            connection.close();\n+        }\n+    }\n+\n     /**\n      * A NTLM client\n      */"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/8285e6be31e20a572d8547c0a061515b3def3882",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/a2e361bfb289496a037a584e5e924cceb0c54e97",
        "message": "Suppressed ProviderNexusAspect to throw NullPointerException in case user wants to create Invocations outside of the server context (e.g. Unit testing)\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@160541 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_6",
        "file": [
            {
                "sha": "542f9efb0010d4ecf6f3b22763f3cfaaf653f369",
                "filename": "core/src/main/aspects/org/apache/ldap/server/jndi/ProviderNexusAspect.aj",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/directory-server/blob/8285e6be31e20a572d8547c0a061515b3def3882/core/src/main/aspects/org/apache/ldap/server/jndi/ProviderNexusAspect.aj",
                "raw_url": "https://github.com/apache/directory-server/raw/8285e6be31e20a572d8547c0a061515b3def3882/core/src/main/aspects/org/apache/ldap/server/jndi/ProviderNexusAspect.aj",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/aspects/org/apache/ldap/server/jndi/ProviderNexusAspect.aj?ref=8285e6be31e20a572d8547c0a061515b3def3882",
                "patch": "@@ -120,9 +120,9 @@ public aspect ProviderNexusAspect\n     {\n         Stack stack = ( Stack ) JndiProvider.s_contextStacks.get();\n         \n-        if ( null == stack )\n+        if ( stack == null )\n         {\n-            throw new NullPointerException( \"Thread had null stack\" );\n+            return null;\n         }\n         \n         return ( Stack ) stack.clone();"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/6842891fdb7a96cbcaad27a3c30b4316f6a66a65",
        "message": "o Fixed some checkstyle error\no Fixed a potential NPE \n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/apacheds-value@1770266 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_7",
        "file": [
            {
                "sha": "90515cf3c973703633b2b044c739b145c083b516",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/InterceptorEnum.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-api/src/main/java/org/apache/directory/server/core/api/InterceptorEnum.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-api/src/main/java/org/apache/directory/server/core/api/InterceptorEnum.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/InterceptorEnum.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -51,7 +51,7 @@\n      * The private constructor\n      * @param methodName The associated interceptor name\n      */\n-    private InterceptorEnum( String name )\n+    InterceptorEnum( String name )\n     {\n         this.name = name;\n     }"
            },
            {
                "sha": "ac760a92c488d042082f1e2ee182a949ca122780",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/OperationEnum.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-api/src/main/java/org/apache/directory/server/core/api/OperationEnum.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-api/src/main/java/org/apache/directory/server/core/api/OperationEnum.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/OperationEnum.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -69,7 +69,7 @@\n      * The private constructor\n      * @param methodName The associated method name\n      */\n-    private OperationEnum( String methodName )\n+    OperationEnum( String methodName )\n     {\n         this.methodName = methodName;\n     }"
            },
            {
                "sha": "ce0ad663018f97d6ca9f909971dc626cb4eaeeee",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/ReferralHandlingMode.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-api/src/main/java/org/apache/directory/server/core/api/ReferralHandlingMode.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-api/src/main/java/org/apache/directory/server/core/api/ReferralHandlingMode.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/ReferralHandlingMode.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -50,7 +50,7 @@\n      * @see Context#REFERRAL\n      * @param jndiValue the JNDI Context.REFERRAL key's value\n      */\n-    private ReferralHandlingMode( String jndiValue )\n+    ReferralHandlingMode( String jndiValue )\n     {\n         this.jndiValue = jndiValue;\n     }"
            },
            {
                "sha": "9fd2de4f89c0f4647f285c5d583fbfdb19307764",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/authn/ppolicy/CheckQualityEnum.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-api/src/main/java/org/apache/directory/server/core/api/authn/ppolicy/CheckQualityEnum.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-api/src/main/java/org/apache/directory/server/core/api/authn/ppolicy/CheckQualityEnum.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/authn/ppolicy/CheckQualityEnum.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -51,7 +51,7 @@\n     /**\n      * Create a new instance of this enum\n      */\n-    private CheckQualityEnum( int value )\n+    CheckQualityEnum( int value )\n     {\n         this.value = value;\n     }"
            },
            {
                "sha": "4491442537cb6c6083fa099e5d6dc929851dbfbb",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/changelog/RevisionOrder.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-api/src/main/java/org/apache/directory/server/core/api/changelog/RevisionOrder.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-api/src/main/java/org/apache/directory/server/core/api/changelog/RevisionOrder.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/changelog/RevisionOrder.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -34,7 +34,7 @@\n     private final boolean ascending;\n \n \n-    private RevisionOrder( boolean ascending )\n+    RevisionOrder( boolean ascending )\n     {\n         this.ascending = ascending;\n     }"
            },
            {
                "sha": "d62442be9b9a198fb76e4ad3a275e75f37a0ada9",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/event/EventType.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-api/src/main/java/org/apache/directory/server/core/api/event/EventType.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-api/src/main/java/org/apache/directory/server/core/api/event/EventType.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/event/EventType.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -48,7 +48,7 @@\n     private int mask;\n \n \n-    private EventType( int mask )\n+    EventType( int mask )\n     {\n         this.mask = mask;\n     }"
            },
            {
                "sha": "bcf64c52d8a6a85261caa97846fc4bed32d172e6",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/BindOperationContext.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/BindOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/BindOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/BindOperationContext.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -24,6 +24,7 @@\n import org.apache.directory.api.ldap.model.constants.AuthenticationLevel;\n import org.apache.directory.api.ldap.model.exception.LdapAuthenticationException;\n import org.apache.directory.api.ldap.model.message.MessageTypeEnum;\n+import org.apache.directory.api.ldap.model.name.Dn;\n import org.apache.directory.api.util.Strings;\n import org.apache.directory.server.core.api.CoreSession;\n import org.apache.directory.server.core.api.OperationEnum;\n@@ -88,11 +89,11 @@ public BindOperationContext( CoreSession session )\n     public AuthenticationLevel getAuthenticationLevel() throws LdapAuthenticationException\n     {\n         // First check if the SASL mechanism has been set\n-        if ( ( saslMechanism == null ) )\n+        if ( saslMechanism == null )\n         {\n             // No, it's either a SIMPLE, ANONYMOUS, UNAUTHENT or an error\n             //\n-            if ( dn.isEmpty() )\n+            if ( Dn.isNullOrEmpty( dn ) )\n             {\n                 if ( Strings.isEmpty( credentials ) )\n                 {"
            },
            {
                "sha": "1fe450b40399eb029410b7ddc4c9ace23154423e",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/sp/StoredProcEngine.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-api/src/main/java/org/apache/directory/server/core/api/sp/StoredProcEngine.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-api/src/main/java/org/apache/directory/server/core/api/sp/StoredProcEngine.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/sp/StoredProcEngine.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -46,7 +46,7 @@\n      * <p>\n      * This method should be called before an attempt to invoke a stored procedure via this Engine.\n      */\n-    void setSPUnitEntry( final Entry spUnit );\n+    void setSPUnitEntry( Entry spUnit );\n \n \n     /**"
            },
            {
                "sha": "2a8417ca4783988f20f3d063424262f341a45716",
                "filename": "core-avl/src/main/java/org/apache/directory/server/core/avltree/avl/AvlNode.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-avl/src/main/java/org/apache/directory/server/core/avltree/avl/AvlNode.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-avl/src/main/java/org/apache/directory/server/core/avltree/avl/AvlNode.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-avl/src/main/java/org/apache/directory/server/core/avltree/avl/AvlNode.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -37,7 +37,7 @@\n     T value = null;\n \n \n-    public AvlNode( AvlNode<T> parent, T value )\n+    AvlNode( AvlNode<T> parent, T value )\n     {\n         this.parent = parent;\n         this.value = value;"
            },
            {
                "sha": "ad1104581a1a1b947b04c9c3f3ba22048b5af3d1",
                "filename": "core-avl/src/main/java/org/apache/directory/server/core/avltree/avl/AvlTreeIterator.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-avl/src/main/java/org/apache/directory/server/core/avltree/avl/AvlTreeIterator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-avl/src/main/java/org/apache/directory/server/core/avltree/avl/AvlTreeIterator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-avl/src/main/java/org/apache/directory/server/core/avltree/avl/AvlTreeIterator.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -36,7 +36,7 @@\n     private boolean initial = true;\n \n \n-    public AvlTreeIterator( AvlNode<T> root )\n+    AvlTreeIterator( AvlNode<T> root )\n     {\n         this.root = root;\n         findNext();"
            },
            {
                "sha": "8856bf94cc852a2c8463733832dafba3698fd2ba",
                "filename": "core-shared/src/main/java/org/apache/directory/server/core/shared/SortedEntryComparator.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-shared/src/main/java/org/apache/directory/server/core/shared/SortedEntryComparator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/core-shared/src/main/java/org/apache/directory/server/core/shared/SortedEntryComparator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-shared/src/main/java/org/apache/directory/server/core/shared/SortedEntryComparator.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -67,7 +67,7 @@\n      * @param mrOid the OID or name of the matchingrule\n      * @param reverse flag to indicate the sort order\n      */\n-    public SortedEntryComparator( AttributeType at, String mrule, boolean reverse, SchemaManager schemaManager ) throws LdapException\n+    SortedEntryComparator( AttributeType at, String mrule, boolean reverse, SchemaManager schemaManager ) throws LdapException\n     {\n         this.type = at;\n         this.reverse = reverse;"
            },
            {
                "sha": "84408dc0d258b676cfea993de8da09b4f3278be0",
                "filename": "interceptors/event/src/main/java/org/apache/directory/server/core/event/DefaultEventService.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/interceptors/event/src/main/java/org/apache/directory/server/core/event/DefaultEventService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/interceptors/event/src/main/java/org/apache/directory/server/core/event/DefaultEventService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/interceptors/event/src/main/java/org/apache/directory/server/core/event/DefaultEventService.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -60,7 +60,7 @@\n      * @param directoryService The associated DirectoryService\n      * @param registrations The list of Registrations\n      */\n-    public DefaultEventService( DirectoryService directoryService )\n+    DefaultEventService( DirectoryService directoryService )\n     {\n         this.directoryService = directoryService;\n         SchemaManager schemaManager = directoryService.getSchemaManager();"
            },
            {
                "sha": "577199b367d42817cfd3220aac55d0b64f12d0ed",
                "filename": "jdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/DupsCursor.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/jdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/DupsCursor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/jdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/DupsCursor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/jdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/DupsCursor.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -92,7 +92,7 @@\n     private boolean valueAvailable;\n \n \n-    public DupsCursor( JdbmTable<K, V> table )\n+    DupsCursor( JdbmTable<K, V> table )\n     {\n         if ( IS_DEBUG )\n         {"
            },
            {
                "sha": "edff4ac6139efc866a4df994ad02004d904ebe7c",
                "filename": "jdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/NoDupsCursor.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/jdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/NoDupsCursor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/jdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/NoDupsCursor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/jdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/NoDupsCursor.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -64,7 +64,7 @@\n      * @param table the JDBM Table to build a Cursor over\n      * @throws IOException of there are problems accessing the BTree\n      */\n-    public NoDupsCursor( JdbmTable<K, V> table )\n+    NoDupsCursor( JdbmTable<K, V> table )\n     {\n         if ( IS_DEBUG )\n         {"
            },
            {
                "sha": "6dfc46bc71a02d414a2c210c5be3072d59a02423",
                "filename": "ldif-partition/src/main/java/org/apache/directory/server/core/partition/ldif/SingleFileLdifPartition.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/ldif-partition/src/main/java/org/apache/directory/server/core/partition/ldif/SingleFileLdifPartition.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/ldif-partition/src/main/java/org/apache/directory/server/core/partition/ldif/SingleFileLdifPartition.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/ldif-partition/src/main/java/org/apache/directory/server/core/partition/ldif/SingleFileLdifPartition.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -414,7 +414,7 @@ private void appendLdif( Entry entry ) throws IOException, LdapException\n         private long len;\n \n \n-        public RandomAccessLdifReader() throws LdapException\n+        RandomAccessLdifReader() throws LdapException\n         {\n             try\n             {"
            },
            {
                "sha": "32910b1c327c9649ea03f3362130fa0848f98246",
                "filename": "mavibot-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/mavibot/MavibotCursor.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/mavibot-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/mavibot/MavibotCursor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/mavibot-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/mavibot/MavibotCursor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/mavibot-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/mavibot/MavibotCursor.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -62,7 +62,7 @@\n      *\n      * @param table the JDBM Table to build a Cursor over\n      */\n-    public MavibotCursor( MavibotTable<K, V> table )\n+    MavibotCursor( MavibotTable<K, V> table )\n     {\n         LOG_CURSOR.debug( \"Creating MavibotCursor {}\", this );\n         this.table = table;"
            },
            {
                "sha": "e09785b4c51ff179843d7a676ab2db09c28b4df4",
                "filename": "protocol-dhcp/src/main/java/org/apache/directory/server/dhcp/messages/MessageType.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dhcp/src/main/java/org/apache/directory/server/dhcp/messages/MessageType.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dhcp/src/main/java/org/apache/directory/server/dhcp/messages/MessageType.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-dhcp/src/main/java/org/apache/directory/server/dhcp/messages/MessageType.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -70,7 +70,7 @@ public byte getCode()\n     /**\n      * Private constructor prevents construction outside of this class.\n      */\n-    private MessageType( byte ordinal, String name )\n+    MessageType( byte ordinal, String name )\n     {\n         this.ordinal = ordinal;\n         this.name = name;"
            },
            {
                "sha": "8206fbc71e55023c53302fe59e1513abb5327465",
                "filename": "protocol-dns/src/main/java/org/apache/directory/server/dns/messages/MessageType.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/MessageType.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/MessageType.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/MessageType.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -41,7 +41,7 @@\n     private final byte value;\n \n \n-    private MessageType( int value )\n+    MessageType( int value )\n     {\n         this.value = ( byte ) value;\n     }"
            },
            {
                "sha": "b1f6329a16c804e3a6f4359f659b361adc02f401",
                "filename": "protocol-dns/src/main/java/org/apache/directory/server/dns/messages/OpCode.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/OpCode.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/OpCode.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/OpCode.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -50,7 +50,7 @@\n     private final byte value;\n \n \n-    private OpCode( int value )\n+    OpCode( int value )\n     {\n         this.value = ( byte ) value;\n     }"
            },
            {
                "sha": "a22409fc827690ddc03812beab3639f72df2ef4e",
                "filename": "protocol-dns/src/main/java/org/apache/directory/server/dns/messages/ProtocolType.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/ProtocolType.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/ProtocolType.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/ProtocolType.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -164,7 +164,7 @@\n     private final byte value;\n \n \n-    private ProtocolType( int value )\n+    ProtocolType( int value )\n     {\n         this.value = ( byte ) value;\n     }"
            },
            {
                "sha": "19fade152f3edb842c41d4bde70bd5f53d0bd37b",
                "filename": "protocol-dns/src/main/java/org/apache/directory/server/dns/messages/RecordClass.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/RecordClass.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/RecordClass.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/RecordClass.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -53,7 +53,7 @@\n     private final short value;\n \n \n-    private RecordClass( int value )\n+    RecordClass( int value )\n     {\n         this.value = ( short ) value;\n     }"
            },
            {
                "sha": "f60c905d7b08f0859e99d2667343a42b9cf6e7cc",
                "filename": "protocol-dns/src/main/java/org/apache/directory/server/dns/messages/RecordType.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/RecordType.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/RecordType.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/RecordType.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -194,7 +194,7 @@\n     private final short value;\n \n \n-    private RecordType( int value )\n+    RecordType( int value )\n     {\n         this.value = ( short ) value;\n     }"
            },
            {
                "sha": "a64d2888736c9bb013a43213c25eb7a9a3854d2a",
                "filename": "protocol-dns/src/main/java/org/apache/directory/server/dns/messages/ResponseCode.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/ResponseCode.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/ResponseCode.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/ResponseCode.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -53,7 +53,7 @@\n     private final byte value;\n \n \n-    private ResponseCode( int value )\n+    ResponseCode( int value )\n     {\n         this.value = ( byte ) value;\n     }"
            },
            {
                "sha": "20c57c249372b051a16c906f5337e4bc23006995",
                "filename": "protocol-dns/src/main/java/org/apache/directory/server/dns/messages/ServiceType.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/ServiceType.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/ServiceType.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-dns/src/main/java/org/apache/directory/server/dns/messages/ServiceType.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -275,7 +275,7 @@\n     private final byte value;\n \n \n-    private ServiceType( int value )\n+    ServiceType( int value )\n     {\n         this.value = ( byte ) value;\n     }"
            },
            {
                "sha": "582f6a6ee89d0cb456166a0411c7826ef2073e1a",
                "filename": "protocol-dns/src/main/java/org/apache/directory/server/dns/store/jndi/DnsCatalog.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dns/src/main/java/org/apache/directory/server/dns/store/jndi/DnsCatalog.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-dns/src/main/java/org/apache/directory/server/dns/store/jndi/DnsCatalog.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-dns/src/main/java/org/apache/directory/server/dns/store/jndi/DnsCatalog.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -41,7 +41,7 @@\n      *\n      * @param map\n      */\n-    public DnsCatalog( Map<String, Object> map )\n+    DnsCatalog( Map<String, Object> map )\n     {\n         this.map = map;\n     }"
            },
            {
                "sha": "4ed6788197b393bd0439a971bea696f1344a910b",
                "filename": "protocol-ntp/src/main/java/org/apache/directory/server/ntp/messages/LeapIndicatorType.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-ntp/src/main/java/org/apache/directory/server/ntp/messages/LeapIndicatorType.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-ntp/src/main/java/org/apache/directory/server/ntp/messages/LeapIndicatorType.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ntp/src/main/java/org/apache/directory/server/ntp/messages/LeapIndicatorType.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -71,7 +71,7 @@\n     /**\n      * Private constructor prevents construction outside of this class.\n      */\n-    private LeapIndicatorType( int ordinal, String name )\n+    LeapIndicatorType( int ordinal, String name )\n     {\n         this.ordinal = ordinal;\n         this.name = name;"
            },
            {
                "sha": "0aae530226cbdd9a865d5182756d2716be14e2fb",
                "filename": "protocol-ntp/src/main/java/org/apache/directory/server/ntp/messages/ModeType.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-ntp/src/main/java/org/apache/directory/server/ntp/messages/ModeType.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-ntp/src/main/java/org/apache/directory/server/ntp/messages/ModeType.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ntp/src/main/java/org/apache/directory/server/ntp/messages/ModeType.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -94,7 +94,7 @@\n     /**\n      * Private constructor prevents construction outside of this class.\n      */\n-    private ModeType( int ordinal, String name )\n+    ModeType( int ordinal, String name )\n     {\n         this.ordinal = ordinal;\n         this.name = name;"
            },
            {
                "sha": "bb73640565c808569cf5bdeab3ff47bb0c1ac3f1",
                "filename": "protocol-ntp/src/main/java/org/apache/directory/server/ntp/messages/StratumType.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-ntp/src/main/java/org/apache/directory/server/ntp/messages/StratumType.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-ntp/src/main/java/org/apache/directory/server/ntp/messages/StratumType.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ntp/src/main/java/org/apache/directory/server/ntp/messages/StratumType.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -65,7 +65,7 @@\n     /**\n      * Private constructor prevents construction outside of this class.\n      */\n-    private StratumType( int ordinal, String name )\n+    StratumType( int ordinal, String name )\n     {\n         this.ordinal = ordinal;\n         this.name = name;"
            },
            {
                "sha": "b1296492f0963cbd9aa5c94c1a5a5d7e68b946d4",
                "filename": "protocol-shared/src/main/java/org/apache/directory/server/protocol/shared/TransportProtocol.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-shared/src/main/java/org/apache/directory/server/protocol/shared/TransportProtocol.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/protocol-shared/src/main/java/org/apache/directory/server/protocol/shared/TransportProtocol.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-shared/src/main/java/org/apache/directory/server/protocol/shared/TransportProtocol.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -32,7 +32,7 @@\n     private final String stringValue;\n \n \n-    private TransportProtocol( int intValue, String stringValue )\n+    TransportProtocol( int intValue, String stringValue )\n     {\n         this.intValue = intValue;\n         this.stringValue = stringValue;"
            },
            {
                "sha": "52b0b6382e9ec50c420d4796d7256d6f9b5c453a",
                "filename": "server-config/src/main/java/org/apache/directory/server/config/ConfigSchemaConstants.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/server-config/src/main/java/org/apache/directory/server/config/ConfigSchemaConstants.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/server-config/src/main/java/org/apache/directory/server/config/ConfigSchemaConstants.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-config/src/main/java/org/apache/directory/server/config/ConfigSchemaConstants.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -285,7 +285,7 @@\n \n \n     /** A private constructor */\n-    private ConfigSchemaConstants( String value, String oid )\n+    ConfigSchemaConstants( String value, String oid )\n     {\n         this.value = value;\n         this.oid = oid;"
            },
            {
                "sha": "6a7ebad17a6c66c93e5e76de2407e792d8546761",
                "filename": "service/src/main/java/org/apache/directory/server/UberjarMain.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/service/src/main/java/org/apache/directory/server/UberjarMain.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fdfa43716a9fe8ff373b928048788b27f3ccb5bc/service/src/main/java/org/apache/directory/server/UberjarMain.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/service/src/main/java/org/apache/directory/server/UberjarMain.java?ref=fdfa43716a9fe8ff373b928048788b27f3ccb5bc",
                "patch": "@@ -73,7 +73,7 @@ public static void main( String[] args ) throws Exception\n         {\n             case START :\n                 // Starts the server\n-                LOG.debug( \"Staring runtime\" );\n+                LOG.debug( \"Starting runtime\" );\n                 instance.start( instanceDirectory );\n \n                 break;"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/ef5b198cc3e5b3085ee1aa73e779b7c27b784bf4",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/b46f04df74fd16df992492af6d230a4107c09a22",
        "message": "Avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1177777 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_8",
        "file": [
            {
                "sha": "7ce3147990a4a23803c963d2e7e4d06d22dd9932",
                "filename": "core-annotations/src/main/java/org/apache/directory/server/core/factory/DSAnnotationProcessor.java",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/apache/directory-server/blob/ef5b198cc3e5b3085ee1aa73e779b7c27b784bf4/core-annotations/src/main/java/org/apache/directory/server/core/factory/DSAnnotationProcessor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/ef5b198cc3e5b3085ee1aa73e779b7c27b784bf4/core-annotations/src/main/java/org/apache/directory/server/core/factory/DSAnnotationProcessor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-annotations/src/main/java/org/apache/directory/server/core/factory/DSAnnotationProcessor.java?ref=ef5b198cc3e5b3085ee1aa73e779b7c27b784bf4",
                "patch": "@@ -248,10 +248,12 @@ public static DirectoryService getDirectoryService() throws Exception\n         if ( instance != null )\n         {\n             dsBuilder = (CreateDS)instance;\n-        }\n \n-        // Ok, we have found a CreateDS annotation. Process it now.\n-        return createDS( dsBuilder );\n+            // Ok, we have found a CreateDS annotation. Process it now.\n+            return createDS( dsBuilder );\n+        }\n+        \n+        throw new LdapException( I18n.err( I18n.ERR_114 ) );\n     }\n \n "
            },
            {
                "sha": "08b75d786e94aa03efc64730175d84d884c872ce",
                "filename": "i18n/src/main/java/org/apache/directory/server/i18n/I18n.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/ef5b198cc3e5b3085ee1aa73e779b7c27b784bf4/i18n/src/main/java/org/apache/directory/server/i18n/I18n.java",
                "raw_url": "https://github.com/apache/directory-server/raw/ef5b198cc3e5b3085ee1aa73e779b7c27b784bf4/i18n/src/main/java/org/apache/directory/server/i18n/I18n.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/i18n/src/main/java/org/apache/directory/server/i18n/I18n.java?ref=ef5b198cc3e5b3085ee1aa73e779b7c27b784bf4",
                "patch": "@@ -147,7 +147,7 @@\n     // ERR_111( \"ERR_111\" ),\n     // ERR_112( \"ERR_112\" ),\n     // ERR_113( \"ERR_113\" ),\n-    // ERR_114( \"ERR_ 114\" ),\n+    ERR_114(\"ERR_114\"),\n     ERR_115(\"ERR_115\"),\n     ERR_116(\"ERR_116\"),\n     ERR_117(\"ERR_117\"),"
            },
            {
                "sha": "69447c2858014879ba937ed410d1aa4cf804ea1f",
                "filename": "i18n/src/main/resources/org/apache/directory/server/i18n/errors.properties",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/ef5b198cc3e5b3085ee1aa73e779b7c27b784bf4/i18n/src/main/resources/org/apache/directory/server/i18n/errors.properties",
                "raw_url": "https://github.com/apache/directory-server/raw/ef5b198cc3e5b3085ee1aa73e779b7c27b784bf4/i18n/src/main/resources/org/apache/directory/server/i18n/errors.properties",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/i18n/src/main/resources/org/apache/directory/server/i18n/errors.properties?ref=ef5b198cc3e5b3085ee1aa73e779b7c27b784bf4",
                "patch": "@@ -135,7 +135,7 @@ ERR_91=Attempt to destroy wrapped partition failed.\n # ERR_111=\n # ERR_112=\n # ERR_113=\n-# ERR_114=\n+ERR_114=Unable to create a DirectoryService instance for unknow reason\n ERR_115=Failed to delete the working directory.\n ERR_116=Failed to delete\\: \n ERR_117=Unsupported changetype found in LDIF: {0}"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/cb99ab541b2440e8fe4e6fb42d08948ca59550ac",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/d13ef60f5205c1471dbde2cfa87aa4e9961a0434",
        "message": "o Fixed a NPE if the pwdGraceAuthNLimit is set to 0 with an expired pwdAge \no Added some more protections against NPE in PP code\no Added some tests for PP\no Renamed a class (type)\no Renamed two methods (typoes too, I guess)\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1467813 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_9",
        "file": [
            {
                "sha": "37bc41c15cea43bbe4de3d2cc32a125f7ee73f02",
                "filename": "interceptors/authn/src/main/java/org/apache/directory/server/core/authn/AbstractAuthenticator.java",
                "status": "modified",
                "additions": 37,
                "deletions": 17,
                "changes": 54,
                "blob_url": "https://github.com/apache/directory-server/blob/cb99ab541b2440e8fe4e6fb42d08948ca59550ac/interceptors/authn/src/main/java/org/apache/directory/server/core/authn/AbstractAuthenticator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/cb99ab541b2440e8fe4e6fb42d08948ca59550ac/interceptors/authn/src/main/java/org/apache/directory/server/core/authn/AbstractAuthenticator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/interceptors/authn/src/main/java/org/apache/directory/server/core/authn/AbstractAuthenticator.java?ref=cb99ab541b2440e8fe4e6fb42d08948ca59550ac",
                "patch": "@@ -174,6 +174,7 @@ public void checkPwdPolicy( Entry userEntry ) throws LdapException\n             LOG.debug( \"checking if account with the Dn {} is locked\", userEntry.getDn() );\n \n             Attribute accountLockAttr = userEntry.get( PWD_ACCOUNT_LOCKED_TIME_AT );\n+\n             if ( accountLockAttr != null )\n             {\n                 String lockedTime = accountLockAttr.getString();\n@@ -186,30 +187,34 @@ public void checkPwdPolicy( Entry userEntry ) throws LdapException\n                     Date lockedDate = DateUtils.getDate( lockedTime );\n                     long unlockTime = pPolicyConfig.getPwdLockoutDuration() * 1000L;\n                     unlockTime += lockedDate.getTime();\n-                    \n+\n                     Date unlockDate = new Date( unlockTime );\n                     Date now = DateUtils.getDate( DateUtils.getGeneralizedTime() );\n-                    \n-                    if( unlockDate.after( now ) )\n+\n+                    if ( unlockDate.after( now ) )\n                     {\n-                        throw new PasswordPolicyException( \"account will remain locked till \" + unlockDate, ACCOUNT_LOCKED.getValue() );\n+                        throw new PasswordPolicyException( \"account will remain locked till \" + unlockDate,\n+                            ACCOUNT_LOCKED.getValue() );\n                     }\n                     else\n                     {\n                         // remove pwdAccountLockedTime attribute\n-                        Modification pwdAccountLockMod = new DefaultModification( ModificationOperation.REMOVE_ATTRIBUTE,  accountLockAttr );\n-                        ModifyOperationContext modContext = new ModifyOperationContext( directoryService.getAdminSession() );\n+                        Modification pwdAccountLockMod = new DefaultModification(\n+                            ModificationOperation.REMOVE_ATTRIBUTE, accountLockAttr );\n+                        ModifyOperationContext modContext = new ModifyOperationContext(\n+                            directoryService.getAdminSession() );\n                         modContext.setDn( userEntry.getDn() );\n-                        \n+\n                         modContext.setModItems( Collections.singletonList( pwdAccountLockMod ) );\n-                        \n+\n                         directoryService.getPartitionNexus().modify( modContext );\n                     }\n                 }\n             }\n         }\n \n         Attribute pwdStartTimeAttr = userEntry.get( PWD_START_TIME_AT );\n+\n         if ( pwdStartTimeAttr != null )\n         {\n             Date pwdStartTime = DateUtils.getDate( pwdStartTimeAttr.getString() );\n@@ -222,6 +227,7 @@ public void checkPwdPolicy( Entry userEntry ) throws LdapException\n         }\n \n         Attribute pwdEndTimeAttr = userEntry.get( PWD_END_TIME_AT );\n+\n         if ( pwdEndTimeAttr != null )\n         {\n             Date pwdEndTime = DateUtils.getDate( pwdEndTimeAttr.getString() );\n@@ -237,18 +243,26 @@ public void checkPwdPolicy( Entry userEntry ) throws LdapException\n         if ( pPolicyConfig.getPwdMaxIdle() > 0 )\n         {\n             Attribute pwdLastSuccessTimeAttr = userEntry.get( PWD_LAST_SUCCESS_AT );\n-            long time = pPolicyConfig.getPwdMaxIdle() * 1000L;\n-            time += DateUtils.getDate( pwdLastSuccessTimeAttr.getString() ).getTime();\n \n-            if ( System.currentTimeMillis() >= time )\n+            // Let's be sure that the user has already logged in\n+            if ( pwdLastSuccessTimeAttr != null )\n             {\n-                throw new PasswordPolicyException(\n-                    \"account locked due to the max idle time of the password was exceeded\", ACCOUNT_LOCKED.getValue() );\n+                long time = pPolicyConfig.getPwdMaxIdle() * 1000L;\n+                time += DateUtils.getDate( pwdLastSuccessTimeAttr.getString() ).getTime();\n+\n+                if ( System.currentTimeMillis() >= time )\n+                {\n+                    throw new PasswordPolicyException(\n+                        \"account locked due to the max idle time of the password was exceeded\",\n+                        ACCOUNT_LOCKED.getValue() );\n+                }\n             }\n         }\n \n+        // Chekc that the password is not too old and need to be disabled\n         if ( pPolicyConfig.getPwdMaxAge() > 0 )\n         {\n+            // In case we have a grace number of attempts\n             if ( pPolicyConfig.getPwdGraceAuthNLimit() > 0 )\n             {\n                 Attribute pwdGraceUseAttr = userEntry.get( PWD_GRACE_USE_TIME_AT );\n@@ -265,13 +279,19 @@ public void checkPwdPolicy( Entry userEntry ) throws LdapException\n             }\n             else\n             {\n+                // No grace attempt : check if the password has expired or not\n                 Attribute pwdChangeTimeAttr = userEntry.get( PWD_CHANGED_TIME_AT );\n-                boolean expired = PasswordUtil.isPwdExpired( pwdChangeTimeAttr.getString(),\n-                    pPolicyConfig.getPwdMaxAge() );\n \n-                if ( expired )\n+                // If the attr is null, this is the admin user. We don't block it\n+                if ( pwdChangeTimeAttr != null )\n                 {\n-                    throw new PasswordPolicyException( \"paasword expired\", PASSWORD_EXPIRED.getValue() );\n+                    boolean expired = PasswordUtil.isPwdExpired( pwdChangeTimeAttr.getString(),\n+                        pPolicyConfig.getPwdMaxAge() );\n+\n+                    if ( expired )\n+                    {\n+                        throw new PasswordPolicyException( \"paasword expired\", PASSWORD_EXPIRED.getValue() );\n+                    }\n                 }\n             }\n         }"
            },
            {
                "sha": "2eedd9fcf2fc147b414c16fc4e5d46240de5c200",
                "filename": "interceptors/authn/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/cb99ab541b2440e8fe4e6fb42d08948ca59550ac/interceptors/authn/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/cb99ab541b2440e8fe4e6fb42d08948ca59550ac/interceptors/authn/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/interceptors/authn/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java?ref=cb99ab541b2440e8fe4e6fb42d08948ca59550ac",
                "patch": "@@ -655,7 +655,7 @@ else if ( policyConfig != null )\n                             numGraceAuth = policyConfig.getPwdGraceAuthNLimit() - 1;\n                         }\n \n-                        pwdRespCtrl.getResponse().setGraceAuthNsRemaining( numGraceAuth );\n+                        pwdRespCtrl.getResponse().setGraceAuthNRemaining( numGraceAuth );\n \n                         pwdGraceUseAttr.add( DateUtils.getGeneralizedTime() );\n                         Modification pwdGraceUseMod = new DefaultModification( ADD_ATTRIBUTE, pwdGraceUseAttr );"
            },
            {
                "sha": "bd42b3c465e788f9ad4500dfeb8c6be84df0a98e",
                "filename": "server-integ/src/test/java/org/apache/directory/server/ppolicy/PasswordPolicyIT.java",
                "status": "modified",
                "additions": 258,
                "deletions": 159,
                "changes": 417,
                "blob_url": "https://github.com/apache/directory-server/blob/cb99ab541b2440e8fe4e6fb42d08948ca59550ac/server-integ/src/test/java/org/apache/directory/server/ppolicy/PasswordPolicyIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/cb99ab541b2440e8fe4e6fb42d08948ca59550ac/server-integ/src/test/java/org/apache/directory/server/ppolicy/PasswordPolicyIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-integ/src/test/java/org/apache/directory/server/ppolicy/PasswordPolicyIT.java?ref=cb99ab541b2440e8fe4e6fb42d08948ca59550ac",
                "patch": "@@ -22,7 +22,6 @@\n \n import static org.apache.directory.api.ldap.extras.controls.ppolicy.PasswordPolicyErrorEnum.INSUFFICIENT_PASSWORD_QUALITY;\n import static org.apache.directory.api.ldap.extras.controls.ppolicy.PasswordPolicyErrorEnum.PASSWORD_EXPIRED;\n-import static org.apache.directory.api.ldap.extras.controls.ppolicy.PasswordPolicyErrorEnum.PASSWORD_TOO_SHORT;\n import static org.apache.directory.api.ldap.model.constants.PasswordPolicySchemaConstants.PWD_ACCOUNT_LOCKED_TIME_AT;\n import static org.apache.directory.api.ldap.model.constants.PasswordPolicySchemaConstants.PWD_CHANGED_TIME_AT;\n import static org.apache.directory.api.ldap.model.constants.PasswordPolicySchemaConstants.PWD_FAILURE_TIME_AT;\n@@ -111,6 +110,9 @@\n         new PasswordPolicyDecorator( codec, new PasswordPolicyImpl() );\n \n \n+    /**\n+     * Set a default PaswordPolicy configuration\n+     */\n     @Before\n     public void setPwdPolicy() throws LdapException\n     {\n@@ -131,10 +133,8 @@ public void setPwdPolicy() throws LdapException\n         policyContainer.setDefaultPolicy( policyConfig );\n         AuthenticationInterceptor authenticationInterceptor = ( AuthenticationInterceptor ) getService()\n             .getInterceptor( InterceptorEnum.AUTHENTICATION_INTERCEPTOR.getName() );\n-        authenticationInterceptor.setPwdPolicies( policyContainer );\n \n-        AuthenticationInterceptor authInterceptor = ( AuthenticationInterceptor ) getService()\n-            .getInterceptor( InterceptorEnum.AUTHENTICATION_INTERCEPTOR.getName() );\n+        authenticationInterceptor.setPwdPolicies( policyContainer );\n     }\n \n \n@@ -145,6 +145,9 @@ public void closeConnections()\n     }\n \n \n+    /**\n+     * Get the PasswordPolicy control from a response\n+     */\n     private PasswordPolicy getPwdRespCtrl( Response resp ) throws Exception\n     {\n         Control control = resp.getControls().get( PP_REQ_CTRL.getOid() );\n@@ -158,48 +161,87 @@ private PasswordPolicy getPwdRespCtrl( Response resp ) throws Exception\n     }\n \n \n-    @Test\n-    public void testAddUserWithClearTextPwd() throws Exception\n+    /**\n+     * Add a user with a password\n+     */\n+    private void addUser( LdapConnection adminConnection, String user, Object password ) throws Exception\n     {\n-        LdapConnection adminConnection = getAdminNetworkConnection( getLdapServer() );\n-\n-        Dn userDn = new Dn( \"cn=user,ou=system\" );\n         Entry userEntry = new DefaultEntry(\n-            userDn,\n+            \"cn=\" + user + \",ou=system\",\n             \"ObjectClass: top\",\n             \"ObjectClass: person\",\n-            \"cn: user\",\n-            \"sn: user_sn\",\n-            \"userPassword: 1234\" );\n+            \"cn\", user,\n+            \"sn\", user + \"_sn\",\n+            \"userPassword\", password );\n \n         AddRequest addRequest = new AddRequestImpl();\n         addRequest.setEntry( userEntry );\n         addRequest.addControl( PP_REQ_CTRL );\n \n         AddResponse addResp = adminConnection.add( addRequest );\n-        assertEquals( ResultCodeEnum.CONSTRAINT_VIOLATION, addResp.getLdapResult().getResultCode() );\n-\n-        PasswordPolicy respCtrl = getPwdRespCtrl( addResp );\n-        assertNotNull( respCtrl );\n-        assertEquals( PASSWORD_TOO_SHORT, respCtrl.getResponse().getPasswordPolicyError() );\n-\n-        Attribute pwdAt = userEntry.get( SchemaConstants.USER_PASSWORD_AT );\n-        pwdAt.clear();\n-        pwdAt.add( \"12345\" );\n-\n-        addResp = adminConnection.add( addRequest );\n         assertEquals( ResultCodeEnum.SUCCESS, addResp.getLdapResult().getResultCode() );\n-        respCtrl = getPwdRespCtrl( addResp );\n+        PasswordPolicy respCtrl = getPwdRespCtrl( addResp );\n         assertNull( respCtrl );\n+    }\n \n-        LdapConnection userConnection = getNetworkConnectionAs( getLdapServer(), userDn.getName(), \"12345\" );\n+\n+    /**\n+     * Check we can bind a user with a given password\n+     */\n+    private void checkBindSuccess( Dn userDn, String password ) throws Exception\n+    {\n+        LdapConnection userConnection = getNetworkConnectionAs( getLdapServer(), userDn.getName(), password );\n         assertNotNull( userConnection );\n         assertTrue( userConnection.isAuthenticated() );\n+\n         userConnection.close();\n-        adminConnection.close();\n     }\n \n \n+    /**\n+     * Check we cannot bind a user with a given password\n+     */\n+    private void checkBindFailure( Dn userDn, String password ) throws Exception\n+    {\n+        try\n+        {\n+            LdapConnection userConnection = getNetworkConnectionAs( getLdapServer(), userDn.getName(), password );\n+            assertNull( userConnection );\n+            assertFalse( userConnection.isAuthenticated() );\n+\n+            userConnection.close();\n+        }\n+        catch ( LdapException le )\n+        {\n+            // Expected\n+        }\n+    }\n+\n+\n+    /**\n+     * Check that we can bind N times with a user/password\n+     */\n+    private void checkBind( LdapConnection connection, Dn userDn, String password, int nbIterations,\n+        String expectedMessage ) throws Exception\n+    {\n+        for ( int i = 0; i < nbIterations; i++ )\n+        {\n+            try\n+            {\n+                connection.bind( userDn, password );\n+            }\n+            catch ( LdapAuthenticationException le )\n+            {\n+                assertEquals( expectedMessage, le.getMessage() );\n+            }\n+        }\n+    }\n+\n+\n+    /**\n+     * Test that we can't inject a hashed password when the ChekcQuality is CHECK_REJECT,\n+     * and that we can when the CheckQuality is CHECK_ACCEPT\n+     */\n     @Test\n     public void testAddUserWithHashedPwd() throws Exception\n     {\n@@ -219,13 +261,15 @@ public void testAddUserWithHashedPwd() throws Exception\n         addRequest.setEntry( userEntry );\n         addRequest.addControl( PP_REQ_CTRL );\n \n+        // We should get a failure\n         AddResponse addResp = adminConnection.add( addRequest );\n         assertEquals( ResultCodeEnum.CONSTRAINT_VIOLATION, addResp.getLdapResult().getResultCode() );\n \n         PasswordPolicy respCtrl = getPwdRespCtrl( addResp );\n         assertNotNull( respCtrl );\n         assertEquals( INSUFFICIENT_PASSWORD_QUALITY, respCtrl.getResponse().getPasswordPolicyError() );\n \n+        // Relax the Check Quality to CHECK_ACCEPT\n         policyConfig.setPwdCheckQuality( CheckQualityEnum.CHECK_ACCEPT ); // allow the password if its quality can't be checked\n         Attribute pwdAt = userEntry.get( SchemaConstants.USER_PASSWORD_AT );\n         pwdAt.clear();\n@@ -370,39 +414,6 @@ public void testPwdMinAge() throws Exception\n     }\n \n \n-    /**\n-     * Check we can bind a user with a given password\n-     */\n-    private void checkBindSuccess( Dn userDn, String password ) throws Exception\n-    {\n-        LdapConnection userConnection = getNetworkConnectionAs( getLdapServer(), userDn.getName(), password );\n-        assertNotNull( userConnection );\n-        assertTrue( userConnection.isAuthenticated() );\n-\n-        userConnection.close();\n-    }\n-\n-\n-    /**\n-     * Check we cannot bind a user wth a given password\n-     */\n-    private void checkBindFailure( Dn userDn, String password ) throws Exception\n-    {\n-        try\n-        {\n-            LdapConnection userConnection = getNetworkConnectionAs( getLdapServer(), userDn.getName(), password );\n-            assertNull( userConnection );\n-            assertFalse( userConnection.isAuthenticated() );\n-\n-            userConnection.close();\n-        }\n-        catch ( LdapException le )\n-        {\n-            // Expected\n-        }\n-    }\n-\n-\n     /**\n      * Test the number of password we keep in history\n      */\n@@ -414,15 +425,9 @@ public void testPwdInHistory() throws Exception\n         LdapConnection adminConnection = getAdminNetworkConnection( getLdapServer() );\n \n         Dn userDn = new Dn( \"cn=userPwdHist,ou=system\" );\n-        Entry userEntry = new DefaultEntry(\n-            userDn.toString(),\n-            \"ObjectClass: top\",\n-            \"ObjectClass: person\",\n-            \"cn: userPwdHist\",\n-            \"sn: userPwdHist_sn\",\n-            \"userPassword: 12345\" );\n \n-        adminConnection.add( userEntry );\n+        addUser( adminConnection, \"userPwdHist\", \"12345\" );\n+\n         checkBindSuccess( userDn, \"12345\" );\n \n         Entry entry = adminConnection.lookup( userDn, \"*\", \"+\" );\n@@ -500,7 +505,7 @@ public void testPwdLength() throws Exception\n             \"sn: userLen_sn\",\n             \"userPassword: 1234\" );\n \n-        // Tryu with a password below the minLength\n+        // Try with a password below the minLength\n         try\n         {\n             adminConnection.add( userEntry );\n@@ -538,6 +543,177 @@ public void testPwdLength() throws Exception\n     }\n \n \n+    /**\n+     * Test the pwdMaxAge configuration. The password should expire when the pwdMaxAge is reached, and\n+     * the password should be locked as we don't have a grace limit. \n+     */\n+    @Test\n+    public void testPwdMaxAgeNoGraceAuthNLimit() throws Exception\n+    {\n+        policyConfig.setPwdMaxAge( 5 );\n+        policyConfig.setPwdGraceAuthNLimit( 0 );\n+\n+        LdapConnection adminConnection = getAdminNetworkConnection( getLdapServer() );\n+\n+        Dn userDn = new Dn( \"cn=userMaxAge,ou=system\" );\n+        String password = \"12345\";\n+\n+        addUser( adminConnection, \"userMaxAge\", password );\n+\n+        BindRequest bindReq = new BindRequestImpl();\n+        bindReq.setDn( userDn );\n+        bindReq.setCredentials( password.getBytes() );\n+        bindReq.addControl( PP_REQ_CTRL );\n+\n+        LdapConnection userCon = new LdapNetworkConnection( \"localhost\", ldapServer.getPort() );\n+        userCon.setTimeOut( 0 );\n+\n+        Thread.sleep( 1000 ); // sleep for one second so that the password expire warning will be sent\n+\n+        BindResponse bindResp = userCon.bind( bindReq );\n+        assertEquals( ResultCodeEnum.SUCCESS, bindResp.getLdapResult().getResultCode() );\n+\n+        PasswordPolicy respCtrl = getPwdRespCtrl( bindResp );\n+        assertNotNull( respCtrl );\n+        assertTrue( respCtrl.getResponse().getTimeBeforeExpiration() > 0 );\n+\n+        Thread.sleep( 4500 ); // sleep for four seconds and a half so that the password expires\n+\n+        // this time it should fail\n+        bindResp = userCon.bind( bindReq );\n+        assertEquals( ResultCodeEnum.INVALID_CREDENTIALS, bindResp.getLdapResult().getResultCode() );\n+\n+        respCtrl = getPwdRespCtrl( bindResp );\n+        assertEquals( PASSWORD_EXPIRED, respCtrl.getResponse().getPasswordPolicyError() );\n+        adminConnection.close();\n+    }\n+\n+\n+    /**\n+     * Test the pwdMaxAge configuration with a grace limit. We should be able to bind two\n+     * times when the password has expired. \n+     */\n+    @Test\n+    public void testPwdMaxAgeWithGraceAuthNLimit() throws Exception\n+    {\n+        policyConfig.setPwdMaxAge( 5 );\n+        policyConfig.setPwdGraceAuthNLimit( 2 );\n+\n+        LdapConnection adminConnection = getAdminNetworkConnection( getLdapServer() );\n+\n+        Dn userDn = new Dn( \"cn=userMaxAge,ou=system\" );\n+        String password = \"12345\";\n+\n+        addUser( adminConnection, \"userMaxAge\", password );\n+\n+        BindRequest bindReq = new BindRequestImpl();\n+        bindReq.setDn( userDn );\n+        bindReq.setCredentials( password.getBytes() );\n+        bindReq.addControl( PP_REQ_CTRL );\n+\n+        LdapConnection userCon = new LdapNetworkConnection( \"localhost\", ldapServer.getPort() );\n+        userCon.setTimeOut( 0 );\n+\n+        Thread.sleep( 1000 ); // sleep for one second so that the password expire warning will be sent\n+\n+        BindResponse bindResp = userCon.bind( bindReq );\n+        assertEquals( ResultCodeEnum.SUCCESS, bindResp.getLdapResult().getResultCode() );\n+\n+        PasswordPolicy respCtrl = getPwdRespCtrl( bindResp );\n+        assertNotNull( respCtrl );\n+        assertTrue( respCtrl.getResponse().getTimeBeforeExpiration() > 0 );\n+\n+        Thread.sleep( 4500 ); // sleep for four seconds and a half so that the password expires\n+\n+        // bind for one more time, should succeed\n+        bindResp = userCon.bind( bindReq );\n+        assertEquals( ResultCodeEnum.SUCCESS, bindResp.getLdapResult().getResultCode() );\n+        respCtrl = getPwdRespCtrl( bindResp );\n+        assertNotNull( respCtrl );\n+        assertEquals( 1, respCtrl.getResponse().getGraceAuthNRemaining() );\n+\n+        // bind for one last time, should succeed\n+        bindResp = userCon.bind( bindReq );\n+        assertEquals( ResultCodeEnum.SUCCESS, bindResp.getLdapResult().getResultCode() );\n+        respCtrl = getPwdRespCtrl( bindResp );\n+        assertNotNull( respCtrl );\n+        assertEquals( 0, respCtrl.getResponse().getGraceAuthNRemaining() );\n+\n+        // this time it should fail\n+        bindResp = userCon.bind( bindReq );\n+        assertEquals( ResultCodeEnum.INVALID_CREDENTIALS, bindResp.getLdapResult().getResultCode() );\n+\n+        respCtrl = getPwdRespCtrl( bindResp );\n+        assertEquals( PASSWORD_EXPIRED, respCtrl.getResponse().getPasswordPolicyError() );\n+        adminConnection.close();\n+    }\n+\n+\n+    /**\n+     * Test the pwdMaxAge configuration with a grace period. We should be able to bind for a \n+     * period of time when the password has expired. \n+     */\n+    @Test\n+    public void testPwdMaxAgeWithGraceExpire() throws Exception\n+    {\n+        policyConfig.setPwdMaxAge( 5 );\n+        policyConfig.setPwdGraceExpire( 2 );\n+\n+        LdapConnection adminConnection = getAdminNetworkConnection( getLdapServer() );\n+\n+        Dn userDn = new Dn( \"cn=userMaxAge,ou=system\" );\n+        String password = \"12345\";\n+\n+        addUser( adminConnection, \"userMaxAge\", password );\n+\n+        BindRequest bindReq = new BindRequestImpl();\n+        bindReq.setDn( userDn );\n+        bindReq.setCredentials( password.getBytes() );\n+        bindReq.addControl( PP_REQ_CTRL );\n+\n+        LdapConnection userCon = new LdapNetworkConnection( \"localhost\", ldapServer.getPort() );\n+        userCon.setTimeOut( 0 );\n+\n+        Thread.sleep( 1000 ); // sleep for one second so that the password expire warning will be sent\n+\n+        BindResponse bindResp = userCon.bind( bindReq );\n+        assertEquals( ResultCodeEnum.SUCCESS, bindResp.getLdapResult().getResultCode() );\n+\n+        PasswordPolicy respCtrl = getPwdRespCtrl( bindResp );\n+        assertNotNull( respCtrl );\n+        assertTrue( respCtrl.getResponse().getTimeBeforeExpiration() > 0 );\n+\n+        Thread.sleep( 4500 ); // sleep for four seconds and a half so that the password expires\n+\n+        // bind for one more time, should succeed\n+        bindResp = userCon.bind( bindReq );\n+        assertEquals( ResultCodeEnum.SUCCESS, bindResp.getLdapResult().getResultCode() );\n+        respCtrl = getPwdRespCtrl( bindResp );\n+        assertNotNull( respCtrl );\n+        assertEquals( 1, respCtrl.getResponse().getGraceAuthNRemaining() );\n+\n+        // Wait 1 second, we should still be able to bind\n+        // bind for one last time, should succeed\n+        bindResp = userCon.bind( bindReq );\n+        assertEquals( ResultCodeEnum.SUCCESS, bindResp.getLdapResult().getResultCode() );\n+        respCtrl = getPwdRespCtrl( bindResp );\n+        assertNotNull( respCtrl );\n+        assertEquals( 0, respCtrl.getResponse().getGraceAuthNRemaining() );\n+\n+        // this time it should fail\n+        bindResp = userCon.bind( bindReq );\n+        assertEquals( ResultCodeEnum.INVALID_CREDENTIALS, bindResp.getLdapResult().getResultCode() );\n+\n+        respCtrl = getPwdRespCtrl( bindResp );\n+        assertEquals( PASSWORD_EXPIRED, respCtrl.getResponse().getPasswordPolicyError() );\n+        adminConnection.close();\n+    }\n+\n+\n+    /**\n+     * Test the pwdMaxAge configuration. The password should expire when the pwdMaxAge is reached.\n+     * @throws Exception\n+     */\n     @Test\n     public void testPwdMaxAgeAndGraceAuth() throws Exception\n     {\n@@ -549,19 +725,8 @@ public void testPwdMaxAgeAndGraceAuth() throws Exception\n \n         Dn userDn = new Dn( \"cn=userMaxAge,ou=system\" );\n         String password = \"12345\";\n-        Entry userEntry = new DefaultEntry(\n-            userDn.toString(),\n-            \"ObjectClass: top\",\n-            \"ObjectClass: person\",\n-            \"cn: userMaxAge\",\n-            \"sn: userMaxAge_sn\",\n-            \"userPassword: \" + password );\n-\n-        AddRequest addRequest = new AddRequestImpl();\n-        addRequest.setEntry( userEntry );\n-        addRequest.addControl( PP_REQ_CTRL );\n \n-        adminConnection.add( addRequest );\n+        addUser( adminConnection, \"userMaxAge\", password );\n \n         BindRequest bindReq = new BindRequestImpl();\n         bindReq.setDn( userDn );\n@@ -587,14 +752,14 @@ public void testPwdMaxAgeAndGraceAuth() throws Exception\n         assertEquals( ResultCodeEnum.SUCCESS, bindResp.getLdapResult().getResultCode() );\n         respCtrl = getPwdRespCtrl( bindResp );\n         assertNotNull( respCtrl );\n-        assertEquals( 1, respCtrl.getResponse().getGraceAuthNsRemaining() );\n+        assertEquals( 1, respCtrl.getResponse().getGraceAuthNRemaining() );\n \n         // this extra second sleep is necessary to modify pwdGraceUseTime attribute with a different timestamp\n         Thread.sleep( 1000 );\n         bindResp = userCon.bind( bindReq );\n         assertEquals( ResultCodeEnum.SUCCESS, bindResp.getLdapResult().getResultCode() );\n         respCtrl = getPwdRespCtrl( bindResp );\n-        assertEquals( 0, respCtrl.getResponse().getGraceAuthNsRemaining() );\n+        assertEquals( 0, respCtrl.getResponse().getGraceAuthNRemaining() );\n \n         // this time it should fail\n         bindResp = userCon.bind( bindReq );\n@@ -666,22 +831,8 @@ public void testGraceAuth() throws Exception\n         LdapConnection adminConnection = getAdminNetworkConnection( getLdapServer() );\n \n         Dn userDn = new Dn( \"cn=userGrace,ou=system\" );\n-        Entry userEntry = new DefaultEntry(\n-            userDn.toString(),\n-            \"ObjectClass: top\",\n-            \"ObjectClass: person\",\n-            \"cn: userGrace\",\n-            \"sn: userGrace_sn\",\n-            \"userPassword: 12345\" );\n \n-        AddRequest addRequest = new AddRequestImpl();\n-        addRequest.setEntry( userEntry );\n-        addRequest.addControl( PP_REQ_CTRL );\n-\n-        AddResponse addResp = adminConnection.add( addRequest );\n-        assertEquals( ResultCodeEnum.SUCCESS, addResp.getLdapResult().getResultCode() );\n-        PasswordPolicy respCtrl = getPwdRespCtrl( addResp );\n-        assertNull( respCtrl );\n+        addUser( adminConnection, \"userGrace\", \"12345\" );\n \n         BindRequest bindReq = new BindRequestImpl();\n         bindReq.setDn( userDn );\n@@ -694,9 +845,9 @@ public void testGraceAuth() throws Exception\n         BindResponse bindResp = userConnection.bind( bindReq );\n         assertTrue( userConnection.isAuthenticated() );\n         PasswordPolicy ppolicy = getPwdRespCtrl( bindResp );\n-        assertEquals( 1, ppolicy.getResponse().getGraceAuthNsRemaining() );\n+        assertEquals( 1, ppolicy.getResponse().getGraceAuthNRemaining() );\n \n-        userEntry = adminConnection.lookup( userDn, \"+\" );\n+        Entry userEntry = adminConnection.lookup( userDn, \"+\" );\n         Attribute pwdGraceAuthUseTime = userEntry.get( PasswordPolicySchemaConstants.PWD_GRACE_USE_TIME_AT );\n         assertNotNull( pwdGraceAuthUseTime );\n \n@@ -732,22 +883,8 @@ public void testPwdLockoutWithDuration() throws Exception\n         LdapConnection adminConnection = getAdminNetworkConnection( getLdapServer() );\n \n         Dn userDn = new Dn( \"cn=userLockout4,ou=system\" );\n-        Entry userEntry = new DefaultEntry(\n-            userDn.toString(),\n-            \"ObjectClass: top\",\n-            \"ObjectClass: person\",\n-            \"cn: userLockout4\",\n-            \"sn: userLockout4_sn\",\n-            \"userPassword: 12345\" );\n \n-        AddRequest addRequest = new AddRequestImpl();\n-        addRequest.setEntry( userEntry );\n-        addRequest.addControl( PP_REQ_CTRL );\n-\n-        AddResponse addResp = adminConnection.add( addRequest );\n-        assertEquals( ResultCodeEnum.SUCCESS, addResp.getLdapResult().getResultCode() );\n-        PasswordPolicy respCtrl = getPwdRespCtrl( addResp );\n-        assertNull( respCtrl );\n+        addUser( adminConnection, \"userLockout4\", \"12345\" );\n \n         BindRequest bindReq = new BindRequestImpl();\n         bindReq.setDn( userDn );\n@@ -762,7 +899,7 @@ public void testPwdLockoutWithDuration() throws Exception\n             assertFalse( userConnection.isAuthenticated() );\n         }\n \n-        userEntry = adminConnection.lookup( userDn, \"+\" );\n+        Entry userEntry = adminConnection.lookup( userDn, \"+\" );\n         Attribute pwdAccountLockedTime = userEntry.get( PasswordPolicySchemaConstants.PWD_ACCOUNT_LOCKED_TIME_AT );\n         assertNotNull( pwdAccountLockedTime );\n \n@@ -780,44 +917,6 @@ public void testPwdLockoutWithDuration() throws Exception\n     }\n \n \n-    private void addUser( LdapConnection adminConnection, Dn userDn, String password ) throws Exception\n-    {\n-        Entry userEntry = new DefaultEntry(\n-            userDn.toString(),\n-            \"ObjectClass: top\",\n-            \"ObjectClass: person\",\n-            \"cn: userLockout\",\n-            \"sn: userLockout_sn\",\n-            \"userPassword\", password );\n-\n-        AddRequest addRequest = new AddRequestImpl();\n-        addRequest.setEntry( userEntry );\n-        addRequest.addControl( PP_REQ_CTRL );\n-\n-        AddResponse addResp = adminConnection.add( addRequest );\n-        assertEquals( ResultCodeEnum.SUCCESS, addResp.getLdapResult().getResultCode() );\n-        PasswordPolicy respCtrl = getPwdRespCtrl( addResp );\n-        assertNull( respCtrl );\n-    }\n-\n-\n-    private void checkBind( LdapConnection connection, Dn userDn, String password, int nbIterations,\n-        String expectedMessage ) throws Exception\n-    {\n-        for ( int i = 0; i < nbIterations; i++ )\n-        {\n-            try\n-            {\n-                connection.bind( userDn, password );\n-            }\n-            catch ( LdapAuthenticationException le )\n-            {\n-                assertEquals( expectedMessage, le.getMessage() );\n-            }\n-        }\n-    }\n-\n-\n     /**\n      * Check that we can't try more than N times to login with a wrong password before\n      * being locked.\n@@ -832,7 +931,7 @@ public void testPwdLockoutWithNAttempts() throws Exception\n         Dn userDn = new Dn( \"cn=userLockout,ou=system\" );\n         LdapConnection adminConnection = getAdminNetworkConnection( getLdapServer() );\n \n-        addUser( adminConnection, userDn, \"12345\" );\n+        addUser( adminConnection, \"userLockout\", \"12345\" );\n \n         LdapConnection userConnection = new LdapNetworkConnection( \"localhost\", ldapServer.getPort() );\n         userConnection.setTimeOut( 0L );\n@@ -866,7 +965,7 @@ public void testPwdLockoutWithNAttemptsAndLockoutDelay() throws Exception\n         Dn userDn = new Dn( \"cn=userLockout2,ou=system\" );\n         LdapConnection adminConnection = getAdminNetworkConnection( getLdapServer() );\n \n-        addUser( adminConnection, userDn, \"12345\" );\n+        addUser( adminConnection, \"userLockout2\", \"12345\" );\n \n         LdapConnection userConnection = new LdapNetworkConnection( \"localhost\", ldapServer.getPort() );\n         userConnection.setTimeOut( 0L );\n@@ -925,7 +1024,7 @@ public void testPwdLockoutFailureCountInterval() throws Exception\n         Dn userDn = new Dn( \"cn=userLockout3,ou=system\" );\n         LdapConnection adminConnection = getAdminNetworkConnection( getLdapServer() );\n \n-        addUser( adminConnection, userDn, \"12345\" );\n+        addUser( adminConnection, \"userLockout3\", \"12345\" );\n \n         LdapConnection userConnection = new LdapNetworkConnection( \"localhost\", ldapServer.getPort() );\n         userConnection.setTimeOut( 0L );\n@@ -1002,7 +1101,7 @@ public void testPwdAttempsDelayed() throws Exception\n         Dn userDn = new Dn( \"cn=userLockout,ou=system\" );\n         LdapConnection adminConnection = getAdminNetworkConnection( getLdapServer() );\n \n-        addUser( adminConnection, userDn, \"12345\" );\n+        addUser( adminConnection, \"userLockout\", \"12345\" );\n \n         LdapConnection userConnection = new LdapNetworkConnection( \"localhost\", ldapServer.getPort() );\n \n@@ -1040,7 +1139,7 @@ public void testPwdMinMaxDelay() throws Exception\n         Dn userDn = new Dn( \"cn=userLockout4,ou=system\" );\n         LdapConnection adminConnection = getAdminNetworkConnection( getLdapServer() );\n \n-        addUser( adminConnection, userDn, \"12345\" );\n+        addUser( adminConnection, \"userLockout4\", \"12345\" );\n \n         LdapConnection userConnection = new LdapNetworkConnection( \"localhost\", ldapServer.getPort() );\n         userConnection.setTimeOut( 0L );"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/b279f058c96ee0d1567b64d181752fd9e60dbd4f",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/1c5233eff8bd6ee92636f324062a35076603750b",
        "message": "Fix NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@947080 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_10",
        "file": [
            {
                "sha": "6ab0c5f59709425c59932158c9fd243a28144dcf",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/entry/ClonedServerEntry.java",
                "status": "modified",
                "additions": 8,
                "deletions": 2,
                "changes": 10,
                "blob_url": "https://github.com/apache/directory-server/blob/b279f058c96ee0d1567b64d181752fd9e60dbd4f/core-api/src/main/java/org/apache/directory/server/core/entry/ClonedServerEntry.java",
                "raw_url": "https://github.com/apache/directory-server/raw/b279f058c96ee0d1567b64d181752fd9e60dbd4f/core-api/src/main/java/org/apache/directory/server/core/entry/ClonedServerEntry.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/entry/ClonedServerEntry.java?ref=b279f058c96ee0d1567b64d181752fd9e60dbd4f",
                "patch": "@@ -476,8 +476,14 @@ else if ( obj instanceof Entry )\n         {\n             return false;\n         }\n-\n-        return clonedEntry.equals( other );\n+        if ( clonedEntry == null)\n+        {\n+            return other == null;\n+        }\n+        else\n+        {\n+            return clonedEntry.equals( other );\n+        }\n     }\n     \n     "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/677317c30afba4ff1cc53d251052bf27023fdf9a",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/ba6ad11b44e1049521f9fb8f7dff0bef709b40e0",
        "message": "o Made the groupCache eternal, in order to avoid NPE\no Added some protection against potential NPE\nThis is to fix DIRSERVER-1627\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1138250 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_11",
        "file": [
            {
                "sha": "66f42c9814d3c2716b5a7ab29c78109bac9d8bb0",
                "filename": "core-api/src/main/resources/directory-cacheservice.xml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/677317c30afba4ff1cc53d251052bf27023fdf9a/core-api/src/main/resources/directory-cacheservice.xml",
                "raw_url": "https://github.com/apache/directory-server/raw/677317c30afba4ff1cc53d251052bf27023fdf9a/core-api/src/main/resources/directory-cacheservice.xml",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/resources/directory-cacheservice.xml?ref=677317c30afba4ff1cc53d251052bf27023fdf9a",
                "patch": "@@ -111,7 +111,7 @@\n \t\ton disk is needed to swap the data if it is too much to hold in memory -->\n \t<cache name=\"groupCache\" \n \t       maxElementsInMemory=\"10000\"\n-\t\t   eternal=\"false\" \n+\t\t   eternal=\"true\" \n \t\t   overflowToDisk=\"true\"\n \t\t   diskSpoolBufferSizeMB=\"20\"\n \t\t   timeToIdleSeconds=\"300\""
            },
            {
                "sha": "f3e4b97162e7201a26861744f9a1877f7200a6b8",
                "filename": "core/src/main/java/org/apache/directory/server/core/authz/GroupCache.java",
                "status": "modified",
                "additions": 8,
                "deletions": 1,
                "changes": 9,
                "blob_url": "https://github.com/apache/directory-server/blob/677317c30afba4ff1cc53d251052bf27023fdf9a/core/src/main/java/org/apache/directory/server/core/authz/GroupCache.java",
                "raw_url": "https://github.com/apache/directory-server/raw/677317c30afba4ff1cc53d251052bf27023fdf9a/core/src/main/java/org/apache/directory/server/core/authz/GroupCache.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/authz/GroupCache.java?ref=677317c30afba4ff1cc53d251052bf27023fdf9a",
                "patch": "@@ -521,7 +521,14 @@ public final boolean isPrincipalAnAdministrator( Dn principalDn )\n         for ( Object obj : ehCache.getKeys() )\n         {\n             String group = ( String ) obj;\n-            Set<String> members = ( Set<String> ) ehCache.get( group ).getValue();\n+            Element element = ehCache.get( group );\n+            \n+            if ( element == null )\n+            {\n+                continue;\n+            }\n+            \n+            Set<String> members = ( Set<String> ) element.getValue();\n \n             if ( members == null )\n             {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/6eb7163e08bca3dc2a6f97e79d19e2b213cbeb43",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/f4f69c9e5bb58a0060052c6e3ecb21f7c3fa703e",
        "message": "o added a null check on ReplayCache reference to avoid NPE (tests are using KdcServer as config so they are not calling the start() method but \n  stop() is called after every test method run which is resulting in a NPE)\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/apacheds-kerberos-codec-2.0@1043090 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_12",
        "file": [
            {
                "sha": "24e17716d9b0a5aec76bfd4708f4f2ab45d8a4bb",
                "filename": "protocol-kerberos/src/main/java/org/apache/directory/server/kerberos/kdc/KdcServer.java",
                "status": "modified",
                "additions": 5,
                "deletions": 2,
                "changes": 7,
                "blob_url": "https://github.com/apache/directory-server/blob/6eb7163e08bca3dc2a6f97e79d19e2b213cbeb43/protocol-kerberos/src/main/java/org/apache/directory/server/kerberos/kdc/KdcServer.java",
                "raw_url": "https://github.com/apache/directory-server/raw/6eb7163e08bca3dc2a6f97e79d19e2b213cbeb43/protocol-kerberos/src/main/java/org/apache/directory/server/kerberos/kdc/KdcServer.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-kerberos/src/main/java/org/apache/directory/server/kerberos/kdc/KdcServer.java?ref=6eb7163e08bca3dc2a6f97e79d19e2b213cbeb43",
                "patch": "@@ -536,8 +536,11 @@ public void stop()\n                 acceptor.dispose();\n             }\n         }\n-        \n-        replayCache.clear();\n+\n+        if ( replayCache != null )\n+        {\n+            replayCache.clear();\n+        }\n         \n         LOG.info( \"Kerberos service stopped.\" );\n     }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/86a04f1f07e62f7a6d137bc2ca457e3e184b96cf",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/29cf93acca9fe156f16615032d4a28ad525a29c2",
        "message": "o Fixed a NPE when no server.xml is provided\no Fixed another NPE : LDAPS was not correctly initialized when the default config is used. \no Replaced 686 by 636 everywhere it was used by mistake\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@773848 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_13",
        "file": [
            {
                "sha": "235c44812b740e44436ca2b01a7da98029aaafaf",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/ReplicaPeerConfiguration.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/86a04f1f07e62f7a6d137bc2ca457e3e184b96cf/protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/ReplicaPeerConfiguration.java",
                "raw_url": "https://github.com/apache/directory-server/raw/86a04f1f07e62f7a6d137bc2ca457e3e184b96cf/protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/ReplicaPeerConfiguration.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/ReplicaPeerConfiguration.java?ref=86a04f1f07e62f7a6d137bc2ca457e3e184b96cf",
                "patch": "@@ -54,7 +54,7 @@\n     private static final int DEFAULT_PORT = 10389;\n     \n     /** The default port */\n-    private static final int DEFAULT_SSL_PORT = 10686;\n+    private static final int DEFAULT_SSL_PORT = 10636;\n     \n     /** The producer we want to replicate */\n     private LdapURL producer;"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/36e1114da1e98f72f95d5ea986888f974e95b9a1",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/6b4b34aa85b1c92afc5cb47f365ad0fd25461070",
        "message": "DIRSERVER-1002 avoid NPE when shutting down server without credentials.  This does not provide proper security for shutting down the server, but does avoid a useless NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@567242 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_14",
        "file": [
            {
                "sha": "03883b887826ddf1023d463110a432652789db5a",
                "filename": "core/src/main/java/org/apache/directory/server/core/jndi/AbstractContextFactory.java",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/apache/directory-server/blob/36e1114da1e98f72f95d5ea986888f974e95b9a1/core/src/main/java/org/apache/directory/server/core/jndi/AbstractContextFactory.java",
                "raw_url": "https://github.com/apache/directory-server/raw/36e1114da1e98f72f95d5ea986888f974e95b9a1/core/src/main/java/org/apache/directory/server/core/jndi/AbstractContextFactory.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/jndi/AbstractContextFactory.java?ref=36e1114da1e98f72f95d5ea986888f974e95b9a1",
                "patch": "@@ -113,6 +113,7 @@ public final synchronized Context getInitialContext( Hashtable env ) throws Nami\n         if ( cfg instanceof ShutdownConfiguration )\n         {\n             service.shutdown();\n+            return new DeadContext();\n         }\n         else if ( cfg instanceof SyncConfiguration )\n         {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/c4b99fd35b9a6aabe3c861ce97a1cbf9ecf078bb",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/f3acb65f26e5ca06a91bd6b08a542712b353501e",
        "message": "Fixed some potential NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1496646 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_15",
        "file": [
            {
                "sha": "33462929c2d01dad616d534d90291d08455b891b",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/request/SearchRequestHandler.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/apache/directory-server/blob/c4b99fd35b9a6aabe3c861ce97a1cbf9ecf078bb/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/request/SearchRequestHandler.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c4b99fd35b9a6aabe3c861ce97a1cbf9ecf078bb/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/request/SearchRequestHandler.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/request/SearchRequestHandler.java?ref=c4b99fd35b9a6aabe3c861ce97a1cbf9ecf078bb",
                "patch": "@@ -920,6 +920,7 @@ private Response generateResponse( LdapSession session, SearchRequest req, Entry\n                 catch ( LdapURLEncodingException e )\n                 {\n                     LOG.error( I18n.err( I18n.ERR_165, url, entry ) );\n+                    ldapUrl = new LdapUrl();\n                 }\n \n                 respRef.getReferral().addLdapUrl( ldapUrl.toString() );\n@@ -1486,6 +1487,7 @@ public Referral getReferralOnAncestorForSearch( LdapSession session, SearchReque\n             catch ( LdapURLEncodingException e )\n             {\n                 LOG.error( I18n.err( I18n.ERR_165, ref, referralAncestor ) );\n+                ldapUrl = new LdapUrl();\n             }\n \n             // Normalize the Dn to check for same dn\n@@ -1565,6 +1567,7 @@ public Referral getReferralOnAncestor( LdapSession session, Dn reqTargetDn, Sear\n             catch ( LdapURLEncodingException e )\n             {\n                 LOG.error( I18n.err( I18n.ERR_165, ref, referralAncestor ) );\n+                ldapUrl = new LdapUrl();\n             }\n \n             Dn urlDn = new Dn( session.getCoreSession().getDirectoryService()"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/e2f0a3d285317026a5a115bf5f34ff36bd99a8ad",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/64d04585cd7bffc84749dc33e101486cdf92ab8d",
        "message": "Fixed some NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1419495 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_16",
        "file": [
            {
                "sha": "bc69e4fcd9cb53bd43f063036e049b559fbfb97b",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/FilteringOperationContext.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/e2f0a3d285317026a5a115bf5f34ff36bd99a8ad/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/FilteringOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/e2f0a3d285317026a5a115bf5f34ff36bd99a8ad/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/FilteringOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/FilteringOperationContext.java?ref=e2f0a3d285317026a5a115bf5f34ff36bd99a8ad",
                "patch": "@@ -388,7 +388,7 @@ public void addReturningAttributes( String... attributesIds ) throws LdapExcepti\n             }\n \n             // reset the noAttribute flag if it is already set cause that will be ignored if any other AT is requested\n-            if ( noAttributes && ( allUserAttributes || allOperationalAttributes || ( !returningAttributes.isEmpty() ) ) )\n+            if ( isNoAttributes() && ( isAllUserAttributes() || isAllOperationalAttributes() || ( !returningAttributes.isEmpty() ) ) )\n             {\n                 noAttributes = false;\n             }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/c1b467f96f09eaee80e201a799de3a435cb5063d",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/505bcc03f567f764dcbbb4d51beafa40100fe48a",
        "message": "Dixed some NPEs\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/index-work@1311663 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_17",
        "file": [
            {
                "sha": "2ab9209b9987f0bb8a840ebe325f0d46635c7bb6",
                "filename": "core-integ/src/test/java/org/apache/directory/server/core/operations/getRootDse/GetRootDsePerfIT.java",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/apache/directory-server/blob/c1b467f96f09eaee80e201a799de3a435cb5063d/core-integ/src/test/java/org/apache/directory/server/core/operations/getRootDse/GetRootDsePerfIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c1b467f96f09eaee80e201a799de3a435cb5063d/core-integ/src/test/java/org/apache/directory/server/core/operations/getRootDse/GetRootDsePerfIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-integ/src/test/java/org/apache/directory/server/core/operations/getRootDse/GetRootDsePerfIT.java?ref=c1b467f96f09eaee80e201a799de3a435cb5063d",
                "patch": "@@ -55,6 +55,7 @@ public void testPerfGetRootDse() throws Exception\n         \n         for ( int i = 0; i < nbIterations; i++ )\n         {\n+            getRootDseContext.setCurrentInterceptor( 0 );\n             if ( i % 1000 == 0 )\n             {\n                 long tt1 = System.currentTimeMillis();"
            },
            {
                "sha": "fa46259e40b1e42cbd7c4acd8eee0d859ea8baec",
                "filename": "core-integ/src/test/java/org/apache/directory/server/core/operations/hasEntry/hasEntryPerfIT.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/c1b467f96f09eaee80e201a799de3a435cb5063d/core-integ/src/test/java/org/apache/directory/server/core/operations/hasEntry/hasEntryPerfIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c1b467f96f09eaee80e201a799de3a435cb5063d/core-integ/src/test/java/org/apache/directory/server/core/operations/hasEntry/hasEntryPerfIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-integ/src/test/java/org/apache/directory/server/core/operations/hasEntry/hasEntryPerfIT.java?ref=c1b467f96f09eaee80e201a799de3a435cb5063d",
                "patch": "@@ -58,6 +58,8 @@ public void testPerfHasEntry() throws Exception\n         \n         for ( int i = 0; i < nbIterations; i++ )\n         {\n+            hasEntryContext.setCurrentInterceptor( 0 );\n+            \n             if ( i % 1000 == 0 )\n             {\n                 long tt1 = System.currentTimeMillis();"
            },
            {
                "sha": "47271faac9c7842eded86548c3bc47a2a3622d9e",
                "filename": "core-integ/src/test/java/org/apache/directory/server/core/operations/list/ListPerfIT.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/c1b467f96f09eaee80e201a799de3a435cb5063d/core-integ/src/test/java/org/apache/directory/server/core/operations/list/ListPerfIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c1b467f96f09eaee80e201a799de3a435cb5063d/core-integ/src/test/java/org/apache/directory/server/core/operations/list/ListPerfIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-integ/src/test/java/org/apache/directory/server/core/operations/list/ListPerfIT.java?ref=c1b467f96f09eaee80e201a799de3a435cb5063d",
                "patch": "@@ -73,6 +73,8 @@ public void testPerfList() throws Exception\n         \n         for ( int i = 0; i < nbIterations; i++ )\n         {\n+            listContext.setCurrentInterceptor( 0 );\n+            \n             if ( i % 1000 == 0 )\n             {\n                 long tt1 = System.currentTimeMillis();"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/802907f26e7c92ab7d3aedf7405d5629ad0bd512",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/c2762886a79e72a7b31f3970e782c3ab75cb167d",
        "message": "Fixed a NPE in the search request\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1209611 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_18",
        "file": [
            {
                "sha": "a10036a7e6c292d4d877a0db455f503479a452bd",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/schema/SchemaPartition.java",
                "status": "modified",
                "additions": 9,
                "deletions": 1,
                "changes": 10,
                "blob_url": "https://github.com/apache/directory-server/blob/802907f26e7c92ab7d3aedf7405d5629ad0bd512/core-api/src/main/java/org/apache/directory/server/core/api/schema/SchemaPartition.java",
                "raw_url": "https://github.com/apache/directory-server/raw/802907f26e7c92ab7d3aedf7405d5629ad0bd512/core-api/src/main/java/org/apache/directory/server/core/api/schema/SchemaPartition.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/schema/SchemaPartition.java?ref=802907f26e7c92ab7d3aedf7405d5629ad0bd512",
                "patch": "@@ -52,11 +52,14 @@\n import org.apache.directory.shared.ldap.model.exception.LdapException;\n import org.apache.directory.shared.ldap.model.exception.LdapInvalidDnException;\n import org.apache.directory.shared.ldap.model.exception.LdapUnwillingToPerformException;\n+import org.apache.directory.shared.ldap.model.filter.ExprNode;\n+import org.apache.directory.shared.ldap.model.filter.PresenceNode;\n import org.apache.directory.shared.ldap.model.message.SearchRequest;\n import org.apache.directory.shared.ldap.model.message.SearchRequestImpl;\n import org.apache.directory.shared.ldap.model.message.SearchScope;\n import org.apache.directory.shared.ldap.model.message.controls.Cascade;\n import org.apache.directory.shared.ldap.model.name.Dn;\n+import org.apache.directory.shared.ldap.model.schema.AttributeType;\n import org.apache.directory.shared.ldap.model.schema.SchemaManager;\n import org.apache.directory.shared.ldap.model.schema.SchemaUtils;\n import org.apache.directory.shared.util.DateUtils;\n@@ -124,6 +127,9 @@\n     /** A static Dn for the ou=schema partition */\n     private static Dn SCHEMA_DN;\n \n+    /** The ObjectClass AttributeType */\n+    private static AttributeType OBJECT_CLASS_AT;\n+\n \n     public SchemaPartition( SchemaManager schemaManager )\n     {\n@@ -139,6 +145,7 @@ public SchemaPartition( SchemaManager schemaManager )\n         id = SCHEMA_ID;\n         suffixDn = SCHEMA_DN;\n         this.schemaManager = schemaManager;\n+        OBJECT_CLASS_AT = schemaManager.getAttributeType( SchemaConstants.OBJECT_CLASS_AT_OID );\n     }\n     \n     \n@@ -293,7 +300,8 @@ public final int getChildCount( DeleteOperationContext deleteContext ) throws Ld\n             Dn dn = deleteContext.getDn();\n             SearchRequest searchRequest = new SearchRequestImpl();\n             searchRequest.setBase( dn );\n-            searchRequest.setFilter( \"ObjectClass=*)\" );\n+            ExprNode node = new PresenceNode( OBJECT_CLASS_AT );\n+            searchRequest.setFilter( node );\n             searchRequest.setTypesOnly( true );\n             searchRequest.setScope( SearchScope.ONELEVEL );\n             "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/1f40e0de2356e937c20b5e3b5dba19b6595fe3d7",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/6e17e2b9426c76ae8eb3b3287c6aab090a73d660",
        "message": "Fix NPE when starting up the ApacheDsService\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1150216 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_19",
        "file": [
            {
                "sha": "6751cda5f6990e98fd731a278c90a1a18ae6ab3e",
                "filename": "service-builder/src/main/java/org/apache/directory/server/config/ServiceBuilder.java",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/directory-server/blob/1f40e0de2356e937c20b5e3b5dba19b6595fe3d7/service-builder/src/main/java/org/apache/directory/server/config/ServiceBuilder.java",
                "raw_url": "https://github.com/apache/directory-server/raw/1f40e0de2356e937c20b5e3b5dba19b6595fe3d7/service-builder/src/main/java/org/apache/directory/server/config/ServiceBuilder.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/service-builder/src/main/java/org/apache/directory/server/config/ServiceBuilder.java?ref=1f40e0de2356e937c20b5e3b5dba19b6595fe3d7",
                "patch": "@@ -74,6 +74,7 @@\n import org.apache.directory.server.core.partition.Partition;\n import org.apache.directory.server.core.partition.impl.btree.jdbm.JdbmIndex;\n import org.apache.directory.server.core.partition.impl.btree.jdbm.JdbmPartition;\n+import org.apache.directory.server.core.schema.SchemaPartition;\n import org.apache.directory.server.integration.http.HttpServer;\n import org.apache.directory.server.integration.http.WebApp;\n import org.apache.directory.server.kerberos.kdc.KdcServer;\n@@ -1259,6 +1260,10 @@ public static DirectoryService createDirectoryService( DirectoryServiceBean dire\n         // The schemaManager\n         directoryService.setSchemaManager( schemaManager );\n \n+        // The schema partition\n+        SchemaPartition schemaPartition = new SchemaPartition( schemaManager );\n+        directoryService.setSchemaPartition( schemaPartition );\n+\n         // MUST attributes\n         // DirectoryService ID\n         directoryService.setInstanceId( directoryServiceBean.getDirectoryServiceId() );"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/bd52de60f2ad858e936ea4b57db570cf3a049daa",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/df75c52b8f369127ac1aac79691c217917e466fa",
        "message": "Fixed NPEs due to recent refactoring of the Partition hierarchy.\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1149638 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_20",
        "file": [
            {
                "sha": "1dd7287810f974793ababc33bf72d03b7b882fea",
                "filename": "service/src/main/java/org/apache/directory/server/ApacheDsService.java",
                "status": "modified",
                "additions": 31,
                "deletions": 27,
                "changes": 58,
                "blob_url": "https://github.com/apache/directory-server/blob/bd52de60f2ad858e936ea4b57db570cf3a049daa/service/src/main/java/org/apache/directory/server/ApacheDsService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/bd52de60f2ad858e936ea4b57db570cf3a049daa/service/src/main/java/org/apache/directory/server/ApacheDsService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/service/src/main/java/org/apache/directory/server/ApacheDsService.java?ref=bd52de60f2ad858e936ea4b57db570cf3a049daa",
                "patch": "@@ -45,6 +45,7 @@\n import org.apache.directory.server.core.partition.Partition;\n import org.apache.directory.server.core.partition.ldif.LdifPartition;\n import org.apache.directory.server.core.partition.ldif.SingleFileLdifPartition;\n+import org.apache.directory.server.core.schema.DefaultSchemaService;\n import org.apache.directory.server.core.schema.SchemaPartition;\n import org.apache.directory.server.i18n.I18n;\n import org.apache.directory.server.integration.http.HttpServer;\n@@ -114,7 +115,7 @@\n     private SingleFileLdifPartition configPartition;\n \n     private ConfigPartitionReader cpReader;\n-    \n+\n     // variables used during the initial startup to update the mandatory operational\n     // attributes\n     private UuidSyntaxChecker uuidChecker = new UuidSyntaxChecker();\n@@ -140,26 +141,26 @@\n     public void start( InstanceLayout instanceLayout ) throws Exception\n     {\n         File partitionsDir = instanceLayout.getPartitionsDirectory();\n-        \n+\n         if ( !partitionsDir.exists() )\n         {\n             LOG.info( \"partition directory doesn't exist, creating {}\", partitionsDir.getAbsolutePath() );\n             partitionsDir.mkdirs();\n         }\n \n         LOG.info( \"using partition dir {}\", partitionsDir.getAbsolutePath() );\n-        \n+\n         initSchemaManager( instanceLayout );\n         initSchemaLdifPartition( instanceLayout );\n         initConfigPartition( instanceLayout );\n \n         // Read the configuration\n         cpReader = new ConfigPartitionReader( configPartition );\n-        \n+\n         ConfigBean configBean = cpReader.readConfig();\n-        \n+\n         DirectoryServiceBean directoryServiceBean = configBean.getDirectoryServiceBean();\n-        \n+\n         // Initialize the DirectoryService now\n         DirectoryService directoryService = initDirectoryService( instanceLayout, directoryServiceBean );\n \n@@ -185,7 +186,7 @@ public void start( InstanceLayout instanceLayout ) throws Exception\n         startHttpServer( directoryServiceBean.getHttpServerBean(), directoryService );\n     }\n \n-    \n+\n     /**\n      * Initialize the schema Manager by loading the schema LDIF files\n      * \n@@ -211,7 +212,6 @@ private void initSchemaManager( InstanceLayout instanceLayout ) throws Exception\n         SchemaLoader loader = new LdifSchemaLoader( schemaPartitionDirectory );\n         schemaManager = new DefaultSchemaManager( loader );\n \n-\n         // We have to load the schema now, otherwise we won't be able\n         // to initialize the Partitions, as we won't be able to parse \n         // and normalize their suffix Dn\n@@ -221,10 +221,10 @@ private void initSchemaManager( InstanceLayout instanceLayout ) throws Exception\n \n         if ( errors.size() != 0 )\n         {\n-            throw new Exception( I18n.err( I18n.ERR_317, Exceptions.printErrors(errors) ) );\n+            throw new Exception( I18n.err( I18n.ERR_317, Exceptions.printErrors( errors ) ) );\n         }\n     }\n-    \n+\n \n     /**\n      * Initialize the schema partition\n@@ -259,7 +259,8 @@ private void initConfigPartition( InstanceLayout instanceLayout ) throws Excepti\n         }\n         else\n         {\n-            LdifConfigExtractor.extractSingleFileConfig( instanceLayout.getConfDirectory(), LdifConfigExtractor.LDIF_CONFIG_FILE, true );\n+            LdifConfigExtractor.extractSingleFileConfig( instanceLayout.getConfDirectory(),\n+                LdifConfigExtractor.LDIF_CONFIG_FILE, true );\n             isConfigPartitionFirstExtraction = true;\n         }\n \n@@ -271,15 +272,20 @@ private void initConfigPartition( InstanceLayout instanceLayout ) throws Excepti\n \n         configPartition.initialize();\n     }\n-    \n-    \n-    private DirectoryService initDirectoryService( InstanceLayout instanceLayout, DirectoryServiceBean directoryServiceBean ) throws Exception\n+\n+\n+    private DirectoryService initDirectoryService( InstanceLayout instanceLayout,\n+        DirectoryServiceBean directoryServiceBean ) throws Exception\n     {\n         LOG.info( \"Initializing the DirectoryService...\" );\n-        \n+\n         long startTime = System.currentTimeMillis();\n \n-        DirectoryService directoryService = ServiceBuilder.createDirectoryService( directoryServiceBean, instanceLayout, schemaManager );\n+        DirectoryService directoryService = ServiceBuilder.createDirectoryService( directoryServiceBean,\n+            instanceLayout, schemaManager );\n+\n+        directoryService.setSchemaManager( schemaManager );\n+        directoryService.setSchemaService( new DefaultSchemaService( schemaManager ) );\n \n         SchemaPartition schemaPartition = directoryService.getSchemaService().getSchemaPartition();\n         schemaPartition.setWrappedPartition( schemaLdifPartition );\n@@ -332,7 +338,7 @@ private DirectoryService initDirectoryService( InstanceLayout instanceLayout, Di\n         }\n \n         LOG.info( \"DirectoryService initialized in {} milliseconds\", ( System.currentTimeMillis() - startTime ) );\n-        \n+\n         return directoryService;\n     }\n \n@@ -346,15 +352,15 @@ private void startLdap( LdapServerBean ldapServerBean, DirectoryService director\n         long startTime = System.currentTimeMillis();\n \n         ldapServer = ServiceBuilder.createLdapServer( ldapServerBean, directoryService );\n-        \n+\n         if ( ldapServer == null )\n         {\n             LOG.info( \"Cannot find any reference to the LDAP Server in the configuration : the server won't be started\" );\n             return;\n         }\n \n         printBanner( BANNER_LDAP );\n-        \n+\n         ldapServer.setDirectoryService( directoryService );\n \n         // And start the server now\n@@ -379,8 +385,8 @@ private void startNtp( NtpServerBean ntpServerBean, DirectoryService directorySe\n         LOG.info( \"Starting the NTP server\" );\n         long startTime = System.currentTimeMillis();\n \n-        ntpServer = ServiceBuilder.createNtpServer( ntpServerBean, directoryService);\n-        \n+        ntpServer = ServiceBuilder.createNtpServer( ntpServerBean, directoryService );\n+\n         if ( ntpServer == null )\n         {\n             LOG.info( \"Cannot find any reference to the NTP Server in the configuration : the server won't be started\" );\n@@ -442,7 +448,7 @@ private void startKerberos( KdcServerBean kdcServerBean, DirectoryService direct\n         long startTime = System.currentTimeMillis();\n \n         kdcServer = ServiceBuilder.createKdcServer( kdcServerBean, directoryService );\n-        \n+\n         if ( kdcServer == null )\n         {\n             LOG.info( \"Cannot find any reference to the Kerberos Server in the configuration : the server won't be started\" );\n@@ -496,14 +502,13 @@ private void startChangePwd( ChangePasswordServerBean changePwdServerBean, Direc\n     }\n     */\n \n-\n     /**\n      * start the embedded HTTP server\n      */\n     private void startHttpServer( HttpServerBean httpServerBean, DirectoryService directoryService ) throws Exception\n     {\n-        httpServer = ServiceBuilder.createHttpServer( httpServerBean, directoryService);\n-        \n+        httpServer = ServiceBuilder.createHttpServer( httpServerBean, directoryService );\n+\n         if ( httpServer == null )\n         {\n             LOG.info( \"Cannot find any reference to the HTTP Server in the configuration : the server won't be started\" );\n@@ -567,7 +572,6 @@ public void stop() throws Exception\n         ldapServer.getDirectoryService().shutdown();\n     }\n \n-\n     private static final String BANNER_LDAP = \"           _                     _          ____  ____   \\n\"\n         + \"          / \\\\   _ __    ___  ___| |__   ___|  _ \\\\/ ___|  \\n\"\n         + \"         / _ \\\\ | '_ \\\\ / _` |/ __| '_ \\\\ / _ \\\\ | | \\\\___ \\\\  \\n\"\n@@ -684,7 +688,7 @@ public void updateMandatoryOpAttributes( Partition partition, DirectoryService d\n             Attribute creatorAt = entry.get( atType );\n             String creator = ( creatorAt == null ? \"\" : creatorAt.getString().trim() );\n \n-            if ( ( creator.length() == 0 ) || ( !Dn.isValid(creator) ) )\n+            if ( ( creator.length() == 0 ) || ( !Dn.isValid( creator ) ) )\n             {\n                 creatorAt = new DefaultAttribute( atType, adminDn );\n             }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/942ce79e8cdd82c28041b396c6d540bf56c8b378",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/8f6a80e0b31f8b78c094630445eee75c4116ecf1",
        "message": "o fixed an NPE\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1136119 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_21",
        "file": [
            {
                "sha": "558d721c7e12c139454afbde15fd3860b3a81fc3",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/SyncReplSearchListener.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/942ce79e8cdd82c28041b396c6d540bf56c8b378/protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/SyncReplSearchListener.java",
                "raw_url": "https://github.com/apache/directory-server/raw/942ce79e8cdd82c28041b396c6d540bf56c8b378/protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/SyncReplSearchListener.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/SyncReplSearchListener.java?ref=942ce79e8cdd82c28041b396c6d540bf56c8b378",
                "patch": "@@ -293,7 +293,7 @@ public void entryMoved( MoveOperationContext moveContext )\n             }\n             else\n             {\n-                clientMsgLog.log( new ReplicaEventMessage( modDnControl, moveContext.getEntry() ) );\n+                clientMsgLog.log( new ReplicaEventMessage( modDnControl, entry ) );\n             }\n         }\n         catch ( Exception e )"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/8f6a80e0b31f8b78c094630445eee75c4116ecf1",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/8b2f40a6974dd0be0756977ac325bc09ac5f81d3",
        "message": "o fixed an NPE and removed some unwanted code\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1136118 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_22",
        "file": [
            {
                "sha": "075cc9e02947f206fdf57461711ed6e0207d16e0",
                "filename": "core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "status": "modified",
                "additions": 10,
                "deletions": 12,
                "changes": 22,
                "blob_url": "https://github.com/apache/directory-server/blob/8f6a80e0b31f8b78c094630445eee75c4116ecf1/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/8f6a80e0b31f8b78c094630445eee75c4116ecf1/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java?ref=8f6a80e0b31f8b78c094630445eee75c4116ecf1",
                "patch": "@@ -644,7 +644,11 @@ public void addPartition( Partition partition ) throws Exception\n \n         try\n         {\n-            partitionNexus.addContextPartition( partition );\n+            // can be null when called before starting up\n+            if ( partitionNexus != null )\n+            {\n+                partitionNexus.addContextPartition( partition );\n+            }\n         }\n         catch ( LdapException le )\n         {\n@@ -654,11 +658,6 @@ public void addPartition( Partition partition ) throws Exception\n         \n         // Now, add the partition to the set of managed partitions\n         partitions.add( partition );\n-\n-        if ( ! started )\n-        {\n-            return;\n-        }\n     }\n \n \n@@ -667,7 +666,11 @@ public void removePartition( Partition partition ) throws Exception\n         // Do the backend cleanup first\n         try\n         {\n-            partitionNexus.removeContextPartition( partition.getSuffix() );\n+            // can be null when called before starting up\n+            if ( partitionNexus != null )\n+            {\n+                partitionNexus.removeContextPartition( partition.getSuffix() );\n+            }\n         }\n         catch ( LdapException le )\n         {\n@@ -677,11 +680,6 @@ public void removePartition( Partition partition ) throws Exception\n         \n         // And update the set of managed partitions\n         partitions.remove( partition );\n-\n-        if ( ! started )\n-        {\n-            return;\n-        }\n     }\n \n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/08acbaf5aa38299d7a49f6a7afceac6d6a5fd3c8",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/053ad38ddf99ada85f9ec8e887ecda5b5f05d4b4",
        "message": "o updated a log message\no fixed an NPE\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1133073 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_23",
        "file": [
            {
                "sha": "7c219fafc4a59e7e57d6b41c04805c25992abb30",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/SyncReplConsumer.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/apache/directory-server/blob/08acbaf5aa38299d7a49f6a7afceac6d6a5fd3c8/protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/SyncReplConsumer.java",
                "raw_url": "https://github.com/apache/directory-server/raw/08acbaf5aa38299d7a49f6a7afceac6d6a5fd3c8/protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/SyncReplConsumer.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/SyncReplConsumer.java?ref=08acbaf5aa38299d7a49f6a7afceac6d6a5fd3c8",
                "patch": "@@ -218,7 +218,8 @@ public boolean connect()\n             }\n             catch ( LdapException le )\n             {\n-                LOG.warn( \"Failed to bind to the server with the given bind Dn {} and credentials: {}\", config.getReplUserDn(), le.getCause() );\n+                LOG.warn( \"Failed to bind to the server with the given bind Dn {}\", config.getReplUserDn() );\n+                LOG.warn( \"\", le );\n             }\n         }\n         catch ( Exception e )\n@@ -266,7 +267,7 @@ public ResultCodeEnum handleSearchDone( SearchResultDone searchDone )\n \n         SyncDoneValue ctrl = (SyncDoneValue)searchDone.getControls().get( SyncDoneValue.OID );\n \n-        if ( ctrl.getCookie() != null )\n+        if ( ( ctrl != null ) && ( ctrl.getCookie() != null ) )\n         {\n             syncCookie = ctrl.getCookie();\n             LOG.debug( \"assigning cookie from sync done value control: \" + Strings.utf8ToString(syncCookie) );"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/5927257808b2efd70416b40a99886418dfed5a2a",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/6b30ff6e365d8e9750f7271da3755aaae6af0aec",
        "message": "o fixed an NPE (getEntry() is returning null in moveContext)\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1128727 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_24",
        "file": [
            {
                "sha": "df96228701c1f725e62413539c19610287810c12",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/SyncReplSearchListener.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/directory-server/blob/5927257808b2efd70416b40a99886418dfed5a2a/protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/SyncReplSearchListener.java",
                "raw_url": "https://github.com/apache/directory-server/raw/5927257808b2efd70416b40a99886418dfed5a2a/protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/SyncReplSearchListener.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/SyncReplSearchListener.java?ref=5927257808b2efd70416b40a99886418dfed5a2a",
                "patch": "@@ -254,15 +254,15 @@ public void entryModified( ModifyOperationContext modifyContext )\n \n     public void entryMoved( MoveOperationContext moveContext )\n     {\n-        Entry entry = moveContext.getEntry();\n+        Entry entry = moveContext.getOriginalEntry();\n \n         LOG.debug( \"sending moved entry {}\", entry.getDn() );\n \n         try\n         {\n             if ( !moveContext.getNewSuperior().isDescendantOf( clientMsgLog.getSearchCriteria().getBase() ) )\n             {\n-                sendDeletedEntry( moveContext.getEntry() );\n+                sendDeletedEntry( entry );\n                 return;\n             }\n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/260230a83f25c5b02b34f4a51b52cb4b629931a4",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/be3bf0a045a8d0e66d81205d4cd1bc527d1b8013",
        "message": "Fixed a NPE : the replConsumer list was not initialized\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1088636 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_25",
        "file": [
            {
                "sha": "7bea35f96b632d290fe26a1ed16679013b797628",
                "filename": "server-config/src/main/java/org/apache/directory/server/config/beans/LdapServerBean.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/260230a83f25c5b02b34f4a51b52cb4b629931a4/server-config/src/main/java/org/apache/directory/server/config/beans/LdapServerBean.java",
                "raw_url": "https://github.com/apache/directory-server/raw/260230a83f25c5b02b34f4a51b52cb4b629931a4/server-config/src/main/java/org/apache/directory/server/config/beans/LdapServerBean.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-config/src/main/java/org/apache/directory/server/config/beans/LdapServerBean.java?ref=260230a83f25c5b02b34f4a51b52cb4b629931a4",
                "patch": "@@ -71,7 +71,7 @@\n \n     /** The replication consumer Bean */\n     @ConfigurationElement(attributeType = \"ads-replConsumers\", container = \"replConsumers\")\n-    private List<ReplConsumerBean> replConsumers;\n+    private List<ReplConsumerBean> replConsumers = new ArrayList<ReplConsumerBean>();\n \n     /** The replication producer Bean */\n     @ConfigurationElement"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/682a77642f4ae712e882930a24d595b2fb67ea93",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/22a807311a769c0a541dc3c1574060ed9fad8a1e",
        "message": "Fixed a NPE if 'directoryServiceBeans' list is null.\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1036393 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_26",
        "file": [
            {
                "sha": "666807456c291e9e91696dbc3d26a6f259d46e40",
                "filename": "server-config/src/main/java/org/apache/directory/server/config/beans/ConfigBean.java",
                "status": "modified",
                "additions": 22,
                "deletions": 16,
                "changes": 38,
                "blob_url": "https://github.com/apache/directory-server/blob/682a77642f4ae712e882930a24d595b2fb67ea93/server-config/src/main/java/org/apache/directory/server/config/beans/ConfigBean.java",
                "raw_url": "https://github.com/apache/directory-server/raw/682a77642f4ae712e882930a24d595b2fb67ea93/server-config/src/main/java/org/apache/directory/server/config/beans/ConfigBean.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-config/src/main/java/org/apache/directory/server/config/beans/ConfigBean.java?ref=682a77642f4ae712e882930a24d595b2fb67ea93",
                "patch": "@@ -19,27 +19,30 @@\n  */\n package org.apache.directory.server.config.beans;\n \n+\n import java.util.List;\n \n+\n /**\n  * The base class containing all the configuration hierarchy. This hierarchy\n  * starts with the DirectoryService elements.\n  *\n  * @author <a href=\"mailto:dev@directory.apache.org\">Apache Directory Project</a>\n  */\n-public class ConfigBean \n+public class ConfigBean\n {\n     /** The DirectoryService beans */\n     private List<AdsBaseBean> directoryServiceBeans;\n \n+\n     /**\n      * Create a new ConfigBean instance\n      */\n     public ConfigBean()\n     {\n     }\n-    \n-    \n+\n+\n     /**\n      * Add underlying DirectoryServiceBean\n      * @param directoryServiceBeans The DirectoryServiceBeans\n@@ -71,15 +74,15 @@ public DirectoryServiceBean getDirectoryServiceBean()\n         {\n             return null;\n         }\n-        \n+\n         for ( AdsBaseBean bean : directoryServiceBeans )\n         {\n             if ( bean instanceof DirectoryServiceBean )\n             {\n-                return (DirectoryServiceBean)bean;\n+                return ( DirectoryServiceBean ) bean;\n             }\n         }\n-        \n+\n         return null;\n     }\n \n@@ -94,18 +97,18 @@ public DirectoryServiceBean getDirectoryServiceBean( String directoryServiceId )\n         {\n             return null;\n         }\n-        \n+\n         for ( AdsBaseBean bean : directoryServiceBeans )\n         {\n             if ( bean instanceof DirectoryServiceBean )\n             {\n-                if ( ((DirectoryServiceBean)bean).getDirectoryServiceId().equals( directoryServiceId ) )\n+                if ( ( ( DirectoryServiceBean ) bean ).getDirectoryServiceId().equals( directoryServiceId ) )\n                 {\n-                    return (DirectoryServiceBean)bean;\n+                    return ( DirectoryServiceBean ) bean;\n                 }\n             }\n         }\n-        \n+\n         return null;\n     }\n \n@@ -117,20 +120,23 @@ public void setDirectoryServiceBeans( List<AdsBaseBean> directoryServiceBeans )\n     {\n         this.directoryServiceBeans = directoryServiceBeans;\n     }\n-    \n-    \n+\n+\n     /**\n      * {@inheritDoc}\n      */\n     public String toString()\n     {\n         StringBuilder sb = new StringBuilder();\n-     \n-        for ( AdsBaseBean directoryService : directoryServiceBeans )\n+\n+        if ( directoryServiceBeans != null )\n         {\n-            sb.append( directoryService ).append( \"\\n\\n\" );\n+            for ( AdsBaseBean directoryService : directoryServiceBeans )\n+            {\n+                sb.append( directoryService ).append( \"\\n\\n\" );\n+            }\n         }\n-        \n+\n         return sb.toString();\n     }\n }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/a60e30af80b06762d2bb1a532bcb65bf19b7a14e",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/d0f3caf482e1db8f1ffb2b0d0f1b1cbf2e11fa9b",
        "message": "o fixed a NPE\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1035519 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_27",
        "file": [
            {
                "sha": "962544e22fd9a1e4bc5e4d7294c31ceb9b24465f",
                "filename": "server-config/src/main/java/org/apache/directory/server/config/beans/PartitionBean.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/apache/directory-server/blob/a60e30af80b06762d2bb1a532bcb65bf19b7a14e/server-config/src/main/java/org/apache/directory/server/config/beans/PartitionBean.java",
                "raw_url": "https://github.com/apache/directory-server/raw/a60e30af80b06762d2bb1a532bcb65bf19b7a14e/server-config/src/main/java/org/apache/directory/server/config/beans/PartitionBean.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-config/src/main/java/org/apache/directory/server/config/beans/PartitionBean.java?ref=a60e30af80b06762d2bb1a532bcb65bf19b7a14e",
                "patch": "@@ -19,6 +19,7 @@\n  */\n package org.apache.directory.server.config.beans;\n \n+import java.util.ArrayList;\n import java.util.List;\n \n import org.apache.directory.shared.ldap.name.DN;\n@@ -40,7 +41,7 @@\n     private boolean partitionSyncOnWrite;\n \n     /** The list of declared indexes */\n-    private List<IndexBean> indexes;\n+    private List<IndexBean> indexes = new ArrayList<IndexBean>();\n     \n     /** The partition's ContextEntry */\n     private String contextEntry;"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/471f1b02146ef9cff141703b2f7f0160d7d11555",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/168f46bf91677fd58ba78707fe2bdbad711852a6",
        "message": "Fixed a NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/apacheds-config@1028919 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_28",
        "file": [
            {
                "sha": "e514cac5c0d4262703d45d7df491c5a8f13e5478",
                "filename": "jdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmStore.java",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/apache/directory-server/blob/471f1b02146ef9cff141703b2f7f0160d7d11555/jdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmStore.java",
                "raw_url": "https://github.com/apache/directory-server/raw/471f1b02146ef9cff141703b2f7f0160d7d11555/jdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmStore.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/jdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmStore.java?ref=471f1b02146ef9cff141703b2f7f0160d7d11555",
                "patch": "@@ -302,7 +302,11 @@ public synchronized void sync() throws Exception\n         else if ( index instanceof JdbmIndex<?, ?> )\n         {\n             jdbmIndex = ( JdbmIndex<?, E> ) index;\n-            jdbmIndex.setWkDirPath( partitionDir );\n+            \n+            if ( jdbmIndex.getWkDirPath() == null )\n+            {\n+                jdbmIndex.setWkDirPath( partitionDir );\n+            }\n         }\n         else\n         {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/ae300c492f976c9e8d7b3a58de835f5aced886b6",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/22c7b3ed0e967dec59f880bce8b1718d72f338d2",
        "message": "o fixed a possible NPE\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1005460 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_29",
        "file": [
            {
                "sha": "cef9ea92620e6f1afe5be38fb05a7299c53773f8",
                "filename": "core/src/main/java/org/apache/directory/server/core/authz/GroupCache.java",
                "status": "modified",
                "additions": 8,
                "deletions": 5,
                "changes": 13,
                "blob_url": "https://github.com/apache/directory-server/blob/ae300c492f976c9e8d7b3a58de835f5aced886b6/core/src/main/java/org/apache/directory/server/core/authz/GroupCache.java",
                "raw_url": "https://github.com/apache/directory-server/raw/ae300c492f976c9e8d7b3a58de835f5aced886b6/core/src/main/java/org/apache/directory/server/core/authz/GroupCache.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/authz/GroupCache.java?ref=ae300c492f976c9e8d7b3a58de835f5aced886b6",
                "patch": "@@ -487,15 +487,18 @@ public final boolean isPrincipalAnAdministrator( DN principalDn )\n             return true;\n         }\n \n-        Set<String> members = ( Set<String> ) ehCache.get( administratorsGroupDn.getNormName() ).getValue();\n-\n-        if ( members == null )\n+        Element cacheElement = ehCache.get( administratorsGroupDn.getNormName() );\n+        \n+        if ( cacheElement == null )\n         {\n             LOG.warn( \"What do you mean there is no administrators group? This is bad news.\" );\n             return false;\n         }\n-\n-        return members.contains( principalDn.getNormName() );\n+        else\n+        {\n+            Set<String> members = ( Set<String> ) cacheElement.getValue();            \n+            return members.contains( principalDn.getNormName() );\n+        }\n     }\n \n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/f429b7807d053b909f0b92f9cfcee7b206bb5b10",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/7dd56c9421e4779ec1fd705a259bb75bd3e8a4ce",
        "message": "Fixed a potential NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@995731 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_30",
        "file": [
            {
                "sha": "b0e85609a8f35fffc0ddd5b2e22eb71b231c1e9a",
                "filename": "core/src/main/java/org/apache/directory/server/core/admin/AdministrativePointInterceptor.java",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/directory-server/blob/f429b7807d053b909f0b92f9cfcee7b206bb5b10/core/src/main/java/org/apache/directory/server/core/admin/AdministrativePointInterceptor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/f429b7807d053b909f0b92f9cfcee7b206bb5b10/core/src/main/java/org/apache/directory/server/core/admin/AdministrativePointInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/admin/AdministrativePointInterceptor.java?ref=f429b7807d053b909f0b92f9cfcee7b206bb5b10",
                "patch": "@@ -648,6 +648,11 @@ private void addAdminPointCache( List<Entry> adminPointEntries ) throws LdapExce\n \n             List<AdministrativePoint> currentAdminPoints = adminPointCache.getElement( dn );\n \n+            if ( currentAdminPoints == null )\n+            {\n+                currentAdminPoints = new ArrayList<AdministrativePoint>();\n+            }\n+\n             List<AdministrativePoint> administrativePoints = createAdministrativePoints( adminPointEntry, uuid );\n \n             for ( AdministrativePoint administrativePoint : administrativePoints )"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/88befe07f88af8d2e65c5d7bb887859b6bfe10b2",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/b9b2b64095978835c97938b4dd52e86cf92c4729",
        "message": "Added parameters checks to avoid NPE (DIRAPI-18)\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@993075 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_31",
        "file": [
            {
                "sha": "5507282cea3950e2665f13715ca57ad1b5f301cf",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/LdapCoreSessionConnection.java",
                "status": "modified",
                "additions": 163,
                "deletions": 10,
                "changes": 173,
                "blob_url": "https://github.com/apache/directory-server/blob/88befe07f88af8d2e65c5d7bb887859b6bfe10b2/core-api/src/main/java/org/apache/directory/server/core/LdapCoreSessionConnection.java",
                "raw_url": "https://github.com/apache/directory-server/raw/88befe07f88af8d2e65c5d7bb887859b6bfe10b2/core-api/src/main/java/org/apache/directory/server/core/LdapCoreSessionConnection.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/LdapCoreSessionConnection.java?ref=88befe07f88af8d2e65c5d7bb887859b6bfe10b2",
                "patch": "@@ -93,6 +93,8 @@\n  */\n public class LdapCoreSessionConnection implements LdapConnection\n {\n+    /** The logger for this class */\n+    private static final Logger LOG = LoggerFactory.getLogger( LdapCoreSessionConnection.class );\n \n     /** the CoreSession object */\n     private CoreSession session;\n@@ -103,10 +105,9 @@\n     /** the session's DirectoryService */\n     private DirectoryService directoryService;\n \n+    /** The MessageId counter */\n     private AtomicInteger messageId = new AtomicInteger( 0 );\n \n-    private static final Logger LOG = LoggerFactory.getLogger( LdapCoreSessionConnection.class );\n-\n \n     public LdapCoreSessionConnection()\n     {\n@@ -161,6 +162,20 @@ public boolean connect() throws LdapException, IOException\n      */\n     public AddResponse add( AddRequest addRequest ) throws LdapException\n     {\n+        if ( addRequest == null )\n+        {\n+            String msg = \"Cannot process a null addRequest\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n+        if ( addRequest.getEntry() == null )\n+        {\n+            String msg = \"Cannot add a null entry\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n         int newId = messageId.incrementAndGet();\n \n         addRequest.setMessageId( newId );\n@@ -190,6 +205,13 @@ public AddResponse add( AddRequest addRequest ) throws LdapException\n      */\n     public AddResponse add( Entry entry ) throws LdapException\n     {\n+        if ( entry == null )\n+        {\n+            String msg = \"Cannot add an empty entry\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n         AddRequest addRequest = new AddRequestImpl();\n         addRequest.setEntry( entry );\n \n@@ -202,6 +224,13 @@ public AddResponse add( Entry entry ) throws LdapException\n      */\n     public CompareResponse compare( CompareRequest compareRequest ) throws LdapException\n     {\n+        if ( compareRequest == null )\n+        {\n+            String msg = \"Cannot process a null compareRequest\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n         int newId = messageId.incrementAndGet();\n \n         CompareResponse resp = new CompareResponseImpl( newId );\n@@ -302,6 +331,13 @@ public CompareResponse compare( String dn, String attributeName, Value<?> value\n      */\n     public DeleteResponse delete( DeleteRequest deleteRequest ) throws LdapException\n     {\n+        if ( deleteRequest == null )\n+        {\n+            String msg = \"Cannot process a null deleteRequest\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n         int newId = messageId.incrementAndGet();\n \n         DeleteResponse resp = new DeleteResponseImpl( newId );\n@@ -349,7 +385,7 @@ public DeleteResponse delete( String dn ) throws LdapException\n     /**\n      * {@inheritDoc}\n      */\n-    public boolean doesFutureExistFor( Integer messageId )\n+    public boolean doesFutureExistFor( int messageId )\n     {\n         return false;\n     }\n@@ -480,6 +516,19 @@ public Entry lookup( String dn ) throws LdapException\n      */\n     public ModifyResponse modify( DN dn, Modification... modifications ) throws LdapException\n     {\n+        if ( dn == null )\n+        {\n+            LOG.debug( \"received a null dn for modification\" );\n+            throw new IllegalArgumentException( \"The DN to be modified cannot be null\" );\n+        }\n+\n+        if ( ( modifications == null ) || ( modifications.length == 0 ) )\n+        {\n+            String msg = \"Cannot process a ModifyRequest without any modification\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n         int newId = messageId.incrementAndGet();\n \n         ModifyResponse resp = new ModifyResponseImpl( newId );\n@@ -525,6 +574,12 @@ public ModifyResponse modify( String dn, Modification... modifications ) throws\n      */\n     public ModifyResponse modify( Entry entry, ModificationOperation modOp ) throws LdapException\n     {\n+        if ( entry == null )\n+        {\n+            LOG.debug( \"received a null entry for modification\" );\n+            throw new IllegalArgumentException( \"Entry to be modified cannot be null\" );\n+        }\n+\n         int newId = messageId.incrementAndGet();\n         ModifyResponse resp = new ModifyResponseImpl( newId );\n         resp.getLdapResult().setResultCode( ResultCodeEnum.SUCCESS );\n@@ -561,6 +616,13 @@ public ModifyResponse modify( Entry entry, ModificationOperation modOp ) throws\n      */\n     public ModifyResponse modify( ModifyRequest modRequest ) throws LdapException\n     {\n+        if ( modRequest == null )\n+        {\n+            String msg = \"Cannot process a null modifyRequest\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n         int newId = messageId.incrementAndGet();\n \n         modRequest.setMessageId( newId );\n@@ -589,6 +651,13 @@ public ModifyResponse modify( ModifyRequest modRequest ) throws LdapException\n      */\n     public ModifyDnResponse modifyDn( ModifyDnRequest modDnRequest ) throws LdapException\n     {\n+        if ( modDnRequest == null )\n+        {\n+            String msg = \"Cannot process a null modDnRequest\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n         int newId = messageId.incrementAndGet();\n \n         ModifyDnResponse resp = new ModifyDnResponseImpl( newId );\n@@ -607,16 +676,16 @@ public ModifyDnResponse modifyDn( ModifyDnRequest modDnRequest ) throws LdapExce\n         try\n         {\n             DN newRdn = null;\n-            if( modDnRequest.getNewRdn() != null )\n+            if ( modDnRequest.getNewRdn() != null )\n             {\n                 newRdn = new DN( modDnRequest.getNewRdn().getName(), schemaManager );\n             }\n-            \n+\n             DN oldRdn = new DN( modDnRequest.getName().getRdn().getName(), schemaManager );\n-            \n-            boolean rdnChanged = modDnRequest.getNewRdn() != null && \n-                ! newRdn.getNormName().equals( oldRdn.getNormName() );\n-            \n+\n+            boolean rdnChanged = modDnRequest.getNewRdn() != null\n+                && !newRdn.getNormName().equals( oldRdn.getNormName() );\n+\n             if ( rdnChanged )\n             {\n                 if ( modDnRequest.getNewSuperior() != null )\n@@ -659,6 +728,20 @@ else if ( modDnRequest.getNewSuperior() != null )\n      */\n     public ModifyDnResponse move( DN entryDn, DN newSuperiorDn ) throws LdapException\n     {\n+        if ( entryDn == null )\n+        {\n+            String msg = \"Cannot process a move of a null DN\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n+        if ( newSuperiorDn == null )\n+        {\n+            String msg = \"Cannot process a move to a null DN\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n         ModifyDnRequest iModDnReq = new ModifyDnRequestImpl();\n         iModDnReq.setName( entryDn );\n         iModDnReq.setNewSuperior( newSuperiorDn );\n@@ -672,6 +755,20 @@ public ModifyDnResponse move( DN entryDn, DN newSuperiorDn ) throws LdapExceptio\n      */\n     public ModifyDnResponse move( String entryDn, String newSuperiorDn ) throws LdapException\n     {\n+        if ( entryDn == null )\n+        {\n+            String msg = \"Cannot process a move of a null DN\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n+        if ( newSuperiorDn == null )\n+        {\n+            String msg = \"Cannot process a move to a null DN\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n         return move( new DN( entryDn ), new DN( newSuperiorDn ) );\n     }\n \n@@ -681,6 +778,20 @@ public ModifyDnResponse move( String entryDn, String newSuperiorDn ) throws Ldap\n      */\n     public ModifyDnResponse rename( DN entryDn, RDN newRdn, boolean deleteOldRdn ) throws LdapException\n     {\n+        if ( entryDn == null )\n+        {\n+            String msg = \"Cannot process a rename of a null DN\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n+        if ( newRdn == null )\n+        {\n+            String msg = \"Cannot process a rename with a null RDN\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n         ModifyDnRequest iModDnReq = new ModifyDnRequestImpl();\n         iModDnReq.setName( entryDn );\n         iModDnReq.setNewRdn( newRdn );\n@@ -713,6 +824,20 @@ public ModifyDnResponse rename( String entryDn, String newRdn, boolean deleteOld\n      */\n     public ModifyDnResponse rename( String entryDn, String newRdn ) throws LdapException\n     {\n+        if ( entryDn == null )\n+        {\n+            String msg = \"Cannot process a rename of a null DN\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n+        if ( newRdn == null )\n+        {\n+            String msg = \"Cannot process a rename with a null RDN\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n         return rename( new DN( entryDn ), new RDN( newRdn ) );\n     }\n \n@@ -800,6 +925,13 @@ public ModifyDnResponse moveAndRename( String entryDn, String newDn, boolean del\n      */\n     public Cursor<Response> search( SearchRequest searchRequest ) throws LdapException\n     {\n+        if ( searchRequest == null )\n+        {\n+            String msg = \"Cannot process a null searchRequest\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n         try\n         {\n             int newId = messageId.incrementAndGet();\n@@ -827,6 +959,12 @@ public ModifyDnResponse moveAndRename( String entryDn, String newDn, boolean del\n     public Cursor<Response> search( DN baseDn, String filter, SearchScope scope, String... attributes )\n         throws LdapException\n     {\n+        if ( baseDn == null )\n+        {\n+            LOG.debug( \"received a null dn for a search\" );\n+            throw new IllegalArgumentException( \"The base DN cannot be null\" );\n+        }\n+\n         // generate some random operation number\n         SearchRequest searchRequest = new SearchRequestImpl();\n \n@@ -853,9 +991,10 @@ public ModifyDnResponse moveAndRename( String entryDn, String newDn, boolean del\n     /**\n      * {@inheritDoc}\n      */\n-    public void unBind() throws Exception\n+    public void unBind() throws LdapException\n     {\n         messageId.set( 0 );\n+\n         if ( session != null )\n         {\n             session.unbind();\n@@ -879,6 +1018,13 @@ public ExtendedResponse extended( String oid ) throws LdapException\n      */\n     public ExtendedResponse extended( ExtendedRequest extendedRequest ) throws LdapException\n     {\n+        if ( extendedRequest == null )\n+        {\n+            String msg = \"Cannot process a null extendedRequest\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n         return extended( ( String ) null );\n \n     }\n@@ -956,6 +1102,13 @@ public BindResponse bind() throws LdapException, IOException\n      */\n     public BindResponse bind( BindRequest bindRequest ) throws LdapException, IOException\n     {\n+        if ( bindRequest == null )\n+        {\n+            String msg = \"Cannot process a null bindRequest\";\n+            LOG.debug( msg );\n+            throw new IllegalArgumentException( msg );\n+        }\n+\n         int newId = messageId.incrementAndGet();\n \n         BindOperationContext bindContext = new BindOperationContext( null );"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/22c5892250a722470f57f31d569e96a716fc6ee2",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/256005adfba6f7277a46debadf14f0c80a865ed0",
        "message": "Fixed a NPE in test\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@961861 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_32",
        "file": [
            {
                "sha": "9daf20e1ccb368196c61c6065038dedbab158e4d",
                "filename": "ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/SearchRequestReturningAttributesTest.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/apache/directory-server/blob/22c5892250a722470f57f31d569e96a716fc6ee2/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/SearchRequestReturningAttributesTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/22c5892250a722470f57f31d569e96a716fc6ee2/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/SearchRequestReturningAttributesTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/SearchRequestReturningAttributesTest.java?ref=22c5892250a722470f57f31d569e96a716fc6ee2",
                "patch": "@@ -40,6 +40,7 @@\n import org.apache.directory.shared.ldap.filter.SearchScope;\n import org.apache.directory.shared.ldap.name.DN;\n import org.junit.AfterClass;\n+import org.junit.Before;\n import org.junit.BeforeClass;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n@@ -76,8 +77,8 @@\n {\n     private static LdapConnection connection;\n \n-    @BeforeClass\n-    public static void setup() throws Exception\n+    @Before\n+    public void setup() throws Exception\n     {\n         connection = new LdapNetworkConnection( \"localhost\", ldapServer.getPort() );\n         DN bindDn = new DN( \"uid=admin,ou=system\" );"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/f95b0ac682e1f0d3b422849e68f27938554fec1b",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/a1dc204181bf0895a259dd3fe04214acd6d313d6",
        "message": "Fixed some failing tests (NPE)\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@958776 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_33",
        "file": [
            {
                "sha": "3a5797436334e53b664b3ddab678a12c7c899c25",
                "filename": "ldap-client-test/src/test/java/org/apache/directory/shared/client/api/LdapConnectionTest.java",
                "status": "modified",
                "additions": 10,
                "deletions": 5,
                "changes": 15,
                "blob_url": "https://github.com/apache/directory-server/blob/f95b0ac682e1f0d3b422849e68f27938554fec1b/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/LdapConnectionTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/f95b0ac682e1f0d3b422849e68f27938554fec1b/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/LdapConnectionTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/LdapConnectionTest.java?ref=f95b0ac682e1f0d3b422849e68f27938554fec1b",
                "patch": "@@ -47,7 +47,9 @@\n import org.apache.directory.shared.ldap.filter.EqualityNode;\n import org.apache.directory.shared.ldap.filter.SearchScope;\n import org.apache.directory.shared.ldap.schema.SchemaManager;\n+import org.junit.After;\n import org.junit.AfterClass;\n+import org.junit.Before;\n import org.junit.BeforeClass;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n@@ -72,18 +74,21 @@\n     private static LdapConnection connection;\n     \n     \n-    @BeforeClass\n-    public static void bindConnection() throws Exception\n+    @Before\n+    public void bindConnection() throws Exception\n     {\n         connection = new LdapNetworkConnection( \"localhost\", ldapServer.getPort() );\n         connection.bind( ADMIN_DN, \"secret\" );\n     }\n     \n     \n-    @AfterClass\n-    public static void unbindConnection() throws Exception\n+    @After\n+    public void unbindConnection() throws Exception\n     {\n-        connection.close();\n+        if ( connection != null )\n+        {\n+            connection.close();\n+        }\n     }\n     \n     "
            },
            {
                "sha": "e5dae221a473b887a1edeacdac9874f18885ac42",
                "filename": "ldap-client-test/src/test/java/org/apache/directory/shared/client/api/LdapSSLConnectionTest.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/apache/directory-server/blob/f95b0ac682e1f0d3b422849e68f27938554fec1b/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/LdapSSLConnectionTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/f95b0ac682e1f0d3b422849e68f27938554fec1b/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/LdapSSLConnectionTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/LdapSSLConnectionTest.java?ref=f95b0ac682e1f0d3b422849e68f27938554fec1b",
                "patch": "@@ -48,6 +48,7 @@\n import org.apache.directory.server.ldap.handlers.extended.StoredProcedureExtendedOperationHandler;\n import org.apache.directory.shared.ldap.constants.SupportedSaslMechanisms;\n import org.apache.directory.shared.ldap.name.DN;\n+import org.junit.Before;\n import org.junit.BeforeClass;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n@@ -83,8 +84,8 @@\n     private static LdapConnectionConfig config;\n     \n     \n-    @BeforeClass\n-    public static void setup()\n+    @Before\n+    public void setup()\n     {\n         X509TrustManager X509 = new X509TrustManager()\n         {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/55e7ee489c44342b51dd19dc1cd8eb18bbd4fbb7",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/9cfdceef6bda72347d09d4deefd60c4ddb2336a1",
        "message": "Avoid NPE if list==null\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@951507 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_34",
        "file": [
            {
                "sha": "5c368d1be959c69209d1d7c66d53f682c62e28e4",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/filtering/CursorList.java",
                "status": "modified",
                "additions": 12,
                "deletions": 12,
                "changes": 24,
                "blob_url": "https://github.com/apache/directory-server/blob/55e7ee489c44342b51dd19dc1cd8eb18bbd4fbb7/core-api/src/main/java/org/apache/directory/server/core/filtering/CursorList.java",
                "raw_url": "https://github.com/apache/directory-server/raw/55e7ee489c44342b51dd19dc1cd8eb18bbd4fbb7/core-api/src/main/java/org/apache/directory/server/core/filtering/CursorList.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/filtering/CursorList.java?ref=55e7ee489c44342b51dd19dc1cd8eb18bbd4fbb7",
                "patch": "@@ -83,32 +83,32 @@\n      */\n     public CursorList( int start, List<EntryFilteringCursor> list, int end, SearchingOperationContext opContext )\n     {\n-        if ( ( start < 0 ) || ( start > list.size() ) )\n+        if ( list != null )\n+        {\n+            this.list = list;\n+        }\n+        else\n+        {\n+            this.list = Collections.emptyList();\n+        }\n+\n+        if ( ( start < 0 ) || ( start > this.list.size() ) )\n         {\n             throw new IllegalArgumentException( I18n.err( I18n.ERR_02005, start ) );\n         }\n \n-        if ( ( end < 0 ) || ( end > list.size() ) )\n+        if ( ( end < 0 ) || ( end > this.list.size() ) )\n         {\n             throw new IllegalArgumentException( I18n.err( I18n.ERR_02006, end ) );\n         }\n \n         // check list is not empty list since the empty list is the only situation\n         // where we allow for start to equal the end: in other cases it makes no sense\n-        if ( ( list.size() > 0 ) && ( start >= end ) )\n+        if ( ( this.list.size() > 0 ) && ( start >= end ) )\n         {\n             throw new IllegalArgumentException( I18n.err( I18n.ERR_02007, start, end ) );\n         }\n \n-        if ( list != null )\n-        {\n-            this.list = list;\n-        }\n-        else\n-        {\n-            this.list = Collections.emptyList();\n-        }\n-\n         this.start = start;\n         this.end = end;\n         this.opContext = opContext;"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/bfce2783f401bb348ca4c601a6d304fd9f965306",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/38f5dfacc8cadedede85b29cb3cad1cd6693673b",
        "message": "Throw IllegalArgumentException instead of NPE.\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@944689 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_35",
        "file": [
            {
                "sha": "668e6a28fd467a7042aae7202dfdd7f32f10af49",
                "filename": "xdbm-base/src/main/java/org/apache/directory/server/xdbm/AbstractIndexCursor.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/bfce2783f401bb348ca4c601a6d304fd9f965306/xdbm-base/src/main/java/org/apache/directory/server/xdbm/AbstractIndexCursor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/bfce2783f401bb348ca4c601a6d304fd9f965306/xdbm-base/src/main/java/org/apache/directory/server/xdbm/AbstractIndexCursor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/xdbm-base/src/main/java/org/apache/directory/server/xdbm/AbstractIndexCursor.java?ref=bfce2783f401bb348ca4c601a6d304fd9f965306",
                "patch": "@@ -42,7 +42,7 @@ public final void setClosureMonitor( ClosureMonitor monitor )\n     {\n         if ( monitor == null )\n         {\n-            throw new NullPointerException( \"monitor\" );\n+            throw new IllegalArgumentException( \"monitor\" );\n         }\n \n         this.monitor = monitor;"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/bf3befb4fe1952216d6243baa618c3d3e979933f",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/76cdc6d22b401a67279217293a199a646138d00e",
        "message": "Fixed a potential NPE by inverting a test\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/apacheds-schema@885290 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_36",
        "file": [
            {
                "sha": "cd46a65d24e0dd3861bea3df2cb8afc6a005f8b2",
                "filename": "core-entry/src/main/java/org/apache/directory/server/core/entry/ServerBinaryValue.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/bf3befb4fe1952216d6243baa618c3d3e979933f/core-entry/src/main/java/org/apache/directory/server/core/entry/ServerBinaryValue.java",
                "raw_url": "https://github.com/apache/directory-server/raw/bf3befb4fe1952216d6243baa618c3d3e979933f/core-entry/src/main/java/org/apache/directory/server/core/entry/ServerBinaryValue.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-entry/src/main/java/org/apache/directory/server/core/entry/ServerBinaryValue.java?ref=bf3befb4fe1952216d6243baa618c3d3e979933f",
                "patch": "@@ -370,7 +370,7 @@ public int compareTo( Value<byte[]> value )\n             {\r\n                 Comparator<? super byte[]> comparator = getLdapComparator();\r\n                 \r\n-                if ( comparator == null )\r\n+                if ( comparator != null )\r\n                 {\r\n                     return comparator.compare( getNormalizedValueReference(), binaryValue.getNormalizedValueReference() );\r\n                 }\r"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/bf18302c6de0549b3dc78c912229b1366a766ec5",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/643f4a330d006d9d499d4d2a2fa42a7f6ad274b1",
        "message": "fixed an NPE occuring while deleting an entry\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@806948 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_37",
        "file": [
            {
                "sha": "3e4b4ca4744926742556bb16601107517ad717cb",
                "filename": "syncrepl/src/main/java/org/apache/directory/server/syncrepl/SyncReplConsumer.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/bf18302c6de0549b3dc78c912229b1366a766ec5/syncrepl/src/main/java/org/apache/directory/server/syncrepl/SyncReplConsumer.java",
                "raw_url": "https://github.com/apache/directory-server/raw/bf18302c6de0549b3dc78c912229b1366a766ec5/syncrepl/src/main/java/org/apache/directory/server/syncrepl/SyncReplConsumer.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/syncrepl/src/main/java/org/apache/directory/server/syncrepl/SyncReplConsumer.java?ref=bf18302c6de0549b3dc78c912229b1366a766ec5",
                "patch": "@@ -360,7 +360,7 @@ public void handleSearchResult( SearchResultEntry syncResult )\n             LOG.debug( \"state name {}\", state.name() );\n \n             EntryAttribute entryUUID = remoteEntry.get( \"entryUUID\" );\n-            LOG.debug( \"entryUUID = {}\", entryUUID.getString() );\n+            LOG.debug( \"entryUUID = {}\", ( entryUUID == null ? null : entryUUID.getString() ) );\n \n             switch ( state )\n             {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/8cb59913352e872ce76a81afc07d860b013d571c",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/0f293ebc6304c68ee97fe4d56ce61cdd589636d5",
        "message": "Fixed a NPE in the toString() method\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@745107 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_38",
        "file": [
            {
                "sha": "947b2b4eb1067ad4c1b40eb5f8f34d88ab216540",
                "filename": "core/src/main/java/org/apache/directory/server/core/interceptor/context/ModifyOperationContext.java",
                "status": "modified",
                "additions": 6,
                "deletions": 3,
                "changes": 9,
                "blob_url": "https://github.com/apache/directory-server/blob/8cb59913352e872ce76a81afc07d860b013d571c/core/src/main/java/org/apache/directory/server/core/interceptor/context/ModifyOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/8cb59913352e872ce76a81afc07d860b013d571c/core/src/main/java/org/apache/directory/server/core/interceptor/context/ModifyOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/interceptor/context/ModifyOperationContext.java?ref=8cb59913352e872ce76a81afc07d860b013d571c",
                "patch": "@@ -25,12 +25,12 @@\n \n import javax.naming.NamingException;\n \n-import org.apache.directory.shared.ldap.entry.EntryAttribute;\n import org.apache.directory.server.core.CoreSession;\n import org.apache.directory.server.core.entry.ClonedServerEntry;\n import org.apache.directory.server.core.entry.ServerEntry;\n import org.apache.directory.server.core.entry.ServerEntryUtils;\n import org.apache.directory.server.core.entry.ServerModification;\n+import org.apache.directory.shared.ldap.entry.EntryAttribute;\n import org.apache.directory.shared.ldap.entry.Modification;\n import org.apache.directory.shared.ldap.entry.ModificationOperation;\n import org.apache.directory.shared.ldap.entry.client.ClientModification;\n@@ -164,9 +164,12 @@ public String toString()\n         \n         sb.append(\"ModifyContext for DN '\").append( getDn().getUpName() ).append( \"', modifications :\\n\" );\n         \n-        for ( Modification mod:modItems )\n+        if ( modItems != null )\n         {\n-            sb.append( mod ).append( '\\n' );\n+            for ( Modification mod:modItems )\n+            {\n+                sb.append( mod ).append( '\\n' );\n+            }\n         }\n         \n         return sb.toString();"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/dbf0c7784be144545fc7379bfa7efb3768231fbf",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/3c5433d099eec3a88f9f003992c5fe57813e1995",
        "message": "fixing potential NPE bug in NTLM provider result handling\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@655321 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_39",
        "file": [
            {
                "sha": "1787405e03ee914ae0b82663df06d6148eac02a5",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/ntlm/NtlmAuthenticationResult.java",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/directory-server/blob/dbf0c7784be144545fc7379bfa7efb3768231fbf/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/ntlm/NtlmAuthenticationResult.java",
                "raw_url": "https://github.com/apache/directory-server/raw/dbf0c7784be144545fc7379bfa7efb3768231fbf/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/ntlm/NtlmAuthenticationResult.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/ntlm/NtlmAuthenticationResult.java?ref=dbf0c7784be144545fc7379bfa7efb3768231fbf",
                "patch": "@@ -57,6 +57,10 @@ public boolean isSuccess()\n      */\n     public byte[] getResponse()\n     {\n+        if ( response == null )\n+        {\n+            return null;\n+        }\n         byte[] copy = new byte[response.length];\n         System.arraycopy( response, 0, copy, 0, response.length );\n         return copy;"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/6878b4ce816e734013a7e7d8e69ae82a14a22a50",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/c402870bcdfcccef9ee7b8d0ba94dd38bc71702a",
        "message": "Fix a lot of the NPES\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/bigbang@584311 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_40",
        "file": [
            {
                "sha": "87852d4e891b6481488286ac53ecb95b2378896f",
                "filename": "server-unit/src/main/java/org/apache/directory/server/unit/AbstractServerTest.java",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/directory-server/blob/6878b4ce816e734013a7e7d8e69ae82a14a22a50/server-unit/src/main/java/org/apache/directory/server/unit/AbstractServerTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/6878b4ce816e734013a7e7d8e69ae82a14a22a50/server-unit/src/main/java/org/apache/directory/server/unit/AbstractServerTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-unit/src/main/java/org/apache/directory/server/unit/AbstractServerTest.java?ref=6878b4ce816e734013a7e7d8e69ae82a14a22a50",
                "patch": "@@ -237,6 +237,7 @@ protected void setUp() throws Exception\n         socketAcceptor = new SocketAcceptor( null );\n         ldapServer = new LdapServer( socketAcceptor, directoryService );\n         ldapServer.setIpPort( port );\n+        configureLdapServer();\n         ldapServer.start();\n \n         setContexts( \"uid=admin,ou=system\", \"secret\" );\n@@ -246,6 +247,10 @@ protected void configureDirectoryService()\n     {\n     }\n \n+    protected void configureLdapServer()\n+    {\n+    }\n+\n     protected void setAllowAnonymousAccess( boolean anonymousAccess )\n     {\n         directoryService.setAllowAnonymousAccess( anonymousAccess );"
            },
            {
                "sha": "73919b499b35615f17174a816495ed11ac51f1cd",
                "filename": "server-unit/src/test/java/org/apache/directory/server/DIRSERVER951ITest.java",
                "status": "modified",
                "additions": 13,
                "deletions": 9,
                "changes": 22,
                "blob_url": "https://github.com/apache/directory-server/blob/6878b4ce816e734013a7e7d8e69ae82a14a22a50/server-unit/src/test/java/org/apache/directory/server/DIRSERVER951ITest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/6878b4ce816e734013a7e7d8e69ae82a14a22a50/server-unit/src/test/java/org/apache/directory/server/DIRSERVER951ITest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-unit/src/test/java/org/apache/directory/server/DIRSERVER951ITest.java?ref=6878b4ce816e734013a7e7d8e69ae82a14a22a50",
                "patch": "@@ -60,13 +60,23 @@\n      * Create context and entries for tests.\n      */\n     public void setUp() throws Exception\n+    {\n+        super.setUp();\n+        super.loadTestLdif( true );\n+        ctx = getWiredContext();\n+        assertNotNull( ctx );\n+    }\n+\n+\n+    @Override\n+    protected void configureDirectoryService()\n     {\n         JdbmPartition systemCfg = new JdbmPartition();\n         systemCfg.setId( \"system\" );\n-        \n+\n         // @TODO need to make this configurable for the system partition\n         systemCfg.setCacheSize( 500 );\n-        \n+\n         systemCfg.setSuffix( PartitionNexus.SYSTEM_PARTITION_SUFFIX );\n \n         // Add indexed attributes for system partition\n@@ -95,16 +105,10 @@ public void setUp() throws Exception\n             NamespaceTools.getRdnValue( \"ou=system\" ) );\n         systemEntry.put( \"uid\", \"testUid\" );\n         systemCfg.setContextEntry( systemEntry );\n-        \n+\n         directoryService.setSystemPartition( systemCfg );\n-        \n-        super.setUp();\n-        super.loadTestLdif( true );\n-        ctx = getWiredContext();\n-        assertNotNull( ctx );\n     }\n \n-\n     /**\n      * Closes context and destroys server.\n      */"
            },
            {
                "sha": "784a6cdd7146e0d31dd1f177c9df6e00a6b6465c",
                "filename": "server-unit/src/test/java/org/apache/directory/server/MiscTest.java",
                "status": "modified",
                "additions": 34,
                "deletions": 26,
                "changes": 60,
                "blob_url": "https://github.com/apache/directory-server/blob/6878b4ce816e734013a7e7d8e69ae82a14a22a50/server-unit/src/test/java/org/apache/directory/server/MiscTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/6878b4ce816e734013a7e7d8e69ae82a14a22a50/server-unit/src/test/java/org/apache/directory/server/MiscTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-unit/src/test/java/org/apache/directory/server/MiscTest.java?ref=6878b4ce816e734013a7e7d8e69ae82a14a22a50",
                "patch": "@@ -20,6 +20,22 @@\n package org.apache.directory.server;\n \n \n+import java.util.HashSet;\n+import java.util.Hashtable;\n+import java.util.Set;\n+\n+import javax.naming.Context;\n+import javax.naming.NamingEnumeration;\n+import javax.naming.NoPermissionException;\n+import javax.naming.OperationNotSupportedException;\n+import javax.naming.directory.Attribute;\n+import javax.naming.directory.Attributes;\n+import javax.naming.directory.DirContext;\n+import javax.naming.directory.InitialDirContext;\n+import javax.naming.directory.SearchControls;\n+import javax.naming.directory.SearchResult;\n+import javax.naming.ldap.InitialLdapContext;\n+\n import netscape.ldap.LDAPAttribute;\n import netscape.ldap.LDAPConnection;\n import netscape.ldap.LDAPException;\n@@ -35,16 +51,6 @@\n import org.apache.directory.shared.ldap.util.ArrayUtils;\n import org.apache.directory.shared.ldap.util.EmptyEnumeration;\n \n-import javax.naming.Context;\n-import javax.naming.NamingEnumeration;\n-import javax.naming.NoPermissionException;\n-import javax.naming.OperationNotSupportedException;\n-import javax.naming.directory.*;\n-import javax.naming.ldap.InitialLdapContext;\n-import java.util.HashSet;\n-import java.util.Hashtable;\n-import java.util.Set;\n-\n \n /**\n  * A set of miscellanous tests.\n@@ -70,15 +76,21 @@ public MiscTest()\n     public void setUp() throws Exception\n     {\n         if ( this.getName().equals( \"testDisableAnonymousBinds\" ) ||\n-             this.getName().equals( \"testCompareWithoutAuthentication\" ) )\n+                this.getName().equals( \"testCompareWithoutAuthentication\" ) )\n         {\n             setAllowAnonymousAccess( false );\n-        }\n-        else if ( this.getName().equals( \"testEnableAnonymousBindsOnRootDSE\" ) )\n+        } else if ( this.getName().equals( \"testEnableAnonymousBindsOnRootDSE\" ) )\n         {\n             setAllowAnonymousAccess( false );\n         }\n-        else if ( this.getName().equals( \"testUserAuthOnMixedCaseSuffix\" ) )\n+        super.setUp();\n+    }\n+\n+\n+    @Override\n+    protected void configureDirectoryService()\n+    {\n+        if ( this.getName().equals( \"testUserAuthOnMixedCaseSuffix\" ) )\n         {\n             Set<Partition> partitions = new HashSet<Partition>();\n             partitions.addAll( directoryService.getPartitions() );\n@@ -96,8 +108,7 @@ else if ( this.getName().equals( \"testUserAuthOnMixedCaseSuffix\" ) )\n             partition.setIndexedAttributes( indexedAttributes );\n             partitions.add( partition );\n             directoryService.setPartitions( partitions );\n-        }\n-        else if ( this.getName().equals( \"testAnonymousBindsEnabledBaseSearch\" ) )\n+        } else if ( this.getName().equals( \"testAnonymousBindsEnabledBaseSearch\" ) )\n         {\n             // allow anonymous access\n             setAllowAnonymousAccess( true );\n@@ -120,11 +131,8 @@ else if ( this.getName().equals( \"testAnonymousBindsEnabledBaseSearch\" ) )\n             partitions.add( partition );\n             directoryService.setPartitions( partitions );\n         }\n-\n-        super.setUp();\n     }\n \n-\n     public void testCompareWithoutAuthentication() throws LDAPException\n     {\n         LDAPConnection conn = new LDAPConnection();\n@@ -135,13 +143,13 @@ public void testCompareWithoutAuthentication() throws LDAPException\n             conn.compare( \"uid=admin,ou=system\", attr );\n             fail( \"Compare success without authentication\" );\n         }\n-        catch( LDAPException e )\n+        catch ( LDAPException e )\n         {\n             assertEquals( \"no permission exception\", 50, e.getLDAPResultCode() );\n         }\n     }\n-    \n-    \n+\n+\n     /**\n      * Test to make sure anonymous binds are disabled when going through\n      * the wire protocol.\n@@ -230,7 +238,7 @@ public void testEnableAnonymousBindsOnRootDSE() throws Exception\n \n \n     /**\n-     * Test to make sure that if anonymous binds are allowed a user may search \n+     * Test to make sure that if anonymous binds are allowed a user may search\n      * within a a partition.\n      *\n      * @throws Exception if anything goes wrong\n@@ -289,7 +297,7 @@ public void testAdminAccessBug() throws Exception\n         SearchControls controls = new SearchControls();\n         controls.setSearchScope( SearchControls.OBJECT_SCOPE );\n         controls.setReturningAttributes( new String[]\n-            { \"+\" } );\n+                {\"+\"} );\n         NamingEnumeration list = ctx.search( \"ou=blah,ou=system\", \"(objectClass=*)\", controls );\n         SearchResult result = ( SearchResult ) list.next();\n         list.close();\n@@ -440,7 +448,7 @@ public String getID()\n         user.put( \"sn\", \"Bush\" );\n         user.put( \"userPassword\", \"Aerial\" );\n         ctx.setRequestControls( new MutableControl[]\n-            { unsupported } );\n+                {unsupported} );\n \n         try\n         {\n@@ -454,6 +462,6 @@ public String getID()\n         DirContext kate = ctx.createSubcontext( \"cn=Kate Bush\", user );\n         assertNotNull( kate );\n         assertTrue( ArrayUtils.isEquals( Asn1StringUtils.getBytesUtf8( \"Aerial\" ), kate.getAttributes( \"\" ).get(\n-            \"userPassword\" ).get() ) );\n+                \"userPassword\" ).get() ) );\n     }\n }"
            },
            {
                "sha": "59431db0c8173c0fcc8f3a26f0d1528eddacc486",
                "filename": "server-unit/src/test/java/org/apache/directory/server/NegationOperatorITest.java",
                "status": "modified",
                "additions": 16,
                "deletions": 12,
                "changes": 28,
                "blob_url": "https://github.com/apache/directory-server/blob/6878b4ce816e734013a7e7d8e69ae82a14a22a50/server-unit/src/test/java/org/apache/directory/server/NegationOperatorITest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/6878b4ce816e734013a7e7d8e69ae82a14a22a50/server-unit/src/test/java/org/apache/directory/server/NegationOperatorITest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-unit/src/test/java/org/apache/directory/server/NegationOperatorITest.java?ref=6878b4ce816e734013a7e7d8e69ae82a14a22a50",
                "patch": "@@ -64,23 +64,34 @@\n      * Create context and entries for tests.\n      */\n     public void setUp() throws Exception\n+    {\n+        super.setUp();\n+        loadedEntries = super.loadTestLdif( true );\n+        ctx = getWiredContext();\n+        assertNotNull( ctx );\n+        assertEquals( 5, loadedEntries.size() );\n+    }\n+\n+\n+    @Override\n+    protected void configureDirectoryService()\n     {\n         if ( this.getName().indexOf( \"Indexed\" ) != -1 )\n         {\n             JdbmPartition system = new JdbmPartition();\n             system.setId( \"system\" );\n-            \n+\n             // @TODO need to make this configurable for the system partition\n             system.setCacheSize( 500 );\n-            \n+\n             system.setSuffix( PartitionNexus.SYSTEM_PARTITION_SUFFIX );\n-    \n+\n             // Add indexed attributes for system partition\n             Set<Index> indexedAttrs = new HashSet<Index>();\n             indexedAttrs.add( new JdbmIndex( SchemaConstants.OBJECT_CLASS_AT ) );\n             indexedAttrs.add( new JdbmIndex( SchemaConstants.OU_AT ) );\n             system.setIndexedAttributes( indexedAttrs );\n-    \n+\n             // Add context entry for system partition\n             Attributes systemEntry = new AttributesImpl();\n             Attribute objectClassAttr = new AttributeImpl( SchemaConstants.OBJECT_CLASS_AT );\n@@ -93,18 +104,11 @@ public void setUp() throws Exception\n             systemEntry.put( NamespaceTools.getRdnAttribute( PartitionNexus.SYSTEM_PARTITION_SUFFIX ),\n                 NamespaceTools.getRdnValue( PartitionNexus.SYSTEM_PARTITION_SUFFIX ) );\n             system.setContextEntry( systemEntry );\n-            \n+\n             directoryService.setSystemPartition( system );\n         }\n-        \n-        super.setUp();\n-        loadedEntries = super.loadTestLdif( true );\n-        ctx = getWiredContext();\n-        assertNotNull( ctx );\n-        assertEquals( 5, loadedEntries.size() );\n     }\n \n-\n     /**\n      * Closes context and destroys server.\n      */"
            },
            {
                "sha": "352b8d0390a7445a907e8cb802bc9e18c4b87ebf",
                "filename": "server-unit/src/test/java/org/apache/directory/server/SaslBindITest.java",
                "status": "modified",
                "additions": 22,
                "deletions": 16,
                "changes": 38,
                "blob_url": "https://github.com/apache/directory-server/blob/6878b4ce816e734013a7e7d8e69ae82a14a22a50/server-unit/src/test/java/org/apache/directory/server/SaslBindITest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/6878b4ce816e734013a7e7d8e69ae82a14a22a50/server-unit/src/test/java/org/apache/directory/server/SaslBindITest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-unit/src/test/java/org/apache/directory/server/SaslBindITest.java?ref=6878b4ce816e734013a7e7d8e69ae82a14a22a50",
                "patch": "@@ -57,6 +57,28 @@\n      * test authentication with.\n      */\n     public void setUp() throws Exception\n+    {\n+        super.setUp();\n+\n+        Hashtable<String, String> env = new Hashtable<String, String>();\n+        env.put( \"java.naming.factory.initial\", \"com.sun.jndi.ldap.LdapCtxFactory\" );\n+        env.put( \"java.naming.provider.url\", \"ldap://localhost:\" + port + \"/dc=example,dc=com\" );\n+        env.put( \"java.naming.security.principal\", \"uid=admin,ou=system\" );\n+        env.put( \"java.naming.security.credentials\", \"secret\" );\n+        env.put( \"java.naming.security.authentication\", \"simple\" );\n+        ctx = new InitialDirContext( env );\n+\n+        Attributes attrs = new AttributesImpl( true );\n+        attrs = getOrgUnitAttributes( \"users\" );\n+        DirContext users = ctx.createSubcontext( \"ou=users\", attrs );\n+\n+        attrs = getPersonAttributes( \"Nelson\", \"Horatio Nelson\", \"hnelson\", \"secret\" );\n+        users.createSubcontext( \"uid=hnelson\", attrs );\n+    }\n+\n+\n+    @Override\n+    protected void configureDirectoryService()\n     {\n         setAllowAnonymousAccess( false );\n         ldapServer.setSaslHost( \"localhost\" );\n@@ -84,24 +106,8 @@ public void setUp() throws Exception\n \n         partitions.add( partition );\n         directoryService.setPartitions( partitions );\n-        super.setUp();\n-\n-        Hashtable<String, String> env = new Hashtable<String, String>();\n-        env.put( \"java.naming.factory.initial\", \"com.sun.jndi.ldap.LdapCtxFactory\" );\n-        env.put( \"java.naming.provider.url\", \"ldap://localhost:\" + port + \"/dc=example,dc=com\" );\n-        env.put( \"java.naming.security.principal\", \"uid=admin,ou=system\" );\n-        env.put( \"java.naming.security.credentials\", \"secret\" );\n-        env.put( \"java.naming.security.authentication\", \"simple\" );\n-        ctx = new InitialDirContext( env );\n-\n-        attrs = getOrgUnitAttributes( \"users\" );\n-        DirContext users = ctx.createSubcontext( \"ou=users\", attrs );\n-\n-        attrs = getPersonAttributes( \"Nelson\", \"Horatio Nelson\", \"hnelson\", \"secret\" );\n-        users.createSubcontext( \"uid=hnelson\", attrs );\n     }\n \n-\n     /**\n      * Tear down.\n      */"
            },
            {
                "sha": "21c5f72ccb599c293a521faaad2a1862eb92333e",
                "filename": "server-unit/src/test/java/org/apache/directory/server/StoredProcedureExecutionITest.java",
                "status": "modified",
                "additions": 11,
                "deletions": 6,
                "changes": 17,
                "blob_url": "https://github.com/apache/directory-server/blob/6878b4ce816e734013a7e7d8e69ae82a14a22a50/server-unit/src/test/java/org/apache/directory/server/StoredProcedureExecutionITest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/6878b4ce816e734013a7e7d8e69ae82a14a22a50/server-unit/src/test/java/org/apache/directory/server/StoredProcedureExecutionITest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-unit/src/test/java/org/apache/directory/server/StoredProcedureExecutionITest.java?ref=6878b4ce816e734013a7e7d8e69ae82a14a22a50",
                "patch": "@@ -50,12 +50,6 @@\n     \n     public void setUp() throws Exception\n     {\n-        /////////////////////////////////////////////////////////\n-        // Enable the Stored Procedure Extended Operation Handler\n-        /////////////////////////////////////////////////////////\n-        Set<ExtendedOperationHandler> handlers = new HashSet<ExtendedOperationHandler>( ldapServer.getExtendedOperationHandlers() );\n-        handlers.add( new StoredProcedureExtendedOperationHandler() );\n-        ldapServer.setExtendedOperationHandlers( handlers );\n \n         super.setUp();\n \n@@ -74,6 +68,17 @@ public void setUp() throws Exception\n     }\n \n \n+    @Override\n+    protected void configureLdapServer()\n+    {\n+        /////////////////////////////////////////////////////////\n+        // Enable the Stored Procedure Extended Operation Handler\n+        /////////////////////////////////////////////////////////\n+        Set<ExtendedOperationHandler> handlers = new HashSet<ExtendedOperationHandler>( ldapServer.getExtendedOperationHandlers() );\n+        handlers.add( new StoredProcedureExtendedOperationHandler() );\n+        ldapServer.setExtendedOperationHandlers( handlers );\n+    }\n+\n     public void tearDown() throws Exception\n     {\n         ctx.close();"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/849af479da42d6ab42ad921f8728035c8eea21ef",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/90e4016fd65ca6cd3a27e7a4632b1a95349ddabb",
        "message": "this should fix NPE (untested)\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/bigbang@584303 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_41",
        "file": [
            {
                "sha": "0ea93fe5014b472a5d60d67ede0c6b2bcce76786",
                "filename": "server-unit/src/test/java/org/apache/directory/server/PasswordPolicyServiceITest.java",
                "status": "modified",
                "additions": 18,
                "deletions": 13,
                "changes": 31,
                "blob_url": "https://github.com/apache/directory-server/blob/849af479da42d6ab42ad921f8728035c8eea21ef/server-unit/src/test/java/org/apache/directory/server/PasswordPolicyServiceITest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/849af479da42d6ab42ad921f8728035c8eea21ef/server-unit/src/test/java/org/apache/directory/server/PasswordPolicyServiceITest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-unit/src/test/java/org/apache/directory/server/PasswordPolicyServiceITest.java?ref=849af479da42d6ab42ad921f8728035c8eea21ef",
                "patch": "@@ -59,9 +59,27 @@\n      */\n     public void setUp() throws Exception\n     {\n+        super.setUp();\n         setAllowAnonymousAccess( false );\n \n         Attributes attrs;\n+\n+\n+        Hashtable<String, String> env = new Hashtable<String, String>();\n+        env.put( \"java.naming.factory.initial\", \"com.sun.jndi.ldap.LdapCtxFactory\" );\n+        env.put( \"java.naming.provider.url\", \"ldap://localhost:\" + port + \"/dc=example,dc=com\" );\n+        env.put( \"java.naming.security.principal\", \"uid=admin,ou=system\" );\n+        env.put( \"java.naming.security.credentials\", \"secret\" );\n+        env.put( \"java.naming.security.authentication\", \"simple\" );\n+        ctx = new InitialDirContext( env );\n+\n+        attrs = getOrgUnitAttributes( \"users\" );\n+        users = ctx.createSubcontext( \"ou=users\", attrs );\n+    }\n+\n+    protected void configureDirectoryService()\n+    {\n+        Attributes attrs;\n         Set<Partition> partitions = new HashSet<Partition>();\n \n         // Add partition 'example'\n@@ -92,19 +110,6 @@ public void setUp() throws Exception\n \n         list.add( new PasswordPolicyInterceptor() );\n         directoryService.setInterceptors( list );\n-\n-        super.setUp();\n-\n-        Hashtable<String, String> env = new Hashtable<String, String>();\n-        env.put( \"java.naming.factory.initial\", \"com.sun.jndi.ldap.LdapCtxFactory\" );\n-        env.put( \"java.naming.provider.url\", \"ldap://localhost:\" + port + \"/dc=example,dc=com\" );\n-        env.put( \"java.naming.security.principal\", \"uid=admin,ou=system\" );\n-        env.put( \"java.naming.security.credentials\", \"secret\" );\n-        env.put( \"java.naming.security.authentication\", \"simple\" );\n-        ctx = new InitialDirContext( env );\n-\n-        attrs = getOrgUnitAttributes( \"users\" );\n-        users = ctx.createSubcontext( \"ou=users\", attrs );\n     }\n \n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/7df31adba307611218e0a8cab604f5b68696a4b9",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/2735bb2dc1da99aa07283fdde71d2cede24708c1",
        "message": "Fixed a potential NPE in the code (defensive code added)\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@523661 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_42",
        "file": [
            {
                "sha": "106ed48f204cfd3967a02b596b1436792ce2670c",
                "filename": "core/src/main/java/org/apache/directory/server/core/schema/SchemaService.java",
                "status": "modified",
                "additions": 10,
                "deletions": 2,
                "changes": 12,
                "blob_url": "https://github.com/apache/directory-server/blob/7df31adba307611218e0a8cab604f5b68696a4b9/core/src/main/java/org/apache/directory/server/core/schema/SchemaService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/7df31adba307611218e0a8cab604f5b68696a4b9/core/src/main/java/org/apache/directory/server/core/schema/SchemaService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/schema/SchemaService.java?ref=7df31adba307611218e0a8cab604f5b68696a4b9",
                "patch": "@@ -128,7 +128,7 @@\n      */\n     private Registries registries;\n \n-    private Set binaries;\n+    private Set<String> binaries;\n \n     /**\n      * subschemaSubentry attribute's value from Root DSE\n@@ -179,7 +179,14 @@ public void init( DirectoryServiceConfiguration factoryCfg, InterceptorConfigura\n         topFilter = new TopFilter();\n         filters.add( binaryAttributeFilter );\n         filters.add( topFilter );\n-        binaries = ( Set ) factoryCfg.getEnvironment().get( BINARY_KEY );\n+        binaries = ( Set<String> ) factoryCfg.getEnvironment().get( BINARY_KEY );\n+        \n+        if ( binaries == null )\n+        {\n+            binaries = new HashSet<String>();\n+        }\n+            \n+            \n \n         schemaBaseDN = new LdapDN( \"ou=schema\" );\n         schemaBaseDN.normalize( registries.getAttributeTypeRegistry().getNormalizerMapping() );\n@@ -1722,6 +1729,7 @@ private void filterBinaryAttributes( Attributes entry ) throws NamingException\n             }\n \n             asBinary = !type.getSyntax().isHumanReadible();\n+            asBinary = asBinary || ( ( binaries != null ) && ( binaries.contains( type ) ) );\n             asBinary = asBinary || binaries.contains( type );\n \n             if ( asBinary )"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/0e69ae062078ab56bce950f718e013efbf3ba621",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/26fbfa9655baf5c39e1d44ec743f06b78c9e7a34",
        "message": "fixed NPE causing bug\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/trunks/apacheds@495114 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_43",
        "file": [
            {
                "sha": "c727e1d8213b88a63d5db227cf324b6da791df6d",
                "filename": "schema-registries/src/main/java/org/apache/directory/server/schema/registries/DefaultAttributeTypeRegistry.java",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/apache/directory-server/blob/0e69ae062078ab56bce950f718e013efbf3ba621/schema-registries/src/main/java/org/apache/directory/server/schema/registries/DefaultAttributeTypeRegistry.java",
                "raw_url": "https://github.com/apache/directory-server/raw/0e69ae062078ab56bce950f718e013efbf3ba621/schema-registries/src/main/java/org/apache/directory/server/schema/registries/DefaultAttributeTypeRegistry.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/schema-registries/src/main/java/org/apache/directory/server/schema/registries/DefaultAttributeTypeRegistry.java?ref=0e69ae062078ab56bce950f718e013efbf3ba621",
                "patch": "@@ -129,7 +129,12 @@ public void registerDescendants( AttributeType attributeType ) throws NamingExce\n     protected void onRegisterAddToAncestorDescendants( AttributeType newType, AttributeType ancestor ) \n         throws NamingException\n     {\n-        if ( ancestor == null || ancestor.getName().equals( \"top\" ) )\n+        if ( ancestor == null )\n+        {\n+            return;\n+        }\n+        \n+        if ( ancestor.getName() != null && ancestor.getName().equals( \"top\" ) )\n         {\n             return;\n         }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/9c81bb62c73454c112f5da25f4edcc79a1332f11",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/e74a72890238fd39944b388010780072f1149d86",
        "message": "Added a safety net against potential NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/trunks/apacheds@491702 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_44",
        "file": [
            {
                "sha": "c18e06adb9a574e69e6ce969421024bd706e6d7c",
                "filename": "schema-registries/src/main/java/org/apache/directory/server/schema/DnComparator.java",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/apache/directory-server/blob/9c81bb62c73454c112f5da25f4edcc79a1332f11/schema-registries/src/main/java/org/apache/directory/server/schema/DnComparator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/9c81bb62c73454c112f5da25f4edcc79a1332f11/schema-registries/src/main/java/org/apache/directory/server/schema/DnComparator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/schema-registries/src/main/java/org/apache/directory/server/schema/DnComparator.java?ref=9c81bb62c73454c112f5da25f4edcc79a1332f11",
                "patch": "@@ -81,6 +81,7 @@ public int compare( Object obj0, Object obj1 )\n     public LdapDN getDn( Object obj ) throws NamingException\n     {\n         LdapDN dn = null;\n+        \n         if ( obj instanceof LdapDN )\n         {\n             dn = LdapDN.normalize( ( LdapDN ) obj, attrRegistry.getNormalizerMapping() );\n@@ -98,8 +99,9 @@ else if ( obj instanceof String )\n         else\n         {\n             throw new IllegalStateException( \"I do not know how to handle dn comparisons with objects of class: \" \n-                + obj.getClass() );\n+                + (obj == null ? null : obj.getClass() ) );\n         }\n+        \n         return dn;\n     }\n }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/b67940f5f19ea3d08154757d6eca71a163af6985",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/88a3b2847704ae82a381ffce8edf023250e23fe4",
        "message": "forgotten null monitor causing NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/directory/eve/trunk@54213 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_45",
        "file": [
            {
                "sha": "049c0595b89d28633e7c628797f915d7f679e339",
                "filename": "backend/core/src/java/org/apache/eve/schema/DefaultOidRegistry.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/b67940f5f19ea3d08154757d6eca71a163af6985/backend/core/src/java/org/apache/eve/schema/DefaultOidRegistry.java",
                "raw_url": "https://github.com/apache/directory-server/raw/b67940f5f19ea3d08154757d6eca71a163af6985/backend/core/src/java/org/apache/eve/schema/DefaultOidRegistry.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/backend/core/src/java/org/apache/eve/schema/DefaultOidRegistry.java?ref=b67940f5f19ea3d08154757d6eca71a163af6985",
                "patch": "@@ -40,7 +40,7 @@\n     /** Maps several names to an OID */\n     private Hashtable byName = new Hashtable();\n     /** Default OidRegistryMonitor */\n-    private OidRegistryMonitor monitor = null;\n+    private OidRegistryMonitor monitor = new OidRegistryMonitorAdapter();\n     \n     \n     /**"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/272d16c88b257bb1cd9fcea46faf652b3f3f8985",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/22837b8b2ad2f70a3ec9edcf21a07ac9d4a42b73",
        "message": "DIRSERVER-1948: NPE in AuthenticationInterceptor when password policy is in place and user does not have a pwdChangedTime\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1561208 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_46",
        "file": [
            {
                "sha": "ebd7e6900259ed386ec9ba776224529d1cabd7fb",
                "filename": "interceptors/authn/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java",
                "status": "modified",
                "additions": 16,
                "deletions": 0,
                "changes": 16,
                "blob_url": "https://github.com/apache/directory-server/blob/272d16c88b257bb1cd9fcea46faf652b3f3f8985/interceptors/authn/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/272d16c88b257bb1cd9fcea46faf652b3f3f8985/interceptors/authn/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/interceptors/authn/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java?ref=272d16c88b257bb1cd9fcea46faf652b3f3f8985",
                "patch": "@@ -142,6 +142,8 @@\n     private AttributeType AT_PWD_LAST_SUCCESS;\n \n     private AttributeType AT_PWD_GRACE_USE_TIME;\n+    \n+    private AttributeType AT_CREATE_TIMESTAMP;\n \n     /** a container to hold all the ppolicies */\n     private PpolicyConfigContainer pwdPolicyContainer;\n@@ -1325,6 +1327,16 @@ private void validatePasswordLength( String password, PasswordPolicyConfiguratio\n     }\n \n \n+    private AttributeType getCreateTimestampAttributeType() throws LdapException \n+    {\n+        if ( AT_CREATE_TIMESTAMP == null ) \n+        {\n+            AT_CREATE_TIMESTAMP = schemaManager.lookupAttributeTypeRegistry( SchemaConstants.CREATE_TIMESTAMP_AT );\n+        }\n+        return AT_CREATE_TIMESTAMP;\n+    }\n+\n+\n     private int getPwdTimeBeforeExpiry( Entry userEntry, PasswordPolicyConfiguration policyConfig )\n         throws LdapException\n     {\n@@ -1341,6 +1353,10 @@ private int getPwdTimeBeforeExpiry( Entry userEntry, PasswordPolicyConfiguration\n         }\n \n         Attribute pwdChangedTimeAt = userEntry.get( AT_PWD_CHANGED_TIME );\n+        if ( pwdChangedTimeAt == null ) \n+        {\n+            pwdChangedTimeAt = userEntry.get( getCreateTimestampAttributeType() );\n+        }\n         long changedTime = DateUtils.getDate( pwdChangedTimeAt.getString() ).getTime();\n \n         long currentTime = DateUtils.getDate( DateUtils.getGeneralizedTime() ).getTime();"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/33cf838e0c3c2d5b93d6e2dc9c6a0701cff1a11e",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/1ffef0afc8b503d31ee9de6a772dee719d21ba51",
        "message": "o fixed a NPE when an expression node contains zero count (DIRSERVER-1922)\no added a test to verify the fix\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1546397 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_47",
        "file": [
            {
                "sha": "c8a6fcb55cd80ab9121ad53c7fecb75288fd2d97",
                "filename": "core-integ/src/test/java/org/apache/directory/server/core/operations/search/SearchIT.java",
                "status": "modified",
                "additions": 24,
                "deletions": 0,
                "changes": 24,
                "blob_url": "https://github.com/apache/directory-server/blob/33cf838e0c3c2d5b93d6e2dc9c6a0701cff1a11e/core-integ/src/test/java/org/apache/directory/server/core/operations/search/SearchIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/33cf838e0c3c2d5b93d6e2dc9c6a0701cff1a11e/core-integ/src/test/java/org/apache/directory/server/core/operations/search/SearchIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-integ/src/test/java/org/apache/directory/server/core/operations/search/SearchIT.java?ref=33cf838e0c3c2d5b93d6e2dc9c6a0701cff1a11e",
                "patch": "@@ -63,6 +63,7 @@\n import org.apache.directory.server.core.annotations.ApplyLdifs;\n import org.apache.directory.server.core.annotations.CreateDS;\n import org.apache.directory.server.core.annotations.LoadSchema;\n+import org.apache.directory.server.core.api.LdapCoreSessionConnection;\n import org.apache.directory.server.core.integ.AbstractLdapTestUnit;\n import org.apache.directory.server.core.integ.FrameworkRunner;\n import org.apache.directory.server.core.integ.IntegrationUtils;\n@@ -2027,4 +2028,27 @@ public void testSearchRootDSESubtree() throws Exception\n \n         assertNotNull( rootDse );\n     }\n+    \n+    \n+    /**\n+     * Test for DIRSERVER-1922\n+     */\n+    @Test\n+    public void testNotEvaluator() throws Exception\n+    {\n+        LdapConnection con = new LdapCoreSessionConnection( service.getAdminSession() );\n+\n+        EntryCursor cursor = con.search( \"ou=groups,ou=system\", \"(!(gidNumber=00001))\", SearchScope.ONELEVEL, SchemaConstants.ALL_ATTRIBUTES_ARRAY );\n+\n+        int count = 0;\n+        while ( cursor.next() )\n+        {\n+            count++;\n+        }\n+        \n+        cursor.close();\n+        \n+        assertEquals( 5, count );\n+    }\n+    \n }"
            },
            {
                "sha": "8fb0f7f1e8d64e614000a11cd3c109cffe5b93aa",
                "filename": "xdbm-partition/src/main/java/org/apache/directory/server/xdbm/search/evaluator/EmptyEvaluator.java",
                "status": "modified",
                "additions": 2,
                "deletions": 8,
                "changes": 10,
                "blob_url": "https://github.com/apache/directory-server/blob/33cf838e0c3c2d5b93d6e2dc9c6a0701cff1a11e/xdbm-partition/src/main/java/org/apache/directory/server/xdbm/search/evaluator/EmptyEvaluator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/33cf838e0c3c2d5b93d6e2dc9c6a0701cff1a11e/xdbm-partition/src/main/java/org/apache/directory/server/xdbm/search/evaluator/EmptyEvaluator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/xdbm-partition/src/main/java/org/apache/directory/server/xdbm/search/evaluator/EmptyEvaluator.java?ref=33cf838e0c3c2d5b93d6e2dc9c6a0701cff1a11e",
                "patch": "@@ -24,7 +24,6 @@\n import org.apache.directory.api.ldap.model.exception.LdapException;\n import org.apache.directory.api.ldap.model.filter.UndefinedNode;\n import org.apache.directory.server.xdbm.IndexEntry;\n-import org.apache.directory.server.xdbm.Store;\n import org.apache.directory.server.xdbm.search.Evaluator;\n \n \n@@ -35,17 +34,12 @@\n  */\n public class EmptyEvaluator implements Evaluator<UndefinedNode>\n {\n-    /** The backend */\n-    private final Store db;\n-\n-\n     /**\n      * Create a new instance of the PassThroughEvaluator\n      * @throws Exception\n      */\n-    public EmptyEvaluator( Store db )\n+    public EmptyEvaluator()\n     {\n-        this.db = db;\n     }\n \n \n@@ -74,7 +68,7 @@ public boolean evaluate( Entry entry ) throws Exception\n      */\n     public UndefinedNode getExpression()\n     {\n-        return null;\n+        return UndefinedNode.UNDEFINED_NODE;\n     }\n \n "
            },
            {
                "sha": "0c313a2f3361ca8841ecf0585a850b2cfd674398",
                "filename": "xdbm-partition/src/main/java/org/apache/directory/server/xdbm/search/impl/DefaultSearchEngine.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/apache/directory-server/blob/33cf838e0c3c2d5b93d6e2dc9c6a0701cff1a11e/xdbm-partition/src/main/java/org/apache/directory/server/xdbm/search/impl/DefaultSearchEngine.java",
                "raw_url": "https://github.com/apache/directory-server/raw/33cf838e0c3c2d5b93d6e2dc9c6a0701cff1a11e/xdbm-partition/src/main/java/org/apache/directory/server/xdbm/search/impl/DefaultSearchEngine.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/xdbm-partition/src/main/java/org/apache/directory/server/xdbm/search/impl/DefaultSearchEngine.java?ref=33cf838e0c3c2d5b93d6e2dc9c6a0701cff1a11e",
                "patch": "@@ -47,6 +47,7 @@\n import org.apache.directory.server.xdbm.search.PartitionSearchResult;\n import org.apache.directory.server.xdbm.search.SearchEngine;\n import org.apache.directory.server.xdbm.search.evaluator.BaseLevelScopeEvaluator;\n+import org.apache.directory.server.xdbm.search.evaluator.EmptyEvaluator;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n@@ -185,7 +186,7 @@ public PartitionSearchResult computeResult( SchemaManager schemaManager, SearchO\n                 evaluator = evaluatorBuilder.build( filter );\n \n                 // Special case if the filter selects no candidate\n-                if ( evaluator == null )\n+                if ( ( evaluator == null ) || ( evaluator instanceof EmptyEvaluator ) )\n                 {\n                     ScopeNode node = new ScopeNode( aliasDerefMode, effectiveBase, effectiveBaseId, scope );\n                     evaluator = new BaseLevelScopeEvaluator<Entry>( db, node );"
            },
            {
                "sha": "0d558906084db084b0ce111b6950441eccf5b477",
                "filename": "xdbm-partition/src/main/java/org/apache/directory/server/xdbm/search/impl/EvaluatorBuilder.java",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/apache/directory-server/blob/33cf838e0c3c2d5b93d6e2dc9c6a0701cff1a11e/xdbm-partition/src/main/java/org/apache/directory/server/xdbm/search/impl/EvaluatorBuilder.java",
                "raw_url": "https://github.com/apache/directory-server/raw/33cf838e0c3c2d5b93d6e2dc9c6a0701cff1a11e/xdbm-partition/src/main/java/org/apache/directory/server/xdbm/search/impl/EvaluatorBuilder.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/xdbm-partition/src/main/java/org/apache/directory/server/xdbm/search/impl/EvaluatorBuilder.java?ref=33cf838e0c3c2d5b93d6e2dc9c6a0701cff1a11e",
                "patch": "@@ -43,6 +43,7 @@\n import org.apache.directory.server.xdbm.search.Evaluator;\n import org.apache.directory.server.xdbm.search.evaluator.AndEvaluator;\n import org.apache.directory.server.xdbm.search.evaluator.ApproximateEvaluator;\n+import org.apache.directory.server.xdbm.search.evaluator.EmptyEvaluator;\n import org.apache.directory.server.xdbm.search.evaluator.EqualityEvaluator;\n import org.apache.directory.server.xdbm.search.evaluator.GreaterEqEvaluator;\n import org.apache.directory.server.xdbm.search.evaluator.LessEqEvaluator;\n@@ -64,6 +65,7 @@\n     private final Store db;\n     private final SchemaManager schemaManager;\n \n+    private static final EmptyEvaluator emptyEvaluator = new EmptyEvaluator();\n \n     /**\n      * Creates a top level Evaluator where leaves are delegated to a leaf node\n@@ -86,7 +88,7 @@ public EvaluatorBuilder( Store db, SchemaManager schemaManager ) throws Exceptio\n \n         if ( ( count != null ) && ( ( Long ) count == 0L ) )\n         {\n-            return null;\n+            return emptyEvaluator;\n         }\n \n         switch ( node.getAssertionType() )\n@@ -154,7 +156,7 @@ public EvaluatorBuilder( Store db, SchemaManager schemaManager ) throws Exceptio\n         switch ( size )\n         {\n             case 0:\n-                return null;\n+                return emptyEvaluator;\n \n             case 1:\n                 return evaluators.get( 0 );\n@@ -175,7 +177,7 @@ public EvaluatorBuilder( Store db, SchemaManager schemaManager ) throws Exceptio\n         switch ( size )\n         {\n             case 0:\n-                return null;\n+                return emptyEvaluator;\n \n             case 1:\n                 return evaluators.get( 0 );"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/126d3b82402ff77435fa2286a56035d6700e842f",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/045b410ba4732f391185efb3924992d299aef65f",
        "message": "o Fixed a NPE in the SASL PLAIN authentication\no Fixed the SASL PLAIN authent test\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1464625 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_48",
        "file": [
            {
                "sha": "39dee9cd44a809f67d04beb296942b86e07b649e",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/plain/PlainSaslServer.java",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/apache/directory-server/blob/126d3b82402ff77435fa2286a56035d6700e842f/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/plain/PlainSaslServer.java",
                "raw_url": "https://github.com/apache/directory-server/raw/126d3b82402ff77435fa2286a56035d6700e842f/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/plain/PlainSaslServer.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/plain/PlainSaslServer.java?ref=126d3b82402ff77435fa2286a56035d6700e842f",
                "patch": "@@ -32,6 +32,7 @@\n import org.apache.directory.api.util.StringConstants;\n import org.apache.directory.api.util.Strings;\n import org.apache.directory.server.core.api.CoreSession;\n+import org.apache.directory.server.core.api.OperationEnum;\n import org.apache.directory.server.core.api.interceptor.context.BindOperationContext;\n import org.apache.directory.server.i18n.I18n;\n import org.apache.directory.server.ldap.LdapSession;\n@@ -240,13 +241,15 @@ public boolean isComplete()\n \n \n     /**\n-     * Try to authenticate the usr against the underlying LDAP server.\n+     * Try to authenticate the user against the underlying LDAP server.\n      */\n     private CoreSession authenticate( String user, String password ) throws InvalidNameException, Exception\n     {\n         BindOperationContext bindContext = new BindOperationContext( getLdapSession().getCoreSession() );\n         bindContext.setDn( new Dn( user ) );\n         bindContext.setCredentials( Strings.getBytesUtf8( password ) );\n+        bindContext.setIoSession( getLdapSession().getIoSession() );\n+        bindContext.setInterceptors( getAdminSession().getDirectoryService().getInterceptors( OperationEnum.BIND ) );\n \n         getAdminSession().getDirectoryService().getOperationManager().bind( bindContext );\n "
            },
            {
                "sha": "02f5ddca031349ee9d537eb8f2544c0a8a173dd8",
                "filename": "server-integ/src/test/java/org/apache/directory/server/operations/bind/SaslBindIT.java",
                "status": "modified",
                "additions": 28,
                "deletions": 29,
                "changes": 57,
                "blob_url": "https://github.com/apache/directory-server/blob/126d3b82402ff77435fa2286a56035d6700e842f/server-integ/src/test/java/org/apache/directory/server/operations/bind/SaslBindIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/126d3b82402ff77435fa2286a56035d6700e842f/server-integ/src/test/java/org/apache/directory/server/operations/bind/SaslBindIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-integ/src/test/java/org/apache/directory/server/operations/bind/SaslBindIT.java?ref=126d3b82402ff77435fa2286a56035d6700e842f",
                "patch": "@@ -73,7 +73,6 @@\n import org.apache.directory.server.core.integ.AbstractLdapTestUnit;\n import org.apache.directory.server.core.integ.FrameworkRunner;\n import org.apache.directory.server.core.kerberos.KeyDerivationInterceptor;\n-import org.apache.directory.shared.kerberos.KerberosAttribute;\n import org.apache.directory.server.ldap.handlers.bind.cramMD5.CramMd5MechanismHandler;\n import org.apache.directory.server.ldap.handlers.bind.digestMD5.DigestMd5MechanismHandler;\n import org.apache.directory.server.ldap.handlers.bind.gssapi.GssapiMechanismHandler;\n@@ -151,52 +150,52 @@\n     allowAnonAccess = false,\n     name = \"SaslBindIT-class\",\n     partitions =\n-    {\n-        @CreatePartition(\n-            name = \"example\",\n-            suffix = \"dc=example,dc=com\",\n-            contextEntry =\n-            @ContextEntry(\n-                entryLdif =\n+        {\n+            @CreatePartition(\n+                name = \"example\",\n+                suffix = \"dc=example,dc=com\",\n+                contextEntry =\n+                @ContextEntry(\n+                    entryLdif =\n                     \"dn: dc=example,dc=com\\n\" +\n-                    \"dc: example\\n\" +\n-                    \"objectClass: top\\n\" +\n-                    \"objectClass: domain\\n\\n\"),\n+                        \"dc: example\\n\" +\n+                        \"objectClass: top\\n\" +\n+                        \"objectClass: domain\\n\\n\"),\n                 indexes =\n-                {\n-                    @CreateIndex(attribute = \"objectClass\"),\n-                    @CreateIndex(attribute = \"dc\"),\n-                    @CreateIndex(attribute = \"ou\")\n+                    {\n+                        @CreateIndex(attribute = \"objectClass\"),\n+                        @CreateIndex(attribute = \"dc\"),\n+                        @CreateIndex(attribute = \"ou\")\n                 })\n     },\n     additionalInterceptors =\n         { KeyDerivationInterceptor.class })\n @CreateLdapServer(transports =\n     {\n         @CreateTransport(protocol = \"LDAP\")\n-    },\n+},\n     saslHost = \"localhost\",\n     saslPrincipal = \"ldap/localhost@EXAMPLE.COM\",\n     saslMechanisms =\n-    {\n-        @SaslMechanism(name = SupportedSaslMechanisms.PLAIN, implClass = PlainMechanismHandler.class),\n-        @SaslMechanism(name = SupportedSaslMechanisms.CRAM_MD5, implClass = CramMd5MechanismHandler.class),\n-        @SaslMechanism(name = SupportedSaslMechanisms.DIGEST_MD5, implClass = DigestMd5MechanismHandler.class),\n-        @SaslMechanism(name = SupportedSaslMechanisms.GSSAPI, implClass = GssapiMechanismHandler.class),\n-        @SaslMechanism(name = SupportedSaslMechanisms.NTLM, implClass = NtlmMechanismHandler.class),\n-        @SaslMechanism(name = SupportedSaslMechanisms.GSS_SPNEGO, implClass = NtlmMechanismHandler.class)\n+        {\n+            @SaslMechanism(name = SupportedSaslMechanisms.PLAIN, implClass = PlainMechanismHandler.class),\n+            @SaslMechanism(name = SupportedSaslMechanisms.CRAM_MD5, implClass = CramMd5MechanismHandler.class),\n+            @SaslMechanism(name = SupportedSaslMechanisms.DIGEST_MD5, implClass = DigestMd5MechanismHandler.class),\n+            @SaslMechanism(name = SupportedSaslMechanisms.GSSAPI, implClass = GssapiMechanismHandler.class),\n+            @SaslMechanism(name = SupportedSaslMechanisms.NTLM, implClass = NtlmMechanismHandler.class),\n+            @SaslMechanism(name = SupportedSaslMechanisms.GSS_SPNEGO, implClass = NtlmMechanismHandler.class)\n     },\n     extendedOpHandlers =\n-    {\n-        StoredProcedureExtendedOperationHandler.class\n+        {\n+            StoredProcedureExtendedOperationHandler.class\n     },\n     ntlmProvider = BogusNtlmProvider.class)\n @CreateKdcServer(\n     transports =\n         {\n             @CreateTransport(protocol = \"UDP\", port = 6088),\n             @CreateTransport(protocol = \"TCP\", port = 6088)\n-        })\n+    })\n public class SaslBindIT extends AbstractLdapTestUnit\n {\n     @Rule\n@@ -263,14 +262,14 @@ public void testSupportedSASLMechanisms() throws Exception\n      * Tests to make sure PLAIN-binds works\n      */\n     @Test\n-    @Ignore\n+    //@Ignore\n     // The SASL Plain mechanism is not supported\n     public void testSaslBindPLAIN() throws Exception\n     {\n         Dn userDn = new Dn( \"uid=hnelson,ou=users,dc=example,dc=com\" );\n         LdapConnection connection = new LdapNetworkConnection( \"localhost\", getLdapServer().getPort() );\n         BindRequest bindReq = new BindRequestImpl();\n-        bindReq.setCredentials( \"secret\" );\n+        bindReq.setCredentials( '\\0' + \"uid=hnelson,ou=users,dc=example,dc=com\" + '\\0' + \"secret\" );\n         bindReq.setDn( userDn );\n         bindReq.setSaslMechanism( SupportedSaslMechanisms.PLAIN );\n \n@@ -505,7 +504,7 @@ public void testSaslGssApiBind() throws Exception\n         LdapNetworkConnection connection = new LdapNetworkConnection( \"localhost\", getLdapServer().getPort() );\n \n         kdcServer.getConfig().setPaEncTimestampRequired( false );\n-        \n+\n         GssApiRequest request = new GssApiRequest();\n         request.setUsername( userDn.getRdn().getValue().getString() );\n         request.setCredentials( \"secret\" );"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/76545ddad23e78326a5f64a1f8aec73fdd7f30c4",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/fc5b1d691b4dc36166eaa2819728dce5a6d4e957",
        "message": "Don't add the authenticator if it's disabled, otherwise we get a NPE later.\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1446107 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_49",
        "file": [
            {
                "sha": "406b143520f8e6337b62e30100aaf0db41532a01",
                "filename": "service-builder/src/main/java/org/apache/directory/server/config/builder/ServiceBuilder.java",
                "status": "modified",
                "additions": 28,
                "deletions": 23,
                "changes": 51,
                "blob_url": "https://github.com/apache/directory-server/blob/76545ddad23e78326a5f64a1f8aec73fdd7f30c4/service-builder/src/main/java/org/apache/directory/server/config/builder/ServiceBuilder.java",
                "raw_url": "https://github.com/apache/directory-server/raw/76545ddad23e78326a5f64a1f8aec73fdd7f30c4/service-builder/src/main/java/org/apache/directory/server/config/builder/ServiceBuilder.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/service-builder/src/main/java/org/apache/directory/server/config/builder/ServiceBuilder.java?ref=76545ddad23e78326a5f64a1f8aec73fdd7f30c4",
                "patch": "@@ -540,7 +540,10 @@ else if ( transportBean instanceof UdpTransportBean )\n \n         for ( AuthenticatorBean authenticatorBean : list )\n         {\n-            authenticators[i++] = createAuthenticator( authenticatorBean );\n+            if ( authenticatorBean.isEnabled() )\n+            {\n+                authenticators[i++] = createAuthenticator( authenticatorBean );\n+            }\n         }\n \n         return authenticators;\n@@ -584,7 +587,7 @@ else if ( transportBean instanceof UdpTransportBean )\n         for ( String encryptionType : encryptionTypes )\n         {\n             EncryptionType et = EncryptionType.getByName( encryptionType );\n-            if( et == EncryptionType.UNKNOWN )\n+            if ( et == EncryptionType.UNKNOWN )\n             {\n                 LOG.warn( \"Unknown encryption type {}\", encryptionType );\n             }\n@@ -594,7 +597,7 @@ else if ( transportBean instanceof UdpTransportBean )\n             }\n         }\n \n-        return types.toArray(new EncryptionType[0]);\n+        return types.toArray( new EncryptionType[0] );\n     }\n \n \n@@ -662,61 +665,63 @@ public static DhcpServer createDhcpServer( DhcpServerBean dhcpServerBean, Direct\n      * @return Instance of KdcServer\n      * @throws org.apache.directory.api.ldap.model.exception.LdapException\n      */\n-    public static KdcServer createKdcServer( DirectoryServiceBean directoryServiceBean, DirectoryService directoryService ) throws LdapException\n+    public static KdcServer createKdcServer( DirectoryServiceBean directoryServiceBean,\n+        DirectoryService directoryService ) throws LdapException\n     {\n         KdcServerBean kdcServerBean = directoryServiceBean.getKdcServerBean();\n-        \n+\n         // Fist, do nothing if the KdcServer is disabled\n         if ( ( kdcServerBean == null ) || kdcServerBean.isDisabled() )\n         {\n             return null;\n         }\n \n         KerberosConfig kdcConfig = new KerberosConfig();\n-        \n+\n         // AllowableClockSkew\n         kdcConfig.setAllowableClockSkew( kdcServerBean.getKrbAllowableClockSkew() );\n-        \n+\n         // BodyChecksumVerified\n         kdcConfig.setBodyChecksumVerified( kdcServerBean.isKrbBodyChecksumVerified() );\n-        \n+\n         // EmptyAddressesAllowed\n         kdcConfig.setEmptyAddressesAllowed( kdcServerBean.isKrbEmptyAddressesAllowed() );\n-        \n+\n         // EncryptionType\n         EncryptionType[] encryptionTypes = createEncryptionTypes( kdcServerBean.getKrbEncryptionTypes() );\n         kdcConfig.setEncryptionTypes( encryptionTypes );\n-        \n+\n         // ForwardableAllowed\n         kdcConfig.setForwardableAllowed( kdcServerBean.isKrbForwardableAllowed() );\n-        \n+\n         // KdcPrincipal\n-        kdcConfig.setServicePrincipal( \"krbtgt/\" + kdcServerBean.getKrbPrimaryRealm() + \"@\" + kdcServerBean.getKrbPrimaryRealm() );\n-        \n+        kdcConfig.setServicePrincipal( \"krbtgt/\" + kdcServerBean.getKrbPrimaryRealm() + \"@\"\n+            + kdcServerBean.getKrbPrimaryRealm() );\n+\n         // MaximumRenewableLifetime\n         kdcConfig.setMaximumRenewableLifetime( kdcServerBean.getKrbMaximumRenewableLifetime() );\n-        \n+\n         // MaximumTicketLifetime\n         kdcConfig.setMaximumTicketLifetime( kdcServerBean.getKrbMaximumTicketLifetime() );\n-        \n+\n         // PaEncTimestampRequired\n         kdcConfig.setPaEncTimestampRequired( kdcServerBean.isKrbPaEncTimestampRequired() );\n-        \n+\n         // PostdatedAllowed\n         kdcConfig.setPostdatedAllowed( kdcServerBean.isKrbPostdatedAllowed() );\n-        \n+\n         // PrimaryRealm\n         kdcConfig.setPrimaryRealm( kdcServerBean.getKrbPrimaryRealm() );\n-        \n+\n         // ProxiableAllowed\n         kdcConfig.setProxiableAllowed( kdcServerBean.isKrbProxiableAllowed() );\n \n         // RenewableAllowed\n         kdcConfig.setRenewableAllowed( kdcServerBean.isKrbRenewableAllowed() );\n-        \n+\n         // searchBaseDn\n         kdcConfig.setSearchBaseDn( kdcServerBean.getSearchBaseDn().getName() );\n-        \n+\n         KdcServer kdcServer = new KdcServer( kdcConfig );\n \n         kdcServer.setDirectoryService( directoryService );\n@@ -730,18 +735,18 @@ public static KdcServer createKdcServer( DirectoryServiceBean directoryServiceBe\n         kdcServer.setTransports( transports );\n \n         ChangePasswordServerBean changePasswordServerBean = directoryServiceBean.getChangePasswordServerBean();\n-        \n+\n         // Fist, do nothing if the ChangePasswordServer is disabled\n         if ( ( changePasswordServerBean != null ) && !changePasswordServerBean.isDisabled() )\n         {\n             ChangePasswordServer changePasswordServer = new ChangePasswordServer( new ChangePasswordConfig( kdcConfig ) );\n             changePasswordServer.setEnabled( true );\n             changePasswordServer.setDirectoryService( directoryService );\n-            \n+\n             // Transports\n             Transport[] chngPwdTransports = createTransports( changePasswordServerBean.getTransports() );\n             changePasswordServer.setTransports( chngPwdTransports );\n-            \n+\n             kdcServer.setChangePwdServer( changePasswordServer );\n         }\n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/d50cfcc32d0a9e8c42f90a33e091ca5dcc2487a2",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/81c242e4ab7ac33e0272ce07810cc5e0bf6f83f2",
        "message": "o Added some checks in the LdapNetworkConnection API for async operations so that we don't get NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1442292 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_50",
        "file": [
            {
                "sha": "3da75032f0d723638ed056577ab674ca9aa3b15f",
                "filename": "interceptors/authz/src/main/java/org/apache/directory/server/core/authz/AciAuthorizationInterceptor.java",
                "status": "modified",
                "additions": 4,
                "deletions": 3,
                "changes": 7,
                "blob_url": "https://github.com/apache/directory-server/blob/d50cfcc32d0a9e8c42f90a33e091ca5dcc2487a2/interceptors/authz/src/main/java/org/apache/directory/server/core/authz/AciAuthorizationInterceptor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/d50cfcc32d0a9e8c42f90a33e091ca5dcc2487a2/interceptors/authz/src/main/java/org/apache/directory/server/core/authz/AciAuthorizationInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/interceptors/authz/src/main/java/org/apache/directory/server/core/authz/AciAuthorizationInterceptor.java?ref=d50cfcc32d0a9e8c42f90a33e091ca5dcc2487a2",
                "patch": "@@ -376,7 +376,8 @@ private void addPerscriptiveAciTuples( OperationContext opContext, Collection<AC\n         {\n             Dn parentDn = dn.getParent();\n             CoreSession session = opContext.getSession();\n-            LookupOperationContext lookupContext = new LookupOperationContext( session, parentDn, SchemaConstants.ALL_ATTRIBUTES_ARRAY );\n+            LookupOperationContext lookupContext = new LookupOperationContext( session, parentDn,\n+                SchemaConstants.ALL_ATTRIBUTES_ARRAY );\n \n             originalEntry = directoryService.getPartitionNexus().lookup( lookupContext );\n         }\n@@ -1442,8 +1443,8 @@ public boolean accept( SearchOperationContext searchContext, Entry entry ) throw\n \n             return filter( searchContext, normName, entry );\n         }\n-        \n-        \n+\n+\n         /**\n          * {@inheritDoc}\n          */"
            },
            {
                "sha": "71f6ffc272b8582f1a767764eec19202b3b22eb2",
                "filename": "ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/ClientModifyDnRequestTest.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/d50cfcc32d0a9e8c42f90a33e091ca5dcc2487a2/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/ClientModifyDnRequestTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/d50cfcc32d0a9e8c42f90a33e091ca5dcc2487a2/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/ClientModifyDnRequestTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/ClientModifyDnRequestTest.java?ref=d50cfcc32d0a9e8c42f90a33e091ca5dcc2487a2",
                "patch": "@@ -70,7 +70,7 @@\n     @Before\n     public void setup() throws Exception\n     {\n-        connection = (LdapNetworkConnection)LdapApiIntegrationUtils.getPooledAdminConnection( getLdapServer() );\n+        connection = ( LdapNetworkConnection ) LdapApiIntegrationUtils.getPooledAdminConnection( getLdapServer() );\n         session = getLdapServer().getDirectoryService().getAdminSession();\n     }\n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/8c7bca005bd6df5f1b17550654e0a3d806a90df4",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/72c9a2b580262396172394a6ab3127c3e53983a3",
        "message": "Added the SchemaManager as a parameter in the FilteringOperationContext.contains() method to rget rid of a NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1419604 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_51",
        "file": [
            {
                "sha": "07879cb282b01cd84c2ad5a59a94166cc9b3ea8c",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/FilteringOperationContext.java",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/apache/directory-server/blob/8c7bca005bd6df5f1b17550654e0a3d806a90df4/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/FilteringOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/8c7bca005bd6df5f1b17550654e0a3d806a90df4/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/FilteringOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/FilteringOperationContext.java?ref=8c7bca005bd6df5f1b17550654e0a3d806a90df4",
                "patch": "@@ -32,6 +32,7 @@\n import org.apache.directory.shared.ldap.model.name.Dn;\n import org.apache.directory.shared.ldap.model.schema.AttributeType;\n import org.apache.directory.shared.ldap.model.schema.AttributeTypeOptions;\n+import org.apache.directory.shared.ldap.model.schema.SchemaManager;\n import org.apache.directory.shared.ldap.model.schema.SchemaUtils;\n import org.apache.directory.shared.ldap.model.schema.UsageEnum;\n import org.apache.directory.shared.util.StringConstants;\n@@ -187,7 +188,7 @@ public void addAttrsId( String attrId )\n      * @param attribute The attribute we are looking for\n      * @return true if the attribute is present\n      */\n-    public boolean contains( String attribute )\n+    public boolean contains( SchemaManager schemaManager, String attribute )\n     {\n         if ( isNoAttributes() )\n         {\n@@ -196,8 +197,7 @@ public boolean contains( String attribute )\n         \n         try\n         {\n-            AttributeType attributeType = getSession().getDirectoryService().\n-                getSchemaManager().lookupAttributeTypeRegistry( attribute );\n+            AttributeType attributeType = schemaManager.lookupAttributeTypeRegistry( attribute );\n             \n             if ( ( attributeType.getUsage() == UsageEnum.USER_APPLICATIONS ) && isAllUserAttributes() )\n             {"
            },
            {
                "sha": "13609c2ba2eee9866d7477e8fa202348b6dd2372",
                "filename": "interceptors/operational/src/main/java/org/apache/directory/server/core/operational/OperationalAttributeInterceptor.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/directory-server/blob/8c7bca005bd6df5f1b17550654e0a3d806a90df4/interceptors/operational/src/main/java/org/apache/directory/server/core/operational/OperationalAttributeInterceptor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/8c7bca005bd6df5f1b17550654e0a3d806a90df4/interceptors/operational/src/main/java/org/apache/directory/server/core/operational/OperationalAttributeInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/interceptors/operational/src/main/java/org/apache/directory/server/core/operational/OperationalAttributeInterceptor.java?ref=8c7bca005bd6df5f1b17550654e0a3d806a90df4",
                "patch": "@@ -646,7 +646,7 @@ private void filter( LookupOperationContext lookupContext, Entry entry ) throws\n                 if ( attributeType.getUsage() != UsageEnum.USER_APPLICATIONS )\n                 {\n                     // If it's not in the list of returning attribute, remove it\n-                    if ( !lookupContext.contains( attributeType.getOid() ) )\n+                    if ( !lookupContext.contains( schemaManager, attributeType.getOid() ) )\n                     {\n                         removedAttributes.add( attributeType );\n                     }\n@@ -689,7 +689,7 @@ private void filterList( LookupOperationContext lookupContext, Entry entry ) thr\n                 AttributeType attributeType = attribute.getAttributeType();\n \n                 // If it's not in the list of returning attribute, remove it\n-                if ( !lookupContext.contains( attributeType.getOid() ) )\n+                if ( !lookupContext.contains( schemaManager, attributeType.getOid() ) )\n                 {\n                     removedAttributes.add( attributeType );\n                 }"
            },
            {
                "sha": "51bb7c53dcccba32fe390f9abf8488918f984d0d",
                "filename": "xdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/AbstractBTreePartition.java",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/apache/directory-server/blob/8c7bca005bd6df5f1b17550654e0a3d806a90df4/xdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/AbstractBTreePartition.java",
                "raw_url": "https://github.com/apache/directory-server/raw/8c7bca005bd6df5f1b17550654e0a3d806a90df4/xdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/AbstractBTreePartition.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/xdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/AbstractBTreePartition.java?ref=8c7bca005bd6df5f1b17550654e0a3d806a90df4",
                "patch": "@@ -1119,7 +1119,7 @@ public Entry lookup( LookupOperationContext lookupContext ) throws LdapException\n \n                     if ( attributeType.getUsage() != UsageEnum.USER_APPLICATIONS )\n                     {\n-                        if ( !lookupContext.contains( oid ) )\n+                        if ( !lookupContext.contains( schemaManager, oid ) )\n                         {\n                             entry.removeAttributes( attributeType );\n                         }\n@@ -1138,7 +1138,7 @@ public Entry lookup( LookupOperationContext lookupContext ) throws LdapException\n \n                     if ( attributeType.getUsage() == UsageEnum.USER_APPLICATIONS )\n                     {\n-                        if ( !lookupContext.contains( oid ) )\n+                        if ( !lookupContext.contains( schemaManager, oid ) )\n                         {\n                             entry.removeAttributes( attributeType );\n                         }\n@@ -1166,7 +1166,7 @@ public Entry lookup( LookupOperationContext lookupContext ) throws LdapException\n                         AttributeType attributeType = attribute.getAttributeType();\n                         String oid = attributeType.getOid();\n \n-                        if ( !lookupContext.contains( oid ) )\n+                        if ( !lookupContext.contains( schemaManager, oid ) )\n                         {\n                             entry.removeAttributes( attributeType );\n                         }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/4f5d5e4b84461db984d529bcc1ae17d0ef35df0f",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/e2f0a3d285317026a5a115bf5f34ff36bd99a8ad",
        "message": "un ignored a test, I fixed the NPE that was making it fail\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1419497 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_52",
        "file": [
            {
                "sha": "271e435bae7dd100c88ecc927ca86dc1d9fe8582",
                "filename": "server-integ/src/test/java/org/apache/directory/server/replication/ClientServerReplicationIT.java",
                "status": "modified",
                "additions": 7,
                "deletions": 3,
                "changes": 10,
                "blob_url": "https://github.com/apache/directory-server/blob/4f5d5e4b84461db984d529bcc1ae17d0ef35df0f/server-integ/src/test/java/org/apache/directory/server/replication/ClientServerReplicationIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/4f5d5e4b84461db984d529bcc1ae17d0ef35df0f/server-integ/src/test/java/org/apache/directory/server/replication/ClientServerReplicationIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-integ/src/test/java/org/apache/directory/server/replication/ClientServerReplicationIT.java?ref=4f5d5e4b84461db984d529bcc1ae17d0ef35df0f",
                "patch": "@@ -183,8 +183,8 @@ private boolean checkEntryReplicated( Dn entryDn, boolean print ) throws Excepti\n                     System.out.println( entryDn.getName() + \" exists \" );\n                 }\n \n-                Entry providerEntry = providerSession.lookup( entryDn, SchemaConstants.ENTRY_CSN_AT );\n-                Entry consumerEntry = consumerSession.lookup( entryDn, SchemaConstants.ENTRY_CSN_AT );\n+                Entry providerEntry = providerSession.lookup( entryDn, \"*\", \"+\" );\n+                Entry consumerEntry = consumerSession.lookup( entryDn, \"*\", \"+\" );\n                 Csn providerCSN = new Csn( providerEntry.get( SchemaConstants.ENTRY_CSN_AT ).getString() );\n                 Csn consumerCSN = new Csn( consumerEntry.get( SchemaConstants.ENTRY_CSN_AT ).getString() );\n                 if ( consumerCSN.compareTo( providerCSN ) >= 0 )\n@@ -246,7 +246,6 @@ private boolean checkEntryDeletion( CoreSession session, Dn entryDn ) throws Exc\n \n \n     @Test\n-    @Ignore\n     public void testModify() throws Exception\n     {\n         Entry provUser = createEntry();\n@@ -256,7 +255,9 @@ public void testModify() throws Exception\n         assertFalse( consumerSession.exists( provUser.getDn() ) );\n \n         // add the entry and check it is replicated\n+        System.out.println( \">--------------------------------------- Adding \" + provUser );\n         providerSession.add( provUser );\n+        System.out.println( \">--------------------------------------- Added \" );\n \n         assertTrue( providerSession.exists( provUser.getDn() ) );\n         assertTrue( checkEntryReplicated( provUser.getDn() ) );\n@@ -265,7 +266,10 @@ public void testModify() throws Exception\n         ModifyRequest modReq = new ModifyRequestImpl();\n         modReq.setName( provUser.getDn() );\n         modReq.add( \"userPassword\", \"secret\" );\n+\n+        System.out.println( \">--------------------------------------- Modifying \" + modReq );\n         providerSession.modify( modReq );\n+        System.out.println( \">--------------------------------------- Modified \" );\n \n         assertTrue( checkEntryReplicated( provUser.getDn() ) );\n         compareEntries( provUser.getDn() );"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/2c7c1f2bc18b676822a835f62c15a89ce7226833",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/41ad3092c3c43b315dd92feb38b3f9031986c994",
        "message": "Protected the constructors against a NPE when the session is null\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1202269 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_53",
        "file": [
            {
                "sha": "b1904ef08996889bb51a23fa360e2c16dccfe63b",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/CompareOperationContext.java",
                "status": "modified",
                "additions": 37,
                "deletions": 13,
                "changes": 50,
                "blob_url": "https://github.com/apache/directory-server/blob/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/CompareOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/CompareOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/CompareOperationContext.java?ref=2c7c1f2bc18b676822a835f62c15a89ce7226833",
                "patch": "@@ -6,16 +6,16 @@\n  *  to you under the Apache License, Version 2.0 (the\n  *  \"License\"); you may not use this file except in compliance\n  *  with the License.  You may obtain a copy of the License at\n- *  \n+ * \n  *    http://www.apache.org/licenses/LICENSE-2.0\n- *  \n+ * \n  *  Unless required by applicable law or agreed to in writing,\n  *  software distributed under the License is distributed on an\n  *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n  *  KIND, either express or implied.  See the License for the\n  *  specific language governing permissions and limitations\n- *  under the License. \n- *  \n+ *  under the License.\n+ * \n  */\n package org.apache.directory.server.core.api.interceptor.context;\n \n@@ -58,7 +58,11 @@\n     public CompareOperationContext( CoreSession session )\n     {\n         super( session );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.COMPARE ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.COMPARE ) );\n+        }\n     }\n \n     \n@@ -70,7 +74,11 @@ public CompareOperationContext( CoreSession session )\n     public CompareOperationContext( CoreSession session, Dn dn )\n     {\n         super( session, dn );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.COMPARE ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.COMPARE ) );\n+        }\n     }\n \n     \n@@ -83,7 +91,11 @@ public CompareOperationContext( CoreSession session, String oid )\n     {\n         super( session );\n         this.oid = oid;\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.COMPARE ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.COMPARE ) );\n+        }\n     }\n \n     \n@@ -96,7 +108,11 @@ public CompareOperationContext( CoreSession session, Dn dn, String oid )\n     {\n         super( session, dn );\n         this.oid = oid;\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.COMPARE ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.COMPARE ) );\n+        }\n     }\n \n     \n@@ -110,7 +126,11 @@ public CompareOperationContext( CoreSession session, Dn dn, String oid, Value<?>\n         super( session, dn );\n         this.oid = oid;\n         this.value = value;\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.COMPARE ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.COMPARE ) );\n+        }\n     }\n \n     \n@@ -120,7 +140,11 @@ public CompareOperationContext( CoreSession session, CompareRequest compareReque\n         this.oid = compareRequest.getAttributeId();\n         this.value = compareRequest.getAssertionValue();\n         this.requestControls = compareRequest.getControls();\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.COMPARE ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.COMPARE ) );\n+        }\n         \n         if ( requestControls.containsKey( ManageDsaIT.OID ) )\n         {\n@@ -136,7 +160,7 @@ public CompareOperationContext( CoreSession session, CompareRequest compareReque\n     /**\n      * @return The compared OID\n      */\n-    public String getOid() \n+    public String getOid()\n     {\n         return oid;\n     }\n@@ -146,7 +170,7 @@ public String getOid()\n      * Set the compared OID\n      * @param oid The compared OID\n      */\n-    public void setOid( String  oid ) \n+    public void setOid( String  oid )\n     {\n         this.oid = oid;\n     }\n@@ -155,7 +179,7 @@ public void setOid( String  oid )\n     /**\n      * @return The value to compare\n      */\n-    public Value<?> getValue() \n+    public Value<?> getValue()\n     {\n         return value;\n     }"
            },
            {
                "sha": "652df2a80225f83437d73f3f260b9dbd3fd44c93",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/DeleteOperationContext.java",
                "status": "modified",
                "additions": 20,
                "deletions": 7,
                "changes": 27,
                "blob_url": "https://github.com/apache/directory-server/blob/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/DeleteOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/DeleteOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/DeleteOperationContext.java?ref=2c7c1f2bc18b676822a835f62c15a89ce7226833",
                "patch": "@@ -6,16 +6,16 @@\n  *  to you under the Apache License, Version 2.0 (the\n  *  \"License\"); you may not use this file except in compliance\n  *  with the License.  You may obtain a copy of the License at\n- *  \n+ * \n  *    http://www.apache.org/licenses/LICENSE-2.0\n- *  \n+ * \n  *  Unless required by applicable law or agreed to in writing,\n  *  software distributed under the License is distributed on an\n  *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n  *  KIND, either express or implied.  See the License for the\n  *  specific language governing permissions and limitations\n- *  under the License. \n- *  \n+ *  under the License.\n+ * \n  */\n package org.apache.directory.server.core.api.interceptor.context;\n \n@@ -43,7 +43,11 @@\n     public DeleteOperationContext( CoreSession session )\n     {\n         super( session );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.DELETE ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.DELETE ) );\n+        }\n     }\n     \n \n@@ -55,14 +59,23 @@ public DeleteOperationContext( CoreSession session )\n     public DeleteOperationContext( CoreSession session, Dn deleteDn )\n     {\n         super( session, deleteDn );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.DELETE ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.DELETE ) );\n+        }\n     }\n \n \n     public DeleteOperationContext( CoreSession session, DeleteRequest deleteRequest )\n     {\n         super( session, deleteRequest.getName() );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.DELETE ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.DELETE ) );\n+        }\n+        \n         requestControls = deleteRequest.getControls();\n         \n         if ( requestControls.containsKey( ManageDsaIT.OID ) )"
            },
            {
                "sha": "464f361243e3743389e851cab5f751824ef4c838",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/GetRootDseOperationContext.java",
                "status": "modified",
                "additions": 10,
                "deletions": 2,
                "changes": 12,
                "blob_url": "https://github.com/apache/directory-server/blob/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/GetRootDseOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/GetRootDseOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/GetRootDseOperationContext.java?ref=2c7c1f2bc18b676822a835f62c15a89ce7226833",
                "patch": "@@ -39,7 +39,11 @@\n     public GetRootDseOperationContext( CoreSession session )\n     {\n         super( session );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.GET_ROOT_DSE ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.GET_ROOT_DSE ) );\n+        }\n     }\n     \n     \n@@ -51,7 +55,11 @@ public GetRootDseOperationContext( CoreSession session )\n     public GetRootDseOperationContext( CoreSession session, Dn dn )\n     {\n         super( session, dn );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.GET_ROOT_DSE ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.GET_ROOT_DSE ) );\n+        }\n     }\n     \n     "
            },
            {
                "sha": "5bc8057fa61fdabce7e5955cd5a63e19b01665d9",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/HasEntryOperationContext.java",
                "status": "modified",
                "additions": 10,
                "deletions": 2,
                "changes": 12,
                "blob_url": "https://github.com/apache/directory-server/blob/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/HasEntryOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/HasEntryOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/HasEntryOperationContext.java?ref=2c7c1f2bc18b676822a835f62c15a89ce7226833",
                "patch": "@@ -40,7 +40,11 @@\n     public HasEntryOperationContext( CoreSession session )\n     {\n         super( session );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.HAS_ENTRY ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.HAS_ENTRY ) );\n+        }\n     }\n     \n     \n@@ -52,7 +56,11 @@ public HasEntryOperationContext( CoreSession session )\n     public HasEntryOperationContext( CoreSession session, Dn entryDn )\n     {\n         super( session, entryDn );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.HAS_ENTRY ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.HAS_ENTRY ) );\n+        }\n     }\n     \n "
            },
            {
                "sha": "b4d517fdded79373facbe8fa067c1b02103a831d",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/ListOperationContext.java",
                "status": "modified",
                "additions": 15,
                "deletions": 3,
                "changes": 18,
                "blob_url": "https://github.com/apache/directory-server/blob/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/ListOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/ListOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/ListOperationContext.java?ref=2c7c1f2bc18b676822a835f62c15a89ce7226833",
                "patch": "@@ -42,7 +42,11 @@\n     public ListOperationContext( CoreSession session )\n     {\n         super( session );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.LIST ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.LIST ) );\n+        }\n     }\n \n \n@@ -54,7 +58,11 @@ public ListOperationContext( CoreSession session )\n     public ListOperationContext( CoreSession session, Dn dn )\n     {\n         super( session, dn );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.LIST ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.LIST ) );\n+        }\n     }\n \n \n@@ -69,7 +77,11 @@ public ListOperationContext( CoreSession session, Dn dn )\n     public ListOperationContext( CoreSession session, Dn dn, Set<AttributeTypeOptions> returningAttributes )\n     {\n         super( session, dn, returningAttributes );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.LIST ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.LIST ) );\n+        }\n     }\n \n "
            },
            {
                "sha": "363d34d524ece5cdfdd8a18d8a0cc8dd8a85dd43",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/MoveAndRenameOperationContext.java",
                "status": "modified",
                "additions": 15,
                "deletions": 3,
                "changes": 18,
                "blob_url": "https://github.com/apache/directory-server/blob/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/MoveAndRenameOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/MoveAndRenameOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/MoveAndRenameOperationContext.java?ref=2c7c1f2bc18b676822a835f62c15a89ce7226833",
                "patch": "@@ -47,7 +47,11 @@\n     public MoveAndRenameOperationContext( CoreSession session )\n     {\n         super( session );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.MOVE_AND_RENAME ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.MOVE_AND_RENAME ) );\n+        }\n     }\n \n \n@@ -63,7 +67,11 @@ public MoveAndRenameOperationContext( CoreSession session, Dn oldDn, Dn newSuper\n     {\n         super( session, oldDn, newRdn, delOldRdn );\n         this.newSuperiorDn = newSuperiorDn;\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.MOVE_AND_RENAME ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.MOVE_AND_RENAME ) );\n+        }\n \n         try\n         {\n@@ -81,7 +89,11 @@ public MoveAndRenameOperationContext( CoreSession session, ModifyDnRequest modif\n         // super sets the newRdn and the delOldRdn members and tests\n         super( session, modifyDnRequest );\n         this.newSuperiorDn = modifyDnRequest.getNewSuperior();\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.MOVE_AND_RENAME ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.MOVE_AND_RENAME ) );\n+        }\n \n         if ( newSuperiorDn == null )\n         {"
            },
            {
                "sha": "2289536832d0cf1ef0d8134c2de31f31a48a99f8",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/MoveOperationContext.java",
                "status": "modified",
                "additions": 15,
                "deletions": 3,
                "changes": 18,
                "blob_url": "https://github.com/apache/directory-server/blob/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/MoveOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/MoveOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/MoveOperationContext.java?ref=2c7c1f2bc18b676822a835f62c15a89ce7226833",
                "patch": "@@ -58,7 +58,11 @@\n     public MoveOperationContext( CoreSession session )\n     {\n         super( session );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.MOVE ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.MOVE ) );\n+        }\n     }\n \n \n@@ -71,7 +75,11 @@ public MoveOperationContext( CoreSession session, Dn oldDn, Dn newSuperior )\n         this.newSuperior = newSuperior;\n         oldSuperior = oldDn.getParent();\n         rdn = ( oldDn.getRdn().clone() );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.MOVE ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.MOVE ) );\n+        }\n \n         try\n         {\n@@ -88,7 +96,11 @@ public MoveOperationContext( CoreSession session, ModifyDnRequest modifyDnReques\n     {\n         super( session, modifyDnRequest.getName() );\n         this.newSuperior = modifyDnRequest.getNewSuperior();\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.MOVE ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.MOVE ) );\n+        }\n \n         if ( newSuperior == null )\n         {"
            },
            {
                "sha": "ef7c70e751e99c958e577a11ccc1aa4900886e4b",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/RenameOperationContext.java",
                "status": "modified",
                "additions": 15,
                "deletions": 3,
                "changes": 18,
                "blob_url": "https://github.com/apache/directory-server/blob/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/RenameOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/RenameOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/RenameOperationContext.java?ref=2c7c1f2bc18b676822a835f62c15a89ce7226833",
                "patch": "@@ -55,7 +55,11 @@\n     public RenameOperationContext( CoreSession session )\n     {\n         super( session );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.RENAME ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.RENAME ) );\n+        }\n     }\n \n \n@@ -71,15 +75,23 @@ public RenameOperationContext( CoreSession session, Dn oldDn, Rdn newRdn, boolea\n         super( session, oldDn );\n         this.newRdn = newRdn;\n         this.deleteOldRdn = deleteOldRdn;\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.RENAME ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.RENAME ) );\n+        }\n     }\n \n \n     public RenameOperationContext( CoreSession session, ModifyDnRequest modifyDnRequest )\n     {\n         super( session, modifyDnRequest.getName() );\n         this.newRdn = modifyDnRequest.getNewRdn();\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.RENAME ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.RENAME ) );\n+        }\n \n         if ( newRdn == null )\n         {"
            },
            {
                "sha": "7614af20157867868d6c39c2fa6ba6174eba6214",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/SearchOperationContext.java",
                "status": "modified",
                "additions": 20,
                "deletions": 4,
                "changes": 24,
                "blob_url": "https://github.com/apache/directory-server/blob/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/SearchOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/SearchOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/SearchOperationContext.java?ref=2c7c1f2bc18b676822a835f62c15a89ce7226833",
                "patch": "@@ -58,7 +58,11 @@\n     public SearchOperationContext( CoreSession session )\n     {\n         super( session );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.SEARCH ) );\n+        \n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.SEARCH ) );\n+        }\n     }\n \n \n@@ -69,7 +73,11 @@ public SearchOperationContext( CoreSession session )\n     public SearchOperationContext( CoreSession session, SearchRequest searchRequest ) throws LdapException\n     {\n         super( session );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.SEARCH ) );\n+        \n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.SEARCH ) );\n+        }\n \n         this.dn = searchRequest.getBase();\n         this.filter = searchRequest.getFilter();\n@@ -114,7 +122,11 @@ public SearchOperationContext( CoreSession session, Dn dn, ExprNode filter, Sear\n         timeLimit = searchControls.getTimeLimit();\n         sizeLimit = searchControls.getCountLimit();\n         typesOnly = searchControls.getReturningObjFlag();\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.SEARCH ) );\n+        \n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.SEARCH ) );\n+        }\n \n         if ( searchControls.getReturningAttributes() != null )\n         {\n@@ -143,7 +155,11 @@ public SearchOperationContext( CoreSession session, Dn dn, SearchScope scope,\n         super( session, dn, returningAttributes );\n         super.setScope( scope );\n         this.filter = filter;\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.SEARCH ) );\n+        \n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.SEARCH ) );\n+        }\n     }\n \n "
            },
            {
                "sha": "1e6d0c02e86a64765c2d3652619a02be7396635d",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/UnbindOperationContext.java",
                "status": "modified",
                "additions": 14,
                "deletions": 6,
                "changes": 20,
                "blob_url": "https://github.com/apache/directory-server/blob/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/UnbindOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/2c7c1f2bc18b676822a835f62c15a89ce7226833/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/UnbindOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/UnbindOperationContext.java?ref=2c7c1f2bc18b676822a835f62c15a89ce7226833",
                "patch": "@@ -6,16 +6,16 @@\n  *  to you under the Apache License, Version 2.0 (the\n  *  \"License\"); you may not use this file except in compliance\n  *  with the License.  You may obtain a copy of the License at\n- *  \n+ * \n  *    http://www.apache.org/licenses/LICENSE-2.0\n- *  \n+ * \n  *  Unless required by applicable law or agreed to in writing,\n  *  software distributed under the License is distributed on an\n  *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n  *  KIND, either express or implied.  See the License for the\n  *  specific language governing permissions and limitations\n- *  under the License. \n- *  \n+ *  under the License.\n+ * \n  */\n package org.apache.directory.server.core.api.interceptor.context;\n \n@@ -40,15 +40,23 @@\n     public UnbindOperationContext( CoreSession session )\n     {\n         super( session, session.getEffectivePrincipal().getDn() );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.UNBIND ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.UNBIND ) );\n+        }\n     }\n     \n \n     public UnbindOperationContext( CoreSession session, UnbindRequest unbindRequest )\n     {\n         super( session, session.getEffectivePrincipal().getDn() );\n         setRequestControls( unbindRequest.getControls() );\n-        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.UNBIND ) );\n+\n+        if ( session != null )\n+        {\n+            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.UNBIND ) );\n+        }\n     }\n \n     "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/6bc7fc3a60b587521bfebfe6fc4d399a4991ba79",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/fe567d53189df34eb320ebf70835d488cf6f91c6",
        "message": "Initilize the DS instance before calling the loadChangeLog method to avoid a NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1157269 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_54",
        "file": [
            {
                "sha": "b787c6388bac61e2eb6cb69d4052e6800d0a413e",
                "filename": "core/src/main/java/org/apache/directory/server/core/changelog/MemoryChangeLogStore.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/6bc7fc3a60b587521bfebfe6fc4d399a4991ba79/core/src/main/java/org/apache/directory/server/core/changelog/MemoryChangeLogStore.java",
                "raw_url": "https://github.com/apache/directory-server/raw/6bc7fc3a60b587521bfebfe6fc4d399a4991ba79/core/src/main/java/org/apache/directory/server/core/changelog/MemoryChangeLogStore.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/changelog/MemoryChangeLogStore.java?ref=6bc7fc3a60b587521bfebfe6fc4d399a4991ba79",
                "patch": "@@ -121,10 +121,10 @@ public Tag tag( String description ) throws Exception\n     public void init( DirectoryService service ) throws Exception\n     {\n         workingDirectory = service.getInstanceLayout().getLogDirectory();\n+        this.directoryService = service;\n         loadRevision();\n         loadTags();\n         loadChangeLog();\n-        this.directoryService = service;\n     }\n \n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/3ecd4e9cd91dbd1ece86bdd2006edcbf3edcc9f2",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/1f40e0de2356e937c20b5e3b5dba19b6595fe3d7",
        "message": "Fix NPE: if one transport is disabled the Transport array contains a null element.\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1150229 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_55",
        "file": [
            {
                "sha": "946f18f95c8a0aba19e617d984b037b9e0803d7c",
                "filename": "service-builder/src/main/java/org/apache/directory/server/config/ServiceBuilder.java",
                "status": "modified",
                "additions": 3,
                "deletions": 4,
                "changes": 7,
                "blob_url": "https://github.com/apache/directory-server/blob/3ecd4e9cd91dbd1ece86bdd2006edcbf3edcc9f2/service-builder/src/main/java/org/apache/directory/server/config/ServiceBuilder.java",
                "raw_url": "https://github.com/apache/directory-server/raw/3ecd4e9cd91dbd1ece86bdd2006edcbf3edcc9f2/service-builder/src/main/java/org/apache/directory/server/config/ServiceBuilder.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/service-builder/src/main/java/org/apache/directory/server/config/ServiceBuilder.java?ref=3ecd4e9cd91dbd1ece86bdd2006edcbf3edcc9f2",
                "patch": "@@ -533,18 +533,17 @@ else if ( transportBean instanceof UdpTransportBean )\n      */\n     public static Transport[] createTransports( TransportBean[] transportBeans )\n     {\n-        Transport[] transports = new Transport[ transportBeans.length ];\n-        int i = 0;\n+        List<Transport> transports = new ArrayList<Transport>();\n         \n         for ( TransportBean transportBean : transportBeans )\n         {\n             if ( transportBean.isEnabled() )\n             {\n-                transports[i++] = createTransport( transportBean );\n+                transports.add( createTransport( transportBean ) );\n             }\n         }\n         \n-        return transports;\n+        return transports.toArray( new Transport[transports.size()] );\n     }\n     /**\n      * Helper method to create an Array of EncryptionTypes from an array of Strings"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/7cd973a144b581dad1fa1163dd71d8e0990fb198",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/79c7c71120d744fd03299debe3654d7e8dabfca3",
        "message": "o fixed a NPE in handling the SyncModifyDn control \no added more tests\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1128731 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_56",
        "file": [
            {
                "sha": "69d127d819bfcbae8db757eed9be74e32557c620",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/SyncReplConsumer.java",
                "status": "modified",
                "additions": 2,
                "deletions": 5,
                "changes": 7,
                "blob_url": "https://github.com/apache/directory-server/blob/7cd973a144b581dad1fa1163dd71d8e0990fb198/protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/SyncReplConsumer.java",
                "raw_url": "https://github.com/apache/directory-server/raw/7cd973a144b581dad1fa1163dd71d8e0990fb198/protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/SyncReplConsumer.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/replication/SyncReplConsumer.java?ref=7cd973a144b581dad1fa1163dd71d8e0990fb198",
                "patch": "@@ -341,12 +341,9 @@ public void handleSearchResult( SearchResultEntry syncResult )\n                     break;\n \n                 case MODDN:\n-                    Control adsModDnControl = syncResult.getControls().get( SyncModifyDn.OID );\n+                    SyncModifyDn adsModDnControl = ( SyncModifyDn ) syncResult.getControls().get( SyncModifyDn.OID );\n                     //Apache Directory Server's special control\n-                    SyncModifyDnDecorator syncModDnControl = \n-                        new SyncModifyDnDecorator( directoryService.getLdapCodecService() );\n-                    syncModDnControl.setDecorated( ( SyncModifyDn ) adsModDnControl );\n-                    applyModDnOperation( syncModDnControl );\n+                    applyModDnOperation( adsModDnControl );\n                     break;\n \n                 case DELETE:"
            },
            {
                "sha": "8e97dec4c58cb3a4f28cf3d8feed1d54e28db771",
                "filename": "server-integ/src/test/java/org/apache/directory/server/replication/ClientServerReplicationIT.java",
                "status": "modified",
                "additions": 94,
                "deletions": 10,
                "changes": 104,
                "blob_url": "https://github.com/apache/directory-server/blob/7cd973a144b581dad1fa1163dd71d8e0990fb198/server-integ/src/test/java/org/apache/directory/server/replication/ClientServerReplicationIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/7cd973a144b581dad1fa1163dd71d8e0990fb198/server-integ/src/test/java/org/apache/directory/server/replication/ClientServerReplicationIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-integ/src/test/java/org/apache/directory/server/replication/ClientServerReplicationIT.java?ref=7cd973a144b581dad1fa1163dd71d8e0990fb198",
                "patch": "@@ -21,11 +21,13 @@\n package org.apache.directory.server.replication;\n \n \n-import static org.junit.Assert.*;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n \n import java.lang.reflect.Method;\n import java.util.ArrayList;\n import java.util.List;\n+import java.util.concurrent.atomic.AtomicInteger;\n \n import org.apache.directory.server.annotations.CreateLdapServer;\n import org.apache.directory.server.annotations.CreateTransport;\n@@ -44,6 +46,10 @@\n import org.apache.directory.server.ldap.replication.SyncreplConfiguration;\n import org.apache.directory.shared.ldap.model.entry.DefaultEntry;\n import org.apache.directory.shared.ldap.model.entry.Entry;\n+import org.apache.directory.shared.ldap.model.message.ModifyRequest;\n+import org.apache.directory.shared.ldap.model.message.ModifyRequestImpl;\n+import org.apache.directory.shared.ldap.model.name.Dn;\n+import org.apache.directory.shared.ldap.model.name.Rdn;\n import org.apache.directory.shared.ldap.model.schema.SchemaManager;\n import org.junit.AfterClass;\n import org.junit.Before;\n@@ -67,6 +73,8 @@\n     \n     private CoreSession consumerSession;\n     \n+    private static AtomicInteger entryCount = new AtomicInteger();\n+    \n     @BeforeClass\n     public static void setUp() throws Exception\n     {\n@@ -107,17 +115,93 @@ public void testInjectContextEntry() throws Exception\n        \n        providerSession.add( entry );\n        \n-       // sleep for 2 sec (twice the refresh interval), just to let the first refresh request succeed\n-       Thread.sleep( 2000 );\n-       \n-       assertTrue( consumerSession.exists( dn ) );\n-       \n-       Entry providerEntry = providerSession.lookup( entry.getDn(), \"*\", \"+\" );\n-       \n-       Entry consumerEntry = consumerSession.lookup( entry.getDn(), \"*\", \"+\" );\n-       assertEquals( providerEntry, consumerEntry );\n+       waitAndCompareEntries( entry.getDn() );\n+    }\n+\n+    \n+    @Test\n+    public void testModify() throws Exception\n+    {\n+        Entry provUser = createEntry();\n+        \n+        assertFalse( consumerSession.exists( provUser.getDn() ) );\n+        \n+        providerSession.add( provUser );\n+        \n+        ModifyRequest modReq = new ModifyRequestImpl();\n+        modReq.setName( provUser.getDn() );\n+        modReq.add( \"userPassword\", \"secret\" );\n+        \n+        providerSession.modify( modReq );\n+        \n+        waitAndCompareEntries( provUser.getDn() );\n+    }\n+    \n+    \n+    @Test\n+    public void testModDn() throws Exception\n+    {\n+        Entry provUser = createEntry();\n+        \n+        assertFalse( consumerSession.exists( provUser.getDn() ) );\n+        \n+        providerSession.add( provUser );\n+     \n+        Dn usersContainer = new Dn( schemaManager, \"ou=users,dc=example,dc=com\" );\n+        \n+        DefaultEntry entry = new DefaultEntry( schemaManager, usersContainer );\n+        entry.add( \"objectClass\", \"organizationalUnit\" );\n+        entry.add( \"ou\", \"users\" );\n+        \n+        providerSession.add( entry );\n+        \n+        waitAndCompareEntries( entry.getDn() );\n+        \n+        // move\n+        Dn userDn = provUser.getDn();\n+        providerSession.move( userDn, usersContainer );\n+        \n+        userDn = usersContainer.add( userDn.getRdn() );\n+        \n+        waitAndCompareEntries( userDn );\n+        \n+        // now try renaming\n+        Rdn newName = new Rdn( schemaManager, userDn.getRdn().getName() + \"renamed\");\n+        \n+        providerSession.rename( userDn, newName, true );\n+        \n+        userDn = usersContainer.add( newName );\n+        \n+        waitAndCompareEntries( userDn );\n     }\n+    \n+    \n+    private void waitAndCompareEntries( Dn dn ) throws Exception\n+    {\n+        // sleep for 2 sec (twice the refresh interval), just to let the first refresh request succeed\n+        Thread.sleep( 2000 );\n \n+        Entry providerEntry = providerSession.lookup( dn, \"*\", \"+\" );\n+        \n+        Entry consumerEntry = consumerSession.lookup( dn, \"*\", \"+\" );\n+        assertEquals( providerEntry, consumerEntry );\n+    }\n+    \n+    \n+    private Entry createEntry() throws Exception\n+    {\n+        String user = \"user\"+ entryCount.incrementAndGet();\n+        \n+        String dn = \"cn=\" + user + \",dc=example,dc=com\";\n+        \n+        DefaultEntry entry = new DefaultEntry( schemaManager, dn );\n+        entry.add( \"objectClass\", \"person\" );\n+        entry.add( \"cn\", user );\n+        entry.add( \"sn\", user );\n+        \n+        return entry;\n+    }\n+    \n     \n     @CreateDS(allowAnonAccess = true, name = \"provider-replication\", partitions =\n         {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/a03ecc87ec4778c36a2f63535ab63ecd3c3670d1",
        "message": "o Renamed the addAll( Dn ) method to add( Dn )\no Fixed some potential NPE\no Minor other refactorings\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1085318 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_57",
        "file": [
            {
                "sha": "532f15027e70021e6ff3633d92b3986cc2f6974a",
                "filename": "core-integ/src/test/java/org/apache/directory/server/core/authz/SearchAuthorizationIT.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1/core-integ/src/test/java/org/apache/directory/server/core/authz/SearchAuthorizationIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1/core-integ/src/test/java/org/apache/directory/server/core/authz/SearchAuthorizationIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-integ/src/test/java/org/apache/directory/server/core/authz/SearchAuthorizationIT.java?ref=73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1",
                "patch": "@@ -133,7 +133,7 @@ private void recursivelyAddSearchData( Dn parent, Entry[] children, final long s\n         for ( int i = 0; ( i < children.length ) && ( count[0] < sizeLimit ); i++ )\n         {\n             Dn childRdn = new Dn();\n-            childRdn = childRdn.addAll( parent );\n+            childRdn = childRdn.add( parent );\n             childRdn = childRdn.add( \"ou=\" + i );\n             childRdns[i] = childRdn;\n             children[i].setDn( childRdn );"
            },
            {
                "sha": "88f0a036d3be1644579445427bb34d2b64d7ec12",
                "filename": "core-jndi/src/main/java/org/apache/directory/server/core/jndi/ServerContext.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/directory-server/blob/73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1/core-jndi/src/main/java/org/apache/directory/server/core/jndi/ServerContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1/core-jndi/src/main/java/org/apache/directory/server/core/jndi/ServerContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-jndi/src/main/java/org/apache/directory/server/core/jndi/ServerContext.java?ref=73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1",
                "patch": "@@ -1614,7 +1614,7 @@ public Name composeName( Name name, Name prefix ) throws NamingException\n         \n         try\n         {\n-            return JndiUtils.toName( JndiUtils.fromName( prefix ).addAll( fqn ) );\n+            return JndiUtils.toName( JndiUtils.fromName( prefix ).add( fqn ) );\n         }\n         catch ( LdapInvalidDnException lide )\n         {\n@@ -1711,7 +1711,7 @@ Dn buildTarget( Dn relativeName ) throws NamingException\n         // Add to left hand side of cloned Dn the relative name arg\n         try\n         {\n-            target = target.addAll( relativeName );\n+            target = target.add( relativeName );\n             target.applySchemaManager( schemaManager );\n         }\n         catch (LdapInvalidDnException lide )"
            },
            {
                "sha": "eac3d6f48e425f496764628ddf2398413423babd",
                "filename": "core/src/main/java/org/apache/directory/server/core/DefaultOperationManager.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/directory-server/blob/73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1/core/src/main/java/org/apache/directory/server/core/DefaultOperationManager.java",
                "raw_url": "https://github.com/apache/directory-server/raw/73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1/core/src/main/java/org/apache/directory/server/core/DefaultOperationManager.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/DefaultOperationManager.java?ref=73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1",
                "patch": "@@ -105,7 +105,7 @@ private LdapReferralException buildReferralException( Entry parentEntry, Dn chil\n                 // So we have to take the Rdn one by one, and create a\n                 // new Dn with the type and value UP form\n     \n-                Dn urlDn = ldapUrl.getDn().addAll( childDn );\n+                Dn urlDn = ldapUrl.getDn().add( childDn );\n     \n                 ldapUrl.setDn( urlDn );\n                 urls.add( ldapUrl.toString() );\n@@ -155,7 +155,7 @@ private LdapReferralException buildReferralExceptionForSearch( Entry parentEntry\n                     // So we have to take the Rdn one by one, and create a\n                     // new Dn with the type and value UP form\n \n-                    Dn urlDn = ldapUrl.getDn().addAll( childDn );\n+                    Dn urlDn = ldapUrl.getDn().add( childDn );\n \n                     ldapUrl.setDn( urlDn );\n                 }"
            },
            {
                "sha": "ab72745d1557a0aa43fad4edb2eca8f5d94f112a",
                "filename": "core/src/main/java/org/apache/directory/server/core/subtree/SubentryInterceptor.java",
                "status": "modified",
                "additions": 7,
                "deletions": 7,
                "changes": 14,
                "blob_url": "https://github.com/apache/directory-server/blob/73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1/core/src/main/java/org/apache/directory/server/core/subtree/SubentryInterceptor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1/core/src/main/java/org/apache/directory/server/core/subtree/SubentryInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/subtree/SubentryInterceptor.java?ref=73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1",
                "patch": "@@ -873,7 +873,7 @@ public void add( NextInterceptor next, AddOperationContext addContext ) throws L\n              * ----------------------------------------------------------------\n              */\n             Dn baseDn = apDn;\n-            baseDn = baseDn.addAll( subentry.getSubtreeSpecification().getBase() );\n+            baseDn = baseDn.add( subentry.getSubtreeSpecification().getBase() );\n \n             updateEntries( OperationEnum.ADD, addContext.getSession(), dn, apDn, subentry.getSubtreeSpecification(), baseDn, operationalAttributes );\n \n@@ -961,7 +961,7 @@ public void delete( NextInterceptor next, DeleteOperationContext deleteContext )\n              */\n             Dn apDn = dn.getParent();\n             Dn baseDn = apDn;\n-            baseDn = baseDn.addAll( removedSubentry.getSubtreeSpecification().getBase() );\n+            baseDn = baseDn.add( removedSubentry.getSubtreeSpecification().getBase() );\n \n             // Remove all the references to this removed subentry from all the selected entries\n             updateEntries( OperationEnum.REMOVE, deleteContext.getSession(), dn, apDn, removedSubentry.getSubtreeSpecification(), baseDn, null );\n@@ -1057,7 +1057,7 @@ public void modify( NextInterceptor next, ModifyOperationContext modifyContext )\n             // search for all entries selected by the old SS and remove references to subentry\n             Dn apName = dn.getParent();\n             Dn oldBaseDn = apName;\n-            oldBaseDn = oldBaseDn.addAll( ssOld.getBase() );\n+            oldBaseDn = oldBaseDn.add( ssOld.getBase() );\n \n             ExprNode filter = new PresenceNode( OBJECT_CLASS_AT );\n             SearchControls controls = new SearchControls();\n@@ -1094,7 +1094,7 @@ public void modify( NextInterceptor next, ModifyOperationContext modifyContext )\n             subentry = subentryCache.getSubentry( dn );\n             List<EntryAttribute> operationalAttributes = getSubentryOperationalAttributes( dn, subentry );\n             Dn newBaseDn = apName;\n-            newBaseDn = newBaseDn.addAll( ssNew.getBase() );\n+            newBaseDn = newBaseDn.add( ssNew.getBase() );\n \n             searchOperationContext = new SearchOperationContext( modifyContext.getSession(), newBaseDn, filter, controls );\n             searchOperationContext.setAliasDerefMode( AliasDerefMode.NEVER_DEREF_ALIASES );\n@@ -1189,7 +1189,7 @@ public void move( NextInterceptor next, MoveOperationContext moveContext ) throw\n             SubtreeSpecification ss = subentry.getSubtreeSpecification();\n             Dn apName = oldDn.getParent();\n             Dn baseDn = apName;\n-            baseDn = baseDn.addAll( ss.getBase() );\n+            baseDn = baseDn.add( ss.getBase() );\n             Dn newName = newSuperiorDn;\n             newName = newName.add( oldDn.getRdn() );\n             newName.applySchemaManager( schemaManager );\n@@ -1280,7 +1280,7 @@ public void moveAndRename( NextInterceptor next, MoveAndRenameOperationContext m\n             SubtreeSpecification ss = subentry.getSubtreeSpecification();\n             Dn apName = oldDn.getParent();\n             Dn baseDn = apName;\n-            baseDn = baseDn.addAll( ss.getBase() );\n+            baseDn = baseDn.add( ss.getBase() );\n             Dn newName = newSuperiorDn.getParent();\n \n             newName = newName.add( moveAndRenameContext.getNewRdn() );\n@@ -1363,7 +1363,7 @@ public void rename( NextInterceptor next, RenameOperationContext renameContext )\n             SubtreeSpecification ss = subentry.getSubtreeSpecification();\n             Dn apName = oldDn.getParent();\n             Dn baseDn = apName;\n-            baseDn = baseDn.addAll( ss.getBase() );\n+            baseDn = baseDn.add( ss.getBase() );\n             Dn newName = oldDn.getParent();\n \n             newName = newName.add( renameContext.getNewRdn() );"
            },
            {
                "sha": "f57581e676b0d97149485d6a54a84b4d75fc7334",
                "filename": "core/src/main/java/org/apache/directory/server/core/subtree/SubtreeEvaluator.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1/core/src/main/java/org/apache/directory/server/core/subtree/SubtreeEvaluator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1/core/src/main/java/org/apache/directory/server/core/subtree/SubtreeEvaluator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/subtree/SubtreeEvaluator.java?ref=73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1",
                "patch": "@@ -78,7 +78,7 @@ public boolean evaluate( SubtreeSpecification subtree, Dn apDn, Dn entryDn, Entr\n         // First construct the subtree base, which is the concatenation of the\n         // AP Dn and the subentry base\n         Dn subentryBaseDn = apDn;\n-        subentryBaseDn = subentryBaseDn.addAll( subtree.getBase() );\n+        subentryBaseDn = subentryBaseDn.add( subtree.getBase() );\n         \n         String s = subentryBaseDn.toString();\n         "
            },
            {
                "sha": "99c416ef55705a506a644d48895ecf190f88cf44",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/SearchHandler.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/directory-server/blob/73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/SearchHandler.java",
                "raw_url": "https://github.com/apache/directory-server/raw/73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/SearchHandler.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/SearchHandler.java?ref=73ea31cd3e6f1d8bb03cf8767cb657f3161d0bb1",
                "patch": "@@ -1404,7 +1404,7 @@ public Referral getReferralOnAncestorForSearch( LdapSession session, SearchReque\n              * name past the farthest referral Dn which the target name extends.\n              */\n             Dn suffix = req.getBase().getDescendantOf( referralAncestor.getDn() );\n-            Dn refDn = urlDn.addAll( suffix );\n+            Dn refDn = urlDn.add( suffix );\n             \n             ldapUrl.setDn( refDn );\n             ldapUrl.setForceScopeRendering( true );\n@@ -1483,7 +1483,7 @@ public Referral getReferralOnAncestor( LdapSession session, Dn reqTargetDn, Sear\n              * name past the farthest referral Dn which the target name extends.\n              */\n             Dn suffix = req.getBase().getDescendantOf( referralAncestor.getDn() );\n-            urlDn = urlDn.addAll( suffix );\n+            urlDn = urlDn.add( suffix );\n \n             StringBuilder buf = new StringBuilder();\n             buf.append( ldapUrl.getScheme() );"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/8aef0bd220847520f7b8be22afec256817a0ba55",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/0374622f00594bdb303add3e72e5bbdb5c3334d7",
        "message": "o fixed a NPE in toString() method (this error popped up while running with logging enabled)\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1039474 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_58",
        "file": [
            {
                "sha": "56e7d95e09a0dadf83b95e51d98293da59c296ae",
                "filename": "kerberos-codec/src/main/java/org/apache/directory/shared/kerberos/messages/KrbError.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/8aef0bd220847520f7b8be22afec256817a0ba55/kerberos-codec/src/main/java/org/apache/directory/shared/kerberos/messages/KrbError.java",
                "raw_url": "https://github.com/apache/directory-server/raw/8aef0bd220847520f7b8be22afec256817a0ba55/kerberos-codec/src/main/java/org/apache/directory/shared/kerberos/messages/KrbError.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/kerberos-codec/src/main/java/org/apache/directory/shared/kerberos/messages/KrbError.java?ref=8aef0bd220847520f7b8be22afec256817a0ba55",
                "patch": "@@ -685,7 +685,7 @@ public String toString()\n             sb.append( \"    cTime: \" ).append( cTime ).append( '\\n' );\n         }\n \n-        if ( cusec > 0 )\n+        if ( cusec != null )\n         {\n             sb.append( \"    cusec: \" ).append( cusec ).append( '\\n' );\n         }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/b8582178614e3ee4981cbd8c8bc633ff5df40d49",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/8ccf8e83e02540637e5d876937f552826bf28b9d",
        "message": "o fixed a possible NPE while performing unboxing of cusec value\no added more tests\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1036938 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_59",
        "file": [
            {
                "sha": "5b02c7f0fca4bb26fcb3b757c1ca6dadcbfe039b",
                "filename": "kerberos-codec/src/main/java/org/apache/directory/shared/kerberos/messages/KrbError.java",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/directory-server/blob/b8582178614e3ee4981cbd8c8bc633ff5df40d49/kerberos-codec/src/main/java/org/apache/directory/shared/kerberos/messages/KrbError.java",
                "raw_url": "https://github.com/apache/directory-server/raw/b8582178614e3ee4981cbd8c8bc633ff5df40d49/kerberos-codec/src/main/java/org/apache/directory/shared/kerberos/messages/KrbError.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/kerberos-codec/src/main/java/org/apache/directory/shared/kerberos/messages/KrbError.java?ref=b8582178614e3ee4981cbd8c8bc633ff5df40d49",
                "patch": "@@ -154,6 +154,11 @@ public void setcTime( KerberosTime cTime )\n      */\n     public int getCusec()\n     {\n+        if ( cusec == null )\n+        {\n+            return 0;\n+        }\n+        \n         return cusec;\n     }\n "
            },
            {
                "sha": "5cbf45e130d3d704de374ee0142be51bcd0795c8",
                "filename": "kerberos-codec/src/test/java/org/apache/directory/shared/kerberos/codec/KrbErrorDecoderTest.java",
                "status": "modified",
                "additions": 281,
                "deletions": 2,
                "changes": 283,
                "blob_url": "https://github.com/apache/directory-server/blob/b8582178614e3ee4981cbd8c8bc633ff5df40d49/kerberos-codec/src/test/java/org/apache/directory/shared/kerberos/codec/KrbErrorDecoderTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/b8582178614e3ee4981cbd8c8bc633ff5df40d49/kerberos-codec/src/test/java/org/apache/directory/shared/kerberos/codec/KrbErrorDecoderTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/kerberos-codec/src/test/java/org/apache/directory/shared/kerberos/codec/KrbErrorDecoderTest.java?ref=b8582178614e3ee4981cbd8c8bc633ff5df40d49",
                "patch": "@@ -20,15 +20,19 @@\n \n package org.apache.directory.shared.kerberos.codec;\n \n-import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.*;\n+import static org.junit.Assert.assertTrue;\n import static org.junit.Assert.fail;\n \n import java.nio.ByteBuffer;\n+import java.util.Arrays;\n \n import org.apache.directory.shared.asn1.ber.Asn1Decoder;\n import org.apache.directory.shared.asn1.codec.DecoderException;\n import org.apache.directory.shared.asn1.codec.EncoderException;\n+import org.apache.directory.shared.kerberos.KerberosMessageType;\n import org.apache.directory.shared.kerberos.codec.krbError.KrbErrorContainer;\n+import org.apache.directory.shared.kerberos.exceptions.ErrorType;\n import org.apache.directory.shared.kerberos.messages.KrbError;\n import org.apache.directory.shared.ldap.util.StringTools;\n import org.junit.Test;\n@@ -102,12 +106,200 @@ public void testDecodeKrbError()\n         }\n         catch( DecoderException e )\n         {\n-            e.printStackTrace();\n             fail();\n         }\n         \n         KrbError krbError = container.getKrbError();\n         \n+        String time = \"20101119080043Z\";\n+        assertEquals( 5, krbError.getProtocolVersionNumber() );\n+        assertEquals( KerberosMessageType.KRB_ERROR, krbError.getMessageType() );\n+        assertEquals( time, krbError.getcTime().getDate() );\n+        assertEquals( 1, krbError.getCusec() );\n+        assertEquals( time, krbError.getsTime().getDate() );\n+        assertEquals( 2, krbError.getSusec() );\n+        assertEquals( ErrorType.KDC_ERR_NONE, krbError.getErrorCode() );\n+        assertEquals( \"crealm\", krbError.getcRealm() );\n+        assertEquals( \"cname\", krbError.getcName().getNameString() );\n+        assertEquals( \"realm\", krbError.getRealm() );\n+        assertEquals( \"sname\", krbError.getsName().getNameString() );\n+        assertEquals( \"etext\", krbError.geteText() );\n+        assertTrue( Arrays.equals( new byte[]{0,1}, krbError.geteData() ) );\n+        \n+        int encodedLen = krbError.computeLength();\n+        \n+        assertEquals( streamLen, encodedLen );\n+        \n+        ByteBuffer buffer = ByteBuffer.allocate( streamLen );\n+        try\n+        {\n+            buffer = krbError.encode( buffer );\n+            \n+            assertEquals( decoded, StringTools.dumpBytes( buffer.array() ) );\n+        }\n+        catch( EncoderException e )\n+        {\n+            fail();\n+        }\n+    }\n+    \n+    \n+    @Test\n+    public void testDecodeKrbErrorWithoutCtime()\n+    {\n+        Asn1Decoder decoder = new Asn1Decoder();\n+        \n+        int streamLen = 0x7A;\n+        ByteBuffer stream = ByteBuffer.allocate( streamLen );\n+        stream.put( new byte[]\n+        {\n+                0x7E, (byte)0x78,\n+                  0x30, (byte)0x76,\n+                    (byte)0xA0, 0x03,           // pvno\n+                      0x02, 0x01, 0x05,    \n+                    (byte)0xA1, 0x03,           // msg-type\n+                      0x02, 0x01, 0x1E,\n+                      //\n+                      // NO ctime\n+                      //\n+                    (byte)0xA3, 0x03,           // cusec\n+                      0x02, 0x01, 0x01,\n+                    (byte)0xA4, 0x11,           // stime\n+                      0x18, 0xF, '2', '0', '1', '0', '1', '1', '1', '9', '0', '8', '0', '0', '4', '3', 'Z',\n+                    (byte)0xA5, 0x03,           // susec\n+                      0x02, 0x01, 0x02,\n+                    (byte)0xA6, 0x03,           // error-code\n+                      0x02, 0x01, 0x00,\n+                    (byte)0xA7, 0x08,            // crealm\n+                      0x1B, 0x06, 'c', 'r', 'e', 'a', 'l', 'm',\n+                    (byte)0xA8, 0x12,           // cname\n+                      0x30, 0x10, \n+                        (byte)0xA0, 0x03,\n+                          0x02, 0x01, 0x00, \n+                        (byte)0xA1, 0x09, \n+                          0x30, 0x07, \n+                            0x1B, 0x05, 'c', 'n', 'a', 'm', 'e',\n+                    (byte)0xA9, 0x07,           // realm\n+                      0x1B, 0x05, 'r', 'e', 'a', 'l', 'm',\n+                    (byte)0xAA, 0x12,           // sname\n+                      0x30, 0x10, \n+                        (byte)0xA0, 0x03,\n+                          0x02, 0x01, 0x00, \n+                        (byte)0xA1, 0x09, \n+                          0x30, 0x07, \n+                            0x1B, 0x05, 's', 'n', 'a', 'm', 'e',\n+                    (byte)0xAB, 0x07,           // e-text\n+                      0x1B, 0x5, 'e', 't', 'e', 'x', 't',\n+                    (byte)0xAC, 0x04,           // e-data\n+                      0x04, 0x02, \n+                        0x00, 0x01\n+        } );\n+        \n+        String decoded = StringTools.dumpBytes( stream.array() );\n+        stream.flip();\n+        \n+        KrbErrorContainer container = new KrbErrorContainer();\n+        container.setStream( stream );\n+        \n+        try\n+        {\n+            decoder.decode( stream, container );\n+        }\n+        catch( DecoderException e )\n+        {\n+            fail();\n+        }\n+        \n+        KrbError krbError = container.getKrbError();\n+        \n+        assertNull( krbError.getcTime() );\n+        \n+        int encodedLen = krbError.computeLength();\n+        \n+        assertEquals( streamLen, encodedLen );\n+        \n+        ByteBuffer buffer = ByteBuffer.allocate( streamLen );\n+        try\n+        {\n+            buffer = krbError.encode( buffer );\n+            \n+            assertEquals( decoded, StringTools.dumpBytes( buffer.array() ) );\n+        }\n+        catch( EncoderException e )\n+        {\n+            fail();\n+        }\n+    }\n+\n+    \n+    @Test\n+    public void testDecodeKrbErrorWithoutCusec()\n+    {\n+        Asn1Decoder decoder = new Asn1Decoder();\n+        \n+        int streamLen = 0x8A;\n+        ByteBuffer stream = ByteBuffer.allocate( streamLen );\n+        stream.put( new byte[]\n+        {\n+                0x7E, (byte)0x81, (byte)0x87,\n+                  0x30, (byte)0x81, (byte)0x84,\n+                    (byte)0xA0, 0x03,           // pvno\n+                      0x02, 0x01, 0x05,    \n+                    (byte)0xA1, 0x03,           // msg-type\n+                      0x02, 0x01, 0x1E,   \n+                    (byte)0xA2, 0x11,           // ctime\n+                      0x18, 0xF, '2', '0', '1', '0', '1', '1', '1', '9', '0', '8', '0', '0', '4', '3', 'Z',\n+                      // NO cuses\n+                    (byte)0xA4, 0x11,           // stime\n+                      0x18, 0xF, '2', '0', '1', '0', '1', '1', '1', '9', '0', '8', '0', '0', '4', '3', 'Z',\n+                    (byte)0xA5, 0x03,           // susec\n+                      0x02, 0x01, 0x02,\n+                    (byte)0xA6, 0x03,           // error-code\n+                      0x02, 0x01, 0x00,\n+                    (byte)0xA7, 0x08,            // crealm\n+                      0x1B, 0x06, 'c', 'r', 'e', 'a', 'l', 'm',\n+                    (byte)0xA8, 0x12,           // cname\n+                      0x30, 0x10, \n+                        (byte)0xA0, 0x03,\n+                          0x02, 0x01, 0x00, \n+                        (byte)0xA1, 0x09, \n+                          0x30, 0x07, \n+                            0x1B, 0x05, 'c', 'n', 'a', 'm', 'e',\n+                    (byte)0xA9, 0x07,           // realm\n+                      0x1B, 0x05, 'r', 'e', 'a', 'l', 'm',\n+                    (byte)0xAA, 0x12,           // sname\n+                      0x30, 0x10, \n+                        (byte)0xA0, 0x03,\n+                          0x02, 0x01, 0x00, \n+                        (byte)0xA1, 0x09, \n+                          0x30, 0x07, \n+                            0x1B, 0x05, 's', 'n', 'a', 'm', 'e',\n+                    (byte)0xAB, 0x07,           // e-text\n+                      0x1B, 0x5, 'e', 't', 'e', 'x', 't',\n+                    (byte)0xAC, 0x04,           // e-data\n+                      0x04, 0x02, \n+                        0x00, 0x01\n+        } );\n+        \n+        String decoded = StringTools.dumpBytes( stream.array() );\n+        stream.flip();\n+        \n+        KrbErrorContainer container = new KrbErrorContainer();\n+        container.setStream( stream );\n+        \n+        try\n+        {\n+            decoder.decode( stream, container );\n+        }\n+        catch( DecoderException e )\n+        {\n+            fail();\n+        }\n+        \n+        KrbError krbError = container.getKrbError();\n+        \n+        assertEquals( 0, krbError.getCusec() );\n+        \n         int encodedLen = krbError.computeLength();\n         \n         assertEquals( streamLen, encodedLen );\n@@ -124,4 +316,91 @@ public void testDecodeKrbError()\n             fail();\n         }\n     }\n+\n+    @Test\n+    public void testDecodeKrbErrorWithoutCtimeAndCusec()\n+    {\n+        Asn1Decoder decoder = new Asn1Decoder();\n+        \n+        int streamLen = 0x75;\n+        ByteBuffer stream = ByteBuffer.allocate( streamLen );\n+        stream.put( new byte[]\n+        {\n+                0x7E, (byte)0x73,\n+                  0x30, (byte)0x71,\n+                    (byte)0xA0, 0x03,           // pvno\n+                      0x02, 0x01, 0x05,    \n+                    (byte)0xA1, 0x03,           // msg-type\n+                      0x02, 0x01, 0x1E,\n+                      //\n+                      // NO ctime, cusec\n+                      //\n+                    (byte)0xA4, 0x11,           // stime\n+                      0x18, 0xF, '2', '0', '1', '0', '1', '1', '1', '9', '0', '8', '0', '0', '4', '3', 'Z',\n+                    (byte)0xA5, 0x03,           // susec\n+                      0x02, 0x01, 0x02,\n+                    (byte)0xA6, 0x03,           // error-code\n+                      0x02, 0x01, 0x00,\n+                    (byte)0xA7, 0x08,            // crealm\n+                      0x1B, 0x06, 'c', 'r', 'e', 'a', 'l', 'm',\n+                    (byte)0xA8, 0x12,           // cname\n+                      0x30, 0x10, \n+                        (byte)0xA0, 0x03,\n+                          0x02, 0x01, 0x00, \n+                        (byte)0xA1, 0x09, \n+                          0x30, 0x07, \n+                            0x1B, 0x05, 'c', 'n', 'a', 'm', 'e',\n+                    (byte)0xA9, 0x07,           // realm\n+                      0x1B, 0x05, 'r', 'e', 'a', 'l', 'm',\n+                    (byte)0xAA, 0x12,           // sname\n+                      0x30, 0x10, \n+                        (byte)0xA0, 0x03,\n+                          0x02, 0x01, 0x00, \n+                        (byte)0xA1, 0x09, \n+                          0x30, 0x07, \n+                            0x1B, 0x05, 's', 'n', 'a', 'm', 'e',\n+                    (byte)0xAB, 0x07,           // e-text\n+                      0x1B, 0x5, 'e', 't', 'e', 'x', 't',\n+                    (byte)0xAC, 0x04,           // e-data\n+                      0x04, 0x02, \n+                        0x00, 0x01\n+        } );\n+        \n+        String decoded = StringTools.dumpBytes( stream.array() );\n+        stream.flip();\n+        \n+        KrbErrorContainer container = new KrbErrorContainer();\n+        container.setStream( stream );\n+        \n+        try\n+        {\n+            decoder.decode( stream, container );\n+        }\n+        catch( DecoderException e )\n+        {\n+            fail();\n+        }\n+        \n+        KrbError krbError = container.getKrbError();\n+        \n+        assertNull( krbError.getcTime() );\n+        assertEquals( 0, krbError.getCusec() );\n+        \n+        int encodedLen = krbError.computeLength();\n+        \n+        assertEquals( streamLen, encodedLen );\n+        \n+        ByteBuffer buffer = ByteBuffer.allocate( streamLen );\n+        try\n+        {\n+            buffer = krbError.encode( buffer );\n+            \n+            assertEquals( decoded, StringTools.dumpBytes( buffer.array() ) );\n+        }\n+        catch( EncoderException e )\n+        {\n+            fail();\n+        }\n+    }\n+\n }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/9c26fbefd7fe2883e4373610237c22f6a9670a1d",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/c43aee522e25b944e813e8af8a3ecb5af12df5b2",
        "message": "o fixing some more placess where a NPE *might* be possible\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1006315 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_60",
        "file": [
            {
                "sha": "f813567d29a97b0c121a153c4506cd303141da98",
                "filename": "core/src/main/java/org/apache/directory/server/core/authz/GroupCache.java",
                "status": "modified",
                "additions": 7,
                "deletions": 5,
                "changes": 12,
                "blob_url": "https://github.com/apache/directory-server/blob/9c26fbefd7fe2883e4373610237c22f6a9670a1d/core/src/main/java/org/apache/directory/server/core/authz/GroupCache.java",
                "raw_url": "https://github.com/apache/directory-server/raw/9c26fbefd7fe2883e4373610237c22f6a9670a1d/core/src/main/java/org/apache/directory/server/core/authz/GroupCache.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/authz/GroupCache.java?ref=9c26fbefd7fe2883e4373610237c22f6a9670a1d",
                "patch": "@@ -423,10 +423,11 @@ public void groupModified( DN name, List<Modification> mods, Entry entry, Schema\n         {\n             if ( memberAttrId.equalsIgnoreCase( modification.getAttribute().getId() ) )\n             {\n-                Set<String> memberSet = ( Set<String> ) ehCache.get( name.getNormName() ).getValue();\n-\n-                if ( memberSet != null )\n+                Element memSetElement = ehCache.get( name.getNormName() );\n+                \n+                if ( memSetElement != null )\n                 {\n+                    Set<String> memberSet = ( Set<String> ) memSetElement.getValue();\n                     modify( memberSet, modification.getOperation(), modification.getAttribute() );\n                 }\n \n@@ -459,10 +460,11 @@ public void groupModified( DN name, ModificationOperation modOp, Entry mods ) th\n             return;\n         }\n \n-        Set<String> memberSet = ( Set<String> ) ehCache.get( name.getNormName() ).getValue();\n+        Element memSetElement = ehCache.get( name.getNormName() );\n \n-        if ( memberSet != null )\n+        if ( memSetElement != null )\n         {\n+            Set<String> memberSet = ( Set<String> ) memSetElement.getValue();\n             modify( memberSet, modOp, members );\n         }\n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/d7053de61a2c5aa0b0113c1977f15abac97b91a3",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/8be3d1b6a08320fda3a9fa7e83a692c09404dc4f",
        "message": "o fixed a NPE which will arise when replication is not enabled\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@996346 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_61",
        "file": [
            {
                "sha": "b1c3acf49f36439123c6986411c4670eb9da946c",
                "filename": "core/src/main/java/org/apache/directory/server/core/partition/DefaultPartitionNexus.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/directory-server/blob/d7053de61a2c5aa0b0113c1977f15abac97b91a3/core/src/main/java/org/apache/directory/server/core/partition/DefaultPartitionNexus.java",
                "raw_url": "https://github.com/apache/directory-server/raw/d7053de61a2c5aa0b0113c1977f15abac97b91a3/core/src/main/java/org/apache/directory/server/core/partition/DefaultPartitionNexus.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/partition/DefaultPartitionNexus.java?ref=d7053de61a2c5aa0b0113c1977f15abac97b91a3",
                "patch": "@@ -153,7 +153,7 @@\n \n     final List<Modification> mods = new ArrayList<Modification>( 2 );\n \n-    private String lastSyncedCtxCsn = \"\";\n+    private String lastSyncedCtxCsn = null;\n \n \n     /**\n@@ -445,7 +445,7 @@ public void sync() throws Exception\n         try\n         {\n             // update only if the CSN changes\n-            if ( !lastSyncedCtxCsn.equals( directoryService.getContextCsn() ) )\n+            if ( ( lastSyncedCtxCsn != null ) && !lastSyncedCtxCsn.equals( directoryService.getContextCsn() ) )\n             {\n                 lastSyncedCtxCsn = directoryService.getContextCsn();\n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/b180cfd4d7e682cff9bc51449a55f1c4a0d6def0",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/c176191f8befd488eab402ec0aa83a732a0bd003",
        "message": "o removed static initialization to avoid NPE while running in eclipse\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@965570 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_62",
        "file": [
            {
                "sha": "ced2624d719e64671e0735b9204c7c1a29bd8d91",
                "filename": "ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/ClientSearchRequestTest.java",
                "status": "modified",
                "additions": 7,
                "deletions": 7,
                "changes": 14,
                "blob_url": "https://github.com/apache/directory-server/blob/b180cfd4d7e682cff9bc51449a55f1c4a0d6def0/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/ClientSearchRequestTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/b180cfd4d7e682cff9bc51449a55f1c4a0d6def0/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/ClientSearchRequestTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/ClientSearchRequestTest.java?ref=b180cfd4d7e682cff9bc51449a55f1c4a0d6def0",
                "patch": "@@ -46,8 +46,8 @@\n import org.apache.directory.shared.ldap.message.AliasDerefMode;\n import org.apache.directory.shared.ldap.message.ResultCodeEnum;\n import org.apache.directory.shared.ldap.name.DN;\n-import org.junit.AfterClass;\n-import org.junit.BeforeClass;\n+import org.junit.After;\n+import org.junit.Before;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n \n@@ -81,10 +81,10 @@\n })\n public class ClientSearchRequestTest extends AbstractLdapTestUnit\n {\n-    private static LdapAsyncConnection connection;\n+    private LdapAsyncConnection connection;\n \n-    @BeforeClass\n-    public static void setup() throws Exception\n+    @Before\n+    public void setup() throws Exception\n     {\n         connection = new LdapNetworkConnection( \"localhost\", ldapServer.getPort() );\n         DN bindDn = new DN( \"uid=admin,ou=system\" );\n@@ -95,8 +95,8 @@ public static void setup() throws Exception\n     /**\n      * Close the LdapConnection\n      */\n-    @AfterClass\n-    public static void shutdown()\n+    @After\n+    public void shutdown()\n     {\n         try\n         {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/a2cd0c6c191f3cdd7d48412526d0431ecb6cc861",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/9ae7c1deb8e6b306b411d0650bc58cc5d7c51c08",
        "message": "Fixed DIRAPI-17 : the Substring filter was not containing the Attribute, leading to a NPE when encoding it.\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@955090 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_63",
        "file": [
            {
                "sha": "2f3f6a5cf7b92f3142027bea38655e9eeed9850b",
                "filename": "ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/ClientSearchRequestTest.java",
                "status": "modified",
                "additions": 27,
                "deletions": 0,
                "changes": 27,
                "blob_url": "https://github.com/apache/directory-server/blob/a2cd0c6c191f3cdd7d48412526d0431ecb6cc861/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/ClientSearchRequestTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/a2cd0c6c191f3cdd7d48412526d0431ecb6cc861/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/ClientSearchRequestTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/ClientSearchRequestTest.java?ref=a2cd0c6c191f3cdd7d48412526d0431ecb6cc861",
                "patch": "@@ -165,6 +165,33 @@ public void testAsyncSearch() throws Exception\n     }\n \n     \n+    /**\n+     * Test a search with a Substring filter\n+     * @throws Exception\n+     */\n+    @Test\n+    public void testSearchPersonSubstring() throws Exception\n+    {\n+        SearchFuture searchFuture = connection.searchAsync( \"ou=system\", \"(objectclass=*ers*)\", SearchScope.SUBTREE, \"*\",\n+            \"+\" );\n+        int count = 0;\n+        SearchResponse searchResponse = null;\n+        do\n+        {\n+            searchResponse = ( SearchResponse ) searchFuture.get( 100000, TimeUnit.MILLISECONDS );\n+            assertNotNull( searchResponse );\n+            \n+            if ( !( searchResponse instanceof SearchResultDone ) )\n+            {\n+                count++;\n+            }\n+        }\n+        while ( !( searchResponse instanceof SearchResultDone ) );\n+\n+        assertEquals(2, count );\n+    }\n+\n+    \n     @Test\n     public void testSearchWithDerefAlias() throws Exception\n     {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/662f2b2f9e99c377c7757150819e2e32cbaef61a",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/e5dd219caae2d0a1f343cdb43ede2e3cb2b085a4",
        "message": "fixed a NPE which can happen if the suite is not null and no suite level LdapServer was defined\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@919399 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_64",
        "file": [
            {
                "sha": "7371d441061370c79565a904c2700210644bc600",
                "filename": "test-framework/src/main/java/org/apache/directory/server/core/integ/FrameworkRunner.java",
                "status": "modified",
                "additions": 6,
                "deletions": 3,
                "changes": 9,
                "blob_url": "https://github.com/apache/directory-server/blob/662f2b2f9e99c377c7757150819e2e32cbaef61a/test-framework/src/main/java/org/apache/directory/server/core/integ/FrameworkRunner.java",
                "raw_url": "https://github.com/apache/directory-server/raw/662f2b2f9e99c377c7757150819e2e32cbaef61a/test-framework/src/main/java/org/apache/directory/server/core/integ/FrameworkRunner.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/test-framework/src/main/java/org/apache/directory/server/core/integ/FrameworkRunner.java?ref=662f2b2f9e99c377c7757150819e2e32cbaef61a",
                "patch": "@@ -188,11 +188,14 @@ public void run( final RunNotifier notifier )\n                 {\n                     LdapServer suiteServer = suite.getLdapServer();\n \n-                    for ( Transport transport : suiteServer.getTransports() )\n+                    if ( suiteServer != null )\n                     {\n-                        if ( minPort <= transport.getPort() )\n+                        for ( Transport transport : suiteServer.getTransports() )\n                         {\n-                            minPort = transport.getPort();\n+                            if ( minPort <= transport.getPort() )\n+                            {\n+                                minPort = transport.getPort();\n+                            }\n                         }\n                     }\n                 }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/4a859c9a6f7a4ae5c7b37538364d3859d2f52349",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/83426e35e438acff494c3d6c655958ee5dcdbb43",
        "message": "Many fixes :\no potential NPE\no unused imports removal\no useless @SuppressWarnings removal\no unused variable removal\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/apacheds-schema@896304 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_65",
        "file": [
            {
                "sha": "3e3dcff4910bb17dccb9f8a338f0e6f585e82ab3",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/interceptor/context/AbstractChangeOperationContext.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/directory-server/blob/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/core-api/src/main/java/org/apache/directory/server/core/interceptor/context/AbstractChangeOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/core-api/src/main/java/org/apache/directory/server/core/interceptor/context/AbstractChangeOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/interceptor/context/AbstractChangeOperationContext.java?ref=4a859c9a6f7a4ae5c7b37538364d3859d2f52349",
                "patch": "@@ -21,8 +21,8 @@\n \n \n import org.apache.directory.server.core.CoreSession;\n-import org.apache.directory.server.core.changelog.LogChange;\n import org.apache.directory.server.core.changelog.ChangeLogEvent;\n+import org.apache.directory.server.core.changelog.LogChange;\n import org.apache.directory.shared.ldap.name.LdapDN;\n \n \n@@ -81,6 +81,6 @@ public void setLogChange( LogChange logChange )\n      */\n     public boolean isLogChange()\n     {\n-        return logChange != logChange.FALSE;\n+        return logChange != LogChange.FALSE;\n     }\n }"
            },
            {
                "sha": "85d418e224b2d3a4a013d2873fc846d727d6ca7f",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/schema/SchemaPartitionDaoImpl.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/core-api/src/main/java/org/apache/directory/server/core/schema/SchemaPartitionDaoImpl.java",
                "raw_url": "https://github.com/apache/directory-server/raw/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/core-api/src/main/java/org/apache/directory/server/core/schema/SchemaPartitionDaoImpl.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/schema/SchemaPartitionDaoImpl.java?ref=4a859c9a6f7a4ae5c7b37538364d3859d2f52349",
                "patch": "@@ -650,7 +650,7 @@ public void enableSchema( String schemaName ) throws Exception\n \n         List<String> names = mr.getNames();\n         \n-        if ( ( names != null ) || ( names.size() > 0 ) )\n+        if ( ( names != null ) && ( names.size() > 0 ) )\n         {\n             for ( String name : names )\n             {"
            },
            {
                "sha": "afa0eba8d26858d7eb61ebdbbe5f0e4ed093520e",
                "filename": "core/src/main/java/org/apache/directory/server/core/configuration/AttributesPropertyEditor.java",
                "status": "modified",
                "additions": 9,
                "deletions": 9,
                "changes": 18,
                "blob_url": "https://github.com/apache/directory-server/blob/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/core/src/main/java/org/apache/directory/server/core/configuration/AttributesPropertyEditor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/core/src/main/java/org/apache/directory/server/core/configuration/AttributesPropertyEditor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/configuration/AttributesPropertyEditor.java?ref=4a859c9a6f7a4ae5c7b37538364d3859d2f52349",
                "patch": "@@ -19,6 +19,15 @@\n  */\n package org.apache.directory.server.core.configuration;\n \n+import java.beans.PropertyEditor;\n+import java.beans.PropertyEditorSupport;\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.StringReader;\n+\n+import javax.naming.NamingException;\n+import javax.naming.directory.Attributes;\n+\n import org.apache.directory.server.core.DirectoryService;\n import org.apache.directory.shared.ldap.entry.Entry;\n import org.apache.directory.shared.ldap.entry.EntryAttribute;\n@@ -28,14 +37,6 @@\n import org.apache.directory.shared.ldap.util.AttributeUtils;\n import org.apache.directory.shared.ldap.util.StringTools;\n \n-import javax.naming.NamingException;\n-import javax.naming.directory.Attributes;\n-import java.beans.PropertyEditor;\n-import java.beans.PropertyEditorSupport;\n-import java.io.BufferedReader;\n-import java.io.IOException;\n-import java.io.StringReader;\n-\n \n /**\n  * A JavaBeans {@link PropertyEditor} that can convert {@link Attributes} to\n@@ -68,7 +69,6 @@ public AttributesPropertyEditor( Object source )\n     /**\n      * Returns LDIF string of {@link Attributes} object.\n      */\n-    @SuppressWarnings(\"deprecation\")\n     public String getAsText()\n     {\n         Attributes attrs = (Attributes) getValue();"
            },
            {
                "sha": "6d8e778041748b5b0457589a48175bc2f96df7fe",
                "filename": "core/src/main/java/org/apache/directory/server/core/subtree/RefinementLeafEvaluator.java",
                "status": "modified",
                "additions": 4,
                "deletions": 6,
                "changes": 10,
                "blob_url": "https://github.com/apache/directory-server/blob/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/core/src/main/java/org/apache/directory/server/core/subtree/RefinementLeafEvaluator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/core/src/main/java/org/apache/directory/server/core/subtree/RefinementLeafEvaluator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/subtree/RefinementLeafEvaluator.java?ref=4a859c9a6f7a4ae5c7b37538364d3859d2f52349",
                "patch": "@@ -20,18 +20,16 @@\n package org.apache.directory.server.core.subtree;\n \n \n+import java.util.Iterator;\n+\n+import javax.naming.NamingException;\n+\n import org.apache.directory.server.core.entry.ServerAttribute;\n import org.apache.directory.shared.ldap.constants.SchemaConstants;\n import org.apache.directory.shared.ldap.entry.EntryAttribute;\n-import org.apache.directory.shared.ldap.entry.client.ClientBinaryValue;\n-import org.apache.directory.shared.ldap.entry.client.ClientStringValue;\n import org.apache.directory.shared.ldap.filter.EqualityNode;\n import org.apache.directory.shared.ldap.filter.SimpleNode;\n import org.apache.directory.shared.ldap.schema.registries.OidRegistry;\n-import org.apache.directory.shared.ldap.util.StringTools;\n-\n-import javax.naming.NamingException;\n-import java.util.Iterator;\n \n \n /**"
            },
            {
                "sha": "0566f3ed2ef7801a94d1360a49ff37d1a797af87",
                "filename": "kerberos-shared/src/main/java/org/apache/directory/server/kerberos/shared/messages/components/Ticket.java",
                "status": "modified",
                "additions": 0,
                "deletions": 6,
                "changes": 6,
                "blob_url": "https://github.com/apache/directory-server/blob/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/kerberos-shared/src/main/java/org/apache/directory/server/kerberos/shared/messages/components/Ticket.java",
                "raw_url": "https://github.com/apache/directory-server/raw/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/kerberos-shared/src/main/java/org/apache/directory/server/kerberos/shared/messages/components/Ticket.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/kerberos-shared/src/main/java/org/apache/directory/server/kerberos/shared/messages/components/Ticket.java?ref=4a859c9a6f7a4ae5c7b37538364d3859d2f52349",
                "patch": "@@ -29,14 +29,8 @@\n import org.apache.directory.server.kerberos.shared.KerberosConstants;\n import org.apache.directory.server.kerberos.shared.KerberosUtils;\n import org.apache.directory.server.kerberos.shared.exceptions.ErrorType;\n-import org.apache.directory.server.kerberos.shared.messages.value.AuthorizationData;\n import org.apache.directory.server.kerberos.shared.messages.value.EncryptedData;\n-import org.apache.directory.server.kerberos.shared.messages.value.EncryptionKey;\n-import org.apache.directory.server.kerberos.shared.messages.value.HostAddresses;\n-import org.apache.directory.server.kerberos.shared.messages.value.KerberosTime;\n import org.apache.directory.server.kerberos.shared.messages.value.PrincipalName;\n-import org.apache.directory.server.kerberos.shared.messages.value.TransitedEncoding;\n-import org.apache.directory.server.kerberos.shared.messages.value.flags.TicketFlags;\n import org.apache.directory.shared.asn1.AbstractAsn1Object;\n import org.apache.directory.shared.asn1.ber.tlv.TLV;\n import org.apache.directory.shared.asn1.ber.tlv.UniversalTag;"
            },
            {
                "sha": "51c80dddbca02ab678ba9047caa1ef3bf0366a72",
                "filename": "ldap-api-test/src/test/java/org/apache/directory/shared/client/api/operations/ClientAddRequestTest.java",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/apache/directory-server/blob/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/ldap-api-test/src/test/java/org/apache/directory/shared/client/api/operations/ClientAddRequestTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/ldap-api-test/src/test/java/org/apache/directory/shared/client/api/operations/ClientAddRequestTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/ldap-api-test/src/test/java/org/apache/directory/shared/client/api/operations/ClientAddRequestTest.java?ref=4a859c9a6f7a4ae5c7b37538364d3859d2f52349",
                "patch": "@@ -32,7 +32,6 @@\n import org.apache.directory.server.core.CoreSession;\n import org.apache.directory.server.core.integ.AbstractLdapTestUnit;\n import org.apache.directory.server.core.integ.FrameworkRunner;\n-import org.apache.directory.server.ldap.LdapServer;\n import org.apache.directory.shared.ldap.client.api.LdapConnection;\n import org.apache.directory.shared.ldap.client.api.exception.LdapException;\n import org.apache.directory.shared.ldap.client.api.listeners.AddListener;"
            },
            {
                "sha": "7e6d78071521b4de0c2080457757f68dc4eba707",
                "filename": "server-tools/src/main/java/org/apache/directory/server/tools/IndexCommand.java",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/apache/directory-server/blob/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/server-tools/src/main/java/org/apache/directory/server/tools/IndexCommand.java",
                "raw_url": "https://github.com/apache/directory-server/raw/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/server-tools/src/main/java/org/apache/directory/server/tools/IndexCommand.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-tools/src/main/java/org/apache/directory/server/tools/IndexCommand.java?ref=4a859c9a6f7a4ae5c7b37538364d3859d2f52349",
                "patch": "@@ -62,7 +62,6 @@ public IndexCommand()\n     }\n \n \n-    @SuppressWarnings(\"unchecked\")\n     private SchemaManager loadSchemaManager() throws Exception\n     {\n         // --------------------------------------------------------------------\n@@ -89,7 +88,7 @@ public void execute( CommandLine cmdline ) throws Exception\n         \n         for ( int ii = 0; ii < partitions.length; ii++ )\n         {\n-            File partitionDirectory = partitionDirectory = new File( getInstanceLayout().getPartitionsDir(), partitions[ii] );\n+            File partitionDirectory = new File( getInstanceLayout().getPartitionsDir(), partitions[ii] );\n             File indexDir = null;\n             \n             if( indexDirPath != null )"
            },
            {
                "sha": "a34c97c13e1125d218676c548d5c70b150f8d68f",
                "filename": "xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/LessEqCursor.java",
                "status": "modified",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/apache/directory-server/blob/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/LessEqCursor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/LessEqCursor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/LessEqCursor.java?ref=4a859c9a6f7a4ae5c7b37538364d3859d2f52349",
                "patch": "@@ -135,7 +135,6 @@ else if ( compareValue == 0 )\n     }\n \n \n-    @SuppressWarnings(\"unchecked\")\n     public void before( IndexEntry<V, ServerEntry> element ) throws Exception\n     {\n         checkNotClosed( \"before()\" );\n@@ -180,7 +179,6 @@ else if ( compareValue == 0 )\n     }\n \n \n-    @SuppressWarnings(\"unchecked\")\n     public void afterValue( Long id, V value ) throws Exception\n     {\n         checkNotClosed( \"afterValue()\" );\n@@ -217,7 +215,6 @@ public void afterValue( Long id, V value ) throws Exception\n     }\n \n \n-    @SuppressWarnings(\"unchecked\")\n     public void after( IndexEntry<V, ServerEntry> element ) throws Exception\n     {\n         checkNotClosed( \"after()\" );\n@@ -337,7 +334,6 @@ public boolean previous() throws Exception\n     }\n \n \n-    @SuppressWarnings(\"unchecked\")\n     public boolean next() throws Exception\n     {\n         checkNotClosed( \"next()\" );"
            },
            {
                "sha": "f7d14a93810cc77980d04bebaee67de54a35975d",
                "filename": "xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/SubstringEvaluator.java",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/apache/directory-server/blob/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/SubstringEvaluator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/SubstringEvaluator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/SubstringEvaluator.java?ref=4a859c9a6f7a4ae5c7b37538364d3859d2f52349",
                "patch": "@@ -199,7 +199,6 @@ private boolean evaluateWithIndex( IndexEntry<?,ServerEntry> indexEntry ) throws\n     }\n \n \n-    @SuppressWarnings( { \"UnusedDeclaration\" } )\n     private boolean evaluateWithIndex( ServerEntry entry ) throws Exception\n     {\n         throw new UnsupportedOperationException( \"This is too inefficient without getId() on ServerEntry\" );"
            },
            {
                "sha": "78251b4ac1f82bf1fed700c994747cd49bb424f0",
                "filename": "xdbm-search/src/test/java/org/apache/directory/server/xdbm/search/impl/OrCursorTest.java",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/apache/directory-server/blob/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/xdbm-search/src/test/java/org/apache/directory/server/xdbm/search/impl/OrCursorTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/4a859c9a6f7a4ae5c7b37538364d3859d2f52349/xdbm-search/src/test/java/org/apache/directory/server/xdbm/search/impl/OrCursorTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/xdbm-search/src/test/java/org/apache/directory/server/xdbm/search/impl/OrCursorTest.java?ref=4a859c9a6f7a4ae5c7b37538364d3859d2f52349",
                "patch": "@@ -162,7 +162,6 @@ public void destryStore() throws Exception\n \n     \n     @Test\n-    @SuppressWarnings( \"unchecked\" )\n     public void testOrCursorUsingCursorBuilder() throws Exception\n     {\n         String filter = \"(|(cn=J*)(sn=W*))\";"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/1f8f48f77c6512b411ff6b022ec4c8a970f7745b",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/f67289687e17bf064f2a01b6a7b7c1d94528169c",
        "message": "Fixed many potential NPE by using oids instead of the names.\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/apacheds-schema@892899 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_66",
        "file": [
            {
                "sha": "0b682122caeceecca3bef32d3dea01a859591969",
                "filename": "utils/src/main/java/org/apache/directory/server/utils/AttributesFactory.java",
                "status": "modified",
                "additions": 10,
                "deletions": 25,
                "changes": 35,
                "blob_url": "https://github.com/apache/directory-server/blob/1f8f48f77c6512b411ff6b022ec4c8a970f7745b/utils/src/main/java/org/apache/directory/server/utils/AttributesFactory.java",
                "raw_url": "https://github.com/apache/directory-server/raw/1f8f48f77c6512b411ff6b022ec4c8a970f7745b/utils/src/main/java/org/apache/directory/server/utils/AttributesFactory.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/utils/src/main/java/org/apache/directory/server/utils/AttributesFactory.java?ref=1f8f48f77c6512b411ff6b022ec4c8a970f7745b",
                "patch": "@@ -192,7 +192,7 @@ public ServerEntry getAttributes( MatchingRule matchingRule, Schema schema, Sche\n         ServerEntry entry = new DefaultServerEntry( schemaManager );\n \n         entry.put( SchemaConstants.OBJECT_CLASS_AT, SchemaConstants.TOP_OC, MetaSchemaConstants.META_MATCHING_RULE_OC );\n-        entry.put( MetaSchemaConstants.M_SYNTAX_AT, matchingRule.getSyntax().getOid() );\n+        entry.put( MetaSchemaConstants.M_SYNTAX_AT, matchingRule.getSyntaxOid() );\n         entry.put( SchemaConstants.CREATORS_NAME_AT, schema.getOwner() );\n         entry.put( SchemaConstants.CREATE_TIMESTAMP_AT, DateUtils.getGeneralizedTime() );\n         injectCommon( matchingRule, entry, schemaManager );\n@@ -334,61 +334,46 @@ public ServerEntry getAttributes( ObjectClass objectClass, Schema schema, Schema\n         injectCommon( objectClass, entry, schemaManager );\n \n         // handle the superior objectClasses \n-        if ( objectClass.getSuperiors() != null && objectClass.getSuperiors().size() != 0 )\n+        if ( objectClass.getSuperiorOids() != null && objectClass.getSuperiorOids().size() != 0 )\n         {\n             EntryAttribute attr = new DefaultServerAttribute( schemaManager.lookupAttributeTypeRegistry( MetaSchemaConstants.M_SUP_OBJECT_CLASS_AT ) );\n-            List<ObjectClass> superClasses = objectClass.getSuperiors();\n             \n-            for ( ObjectClass superClass:superClasses )\n+            for ( String superior:objectClass.getSuperiorOids() )\n             {\n-                attr.add( getNameOrNumericoid( superClass ) ); \n+                attr.add( superior ); \n             }\n             \n             entry.put( attr );\n         }\n \n         // add the must list\n-        if ( objectClass.getMustAttributeTypes() != null && objectClass.getMustAttributeTypes().size() != 0 )\n+        if ( objectClass.getMustAttributeTypeOids() != null && objectClass.getMustAttributeTypeOids().size() != 0 )\n         {\n             EntryAttribute attr = new DefaultServerAttribute( schemaManager.lookupAttributeTypeRegistry( MetaSchemaConstants.M_MUST_AT ) );\n-            List<AttributeType> mustList = objectClass.getMustAttributeTypes();\n \n-            for ( AttributeType attributeType:mustList )\n+            for ( String mustOid :objectClass.getMustAttributeTypeOids() )\n             {\n-                attr.add( getNameOrNumericoid( attributeType ) );\n+                attr.add( mustOid );\n             }\n             \n             entry.put( attr );\n         }\n         \n         // add the may list\n-        if ( objectClass.getMayAttributeTypes() != null && objectClass.getMayAttributeTypes().size() != 0 )\n+        if ( objectClass.getMayAttributeTypeOids() != null && objectClass.getMayAttributeTypeOids().size() != 0 )\n         {\n             EntryAttribute attr = new DefaultServerAttribute( schemaManager.lookupAttributeTypeRegistry( MetaSchemaConstants.M_MAY_AT ) );\n-            List<AttributeType> mayList = objectClass.getMayAttributeTypes();\n \n-            for ( AttributeType attributeType:mayList )\n+            for ( String mayOid :objectClass.getMayAttributeTypeOids() )\n             {\n-                attr.add( getNameOrNumericoid( attributeType ) );\n+                attr.add( mayOid );\n             }\n             \n             entry.put( attr );\n         }\n         \n         return entry;\n     }\n-\n-    \n-    private final String getNameOrNumericoid( SchemaObject object )\n-    {\n-        // first try to use user friendly name if we can\n-        if ( object.getName() != null )\n-        {\n-            return object.getName();\n-        }\n-        \n-        return object.getOid();\n-    }\n     \n     \n     private final void injectCommon( SchemaObject object, ServerEntry entry, SchemaManager schemaManager ) throws NamingException"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/9ae9e2a754f10b0f9b04688cc43623126c741b9d",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/d3095e239f03e09ae0c33ad2e470b6d2f17a35ba",
        "message": "Used the oids instead of the refrences to avoid NPEs\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/apacheds-schema@892823 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_67",
        "file": [
            {
                "sha": "6f757f70e5d1853cf3acef6c8d570ded15983c4b",
                "filename": "utils/src/main/java/org/apache/directory/server/utils/AttributesFactory.java",
                "status": "modified",
                "additions": 10,
                "deletions": 39,
                "changes": 49,
                "blob_url": "https://github.com/apache/directory-server/blob/9ae9e2a754f10b0f9b04688cc43623126c741b9d/utils/src/main/java/org/apache/directory/server/utils/AttributesFactory.java",
                "raw_url": "https://github.com/apache/directory-server/raw/9ae9e2a754f10b0f9b04688cc43623126c741b9d/utils/src/main/java/org/apache/directory/server/utils/AttributesFactory.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/utils/src/main/java/org/apache/directory/server/utils/AttributesFactory.java?ref=9ae9e2a754f10b0f9b04688cc43623126c741b9d",
                "patch": "@@ -267,7 +267,7 @@ public ServerEntry getAttributes( AttributeType attributeType, Schema schema, Sc\n         ServerEntry entry = new DefaultServerEntry( schemaManager );\n \n         entry.put( SchemaConstants.OBJECT_CLASS_AT, SchemaConstants.TOP_OC, MetaSchemaConstants.META_ATTRIBUTE_TYPE_OC );\n-        entry.put( MetaSchemaConstants.M_SYNTAX_AT, attributeType.getSyntax().getOid() );\n+        entry.put( MetaSchemaConstants.M_SYNTAX_AT, attributeType.getSyntaxOid() );\n         entry.put( MetaSchemaConstants.M_COLLECTIVE_AT, getBoolean( attributeType.isCollective() ) );\n         entry.put( MetaSchemaConstants.M_NO_USER_MODIFICATION_AT, getBoolean( ! attributeType.isUserModifiable() ) );\n         entry.put( MetaSchemaConstants.M_SINGLE_VALUE_AT, getBoolean( attributeType.isSingleValued() ) );\n@@ -277,55 +277,26 @@ public ServerEntry getAttributes( AttributeType attributeType, Schema schema, Sc\n \n         injectCommon( attributeType, entry, schemaManager );\n         \n-        AttributeType superior = attributeType.getSuperior();\n+        String superiorOid = attributeType.getSuperiorOid();\n         \n-        if ( superior != null )\n+        if ( superiorOid != null )\n         {\n-            // use name if we can for clarity\n-            String sup = superior.getName();\n-            \n-            if ( sup == null )\n-            {\n-                sup = superior.getOid();\n-            }\n-            \n-            entry.put( MetaSchemaConstants.M_SUP_ATTRIBUTE_TYPE_AT, sup );\n+            entry.put( MetaSchemaConstants.M_SUP_ATTRIBUTE_TYPE_AT, superiorOid );\n         }\n         \n-        if ( attributeType.getEquality() != null )\n+        if ( attributeType.getEqualityOid() != null )\n         {\n-            String equality = attributeType.getEquality().getName();\n-            \n-            if ( equality == null )\n-            {\n-                equality = attributeType.getEquality().getOid();\n-            }\n-            \n-            entry.put( MetaSchemaConstants.M_EQUALITY_AT, equality );\n+            entry.put( MetaSchemaConstants.M_EQUALITY_AT, attributeType.getEqualityOid() );\n         }\n \n-        if ( attributeType.getSubstring() != null )\n+        if ( attributeType.getSubstringOid() != null )\n         {\n-            String substr = attributeType.getSubstring().getName();\n-            \n-            if ( substr == null )\n-            {\n-                substr = attributeType.getSubstring().getOid();\n-            }\n-            \n-            entry.put( MetaSchemaConstants.M_SUBSTR_AT, substr );\n+            entry.put( MetaSchemaConstants.M_SUBSTR_AT, attributeType.getSubstringOid() );\n         }\n \n-        if ( attributeType.getOrdering() != null )\n+        if ( attributeType.getOrderingOid() != null )\n         {\n-            String ordering = attributeType.getOrdering().getName();\n-            \n-            if ( ordering == null )\n-            {\n-                ordering = attributeType.getOrdering().getOid();\n-            }\n-            \n-            entry.put( MetaSchemaConstants.M_ORDERING_AT, ordering );\n+            entry.put( MetaSchemaConstants.M_ORDERING_AT, attributeType.getOrderingOid() );\n         }\n \n         return entry;"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/7276466efec3571d5e66917264a0732cc49bb887",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/96eaf2cef3dac80d844a911e66e78739d2799e6b",
        "message": "Fixed a bug in the cloning of ServerEntries :we could get some NPE in some corner cases \n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/apacheds-schema@891319 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_68",
        "file": [
            {
                "sha": "b060a6a3e4b550028f5445f0e8cd62100afcb068",
                "filename": "core-entry/src/main/java/org/apache/directory/server/core/entry/DefaultServerEntry.java",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/apache/directory-server/blob/7276466efec3571d5e66917264a0732cc49bb887/core-entry/src/main/java/org/apache/directory/server/core/entry/DefaultServerEntry.java",
                "raw_url": "https://github.com/apache/directory-server/raw/7276466efec3571d5e66917264a0732cc49bb887/core-entry/src/main/java/org/apache/directory/server/core/entry/DefaultServerEntry.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-entry/src/main/java/org/apache/directory/server/core/entry/DefaultServerEntry.java?ref=7276466efec3571d5e66917264a0732cc49bb887",
                "patch": "@@ -2282,10 +2282,10 @@ public Entry clone()\n         // now clone all the servrAttributes\n         clone.attributes.clear();\n         \n-        for ( AttributeType key:attributes.keySet() )\n+        for ( EntryAttribute entryAttribute : attributes.values() )\n         {\n-            EntryAttribute value = (ServerAttribute)attributes.get( key ).clone();\n-            clone.attributes.put( key, value );\n+            ServerAttribute value = (ServerAttribute)entryAttribute.clone();\n+            clone.attributes.put( value.getAttributeType(), value );\n         }\n         \n         // We are done !"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/a8e5de66a54f21693d1950b22c5634f0764b68f1",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/4476ebf6d368ebd8f96764cad4a806b9e2fb9cdb",
        "message": "Fixed a potential NPE : the MR was null but we were still trying to get its oid ...\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/apacheds-schema@813827 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_69",
        "file": [
            {
                "sha": "170a940c2a20828eb8b6f3b88b9fa3960c40af79",
                "filename": "xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/EqualityEvaluator.java",
                "status": "modified",
                "additions": 11,
                "deletions": 14,
                "changes": 25,
                "blob_url": "https://github.com/apache/directory-server/blob/a8e5de66a54f21693d1950b22c5634f0764b68f1/xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/EqualityEvaluator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/a8e5de66a54f21693d1950b22c5634f0764b68f1/xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/EqualityEvaluator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/EqualityEvaluator.java?ref=a8e5de66a54f21693d1950b22c5634f0764b68f1",
                "patch": "@@ -20,6 +20,16 @@\n package org.apache.directory.server.xdbm.search.impl;\n \n \n+import java.util.Comparator;\n+import java.util.Iterator;\n+\n+import org.apache.directory.server.core.entry.ServerAttribute;\n+import org.apache.directory.server.core.entry.ServerEntry;\n+import org.apache.directory.server.xdbm.Index;\n+import org.apache.directory.server.xdbm.IndexEntry;\n+import org.apache.directory.server.xdbm.Store;\n+import org.apache.directory.server.xdbm.search.Evaluator;\n+import org.apache.directory.shared.ldap.entry.Value;\n import org.apache.directory.shared.ldap.filter.EqualityNode;\n import org.apache.directory.shared.ldap.schema.AttributeType;\n import org.apache.directory.shared.ldap.schema.MatchingRule;\n@@ -29,19 +39,6 @@\n import org.apache.directory.shared.ldap.schema.normalizers.NoOpNormalizer;\n import org.apache.directory.shared.ldap.schema.registries.Registries;\n import org.apache.directory.shared.ldap.util.StringTools;\n-import org.apache.directory.shared.ldap.entry.Value;\n-import org.apache.directory.shared.ldap.entry.client.ClientBinaryValue;\n-import org.apache.directory.server.xdbm.IndexEntry;\n-import org.apache.directory.server.xdbm.Store;\n-import org.apache.directory.server.xdbm.Index;\n-import org.apache.directory.server.xdbm.search.Evaluator;\n-import org.apache.directory.server.core.entry.ServerBinaryValue;\n-import org.apache.directory.server.core.entry.ServerEntry;\n-import org.apache.directory.server.core.entry.ServerAttribute;\n-import org.apache.directory.server.core.entry.ServerStringValue;\n-\n-import java.util.Iterator;\n-import java.util.Comparator;\n \n \n /**\n@@ -95,7 +92,7 @@ public EqualityEvaluator( EqualityNode<T> node, Store<ServerEntry> db, Registrie\n \n             if ( mr == null )\n             {\n-                normalizer = new NoOpNormalizer( mr.getOid() );\n+                normalizer = new NoOpNormalizer( type.getOid() );\n                 comparator = null;\n             }\n             else"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/a876589a77357f40992bcee2b664e5acf6ec8b2a",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/1fdd9607ac8d34634c2377c044a222d1f7b13dd0",
        "message": "o Cleanup of the SyntaxChecker registry\no Fixed a test which was failing (NPE)\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@777320 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_70",
        "file": [
            {
                "sha": "0d69ead352e70b5926e44577f38cba30e06eff58",
                "filename": "schema-registries/src/main/java/org/apache/directory/server/schema/registries/DefaultSyntaxCheckerRegistry.java",
                "status": "modified",
                "additions": 79,
                "deletions": 33,
                "changes": 112,
                "blob_url": "https://github.com/apache/directory-server/blob/a876589a77357f40992bcee2b664e5acf6ec8b2a/schema-registries/src/main/java/org/apache/directory/server/schema/registries/DefaultSyntaxCheckerRegistry.java",
                "raw_url": "https://github.com/apache/directory-server/raw/a876589a77357f40992bcee2b664e5acf6ec8b2a/schema-registries/src/main/java/org/apache/directory/server/schema/registries/DefaultSyntaxCheckerRegistry.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/schema-registries/src/main/java/org/apache/directory/server/schema/registries/DefaultSyntaxCheckerRegistry.java?ref=a876589a77357f40992bcee2b664e5acf6ec8b2a",
                "patch": "@@ -21,13 +21,14 @@\n \n \n import java.util.ArrayList;\n-import java.util.HashMap;\n import java.util.Iterator;\n import java.util.List;\n import java.util.Map;\n+import java.util.concurrent.ConcurrentHashMap;\n \n import javax.naming.NamingException;\n \n+import org.apache.directory.shared.asn1.primitives.OID;\n import org.apache.directory.shared.ldap.schema.SyntaxChecker;\n import org.apache.directory.shared.ldap.schema.parsers.SyntaxCheckerDescription;\n import org.slf4j.Logger;\n@@ -44,92 +45,116 @@\n {\n     /** static class logger */\n     private static final Logger LOG = LoggerFactory.getLogger( DefaultSyntaxCheckerRegistry.class );\n+    \n     /** a map by OID of SyntaxCheckers */\n-    private final Map<String, SyntaxChecker> byOid;\n+    private final Map<String, SyntaxChecker> byOidSyntaxChecker;\n+    \n     /** maps an OID to a syntaxCheckerDescription */\n     private final Map<String, SyntaxCheckerDescription> oidToDescription;\n \n \n     // ------------------------------------------------------------------------\n     // C O N S T R U C T O R S\n     // ------------------------------------------------------------------------\n-\n-\n     /**\n      * Creates an instance of a DefaultSyntaxRegistry.\n      */\n     public DefaultSyntaxCheckerRegistry()\n     {\n-        this.byOid = new HashMap<String, SyntaxChecker>();\n-        this.oidToDescription = new HashMap<String, SyntaxCheckerDescription>();\n+        byOidSyntaxChecker = new ConcurrentHashMap<String, SyntaxChecker>();\n+        oidToDescription = new ConcurrentHashMap<String, SyntaxCheckerDescription>();\n     }\n \n \n     // ------------------------------------------------------------------------\n     // Service Methods\n     // ------------------------------------------------------------------------\n-\n-    \n+    /**\n+     * {@inheritDoc}\n+     */\n     public void register( SyntaxCheckerDescription syntaxCheckerDescription, SyntaxChecker syntaxChecker ) throws NamingException\n     {\n-        if ( byOid.containsKey( syntaxChecker.getSyntaxOid() ) )\n+    \tString oid = syntaxChecker.getSyntaxOid();\n+    \t\n+        if ( byOidSyntaxChecker.containsKey( oid ) )\n         {\n-            throw new NamingException( \"SyntaxChecker with OID \" + syntaxChecker.getSyntaxOid()\n-                + \" already registered!\" );\n+        \tString msg = \"SyntaxChecker with OID \" + oid + \" already registered!\";\n+        \tLOG.warn( msg );\n+            throw new NamingException( msg );\n         }\n \n-        byOid.put( syntaxChecker.getSyntaxOid(), syntaxChecker );\n-        oidToDescription.put( syntaxChecker.getSyntaxOid(), syntaxCheckerDescription );\n+        byOidSyntaxChecker.put( oid, syntaxChecker );\n+        oidToDescription.put( oid, syntaxCheckerDescription );\n+        \n         if ( LOG.isDebugEnabled() )\n         {\n-            LOG.debug( \"registered syntaxChecher for OID \" + syntaxChecker.getSyntaxOid() );\n+            LOG.debug( \"registered syntaxChecher for OID {}\", oid );\n         }\n     }\n \n \n+    /**\n+     * {@inheritDoc}\n+     */\n     public SyntaxChecker lookup( String oid ) throws NamingException\n     {\n-        if ( !byOid.containsKey( oid ) )\n+        SyntaxChecker syntaxChecker = byOidSyntaxChecker.get( oid );\n+\n+        if ( syntaxChecker == null )\n         {\n-            throw new NamingException( \"SyntaxChecker for OID \" + oid + \" not found!\" );\n+        \tString msg = \"SyntaxChecker for OID \" + oid + \" not found!\";\n+        \tLOG.warn( msg );\n+            throw new NamingException( msg );\n         }\n-\n-        SyntaxChecker syntaxChecker = byOid.get( oid );\n+        \n         if ( LOG.isDebugEnabled() )\n         {\n-            LOG.debug( \"looked up syntaxChecher with OID \" + oid );\n+            LOG.debug( \"looked up syntaxChecher with OID {}\", oid );\n         }\n+\n         return syntaxChecker;\n     }\n \n \n+    /**\n+     * {@inheritDoc}\n+     */\n     public boolean hasSyntaxChecker( String oid )\n     {\n-        return byOid.containsKey( oid );\n+        return byOidSyntaxChecker.containsKey( oid );\n     }\n \n \n+    /**\n+     * {@inheritDoc}\n+     */\n     public String getSchemaName( String oid ) throws NamingException\n     {\n-        if ( ! Character.isDigit( oid.charAt( 0 ) ) )\n+        if ( ! OID.isOID( oid ) )\n         {\n-            throw new NamingException( \"Looks like the arg is not a numeric OID\" );\n+        \tString msg = \"Looks like the arg is not a numeric OID\";\n+        \tLOG.warn( msg );\n+            throw new NamingException( msg );\n         }\n \n-        if ( oidToDescription.containsKey( oid ) )\n+        SyntaxCheckerDescription description = oidToDescription.get( oid );\n+        \n+        if ( description != null )\n         {\n-            return getSchema( oidToDescription.get( oid ) );\n+            return getSchema( description );\n         }\n \n-        throw new NamingException( \"OID \" + oid + \" not found in oid to \" + \"schema name map!\" );\n+    \tString msg = \"OID \" + oid + \" not found in oid to schema name map!\";\n+    \tLOG.warn( msg );\n+        throw new NamingException( msg );\n     }\n     \n     \n     private static String getSchema( SyntaxCheckerDescription desc ) \n     {\n         List<String> ext = desc.getExtensions().get( \"X-SCHEMA\" );\n         \n-        if ( ext == null || ext.size() == 0 )\n+        if ( ( ext == null ) || ( ext.size() == 0 ) )\n         {\n             return \"other\";\n         }\n@@ -138,47 +163,65 @@ private static String getSchema( SyntaxCheckerDescription desc )\n     }\n \n \n+    /**\n+     * {@inheritDoc}\n+     */\n     public Iterator<SyntaxChecker> iterator()\n     {\n-        return byOid.values().iterator();\n+        return byOidSyntaxChecker.values().iterator();\n     }\n \n \n+    /**\n+     * {@inheritDoc}\n+     */\n     public void unregister( String numericOid ) throws NamingException\n     {\n-        if ( ! Character.isDigit( numericOid.charAt( 0 ) ) )\n+        if ( ! OID.isOID( numericOid ) )\n         {\n-            throw new NamingException( \"Looks like the arg is not a numeric OID\" );\n+        \tString msg = \"Looks like the arg is not a numeric OID\";\n+        \tLOG.warn( msg );\n+            throw new NamingException( msg );\n         }\n \n-        byOid.remove( numericOid );\n+        byOidSyntaxChecker.remove( numericOid );\n         oidToDescription.remove( numericOid );\n     }\n     \n     \n+    /**\n+     * {@inheritDoc}\n+     */\n     public void unregisterSchemaElements( String schemaName )\n     {\n-        List<String> oids = new ArrayList<String>( byOid.keySet() );\n+        List<String> oids = new ArrayList<String>( byOidSyntaxChecker.keySet() );\n+        \n         for ( String oid : oids )\n         {\n             SyntaxCheckerDescription description = oidToDescription.get( oid );\n             String schemaNameForOid = getSchema( description );\n+            \n             if ( schemaNameForOid.equalsIgnoreCase( schemaName ) )\n             {\n-                byOid.remove( oid );\n+            \tbyOidSyntaxChecker.remove( oid );\n                 oidToDescription.remove( oid );\n             }\n         }\n     }\n \n \n+    /**\n+     * {@inheritDoc}\n+     */\n     public void renameSchema( String originalSchemaName, String newSchemaName )\n     {\n-        List<String> oids = new ArrayList<String>( byOid.keySet() );\n+        List<String> oids = new ArrayList<String>( byOidSyntaxChecker.keySet() );\n+        \n         for ( String oid : oids )\n         {\n             SyntaxCheckerDescription description = oidToDescription.get( oid );\n             String schemaNameForOid = getSchema( description );\n+            \n             if ( schemaNameForOid.equalsIgnoreCase( originalSchemaName ) )\n             {\n                 List<String> values = description.getExtensions().get( \"X-SCHEMA\" );\n@@ -189,6 +232,9 @@ public void renameSchema( String originalSchemaName, String newSchemaName )\n     }\n \n \n+    /**\n+     * {@inheritDoc}\n+     */\n     public Iterator<SyntaxCheckerDescription> syntaxCheckerDescriptionIterator()\n     {\n         return oidToDescription.values().iterator();"
            },
            {
                "sha": "4860512f9b88e98b826cedcdb11943dfc0f12d54",
                "filename": "xdbm-search/src/test/java/org/apache/directory/server/xdbm/search/impl/BogusSyntax.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/a876589a77357f40992bcee2b664e5acf6ec8b2a/xdbm-search/src/test/java/org/apache/directory/server/xdbm/search/impl/BogusSyntax.java",
                "raw_url": "https://github.com/apache/directory-server/raw/a876589a77357f40992bcee2b664e5acf6ec8b2a/xdbm-search/src/test/java/org/apache/directory/server/xdbm/search/impl/BogusSyntax.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/xdbm-search/src/test/java/org/apache/directory/server/xdbm/search/impl/BogusSyntax.java?ref=a876589a77357f40992bcee2b664e5acf6ec8b2a",
                "patch": "@@ -46,7 +46,7 @@ public boolean isHumanReadable()\n \n     public SyntaxChecker getSyntaxChecker() throws NamingException\n     {\n-        return new AcceptAllSyntaxChecker();\n+        return new AcceptAllSyntaxChecker( getOid() );\n     }\n \n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/23ab5e4e61fc57eb77364b5b91f8b0c8718c7e90",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/025da9d787ba0f42ae7f72e9150bbe89c8a8253f",
        "message": "Ooops... Without those small modifications, the tests ends with a hell lot of NPE :/\n\nMy bad.\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@770597 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_71",
        "file": [
            {
                "sha": "29dedb84c82e6df99c239daed8911f91ecf24736",
                "filename": "core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "status": "modified",
                "additions": 5,
                "deletions": 2,
                "changes": 7,
                "blob_url": "https://github.com/apache/directory-server/blob/23ab5e4e61fc57eb77364b5b91f8b0c8718c7e90/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/23ab5e4e61fc57eb77364b5b91f8b0c8718c7e90/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java?ref=23ab5e4e61fc57eb77364b5b91f8b0c8718c7e90",
                "patch": "@@ -938,9 +938,12 @@ public synchronized void shutdown() throws Exception\n         changeLog.destroy();\n         \n         // --------------------------------------------------------------------\n-        // Shutdown the journal\n+        // Shutdown the journal if enabled\n         // --------------------------------------------------------------------\n-        journal.destroy();\n+        if ( journal.isEnabled() )\n+        {\n+            journal.destroy();\n+        }\n \n         // --------------------------------------------------------------------\n         // Shutdown the partition"
            },
            {
                "sha": "4e13d2da2c780796fff497ad5f24daccafdd6ab9",
                "filename": "core/src/main/java/org/apache/directory/server/core/journal/DefaultJournal.java",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/apache/directory-server/blob/23ab5e4e61fc57eb77364b5b91f8b0c8718c7e90/core/src/main/java/org/apache/directory/server/core/journal/DefaultJournal.java",
                "raw_url": "https://github.com/apache/directory-server/raw/23ab5e4e61fc57eb77364b5b91f8b0c8718c7e90/core/src/main/java/org/apache/directory/server/core/journal/DefaultJournal.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/journal/DefaultJournal.java?ref=23ab5e4e61fc57eb77364b5b91f8b0c8718c7e90",
                "patch": "@@ -53,7 +53,10 @@ public void destroy() throws Exception\n         \n         // We have to release the file, otherwise Windows won't be able\n         // to stop the server\n-        store.destroy();\n+        if ( store != null )\n+        {\n+            store.destroy();\n+        }\n     }\n \n "
            },
            {
                "sha": "b3cf570f7d54c2d96b63756d963cfdf2ccb78fcd",
                "filename": "core/src/main/java/org/apache/directory/server/core/journal/JournalInterceptor.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/23ab5e4e61fc57eb77364b5b91f8b0c8718c7e90/core/src/main/java/org/apache/directory/server/core/journal/JournalInterceptor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/23ab5e4e61fc57eb77364b5b91f8b0c8718c7e90/core/src/main/java/org/apache/directory/server/core/journal/JournalInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/journal/JournalInterceptor.java?ref=23ab5e4e61fc57eb77364b5b91f8b0c8718c7e90",
                "patch": "@@ -79,7 +79,7 @@ public void init( DirectoryService directoryService ) throws Exception\n     {\n         super.init( directoryService );\n         \n-        //if ( directoryService.getJournal().isEnabled() )\n+        if ( directoryService.getJournal().isEnabled() )\n         {\n             journalEnabled = true; \n             journal = directoryService.getJournal();"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/2ea3b3654fb4d7c3cc2a7349f3e2b6125173f46d",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/457a3378269d55a1345af83391a741629998e05a",
        "message": "o updated the cookie storage dir location\no fixed an NPE occurred while deleting a cookie\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/apacheds-replication@755698 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_72",
        "file": [
            {
                "sha": "5f9835853b3311968d9d56fefe8db0929acc2951",
                "filename": "mitosis/src/main/java/org/apache/directory/mitosis/syncrepl/SyncreplConsumer.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/directory-server/blob/2ea3b3654fb4d7c3cc2a7349f3e2b6125173f46d/mitosis/src/main/java/org/apache/directory/mitosis/syncrepl/SyncreplConsumer.java",
                "raw_url": "https://github.com/apache/directory-server/raw/2ea3b3654fb4d7c3cc2a7349f3e2b6125173f46d/mitosis/src/main/java/org/apache/directory/mitosis/syncrepl/SyncreplConsumer.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/mitosis/src/main/java/org/apache/directory/mitosis/syncrepl/SyncreplConsumer.java?ref=2ea3b3654fb4d7c3cc2a7349f3e2b6125173f46d",
                "patch": "@@ -150,7 +150,7 @@ public void init( DirectoryService directoryservice )\n     {\n         this.directoryService = directoryservice;\n \n-        File cookieDir = new File( \"cookies\" );\n+        File cookieDir = new File( directoryservice.getWorkingDirectory(), \"cookies\" );\n         cookieDir.mkdir();\n         \n         cookieFile = new File( cookieDir, String.valueOf( config.getReplicaId() ) );\n@@ -671,7 +671,7 @@ private void readCookie()\n      */\n     public void deleteCookieFile()\n     {\n-        if( cookieFile.exists() )\n+        if( cookieFile != null && cookieFile.exists() )\n         {\n             LOG.debug( \"deleting the cookie file\" );\n             cookieFile.delete();"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/35eba60a9c2d4895584b825fccab5a745c4a9198",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/cc4e1268083a3ecd8f604f8cc29df55281aa1aba",
        "message": "Fix a NPE when we try to create an index on an attributeType which has no EQUALITY matching rule\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@751899 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_73",
        "file": [
            {
                "sha": "deab7d701c881456fe68c89f45dac32d50cfd3b3",
                "filename": "jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmIndex.java",
                "status": "modified",
                "additions": 23,
                "deletions": 9,
                "changes": 32,
                "blob_url": "https://github.com/apache/directory-server/blob/35eba60a9c2d4895584b825fccab5a745c4a9198/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmIndex.java",
                "raw_url": "https://github.com/apache/directory-server/raw/35eba60a9c2d4895584b825fccab5a745c4a9198/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmIndex.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmIndex.java?ref=35eba60a9c2d4895584b825fccab5a745c4a9198",
                "patch": "@@ -31,7 +31,10 @@\n import org.apache.directory.server.xdbm.Tuple;\n import org.apache.directory.server.xdbm.IndexCursor;\n import org.apache.directory.shared.ldap.schema.AttributeType;\n+import org.apache.directory.shared.ldap.schema.MatchingRule;\n import org.apache.directory.shared.ldap.util.SynchronizedLRUMap;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n \n import javax.naming.NamingException;\n import java.io.File;\n@@ -48,53 +51,66 @@\n  */\n public class JdbmIndex<K,O> implements Index<K,O>\n {\n+    /** A logger for this class */\n+    private static final Logger LOG = LoggerFactory.getLogger( JdbmIndex.class.getSimpleName() );\n+\n     /**\n      * default duplicate limit before duplicate keys switch to using a btree for values\n      */\n     public static final int DEFAULT_DUPLICATE_LIMIT = 512;\n \n     /**  the key used for the forward btree name */\n     public static final String FORWARD_BTREE = \"_forward\";\n+    \n     /**  the key used for the reverse btree name */\n     public static final String REVERSE_BTREE = \"_reverse\";\n \n     /** the attribute type resolved for this JdbmIndex */\n     private AttributeType attribute;\n+\n     /**\n      * the forward btree where the btree key is the value of the indexed attribute and\n      * the value of the btree is the entry id of the entry containing an attribute with\n      * that value\n      */\n     protected JdbmTable<K, Long> forward;\n+    \n     /**\n      * the reverse btree where the btree key is the entry id of the entry containing a\n      * value for the indexed attribute, and the btree value is the value of the indexed\n      * attribute\n      */\n     protected JdbmTable<Long,K> reverse;\n+    \n     /**\n      * the JDBM record manager for the file containing this index\n      */\n     protected RecordManager recMan;\n+    \n     /**\n      * the normalized value cache for this index\n      * @todo I don't think the keyCache is required anymore since the normalizer\n      * will cache values for us.\n      */\n     protected SynchronizedLRUMap keyCache;\n+    \n     /** the size (number of index entries) for the cache */\n     protected int cacheSize = DEFAULT_INDEX_CACHE_SIZE;\n+    \n     /**\n      * duplicate limit before duplicate keys switch to using a btree for values\n      */\n     protected int numDupLimit = DEFAULT_DUPLICATE_LIMIT;\n+    \n     /**\n      * the attribute identifier set at configuration time for this index which may not\n      * be the OID but an alias name for the attributeType associated with this Index\n      */\n     private String attributeId;\n+    \n     /** whether or not this index has been initialized */\n     protected boolean initialized;\n+    \n     /** a customm working directory path when specified in configuration */\n     protected File wkDirPath;\n \n@@ -136,8 +152,10 @@ public JdbmIndex( String attributeId )\n \n     public void init( AttributeType attributeType, File wkDirPath ) throws IOException\n     {\n-        this.keyCache = new SynchronizedLRUMap( cacheSize );\n-        this.attribute = attributeType;\n+        LOG.debug( \"Initializing an Index for attribute '{}'\", attributeType.getName() );\n+        \n+        keyCache = new SynchronizedLRUMap( cacheSize );\n+        attribute = attributeType;\n \n         if ( attributeId == null )\n         {\n@@ -182,7 +200,9 @@ private void initTables() throws IOException\n \n         try\n         {\n-            comp = new SerializableComparator<K>( attribute.getEquality().getOid() );\n+            MatchingRule mr = attribute.getEquality();\n+            \n+            comp = new SerializableComparator<K>( mr.getOid() );\n         }\n         catch ( NamingException e )\n         {\n@@ -469,8 +489,6 @@ public void drop( Long id ) throws Exception\n     // ------------------------------------------------------------------------\n     // Index Cursor Operations\n     // ------------------------------------------------------------------------\n-\n-\n     @SuppressWarnings(\"unchecked\")\n     public IndexCursor<K, O> reverseCursor() throws Exception\n     {\n@@ -514,8 +532,6 @@ public void drop( Long id ) throws Exception\n     // ------------------------------------------------------------------------\n     // Value Assertion (a.k.a Index Lookup) Methods //\n     // ------------------------------------------------------------------------\n-\n-    \n     /**\n      * @see Index#forward(Object)\n      */\n@@ -626,8 +642,6 @@ public boolean reverseLessOrEq( Long id, K attrVal ) throws Exception\n     // ------------------------------------------------------------------------\n     // Maintenance Methods \n     // ------------------------------------------------------------------------\n-\n-\n     /**\n      * @see org.apache.directory.server.xdbm.Index#close()\n      */"
            },
            {
                "sha": "a1001c2ccf53a6b879de7a2e7aaa04336048e3b9",
                "filename": "jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmStore.java",
                "status": "modified",
                "additions": 17,
                "deletions": 2,
                "changes": 19,
                "blob_url": "https://github.com/apache/directory-server/blob/35eba60a9c2d4895584b825fccab5a745c4a9198/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmStore.java",
                "raw_url": "https://github.com/apache/directory-server/raw/35eba60a9c2d4895584b825fccab5a745c4a9198/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmStore.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmStore.java?ref=35eba60a9c2d4895584b825fccab5a745c4a9198",
                "patch": "@@ -64,6 +64,7 @@\n import org.apache.directory.shared.ldap.name.LdapDN;\n import org.apache.directory.shared.ldap.name.Rdn;\n import org.apache.directory.shared.ldap.schema.AttributeType;\n+import org.apache.directory.shared.ldap.schema.MatchingRule;\n import org.apache.directory.shared.ldap.util.NamespaceTools;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n@@ -372,9 +373,23 @@ private void setupUserIndices() throws Exception\n             for ( Index<?,E> index : userIndices.values() )\n             {\n                 String oid = oidRegistry.getOid( index.getAttributeId() );\n-                tmp.put( oid, index );\n-                ( ( JdbmIndex ) index ).init( attributeTypeRegistry.lookup( oid ), workingDirectory );\n+                AttributeType attributeType = attributeTypeRegistry.lookup( oid );\n+                \n+                // Check that the attributeType has an EQUALITY matchingRule\n+                MatchingRule mr = attributeType.getEquality();\n+                \n+                if ( mr != null )\n+                {\n+                    ( ( JdbmIndex ) index ).init( attributeTypeRegistry.lookup( oid ), workingDirectory );\n+                    tmp.put( oid, index );\n+                }\n+                else\n+                {\n+                    LOG.error( \"Cannot build an index for attribute '{}', no EQUALITY MatchingRule defined\",\n+                        attributeType.getName() );\n+                }\n             }\n+            \n             userIndices = tmp;\n         }\n         else"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/715e47933e5d43d13765064380591a501a599079",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/766524e98c56ccf42616d14c30b677ea90a8752e",
        "message": "Fixed a NPE due to a bad initialization of the Transport\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@730097 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_74",
        "file": [
            {
                "sha": "d43c158edee42397d948c4faa3c7b4e1e817654b",
                "filename": "server-integ/src/test/java/org/apache/directory/server/operations/modify/ModifyReplaceIT.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/715e47933e5d43d13765064380591a501a599079/server-integ/src/test/java/org/apache/directory/server/operations/modify/ModifyReplaceIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/715e47933e5d43d13765064380591a501a599079/server-integ/src/test/java/org/apache/directory/server/operations/modify/ModifyReplaceIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-integ/src/test/java/org/apache/directory/server/operations/modify/ModifyReplaceIT.java?ref=715e47933e5d43d13765064380591a501a599079",
                "patch": "@@ -136,9 +136,9 @@ public LdapService newInstance() throws Exception\n \n             LdapService ldapService = new LdapService();\n             ldapService.setDirectoryService( service );\n-            ldapService.setSocketAcceptor( new NioSocketAcceptor() );\n             int port = AvailablePortFinder.getNextAvailable( 1024 );\n             ldapService.setTcpTransport( new TcpTransport( port ) );\n+            ldapService.setSocketAcceptor( new NioSocketAcceptor() );\n             ldapService.getTcpTransport().setNbThreads( 3 );\n             ldapService.addExtendedOperationHandler( new StartTlsHandler() );\n             ldapService.addExtendedOperationHandler( new StoredProcedureExtendedOperationHandler() );"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/b6c0a5ec0393cc4872760b9e7051957bc1f2a5be",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/36a8c3b7142bb76f011713a42437b9260313627b",
        "message": "Avoid a NPE when the entry is not found. Thiw will fix DIRSERVER-1267\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@697059 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_75",
        "file": [
            {
                "sha": "af7dfb8e8414f952f1801578065bef4c58e03505",
                "filename": "xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/DefaultSearchEngine.java",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/apache/directory-server/blob/b6c0a5ec0393cc4872760b9e7051957bc1f2a5be/xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/DefaultSearchEngine.java",
                "raw_url": "https://github.com/apache/directory-server/raw/b6c0a5ec0393cc4872760b9e7051957bc1f2a5be/xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/DefaultSearchEngine.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/DefaultSearchEngine.java?ref=b6c0a5ec0393cc4872760b9e7051957bc1f2a5be",
                "patch": "@@ -97,6 +97,14 @@ public Optimizer getOptimizer()\n     {\n         LdapDN effectiveBase;\n         Long baseId = db.getEntryId( base.toString() );\n+        \n+        // Check that we have an entry, otherwise we can immediately get out\n+        if ( baseId == null )\n+        {\n+            // The entry is not found : ciao !\n+            return new EmptyIndexCursor<Long, ServerEntry>();\n+        }\n+        \n         String aliasedBase = db.getAliasIndex().reverseLookup( baseId );\n \n         // --------------------------------------------------------------------"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/cd91e1c00ccb9d5c09a63496625eab262c8cfc73",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/fbb8eae5913dfcdb7229f2b797cd9a6c9f260f2a",
        "message": "Fixed a NPE when trying to read an operational attribute, as we were using the clonedServerEntry, not the original entry.\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@691317 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_76",
        "file": [
            {
                "sha": "f88aacb326319dd33dd8f5ee7b0e6db5ffef2961",
                "filename": "server-jndi/src/main/java/org/apache/directory/server/configuration/ApacheDS.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/cd91e1c00ccb9d5c09a63496625eab262c8cfc73/server-jndi/src/main/java/org/apache/directory/server/configuration/ApacheDS.java",
                "raw_url": "https://github.com/apache/directory-server/raw/cd91e1c00ccb9d5c09a63496625eab262c8cfc73/server-jndi/src/main/java/org/apache/directory/server/configuration/ApacheDS.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-jndi/src/main/java/org/apache/directory/server/configuration/ApacheDS.java?ref=cd91e1c00ccb9d5c09a63496625eab262c8cfc73",
                "patch": "@@ -353,7 +353,7 @@ private void loadLdif( File ldifFile ) throws Exception\n         \r\n         if ( fileEntry != null )\r\n         {\r\n-            String time = fileEntry.get( SchemaConstants.CREATE_TIMESTAMP_AT ).getString();\r\n+            String time = ((ClonedServerEntry)fileEntry).getOriginalEntry().get( SchemaConstants.CREATE_TIMESTAMP_AT ).getString();\r\n             LOG.info( \"Load of LDIF file '\" + getCanonical( ldifFile )\r\n                     + \"' skipped.  It has already been loaded on \" + time + \".\" );\r\n         }\r"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/36a97e8ac3b13e37f1d6d3a96891f0ace3ddb844",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/d943a990e30ddeb38809f31cd96896a4d80d9d43",
        "message": "Fixed a NPE by returning something in the getNamesRef method\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/bigbang@664305 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_77",
        "file": [
            {
                "sha": "d26508cd67e6ad744ff245404420094c2d412daa",
                "filename": "core-integ/src/test/java/org/apache/directory/server/core/schema/MetaComparatorHandlerIT.java",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/apache/directory-server/blob/36a97e8ac3b13e37f1d6d3a96891f0ace3ddb844/core-integ/src/test/java/org/apache/directory/server/core/schema/MetaComparatorHandlerIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/36a97e8ac3b13e37f1d6d3a96891f0ace3ddb844/core-integ/src/test/java/org/apache/directory/server/core/schema/MetaComparatorHandlerIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-integ/src/test/java/org/apache/directory/server/core/schema/MetaComparatorHandlerIT.java?ref=36a97e8ac3b13e37f1d6d3a96891f0ace3ddb844",
                "patch": "@@ -607,8 +607,7 @@ public void setSchema( String schemaName )\n \n         public String[] getNamesRef()\n         {\n-            // TODO Auto-generated method stub\n-            return null;\n+            return new String[] { \"dummy\" };\n         }\n     }\n }"
            },
            {
                "sha": "221d012d0f84b13f6c6ca7c944ae92d144a0960b",
                "filename": "core-integ/src/test/java/org/apache/directory/server/core/schema/MetaNormalizerHandlerIT.java",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/apache/directory-server/blob/36a97e8ac3b13e37f1d6d3a96891f0ace3ddb844/core-integ/src/test/java/org/apache/directory/server/core/schema/MetaNormalizerHandlerIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/36a97e8ac3b13e37f1d6d3a96891f0ace3ddb844/core-integ/src/test/java/org/apache/directory/server/core/schema/MetaNormalizerHandlerIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-integ/src/test/java/org/apache/directory/server/core/schema/MetaNormalizerHandlerIT.java?ref=36a97e8ac3b13e37f1d6d3a96891f0ace3ddb844",
                "patch": "@@ -610,8 +610,7 @@ public void setSchema( String schemaName )\n \n         public String[] getNamesRef()\n         {\n-            // TODO Auto-generated method stub\n-            return null;\n+            return new String[] { \"dummy\" };\n         }\n     }\n }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/da075a6cccb347609591dc140d4414b67fd49fe7",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/637d203ae6cb36eaf4ddf8aa66f51f3414628092",
        "message": "triggers broken for now disabling tests until we can revamp this subsystem: some fixes to correct NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/bigbang@664223 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_78",
        "file": [
            {
                "sha": "96bbb79f78c4d9afe643bc570f6c641856e20b19",
                "filename": "core-integ/src/test/java/org/apache/directory/server/core/trigger/BackupUtilitiesSP.java",
                "status": "modified",
                "additions": 26,
                "deletions": 12,
                "changes": 38,
                "blob_url": "https://github.com/apache/directory-server/blob/da075a6cccb347609591dc140d4414b67fd49fe7/core-integ/src/test/java/org/apache/directory/server/core/trigger/BackupUtilitiesSP.java",
                "raw_url": "https://github.com/apache/directory-server/raw/da075a6cccb347609591dc140d4414b67fd49fe7/core-integ/src/test/java/org/apache/directory/server/core/trigger/BackupUtilitiesSP.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-integ/src/test/java/org/apache/directory/server/core/trigger/BackupUtilitiesSP.java?ref=da075a6cccb347609591dc140d4414b67fd49fe7",
                "patch": "@@ -19,30 +19,44 @@\n  */\n package org.apache.directory.server.core.trigger;\n \n-import javax.naming.NamingException;\n-import javax.naming.ldap.LdapContext;\n \n+import org.apache.directory.server.core.CoreSession;\n+import org.apache.directory.server.core.entry.ClonedServerEntry;\n import org.apache.directory.server.core.entry.ServerEntry;\n-import org.apache.directory.server.core.entry.ServerEntryUtils;\n import org.apache.directory.shared.ldap.name.LdapDN;\n+\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n \n+/**\n+ * An example of a stored procedures that backs up entries after a delete \n+ * operation.\n+ *\n+ * @author <a href=\"mailto:dev@directory.apache.org\">Apache Directory Project</a>\n+ * @version $Rev$, $Date$\n+ */\n public class BackupUtilitiesSP\n {\n     private static final Logger LOG = LoggerFactory.getLogger( BackupUtilitiesSP.class );\n \n \n-    public static void backupDeleted( LdapContext ctx, LdapDN deletedEntryName,\n-                                      LdapDN operationPrincipal, ServerEntry deletedEntry ) throws NamingException\n+    /**\n+     * A stored procedure that backs up a deleted entry somewhere else in the DIT.\n+     *\n+     * @param session a session to use to perform changes to the DIT\n+     * @param deletedEntry the entry that was deleted\n+     * @throws Exception if there are failures\n+     */\n+    public static void backupDeleted( CoreSession session, ClonedServerEntry deletedEntry ) throws Exception\n     {\n-        LOG.info( \"User \\\"\" + operationPrincipal + \"\\\" has deleted entry \\\"\" + deletedEntryName + \"\\\"\" );\n-        LOG.info( \"Entry content was: \" + deletedEntry );\n-        LdapContext backupCtx = ( LdapContext ) ctx.lookup( \"ou=backupContext,ou=system\" );\n-        String deletedEntryRdn = deletedEntryName.get( deletedEntryName.size() - 1 );\n-        backupCtx.createSubcontext( deletedEntryRdn, ServerEntryUtils.toAttributesImpl( deletedEntry ) );\n-        LOG.info( \"Backed up deleted entry to \\\"\" +\n-                ( ( LdapContext ) backupCtx.lookup( deletedEntryRdn ) ).getNameInNamespace() + \"\\\"\" );\n+        LOG.info( \"User \\\"\" + session.getEffectivePrincipal() + \"\\\" has deleted entry \\\"\" + deletedEntry + \"\\\"\" );\n+        LdapDN backupDn = new LdapDN ( \"ou=backupContext,ou=system\" );\n+        String deletedEntryRdn = deletedEntry.getDn().get( deletedEntry.getDn().size() - 1 );\n+        ServerEntry entry = ( ServerEntry ) deletedEntry.getOriginalEntry().clone();\n+        backupDn.add( deletedEntryRdn );\n+        entry.setDn( backupDn );\n+        session.add( deletedEntry );\n+        LOG.info( \"Backed up deleted entry to \\\"\" + backupDn + \"\\\"\" );\n     }\n }"
            },
            {
                "sha": "3be84cd13b36dd6e77271ea866cfcfaf07c88a4b",
                "filename": "core-integ/src/test/java/org/apache/directory/server/core/trigger/TriggerInterceptorIT.java",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/apache/directory-server/blob/da075a6cccb347609591dc140d4414b67fd49fe7/core-integ/src/test/java/org/apache/directory/server/core/trigger/TriggerInterceptorIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/da075a6cccb347609591dc140d4414b67fd49fe7/core-integ/src/test/java/org/apache/directory/server/core/trigger/TriggerInterceptorIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-integ/src/test/java/org/apache/directory/server/core/trigger/TriggerInterceptorIT.java?ref=da075a6cccb347609591dc140d4414b67fd49fe7",
                "patch": "@@ -31,6 +31,8 @@\n import org.apache.directory.shared.ldap.util.AttributeUtils;\n import static org.junit.Assert.assertNotNull;\n import static org.junit.Assert.assertTrue;\n+\n+import org.junit.Ignore;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n \n@@ -46,6 +48,7 @@\n  * @version $Rev:$\n  */\n @RunWith ( CiRunner.class )\n+@Ignore\n public class TriggerInterceptorIT\n {\n     public static DirectoryService service;\n@@ -93,6 +96,9 @@ public void testAfterDeleteBackupDeletedEntryEntryTrigger() throws Exception\n         // Create the Entry Trigger Specification.\n         TriggerUtils.defineTriggerExecutionSpecificPoint( sysRoot );\n         LdapContext entry = ( LdapContext ) sysRoot.lookup( \"ou=testEntry\" );\n+        \n+        // TODO - change the spec to make this pass\n+        \n         String triggerSpec = \"AFTER Delete CALL \\\"\" + BackupUtilitiesSP.class.getName() +\n             \":backupDeleted\\\" ( $ldapContext \\\"\\\", $name, $operationPrincipal, $deletedEntry );\";\n         TriggerUtils.loadEntryTriggerSpecification( entry, triggerSpec );"
            },
            {
                "sha": "d3838f8854954bd0585d201be1f62d47fb2ed0c4",
                "filename": "core/src/main/java/org/apache/directory/server/core/sp/StoredProcExecutionManager.java",
                "status": "modified",
                "additions": 4,
                "deletions": 5,
                "changes": 9,
                "blob_url": "https://github.com/apache/directory-server/blob/da075a6cccb347609591dc140d4414b67fd49fe7/core/src/main/java/org/apache/directory/server/core/sp/StoredProcExecutionManager.java",
                "raw_url": "https://github.com/apache/directory-server/raw/da075a6cccb347609591dc140d4414b67fd49fe7/core/src/main/java/org/apache/directory/server/core/sp/StoredProcExecutionManager.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/sp/StoredProcExecutionManager.java?ref=da075a6cccb347609591dc140d4414b67fd49fe7",
                "patch": "@@ -22,7 +22,6 @@\n \n import org.apache.directory.server.core.CoreSession;\n import org.apache.directory.server.core.entry.ClonedServerEntry;\n-import org.apache.directory.server.core.entry.ServerEntry;\n import org.apache.directory.server.core.entry.ServerStringValue;\n import org.apache.directory.server.core.filtering.EntryFilteringCursor;\n import org.apache.directory.shared.ldap.constants.SchemaConstants;\n@@ -79,7 +78,7 @@ public StoredProcExecutionManager( final String storedProcContainer, final List<\n      * @return The entry associated with the SP Unit.\n      * @throws NamingException If the unit cannot be located or any other error occurs.\n      */\n-    public ServerEntry findStoredProcUnit( CoreSession session, String fullSPName ) throws Exception\n+    public ClonedServerEntry findStoredProcUnit( CoreSession session, String fullSPName ) throws Exception\n     {\n         SearchControls controls = new SearchControls();\n         controls.setReturningAttributes( SchemaConstants.ALL_USER_ATTRIBUTES_ARRAY );\n@@ -111,9 +110,9 @@ public ServerEntry findStoredProcUnit( CoreSession session, String fullSPName )\n      * @return A {@link StoredProcEngine} associated with spUnitEntry.\n      * @throws NamingException If no {@link StoredProcEngine} that can be associated with the language identifier in spUnitEntry can be found.\n      */\n-    public StoredProcEngine getStoredProcEngineInstance( ServerEntry spUnitEntry ) throws NamingException\n+    public StoredProcEngine getStoredProcEngineInstance( ClonedServerEntry spUnitEntry ) throws NamingException\n     {\n-        String spLangId = ( String ) spUnitEntry.get( \"storedProcLangId\" ).getString();\n+        String spLangId = ( String ) spUnitEntry.getOriginalEntry().get( \"storedProcLangId\" ).getString();\n \n         for ( StoredProcEngineConfig engineConfig : storedProcEngineConfigs )\n         {\n@@ -139,7 +138,7 @@ public StoredProcEngine getStoredProcEngineInstance( ServerEntry spUnitEntry ) t\n                     throw ne;\n                 }\n                 \n-                engine.setSPUnitEntry( spUnitEntry );\n+                engine.setSPUnitEntry( spUnitEntry.getOriginalEntry() );\n                 return engine;\n             }\n "
            },
            {
                "sha": "ea8c327c80f3f4fb08c8140d3d91f344992506f4",
                "filename": "core/src/main/java/org/apache/directory/server/core/trigger/TriggerInterceptor.java",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/apache/directory-server/blob/da075a6cccb347609591dc140d4414b67fd49fe7/core/src/main/java/org/apache/directory/server/core/trigger/TriggerInterceptor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/da075a6cccb347609591dc140d4414b67fd49fe7/core/src/main/java/org/apache/directory/server/core/trigger/TriggerInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/trigger/TriggerInterceptor.java?ref=da075a6cccb347609591dc140d4414b67fd49fe7",
                "patch": "@@ -29,7 +29,6 @@\n import org.apache.directory.server.core.interceptor.NextInterceptor;\n import org.apache.directory.server.core.interceptor.context.AddOperationContext;\n import org.apache.directory.server.core.interceptor.context.DeleteOperationContext;\n-import org.apache.directory.server.core.interceptor.context.LookupOperationContext;\n import org.apache.directory.server.core.interceptor.context.ModifyOperationContext;\n import org.apache.directory.server.core.interceptor.context.MoveAndRenameOperationContext;\n import org.apache.directory.server.core.interceptor.context.MoveOperationContext;\n@@ -600,7 +599,7 @@ private Object executeProcedure( OperationContext opContext, String procedure, O\n         \n         try\n         {\n-            ServerEntry spUnit = manager.findStoredProcUnit( opContext.getSession(), procedure );\n+            ClonedServerEntry spUnit = manager.findStoredProcUnit( opContext.getSession(), procedure );\n             StoredProcEngine engine = manager.getStoredProcEngineInstance( spUnit );\n             return engine.invokeProcedure( opContext.getSession(), procedure, values );\n         }"
            },
            {
                "sha": "0ddf282e507e98047319ccb3715fa6a7cba96d6d",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/extended/StoredProcedureExtendedOperationHandler.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/directory-server/blob/da075a6cccb347609591dc140d4414b67fd49fe7/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/extended/StoredProcedureExtendedOperationHandler.java",
                "raw_url": "https://github.com/apache/directory-server/raw/da075a6cccb347609591dc140d4414b67fd49fe7/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/extended/StoredProcedureExtendedOperationHandler.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/extended/StoredProcedureExtendedOperationHandler.java?ref=da075a6cccb347609591dc140d4414b67fd49fe7",
                "patch": "@@ -36,7 +36,7 @@\n \n import org.apache.commons.lang.SerializationUtils;\n import org.apache.directory.server.core.CoreSession;\n-import org.apache.directory.server.core.entry.ServerEntry;\n+import org.apache.directory.server.core.entry.ClonedServerEntry;\n import org.apache.directory.server.core.jndi.ServerLdapContext;\n import org.apache.directory.server.core.sp.StoredProcEngine;\n import org.apache.directory.server.core.sp.StoredProcEngineConfig;\n@@ -102,7 +102,7 @@ public void handleExtendedOperation( IoSession session, SessionRegistry registry\n         \n         String procedure = StringTools.utf8ToString( spBean.getProcedure() );\n         CoreSession coreSession = ctx.getService().getSession( ctx.getPrincipal() );\n-        ServerEntry spUnit = manager.findStoredProcUnit( coreSession, procedure );\n+        ClonedServerEntry spUnit = manager.findStoredProcUnit( coreSession, procedure );\n         StoredProcEngine engine = manager.getStoredProcEngineInstance( spUnit );\n         \n         List<Object> valueList = new ArrayList<Object>( spBean.getParameters().size() );"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/ccd2783f7f19003081029a11fe1545fcb55fe377",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/28ce5fc1dc6f9549cb907e8ca3ac0a1dbc21e034",
        "message": "fixing bug breaking mitosis when it expects a null return from the lookup() operation instead of throwing a NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/bigbang@660400 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_79",
        "file": [
            {
                "sha": "d10e05dd427a36f5aaef488d4394ecd84ed75f71",
                "filename": "core/src/main/java/org/apache/directory/server/core/partition/impl/btree/BTreePartition.java",
                "status": "modified",
                "additions": 8,
                "deletions": 1,
                "changes": 9,
                "blob_url": "https://github.com/apache/directory-server/blob/ccd2783f7f19003081029a11fe1545fcb55fe377/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/BTreePartition.java",
                "raw_url": "https://github.com/apache/directory-server/raw/ccd2783f7f19003081029a11fe1545fcb55fe377/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/BTreePartition.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/BTreePartition.java?ref=ccd2783f7f19003081029a11fe1545fcb55fe377",
                "patch": "@@ -287,7 +287,14 @@ public EntryFilteringCursor search( SearchOperationContext opContext ) throws Ex\n \n     public ClonedServerEntry lookup( LookupOperationContext opContext ) throws Exception\n     {\n-        ClonedServerEntry entry = lookup( getEntryId( opContext.getDn().getNormName() ) );\n+        Long id = getEntryId( opContext.getDn().getNormName() );\n+        \n+        if ( id == null )\n+        {\n+            return null;\n+        }\n+        \n+        ClonedServerEntry entry = lookup( id );\n \n         if ( ( opContext.getAttrsId() == null ) || ( opContext.getAttrsId().size() == 0 ) )\n         {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/6a739a91b41542f77cf697dc00d789d90c358213",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/281c842057d8f49d5200ac4d59865c6d442e608f",
        "message": "fixed an NPE in CursorBuilder.buildAndCursor()\nAndCursorTest - added test cases for AndCursor\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/sandbox/akarasulu/bigbang/apacheds@653606 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_80",
        "file": [
            {
                "sha": "06060ba4adcc9469e9a4d678403f2bc22e50f12d",
                "filename": "xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/CursorBuilder.java",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/apache/directory-server/blob/6a739a91b41542f77cf697dc00d789d90c358213/xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/CursorBuilder.java",
                "raw_url": "https://github.com/apache/directory-server/raw/6a739a91b41542f77cf697dc00d789d90c358213/xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/CursorBuilder.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/xdbm-search/src/main/java/org/apache/directory/server/xdbm/search/impl/CursorBuilder.java?ref=6a739a91b41542f77cf697dc00d789d90c358213",
                "patch": "@@ -159,7 +159,12 @@ public CursorBuilder( Store<Attributes> db, EvaluatorBuilder evaluatorBuilder )\n         for ( int ii = 0; ii < children.size(); ii++ )\n         {\n             ExprNode child = children.get( ii );\n-            value = ( Long ) child.get( \"count\" );\n+            Object count = child.get( \"count\" );\n+            if( count == null )\n+            {\n+                continue;\n+            }\n+            value = ( Long ) count;\n             minValue = Math.min( minValue, value );\n \n             if ( minValue == value )"
            },
            {
                "sha": "6d9895b00245f0ff815323d89dfb247b9d548c3b",
                "filename": "xdbm-search/src/test/java/org/apache/directory/server/xdbm/search/impl/AndCursorTest.java",
                "status": "added",
                "additions": 279,
                "deletions": 0,
                "changes": 279,
                "blob_url": "https://github.com/apache/directory-server/blob/6a739a91b41542f77cf697dc00d789d90c358213/xdbm-search/src/test/java/org/apache/directory/server/xdbm/search/impl/AndCursorTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/6a739a91b41542f77cf697dc00d789d90c358213/xdbm-search/src/test/java/org/apache/directory/server/xdbm/search/impl/AndCursorTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/xdbm-search/src/test/java/org/apache/directory/server/xdbm/search/impl/AndCursorTest.java?ref=6a739a91b41542f77cf697dc00d789d90c358213",
                "patch": "@@ -0,0 +1,279 @@\n+/*\n+ *  Licensed to the Apache Software Foundation (ASF) under one\n+ *  or more contributor license agreements.  See the NOTICE file\n+ *  distributed with this work for additional information\n+ *  regarding copyright ownership.  The ASF licenses this file\n+ *  to you under the Apache License, Version 2.0 (the\n+ *  \"License\"); you may not use this file except in compliance\n+ *  with the License.  You may obtain a copy of the License at\n+ *  \n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *  \n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License. \n+ *  \n+ */\n+package org.apache.directory.server.xdbm.search.impl;\n+\n+import static org.junit.Assert.*;\n+\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+\n+import javax.naming.directory.Attributes;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.apache.directory.server.core.cursor.Cursor;\n+import org.apache.directory.server.core.cursor.InvalidCursorPositionException;\n+import org.apache.directory.server.core.partition.impl.btree.jdbm.JdbmIndex;\n+import org.apache.directory.server.core.partition.impl.btree.jdbm.JdbmStore;\n+import org.apache.directory.server.schema.SerializableComparator;\n+import org.apache.directory.server.schema.bootstrap.ApacheSchema;\n+import org.apache.directory.server.schema.bootstrap.ApachemetaSchema;\n+import org.apache.directory.server.schema.bootstrap.BootstrapSchemaLoader;\n+import org.apache.directory.server.schema.bootstrap.CollectiveSchema;\n+import org.apache.directory.server.schema.bootstrap.CoreSchema;\n+import org.apache.directory.server.schema.bootstrap.Schema;\n+import org.apache.directory.server.schema.bootstrap.SystemSchema;\n+import org.apache.directory.server.schema.registries.AttributeTypeRegistry;\n+import org.apache.directory.server.schema.registries.DefaultOidRegistry;\n+import org.apache.directory.server.schema.registries.DefaultRegistries;\n+import org.apache.directory.server.schema.registries.OidRegistry;\n+import org.apache.directory.server.schema.registries.Registries;\n+import org.apache.directory.server.xdbm.ForwardIndexEntry;\n+import org.apache.directory.server.xdbm.IndexEntry;\n+import org.apache.directory.server.xdbm.Store;\n+import org.apache.directory.server.xdbm.tools.StoreUtils;\n+import org.apache.directory.shared.ldap.constants.SchemaConstants;\n+import org.apache.directory.shared.ldap.filter.AndNode;\n+import org.apache.directory.shared.ldap.filter.ExprNode;\n+import org.apache.directory.shared.ldap.filter.FilterParser;\n+import org.apache.directory.shared.ldap.filter.PresenceNode;\n+import org.apache.directory.shared.ldap.filter.SubstringNode;\n+import org.junit.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * \n+ * Test class for AndCursor.\n+ *\n+ * @author <a href=\"mailto:dev@directory.apache.org\">Apache Directory Project</a>\n+ * @version $Rev$, $Date$\n+ */\n+public class AndCursorTest\n+{\n+    private static final Logger LOG = LoggerFactory.getLogger( AndCursorTest.class.getSimpleName() );\n+\n+    File wkdir;\n+    Store<Attributes> store;\n+    Registries registries = null;\n+    AttributeTypeRegistry attributeRegistry;\n+    EvaluatorBuilder evaluatorBuilder;\n+    CursorBuilder cursorBuilder;\n+\n+    public AndCursorTest() throws Exception\n+    {\n+        // setup the standard registries\n+        BootstrapSchemaLoader loader = new BootstrapSchemaLoader();\n+        OidRegistry oidRegistry = new DefaultOidRegistry();\n+        registries = new DefaultRegistries( \"bootstrap\", loader, oidRegistry );\n+        SerializableComparator.setRegistry( registries.getComparatorRegistry() );\n+\n+        // load essential bootstrap schemas\n+        Set<Schema> bootstrapSchemas = new HashSet<Schema>();\n+        bootstrapSchemas.add( new ApachemetaSchema() );\n+        bootstrapSchemas.add( new ApacheSchema() );\n+        bootstrapSchemas.add( new CoreSchema() );\n+        bootstrapSchemas.add( new SystemSchema() );\n+        bootstrapSchemas.add( new CollectiveSchema() );\n+        loader.loadWithDependencies( bootstrapSchemas, registries );\n+        attributeRegistry = registries.getAttributeTypeRegistry();\n+    }\n+\n+\n+    @Before\n+    public void createStore() throws Exception\n+    {\n+        destryStore();\n+\n+        // setup the working directory for the store\n+        wkdir = File.createTempFile( getClass().getSimpleName(), \"db\" );\n+        wkdir.delete();\n+        wkdir = new File( wkdir.getParentFile(), getClass().getSimpleName() );\n+        wkdir.mkdirs();\n+\n+        // initialize the store\n+        store = new JdbmStore<Attributes>();\n+        store.setName( \"example\" );\n+        store.setCacheSize( 10 );\n+        store.setWorkingDirectory( wkdir );\n+        store.setSyncOnWrite( false );\n+\n+        store.addIndex( new JdbmIndex( SchemaConstants.OU_AT_OID ) );\n+        store.addIndex( new JdbmIndex( SchemaConstants.CN_AT_OID ) );\n+        StoreUtils.loadExampleData( store, registries );\n+        \n+        evaluatorBuilder = new EvaluatorBuilder( store, registries );\n+        cursorBuilder = new CursorBuilder( store, evaluatorBuilder );\n+        \n+        LOG.debug( \"Created new store\" );\n+    }\n+\n+    \n+    @After\n+    public void destryStore() throws Exception\n+    {\n+        if ( store != null )\n+        {\n+            store.destroy();\n+        }\n+\n+        store = null;\n+        if ( wkdir != null )\n+        {\n+            FileUtils.deleteDirectory( wkdir );\n+        }\n+\n+        wkdir = null;\n+    }\n+\n+    \n+    @Test\n+    public void testAndCursorWithCursorBuilder() throws Exception\n+    {\n+        String filter = \"(&(cn=J*)(sn=*))\";\n+\n+        ExprNode exprNode = FilterParser.parse( filter );\n+        \n+        Cursor<IndexEntry<?,Attributes>> cursor = cursorBuilder.build( exprNode );\n+        \n+        cursor.beforeFirst();\n+\n+        assertTrue( cursor.next() );\n+        assertTrue( cursor.available() );\n+        assertEquals( 8, ( long ) cursor.get().getId() );\n+        assertEquals( \"jack daniels\", cursor.get().getValue() );\n+        \n+        assertTrue( cursor.next() );\n+        assertTrue( cursor.available() );\n+        assertEquals( 6, ( long ) cursor.get().getId() );\n+        assertEquals( \"jim bean\", cursor.get().getValue() );\n+        \n+        assertTrue( cursor.next() );\n+        assertTrue( cursor.available() );\n+        assertEquals( 5, ( long ) cursor.get().getId() );\n+        assertEquals( \"johnny walker\", cursor.get().getValue() );\n+        \n+        assertFalse( cursor.next() );\n+        assertFalse( cursor.available() );\n+        \n+        cursor.close();\n+        assertTrue( cursor.isClosed() );\n+    }\n+    \n+    \n+    @Test\n+    public void testAndCursorWithManualFilter() throws Exception\n+    {\n+        AndNode andNode = new AndNode();\n+        \n+        List<Evaluator<? extends ExprNode,Attributes>> evaluators = new ArrayList<Evaluator<? extends ExprNode,Attributes>>();\n+        Evaluator<? extends ExprNode, Attributes> eval;\n+        \n+        ExprNode exprNode = new SubstringNode( \"cn\", \"J*\", null );\n+        eval = new SubstringEvaluator( ( SubstringNode ) exprNode, store, registries );\n+        Cursor<IndexEntry<?,Attributes>> wrapped = new SubstringCursor( store, ( SubstringEvaluator ) eval );\n+        \n+        /* adding this results in NPE  adding Presence evaluator not \n+         Substring evaluator but adding Substring cursor as wrapped cursor */\n+        // evaluators.add( eval ); \n+        \n+        andNode.addNode( exprNode );\n+        \n+        exprNode = new PresenceNode( \"sn\" );\n+        eval = new PresenceEvaluator( ( PresenceNode ) exprNode, store, registries );\n+        evaluators.add( eval );\n+        \n+        andNode.addNode( exprNode );\n+        \n+        Cursor<IndexEntry<?,Attributes>> cursor = ( Cursor<IndexEntry<?,Attributes>> ) new AndCursor( wrapped, evaluators ); //cursorBuilder.build( andNode );\n+        \n+        cursor.beforeFirst();\n+\n+        assertTrue( cursor.next() );\n+        assertTrue( cursor.available() );\n+        assertEquals( 8, ( long ) cursor.get().getId() );\n+        assertEquals( \"jack daniels\", cursor.get().getValue() );\n+        \n+        cursor.first();\n+        \n+        assertTrue( cursor.next() );\n+        assertTrue( cursor.available() );\n+        assertEquals( 6, ( long ) cursor.get().getId() );\n+        assertEquals( \"jim bean\", cursor.get().getValue() );\n+        \n+        assertTrue( cursor.next() );\n+        assertTrue( cursor.available() );\n+        assertEquals( 5, ( long ) cursor.get().getId() );\n+        assertEquals( \"johnny walker\", cursor.get().getValue() );        \n+        \n+        assertFalse( cursor.next() );\n+        assertFalse( cursor.available() );\n+\n+        cursor.afterLast();\n+        \n+        assertTrue( cursor.previous() );\n+        assertTrue( cursor.available() );\n+        assertEquals( 5, ( long ) cursor.get().getId() );\n+        assertEquals( \"johnny walker\", cursor.get().getValue() );\n+        \n+        cursor.last();\n+        \n+        assertTrue( cursor.previous() );\n+        assertTrue( cursor.available() );\n+        assertEquals( 6, ( long ) cursor.get().getId() );\n+        assertEquals( \"jim bean\", cursor.get().getValue() );\n+        \n+        assertTrue( cursor.previous() );\n+        assertTrue( cursor.available() );\n+        assertEquals( 8, ( long ) cursor.get().getId() );\n+        assertEquals( \"jack daniels\", cursor.get().getValue() );\n+        \n+        assertFalse( cursor.previous() );\n+        assertFalse( cursor.available() );\n+        \n+        assertTrue( cursor.isElementReused() );\n+\n+        try\n+        {\n+            cursor.get();\n+            fail( \"should fail with InvalidCursorPositionException\" );\n+        }\n+        catch( InvalidCursorPositionException ice ) { }\n+        \n+        try\n+        {\n+            cursor.after( new ForwardIndexEntry() );\n+            fail( \"should fail with UnsupportedOperationException \" );\n+        }\n+        catch( UnsupportedOperationException uoe ) {}\n+        \n+        try\n+        {\n+            cursor.before( new ForwardIndexEntry() );\n+            fail( \"should fail with UnsupportedOperationException \" );\n+        }\n+        catch( UnsupportedOperationException uoe ) {}\n+\n+    }\n+    \n+    \n+}"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/fd9a6ba219000fbbdf1e89ab0f46903824963330",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/f3bf61c33232aa1bdf02bc4c169f1ab49ea7a64d",
        "message": "fixing some issues with the abstract test which was resulting in NPE due to order of setUp commands\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/bigbang@584317 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_81",
        "file": [
            {
                "sha": "3ccc0bc4e3fa0042687d53ae1baaeb7ffe71feed",
                "filename": "server-unit/src/main/java/org/apache/directory/server/unit/AbstractServerTest.java",
                "status": "modified",
                "additions": 4,
                "deletions": 10,
                "changes": 14,
                "blob_url": "https://github.com/apache/directory-server/blob/fd9a6ba219000fbbdf1e89ab0f46903824963330/server-unit/src/main/java/org/apache/directory/server/unit/AbstractServerTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fd9a6ba219000fbbdf1e89ab0f46903824963330/server-unit/src/main/java/org/apache/directory/server/unit/AbstractServerTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-unit/src/main/java/org/apache/directory/server/unit/AbstractServerTest.java?ref=fd9a6ba219000fbbdf1e89ab0f46903824963330",
                "patch": "@@ -109,11 +109,6 @@\n             return EMPTY_LIST;\n         }\n         \n-//        if ( ! apacheDS.isStarted() )\n-//        {\n-//            throw new ConfigurationException( \"The server has not been started - cannot add entries.\" );\n-//        }\n-        \n         LdifReader ldifReader = new LdifReader( in );\n         List<Entry> entries = new ArrayList<Entry>();\n         while ( ldifReader.hasNext() )\n@@ -229,17 +224,16 @@ protected void setUp() throws Exception\n         start++;\n         directoryService = new DefaultDirectoryService();\n         directoryService.setShutdownHookEnabled( false );\n+        socketAcceptor = new SocketAcceptor( null );\n+        ldapServer = new LdapServer( socketAcceptor, directoryService );\n+        ldapServer.setIpPort( port = AvailablePortFinder.getNextAvailable( 1024 ) );\n+\n         doDelete( directoryService.getWorkingDirectory() );\n         configureDirectoryService();\n         directoryService.startup();\n-        port = AvailablePortFinder.getNextAvailable( 1024 );\n \n-        socketAcceptor = new SocketAcceptor( null );\n-        ldapServer = new LdapServer( socketAcceptor, directoryService );\n-        ldapServer.setIpPort( port );\n         configureLdapServer();\n         ldapServer.start();\n-\n         setContexts( \"uid=admin,ou=system\", \"secret\" );\n     }\n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/d8feaf49d2e7d24250cf1d7836f45659062df429",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/ad252e64f16b801a17cd0af6ac623e4fc3151c01",
        "message": "Injected the modifications which fix MR NPE  from trunk to bigbang\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/bigbang@583177 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_82",
        "file": [
            {
                "sha": "aeeda1cb9fba921f702d26690f32faaefdc66c8b",
                "filename": "core/src/main/java/org/apache/directory/server/core/event/LeafEvaluator.java",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/apache/directory-server/blob/d8feaf49d2e7d24250cf1d7836f45659062df429/core/src/main/java/org/apache/directory/server/core/event/LeafEvaluator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/d8feaf49d2e7d24250cf1d7836f45659062df429/core/src/main/java/org/apache/directory/server/core/event/LeafEvaluator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/event/LeafEvaluator.java?ref=d8feaf49d2e7d24250cf1d7836f45659062df429",
                "patch": "@@ -341,16 +341,24 @@ private MatchingRule getMatchingRule( String attrId, int matchType ) throws Nami\n             case ( EQUALITY_MATCH ):\n                 mrule = type.getEquality();\n                 break;\n+                \n             case ( SUBSTRING_MATCH ):\n                 mrule = type.getSubstr();\n                 break;\n+                \n             case ( ORDERING_MATCH ):\n                 mrule = type.getOrdering();\n                 break;\n+                \n             default:\n                 throw new NamingException( \"Unknown match type: \" + matchType );\n         }\n \n+        if ( ( mrule == null ) && ( matchType != EQUALITY_MATCH ) )\n+        {\n+            mrule = type.getEquality();\n+        }\n+\n         return mrule;\n     }\n }"
            },
            {
                "sha": "c9b879439f612da5adabeae054615615bbc288c4",
                "filename": "core/src/main/java/org/apache/directory/server/core/event/SubstringEvaluator.java",
                "status": "modified",
                "additions": 10,
                "deletions": 1,
                "changes": 11,
                "blob_url": "https://github.com/apache/directory-server/blob/d8feaf49d2e7d24250cf1d7836f45659062df429/core/src/main/java/org/apache/directory/server/core/event/SubstringEvaluator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/d8feaf49d2e7d24250cf1d7836f45659062df429/core/src/main/java/org/apache/directory/server/core/event/SubstringEvaluator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/event/SubstringEvaluator.java?ref=d8feaf49d2e7d24250cf1d7836f45659062df429",
                "patch": "@@ -33,6 +33,7 @@\n import org.apache.directory.shared.ldap.filter.ExprNode;\n import org.apache.directory.shared.ldap.filter.SubstringNode;\n import org.apache.directory.shared.ldap.schema.AttributeType;\n+import org.apache.directory.shared.ldap.schema.MatchingRule;\n import org.apache.directory.shared.ldap.schema.Normalizer;\n \n \n@@ -72,7 +73,15 @@ public boolean evaluate( ExprNode node, String dn, Attributes entry ) throws Nam\n         SubstringNode snode = (SubstringNode)node;\n         String oid = oidRegistry.getOid( snode.getAttribute() );\n         AttributeType type = attributeTypeRegistry.lookup( oid );\n-        Normalizer normalizer = type.getSubstr().getNormalizer();\n+        MatchingRule matchingRule = type.getSubstr();\n+        \n+        if ( matchingRule == null )\n+        {\n+            matchingRule = type.getEquality();\n+        }\n+        \n+        Normalizer normalizer = matchingRule.getNormalizer();\n+        \n \n         // get the attribute\n         Attribute attr = entry.get( snode.getAttribute() );"
            },
            {
                "sha": "3c2a9e224bd08d89e09ee8371fa504ebb7ba444d",
                "filename": "core/src/main/java/org/apache/directory/server/core/partition/impl/btree/LeafEvaluator.java",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/apache/directory-server/blob/d8feaf49d2e7d24250cf1d7836f45659062df429/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/LeafEvaluator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/d8feaf49d2e7d24250cf1d7836f45659062df429/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/LeafEvaluator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/LeafEvaluator.java?ref=d8feaf49d2e7d24250cf1d7836f45659062df429",
                "patch": "@@ -346,7 +346,6 @@ private boolean evalPresence( String attrId, IndexRecord rec ) throws NamingExce\n             // this attribute type : as the AT was indexed, we\n             // have a direct access to the entry.\n             if ( idx.hasValue( attrId, rec.getEntryId() ) )\n-                ;\n             {\n                 return true;\n             }"
            },
            {
                "sha": "16dc0fd9b9305d3bfd6afcf4dfd4a32d25668eec",
                "filename": "core/src/main/java/org/apache/directory/server/core/partition/impl/btree/SubstringEnumerator.java",
                "status": "modified",
                "additions": 10,
                "deletions": 1,
                "changes": 11,
                "blob_url": "https://github.com/apache/directory-server/blob/d8feaf49d2e7d24250cf1d7836f45659062df429/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/SubstringEnumerator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/d8feaf49d2e7d24250cf1d7836f45659062df429/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/SubstringEnumerator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/SubstringEnumerator.java?ref=d8feaf49d2e7d24250cf1d7836f45659062df429",
                "patch": "@@ -30,6 +30,7 @@\n import org.apache.directory.shared.ldap.filter.ExprNode;\n import org.apache.directory.shared.ldap.filter.SubstringNode;\n import org.apache.directory.shared.ldap.schema.AttributeType;\n+import org.apache.directory.shared.ldap.schema.MatchingRule;\n import org.apache.directory.shared.ldap.schema.Normalizer;\n \n \n@@ -79,7 +80,15 @@ public SubstringEnumerator(BTreePartition db, AttributeTypeRegistry attributeTyp\n         Index idx = null;\n         final SubstringNode snode = ( SubstringNode ) node;\n         AttributeType type = attributeTypeRegistry.lookup( snode.getAttribute() );\n-        Normalizer normalizer = type.getSubstr().getNormalizer();\n+\n+        MatchingRule matchingRule = type.getSubstr();\n+\n+        if ( matchingRule == null )\n+        {\n+            matchingRule = type.getEquality();\n+        }\n+        \n+        Normalizer normalizer = matchingRule.getNormalizer();\n \n         if ( db.hasUserIndexOn( snode.getAttribute() ) )\n         {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/f71d06a8ae6673d999fbcefd400cc6dc3517ba5d",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/9e30d818ed2fbab98d70de2ba6d596b0abb91579",
        "message": "When the MatchinRule is null, returns the Equality MR a s a default, to avoid NPEs\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@582874 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_83",
        "file": [
            {
                "sha": "a31fe6c0217b68ea944b2232b34e574ba290578e",
                "filename": "core/src/main/java/org/apache/directory/server/core/event/LeafEvaluator.java",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/apache/directory-server/blob/f71d06a8ae6673d999fbcefd400cc6dc3517ba5d/core/src/main/java/org/apache/directory/server/core/event/LeafEvaluator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/f71d06a8ae6673d999fbcefd400cc6dc3517ba5d/core/src/main/java/org/apache/directory/server/core/event/LeafEvaluator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/event/LeafEvaluator.java?ref=f71d06a8ae6673d999fbcefd400cc6dc3517ba5d",
                "patch": "@@ -305,6 +305,7 @@ private boolean evalEquality( EqualityNode node, Attributes entry ) throws Namin\n     private Comparator getComparator( String attrId ) throws NamingException\n     {\n         MatchingRule mrule = getMatchingRule( attrId, EQUALITY_MATCH );\n+\n         return mrule.getComparator();\n     }\n \n@@ -341,16 +342,24 @@ private MatchingRule getMatchingRule( String attrId, int matchType ) throws Nami\n             case ( EQUALITY_MATCH ):\n                 mrule = type.getEquality();\n                 break;\n+                \n             case ( SUBSTRING_MATCH ):\n                 mrule = type.getSubstr();\n                 break;\n+                \n             case ( ORDERING_MATCH ):\n                 mrule = type.getOrdering();\n                 break;\n+                \n             default:\n                 throw new NamingException( \"Unknown match type: \" + matchType );\n         }\n \n+        if ( mrule == null )\n+        {\n+            return type.getEquality();\n+        }\n+        \n         return mrule;\n     }\n }"
            },
            {
                "sha": "fcfe675a6177cb44dede7ad6c7b069c36dd14cdf",
                "filename": "core/src/main/java/org/apache/directory/server/core/event/SubstringEvaluator.java",
                "status": "modified",
                "additions": 9,
                "deletions": 1,
                "changes": 10,
                "blob_url": "https://github.com/apache/directory-server/blob/f71d06a8ae6673d999fbcefd400cc6dc3517ba5d/core/src/main/java/org/apache/directory/server/core/event/SubstringEvaluator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/f71d06a8ae6673d999fbcefd400cc6dc3517ba5d/core/src/main/java/org/apache/directory/server/core/event/SubstringEvaluator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/event/SubstringEvaluator.java?ref=f71d06a8ae6673d999fbcefd400cc6dc3517ba5d",
                "patch": "@@ -33,6 +33,7 @@\n import org.apache.directory.shared.ldap.filter.ExprNode;\n import org.apache.directory.shared.ldap.filter.SubstringNode;\n import org.apache.directory.shared.ldap.schema.AttributeType;\n+import org.apache.directory.shared.ldap.schema.MatchingRule;\n import org.apache.directory.shared.ldap.schema.Normalizer;\n \n \n@@ -72,7 +73,14 @@ public boolean evaluate( ExprNode node, String dn, Attributes entry ) throws Nam\n         SubstringNode snode = (SubstringNode)node;\n         String oid = oidRegistry.getOid( snode.getAttribute() );\n         AttributeType type = attributeTypeRegistry.lookup( oid );\n-        Normalizer normalizer = type.getSubstr().getNormalizer();\n+        MatchingRule matchingRule = type.getSubstr();\n+        \n+        if ( matchingRule == null )\n+        {\n+            matchingRule = type.getEquality();\n+        }\n+        \n+        Normalizer normalizer = matchingRule.getNormalizer();\n \n         // get the attribute\n         Attribute attr = entry.get( snode.getAttribute() );"
            },
            {
                "sha": "eefc7d3b0eb1e73ddcbde567506c28e275339e9c",
                "filename": "core/src/main/java/org/apache/directory/server/core/partition/impl/btree/SubstringEnumerator.java",
                "status": "modified",
                "additions": 9,
                "deletions": 1,
                "changes": 10,
                "blob_url": "https://github.com/apache/directory-server/blob/f71d06a8ae6673d999fbcefd400cc6dc3517ba5d/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/SubstringEnumerator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/f71d06a8ae6673d999fbcefd400cc6dc3517ba5d/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/SubstringEnumerator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/SubstringEnumerator.java?ref=f71d06a8ae6673d999fbcefd400cc6dc3517ba5d",
                "patch": "@@ -30,6 +30,7 @@\n import org.apache.directory.shared.ldap.filter.ExprNode;\n import org.apache.directory.shared.ldap.filter.SubstringNode;\n import org.apache.directory.shared.ldap.schema.AttributeType;\n+import org.apache.directory.shared.ldap.schema.MatchingRule;\n import org.apache.directory.shared.ldap.schema.Normalizer;\n \n \n@@ -79,7 +80,14 @@ public SubstringEnumerator(BTreePartition db, AttributeTypeRegistry attributeTyp\n         Index idx = null;\n         final SubstringNode snode = ( SubstringNode ) node;\n         AttributeType type = attributeTypeRegistry.lookup( snode.getAttribute() );\n-        Normalizer normalizer = type.getSubstr().getNormalizer();\n+        MatchingRule matchingRule = type.getSubstr();\n+        \n+        if ( matchingRule == null )\n+        {\n+            matchingRule = type.getEquality();\n+        }\n+        \n+        Normalizer normalizer = matchingRule.getNormalizer();\n \n         if ( db.hasUserIndexOn( snode.getAttribute() ) )\n         {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/0a488a00a01840252e1e3732a584c83cfbda374e",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/d1cdab28be2cfb784ee19a4f22491e2acb77db21",
        "message": "Switching from long to Long because it can generate some NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@580801 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_84",
        "file": [
            {
                "sha": "3748a8dd705af4c3159fef45820552ffc55f246d",
                "filename": "core/src/main/java/org/apache/directory/server/core/partition/impl/btree/DefaultOptimizer.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/0a488a00a01840252e1e3732a584c83cfbda374e/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/DefaultOptimizer.java",
                "raw_url": "https://github.com/apache/directory-server/raw/0a488a00a01840252e1e3732a584c83cfbda374e/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/DefaultOptimizer.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/DefaultOptimizer.java?ref=0a488a00a01840252e1e3732a584c83cfbda374e",
                "patch": "@@ -76,7 +76,7 @@ public DefaultOptimizer(BTreePartition db)\n     public void annotate( ExprNode node ) throws NamingException\n     {\n         // Start off with the worst case unless scan count says otherwise.\n-        long count = Long.MAX_VALUE;\n+        Long count = Long.MAX_VALUE;\n \n         /* --------------------------------------------------------------------\n          *                 H A N D L E   L E A F   N O D E S          "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/15486cb612705a4ce33f60f047bcbaeced6c9052",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/0702c27fab1b88c86813257e80f74d033e47e8e3",
        "message": "Added some defensive code to avoid NPE if the attrsId is null\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@578126 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_85",
        "file": [
            {
                "sha": "8741a541bb9ee9ff115ea1b932dd4ebf404a6c33",
                "filename": "core/src/main/java/org/apache/directory/server/core/interceptor/context/LookupOperationContext.java",
                "status": "modified",
                "additions": 9,
                "deletions": 2,
                "changes": 11,
                "blob_url": "https://github.com/apache/directory-server/blob/15486cb612705a4ce33f60f047bcbaeced6c9052/core/src/main/java/org/apache/directory/server/core/interceptor/context/LookupOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/15486cb612705a4ce33f60f047bcbaeced6c9052/core/src/main/java/org/apache/directory/server/core/interceptor/context/LookupOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/interceptor/context/LookupOperationContext.java?ref=15486cb612705a4ce33f60f047bcbaeced6c9052",
                "patch": "@@ -92,8 +92,15 @@ public LookupOperationContext( LdapDN dn, String attrsId[] )\n      */\n     public String[] getAttrsIdArray()\n     {\n-        String[] attrs = new String[ attrsId.size()];\n-        return attrsId.toArray( attrs );\n+        if ( attrsId == null )\n+        {\n+            return new String[]{};\n+        }\n+        else\n+        {\n+            String[] attrs = new String[ attrsId.size()];\n+            return attrsId.toArray( attrs );\n+        }\n     }\n \n     /**"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/364c1d5e0e3f44686a319441ce2f84f18a8bcc65",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/d1f3aba2512bc2f02e06db05e5f9cff15f2ad0ca",
        "message": "Fix for DIRSERVER-987 : a bad initialization sequence was the cause of the NPE. My fault ...\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@566423 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_86",
        "file": [
            {
                "sha": "fd40f59f8bd0204a7daab8ce6f7a53c013e172ad",
                "filename": "core/src/main/java/org/apache/directory/server/core/authz/TupleCache.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/364c1d5e0e3f44686a319441ce2f84f18a8bcc65/core/src/main/java/org/apache/directory/server/core/authz/TupleCache.java",
                "raw_url": "https://github.com/apache/directory-server/raw/364c1d5e0e3f44686a319441ce2f84f18a8bcc65/core/src/main/java/org/apache/directory/server/core/authz/TupleCache.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/authz/TupleCache.java?ref=364c1d5e0e3f44686a319441ce2f84f18a8bcc65",
                "patch": "@@ -112,8 +112,8 @@ public TupleCache( DirectoryServiceConfiguration factoryCfg ) throws NamingExcep\n         NameComponentNormalizer ncn = new ConcreteNameComponentNormalizer( attributeTypeRegistry, oidRegistry );\n         aciParser = new ACIItemParser( ncn, normalizerMap );\n         env = ( Hashtable ) factoryCfg.getEnvironment().clone();\n-        initialize();\n         prescriptiveAciAT = attributeTypeRegistry.lookup( SchemaConstants.PRESCRIPTIVE_ACI_AT ); \n+        initialize();\n     }\n \n     "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/91e774615af5089b6aa2a530e94a83eb67f14db4",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/42ece7b02d9b79bbba8a4a86eed996ca7557f22a",
        "message": "Fixed a NPE when the user send an Attributes without any \"ObjecClass\" attribute\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@546021 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_87",
        "file": [
            {
                "sha": "f6c6d77b81ed3e4da9c4195bf6fe7d2e967d60c7",
                "filename": "core/src/main/java/org/apache/directory/server/core/schema/SchemaService.java",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/apache/directory-server/blob/91e774615af5089b6aa2a530e94a83eb67f14db4/core/src/main/java/org/apache/directory/server/core/schema/SchemaService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/91e774615af5089b6aa2a530e94a83eb67f14db4/core/src/main/java/org/apache/directory/server/core/schema/SchemaService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/schema/SchemaService.java?ref=91e774615af5089b6aa2a530e94a83eb67f14db4",
                "patch": "@@ -1687,6 +1687,15 @@ private void check( LdapDN dn, Attributes entry ) throws NamingException\n         // 3-2) or if the AttributeType is COLLECTIVE\n         // 4) We also check that for H-R attributes, we have a valid String in the values\n         Attribute objectClassAttr = entry.get( SchemaConstants.OBJECT_CLASS_AT );\n+        \n+        // Protect the server against a null objectClassAttr\n+        // It can be the case if the user forgot to add it to the entry ...\n+        // In this case, we create an new one, empty\n+        if ( objectClassAttr == null )\n+        {\n+            objectClassAttr = new AttributeImpl( SchemaConstants.OBJECT_CLASS_AT );\n+        }\n+        \n         List<ObjectClass> ocs = new ArrayList<ObjectClass>();\n \n         alterObjectClasses( objectClassAttr );"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/87c17a6d5d9ec6f9b54379de97cc7600ca5d825a",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/71dadf8fd95717b4a5b25893a35a7ac780810db5",
        "message": "fix npe due to lack of check for attribute and cleaned up javadocs\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/directory/apacheds/trunk@153145 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_88",
        "file": [
            {
                "sha": "dfe84a4ca520fca84c0cf354a4b51bc11768ec76",
                "filename": "core/src/main/java/org/apache/ldap/server/db/jdbm/JdbmDatabase.java",
                "status": "modified",
                "additions": 14,
                "deletions": 3,
                "changes": 17,
                "blob_url": "https://github.com/apache/directory-server/blob/87c17a6d5d9ec6f9b54379de97cc7600ca5d825a/core/src/main/java/org/apache/ldap/server/db/jdbm/JdbmDatabase.java",
                "raw_url": "https://github.com/apache/directory-server/raw/87c17a6d5d9ec6f9b54379de97cc7600ca5d825a/core/src/main/java/org/apache/ldap/server/db/jdbm/JdbmDatabase.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/ldap/server/db/jdbm/JdbmDatabase.java?ref=87c17a6d5d9ec6f9b54379de97cc7600ca5d825a",
                "patch": "@@ -38,7 +38,9 @@\n import jdbm.recman.CacheRecordManager;\n import org.apache.ldap.common.MultiException;\n import org.apache.ldap.common.exception.LdapNameNotFoundException;\n+import org.apache.ldap.common.exception.LdapSchemaViolationException;\n import org.apache.ldap.common.message.LockableAttributesImpl;\n+import org.apache.ldap.common.message.ResultCodeEnum;\n import org.apache.ldap.common.name.LdapName;\n import org.apache.ldap.common.schema.AttributeType;\n import org.apache.ldap.common.schema.Normalizer;\n@@ -682,13 +684,22 @@ public void add( String updn, Name dn, Attributes entry ) throws NamingException\n         // don't keep going if we cannot find the parent Id\n         if ( parentId == null )\n         {\n-            throw new LdapNameNotFoundException( \"Id for parent '\" +\n-                    dn.getSuffix( 1 ).toString() + \"' not found!\" );\n+            throw new LdapNameNotFoundException( \"Id for parent '\" + dn.getSuffix( 1 ).toString() + \"' not found!\" );\n+        }\n+\n+        Attribute objectClass = entry.get( \"objectClass\" );\n+\n+        if ( objectClass == null )\n+        {\n+            String msg = \"Entry \" + updn + \" contains no objectClass attribute: \" + entry;\n+\n+            throw new LdapSchemaViolationException( msg, ResultCodeEnum.OBJECTCLASSVIOLATION );\n         }\n \n         // Start adding the system indices\n         // Why bother doing a lookup if this is not an alias.\n-        if ( entry.get( \"objectClass\" ).contains( ALIAS_OBJECT ) ) \n+\n+        if ( entry.get( \"objectClass\" ).contains( ALIAS_OBJECT ) )\n         {\n             addAliasIndices( id, dn, ( String ) entry.get( ALIAS_ATTRIBUTE ).get() );\n         }"
            },
            {
                "sha": "d47d5ae14de915a5cd4ca3b1d58326aefffdd274",
                "filename": "core/src/main/java/org/apache/ldap/server/prefs/ServerPreferencesFactory.java",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/apache/directory-server/blob/87c17a6d5d9ec6f9b54379de97cc7600ca5d825a/core/src/main/java/org/apache/ldap/server/prefs/ServerPreferencesFactory.java",
                "raw_url": "https://github.com/apache/directory-server/raw/87c17a6d5d9ec6f9b54379de97cc7600ca5d825a/core/src/main/java/org/apache/ldap/server/prefs/ServerPreferencesFactory.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/ldap/server/prefs/ServerPreferencesFactory.java?ref=87c17a6d5d9ec6f9b54379de97cc7600ca5d825a",
                "patch": "@@ -20,6 +20,7 @@\n import java.util.prefs.Preferences;\n import java.util.prefs.PreferencesFactory;\n \n+\n import org.apache.ldap.common.NotImplementedException;\n \n "
            },
            {
                "sha": "cdaff0ad283f9c4f7fc184f551b4aae3111dd28b",
                "filename": "core/src/main/java/org/apache/ldap/server/prefs/ServerSystemPreferences.java",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/apache/directory-server/blob/87c17a6d5d9ec6f9b54379de97cc7600ca5d825a/core/src/main/java/org/apache/ldap/server/prefs/ServerSystemPreferences.java",
                "raw_url": "https://github.com/apache/directory-server/raw/87c17a6d5d9ec6f9b54379de97cc7600ca5d825a/core/src/main/java/org/apache/ldap/server/prefs/ServerSystemPreferences.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/ldap/server/prefs/ServerSystemPreferences.java?ref=87c17a6d5d9ec6f9b54379de97cc7600ca5d825a",
                "patch": "@@ -128,9 +128,9 @@ public ServerSystemPreferences( ServerSystemPreferences parent, String name )\n \n \n     /**\n-     * Wrapps this Preferences object as a Dictionary.\n+     * Wrapps this ServerPreferences object as a Dictionary.\n      *\n-     * @return a Dictionary that uses this Preferences object as the underlying backing store\n+     * @return a Dictionary that uses this ServerPreferences object as the underlying backing store\n      */\n     public Dictionary wrapAsDictionary()\n     {\n@@ -139,9 +139,9 @@ public Dictionary wrapAsDictionary()\n \n \n     /**\n-     * Gets access to the LDAP context associated with this Preferences node.\n+     * Gets access to the LDAP context associated with this ServerPreferences node.\n      *\n-     * @return the LDAP context associate with this Preferences node\n+     * @return the LDAP context associate with this ServerPreferences node\n      */\n     LdapContext getLdapContext()\n     {\n@@ -150,10 +150,10 @@ LdapContext getLdapContext()\n \n \n     /**\n-     * Sets up a new Preferences node by injecting the required information\n+     * Sets up a new ServerPreferences node by injecting the required information\n      * such as the node name attribute and the objectClass attribute.\n      *\n-     * @param name the name of the new Preferences node.\n+     * @param name the name of the new ServerPreferences node.\n      */\n     private void setUpNode( String name ) throws NamingException\n     {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/859e0cb55e914e9359e4041162e1d92e3204b211",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/5fa276f9679c60c587032c9bb6c96a7628ed6669",
        "message": "o Added the bind( Dn ) and bind( String ) method in the LdapConnection interface\no Ignored the SASL PLAIN bind test, it's not working in the LdapNeworkConnection\no The testAnonymousBindReques is not anymore ignored, the NPE ha sbeen fixed\no Added a check in the LdapNetworkConnection.bind( username, password ) methods to forbid a call when the password is null but the username is not\no Fixed a NPE in the BindRequestDecorator class\no Updated the BindRequest Javadoc\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1092743 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_89",
        "file": [
            {
                "sha": "0dae4ddcce82d20db62d2134783e137f354c6023",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/LdapCoreSessionConnection.java",
                "status": "modified",
                "additions": 24,
                "deletions": 0,
                "changes": 24,
                "blob_url": "https://github.com/apache/directory-server/blob/859e0cb55e914e9359e4041162e1d92e3204b211/core-api/src/main/java/org/apache/directory/server/core/LdapCoreSessionConnection.java",
                "raw_url": "https://github.com/apache/directory-server/raw/859e0cb55e914e9359e4041162e1d92e3204b211/core-api/src/main/java/org/apache/directory/server/core/LdapCoreSessionConnection.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/LdapCoreSessionConnection.java?ref=859e0cb55e914e9359e4041162e1d92e3204b211",
                "patch": "@@ -1206,6 +1206,21 @@ public BindResponse bind( BindRequest bindRequest ) throws LdapException, IOExce\n     }\n \n \n+    /**\n+     * {@inheritDoc}\n+     */\n+    public BindResponse bind( Dn name ) throws LdapException, IOException\n+    {\n+        byte[] credBytes = StringConstants.EMPTY_BYTES;\n+\n+        BindRequest bindReq = new BindRequestImpl();\n+        bindReq.setName( name );\n+        bindReq.setCredentials( credBytes );\n+\n+        return bind( bindReq );\n+    }\n+\n+\n     /**\n      * {@inheritDoc}\n      */\n@@ -1221,6 +1236,15 @@ public BindResponse bind( Dn name, String credentials ) throws LdapException, IO\n     }\n \n \n+    /**\n+     * {@inheritDoc}\n+     */\n+    public BindResponse bind( String name ) throws LdapException, IOException\n+    {\n+        return bind( new Dn( schemaManager, name ), null );\n+    }\n+\n+\n     /**\n      * {@inheritDoc}\n      */"
            },
            {
                "sha": "bb81fb73e2250e65d895f8d40a0868ec4ee719d1",
                "filename": "ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/bind/SimpleBindRequestTest.java",
                "status": "modified",
                "additions": 22,
                "deletions": 6,
                "changes": 28,
                "blob_url": "https://github.com/apache/directory-server/blob/859e0cb55e914e9359e4041162e1d92e3204b211/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/bind/SimpleBindRequestTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/859e0cb55e914e9359e4041162e1d92e3204b211/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/bind/SimpleBindRequestTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/bind/SimpleBindRequestTest.java?ref=859e0cb55e914e9359e4041162e1d92e3204b211",
                "patch": "@@ -39,6 +39,7 @@\n import org.apache.directory.server.core.interceptor.BaseInterceptor;\n import org.apache.directory.server.core.interceptor.NextInterceptor;\n import org.apache.directory.server.core.interceptor.context.BindOperationContext;\n+import org.apache.directory.shared.ldap.model.exception.LdapAuthenticationException;\n import org.apache.directory.shared.ldap.model.exception.LdapException;\n import org.apache.directory.shared.ldap.model.message.BindRequest;\n import org.apache.directory.shared.ldap.model.message.BindRequestImpl;\n@@ -48,7 +49,6 @@\n import org.apache.directory.shared.ldap.model.name.Dn;\n import org.junit.After;\n import org.junit.Before;\n-import org.junit.Ignore;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n \n@@ -64,9 +64,16 @@\n @ApplyLdifs(\n     {\n         // Entry # 1\n-        \"dn: uid=superuser,ou=system\", \"objectClass: person\", \"objectClass: organizationalPerson\",\n-        \"objectClass: inetOrgPerson\", \"objectClass: top\", \"cn: superuser\", \"sn: administrator\",\n-        \"displayName: Directory Superuser\", \"uid: superuser\", \"userPassword: test\" })\n+        \"dn: uid=superuser,ou=system\", \n+        \"objectClass: person\", \n+        \"objectClass: organizationalPerson\",\n+        \"objectClass: inetOrgPerson\", \n+        \"objectClass: top\", \n+        \"cn: superuser\", \n+        \"sn: administrator\",\n+        \"displayName: Directory Superuser\", \n+        \"uid: superuser\", \n+        \"userPassword: test\" })\n public class SimpleBindRequestTest extends AbstractLdapTestUnit\n {\n     private LdapAsyncConnection connection;\n@@ -159,7 +166,6 @@ public void testSimpleBindRequest() throws Exception\n      * Test a successful anonymous bind request.\n      */\n     @Test\n-    @Ignore // TODO : FIXME ! We get a NPE low in the code because the name is null\n     public void testAnonymousBindRequest() throws Exception\n     {\n         BindRequest bindRequest = new BindRequestImpl();\n@@ -255,7 +261,7 @@ public void testSimpleBindNoNamePassword() throws Exception\n     @Test\n     public void testSimpleBindUnauthenticated() throws Exception\n     {\n-        BindResponse response = connection.bind( \"uid=admin,ou=system\", ( String ) null );\n+        BindResponse response = connection.bind( \"uid=admin,ou=system\" );\n         LdapResult ldapResult = response.getLdapResult();\n         assertEquals( ResultCodeEnum.UNWILLING_TO_PERFORM, ldapResult.getResultCode() );\n         assertEquals( 1, response.getMessageId() );\n@@ -264,6 +270,16 @@ public void testSimpleBindUnauthenticated() throws Exception\n     }\n \n \n+    /**\n+     * Test an bind with no password\n+     */\n+    @Test( expected=LdapAuthenticationException.class )\n+    public void testSimpleBindNoPassword() throws Exception\n+    {\n+        connection.bind( \"uid=admin,ou=system\", ( String ) null );\n+    }\n+\n+\n     /**\n      * Test a valid bind\n      */"
            },
            {
                "sha": "e47b92f9e79984e9b2b2e956c1c062933044f678",
                "filename": "server-integ/src/test/java/org/apache/directory/server/operations/bind/SaslBindIT.java",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/apache/directory-server/blob/859e0cb55e914e9359e4041162e1d92e3204b211/server-integ/src/test/java/org/apache/directory/server/operations/bind/SaslBindIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/859e0cb55e914e9359e4041162e1d92e3204b211/server-integ/src/test/java/org/apache/directory/server/operations/bind/SaslBindIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-integ/src/test/java/org/apache/directory/server/operations/bind/SaslBindIT.java?ref=859e0cb55e914e9359e4041162e1d92e3204b211",
                "patch": "@@ -232,6 +232,7 @@ public void testSupportedSASLMechanisms() throws Exception\n      * Tests to make sure PLAIN-binds works\n      */\n     @Test\n+    @Ignore // The SASL Plain mechanism is ot supported\n     public void testSaslBindPLAIN() throws Exception\n     {\n         Dn userDn = new Dn( \"uid=hnelson,ou=users,dc=example,dc=com\" );"
            },
            {
                "sha": "833b081153e3caf28fbbb1ff3a0397000b244ef0",
                "filename": "server-integ/src/test/java/org/apache/directory/server/operations/bind/SimpleBindIT.java",
                "status": "modified",
                "additions": 8,
                "deletions": 2,
                "changes": 10,
                "blob_url": "https://github.com/apache/directory-server/blob/859e0cb55e914e9359e4041162e1d92e3204b211/server-integ/src/test/java/org/apache/directory/server/operations/bind/SimpleBindIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/859e0cb55e914e9359e4041162e1d92e3204b211/server-integ/src/test/java/org/apache/directory/server/operations/bind/SimpleBindIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-integ/src/test/java/org/apache/directory/server/operations/bind/SimpleBindIT.java?ref=859e0cb55e914e9359e4041162e1d92e3204b211",
                "patch": "@@ -71,8 +71,14 @@\n @ApplyLdifs(\n     {\n         // Entry # 1\n-        \"dn: uid=hnelson,ou=users,ou=system\", \"objectClass: inetOrgPerson\", \"objectClass: organizationalPerson\",\n-        \"objectClass: person\", \"objectClass: top\", \"userPassword: secret\", \"uid: hnelson\", \"cn: Horatio Nelson\",\n+        \"dn: uid=hnelson,ou=users,ou=system\", \n+        \"objectClass: inetOrgPerson\", \n+        \"objectClass: organizationalPerson\",\n+        \"objectClass: person\", \n+        \"objectClass: top\", \n+        \"userPassword: secret\", \n+        \"uid: hnelson\",\n+        \"cn: Horatio Nelson\",\n         \"sn: Nelson\" })\n @CreateDS(allowAnonAccess = true, name = \"SimpleBindIT-class\")\n @CreateLdapServer(transports ="
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/fa16d670ca7f24627e72f84a757511384ab84cda",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/985ea9ef35e9695e846c60bbef938e74d492b3de",
        "message": "o Fixed many potential NPE detected by Sonar\no Fixed a bad list access on CursorList\no Initializing a default CacheService if none is given at startup\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1486298 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_90",
        "file": [
            {
                "sha": "15aa460b531bcc57e5ab9ed30b21a7e17dbd0da3",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/filtering/CursorList.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/directory-server/blob/fa16d670ca7f24627e72f84a757511384ab84cda/core-api/src/main/java/org/apache/directory/server/core/api/filtering/CursorList.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fa16d670ca7f24627e72f84a757511384ab84cda/core-api/src/main/java/org/apache/directory/server/core/api/filtering/CursorList.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/filtering/CursorList.java?ref=fa16d670ca7f24627e72f84a757511384ab84cda",
                "patch": "@@ -112,7 +112,7 @@ public CursorList( int start, List<EntryFilteringCursor> list, int end, SearchOp\n             this.list = Collections.emptyList();\n         }\n \n-        listSize = list.size();\n+        listSize = this.list.size();\n \n         if ( ( start < 0 ) || ( start > listSize ) )\n         {\n@@ -135,7 +135,7 @@ public CursorList( int start, List<EntryFilteringCursor> list, int end, SearchOp\n         this.end = end;\n         this.searchContext = searchContext;\n         index = start;\n-        currentCursor = list.get( index );\n+        currentCursor = this.list.get( index );\n     }\n \n "
            },
            {
                "sha": "2710a739fedaa3910edc97e2136486d7fce11702",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/AddOperationContext.java",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/directory-server/blob/fa16d670ca7f24627e72f84a757511384ab84cda/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/AddOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fa16d670ca7f24627e72f84a757511384ab84cda/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/AddOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/AddOperationContext.java?ref=fa16d670ca7f24627e72f84a757511384ab84cda",
                "patch": "@@ -23,6 +23,7 @@\n import org.apache.directory.api.ldap.model.entry.DefaultEntry;\n import org.apache.directory.api.ldap.model.entry.Entry;\n import org.apache.directory.api.ldap.model.exception.LdapException;\n+import org.apache.directory.api.ldap.model.exception.LdapOperationErrorException;\n import org.apache.directory.api.ldap.model.message.AddRequest;\n import org.apache.directory.api.ldap.model.message.MessageTypeEnum;\n import org.apache.directory.api.ldap.model.message.controls.ManageDsaIT;\n@@ -118,6 +119,10 @@ public AddOperationContext( CoreSession session, AddRequest addRequest ) throws\n         {\n             setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.ADD ) );\n         }\n+        else\n+        {\n+            throw new LdapOperationErrorException( \"No session to proceed the operation\" );\n+        }\n \n         entry = new ClonedServerEntry(\n             new DefaultEntry( session.getDirectoryService().getSchemaManager(), addRequest.getEntry() ) );"
            },
            {
                "sha": "c855c515a4ed806888602778ee7e4563e5fb8758",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/ModifyOperationContext.java",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/directory-server/blob/fa16d670ca7f24627e72f84a757511384ab84cda/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/ModifyOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fa16d670ca7f24627e72f84a757511384ab84cda/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/ModifyOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/ModifyOperationContext.java?ref=fa16d670ca7f24627e72f84a757511384ab84cda",
                "patch": "@@ -29,6 +29,7 @@\n import org.apache.directory.api.ldap.model.entry.Modification;\n import org.apache.directory.api.ldap.model.entry.ModificationOperation;\n import org.apache.directory.api.ldap.model.exception.LdapException;\n+import org.apache.directory.api.ldap.model.exception.LdapOperationErrorException;\n import org.apache.directory.api.ldap.model.message.MessageTypeEnum;\n import org.apache.directory.api.ldap.model.message.ModifyRequest;\n import org.apache.directory.api.ldap.model.message.controls.ManageDsaIT;\n@@ -96,6 +97,10 @@ public ModifyOperationContext( CoreSession session, ModifyRequest modifyRequest\n         {\n             setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.MODIFY ) );\n         }\n+        else\n+        {\n+            throw new LdapOperationErrorException( \"Cannot proceed the operation with no session\" );\n+        }\n \n         modItems = ServerEntryUtils.toServerModification( modifyRequest.getModifications().toArray(\n             new DefaultModification[0] ), session.getDirectoryService().getSchemaManager() );"
            },
            {
                "sha": "63dbf7edabb7f9694954be0668f16ac34207b296",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/UnbindOperationContext.java",
                "status": "modified",
                "additions": 2,
                "deletions": 8,
                "changes": 10,
                "blob_url": "https://github.com/apache/directory-server/blob/fa16d670ca7f24627e72f84a757511384ab84cda/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/UnbindOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fa16d670ca7f24627e72f84a757511384ab84cda/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/UnbindOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/api/interceptor/context/UnbindOperationContext.java?ref=fa16d670ca7f24627e72f84a757511384ab84cda",
                "patch": "@@ -41,10 +41,7 @@ public UnbindOperationContext( CoreSession session )\n     {\n         super( session, session.getEffectivePrincipal().getDn() );\n \n-        if ( session != null )\n-        {\n-            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.UNBIND ) );\n-        }\n+        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.UNBIND ) );\n     }\n \n \n@@ -53,10 +50,7 @@ public UnbindOperationContext( CoreSession session, UnbindRequest unbindRequest\n         super( session, session.getEffectivePrincipal().getDn() );\n         setRequestControls( unbindRequest.getControls() );\n \n-        if ( session != null )\n-        {\n-            setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.UNBIND ) );\n-        }\n+        setInterceptors( session.getDirectoryService().getInterceptors( OperationEnum.UNBIND ) );\n     }\n \n "
            },
            {
                "sha": "f3547266e66176914ed1aaf8ef347dab3098cd31",
                "filename": "core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "status": "modified",
                "additions": 5,
                "deletions": 2,
                "changes": 7,
                "blob_url": "https://github.com/apache/directory-server/blob/fa16d670ca7f24627e72f84a757511384ab84cda/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fa16d670ca7f24627e72f84a757511384ab84cda/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java?ref=fa16d670ca7f24627e72f84a757511384ab84cda",
                "patch": "@@ -1792,11 +1792,14 @@ private void initialize() throws Exception\n             setDefaultInterceptorConfigurations();\n         }\n \n-        if ( cacheService != null )\n+        if ( cacheService == null )\n         {\n-            cacheService.initialize( instanceLayout );\n+            // Initialize a default cache service\n+            cacheService = new CacheService();\n         }\n \n+        cacheService.initialize( instanceLayout );\n+\n         // Initialize the AP caches\n         accessControlAPCache = new DnNode<AccessControlAdministrativePoint>();\n         collectiveAttributeAPCache = new DnNode<CollectiveAttributeAdministrativePoint>();"
            },
            {
                "sha": "f5fa3b059abe15484d88aac116c16078261026c5",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/extended/GracefulShutdownHandler.java",
                "status": "modified",
                "additions": 12,
                "deletions": 12,
                "changes": 24,
                "blob_url": "https://github.com/apache/directory-server/blob/fa16d670ca7f24627e72f84a757511384ab84cda/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/extended/GracefulShutdownHandler.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fa16d670ca7f24627e72f84a757511384ab84cda/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/extended/GracefulShutdownHandler.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/extended/GracefulShutdownHandler.java?ref=fa16d670ca7f24627e72f84a757511384ab84cda",
                "patch": "@@ -247,21 +247,21 @@ public static void sendNoticeOfDisconnect( List<IoSession> sessions, IoSession r\n                     LOG.warn( \"Failed to sent NoD for client: \" + session, e );\n                 }\n             }\n-        }\n \n-        // And close the connections when the NoDs are sent.\n-        Iterator<IoSession> sessionIt = sessions.iterator();\n+            // And close the connections when the NoDs are sent.\n+            Iterator<IoSession> sessionIt = sessions.iterator();\n \n-        for ( WriteFuture future : writeFutures )\n-        {\n-            try\n-            {\n-                future.awaitUninterruptibly( 1000 );\n-                sessionIt.next().close( true );\n-            }\n-            catch ( Exception e )\n+            for ( WriteFuture future : writeFutures )\n             {\n-                LOG.warn( \"Failed to sent NoD.\", e );\n+                try\n+                {\n+                    future.awaitUninterruptibly( 1000 );\n+                    sessionIt.next().close( true );\n+                }\n+                catch ( Exception e )\n+                {\n+                    LOG.warn( \"Failed to sent NoD.\", e );\n+                }\n             }\n         }\n     }"
            },
            {
                "sha": "3481bd757440f8cf66ea420df1c31ecedbde9ce6",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/request/SearchRequestHandler.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/fa16d670ca7f24627e72f84a757511384ab84cda/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/request/SearchRequestHandler.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fa16d670ca7f24627e72f84a757511384ab84cda/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/request/SearchRequestHandler.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/request/SearchRequestHandler.java?ref=fa16d670ca7f24627e72f84a757511384ab84cda",
                "patch": "@@ -477,6 +477,8 @@ private void readPagedResults( LdapSession session, SearchRequest req, LdapResul\n \n         boolean hasMoreEntry = cursor.next();\n \n+        // We have some entry, move back to the first one, as we just moved forward \n+        // to get the first entry\n         if ( hasMoreEntry )\n         {\n             cursor.previous();"
            },
            {
                "sha": "aca13769fcade0e4aa6a8796aaf34c4c839d57a3",
                "filename": "service-builder/src/main/java/org/apache/directory/server/config/builder/ServiceBuilder.java",
                "status": "modified",
                "additions": 4,
                "deletions": 5,
                "changes": 9,
                "blob_url": "https://github.com/apache/directory-server/blob/fa16d670ca7f24627e72f84a757511384ab84cda/service-builder/src/main/java/org/apache/directory/server/config/builder/ServiceBuilder.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fa16d670ca7f24627e72f84a757511384ab84cda/service-builder/src/main/java/org/apache/directory/server/config/builder/ServiceBuilder.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/service-builder/src/main/java/org/apache/directory/server/config/builder/ServiceBuilder.java?ref=fa16d670ca7f24627e72f84a757511384ab84cda",
                "patch": "@@ -69,7 +69,6 @@\n import org.apache.directory.server.config.beans.SaslMechHandlerBean;\n import org.apache.directory.server.config.beans.TcpTransportBean;\n import org.apache.directory.server.config.beans.TransportBean;\n-import org.apache.directory.server.config.beans.UdpTransportBean;\n import org.apache.directory.server.constants.ApacheSchemaConstants;\n import org.apache.directory.server.core.DefaultDirectoryService;\n import org.apache.directory.server.core.api.DirectoryService;\n@@ -514,7 +513,7 @@ public static Transport createTransport( TransportBean transportBean )\n         {\n             transport = new TcpTransport();\n         }\n-        else if ( transportBean instanceof UdpTransportBean )\n+        else\n         {\n             transport = new UdpTransport();\n         }\n@@ -972,13 +971,13 @@ public static LdapServer createLdapServer( LdapServerBean ldapServerBean, Direct\n \n         // Relplication pinger thread sleep time\n         ldapServer.setReplPingerSleepTime( ldapServerBean.getReplPingerSleep() );\n-        \n+\n         // Enabled cipher suites\n-        if( ldapServerBean.getEnabledCipherSuites() != null )\n+        if ( ldapServerBean.getEnabledCipherSuites() != null )\n         {\n             ldapServer.setEnabledCipherSuites( ldapServerBean.getEnabledCipherSuites() );\n         }\n-        \n+\n         // The transports\n         Transport[] transports = createTransports( ldapServerBean.getTransports() );\n         ldapServer.setTransports( transports );"
            },
            {
                "sha": "0e9005454ead638e3abaa4ca1dce09228c9daadf",
                "filename": "service-osgi/src/main/java/org/apache/directory/server/ApacheDsService.java",
                "status": "modified",
                "additions": 5,
                "deletions": 26,
                "changes": 31,
                "blob_url": "https://github.com/apache/directory-server/blob/fa16d670ca7f24627e72f84a757511384ab84cda/service-osgi/src/main/java/org/apache/directory/server/ApacheDsService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/fa16d670ca7f24627e72f84a757511384ab84cda/service-osgi/src/main/java/org/apache/directory/server/ApacheDsService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/service-osgi/src/main/java/org/apache/directory/server/ApacheDsService.java?ref=fa16d670ca7f24627e72f84a757511384ab84cda",
                "patch": "@@ -29,6 +29,7 @@\n import java.util.Map;\n import java.util.UUID;\n \n+import org.apache.commons.lang.time.DateUtils;\n import org.apache.directory.server.config.ConfigPartitionReader;\n import org.apache.directory.server.config.LdifConfigExtractor;\n import org.apache.directory.server.config.beans.ConfigBean;\n@@ -52,31 +53,6 @@\n import org.apache.directory.server.kerberos.kdc.KdcServer;\n import org.apache.directory.server.ldap.LdapServer;\n import org.apache.directory.server.ntp.NtpServer;\n-import org.apache.directory.shared.ldap.model.constants.SchemaConstants;\n-import org.apache.directory.shared.ldap.model.entry.Attribute;\n-import org.apache.directory.shared.ldap.model.entry.DefaultAttribute;\n-import org.apache.directory.shared.ldap.model.entry.DefaultModification;\n-import org.apache.directory.shared.ldap.model.entry.Entry;\n-import org.apache.directory.shared.ldap.model.entry.Modification;\n-import org.apache.directory.shared.ldap.model.entry.ModificationOperation;\n-import org.apache.directory.shared.ldap.model.filter.ExprNode;\n-import org.apache.directory.shared.ldap.model.filter.PresenceNode;\n-import org.apache.directory.shared.ldap.model.message.AliasDerefMode;\n-import org.apache.directory.shared.ldap.model.message.SearchScope;\n-import org.apache.directory.shared.ldap.model.name.Dn;\n-import org.apache.directory.shared.ldap.model.schema.AttributeType;\n-import org.apache.directory.shared.ldap.model.schema.AttributeTypeOptions;\n-import org.apache.directory.shared.ldap.model.schema.SchemaManager;\n-import org.apache.directory.shared.ldap.model.schema.registries.SchemaLoader;\n-import org.apache.directory.shared.ldap.model.schema.syntaxCheckers.CsnSyntaxChecker;\n-import org.apache.directory.shared.ldap.model.schema.syntaxCheckers.GeneralizedTimeSyntaxChecker;\n-import org.apache.directory.shared.ldap.model.schema.syntaxCheckers.UuidSyntaxChecker;\n-import org.apache.directory.shared.ldap.schemaextractor.SchemaLdifExtractor;\n-import org.apache.directory.shared.ldap.schemaextractor.impl.DefaultSchemaLdifExtractor;\n-import org.apache.directory.shared.ldap.schemaloader.LdifSchemaLoader;\n-import org.apache.directory.shared.ldap.schemamanager.impl.DefaultSchemaManager;\n-import org.apache.directory.shared.util.DateUtils;\n-import org.apache.directory.shared.util.exception.Exceptions;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n@@ -578,7 +554,10 @@ public void stop() throws Exception\n         }\n \n         // We now have to stop the underlaying DirectoryService\n-        ldapServer.getDirectoryService().shutdown();\n+        if ( ldapServer != null )\n+        {\n+            ldapServer.getDirectoryService().shutdown();\n+        }\n     }\n \n     private static final String BANNER_LDAP = \"           _                     _          ____  ____   \\n\""
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/c0187e62926aa58970170a59bb6ba6a3e96d7a9a",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/f3b89a0752761865516adea7fae2db4c32bd680a",
        "message": "Another fix for DIRSERVER-1802 : we were creating an array which is too big when we remove a disabled Authenticator, so we end with a null value in the array, which produces a NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1446146 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_91",
        "file": [
            {
                "sha": "523a4e5ca1f48b52c3a992248111efbdbed10a72",
                "filename": "service-builder/src/main/java/org/apache/directory/server/config/builder/ServiceBuilder.java",
                "status": "modified",
                "additions": 4,
                "deletions": 3,
                "changes": 7,
                "blob_url": "https://github.com/apache/directory-server/blob/c0187e62926aa58970170a59bb6ba6a3e96d7a9a/service-builder/src/main/java/org/apache/directory/server/config/builder/ServiceBuilder.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c0187e62926aa58970170a59bb6ba6a3e96d7a9a/service-builder/src/main/java/org/apache/directory/server/config/builder/ServiceBuilder.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/service-builder/src/main/java/org/apache/directory/server/config/builder/ServiceBuilder.java?ref=c0187e62926aa58970170a59bb6ba6a3e96d7a9a",
                "patch": "@@ -535,18 +535,19 @@ else if ( transportBean instanceof UdpTransportBean )\n      */\n     public static Authenticator[] createAuthenticators( List<AuthenticatorBean> list ) throws ConfigurationException\n     {\n-        Authenticator[] authenticators = new Authenticator[list.size()];\n+        Set<Authenticator> authenticators = new HashSet<Authenticator>( list.size() );\n         int i = 0;\n \n         for ( AuthenticatorBean authenticatorBean : list )\n         {\n             if ( authenticatorBean.isEnabled() )\n             {\n-                authenticators[i++] = createAuthenticator( authenticatorBean );\n+                authenticators.add( createAuthenticator( authenticatorBean ) );\n             }\n         }\n \n-        return authenticators;\n+        return authenticators.toArray( new Authenticator[]\n+            {} );\n     }\n \n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/f80272a56675b939e3bc2180c422937e35e33f9f",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/70d95ae603cab7a6405cf2ff402a6bb6159cdf45",
        "message": "o fixed the issue with modify operation(DIRSERVER-1665) (the getOriginalEntry() is returning null value on modify \noperation context)\no fixed another NPE arising while checking the pasword's age\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1178922 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_92",
        "file": [
            {
                "sha": "cfdbf618ac613120b177ff16d8ec74002865c2b5",
                "filename": "core/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java",
                "status": "modified",
                "additions": 18,
                "deletions": 14,
                "changes": 32,
                "blob_url": "https://github.com/apache/directory-server/blob/f80272a56675b939e3bc2180c422937e35e33f9f/core/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/f80272a56675b939e3bc2180c422937e35e33f9f/core/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java?ref=f80272a56675b939e3bc2180c422937e35e33f9f",
                "patch": "@@ -511,19 +511,16 @@ public void modify( NextInterceptor next, ModifyOperationContext modifyContext )\n         }\n \n         // handle the case where pwdPolicySubentry AT is about to be deleted in thid modify()\n-        PasswordPolicyConfiguration policyConfig = getPwdPolicy( modifyContext.getOriginalEntry() );\n+        PasswordPolicyConfiguration policyConfig = getPwdPolicy( modifyContext.getEntry() );\n         \n         boolean isPPolicyReqCtrlPresent = modifyContext.hasRequestControl( PasswordPolicy.OID );\n         Dn userDn = modifyContext.getSession().getAuthenticatedPrincipal().getDn();\n \n         PwdModDetailsHolder pwdModDetails = null;\n         \n-        if ( policyConfig.isPwdSafeModify() || pwdResetSet.contains( userDn ) || ( policyConfig.getPwdMinAge() > 0 ) )\n-        {\n-            pwdModDetails = getPwdModDetails( modifyContext, policyConfig );\n-        }\n+        pwdModDetails = getPwdModDetails( modifyContext, policyConfig );\n \n-        if ( ( pwdModDetails != null ) && pwdModDetails.isPwdModPresent() )\n+        if ( pwdModDetails.isPwdModPresent() )\n         {\n             if ( pwdResetSet.contains( userDn ) )\n             {\n@@ -622,6 +619,11 @@ public void modify( NextInterceptor next, ModifyOperationContext modifyContext )\n             if ( histSize > 0 )\n             {\n                 Attribute pwdHistoryAt = entry.get( PWD_HISTORY_AT );\n+                if ( pwdHistoryAt == null )\n+                {\n+                \tpwdHistoryAt = new DefaultAttribute( AT_PWD_HISTORY );\n+                }\n+                \n                 Set<PasswordHistory> pwdHistSet = new TreeSet<PasswordHistory>();\n \n                 for ( Value<?> value : pwdHistoryAt  )\n@@ -650,13 +652,12 @@ public void modify( NextInterceptor next, ModifyOperationContext modifyContext )\n                 PasswordHistory newPwdHist = new PasswordHistory( pwdChangedTime, newPassword );\n                 pwdHistSet.add( newPwdHist );\n \n-                pwdHistoryAt = new DefaultAttribute( pwdHistoryAt.getAttributeType() );\n+                pwdHistoryAt.clear();\n                 pwdHistoryAt.add( newPwdHist.getHistoryValue() );\n                 pwdAddHistMod = new DefaultModification( ADD_ATTRIBUTE, pwdHistoryAt );\n \n                 if ( pwdHistSet.size() > histSize )\n                 {\n-                    pwdHistoryAt = new DefaultAttribute( pwdHistoryAt.getAttributeType() );\n                     PasswordHistory remPwdHist = ( PasswordHistory ) pwdHistSet.toArray()[histSize - 1];\n                     pwdHistoryAt.add( remPwdHist.getHistoryValue() );\n                     pwdRemHistMod = new DefaultModification( REMOVE_ATTRIBUTE, pwdHistoryAt );\n@@ -1285,12 +1286,15 @@ private boolean isPwdTooYoung( Entry userEntry, PasswordPolicyConfiguration poli\n         }\n \n         Attribute pwdChangedTimeAt = userEntry.get( PWD_CHANGED_TIME_AT );\n-        long changedTime = DateUtils.getDate( pwdChangedTimeAt.getString() ).getTime();\n-        changedTime += policyConfig.getPwdMinAge() * 1000;\n-\n-        if ( changedTime > System.currentTimeMillis() )\n-        {\n-            return true;\n+        if ( pwdChangedTimeAt != null )\n+        {\n+        \tlong changedTime = DateUtils.getDate( pwdChangedTimeAt.getString() ).getTime();\n+        \tchangedTime += policyConfig.getPwdMinAge() * 1000;\n+        \t\n+        \tif ( changedTime > System.currentTimeMillis() )\n+        \t{\n+        \t\treturn true;\n+        \t}\n         }\n \n         return false;"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/e37bdf2b1f0d41b83dcda96af54a25a09adbde84",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/3ad028dad1b498fe384ea2da712e595c4d62c6a4",
        "message": "o added a test to for DSML engine to demonstrate an NPE raised in SearchRequestDecorator while processing a DSML search request\no added a dependency on dsml-engine and added the required test resource\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1091706 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_93",
        "file": [
            {
                "sha": "c433dfaaa57d56124c06ece1610a8da464feda9d",
                "filename": "server-integ/pom.xml",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/apache/directory-server/blob/e37bdf2b1f0d41b83dcda96af54a25a09adbde84/server-integ/pom.xml",
                "raw_url": "https://github.com/apache/directory-server/raw/e37bdf2b1f0d41b83dcda96af54a25a09adbde84/server-integ/pom.xml",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-integ/pom.xml?ref=e37bdf2b1f0d41b83dcda96af54a25a09adbde84",
                "patch": "@@ -154,6 +154,12 @@\n       <groupId>org.apache.directory.shared</groupId>\n       <artifactId>shared-ldap-client-api</artifactId>\n     </dependency>  \n+\n+    <dependency>\n+      <groupId>org.apache.directory.shared</groupId>\n+      <artifactId>shared-dsml-engine</artifactId>\n+      <version>${org.apache.directory.shared.version}</version>\n+    </dependency>\n   </dependencies>\n \n   <build>"
            },
            {
                "sha": "3a2d5cad029cf2e931a05a381320410510fb9fe4",
                "filename": "server-integ/src/test/java/org/apache/directory/dsml/engine/Dsmlv2EngineTest.java",
                "status": "added",
                "additions": 107,
                "deletions": 0,
                "changes": 107,
                "blob_url": "https://github.com/apache/directory-server/blob/e37bdf2b1f0d41b83dcda96af54a25a09adbde84/server-integ/src/test/java/org/apache/directory/dsml/engine/Dsmlv2EngineTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/e37bdf2b1f0d41b83dcda96af54a25a09adbde84/server-integ/src/test/java/org/apache/directory/dsml/engine/Dsmlv2EngineTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-integ/src/test/java/org/apache/directory/dsml/engine/Dsmlv2EngineTest.java?ref=e37bdf2b1f0d41b83dcda96af54a25a09adbde84",
                "patch": "@@ -0,0 +1,107 @@\n+/*\n+ *   Licensed to the Apache Software Foundation (ASF) under one\n+ *   or more contributor license agreements.  See the NOTICE file\n+ *   distributed with this work for additional information\n+ *   regarding copyright ownership.  The ASF licenses this file\n+ *   to you under the Apache License, Version 2.0 (the\n+ *   \"License\"); you may not use this file except in compliance\n+ *   with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing,\n+ *   software distributed under the License is distributed on an\n+ *   \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *   KIND, either express or implied.  See the License for the\n+ *   specific language governing permissions and limitations\n+ *   under the License.\n+ *\n+ */\n+\n+package org.apache.directory.dsml.engine;\n+\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.InputStream;\n+\n+import org.apache.directory.ldap.client.api.LdapConnection;\n+import org.apache.directory.ldap.client.api.LdapNetworkConnection;\n+import org.apache.directory.server.annotations.CreateLdapServer;\n+import org.apache.directory.server.annotations.CreateTransport;\n+import org.apache.directory.server.core.annotations.CreateDS;\n+import org.apache.directory.server.core.integ.AbstractLdapTestUnit;\n+import org.apache.directory.server.core.integ.FrameworkRunner;\n+import org.apache.directory.shared.dsmlv2.Dsmlv2ResponseParser;\n+import org.apache.directory.shared.dsmlv2.engine.Dsmlv2Engine;\n+import org.apache.directory.shared.dsmlv2.reponse.BatchResponseDsml;\n+import org.apache.directory.shared.dsmlv2.reponse.SearchResponse;\n+import org.apache.directory.shared.ldap.codec.api.LdapCodecServiceFactory;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+\n+/**\n+ * Test for demonstrating the NPE generated while processing a search DSML request by Dsmlv2Engine.\n+ *\n+ * @author <a href=\"mailto:dev@directory.apache.org\">Apache Directory Project</a>\n+ */\n+@RunWith(FrameworkRunner.class)\n+@CreateDS(name = \"Dsmlv2EngineTest-DS\")\n+@CreateLdapServer(transports =\n+    { @CreateTransport(protocol = \"LDAP\") })\n+public class Dsmlv2EngineTest extends AbstractLdapTestUnit\n+{\n+    private LdapConnection connection;\n+\n+    private Dsmlv2Engine engine;\n+\n+\n+    @Before\n+    public void setup()\n+    {\n+        connection = new LdapNetworkConnection( \"localhost\", ldapServer.getPort() );\n+        engine = new Dsmlv2Engine( connection, \"uid=admin,ou=system\", \"secret\" );\n+    }\n+\n+\n+    @After\n+    public void unbind() throws Exception\n+    {\n+        connection.unBind();\n+        connection.close();\n+    }\n+\n+\n+    //Enable WARN level logging to see the stacktrace\n+    // e.x log4j.rootCategory=WARN, stdout\n+    @Ignore(\"Failes with an NPE at org.apache.directory.shared.ldap.codec.decorators.SearchRequestDecorator.computeLength(SearchRequestDecorator.java:939)\")\n+    @Test\n+    public void testEngineWithDefaultBlockingResponse() throws Exception\n+    {\n+        InputStream dsmlIn = getClass().getClassLoader().getResourceAsStream( \"dsml-search-req.xml\" );\n+\n+        ByteArrayOutputStream byteOut = new ByteArrayOutputStream();\n+\n+        engine.processDSML( dsmlIn, byteOut );\n+\n+        Dsmlv2ResponseParser respParser = new Dsmlv2ResponseParser( LdapCodecServiceFactory.getSingleton() );\n+        System.out.println( byteOut.toString() );\n+        respParser.setInput( byteOut.toString() );\n+\n+        respParser.parseAllResponses();\n+\n+        BatchResponseDsml batchResp = respParser.getBatchResponse();\n+\n+        assertNotNull( batchResp );\n+\n+        SearchResponse searchResp = ( SearchResponse ) batchResp.getCurrentResponse().getDecorated();\n+\n+        assertEquals( 5, searchResp.getSearchResultEntryList().size() );\n+    }\n+}"
            },
            {
                "sha": "17a32c27e404b4ed7c16b0f8c76d9aa5836df385",
                "filename": "server-integ/src/test/resources/dsml-search-req.xml",
                "status": "added",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/apache/directory-server/blob/e37bdf2b1f0d41b83dcda96af54a25a09adbde84/server-integ/src/test/resources/dsml-search-req.xml",
                "raw_url": "https://github.com/apache/directory-server/raw/e37bdf2b1f0d41b83dcda96af54a25a09adbde84/server-integ/src/test/resources/dsml-search-req.xml",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-integ/src/test/resources/dsml-search-req.xml?ref=e37bdf2b1f0d41b83dcda96af54a25a09adbde84",
                "patch": "@@ -0,0 +1,18 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n+<soap-env:Envelope xmlns:soap-env=\"http://schemas.xmlsoap.org/soap/envelope/\">\n+\t<soap-env:Body>\n+\t\t<dsml:batchRequest xmlns:dsml=\"urn:oasis:names:tc:DSML:2:0:core\"\n+\t\t\txmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n+\t\t\t<searchRequest dn=\"ou=system\" scope=\"singleLevel\"\n+\t\t\t\tderefAliases=\"neverDerefAliases\" typesOnly=\"false\" >\n+\t\t\t\t<filter>\n+\t\t\t\t\t<present name=\"objectClass\">\n+\t\t\t\t\t</present>\n+\t\t\t\t</filter>\n+\t\t\t\t<attributes>\n+\t\t\t\t  <attribute name=\"*\"/>\n+\t\t\t\t</attributes>\n+\t\t\t</searchRequest>\n+\t\t</dsml:batchRequest>\n+\t</soap-env:Body>\n+</soap-env:Envelope>\n\\ No newline at end of file"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/3ad028dad1b498fe384ea2da712e595c4d62c6a4",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/ad6240d74d748bc5c321b420f2aba9aae2d91be9",
        "message": "o Added a tests for a simple bind request and an (ignored atm) anonymous bind request. The Anonymous bind fails because we have a NPE in the BindRequest encoder when the name is null.\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1091679 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_94",
        "file": [
            {
                "sha": "93b320a1b57330a7ffb5535885a874bd24af787c",
                "filename": "ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/bind/SimpleBindRequestTest.java",
                "status": "modified",
                "additions": 36,
                "deletions": 0,
                "changes": 36,
                "blob_url": "https://github.com/apache/directory-server/blob/3ad028dad1b498fe384ea2da712e595c4d62c6a4/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/bind/SimpleBindRequestTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/3ad028dad1b498fe384ea2da712e595c4d62c6a4/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/bind/SimpleBindRequestTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/bind/SimpleBindRequestTest.java?ref=3ad028dad1b498fe384ea2da712e595c4d62c6a4",
                "patch": "@@ -48,6 +48,7 @@\n import org.apache.directory.shared.ldap.model.name.Dn;\n import org.junit.After;\n import org.junit.Before;\n+import org.junit.Ignore;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n \n@@ -136,6 +137,41 @@ public void testAsyncBindRequest() throws Exception\n     }\n \n \n+    /**\n+     * Test a successful simple bind request.\n+     */\n+    @Test\n+    public void testSimpleBindRequest() throws Exception\n+    {\n+        BindRequest bindRequest = new BindRequestImpl();\n+        bindRequest.setName( new Dn( \"uid=admin,ou=system\" ) );\n+        bindRequest.setCredentials( \"secret\" );\n+\n+        BindResponse bindResponse = connection.bind( bindRequest );\n+\n+        assertNotNull( bindResponse );\n+        assertEquals( ResultCodeEnum.SUCCESS, bindResponse.getLdapResult().getResultCode() );\n+        assertTrue( connection.isAuthenticated() );\n+    }\n+\n+\n+    /**\n+     * Test a successful anonymous bind request.\n+     */\n+    @Test\n+    @Ignore // TODO : FIXME ! We get a NPE low in the code because the name is null\n+    public void testAnonymousBindRequest() throws Exception\n+    {\n+        BindRequest bindRequest = new BindRequestImpl();\n+\n+        BindResponse bindResponse = connection.bind( bindRequest );\n+\n+        assertNotNull( bindResponse );\n+        assertEquals( ResultCodeEnum.SUCCESS, bindResponse.getLdapResult().getResultCode() );\n+        assertTrue( connection.isAuthenticated() );\n+    }\n+\n+\n     /**\n      * Test an Anonymous BindRequest\n      */"
            },
            {
                "sha": "c5e922e733ea6df0136d69fb50c4e4eba0f97f42",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/plain/PlainSaslServer.java",
                "status": "modified",
                "additions": 8,
                "deletions": 3,
                "changes": 11,
                "blob_url": "https://github.com/apache/directory-server/blob/3ad028dad1b498fe384ea2da712e595c4d62c6a4/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/plain/PlainSaslServer.java",
                "raw_url": "https://github.com/apache/directory-server/raw/3ad028dad1b498fe384ea2da712e595c4d62c6a4/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/plain/PlainSaslServer.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/plain/PlainSaslServer.java?ref=3ad028dad1b498fe384ea2da712e595c4d62c6a4",
                "patch": "@@ -22,6 +22,9 @@\n \n import java.io.IOException;\n \n+import javax.naming.InvalidNameException;\n+import javax.security.sasl.SaslException;\n+\n import org.apache.directory.server.core.CoreSession;\n import org.apache.directory.server.core.interceptor.context.BindOperationContext;\n import org.apache.directory.server.i18n.I18n;\n@@ -34,9 +37,6 @@\n import org.apache.directory.shared.util.StringConstants;\n import org.apache.directory.shared.util.Strings;\n \n-import javax.naming.InvalidNameException;\n-import javax.security.sasl.SaslException;\n-\n \n /**\n  * A SaslServer implementation for PLAIN based SASL mechanism.  This is\n@@ -126,6 +126,11 @@ public String getMechanismName()\n             // - the optional authzId\n             // - the authId\n             // - the password\n+            // The message should have this structure :\n+            // message   = [authzid] '0x00' authcid '0x00' passwd\n+            // authzid   = 1*SAFE ; MUST accept up to 255 octets\n+            // authcid   = 1*SAFE ; MUST accept up to 255 octets\n+            // passwd    = 1*SAFE ; MUST accept up to 255 octets\n             InitialResponse element = InitialResponse.AUTHZID_EXPECTED;\n             String authzId = null;\n             String authcId = null;"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/b3f4b4085ea61403cc270e2b2cf872d16e21eef9",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/2d585c24cda93f19818747521727d72ef8a645a2",
        "message": "o fixed an NPE issue which can arise when the pwdpolicy is setting and the interceptor was not yet intialized\no updated test case\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1028420 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_95",
        "file": [
            {
                "sha": "706ecb5d811f4408519e341c382d8e4bfdc68b1c",
                "filename": "core-integ/src/test/java/org/apache/directory/server/core/authn/ppolicy/PasswordPolicyTest.java",
                "status": "modified",
                "additions": 9,
                "deletions": 5,
                "changes": 14,
                "blob_url": "https://github.com/apache/directory-server/blob/b3f4b4085ea61403cc270e2b2cf872d16e21eef9/core-integ/src/test/java/org/apache/directory/server/core/authn/ppolicy/PasswordPolicyTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/b3f4b4085ea61403cc270e2b2cf872d16e21eef9/core-integ/src/test/java/org/apache/directory/server/core/authn/ppolicy/PasswordPolicyTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-integ/src/test/java/org/apache/directory/server/core/authn/ppolicy/PasswordPolicyTest.java?ref=b3f4b4085ea61403cc270e2b2cf872d16e21eef9",
                "patch": "@@ -32,9 +32,11 @@\n import static org.junit.Assert.assertTrue;\n \n import org.apache.directory.ldap.client.api.LdapConnection;\n+import org.apache.directory.ldap.client.api.LdapNetworkConnection;\n import org.apache.directory.server.annotations.CreateLdapServer;\n import org.apache.directory.server.annotations.CreateTransport;\n import org.apache.directory.server.core.PasswordPolicyConfiguration;\n+import org.apache.directory.server.core.PpolicyConfigContainer;\n import org.apache.directory.server.core.annotations.CreateDS;\n import org.apache.directory.server.core.authn.AuthenticationInterceptor;\n import org.apache.directory.server.core.authn.PasswordUtil;\n@@ -61,7 +63,6 @@\n import org.apache.directory.shared.ldap.message.ResultCodeEnum;\n import org.apache.directory.shared.ldap.message.control.Control;\n import org.apache.directory.shared.ldap.name.DN;\n-import org.apache.directory.shared.ldap.util.StringTools;\n import org.junit.After;\n import org.junit.Before;\n import org.junit.Test;\n@@ -103,10 +104,13 @@ public void setPwdPolicy() throws LdapException\n         policyConfig.setPwdGraceAuthNLimit( 5 );\n         policyConfig.setPwdCheckQuality( 2 ); // DO NOT allow the password if its quality can't be checked\n \n+        PpolicyConfigContainer policyContainer = new PpolicyConfigContainer();\n+        policyContainer.setDefaultPolicy( policyConfig );\n+        service.setPwdPolicies( policyContainer );\n+        \n         AuthenticationInterceptor authInterceptor = ( AuthenticationInterceptor ) service\n-            .getInterceptor( AuthenticationInterceptor.class.getName() );\n-        authInterceptor.setPwdPolicyConfig( policyConfig );\n-\n+        .getInterceptor( AuthenticationInterceptor.class.getName() );\n+        \n         authInterceptor.loadPwdPolicyStateAtributeTypes();\n     }\n \n@@ -122,7 +126,7 @@ public void closeConnections()\n     public void testAddUserWithClearTextPwd() throws Exception\n     {\n         LdapConnection connection = getAdminNetworkConnection( ldapServer );\n-\n+        \n         DN userDn = new DN( \"cn=user,ou=system\" );\n         Entry userEntry = LdifUtils.createEntry( userDn, \"ObjectClass: top\", \"ObjectClass: person\", \"cn: user\",\n             \"sn: user_sn\", \"userPassword: 1234\" );"
            },
            {
                "sha": "96ce24e0456369f696e58ec29c87cfba64f5949d",
                "filename": "core/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/apache/directory-server/blob/b3f4b4085ea61403cc270e2b2cf872d16e21eef9/core/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/b3f4b4085ea61403cc270e2b2cf872d16e21eef9/core/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java?ref=b3f4b4085ea61403cc270e2b2cf872d16e21eef9",
                "patch": "@@ -158,7 +158,8 @@\n \n     private AttributeType AT_PWD_GRACE_USE_TIME;\n \n-    \n+    //FIXME should be removed after the config branch merge\n+    private PpolicyConfigContainer policyContainer;\n     \n     /**\n      * the set of interceptors we should *not* go through when pwdpolicy state information is being updated\n@@ -200,6 +201,8 @@ public void init( DirectoryService directoryService ) throws LdapException\n     {\n         this.directoryService = directoryService;\n \n+        directoryService.setPwdPolicies( policyContainer );;\n+        \n         schemaManager = directoryService.getSchemaManager();\n \n         adminSession = directoryService.getAdminSession();\n@@ -1095,9 +1098,8 @@ public void unbind( NextInterceptor next, UnbindOperationContext unbindContext )\n      */\n     public void setPwdPolicyConfig( PasswordPolicyConfiguration policyConfig )\n     {\n-        PpolicyConfigContainer policyContainer = new PpolicyConfigContainer();\n+        policyContainer = new PpolicyConfigContainer();\n         policyContainer.setDefaultPolicy( policyConfig );\n-        directoryService.setPwdPolicies( policyContainer );\n     }\n \n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/b16124c97fa34a58b4e70e0e7095b2df6926dadb",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/cdf549a27947f27c2281f68d7322a9cebb75303c",
        "message": "o When we can't find a SaslFactory for a mechanism, throw an exception instead of forging a BindResponse object\no Added some comments\no Included Kiran's patch for DIRAPI-30\no Fixed some potential NPE\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@999888 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_96",
        "file": [
            {
                "sha": "72a2b4027d3a004431d51918bf1130236ea8aae5",
                "filename": "server-integ/src/test/java/org/apache/directory/server/operations/bind/SaslBindIT.java",
                "status": "modified",
                "additions": 12,
                "deletions": 2,
                "changes": 14,
                "blob_url": "https://github.com/apache/directory-server/blob/b16124c97fa34a58b4e70e0e7095b2df6926dadb/server-integ/src/test/java/org/apache/directory/server/operations/bind/SaslBindIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/b16124c97fa34a58b4e70e0e7095b2df6926dadb/server-integ/src/test/java/org/apache/directory/server/operations/bind/SaslBindIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-integ/src/test/java/org/apache/directory/server/operations/bind/SaslBindIT.java?ref=b16124c97fa34a58b4e70e0e7095b2df6926dadb",
                "patch": "@@ -22,6 +22,7 @@\n \n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n \n import java.lang.reflect.Field;\n import java.net.InetAddress;\n@@ -253,8 +254,16 @@ public void testSaslBindNoMech() throws Exception\n         bindReq.setSaslMechanism( \"\" ); // invalid mechanism\n         bindReq.setSimple( false );\n \n-        BindResponse resp = connection.bind( bindReq );\n-        assertEquals( ResultCodeEnum.AUTH_METHOD_NOT_SUPPORTED, resp.getLdapResult().getResultCode() );\n+        try\n+        {\n+            connection.bind( bindReq );\n+            fail();\n+        }\n+        catch ( LdapException le )\n+        {\n+            //expected\n+        }\n+\n         connection.close();\n     }\n \n@@ -433,6 +442,7 @@ public void testSequentialBinds() throws Exception\n         for ( int i = 0; i < 1000; i++ )\n         {\n             System.out.println( \"try \" + i );\n+\n             // Digest-MD5\n             connection = new LdapNetworkConnection( \"localhost\", ldapServer.getPort() );\n             resp = connection.bindDigestMd5( userDn.getName(), \"secret\", null, ldapServer.getSaslRealms()"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/e8996a8b9bf820dc7981f3b91ce860e7c2189965",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/b6c451e6401b5b3689be330f04ef4e3978859985",
        "message": "o removed many redundant AT lookups\no fixed some NPE bugs\no used the ModifyOperationContext to bypass the interceptor chain when the pwdpolicy state information needs to be updated\no removed the @CreateDS to use a default DS instance with changelog enabled\no @Ignored a test \n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@964358 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_97",
        "file": [
            {
                "sha": "23368f40275fc38c9c43c81e15d14214e882f236",
                "filename": "core-integ/src/test/java/org/apache/directory/server/core/authn/ppolicy/PasswordPolicyTest.java",
                "status": "modified",
                "additions": 9,
                "deletions": 7,
                "changes": 16,
                "blob_url": "https://github.com/apache/directory-server/blob/e8996a8b9bf820dc7981f3b91ce860e7c2189965/core-integ/src/test/java/org/apache/directory/server/core/authn/ppolicy/PasswordPolicyTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/e8996a8b9bf820dc7981f3b91ce860e7c2189965/core-integ/src/test/java/org/apache/directory/server/core/authn/ppolicy/PasswordPolicyTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-integ/src/test/java/org/apache/directory/server/core/authn/ppolicy/PasswordPolicyTest.java?ref=e8996a8b9bf820dc7981f3b91ce860e7c2189965",
                "patch": "@@ -39,7 +39,6 @@\n import org.apache.directory.ldap.client.api.message.ModifyResponse;\n import org.apache.directory.server.annotations.CreateLdapServer;\n import org.apache.directory.server.annotations.CreateTransport;\n-import org.apache.directory.server.core.annotations.CreateDS;\n import org.apache.directory.server.core.authn.AuthenticationInterceptor;\n import org.apache.directory.server.core.authn.PasswordPolicyConfiguration;\n import org.apache.directory.server.core.authn.PasswordUtil;\n@@ -54,12 +53,14 @@\n import org.apache.directory.shared.ldap.entry.DefaultEntry;\n import org.apache.directory.shared.ldap.entry.Entry;\n import org.apache.directory.shared.ldap.entry.EntryAttribute;\n+import org.apache.directory.shared.ldap.exception.LdapException;\n import org.apache.directory.shared.ldap.message.ResultCodeEnum;\n import org.apache.directory.shared.ldap.message.control.Control;\n import org.apache.directory.shared.ldap.name.DN;\n import org.apache.directory.shared.ldap.util.StringTools;\n import org.junit.After;\n import org.junit.Before;\n+import org.junit.Ignore;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n \n@@ -75,7 +76,6 @@\n         @CreateTransport( protocol = \"LDAP\" ), \n         @CreateTransport( protocol = \"LDAPS\" ) \n     })\n-@CreateDS( enableChangeLog=false )\n public class PasswordPolicyTest extends AbstractLdapTestUnit\n {\n     private PasswordPolicyConfiguration policyConfig;\n@@ -86,7 +86,7 @@\n \n \n     @Before\n-    public void setPwdPolicy()\n+    public void setPwdPolicy() throws LdapException\n     {\n         policyConfig = new PasswordPolicyConfiguration();\n         \n@@ -104,6 +104,8 @@ public void setPwdPolicy()\n         AuthenticationInterceptor authInterceptor = ( AuthenticationInterceptor ) service\n             .getInterceptor( AuthenticationInterceptor.class.getName() );\n         authInterceptor.setPwdPolicyConfig( policyConfig );\n+        \n+        authInterceptor.loadPwdPolicyStateAtributeTypes();\n     }\n \n \n@@ -191,7 +193,7 @@ public void testAddUserWithHashedPwd() throws Exception\n         assertNotNull( userConnection );\n         assertTrue( userConnection.isAuthenticated() );\n     }\n-    \n+\n     \n     @Test\n     public void testPwdMinAge() throws Exception\n@@ -200,11 +202,11 @@ public void testPwdMinAge() throws Exception\n         \n         LdapConnection connection = getAdminNetworkConnection( ldapServer );\n         \n-        DN userDn = new DN( \"cn=user,ou=system\" );\n+        DN userDn = new DN( \"cn=userMinAge,ou=system\" );\n         Entry userEntry = new DefaultEntry( userDn );\n         userEntry.add( SchemaConstants.OBJECT_CLASS, SchemaConstants.PERSON_OC );\n-        userEntry.add( SchemaConstants.CN_AT, \"user\" );\n-        userEntry.add( SchemaConstants.SN_AT, \"user_sn\" );\n+        userEntry.add( SchemaConstants.CN_AT, \"userMinAge\" );\n+        userEntry.add( SchemaConstants.SN_AT, \"userMinAge_sn\" );\n         userEntry.add( SchemaConstants.USER_PASSWORD_AT, \"12345\".getBytes() );\n \n         AddRequest addReq = new AddRequest( userEntry );"
            },
            {
                "sha": "04c6657edb524083ed5d82424806870d4588a0b2",
                "filename": "core/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java",
                "status": "modified",
                "additions": 152,
                "deletions": 77,
                "changes": 229,
                "blob_url": "https://github.com/apache/directory-server/blob/e8996a8b9bf820dc7981f3b91ce860e7c2189965/core/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/e8996a8b9bf820dc7981f3b91ce860e7c2189965/core/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/authn/AuthenticationInterceptor.java?ref=e8996a8b9bf820dc7981f3b91ce860e7c2189965",
                "patch": "@@ -30,6 +30,9 @@\n import static org.apache.directory.shared.ldap.constants.PasswordPolicySchemaConstants.PWD_HISTORY_AT;\n import static org.apache.directory.shared.ldap.constants.PasswordPolicySchemaConstants.PWD_LAST_SUCCESS_AT;\n import static org.apache.directory.shared.ldap.constants.PasswordPolicySchemaConstants.PWD_RESET_AT;\n+import static org.apache.directory.shared.ldap.entry.ModificationOperation.ADD_ATTRIBUTE;\n+import static org.apache.directory.shared.ldap.entry.ModificationOperation.REMOVE_ATTRIBUTE;\n+import static org.apache.directory.shared.ldap.entry.ModificationOperation.REPLACE_ATTRIBUTE;\n \n import java.util.ArrayList;\n import java.util.Arrays;\n@@ -48,6 +51,11 @@\n import org.apache.directory.server.core.DefaultCoreSession;\n import org.apache.directory.server.core.DirectoryService;\n import org.apache.directory.server.core.LdapPrincipal;\n+import org.apache.directory.server.core.authz.AciAuthorizationInterceptor;\n+import org.apache.directory.server.core.authz.DefaultAuthorizationInterceptor;\n+import org.apache.directory.server.core.collective.CollectiveAttributeInterceptor;\n+import org.apache.directory.server.core.event.EventInterceptor;\n+import org.apache.directory.server.core.exception.ExceptionInterceptor;\n import org.apache.directory.server.core.filtering.EntryFilteringCursor;\n import org.apache.directory.server.core.interceptor.BaseInterceptor;\n import org.apache.directory.server.core.interceptor.Interceptor;\n@@ -67,6 +75,11 @@\n import org.apache.directory.server.core.interceptor.context.RenameOperationContext;\n import org.apache.directory.server.core.interceptor.context.SearchOperationContext;\n import org.apache.directory.server.core.interceptor.context.UnbindOperationContext;\n+import org.apache.directory.server.core.normalization.NormalizationInterceptor;\n+import org.apache.directory.server.core.operational.OperationalAttributeInterceptor;\n+import org.apache.directory.server.core.schema.SchemaInterceptor;\n+import org.apache.directory.server.core.subtree.SubentryInterceptor;\n+import org.apache.directory.server.core.trigger.TriggerInterceptor;\n import org.apache.directory.server.i18n.I18n;\n import org.apache.directory.shared.ldap.codec.controls.ppolicy.PasswordPolicyErrorEnum;\n import org.apache.directory.shared.ldap.codec.controls.ppolicy.PasswordPolicyRequestControl;\n@@ -90,13 +103,13 @@\n import org.apache.directory.shared.ldap.exception.LdapUnwillingToPerformException;\n import org.apache.directory.shared.ldap.message.ResultCodeEnum;\n import org.apache.directory.shared.ldap.name.DN;\n+import org.apache.directory.shared.ldap.schema.AttributeType;\n import org.apache.directory.shared.ldap.schema.SchemaManager;\n import org.apache.directory.shared.ldap.util.DateUtils;\n import org.apache.directory.shared.ldap.util.StringTools;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n-\n /**\n  * An {@link Interceptor} that authenticates users.\n  *\n@@ -122,11 +135,46 @@\n \n     private CoreSession adminSession;\n \n-    private boolean pwdPolicyEnabled = false;\n-\n     private Set<DN> pwdResetSet = new HashSet<DN>();\n \n+    // pwdpolicy state attribute types\n+    private AttributeType AT_PWD_RESET;\n+    \n+    private AttributeType AT_PWD_CHANGED_TIME;\n+    \n+    private AttributeType AT_PWD_HISTORY;\n+\n+    private AttributeType AT_PWD_FAILURE_TIME;\n+    \n+    private AttributeType AT_PWD_ACCOUNT_LOCKED_TIME;\n+    \n+    private AttributeType AT_PWD_LAST_SUCCESS;\n+    \n+    private AttributeType AT_PWD_GRACE_USE_TIME;\n \n+    /**\n+     * the set of interceptors we should *not* go through when pwdpolicy state information is being updated\n+     */\n+    private static final Collection<String> BYPASS_INTERCEPTORS;\n+\n+    static\n+    {\n+        Set<String> c = new HashSet<String>();\n+        c.add( NormalizationInterceptor.class.getName() );\n+        c.add( AuthenticationInterceptor.class.getName() );\n+        c.add( AciAuthorizationInterceptor.class.getName() );\n+        c.add( DefaultAuthorizationInterceptor.class.getName() );\n+        c.add( ExceptionInterceptor.class.getName() );\n+        c.add( OperationalAttributeInterceptor.class.getName() );\n+        c.add( SchemaInterceptor.class.getName() );\n+        c.add( SubentryInterceptor.class.getName() );\n+        c.add( CollectiveAttributeInterceptor.class.getName() );\n+        c.add( EventInterceptor.class.getName() );\n+        c.add( TriggerInterceptor.class.getName() );\n+        BYPASS_INTERCEPTORS = Collections.unmodifiableCollection( c );\n+    }\n+\n+    \n     /**\n      * Creates an authentication service interceptor.\n      */\n@@ -146,11 +194,8 @@ public void init( DirectoryService directoryService ) throws LdapException\n \n         adminSession = directoryService.getAdminSession();\n \n-        if ( policyConfig != null )\n-        {\n-            pwdPolicyEnabled = true;\n-        }\n-\n+        loadPwdPolicyStateAtributeTypes();\n+        \n         if ( authenticators == null )\n         {\n             setDefaultAuthenticators();\n@@ -215,7 +260,6 @@ public void destroy()\n     private void register( Authenticator authenticator, DirectoryService directoryService ) throws LdapException\n     {\n         authenticator.init( directoryService );\n-        authenticator.setPwdPolicyConfig( policyConfig );\n \n         Collection<Authenticator> authenticatorList = getAuthenticators( authenticator.getAuthenticatorType() );\n \n@@ -303,24 +347,21 @@ public void add( NextInterceptor next, AddOperationContext addContext ) throws L\n             String pwdChangedTime = DateUtils.getGeneralizedTime();\n             if( ( policyConfig.getPwdMinAge() > 0 ) || ( policyConfig.getPwdMaxAge() > 0 ) )\n             {\n-                EntryAttribute pwdChangedTimeAt = new DefaultEntryAttribute(\n-                    schemaManager.lookupAttributeTypeRegistry( PWD_CHANGED_TIME_AT ) );\n+                EntryAttribute pwdChangedTimeAt = new DefaultEntryAttribute( AT_PWD_CHANGED_TIME );\n                 pwdChangedTimeAt.add( pwdChangedTime );\n                 entry.add( pwdChangedTimeAt );\n             }\n \n             if ( policyConfig.isPwdMustChange() && addContext.getSession().isAnAdministrator() )\n             {\n-                EntryAttribute pwdMustChangeAt = new DefaultEntryAttribute(\n-                    schemaManager.lookupAttributeTypeRegistry( PWD_RESET_AT ) );\n-                pwdMustChangeAt.add( \"TRUE\" );\n-                entry.add( pwdMustChangeAt );\n+                EntryAttribute pwdResetAt = new DefaultEntryAttribute( AT_PWD_RESET );\n+                pwdResetAt.add( \"TRUE\" );\n+                entry.add( pwdResetAt );\n             }\n \n             if ( policyConfig.getPwdInHistory() > 0 )\n             {\n-                EntryAttribute pwdHistoryAt = new DefaultEntryAttribute(\n-                    schemaManager.lookupAttributeTypeRegistry( PWD_HISTORY_AT ) );\n+                EntryAttribute pwdHistoryAt = new DefaultEntryAttribute( AT_PWD_HISTORY );\n                 byte[] pwdHistoryVal = new PasswordHistory( pwdChangedTime, userPassword.get() ).getHistoryValue();\n                 pwdHistoryAt.add( pwdHistoryVal );\n                 entry.add( pwdHistoryAt );\n@@ -567,14 +608,14 @@ public void modify( NextInterceptor next, ModifyOperationContext modifyContext )\n \n             pwdHistoryAt = new DefaultEntryAttribute( pwdHistoryAt.getAttributeType() );\n             pwdHistoryAt.add( newPwdHist.getHistoryValue() );\n-            pwdAddHistMod = new DefaultModification( ModificationOperation.ADD_ATTRIBUTE, pwdHistoryAt );\n+            pwdAddHistMod = new DefaultModification( ADD_ATTRIBUTE, pwdHistoryAt );\n \n             if ( pwdHistSet.size() > histSize )\n             {\n                 pwdHistoryAt = new DefaultEntryAttribute( pwdHistoryAt.getAttributeType() );\n                 PasswordHistory remPwdHist = ( PasswordHistory ) pwdHistSet.toArray()[histSize - 1];\n                 pwdHistoryAt.add( remPwdHist.getHistoryValue() );\n-                pwdRemHistMod = new DefaultModification( ModificationOperation.REMOVE_ATTRIBUTE, pwdHistoryAt );\n+                pwdRemHistMod = new DefaultModification( REMOVE_ATTRIBUTE, pwdHistoryAt );\n             }\n         }\n \n@@ -586,11 +627,9 @@ public void modify( NextInterceptor next, ModifyOperationContext modifyContext )\n             List<Modification> mods = new ArrayList<Modification>();\n             if ( ( policyConfig.getPwdMinAge() > 0 ) || ( policyConfig.getPwdMaxAge() > 0 ) )\n             {\n-                EntryAttribute pwdChangedTimeAt = new DefaultEntryAttribute(\n-                    schemaManager.lookupAttributeTypeRegistry( PWD_CHANGED_TIME_AT ) );\n+                EntryAttribute pwdChangedTimeAt = new DefaultEntryAttribute( AT_PWD_CHANGED_TIME );\n                 pwdChangedTimeAt.add( pwdChangedTime );\n-                Modification pwdChangedTimeMod = new DefaultModification( ModificationOperation.REPLACE_ATTRIBUTE,\n-                    pwdChangedTimeAt );\n+                Modification pwdChangedTimeMod = new DefaultModification( REPLACE_ATTRIBUTE, pwdChangedTimeAt );\n                 mods.add( pwdChangedTimeMod );\n             }\n \n@@ -607,19 +646,17 @@ public void modify( NextInterceptor next, ModifyOperationContext modifyContext )\n             boolean removeFromPwdResetSet = false;\n             if ( policyConfig.isPwdMustChange() )\n             {\n-                EntryAttribute pwdMustChangeAt = new DefaultEntryAttribute(\n-                    schemaManager.lookupAttributeTypeRegistry( PWD_RESET_AT ) );\n+                EntryAttribute pwdMustChangeAt = new DefaultEntryAttribute( AT_PWD_RESET );\n                 Modification pwdMustChangeMod = null;\n \n                 if ( modifyContext.getSession().isAnAdministrator() )\n                 {\n                     pwdMustChangeAt.add( \"TRUE\" );\n-                    pwdMustChangeMod = new DefaultModification( ModificationOperation.REPLACE_ATTRIBUTE,\n-                        pwdMustChangeAt );\n+                    pwdMustChangeMod = new DefaultModification( REPLACE_ATTRIBUTE, pwdMustChangeAt );\n                 }\n                 else\n                 {\n-                    pwdMustChangeMod = new DefaultModification( ModificationOperation.REMOVE_ATTRIBUTE, pwdMustChangeAt );\n+                    pwdMustChangeMod = new DefaultModification( REMOVE_ATTRIBUTE, pwdMustChangeAt );\n                     removeFromPwdResetSet = true;\n                 }\n \n@@ -629,17 +666,17 @@ public void modify( NextInterceptor next, ModifyOperationContext modifyContext )\n             EntryAttribute pwdFailureTimeAt = entry.get( PWD_FAILURE_TIME_AT );\n             if ( pwdFailureTimeAt != null )\n             {\n-                mods.add( new DefaultModification( ModificationOperation.REMOVE_ATTRIBUTE, pwdFailureTimeAt ) );\n+                mods.add( new DefaultModification( REMOVE_ATTRIBUTE, pwdFailureTimeAt ) );\n             }\n \n             EntryAttribute pwdGraceUseTimeAt = entry.get( PWD_GRACE_USE_TIME_AT );\n             if ( pwdGraceUseTimeAt != null )\n             {\n-                mods.add( new DefaultModification( ModificationOperation.REMOVE_ATTRIBUTE, pwdGraceUseTimeAt ) );\n+                mods.add( new DefaultModification( REMOVE_ATTRIBUTE, pwdGraceUseTimeAt ) );\n             }\n \n-            directoryService.getAdminSession().modify( modifyContext.getDn(), mods );\n-\n+//            directoryService.getAdminSession().modify( modifyContext.getDn(), mods );\n+            \n             if ( removeFromPwdResetSet )\n             {\n                 pwdResetSet.remove( userDn );\n@@ -804,6 +841,8 @@ public void bind( NextInterceptor next, BindOperationContext bindContext ) throw\n         {\n             try\n             {\n+                authenticator.setPwdPolicyConfig( policyConfig );\n+                \n                 // perform the authentication\n                 LdapPrincipal principal = authenticator.authenticate( bindContext );\n \n@@ -863,13 +902,12 @@ public void bind( NextInterceptor next, BindOperationContext bindContext ) throw\n                 LOG.info( \"Cannot bind to the server \" );\n             }\n \n-            if ( pwdPolicyEnabled )\n+            if ( policyConfig != null )\n             {\n                 EntryAttribute pwdFailTimeAt = bindContext.getEntry().get( PWD_FAILURE_TIME_AT );\n                 if ( pwdFailTimeAt == null )\n                 {\n-                    pwdFailTimeAt = new DefaultEntryAttribute(\n-                        schemaManager.lookupAttributeTypeRegistry( PWD_FAILURE_TIME_AT ) );\n+                    pwdFailTimeAt = new DefaultEntryAttribute( AT_PWD_FAILURE_TIME );\n                 }\n                 else\n                 {\n@@ -878,8 +916,7 @@ public void bind( NextInterceptor next, BindOperationContext bindContext ) throw\n \n                 String failureTime = DateUtils.getGeneralizedTime();\n                 pwdFailTimeAt.add( failureTime );\n-                Modification pwdFailTimeMod = new DefaultModification( ModificationOperation.ADD_ATTRIBUTE,\n-                    pwdFailTimeAt );\n+                Modification pwdFailTimeMod = new DefaultModification( ADD_ATTRIBUTE, pwdFailTimeAt );\n \n                 List<Modification> mods = new ArrayList<Modification>();\n                 mods.add( pwdFailTimeMod );\n@@ -888,11 +925,9 @@ public void bind( NextInterceptor next, BindOperationContext bindContext ) throw\n \n                 if ( policyConfig.isPwdLockout() && ( numFailures >= policyConfig.getPwdMaxFailure() ) )\n                 {\n-                    EntryAttribute pwdAccountLockedTimeAt = new DefaultEntryAttribute(\n-                        schemaManager.lookupAttributeTypeRegistry( PWD_ACCOUNT_LOCKED_TIME_AT ) );\n+                    EntryAttribute pwdAccountLockedTimeAt = new DefaultEntryAttribute( AT_PWD_ACCOUNT_LOCKED_TIME );\n                     pwdAccountLockedTimeAt.add( failureTime );\n-                    Modification pwdAccountLockedMod = new DefaultModification( ModificationOperation.ADD_ATTRIBUTE,\n-                        pwdAccountLockedTimeAt );\n+                    Modification pwdAccountLockedMod = new DefaultModification( ADD_ATTRIBUTE, pwdAccountLockedTimeAt );\n                     mods.add( pwdAccountLockedMod );\n \n                     pwdRespCtrl.setPasswordPolicyError( PasswordPolicyErrorEnum.ACCOUNT_LOCKED );\n@@ -918,66 +953,80 @@ else if ( policyConfig.getPwdMinDelay() > 0 )\n                     }\n                 }\n \n-                adminSession.modify( dn, Collections.singletonList( pwdFailTimeMod ) );\n+                //adminSession.modify( dn, Collections.singletonList( pwdFailTimeMod ) );\n+                ModifyOperationContext bindModCtx = new ModifyOperationContext( adminSession );\n+                bindModCtx.setByPassed( BYPASS_INTERCEPTORS );\n+                bindModCtx.setDn( dn );\n+                bindModCtx.setModItems( Collections.singletonList( pwdFailTimeMod ) );\n+                directoryService.getOperationManager().modify( bindModCtx );\n             }\n \n             String upDn = ( dn == null ? \"\" : dn.getName() );\n             throw new LdapAuthenticationException( I18n.err( I18n.ERR_229, upDn ) );\n         }\n-        else if ( pwdPolicyEnabled )\n+        else if ( policyConfig != null )\n         {\n             List<Modification> mods = new ArrayList<Modification>();\n \n             if ( policyConfig.getPwdMaxIdle() > 0 )\n             {\n-                EntryAttribute pwdLastSuccesTimeAt = new DefaultEntryAttribute(\n-                    schemaManager.lookupAttributeTypeRegistry( PWD_LAST_SUCCESS_AT ) );\n+                EntryAttribute pwdLastSuccesTimeAt = new DefaultEntryAttribute( AT_PWD_LAST_SUCCESS );\n                 pwdLastSuccesTimeAt.add( DateUtils.getGeneralizedTime() );\n-                Modification pwdLastSuccesTimeMod = new DefaultModification( ModificationOperation.REPLACE_ATTRIBUTE,\n-                    pwdLastSuccesTimeAt );\n+                Modification pwdLastSuccesTimeMod = new DefaultModification( REPLACE_ATTRIBUTE, pwdLastSuccesTimeAt );\n                 mods.add( pwdLastSuccesTimeMod );\n             }\n \n-            EntryAttribute pwdFailTimeAt = new DefaultEntryAttribute(\n-                schemaManager.lookupAttributeTypeRegistry( PWD_FAILURE_TIME_AT ) );\n-            Modification pwdFailTimeMod = new DefaultModification( ModificationOperation.REMOVE_ATTRIBUTE,\n-                pwdFailTimeAt );\n-            mods.add( pwdFailTimeMod );\n+            EntryAttribute pwdFailTimeAt = userEntry.get( AT_PWD_FAILURE_TIME );\n+            if( pwdFailTimeAt != null )\n+            {\n+                Modification pwdFailTimeMod = new DefaultModification( REMOVE_ATTRIBUTE, pwdFailTimeAt );\n+                mods.add( pwdFailTimeMod );\n+            }\n \n-            EntryAttribute pwdAccLockedTimeAt = new DefaultEntryAttribute(\n-                schemaManager.lookupAttributeTypeRegistry( PWD_ACCOUNT_LOCKED_TIME_AT ) );\n-            Modification pwdAccLockedTimeMod = new DefaultModification( ModificationOperation.REMOVE_ATTRIBUTE,\n-                pwdAccLockedTimeAt );\n-            mods.add( pwdAccLockedTimeMod );\n+            EntryAttribute pwdAccLockedTimeAt = userEntry.get( AT_PWD_ACCOUNT_LOCKED_TIME );\n+            if( pwdAccLockedTimeAt != null )\n+            {\n+                Modification pwdAccLockedTimeMod = new DefaultModification( REMOVE_ATTRIBUTE, pwdAccLockedTimeAt );\n+                mods.add( pwdAccLockedTimeMod );\n+            }\n \n             // checking the expiration time *after* performing authentication, do we need to care about millisecond precision?\n             if ( ( policyConfig.getPwdMaxAge() > 0 ) && ( policyConfig.getPwdGraceAuthNLimit() > 0 ) )\n             {\n                 EntryAttribute pwdChangeTimeAttr = userEntry.get( PWD_CHANGED_TIME_AT );\n-                boolean expired = PasswordUtil\n-                    .isPwdExpired( pwdChangeTimeAttr.getString(), policyConfig.getPwdMaxAge() );\n-                if ( expired )\n+                if( pwdChangeTimeAttr != null )\n                 {\n-                    EntryAttribute pwdGraceUseAttr = userEntry.get( PWD_GRACE_USE_TIME_AT );\n-                    if ( pwdGraceUseAttr != null )\n-                    {\n-                        pwdRespCtrl.setGraceAuthNsRemaining( policyConfig.getPwdGraceAuthNLimit()\n-                            - ( pwdGraceUseAttr.size() + 1 ) );\n-                    }\n-                    else\n+                    boolean expired = PasswordUtil\n+                    .isPwdExpired( pwdChangeTimeAttr.getString(), policyConfig.getPwdMaxAge() );\n+                    if ( expired )\n                     {\n-                        pwdGraceUseAttr = new DefaultEntryAttribute(\n-                            schemaManager.lookupAttributeTypeRegistry( PWD_GRACE_USE_TIME_AT ) );\n+                        EntryAttribute pwdGraceUseAttr = userEntry.get( PWD_GRACE_USE_TIME_AT );\n+                        if ( pwdGraceUseAttr != null )\n+                        {\n+                            pwdRespCtrl.setGraceAuthNsRemaining( policyConfig.getPwdGraceAuthNLimit()\n+                                - ( pwdGraceUseAttr.size() + 1 ) );\n+                        }\n+                        else\n+                        {\n+                            pwdGraceUseAttr = new DefaultEntryAttribute( AT_PWD_GRACE_USE_TIME );\n+                        }\n+                        \n+                        pwdGraceUseAttr.add( DateUtils.getGeneralizedTime() );\n+                        Modification pwdGraceUseMod = new DefaultModification( ADD_ATTRIBUTE, pwdGraceUseAttr );\n+                        mods.add( pwdGraceUseMod );\n                     }\n-\n-                    pwdGraceUseAttr.add( DateUtils.getGeneralizedTime() );\n-                    Modification pwdGraceUseMod = new DefaultModification( ModificationOperation.ADD_ATTRIBUTE,\n-                        pwdGraceUseAttr );\n-                    mods.add( pwdGraceUseMod );\n                 }\n             }\n \n-            adminSession.modify( dn, mods );\n+            if( !mods.isEmpty() )\n+            {\n+                //adminSession.modify( dn, mods );\n+                ModifyOperationContext bindModCtx = new ModifyOperationContext( adminSession );\n+                bindModCtx.setByPassed( BYPASS_INTERCEPTORS );\n+                bindModCtx.setDn( dn );\n+                bindModCtx.setModItems( mods );\n+                directoryService.getOperationManager().modify( bindModCtx );\n+            }\n \n             if ( isPPolicyReqCtrlPresent )\n             {\n@@ -1017,6 +1066,32 @@ public void setPwdPolicyConfig( PasswordPolicyConfiguration policyConfig )\n         this.policyConfig = policyConfig;\n     }\n \n+    public void loadPwdPolicyStateAtributeTypes() throws LdapException\n+    {\n+        if ( policyConfig != null )\n+        {\n+            AT_PWD_RESET = schemaManager.lookupAttributeTypeRegistry( PWD_RESET_AT );\n+            PWD_POLICY_STATE_ATTRIBUTE_TYPES.add( AT_PWD_RESET );\n+            \n+            AT_PWD_CHANGED_TIME = schemaManager.lookupAttributeTypeRegistry( PWD_CHANGED_TIME_AT );\n+            PWD_POLICY_STATE_ATTRIBUTE_TYPES.add( AT_PWD_CHANGED_TIME );\n+            \n+            AT_PWD_HISTORY = schemaManager.lookupAttributeTypeRegistry( PWD_HISTORY_AT );\n+            PWD_POLICY_STATE_ATTRIBUTE_TYPES.add( AT_PWD_HISTORY );\n+            \n+            AT_PWD_FAILURE_TIME = schemaManager.lookupAttributeTypeRegistry( PWD_FAILURE_TIME_AT );\n+            PWD_POLICY_STATE_ATTRIBUTE_TYPES.add( AT_PWD_FAILURE_TIME );\n+            \n+            AT_PWD_ACCOUNT_LOCKED_TIME = schemaManager.lookupAttributeTypeRegistry( PWD_ACCOUNT_LOCKED_TIME_AT );\n+            PWD_POLICY_STATE_ATTRIBUTE_TYPES.add( AT_PWD_ACCOUNT_LOCKED_TIME );\n+            \n+            AT_PWD_LAST_SUCCESS = schemaManager.lookupAttributeTypeRegistry( PWD_LAST_SUCCESS_AT );\n+            PWD_POLICY_STATE_ATTRIBUTE_TYPES.add( AT_PWD_LAST_SUCCESS );\n+            \n+            AT_PWD_GRACE_USE_TIME = schemaManager.lookupAttributeTypeRegistry( PWD_GRACE_USE_TIME_AT );\n+            PWD_POLICY_STATE_ATTRIBUTE_TYPES.add( AT_PWD_GRACE_USE_TIME );\n+        }\n+    }\n \n     // ---------- private methods ----------------\n \n@@ -1261,11 +1336,11 @@ private PwdModDetailsHolder getPwdModDetails( ModifyOperationContext modifyConte\n                 pwdModDetails.setPwdModPresent( true );\n                 ModificationOperation op = m.getOperation();\n \n-                if ( op == ModificationOperation.REMOVE_ATTRIBUTE )\n+                if ( op == REMOVE_ATTRIBUTE )\n                 {\n                     pwdModDetails.setDelete( true );\n                 }\n-                else if ( op == ModificationOperation.REPLACE_ATTRIBUTE || op == ModificationOperation.ADD_ATTRIBUTE )\n+                else if ( op == REPLACE_ATTRIBUTE || op == ADD_ATTRIBUTE )\n                 {\n                     pwdModDetails.setAddOrReplace( true );\n                     pwdModDetails.setNewPwd( at.getBytes() );"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/d079b906ee168fb7d3a71731e0b1630f37ec7e0e",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/06e3ec724aa80abdb894a35abf2f1bf5b6fc2b4b",
        "message": "o Added a fix for DIRSERVER-1448 : w don't throw anymore a NPE if a modification removes all the OC for an entry.\no The associated error message code has been improved\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@948490 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_98",
        "file": [
            {
                "sha": "45473eb492b04e67ba0dd04e1fe9442cefed16c5",
                "filename": "core/src/main/java/org/apache/directory/server/core/collective/CollectiveAttributesSchemaChecker.java",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/apache/directory-server/blob/d079b906ee168fb7d3a71731e0b1630f37ec7e0e/core/src/main/java/org/apache/directory/server/core/collective/CollectiveAttributesSchemaChecker.java",
                "raw_url": "https://github.com/apache/directory-server/raw/d079b906ee168fb7d3a71731e0b1630f37ec7e0e/core/src/main/java/org/apache/directory/server/core/collective/CollectiveAttributesSchemaChecker.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/collective/CollectiveAttributesSchemaChecker.java?ref=d079b906ee168fb7d3a71731e0b1630f37ec7e0e",
                "patch": "@@ -30,10 +30,10 @@\n import org.apache.directory.server.core.partition.PartitionNexus;\n import org.apache.directory.server.i18n.I18n;\n import org.apache.directory.shared.ldap.constants.SchemaConstants;\n+import org.apache.directory.shared.ldap.entry.Entry;\n import org.apache.directory.shared.ldap.entry.EntryAttribute;\n import org.apache.directory.shared.ldap.entry.Modification;\n import org.apache.directory.shared.ldap.entry.ModificationOperation;\n-import org.apache.directory.shared.ldap.entry.Entry;\n import org.apache.directory.shared.ldap.exception.LdapException;\n import org.apache.directory.shared.ldap.exception.LdapInvalidAttributeTypeException;\n import org.apache.directory.shared.ldap.exception.LdapSchemaViolationException;\n@@ -83,6 +83,12 @@ public void checkModify( OperationContext opContext, DN normName, List<Modificat\n         \n         EntryAttribute targetObjectClasses = targetEntry.get( SchemaConstants.OBJECT_CLASS_AT );\n         \n+        if ( targetObjectClasses == null )\n+        {\n+            // This is not allowed \n+            throw new LdapSchemaViolationException( ResultCodeEnum.OTHER, I18n.err( I18n.ERR_272_MODIFY_LEAVES_NO_STRUCTURAL_OBJECT_CLASS, originalEntry.getDn() ));\n+        }\n+        \n         if ( targetObjectClasses.contains( SchemaConstants.COLLECTIVE_ATTRIBUTE_SUBENTRY_OC ) )\n         {\n             return;"
            },
            {
                "sha": "b534665a68753b059d7682c8fdb9625b44ceebfb",
                "filename": "core/src/main/java/org/apache/directory/server/core/schema/SchemaChecker.java",
                "status": "modified",
                "additions": 7,
                "deletions": 7,
                "changes": 14,
                "blob_url": "https://github.com/apache/directory-server/blob/d079b906ee168fb7d3a71731e0b1630f37ec7e0e/core/src/main/java/org/apache/directory/server/core/schema/SchemaChecker.java",
                "raw_url": "https://github.com/apache/directory-server/raw/d079b906ee168fb7d3a71731e0b1630f37ec7e0e/core/src/main/java/org/apache/directory/server/core/schema/SchemaChecker.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/schema/SchemaChecker.java?ref=d079b906ee168fb7d3a71731e0b1630f37ec7e0e",
                "patch": "@@ -27,9 +27,9 @@\n \n import org.apache.directory.server.i18n.I18n;\n import org.apache.directory.shared.ldap.constants.SchemaConstants;\n+import org.apache.directory.shared.ldap.entry.Entry;\n import org.apache.directory.shared.ldap.entry.EntryAttribute;\n import org.apache.directory.shared.ldap.entry.ModificationOperation;\n-import org.apache.directory.shared.ldap.entry.Entry;\n import org.apache.directory.shared.ldap.entry.Value;\n import org.apache.directory.shared.ldap.exception.LdapException;\n import org.apache.directory.shared.ldap.exception.LdapSchemaViolationException;\n@@ -88,7 +88,7 @@ public static void preventStructuralClassRemovalOnModifyReplace( SchemaManager s\n         // all the objectClass values in which case we must throw an exception\n         if ( attribute.size() == 0 )\n         {\n-            String msg = I18n.err( I18n.ERR_272, name );\n+            String msg = I18n.err( I18n.ERR_272_MODIFY_LEAVES_NO_STRUCTURAL_OBJECT_CLASS, name );\n             \n             if ( log.isInfoEnabled() )\n             {\n@@ -111,7 +111,7 @@ public static void preventStructuralClassRemovalOnModifyReplace( SchemaManager s\n \n         // no structural object classes exist for the entry in the replacement\n         // set for the objectClass attribute so we need to complain about that\n-        String msg = I18n.err( I18n.ERR_272, name );\n+        String msg = I18n.err( I18n.ERR_272_MODIFY_LEAVES_NO_STRUCTURAL_OBJECT_CLASS, name );\n         if ( log.isInfoEnabled() )\n         {\n             log.info( msg + \".  Raising LdapSchemaViolationException.\" );\n@@ -152,7 +152,7 @@ public static void preventStructuralClassRemovalOnModifyReplace(\n         // all the objectClass values in which case we must throw an exception\n         if ( objectClass.size() == 0 )\n         {\n-            String msg = I18n.err( I18n.ERR_272, name );\n+            String msg = I18n.err( I18n.ERR_272_MODIFY_LEAVES_NO_STRUCTURAL_OBJECT_CLASS, name );\n             if ( log.isInfoEnabled() )\n             {\n                 log.info( msg + \".  Raising LdapSchemaViolationException.\" );\n@@ -173,7 +173,7 @@ public static void preventStructuralClassRemovalOnModifyReplace(\n \n         // no structural object classes exist for the entry in the replacement\n         // set for the objectClass attribute so we need to complain about that\n-        String msg =  I18n.err( I18n.ERR_272, name );\n+        String msg =  I18n.err( I18n.ERR_272_MODIFY_LEAVES_NO_STRUCTURAL_OBJECT_CLASS, name );\n         if ( log.isInfoEnabled() )\n         {\n             log.info( msg + \".  Raising LdapSchemaViolationException.\" );\n@@ -232,7 +232,7 @@ public static void preventStructuralClassRemovalOnModifyRemove( SchemaManager sc\n         // all the objectClass values in which case we must throw an exception\n         if ( attribute.size() == 0 )\n         {\n-            String msg =  I18n.err( I18n.ERR_272, name );\n+            String msg =  I18n.err( I18n.ERR_272_MODIFY_LEAVES_NO_STRUCTURAL_OBJECT_CLASS, name );\n             \n             if ( log.isInfoEnabled() )\n             {\n@@ -266,7 +266,7 @@ public static void preventStructuralClassRemovalOnModifyRemove( SchemaManager sc\n \n         // no structural object classes exist for the entry after the modifications\n         // to the objectClass attribute so we need to complain about that\n-        String msg =  I18n.err( I18n.ERR_272, name );\n+        String msg =  I18n.err( I18n.ERR_272_MODIFY_LEAVES_NO_STRUCTURAL_OBJECT_CLASS, name );\n \n         if ( log.isInfoEnabled() )\n         {"
            },
            {
                "sha": "2ed0e7db4b1e18c0831c119d871b2c08078a7846",
                "filename": "i18n/src/main/java/org/apache/directory/server/i18n/I18n.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/d079b906ee168fb7d3a71731e0b1630f37ec7e0e/i18n/src/main/java/org/apache/directory/server/i18n/I18n.java",
                "raw_url": "https://github.com/apache/directory-server/raw/d079b906ee168fb7d3a71731e0b1630f37ec7e0e/i18n/src/main/java/org/apache/directory/server/i18n/I18n.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/i18n/src/main/java/org/apache/directory/server/i18n/I18n.java?ref=d079b906ee168fb7d3a71731e0b1630f37ec7e0e",
                "patch": "@@ -305,7 +305,7 @@\n     ERR_269( \"ERR_269\" ),\n     ERR_270( \"ERR_270\" ),\n     ERR_271( \"ERR_271\" ),\n-    ERR_272( \"ERR_272\" ),\n+    ERR_272_MODIFY_LEAVES_NO_STRUCTURAL_OBJECT_CLASS( \"ERR_272_MODIFY_LEAVES_NO_STRUCTURAL_OBJECT_CLASS\" ),\n     ERR_273( \"ERR_273\" ),\n     ERR_274( \"ERR_274\" ),\n     ERR_275( \"ERR_275\" ),"
            },
            {
                "sha": "164e6cc9493b5e74b1da35efff7042a02bfe8481",
                "filename": "i18n/src/main/resources/org/apache/directory/server/i18n/errors.properties",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/d079b906ee168fb7d3a71731e0b1630f37ec7e0e/i18n/src/main/resources/org/apache/directory/server/i18n/errors.properties",
                "raw_url": "https://github.com/apache/directory-server/raw/d079b906ee168fb7d3a71731e0b1630f37ec7e0e/i18n/src/main/resources/org/apache/directory/server/i18n/errors.properties",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/i18n/src/main/resources/org/apache/directory/server/i18n/errors.properties?ref=d079b906ee168fb7d3a71731e0b1630f37ec7e0e",
                "patch": "@@ -293,7 +293,7 @@ ERR_268=Cannot find a partition for {0}\n ERR_269=userRoot() in org.apache.directory.server.prefs.ServerPreferencesFactory not implemented!\n ERR_270=Failed to set up node.\n ERR_271=Failed to get SPI.\n-ERR_272=Modify operation leaves no structural objectClass for entry {0}\n+ERR_272_MODIFY_LEAVES_NO_STRUCTURAL_OBJECT_CLASS=Modify operation leaves no structural objectClass for entry {0}\n ERR_273=Modify operation attempts to delete RDN attribute {0} on entry {1} violates schema constraints\n ERR_274=Modify operation attempts to delete RDN attribute values in use for {0} on entry {1} and violates schema constraints\n ERR_275={0} not found in attribute registry!"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/f29b27fc50328a70f39f0662229ab3bcef203f53",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/9db7285016ede0e35c339ba6b370355898b15529",
        "message": "Fixed a NPE I introduced yesterday night.\nRule #1 : always run full build before committing\nRule #2 : don't commit at 4 am if you are too tired to wait 10 minutes for the build to end... \n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@946589 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_99",
        "file": [
            {
                "sha": "6e13ed8d8a26836bb3eca587818e2df9a453d071",
                "filename": "jdbm/src/main/java/jdbm/btree/BTree.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/f29b27fc50328a70f39f0662229ab3bcef203f53/jdbm/src/main/java/jdbm/btree/BTree.java",
                "raw_url": "https://github.com/apache/directory-server/raw/f29b27fc50328a70f39f0662229ab3bcef203f53/jdbm/src/main/java/jdbm/btree/BTree.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/jdbm/src/main/java/jdbm/btree/BTree.java?ref=f29b27fc50328a70f39f0662229ab3bcef203f53",
                "patch": "@@ -563,7 +563,7 @@ public void readExternal( ObjectInput in ) throws IOException, ClassNotFoundExce\n         bTreeHeight = in.readInt();\n         rootId = in.readLong();\n         pageSize = in.readInt();\n-        nbEntries.set( in.readInt() );\n+        nbEntries = new AtomicInteger( in.readInt() );\n     }\n \n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/3128c55f844c31fd55437cdcb4846c7835ef8c4f",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/a39a365c0d5179dd6f54b923658f60603764ac79",
        "message": "Added partitions have the registries injected if it's not already done\nFixed a NPE by injecting the working directory in the JDBMPartition\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/apacheds-schema@813577 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_100",
        "file": [
            {
                "sha": "4361706b52f901ad2f07a13a4d64a8c14eeb44c5",
                "filename": "core-integ/src/test/java/org/apache/directory/server/core/jndi/MixedCaseITest.java",
                "status": "modified",
                "additions": 80,
                "deletions": 30,
                "changes": 110,
                "blob_url": "https://github.com/apache/directory-server/blob/3128c55f844c31fd55437cdcb4846c7835ef8c4f/core-integ/src/test/java/org/apache/directory/server/core/jndi/MixedCaseITest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/3128c55f844c31fd55437cdcb4846c7835ef8c4f/core-integ/src/test/java/org/apache/directory/server/core/jndi/MixedCaseITest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-integ/src/test/java/org/apache/directory/server/core/jndi/MixedCaseITest.java?ref=3128c55f844c31fd55437cdcb4846c7835ef8c4f",
                "patch": "@@ -20,33 +20,16 @@\n package org.apache.directory.server.core.jndi;\n \n \n-import org.apache.directory.server.core.DefaultDirectoryService;\n-import org.apache.directory.server.core.DirectoryService;\n-import org.apache.directory.server.core.entry.ServerEntry;\n-import org.apache.directory.server.core.integ.CiRunner;\n-import org.apache.directory.server.core.integ.DirectoryServiceFactory;\n import static org.apache.directory.server.core.integ.IntegrationUtils.getContext;\n-import org.apache.directory.server.core.integ.Level;\n-import org.apache.directory.server.core.integ.annotations.Factory;\n-import org.apache.directory.server.core.integ.annotations.CleanupLevel;\n-import org.apache.directory.server.core.partition.Partition;\n-import org.apache.directory.server.xdbm.Index;\n-import org.apache.directory.server.core.partition.impl.btree.jdbm.JdbmIndex;\n-import org.apache.directory.server.core.partition.impl.btree.jdbm.JdbmPartition;\n-import org.apache.directory.server.core.partition.ldif.LdifPartition;\n-import org.apache.directory.server.core.schema.SchemaPartition;\n-import org.apache.directory.shared.ldap.exception.LdapNameNotFoundException;\n-import org.apache.directory.shared.ldap.name.LdapDN;\n-\n import static org.junit.Assert.assertEquals;\n-import static org.junit.Assert.assertTrue;\n import static org.junit.Assert.assertFalse;\n import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n import static org.junit.Assert.fail;\n \n-import org.junit.Before;\n-import org.junit.Test;\n-import org.junit.runner.RunWith;\n+import java.io.File;\n+import java.util.HashSet;\n+import java.util.Set;\n \n import javax.naming.NamingEnumeration;\n import javax.naming.directory.Attribute;\n@@ -58,8 +41,31 @@\n import javax.naming.directory.SearchControls;\n import javax.naming.directory.SearchResult;\n import javax.naming.ldap.LdapContext;\n-import java.util.HashSet;\n-import java.util.Set;\n+\n+import org.apache.directory.server.constants.ServerDNConstants;\n+import org.apache.directory.server.core.DefaultDirectoryService;\n+import org.apache.directory.server.core.DirectoryService;\n+import org.apache.directory.server.core.entry.ServerEntry;\n+import org.apache.directory.server.core.integ.CiRunner;\n+import org.apache.directory.server.core.integ.DirectoryServiceFactory;\n+import org.apache.directory.server.core.integ.Level;\n+import org.apache.directory.server.core.integ.annotations.CleanupLevel;\n+import org.apache.directory.server.core.integ.annotations.Factory;\n+import org.apache.directory.server.core.partition.Partition;\n+import org.apache.directory.server.core.partition.impl.btree.jdbm.JdbmIndex;\n+import org.apache.directory.server.core.partition.impl.btree.jdbm.JdbmPartition;\n+import org.apache.directory.server.core.partition.ldif.LdifPartition;\n+import org.apache.directory.server.core.schema.SchemaPartition;\n+import org.apache.directory.server.xdbm.Index;\n+import org.apache.directory.shared.ldap.constants.SchemaConstants;\n+import org.apache.directory.shared.ldap.exception.LdapNameNotFoundException;\n+import org.apache.directory.shared.ldap.name.LdapDN;\n+import org.apache.directory.shared.ldap.schema.ldif.extractor.SchemaLdifExtractor;\n+import org.apache.directory.shared.ldap.schema.registries.Registries;\n+import org.apache.directory.shared.schema.loader.ldif.JarLdifSchemaLoader;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n \n \n /**\n@@ -82,26 +88,70 @@\n     {\n         public DirectoryService newInstance() throws Exception\n         {\n-            DefaultDirectoryService service = new DefaultDirectoryService();\n-            SchemaPartition schemaPartition = new SchemaPartition();\n-            schemaPartition.setWrappedPartition( new LdifPartition() );\n-            service.getSchemaService().setSchemaPartition( schemaPartition );\n+            String workingDirectory = System.getProperty( \"workingDirectory\" );\n+\n+            if ( workingDirectory == null )\n+            {\n+                String path = DirectoryServiceFactory.class.getResource( \"\" ).getPath();\n+                int targetPos = path.indexOf( \"target\" );\n+                workingDirectory = path.substring( 0, targetPos + 6 ) + \"/server-work\";\n+            }\n+\n+            DirectoryService service = new DefaultDirectoryService();\n+            service.setWorkingDirectory( new File( workingDirectory ) );\n+            SchemaPartition schemaPartition = service.getSchemaService().getSchemaPartition();\n+            Registries registries = service.getRegistries();\n+            \n+            // Init the LdifPartition\n+            LdifPartition ldifPartition = new LdifPartition();\n+            \n+            ldifPartition.setWorkingDirectory( workingDirectory + \"/schema\" );\n+            \n+            // Extract the schema on disk (a brand new one) and load the registries\n+            SchemaLdifExtractor extractor = new SchemaLdifExtractor( new File( workingDirectory ) );\n+            \n+            schemaPartition.setWrappedPartition( ldifPartition );\n+            schemaPartition.setRegistries( registries );\n+            \n+            JarLdifSchemaLoader loader = new JarLdifSchemaLoader();\n+            loader.loadAllEnabled( registries );\n+            extractor.extractOrCopy();\n+\n             service.getChangeLog().setEnabled( true );\n \n+            // change the working directory to something that is unique\n+            // on the system and somewhere either under target directory\n+            // or somewhere in a temp area of the machine.\n+            \n+            // Inject the System Partition\n+            Partition systemPartition = new JdbmPartition();\n+            systemPartition.setId( \"system\" );\n+            ((JdbmPartition)systemPartition).setCacheSize( 500 );\n+            systemPartition.setSuffix( ServerDNConstants.SYSTEM_DN );\n+            systemPartition.setRegistries( registries );\n+            ((JdbmPartition)systemPartition).setPartitionDir( new File( workingDirectory, \"system\" ) );\n+    \n+            // Add objectClass attribute for the system partition\n+            Set<Index<?,ServerEntry>> indexedAttrs = new HashSet<Index<?,ServerEntry>>();\n+            indexedAttrs.add( \n+                new JdbmIndex<Object,ServerEntry>( SchemaConstants.OBJECT_CLASS_AT ) );\n+            ( ( JdbmPartition ) systemPartition ).setIndexedAttributes( indexedAttrs );\n+            \n+            service.setSystemPartition( systemPartition );\n+\n             JdbmPartition partition = new JdbmPartition();\n             partition.setId( \"apache\" );\n             partition.setSuffix( SUFFIX_DN );\n+            partition.setPartitionDir( new File( workingDirectory, \"apache\" ) );\n \n             HashSet<Index<?, ServerEntry>> indexedAttributes = new HashSet<Index<?, ServerEntry>>();\n             indexedAttributes.add( new JdbmIndex<String,ServerEntry>( \"objectClass\" ) );\n             indexedAttributes.add( new JdbmIndex<String,ServerEntry>( \"ou\" ) );\n             indexedAttributes.add( new JdbmIndex<String,ServerEntry>( \"uid\" ) );\n             partition.setIndexedAttributes( indexedAttributes );\n \n-            Set<Partition> partitions = new HashSet<Partition>();\n-            partitions.add( partition );\n+            service.addPartition( partition );\n \n-            service.setPartitions( partitions );\n             return service;\n         }\n     }"
            },
            {
                "sha": "a89b979d305d5c67b1a48458186dfc165bb1a2d4",
                "filename": "core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/apache/directory-server/blob/3128c55f844c31fd55437cdcb4846c7835ef8c4f/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/3128c55f844c31fd55437cdcb4846c7835ef8c4f/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java?ref=3128c55f844c31fd55437cdcb4846c7835ef8c4f",
                "patch": "@@ -332,13 +332,16 @@ public void setPartitions( Set<? extends Partition> partitions )\n         Set<Partition> cloned = new HashSet<Partition>();\n         cloned.addAll( partitions );\n         Set<String> names = new HashSet<String>();\n+        \n         for ( Partition partition : cloned )\n         {\n             String id = partition.getId();\n+            \n             if ( names.contains( id ) )\n             {\n                 LOG.warn( \"Encountered duplicate partition {} identifier.\", id );\n             }\n+            \n             names.add( id );\n         }\n "
            },
            {
                "sha": "1a25697768f67c02cefc25cf059b6e4d7f9cd10d",
                "filename": "core/src/main/java/org/apache/directory/server/core/partition/DefaultPartitionNexus.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/3128c55f844c31fd55437cdcb4846c7835ef8c4f/core/src/main/java/org/apache/directory/server/core/partition/DefaultPartitionNexus.java",
                "raw_url": "https://github.com/apache/directory-server/raw/3128c55f844c31fd55437cdcb4846c7835ef8c4f/core/src/main/java/org/apache/directory/server/core/partition/DefaultPartitionNexus.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/partition/DefaultPartitionNexus.java?ref=3128c55f844c31fd55437cdcb4846c7835ef8c4f",
                "patch": "@@ -238,7 +238,7 @@ public void initialize( ) throws Exception\n         {\n             for ( Partition partition : directoryService.getPartitions() )\n             {\n-                //adminDn.normalize( registries.getAttributeTypeRegistry().getNormalizerMapping() );\n+                partition.setRegistries( registries );\n                 CoreSession adminSession = new DefaultCoreSession( \n                     new LdapPrincipal( adminDn, AuthenticationLevel.STRONG ), directoryService );\n     "
            }
        ]
    }
]
[
    {
        "commit": "https://github.com/apache/directory-server/commit/d2bfb9bcf2b6287938d2409258967dd034755da8",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/8410e342de6c7b8719e111bc53c8ba9a31479396",
        "message": "o Fixed the logic. There where some NPE as the coreSession might have been null, and some other errors\no Added some Javadoc\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/bigbang@678819 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_101",
        "file": [
            {
                "sha": "3e5a5ee2127d71c032d0433ff29814f1637faa3f",
                "filename": "protocol-newldap/src/main/java/org/apache/directory/server/newldap/handlers/LdapRequestHandler.java",
                "status": "modified",
                "additions": 29,
                "deletions": 9,
                "changes": 38,
                "blob_url": "https://github.com/apache/directory-server/blob/d2bfb9bcf2b6287938d2409258967dd034755da8/protocol-newldap/src/main/java/org/apache/directory/server/newldap/handlers/LdapRequestHandler.java",
                "raw_url": "https://github.com/apache/directory-server/raw/d2bfb9bcf2b6287938d2409258967dd034755da8/protocol-newldap/src/main/java/org/apache/directory/server/newldap/handlers/LdapRequestHandler.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-newldap/src/main/java/org/apache/directory/server/newldap/handlers/LdapRequestHandler.java?ref=d2bfb9bcf2b6287938d2409258967dd034755da8",
                "patch": "@@ -64,9 +64,6 @@ public final void setLdapServer( LdapServer ldapServer )\n \n \n     /**\n-     * TODO - add notes about how this protects against unauthorized access\n-     * and sets up the ldapSession's coreContext.\n-     * \n      * Handle a LDAP message received during a session.\n      * \n      * @param session the user session created when the user first connected\n@@ -79,7 +76,13 @@ public final void messageReceived( IoSession session, T message ) throws Excepti\n     {\n         LdapSession ldapSession = ldapServer.getLdapSession( session );\n \n-        if ( ! ( message instanceof BindRequest ) )\n+        // We should check that the server allows anonymous requests\n+        // only if it's not a BindRequest\n+        if ( message instanceof BindRequest )\n+        {\n+        \thandle( ldapSession, message );\n+        }\n+        else\n         {\n             CoreSession coreSession = null;\n             \n@@ -91,14 +94,25 @@ public final void messageReceived( IoSession session, T message ) throws Excepti\n             if ( ldapSession.isAuthenticated() )\n             {\n                 coreSession = ldapSession.getCoreSession();\n+                handle( ldapSession, message );\n+                return;\n             }\n-            else if ( coreSession.getDirectoryService().isAllowAnonymousAccess() )\n+            \n+            coreSession = getLdapServer().getDirectoryService().getSession();\n+            ldapSession.setCoreSession( coreSession );\n+            \n+            if ( coreSession.getDirectoryService().isAllowAnonymousAccess() )\n             {\n-                coreSession = getLdapServer().getDirectoryService().getSession();\n-                ldapSession.setCoreSession( coreSession );\n+            \t// We are not authenticated, and the server allows anonymous access,\n+            \t// we have create a new Anonymous session. Just return.\n+            \thandle( ldapSession, message );\n+            \treturn;\n             }\n             else if ( message instanceof ResultResponseRequest )\n             {\n+            \t// The server does not allow anonymous access, and the client\n+            \t// is not authenticated : get out if the request expect a\n+            \t// response.\n                 ResultResponse response = ( ( ResultResponseRequest ) message ).getResultResponse();\n                 response.getLdapResult().setErrorMessage( \"Anonymous access disabled.\" );\n                 response.getLdapResult().setResultCode( ResultCodeEnum.INSUFFICIENT_ACCESS_RIGHTS );\n@@ -107,13 +121,19 @@ else if ( message instanceof ResultResponseRequest )\n             }\n             else\n             {\n+            \t// Last case : the AbandonRequest. We just quit.\n                 return;\n             }\n         }\n-\n-        handle( ldapSession, message );\n     }\n \n     \n+    /**\n+     * Handle a Ldap message associated with a session\n+     * \n+     * @param session The associated session\n+     * @param message The message we have to handle\n+     * @throws Exception If there is an error during the processing of this message\n+     */\n     public abstract void handle( LdapSession session, T message ) throws Exception;\n }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/d6b03815121a33c203fc2763cfbb79269a074be6",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/acc7058fff2b88d7631fca026728707cc50b227c",
        "message": "Using FindBugs, and fixed :\no Potential NPE\no Removed useless incrementations\no Added a method in LdapURL to return a copy of the bytes\no Improved the use of Map iterators\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/bigbang@637403 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_102",
        "file": [
            {
                "sha": "e3661d0241a6648fcb4c2a87d5da566da7382a5d",
                "filename": "core-entry/src/main/java/org/apache/directory/server/core/entry/DefaultServerAttribute.java",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/apache/directory-server/blob/d6b03815121a33c203fc2763cfbb79269a074be6/core-entry/src/main/java/org/apache/directory/server/core/entry/DefaultServerAttribute.java",
                "raw_url": "https://github.com/apache/directory-server/raw/d6b03815121a33c203fc2763cfbb79269a074be6/core-entry/src/main/java/org/apache/directory/server/core/entry/DefaultServerAttribute.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-entry/src/main/java/org/apache/directory/server/core/entry/DefaultServerAttribute.java?ref=d6b03815121a33c203fc2763cfbb79269a074be6",
                "patch": "@@ -367,7 +367,7 @@ public void setAttributeType( AttributeType attributeType )\n     {\r\n         if ( attributeType == null )\r\n         {\r\n-            throw new IllegalArgumentException( getErrorMessage( attributeType ) );\r\n+            throw new IllegalArgumentException( \"The AttributeType parameter should not be null\" );\r\n         }\r\n \r\n         this.attributeType = attributeType;\r\n@@ -413,7 +413,7 @@ public DefaultServerAttribute( AttributeType attributeType )\n     {\r\n         if ( attributeType == null )\r\n         {\r\n-            throw new IllegalArgumentException( getErrorMessage( attributeType ) );\r\n+            throw new IllegalArgumentException( \"The AttributeType parameter should not be null\" );\r\n         }\r\n         \r\n         setAttributeType( attributeType );\r\n@@ -427,7 +427,7 @@ public DefaultServerAttribute( String upId, AttributeType attributeType )\n     {\r\n         if ( attributeType == null ) \r\n         {\r\n-            String message = getErrorMessage( attributeType );\r\n+            String message = \"The AttributeType parameter should not be null\";\r\n             LOG.error( message );\r\n             throw new IllegalArgumentException( message );\r\n         }\r\n@@ -472,7 +472,7 @@ public DefaultServerAttribute( String upId, AttributeType attributeType, Value<?\n     {\r\n         if ( attributeType == null )\r\n         {\r\n-            throw new IllegalArgumentException( getErrorMessage( attributeType ) );\r\n+            throw new IllegalArgumentException( \"The AttributeType parameter should not be null\" );\r\n         }\r\n         \r\n         setAttributeType( attributeType );\r\n@@ -497,7 +497,7 @@ public DefaultServerAttribute( String upId, AttributeType attributeType, String.\n     {\r\n         if ( attributeType == null )\r\n         {\r\n-            throw new IllegalArgumentException( getErrorMessage( attributeType ) );\r\n+            throw new IllegalArgumentException( \"The AttributeType parameter should not be null\" );\r\n         }\r\n \r\n         setAttributeType( attributeType );\r\n@@ -522,7 +522,7 @@ public DefaultServerAttribute( String upId, AttributeType attributeType, byte[].\n     {\r\n         if ( attributeType == null )\r\n         {\r\n-            throw new IllegalArgumentException( getErrorMessage( attributeType ) );\r\n+            throw new IllegalArgumentException( \"The AttributeType parameter should not be null\" );\r\n         }\r\n \r\n         setAttributeType( attributeType );\r"
            },
            {
                "sha": "ca770881ff66763e5ad70a40223bd267ca8bb817",
                "filename": "core-entry/src/test/java/org/apache/directory/server/core/entry/ServerBinaryValueTest.java",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/apache/directory-server/blob/d6b03815121a33c203fc2763cfbb79269a074be6/core-entry/src/test/java/org/apache/directory/server/core/entry/ServerBinaryValueTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/d6b03815121a33c203fc2763cfbb79269a074be6/core-entry/src/test/java/org/apache/directory/server/core/entry/ServerBinaryValueTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-entry/src/test/java/org/apache/directory/server/core/entry/ServerBinaryValueTest.java?ref=d6b03815121a33c203fc2763cfbb79269a074be6",
                "patch": "@@ -60,9 +60,9 @@\n  */\n public class ServerBinaryValueTest\n {\n-    static private TestServerEntryUtils.S s;\n-    static private TestServerEntryUtils.AT at;\n-    static private TestServerEntryUtils.MR mr;\n+    private TestServerEntryUtils.S s;\n+    private TestServerEntryUtils.AT at;\n+    private TestServerEntryUtils.MR mr;\n     \n     private static final byte[] BYTES1 = new byte[]{0x01, 0x02, 0x03, 0x04};\n     private static final byte[] BYTES2 = new byte[]{(byte)0x81, (byte)0x82, (byte)0x83, (byte)0x84};"
            },
            {
                "sha": "8763794ec69b9a0d65c1ccb0357f4bc8d2542414",
                "filename": "core-entry/src/test/java/org/apache/directory/server/core/entry/ServerStringValueTest.java",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/apache/directory-server/blob/d6b03815121a33c203fc2763cfbb79269a074be6/core-entry/src/test/java/org/apache/directory/server/core/entry/ServerStringValueTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/d6b03815121a33c203fc2763cfbb79269a074be6/core-entry/src/test/java/org/apache/directory/server/core/entry/ServerStringValueTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-entry/src/test/java/org/apache/directory/server/core/entry/ServerStringValueTest.java?ref=d6b03815121a33c203fc2763cfbb79269a074be6",
                "patch": "@@ -68,9 +68,9 @@\n  */\r\n public class ServerStringValueTest\r\n {\r\n-    static private TestServerEntryUtils.S s;\r\n-    static private TestServerEntryUtils.AT at;\r\n-    static private TestServerEntryUtils.MR mr;\r\n+    private TestServerEntryUtils.S s;\r\n+    private TestServerEntryUtils.AT at;\r\n+    private TestServerEntryUtils.MR mr;\r\n \r\n     \r\n     /**\r"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/8eea34d70e19cabdafe40ab5ffbb6cd4526f06ab",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/388674bdd1515ddbae276168e6a274837797264c",
        "message": "Fixed a potential NPE in some cases. Switching from Long to long was not a good idea when the called method can return a null value. My bad.\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@578767 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_103",
        "file": [
            {
                "sha": "57cb22c2e91147aea505e47d281ff401ec6e155d",
                "filename": "core/src/main/java/org/apache/directory/server/core/partition/impl/btree/DefaultOptimizer.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/8eea34d70e19cabdafe40ab5ffbb6cd4526f06ab/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/DefaultOptimizer.java",
                "raw_url": "https://github.com/apache/directory-server/raw/8eea34d70e19cabdafe40ab5ffbb6cd4526f06ab/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/DefaultOptimizer.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/partition/impl/btree/DefaultOptimizer.java?ref=8eea34d70e19cabdafe40ab5ffbb6cd4526f06ab",
                "patch": "@@ -345,7 +345,7 @@ private long getScopeScan( ScopeNode node ) throws NamingException\n                 return 1L;\n             \n             case ( SearchControls.ONELEVEL_SCOPE  ):\n-                long id = db.getEntryId( node.getBaseDn() );\n+                Long id = db.getEntryId( node.getBaseDn() );\n                 return Long.valueOf( db.getChildCount( id ) );\n                 \n             case ( SearchControls.SUBTREE_SCOPE  ):"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/364dedacd8d49664dcc63cb24a1b3adbca43d3e8",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/03c109ffc81b6773a444fd3ba7650a0c95535f5c",
        "message": "changes ...\n\n o added new group tracking cache for rapidly looking up group membership\n   for making groupwise AC decisions \n o fixed a bug in TupleCache that will cause NPE\n o added lookup method for Tuple sets in TupleCache\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@293515 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_104",
        "file": [
            {
                "sha": "017ff117f22dcdb1b34045baea744980e4fc6a13",
                "filename": "core/src/main/java/org/apache/ldap/server/authz/AuthorizationService.java",
                "status": "modified",
                "additions": 14,
                "deletions": 9,
                "changes": 23,
                "blob_url": "https://github.com/apache/directory-server/blob/364dedacd8d49664dcc63cb24a1b3adbca43d3e8/core/src/main/java/org/apache/ldap/server/authz/AuthorizationService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/364dedacd8d49664dcc63cb24a1b3adbca43d3e8/core/src/main/java/org/apache/ldap/server/authz/AuthorizationService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/ldap/server/authz/AuthorizationService.java?ref=364dedacd8d49664dcc63cb24a1b3adbca43d3e8",
                "patch": "@@ -27,12 +27,10 @@\n import org.apache.ldap.server.invocation.InvocationStack;\n import org.apache.ldap.server.authn.LdapPrincipal;\n import org.apache.ldap.common.filter.ExprNode;\n-import org.apache.ldap.common.aci.AuthenticationLevel;\n \n import javax.naming.Name;\n import javax.naming.NamingException;\n import javax.naming.NamingEnumeration;\n-import javax.naming.Context;\n import javax.naming.directory.Attributes;\n import javax.naming.directory.ModificationItem;\n import javax.naming.directory.SearchControls;\n@@ -50,8 +48,10 @@\n {\n     /** the partition nexus */\n     private ContextPartitionNexus nexus;\n-    /** a cache that responds to add, delete, and modify attempts */\n-    private TupleCache cache;\n+    /** a tupleCache that responds to add, delete, and modify attempts */\n+    private TupleCache tupleCache;\n+    /** a groupCache that responds to add, delete, and modify attempts */\n+    private GroupCache groupCache;\n     /** use and instance of the ACDF engine */\n     private ACDFEngine engine;\n \n@@ -61,7 +61,8 @@ public void init( ContextFactoryConfiguration factoryCfg, InterceptorConfigurati\n         super.init( factoryCfg, cfg );\n \n         nexus = factoryCfg.getPartitionNexus();\n-        cache = new TupleCache( factoryCfg );\n+        tupleCache = new TupleCache( factoryCfg );\n+        groupCache = new GroupCache( factoryCfg );\n         engine = new ACDFEngine( factoryCfg.getGlobalRegistries().getOidRegistry(),\n                 factoryCfg.getGlobalRegistries().getAttributeTypeRegistry() );\n     }\n@@ -85,7 +86,8 @@ public void init( ContextFactoryConfiguration factoryCfg, InterceptorConfigurati\n     public void add( NextInterceptor next, String upName, Name normName, Attributes entry ) throws NamingException\n     {\n         next.add( upName, normName, entry );\n-        cache.subentryAdded( upName, normName, entry );\n+        tupleCache.subentryAdded( upName, normName, entry );\n+        groupCache.groupAdded( upName, normName, entry );\n \n         ServerContext ctx = ( ServerContext ) InvocationStack.getInstance().peek().getCaller();\n         LdapPrincipal user = ctx.getPrincipal();\n@@ -100,23 +102,26 @@ public void delete( NextInterceptor next, Name name ) throws NamingException\n     {\n         Attributes entry = nexus.lookup( name );\n         next.delete( name );\n-        cache.subentryDeleted( name, entry );\n+        tupleCache.subentryDeleted( name, entry );\n+        groupCache.groupDeleted( name, entry );\n     }\n \n \n     public void modify( NextInterceptor next, Name name, int modOp, Attributes mods ) throws NamingException\n     {\n         Attributes entry = nexus.lookup( name );\n         next.modify( name, modOp, mods );\n-        cache.subentryModified( name, modOp, mods, entry );\n+        tupleCache.subentryModified( name, modOp, mods, entry );\n+        groupCache.groupModified( name, modOp, mods, entry );\n     }\n \n \n     public void modify( NextInterceptor next, Name name, ModificationItem[] mods ) throws NamingException\n     {\n         Attributes entry = nexus.lookup( name );\n         next.modify( name, mods );\n-        cache.subentryModified( name, mods, entry );\n+        tupleCache.subentryModified( name, mods, entry );\n+        groupCache.groupModified( name, mods, entry );\n     }\n \n "
            },
            {
                "sha": "2b167772f9db3c6362c4713b68e1b33e00b28216",
                "filename": "core/src/main/java/org/apache/ldap/server/authz/GroupCache.java",
                "status": "added",
                "additions": 374,
                "deletions": 0,
                "changes": 374,
                "blob_url": "https://github.com/apache/directory-server/blob/364dedacd8d49664dcc63cb24a1b3adbca43d3e8/core/src/main/java/org/apache/ldap/server/authz/GroupCache.java",
                "raw_url": "https://github.com/apache/directory-server/raw/364dedacd8d49664dcc63cb24a1b3adbca43d3e8/core/src/main/java/org/apache/ldap/server/authz/GroupCache.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/ldap/server/authz/GroupCache.java?ref=364dedacd8d49664dcc63cb24a1b3adbca43d3e8",
                "patch": "@@ -0,0 +1,374 @@\n+/*\n+ *   Copyright 2004 The Apache Software Foundation\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ *\n+ */\n+package org.apache.ldap.server.authz;\n+\n+\n+import org.apache.ldap.common.name.DnParser;\n+import org.apache.ldap.common.name.LdapName;\n+import org.apache.ldap.common.filter.SimpleNode;\n+import org.apache.ldap.common.filter.BranchNode;\n+import org.apache.ldap.server.jndi.ContextFactoryConfiguration;\n+import org.apache.ldap.server.schema.ConcreteNameComponentNormalizer;\n+import org.apache.ldap.server.partition.ContextPartitionNexus;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import javax.naming.Name;\n+import javax.naming.NamingException;\n+import javax.naming.NamingEnumeration;\n+import javax.naming.directory.*;\n+import java.util.*;\n+\n+\n+/**\n+ * A cache for tracking static group membership.\n+ *\n+ * @author <a href=\"mailto:dev@directory.apache.org\">Apache Directory Project</a>\n+ * @version $Rev$\n+ */\n+public class GroupCache\n+{\n+    /** the attribute id for an object class: objectClass */\n+    private static final String OC_ATTR = \"objectClass\";\n+    /** the member attribute for a groupOfNames: member */\n+    private static final String MEMBER_ATTR = \"member\";\n+    /** the member attribute for a groupOfUniqueNames: uniqueMember */\n+    private static final String UNIQUEMEMBER_ATTR = \"uniqueMember\";\n+    /** the groupOfNames objectClass: groupOfNames */\n+    private static final String GROUPOFNAMES_OC = \"groupOfNames\";\n+    /** the groupOfUniqueNames objectClass: groupOfUniqueNames */\n+    private static final String GROUPOFUNIQUENAMES_OC = \"groupOfUniqueNames\";\n+    /** the logger for this class */\n+    private static final Logger log = LoggerFactory.getLogger( GroupCache.class );\n+\n+    /** String key for the DN of a group to a Set (HashSet) for the Strings of member DNs */\n+    private final Map groups = new HashMap();\n+    /** a handle on the partition nexus */\n+    private final ContextPartitionNexus nexus;\n+    /** the env to use for searching */\n+    private final Hashtable env;\n+    /** the normalizing Dn parser for member names */\n+    private DnParser parser;\n+\n+\n+    /**\n+     * Creates a static group cache.\n+     *\n+     * @param factoryCfg the context factory configuration for the server\n+     */\n+    public GroupCache( ContextFactoryConfiguration factoryCfg ) throws NamingException\n+    {\n+        this.nexus = factoryCfg.getPartitionNexus();\n+        this.env = ( Hashtable ) factoryCfg.getEnvironment().clone();\n+        this.parser = new DnParser( new ConcreteNameComponentNormalizer(\n+                factoryCfg.getGlobalRegistries().getAttributeTypeRegistry() ) );\n+        initialize();\n+    }\n+\n+\n+    private void initialize() throws NamingException\n+    {\n+        // search all naming contexts for static groups and generate\n+        // normalized sets of members to cache within the map\n+\n+        BranchNode filter = new BranchNode( BranchNode.OR );\n+        filter.addNode( new SimpleNode( OC_ATTR, GROUPOFNAMES_OC, SimpleNode.EQUALITY ) );\n+        filter.addNode( new SimpleNode( OC_ATTR, GROUPOFUNIQUENAMES_OC, SimpleNode.EQUALITY ) );\n+\n+        Iterator suffixes = nexus.listSuffixes( true );\n+        while ( suffixes.hasNext() )\n+        {\n+            String suffix = ( String ) suffixes.next();\n+            Name baseDn = new LdapName( suffix );\n+            SearchControls ctls = new SearchControls();\n+            ctls.setSearchScope( SearchControls.SUBTREE_SCOPE );\n+            NamingEnumeration results = nexus.search( baseDn, env, filter, ctls );\n+\n+            while ( results.hasMore() )\n+            {\n+                SearchResult result = ( SearchResult ) results.next();\n+                String groupDn = result.getName();\n+                groupDn = parser.parse( groupDn ).toString();\n+                Attribute members = getMemberAttribute( result.getAttributes() );\n+\n+                if ( members != null )\n+                {\n+                    Set memberSet = new HashSet( members.size() );\n+                    addMembers( memberSet, members );\n+                    groups.put( groupDn, memberSet );\n+                }\n+                else\n+                {\n+                    log.warn( \"Found group '\" + groupDn + \"' without any member or uniqueMember attributes\" );\n+                }\n+            }\n+            results.close();\n+        }\n+    }\n+\n+\n+    /**\n+     * Gets the member attribute regardless of whether groupOfNames or\n+     * groupOfUniqueNames is used.\n+     *\n+     * @param entry the entry inspected for member attributes\n+     * @return the member attribute\n+     */\n+    private Attribute getMemberAttribute( Attributes entry )\n+    {\n+        Attribute oc = entry.get( OC_ATTR );\n+\n+        if ( oc.contains( GROUPOFNAMES_OC ) )\n+        {\n+            return entry.get( MEMBER_ATTR );\n+        }\n+\n+        if ( oc.contains( GROUPOFUNIQUENAMES_OC ) )\n+        {\n+            return entry.get( UNIQUEMEMBER_ATTR );\n+        }\n+\n+        return null;\n+    }\n+\n+\n+    /**\n+     * Adds normalized member DNs to the set of normalized member names.\n+     *\n+     * @param memberSet the set of member Dns (Strings)\n+     * @param members the member attribute values being added\n+     * @throws NamingException if there are problems accessing the attr values\n+     */\n+    private void addMembers( Set memberSet, Attribute members ) throws NamingException\n+    {\n+        for ( int ii = 0; ii < members.size(); ii++ )\n+        {\n+            // get and normalize the DN of the member\n+            String memberDn = ( String ) members.get( ii );\n+            memberDn = parser.parse( memberDn ).toString();\n+            memberSet.add( memberDn );\n+        }\n+    }\n+\n+\n+    /**\n+     * Removes a set of member names from an existing set.\n+     *\n+     * @param memberSet the set of normalized member DNs\n+     * @param members the set of member values\n+     * @throws NamingException if there are problems accessing the attr values\n+     */\n+    private void removeMembers( Set memberSet, Attribute members ) throws NamingException\n+    {\n+        for ( int ii = 0; ii < members.size(); ii++ )\n+        {\n+            // get and normalize the DN of the member\n+            String memberDn = ( String ) members.get( ii );\n+            memberDn = parser.parse( memberDn ).toString();\n+            memberSet.remove( memberDn );\n+        }\n+    }\n+\n+\n+    /**\n+     * Adds a groups members to the cache.  Called by interceptor to account for new\n+     * group additions.\n+     *\n+     * @param upName the user provided name for the group entry\n+     * @param normName the normalized name for the group entry\n+     * @param entry the group entry's attributes\n+     * @throws NamingException if there are problems accessing the attr values\n+     */\n+    public void groupAdded( String upName, Name normName, Attributes entry ) throws NamingException\n+    {\n+        Attribute members = getMemberAttribute( entry );\n+\n+        if ( members == null )\n+        {\n+            return;\n+        }\n+\n+        Set memberSet = new HashSet( members.size() );\n+        addMembers( memberSet, members );\n+        groups.put( normName.toString(), memberSet );\n+    }\n+\n+\n+    /**\n+     * Deletes a group's members from the cache.  Called by interceptor to account for\n+     * the deletion of groups.\n+     *\n+     * @param name the normalized DN of the group entry\n+     * @param entry the attributes of entry being deleted\n+     */\n+    public void groupDeleted( Name name, Attributes entry )\n+    {\n+        Attribute members = getMemberAttribute( entry );\n+\n+        if ( members == null )\n+        {\n+            return;\n+        }\n+\n+        groups.remove( name.toString() );\n+    }\n+\n+\n+    /**\n+     * Utility method to modify a set of member names based on a modify operation\n+     * that changes the members of a group.\n+     *\n+     * @param memberSet the set of members to be altered\n+     * @param modOp the type of modify operation being performed\n+     * @param members the members being added, removed or replaced\n+     * @throws NamingException if there are problems accessing attribute values\n+     */\n+    private void modify( Set memberSet, int modOp, Attribute members ) throws NamingException\n+    {\n+\n+        switch ( modOp )\n+        {\n+            case ( DirContext.ADD_ATTRIBUTE ):\n+                addMembers( memberSet, members );\n+                break;\n+            case ( DirContext.REPLACE_ATTRIBUTE ):\n+                if ( members.size() > 0 )\n+                {\n+                    memberSet.clear();\n+                    addMembers( memberSet, members );\n+                }\n+                break;\n+            case ( DirContext.REMOVE_ATTRIBUTE ):\n+                removeMembers( memberSet, members );\n+                break;\n+            default:\n+                throw new InternalError( \"Undefined modify operation value of \" + modOp );\n+        }\n+    }\n+\n+\n+    /**\n+     * Modifies the cache to reflect changes via modify operations to the group entries.\n+     * Called by the interceptor to account for modify ops on groups.\n+     *\n+     * @param name the normalized name of the group entry modified\n+     * @param mods the modification operations being performed\n+     * @param entry the group entry being modified\n+     * @throws NamingException if there are problems accessing attribute  values\n+     */\n+    public void groupModified( Name name, ModificationItem[] mods, Attributes entry ) throws NamingException\n+    {\n+        Attribute members = null;\n+        String memberAttrId = null;\n+        Attribute oc = entry.get( OC_ATTR );\n+\n+        if ( oc.contains( GROUPOFNAMES_OC ) )\n+        {\n+            members = entry.get( MEMBER_ATTR );\n+            memberAttrId = MEMBER_ATTR;\n+        }\n+\n+        if ( oc.contains( GROUPOFUNIQUENAMES_OC ) )\n+        {\n+            members = entry.get( UNIQUEMEMBER_ATTR );\n+            memberAttrId = UNIQUEMEMBER_ATTR;\n+        }\n+\n+        if ( members == null )\n+        {\n+            return;\n+        }\n+\n+        for ( int ii = 0; ii < mods.length; ii++ )\n+        {\n+            if ( memberAttrId.equalsIgnoreCase( mods[ii].getAttribute().getID() ) )\n+            {\n+                Set memberSet = ( Set ) groups.get( name.toString() );\n+                if ( memberSet != null )\n+                {\n+                    modify( memberSet, mods[ii].getModificationOp(), members );\n+                }\n+                break;\n+            }\n+        }\n+    }\n+\n+\n+    /**\n+     * Modifies the cache to reflect changes via modify operations to the group entries.\n+     * Called by the interceptor to account for modify ops on groups.\n+     *\n+     * @param name the normalized name of the group entry modified\n+     * @param modOp the modify operation being performed\n+     * @param mods the modifications being performed\n+     * @param entry the entry being modified\n+     * @throws NamingException if there are problems accessing attribute  values\n+     */\n+    public void groupModified( Name name, int modOp, Attributes mods, Attributes entry ) throws NamingException\n+    {\n+        Attribute members = getMemberAttribute( entry );\n+\n+        if ( members == null )\n+        {\n+            return;\n+        }\n+\n+        Set memberSet = ( Set ) groups.get( name.toString() );\n+        if ( memberSet != null )\n+        {\n+            modify( memberSet, modOp, members );\n+        }\n+    }\n+\n+\n+    /**\n+     * Gets the set of groups a user is a member of.  The groups are returned\n+     * as normalized Name objects within the set.\n+     *\n+     * @param member the member (user) to get the groups for\n+     * @return a Set of Name objects representing the groups\n+     * @throws NamingException if there are problems accessing attribute  values\n+     */\n+    public Set getGroups( String member ) throws NamingException\n+    {\n+        member = parser.parse( member ).toString();\n+        Set memberGroups = null;\n+\n+        Iterator list = groups.keySet().iterator();\n+        while ( list.hasNext() )\n+        {\n+            String group = ( String ) list.next();\n+            Set members = ( Set ) groups.get( group );\n+            if ( members.contains( member ) )\n+            {\n+                if ( memberGroups == null )\n+                {\n+                    memberGroups = new HashSet();\n+                }\n+\n+                memberGroups.add( new LdapName( group ) );\n+            }\n+        }\n+\n+        if ( memberGroups == null )\n+        {\n+            return Collections.EMPTY_SET;\n+        }\n+\n+        return memberGroups;\n+    }\n+}"
            },
            {
                "sha": "7b3bb85857f20b1bf925fbfe8de4239edfa9ed48",
                "filename": "core/src/main/java/org/apache/ldap/server/authz/TupleCache.java",
                "status": "modified",
                "additions": 13,
                "deletions": 7,
                "changes": 20,
                "blob_url": "https://github.com/apache/directory-server/blob/364dedacd8d49664dcc63cb24a1b3adbca43d3e8/core/src/main/java/org/apache/ldap/server/authz/TupleCache.java",
                "raw_url": "https://github.com/apache/directory-server/raw/364dedacd8d49664dcc63cb24a1b3adbca43d3e8/core/src/main/java/org/apache/ldap/server/authz/TupleCache.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/ldap/server/authz/TupleCache.java?ref=364dedacd8d49664dcc63cb24a1b3adbca43d3e8",
                "patch": "@@ -18,12 +18,7 @@\n \n \n import java.text.ParseException;\n-import java.util.ArrayList;\n-import java.util.HashMap;\n-import java.util.Hashtable;\n-import java.util.Iterator;\n-import java.util.List;\n-import java.util.Map;\n+import java.util.*;\n \n import javax.naming.Name;\n import javax.naming.NamingEnumeration;\n@@ -161,7 +156,7 @@ public void subentryAdded( String upName, Name normName, Attributes entry ) thro\n \n             try\n             {\n-                aciParser.parse( ( String ) aci.get( ii ) );\n+                item = aciParser.parse( ( String ) aci.get( ii ) );\n             }\n             catch ( ParseException e )\n             {\n@@ -219,5 +214,16 @@ public void subentryModified( Name normName, int modOp, Attributes mods, Attribu\n             subentryDeleted( normName, entry );\n             subentryAdded( normName.toString(), normName, entry );\n         }\n+    }                                                     \n+\n+\n+    public List getACITuples( String subentryDn )\n+    {\n+        List aciTuples = ( List ) tuples.get( subentryDn );\n+        if ( aciTuples == null )\n+        {\n+            return Collections.EMPTY_LIST;\n+        }\n+        return Collections.unmodifiableList( aciTuples );\n     }\n }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/7e0d904ab2ea26cb68893e7ae70666c3ae631c52",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/72aa7d5c9110ce95db3ca0d1c98d437fda57c2da",
        "message": "Changes ...\n\n o was not reporting some exceptions that were wrapped in invocation target\n   exceptions within the interceptor procession within the JNDI provider\n o fixed NPE that was hidden (revieled due to above) in SubstringEvaluator \n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/directory/eve/trunk@109471 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_105",
        "file": [
            {
                "sha": "f29ab08ba21276c0386b2b1bf12b464e97b1f6e1",
                "filename": "jndi-provider/src/java/org/apache/eve/db/SubstringEvaluator.java",
                "status": "modified",
                "additions": 2,
                "deletions": 3,
                "changes": 5,
                "blob_url": "https://github.com/apache/directory-server/blob/7e0d904ab2ea26cb68893e7ae70666c3ae631c52/jndi-provider/src/java/org/apache/eve/db/SubstringEvaluator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/7e0d904ab2ea26cb68893e7ae70666c3ae631c52/jndi-provider/src/java/org/apache/eve/db/SubstringEvaluator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/jndi-provider/src/java/org/apache/eve/db/SubstringEvaluator.java?ref=7e0d904ab2ea26cb68893e7ae70666c3ae631c52",
                "patch": "@@ -122,8 +122,7 @@ public boolean evaluate( ExprNode node, IndexRecord record )\n         // Index not defined beyond this point\n         // --------------------------------------------------------------------\n         \n-        Attribute attr = null;\n-        String oid = oidRegistry.getOid( attr.getID() );\n+        String oid = oidRegistry.getOid( snode.getAttribute() );\n         AttributeType type = attributeTypeRegistry.lookup( oid );\n         Normalizer normalizer = type.getSubstr().getNormalizer();\n \n@@ -135,7 +134,7 @@ public boolean evaluate( ExprNode node, IndexRecord record )\n         }\n         \n         // get the attribute\n-        attr = record.getAttributes().get( snode.getAttribute() );\n+        Attribute attr = record.getAttributes().get( snode.getAttribute() );\n         \n         // if the attribute does not exist just return false\n         if ( null == attr )"
            },
            {
                "sha": "04f2e7a492f5a5baa9561f9a25b37593dcf1f265",
                "filename": "jndi-provider/src/java/org/apache/eve/jndi/EveJndiProvider.java",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/directory-server/blob/7e0d904ab2ea26cb68893e7ae70666c3ae631c52/jndi-provider/src/java/org/apache/eve/jndi/EveJndiProvider.java",
                "raw_url": "https://github.com/apache/directory-server/raw/7e0d904ab2ea26cb68893e7ae70666c3ae631c52/jndi-provider/src/java/org/apache/eve/jndi/EveJndiProvider.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/jndi-provider/src/java/org/apache/eve/jndi/EveJndiProvider.java?ref=7e0d904ab2ea26cb68893e7ae70666c3ae631c52",
                "patch": "@@ -220,6 +220,11 @@ public Object invoke( Object proxy, Method method, Object[] args ) throws Throwa\n                     {\n                         target = ( NamingException ) ite.getTargetException();\n                     }\n+                    else\n+                    {\n+                        target = new NamingException();\n+                        target.setRootCause( ite.getTargetException() );\n+                    }\n                 }\n                 else\n                 {"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/10c00a883f07bf38dde08eec797e43651a4c1940",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/13f44260107d9202f68ba756f7a7f1ee7c8e8886",
        "message": "o Initialize the alias and ParentIdAndRdn caches in the AbstractBTreePartition class\no Fixed NPE when those caches are not existing\no Updated the alias cache when some aliases are added/removed\no A small improvement in the dropMovedAliasIndices method = don't do two reverseLookup\no Used the alias cache in the SubtreeScopeEvaluator and the DefaultSearchEngine\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1547278 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_106",
        "file": [
            {
                "sha": "b92fb24112fee5f5a1a4aa199c8b2672c6624bfc",
                "filename": "jdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmPartition.java",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/apache/directory-server/blob/10c00a883f07bf38dde08eec797e43651a4c1940/jdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmPartition.java",
                "raw_url": "https://github.com/apache/directory-server/raw/10c00a883f07bf38dde08eec797e43651a4c1940/jdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmPartition.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/jdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmPartition.java?ref=10c00a883f07bf38dde08eec797e43651a4c1940",
                "patch": "@@ -268,7 +268,13 @@ protected void doInit() throws Exception\n             if ( cacheService != null )\n             {\n                 entryCache = cacheService.getCache( getId() );\n-                aliasCache = cacheService.getCache( \"alias\" );\n+\n+                int cacheSizeConfig = entryCache.getCacheConfiguration().getMaxElementsInMemory();\n+\n+                if ( cacheSizeConfig < cacheSize )\n+                {\n+                    entryCache.getCacheConfiguration().setMaxElementsInMemory( cacheSize );\n+                }\n             }\n \n             // We are done !"
            },
            {
                "sha": "b64dd75ddc24b5ac8a91933533892eed9718cdfd",
                "filename": "mavibot-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/mavibot/MavibotPartition.java",
                "status": "modified",
                "additions": 0,
                "deletions": 18,
                "changes": 18,
                "blob_url": "https://github.com/apache/directory-server/blob/10c00a883f07bf38dde08eec797e43651a4c1940/mavibot-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/mavibot/MavibotPartition.java",
                "raw_url": "https://github.com/apache/directory-server/raw/10c00a883f07bf38dde08eec797e43651a4c1940/mavibot-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/mavibot/MavibotPartition.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/mavibot-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/mavibot/MavibotPartition.java?ref=10c00a883f07bf38dde08eec797e43651a4c1940",
                "patch": "@@ -215,24 +215,6 @@ protected void doInit() throws Exception\n                 {\n                     entryCache.getCacheConfiguration().setMaxElementsInMemory( cacheSize );\n                 }\n-                \n-                aliasCache = cacheService.getCache( \"alias\" );\n-\n-                cacheSizeConfig = aliasCache.getCacheConfiguration().getMaxElementsInMemory();\n-\n-                if ( cacheSizeConfig < cacheSize )\n-                {\n-                    aliasCache.getCacheConfiguration().setMaxElementsInMemory( cacheSize );\n-                }\n-                \n-                piarCache = cacheService.getCache( \"piar\" );\n-                \n-                cacheSizeConfig = piarCache.getCacheConfiguration().getMaxElementsInMemory();\n-\n-                if ( cacheSizeConfig < cacheSize )\n-                {\n-                    piarCache.getCacheConfiguration().setMaxElementsInMemory( cacheSize * 3 );\n-                }\n             }\n \n             // We are done !"
            },
            {
                "sha": "184294bd275270fbaa50901251926b44567646e4",
                "filename": "xdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/AbstractBTreePartition.java",
                "status": "modified",
                "additions": 51,
                "deletions": 8,
                "changes": 59,
                "blob_url": "https://github.com/apache/directory-server/blob/10c00a883f07bf38dde08eec797e43651a4c1940/xdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/AbstractBTreePartition.java",
                "raw_url": "https://github.com/apache/directory-server/raw/10c00a883f07bf38dde08eec797e43651a4c1940/xdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/AbstractBTreePartition.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/xdbm-partition/src/main/java/org/apache/directory/server/core/partition/impl/btree/AbstractBTreePartition.java?ref=10c00a883f07bf38dde08eec797e43651a4c1940",
                "patch": "@@ -555,6 +555,26 @@ protected void doInit() throws Exception\n         setupSystemIndices();\n         setupUserIndices();\n \n+        if ( cacheService != null )\n+        {\n+            aliasCache = cacheService.getCache( \"alias\" );\n+    \n+            int cacheSizeConfig = aliasCache.getCacheConfiguration().getMaxElementsInMemory();\n+    \n+            if ( cacheSizeConfig < cacheSize )\n+            {\n+                aliasCache.getCacheConfiguration().setMaxElementsInMemory( cacheSize );\n+            }\n+            \n+            piarCache = cacheService.getCache( \"piar\" );\n+            \n+            cacheSizeConfig = piarCache.getCacheConfiguration().getMaxElementsInMemory();\n+    \n+            if ( cacheSizeConfig < cacheSize )\n+            {\n+                piarCache.getCacheConfiguration().setMaxElementsInMemory( cacheSize * 3 );\n+            }\n+        }\n     }\n \n \n@@ -2250,11 +2270,25 @@ protected Dn buildEntryDn( String id ) throws Exception\n             {\n                 ParentIdAndRdn cur = null;\n             \n-                Element piar = piarCache.get( parentId );\n-                \n-                if ( piar != null )\n+                if ( piarCache != null )\n                 {\n-                    cur = (ParentIdAndRdn)piar.getValue();\n+                    Element piar = piarCache.get( parentId );\n+                    \n+                    if ( piar != null )\n+                    {\n+                        cur = (ParentIdAndRdn)piar.getValue();\n+                    }\n+                    else\n+                    {\n+                        cur = rdnIdx.reverseLookup( parentId );\n+                        \n+                        if ( cur == null )\n+                        {\n+                            return null;\n+                        }\n+                        \n+                        piarCache.put( new Element( parentId, cur) );\n+                    }\n                 }\n                 else\n                 {\n@@ -2264,8 +2298,6 @@ protected Dn buildEntryDn( String id ) throws Exception\n                     {\n                         return null;\n                     }\n-                    \n-                    piarCache.put( new Element( parentId, cur) );\n                 }\n \n                 Rdn[] rdns = cur.getRdns();\n@@ -2766,6 +2798,11 @@ protected void addAliasIndices( String aliasId, Dn aliasDn, Dn aliasTarget ) thr\n \n         // Add the alias to the simple alias index\n         aliasIdx.add( aliasTarget, aliasId );\n+        \n+        if ( aliasCache != null )\n+        {\n+            aliasCache.put(  new Element( aliasId, aliasTarget ) );\n+        }\n \n         /*\n          * Handle One Level Scope Alias Index\n@@ -2859,6 +2896,11 @@ protected void dropAliasIndices( String aliasId ) throws Exception\n \n         // Drops all alias tuples pointing to the id of the alias to be deleted\n         aliasIdx.drop( aliasId );\n+\n+        if ( aliasCache != null )\n+        {\n+            aliasCache.remove( aliasId );\n+        }\n     }\n \n \n@@ -2874,9 +2916,10 @@ protected void dropMovedAliasIndices( final Dn movedBase ) throws Exception\n     {\n         String movedBaseId = getEntryId( movedBase );\n \n-        if ( aliasIdx.reverseLookup( movedBaseId ) != null )\n+        Dn targetDn = aliasIdx.reverseLookup( movedBaseId );\n+        \n+        if ( targetDn != null )\n         {\n-            Dn targetDn = aliasIdx.reverseLookup( movedBaseId );\n             targetDn.apply( schemaManager );\n             String targetId = getEntryId( targetDn );\n             Dn aliasDn = getEntryDn( movedBaseId );"
            },
            {
                "sha": "94b398371baed9fa5e05ce4406f9410272186535",
                "filename": "xdbm-partition/src/main/java/org/apache/directory/server/xdbm/search/evaluator/SubtreeScopeEvaluator.java",
                "status": "modified",
                "additions": 18,
                "deletions": 1,
                "changes": 19,
                "blob_url": "https://github.com/apache/directory-server/blob/10c00a883f07bf38dde08eec797e43651a4c1940/xdbm-partition/src/main/java/org/apache/directory/server/xdbm/search/evaluator/SubtreeScopeEvaluator.java",
                "raw_url": "https://github.com/apache/directory-server/raw/10c00a883f07bf38dde08eec797e43651a4c1940/xdbm-partition/src/main/java/org/apache/directory/server/xdbm/search/evaluator/SubtreeScopeEvaluator.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/xdbm-partition/src/main/java/org/apache/directory/server/xdbm/search/evaluator/SubtreeScopeEvaluator.java?ref=10c00a883f07bf38dde08eec797e43651a4c1940",
                "patch": "@@ -20,10 +20,13 @@\n package org.apache.directory.server.xdbm.search.evaluator;\n \n \n+import net.sf.ehcache.Element;\n+\n import org.apache.directory.api.ldap.model.entry.Entry;\n import org.apache.directory.api.ldap.model.exception.LdapException;\n import org.apache.directory.api.ldap.model.filter.ScopeNode;\n import org.apache.directory.api.ldap.model.message.SearchScope;\n+import org.apache.directory.api.ldap.model.name.Dn;\n import org.apache.directory.server.core.api.partition.Partition;\n import org.apache.directory.server.i18n.I18n;\n import org.apache.directory.server.xdbm.IndexEntry;\n@@ -201,7 +204,21 @@ public boolean evaluate( IndexEntry<?, String> indexEntry ) throws LdapException\n          * candidate id is an alias, if so we reject it since aliases should\n          * not be returned.\n          */\n-        if ( db.getAliasCache().get( id ) != null )\n+        if ( db.getAliasCache() != null )\n+        {\n+            Element element = db.getAliasCache().get( id );\n+            \n+            if ( element != null )\n+            {\n+                if ( element.getValue() != null )\n+                {\n+                    Dn dn = (Dn)element.getValue();\n+                    \n+                    return false;\n+                }\n+            }\n+        }\n+        else if ( null != db.getAliasIndex().reverseLookup( id ) )\n         {\n             return false;\n         }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/47b7490e26592f5282958abad7d93752fbbef198",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/8cf228104b13cb55c79b696eb2a72c05ac8ae0e2",
        "message": "o Added some missing At in the metaSyntax ObjectClass : m-obsolete and x-humanReadable\no Fixed a potential NPE when a schema object is injected without name\no Moved the ChangeLog interceptor at the end of the iChain\no Removed the isFirstOperation() check in the ChangeLong operations, it's not used anymore\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@1059073 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_107",
        "file": [
            {
                "sha": "bb3e3931ede248f13ee2bd4749120a6d29820edc",
                "filename": "core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/47b7490e26592f5282958abad7d93752fbbef198/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/47b7490e26592f5282958abad7d93752fbbef198/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java?ref=47b7490e26592f5282958abad7d93752fbbef198",
                "patch": "@@ -683,13 +683,13 @@ private void setDefaultInterceptorConfigurations()\n         list.add( new DefaultAuthorizationInterceptor() );\n         list.add( new AdministrativePointInterceptor() );\n         list.add( new ExceptionInterceptor() );\n-        list.add( new ChangeLogInterceptor() );\n         list.add( new OperationalAttributeInterceptor() );\n         list.add( new SchemaInterceptor() );\n         list.add( new CollectiveAttributeInterceptor() );\n         list.add( new SubentryInterceptor() );\n         list.add( new EventInterceptor() );\n         list.add( new TriggerInterceptor() );\n+        list.add( new ChangeLogInterceptor() );\n         list.add( new JournalInterceptor() );\n \n         setInterceptors( list );"
            },
            {
                "sha": "402f24d203445556206509bf4c0b72e743a93edb",
                "filename": "core/src/main/java/org/apache/directory/server/core/changelog/ChangeLogInterceptor.java",
                "status": "modified",
                "additions": 8,
                "deletions": 11,
                "changes": 19,
                "blob_url": "https://github.com/apache/directory-server/blob/47b7490e26592f5282958abad7d93752fbbef198/core/src/main/java/org/apache/directory/server/core/changelog/ChangeLogInterceptor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/47b7490e26592f5282958abad7d93752fbbef198/core/src/main/java/org/apache/directory/server/core/changelog/ChangeLogInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/changelog/ChangeLogInterceptor.java?ref=47b7490e26592f5282958abad7d93752fbbef198",
                "patch": "@@ -98,13 +98,11 @@ public void init( DirectoryService directoryService ) throws LdapException\n     // -----------------------------------------------------------------------\n     // Overridden (only change inducing) intercepted methods\n     // -----------------------------------------------------------------------\n-    \n-\n     public void add( NextInterceptor next, AddOperationContext addContext ) throws LdapException\n     {\n         next.add( addContext );\n \n-        if ( ! changeLog.isEnabled() || ! addContext.isFirstOperation() )\n+        if ( !changeLog.isEnabled() )\n         {\n             return;\n         }\n@@ -143,14 +141,14 @@ public void delete( NextInterceptor next, DeleteOperationContext deleteContext )\n         // must save the entry if change log is enabled\n         Entry serverEntry = null;\n \n-        if ( changeLog.isEnabled() && deleteContext.isFirstOperation() )\n+        if ( changeLog.isEnabled() )\n         {\n             serverEntry = getAttributes( deleteContext );\n         }\n \n         next.delete( deleteContext );\n \n-        if ( ! changeLog.isEnabled() || ! deleteContext.isFirstOperation() )\n+        if ( !changeLog.isEnabled() )\n         {\n             return;\n         }\n@@ -220,7 +218,7 @@ public void modify( NextInterceptor next, ModifyOperationContext modifyContext )\n         Modification modification = ServerEntryUtils.getModificationItem( modifyContext.getModItems(), entryDeleted );\n         boolean isDelete = ( modification != null );\n \n-        if ( ! isDelete && ( changeLog.isEnabled() && modifyContext.isFirstOperation() ) )\n+        if ( !isDelete && ( changeLog.isEnabled() ) )\n         {\n             // @todo make sure we're not putting in operational attributes that cannot be user modified\n             serverEntry = getAttributes( modifyContext );\n@@ -242,7 +240,6 @@ public void modify( NextInterceptor next, ModifyOperationContext modifyContext )\n         if ( \n             isDelete ||   \n             ! changeLog.isEnabled() || \n-            ! modifyContext.isFirstOperation() ||\n             \n          // if there are no modifications due to stripping out bogus non-\n          // existing attributes then we will have no modification items and\n@@ -307,7 +304,7 @@ public void rename ( NextInterceptor next, RenameOperationContext renameContext\n         // After this point, the entry has been modified. The cloned entry contains\n         // the modified entry, the originalEntry has changed\n \n-        if ( ! changeLog.isEnabled() || ! renameContext.isFirstOperation() )\n+        if ( !changeLog.isEnabled() )\n         {\n             return;\n         }\n@@ -330,15 +327,15 @@ public void moveAndRename( NextInterceptor next, MoveAndRenameOperationContext m\n     {\n         Entry serverEntry = null;\n         \n-        if ( changeLog.isEnabled() && moveAndRenameContext.isFirstOperation() )\n+        if ( changeLog.isEnabled() )\n         {\n             // @todo make sure we're not putting in operational attributes that cannot be user modified\n             serverEntry = moveAndRenameContext.getOriginalEntry();\n         }\n \n         next.moveAndRename( moveAndRenameContext );\n \n-        if ( ! changeLog.isEnabled() || ! moveAndRenameContext.isFirstOperation() )\n+        if ( !changeLog.isEnabled() )\n         {\n             return;\n         }\n@@ -371,7 +368,7 @@ public void move( NextInterceptor next, MoveOperationContext moveContext ) throw\n     {\n         next.move( moveContext );\n \n-        if ( ! changeLog.isEnabled() || ! moveContext.isFirstOperation() )\n+        if ( !changeLog.isEnabled() )\n         {\n             return;\n         }"
            },
            {
                "sha": "697b60e8ac16bb8062864685012b5aedfaf7cc91",
                "filename": "core/src/main/java/org/apache/directory/server/core/schema/SchemaInterceptor.java",
                "status": "modified",
                "additions": 4,
                "deletions": 3,
                "changes": 7,
                "blob_url": "https://github.com/apache/directory-server/blob/47b7490e26592f5282958abad7d93752fbbef198/core/src/main/java/org/apache/directory/server/core/schema/SchemaInterceptor.java",
                "raw_url": "https://github.com/apache/directory-server/raw/47b7490e26592f5282958abad7d93752fbbef198/core/src/main/java/org/apache/directory/server/core/schema/SchemaInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/schema/SchemaInterceptor.java?ref=47b7490e26592f5282958abad7d93752fbbef198",
                "patch": "@@ -1533,14 +1533,15 @@ else if ( entry.contains( OBJECT_CLASS_AT, SchemaConstants.META_OBJECT_CLASS_OC\n \n                 if ( ( schema != null ) && schema.isEnabled() )\n                 {\n-                    String ocName = entry.get( MetaSchemaConstants.M_NAME_AT ).getString();\n-                    ObjectClass addedOC = schemaManager.getObjectClassRegistry().lookup( ocName );\n+                    EntryAttribute oidAT = entry.get( MetaSchemaConstants.M_OID_AT );                    \n+                    String ocOid = oidAT.getString();\n+                    \n+                    ObjectClass addedOC = schemaManager.getObjectClassRegistry().lookup( ocOid );\n                     computeSuperior( addedOC );\n                 }\n             }\n             else if ( entry.contains( OBJECT_CLASS_AT, SchemaConstants.META_ATTRIBUTE_TYPE_OC ) )\n             {\n-\n                 // This is an AttributeType addition\n                 next.add( addContext );\n             }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/af2901c5ed0fcae63ed93e7d004fee54b64da2e8",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/7585f50ecae537a093aca1058ea347390bf89897",
        "message": "o Added the handling of exceptionCaucght() events in the client API\no The responseFuture now contains the cause of error if something went wrong during the request sending\no Added a test to demonstrate DIRAPI-20, and prove that it's now fixed.\no Fixed a NPE in some tests by using non static fields\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/apacheds-subtree@965671 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_108",
        "file": [
            {
                "sha": "89c410f4bcc3be4f22fe94fb82915a03305f626c",
                "filename": "ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/ClientSearchRequestTest.java",
                "status": "modified",
                "additions": 33,
                "deletions": 12,
                "changes": 45,
                "blob_url": "https://github.com/apache/directory-server/blob/af2901c5ed0fcae63ed93e7d004fee54b64da2e8/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/ClientSearchRequestTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/af2901c5ed0fcae63ed93e7d004fee54b64da2e8/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/ClientSearchRequestTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/ClientSearchRequestTest.java?ref=af2901c5ed0fcae63ed93e7d004fee54b64da2e8",
                "patch": "@@ -42,12 +42,13 @@\n import org.apache.directory.server.core.integ.FrameworkRunner;\n import org.apache.directory.shared.ldap.cursor.Cursor;\n import org.apache.directory.shared.ldap.entry.Entry;\n+import org.apache.directory.shared.ldap.exception.LdapException;\n import org.apache.directory.shared.ldap.filter.SearchScope;\n import org.apache.directory.shared.ldap.message.AliasDerefMode;\n import org.apache.directory.shared.ldap.message.ResultCodeEnum;\n import org.apache.directory.shared.ldap.name.DN;\n-import org.junit.AfterClass;\n-import org.junit.BeforeClass;\n+import org.junit.After;\n+import org.junit.Before;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n \n@@ -70,21 +71,29 @@\n     \"objectClass: top\",\n     \"sn: user1 sn\",\n     \"cn: user1\",\n-    \n+\n     // alias to the above entry\n     \"dn: cn=user1-alias,ou=users,ou=system\",\n     \"objectClass: alias\",\n     \"objectClass: top\",\n     \"objectClass: extensibleObject\",\n     \"aliasedObjectName: cn=user1,ou=users,ou=system\",\n-    \"cn: user1-alias\"\n+    \"cn: user1-alias\",\n+\n+    // Another user\n+    \"dn: cn=elecharny,ou=users,ou=system\",\n+    \"objectClass: person\",\n+    \"objectClass: top\",\n+    \"sn:: RW1tYW51ZWwgTMOpY2hhcm55\",\n+    \"cn: elecharny\"\n+    \n })\n public class ClientSearchRequestTest extends AbstractLdapTestUnit\n {\n-    private static LdapAsyncConnection connection;\n+    private LdapAsyncConnection connection;\n \n-    @BeforeClass\n-    public static void setup() throws Exception\n+    @Before\n+    public void setup() throws Exception\n     {\n         connection = new LdapNetworkConnection( \"localhost\", ldapServer.getPort() );\n         DN bindDn = new DN( \"uid=admin,ou=system\" );\n@@ -95,8 +104,8 @@ public static void setup() throws Exception\n     /**\n      * Close the LdapConnection\n      */\n-    @AfterClass\n-    public static void shutdown()\n+    @After\n+    public void shutdown()\n     {\n         try\n         {\n@@ -155,6 +164,7 @@ public void testAsyncSearch() throws Exception\n             \"+\" );\n         int count = 0;\n         SearchResponse searchResponse = null;\n+        \n         do\n         {\n             searchResponse = ( SearchResponse ) searchFuture.get( 1000, TimeUnit.MILLISECONDS );\n@@ -181,6 +191,7 @@ public void testSearchPersonSubstring() throws Exception\n             \"+\" );\n         int count = 0;\n         SearchResponse searchResponse = null;\n+        \n         do\n         {\n             searchResponse = ( SearchResponse ) searchFuture.get( 100000, TimeUnit.MILLISECONDS );\n@@ -193,7 +204,7 @@ public void testSearchPersonSubstring() throws Exception\n         }\n         while ( !( searchResponse instanceof SearchResultDone ) );\n \n-        assertEquals(2, count );\n+        assertEquals( 3, count );\n     }\n \n     \n@@ -208,22 +219,32 @@ public void testSearchWithDerefAlias() throws Exception\n         \n         int count = 0;\n         Cursor<SearchResponse> cursor = connection.search( searchRequest );\n+        \n         while( cursor.next() )\n         {\n             count++;\n         }\n         \n         // due to dereferencing of aliases we get only one entry\n-        assertEquals( 1, count );\n+        assertEquals( 2, count );\n \n         count = 0;\n         searchRequest.setDerefAliases( AliasDerefMode.NEVER_DEREF_ALIASES );\n         cursor = connection.search( searchRequest );\n+        \n         while( cursor.next() )\n         {\n             count++;\n         }\n         \n-        assertEquals( 2, count );\n+        assertEquals( 3, count );\n+    }\n+    \n+\n+    @Test(expected=LdapException.class)\n+    public void testSearchUTF8() throws Exception\n+    {\n+        connection.search( \"ou=system\", \"(sn=Emmanuel L\ufffdcharny)\", SearchScope.ONELEVEL, \"*\", \"+\" );\n+        fail();\n     }\n }"
            },
            {
                "sha": "b0f5baa846f3bb7327ee27fbd6c76c5393222601",
                "filename": "ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/SearchRequestReturningAttributesTest.java",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/apache/directory-server/blob/af2901c5ed0fcae63ed93e7d004fee54b64da2e8/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/SearchRequestReturningAttributesTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/af2901c5ed0fcae63ed93e7d004fee54b64da2e8/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/SearchRequestReturningAttributesTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/ldap-client-test/src/test/java/org/apache/directory/shared/client/api/operations/search/SearchRequestReturningAttributesTest.java?ref=af2901c5ed0fcae63ed93e7d004fee54b64da2e8",
                "patch": "@@ -41,7 +41,6 @@\n import org.apache.directory.shared.ldap.name.DN;\n import org.junit.AfterClass;\n import org.junit.Before;\n-import org.junit.BeforeClass;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/c43b60334bef4dbf7fd1e535a3f187537fa7465d",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/3a4227a8cf53a441688639493cbc8ec26ddde69b",
        "message": "o The DS getSession now throw an LdapException\no Eliminated a potential NPE when transmitting a null password\no The bind() method now throws an LdapException\no Fixed the InterceptorException\no Fixed tests as bind() throws an exception now\no Added tests where we send a null password, to show that DIRSERVER-1309 has been fixed\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@950291 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_109",
        "file": [
            {
                "sha": "c0bfa32cab1557688062d04bb264824e60e885f6",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/DirectoryService.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/apache/directory-server/blob/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-api/src/main/java/org/apache/directory/server/core/DirectoryService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-api/src/main/java/org/apache/directory/server/core/DirectoryService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/DirectoryService.java?ref=c43b60334bef4dbf7fd1e535a3f187537fa7465d",
                "patch": "@@ -36,6 +36,7 @@\n import org.apache.directory.server.core.schema.SchemaService;\n import org.apache.directory.shared.ldap.csn.Csn;\n import org.apache.directory.shared.ldap.entry.Entry;\n+import org.apache.directory.shared.ldap.exception.LdapException;\n import org.apache.directory.shared.ldap.ldif.LdifEntry;\n import org.apache.directory.shared.ldap.name.DN;\n import org.apache.directory.shared.ldap.schema.SchemaManager;\n@@ -196,7 +197,7 @@\n      *\n      * @return a logical session as a specific user\n      */\n-    CoreSession getSession( DN principalDn, byte[] credentials ) throws Exception;\n+    CoreSession getSession( DN principalDn, byte[] credentials ) throws LdapException;\n \n     \n     /**"
            },
            {
                "sha": "df9fccfd6a2d73d3acf1453db976c9eeb2a0c52c",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/LdapCoreSessionConnection.java",
                "status": "modified",
                "additions": 6,
                "deletions": 2,
                "changes": 8,
                "blob_url": "https://github.com/apache/directory-server/blob/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-api/src/main/java/org/apache/directory/server/core/LdapCoreSessionConnection.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-api/src/main/java/org/apache/directory/server/core/LdapCoreSessionConnection.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/LdapCoreSessionConnection.java?ref=c43b60334bef4dbf7fd1e535a3f187537fa7465d",
                "patch": "@@ -78,6 +78,7 @@\n import org.apache.directory.shared.ldap.name.DN;\n import org.apache.directory.shared.ldap.name.RDN;\n import org.apache.directory.shared.ldap.schema.SchemaManager;\n+import org.apache.directory.shared.ldap.util.StringTools;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n@@ -939,11 +940,14 @@ public BindResponse bind( DN name, String credentials ) throws LdapException, IO\n     {\n         try\n         {\n-            setSession( directoryService.getSession( name, credentials.getBytes() ) );\n+            byte[] credBytes = ( credentials == null ? StringTools.EMPTY_BYTES : StringTools.getBytesUtf8( credentials ) );\n+\n+            setSession( directoryService.getSession( name, credBytes ) );\n         }\n-        catch( Exception e )\n+        catch ( LdapException e )\n         {\n             LOG.warn( e.getMessage(), e );\n+            throw e;\n         }\n         \n         return null;"
            },
            {
                "sha": "a1a964a2a7135416c2cbc64a8521f0b9088a03b4",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/OperationManager.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/apache/directory-server/blob/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-api/src/main/java/org/apache/directory/server/core/OperationManager.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-api/src/main/java/org/apache/directory/server/core/OperationManager.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/OperationManager.java?ref=c43b60334bef4dbf7fd1e535a3f187537fa7465d",
                "patch": "@@ -42,6 +42,7 @@\n import org.apache.directory.server.core.interceptor.context.SearchOperationContext;\n import org.apache.directory.server.core.interceptor.context.UnbindOperationContext;\n import org.apache.directory.shared.ldap.entry.Entry;\n+import org.apache.directory.shared.ldap.exception.LdapException;\n import org.apache.directory.shared.ldap.name.DN;\n \n \n@@ -147,7 +148,7 @@\n     /**\n      * TODO document after determining if this method should be here.\n      */\n-    void bind( BindOperationContext opContext ) throws Exception;\n+    void bind( BindOperationContext opContext ) throws LdapException;\n \n     \n     /**"
            },
            {
                "sha": "a53e2375cf68d47faa17526deaff33779aab4d03",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/interceptor/InterceptorChain.java",
                "status": "modified",
                "additions": 4,
                "deletions": 3,
                "changes": 7,
                "blob_url": "https://github.com/apache/directory-server/blob/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-api/src/main/java/org/apache/directory/server/core/interceptor/InterceptorChain.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-api/src/main/java/org/apache/directory/server/core/interceptor/InterceptorChain.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/interceptor/InterceptorChain.java?ref=c43b60334bef4dbf7fd1e535a3f187537fa7465d",
                "patch": "@@ -58,6 +58,7 @@\n import org.apache.directory.server.i18n.I18n;\n import org.apache.directory.shared.ldap.constants.SchemaConstants;\n import org.apache.directory.shared.ldap.entry.Entry;\n+import org.apache.directory.shared.ldap.exception.LdapException;\n import org.apache.directory.shared.ldap.name.DN;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n@@ -770,7 +771,7 @@ public void add( AddOperationContext opContext ) throws Exception\n     }\n \n \n-    public void bind( BindOperationContext opContext ) throws Exception\n+    public void bind( BindOperationContext opContext ) throws LdapException\n     {\n         Element node = getStartingEntry();\n         Interceptor head = node.interceptor;\n@@ -781,9 +782,9 @@ public void bind( BindOperationContext opContext ) throws Exception\n         {\n             head.bind( next, opContext );\n         }\n-        catch ( Exception ne )\n+        catch ( LdapException le )\n         {\n-            throw ne;\n+            throw le;\n         }\n         catch ( Throwable e )\n         {"
            },
            {
                "sha": "3115e36b7ef9dab5c1501ac40eab5b8b25de80c0",
                "filename": "core-api/src/main/java/org/apache/directory/server/core/interceptor/InterceptorException.java",
                "status": "modified",
                "additions": 12,
                "deletions": 9,
                "changes": 21,
                "blob_url": "https://github.com/apache/directory-server/blob/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-api/src/main/java/org/apache/directory/server/core/interceptor/InterceptorException.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-api/src/main/java/org/apache/directory/server/core/interceptor/InterceptorException.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-api/src/main/java/org/apache/directory/server/core/interceptor/InterceptorException.java?ref=c43b60334bef4dbf7fd1e535a3f187537fa7465d",
                "patch": "@@ -22,6 +22,8 @@\n \n import javax.naming.NamingException;\n \n+import org.apache.directory.shared.ldap.exception.LdapException;\n+\n \n /**\n  * A {@link NamingException} that wraps uncaught runtime exceptions thrown\n@@ -30,7 +32,7 @@\n  * @author <a href=\"mailto:dev@directory.apache.org\">Apache Directory Project</a>\n  * @version $Rev$, $Date$\n  */\n-public class InterceptorException extends NamingException\n+public class InterceptorException extends LdapException\n {\n     private static final long serialVersionUID = 3258690996517746233L;\n \n@@ -45,8 +47,9 @@\n      *\n      * @param interceptor the Interceptor causing the failure\n      */\n-    public InterceptorException(Interceptor interceptor)\n+    public InterceptorException( Interceptor interceptor )\n     {\n+        super();\n         this.interceptor = interceptor;\n     }\n \n@@ -57,7 +60,7 @@ public InterceptorException(Interceptor interceptor)\n      * @param interceptor the Interceptor causing the failure\n      * @param explanation String explanation of why the Interceptor failed\n      */\n-    public InterceptorException(Interceptor interceptor, String explanation)\n+    public InterceptorException( Interceptor interceptor, String explanation )\n     {\n         super( explanation );\n         this.interceptor = interceptor;\n@@ -70,10 +73,10 @@ public InterceptorException(Interceptor interceptor, String explanation)\n      * @param interceptor the Interceptor causing the failure\n      * @param rootCause   the root cause of this exception\n      */\n-    public InterceptorException(Interceptor interceptor, Throwable rootCause)\n+    public InterceptorException( Interceptor interceptor, Throwable rootCause )\n     {\n-        this( interceptor );\n-        super.setRootCause( rootCause );\n+        super( rootCause );\n+        this.interceptor = interceptor;\n     }\n \n \n@@ -84,10 +87,10 @@ public InterceptorException(Interceptor interceptor, Throwable rootCause)\n      * @param explanation String explanation of why the Interceptor failed\n      * @param rootCause   the root cause of this exception\n      */\n-    public InterceptorException(Interceptor interceptor, String explanation, Throwable rootCause)\n+    public InterceptorException( Interceptor interceptor, String explanation, Throwable rootCause )\n     {\n-        this( interceptor, explanation );\n-        super.setRootCause( rootCause );\n+        super( explanation, rootCause );\n+        this.interceptor = interceptor;\n     }\n \n "
            },
            {
                "sha": "aad26e1f86644d2da31aede1bd466ac3ca4511fd",
                "filename": "core-integ/src/main/java/org/apache/directory/server/core/integ/IntegrationUtils.java",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/apache/directory-server/blob/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-integ/src/main/java/org/apache/directory/server/core/integ/IntegrationUtils.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-integ/src/main/java/org/apache/directory/server/core/integ/IntegrationUtils.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-integ/src/main/java/org/apache/directory/server/core/integ/IntegrationUtils.java?ref=c43b60334bef4dbf7fd1e535a3f187537fa7465d",
                "patch": "@@ -54,6 +54,7 @@\n import org.apache.directory.shared.ldap.name.DN;\n import org.apache.directory.shared.ldap.name.RDN;\n import org.apache.directory.shared.ldap.schema.registries.Schema;\n+import org.apache.directory.shared.ldap.util.StringTools;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n@@ -377,8 +378,10 @@ public static LdapConnection getConnectionAs( DirectoryService dirService, Strin\n     public static LdapConnection getConnectionAs( DirectoryService dirService, DN dn, String password ) throws Exception\n     {\n         Object connectionObj = LdapConnectionFactory.getCoreSessionConnection();\n-        ( ( LdapCoreSessionConnection ) connectionObj ).setSession( dirService.getSession( dn, password.getBytes() ) );\n         \n+        byte[] passwdBytes = password == null ? StringTools.EMPTY_BYTES : StringTools.getBytesUtf8( password );\n+        ( ( LdapCoreSessionConnection ) connectionObj ).setSession( dirService.getSession( dn, passwdBytes ) );\n+\n         return ( LdapConnection )connectionObj;\n     }\n "
            },
            {
                "sha": "644b91d02570667079c6c706eefb0c97e622d732",
                "filename": "core-integ/src/test/java/org/apache/directory/server/core/authn/SimpleAuthenticationIT.java",
                "status": "modified",
                "additions": 80,
                "deletions": 31,
                "changes": 111,
                "blob_url": "https://github.com/apache/directory-server/blob/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-integ/src/test/java/org/apache/directory/server/core/authn/SimpleAuthenticationIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-integ/src/test/java/org/apache/directory/server/core/authn/SimpleAuthenticationIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-integ/src/test/java/org/apache/directory/server/core/authn/SimpleAuthenticationIT.java?ref=c43b60334bef4dbf7fd1e535a3f187537fa7465d",
                "patch": "@@ -23,9 +23,9 @@\n import static org.apache.directory.server.core.integ.IntegrationUtils.apply;\n import static org.apache.directory.server.core.integ.IntegrationUtils.getConnectionAs;\n import static org.apache.directory.server.core.integ.IntegrationUtils.getUserAddLdif;\n-import static org.junit.Assert.assertFalse;\n import static org.junit.Assert.assertNotNull;\n import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n \n import org.apache.commons.lang.ArrayUtils;\n import org.apache.directory.ldap.client.api.LdapConnection;\n@@ -37,6 +37,7 @@\n import org.apache.directory.server.core.integ.IntegrationUtils;\n import org.apache.directory.shared.ldap.entry.Entry;\n import org.apache.directory.shared.ldap.entry.EntryAttribute;\n+import org.apache.directory.shared.ldap.exception.LdapException;\n import org.apache.directory.shared.ldap.name.DN;\n import org.apache.directory.shared.ldap.util.StringTools;\n import org.junit.After;\n@@ -208,11 +209,17 @@ public void test11InvalidateCredentialCache() throws Exception\n         // close and try with old password (should fail)\n         connection.close();\n \n-        connection.bind( userDn, \"test\" );\n-        assertFalse( connection.isAuthenticated() );\n-\n-        // close and try again now with new password (should fail)\n-        connection.close();\n+        try\n+        {\n+            connection.bind( userDn, \"test\" );\n+            fail();\n+        }\n+        catch ( LdapException le )\n+        {\n+            connection.close();\n+        }\n+\n+        // close and try again now with new password (should succeed)\n         connection.bind( userDn, \"newpwd\" );\n \n         entry = ( ( SearchResultEntry ) connection.lookup( userDn ) ).getEntry();\n@@ -259,11 +266,17 @@ public void testSHA() throws Exception\n         // close and try with old password (should fail)\n         connection.close();\n \n-        connection.bind( userDn, \"test\" );\n-        assertFalse( connection.isAuthenticated() );\n-        connection.close();\n+        try\n+        {\n+            connection.bind( userDn, \"test\" );\n+            fail();\n+        }\n+        catch ( LdapException le )\n+        {\n+            connection.close();\n+        }\n \n-        // try again now with new password (should be successfull)\n+        // try again now with new password (should be successful)\n         connection.bind( userDn, \"secret\" );\n         assertTrue( connection.isAuthenticated() );\n         entry = ( ( SearchResultEntry ) connection.lookup( userDn ) ).getEntry();\n@@ -301,11 +314,17 @@ public void testSSHA() throws Exception\n         // close and try with old password (should fail)\n         connection.close();\n \n-        connection.bind( userDn, \"test\" );\n-        assertFalse( connection.isAuthenticated() );\n-        connection.close();\n+        try\n+        {\n+            connection.bind( userDn, \"test\" );\n+            fail();\n+        }\n+        catch ( LdapException le )\n+        {\n+            connection.close();\n+        }\n \n-        // try again now with new password (should be successfull)\n+        // try again now with new password (should be successful)\n         connection.bind( userDn, \"secret\" );\n         entry = ( ( SearchResultEntry ) connection.lookup( userDn ) ).getEntry();\n         assertNotNull( entry );\n@@ -341,9 +360,15 @@ public void testSSHA4BytesSalt() throws Exception\n         // close and try with old password (should fail)\n         connection.close();\n \n-        connection.bind( userDn, \"test\" );\n-        assertFalse( connection.isAuthenticated() );\n-        connection.close();\n+        try\n+        {\n+            connection.bind( userDn, \"test\" );\n+            fail();\n+        }\n+        catch ( LdapException le )\n+        {\n+            connection.close();\n+        }\n \n         // try again now with new password (should be successful)\n         connection.bind( userDn, \"test123\" );\n@@ -381,11 +406,17 @@ public void testMD5() throws Exception\n         // close and try with old password (should fail)\n         connection.close();\n \n-        connection.bind( userDn, \"test\" );\n-        assertFalse( connection.isAuthenticated() );\n-        connection.close();\n+        try\n+        {\n+            connection.bind( userDn, \"test\" );\n+            fail();\n+        }\n+        catch ( LdapException le )\n+        {\n+            connection.close();\n+        }\n \n-        // try again now with new password (should be successfull)\n+        // try again now with new password (should be successful)\n         connection.bind( userDn, \"secret\" );\n         entry = ( ( SearchResultEntry ) connection.lookup( userDn ) ).getEntry();\n         assertNotNull( entry );\n@@ -422,9 +453,15 @@ public void testSMD5() throws Exception\n         // close and try with old password (should fail)\n         connection.close();\n \n-        connection.bind( userDn, \"test\" );\n-        assertFalse( connection.isAuthenticated() );\n-        connection.close();\n+        try\n+        {\n+            connection.bind( userDn, \"test\" );\n+            fail();\n+        }\n+        catch ( LdapException le )\n+        {\n+            connection.close();\n+        }\n \n         // try again now with new password (should be successful)\n         connection.bind( userDn, \"secret\" );\n@@ -462,11 +499,17 @@ public void testCRYPT() throws Exception\n         // close and try with old password (should fail)\n         connection.close();\n \n-        connection.bind( userDn, \"test\" );\n-        assertFalse( connection.isAuthenticated() );\n-        connection.close();\n+        try\n+        {\n+            connection.bind( userDn, \"test\" );\n+            fail();\n+        }\n+        catch ( LdapException le )\n+        {\n+            connection.close();\n+        }\n \n-        // try again now with new password (should be successfull)\n+        // try again now with new password (should be successful)\n         connection.bind( userDn, \"secret\" );\n         entry = ( ( SearchResultEntry ) connection.lookup( userDn ) ).getEntry();\n         assertNotNull( entry );\n@@ -501,8 +544,14 @@ public void testInvalidateCredentialCacheForUpdatingAnotherUsersPassword() throw\n         connection.modify( modReq );\n         connection.close();\n \n-        connection.bind( userDn, \"test\" );\n-        assertFalse( connection.isAuthenticated() );\n-        connection.close();\n+        try\n+        {\n+            connection.bind( userDn, \"test\" );\n+            fail();\n+        }\n+        catch ( LdapException le )\n+        {\n+            connection.close();\n+        }\n     }\n }"
            },
            {
                "sha": "9722ad84bc24f8ac396d1a573b16efd40c4da82f",
                "filename": "core-integ/src/test/java/org/apache/directory/server/core/operations/bind/SimpleBindIT.java",
                "status": "modified",
                "additions": 45,
                "deletions": 8,
                "changes": 53,
                "blob_url": "https://github.com/apache/directory-server/blob/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-integ/src/test/java/org/apache/directory/server/core/operations/bind/SimpleBindIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-integ/src/test/java/org/apache/directory/server/core/operations/bind/SimpleBindIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-integ/src/test/java/org/apache/directory/server/core/operations/bind/SimpleBindIT.java?ref=c43b60334bef4dbf7fd1e535a3f187537fa7465d",
                "patch": "@@ -40,11 +40,14 @@\n import javax.naming.directory.SearchControls;\n import javax.naming.directory.SearchResult;\n \n+import org.apache.directory.ldap.client.api.LdapConnection;\n import org.apache.directory.server.core.DirectoryService;\n import org.apache.directory.server.core.integ.AbstractLdapTestUnit;\n import org.apache.directory.server.core.integ.FrameworkRunner;\n+import org.apache.directory.server.core.integ.IntegrationUtils;\n import org.apache.directory.server.core.jndi.CoreContextFactory;\n import org.apache.directory.shared.ldap.constants.JndiPropertyConstants;\n+import org.apache.directory.shared.ldap.exception.LdapUnwillingToPerformException;\n import org.apache.directory.shared.ldap.message.AliasDerefMode;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n@@ -85,7 +88,7 @@\n      * @throws Exception on error\n      */\n     @Test\n-    public void testSimpleBindUserPassword()\n+    public void testSimpleBindAPrincipalAPassword()\n     {\n         // We will bind using JNDI\n         // Set up the environment for creating the initial context\n@@ -128,7 +131,7 @@ public void testSimpleBindUserPassword()\n      * @throws Exception on error\n      */\n     @Test\n-    public void testSimpleBindUserBadPassword()\n+    public void testSimpleBindAPrincipalBadPassword()\n     {\n         // We will bind using JNDI\n         // Set up the environment for creating the initial context\n@@ -167,7 +170,7 @@ public void testSimpleBindUserBadPassword()\n      * @throws Exception on error\n      */\n     @Test\n-    public void testSimpleBindBadUserPassword()\n+    public void testSimpleBindBadPrincipalAPassword()\n     {\n         // We will bind using JNDI\n         // Set up the environment for creating the initial context\n@@ -206,7 +209,7 @@ public void testSimpleBindBadUserPassword()\n      * @throws Exception on error\n      */\n     @Test\n-    public void testSimpleBindUnknowUserPassword()\n+    public void testSimpleBindUnknowPrincipalAPassword()\n     {\n         // We will bind using JNDI\n         // Set up the environment for creating the initial context\n@@ -247,7 +250,7 @@ public void testSimpleBindUnknowUserPassword()\n      * @throws Exception on error\n      */\n     @Test\n-    public void testSimpleBindNoUserNoPassword()\n+    public void testSimpleBindNoPrincipalNoPassword()\n     {\n         // We will bind using JNDI\n         // Set up the environment for creating the initial context\n@@ -258,7 +261,7 @@ public void testSimpleBindNoUserNoPassword()\n         // Bind on the rootDSE\n         env.put( Context.PROVIDER_URL, \"\" );\n \n-        // Authenticate as admin and password \"secret\"\n+        // Authenticate with no principal and no password : this is an anonymous bind\n         env.put( Context.SECURITY_AUTHENTICATION, \"simple\" );\n         env.put( Context.SECURITY_PRINCIPAL, \"\" );\n         env.put( Context.SECURITY_CREDENTIALS, \"\" );\n@@ -325,7 +328,7 @@ public void testSimpleBindNoUserNoPassword()\n      * @throws Exception on error\n      */\n     @Test\n-    public void testSimpleBindUserNoPassword()\n+    public void testSimpleBindAPrincipalNoPassword()\n     {\n         // We will bind using JNDI\n         // Set up the environment for creating the initial context\n@@ -357,13 +360,47 @@ public void testSimpleBindUserNoPassword()\n     }\n \n \n+    /**\n+     * covers the Unauthenticated case : we should get a UnwillingToPerform error.\n+     * \n+     * @throws Exception on error\n+     */\n+    @Test\n+    public void testSimpleBindAPrincipalNullPassword() throws Exception\n+    {\n+        try\n+        {\n+            LdapConnection connection = IntegrationUtils.getConnectionAs( service, \"uid=admin,ou=system\", null );\n+            \n+            // We should have failed wilh an LdapUnwillingToPerformException\n+            fail();\n+        }\n+        catch ( LdapUnwillingToPerformException lutpe )\n+        {\n+            // expected\n+        }\n+\n+        LdapConnection connection = IntegrationUtils.getConnectionAs( service, \"uid=admin,ou=system\", \"secret\" );\n+\n+        try\n+        {\n+            connection.bind( \"uid=admin,ou=system\", null );\n+            fail();\n+        }\n+        catch ( LdapUnwillingToPerformException lutpe )\n+        {\n+            // expected\n+        }\n+    }\n+\n+\n     /**\n      * not allowed by the server. We should get a invalidCredentials error.\n      * \n      * @throws Exception on error\n      */\n     @Test\n-    public void testSimpleBindNoUserPassword() throws Exception\n+    public void testSimpleBindNoPrincipalAPassword() throws Exception\n     {\n         // We will bind using JNDI\n         // Set up the environment for creating the initial context"
            },
            {
                "sha": "202a985b49b4517aee80b5897f8994b712f31857",
                "filename": "core-mock/src/main/java/org/apache/directory/server/core/MockDirectoryService.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/apache/directory-server/blob/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-mock/src/main/java/org/apache/directory/server/core/MockDirectoryService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-mock/src/main/java/org/apache/directory/server/core/MockDirectoryService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-mock/src/main/java/org/apache/directory/server/core/MockDirectoryService.java?ref=c43b60334bef4dbf7fd1e535a3f187537fa7465d",
                "patch": "@@ -39,6 +39,7 @@\n import org.apache.directory.server.core.schema.SchemaService;\n import org.apache.directory.shared.ldap.csn.Csn;\n import org.apache.directory.shared.ldap.entry.Entry;\n+import org.apache.directory.shared.ldap.exception.LdapException;\n import org.apache.directory.shared.ldap.ldif.LdifEntry;\n import org.apache.directory.shared.ldap.name.DN;\n import org.apache.directory.shared.ldap.schema.SchemaManager;\n@@ -368,7 +369,7 @@ public CoreSession getSession( LdapPrincipal principal ) throws Exception\n     }\n \n \n-    public CoreSession getSession( DN principalDn, byte[] credentials ) throws Exception\n+    public CoreSession getSession( DN principalDn, byte[] credentials ) throws LdapException\n     {\n         return null;\n     }"
            },
            {
                "sha": "718b240f34a209b61c9165bef8e1f06cd3bc2dce",
                "filename": "core-mock/src/main/java/org/apache/directory/server/core/MockOperationManager.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/apache/directory-server/blob/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-mock/src/main/java/org/apache/directory/server/core/MockOperationManager.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core-mock/src/main/java/org/apache/directory/server/core/MockOperationManager.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-mock/src/main/java/org/apache/directory/server/core/MockOperationManager.java?ref=c43b60334bef4dbf7fd1e535a3f187537fa7465d",
                "patch": "@@ -41,6 +41,7 @@\n import org.apache.directory.server.core.interceptor.context.RenameOperationContext;\n import org.apache.directory.server.core.interceptor.context.SearchOperationContext;\n import org.apache.directory.server.core.interceptor.context.UnbindOperationContext;\n+import org.apache.directory.shared.ldap.exception.LdapException;\n import org.apache.directory.shared.ldap.name.DN;\n \n public class MockOperationManager implements OperationManager\n@@ -57,7 +58,7 @@ public void add( AddOperationContext opContext ) throws Exception\n     }\n \n     \n-    public void bind( BindOperationContext opContext ) throws Exception\n+    public void bind( BindOperationContext opContext ) throws LdapException\n     {\n     }\n "
            },
            {
                "sha": "413513c3a68dd9f4855a35bbecf87f3724412818",
                "filename": "core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/apache/directory-server/blob/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/DefaultDirectoryService.java?ref=c43b60334bef4dbf7fd1e535a3f187537fa7465d",
                "patch": "@@ -660,8 +660,7 @@ public CoreSession getSession( LdapPrincipal principal )\n     }\n     \n     \n-    public CoreSession getSession( DN principalDn, byte[] credentials ) \n-        throws Exception\n+    public CoreSession getSession( DN principalDn, byte[] credentials ) throws LdapException\n     {\n         if ( ! started )\n         {"
            },
            {
                "sha": "e1345de307140e06f1438a3c4f4190598212e229",
                "filename": "core/src/main/java/org/apache/directory/server/core/DefaultOperationManager.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/apache/directory-server/blob/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core/src/main/java/org/apache/directory/server/core/DefaultOperationManager.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core/src/main/java/org/apache/directory/server/core/DefaultOperationManager.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/DefaultOperationManager.java?ref=c43b60334bef4dbf7fd1e535a3f187537fa7465d",
                "patch": "@@ -53,6 +53,7 @@\n import org.apache.directory.shared.ldap.entry.EntryAttribute;\n import org.apache.directory.shared.ldap.entry.Value;\n import org.apache.directory.shared.ldap.exception.LdapAffectMultipleDsaException;\n+import org.apache.directory.shared.ldap.exception.LdapException;\n import org.apache.directory.shared.ldap.exception.LdapInvalidDnException;\n import org.apache.directory.shared.ldap.exception.LdapPartialResultException;\n import org.apache.directory.shared.ldap.exception.LdapReferralException;\n@@ -271,7 +272,7 @@ public void add( AddOperationContext opContext ) throws Exception\n     /**\n      * {@inheritDoc}\n      */\n-    public void bind( BindOperationContext opContext ) throws Exception\n+    public void bind( BindOperationContext opContext ) throws LdapException\n     {\n         LOG.debug( \">> BindOperation : {}\", opContext );\n "
            },
            {
                "sha": "b7cb203dbaf5db6bf5402342c659ecf997c10d73",
                "filename": "core/src/test/java/org/apache/directory/server/core/authz/support/MaxImmSubFilterTest.java",
                "status": "modified",
                "additions": 4,
                "deletions": 3,
                "changes": 7,
                "blob_url": "https://github.com/apache/directory-server/blob/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core/src/test/java/org/apache/directory/server/core/authz/support/MaxImmSubFilterTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core/src/test/java/org/apache/directory/server/core/authz/support/MaxImmSubFilterTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/test/java/org/apache/directory/server/core/authz/support/MaxImmSubFilterTest.java?ref=c43b60334bef4dbf7fd1e535a3f187537fa7465d",
                "patch": "@@ -86,8 +86,9 @@\n import org.apache.directory.shared.ldap.cursor.Cursor;\n import org.apache.directory.shared.ldap.cursor.CursorIterator;\n import org.apache.directory.shared.ldap.entry.DefaultEntry;\n-import org.apache.directory.shared.ldap.entry.Modification;\n import org.apache.directory.shared.ldap.entry.Entry;\n+import org.apache.directory.shared.ldap.entry.Modification;\n+import org.apache.directory.shared.ldap.exception.LdapException;\n import org.apache.directory.shared.ldap.ldif.LdifEntry;\n import org.apache.directory.shared.ldap.message.control.Control;\n import org.apache.directory.shared.ldap.name.DN;\n@@ -796,7 +797,7 @@ public CoreSession getSession( LdapPrincipal principal ) throws Exception\n         }\n \n \n-        public CoreSession getSession( DN principalDn, byte[] credentials ) throws Exception\n+        public CoreSession getSession( DN principalDn, byte[] credentials ) throws LdapException\n         {\n             return null;\n         }\n@@ -930,7 +931,7 @@ public void add( AddOperationContext opContext ) throws Exception\n         }\n \n         \n-        public void bind( BindOperationContext opContext ) throws Exception\n+        public void bind( BindOperationContext opContext ) throws LdapException\n         {\n         }\n "
            },
            {
                "sha": "52b56d472010187c711f371a3ab78ce25de18dc4",
                "filename": "core/src/test/java/org/apache/directory/server/core/interceptor/InterceptorChainTest.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/apache/directory-server/blob/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core/src/test/java/org/apache/directory/server/core/interceptor/InterceptorChainTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c43b60334bef4dbf7fd1e535a3f187537fa7465d/core/src/test/java/org/apache/directory/server/core/interceptor/InterceptorChainTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/test/java/org/apache/directory/server/core/interceptor/InterceptorChainTest.java?ref=c43b60334bef4dbf7fd1e535a3f187537fa7465d",
                "patch": "@@ -52,6 +52,7 @@\n import org.apache.directory.shared.ldap.constants.AuthenticationLevel;\n import org.apache.directory.shared.ldap.csn.Csn;\n import org.apache.directory.shared.ldap.entry.Entry;\n+import org.apache.directory.shared.ldap.exception.LdapException;\n import org.apache.directory.shared.ldap.ldif.LdifEntry;\n import org.apache.directory.shared.ldap.name.DN;\n import org.apache.directory.shared.ldap.schema.SchemaManager;\n@@ -602,7 +603,7 @@ public CoreSession getSession( LdapPrincipal principal ) throws Exception\n         }\n \n \n-        public CoreSession getSession( DN principalDn, byte[] credentials ) throws Exception\n+        public CoreSession getSession( DN principalDn, byte[] credentials ) throws LdapException\n         {\n             return null;\n         }"
            },
            {
                "sha": "62f66f3a4c400abf88f1d31216c6d34505caccf1",
                "filename": "server-integ/src/test/java/org/apache/directory/server/operations/bind/SimpleBindIT.java",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/apache/directory-server/blob/c43b60334bef4dbf7fd1e535a3f187537fa7465d/server-integ/src/test/java/org/apache/directory/server/operations/bind/SimpleBindIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/c43b60334bef4dbf7fd1e535a3f187537fa7465d/server-integ/src/test/java/org/apache/directory/server/operations/bind/SimpleBindIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-integ/src/test/java/org/apache/directory/server/operations/bind/SimpleBindIT.java?ref=c43b60334bef4dbf7fd1e535a3f187537fa7465d",
                "patch": "@@ -192,7 +192,7 @@ public void testSimpleBindBadPassword()\n      * try to connect using a user with an invalid DN: we should get a invalidDNSyntax error.\n      */\n     @Test\n-    public void testSimpleBindBadUserPassword()\n+    public void testSimpleBindBadPrincipalAPassword()\n     {\n         Hashtable<String, String> env = new Hashtable<String, String>();\n         env.put( Context.INITIAL_CONTEXT_FACTORY, \"com.sun.jndi.ldap.LdapCtxFactory\" );\n@@ -222,7 +222,7 @@ public void testSimpleBindBadUserPassword()\n      * try to connect using a unknown user: we should get a invalidCredentials error.\n      */\n     @Test\n-    public void testSimpleBindUnknowUserPassword()\n+    public void testSimpleBindUnknowPrincipalAPassword()\n     {\n         Hashtable<String, String> env = new Hashtable<String, String>();\n         env.put( Context.INITIAL_CONTEXT_FACTORY, \"com.sun.jndi.ldap.LdapCtxFactory\" );\n@@ -250,7 +250,7 @@ public void testSimpleBindUnknowUserPassword()\n      * covers the anonymous authentication : we should be able to read the rootDSE, but that's it\n      */\n     @Test\n-    public void testSimpleBindNoUserNoPassword()\n+    public void testSimpleBindNoPrincipalNoPassword()\n     {\n         boolean oldValue = ldapServer.getDirectoryService().isAllowAnonymousAccess();\n         ldapServer.getDirectoryService().setAllowAnonymousAccess( false );\n@@ -336,7 +336,7 @@ public void testSimpleBindNoUserNoPassword()\n      * covers the Unauthenticated case : we should get a UnwillingToPerform error.\n      */\n     @Test\n-    public void testSimpleBindUserNoPassword()\n+    public void testSimpleBindPrincipalNoPassword()\n     {\n         Hashtable<String, String> env = new Hashtable<String, String>();\n         env.put( Context.INITIAL_CONTEXT_FACTORY, \"com.sun.jndi.ldap.LdapCtxFactory\" );\n@@ -366,7 +366,7 @@ public void testSimpleBindUserNoPassword()\n      * not allowed by the server. We should get a invalidCredentials error.\n      */\n     @Test\n-    public void testSimpleBindNoUserPassword() throws Exception\n+    public void testSimpleBindNoUserAPassword() throws Exception\n     {\n         Hashtable<String, String> env = new Hashtable<String, String>();\n         env.put( Context.INITIAL_CONTEXT_FACTORY, \"com.sun.jndi.ldap.LdapCtxFactory\" );"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/1d92c47fdaff9e06686cb371f3591e134f18cb6b",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/5b90fea8ecbc9adc709ad158fbded30d36d37878",
        "message": "o Moved the invocation stack handling into the OperationContext\no Added a @Factory into the AdministratorsGroup test to avoid a NPE when the test is run alone\no added a package for core-jndi (not yeat integrated into the build)\no Modify te PartitionNexusProxy to use the OperationContext modification with the Invocation\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/bigbang@653338 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_110",
        "file": [
            {
                "sha": "61bb9aee2ef7c4090e6c2e1569ce2902a1f42ac6",
                "filename": "core-integ/src/test/java/org/apache/directory/server/core/authz/AdministratorsGroupIT.java",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/apache/directory-server/blob/1d92c47fdaff9e06686cb371f3591e134f18cb6b/core-integ/src/test/java/org/apache/directory/server/core/authz/AdministratorsGroupIT.java",
                "raw_url": "https://github.com/apache/directory-server/raw/1d92c47fdaff9e06686cb371f3591e134f18cb6b/core-integ/src/test/java/org/apache/directory/server/core/authz/AdministratorsGroupIT.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-integ/src/test/java/org/apache/directory/server/core/authz/AdministratorsGroupIT.java?ref=1d92c47fdaff9e06686cb371f3591e134f18cb6b",
                "patch": "@@ -76,6 +76,7 @@ boolean canReadAdministrators( DirContext ctx ) throws NamingException\n      * @throws Exception on failures\n      */\n     @Test\n+    @Factory ( AutzIntegUtils.ServiceFactory.class )\n     public void testNonAdminReadAccessToGroups() throws Exception\n     {\n         Name billydDn = createUser( \"billyd\", \"s3kr3t\" );"
            },
            {
                "sha": "432328323115db7d6e92c72a9c40c78fb204af14",
                "filename": "core/src/main/java/org/apache/directory/server/core/interceptor/context/AbstractOperationContext.java",
                "status": "modified",
                "additions": 24,
                "deletions": 1,
                "changes": 25,
                "blob_url": "https://github.com/apache/directory-server/blob/1d92c47fdaff9e06686cb371f3591e134f18cb6b/core/src/main/java/org/apache/directory/server/core/interceptor/context/AbstractOperationContext.java",
                "raw_url": "https://github.com/apache/directory-server/raw/1d92c47fdaff9e06686cb371f3591e134f18cb6b/core/src/main/java/org/apache/directory/server/core/interceptor/context/AbstractOperationContext.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/interceptor/context/AbstractOperationContext.java?ref=1d92c47fdaff9e06686cb371f3591e134f18cb6b",
                "patch": "@@ -25,6 +25,8 @@\n \n import javax.naming.ldap.Control;\n \n+import org.apache.directory.server.core.invocation.Invocation;\n+import org.apache.directory.server.core.invocation.InvocationStack;\n import org.apache.directory.server.schema.registries.Registries;\n import org.apache.directory.shared.ldap.name.LdapDN;\n \n@@ -55,7 +57,6 @@\n     /** The global registries reference */\n     private Registries registries;\n \n-    \n     /**\n      * Creates a new instance of AbstractOperationContext.\n      *\n@@ -220,4 +221,26 @@ public Registries getRegistries()\n     {\n         return registries;\n     }\n+    \n+    \n+    /**\n+     * Add the invocation into the invocation stack\n+     * \n+     * @param invocation The new invocation.\n+     */\n+    public void push( Invocation invocation )\n+    {\n+        InvocationStack stack = InvocationStack.getInstance();\n+        stack.push( invocation );\n+    }\n+    \n+    \n+    /**\n+     * Remove the invocation fro the invocation stack\n+     */\n+    public void pop()\n+    {\n+        InvocationStack stack = InvocationStack.getInstance();\n+        stack.pop();\n+    }\n }"
            },
            {
                "sha": "ba13103bb0d276ad29c1c937f99a336e5ecb1f9e",
                "filename": "core/src/main/java/org/apache/directory/server/core/invocation/Invocation.java",
                "status": "modified",
                "additions": 2,
                "deletions": 42,
                "changes": 44,
                "blob_url": "https://github.com/apache/directory-server/blob/1d92c47fdaff9e06686cb371f3591e134f18cb6b/core/src/main/java/org/apache/directory/server/core/invocation/Invocation.java",
                "raw_url": "https://github.com/apache/directory-server/raw/1d92c47fdaff9e06686cb371f3591e134f18cb6b/core/src/main/java/org/apache/directory/server/core/invocation/Invocation.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/invocation/Invocation.java?ref=1d92c47fdaff9e06686cb371f3591e134f18cb6b",
                "patch": "@@ -20,10 +20,8 @@\n package org.apache.directory.server.core.invocation;\n \n \n-import java.util.ArrayList;\n import java.util.Collections;\n import java.util.HashSet;\n-import java.util.List;\n import java.util.Collection;\n import java.util.Set;\n \n@@ -43,7 +41,6 @@\n {\n     private final Context caller;\n     private final String name;\n-    private final List<Object> parameters;\n     private final Collection<String> bypassed;\n     private final PartitionNexusProxy proxy;\n     \n@@ -58,20 +55,7 @@\n      */\n     public Invocation( PartitionNexusProxy proxy, Context caller, String name )\n     {\n-        this( proxy, caller, name, null, EMPTY_STRING_SET );\n-    }\n-\n-\n-    /**\n-     * Creates a new instance.\n-     *\n-     * @param caller the JNDI {@link Context} that made this invocation\n-     * @param name the name of the called method\n-     * @param parameters the array of parameters passed to the called method\n-     */\n-    public Invocation( PartitionNexusProxy proxy, Context caller, String name, Object[] parameters )\n-    {\n-        this( proxy, caller, name, parameters, EMPTY_STRING_SET );\n+        this( proxy, caller, name, EMPTY_STRING_SET );\n     }\n \n \n@@ -83,8 +67,7 @@ public Invocation( PartitionNexusProxy proxy, Context caller, String name, Objec\n      * @param parameters the array of parameters passed to the called method\n      * @param bypassed the set of bypassed Interceptor names\n      */\n-    public Invocation( PartitionNexusProxy proxy, Context caller, String name, Object[] parameters,\n-        Collection<String> bypassed )\n+    public Invocation( PartitionNexusProxy proxy, Context caller, String name, Collection<String> bypassed )\n     {\n         if ( proxy == null )\n         {\n@@ -101,11 +84,6 @@ public Invocation( PartitionNexusProxy proxy, Context caller, String name, Objec\n             throw new NullPointerException( \"name\" );\n         }\n \n-        if ( parameters == null )\n-        {\n-            parameters = new Object[0];\n-        }\n-\n         if ( bypassed == null )\n         {\n             this.bypassed = EMPTY_STRING_SET;\n@@ -118,15 +96,6 @@ public Invocation( PartitionNexusProxy proxy, Context caller, String name, Objec\n         this.proxy = proxy;\n         this.caller = caller;\n         this.name = name;\n-\n-        List<Object> paramList = new ArrayList<Object>();\n-        \n-        for ( int i = 0; i < parameters.length; i++ )\n-        {\n-            paramList.add( parameters[i] );\n-        }\n-\n-        this.parameters = Collections.unmodifiableList( paramList );\n     }\n \n \n@@ -157,15 +126,6 @@ public String getName()\n     }\n \n \n-    /**\n-     * Returns the list of parameters parameters passed to the called method.\n-     */\n-    public List<Object> getParameters()\n-    {\n-        return parameters;\n-    }\n-\n-\n     /**\n      * Checks to see if an interceptor is bypassed.\n      *"
            },
            {
                "sha": "dbbcfc0a85d24b16f2dbca277fbbfb943034024e",
                "filename": "core/src/main/java/org/apache/directory/server/core/partition/PartitionNexusProxy.java",
                "status": "modified",
                "additions": 83,
                "deletions": 86,
                "changes": 169,
                "blob_url": "https://github.com/apache/directory-server/blob/1d92c47fdaff9e06686cb371f3591e134f18cb6b/core/src/main/java/org/apache/directory/server/core/partition/PartitionNexusProxy.java",
                "raw_url": "https://github.com/apache/directory-server/raw/1d92c47fdaff9e06686cb371f3591e134f18cb6b/core/src/main/java/org/apache/directory/server/core/partition/PartitionNexusProxy.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/partition/PartitionNexusProxy.java?ref=1d92c47fdaff9e06686cb371f3591e134f18cb6b",
                "patch": "@@ -40,11 +40,14 @@\n import org.apache.directory.server.core.authn.AuthenticationInterceptor;\n import org.apache.directory.server.core.authz.AciAuthorizationInterceptor;\n import org.apache.directory.server.core.authz.DefaultAuthorizationInterceptor;\n+import org.apache.directory.server.core.changelog.ChangeLogInterceptor;\n+import org.apache.directory.server.core.collective.CollectiveAttributeInterceptor;\n import org.apache.directory.server.core.entry.ServerEntry;\n import org.apache.directory.server.core.entry.ServerSearchResult;\n import org.apache.directory.server.core.enumeration.SearchResultFilter;\n import org.apache.directory.server.core.enumeration.SearchResultFilteringEnumeration;\n import org.apache.directory.server.core.event.EventInterceptor;\n+import org.apache.directory.server.core.exception.ExceptionInterceptor;\n import org.apache.directory.server.core.interceptor.InterceptorChain;\n import org.apache.directory.server.core.interceptor.context.AddContextPartitionOperationContext;\n import org.apache.directory.server.core.interceptor.context.AddOperationContext;\n@@ -79,7 +82,6 @@\n import org.apache.directory.shared.ldap.filter.ExprNode;\n import org.apache.directory.shared.ldap.name.LdapDN;\n \n-\n /**\n  * A decorator that wraps other {@link PartitionNexus} to enable\n  * {@link InterceptorChain} and {@link InvocationStack} support.\n@@ -106,6 +108,8 @@\n      * safe to use set of bypass instructions to lookup raw entries excluding operational attributes\n      */\n     public static final Collection<String> LOOKUP_EXCLUDING_OPR_ATTRS_BYPASS;\n+    \n+    public static final Collection<String> GET_ROOT_DSE_BYPASS;\n \n     /**\n      * Bypass String to use when ALL interceptors should be skipped\n@@ -186,6 +190,24 @@\n         c.add( EventInterceptor.class.getName() );\n         c.add( TriggerInterceptor.class.getName() );\n         LOOKUP_EXCLUDING_OPR_ATTRS_BYPASS = Collections.unmodifiableCollection( c );\n+        \n+        \n+        c = new HashSet<String>();\n+        c.add( NormalizationInterceptor.class.getName() );\n+        //c.add( AuthenticationInterceptor.class.getName() );\n+        c.add( ChangeLogInterceptor.class.getName() );\n+        c.add( ReferralInterceptor.class.getName() );\n+        c.add( AciAuthorizationInterceptor.class.getName() );\n+        c.add( DefaultAuthorizationInterceptor.class.getName() );\n+        c.add( ExceptionInterceptor.class.getName() );\n+        c.add( OperationalAttributeInterceptor.class.getName() );\n+        c.add( SchemaInterceptor.class.getName() );\n+        c.add( SubentryInterceptor.class.getName() );\n+        c.add( CollectiveAttributeInterceptor.class.getName() );\n+        c.add( EventInterceptor.class.getName() );\n+        c.add( TriggerInterceptor.class.getName() );\n+        GET_ROOT_DSE_BYPASS = Collections.unmodifiableCollection( c );\n+\n     }\n \n \n@@ -316,17 +338,15 @@ public LdapDN getMatchedName( GetMatchedNameOperationContext opContext ) throws\n     public LdapDN getMatchedName( GetMatchedNameOperationContext opContext, Collection<String> bypass ) throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        Object[] args = new Object[] {opContext};\n-        stack.push( new Invocation( this, caller, \"getMatchedName\", args, bypass ) );\n-\n+        opContext.push( new Invocation( this, caller, \"getMatchedName\", bypass ) );\n+        \n         try\n         {\n             return service.getInterceptorChain().getMatchedName( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n@@ -340,16 +360,15 @@ public LdapDN getSuffix( GetSuffixOperationContext opContext ) throws NamingExce\n     public LdapDN getSuffix( GetSuffixOperationContext opContext, Collection<String> bypass ) throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        Object[] args = new Object[] {opContext};\n-        stack.push( new Invocation( this, caller, \"getSuffixDn\", args, bypass ) );\n+        opContext.push( new Invocation( this, caller, \"getSuffixDn\", bypass ) );\n+        \n         try\n         {\n             return service.getInterceptorChain().getSuffix( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n@@ -363,16 +382,15 @@ public LdapDN getSuffix( GetSuffixOperationContext opContext, Collection<String>\n     public Iterator<String> listSuffixes( ListSuffixOperationContext opContext, Collection<String> bypass ) throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        Object[] args = new Object[] {};\n-        stack.push( new Invocation( this, caller, \"listSuffixes\", args, bypass ) );\n+        opContext.push( new Invocation( this, caller, \"listSuffices\", bypass ) );\n+        \n         try\n         {\n             return service.getInterceptorChain().listSuffixes( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n@@ -386,16 +404,15 @@ public boolean compare( CompareOperationContext opContext ) throws NamingExcepti\n     public boolean compare( CompareOperationContext opContext, Collection<String> bypass ) throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        stack.push( new Invocation( this, caller, \"compare\", new Object[]\n-                {opContext}, bypass ) );\n+        opContext.push( new Invocation( this, caller, \"compare\", bypass ) );\n+        \n         try\n         {\n             return service.getInterceptorChain().compare( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n@@ -409,16 +426,15 @@ public void delete( DeleteOperationContext opContext ) throws NamingException\n     public void delete( DeleteOperationContext opContext, Collection<String> bypass ) throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        stack.push( new Invocation( this, caller, \"delete\", new Object[]\n-                {opContext}, bypass ) );\n+        opContext.push( new Invocation( this, caller, \"delete\", bypass ) );\n+        \n         try\n         {\n             service.getInterceptorChain().delete( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n@@ -432,16 +448,15 @@ public void add( AddOperationContext opContext ) throws NamingException\n     public void add( AddOperationContext opContext, Collection<String> bypass ) throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        stack.push( new Invocation( this, caller, \"add\", new Object[]\n-                {opContext}, bypass ) );\n+        opContext.push( new Invocation( this, caller, \"add\", bypass ) );\n+        \n         try\n         {\n             service.getInterceptorChain().add( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n@@ -455,17 +470,15 @@ public void modify( ModifyOperationContext opContext ) throws NamingException\n     public void modify( ModifyOperationContext opContext, Collection<String> bypass ) throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        stack.push( new Invocation( this, caller, \"modify\", new Object[]\n-                {opContext}, bypass ) );\n-\n+        opContext.push( new Invocation( this, caller, \"modify\", bypass ) );\n+        \n         try\n         {\n             service.getInterceptorChain().modify( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n@@ -480,16 +493,15 @@ public void modify( ModifyOperationContext opContext, Collection<String> bypass\n             throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        stack.push( new Invocation( this, caller, \"list\", new Object[]\n-                {opContext}, bypass ) );\n+        opContext.push( new Invocation( this, caller, \"list\", bypass ) );\n+        \n         try\n         {\n             return service.getInterceptorChain().list( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n@@ -550,16 +562,15 @@ public boolean accept( Invocation invocation, ServerSearchResult result, SearchC\n             throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        stack.push( new Invocation( this, caller, \"search\", new Object[]\n-                {opContext}, bypass ) );\n+        opContext.push( new Invocation( this, caller, \"search\", bypass ) );\n+        \n         try\n         {\n             return service.getInterceptorChain().search( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n@@ -604,16 +615,15 @@ else if ( ( attrs.size() == 1 ) && ( attrs.contains( SchemaConstants.ALL_OPERATI\n     public ServerEntry lookup( LookupOperationContext opContext, Collection<String> bypass ) throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        stack.push( new Invocation( this, caller, \"lookup\", new Object[]\n-                {opContext}, bypass ) );\n+        opContext.push( new Invocation( this, caller, \"lookup\", bypass ) );\n+        \n         try\n         {\n             return service.getInterceptorChain().lookup( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n@@ -626,16 +636,15 @@ public boolean hasEntry( EntryOperationContext opContext ) throws NamingExceptio\n     public boolean hasEntry( EntryOperationContext opContext, Collection<String> bypass ) throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        stack.push( new Invocation( this, caller, \"hasEntry\", new Object[]\n-                {opContext}, bypass ) );\n+        opContext.push( new Invocation( this, caller, \"hasEntry\", bypass ) );\n+        \n         try\n         {\n             return service.getInterceptorChain().hasEntry( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n@@ -649,17 +658,15 @@ public void rename( RenameOperationContext opContext ) throws NamingException\n     public void rename( RenameOperationContext opContext, Collection<String> bypass ) throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        Object[] args = new Object[]\n-                {opContext};\n-        stack.push( new Invocation( this, caller, \"rename\", args, bypass ) );\n+        opContext.push( new Invocation( this, caller, \"rename\", bypass ) );\n+        \n         try\n         {\n             service.getInterceptorChain().rename( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n@@ -673,16 +680,15 @@ public void move( MoveOperationContext opContext ) throws NamingException\n     public void move( MoveOperationContext opContext, Collection<String> bypass ) throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        stack.push( new Invocation( this, caller, \"move\", new Object[]\n-                {opContext}, bypass ) );\n+        opContext.push( new Invocation( this, caller, \"move\", bypass ) );\n+        \n         try\n         {\n             service.getInterceptorChain().move( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n@@ -697,17 +703,15 @@ public void moveAndRename( MoveAndRenameOperationContext opContext, Collection<S\n             throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        Object[] args = new Object[]\n-                {opContext};\n-        stack.push( new Invocation( this, caller, \"moveAndRename\", args, bypass ) );\n+        opContext.push( new Invocation( this, caller, \"moveAndRename\", bypass ) );\n+        \n         try\n         {\n             service.getInterceptorChain().moveAndRename( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n@@ -722,36 +726,31 @@ public void bind( BindOperationContext opContext, Collection<String> bypass )\n             throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        Object[] args = new Object[]\n-                {opContext};\n-\n-        stack.push( new Invocation( this, caller, \"bind\", args, bypass ) );\n-\n+        opContext.push( new Invocation( this, caller, \"bind\", bypass ) );\n+        \n         try\n         {\n             service.getInterceptorChain().bind( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n+\n     public void unbind( UnbindOperationContext opContext, Collection<String> bypass ) throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        Object[] args = new Object[]\n-                {opContext};\n-        stack.push( new Invocation( this, caller, \"unbind\", args, bypass ) );\n+        opContext.push( new Invocation( this, caller, \"unbind\", bypass ) );\n+        \n         try\n         {\n             service.getInterceptorChain().unbind( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n@@ -776,30 +775,30 @@ public ServerEntry getRootDSE( GetRootDSEOperationContext opContext ) throws Nam\n             {\n                 if ( ROOT_DSE_ALL == null )\n                 {\n-                    ROOT_DSE_ALL = getRootDSE( null, null );\n+                    ROOT_DSE_ALL = getRootDSE( opContext, null );\n                 }\n             }\n \n             return ROOT_DSE_ALL;\n         }\n \n-        return getRootDSE( null, null );\n+        return getRootDSE( opContext, null );\n     }\n \n \n     public ServerEntry getRootDSE( GetRootDSEOperationContext opContext, Collection<String> bypass )\n             throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        stack.push( new Invocation( this, caller, \"getRootDSE\", null, bypass ) );\n+        opContext.push( new Invocation( this, caller, \"getRootDSE\", GET_ROOT_DSE_BYPASS ) );\n+        \n         try\n         {\n             return service.getInterceptorChain().getRootDSE( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n@@ -814,16 +813,15 @@ public void addContextPartition( AddContextPartitionOperationContext opContext,\n             throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        stack.push( new Invocation( this, caller, \"addContextPartition\", new Object[]\n-                {opContext}, bypass ) );\n+        opContext.push( new Invocation( this, caller, \"addContextPartition\", bypass ) );\n+        \n         try\n         {\n             service.getInterceptorChain().addContextPartition( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n \n@@ -838,16 +836,15 @@ public void removeContextPartition( RemoveContextPartitionOperationContext opCon\n             throws NamingException\n     {\n         ensureStarted();\n-        InvocationStack stack = InvocationStack.getInstance();\n-        stack.push( new Invocation( this, caller, \"removeContextPartition\", new Object[]\n-                {opContext}, bypass ) );\n+        opContext.push( new Invocation( this, caller, \"removeContextPartition\", bypass ) );\n+        \n         try\n         {\n             service.getInterceptorChain().removeContextPartition( opContext );\n         }\n         finally\n         {\n-            stack.pop();\n+            opContext.pop();\n         }\n     }\n "
            },
            {
                "sha": "908f02039ff7e4f96a136443a85a6acf5fd406ba",
                "filename": "core/src/test/java/org/apache/directory/server/core/interceptor/InterceptorChainTest.java",
                "status": "modified",
                "additions": 6,
                "deletions": 11,
                "changes": 17,
                "blob_url": "https://github.com/apache/directory-server/blob/1d92c47fdaff9e06686cb371f3591e134f18cb6b/core/src/test/java/org/apache/directory/server/core/interceptor/InterceptorChainTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/1d92c47fdaff9e06686cb371f3591e134f18cb6b/core/src/test/java/org/apache/directory/server/core/interceptor/InterceptorChainTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/test/java/org/apache/directory/server/core/interceptor/InterceptorChainTest.java?ref=1d92c47fdaff9e06686cb371f3591e134f18cb6b",
                "patch": "@@ -97,7 +97,7 @@ public void testNoBypass() throws NamingException\n         Context ctx = new DeadContext();\n         DirectoryService ds = new MockDirectoryService();\n         PartitionNexusProxy proxy = new PartitionNexusProxy( ctx, ds );\n-        Invocation i = new Invocation( proxy, ctx, \"lookup\", new Object[]{ dn } );\n+        Invocation i = new Invocation( proxy, ctx, \"lookup\" );\n         InvocationStack.getInstance().push( i );\n \n         try\n@@ -122,8 +122,7 @@ public void testSingleBypass() throws NamingException\n         Context ctx = new DeadContext();\n         DirectoryService ds = new MockDirectoryService();\n         PartitionNexusProxy proxy = new PartitionNexusProxy( ctx, ds );\n-        Invocation i = new Invocation( proxy, ctx, \"lookup\", new Object[]\n-            { dn }, Collections.singleton( \"0\" ) );\n+        Invocation i = new Invocation( proxy, ctx, \"lookup\", Collections.singleton( \"0\" ) );\n         InvocationStack.getInstance().push( i );\n \n         try\n@@ -151,8 +150,7 @@ public void testAdjacentDoubleBypass() throws NamingException\n         Set<String> bypass = new HashSet<String>();\n         bypass.add( \"0\" );\n         bypass.add( \"1\" );\n-        Invocation i = new Invocation( proxy, ctx, \"lookup\", new Object[]\n-            { dn }, bypass );\n+        Invocation i = new Invocation( proxy, ctx, \"lookup\", bypass );\n         InvocationStack.getInstance().push( i );\n \n         try\n@@ -180,8 +178,7 @@ public void testFrontAndBackDoubleBypass() throws NamingException\n         Set<String> bypass = new HashSet<String>();\n         bypass.add( \"0\" );\n         bypass.add( \"4\" );\n-        Invocation i = new Invocation( proxy, ctx, \"lookup\", new Object[]\n-            { dn }, bypass );\n+        Invocation i = new Invocation( proxy, ctx, \"lookup\", bypass );\n         InvocationStack.getInstance().push( i );\n \n         try\n@@ -208,8 +205,7 @@ public void testDoubleBypass() throws NamingException\n         Set<String> bypass = new HashSet<String>();\n         bypass.add( \"1\" );\n         bypass.add( \"3\" );\n-        Invocation i = new Invocation( proxy, ctx, \"lookup\", new Object[]\n-            { dn }, bypass );\n+        Invocation i = new Invocation( proxy, ctx, \"lookup\", bypass );\n         InvocationStack.getInstance().push( i );\n \n         try\n@@ -233,8 +229,7 @@ public void testCompleteBypass() throws NamingException\n         Context ctx = new DeadContext();\n         DirectoryService ds = new MockDirectoryService();\n         PartitionNexusProxy proxy = new PartitionNexusProxy( ctx, ds );\n-        Invocation i = new Invocation( proxy, ctx, \"lookup\", new Object[]\n-            { dn }, PartitionNexusProxy.BYPASS_ALL_COLLECTION );\n+        Invocation i = new Invocation( proxy, ctx, \"lookup\", PartitionNexusProxy.BYPASS_ALL_COLLECTION );\n         InvocationStack.getInstance().push( i );\n \n         try"
            },
            {
                "sha": "60528782c2a9f984ec6a4514740520a728d83f6b",
                "filename": "pom.xml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/1d92c47fdaff9e06686cb371f3591e134f18cb6b/pom.xml",
                "raw_url": "https://github.com/apache/directory-server/raw/1d92c47fdaff9e06686cb371f3591e134f18cb6b/pom.xml",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/pom.xml?ref=1d92c47fdaff9e06686cb371f3591e134f18cb6b",
                "patch": "@@ -343,7 +343,7 @@\n     <module>jdbm-store</module>\n     <module>btree-base</module>\n     <module>core</module>\n-    <!-- module>core-jndi</module -->\n+    <!--module>core-jndi</module-->\n     <module>core-constants</module>\n     <module>core-shared</module>\n     <module>core-plugin</module>"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/a220b1d54a52984193fd9923c5c33d32f535e804",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/8bcee7a23047fc9a2784bdb6a8bda8bf02e4ba60",
        "message": "changes ...\n\n o fixed NPE when izpack target parameters were null (not set in config)\n o fixed issue with LICENSE.txt not being present: hmm gota use bundled one\n   rather than doing a touch on it to have empty license.\n o fixed shell script template for stop command\n o removed infinte while loop in boostrapper init()\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/trunks/apacheds@372421 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_111",
        "file": [
            {
                "sha": "6f9e05424b637493819a1a3027b437b5faa8bb67",
                "filename": "standalone/daemon/src/main/java/org/apache/directory/server/standalone/daemon/Bootstrapper.java",
                "status": "modified",
                "additions": 0,
                "deletions": 14,
                "changes": 14,
                "blob_url": "https://github.com/apache/directory-server/blob/a220b1d54a52984193fd9923c5c33d32f535e804/standalone/daemon/src/main/java/org/apache/directory/server/standalone/daemon/Bootstrapper.java",
                "raw_url": "https://github.com/apache/directory-server/raw/a220b1d54a52984193fd9923c5c33d32f535e804/standalone/daemon/src/main/java/org/apache/directory/server/standalone/daemon/Bootstrapper.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/standalone/daemon/src/main/java/org/apache/directory/server/standalone/daemon/Bootstrapper.java?ref=a220b1d54a52984193fd9923c5c33d32f535e804",
                "patch": "@@ -246,20 +246,6 @@ public void init( String[] args )\n         }\n         \n         callInit( bootstrapProperties.getProperty( BOOTSTRAP_START_CLASS_PROP, null ) );\n-        \n-        while( true )\n-        {\n-            try\n-            {\n-                Thread.sleep( 2000 );\n-            }\n-            catch ( InterruptedException e )\n-            {\n-                e.printStackTrace();\n-            }\n-\n-            log.debug( \"tick-tock\" );\n-        }\n     }\n     \n     "
            },
            {
                "sha": "82ec6fa72c83f3c310718505d8559d7819363484",
                "filename": "standalone/installers/plugin/src/main/java/org/apache/directory/server/standalone/installers/CreateImageCommand.java",
                "status": "modified",
                "additions": 10,
                "deletions": 1,
                "changes": 11,
                "blob_url": "https://github.com/apache/directory-server/blob/a220b1d54a52984193fd9923c5c33d32f535e804/standalone/installers/plugin/src/main/java/org/apache/directory/server/standalone/installers/CreateImageCommand.java",
                "raw_url": "https://github.com/apache/directory-server/raw/a220b1d54a52984193fd9923c5c33d32f535e804/standalone/installers/plugin/src/main/java/org/apache/directory/server/standalone/installers/CreateImageCommand.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/standalone/installers/plugin/src/main/java/org/apache/directory/server/standalone/installers/CreateImageCommand.java?ref=a220b1d54a52984193fd9923c5c33d32f535e804",
                "patch": "@@ -24,6 +24,8 @@\n import org.apache.directory.server.standalone.daemon.InstallationLayout;\n import org.apache.maven.plugin.MojoExecutionException;\n import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.tools.ant.Project;\n+import org.apache.tools.ant.taskdefs.Touch;\n import org.codehaus.plexus.util.FileUtils;\n \n \n@@ -92,9 +94,9 @@ public void execute() throws MojoExecutionException, MojoFailureException\n         }\n         \n         // copy over the license file if present otherwise use the bundled copy\n+        File licenseTarget = layout.getLicenseFile( mymojo.getLicenseFile().getName() );\n         if ( mymojo.getLicenseFile().exists() )\n         {\n-            File licenseTarget = layout.getLicenseFile( mymojo.getLicenseFile().getName() );\n             try\n             {\n                 FileUtils.copyFile( mymojo.getLicenseFile(), licenseTarget );\n@@ -105,6 +107,13 @@ public void execute() throws MojoExecutionException, MojoFailureException\n                     + \" into position \" + licenseTarget );\n             }\n         }\n+        else\n+        {\n+            Touch task = new Touch();\n+            task.setProject( new Project() );\n+            task.setFile( licenseTarget );\n+            task.execute();\n+        }\n         \n         // copy over the license file if present otherwise use the bundled copy\n         File iconTarget = layout.getLogoIconFile( mymojo.getApplicationIcon().getName() );"
            },
            {
                "sha": "527fa8ef658979466269bbf1810a147978c02402",
                "filename": "standalone/installers/plugin/src/main/java/org/apache/directory/server/standalone/installers/izpack/IzPackInstallerCommand.java",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/apache/directory-server/blob/a220b1d54a52984193fd9923c5c33d32f535e804/standalone/installers/plugin/src/main/java/org/apache/directory/server/standalone/installers/izpack/IzPackInstallerCommand.java",
                "raw_url": "https://github.com/apache/directory-server/raw/a220b1d54a52984193fd9923c5c33d32f535e804/standalone/installers/plugin/src/main/java/org/apache/directory/server/standalone/installers/izpack/IzPackInstallerCommand.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/standalone/installers/plugin/src/main/java/org/apache/directory/server/standalone/installers/izpack/IzPackInstallerCommand.java?ref=a220b1d54a52984193fd9923c5c33d32f535e804",
                "patch": "@@ -105,7 +105,7 @@ private void doIzPackFiles() throws MojoFailureException\n         if ( target.getOsFamily().equals( \"windows\" ) )\n         {\n             // handle the installer file\n-            if ( target.getIzPackInstallFile().exists() )\n+            if ( target.getIzPackInstallFile() != null && target.getIzPackInstallFile().exists() )\n             {\n                 try\n                 {\n@@ -146,7 +146,7 @@ private void doIzPackFiles() throws MojoFailureException\n             }\n \n             // handle the windows shortcuts file \n-            if ( target.getIzPackShortcutsWindowsFile().exists() )\n+            if ( target.getIzPackShortcutsWindowsFile() != null && target.getIzPackShortcutsWindowsFile().exists() )\n             {\n                 try\n                 {\n@@ -201,7 +201,7 @@ private void doIzPackFiles() throws MojoFailureException\n         }\n         else if ( target.getOsFamily().equals( \"unix\" ) || target.getOsFamily().equals( \"mac\" ) )\n         {\n-            if ( target.getIzPackInstallFile().exists() )\n+            if ( target.getIzPackInstallFile() != null && target.getIzPackInstallFile().exists() )\n             {\n                 try\n                 {\n@@ -242,7 +242,7 @@ else if ( target.getOsFamily().equals( \"unix\" ) || target.getOsFamily().equals(\n                 }\n             }\n \n-            if ( target.getIzPackShortcutsUnixFile().exists() )\n+            if ( target.getIzPackShortcutsUnixFile() != null && target.getIzPackShortcutsUnixFile().exists() )\n             {\n                 try\n                 {\n@@ -296,7 +296,7 @@ else if ( target.getOsFamily().equals( \"unix\" ) || target.getOsFamily().equals(\n             }\n         }\n \n-        if ( target.getIzPackUserInputFile().exists() )\n+        if ( target.getIzPackUserInputFile() != null && target.getIzPackUserInputFile().exists() )\n         {\n             try\n             {"
            },
            {
                "sha": "712a2525cb619ee216319f2196129afb3eec3b9a",
                "filename": "standalone/installers/plugin/src/main/resources/org/apache/directory/server/standalone/installers/template.init",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/apache/directory-server/blob/a220b1d54a52984193fd9923c5c33d32f535e804/standalone/installers/plugin/src/main/resources/org/apache/directory/server/standalone/installers/template.init",
                "raw_url": "https://github.com/apache/directory-server/raw/a220b1d54a52984193fd9923c5c33d32f535e804/standalone/installers/plugin/src/main/resources/org/apache/directory/server/standalone/installers/template.init",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/standalone/installers/plugin/src/main/resources/org/apache/directory/server/standalone/installers/template.init?ref=a220b1d54a52984193fd9923c5c33d32f535e804",
                "patch": "@@ -168,6 +168,7 @@ case \"$1\" in\n     # Stop ${app}\n     #\n     echo -n $\"Shutting down $prog: \"\n+    RETVAL=0\n \n     $DAEMON_HOME/${app} \\\n     -stop \\"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/b696783ca116be74d06369e6a99fcf7c5da36839",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/18d5101e9177af1656ed0ccb2fa689874bd5d31b",
        "message": "making sasl ntlm and gss-spengo work\n\n o the shared sasl server for these mechanisms now sets the principal into the\n   session which is what is expected - this prevents a NPE from be thrown\n o the shared sasl server needs access to the bind request and the session \n o added simple client for some pass thru plumbing tests without actually using\n   a valid NTLM provider of which all options are LGPL at this point\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/branches/bigbang@654367 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_112",
        "file": [
            {
                "sha": "6ffba1d9c6907696f7bbede1110466d3af00d835",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/ntlm/NtlmMechanismHandler.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/b696783ca116be74d06369e6a99fcf7c5da36839/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/ntlm/NtlmMechanismHandler.java",
                "raw_url": "https://github.com/apache/directory-server/raw/b696783ca116be74d06369e6a99fcf7c5da36839/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/ntlm/NtlmMechanismHandler.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/ntlm/NtlmMechanismHandler.java?ref=b696783ca116be74d06369e6a99fcf7c5da36839",
                "patch": "@@ -69,7 +69,7 @@ public SaslServer handleMechanism( IoSession session, BindRequest bindRequest )\n                 initProvider();\n             }\n             \n-            ss = new NtlmSaslServer( provider );\n+            ss = new NtlmSaslServer( provider, bindRequest, session );\n             session.setAttribute( SASL_CONTEXT, ss );\n         }\n "
            },
            {
                "sha": "6e43d2463ad7802ccbd8cbb26a4ab17eaa255596",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/ntlm/NtlmSaslServer.java",
                "status": "modified",
                "additions": 13,
                "deletions": 2,
                "changes": 15,
                "blob_url": "https://github.com/apache/directory-server/blob/b696783ca116be74d06369e6a99fcf7c5da36839/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/ntlm/NtlmSaslServer.java",
                "raw_url": "https://github.com/apache/directory-server/raw/b696783ca116be74d06369e6a99fcf7c5da36839/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/ntlm/NtlmSaslServer.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/bind/ntlm/NtlmSaslServer.java?ref=b696783ca116be74d06369e6a99fcf7c5da36839",
                "patch": "@@ -21,7 +21,10 @@\n \n \n import org.apache.directory.shared.ldap.constants.SupportedSaslMechanisms;\n+import org.apache.directory.shared.ldap.message.BindRequest;\n+import org.apache.mina.common.IoSession;\n \n+import javax.naming.Context;\n import javax.security.sasl.SaslServer;\n import javax.security.sasl.SaslException;\n \n@@ -40,10 +43,14 @@\n \n     private NegotiationState state = NegotiationState.INITIALIZED;\n     private final NtlmProvider provider;\n+    private final BindRequest request;\n+    private final IoSession session;\n \n-\n-    public NtlmSaslServer( NtlmProvider provider )\n+    \n+    public NtlmSaslServer( NtlmProvider provider, BindRequest request, IoSession session )\n     {\n+        this.session = session;\n+        this.request = request;\n         this.provider = provider;\n     }\n \n@@ -82,10 +89,12 @@ protected void responseSent()\n                 throw new IllegalStateException( \"Cannot send Type 2 challenge before Type 1 response.\" );\n             case TYPE_1_RECEIVED:\n                 state = NegotiationState.TYPE_2_SENT;\n+                break;\n             case TYPE_2_SENT:\n                 throw new IllegalStateException( \"Cannot send Type 2 after it's already sent.\" );\n             case TYPE_3_RECEIVED:\n                 state = NegotiationState.COMPLETED;\n+                break;\n             case COMPLETED:\n                 throw new IllegalStateException( \"Sasl challenge response already completed.\" );\n         }\n@@ -124,6 +133,8 @@ protected void responseSent()\n                 try\n                 {\n                     result = provider.authenticate( response );\n+                    retval = result.getResponse();\n+                    session.setAttribute( Context.SECURITY_PRINCIPAL, request.getName().toString() );\n                 }\n                 catch ( Exception e )\n                 {"
            },
            {
                "sha": "d0bc63feb19b0cd31e6e9a13c8cb4e951b406fcd",
                "filename": "server-unit/src/main/java/org/apache/directory/server/unit/AbstractServerTest.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/apache/directory-server/blob/b696783ca116be74d06369e6a99fcf7c5da36839/server-unit/src/main/java/org/apache/directory/server/unit/AbstractServerTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/b696783ca116be74d06369e6a99fcf7c5da36839/server-unit/src/main/java/org/apache/directory/server/unit/AbstractServerTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-unit/src/main/java/org/apache/directory/server/unit/AbstractServerTest.java?ref=b696783ca116be74d06369e6a99fcf7c5da36839",
                "patch": "@@ -254,8 +254,11 @@ protected void setUp() throws Exception\n         directoryService.startup();\n \n         configureLdapServer();\n+\n+        // TODO shouldn't this be before calling configureLdapServer() ???\n         ldapServer.addExtendedOperationHandler( new StartTlsHandler() );\n         ldapServer.addExtendedOperationHandler( new StoredProcedureExtendedOperationHandler() );\n+\n         ldapServer.start();\n         setContexts( ServerDNConstants.ADMIN_SYSTEM_DN, \"secret\" );\n     }"
            },
            {
                "sha": "715fc6bd980de62ec7f2d03f6305957ded92914d",
                "filename": "server-unit/src/test/java/org/apache/directory/server/SaslBindITest.java",
                "status": "modified",
                "additions": 197,
                "deletions": 1,
                "changes": 198,
                "blob_url": "https://github.com/apache/directory-server/blob/b696783ca116be74d06369e6a99fcf7c5da36839/server-unit/src/test/java/org/apache/directory/server/SaslBindITest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/b696783ca116be74d06369e6a99fcf7c5da36839/server-unit/src/test/java/org/apache/directory/server/SaslBindITest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/server-unit/src/test/java/org/apache/directory/server/SaslBindITest.java?ref=b696783ca116be74d06369e6a99fcf7c5da36839",
                "patch": "@@ -20,17 +20,30 @@\n package org.apache.directory.server;\n \n \n+import org.apache.commons.lang.ArrayUtils;\n+import org.apache.commons.net.SocketClient;\n import org.apache.directory.server.core.entry.DefaultServerEntry;\n import org.apache.directory.server.core.entry.ServerEntry;\n import org.apache.directory.server.core.partition.Partition;\n import org.apache.directory.server.core.partition.impl.btree.Index;\n import org.apache.directory.server.core.partition.impl.btree.jdbm.JdbmIndex;\n import org.apache.directory.server.core.partition.impl.btree.jdbm.JdbmPartition;\n+import org.apache.directory.server.ldap.handlers.bind.ntlm.NtlmAuthenticationResult;\n+import org.apache.directory.server.ldap.handlers.bind.ntlm.NtlmMechanismHandler;\n+import org.apache.directory.server.ldap.handlers.bind.ntlm.NtlmProvider;\n import org.apache.directory.server.unit.AbstractServerTest;\n import org.apache.directory.shared.ldap.message.AttributeImpl;\n import org.apache.directory.shared.ldap.message.AttributesImpl;\n+import org.apache.directory.shared.ldap.message.BindRequestImpl;\n+import org.apache.directory.shared.ldap.message.BindResponse;\n+import org.apache.directory.shared.ldap.message.MessageDecoder;\n+import org.apache.directory.shared.ldap.message.MessageEncoder;\n+import org.apache.directory.shared.ldap.message.ResultCodeEnum;\n+import org.apache.directory.shared.ldap.message.spi.BinaryAttributeDetector;\n import org.apache.directory.shared.ldap.name.LdapDN;\n import org.apache.directory.shared.ldap.constants.SupportedSaslMechanisms;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n \n import javax.naming.Context;\n import javax.naming.NamingEnumeration;\n@@ -39,6 +52,7 @@\n import javax.naming.directory.Attributes;\n import javax.naming.directory.DirContext;\n import javax.naming.directory.InitialDirContext;\n+\n import java.util.HashSet;\n import java.util.Hashtable;\n import java.util.Set;\n@@ -53,7 +67,9 @@\n  */\n public class SaslBindITest extends AbstractServerTest\n {\n+    private static final Logger LOG = LoggerFactory.getLogger( SaslBindITest.class );\n     private DirContext ctx;\n+    private BogusNtlmProvider provider;\n \n \n     /**\n@@ -62,6 +78,7 @@\n      */\n     public void setUp() throws Exception\n     {\n+        provider = new BogusNtlmProvider();\n         super.setUp();\n         setAllowAnonymousAccess( false );\n \n@@ -85,7 +102,6 @@ public void setUp() throws Exception\n     @Override\n     protected void configureDirectoryService() throws NamingException\n     {\n-\n         Set<Partition> partitions = new HashSet<Partition>();\n         JdbmPartition partition = new JdbmPartition();\n         partition.setId( \"example\" );\n@@ -114,8 +130,17 @@ protected void configureDirectoryService() throws NamingException\n     protected void configureLdapServer()\n     {\n         ldapServer.setSaslHost( \"localhost\" );\n+        \n+        NtlmMechanismHandler ntlmMechanismHandler = new NtlmMechanismHandler();\n+        ntlmMechanismHandler.setNtlmProvider( provider  );\n+        \n+        ldapServer.removeSaslMechanismHandler( SupportedSaslMechanisms.NTLM );\n+        ldapServer.addSaslMechanismHandler( SupportedSaslMechanisms.NTLM, ntlmMechanismHandler );\n+        ldapServer.removeSaslMechanismHandler( SupportedSaslMechanisms.GSS_SPNEGO );\n+        ldapServer.addSaslMechanismHandler( SupportedSaslMechanisms.GSS_SPNEGO, ntlmMechanismHandler );\n     }\n \n+    \n     /**\n      * Tear down.\n      */\n@@ -495,4 +520,175 @@ public void testSaslCramMd5BindBadPassword()\n             assertTrue( e.getMessage().contains( \"Invalid response\" ) );\n         }\n     }\n+\n+\n+    /**\n+     * Tests that the plumbing for NTLM bind works.\n+     */\n+    public void testNtlmBind() throws Exception\n+    {\n+        NtlmSaslBindClient client = new NtlmSaslBindClient( SupportedSaslMechanisms.NTLM );\n+        BindResponse type2response = client.bindType1( \"type1_test\".getBytes() );\n+        assertEquals( 1, type2response.getMessageId() );\n+        assertEquals( ResultCodeEnum.SASL_BIND_IN_PROGRESS, type2response.getLdapResult().getResultCode() );\n+        assertTrue( ArrayUtils.isEquals( \"type1_test\".getBytes(), provider.getType1Response() ) );\n+        assertTrue( ArrayUtils.isEquals( \"challenge\".getBytes(), type2response.getServerSaslCreds() ) );\n+        \n+        BindResponse finalResponse = client.bindType3( \"type3_test\".getBytes() );\n+        assertEquals( 2, finalResponse.getMessageId() );\n+        assertEquals( ResultCodeEnum.SUCCESS, finalResponse.getLdapResult().getResultCode() );\n+        assertTrue( ArrayUtils.isEquals( \"type3_test\".getBytes(), provider.getType3Response() ) );\n+        assertTrue( ArrayUtils.isEquals( \"results\".getBytes(), finalResponse.getServerSaslCreds() ) );\n+    }\n+\n+\n+    /**\n+     * Tests that the plumbing for NTLM bind works.\n+     */\n+    public void testGssSpnegoBind() throws Exception\n+    {\n+        NtlmSaslBindClient client = new NtlmSaslBindClient( SupportedSaslMechanisms.GSS_SPNEGO );\n+        BindResponse type2response = client.bindType1( \"type1_test\".getBytes() );\n+        assertEquals( 1, type2response.getMessageId() );\n+        assertEquals( ResultCodeEnum.SASL_BIND_IN_PROGRESS, type2response.getLdapResult().getResultCode() );\n+        assertTrue( ArrayUtils.isEquals( \"type1_test\".getBytes(), provider.getType1Response() ) );\n+        assertTrue( ArrayUtils.isEquals( \"challenge\".getBytes(), type2response.getServerSaslCreds() ) );\n+        \n+        BindResponse finalResponse = client.bindType3( \"type3_test\".getBytes() );\n+        assertEquals( 2, finalResponse.getMessageId() );\n+        assertEquals( ResultCodeEnum.SUCCESS, finalResponse.getLdapResult().getResultCode() );\n+        assertTrue( ArrayUtils.isEquals( \"type3_test\".getBytes(), provider.getType3Response() ) );\n+        assertTrue( ArrayUtils.isEquals( \"results\".getBytes(), finalResponse.getServerSaslCreds() ) );\n+    }\n+\n+\n+    class BogusNtlmProvider implements NtlmProvider\n+    {\n+        private byte[] type1response;\n+        private byte[] type3response;\n+        \n+        \n+        public NtlmAuthenticationResult authenticate( byte[] type3response ) throws Exception\n+        {\n+            this.type3response = type3response;\n+            return new NtlmAuthenticationResult( \"results\".getBytes(), true );\n+        }\n+\n+\n+        public byte[] generateChallenge( byte[] type1reponse ) throws Exception\n+        {\n+            this.type1response = type1reponse;\n+            return \"challenge\".getBytes();\n+        }\n+        \n+        \n+        public byte[] getType1Response()\n+        {\n+            return type1response;\n+        }\n+        \n+        \n+        public byte[] getType3Response()\n+        {\n+            return type3response;\n+        }\n+    }\n+\n+\n+    class NtlmSaslBindClient extends SocketClient\n+    {\n+        private final String mechanism;\n+        \n+        \n+        NtlmSaslBindClient( String mechanism ) throws Exception\n+        {\n+            this.mechanism = mechanism;\n+            setDefaultPort( port );\n+            connect( \"localhost\", port );\n+            setTcpNoDelay( false );\n+            \n+            LOG.debug( \"isConnected() = {}\", _isConnected_ );\n+            LOG.debug( \"LocalPort     = {}\", getLocalPort() );\n+            LOG.debug( \"LocalAddress  = {}\", getLocalAddress() );\n+            LOG.debug( \"RemotePort    = {}\", getRemotePort() );\n+            LOG.debug( \"RemoteAddress = {}\", getRemoteAddress() );\n+        }\n+\n+        \n+        BindResponse bindType1( byte[] type1response ) throws Exception\n+        {\n+            if ( ! isConnected() )\n+            {\n+                throw new IllegalStateException( \"Client is not connected.\" );\n+            }\n+            \n+            // Setup the bind request\n+            BindRequestImpl request = new BindRequestImpl( 1 ) ;\n+            request.setName( new LdapDN( \"uid=admin,ou=system\" ) ) ;\n+            request.setSimple( false ) ;\n+            request.setCredentials( type1response ) ;\n+            request.setSaslMechanism( mechanism );\n+            request.setVersion3( true ) ;\n+            \n+            // Setup the ASN1 Enoder and Decoder\n+            MessageEncoder encoder = new MessageEncoder();\n+            MessageDecoder decoder = new MessageDecoder( new BinaryAttributeDetector() {\n+                public boolean isBinary( String attributeId )\n+                {\n+                    return false;\n+                }\n+            } );\n+     \n+            // Send encoded request to server\n+            encoder.encodeBlocking( null, _output_, request );\n+            _output_.flush();\n+            \n+            while ( _input_.available() <= 0 )\n+            {\n+                Thread.sleep( 100 );\n+            }\n+            \n+            // Retrieve the response back from server to my last request.\n+            return ( BindResponse ) decoder.decode( null, _input_ );\n+        }\n+        \n+        \n+        BindResponse bindType3( byte[] type3response ) throws Exception\n+        {\n+            if ( ! isConnected() )\n+            {\n+                throw new IllegalStateException( \"Client is not connected.\" );\n+            }\n+            \n+            // Setup the bind request\n+            BindRequestImpl request = new BindRequestImpl( 2 ) ;\n+            request.setName( new LdapDN( \"uid=admin,ou=system\" ) ) ;\n+            request.setSimple( false ) ;\n+            request.setCredentials( type3response ) ;\n+            request.setSaslMechanism( mechanism );\n+            request.setVersion3( true ) ;\n+            \n+            // Setup the ASN1 Enoder and Decoder\n+            MessageEncoder encoder = new MessageEncoder();\n+            MessageDecoder decoder = new MessageDecoder( new BinaryAttributeDetector() {\n+                public boolean isBinary( String attributeId )\n+                {\n+                    return false;\n+                }\n+            } );\n+     \n+            // Send encoded request to server\n+            encoder.encodeBlocking( null, _output_, request );\n+            \n+            _output_.flush();\n+            \n+            while ( _input_.available() <= 0 )\n+            {\n+                Thread.sleep( 100 );\n+            }\n+            \n+            // Retrieve the response back from server to my last request.\n+            return ( BindResponse ) decoder.decode( null, _input_ );\n+        }\n+    }\n }"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/e1d020a39cd5ba602285c15c8032620cda6588ba",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/07e18b2dd2120e2e789a60fa03764770c1a050e2",
        "message": "Further test-driven improvements to protocol-kerberos:\no  Added 7 new tests to Authentication Service (AS) coverage.\no  Added 12 new tests to Ticket-Granting Service (TGS) coverage.\no  Added more robust (anti-NPE) checks for client addresses during ticket generation.\no  Improved comments.\no  Switched to a shorter, more encapsulated form of getting and setting options.\no  Added missing policy checks to TGS per RFC 4120.\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@560081 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_113",
        "file": [
            {
                "sha": "55946905b4780a28652004ee907c572332b460a6",
                "filename": "protocol-kerberos/src/main/java/org/apache/directory/server/kerberos/kdc/authentication/GenerateTicket.java",
                "status": "modified",
                "additions": 21,
                "deletions": 29,
                "changes": 50,
                "blob_url": "https://github.com/apache/directory-server/blob/e1d020a39cd5ba602285c15c8032620cda6588ba/protocol-kerberos/src/main/java/org/apache/directory/server/kerberos/kdc/authentication/GenerateTicket.java",
                "raw_url": "https://github.com/apache/directory-server/raw/e1d020a39cd5ba602285c15c8032620cda6588ba/protocol-kerberos/src/main/java/org/apache/directory/server/kerberos/kdc/authentication/GenerateTicket.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-kerberos/src/main/java/org/apache/directory/server/kerberos/kdc/authentication/GenerateTicket.java?ref=e1d020a39cd5ba602285c15c8032620cda6588ba",
                "patch": "@@ -81,7 +81,7 @@ public void execute( NextCommand next, IoSession session, Object message ) throw\n             newTicketBody.setFlag( TicketFlags.PRE_AUTHENT );\n         }\n \n-        if ( request.getKdcOptions().get( KdcOptions.FORWARDABLE ) )\n+        if ( request.getOption( KdcOptions.FORWARDABLE ) )\n         {\n             if ( !config.isForwardableAllowed() )\n             {\n@@ -91,7 +91,7 @@ public void execute( NextCommand next, IoSession session, Object message ) throw\n             newTicketBody.setFlag( TicketFlags.FORWARDABLE );\n         }\n \n-        if ( request.getKdcOptions().get( KdcOptions.PROXIABLE ) )\n+        if ( request.getOption( KdcOptions.PROXIABLE ) )\n         {\n             if ( !config.isProxiableAllowed() )\n             {\n@@ -101,7 +101,7 @@ public void execute( NextCommand next, IoSession session, Object message ) throw\n             newTicketBody.setFlag( TicketFlags.PROXIABLE );\n         }\n \n-        if ( request.getKdcOptions().get( KdcOptions.ALLOW_POSTDATE ) )\n+        if ( request.getOption( KdcOptions.ALLOW_POSTDATE ) )\n         {\n             if ( !config.isPostdateAllowed() )\n             {\n@@ -111,9 +111,9 @@ public void execute( NextCommand next, IoSession session, Object message ) throw\n             newTicketBody.setFlag( TicketFlags.MAY_POSTDATE );\n         }\n \n-        if ( request.getKdcOptions().get( KdcOptions.RENEW ) || request.getKdcOptions().get( KdcOptions.VALIDATE )\n-            || request.getKdcOptions().get( KdcOptions.PROXY ) || request.getKdcOptions().get( KdcOptions.FORWARDED )\n-            || request.getKdcOptions().get( KdcOptions.ENC_TKT_IN_SKEY ) )\n+        if ( request.getOption( KdcOptions.RENEW ) || request.getOption( KdcOptions.VALIDATE )\n+            || request.getOption( KdcOptions.PROXY ) || request.getOption( KdcOptions.FORWARDED )\n+            || request.getOption( KdcOptions.ENC_TKT_IN_SKEY ) )\n         {\n             throw new KerberosException( ErrorType.KDC_ERR_BADOPTION );\n         }\n@@ -137,7 +137,7 @@ public void execute( NextCommand next, IoSession session, Object message ) throw\n          * ticket is set to the authentication server's current time.\"\n          */\n         if ( startTime == null || startTime.lessThan( now ) || startTime.isInClockSkew( config.getAllowableClockSkew() )\n-            && !request.getKdcOptions().get( KdcOptions.POSTDATED ) )\n+            && !request.getOption( KdcOptions.POSTDATED ) )\n         {\n             startTime = now;\n         }\n@@ -148,8 +148,7 @@ public void execute( NextCommand next, IoSession session, Object message ) throw\n          * KDC_ERR_CANNOT_POSTDATE is returned.\"\n          */\n         if ( startTime != null && startTime.greaterThan( now )\n-            && !startTime.isInClockSkew( config.getAllowableClockSkew() )\n-            && !request.getKdcOptions().get( KdcOptions.POSTDATED ) )\n+            && !startTime.isInClockSkew( config.getAllowableClockSkew() ) && !request.getOption( KdcOptions.POSTDATED ) )\n         {\n             throw new KerberosException( ErrorType.KDC_ERR_CANNOT_POSTDATE );\n         }\n@@ -159,7 +158,7 @@ public void execute( NextCommand next, IoSession session, Object message ) throw\n          * local realm and if the ticket's starttime is acceptable, it is set as\n          * requested, and the INVALID flag is set in the new ticket.\"\n          */\n-        if ( request.getKdcOptions().get( KdcOptions.POSTDATED ) )\n+        if ( request.getOption( KdcOptions.POSTDATED ) )\n         {\n             if ( !config.isPostdateAllowed() )\n             {\n@@ -182,10 +181,8 @@ public void execute( NextCommand next, IoSession session, Object message ) throw\n         }\n \n         /*\n-         new_tkt.endtime := min(till,\n-         new_tkt.starttime+client.max_life,\n-         new_tkt.starttime+server.max_life,\n-         new_tkt.starttime+max_life_for_realm);\n+         * The end time is the minimum of (a) the requested till time or (b)\n+         * the start time plus maximum lifetime as configured in policy.\n          */\n         long endTime = Math.min( till, startTime.getTime() + config.getMaximumTicketLifetime() );\n         KerberosTime kerberosEndTime = new KerberosTime( endTime );\n@@ -215,29 +212,18 @@ public void execute( NextCommand next, IoSession session, Object message ) throw\n          */\n         KerberosTime tempRtime = request.getRtime();\n \n-        if ( request.getKdcOptions().get( KdcOptions.RENEWABLE_OK ) && request.getTill().greaterThan( kerberosEndTime ) )\n+        if ( request.getOption( KdcOptions.RENEWABLE_OK ) && request.getTill().greaterThan( kerberosEndTime ) )\n         {\n             if ( !config.isRenewableAllowed() )\n             {\n                 throw new KerberosException( ErrorType.KDC_ERR_POLICY );\n             }\n \n-            request.getKdcOptions().set( KdcOptions.RENEWABLE );\n+            request.setOption( KdcOptions.RENEWABLE );\n             tempRtime = request.getTill();\n         }\n \n-        /*\n-         if (req.kdc-options.RENEWABLE is set) then\n-         set new_tkt.flags.RENEWABLE;\n-         new_tkt.renew-till := min(rtime,\n-         new_tkt.starttime+client.max_rlife,\n-         new_tkt.starttime+server.max_rlife,\n-         new_tkt.starttime+max_rlife_for_realm);\n-         else\n-         omit new_tkt.renew-till;\n-         endif\n-         */\n-        if ( request.getKdcOptions().get( KdcOptions.RENEWABLE ) )\n+        if ( request.getOption( KdcOptions.RENEWABLE ) )\n         {\n             if ( !config.isRenewableAllowed() )\n             {\n@@ -251,11 +237,17 @@ public void execute( NextCommand next, IoSession session, Object message ) throw\n                 tempRtime = KerberosTime.INFINITY;\n             }\n \n+            /*\n+             * The renew-till time is the minimum of (a) the requested renew-till\n+             * time or (b) the start time plus maximum renewable lifetime as\n+             * configured in policy.\n+             */\n             long renewTill = Math.min( tempRtime.getTime(), startTime.getTime() + config.getMaximumRenewableLifetime() );\n             newTicketBody.setRenewTill( new KerberosTime( renewTill ) );\n         }\n \n-        if ( request.getAddresses() != null )\n+        if ( request.getAddresses() != null && request.getAddresses().getAddresses() != null\n+            && request.getAddresses().getAddresses().length > 0 )\n         {\n             newTicketBody.setClientAddresses( request.getAddresses() );\n         }"
            },
            {
                "sha": "c875c3f9830495ec964d7f733265b57f5a5c457c",
                "filename": "protocol-kerberos/src/main/java/org/apache/directory/server/kerberos/kdc/ticketgrant/GenerateTicket.java",
                "status": "modified",
                "additions": 85,
                "deletions": 16,
                "changes": 101,
                "blob_url": "https://github.com/apache/directory-server/blob/e1d020a39cd5ba602285c15c8032620cda6588ba/protocol-kerberos/src/main/java/org/apache/directory/server/kerberos/kdc/ticketgrant/GenerateTicket.java",
                "raw_url": "https://github.com/apache/directory-server/raw/e1d020a39cd5ba602285c15c8032620cda6588ba/protocol-kerberos/src/main/java/org/apache/directory/server/kerberos/kdc/ticketgrant/GenerateTicket.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-kerberos/src/main/java/org/apache/directory/server/kerberos/kdc/ticketgrant/GenerateTicket.java?ref=e1d020a39cd5ba602285c15c8032620cda6588ba",
                "patch": "@@ -137,6 +137,11 @@ private void processFlags( KdcConfiguration config, KdcRequest request, Ticket t\n \n         if ( request.getOption( KdcOptions.FORWARDABLE ) )\n         {\n+            if ( !config.isForwardableAllowed() )\n+            {\n+                throw new KerberosException( ErrorType.KDC_ERR_POLICY );\n+            }\n+\n             if ( !tgt.getFlag( TicketFlags.FORWARDABLE ) )\n             {\n                 throw new KerberosException( ErrorType.KDC_ERR_BADOPTION );\n@@ -147,13 +152,30 @@ private void processFlags( KdcConfiguration config, KdcRequest request, Ticket t\n \n         if ( request.getOption( KdcOptions.FORWARDED ) )\n         {\n+            if ( !config.isForwardableAllowed() )\n+            {\n+                throw new KerberosException( ErrorType.KDC_ERR_POLICY );\n+            }\n+\n             if ( !tgt.getFlag( TicketFlags.FORWARDABLE ) )\n             {\n                 throw new KerberosException( ErrorType.KDC_ERR_BADOPTION );\n             }\n \n+            if ( request.getAddresses() != null && request.getAddresses().getAddresses() != null\n+                && request.getAddresses().getAddresses().length > 0 )\n+            {\n+                newTicketBody.setClientAddresses( request.getAddresses() );\n+            }\n+            else\n+            {\n+                if ( !config.isEmptyAddressesAllowed() )\n+                {\n+                    throw new KerberosException( ErrorType.KDC_ERR_POLICY );\n+                }\n+            }\n+\n             newTicketBody.setFlag( TicketFlags.FORWARDED );\n-            newTicketBody.setClientAddresses( request.getAddresses() );\n         }\n \n         if ( tgt.getFlag( TicketFlags.FORWARDED ) )\n@@ -163,6 +185,11 @@ private void processFlags( KdcConfiguration config, KdcRequest request, Ticket t\n \n         if ( request.getOption( KdcOptions.PROXIABLE ) )\n         {\n+            if ( !config.isProxiableAllowed() )\n+            {\n+                throw new KerberosException( ErrorType.KDC_ERR_POLICY );\n+            }\n+\n             if ( !tgt.getFlag( TicketFlags.PROXIABLE ) )\n             {\n                 throw new KerberosException( ErrorType.KDC_ERR_BADOPTION );\n@@ -173,17 +200,39 @@ private void processFlags( KdcConfiguration config, KdcRequest request, Ticket t\n \n         if ( request.getOption( KdcOptions.PROXY ) )\n         {\n+            if ( !config.isProxiableAllowed() )\n+            {\n+                throw new KerberosException( ErrorType.KDC_ERR_POLICY );\n+            }\n+\n             if ( !tgt.getFlag( TicketFlags.PROXIABLE ) )\n             {\n                 throw new KerberosException( ErrorType.KDC_ERR_BADOPTION );\n             }\n \n+            if ( request.getAddresses() != null && request.getAddresses().getAddresses() != null\n+                && request.getAddresses().getAddresses().length > 0 )\n+            {\n+                newTicketBody.setClientAddresses( request.getAddresses() );\n+            }\n+            else\n+            {\n+                if ( !config.isEmptyAddressesAllowed() )\n+                {\n+                    throw new KerberosException( ErrorType.KDC_ERR_POLICY );\n+                }\n+            }\n+\n             newTicketBody.setFlag( TicketFlags.PROXY );\n-            newTicketBody.setClientAddresses( request.getAddresses() );\n         }\n \n         if ( request.getOption( KdcOptions.ALLOW_POSTDATE ) )\n         {\n+            if ( !config.isPostdateAllowed() )\n+            {\n+                throw new KerberosException( ErrorType.KDC_ERR_POLICY );\n+            }\n+\n             if ( !tgt.getFlag( TicketFlags.MAY_POSTDATE ) )\n             {\n                 throw new KerberosException( ErrorType.KDC_ERR_BADOPTION );\n@@ -204,14 +253,14 @@ private void processFlags( KdcConfiguration config, KdcRequest request, Ticket t\n          */\n         if ( request.getOption( KdcOptions.POSTDATED ) )\n         {\n-            if ( !tgt.getFlag( TicketFlags.MAY_POSTDATE ) )\n+            if ( !config.isPostdateAllowed() )\n             {\n-                throw new KerberosException( ErrorType.KDC_ERR_BADOPTION );\n+                throw new KerberosException( ErrorType.KDC_ERR_POLICY );\n             }\n \n-            if ( !config.isPostdateAllowed() )\n+            if ( !tgt.getFlag( TicketFlags.MAY_POSTDATE ) )\n             {\n-                throw new KerberosException( ErrorType.KDC_ERR_POLICY );\n+                throw new KerberosException( ErrorType.KDC_ERR_BADOPTION );\n             }\n \n             newTicketBody.setFlag( TicketFlags.POSTDATED );\n@@ -222,6 +271,11 @@ private void processFlags( KdcConfiguration config, KdcRequest request, Ticket t\n \n         if ( request.getOption( KdcOptions.VALIDATE ) )\n         {\n+            if ( !config.isPostdateAllowed() )\n+            {\n+                throw new KerberosException( ErrorType.KDC_ERR_POLICY );\n+            }\n+\n             if ( !tgt.getFlag( TicketFlags.INVALID ) )\n             {\n                 throw new KerberosException( ErrorType.KDC_ERR_POLICY );\n@@ -267,7 +321,7 @@ private void processTimes( KdcConfiguration config, KdcRequest request, EncTicke\n          * ticket is set to the authentication server's current time.\"\n          */\n         if ( startTime == null || startTime.lessThan( now ) || startTime.isInClockSkew( config.getAllowableClockSkew() )\n-            && !request.getKdcOptions().get( KdcOptions.POSTDATED ) )\n+            && !request.getOption( KdcOptions.POSTDATED ) )\n         {\n             startTime = now;\n         }\n@@ -280,7 +334,7 @@ private void processTimes( KdcConfiguration config, KdcRequest request, EncTicke\n          */\n         if ( startTime != null && startTime.greaterThan( now )\n             && !startTime.isInClockSkew( config.getAllowableClockSkew() )\n-            && ( !request.getKdcOptions().get( KdcOptions.POSTDATED ) || !tgt.getFlag( TicketFlags.MAY_POSTDATE ) ) )\n+            && ( !request.getOption( KdcOptions.POSTDATED ) || !tgt.getFlag( TicketFlags.MAY_POSTDATE ) ) )\n         {\n             throw new KerberosException( ErrorType.KDC_ERR_CANNOT_POSTDATE );\n         }\n@@ -290,6 +344,11 @@ private void processTimes( KdcConfiguration config, KdcRequest request, EncTicke\n \n         if ( request.getOption( KdcOptions.RENEW ) )\n         {\n+            if ( !config.isRenewableAllowed() )\n+            {\n+                throw new KerberosException( ErrorType.KDC_ERR_POLICY );\n+            }\n+\n             if ( !tgt.getFlag( TicketFlags.RENEWABLE ) )\n             {\n                 throw new KerberosException( ErrorType.KDC_ERR_BADOPTION );\n@@ -328,10 +387,10 @@ private void processTimes( KdcConfiguration config, KdcRequest request, EncTicke\n                 till = request.getTill();\n             }\n \n-            // TODO - config; requires store\n             /*\n-             new_tkt.starttime+client.max_life,\n-             new_tkt.starttime+server.max_life,\n+             * The end time is the minimum of (a) the requested till time or (b)\n+             * the start time plus maximum lifetime as configured in policy or (c)\n+             * the end time of the TGT.\n              */\n             List<KerberosTime> minimizer = new ArrayList<KerberosTime>();\n             minimizer.add( till );\n@@ -344,7 +403,12 @@ private void processTimes( KdcConfiguration config, KdcRequest request, EncTicke\n             if ( request.getOption( KdcOptions.RENEWABLE_OK ) && kerberosEndTime.lessThan( request.getTill() )\n                 && tgt.getFlag( TicketFlags.RENEWABLE ) )\n             {\n-                // we set the RENEWABLE option for later processing                           \n+                if ( !config.isRenewableAllowed() )\n+                {\n+                    throw new KerberosException( ErrorType.KDC_ERR_POLICY );\n+                }\n+\n+                // We set the RENEWABLE option for later processing.                           \n                 request.setOption( KdcOptions.RENEWABLE );\n                 long rtime = Math.min( request.getTill().getTime(), tgt.getRenewTill().getTime() );\n                 renewalTime = new KerberosTime( rtime );\n@@ -368,13 +432,18 @@ private void processTimes( KdcConfiguration config, KdcRequest request, EncTicke\n \n         if ( request.getOption( KdcOptions.RENEWABLE ) && tgt.getFlag( TicketFlags.RENEWABLE ) )\n         {\n+            if ( !config.isRenewableAllowed() )\n+            {\n+                throw new KerberosException( ErrorType.KDC_ERR_POLICY );\n+            }\n+\n             newTicketBody.setFlag( TicketFlags.RENEWABLE );\n \n             /*\n-             new_tkt.starttime+client.max_rlife,\n-             new_tkt.starttime+server.max_rlife,\n+             * The renew-till time is the minimum of (a) the requested renew-till\n+             * time or (b) the start time plus maximum renewable lifetime as\n+             * configured in policy or (c) the renew-till time of the TGT.\n              */\n-            // TODO - client and server configurable; requires store\n             List<KerberosTime> minimizer = new ArrayList<KerberosTime>();\n \n             /*\n@@ -385,7 +454,7 @@ private void processTimes( KdcConfiguration config, KdcRequest request, EncTicke\n                 minimizer.add( rtime );\n             }\n \n-            minimizer.add( new KerberosTime( now.getTime() + config.getMaximumRenewableLifetime() ) );\n+            minimizer.add( new KerberosTime( startTime.getTime() + config.getMaximumRenewableLifetime() ) );\n             minimizer.add( tgt.getRenewTill() );\n             newTicketBody.setRenewTill( Collections.min( minimizer ) );\n         }"
            },
            {
                "sha": "d69e8c969964f4c32fe4acd92aa0fc109952fbe1",
                "filename": "protocol-kerberos/src/test/java/org/apache/directory/server/kerberos/protocol/AuthenticationPolicyTest.java",
                "status": "added",
                "additions": 307,
                "deletions": 0,
                "changes": 307,
                "blob_url": "https://github.com/apache/directory-server/blob/e1d020a39cd5ba602285c15c8032620cda6588ba/protocol-kerberos/src/test/java/org/apache/directory/server/kerberos/protocol/AuthenticationPolicyTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/e1d020a39cd5ba602285c15c8032620cda6588ba/protocol-kerberos/src/test/java/org/apache/directory/server/kerberos/protocol/AuthenticationPolicyTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-kerberos/src/test/java/org/apache/directory/server/kerberos/protocol/AuthenticationPolicyTest.java?ref=e1d020a39cd5ba602285c15c8032620cda6588ba",
                "patch": "@@ -0,0 +1,307 @@\n+/*\n+ *  Licensed to the Apache Software Foundation (ASF) under one\n+ *  or more contributor license agreements.  See the NOTICE file\n+ *  distributed with this work for additional information\n+ *  regarding copyright ownership.  The ASF licenses this file\n+ *  to you under the Apache License, Version 2.0 (the\n+ *  \"License\"); you may not use this file except in compliance\n+ *  with the License.  You may obtain a copy of the License at\n+ *  \n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *  \n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License. \n+ *  \n+ */\n+package org.apache.directory.server.kerberos.protocol;\n+\n+\n+import org.apache.directory.server.kerberos.kdc.KdcConfiguration;\n+import org.apache.directory.server.kerberos.shared.messages.ErrorMessage;\n+import org.apache.directory.server.kerberos.shared.messages.KdcRequest;\n+import org.apache.directory.server.kerberos.shared.messages.MessageType;\n+import org.apache.directory.server.kerberos.shared.messages.value.KdcOptions;\n+import org.apache.directory.server.kerberos.shared.messages.value.KerberosTime;\n+import org.apache.directory.server.kerberos.shared.messages.value.RequestBodyModifier;\n+import org.apache.directory.server.kerberos.shared.store.PrincipalStore;\n+\n+\n+/**\n+ * Tests configuration of Authentication Service (AS) policy.\n+ *\n+ * @author <a href=\"mailto:dev@directory.apache.org\">Apache Directory Project</a>\n+ * @version $Rev$, $Date$\n+ */\n+public class AuthenticationPolicyTest extends AbstractAuthenticationServiceTest\n+{\n+    private KdcConfiguration config;\n+    private PrincipalStore store;\n+    private KerberosProtocolHandler handler;\n+    private DummySession session;\n+\n+\n+    /**\n+     * Creates a new instance of {@link AuthenticationPolicyTest}.\n+     */\n+    public AuthenticationPolicyTest()\n+    {\n+        config = new KdcConfiguration();\n+        store = new MapPrincipalStoreImpl();\n+        handler = new KerberosProtocolHandler( config, store );\n+        session = new DummySession();\n+    }\n+\n+\n+    /**\n+     * Tests when forwardable tickets are disallowed that requests for\n+     * forwardable tickets fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testForwardableTicket() throws Exception\n+    {\n+        // Deny FORWARDABLE tickets in policy.\n+        config.setPaEncTimestampRequired( false );\n+        config.setForwardableAllowed( false );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setClientName( getPrincipalName( \"hnelson\" ) );\n+        modifier.setServerName( getPrincipalName( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.FORWARDABLE );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long now = System.currentTimeMillis();\n+        KerberosTime requestedEndTime = new KerberosTime( now + 1 * KerberosTime.DAY );\n+        modifier.setTill( requestedEndTime );\n+\n+        KdcRequest message = new KdcRequest( 5, MessageType.KRB_AS_REQ, null, modifier.getRequestBody() );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+    }\n+\n+\n+    /**\n+     * Tests when proxiable tickets are disallowed that requests for\n+     * proxiable tickets fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testProxiableTicket() throws Exception\n+    {\n+        // Deny PROXIABLE tickets in policy.\n+        config.setPaEncTimestampRequired( false );\n+        config.setProxiableAllowed( false );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setClientName( getPrincipalName( \"hnelson\" ) );\n+        modifier.setServerName( getPrincipalName( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.PROXIABLE );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long now = System.currentTimeMillis();\n+        KerberosTime requestedEndTime = new KerberosTime( now + 1 * KerberosTime.DAY );\n+        modifier.setTill( requestedEndTime );\n+\n+        KdcRequest message = new KdcRequest( 5, MessageType.KRB_AS_REQ, null, modifier.getRequestBody() );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+    }\n+\n+\n+    /**\n+     * Tests when postdated tickets are disallowed that requests for\n+     * ALLOW-POSTDATE tickets fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testAllowPostdate() throws Exception\n+    {\n+        // Deny POSTDATED tickets in policy.\n+        config.setPaEncTimestampRequired( false );\n+        config.setPostdateAllowed( false );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setClientName( getPrincipalName( \"hnelson\" ) );\n+        modifier.setServerName( getPrincipalName( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.ALLOW_POSTDATE );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long now = System.currentTimeMillis();\n+        KerberosTime requestedEndTime = new KerberosTime( now + 1 * KerberosTime.DAY );\n+        modifier.setTill( requestedEndTime );\n+\n+        KdcRequest message = new KdcRequest( 5, MessageType.KRB_AS_REQ, null, modifier.getRequestBody() );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+    }\n+\n+\n+    /**\n+     * Tests when postdated tickets are disallowed that requests for\n+     * postdated tickets fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testPostdate() throws Exception\n+    {\n+        // Deny POSTDATED tickets in policy.\n+        config.setPaEncTimestampRequired( false );\n+        config.setPostdateAllowed( false );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setClientName( getPrincipalName( \"hnelson\" ) );\n+        modifier.setServerName( getPrincipalName( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.POSTDATED );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long now = System.currentTimeMillis();\n+        KerberosTime requestedEndTime = new KerberosTime( now + 1 * KerberosTime.DAY );\n+        modifier.setTill( requestedEndTime );\n+\n+        KdcRequest message = new KdcRequest( 5, MessageType.KRB_AS_REQ, null, modifier.getRequestBody() );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+    }\n+\n+\n+    /**\n+     * Tests when renewable tickets are disallowed that requests for\n+     * RENEWABLE-OK tickets fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testRenewableOk() throws Exception\n+    {\n+        // Deny RENEWABLE tickets in policy.\n+        config.setPaEncTimestampRequired( false );\n+        config.setRenewableAllowed( false );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setClientName( getPrincipalName( \"hnelson\" ) );\n+        modifier.setServerName( getPrincipalName( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.RENEWABLE_OK );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long now = System.currentTimeMillis();\n+        KerberosTime requestedEndTime = new KerberosTime( now + KerberosTime.WEEK );\n+        modifier.setTill( requestedEndTime );\n+\n+        KdcRequest message = new KdcRequest( 5, MessageType.KRB_AS_REQ, null, modifier.getRequestBody() );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+    }\n+\n+\n+    /**\n+     * Tests when renewable tickets are disallowed that requests for\n+     * renewable tickets fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testRenewableTicket() throws Exception\n+    {\n+        // Deny RENEWABLE tickets in policy.\n+        config.setPaEncTimestampRequired( false );\n+        config.setRenewableAllowed( false );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setClientName( getPrincipalName( \"hnelson\" ) );\n+        modifier.setServerName( getPrincipalName( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.RENEWABLE );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long now = System.currentTimeMillis();\n+        KerberosTime requestedEndTime = new KerberosTime( now + 1 * KerberosTime.DAY );\n+        modifier.setTill( requestedEndTime );\n+\n+        KerberosTime requestedRenewTillTime = new KerberosTime( now + KerberosTime.WEEK / 2 );\n+        modifier.setRtime( requestedRenewTillTime );\n+\n+        KdcRequest message = new KdcRequest( 5, MessageType.KRB_AS_REQ, null, modifier.getRequestBody() );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+    }\n+\n+\n+    /**\n+     * Tests when empty addresses are disallowed that requests with no addresses\n+     * fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testEmptyAddresses() throws Exception\n+    {\n+        // Deny empty addresses in policy.\n+        config.setPaEncTimestampRequired( false );\n+        config.setEmptyAddressesAllowed( false );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setClientName( getPrincipalName( \"hnelson\" ) );\n+        modifier.setServerName( getPrincipalName( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long now = System.currentTimeMillis();\n+        KerberosTime requestedEndTime = new KerberosTime( now + 1 * KerberosTime.DAY );\n+        modifier.setTill( requestedEndTime );\n+\n+        KerberosTime requestedRenewTillTime = new KerberosTime( now + KerberosTime.WEEK / 2 );\n+        modifier.setRtime( requestedRenewTillTime );\n+\n+        KdcRequest message = new KdcRequest( 5, MessageType.KRB_AS_REQ, null, modifier.getRequestBody() );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+    }\n+}"
            },
            {
                "sha": "71f42cf3252208166c3f998b1763f4ae8a45ff00",
                "filename": "protocol-kerberos/src/test/java/org/apache/directory/server/kerberos/protocol/TicketGrantingPolicyTest.java",
                "status": "added",
                "additions": 693,
                "deletions": 0,
                "changes": 693,
                "blob_url": "https://github.com/apache/directory-server/blob/e1d020a39cd5ba602285c15c8032620cda6588ba/protocol-kerberos/src/test/java/org/apache/directory/server/kerberos/protocol/TicketGrantingPolicyTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/e1d020a39cd5ba602285c15c8032620cda6588ba/protocol-kerberos/src/test/java/org/apache/directory/server/kerberos/protocol/TicketGrantingPolicyTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-kerberos/src/test/java/org/apache/directory/server/kerberos/protocol/TicketGrantingPolicyTest.java?ref=e1d020a39cd5ba602285c15c8032620cda6588ba",
                "patch": "@@ -0,0 +1,693 @@\n+/*\n+ *  Licensed to the Apache Software Foundation (ASF) under one\n+ *  or more contributor license agreements.  See the NOTICE file\n+ *  distributed with this work for additional information\n+ *  regarding copyright ownership.  The ASF licenses this file\n+ *  to you under the Apache License, Version 2.0 (the\n+ *  \"License\"); you may not use this file except in compliance\n+ *  with the License.  You may obtain a copy of the License at\n+ *  \n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *  \n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License. \n+ *  \n+ */\n+package org.apache.directory.server.kerberos.protocol;\n+\n+\n+import java.net.InetAddress;\n+\n+import javax.security.auth.kerberos.KerberosPrincipal;\n+\n+import org.apache.directory.server.kerberos.kdc.KdcConfiguration;\n+import org.apache.directory.server.kerberos.shared.crypto.encryption.CipherTextHandler;\n+import org.apache.directory.server.kerberos.shared.messages.ErrorMessage;\n+import org.apache.directory.server.kerberos.shared.messages.KdcRequest;\n+import org.apache.directory.server.kerberos.shared.messages.components.EncTicketPartModifier;\n+import org.apache.directory.server.kerberos.shared.messages.components.Ticket;\n+import org.apache.directory.server.kerberos.shared.messages.value.EncryptionKey;\n+import org.apache.directory.server.kerberos.shared.messages.value.HostAddress;\n+import org.apache.directory.server.kerberos.shared.messages.value.HostAddresses;\n+import org.apache.directory.server.kerberos.shared.messages.value.KdcOptions;\n+import org.apache.directory.server.kerberos.shared.messages.value.KerberosTime;\n+import org.apache.directory.server.kerberos.shared.messages.value.RequestBody;\n+import org.apache.directory.server.kerberos.shared.messages.value.RequestBodyModifier;\n+import org.apache.directory.server.kerberos.shared.messages.value.TicketFlags;\n+import org.apache.directory.server.kerberos.shared.store.PrincipalStore;\n+\n+\n+/**\n+ * Tests configuration of Ticket-Granting Service (TGS) policy.\n+ * \n+ * @author <a href=\"mailto:dev@directory.apache.org\">Apache Directory Project</a>\n+ * @version $Rev$, $Date$\n+ */\n+public class TicketGrantingPolicyTest extends AbstractTicketGrantingServiceTest\n+{\n+    private KdcConfiguration config;\n+    private PrincipalStore store;\n+    private KerberosProtocolHandler handler;\n+    private DummySession session;\n+\n+\n+    /**\n+     * Creates a new instance of {@link TicketGrantingPolicyTest}.\n+     */\n+    public TicketGrantingPolicyTest()\n+    {\n+        config = new KdcConfiguration();\n+\n+        /*\n+         * Body checksum verification must be disabled because we are bypassing\n+         * the codecs, where the body bytes are set on the KdcRequest message.\n+         */\n+        config.setBodyChecksumVerified( false );\n+\n+        store = new MapPrincipalStoreImpl();\n+        handler = new KerberosProtocolHandler( config, store );\n+        session = new DummySession();\n+        lockBox = new CipherTextHandler();\n+    }\n+\n+\n+    /**\n+     * Tests when forwardable tickets are disallowed that requests for\n+     * forwardable tickets fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testForwardableTicket() throws Exception\n+    {\n+        // Deny FORWARDABLE tickets in policy.\n+        config.setForwardableAllowed( false );\n+\n+        // Get the mutable ticket part.\n+        KerberosPrincipal clientPrincipal = new KerberosPrincipal( \"hnelson@EXAMPLE.COM\" );\n+        EncTicketPartModifier encTicketPartModifier = getTicketArchetype( clientPrincipal );\n+\n+        // Make changes to test.\n+        encTicketPartModifier.setFlag( TicketFlags.FORWARDABLE );\n+\n+        // Seal the ticket for the server.\n+        KerberosPrincipal serverPrincipal = new KerberosPrincipal( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" );\n+        String passPhrase = \"randomKey\";\n+        EncryptionKey serverKey = getEncryptionKey( serverPrincipal, passPhrase );\n+        Ticket tgt = getTicket( encTicketPartModifier, serverPrincipal, serverKey );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setServerName( getPrincipalName( \"ldap/ldap.example.com@EXAMPLE.COM\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+        modifier.setNonce( random.nextInt() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.FORWARDABLE );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long now = System.currentTimeMillis();\n+\n+        KerberosTime requestedEndTime = new KerberosTime( now + 1 * KerberosTime.DAY );\n+        modifier.setTill( requestedEndTime );\n+\n+        RequestBody requestBody = modifier.getRequestBody();\n+        KdcRequest message = getKdcRequest( tgt, requestBody );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+    }\n+\n+\n+    /**\n+     * Tests when forwardable tickets are disallowed that requests for\n+     * forwarded tickets fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testForwardedTicket() throws Exception\n+    {\n+        // Deny FORWARDABLE tickets in policy.\n+        config.setForwardableAllowed( false );\n+\n+        // Get the mutable ticket part.\n+        KerberosPrincipal clientPrincipal = new KerberosPrincipal( \"hnelson@EXAMPLE.COM\" );\n+        EncTicketPartModifier encTicketPartModifier = getTicketArchetype( clientPrincipal );\n+\n+        // Make changes to test.\n+        encTicketPartModifier.setFlag( TicketFlags.FORWARDABLE );\n+\n+        // Seal the ticket for the server.\n+        KerberosPrincipal serverPrincipal = new KerberosPrincipal( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" );\n+        String passPhrase = \"randomKey\";\n+        EncryptionKey serverKey = getEncryptionKey( serverPrincipal, passPhrase );\n+        Ticket tgt = getTicket( encTicketPartModifier, serverPrincipal, serverKey );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setServerName( getPrincipalName( \"ldap/ldap.example.com@EXAMPLE.COM\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+        modifier.setNonce( random.nextInt() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.FORWARDED );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long now = System.currentTimeMillis();\n+\n+        KerberosTime requestedEndTime = new KerberosTime( now + 1 * KerberosTime.DAY );\n+        modifier.setTill( requestedEndTime );\n+\n+        RequestBody requestBody = modifier.getRequestBody();\n+        KdcRequest message = getKdcRequest( tgt, requestBody );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+    }\n+\n+\n+    /**\n+     * Tests when empty addresses are disallowed and forwarded tickets are requested\n+     * that requests with no addresses fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testForwardedNoAddressesTicket() throws Exception\n+    {\n+        /*\n+         * Test case needs further testing to ensure the localhost address is\n+         * resolved uniformly on different platforms, or else the test case will fail.\n+         */\n+        assertTrue( true );\n+\n+        /*\n+        // Deny empty addresses tickets in policy.\n+        config.setEmptyAddressesAllowed( false );\n+\n+        // Get the mutable ticket part.\n+        KerberosPrincipal clientPrincipal = new KerberosPrincipal( \"hnelson@EXAMPLE.COM\" );\n+        EncTicketPartModifier encTicketPartModifier = getTicketArchetype( clientPrincipal );\n+\n+        // Make changes to test.\n+        encTicketPartModifier.setFlag( TicketFlags.FORWARDABLE );\n+\n+        HostAddress[] address =\n+            { new HostAddress( InetAddress.getByAddress( new byte[4] ) ) };\n+        HostAddresses addresses = new HostAddresses( address );\n+        encTicketPartModifier.setClientAddresses( addresses );\n+\n+        // Seal the ticket for the server.\n+        KerberosPrincipal serverPrincipal = new KerberosPrincipal( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" );\n+        String passPhrase = \"randomKey\";\n+        EncryptionKey serverKey = getEncryptionKey( serverPrincipal, passPhrase );\n+        Ticket tgt = getTicket( encTicketPartModifier, serverPrincipal, serverKey );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setServerName( getPrincipalName( \"ldap/ldap.example.com@EXAMPLE.COM\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+        modifier.setNonce( random.nextInt() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.FORWARDED );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long now = System.currentTimeMillis();\n+\n+        KerberosTime requestedEndTime = new KerberosTime( now + 1 * KerberosTime.DAY );\n+        modifier.setTill( requestedEndTime );\n+\n+        RequestBody requestBody = modifier.getRequestBody();\n+        KdcRequest message = getKdcRequest( tgt, requestBody );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+        */\n+    }\n+\n+\n+    /**\n+     * Tests when proxiable tickets are disallowed that requests for\n+     * proxiable tickets fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testProxiableTicket() throws Exception\n+    {\n+        // Deny PROXIABLE tickets in policy.\n+        config.setProxiableAllowed( false );\n+\n+        // Get the mutable ticket part.\n+        KerberosPrincipal clientPrincipal = new KerberosPrincipal( \"hnelson@EXAMPLE.COM\" );\n+        EncTicketPartModifier encTicketPartModifier = getTicketArchetype( clientPrincipal );\n+\n+        // Make changes to test.\n+        encTicketPartModifier.setFlag( TicketFlags.PROXIABLE );\n+\n+        // Seal the ticket for the server.\n+        KerberosPrincipal serverPrincipal = new KerberosPrincipal( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" );\n+        String passPhrase = \"randomKey\";\n+        EncryptionKey serverKey = getEncryptionKey( serverPrincipal, passPhrase );\n+        Ticket tgt = getTicket( encTicketPartModifier, serverPrincipal, serverKey );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setServerName( getPrincipalName( \"ldap/ldap.example.com@EXAMPLE.COM\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+        modifier.setNonce( random.nextInt() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.PROXIABLE );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long now = System.currentTimeMillis();\n+\n+        KerberosTime requestedEndTime = new KerberosTime( now + 1 * KerberosTime.DAY );\n+        modifier.setTill( requestedEndTime );\n+\n+        RequestBody requestBody = modifier.getRequestBody();\n+        KdcRequest message = getKdcRequest( tgt, requestBody );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+    }\n+\n+\n+    /**\n+     * Tests when proxiable tickets are disallowed that requests for\n+     * proxy tickets fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testProxyTicket() throws Exception\n+    {\n+        // Deny PROXIABLE tickets in policy.\n+        config.setProxiableAllowed( false );\n+\n+        // Get the mutable ticket part.\n+        KerberosPrincipal clientPrincipal = new KerberosPrincipal( \"hnelson@EXAMPLE.COM\" );\n+        EncTicketPartModifier encTicketPartModifier = getTicketArchetype( clientPrincipal );\n+\n+        // Make changes to test.\n+        encTicketPartModifier.setFlag( TicketFlags.PROXIABLE );\n+\n+        // Seal the ticket for the server.\n+        KerberosPrincipal serverPrincipal = new KerberosPrincipal( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" );\n+        String passPhrase = \"randomKey\";\n+        EncryptionKey serverKey = getEncryptionKey( serverPrincipal, passPhrase );\n+        Ticket tgt = getTicket( encTicketPartModifier, serverPrincipal, serverKey );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setServerName( getPrincipalName( \"ldap/ldap.example.com@EXAMPLE.COM\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+        modifier.setNonce( random.nextInt() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.PROXY );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long now = System.currentTimeMillis();\n+\n+        KerberosTime requestedEndTime = new KerberosTime( now + 1 * KerberosTime.DAY );\n+        modifier.setTill( requestedEndTime );\n+\n+        HostAddress[] address =\n+            { new HostAddress( InetAddress.getLocalHost() ) };\n+        HostAddresses addresses = new HostAddresses( address );\n+        modifier.setAddresses( addresses );\n+\n+        RequestBody requestBody = modifier.getRequestBody();\n+        KdcRequest message = getKdcRequest( tgt, requestBody );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+    }\n+\n+\n+    /**\n+     * Tests when empty addresses are disallowed and proxy tickets are requested\n+     * that requests with no addresses fail with the correct error message.\n+     *  \n+     * @throws Exception \n+     */\n+    public void testProxyNoAddressesTicket() throws Exception\n+    {\n+        /*\n+         * Test case needs further testing to ensure the localhost address is\n+         * resolved uniformly on different platforms, or else the test case will fail.\n+         */\n+        assertTrue( true );\n+\n+        /*\n+        // Deny empty addresses tickets in policy.\n+        config.setEmptyAddressesAllowed( false );\n+\n+        // Get the mutable ticket part.\n+        KerberosPrincipal clientPrincipal = new KerberosPrincipal( \"hnelson@EXAMPLE.COM\" );\n+        EncTicketPartModifier encTicketPartModifier = getTicketArchetype( clientPrincipal );\n+\n+        // Make changes to test.\n+        encTicketPartModifier.setFlag( TicketFlags.PROXIABLE );\n+\n+        HostAddress[] address =\n+            { new HostAddress( InetAddress.getByAddress( new byte[4] ) ) };\n+        HostAddresses addresses = new HostAddresses( address );\n+        encTicketPartModifier.setClientAddresses( addresses );\n+\n+        // Seal the ticket for the server.\n+        KerberosPrincipal serverPrincipal = new KerberosPrincipal( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" );\n+        String passPhrase = \"randomKey\";\n+        EncryptionKey serverKey = getEncryptionKey( serverPrincipal, passPhrase );\n+        Ticket tgt = getTicket( encTicketPartModifier, serverPrincipal, serverKey );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setServerName( getPrincipalName( \"ldap/ldap.example.com@EXAMPLE.COM\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+        modifier.setNonce( random.nextInt() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.PROXY );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long now = System.currentTimeMillis();\n+\n+        KerberosTime requestedEndTime = new KerberosTime( now + 1 * KerberosTime.DAY );\n+        modifier.setTill( requestedEndTime );\n+\n+        RequestBody requestBody = modifier.getRequestBody();\n+        KdcRequest message = getKdcRequest( tgt, requestBody );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+        */\n+    }\n+\n+\n+    /**\n+     * Tests when postdated tickets are disallowed that requests for\n+     * ALLOW-POSTDATE tickets fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testAllowPostdate() throws Exception\n+    {\n+        // Deny ALLOW_POSTDATE tickets in policy.\n+        config.setPostdateAllowed( false );\n+\n+        // Get the mutable ticket part.\n+        KerberosPrincipal clientPrincipal = new KerberosPrincipal( \"hnelson@EXAMPLE.COM\" );\n+        EncTicketPartModifier encTicketPartModifier = getTicketArchetype( clientPrincipal );\n+\n+        // Make changes to test.\n+        encTicketPartModifier.setFlag( TicketFlags.MAY_POSTDATE );\n+\n+        // Seal the ticket for the server.\n+        KerberosPrincipal serverPrincipal = new KerberosPrincipal( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" );\n+        String passPhrase = \"randomKey\";\n+        EncryptionKey serverKey = getEncryptionKey( serverPrincipal, passPhrase );\n+        Ticket tgt = getTicket( encTicketPartModifier, serverPrincipal, serverKey );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setServerName( getPrincipalName( \"ldap/ldap.example.com@EXAMPLE.COM\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+        modifier.setNonce( random.nextInt() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.ALLOW_POSTDATE );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long now = System.currentTimeMillis();\n+\n+        KerberosTime requestedEndTime = new KerberosTime( now + 1 * KerberosTime.DAY );\n+        modifier.setTill( requestedEndTime );\n+\n+        RequestBody requestBody = modifier.getRequestBody();\n+        KdcRequest message = getKdcRequest( tgt, requestBody );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+    }\n+\n+\n+    /**\n+     * Tests when postdated tickets are disallowed that requests for\n+     * postdated tickets fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testPostdated() throws Exception\n+    {\n+        // Deny POSTDATED tickets in policy.\n+        config.setPostdateAllowed( false );\n+\n+        // Get the mutable ticket part.\n+        KerberosPrincipal clientPrincipal = new KerberosPrincipal( \"hnelson@EXAMPLE.COM\" );\n+        EncTicketPartModifier encTicketPartModifier = getTicketArchetype( clientPrincipal );\n+\n+        // Make changes to test.\n+        encTicketPartModifier.setFlag( TicketFlags.MAY_POSTDATE );\n+\n+        // Seal the ticket for the server.\n+        KerberosPrincipal serverPrincipal = new KerberosPrincipal( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" );\n+        String passPhrase = \"randomKey\";\n+        EncryptionKey serverKey = getEncryptionKey( serverPrincipal, passPhrase );\n+        Ticket tgt = getTicket( encTicketPartModifier, serverPrincipal, serverKey );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setServerName( getPrincipalName( \"ldap/ldap.example.com@EXAMPLE.COM\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+        modifier.setNonce( random.nextInt() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.POSTDATED );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long now = System.currentTimeMillis();\n+\n+        KerberosTime requestedEndTime = new KerberosTime( now + 1 * KerberosTime.DAY );\n+        modifier.setTill( requestedEndTime );\n+\n+        RequestBody requestBody = modifier.getRequestBody();\n+        KdcRequest message = getKdcRequest( tgt, requestBody );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+    }\n+\n+\n+    /**\n+     * Tests when postdated tickets are disallowed that requests for\n+     * validation of invalid tickets fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testValidateInvalidTicket() throws Exception\n+    {\n+        // Deny VALIDATE tickets in policy.\n+        config.setPostdateAllowed( false );\n+\n+        // Get the mutable ticket part.\n+        KerberosPrincipal clientPrincipal = new KerberosPrincipal( \"hnelson@EXAMPLE.COM\" );\n+        EncTicketPartModifier encTicketPartModifier = getTicketArchetype( clientPrincipal );\n+\n+        // Make changes to test.\n+        encTicketPartModifier.setFlag( TicketFlags.INVALID );\n+\n+        // Seal the ticket for the server.\n+        KerberosPrincipal serverPrincipal = new KerberosPrincipal( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" );\n+        String passPhrase = \"randomKey\";\n+        EncryptionKey serverKey = getEncryptionKey( serverPrincipal, passPhrase );\n+        Ticket tgt = getTicket( encTicketPartModifier, serverPrincipal, serverKey );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setServerName( getPrincipalName( \"hnelson\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+        modifier.setNonce( random.nextInt() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.VALIDATE );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long currentTime = System.currentTimeMillis();\n+\n+        KerberosTime requestedEndTime = new KerberosTime( currentTime + KerberosTime.DAY );\n+        modifier.setTill( requestedEndTime );\n+\n+        RequestBody requestBody = modifier.getRequestBody();\n+\n+        KdcRequest message = getKdcRequest( tgt, requestBody );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+    }\n+\n+\n+    /**\n+     * Tests when renewable tickets are disallowed that requests for\n+     * renewal of tickets fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testRenewTicket() throws Exception\n+    {\n+        // Deny RENEWABLE tickets in policy.\n+        config.setRenewableAllowed( false );\n+\n+        KerberosPrincipal clientPrincipal = new KerberosPrincipal( \"hnelson@EXAMPLE.COM\" );\n+        KerberosPrincipal serverPrincipal = new KerberosPrincipal( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" );\n+        String serverPassword = \"randomKey\";\n+\n+        Ticket tgt = getTgt( clientPrincipal, serverPrincipal, serverPassword );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setServerName( getPrincipalName( \"hnelson\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+        modifier.setNonce( random.nextInt() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.RENEW );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long currentTime = System.currentTimeMillis();\n+\n+        KerberosTime requestedEndTime = new KerberosTime( currentTime + KerberosTime.DAY );\n+        modifier.setTill( requestedEndTime );\n+\n+        RequestBody requestBody = modifier.getRequestBody();\n+\n+        KdcRequest message = getKdcRequest( tgt, requestBody );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+    }\n+\n+\n+    /**\n+     * Tests when renewable tickets are disallowed that requests for\n+     * RENEWABLE-OK tickets fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testRenewableOk() throws Exception\n+    {\n+        // Deny RENEWABLE tickets in policy.\n+        config.setRenewableAllowed( false );\n+\n+        // Get the mutable ticket part.\n+        KerberosPrincipal clientPrincipal = new KerberosPrincipal( \"hnelson@EXAMPLE.COM\" );\n+        EncTicketPartModifier encTicketPartModifier = getTicketArchetype( clientPrincipal );\n+\n+        // Make changes to test.\n+        encTicketPartModifier.setFlag( TicketFlags.RENEWABLE );\n+\n+        // Seal the ticket for the server.\n+        KerberosPrincipal serverPrincipal = new KerberosPrincipal( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" );\n+        String passPhrase = \"randomKey\";\n+        EncryptionKey serverKey = getEncryptionKey( serverPrincipal, passPhrase );\n+        Ticket tgt = getTicket( encTicketPartModifier, serverPrincipal, serverKey );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setServerName( getPrincipalName( \"ldap/ldap.example.com@EXAMPLE.COM\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+        modifier.setNonce( random.nextInt() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.RENEWABLE_OK );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long now = System.currentTimeMillis();\n+\n+        KerberosTime requestedEndTime = new KerberosTime( now + KerberosTime.WEEK );\n+        modifier.setTill( requestedEndTime );\n+\n+        RequestBody requestBody = modifier.getRequestBody();\n+        KdcRequest message = getKdcRequest( tgt, requestBody );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+    }\n+\n+\n+    /**\n+     * Tests when renewable tickets are disallowed that requests for\n+     * renewable tickets fail with the correct error message.\n+     * \n+     * @throws Exception \n+     */\n+    public void testRenewableTicket() throws Exception\n+    {\n+        // Deny RENEWABLE tickets in policy.\n+        config.setRenewableAllowed( false );\n+\n+        // Get the mutable ticket part.\n+        KerberosPrincipal clientPrincipal = new KerberosPrincipal( \"hnelson@EXAMPLE.COM\" );\n+        EncTicketPartModifier encTicketPartModifier = getTicketArchetype( clientPrincipal );\n+\n+        // Make changes to test.\n+        encTicketPartModifier.setFlag( TicketFlags.RENEWABLE );\n+\n+        // Seal the ticket for the server.\n+        KerberosPrincipal serverPrincipal = new KerberosPrincipal( \"krbtgt/EXAMPLE.COM@EXAMPLE.COM\" );\n+        String passPhrase = \"randomKey\";\n+        EncryptionKey serverKey = getEncryptionKey( serverPrincipal, passPhrase );\n+        Ticket tgt = getTicket( encTicketPartModifier, serverPrincipal, serverKey );\n+\n+        RequestBodyModifier modifier = new RequestBodyModifier();\n+        modifier.setServerName( getPrincipalName( \"ldap/ldap.example.com@EXAMPLE.COM\" ) );\n+        modifier.setRealm( \"EXAMPLE.COM\" );\n+        modifier.setEType( config.getEncryptionTypes() );\n+        modifier.setNonce( random.nextInt() );\n+\n+        KdcOptions kdcOptions = new KdcOptions();\n+        kdcOptions.set( KdcOptions.RENEWABLE );\n+        modifier.setKdcOptions( kdcOptions );\n+\n+        long now = System.currentTimeMillis();\n+\n+        KerberosTime requestedEndTime = new KerberosTime( now + 1 * KerberosTime.DAY );\n+        modifier.setTill( requestedEndTime );\n+\n+        KerberosTime requestedRenewTillTime = new KerberosTime( now + KerberosTime.WEEK / 2 );\n+        modifier.setRtime( requestedRenewTillTime );\n+\n+        RequestBody requestBody = modifier.getRequestBody();\n+        KdcRequest message = getKdcRequest( tgt, requestBody );\n+\n+        handler.messageReceived( session, message );\n+\n+        ErrorMessage error = ( ErrorMessage ) session.getMessage();\n+        assertEquals( \"KDC policy rejects request\", 12, error.getErrorCode() );\n+    }\n+}"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/bf3d0982575284c3ae2b5ab19d66be89924c0085",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/f383684370acba67e6fee21ce988ee254457fbad",
        "message": "o Injected Kiran's patch to move AVL serialization inside JDBM\no Added synchronization in JDBMStore for modification operations and sync()\no The JDBM byte buffers are copied before being returned to the caller, to avoid a modification \nmade on a reference\no Fixed some double update of the oneLevel index (no need to add a (id,id) entry)\no When we can't find the entry, instead of a NPE, an error 32 is generated (NO_SUCH_OBJECT)\no Minor cleanup in JdbmTable\no Added some logs in JdbmTable\no Added some traces if the AVL Tree deserializer detect some bad tree\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@792502 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_114",
        "file": [
            {
                "sha": "3c4e1b3af635e192d3dff67cd7c020f59caf0547",
                "filename": "core-avl/src/main/java/org/apache/directory/server/core/avltree/AvlTree.java",
                "status": "modified",
                "additions": 54,
                "deletions": 7,
                "changes": 61,
                "blob_url": "https://github.com/apache/directory-server/blob/bf3d0982575284c3ae2b5ab19d66be89924c0085/core-avl/src/main/java/org/apache/directory/server/core/avltree/AvlTree.java",
                "raw_url": "https://github.com/apache/directory-server/raw/bf3d0982575284c3ae2b5ab19d66be89924c0085/core-avl/src/main/java/org/apache/directory/server/core/avltree/AvlTree.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-avl/src/main/java/org/apache/directory/server/core/avltree/AvlTree.java?ref=bf3d0982575284c3ae2b5ab19d66be89924c0085",
                "patch": "@@ -489,9 +489,9 @@ public void printTree()\n \n         System.out.println( getRoot() );\n         \n-        visit( getRoot().getRight(), getRoot() );\n+        visit( null, getRoot().getRight(), getRoot() );\n         \n-        visit( getRoot().getLeft(), getRoot() );\n+        visit( null, getRoot().getLeft(), getRoot() );\n     }\n     \n \n@@ -930,7 +930,19 @@ private int getBalance( LinkedAvlNode<K> node )\n     }\n     \n     \n-    private void visit( LinkedAvlNode<K> node, LinkedAvlNode<K> parentNode ) \n+    /**\n+     * Checks that the tree is correct. It must be balanced, and the prev/next\n+     * chain must be equivalent to a depth-first descent on the tree\n+     * \n+     * @return true if the tree is balanced and correct\n+     */\n+    public boolean checkTree()\n+    {\n+        return true;\n+    }\n+    \n+    \n+    private void visit( StringBuilder sb, LinkedAvlNode<K> node, LinkedAvlNode<K> parentNode ) \n     {\n         if( node == null )\n         {\n@@ -944,10 +956,18 @@ private void visit( LinkedAvlNode<K> node, LinkedAvlNode<K> parentNode )\n         \n         for( int i=0; i < parentNode.getDepth(); i++ )\n         {\n-            System.out.print( \"|  \" );\n+            if ( sb != null )\n+            {\n+                sb.append( \"|  \" );\n+            }\n+            else\n+            {\n+                System.out.print( \"|  \" );\n+            }\n         }\n \n         String type = \"\";\n+        \n         if( node == parentNode.left )\n         {\n             type = \"L\";\n@@ -957,16 +977,43 @@ else if( node == parentNode.right )\n             type = \"R\";\n         }\n         \n-        System.out.println( \"|--\" + node + type );\n+        if ( sb != null )\n+        {\n+            sb.append( \"|--\" ).append( node ).append( type ).append( '\\n' );\n+        }\n+        else\n+        {\n+            System.out.println( \"|--\" + node + type );\n+        }\n         \n         if ( node.getRight() != null )\n         {\n-            visit( node.getRight(), node );\n+            visit( sb, node.getRight(), node );\n         }\n         \n         if( node.getLeft() != null )\n         {\n-            visit( node.getLeft(), node );\n+            visit( sb, node.getLeft(), node );\n+        }\n+    }\n+    \n+    public String toString()\n+    {\n+        if( isEmpty() )\n+        {\n+            return \"[]\";\n         }\n+        \n+        getRoot().setDepth( 0 );\n+\n+        StringBuilder sb = new StringBuilder();\n+        \n+        sb.append( getRoot() );\n+        \n+        visit( sb, getRoot().getRight(), getRoot() );\n+        \n+        visit( sb, getRoot().getLeft(), getRoot() );\n+        \n+        return sb.toString();\n     }\n }"
            },
            {
                "sha": "c55aaff71366449970f755f49d20a19c37784d08",
                "filename": "core-avl/src/main/java/org/apache/directory/server/core/avltree/AvlTreeMarshaller.java",
                "status": "modified",
                "additions": 69,
                "deletions": 38,
                "changes": 107,
                "blob_url": "https://github.com/apache/directory-server/blob/bf3d0982575284c3ae2b5ab19d66be89924c0085/core-avl/src/main/java/org/apache/directory/server/core/avltree/AvlTreeMarshaller.java",
                "raw_url": "https://github.com/apache/directory-server/raw/bf3d0982575284c3ae2b5ab19d66be89924c0085/core-avl/src/main/java/org/apache/directory/server/core/avltree/AvlTreeMarshaller.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-avl/src/main/java/org/apache/directory/server/core/avltree/AvlTreeMarshaller.java?ref=bf3d0982575284c3ae2b5ab19d66be89924c0085",
                "patch": "@@ -27,6 +27,12 @@\n import java.io.IOException;\n import java.util.Comparator;\n \n+import org.apache.directory.shared.ldap.util.StringTools;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import sun.reflect.Reflection;\n+\n \n /**\n  * Class to serialize the AvlTree node data.\n@@ -37,6 +43,9 @@\n @SuppressWarnings(\"unchecked\")\n public class AvlTreeMarshaller<E> implements Marshaller<AvlTree<E>>\n {\n+    /** static logger */\n+    private static final Logger LOG = LoggerFactory.getLogger( AvlTreeMarshaller.class );\n+\n     /** used for serialized form of an empty AvlTree */\n     private static final byte[] EMPTY_TREE = new byte[1];\n \n@@ -104,6 +113,18 @@ public AvlTreeMarshaller( Comparator<E> comparator )\n             writeTree( tree.getRoot(), out );\n             out.flush();\n             data = byteStream.toByteArray();\n+            \n+            // Try to deserialize, just to see\n+            try\n+            {\n+                deserialize( data );\n+            }\n+            catch (NullPointerException npe )\n+            {\n+                System.out.println( \"Bad serialization, tree : [\" + StringTools.dumpBytes( data ) + \"]\");\n+                throw npe;\n+            }\n+\n             out.close();\n         }\n         catch( IOException e )\n@@ -164,49 +185,59 @@ private void writeTree( LinkedAvlNode<E> node, DataOutputStream out ) throws IOE\n      */\n     public AvlTree<E> deserialize( byte[] data ) throws IOException\n     {\n-        if ( data == null || data.length == 0 )\n-        {\n-            throw new IOException( \"Null or empty data array is invalid.\" );\n-        }\n+        LOG.debug( \"Deserializing the tree, called by {}\", Reflection.getCallerClass( 2 ).getSimpleName() );\n \n-        if ( data.length == 1 && data[0] == 0 )\n-        {\n-            return new AvlTree<E>( comparator );\n-        }\n-\n-        ByteArrayInputStream bin = new ByteArrayInputStream( data );\n-        DataInputStream din = new DataInputStream( bin );\n-        \n-        byte startByte = din.readByte();\n-        \n-        if( startByte != 0 )\n-        {\n-            throw new IOException(\"wrong AvlTree serialized data format\");\n-        }\n-        \n-        int size = din.readInt();\n-        \n-        LinkedAvlNode[] nodes = new LinkedAvlNode[ size ];\n-        LinkedAvlNode<E> root = readTree( din, null, nodes );\n-        \n-        AvlTree<E> tree = new AvlTree<E>( comparator );\n-        \n-        tree.setRoot( root );\n-        \n-        tree.setFirst( nodes[0] );\n-        \n-        if( nodes.length >= 1 )\n+        try\n         {\n-            tree.setLast( nodes[ nodes.length - 1 ] );\n+            if ( data == null || data.length == 0 )\n+            {\n+                throw new IOException( \"Null or empty data array is invalid.\" );\n+            }\n+    \n+            if ( data.length == 1 && data[0] == 0 )\n+            {\n+                return new AvlTree<E>( comparator );\n+            }\n+    \n+            ByteArrayInputStream bin = new ByteArrayInputStream( data );\n+            DataInputStream din = new DataInputStream( bin );\n+            \n+            byte startByte = din.readByte();\n+            \n+            if( startByte != 0 )\n+            {\n+                throw new IOException(\"wrong AvlTree serialized data format\");\n+            }\n+            \n+            int size = din.readInt();\n+            \n+            LinkedAvlNode[] nodes = new LinkedAvlNode[ size ];\n+            LinkedAvlNode<E> root = readTree( din, null, nodes );\n+            \n+            AvlTree<E> tree = new AvlTree<E>( comparator );\n+            \n+            tree.setRoot( root );\n+            \n+            tree.setFirst( nodes[0] );\n+            \n+            if( nodes.length >= 1 )\n+            {\n+                tree.setLast( nodes[ nodes.length - 1 ] );\n+            }\n+            \n+            for( int i = 0; i < nodes.length - 1; i++ )\n+            {\n+                nodes[ i ].setNext( nodes[ i + 1] );\n+                nodes[ i + 1].setPrevious( nodes[ i ] );\n+            }\n+    \n+            return tree;\n         }\n-        \n-        for( int i = 0; i < nodes.length - 1; i++ )\n+        catch (NullPointerException npe )\n         {\n-            nodes[ i ].setNext( nodes[ i + 1] );\n-            nodes[ i + 1].setPrevious( nodes[ i ] );\n+            System.out.println( \"Bad tree : [\" + StringTools.dumpBytes( data ) + \"]\");\n+            throw npe;\n         }\n-\n-        return tree;\n     }\n \n     "
            },
            {
                "sha": "13a950151572ba50c6a7e3848abbb815b1dcf525",
                "filename": "core-avl/src/test/java/org/apache/directory/server/core/avltree/AvlTreeTest.java",
                "status": "modified",
                "additions": 38,
                "deletions": 0,
                "changes": 38,
                "blob_url": "https://github.com/apache/directory-server/blob/bf3d0982575284c3ae2b5ab19d66be89924c0085/core-avl/src/test/java/org/apache/directory/server/core/avltree/AvlTreeTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/bf3d0982575284c3ae2b5ab19d66be89924c0085/core-avl/src/test/java/org/apache/directory/server/core/avltree/AvlTreeTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core-avl/src/test/java/org/apache/directory/server/core/avltree/AvlTreeTest.java?ref=bf3d0982575284c3ae2b5ab19d66be89924c0085",
                "patch": "@@ -490,4 +490,42 @@ private void traverse( LinkedAvlNode<Integer> startNode, List<LinkedAvlNode<Inte\n       }\n       //3. post-order\n     }\n+\n+\n+    @Test\n+    public void testRemoveEmptyTree()\n+    {\n+        tree.remove( null );\n+        \n+        assertEquals( 0, tree.getSize() );\n+\n+        tree.remove( 1 );\n+        \n+        assertEquals( 0, tree.getSize() );\n+    }\n+\n+\n+    @Test\n+    public void testRemoveOneNode()\n+    {\n+        tree.insert( 1 );\n+        assertEquals( 1, tree.getSize() );\n+        \n+        tree.remove( 1 );\n+        assertEquals( 0, tree.getSize() );\n+    }\n+\n+\n+    @Test\n+    public void testRemoveOneNodeWithRight()\n+    {\n+        tree.insert( 1 );\n+        tree.insert( 2 );\n+        assertEquals( 2, tree.getSize() );\n+        assertEquals( \"1,2\", getInorderForm() );\n+        \n+        tree.remove( 1 );\n+        assertEquals( 1, tree.getSize() );\n+        assertEquals( Integer.valueOf( 2 ), tree.getRoot().getKey() );\n+    }\n }"
            },
            {
                "sha": "b24e8e036180e035cef03ad9fa018f071b8bd029",
                "filename": "core/src/main/java/org/apache/directory/server/core/DefaultOperationManager.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/directory-server/blob/bf3d0982575284c3ae2b5ab19d66be89924c0085/core/src/main/java/org/apache/directory/server/core/DefaultOperationManager.java",
                "raw_url": "https://github.com/apache/directory-server/raw/bf3d0982575284c3ae2b5ab19d66be89924c0085/core/src/main/java/org/apache/directory/server/core/DefaultOperationManager.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/directory/server/core/DefaultOperationManager.java?ref=bf3d0982575284c3ae2b5ab19d66be89924c0085",
                "patch": "@@ -265,8 +265,8 @@ public void add( AddOperationContext opContext ) throws Exception\n             pop();\n         }\n \n-        LOG.debug( \"<< AddOperation successfull\" );\n-        LOG_CHANGES.debug( \"<< AddOperation successfull\" );\n+        LOG.debug( \"<< AddOperation successful\" );\n+        LOG_CHANGES.debug( \"<< AddOperation successful\" );\n     }\n \n "
            },
            {
                "sha": "ab5bc1da98432555854e55c1a0bea5058f095f23",
                "filename": "jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmStore.java",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/apache/directory-server/blob/bf3d0982575284c3ae2b5ab19d66be89924c0085/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmStore.java",
                "raw_url": "https://github.com/apache/directory-server/raw/bf3d0982575284c3ae2b5ab19d66be89924c0085/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmStore.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmStore.java?ref=bf3d0982575284c3ae2b5ab19d66be89924c0085",
                "patch": "@@ -1160,9 +1160,12 @@ private void addAliasIndices( Long aliasId, LdapDN aliasDn, String aliasTarget )\n \n     /**\n      * {@inheritDoc}\n+     * TODO : We should be able to revert all the changes made to index \n+     * if something went wrong. Also the index should auto-repair : if\n+     * an entry does not exist in the Master table, then the index must be updated to reflect this.\n      */\n     @SuppressWarnings(\"unchecked\")\n-    public void add( ServerEntry entry ) throws Exception\n+    public synchronized void add( ServerEntry entry ) throws Exception\n     {\n         if ( entry instanceof ClonedServerEntry )\n         {\n@@ -1210,7 +1213,6 @@ public void add( ServerEntry entry ) throws Exception\n \n         // Start adding the system userIndices\n         // Why bother doing a lookup if this is not an alias.\n-\n         // First, the ObjectClass index\n         for ( Value<?> value : objectClass )\n         {\n@@ -1306,7 +1308,7 @@ public ServerEntry lookup( Long id ) throws Exception\n     /**\n      * {@inheritDoc}\n      */\n-    public void delete( Long id ) throws Exception\n+    public synchronized void delete( Long id ) throws Exception\n     {\n         ServerEntry entry = lookup( id );\n         Long parentId = getParentId( id );"
            },
            {
                "sha": "51db2a4a8429b77a2a8b89b76d3c71abc601a362",
                "filename": "jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmTable.java",
                "status": "modified",
                "additions": 248,
                "deletions": 134,
                "changes": 382,
                "blob_url": "https://github.com/apache/directory-server/blob/bf3d0982575284c3ae2b5ab19d66be89924c0085/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmTable.java",
                "raw_url": "https://github.com/apache/directory-server/raw/bf3d0982575284c3ae2b5ab19d66be89924c0085/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmTable.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/jdbm-store/src/main/java/org/apache/directory/server/core/partition/impl/btree/jdbm/JdbmTable.java?ref=bf3d0982575284c3ae2b5ab19d66be89924c0085",
                "patch": "@@ -35,7 +35,10 @@\n import org.apache.directory.shared.ldap.cursor.Cursor;\n import org.apache.directory.shared.ldap.cursor.EmptyCursor;\n import org.apache.directory.shared.ldap.cursor.SingletonCursor;\n+import org.apache.directory.shared.ldap.util.StringTools;\n import org.apache.directory.shared.ldap.util.SynchronizedLRUMap;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n \n import java.io.IOException;\n import java.util.Comparator;\n@@ -50,30 +53,36 @@\n  */\n public class JdbmTable<K,V> implements Table<K,V>\n {\n-    private static final byte[] EMPTY_BYTES = new byte[0];\n+    /** A logger for this class */\n+    private static final Logger LOG = LoggerFactory.getLogger( JdbmTable.class.getSimpleName() );\n \n     /** the key to store and retreive the count information */\n     private static final String SZSUFFIX = \"_btree_sz\";\n \n     /** the name of this table */\n     private final String name;\n+\n     /** the JDBM record manager for the file this table is managed in */\n     private final RecordManager recMan;\n+    \n     /** whether or not this table allows for duplicates */\n     private final boolean allowsDuplicates;\n+    \n     /** a key comparator for the keys in this Table */\n     private final Comparator<K> keyComparator;\n+    \n     /** a value comparator for the values in this Table */\n     private final Comparator<V> valueComparator;\n \n     /** the current count of entries in this Table */\n     private int count;\n+    \n     /** the wrappedCursor JDBM btree used in this Table */\n     private BTree bt;\n \n-\n     /** the limit at which we start using btree redirection for duplicates */\n     private int numDupLimit = JdbmIndex.DEFAULT_DUPLICATE_LIMIT;\n+\n     /** a cache of duplicate BTrees */\n     private final Map<Long, BTree> duplicateBtrees;\n \n@@ -388,14 +397,14 @@ public V get( K key ) throws Exception\n         jdbm.helper.Tuple tuple = new jdbm.helper.Tuple();\n         tree.browse().getNext( tuple );\n         //noinspection unchecked\n+        \n         return ( V ) tuple.getKey();\n     }\n \n     \n     /**\n      * @see Table#hasGreaterOrEqual(Object,Object)\n      */\n-    @SuppressWarnings(\"unchecked\")\n     public boolean hasGreaterOrEqual( K key, V val ) throws IOException\n     {\n         if ( key == null )\n@@ -410,6 +419,7 @@ public boolean hasGreaterOrEqual( K key, V val ) throws IOException\n         }\n \n         DupsContainer<V> values = getDupsContainer( ( byte[] ) bt.find( key ) );\n+        \n         if ( values.isAvlTree() )\n         {\n             AvlTree<V> set = values.getAvlTree();\n@@ -419,14 +429,14 @@ public boolean hasGreaterOrEqual( K key, V val ) throws IOException\n \n         // last option is to try a btree with BTreeRedirects\n         BTree tree = getBTree( values.getBTreeRedirect() );\n+        \n         return tree.size() != 0 && btreeHas( tree, val, true );\n     }\n \n \n     /**\n      * @see Table#hasLessOrEqual(Object,Object)\n      */\n-    @SuppressWarnings(\"unchecked\")\n     public boolean hasLessOrEqual( K key, V val ) throws IOException\n     {\n         if ( key == null )\n@@ -441,6 +451,7 @@ public boolean hasLessOrEqual( K key, V val ) throws IOException\n         }\n \n         DupsContainer<V> values = getDupsContainer( ( byte[] ) bt.find( key ) );\n+        \n         if ( values.isAvlTree() )\n         {\n             AvlTree<V> set = values.getAvlTree();\n@@ -450,6 +461,7 @@ public boolean hasLessOrEqual( K key, V val ) throws IOException\n \n         // last option is to try a btree with BTreeRedirects\n         BTree tree = getBTree( values.getBTreeRedirect() );\n+        \n         return tree.size() != 0 && btreeHas( tree, val, false );\n     }\n \n@@ -547,6 +559,7 @@ public boolean has( K key, V value ) throws IOException\n         }\n         \n         DupsContainer<V> values = getDupsContainer( ( byte[] ) bt.find( key ) );\n+        \n         if ( values.isAvlTree() )\n         {\n             return values.getAvlTree().find( value ) != null;\n@@ -570,58 +583,92 @@ public boolean has( K key ) throws IOException\n      * java.lang.Object)\n      */\n     @SuppressWarnings(\"unchecked\")\n-    public void put( K key, V value ) throws Exception\n+    public synchronized void put( K key, V value ) throws Exception\n     {\n-        if ( value == null || key == null )\n+        try\n         {\n-            throw new IllegalArgumentException( \"null for key or value is not valid\" );\n-        }\n-        \n-        V replaced;\n-\n-        if ( ! allowsDuplicates )\n-        {\n-            replaced = ( V ) bt.insert( key, value, true );\n-\n-            if ( null == replaced )\n+            if ( LOG.isDebugEnabled() )\n             {\n-                count++;\n+                LOG.debug( \"---> Add {} = {}\", name, key );\n             }\n \n-            return;\n-        }\n-        \n-        DupsContainer<V> values = getDupsContainer( ( byte[] ) bt.find( key ) );\n-        if ( values.isAvlTree() )\n-        {\n-            AvlTree<V> set = values.getAvlTree();\n-            replaced = set.insert( value );\n+            if ( ( value == null ) || ( key == null ) )\n+            {\n+                throw new IllegalArgumentException( \"null for key or value is not valid\" );\n+            }\n             \n-            if ( replaced != null )// if the value already present returns the same value\n+            V replaced;\n+    \n+            if ( ! allowsDuplicates )\n             {\n+                replaced = ( V ) bt.insert( key, value, true );\n+    \n+                if ( null == replaced )\n+                {\n+                    count++;\n+                }\n+    \n+                if ( LOG.isDebugEnabled() )\n+                {\n+                    LOG.debug( \"<--- Add ONE {} = {}\", name, key );\n+                }\n+                \n+                return;\n+            }\n+            \n+            DupsContainer<V> values = getDupsContainer( ( byte[] ) bt.find( key ) );\n+            \n+            if ( values.isAvlTree() )\n+            {\n+                AvlTree<V> set = values.getAvlTree();\n+                replaced = set.insert( value );\n+                \n+                if ( replaced != null )// if the value already present returns the same value\n+                {\n+                    return;\n+                }\n+                if ( set.getSize() > numDupLimit )\n+                {\n+                    BTree tree = convertToBTree( set );\n+                    BTreeRedirect redirect = new BTreeRedirect( tree.getRecid() );\n+                    bt.insert( key, BTreeRedirectMarshaller.INSTANCE.serialize( redirect ), true );\n+                    \n+                    if ( LOG.isDebugEnabled() )\n+                    {\n+                        LOG.debug( \"<--- Add new BTREE {} = {}\", name, key );\n+                    }\n+                }\n+                else\n+                {\n+                    bt.insert( key, marshaller.serialize( set ), true );\n+                    \n+                    if ( LOG.isDebugEnabled() )\n+                    {\n+                        LOG.debug( \"<--- Add AVL {} = {}\", name, key );\n+                    }\n+                }\n+    \n+                count++;\n                 return;\n             }\n-            if ( set.getSize() > numDupLimit )\n+            \n+            BTree tree = getBTree( values.getBTreeRedirect() );\n+            replaced = ( V ) tree.insert( value, StringTools.EMPTY_BYTES, true );\n+            \n+            if ( replaced == null )\n             {\n-                BTree tree = convertToBTree( set );\n-                BTreeRedirect redirect = new BTreeRedirect( tree.getRecid() );\n-                bt.insert( key, BTreeRedirectMarshaller.INSTANCE.serialize( redirect ), true );\n+                count++;\n             }\n-            else\n+            \n+            if ( LOG.isDebugEnabled() )\n             {\n-                bt.insert( key, marshaller.serialize( set ), true );\n+                LOG.debug( \"<--- Add BTREE {} = {}\", name, key );\n             }\n-\n-            count++;\n-            return;\n         }\n-        \n-        BTree tree = getBTree( values.getBTreeRedirect() );\n-        replaced = ( V ) tree.insert( value, EMPTY_BYTES, true );\n-        \n-        if ( replaced == null )\n+        catch ( Exception e )\n         {\n-            count++;\n+            LOG.error( \"Error while adding \" + key + \" on table \" + name, e );\n+            throw e;\n         }\n     }\n     \n@@ -631,110 +678,187 @@ public void put( K key, V value ) throws Exception\n      * java.lang.Object)\n      */\n     @SuppressWarnings(\"unchecked\")\n-    public void remove( K key, V value ) throws IOException\n+    public synchronized void remove( K key, V value ) throws IOException\n     {\n-        if ( key == null )\n+        try\n         {\n-            return;\n-        }\n-\n-        if ( ! allowsDuplicates )\n-        {\n-            V oldValue = ( V ) bt.find( key );\n-        \n-            // Remove the value only if it is the same as value.\n-            if ( ( oldValue != null ) && oldValue.equals( value ) )\n+            if ( LOG.isDebugEnabled() )\n+            {\n+                LOG.debug( \"---> Remove \" + name + \" = \" + key + \", \" + value );\n+            }\n+            \n+            if ( key == null )\n             {\n-                bt.remove( key );\n-                count--;\n+                if ( LOG.isDebugEnabled() )\n+                {\n+                    LOG.debug( \"<--- Remove NULL key \" + name );\n+                }\n                 return;\n             }\n-\n-            return;\n-        }\n-\n-        DupsContainer<V> values = getDupsContainer( ( byte[] ) bt.find( key ) );\n-        \n-        if ( values.isAvlTree() )\n-        {\n-            AvlTree<V> set = values.getAvlTree();\n-\n-            // If removal succeeds then remove if set is empty else replace it\n-            if ( set.remove( value ) != null )\n+    \n+            if ( ! allowsDuplicates )\n             {\n-                if ( set.isEmpty() )\n+                V oldValue = ( V ) bt.find( key );\n+            \n+                // Remove the value only if it is the same as value.\n+                if ( ( oldValue != null ) && oldValue.equals( value ) )\n                 {\n                     bt.remove( key );\n+                    count--;\n+                    \n+                    if ( LOG.isDebugEnabled() )\n+                    {\n+                        LOG.debug( \"<--- Remove ONE \" + name + \" = \" + key + \", \" + value );\n+                    }\n+                    \n+                    return;\n                 }\n-                else\n+    \n+                return;\n+            }\n+    \n+            DupsContainer<V> values = getDupsContainer( ( byte[] ) bt.find( key ) );\n+            \n+            if ( values.isAvlTree() )\n+            {\n+                AvlTree<V> set = values.getAvlTree();\n+    \n+                // If removal succeeds then remove if set is empty else replace it\n+                if ( set.remove( value ) != null )\n                 {\n-                    bt.insert( key, marshaller.serialize( set ), true );\n+                    if ( set.isEmpty() )\n+                    {\n+                        bt.remove( key );\n+                    }\n+                    else\n+                    {\n+                        bt.insert( key, marshaller.serialize( set ), true );\n+                    }\n+                    count--;\n+\n+                    if ( LOG.isDebugEnabled() )\n+                    {\n+                        LOG.debug( \"<--- Remove AVL \" + name + \" = \" + key + \", \" + value );\n+                    }\n+                    \n+                    return;\n                 }\n-                count--;\n+    \n                 return;\n             }\n-\n-            return;\n-        }\n-\n-        // if the number of duplicates falls below the numDupLimit value\n-        BTree tree = getBTree( values.getBTreeRedirect() );\n-        \n-        if ( removeDupFromBTree( tree, value ) )\n-        {\n-            /*\n-             * If we drop below the duplicate limit then we revert from using\n-             * a Jdbm BTree to using an in memory AvlTree.\n-             */\n-            if ( tree.size() <= numDupLimit )\n+    \n+            // if the number of duplicates falls below the numDupLimit value\n+            BTree tree = getBTree( values.getBTreeRedirect() );\n+            \n+            if ( tree.find( value ) != null )\n             {\n-                AvlTree<V> avlTree = convertToAvlTree( tree );\n-                bt.insert( key, marshaller.serialize( avlTree ), true );\n-                recMan.delete( tree.getRecid() );\n+                if ( tree.remove( value ) != null )\n+                {\n+                    /*\n+                     * If we drop below the duplicate limit then we revert from using\n+                     * a Jdbm BTree to using an in memory AvlTree.\n+                     */\n+                    if ( tree.size() <= numDupLimit )\n+                    {\n+                        AvlTree<V> avlTree = convertToAvlTree( tree );\n+                        bt.insert( key, marshaller.serialize( avlTree ), true );\n+                        recMan.delete( tree.getRecid() );\n+                    }\n+                    \n+                    count--;\n+                    \n+                    if ( LOG.isDebugEnabled() )\n+                    {\n+                        LOG.debug( \"<--- Remove BTREE \" + name + \" = \" + key + \", \" + value );\n+                    }\n+                    \n+                    return;\n+                }\n             }\n-            \n-            count--;\n-            return;\n+        }\n+        catch ( Exception e )\n+        {\n+            LOG.error( \"Error while adding \" + key + \", \" + value + \" on table \" + name, e );\n         }\n     }\n \n \n     /**\n      * @see Table#remove(Object)\n      */\n-    public void remove( K key ) throws IOException\n+    public synchronized void remove( K key ) throws IOException\n     {\n-        if ( key == null )\n-        {\n-            return;\n-        }\n-\n-        Object returned = bt.remove( key );\n-\n-        if ( null == returned )\n+        try\n         {\n-            return;\n-        }\n-\n-        if ( ! allowsDuplicates )\n-        {\n-            this.count--;\n-            return;\n-        }\n-\n-        byte[] serialized = ( byte[] ) returned;\n-\n-        if ( BTreeRedirectMarshaller.isRedirect( serialized ) )\n-        {\n-            BTree tree = getBTree( BTreeRedirectMarshaller.INSTANCE.deserialize( serialized ) );\n-            this.count -= tree.size();\n-            return;\n+            if ( LOG.isDebugEnabled() )\n+            {\n+                LOG.debug( \"---> Remove {} = {}\", name, key );\n+            }\n+            \n+            if ( key == null )\n+            {\n+                return;\n+            }\n+    \n+            Object returned = bt.remove( key );\n+    \n+            if ( null == returned )\n+            {\n+                if ( LOG.isDebugEnabled() )\n+                {\n+                    LOG.debug( \"<--- Remove AVL {} = {} (not found)\", name, key );\n+                }\n+                \n+                return;\n+            }\n+    \n+            if ( ! allowsDuplicates )\n+            {\n+                this.count--;\n+             \n+                if ( LOG.isDebugEnabled() )\n+                {\n+                    LOG.debug( \"<--- Remove ONE {} = {}\", name, key );\n+                }\n+                \n+                return;\n+            }\n+    \n+            byte[] serialized = ( byte[] ) returned;\n+    \n+            if ( BTreeRedirectMarshaller.isRedirect( serialized ) )\n+            {\n+                BTree tree = getBTree( BTreeRedirectMarshaller.INSTANCE.deserialize( serialized ) );\n+                this.count -= tree.size();\n+                \n+                if ( LOG.isDebugEnabled() )\n+                {\n+                    LOG.debug( \"<--- Remove BTree {} = {}\", name, key );\n+                }\n+                \n+                return;\n+            }\n+            else\n+            {\n+                AvlTree<V> set = marshaller.deserialize( serialized );\n+                this.count -= set.getSize();\n+    \n+                if ( LOG.isDebugEnabled() )\n+                {\n+                    LOG.debug( \"<--- Remove AVL {} = {}\", name, key );\n+                }\n+                \n+                return;\n+            }\n         }\n-        else\n+        catch ( Exception e )\n         {\n-            AvlTree<V> set = marshaller.deserialize( serialized );\n-            this.count -= set.getSize();\n-            return;\n+            LOG.error(  \"Exception while removing \" + key + \" from index \" + name, e );\n+            \n+            if ( e instanceof IOException )\n+            {\n+                throw (IOException)e;\n+            }\n         }\n     }\n \n@@ -833,7 +957,7 @@ public synchronized void close() throws IOException\n      *\n      * @throws IOException if errors are encountered on the flush\n      */\n-    public void sync() throws IOException\n+    public synchronized void sync() throws IOException\n     {\n         long recId = recMan.getNamedObject( name + SZSUFFIX );\n         recMan.update( recId, count );\n@@ -849,8 +973,6 @@ public void sync() throws IOException\n     // ------------------------------------------------------------------------\n     // Private/Package Utility Methods \n     // ------------------------------------------------------------------------\n-\n-\n     DupsContainer<V> getDupsContainer( byte[] serialized ) throws IOException\n     {\n         if ( serialized == null )\n@@ -928,23 +1050,13 @@ private boolean btreeHas( BTree tree, V key, boolean isGreaterThan ) throws IOEx\n     }\n \n \n-    private boolean removeDupFromBTree( BTree tree, V value ) throws IOException\n-    {\n-        Object removed = null;\n-        if ( tree.find( value ) != null )\n-        {\n-            removed = tree.remove( value );\n-        }\n-        return null != removed;\n-    }\n-\n-\n     @SuppressWarnings(\"unchecked\")\n     private AvlTree<V> convertToAvlTree( BTree bTree ) throws IOException\n     {\n         AvlTree<V> avlTree = new AvlTree<V>( valueComparator );\n         TupleBrowser browser = bTree.browse();\n         jdbm.helper.Tuple tuple = new jdbm.helper.Tuple();\n+        \n         while ( browser.getNext( tuple ) )\n         {\n             avlTree.insert( ( V ) tuple.getKey() );\n@@ -969,10 +1081,12 @@ private BTree convertToBTree( AvlTree<V> avlTree ) throws Exception\n \n         Cursor<V> keys = new AvlTreeCursor<V>( avlTree );\n         keys.beforeFirst();\n+        \n         while ( keys.next() )\n         {\n-            bTree.insert( keys.get(), EMPTY_BYTES, true );\n+            bTree.insert( keys.get(), StringTools.EMPTY_BYTES, true );\n         }\n+        \n         return bTree;\n     }\n }"
            },
            {
                "sha": "4d2a0af53b21fa1e5ed7bb5d71e5d63ec2b81a3f",
                "filename": "jdbm/src/main/java/jdbm/recman/CacheRecordManager.java",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/apache/directory-server/blob/bf3d0982575284c3ae2b5ab19d66be89924c0085/jdbm/src/main/java/jdbm/recman/CacheRecordManager.java",
                "raw_url": "https://github.com/apache/directory-server/raw/bf3d0982575284c3ae2b5ab19d66be89924c0085/jdbm/src/main/java/jdbm/recman/CacheRecordManager.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/jdbm/src/main/java/jdbm/recman/CacheRecordManager.java?ref=bf3d0982575284c3ae2b5ab19d66be89924c0085",
                "patch": "@@ -267,6 +267,14 @@ public synchronized Object fetch( long recid, Serializer serializer )\n                 throw new WrappedRuntimeException( except );\n             }\n         }\n+        \n+        if ( entry._obj instanceof byte[] )\n+        {\n+            byte[] copy = new byte[((byte[])entry._obj).length];\n+            System.arraycopy( entry._obj, 0, copy, 0, ((byte[])entry._obj).length );\n+            return copy;\n+        }\n+        \n         return entry._obj;\n     }\n "
            },
            {
                "sha": "37581bd51a8937d909896eba3e27d2b735d738d0",
                "filename": "protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/extended/LaunchDiagnosticUiHandler.java",
                "status": "modified",
                "additions": 18,
                "deletions": 9,
                "changes": 27,
                "blob_url": "https://github.com/apache/directory-server/blob/bf3d0982575284c3ae2b5ab19d66be89924c0085/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/extended/LaunchDiagnosticUiHandler.java",
                "raw_url": "https://github.com/apache/directory-server/raw/bf3d0982575284c3ae2b5ab19d66be89924c0085/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/extended/LaunchDiagnosticUiHandler.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/protocol-ldap/src/main/java/org/apache/directory/server/ldap/handlers/extended/LaunchDiagnosticUiHandler.java?ref=bf3d0982575284c3ae2b5ab19d66be89924c0085",
                "patch": "@@ -104,15 +104,24 @@ public void handleExtendedOperation( LdapSession requestor, InternalExtendedRequ\n             \n             if ( partition instanceof BTreePartition )\n             {\n-                BTreePartition btPartition = ( BTreePartition ) partition;\n-                PartitionFrame frame = new PartitionFrame( btPartition, service.getRegistries() );\n-                Point pos = getCenteredPosition( frame );\n-                pos.y = launchedWindowCount * 20 + pos.y;\n-                double multiplier = getAspectRatio() * 20.0;\n-                pos.x = ( int ) ( launchedWindowCount * multiplier ) + pos.x;\n-                frame.setLocation( pos );\n-                frame.setVisible( true );\n-                launchedWindowCount++;\n+                try\n+                {\n+                    BTreePartition btPartition = ( BTreePartition ) partition;\n+                    // TODO : If a partition does not have an initial entry associated, we wil:\n+                    // get a NPE : this has to be fixed.\n+                    PartitionFrame frame = new PartitionFrame( btPartition, service.getRegistries() );\n+                    Point pos = getCenteredPosition( frame );\n+                    pos.y = launchedWindowCount * 20 + pos.y;\n+                    double multiplier = getAspectRatio() * 20.0;\n+                    pos.x = ( int ) ( launchedWindowCount * multiplier ) + pos.x;\n+                    frame.setLocation( pos );\n+                    frame.setVisible( true );\n+                    launchedWindowCount++;\n+                }\n+                catch ( Exception e )\n+                {\n+                    // Continue\n+                }\n             }\n         }\n "
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/f042e1564af6dcff28640fce18ff32b44c71482a",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/c754fc19d01305d3cc00d2d24a50b4aa3a3726a5",
        "message": "changes ...\n\n o added rename, move and combined test cases \n o added modify test cases \n o added more utility functions to the AbstractAuthorizationTest \n o commented out code for requiring grantRemove/grantAdd perms on old RDN\n   deletes in modifyRdn operations that change the RDN - this does not \n   comply with X.501 although it makes a lot of sense\n o OldAuthenticationService now disables itself for its static rules when\n   the basic authorization service is enabled.\n o fixed bug in move operation handling to make sure import/export/rename\n   permissions are correctly mandated for respective overloads \n o fixed bug in AbstractAuthorizationTest: was not looking up operational \n   attribute administrativeRole properly to create subentries under ou=system\n o fixed bug in MicroOperationFilter: filter accepted ACI without testing\n   the presence of all required micro operation permissions.\n o fixed bug in GroupCache: group cache was not properly updating the cache on\n   modify operations on groups that are a groupOfNames and groupOfUniqueNames\n o fixed NPE in GroupCache\n o fixed bug in AuthorizationService in lookup(Name, String[]) where the \n   attribute ids where not being used for nexus lookups.\n\nTODO: \n\n o more testing with different kinds of ACI constructs should add to the total\n   number of tests per operation \n o doco badly needed\n o need to make the code not use the nexus for search list and lookups - the \n   next interceptor should be used\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@321394 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_115",
        "file": [
            {
                "sha": "e60115a8b31bf91b4d12d5220946ba79b1b60b05",
                "filename": "core/src/main/java/org/apache/ldap/server/authz/AuthorizationService.java",
                "status": "modified",
                "additions": 55,
                "deletions": 55,
                "changes": 110,
                "blob_url": "https://github.com/apache/directory-server/blob/f042e1564af6dcff28640fce18ff32b44c71482a/core/src/main/java/org/apache/ldap/server/authz/AuthorizationService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/f042e1564af6dcff28640fce18ff32b44c71482a/core/src/main/java/org/apache/ldap/server/authz/AuthorizationService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/ldap/server/authz/AuthorizationService.java?ref=f042e1564af6dcff28640fce18ff32b44c71482a",
                "patch": "@@ -35,7 +35,6 @@\n import org.apache.ldap.common.aci.ACIItem;\n import org.apache.ldap.common.exception.LdapNamingException;\n import org.apache.ldap.common.message.ResultCodeEnum;\n-import org.apache.ldap.common.util.NamespaceTools;\n \n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n@@ -524,7 +523,7 @@ private void checkLookupAccess( NextInterceptor next, LdapPrincipal user, Name d\n \n     public Attributes lookup( NextInterceptor next, Name dn, String[] attrIds ) throws NamingException\n     {\n-        Attributes entry = nexus.lookup( dn, attrIds );\n+        Attributes entry = nexus.lookup( dn );\n         LdapPrincipal user = ( ( ServerContext ) InvocationStack.getInstance().peek().getCaller() ).getPrincipal();\n \n         if ( user.getName().equalsIgnoreCase( DirectoryPartitionNexus.ADMIN_PRINCIPAL ) || ! enabled )\n@@ -579,32 +578,32 @@ public void modifyRn( NextInterceptor next, Name name, String newRn, boolean del\n         engine.checkPermission( next, userGroups, user.getJndiName(), user.getAuthenticationLevel(), name, null,\n                 null, Collections.singleton( MicroOperation.RENAME ), tuples, entry );\n \n-        if ( deleteOldRn )\n-        {\n-            String oldRn = name.get( name.size() - 1 );\n-            if ( NamespaceTools.hasCompositeComponents( oldRn ) )\n-            {\n-                String[] comps = NamespaceTools.getCompositeComponents( oldRn );\n-                for ( int ii = 0; ii < comps.length; ii++ )\n-                {\n-                    String id = NamespaceTools.getRdnAttribute( comps[ii] );\n-                    String value = NamespaceTools.getRdnValue( comps[ii] );\n-                    engine.checkPermission( next, userGroups, user.getJndiName(),\n-                            user.getAuthenticationLevel(), name, id,\n-                            value, Collections.singleton( MicroOperation.REMOVE ),\n-                            tuples, entry );\n-                }\n-            }\n-            else\n-            {\n-                String id = NamespaceTools.getRdnAttribute( oldRn );\n-                String value = NamespaceTools.getRdnValue( oldRn );\n-                engine.checkPermission( next, userGroups, user.getJndiName(),\n-                        user.getAuthenticationLevel(), name, id,\n-                        value, Collections.singleton( MicroOperation.REMOVE ),\n-                        tuples, entry );\n-            }\n-        }\n+//        if ( deleteOldRn )\n+//        {\n+//            String oldRn = name.get( name.size() - 1 );\n+//            if ( NamespaceTools.hasCompositeComponents( oldRn ) )\n+//            {\n+//                String[] comps = NamespaceTools.getCompositeComponents( oldRn );\n+//                for ( int ii = 0; ii < comps.length; ii++ )\n+//                {\n+//                    String id = NamespaceTools.getRdnAttribute( comps[ii] );\n+//                    String value = NamespaceTools.getRdnValue( comps[ii] );\n+//                    engine.checkPermission( next, userGroups, user.getJndiName(),\n+//                            user.getAuthenticationLevel(), name, id,\n+//                            value, Collections.singleton( MicroOperation.REMOVE ),\n+//                            tuples, entry );\n+//                }\n+//            }\n+//            else\n+//            {\n+//                String id = NamespaceTools.getRdnAttribute( oldRn );\n+//                String value = NamespaceTools.getRdnValue( oldRn );\n+//                engine.checkPermission( next, userGroups, user.getJndiName(),\n+//                        user.getAuthenticationLevel(), name, id,\n+//                        value, Collections.singleton( MicroOperation.REMOVE ),\n+//                        tuples, entry );\n+//            }\n+//        }\n \n         next.modifyRn( name, newRn, deleteOldRn );\n         tupleCache.subentryRenamed( name, newName );\n@@ -635,8 +634,9 @@ public void move( NextInterceptor next, Name oriChildName, Name newParentName, S\n         addSubentryAciTuples( tuples, oriChildName, entry );\n \n         Collection perms = new HashSet();\n-        perms.add( MicroOperation.RENAME );\n+        perms.add( MicroOperation.IMPORT );\n         perms.add( MicroOperation.EXPORT );\n+        perms.add( MicroOperation.RENAME );\n         engine.checkPermission( next, userGroups, user.getJndiName(), user.getAuthenticationLevel(),\n                 oriChildName, null, null, perms, tuples, entry );\n \n@@ -647,32 +647,32 @@ public void move( NextInterceptor next, Name oriChildName, Name newParentName, S\n         engine.checkPermission( next, userGroups, user.getJndiName(), user.getAuthenticationLevel(),\n                 oriChildName, null, null, Collections.singleton( MicroOperation.IMPORT ), tuples, entry );\n \n-        if ( deleteOldRn )\n-        {\n-            String oldRn = oriChildName.get( oriChildName.size() - 1 );\n-            if ( NamespaceTools.hasCompositeComponents( oldRn ) )\n-            {\n-                String[] comps = NamespaceTools.getCompositeComponents( oldRn );\n-                for ( int ii = 0; ii < comps.length; ii++ )\n-                {\n-                    String id = NamespaceTools.getRdnAttribute( comps[ii] );\n-                    String value = NamespaceTools.getRdnValue( comps[ii] );\n-                    engine.checkPermission( next, userGroups, user.getJndiName(),\n-                            user.getAuthenticationLevel(), oriChildName, id,\n-                            value, Collections.singleton( MicroOperation.REMOVE ),\n-                            tuples, entry );\n-                }\n-            }\n-            else\n-            {\n-                String id = NamespaceTools.getRdnAttribute( oldRn );\n-                String value = NamespaceTools.getRdnValue( oldRn );\n-                engine.checkPermission( next, userGroups, user.getJndiName(),\n-                        user.getAuthenticationLevel(), oriChildName, id,\n-                        value, Collections.singleton( MicroOperation.REMOVE ),\n-                        tuples, entry );\n-            }\n-        }\n+//        if ( deleteOldRn )\n+//        {\n+//            String oldRn = oriChildName.get( oriChildName.size() - 1 );\n+//            if ( NamespaceTools.hasCompositeComponents( oldRn ) )\n+//            {\n+//                String[] comps = NamespaceTools.getCompositeComponents( oldRn );\n+//                for ( int ii = 0; ii < comps.length; ii++ )\n+//                {\n+//                    String id = NamespaceTools.getRdnAttribute( comps[ii] );\n+//                    String value = NamespaceTools.getRdnValue( comps[ii] );\n+//                    engine.checkPermission( next, userGroups, user.getJndiName(),\n+//                            user.getAuthenticationLevel(), oriChildName, id,\n+//                            value, Collections.singleton( MicroOperation.REMOVE ),\n+//                            tuples, entry );\n+//                }\n+//            }\n+//            else\n+//            {\n+//                String id = NamespaceTools.getRdnAttribute( oldRn );\n+//                String value = NamespaceTools.getRdnValue( oldRn );\n+//                engine.checkPermission( next, userGroups, user.getJndiName(),\n+//                        user.getAuthenticationLevel(), oriChildName, id,\n+//                        value, Collections.singleton( MicroOperation.REMOVE ),\n+//                        tuples, entry );\n+//            }\n+//        }\n \n         next.move( oriChildName, newParentName, newRn, deleteOldRn );\n         tupleCache.subentryRenamed( oriChildName, newName );"
            },
            {
                "sha": "7279bf8f4717837c86b6828b1f7eec6464099b09",
                "filename": "core/src/main/java/org/apache/ldap/server/authz/GroupCache.java",
                "status": "modified",
                "additions": 22,
                "deletions": 1,
                "changes": 23,
                "blob_url": "https://github.com/apache/directory-server/blob/f042e1564af6dcff28640fce18ff32b44c71482a/core/src/main/java/org/apache/ldap/server/authz/GroupCache.java",
                "raw_url": "https://github.com/apache/directory-server/raw/f042e1564af6dcff28640fce18ff32b44c71482a/core/src/main/java/org/apache/ldap/server/authz/GroupCache.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/ldap/server/authz/GroupCache.java?ref=f042e1564af6dcff28640fce18ff32b44c71482a",
                "patch": "@@ -132,6 +132,21 @@ private Attribute getMemberAttribute( Attributes entry )\n     {\n         Attribute oc = entry.get( OC_ATTR );\n \n+        if ( oc == null )\n+        {\n+            if ( entry.get( MEMBER_ATTR ) != null )\n+            {\n+                return entry.get( MEMBER_ATTR );\n+            }\n+\n+            if ( entry.get( UNIQUEMEMBER_ATTR ) != null )\n+            {\n+                return entry.get( UNIQUEMEMBER_ATTR );\n+            }\n+\n+            return null;\n+        }\n+\n         if ( oc.contains( GROUPOFNAMES_OC ) )\n         {\n             return entry.get( MEMBER_ATTR );\n@@ -320,7 +335,7 @@ public void groupModified( Name name, ModificationItem[] mods, Attributes entry\n      */\n     public void groupModified( Name name, int modOp, Attributes mods, Attributes entry ) throws NamingException\n     {\n-        Attribute members = getMemberAttribute( entry );\n+        Attribute members = getMemberAttribute( mods );\n \n         if ( members == null )\n         {\n@@ -353,6 +368,12 @@ public Set getGroups( String member ) throws NamingException\n         {\n             String group = ( String ) list.next();\n             Set members = ( Set ) groups.get( group );\n+\n+            if ( members == null )\n+            {\n+                continue;\n+            }\n+\n             if ( members.contains( member ) )\n             {\n                 if ( memberGroups == null )"
            },
            {
                "sha": "748f69a4c05b87fcb10e0869210f636b4ec84e8f",
                "filename": "core/src/main/java/org/apache/ldap/server/authz/OldAuthorizationService.java",
                "status": "modified",
                "additions": 53,
                "deletions": 28,
                "changes": 81,
                "blob_url": "https://github.com/apache/directory-server/blob/f042e1564af6dcff28640fce18ff32b44c71482a/core/src/main/java/org/apache/ldap/server/authz/OldAuthorizationService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/f042e1564af6dcff28640fce18ff32b44c71482a/core/src/main/java/org/apache/ldap/server/authz/OldAuthorizationService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/ldap/server/authz/OldAuthorizationService.java?ref=f042e1564af6dcff28640fce18ff32b44c71482a",
                "patch": "@@ -76,6 +76,8 @@\n      * the name parser used by this service\n      */\n     private DnParser dnParser;\n+    private boolean enabled = true;\n+\n \n \n     /**\n@@ -90,6 +92,9 @@ public void init( DirectoryServiceConfiguration factoryCfg, InterceptorConfigura\n     {\n         AttributeTypeRegistry atr = factoryCfg.getGlobalRegistries().getAttributeTypeRegistry();\n         dnParser = new DnParser( new ConcreteNameComponentNormalizer( atr ) );\n+\n+        // disable this static module if basic access control mechanisms are enabled\n+        enabled = ! factoryCfg.getStartupConfiguration().isAccessControlEnabled();\n     }\n \n \n@@ -99,6 +104,12 @@ public void init( DirectoryServiceConfiguration factoryCfg, InterceptorConfigura\n \n     public void delete( NextInterceptor nextInterceptor, Name name ) throws NamingException\n     {\n+        if ( !enabled )\n+        {\n+            nextInterceptor.delete( name );\n+            return;\n+        }\n+\n         Name principalDn = getPrincipal().getJndiName();\n \n         if ( name.toString().equals( \"\" ) )\n@@ -162,7 +173,11 @@ public boolean hasEntry( NextInterceptor nextInterceptor, Name name ) throws Nam\n      */\n     public void modify( NextInterceptor nextInterceptor, Name name, int modOp, Attributes attrs ) throws NamingException\n     {\n-        protectModifyAlterations( name );\n+        if ( enabled )\n+        {\n+            protectModifyAlterations( name );\n+        }\n+\n         nextInterceptor.modify( name, modOp, attrs );\n     }\n \n@@ -175,7 +190,10 @@ public void modify( NextInterceptor nextInterceptor, Name name, int modOp, Attri\n      */\n     public void modify( NextInterceptor nextInterceptor, Name name, ModificationItem[] items ) throws NamingException\n     {\n-        protectModifyAlterations( name );\n+        if ( enabled )\n+        {\n+            protectModifyAlterations( name );\n+        }\n         nextInterceptor.modify( name, items );\n     }\n \n@@ -192,13 +210,6 @@ private void protectModifyAlterations( Name dn ) throws LdapNoPermissionExceptio\n \n         if ( !principalDn.equals( ADMIN_DN ) )\n         {\n-            if ( dn == ADMIN_DN || dn.equals( ADMIN_DN ) )\n-            {\n-                String msg = \"User \" + principalDn;\n-                msg += \" does not have permission to modify the admin account.\";\n-                throw new LdapNoPermissionException( msg );\n-            }\n-\n             if ( dn.size() > 2 && dn.startsWith( USER_BASE_DN ) )\n             {\n                 String msg = \"User \" + principalDn;\n@@ -232,14 +243,20 @@ private void protectModifyAlterations( Name dn ) throws LdapNoPermissionExceptio\n \n     public void modifyRn( NextInterceptor nextInterceptor, Name name, String newRn, boolean deleteOldRn ) throws NamingException\n     {\n-        protectDnAlterations( name );\n+        if ( enabled )\n+        {\n+            protectDnAlterations( name );\n+        }\n         nextInterceptor.modifyRn( name, newRn, deleteOldRn );\n     }\n \n \n     public void move( NextInterceptor nextInterceptor, Name oriChildName, Name newParentName ) throws NamingException\n     {\n-        protectDnAlterations( oriChildName );\n+        if ( enabled )\n+        {\n+            protectDnAlterations( oriChildName );\n+        }\n         nextInterceptor.move( oriChildName, newParentName );\n     }\n \n@@ -248,7 +265,10 @@ public void move( NextInterceptor nextInterceptor,\n             Name oriChildName, Name newParentName, String newRn,\n             boolean deleteOldRn ) throws NamingException\n     {\n-        protectDnAlterations( oriChildName );\n+        if ( enabled )\n+        {\n+            protectDnAlterations( oriChildName );\n+        }\n         nextInterceptor.move( oriChildName, newParentName, newRn, deleteOldRn );\n     }\n \n@@ -294,9 +314,9 @@ private void protectDnAlterations( Name dn ) throws LdapNoPermissionException\n     public Attributes lookup( NextInterceptor nextInterceptor, Name name ) throws NamingException\n     {\n         Attributes attributes = nextInterceptor.lookup( name );\n-        if ( attributes == null )\n+        if ( ! enabled || attributes == null )\n         {\n-            return null;\n+            return attributes;\n         }\n \n         protectLookUp( name );\n@@ -307,9 +327,9 @@ public Attributes lookup( NextInterceptor nextInterceptor, Name name ) throws Na\n     public Attributes lookup( NextInterceptor nextInterceptor, Name name, String[] attrIds ) throws NamingException\n     {\n         Attributes attributes = nextInterceptor.lookup( name, attrIds );\n-        if ( attributes == null )\n+        if ( ! enabled || attributes == null )\n         {\n-            return null;\n+            return attributes;\n         }\n \n         protectLookUp( name );\n@@ -375,31 +395,36 @@ public NamingEnumeration search( NextInterceptor nextInterceptor,\n             SearchControls searchCtls ) throws NamingException\n     {\n         NamingEnumeration e = nextInterceptor.search( base, env, filter, searchCtls );\n+        if ( !enabled )\n+        {\n+            return e;\n+        }\n         //if ( searchCtls.getReturningAttributes() != null )\n         //{\n         //    return null;\n         //}\n         \n-        LdapContext ctx =\n-            ( LdapContext ) InvocationStack.getInstance().peek().getCaller();\n+        LdapContext ctx = ( LdapContext ) InvocationStack.getInstance().peek().getCaller();\n         return new SearchResultFilteringEnumeration( e, searchCtls, ctx,\n-                new SearchResultFilter()\n+            new SearchResultFilter()\n+            {\n+                public boolean accept( LdapContext ctx, SearchResult result, SearchControls controls )\n+                        throws NamingException\n                 {\n-                    public boolean accept( LdapContext ctx, SearchResult result,\n-                                           SearchControls controls )\n-                            throws NamingException\n-                    {\n-                        return OldAuthorizationService.this.isSearchable( ctx, result );\n-                    }\n-                } );\n+                    return OldAuthorizationService.this.isSearchable( ctx, result );\n+                }\n+            });\n     }\n \n \n     public NamingEnumeration list( NextInterceptor nextInterceptor, Name base ) throws NamingException\n     {\n         NamingEnumeration e = nextInterceptor.list( base );\n-        LdapContext ctx =\n-            ( LdapContext ) InvocationStack.getInstance().peek().getCaller();\n+        if ( !enabled )\n+        {\n+            return e;\n+        }\n+        LdapContext ctx = ( LdapContext ) InvocationStack.getInstance().peek().getCaller();\n         \n         return new SearchResultFilteringEnumeration( e, null, ctx,\n             new SearchResultFilter()"
            },
            {
                "sha": "9fb182c4de748d779e02ddf72ea8dbb0070d3607",
                "filename": "core/src/main/java/org/apache/ldap/server/authz/support/MicroOperationFilter.java",
                "status": "modified",
                "additions": 15,
                "deletions": 4,
                "changes": 19,
                "blob_url": "https://github.com/apache/directory-server/blob/f042e1564af6dcff28640fce18ff32b44c71482a/core/src/main/java/org/apache/ldap/server/authz/support/MicroOperationFilter.java",
                "raw_url": "https://github.com/apache/directory-server/raw/f042e1564af6dcff28640fce18ff32b44c71482a/core/src/main/java/org/apache/ldap/server/authz/support/MicroOperationFilter.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/ldap/server/authz/support/MicroOperationFilter.java?ref=f042e1564af6dcff28640fce18ff32b44c71482a",
                "patch": "@@ -40,7 +40,11 @@\n  */\n public class MicroOperationFilter implements ACITupleFilter\n {\n-    public Collection filter( Collection tuples, OperationScope scope, NextInterceptor next, Collection userGroupNames, Name userName, Attributes userEntry, AuthenticationLevel authenticationLevel, Name entryName, String attrId, Object attrValue, Attributes entry, Collection microOperations ) throws NamingException\n+    public Collection filter( Collection tuples, OperationScope scope, NextInterceptor next,\n+                              Collection userGroupNames, Name userName, Attributes userEntry,\n+                              AuthenticationLevel authenticationLevel, Name entryName, String attrId,\n+                              Object attrValue, Attributes entry, Collection microOperations )\n+            throws NamingException\n     {\n         if( tuples.size() == 0 )\n         {\n@@ -50,13 +54,20 @@ public Collection filter( Collection tuples, OperationScope scope, NextIntercept\n         for( Iterator i = tuples.iterator(); i.hasNext(); )\n         {\n             ACITuple tuple = ( ACITuple ) i.next();\n-            boolean retain = false;\n+\n+            /*\n+             * The ACITuple must contain all the MicroOperations specified within the\n+             * microOperations argument.  Just matching a single microOperation is not\n+             * enough.  All must be matched to retain the ACITuple.\n+             */\n+\n+            boolean retain = true;\n             for( Iterator j = microOperations.iterator(); j.hasNext(); )\n             {\n                 MicroOperation microOp = ( MicroOperation ) j.next();\n-                if( tuple.getMicroOperations().contains( microOp ) )\n+                if( ! tuple.getMicroOperations().contains( microOp ) )\n                 {\n-                    retain = true;\n+                    retain = false;\n                     break;\n                 }\n             }"
            },
            {
                "sha": "a66fbaffc807e435db128f5e164b7adbccbdf327",
                "filename": "core/src/test/org/apache/ldap/server/authz/AbstractAuthorizationTest.java",
                "status": "modified",
                "additions": 39,
                "deletions": 1,
                "changes": 40,
                "blob_url": "https://github.com/apache/directory-server/blob/f042e1564af6dcff28640fce18ff32b44c71482a/core/src/test/org/apache/ldap/server/authz/AbstractAuthorizationTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/f042e1564af6dcff28640fce18ff32b44c71482a/core/src/test/org/apache/ldap/server/authz/AbstractAuthorizationTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/test/org/apache/ldap/server/authz/AbstractAuthorizationTest.java?ref=f042e1564af6dcff28640fce18ff32b44c71482a",
                "patch": "@@ -113,6 +113,20 @@ public Name createGroup( String cn, String firstMemberDn ) throws NamingExceptio\n     }\n \n \n+    /**\n+     * Deletes a user with a specific UID under ou=users,ou=system.\n+     *\n+     * @param uid the RDN value for the user to delete\n+     * @throws NamingException if there are problems removing the user\n+     * i.e. user does not exist\n+     */\n+    public void deleteUser( String uid ) throws NamingException\n+    {\n+        DirContext adminCtx = getContextAsAdmin();\n+        adminCtx.destroySubcontext( \"uid=\"+uid+\",ou=users\" );\n+    }\n+\n+\n     /**\n      * Creates a simple user as an inetOrgPerson under the ou=users,ou=system\n      * container.  The user's RDN attribute is the uid argument.  This argument\n@@ -159,6 +173,23 @@ public void addUserToGroup( String userUid, String groupCn ) throws NamingExcept\n     }\n \n \n+    /**\n+     * Removes a user from a group.\n+     *\n+     * @param userUid the RDN attribute value of the user to remove from the group\n+     * @param groupCn the RDN attribute value of the group to have user removed from\n+     * @throws NamingException if there are problems accessing the group\n+     */\n+    public void removeUserFromGroup( String userUid, String groupCn ) throws NamingException\n+    {\n+        DirContext adminCtx = getContextAsAdmin();\n+        Attributes changes = new BasicAttributes( \"uniqueMember\",\n+                \"uid=\"+userUid+\",ou=users,ou=system\", true );\n+        adminCtx.modifyAttributes( \"cn=\"+groupCn+\",ou=groups\",\n+                DirContext.REMOVE_ATTRIBUTE, changes );\n+    }\n+\n+\n     /**\n      * Gets the context at ou=system as a specific user.\n      *\n@@ -193,6 +224,13 @@ public DirContext getContextAs( Name user, String password, String dn ) throws N\n     }\n \n \n+    public void deleteAccessControlSubentry( String cn ) throws NamingException\n+    {\n+        DirContext adminCtx = getContextAsAdmin();\n+        adminCtx.destroySubcontext( \"cn=\" + cn );\n+    }\n+\n+\n     /**\n      * Creates an access control subentry under ou=system whose subtree covers\n      * the entire naming context.\n@@ -206,7 +244,7 @@ public void createAccessControlSubentry( String cn, String aciItem ) throws Nami\n         DirContext adminCtx = getContextAsAdmin();\n \n         // modify ou=system to be an AP for an A/C AA if it is not already\n-        Attributes ap = adminCtx.getAttributes( \"\" );\n+        Attributes ap = adminCtx.getAttributes( \"\", new String[] { \"administrativeRole\" } );\n         Attribute administrativeRole = ap.get( \"administrativeRole\" );\n         if ( administrativeRole == null || ! administrativeRole.contains( SubentryService.AC_AREA ) )\n         {"
            },
            {
                "sha": "3aa3e232d3241d259b1db00b05ec96e9bf865aa2",
                "filename": "core/src/test/org/apache/ldap/server/authz/ModifyAuthorizationTest.java",
                "status": "added",
                "additions": 544,
                "deletions": 0,
                "changes": 544,
                "blob_url": "https://github.com/apache/directory-server/blob/f042e1564af6dcff28640fce18ff32b44c71482a/core/src/test/org/apache/ldap/server/authz/ModifyAuthorizationTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/f042e1564af6dcff28640fce18ff32b44c71482a/core/src/test/org/apache/ldap/server/authz/ModifyAuthorizationTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/test/org/apache/ldap/server/authz/ModifyAuthorizationTest.java?ref=f042e1564af6dcff28640fce18ff32b44c71482a",
                "patch": "@@ -0,0 +1,544 @@\n+/*\n+ *   Copyright 2004 The Apache Software Foundation\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ *\n+ */\n+package org.apache.ldap.server.authz;\n+\n+\n+import org.apache.ldap.common.exception.LdapNoPermissionException;\n+import org.apache.ldap.common.name.LdapName;\n+\n+import javax.naming.NamingException;\n+import javax.naming.NamingEnumeration;\n+import javax.naming.Name;\n+import javax.naming.directory.*;\n+import java.util.List;\n+import java.util.ArrayList;\n+\n+\n+/**\n+ * Tests whether or not authorization around entry modify operations work properly.\n+ *\n+ * @author <a href=\"mailto:dev@directory.apache.org\">Apache Directory Project</a>\n+ * @version $Rev$\n+ */\n+public class ModifyAuthorizationTest extends AbstractAuthorizationTest\n+{\n+    /**\n+     * Checks if an attribute of a simple entry (an organizationalUnit) with an RDN\n+     * relative to ou=system can be modified by a specific non-admin user.  If a\n+     * permission exception is encountered it is caught and false is returned,\n+     * otherwise true is returned.  The entry is deleted after being created just in case\n+     * subsequent calls to this method are made in the same test case: the admin account\n+     * is used to add and delete this test entry so permissions to add and delete are not\n+     * required to test the modify operation by the user.\n+     *\n+     * @param uid the unique identifier for the user (presumed to exist under ou=users,ou=system)\n+     * @param password the password of this user\n+     * @param entryRdn the relative DN, relative to ou=system where entry is created\n+     * for modification test\n+     * @param mods the modifications to make to the entry\n+     * @return true if the modifications can be made by the user at the specified location,\n+     * false otherwise.\n+     * @throws javax.naming.NamingException if there are problems conducting the test\n+     */\n+    public boolean checkCanModifyAs( String uid, String password, String entryRdn, ModificationItem[] mods )\n+            throws NamingException\n+    {\n+        // create the entry with the telephoneNumber attribute to modify\n+        Attributes testEntry = new BasicAttributes( \"ou\", \"testou\", true );\n+        Attribute objectClass = new BasicAttribute( \"objectClass\" );\n+        testEntry.put( objectClass );\n+        objectClass.add( \"top\" );\n+        objectClass.add( \"organizationalUnit\" );\n+        testEntry.put( \"telephoneNumber\", \"867-5309\" );  // jenny don't change your number\n+\n+        DirContext adminContext = getContextAsAdmin();\n+\n+        try\n+        {\n+            // create the entry as admin\n+            LdapName userName = new LdapName( \"uid=\"+uid+\",ou=users,ou=system\" );\n+            adminContext.createSubcontext( entryRdn, testEntry );\n+\n+            // modify the entry as the user\n+            DirContext userContext = getContextAs( userName, password );\n+            userContext.modifyAttributes( entryRdn, mods );\n+\n+            return true;\n+        }\n+        catch ( LdapNoPermissionException e )\n+        {\n+            return false;\n+        }\n+        finally\n+        {\n+            // let's clean up\n+            adminContext.destroySubcontext( entryRdn );\n+        }\n+    }\n+\n+\n+    /**\n+     * Checks if an attribute of a simple entry (an organizationalUnit) with an RDN\n+     * relative to ou=system can be modified by a specific non-admin user.  If a\n+     * permission exception is encountered it is caught and false is returned,\n+     * otherwise true is returned.  The entry is deleted after being created just in case\n+     * subsequent calls to this method are made in the same test case: the admin account\n+     * is used to add and delete this test entry so permissions to add and delete are not\n+     * required to test the modify operation by the user.\n+     *\n+     * @param uid the unique identifier for the user (presumed to exist under ou=users,ou=system)\n+     * @param password the password of this user\n+     * @param entryRdn the relative DN, relative to ou=system where entry is created\n+     * for modification test\n+     * @param mods the attributes to modify in the entry\n+     * @param modOp the modification operation to use for all attributes\n+     * @return true if the modifications can be made by the user at the specified location,\n+     * false otherwise.\n+     * @throws javax.naming.NamingException if there are problems conducting the test\n+     */\n+    public boolean checkCanModifyAs( String uid, String password, String entryRdn, int modOp, Attributes mods )\n+            throws NamingException\n+    {\n+        // create the entry with the telephoneNumber attribute to modify\n+        Attributes testEntry = new BasicAttributes( \"ou\", \"testou\", true );\n+        Attribute objectClass = new BasicAttribute( \"objectClass\" );\n+        testEntry.put( objectClass );\n+        objectClass.add( \"top\" );\n+        objectClass.add( \"organizationalUnit\" );\n+        testEntry.put( \"telephoneNumber\", \"867-5309\" );  // jenny don't change your number\n+\n+        DirContext adminContext = getContextAsAdmin();\n+\n+        try\n+        {\n+            // create the entry as admin\n+            LdapName userName = new LdapName( \"uid=\"+uid+\",ou=users,ou=system\" );\n+            adminContext.createSubcontext( entryRdn, testEntry );\n+\n+            // modify the entry as the user\n+            DirContext userContext = getContextAs( userName, password );\n+            userContext.modifyAttributes( entryRdn, modOp, mods );\n+\n+            return true;\n+        }\n+        catch ( LdapNoPermissionException e )\n+        {\n+            return false;\n+        }\n+        finally\n+        {\n+            // let's clean up\n+            adminContext.destroySubcontext( entryRdn );\n+        }\n+    }\n+\n+\n+    /**\n+     * Checks if a user can modify an attribute of their own entry.  Users are\n+     * presumed to reside under ou=users,ou=system.  If a permission exception is\n+     * encountered it is caught and false is returned, otherwise true is returned.\n+     *\n+     * @param uid the unique identifier for the user (presumed to exist under ou=users,ou=system)\n+     * @param password the password of this user\n+     * @param mods the attributes to modify in the entry\n+     * @param modOp the modification operation to use for all attributes\n+     * @return true if the modifications can be made by the user his/her own entry,\n+     * false otherwise.\n+     * @throws javax.naming.NamingException if there are problems conducting the test\n+     */\n+    public boolean checkCanSelfModify( String uid, String password, int modOp, Attributes mods )\n+            throws NamingException\n+    {\n+        try\n+        {\n+            // modify the entry as the user\n+            Name userEntry = new LdapName( \"uid=\"+uid+\",ou=users,ou=system\" );\n+            DirContext userContext = getContextAs( userEntry, password, userEntry.toString() );\n+            userContext.modifyAttributes( \"\", modOp, mods );\n+            return true;\n+        }\n+        catch ( LdapNoPermissionException e )\n+        {\n+            return false;\n+        }\n+    }\n+\n+\n+    /**\n+     * Checks if a user can modify an attribute of their own entry.  Users are\n+     * presumed to reside under ou=users,ou=system.  If a permission exception is\n+     * encountered it is caught and false is returned, otherwise true is returned.\n+     *\n+     * @param uid the unique identifier for the user (presumed to exist under ou=users,ou=system)\n+     * @param password the password of this user\n+     * @param mods the attributes to modify in the entry\n+     * @return true if the modifications can be made by the user his/her own entry,\n+     * false otherwise.\n+     * @throws javax.naming.NamingException if there are problems conducting the test\n+     */\n+    public boolean checkCanSelfModify( String uid, String password, ModificationItem[] mods )\n+            throws NamingException\n+    {\n+        try\n+        {\n+            // modify the entry as the user\n+            Name userEntry = new LdapName( \"uid=\"+uid+\",ou=users,ou=system\" );\n+            DirContext userContext = getContextAs( userEntry, password, userEntry.toString() );\n+            userContext.modifyAttributes( \"\", mods );\n+            return true;\n+        }\n+        catch ( LdapNoPermissionException e )\n+        {\n+            return false;\n+        }\n+    }\n+\n+\n+    /**\n+     * Converts a set of attributes and a modification operation type into a MoficationItem array.\n+     *\n+     * @param modOp the modification operation to perform\n+     * @param changes the modifications to the attribute\n+     * @return the array of modification items represting the changes\n+     * @throws NamingException if there are problems accessing attributes\n+     */\n+    private ModificationItem[] toItems( int modOp, Attributes changes ) throws NamingException\n+    {\n+        List mods = new ArrayList();\n+        NamingEnumeration list = changes.getAll();\n+        while ( list.hasMore() )\n+        {\n+            Attribute attr = ( Attribute ) list.next();\n+            mods.add( new ModificationItem( modOp, attr ) );\n+        }\n+        ModificationItem[] modArray = new ModificationItem[mods.size()];\n+        return ( ModificationItem[] ) mods.toArray( modArray );\n+    }\n+\n+\n+    public void testSelfModification() throws NamingException\n+    {\n+        // ----------------------------------------------------------------------------------\n+        // Modify with Attribute Addition\n+        // ----------------------------------------------------------------------------------\n+\n+        // create the non-admin user\n+        createUser( \"billyd\", \"billyd\" );\n+\n+        // create the password modification\n+        ModificationItem[] mods = toItems( DirContext.REPLACE_ATTRIBUTE,\n+                new BasicAttributes( \"userPassword\", \"williams\", true ) );\n+\n+        // try a modify operation which should fail without any ACI\n+        assertFalse( checkCanSelfModify( \"billyd\", \"billyd\", mods ) );\n+\n+        // Gives grantModify, and grantRead perm to all users in the Administrators group for\n+        // entries and all attribute types and values\n+        createAccessControlSubentry( \"selfModifyUserPassword\",\n+                \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { thisEntry }, \" +\n+                \"userPermissions { \" +\n+                        \"{ protectedItems {entry}, grantsAndDenials { grantModify, grantBrowse, grantRead } }, \" +\n+                        \"{ protectedItems {allAttributeValues {userPassword}}, grantsAndDenials { grantAdd, grantRemove } } \" +\n+                        \"} } }\" );\n+\n+        // try a modify operation which should succeed with ACI\n+        assertTrue( checkCanSelfModify( \"billyd\", \"billyd\", mods ) );\n+        deleteAccessControlSubentry( \"selfModifyUserPassword\" );\n+    }\n+\n+\n+    /**\n+     * Checks to make sure group membership based userClass works for modify operations.\n+     *\n+     * @throws javax.naming.NamingException if the test encounters an error\n+     */\n+    public void testGrantModifyByAdministrators() throws NamingException\n+    {\n+        // ----------------------------------------------------------------------------------\n+        // Modify with Attribute Addition\n+        // ----------------------------------------------------------------------------------\n+\n+        // create the add modifications\n+        ModificationItem[] mods = toItems( DirContext.ADD_ATTRIBUTE,\n+                new BasicAttributes( \"registeredAddress\", \"100 Park Ave.\", true ) );\n+\n+        // create the non-admin user\n+        createUser( \"billyd\", \"billyd\" );\n+\n+        // try a modify operation which should fail without any ACI\n+        assertFalse( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", mods ) );\n+\n+        // Gives grantModify, and grantRead perm to all users in the Administrators group for\n+        // entries and all attribute types and values\n+        createAccessControlSubentry( \"administratorModifyAdd\",\n+                \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { userGroup { \\\"cn=Administrators,ou=groups,ou=system\\\" } }, \" +\n+                \"userPermissions { \" +\n+                        \"{ protectedItems {entry}, grantsAndDenials { grantModify, grantBrowse } }, \" +\n+                        \"{ protectedItems {allAttributeValues {registeredAddress}}, grantsAndDenials { grantAdd } } \" +\n+                        \"} } }\" );\n+\n+        // see if we can now add that test entry which we could not before\n+        // add op should still fail since billd is not in the admin group\n+        assertFalse( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", mods ) );\n+\n+        // now add billyd to the Administrator group and try again\n+        addUserToGroup( \"billyd\", \"Administrators\" );\n+\n+        // try a modify operation which should succeed with ACI and group membership change\n+        assertTrue( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", mods ) );\n+        deleteAccessControlSubentry( \"administratorModifyAdd\" );\n+\n+        // ----------------------------------------------------------------------------------\n+        // Modify with Attribute Removal\n+        // ----------------------------------------------------------------------------------\n+\n+        // now let's test to see if we can perform a modify with a delete op\n+        mods = toItems( DirContext.REMOVE_ATTRIBUTE,\n+                new BasicAttributes( \"telephoneNumber\", \"867-5309\", true ) );\n+\n+        // make sure we cannot remove the telephone number from the test entry\n+        assertFalse( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", mods ) );\n+\n+        // Gives grantModify, and grantRead perm to all users in the Administrators group for\n+        // entries and all attribute types and values\n+        createAccessControlSubentry( \"administratorModifyRemove\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { userGroup { \\\"cn=Administrators,ou=groups,ou=system\\\" } }, \" +\n+                \"userPermissions { \" +\n+                        \"{ protectedItems {entry}, grantsAndDenials { grantModify, grantBrowse } }, \" +\n+                        \"{ protectedItems {allAttributeValues {telephoneNumber}}, grantsAndDenials { grantRemove } } \" +\n+                        \"} } }\" );\n+\n+        // try a modify operation which should succeed with ACI and group membership change\n+        assertTrue( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", mods ) );\n+        deleteAccessControlSubentry( \"administratorModifyRemove\" );\n+\n+        // ----------------------------------------------------------------------------------\n+        // Modify with Attribute Replace (requires both grantRemove and grantAdd on attrs)\n+        // ----------------------------------------------------------------------------------\n+\n+        // now let's test to see if we can perform a modify with a delete op\n+        mods = toItems( DirContext.REPLACE_ATTRIBUTE,\n+                new BasicAttributes( \"telephoneNumber\", \"867-5309\", true ) );\n+\n+        // make sure we cannot remove the telephone number from the test entry\n+        assertFalse( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", mods ) );\n+\n+        // Gives grantModify, and grantRead perm to all users in the Administrators group for\n+        // entries and all attribute types and values\n+        createAccessControlSubentry( \"administratorModifyReplace\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { userGroup { \\\"cn=Administrators,ou=groups,ou=system\\\" } }, \" +\n+                \"userPermissions { \" +\n+                        \"{ protectedItems {entry}, grantsAndDenials { grantModify, grantBrowse } }, \" +\n+                        \"{ protectedItems {allAttributeValues {telephoneNumber}}, grantsAndDenials { grantAdd, grantRemove } } \" +\n+                        \"} } }\" );\n+\n+        // try a modify operation which should succeed with ACI and group membership change\n+        assertTrue( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", mods ) );\n+        deleteAccessControlSubentry( \"administratorModifyReplace\" );\n+\n+        /* =================================================================================\n+         *              DO IT ALL OVER AGAIN BUT USE THE OTHER MODIFY METHOD\n+         * ================================================================================= */\n+\n+        // ----------------------------------------------------------------------------------\n+        // Modify with Attribute Addition\n+        // ----------------------------------------------------------------------------------\n+\n+        // create the add modifications\n+        Attributes changes = new BasicAttributes( \"registeredAddress\", \"100 Park Ave.\", true );\n+\n+        // try a modify operation which should fail without any ACI\n+        assertFalse( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", DirContext.ADD_ATTRIBUTE, changes ) );\n+\n+        // Gives grantModify, and grantRead perm to all users in the Administrators group for\n+        // entries and all attribute types and values\n+        createAccessControlSubentry( \"administratorModifyAdd\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { userGroup { \\\"cn=Administrators,ou=groups,ou=system\\\" } }, \" +\n+                \"userPermissions { \" +\n+                        \"{ protectedItems {entry}, grantsAndDenials { grantModify, grantBrowse } }, \" +\n+                        \"{ protectedItems {allAttributeValues {registeredAddress}}, grantsAndDenials { grantAdd } } \" +\n+                        \"} } }\" );\n+\n+        // try a modify operation which should succeed with ACI and group membership change\n+        assertTrue( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", DirContext.ADD_ATTRIBUTE, changes ) );\n+        deleteAccessControlSubentry( \"administratorModifyAdd\" );\n+\n+        // ----------------------------------------------------------------------------------\n+        // Modify with Attribute Removal\n+        // ----------------------------------------------------------------------------------\n+\n+        // now let's test to see if we can perform a modify with a delete op\n+        changes = new BasicAttributes( \"telephoneNumber\", \"867-5309\", true );\n+\n+        // make sure we cannot remove the telephone number from the test entry\n+        assertFalse( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", DirContext.REMOVE_ATTRIBUTE, changes ) );\n+\n+        // Gives grantModify, and grantRead perm to all users in the Administrators group for\n+        // entries and all attribute types and values\n+        createAccessControlSubentry( \"administratorModifyRemove\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { userGroup { \\\"cn=Administrators,ou=groups,ou=system\\\" } }, \" +\n+                \"userPermissions { \" +\n+                        \"{ protectedItems {entry}, grantsAndDenials { grantModify, grantBrowse } }, \" +\n+                        \"{ protectedItems {allAttributeValues {telephoneNumber}}, grantsAndDenials { grantRemove } } \" +\n+                        \"} } }\" );\n+\n+        // try a modify operation which should succeed with ACI and group membership change\n+        assertTrue( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", DirContext.REMOVE_ATTRIBUTE, changes ) );\n+        deleteAccessControlSubentry( \"administratorModifyRemove\" );\n+\n+        // ----------------------------------------------------------------------------------\n+        // Modify with Attribute Replace (requires both grantRemove and grantAdd on attrs)\n+        // ----------------------------------------------------------------------------------\n+\n+        // now let's test to see if we can perform a modify with a delete op\n+        changes = new BasicAttributes( \"telephoneNumber\", \"867-5309\", true );\n+\n+        // make sure we cannot remove the telephone number from the test entry\n+        assertFalse( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", DirContext.REPLACE_ATTRIBUTE, changes ) );\n+\n+        // Gives grantModify, and grantRead perm to all users in the Administrators group for\n+        // entries and all attribute types and values\n+        createAccessControlSubentry( \"administratorModifyReplace\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { userGroup { \\\"cn=Administrators,ou=groups,ou=system\\\" } }, \" +\n+                \"userPermissions { \" +\n+                        \"{ protectedItems {entry}, grantsAndDenials { grantModify, grantBrowse } }, \" +\n+                        \"{ protectedItems {allAttributeValues {telephoneNumber}}, grantsAndDenials { grantAdd, grantRemove } } \" +\n+                        \"} } }\" );\n+\n+        // try a modify operation which should succeed with ACI and group membership change\n+        assertTrue( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", DirContext.REPLACE_ATTRIBUTE, changes ) );\n+        deleteAccessControlSubentry( \"administratorModifyReplace\" );\n+    }\n+\n+\n+//    /**\n+//     * Checks to make sure name based userClass works for modify operations.\n+//     *\n+//     * @throws javax.naming.NamingException if the test encounters an error\n+//     */\n+//    public void testGrantModifyByName() throws NamingException\n+//    {\n+//        // create the non-admin user\n+//        createUser( \"billyd\", \"billyd\" );\n+//\n+//        // try an modify operation which should fail without any ACI\n+//        assertFalse( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", \"867-5309\" ) );\n+//\n+//        // now add a subentry that enables user billyd to modify an entry below ou=system\n+//        createAccessControlSubentry( \"billydAdd\", \"{ \" +\n+//                \"identificationTag \\\"addAci\\\", \" +\n+//                \"precedence 14, \" +\n+//                \"authenticationLevel none, \" +\n+//                \"itemOrUserFirst userFirst: { \" +\n+//                \"userClasses { name { \\\"uid=billyd,ou=users,ou=system\\\" } }, \" +\n+//                \"userPermissions { { \" +\n+//                \"protectedItems {entry, allUserAttributeTypesAndValues}, \" +\n+//                \"grantsAndDenials { grantModify, grantRead, grantBrowse } } } } }\" );\n+//\n+//        // should work now that billyd is authorized by name\n+//        assertTrue( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", \"867-5309\" ) );\n+//    }\n+//\n+//\n+//    /**\n+//     * Checks to make sure subtree based userClass works for modify operations.\n+//     *\n+//     * @throws javax.naming.NamingException if the test encounters an error\n+//     */\n+//    public void testGrantModifyBySubtree() throws NamingException\n+//    {\n+//        // create the non-admin user\n+//        createUser( \"billyd\", \"billyd\" );\n+//\n+//        // try a modify operation which should fail without any ACI\n+//        assertFalse( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", \"867-5309\" ) );\n+//\n+//        // now add a subentry that enables user billyd to modify an entry below ou=system\n+//        createAccessControlSubentry( \"billyAddBySubtree\", \"{ \" +\n+//                \"identificationTag \\\"addAci\\\", \" +\n+//                \"precedence 14, \" +\n+//                \"authenticationLevel none, \" +\n+//                \"itemOrUserFirst userFirst: { \" +\n+//                \"userClasses { subtree { { base \\\"ou=users,ou=system\\\" } } }, \" +\n+//                \"userPermissions { { \" +\n+//                \"protectedItems {entry, allUserAttributeTypesAndValues}, \" +\n+//                \"grantsAndDenials { grantModify, grantRead, grantBrowse } } } } }\" );\n+//\n+//        // should work now that billyd is authorized by the subtree userClass\n+//        assertTrue( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", \"867-5309\" ) );\n+//    }\n+//\n+//\n+//    /**\n+//     * Checks to make sure <b>allUsers</b> userClass works for modify operations.\n+//     *\n+//     * @throws javax.naming.NamingException if the test encounters an error\n+//     */\n+//    public void testGrantModifyAllUsers() throws NamingException\n+//    {\n+//        // create the non-admin user\n+//        createUser( \"billyd\", \"billyd\" );\n+//\n+//        // try an add operation which should fail without any ACI\n+//        assertFalse( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", \"867-5309\" ) );\n+//\n+//        // now add a subentry that enables anyone to add an entry below ou=system\n+//        createAccessControlSubentry( \"anybodyAdd\", \"{ \" +\n+//                \"identificationTag \\\"addAci\\\", \" +\n+//                \"precedence 14, \" +\n+//                \"authenticationLevel none, \" +\n+//                \"itemOrUserFirst userFirst: { \" +\n+//                \"userClasses { allUsers }, \" +\n+//                \"userPermissions { { \" +\n+//                \"protectedItems {entry, allUserAttributeTypesAndValues}, \" +\n+//                \"grantsAndDenials { grantModify, grantRead, grantBrowse } } } } }\" );\n+//\n+//        // see if we can now modify that test entry's number which we could not before\n+//        // should work with billyd now that all users are authorized\n+//        assertTrue( checkCanModifyAs( \"billyd\", \"billyd\", \"ou=testou\", \"867-5309\" ) );\n+//    }\n+}"
            },
            {
                "sha": "0b9648254e255f50ffd17f5c50eff98cc828f207",
                "filename": "core/src/test/org/apache/ldap/server/authz/MoveRenameAuthorizationTest.java",
                "status": "added",
                "additions": 482,
                "deletions": 0,
                "changes": 482,
                "blob_url": "https://github.com/apache/directory-server/blob/f042e1564af6dcff28640fce18ff32b44c71482a/core/src/test/org/apache/ldap/server/authz/MoveRenameAuthorizationTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/f042e1564af6dcff28640fce18ff32b44c71482a/core/src/test/org/apache/ldap/server/authz/MoveRenameAuthorizationTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/test/org/apache/ldap/server/authz/MoveRenameAuthorizationTest.java?ref=f042e1564af6dcff28640fce18ff32b44c71482a",
                "patch": "@@ -0,0 +1,482 @@\n+/*\n+ *   Copyright 2004 The Apache Software Foundation\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ *\n+ */\n+package org.apache.ldap.server.authz;\n+\n+\n+import org.apache.ldap.common.exception.LdapNoPermissionException;\n+import org.apache.ldap.common.name.LdapName;\n+\n+import javax.naming.NamingException;\n+import javax.naming.directory.*;\n+\n+\n+/**\n+ * Tests whether or not authorization around entry renames and moves work properly.\n+ *\n+ * @author <a href=\"mailto:dev@directory.apache.org\">Apache Directory Project</a>\n+ * @version $Rev$\n+ */\n+public class MoveRenameAuthorizationTest extends AbstractAuthorizationTest\n+{\n+    /**\n+     * Checks if a simple entry (organizationalUnit) can be renamed at an RDN relative\n+     * to ou=system by a specific non-admin user.  If a permission exception\n+     * is encountered it is caught and false is returned, otherwise true is returned\n+     * when the entry is created.  The entry is deleted after being created just in case\n+     * subsequent calls to this method do not fail: the admin account is used to delete\n+     * this test entry so permissions to delete are not required to delete it by the user.\n+     *\n+     * @param uid the unique identifier for the user (presumed to exist under ou=users,ou=system)\n+     * @param password the password of this user\n+     * @param entryRdn the relative DN, relative to ou=system where entry renames are tested\n+     * @param newRdn the new RDN for the entry under ou=system\n+     * @return true if the entry can be renamed by the user at the specified location, false otherwise\n+     * @throws javax.naming.NamingException if there are problems conducting the test\n+     */\n+    public boolean checkCanRenameAs( String uid, String password, String entryRdn, String newRdn )\n+            throws NamingException\n+    {\n+        Attributes testEntry = new BasicAttributes( \"ou\", \"testou\", true );\n+        Attribute objectClass = new BasicAttribute( \"objectClass\" );\n+        testEntry.put( objectClass );\n+        objectClass.add( \"top\" );\n+        objectClass.add( \"organizationalUnit\" );\n+\n+        DirContext adminContext = getContextAsAdmin();\n+        try\n+        {\n+            // create the new entry as the admin user\n+            adminContext.createSubcontext( entryRdn, testEntry );\n+\n+            LdapName userName = new LdapName( \"uid=\"+uid+\",ou=users,ou=system\" );\n+            DirContext userContext = getContextAs( userName, password );\n+            userContext.rename( entryRdn, newRdn );\n+\n+            // delete the renamed context as the admin user\n+            adminContext.destroySubcontext( newRdn );\n+            return true;\n+        }\n+        catch ( LdapNoPermissionException e )\n+        {\n+            // delete the original context as the admin user since rename\n+            // of newly created test entry did not succeed\n+            adminContext.destroySubcontext( entryRdn );\n+            return false;\n+        }\n+    }\n+\n+\n+    /**\n+     * Checks to make sure group membership based userClass works for renames,\n+     * moves and moves with renames.\n+     *\n+     * @throws javax.naming.NamingException if the test encounters an error\n+     */\n+    public void testGrantByAdministrators() throws NamingException\n+    {\n+        // ----------------------------------------------------------------------------\n+        // Test simple RDN change: NO SUBTREE MOVEMENT!\n+        // ----------------------------------------------------------------------------\n+\n+        // create the non-admin user\n+        createUser( \"billyd\", \"billyd\" );\n+\n+        // try the rename operation which should fail without any ACI\n+        assertFalse( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou\", \"ou=newname\" ) );\n+\n+        // Gives grantRename perm to all users in the Administrators group for entries\n+        createAccessControlSubentry( \"grantRenameByAdmin\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { userGroup { \\\"cn=Administrators,ou=groups,ou=system\\\" } }, \" +\n+                \"userPermissions { { \" +\n+                \"protectedItems {entry}, \" +\n+                \"grantsAndDenials { grantRename, grantBrowse } } } } }\" );\n+\n+        // see if we can now rename that test entry which we could not before\n+        // rename op should still fail since billyd is not in the admin group\n+        assertFalse( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou\", \"ou=newname\" ) );\n+\n+        // now add billyd to the Administrator group and try again\n+        addUserToGroup( \"billyd\", \"Administrators\" );\n+\n+        // try a rename operation which should succeed with ACI and group membership change\n+        assertTrue( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou\", \"ou=newname\" ) );\n+\n+        // now let's cleanup\n+        removeUserFromGroup( \"billyd\", \"Administrators\" );\n+        deleteAccessControlSubentry( \"grantRenameByAdmin\" );\n+        deleteUser( \"billyd\" );\n+\n+        // ----------------------------------------------------------------------------\n+        // Test move and RDN change at the same time.\n+        // ----------------------------------------------------------------------------\n+\n+        // create the non-admin user\n+        createUser( \"billyd\", \"billyd\" );\n+\n+        // try an move w/ rdn change which should fail without any ACI\n+        assertFalse( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=newname,ou=groups\" ) );\n+\n+        // Gives grantRename, grantImport, grantExport perm to all users in the Administrators\n+        // group for entries - browse is needed just to read navigate the tree at root\n+        createAccessControlSubentry( \"grantRenameMoveByAdmin\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { userGroup { \\\"cn=Administrators,ou=groups,ou=system\\\" } }, \" +\n+                \"userPermissions { { \" +\n+                \"protectedItems {entry}, \" +\n+                \"grantsAndDenials { grantExport, grantImport, grantRename, grantBrowse } } } } }\" );\n+\n+        // see if we can move and rename the test entry which we could not before\n+        // op should still fail since billyd is not in the admin group\n+        assertFalse( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=newname,ou=groups\" ) );\n+\n+        // now add billyd to the Administrator group and try again\n+        addUserToGroup( \"billyd\", \"Administrators\" );\n+\n+        // try move w/ rdn change which should succeed with ACI and group membership change\n+        assertTrue( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=newname,ou=groups\" ) );\n+\n+        // now let's cleanup\n+        removeUserFromGroup( \"billyd\", \"Administrators\" );\n+        deleteAccessControlSubentry( \"grantRenameMoveByAdmin\" );\n+        deleteUser( \"billyd\" );\n+\n+        // ----------------------------------------------------------------------------\n+        // Test move ONLY without any RDN changes.\n+        // ----------------------------------------------------------------------------\n+\n+        // create the non-admin user\n+        createUser( \"billyd\", \"billyd\" );\n+\n+        // try move operation which should fail without any ACI\n+        assertFalse( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=testou,ou=groups\" ) );\n+\n+        // Gives grantImport, and grantExport perm to all users in the Administrators group for entries\n+        createAccessControlSubentry( \"grantMoveByAdmin\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { userGroup { \\\"cn=Administrators,ou=groups,ou=system\\\" } }, \" +\n+                \"userPermissions { { \" +\n+                \"protectedItems {entry}, \" +\n+                \"grantsAndDenials { grantExport, grantImport, grantBrowse } } } } }\" );\n+\n+        // see if we can now move that test entry which we could not before\n+        // op should still fail since billyd is not in the admin group\n+        assertFalse( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=testou,ou=groups\" ) );\n+\n+        // now add billyd to the Administrator group and try again\n+        addUserToGroup( \"billyd\", \"Administrators\" );\n+\n+        // try move operation which should succeed with ACI and group membership change\n+        assertTrue( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=testou,ou=groups\" ) );\n+\n+        // now let's cleanup\n+        removeUserFromGroup( \"billyd\", \"Administrators\" );\n+        deleteAccessControlSubentry( \"grantMoveByAdmin\" );\n+        deleteUser( \"billyd\" );\n+    }\n+\n+\n+    /**\n+     * Checks to make sure name based userClass works for rename, move, and\n+     * rename with move operation access controls.\n+     *\n+     * @throws javax.naming.NamingException if the test encounters an error\n+     */\n+    public void testGrantByName() throws NamingException\n+    {\n+        // ----------------------------------------------------------------------------\n+        // Test simple RDN change: NO SUBTREE MOVEMENT!\n+        // ----------------------------------------------------------------------------\n+\n+        // create the non-admin user\n+        createUser( \"billyd\", \"billyd\" );\n+\n+        // try the rename operation which should fail without any ACI\n+        assertFalse( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou\", \"ou=newname\" ) );\n+\n+        // Gives grantRename perm specifically to the billyd user\n+        createAccessControlSubentry( \"grantRenameByName\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { name { \\\"uid=billyd,ou=users,ou=system\\\" } }, \" +\n+                \"userPermissions { { \" +\n+                \"protectedItems {entry}, \" +\n+                \"grantsAndDenials { grantRename, grantBrowse } } } } }\" );\n+\n+        // try a rename operation which should succeed with ACI\n+        assertTrue( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou\", \"ou=newname\" ) );\n+\n+        // now let's cleanup\n+        deleteAccessControlSubentry( \"grantRenameByName\" );\n+        deleteUser( \"billyd\" );\n+\n+        // ----------------------------------------------------------------------------\n+        // Test move and RDN change at the same time.\n+        // ----------------------------------------------------------------------------\n+\n+        // create the non-admin user\n+        createUser( \"billyd\", \"billyd\" );\n+\n+        // try an move w/ rdn change which should fail without any ACI\n+        assertFalse( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=newname,ou=groups\" ) );\n+\n+        // Gives grantRename, grantImport, grantExport perm to billyd user on entries\n+        createAccessControlSubentry( \"grantRenameMoveByName\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { name { \\\"uid=billyd,ou=users,ou=system\\\" } }, \" +\n+                \"userPermissions { { \" +\n+                \"protectedItems {entry}, \" +\n+                \"grantsAndDenials { grantExport, grantImport, grantRename, grantBrowse } } } } }\" );\n+\n+        // try move w/ rdn change which should succeed with ACI\n+        assertTrue( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=newname,ou=groups\" ) );\n+\n+        // now let's cleanup\n+        deleteAccessControlSubentry( \"grantRenameMoveByName\" );\n+        deleteUser( \"billyd\" );\n+\n+        // ----------------------------------------------------------------------------\n+        // Test move ONLY without any RDN changes.\n+        // ----------------------------------------------------------------------------\n+\n+        // create the non-admin user\n+        createUser( \"billyd\", \"billyd\" );\n+\n+        // try move operation which should fail without any ACI\n+        assertFalse( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=testou,ou=groups\" ) );\n+\n+        // Gives grantImport, and grantExport perm to billyd user for entries\n+        createAccessControlSubentry( \"grantMoveByName\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { name { \\\"uid=billyd,ou=users,ou=system\\\" } }, \" +\n+                \"userPermissions { { \" +\n+                \"protectedItems {entry}, \" +\n+                \"grantsAndDenials { grantExport, grantImport, grantBrowse } } } } }\" );\n+\n+        // try move operation which should succeed with ACI\n+        assertTrue( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=testou,ou=groups\" ) );\n+\n+        // now let's cleanup\n+        deleteAccessControlSubentry( \"grantMoveByName\" );\n+        deleteUser( \"billyd\" );\n+    }\n+\n+\n+    /**\n+     * Checks to make sure subtree based userClass works for rename, move, and\n+     * rename with move operation access controls.\n+     *\n+     * @throws javax.naming.NamingException if the test encounters an error\n+     */\n+    public void testGrantBySubtree() throws NamingException\n+    {\n+        // ----------------------------------------------------------------------------\n+        // Test simple RDN change: NO SUBTREE MOVEMENT!\n+        // ----------------------------------------------------------------------------\n+\n+        // create the non-admin user\n+        createUser( \"billyd\", \"billyd\" );\n+\n+        // try the rename operation which should fail without any ACI\n+        assertFalse( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou\", \"ou=newname\" ) );\n+\n+        // Gives grantRename perm for entries to those users selected by the subtree\n+        createAccessControlSubentry( \"grantRenameByTree\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { subtree { { base \\\"ou=users,ou=system\\\" } } }, \" +\n+                \"userPermissions { { \" +\n+                \"protectedItems {entry}, \" +\n+                \"grantsAndDenials { grantRename, grantBrowse } } } } }\" );\n+\n+        // try a rename operation which should succeed with ACI\n+        assertTrue( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou\", \"ou=newname\" ) );\n+\n+        // now let's cleanup\n+        deleteAccessControlSubentry( \"grantRenameByTree\" );\n+        deleteUser( \"billyd\" );\n+\n+        // ----------------------------------------------------------------------------\n+        // Test move and RDN change at the same time.\n+        // ----------------------------------------------------------------------------\n+\n+        // create the non-admin user\n+        createUser( \"billyd\", \"billyd\" );\n+\n+        // try an move w/ rdn change which should fail without any ACI\n+        assertFalse( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=newname,ou=groups\" ) );\n+\n+        // Gives grantRename, grantImport, grantExport for entries to users selected by subtree\n+        createAccessControlSubentry( \"grantRenameMoveByTree\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { subtree { { base \\\"ou=users,ou=system\\\" } } }, \" +\n+                \"userPermissions { { \" +\n+                \"protectedItems {entry}, \" +\n+                \"grantsAndDenials { grantExport, grantImport, grantRename, grantBrowse } } } } }\" );\n+\n+        // try move w/ rdn change which should succeed with ACI\n+        assertTrue( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=newname,ou=groups\" ) );\n+\n+        // now let's cleanup\n+        deleteAccessControlSubentry( \"grantRenameMoveByTree\" );\n+        deleteUser( \"billyd\" );\n+\n+        // ----------------------------------------------------------------------------\n+        // Test move ONLY without any RDN changes.\n+        // ----------------------------------------------------------------------------\n+\n+        // create the non-admin user\n+        createUser( \"billyd\", \"billyd\" );\n+\n+        // try move operation which should fail without any ACI\n+        assertFalse( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=testou,ou=groups\" ) );\n+\n+        // Gives grantImport, and grantExport perm for entries to subtree selected users\n+        createAccessControlSubentry( \"grantMoveByTree\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { subtree { { base \\\"ou=users,ou=system\\\" } } }, \" +\n+                \"userPermissions { { \" +\n+                \"protectedItems {entry}, \" +\n+                \"grantsAndDenials { grantExport, grantImport, grantBrowse } } } } }\" );\n+\n+        // try move operation which should succeed with ACI\n+        assertTrue( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=testou,ou=groups\" ) );\n+\n+        // now let's cleanup\n+        deleteAccessControlSubentry( \"grantMoveByTree\" );\n+        deleteUser( \"billyd\" );\n+    }\n+\n+\n+    /**\n+     * Checks to make sure the <b>anyUser</b> userClass works for rename, move, and\n+     * rename with move operation access controls.\n+     *\n+     * @throws javax.naming.NamingException if the test encounters an error\n+     */\n+    public void testGrantByAnyuser() throws NamingException\n+    {\n+        // ----------------------------------------------------------------------------\n+        // Test simple RDN change: NO SUBTREE MOVEMENT!\n+        // ----------------------------------------------------------------------------\n+\n+        // create the non-admin user\n+        createUser( \"billyd\", \"billyd\" );\n+\n+        // try the rename operation which should fail without any ACI\n+        assertFalse( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou\", \"ou=newname\" ) );\n+\n+        // Gives grantRename perm for entries to any user\n+        createAccessControlSubentry( \"grantRenameByAny\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { allUsers }, \" +\n+                \"userPermissions { { \" +\n+                \"protectedItems {entry}, \" +\n+                \"grantsAndDenials { grantRename, grantBrowse } } } } }\" );\n+\n+        // try a rename operation which should succeed with ACI\n+        assertTrue( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou\", \"ou=newname\" ) );\n+\n+        // now let's cleanup\n+        deleteAccessControlSubentry( \"grantRenameByAny\" );\n+        deleteUser( \"billyd\" );\n+\n+        // ----------------------------------------------------------------------------\n+        // Test move and RDN change at the same time.\n+        // ----------------------------------------------------------------------------\n+\n+        // create the non-admin user\n+        createUser( \"billyd\", \"billyd\" );\n+\n+        // try an move w/ rdn change which should fail without any ACI\n+        assertFalse( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=newname,ou=groups\" ) );\n+\n+        // Gives grantRename, grantImport, grantExport for entries to any user\n+        createAccessControlSubentry( \"grantRenameMoveByAny\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { allUsers }, \" +\n+                \"userPermissions { { \" +\n+                \"protectedItems {entry}, \" +\n+                \"grantsAndDenials { grantExport, grantImport, grantRename, grantBrowse } } } } }\" );\n+\n+        // try move w/ rdn change which should succeed with ACI\n+        assertTrue( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=newname,ou=groups\" ) );\n+\n+        // now let's cleanup\n+        deleteAccessControlSubentry( \"grantRenameMoveByAny\" );\n+        deleteUser( \"billyd\" );\n+\n+        // ----------------------------------------------------------------------------\n+        // Test move ONLY without any RDN changes.\n+        // ----------------------------------------------------------------------------\n+\n+        // create the non-admin user\n+        createUser( \"billyd\", \"billyd\" );\n+\n+        // try move operation which should fail without any ACI\n+        assertFalse( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=testou,ou=groups\" ) );\n+\n+        // Gives grantImport, and grantExport perm for entries to any user\n+        createAccessControlSubentry( \"grantMoveByAny\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { allUsers }, \" +\n+                \"userPermissions { { \" +\n+                \"protectedItems {entry}, \" +\n+                \"grantsAndDenials { grantExport, grantImport, grantBrowse } } } } }\" );\n+\n+        // try move operation which should succeed with ACI\n+        assertTrue( checkCanRenameAs( \"billyd\", \"billyd\", \"ou=testou,ou=users\", \"ou=testou,ou=groups\" ) );\n+\n+        // now let's cleanup\n+        deleteAccessControlSubentry( \"grantMoveByAny\" );\n+        deleteUser( \"billyd\" );\n+    }\n+}"
            },
            {
                "sha": "257b1984e6db6f874a18961a92902a3b8a5dfcd3",
                "filename": "core/src/test/org/apache/ldap/server/authz/support/MicroOperationFilterTest.java",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/apache/directory-server/blob/f042e1564af6dcff28640fce18ff32b44c71482a/core/src/test/org/apache/ldap/server/authz/support/MicroOperationFilterTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/f042e1564af6dcff28640fce18ff32b44c71482a/core/src/test/org/apache/ldap/server/authz/support/MicroOperationFilterTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/test/org/apache/ldap/server/authz/support/MicroOperationFilterTest.java?ref=f042e1564af6dcff28640fce18ff32b44c71482a",
                "patch": "@@ -54,6 +54,7 @@\n         USER_OPERATIONS_A.add( MicroOperation.BROWSE );\r\n         USER_OPERATIONS_B.add( MicroOperation.COMPARE );\r\n         USER_OPERATIONS_B.add( MicroOperation.DISCLOSE_ON_ERROR );\r\n+        TUPLE_OPERATIONS.add( MicroOperation.ADD );\r\n         TUPLE_OPERATIONS.add( MicroOperation.BROWSE );\r\n         TUPLE_OPERATIONS.add( MicroOperation.EXPORT );\r\n     }\r"
            }
        ]
    },
    {
        "commit": "https://github.com/apache/directory-server/commit/0a4e276dc33982ba994abc23dfea44d061c4f96a",
        "repo": "directory-server",
        "parent": "https://github.com/apache/directory-server/commit/dacee98ad87ddea82f14dd4d2eb23be3de8946ce",
        "message": "changes ...\n\n o added new accessControlEnabled property to the startup configuration\n   this property controls whether or not the authorization subsystem is\n   enabled or not - by default it is disabled and must be turned on\n o made admin user bypass all permission checks\n o added entryACI and subentryACI to the apache schema\n o implemented and passed tests for authz with add ops .. still need more tests\n o fixed bug in ACDFEngine where on add ops entry lookups in database were \n   failing \n o fixed bug in SubentryService where we were trying to clone null objects \n   and were getting a NPE\n o added public operation in SubentryService to determine the set of subentry\n   operational attributes within an entry that is about to be added ... other\n   services like authz cannot figure this out since they do not have access to\n   the subtree cache.  This service must be offered to other services that need\n   to determine if an entry to be added is included in the collections of \n   subentries.\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/directory/apacheds/trunk@306997 13f79535-47bb-0310-9956-ffa450edef68",
        "bug_id": "directory-server_116",
        "file": [
            {
                "sha": "e16b4958a1699a024a4a945f4aca86532623f0c3",
                "filename": "core/src/main/java/org/apache/ldap/server/authz/AuthorizationService.java",
                "status": "modified",
                "additions": 379,
                "deletions": 14,
                "changes": 393,
                "blob_url": "https://github.com/apache/directory-server/blob/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/main/java/org/apache/ldap/server/authz/AuthorizationService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/main/java/org/apache/ldap/server/authz/AuthorizationService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/ldap/server/authz/AuthorizationService.java?ref=0a4e276dc33982ba994abc23dfea44d061c4f96a",
                "patch": "@@ -19,23 +19,35 @@\n \n import org.apache.ldap.server.interceptor.BaseInterceptor;\n import org.apache.ldap.server.interceptor.NextInterceptor;\n+import org.apache.ldap.server.interceptor.InterceptorChain;\n import org.apache.ldap.server.jndi.ContextFactoryConfiguration;\n import org.apache.ldap.server.jndi.ServerContext;\n import org.apache.ldap.server.configuration.InterceptorConfiguration;\n import org.apache.ldap.server.partition.ContextPartitionNexus;\n import org.apache.ldap.server.authz.support.ACDFEngine;\n import org.apache.ldap.server.invocation.InvocationStack;\n import org.apache.ldap.server.authn.LdapPrincipal;\n+import org.apache.ldap.server.schema.ConcreteNameComponentNormalizer;\n+import org.apache.ldap.server.subtree.SubentryService;\n import org.apache.ldap.common.filter.ExprNode;\n+import org.apache.ldap.common.aci.MicroOperation;\n+import org.apache.ldap.common.aci.ACIItemParser;\n+import org.apache.ldap.common.aci.ACIItem;\n+import org.apache.ldap.common.exception.LdapNamingException;\n+import org.apache.ldap.common.message.ResultCodeEnum;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n \n import javax.naming.Name;\n import javax.naming.NamingException;\n import javax.naming.NamingEnumeration;\n import javax.naming.directory.Attributes;\n import javax.naming.directory.ModificationItem;\n import javax.naming.directory.SearchControls;\n-import java.util.Iterator;\n-import java.util.Map;\n+import javax.naming.directory.Attribute;\n+import java.util.*;\n+import java.text.ParseException;\n \n \n /**\n@@ -46,61 +58,290 @@\n  */\n public class AuthorizationService extends BaseInterceptor\n {\n+    /** the logger for this class */\n+    private static final Logger log = LoggerFactory.getLogger( AuthorizationService.class );\n+\n+    private static final String ENTRYACI_ATTR = \"entryACI\";\n+    private static final String SUBENTRYACI_ATTR = \"subentryACI\";\n+    private static final String AC_SUBENTRY_ATTR = \"accessControlSubentries\";\n+\n+    /** collection of MicroOperations for the add operation */\n+    private static final Collection ADD_OPS;\n+    /** collection of MicroOperations for the delete operation */\n+    private static final Collection DELETE_OPS;\n+    /** collection of MicroOperations for the compare operation */\n+    private static final Collection COMPARE_OPS;\n+    /** collection of MicroOperations for the search operation */\n+    private static final Collection SEARCH_OPS;\n+    /** collection of MicroOperations for the modify operation */\n+    private static final Collection MODIFY_OPS;\n+    /** collection of MicroOperations for the modifyRdn operation */\n+    private static final Collection MODIFYRDN_OPS;\n+    /** collection of MicroOperations for the browsing */\n+    private static final Collection BROWSE_OPS;\n+\n+    static\n+    {\n+        Set ops = new HashSet();\n+        ops.add( MicroOperation.ADD );\n+        ADD_OPS = Collections.unmodifiableCollection( ops );\n+\n+        ops = new HashSet();\n+        ops.add( MicroOperation.REMOVE );\n+        DELETE_OPS = Collections.unmodifiableCollection( ops );\n+\n+        ops = new HashSet();\n+        ops.add( MicroOperation.COMPARE );\n+        COMPARE_OPS = Collections.unmodifiableCollection( ops );\n+\n+        ops = new HashSet();\n+        ops.add( MicroOperation.RETURN_DN );\n+        ops.add( MicroOperation.FILTER_MATCH );\n+        ops.add( MicroOperation.READ );\n+        SEARCH_OPS = Collections.unmodifiableCollection( ops );\n+\n+        ops = new HashSet();\n+        ops.add( MicroOperation.MODIFY );\n+        MODIFY_OPS = Collections.unmodifiableCollection( ops );\n+\n+        ops = new HashSet();\n+        ops.add( MicroOperation.RENAME );\n+        MODIFYRDN_OPS = Collections.unmodifiableCollection( ops );\n+\n+        ops = new HashSet();\n+        ops.add( MicroOperation.BROWSE );\n+        BROWSE_OPS = Collections.unmodifiableCollection( ops );\n+    }\n+\n     /** the partition nexus */\n     private ContextPartitionNexus nexus;\n     /** a tupleCache that responds to add, delete, and modify attempts */\n     private TupleCache tupleCache;\n     /** a groupCache that responds to add, delete, and modify attempts */\n     private GroupCache groupCache;\n+    /** a normalizing ACIItem parser */\n+    private ACIItemParser aciParser;\n     /** use and instance of the ACDF engine */\n     private ACDFEngine engine;\n+    /** interceptor chain */\n+    private InterceptorChain chain;\n+    /** whether or not this interceptor is activated */\n+    private boolean enabled = false;\n \n \n+    /**\n+     * Initializes this interceptor based service by getting a handle on the nexus, setting up\n+     * the tupe and group membership caches and the ACIItem parser and the ACDF engine.\n+     *\n+     * @param factoryCfg the ContextFactory configuration for the server\n+     * @param cfg the interceptor configuration\n+     * @throws NamingException if there are problems during initialization\n+     */\n     public void init( ContextFactoryConfiguration factoryCfg, InterceptorConfiguration cfg ) throws NamingException\n     {\n         super.init( factoryCfg, cfg );\n \n         nexus = factoryCfg.getPartitionNexus();\n         tupleCache = new TupleCache( factoryCfg );\n         groupCache = new GroupCache( factoryCfg );\n+        aciParser = new ACIItemParser( new ConcreteNameComponentNormalizer(\n+                factoryCfg.getGlobalRegistries().getAttributeTypeRegistry() ) );\n         engine = new ACDFEngine( factoryCfg.getGlobalRegistries().getOidRegistry(),\n                 factoryCfg.getGlobalRegistries().getAttributeTypeRegistry() );\n+        chain = factoryCfg.getInterceptorChain();\n+        enabled = factoryCfg.getStartupConfiguration().isAccessControlEnabled();\n+    }\n+\n+\n+    /**\n+     * Adds perscriptiveACI tuples to a collection of tuples by accessing the\n+     * tupleCache.  The tuple cache is accessed for each A/C subentry\n+     * associated with the protected entry.  Note that subentries are handled\n+     * differently: their parent, the administrative entry is accessed to\n+     * determine the perscriptiveACIs effecting the AP and hence the subentry\n+     * which is considered to be in the same context.\n+     *\n+     * @param tuples the collection of tuples to add to\n+     * @param dn the normalized distinguished name of the protected entry\n+     * @param entry the target entry that access to is being controled\n+     * @throws NamingException if there are problems accessing attribute values\n+     */\n+    private void addPerscriptiveAciTuples( Collection tuples, Name dn, Attributes entry ) throws NamingException\n+    {\n+        /*\n+         * If the protected entry is a subentry, then the entry being evaluated\n+         * for perscriptiveACIs is in fact the administrative entry.  By\n+         * substituting the administrative entry for the actual subentry the\n+         * code below this \"if\" statement correctly evaluates the effects of\n+         * perscriptiveACI on the subentry.  Basically subentries are considered\n+         * to be in the same naming context as their access point so the subentries\n+         * effecting their parent entry applies to them as well.\n+         */\n+        if ( entry.get( \"objectClass\" ).contains( \"subentry\" ) )\n+        {\n+            Name parentDn = ( Name ) dn.clone();\n+            parentDn.remove( dn.size() - 1 );\n+            entry = nexus.lookup( parentDn );\n+        }\n+\n+        Attribute subentries = entry.get( AC_SUBENTRY_ATTR );\n+        if ( subentries == null ) return;\n+        for ( int ii = 0; ii < subentries.size(); ii++ )\n+        {\n+            String subentryDn = ( String ) subentries.get( ii );\n+            tuples.addAll( tupleCache.getACITuples( subentryDn ) );\n+        }\n+    }\n+\n+\n+    /**\n+     * Adds the set of entryACI tuples to a collection of tuples.  The entryACI\n+     * is parsed and tuples are generated on they fly then added to the collection.\n+     *\n+     * @param tuples the collection of tuples to add to\n+     * @param entry the target entry that access to is being regulated\n+     * @throws NamingException if there are problems accessing attribute values\n+     */\n+    private void addEntryAciTuples( Collection tuples, Attributes entry ) throws NamingException\n+    {\n+        Attribute entryAci = entry.get( ENTRYACI_ATTR );\n+        if ( entryAci == null ) return;\n+\n+        for ( int ii = 0; ii < entryAci.size(); ii++ )\n+        {\n+            String aciString = ( String ) entryAci.get( ii );\n+            ACIItem item;\n+\n+            try\n+            {\n+                item = aciParser.parse( aciString );\n+            }\n+            catch ( ParseException e )\n+            {\n+                String msg = \"failed to parse entryACI: \" + aciString ;\n+                log.error( msg, e );\n+                throw new LdapNamingException( msg, ResultCodeEnum.OPERATIONSERROR );\n+            }\n+\n+            tuples.add( item.toTuples() );\n+        }\n+    }\n+\n+\n+    /**\n+     * Adds the set of subentryACI tuples to a collection of tuples.  The subentryACI\n+     * is parsed and tuples are generated on the fly then added to the collection.\n+     *\n+     * @param tuples the collection of tuples to add to\n+     * @param dn the normalized distinguished name of the protected entry\n+     * @param entry the target entry that access to is being regulated\n+     * @throws NamingException if there are problems accessing attribute values\n+     */\n+    private void addSubentryAciTuples( Collection tuples, Name dn, Attributes entry ) throws NamingException\n+    {\n+        // only perform this for subentries\n+        if ( ! entry.get( \"objectClass\" ).contains( \"subentry\" ) ) return;\n+\n+        // get the parent or administrative entry for this subentry since it\n+        // will contain the subentryACI attributes that effect subentries\n+        Name parentDn = ( Name ) dn.clone();\n+        parentDn.remove( dn.size() - 1 );\n+        Attributes administrativeEntry = nexus.lookup( parentDn );\n+        Attribute subentryAci = administrativeEntry.get( SUBENTRYACI_ATTR );\n+\n+        if ( subentryAci == null ) return;\n+\n+        for ( int ii = 0; ii < subentryAci.size(); ii++ )\n+        {\n+            String aciString = ( String ) subentryAci.get( ii );\n+            ACIItem item;\n+\n+            try\n+            {\n+                item = aciParser.parse( aciString );\n+            }\n+            catch ( ParseException e )\n+            {\n+                String msg = \"failed to parse subentryACI: \" + aciString ;\n+                log.error( msg, e );\n+                throw new LdapNamingException( msg, ResultCodeEnum.OPERATIONSERROR );\n+            }\n+\n+            tuples.add( item.toTuples() );\n+        }\n     }\n \n \n-    /*\n+    /* -------------------------------------------------------------------------------\n      * Within every access controled interceptor method we must retrieve the ACITuple\n      * set for all the perscriptiveACIs that apply to the candidate, the target entry\n      * operated upon.  This ACITuple set is gotten from the TupleCache by looking up\n      * the subentries referenced by the accessControlSubentries operational attribute\n      * within the target entry.\n      *\n-     * Then the entry is inspected for an entryACI.  If present a set of ACITuples\n-     * are generated for all the entryACIs within the entry.  This set is combined\n-     * with the ACITuples cached for the perscriptiveACI affecting the target entry.\n+     * Then the entry is inspected for an entryACI.  This is not done for the add op\n+     * since it could introduce a security breech.  So for non-add ops if present a\n+     * set of ACITuples are generated for all the entryACIs within the entry.  This\n+     * set is combined with the ACITuples cached for the perscriptiveACI affecting\n+     * the target entry.\n      *\n      * The union of ACITuples are fed into the engine along with other parameters\n      * to decide where permission is granted or rejected for the specific operation.\n+     * -------------------------------------------------------------------------------\n      */\n \n     public void add( NextInterceptor next, String upName, Name normName, Attributes entry ) throws NamingException\n     {\n+        // Access the principal requesting the operation, and bypass checks if it is the admin\n+        LdapPrincipal user = ( ( ServerContext ) InvocationStack.getInstance().peek().getCaller() ).getPrincipal();\n+        if ( user.getName().equalsIgnoreCase( ContextPartitionNexus.ADMIN_PRINCIPAL ) || ! enabled )\n+        {\n+            next.add( upName, normName, entry );\n+            tupleCache.subentryAdded( upName, normName, entry );\n+            groupCache.groupAdded( upName, normName, entry );\n+            return;\n+        }\n+\n+        // perform checks below here\n+        SubentryService subentryService = ( SubentryService ) chain.get( \"subentryService\" );\n+        Attributes subentryAttrs = subentryService.getSubentryAttributes( normName, entry );\n+        NamingEnumeration attrList = entry.getAll();\n+        while( attrList.hasMore() )\n+        {\n+            subentryAttrs.put( ( Attribute ) attrList.next() );\n+        }\n+\n+        // Assemble all the information required to make an access control decision\n+        Set userGroups = groupCache.getGroups( user.getName() );\n+        Collection tuples = new HashSet();\n+\n+        // note that entryACI should not be considered in adds (it's a security breach)\n+        addPerscriptiveAciTuples( tuples, normName, subentryAttrs );\n+        addSubentryAciTuples( tuples, normName, subentryAttrs );\n+        engine.checkPermission( next, userGroups, user.getJndiName(), user.getAuthenticationLevel(), normName, null,\n+            null, ADD_OPS, tuples, subentryAttrs );\n+\n+        // if we've gotten this far then access is granted\n         next.add( upName, normName, entry );\n         tupleCache.subentryAdded( upName, normName, entry );\n         groupCache.groupAdded( upName, normName, entry );\n-\n-        ServerContext ctx = ( ServerContext ) InvocationStack.getInstance().peek().getCaller();\n-        LdapPrincipal user = ctx.getPrincipal();\n-        Name userGroupName = null;\n-\n-//        engine.checkPermission( next, userGroupName, user.getName(), user.getAuthenticationLevel(), normName, null,\n-//                null, ADD_OPS, aciTuples );\n     }\n \n \n     public void delete( NextInterceptor next, Name name ) throws NamingException\n     {\n         Attributes entry = nexus.lookup( name );\n+//        ServerContext ctx = ( ServerContext ) InvocationStack.getInstance().peek().getCaller();\n+//        LdapPrincipal user = ctx.getPrincipal();\n+//        Set userGroups = groupCache.getGroups( user.getName() );\n+//        Collection tuples = new HashSet();\n+//        addPerscriptiveAciTuples( tuples, entry );\n+//        addEntryAciTuples( tuples, entry );\n+//        addSubentryAciTuples( tuples, entry );\n+//\n+//        engine.checkPermission( next, userGroups, user.getJndiName(), user.getAuthenticationLevel(), name, null,\n+//                null, DELETE_OPS, tuples );\n+\n         next.delete( name );\n         tupleCache.subentryDeleted( name, entry );\n         groupCache.groupDeleted( name, entry );\n@@ -110,6 +351,17 @@ public void delete( NextInterceptor next, Name name ) throws NamingException\n     public void modify( NextInterceptor next, Name name, int modOp, Attributes mods ) throws NamingException\n     {\n         Attributes entry = nexus.lookup( name );\n+//        ServerContext ctx = ( ServerContext ) InvocationStack.getInstance().peek().getCaller();\n+//        LdapPrincipal user = ctx.getPrincipal();\n+//        Set userGroups = groupCache.getGroups( user.getName() );\n+//        Collection tuples = new HashSet();\n+//        addPerscriptiveAciTuples( tuples, entry );\n+//        addEntryAciTuples( tuples, entry );\n+//        addSubentryAciTuples( tuples, entry );\n+//\n+//        engine.checkPermission( next, userGroups, user.getJndiName(), user.getAuthenticationLevel(), name, null,\n+//                null, MODIFY_OPS, tuples );\n+\n         next.modify( name, modOp, mods );\n         tupleCache.subentryModified( name, modOp, mods, entry );\n         groupCache.groupModified( name, modOp, mods, entry );\n@@ -119,6 +371,17 @@ public void modify( NextInterceptor next, Name name, int modOp, Attributes mods\n     public void modify( NextInterceptor next, Name name, ModificationItem[] mods ) throws NamingException\n     {\n         Attributes entry = nexus.lookup( name );\n+//        ServerContext ctx = ( ServerContext ) InvocationStack.getInstance().peek().getCaller();\n+//        LdapPrincipal user = ctx.getPrincipal();\n+//        Set userGroups = groupCache.getGroups( user.getName() );\n+//        Collection tuples = new HashSet();\n+//        addPerscriptiveAciTuples( tuples, entry );\n+//        addEntryAciTuples( tuples, entry );\n+//        addSubentryAciTuples( tuples, entry );\n+//\n+//        engine.checkPermission( next, userGroups, user.getJndiName(), user.getAuthenticationLevel(), name, null,\n+//                null, MODIFY_OPS, tuples );\n+\n         next.modify( name, mods );\n         tupleCache.subentryModified( name, mods, entry );\n         groupCache.groupModified( name, mods, entry );\n@@ -127,18 +390,54 @@ public void modify( NextInterceptor next, Name name, ModificationItem[] mods ) t\n \n     public Attributes getRootDSE( NextInterceptor next ) throws NamingException\n     {\n-        return super.getRootDSE( next );\n+        Attributes entry = super.getRootDSE( next );\n+//        ServerContext ctx = ( ServerContext ) InvocationStack.getInstance().peek().getCaller();\n+//        LdapPrincipal user = ctx.getPrincipal();\n+//        Set userGroups = groupCache.getGroups( user.getName() );\n+//        Collection tuples = new HashSet();\n+//        addPerscriptiveAciTuples( tuples, entry );\n+//        addEntryAciTuples( tuples, entry );\n+//        addSubentryAciTuples( tuples, entry );\n+//\n+//        engine.checkPermission( next, userGroups, user.getJndiName(), user.getAuthenticationLevel(),\n+//                new LdapName(), null, null, SEARCH_OPS, tuples );\n+\n+        return entry;\n     }\n \n \n     public boolean hasEntry( NextInterceptor next, Name name ) throws NamingException\n     {\n+//        Attributes entry = nexus.lookup( name );\n+//        ServerContext ctx = ( ServerContext ) InvocationStack.getInstance().peek().getCaller();\n+//        LdapPrincipal user = ctx.getPrincipal();\n+//        Set userGroups = groupCache.getGroups( user.getName() );\n+//        Collection tuples = new HashSet();\n+//        addPerscriptiveAciTuples( tuples, entry );\n+//        addEntryAciTuples( tuples, entry );\n+//        addSubentryAciTuples( tuples, entry );\n+//\n+//        engine.checkPermission( next, userGroups, user.getJndiName(), user.getAuthenticationLevel(), name, null,\n+//                null, BROWSE_OPS, tuples );\n+\n         return next.hasEntry( name );\n     }\n \n \n     public NamingEnumeration list( NextInterceptor next, Name base ) throws NamingException\n     {\n+//        Attributes entry = nexus.lookup( base );\n+//        ServerContext ctx = ( ServerContext ) InvocationStack.getInstance().peek().getCaller();\n+//        LdapPrincipal user = ctx.getPrincipal();\n+//        Set userGroups = groupCache.getGroups( user.getName() );\n+//        Collection tuples = new HashSet();\n+//        addPerscriptiveAciTuples( tuples, entry );\n+//        addEntryAciTuples( tuples, entry );\n+//        addSubentryAciTuples( tuples, entry );\n+//\n+//        engine.checkPermission( next, userGroups, user.getJndiName(), user.getAuthenticationLevel(), base, null,\n+//                null, SEARCH_OPS, tuples );\n+\n         return super.list( next, base );\n     }\n \n@@ -163,26 +462,92 @@ public Attributes lookup( NextInterceptor next, Name name ) throws NamingExcepti\n \n     public void modifyRn( NextInterceptor next, Name name, String newRn, boolean deleteOldRn ) throws NamingException\n     {\n+//        Attributes entry = nexus.lookup( name );\n+//        ServerContext ctx = ( ServerContext ) InvocationStack.getInstance().peek().getCaller();\n+//        LdapPrincipal user = ctx.getPrincipal();\n+//        Set userGroups = groupCache.getGroups( user.getName() );\n+//        Collection tuples = new HashSet();\n+//        addPerscriptiveAciTuples( tuples, entry );\n+//        addEntryAciTuples( tuples, entry );\n+//        addSubentryAciTuples( tuples, entry );\n+//\n+//        engine.checkPermission( next, userGroups, user.getJndiName(), user.getAuthenticationLevel(), name, null,\n+//                null, MODIFYRDN_OPS, tuples );\n+\n         super.modifyRn( next, name, newRn, deleteOldRn );\n     }\n \n \n     public void move( NextInterceptor next, Name oriChildName, Name newParentName, String newRn, boolean deleteOldRn )\n             throws NamingException\n     {\n+//        Attributes entry = nexus.lookup( oriChildName );\n+//        ServerContext ctx = ( ServerContext ) InvocationStack.getInstance().peek().getCaller();\n+//        LdapPrincipal user = ctx.getPrincipal();\n+//        Set userGroups = groupCache.getGroups( user.getName() );\n+//        Collection tuples = new HashSet();\n+//        addPerscriptiveAciTuples( tuples, entry );\n+//        addEntryAciTuples( tuples, entry );\n+//        addSubentryAciTuples( tuples, entry );\n+//\n+//        engine.checkPermission( next, userGroups, user.getJndiName(), user.getAuthenticationLevel(), oriChildName, null,\n+//                null, MODIFYRDN_OPS, tuples );\n+\n         super.move( next, oriChildName, newParentName, newRn, deleteOldRn );\n     }\n \n \n     public void move( NextInterceptor next, Name oriChildName, Name newParentName ) throws NamingException\n     {\n+//        Attributes entry = nexus.lookup( oriChildName );\n+//        ServerContext ctx = ( ServerContext ) InvocationStack.getInstance().peek().getCaller();\n+//        LdapPrincipal user = ctx.getPrincipal();\n+//        Set userGroups = groupCache.getGroups( user.getName() );\n+//        Collection tuples = new HashSet();\n+//        addPerscriptiveAciTuples( tuples, entry );\n+//        addEntryAciTuples( tuples, entry );\n+//        addSubentryAciTuples( tuples, entry );\n+//\n+//        engine.checkPermission( next, userGroups, user.getJndiName(), user.getAuthenticationLevel(), oriChildName, null,\n+//                null, MODIFYRDN_OPS, tuples );\n+//\n         super.move( next, oriChildName, newParentName );\n     }\n \n \n     public NamingEnumeration search( NextInterceptor next, Name base, Map env, ExprNode filter,\n                                      SearchControls searchCtls ) throws NamingException\n     {\n+//        Attributes entry = nexus.lookup( base );\n+//        ServerContext ctx = ( ServerContext ) InvocationStack.getInstance().peek().getCaller();\n+//        LdapPrincipal user = ctx.getPrincipal();\n+//        Set userGroups = groupCache.getGroups( user.getName() );\n+//        Collection tuples = new HashSet();\n+//        addPerscriptiveAciTuples( tuples, entry );\n+//        addEntryAciTuples( tuples, entry );\n+//        addSubentryAciTuples( tuples, entry );\n+//\n+//        engine.checkPermission( next, userGroups, user.getJndiName(), user.getAuthenticationLevel(), base, null,\n+//                null, SEARCH_OPS, tuples );\n+\n         return super.search( next, base, env, filter, searchCtls );\n     }\n+\n+\n+    public boolean compare( NextInterceptor next, Name name, String oid, Object value ) throws NamingException\n+    {\n+//        Attributes entry = nexus.lookup( name );\n+//        ServerContext ctx = ( ServerContext ) InvocationStack.getInstance().peek().getCaller();\n+//        LdapPrincipal user = ctx.getPrincipal();\n+//        Set userGroups = groupCache.getGroups( user.getName() );\n+//        Collection tuples = new HashSet();\n+//        addPerscriptiveAciTuples( tuples, entry );\n+//        addEntryAciTuples( tuples, entry );\n+//        addSubentryAciTuples( tuples, entry );\n+//\n+//        engine.checkPermission( next, userGroups, user.getJndiName(), user.getAuthenticationLevel(), name, null,\n+//                null, COMPARE_OPS, tuples );\n+\n+        return super.compare(next, name, oid, value);\n+    }\n }"
            },
            {
                "sha": "0e3441bec43c930c447fc439e9f557e67018f249",
                "filename": "core/src/main/java/org/apache/ldap/server/authz/TupleCache.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/directory-server/blob/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/main/java/org/apache/ldap/server/authz/TupleCache.java",
                "raw_url": "https://github.com/apache/directory-server/raw/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/main/java/org/apache/ldap/server/authz/TupleCache.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/ldap/server/authz/TupleCache.java?ref=0a4e276dc33982ba994abc23dfea44d061c4f96a",
                "patch": "@@ -172,7 +172,7 @@ public void subentryAdded( String upName, Name normName, Attributes entry ) thro\n \n \n     public void subentryDeleted( Name normName, Attributes entry ) throws NamingException\n-    {\n+    {                                                                                      \n         if ( ! hasPrescriptiveACI( entry ) )\n         {\n             return;"
            },
            {
                "sha": "e03c89ed68cf1801a43ff6d09fbf5fad22293004",
                "filename": "core/src/main/java/org/apache/ldap/server/authz/support/ACDFEngine.java",
                "status": "modified",
                "additions": 4,
                "deletions": 5,
                "changes": 9,
                "blob_url": "https://github.com/apache/directory-server/blob/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/main/java/org/apache/ldap/server/authz/support/ACDFEngine.java",
                "raw_url": "https://github.com/apache/directory-server/raw/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/main/java/org/apache/ldap/server/authz/support/ACDFEngine.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/ldap/server/authz/support/ACDFEngine.java?ref=0a4e276dc33982ba994abc23dfea44d061c4f96a",
                "patch": "@@ -116,13 +116,13 @@ public void checkPermission(\n             NextInterceptor next,\r\n             Collection userGroupNames, Name username, AuthenticationLevel authenticationLevel,\r\n             Name entryName, String attrId, Object attrValue,\r\n-            Collection microOperations, Collection aciTuples ) throws NamingException \r\n+            Collection microOperations, Collection aciTuples, Attributes entry ) throws NamingException\r\n     {\r\n         if( !hasPermission(\r\n                 next,\r\n                 userGroupNames, username, authenticationLevel,\r\n                 entryName, attrId, attrValue,\r\n-                microOperations, aciTuples ) )\r\n+                microOperations, aciTuples, entry ) )\r\n         {\r\n             throw new LdapNoPermissionException();\r\n         }\r\n@@ -148,16 +148,15 @@ public boolean hasPermission(\n             NextInterceptor next, \r\n             Collection userGroupNames, Name userName, AuthenticationLevel authenticationLevel,\r\n             Name entryName, String attrId, Object attrValue,\r\n-            Collection microOperations, Collection aciTuples ) throws NamingException\r\n+            Collection microOperations, Collection aciTuples, Attributes entry ) throws NamingException\r\n     {\r\n         if( entryName == null )\r\n         {\r\n             throw new NullPointerException( \"entryName\" );\r\n         }\r\n         \r\n         Attributes userEntry = next.lookup( userName );\r\n-        Attributes entry = next.lookup( entryName );\r\n-        \r\n+\r\n         // Determine the scope of the requested operation.\r\n         OperationScope scope;\r\n         if( attrId == null )\r"
            },
            {
                "sha": "ab80bf093291e87dc7723bbd7706b2e041f02e40",
                "filename": "core/src/main/java/org/apache/ldap/server/configuration/MutableStartupConfiguration.java",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/directory-server/blob/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/main/java/org/apache/ldap/server/configuration/MutableStartupConfiguration.java",
                "raw_url": "https://github.com/apache/directory-server/raw/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/main/java/org/apache/ldap/server/configuration/MutableStartupConfiguration.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/ldap/server/configuration/MutableStartupConfiguration.java?ref=0a4e276dc33982ba994abc23dfea44d061c4f96a",
                "patch": "@@ -70,6 +70,11 @@ public void setContextPartitionConfigurations( Set contextParitionConfigurations\n         super.setContextPartitionConfigurations( contextParitionConfigurations );\n     }\n \n+    public void setAccessControlEnabled( boolean isAccessControlEnabled )\n+    {\n+        super.setAccessControlEnabled( isAccessControlEnabled );\n+    }\n+\n     public void setAllowAnonymousAccess( boolean enableAnonymousAccess )\n     {\n         super.setAllowAnonymousAccess( enableAnonymousAccess );"
            },
            {
                "sha": "12bd44e73a4ef9f8d3c213c3c429ce14b68d2973",
                "filename": "core/src/main/java/org/apache/ldap/server/configuration/StartupConfiguration.java",
                "status": "modified",
                "additions": 17,
                "deletions": 0,
                "changes": 17,
                "blob_url": "https://github.com/apache/directory-server/blob/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/main/java/org/apache/ldap/server/configuration/StartupConfiguration.java",
                "raw_url": "https://github.com/apache/directory-server/raw/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/main/java/org/apache/ldap/server/configuration/StartupConfiguration.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/ldap/server/configuration/StartupConfiguration.java?ref=0a4e276dc33982ba994abc23dfea44d061c4f96a",
                "patch": "@@ -54,6 +54,7 @@\n \n     private File workingDirectory = new File( \"server-work\" );\n     private boolean allowAnonymousAccess = true; // allow by default\n+    private boolean accessControlEnabled = false; // turn off by default\n     private Set authenticatorConfigurations; // Set<AuthenticatorConfiguration>\n     private List interceptorConfigurations; // Set<InterceptorConfiguration>\n     \n@@ -268,6 +269,22 @@ protected void setContextPartitionConfigurations( Set contextParitionConfigurati\n         this.contextPartitionConfigurations = newSet;\n     }\n \n+    /**\n+     * Returns <tt>true</tt> if access control checks are enbaled.\n+     */\n+    public boolean isAccessControlEnabled()\n+    {\n+        return accessControlEnabled;\n+    }\n+\n+    /**\n+     * Sets whether to enable basic access control checks or not\n+     */\n+    protected void setAccessControlEnabled( boolean isAccessControlEnabled )\n+    {\n+        this.accessControlEnabled = isAccessControlEnabled;\n+    }\n+\n     /**\n      * Returns <tt>true</tt> if anonymous access is allowed.\n      */"
            },
            {
                "sha": "1436587e34ae61623d8e710a135edf625071674c",
                "filename": "core/src/main/java/org/apache/ldap/server/subtree/SubentryService.java",
                "status": "modified",
                "additions": 99,
                "deletions": 16,
                "changes": 115,
                "blob_url": "https://github.com/apache/directory-server/blob/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/main/java/org/apache/ldap/server/subtree/SubentryService.java",
                "raw_url": "https://github.com/apache/directory-server/raw/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/main/java/org/apache/ldap/server/subtree/SubentryService.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/java/org/apache/ldap/server/subtree/SubentryService.java?ref=0a4e276dc33982ba994abc23dfea44d061c4f96a",
                "patch": "@@ -102,11 +102,7 @@ public boolean accept( LdapContext ctx, SearchResult result, SearchControls cont\n                 return true;\n             }\n \n-            if ( objectClasses.contains( SUBENTRY_OBJECTCLASS ) || objectClasses.contains( SUBENTRY_OBJECTCLASS_OID ) )\n-            {\n-                return false;\n-            }\n-            return true;\n+            return !( objectClasses.contains(SUBENTRY_OBJECTCLASS) || objectClasses.contains(SUBENTRY_OBJECTCLASS_OID) );\n         }\n     };\n \n@@ -150,7 +146,7 @@ public void init( ContextFactoryConfiguration factoryCfg, InterceptorConfigurati\n                 Attributes subentry = result.getAttributes();\n                 String dn = result.getName();\n                 String subtree = ( String ) subentry.get( \"subtreeSpecification\" ).get();\n-                SubtreeSpecification ss = null;\n+                SubtreeSpecification ss;\n \n                 try\n                 {\n@@ -219,7 +215,7 @@ public NamingEnumeration search( NextInterceptor nextInterceptor, Name base, Map\n      */\n     private boolean isSubentryVisible( LdapContext ctx ) throws NamingException\n     {\n-        Control[] reqControls = ( Control[] ) ctx.getRequestControls();\n+        Control[] reqControls = ctx.getRequestControls();\n \n         if ( reqControls == null || reqControls.length <= 0 )\n         {\n@@ -246,6 +242,93 @@ private boolean isSubentryVisible( LdapContext ctx ) throws NamingException\n     // -----------------------------------------------------------------------\n \n \n+    /**\n+     * Evaluates the set of subentry subtrees upon an entry and returns the\n+     * operational subentry attributes that will be added to the entry if\n+     * added at the dn specified.\n+     *\n+     * @param dn the normalized distinguished name of the entry\n+     * @param entryAttrs the entry attributes are generated for\n+     * @return the set of subentry op attrs for an entry\n+     * @throws NamingException if there are problems accessing entry information\n+     */\n+    public Attributes getSubentryAttributes( Name dn, Attributes entryAttrs ) throws NamingException\n+    {\n+        Attributes subentryAttrs = new LockableAttributesImpl();\n+        Attribute objectClasses = entryAttrs.get( \"objectClass\" );\n+        Iterator list = subtrees.keySet().iterator();\n+        while ( list.hasNext() )\n+        {\n+            String subentryDnStr = ( String ) list.next();\n+            Name subentryDn = new LdapName( subentryDnStr );\n+            Name apDn = ( Name ) subentryDn.clone();\n+            apDn.remove( apDn.size() - 1 );\n+            SubtreeSpecification ss = ( SubtreeSpecification ) subtrees.get( subentryDn );\n+\n+            if ( evaluator.evaluate( ss, apDn, dn, objectClasses ) )\n+            {\n+                Attribute administrativeRole = nexus.lookup( apDn ).get( \"administrativeRole\" );\n+                NamingEnumeration roles = administrativeRole.getAll();\n+                while ( roles.hasMore() )\n+                {\n+                    Attribute operational;\n+                    String role = ( String ) roles.next();\n+\n+                    if ( role.equalsIgnoreCase( AUTONOUMOUS_AREA ) )\n+                    {\n+                        operational = subentryAttrs.get( AUTONOUMOUS_AREA_SUBENTRY );\n+                        if ( operational == null )\n+                        {\n+                            operational = new LockableAttributeImpl( AUTONOUMOUS_AREA_SUBENTRY );\n+                            subentryAttrs.put( operational );\n+                        }\n+                    }\n+                    else if ( role.equalsIgnoreCase( AC_AREA ) || role.equalsIgnoreCase( AC_INNERAREA ) )\n+                    {\n+                        operational = subentryAttrs.get( AC_SUBENTRY );\n+                        if ( operational == null )\n+                        {\n+                            operational = new LockableAttributeImpl( AC_SUBENTRY );\n+                            subentryAttrs.put( operational );\n+                        }\n+                    }\n+                    else if ( role.equalsIgnoreCase( SCHEMA_AREA ) )\n+                    {\n+                        operational = subentryAttrs.get( SCHEMA_AREA_SUBENTRY );\n+                        if ( operational == null )\n+                        {\n+                            operational = new LockableAttributeImpl( SCHEMA_AREA_SUBENTRY );\n+                            subentryAttrs.put( operational );\n+                        }\n+                    }\n+                    else if ( role.equalsIgnoreCase( COLLECTIVE_AREA ) ||\n+                              role.equalsIgnoreCase( COLLECTIVE_INNERAREA ) )\n+                    {\n+                        operational = subentryAttrs.get( COLLECTIVE_ATTRIBUTE_SUBENTRIES );\n+                        if ( operational == null )\n+                        {\n+                            operational = new LockableAttributeImpl( COLLECTIVE_ATTRIBUTE_SUBENTRIES );\n+                            subentryAttrs.put( operational );\n+                        }\n+                    }\n+                    else\n+                    {\n+                        throw new LdapInvalidAttributeValueException( \"Encountered invalid administrativeRole '\"\n+                                + role + \"' in administrative point of subentry \" + subentryDnStr + \". The values of this attribute\"\n+                                + \" are constrained to autonomousArea, accessControlSpecificArea, accessControlInnerArea,\"\n+                                + \" subschemaAdminSpecificArea, collectiveAttributeSpecificArea, and\"\n+                                + \" collectiveAttributeInnerArea.\", ResultCodeEnum.CONSTRAINTVIOLATION );\n+                    }\n+\n+                    operational.add( subentryDn.toString() );\n+                }\n+            }\n+        }\n+\n+        return subentryAttrs;\n+    }\n+\n+\n     public void add( NextInterceptor next, String upName, Name normName, Attributes entry ) throws NamingException\n     {\n         Attribute objectClasses = entry.get( \"objectClass\" );\n@@ -285,7 +368,7 @@ public void add( NextInterceptor next, String upName, Name normName, Attributes\n              * ----------------------------------------------------------------\n              */\n             String subtree = ( String ) entry.get( \"subtreeSpecification\" ).get();\n-            SubtreeSpecification ss = null;\n+            SubtreeSpecification ss;\n             try\n             {\n                 ss = ssParser.parse( subtree );\n@@ -345,7 +428,7 @@ public void add( NextInterceptor next, String upName, Name normName, Attributes\n                     NamingEnumeration roles = administrativeRole.getAll();\n                     while ( roles.hasMore() )\n                     {\n-                        Attribute operational = null;\n+                        Attribute operational;\n                         String role = ( String ) roles.next();\n \n                         if ( role.equalsIgnoreCase( AUTONOUMOUS_AREA ) )\n@@ -359,7 +442,7 @@ public void add( NextInterceptor next, String upName, Name normName, Attributes\n                         }\n                         else if ( role.equalsIgnoreCase( AC_AREA ) || role.equalsIgnoreCase( AC_INNERAREA ) )\n                         {\n-                            operational = ( Attribute ) entry.get( AC_SUBENTRY ).clone();\n+                            operational = ( Attribute ) entry.get( AC_SUBENTRY );\n                             if ( operational == null )\n                             {\n                                 operational = new LockableAttributeImpl( AC_SUBENTRY );\n@@ -368,7 +451,7 @@ else if ( role.equalsIgnoreCase( AC_AREA ) || role.equalsIgnoreCase( AC_INNERARE\n                         }\n                         else if ( role.equalsIgnoreCase( SCHEMA_AREA ) )\n                         {\n-                            operational = ( Attribute ) entry.get( SCHEMA_AREA_SUBENTRY ).clone();\n+                            operational = ( Attribute ) entry.get( SCHEMA_AREA_SUBENTRY );\n                             if ( operational == null )\n                             {\n                                 operational = new LockableAttributeImpl( SCHEMA_AREA_SUBENTRY );\n@@ -378,7 +461,7 @@ else if ( role.equalsIgnoreCase( SCHEMA_AREA ) )\n                         else if ( role.equalsIgnoreCase( COLLECTIVE_AREA ) ||\n                                   role.equalsIgnoreCase( COLLECTIVE_INNERAREA ) )\n                         {\n-                            operational = ( Attribute ) entry.get( COLLECTIVE_ATTRIBUTE_SUBENTRIES ).clone();\n+                            operational = ( Attribute ) entry.get( COLLECTIVE_ATTRIBUTE_SUBENTRIES );\n                             if ( operational == null )\n                             {\n                                 operational = new LockableAttributeImpl( COLLECTIVE_ATTRIBUTE_SUBENTRIES );\n@@ -777,7 +860,7 @@ public void modify( NextInterceptor next, Name name, int modOp, Attributes mods\n         if ( objectClasses.contains( \"subentry\" ) && mods.get( \"subtreeSpecification\" ) != null )\n         {\n             SubtreeSpecification ssOld = ( SubtreeSpecification ) subtrees.remove( name.toString() );\n-            SubtreeSpecification ssNew = null;\n+            SubtreeSpecification ssNew;\n \n             try\n             {\n@@ -850,7 +933,7 @@ public void modify( NextInterceptor next, Name name, ModificationItem[] mods ) t\n \n         for ( int ii = 0; ii < mods.length; ii++ )\n         {\n-            if ( ( ( String ) mods[ii].getAttribute().getID() ).equalsIgnoreCase( \"subtreeSpecification\" ) )\n+            if ( \"subtreeSpecification\".equalsIgnoreCase( mods[ii].getAttribute().getID() ) )\n             {\n                 isSubtreeSpecificationModification = true;\n                 subtreeMod = mods[ii];\n@@ -860,7 +943,7 @@ public void modify( NextInterceptor next, Name name, ModificationItem[] mods ) t\n         if ( objectClasses.contains( \"subentry\" ) && isSubtreeSpecificationModification )\n         {\n             SubtreeSpecification ssOld = ( SubtreeSpecification ) subtrees.remove( name.toString() );\n-            SubtreeSpecification ssNew = null;\n+            SubtreeSpecification ssNew;\n \n             try\n             {\n@@ -936,7 +1019,7 @@ public void modify( NextInterceptor next, Name name, ModificationItem[] mods ) t\n         NamingEnumeration roles = administrativeRole.getAll();\n         while ( roles.hasMore() )\n         {\n-            Attribute operational = null;\n+            Attribute operational;\n             String role = ( String ) roles.next();\n \n             if ( role.equalsIgnoreCase( AUTONOUMOUS_AREA ) )"
            },
            {
                "sha": "52cbabdc290cef84e378d8a30c6db92dc9901852",
                "filename": "core/src/main/schema/apache.schema",
                "status": "modified",
                "additions": 12,
                "deletions": 0,
                "changes": 12,
                "blob_url": "https://github.com/apache/directory-server/blob/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/main/schema/apache.schema",
                "raw_url": "https://github.com/apache/directory-server/raw/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/main/schema/apache.schema",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/main/schema/apache.schema?ref=0a4e276dc33982ba994abc23dfea44d061c4f96a",
                "patch": "@@ -112,6 +112,18 @@ attributetype ( 1.2.6.1.4.1.18060.1.1.1.3.12 NAME 'prescriptiveACI'\n   SYNTAX 1.3.6.1.4.1.1466.115.121.1.1\n   USAGE directoryOperation )\n \n+attributetype ( 1.2.6.1.4.1.18060.1.1.1.3.13 NAME 'entryACI'\n+  DESC 'Access control information that applies to a single entry'\n+  EQUALITY directoryStringFirstComponentMatch\n+  SYNTAX 1.3.6.1.4.1.1466.115.121.1.1\n+  USAGE directoryOperation )\n+\n+attributetype ( 1.2.6.1.4.1.18060.1.1.1.3.13 NAME 'subentryACI'\n+  DESC 'Access control information that applies to a single subentry'\n+  EQUALITY directoryStringFirstComponentMatch\n+  SYNTAX 1.3.6.1.4.1.1466.115.121.1.1\n+  USAGE directoryOperation )\n+\n objectclass ( 1.2.6.1.4.1.18060.1.1.1.4.2\n     NAME 'accessControlSubentry'\n     AUXILIARY "
            },
            {
                "sha": "ba7bff67aa0965e2b26e9abdf721b48cb611225d",
                "filename": "core/src/test/org/apache/ldap/server/authz/AuthorizationServiceAsAdminTest.java",
                "status": "modified",
                "additions": 2,
                "deletions": 12,
                "changes": 14,
                "blob_url": "https://github.com/apache/directory-server/blob/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/test/org/apache/ldap/server/authz/AuthorizationServiceAsAdminTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/test/org/apache/ldap/server/authz/AuthorizationServiceAsAdminTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/test/org/apache/ldap/server/authz/AuthorizationServiceAsAdminTest.java?ref=0a4e276dc33982ba994abc23dfea44d061c4f96a",
                "patch": "@@ -21,14 +21,12 @@\n \n import javax.naming.NamingEnumeration;\n import javax.naming.NamingException;\n-import javax.naming.directory.Attributes;\n-import javax.naming.directory.DirContext;\n-import javax.naming.directory.SearchControls;\n-import javax.naming.directory.SearchResult;\n+import javax.naming.directory.*;\n \n import org.apache.ldap.common.exception.LdapNoPermissionException;\n import org.apache.ldap.common.message.LockableAttributesImpl;\n import org.apache.ldap.server.AbstractAdminTestCase;\n+import org.apache.ldap.server.subtree.SubentryService;\n \n \n /**\n@@ -101,28 +99,20 @@ public void testModifyOnAdminByAdmin() throws NamingException\n     public void testSearchSubtreeByAdmin() throws NamingException\n     {\n         SearchControls controls = new SearchControls();\n-\n         controls.setSearchScope( SearchControls.SUBTREE_SCOPE );\n-\n         HashSet set = new HashSet();\n-\n         NamingEnumeration list = sysRoot.search( \"\", \"(objectClass=*)\", controls );\n \n         while ( list.hasMore() )\n         {\n             SearchResult result = ( SearchResult ) list.next();\n-\n             set.add( result.getName() );\n         }\n \n         assertTrue( set.contains( \"ou=system\" ) );\n-\n         assertTrue( set.contains( \"ou=groups,ou=system\" ) );\n-\n         assertTrue( set.contains( \"ou=users,ou=system\" ) );\n-\n         assertTrue( set.contains( \"uid=akarasulu,ou=users,ou=system\" ) );\n-\n         assertTrue( set.contains( \"uid=admin,ou=system\" ) );\n     }\n }"
            },
            {
                "sha": "96b871116232b382f4ebd6bede761f5fce8ad4bc",
                "filename": "core/src/test/org/apache/ldap/server/authz/AuthorizationServiceAsNonAdminTest.java",
                "status": "modified",
                "additions": 73,
                "deletions": 6,
                "changes": 79,
                "blob_url": "https://github.com/apache/directory-server/blob/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/test/org/apache/ldap/server/authz/AuthorizationServiceAsNonAdminTest.java",
                "raw_url": "https://github.com/apache/directory-server/raw/0a4e276dc33982ba994abc23dfea44d061c4f96a/core/src/test/org/apache/ldap/server/authz/AuthorizationServiceAsNonAdminTest.java",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/core/src/test/org/apache/ldap/server/authz/AuthorizationServiceAsNonAdminTest.java?ref=0a4e276dc33982ba994abc23dfea44d061c4f96a",
                "patch": "@@ -18,17 +18,16 @@\n \n \n import java.util.HashSet;\n+import java.util.Hashtable;\n \n import javax.naming.NamingEnumeration;\n import javax.naming.NamingException;\n-import javax.naming.directory.Attributes;\n-import javax.naming.directory.DirContext;\n-import javax.naming.directory.SearchControls;\n-import javax.naming.directory.SearchResult;\n+import javax.naming.directory.*;\n \n import org.apache.ldap.common.exception.LdapNoPermissionException;\n import org.apache.ldap.common.message.LockableAttributesImpl;\n import org.apache.ldap.server.AbstractNonAdminTestCase;\n+import org.apache.ldap.server.subtree.SubentryService;\n \n \n /**\n@@ -40,6 +39,13 @@\n  */\n public class AuthorizationServiceAsNonAdminTest extends AbstractNonAdminTestCase\n {\n+    public AuthorizationServiceAsNonAdminTest()\n+    {\n+        super();\n+        super.configuration.setAccessControlEnabled( true );\n+    }\n+\n+\n     /**\n      * Makes sure a non-admin user cannot delete the admin account.\n      *\n@@ -106,8 +112,7 @@ public void testSearchSubtreeByNonAdmin() throws NamingException\n         controls.setSearchScope( SearchControls.SUBTREE_SCOPE );\n \n         HashSet set = new HashSet();\n-        NamingEnumeration list = sysRoot.search( \"\",\n-                \"(objectClass=*)\", controls );\n+        NamingEnumeration list = sysRoot.search( \"\", \"(objectClass=*)\", controls );\n         while ( list.hasMore() )\n         {\n             SearchResult result = ( SearchResult ) list.next();\n@@ -121,4 +126,66 @@ public void testSearchSubtreeByNonAdmin() throws NamingException\n         assertFalse( set.contains( \"uid=akarasulu,ou=users,ou=system\" ) );\n         assertFalse( set.contains( \"uid=admin,ou=system\" ) );\n     }\n+\n+\n+    private DirContext getAdminContext() throws NamingException\n+    {\n+        Hashtable env = ( Hashtable ) ( ( Hashtable ) sysRoot.getEnvironment() ).clone();\n+        env.put( DirContext.PROVIDER_URL, \"ou=system\" );\n+        env.put( DirContext.SECURITY_AUTHENTICATION, \"simple\" );\n+        env.put( DirContext.SECURITY_PRINCIPAL, \"uid=admin,ou=system\" );\n+        env.put( DirContext.SECURITY_CREDENTIALS, \"secret\" );\n+        return new InitialDirContext( env );\n+    }\n+\n+\n+    public void testGrantAddAllUsers() throws NamingException\n+    {\n+        DirContext adminCtx = getAdminContext();\n+\n+        // modify ou=system to be an AP for an A/C AA\n+        Attributes changes = new BasicAttributes( \"administrativeRole\", SubentryService.AC_AREA, true );\n+        adminCtx.modifyAttributes( \"\", DirContext.ADD_ATTRIBUTE, changes );\n+\n+        // try an add operation which should fail without any ACI\n+        Attributes testEntry = new BasicAttributes( \"ou\", \"testou\", true );\n+        Attribute objectClass = new BasicAttribute( \"objectClass\" );\n+        testEntry.put( objectClass );\n+        objectClass.add( \"top\" );\n+        objectClass.add( \"organizationalUnit\" );\n+\n+        try\n+        {\n+            sysRoot.createSubcontext( \"ou=testou\", testEntry );\n+            fail( \"should never get here due to a permission exception\" );\n+        }\n+        catch ( LdapNoPermissionException e ) {}\n+\n+        // now add a subentry that enables anyone to add an entry below ou=system\n+        Attributes subentry = new BasicAttributes( \"cn\", \"anybodyAdd\", true );\n+        objectClass = new BasicAttribute( \"objectClass\" );\n+        subentry.put( objectClass );\n+        objectClass.add( \"top\" );\n+        objectClass.add( \"subentry\" );\n+        objectClass.add( \"accessControlSubentry\" );\n+        subentry.put( \"subtreeSpecification\", \"{}\" );\n+        subentry.put( \"prescriptiveACI\", \"{ \" +\n+                \"identificationTag \\\"addAci\\\", \" +\n+                \"precedence 14, \" +\n+                \"authenticationLevel none, \" +\n+                \"itemOrUserFirst userFirst: { \" +\n+                \"userClasses { allUsers }, \" +\n+                \"userPermissions { { \" +\n+                \"protectedItems {entry}, \" +\n+                \"grantsAndDenials { grantAdd } } } } }\" );\n+        adminCtx.createSubcontext( \"cn=anybodyAdd\", subentry );\n+\n+        // see if we can now add that test entry which we could not before\n+        testEntry = new BasicAttributes( \"ou\", \"testou\", true );\n+        objectClass = new BasicAttribute( \"objectClass\" );\n+        testEntry.put( objectClass );\n+        objectClass.add( \"top\" );\n+        objectClass.add( \"organizationalUnit\" );\n+        sysRoot.createSubcontext( \"ou=testou\", testEntry );\n+    }\n }"
            },
            {
                "sha": "55d29792c589836791425d0001112cc66f5241fd",
                "filename": "main/server.xml",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/apache/directory-server/blob/0a4e276dc33982ba994abc23dfea44d061c4f96a/main/server.xml",
                "raw_url": "https://github.com/apache/directory-server/raw/0a4e276dc33982ba994abc23dfea44d061c4f96a/main/server.xml",
                "contents_url": "https://api.github.com/repos/apache/directory-server/contents/main/server.xml?ref=0a4e276dc33982ba994abc23dfea44d061c4f96a",
                "patch": "@@ -20,6 +20,7 @@\n   <bean id=\"configuration\" class=\"org.apache.ldap.server.configuration.MutableServerStartupConfiguration\">\n     <property name=\"workingDirectory\"><value>apache.org</value></property>\n     <property name=\"allowAnonymousAccess\"><value>false</value></property>\n+    <property name=\"accessControlEnabled\"><value>false</value></property>\n     <property name=\"ldapPort\"><value>10389</value></property>\n     <property name=\"contextPartitionConfigurations\">\n       <set>"
            }
        ]
    }
]
