<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Order by clause</title>
<link rel="stylesheet" href="css/blazebit.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="prettify/prettify.min.css">
<script src="prettify/prettify.min.js"></script>
<script src="prettify/lang-ext.js"></script>
<script>document.addEventListener('DOMContentLoaded', prettyPrint)</script>
<link rel="shortcut icon" href="images/favicon.png">
</head>
<body class="book toc2 toc-left">

<div class="brand">
    <a class="vendor" href="https://blazebit.com">
        <strong>Blazebit.com</strong>
    </a>
    <a class="logo" href="https://persistence.blazebit.com">
        <strong>blaze-persistence</strong>
    </a>
</div>
<br/>

<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#anchor-order-by-clause">Order by clause</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="anchor-order-by-clause"><a class="anchor" href="#anchor-order-by-clause"></a>Order by clause</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An <code>ORDER BY</code> clause can be used to order the underlying result list.
Depending on the mapping and the collection type in an entity, the order of elements contained in collection may or may not be preserved.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Contrary to what the JPA spec allows, {projectname} also allows to use the <code>ORDER BY</code> clause in subqueries.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, the use of complex expressions is allowed in <a href="{core_jdoc}/persistence/OrderByBuilder.html#orderBy(java.lang.String,%20boolean,%20boolean)"><code>orderBy()</code></a>,
but can be disabled by turning on the <a href="#compatible_mode">compatible mode</a>.</p>
</div>
<div class="paragraph">
<p>Also note that by default, {projectname} chose to use the <code>NULLS LAST</code> behavior instead of relying on the DBMS default, in order to provide better portability.
It is strongly advised to always define the <em>null precedence</em> in order to get deterministic results.</p>
</div>
<div class="paragraph">
<p>For convenience {projectname} also offers you shorthand methods for ordering <a href="{core_jdoc}/persistence/OrderByBuilder.html#orderByAsc(java.lang.String)">ascending</a>
or <a href="{core_jdoc}/persistence/OrderByBuilder.html#orderByDesc(java.lang.String)">descending</a> that make use of the default <em>null precedence</em>.</p>
</div>
<div class="listingblock">
<div class="content">
    <pre class="prettyprint javaext lang-javaext">CriteriaBuilder&lt;Tuple&gt; cb = cbf.create(em, Tuple.class)
    .from(Cat.class)
    .select("age")
    .select("id")
    .orderByAsc("age")
    .orderByDesc("id");</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
    <pre class="prettyprint sqlext lang-sqlext">SELECT cat.age, cat.id
FROM Cat cat
ORDER BY
    cat.age ASC NULLS LAST,
    cat.id DESC NULLS LAST</pre>
</div>
</div>
<div class="paragraph">
<p>Apart from specifying the expression itself for an <code>ORDER BY</code> element, you can also refer to a select alias.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is also the only way to order by the result of a subquery. Many DBMS do not support the occurrence of a subquery in <code>ORDER BY</code> directly, so {projectname} dos not allow to do that either.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
    <pre class="prettyprint javaext lang-javaext">CriteriaBuilder&lt;Tuple&gt; cb = cbf.create(em, Tuple.class)
    .from(Cat.class)
    .selectSubquery("olderCatCount")
        .from(Cat.class, "subCat")
        .select("COUNT(*)")
        .where("subCat.age").gtExpression("cat.age")
    .end()
    .select("id")
    .orderByAsc("olderCatCount")
    .orderByDesc("id");</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
    <pre class="prettyprint sqlext lang-sqlext">SELECT
    (
        SELECT COUNT(*)
        FROM Cat subCat
        WHERE subCat.age &gt; cat.age
    ) AS olderCatCount,
    cat.id
FROM Cat cat
ORDER BY
    olderCatCount ASC NULLS LAST,
    cat.id DESC NULLS LAST</pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-08-04 13:32:35 KST
</div>
</div>
</body>
</html>