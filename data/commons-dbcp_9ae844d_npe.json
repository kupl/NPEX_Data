[
    {
        "repo": "commons-dbcp",
        "commit": "https://github.com/apache/commons-dbcp/commit/9ae844dbf476eba54ac52d9842cba0505c4c6666",
        "bug_id": "commons-dbcp_9ae844d",
        "message": "Added null check to DelegatingConnection#closeInternal. Prior to this change, NPEs were being generated by ManagedConnection#close.\n\nJIRA: DBCP-438\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/commons/proper/dbcp/trunk@1691861 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/commons-dbcp/commit/e1f732a6dc9ad194ca6c89bab45ad2d54c963a1b",
        "patched_files": [
            "changes.xml",
            "DelegatingConnection.java",
            "ManagedDataSource.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/commons-dbcp/raw/9ae844dbf476eba54ac52d9842cba0505c4c6666/src/changes/changes.xml",
                "contents_url": "https://api.github.com/repos/apache/commons-dbcp/contents/src/changes/changes.xml?ref=9ae844dbf476eba54ac52d9842cba0505c4c6666",
                "filename": "src/changes/changes.xml",
                "deletions": 0,
                "sha": "67e81f03f0d67eb42edfaf7414e50cd8e663079e",
                "blob_url": "https://github.com/apache/commons-dbcp/blob/9ae844dbf476eba54ac52d9842cba0505c4c6666/src/changes/changes.xml",
                "patch": "@@ -61,6 +61,9 @@ The <action> type attribute can be add,update,fix,remove.\n \n   <body>\n     <release version=\"2.1.1\" date=\"TBD\" description=\"Bug fixes.\">\n+      <action issue=\"DBCP-438\" dev=\"psteitz\" type=\"fix\" due-to=\"Raihan Kibria\">\n+        Nested connections in a transaction (local) throws null pointer. \n+      </action>\n       <action issue=\"DBCP-437\" dev=\"psteitz\" type=\"fix\">\n         BasicDataSource does not set disconnectionSql properties on its PoolableConnectionFactory.\n       </action>",
                "changes": 3
            },
            {
                "status": "modified",
                "additions": 7,
                "raw_url": "https://github.com/apache/commons-dbcp/raw/9ae844dbf476eba54ac52d9842cba0505c4c6666/src/main/java/org/apache/commons/dbcp2/DelegatingConnection.java",
                "contents_url": "https://api.github.com/repos/apache/commons-dbcp/contents/src/main/java/org/apache/commons/dbcp2/DelegatingConnection.java?ref=9ae844dbf476eba54ac52d9842cba0505c4c6666",
                "filename": "src/main/java/org/apache/commons/dbcp2/DelegatingConnection.java",
                "deletions": 3,
                "sha": "00657379b6293dc164901414eadba4a752052b75",
                "blob_url": "https://github.com/apache/commons-dbcp/blob/9ae844dbf476eba54ac52d9842cba0505c4c6666/src/main/java/org/apache/commons/dbcp2/DelegatingConnection.java",
                "patch": "@@ -231,9 +231,13 @@ protected final void closeInternal() throws SQLException {\n         try {\n             passivate();\n         } finally {\n-            try {\n-                _conn.close();\n-            } finally {\n+            if (_conn != null) {\n+                try {\n+                    _conn.close();\n+                } finally {\n+                    _closed = true;\n+                }\n+            } else {\n                 _closed = true;\n             }\n         }",
                "changes": 10
            },
            {
                "status": "modified",
                "additions": 16,
                "raw_url": "https://github.com/apache/commons-dbcp/raw/9ae844dbf476eba54ac52d9842cba0505c4c6666/src/test/java/org/apache/commons/dbcp2/managed/TestManagedDataSource.java",
                "contents_url": "https://api.github.com/repos/apache/commons-dbcp/contents/src/test/java/org/apache/commons/dbcp2/managed/TestManagedDataSource.java?ref=9ae844dbf476eba54ac52d9842cba0505c4c6666",
                "filename": "src/test/java/org/apache/commons/dbcp2/managed/TestManagedDataSource.java",
                "deletions": 0,
                "sha": "acae0bf51553598cddd8bfa1822406eb207e52c1",
                "blob_url": "https://github.com/apache/commons-dbcp/blob/9ae844dbf476eba54ac52d9842cba0505c4c6666/src/test/java/org/apache/commons/dbcp2/managed/TestManagedDataSource.java",
                "patch": "@@ -242,4 +242,20 @@ public void testManagedConnectionEqualInnermost() throws Exception {\n         assertTrue(con2.innermostDelegateEquals(inner));\n         assertFalse(con.equals(con2));\n     }\n+    \n+    @Test\n+    public void testNestedConnections() throws Exception {\n+        transactionManager.begin();\n+        \n+        Connection c1 = null;\n+        Connection c2 = null;\n+        \n+        c1 = newConnection();\n+        c2 = newConnection();\n+        \n+        transactionManager.commit();\n+        \n+        c1.close();\n+        c2.close();\n+    }   \n }",
                "changes": 16
            },
            {
                "status": "modified",
                "additions": 6,
                "raw_url": "https://github.com/apache/commons-dbcp/raw/9ae844dbf476eba54ac52d9842cba0505c4c6666/src/test/java/org/apache/commons/dbcp2/managed/TestManagedDataSourceInTx.java",
                "contents_url": "https://api.github.com/repos/apache/commons-dbcp/contents/src/test/java/org/apache/commons/dbcp2/managed/TestManagedDataSourceInTx.java?ref=9ae844dbf476eba54ac52d9842cba0505c4c6666",
                "filename": "src/test/java/org/apache/commons/dbcp2/managed/TestManagedDataSourceInTx.java",
                "deletions": 0,
                "sha": "d6726014a8277f358d1669e25647edeb1dc711f6",
                "blob_url": "https://github.com/apache/commons-dbcp/blob/9ae844dbf476eba54ac52d9842cba0505c4c6666/src/test/java/org/apache/commons/dbcp2/managed/TestManagedDataSourceInTx.java",
                "patch": "@@ -70,6 +70,12 @@ public void testManagedConnectionEqualsFail() throws Exception {\n         // two connections to the same datasource are supposed to share\n         // a single connection\n     }\n+    \n+    @Override\n+    @Test\n+    public void testNestedConnections() {\n+        // Not supported\n+    }\n \n     @Override\n     @Test",
                "changes": 6
            }
        ],
        "unit_tests": [
            "TestManagedDataSource.java",
            "TestDelegatingConnection.java",
            "TestManagedDataSourceInTx.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "src/test/java/org/apache/commons/dbcp2/managed/TestManagedDataSource.java",
        "buggy_files": [
            "src/changes/changes.xml",
            "src/main/java/org/apache/commons/dbcp2/DelegatingConnection.java",
            "src/main/java/org/apache/commons/dbcp2/managed/ManagedDataSource.java"
        ],
        "fixed": true
    }
]