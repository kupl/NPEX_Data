[
    {
        "repo": "mina-ftpserver",
        "message": "Fixed NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/ftpserver/trunk@395569 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-ftpserver/commit/fb9f219bdd47a4ce430abddfbc4ced15e714ca35",
        "parent": "https://github.com/apache/mina-ftpserver/commit/1f0c541806274fa0f4e0bf92c2a9f6a846a783cc",
        "bug_id": "mina-ftpserver_1",
        "file": [
            {
                "sha": "9c84abbf28b8520b78996c39c4aa3c801f821bf7",
                "filename": "src/java/org/apache/ftpserver/config/PropertiesConfiguration.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/fb9f219bdd47a4ce430abddfbc4ced15e714ca35/src/java/org/apache/ftpserver/config/PropertiesConfiguration.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/fb9f219bdd47a4ce430abddfbc4ced15e714ca35/src/java/org/apache/ftpserver/config/PropertiesConfiguration.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/src/java/org/apache/ftpserver/config/PropertiesConfiguration.java?ref=fb9f219bdd47a4ce430abddfbc4ced15e714ca35",
                "patch": "@@ -57,7 +57,7 @@ public PropertiesConfiguration(InputStream in) throws IOException {\n      * Constructor - set the properties.\n      */\n     public PropertiesConfiguration(Properties prop) {\n-        prop = new Properties(prop);\n+        this.prop = new Properties(prop);\n     }    \n     \n ",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "mina-ftpserver",
        "message": "Fix a potential NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/ftpserver/trunk@746812 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-ftpserver/commit/54a34f43b7b4019f0ea310ff44ac61a3dcb3b3ef",
        "parent": "https://github.com/apache/mina-ftpserver/commit/f6c8f3e3825ad27394c6b0c128b68f3018b8517d",
        "bug_id": "mina-ftpserver_2",
        "file": [
            {
                "sha": "cbab9e3d7767abd090d79e4116dd7e8869286745",
                "filename": "core/src/main/java/org/apache/ftpserver/filesystem/nativefs/impl/NativeFtpFile.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/54a34f43b7b4019f0ea310ff44ac61a3dcb3b3ef/core/src/main/java/org/apache/ftpserver/filesystem/nativefs/impl/NativeFtpFile.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/54a34f43b7b4019f0ea310ff44ac61a3dcb3b3ef/core/src/main/java/org/apache/ftpserver/filesystem/nativefs/impl/NativeFtpFile.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/core/src/main/java/org/apache/ftpserver/filesystem/nativefs/impl/NativeFtpFile.java?ref=54a34f43b7b4019f0ea310ff44ac61a3dcb3b3ef",
                "patch": "@@ -496,7 +496,7 @@ public final static String getPhysicalName(final String rootDir,\n                 File[] matches = new File(resArg)\n                         .listFiles(new NameEqualsFileFilter(tok, true));\n \n-                if (matches.length > 0) {\n+                if (matches != null && matches.length > 0) {\n                     tok = matches[0].getName();\n                 }\n             }",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "mina-ftpserver",
        "message": "NPE in daemon (FTPSERVER-169)\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/ftpserver/trunk@688969 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-ftpserver/commit/25d6a0b20a596a40047a78c284cf2b7b69901745",
        "parent": "https://github.com/apache/mina-ftpserver/commit/f44bd27da2bed94d169e150f6734c824e3080e78",
        "bug_id": "mina-ftpserver_3",
        "file": [
            {
                "sha": "0d87a09fa5b51298df83e957cb27a083b1369a4c",
                "filename": "core/src/main/java/org/apache/ftpserver/main/Daemon.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/25d6a0b20a596a40047a78c284cf2b7b69901745/core/src/main/java/org/apache/ftpserver/main/Daemon.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/25d6a0b20a596a40047a78c284cf2b7b69901745/core/src/main/java/org/apache/ftpserver/main/Daemon.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/core/src/main/java/org/apache/ftpserver/main/Daemon.java?ref=25d6a0b20a596a40047a78c284cf2b7b69901745",
                "patch": "@@ -45,7 +45,7 @@ public static void main(String[] args) throws Exception {\n         try {\n             if (server == null) {\n                 // get configuration\n-                FtpServer server = getConfiguration(args);\n+                server = getConfiguration(args);\n                 if (server == null) {\n                     LOG.error(\"No configuration provided\");\n                     throw new FtpException(\"No configuration provided\");",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "mina-ftpserver",
        "message": "Fix potential NPE in PropertiesUserManager (FTPSERVER-145)\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/ftpserver/trunk@683615 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-ftpserver/commit/e934827758f0019c2dd23c42da27673356125790",
        "parent": "https://github.com/apache/mina-ftpserver/commit/a63073007ab5cd1c8e638b747b8693d01c5445b5",
        "bug_id": "mina-ftpserver_4",
        "file": [
            {
                "sha": "2406c9a494b5f131baa6744f5b573a36ff8d12f6",
                "filename": "core/src/main/java/org/apache/ftpserver/usermanager/PropertiesUserManager.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/e934827758f0019c2dd23c42da27673356125790/core/src/main/java/org/apache/ftpserver/usermanager/PropertiesUserManager.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/e934827758f0019c2dd23c42da27673356125790/core/src/main/java/org/apache/ftpserver/usermanager/PropertiesUserManager.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/core/src/main/java/org/apache/ftpserver/usermanager/PropertiesUserManager.java?ref=e934827758f0019c2dd23c42da27673356125790",
                "patch": "@@ -224,7 +224,7 @@ public synchronized void save(User usr) throws FtpException {\n      * @throws FtpException\n      */\n     private void saveUserData() throws FtpException {\n-        File dir = userDataFile.getParentFile();\n+        File dir = userDataFile.getAbsoluteFile().getParentFile();\n         if(dir != null && !dir.exists() && !dir.mkdirs() ) {\n             String dirName = dir.getAbsolutePath();\n             throw new FtpServerConfigurationException(\"Cannot create directory for user data file : \" + dirName);",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "mina-ftpserver",
        "message": "Fixed potential NPEs\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/ftpserver/trunk@581383 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-ftpserver/commit/43692fc3904e1f05da3cfa93806cc241cab77661",
        "parent": "https://github.com/apache/mina-ftpserver/commit/c1b8e1ff1036b154e7d1f033592292b57f8dc6d8",
        "bug_id": "mina-ftpserver_5",
        "file": [
            {
                "sha": "6353365712645eeef4f553d052cb89cd33b40c1b",
                "filename": "core/src/java/org/apache/ftpserver/command/PASS.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/43692fc3904e1f05da3cfa93806cc241cab77661/core/src/java/org/apache/ftpserver/command/PASS.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/43692fc3904e1f05da3cfa93806cc241cab77661/core/src/java/org/apache/ftpserver/command/PASS.java",
                "status": "modified",
                "changes": 17,
                "additions": 10,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/core/src/java/org/apache/ftpserver/command/PASS.java?ref=43692fc3904e1f05da3cfa93806cc241cab77661",
                "patch": "@@ -98,14 +98,17 @@ public void execute(Connection connection,\n             }\n             \n             // anonymous login limit check\n-            boolean anonymous = userName.equals(\"anonymous\");\n-            int currAnonLogin = stat.getCurrentAnonymousLoginNumber();\n-            int maxAnonLogin = conManager.getMaxAnonymousLogins();\n-            if( anonymous && (currAnonLogin >= maxAnonLogin) ) {\n-                out.write(FtpReplyUtil.translate(session, FtpReply.REPLY_421_SERVICE_NOT_AVAILABLE_CLOSING_CONTROL_CONNECTION, \"PASS.anonymous\", null));\n-                return;\n-            }\n             \n+            boolean anonymous = userName != null && userName.equals(\"anonymous\");\n+            if(anonymous) {\n+\t            int currAnonLogin = stat.getCurrentAnonymousLoginNumber();\n+\t            int maxAnonLogin = conManager.getMaxAnonymousLogins();\n+\t            if( currAnonLogin >= maxAnonLogin ) {\n+\t                out.write(FtpReplyUtil.translate(session, FtpReply.REPLY_421_SERVICE_NOT_AVAILABLE_CLOSING_CONTROL_CONNECTION, \"PASS.anonymous\", null));\n+\t                return;\n+\t            }\n+            }\n+\t            \n             // login limit check\n             int currLogin = stat.getCurrentLoginNumber();\n             int maxLogin = conManager.getMaxLogins();",
                "deletions": 7
            },
            {
                "sha": "6c0390ebb3dfdc45d0c61afc6a28c6e22447ad1c",
                "filename": "core/src/java/org/apache/ftpserver/util/ClassUtils.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/43692fc3904e1f05da3cfa93806cc241cab77661/core/src/java/org/apache/ftpserver/util/ClassUtils.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/43692fc3904e1f05da3cfa93806cc241cab77661/core/src/java/org/apache/ftpserver/util/ClassUtils.java",
                "status": "modified",
                "changes": 7,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/core/src/java/org/apache/ftpserver/util/ClassUtils.java?ref=43692fc3904e1f05da3cfa93806cc241cab77661",
                "patch": "@@ -76,9 +76,12 @@ private static void setProperty(Object target, PropertyDescriptor setter, Object\n                 throw new RuntimeException(\"Failed invoking setter \" + setter.getDisplayName() + \" on \" + target, e);\n             }\n         } else {\n-            throw new RuntimeException(\"Property \\\"\" + setter.getDisplayName() + \"\\\" is not settable on class \"+ target.getClass());\n+        \tif(setter != null) {\n+        \t\tthrow new RuntimeException(\"Property \\\"\" + setter.getDisplayName() + \"\\\" is not settable on class \"+ target.getClass());\n+        \t} else {\n+        \t\tthrow new RuntimeException(\"Property is not settable on class \"+ target.getClass());\n+        \t}\n         }\n-        \n     }\n     \n     private static void setProperty(Object target, PropertyDescriptor setter, String propertyValue) {",
                "deletions": 2
            }
        ]
    },
    {
        "repo": "mina-ftpserver",
        "message": "Adding some NPE checks\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/ftpserver/trunk@497032 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-ftpserver/commit/421bc5e5638ef185d5ee576ecf33fb1198dd1fa1",
        "parent": "https://github.com/apache/mina-ftpserver/commit/0f214c11ca25f316b5951f285d5f747e450ea459",
        "bug_id": "mina-ftpserver_6",
        "file": [
            {
                "sha": "1869e9ba7e3bad63f40deb11856b1a3e589007d3",
                "filename": "core/src/java/org/apache/ftpserver/FtpDataConnection.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/421bc5e5638ef185d5ee576ecf33fb1198dd1fa1/core/src/java/org/apache/ftpserver/FtpDataConnection.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/421bc5e5638ef185d5ee576ecf33fb1198dd1fa1/core/src/java/org/apache/ftpserver/FtpDataConnection.java",
                "status": "modified",
                "changes": 11,
                "additions": 10,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/core/src/java/org/apache/ftpserver/FtpDataConnection.java?ref=421bc5e5638ef185d5ee576ecf33fb1198dd1fa1",
                "patch": "@@ -91,7 +91,16 @@ public synchronized void closeDataSocket() {\n             catch(Exception ex) {\n                 log.warn(\"FtpDataConnection.closeDataSocket()\", ex);\n             }\n-            serverContext.getDataConnectionConfig().releasePassivePort(port);\n+            \n+            FtpServerContext ctx = serverContext;\n+            \n+            if(ctx != null) {\n+                DataConnectionConfig dcc = ctx.getDataConnectionConfig();\n+                if(dcc != null) {\n+                    dcc.releasePassivePort(port);\n+                }\n+            }\n+            \n             servSoc = null;\n         }\n         ",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "mina-ftpserver",
        "message": "fix NPE for \"client.login.time\" message template\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/ftpserver/trunk@405709 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-ftpserver/commit/b81a159d91cb7516053489e52d9cf019a542511e",
        "parent": "https://github.com/apache/mina-ftpserver/commit/0fa247e5d856348dcdaab8a8dadf3097eb98502e",
        "bug_id": "mina-ftpserver_7",
        "file": [
            {
                "sha": "a0b37bc336246a2ef88abf659ca87f7fe3ecc417",
                "filename": "src/java/org/apache/ftpserver/FtpWriter.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/b81a159d91cb7516053489e52d9cf019a542511e/src/java/org/apache/ftpserver/FtpWriter.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/b81a159d91cb7516053489e52d9cf019a542511e/src/java/org/apache/ftpserver/FtpWriter.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/src/java/org/apache/ftpserver/FtpWriter.java?ref=b81a159d91cb7516053489e52d9cf019a542511e",
                "patch": "@@ -520,7 +520,7 @@ else if(varName.equals(CLIENT_CON_TIME)) {\n         \n         // client login name\n         else if(varName.equals(CLIENT_LOGIN_NAME)) {\n-            varVal = request.getUser().getName();\n+            varVal = request.getUserArgument();\n         }\n         \n         // client login time",
                "deletions": 1
            },
            {
                "sha": "1163da96c53407504a5815839a4c316962832cbd",
                "filename": "src/java/org/apache/ftpserver/ftplet/FtpRequest.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/b81a159d91cb7516053489e52d9cf019a542511e/src/java/org/apache/ftpserver/ftplet/FtpRequest.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/b81a159d91cb7516053489e52d9cf019a542511e/src/java/org/apache/ftpserver/ftplet/FtpRequest.java",
                "status": "modified",
                "changes": 9,
                "additions": 8,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/src/java/org/apache/ftpserver/ftplet/FtpRequest.java?ref=b81a159d91cb7516053489e52d9cf019a542511e",
                "patch": "@@ -83,11 +83,18 @@\n      * {@link User#getMaxIdleTime()} after user login.\n      */\n     void setMaxIdleTime(int maxIdleTimeSec);\n-    \n+\n     /**\n      * Get user object.\n      */\n     User getUser();\n+\n+    /**\n+     * Returns user name entered in USER command\n+     * \n+     * @return user name entered in USER command\n+     */\n+    String getUserArgument();\n     \n     /**\n      * Get the requested language.",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "mina-ftpserver",
        "message": "fix NPE when User is not loggined yet\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/ftpserver/trunk@405700 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-ftpserver/commit/0fa247e5d856348dcdaab8a8dadf3097eb98502e",
        "parent": "https://github.com/apache/mina-ftpserver/commit/94f01fefc22e308a47702c6f3de3fe7710eaa115",
        "bug_id": "mina-ftpserver_8",
        "file": [
            {
                "sha": "8946d14de4468701b5859f8ce4e1e99d9fd61cf6",
                "filename": "src/java/org/apache/ftpserver/RequestHandler.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/0fa247e5d856348dcdaab8a8dadf3097eb98502e/src/java/org/apache/ftpserver/RequestHandler.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/0fa247e5d856348dcdaab8a8dadf3097eb98502e/src/java/org/apache/ftpserver/RequestHandler.java",
                "status": "modified",
                "changes": 11,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/src/java/org/apache/ftpserver/RequestHandler.java?ref=0fa247e5d856348dcdaab8a8dadf3097eb98502e",
                "patch": "@@ -26,13 +26,7 @@\n import java.net.SocketException;\n \n import org.apache.commons.logging.Log;\n-import org.apache.ftpserver.ftplet.DataType;\n-import org.apache.ftpserver.ftplet.FileSystemView;\n-import org.apache.ftpserver.ftplet.FtpException;\n-import org.apache.ftpserver.ftplet.FtpRequest;\n-import org.apache.ftpserver.ftplet.Ftplet;\n-import org.apache.ftpserver.ftplet.FtpletEnum;\n-import org.apache.ftpserver.ftplet.Structure;\n+import org.apache.ftpserver.ftplet.*;\n import org.apache.ftpserver.interfaces.ConnectionObserver;\n import org.apache.ftpserver.interfaces.ICommand;\n import org.apache.ftpserver.interfaces.ICommandFactory;\n@@ -326,7 +320,8 @@ public void close() {\n         if(request != null) {\n             \n             // log message\n-            String userName = request.getUser().getName();\n+            User user = request.getUser();\n+            String userName = user != null ? user.getName() : \"<Not loginned>\";\n             InetAddress clientAddr = request.getRemoteAddress(); \n             log.info(\"Close connection : \" + clientAddr.getHostAddress() + \" - \" + userName);\n             ",
                "deletions": 8
            }
        ]
    },
    {
        "repo": "mina-ftpserver",
        "message": "Working around a bug in the IBM JVM which might cause a NPE in test tear down (FTPSERVER-422)\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/ftpserver/trunk@1138754 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-ftpserver/commit/309d7942df4ae24332d28929b5464f7ab8a2373a",
        "parent": "https://github.com/apache/mina-ftpserver/commit/02765e5bcaaa55d94227dd35a37293889e6c0844",
        "bug_id": "mina-ftpserver_9",
        "file": [
            {
                "sha": "aad9d526a0f8608f600b784cbf33d133f59f866e",
                "filename": "core/src/test/java/org/apache/ftpserver/clienttests/ClientTestTemplate.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/309d7942df4ae24332d28929b5464f7ab8a2373a/core/src/test/java/org/apache/ftpserver/clienttests/ClientTestTemplate.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/309d7942df4ae24332d28929b5464f7ab8a2373a/core/src/test/java/org/apache/ftpserver/clienttests/ClientTestTemplate.java",
                "status": "modified",
                "changes": 7,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/core/src/test/java/org/apache/ftpserver/clienttests/ClientTestTemplate.java?ref=309d7942df4ae24332d28929b5464f7ab8a2373a",
                "patch": "@@ -227,7 +227,12 @@ protected void tearDown() throws Exception {\n         }\n \n         if (server != null) {\n-            server.stop();\n+        \ttry {\n+        \t\tserver.stop();\n+        \t} catch(NullPointerException e) {\n+        \t\t// a bug in the IBM JVM might cause Thread.interrupt() to throw an NPE\n+        \t\t// see http://www-01.ibm.com/support/docview.wss?uid=swg1IZ52037&wv=1\n+        \t}\n         }\n \n         cleanTmpDirs();",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "mina-ftpserver",
        "message": "Fixing NPE thrown when restarting a stopped FtpServer and improving Javadoc for this (FTPSERVER-340)\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/ftpserver/trunk@882110 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-ftpserver/commit/10df73239d9ff8274dfe8f3fa59be14a49dad49f",
        "parent": "https://github.com/apache/mina-ftpserver/commit/8497b0b094d6caa110602b695055c965c567c537",
        "bug_id": "mina-ftpserver_10",
        "file": [
            {
                "sha": "680bd19a8471015094d9f525cab79ad6f6eed736",
                "filename": "core/src/main/java/org/apache/ftpserver/impl/DefaultFtpServer.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/10df73239d9ff8274dfe8f3fa59be14a49dad49f/core/src/main/java/org/apache/ftpserver/impl/DefaultFtpServer.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/10df73239d9ff8274dfe8f3fa59be14a49dad49f/core/src/main/java/org/apache/ftpserver/impl/DefaultFtpServer.java",
                "status": "modified",
                "changes": 7,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/core/src/main/java/org/apache/ftpserver/impl/DefaultFtpServer.java?ref=10df73239d9ff8274dfe8f3fa59be14a49dad49f",
                "patch": "@@ -67,6 +67,10 @@ public DefaultFtpServer(final FtpServerContext serverContext) {\n      * @throws FtpException \n      */\n     public void start() throws FtpException {\n+        if (serverContext == null) {\n+            // we have already been stopped, can not be restarted\n+            throw new IllegalStateException(\"FtpServer has been stopped. Restart is not supported\");\n+        }\n \n         List<Listener> startedListeners = new ArrayList<Listener>();\n         \n@@ -99,7 +103,8 @@ public void start() throws FtpException {\n     }\n \n     /**\n-     * Stop the server. Stop the listener thread.\n+     * Stop the server. Stopping the server will close completely and \n+     * it not supported to restart using {@link #start()}.\n      */\n     public void stop() {\n         if (serverContext == null) {",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "mina-ftpserver",
        "message": "Added protection against NPE in the unlikely case that the user has no authorities\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/ftpserver/trunk@689490 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-ftpserver/commit/81ac8af8dde8197681884f644627a7f7b8c34971",
        "parent": "https://github.com/apache/mina-ftpserver/commit/5c8579b25ebbab0af702e52dfdeb0c3cb3c8dce2",
        "bug_id": "mina-ftpserver_11",
        "file": [
            {
                "sha": "85d1293c8fa46cbe7b5321ca3070d8e6dca6d0f2",
                "filename": "core/src/main/java/org/apache/ftpserver/usermanager/BaseUser.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/81ac8af8dde8197681884f644627a7f7b8c34971/core/src/main/java/org/apache/ftpserver/usermanager/BaseUser.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/81ac8af8dde8197681884f644627a7f7b8c34971/core/src/main/java/org/apache/ftpserver/usermanager/BaseUser.java",
                "status": "modified",
                "changes": 5,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/core/src/main/java/org/apache/ftpserver/usermanager/BaseUser.java?ref=81ac8af8dde8197681884f644627a7f7b8c34971",
                "patch": "@@ -180,6 +180,11 @@ public String toString() {\n     public AuthorizationRequest authorize(AuthorizationRequest request) {\n         Authority[] authorities = getAuthorities();\n \n+        // check for no authorities at all\n+        if(authorities == null) {\n+            return null;\n+        }\n+        \n         boolean someoneCouldAuthorize = false;\n         for (int i = 0; i < authorities.length; i++) {\n             Authority authority = authorities[i];",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "mina-ftpserver",
        "message": "Fixed potential NPE in PASS. Thanks to Dave Roberts for the report and patch (FTPSERVER-115)\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/ftpserver/trunk@596658 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-ftpserver/commit/b047c1ef804d9e6680aeb95180285e57359199ae",
        "parent": "https://github.com/apache/mina-ftpserver/commit/c9c1544aa07e61c01870d0fc7fa308748bf1a551",
        "bug_id": "mina-ftpserver_12",
        "file": [
            {
                "sha": "4241094ff27808f5d7ab0fbd92d15650ada4a08f",
                "filename": "core/src/java/org/apache/ftpserver/DefaultFtpServerContext.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/b047c1ef804d9e6680aeb95180285e57359199ae/core/src/java/org/apache/ftpserver/DefaultFtpServerContext.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/b047c1ef804d9e6680aeb95180285e57359199ae/core/src/java/org/apache/ftpserver/DefaultFtpServerContext.java",
                "status": "modified",
                "changes": 7,
                "additions": 7,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/core/src/java/org/apache/ftpserver/DefaultFtpServerContext.java?ref=b047c1ef804d9e6680aeb95180285e57359199ae",
                "patch": "@@ -250,6 +250,13 @@ public void dispose() {\n             listenerBean.destroyBean();\n         }\n         \n+//        Iterator listenerIter = listeners.values().iterator();\n+//        while (listenerIter.hasNext()) {\n+//            Listener listenerBean = (Listener) listenerIter.next();\n+//            listenerBean.stop();\n+//        }\n+\n+        \n         if(connectionManager != null && connectionManager instanceof Component) {\n             ((Component)connectionManager).dispose();\n         }",
                "deletions": 0
            },
            {
                "sha": "d0608202d8bc2e0844966ff6d573d49fb69b063f",
                "filename": "core/src/java/org/apache/ftpserver/command/PASS.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/b047c1ef804d9e6680aeb95180285e57359199ae/core/src/java/org/apache/ftpserver/command/PASS.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/b047c1ef804d9e6680aeb95180285e57359199ae/core/src/java/org/apache/ftpserver/command/PASS.java",
                "status": "modified",
                "changes": 7,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/core/src/java/org/apache/ftpserver/command/PASS.java?ref=b047c1ef804d9e6680aeb95180285e57359199ae",
                "patch": "@@ -93,7 +93,6 @@ public void execute(Connection connection,\n             // already logged-in\n             if(session.isLoggedIn()) {\n                 out.write(FtpReplyUtil.translate(session, FtpReply.REPLY_202_COMMAND_NOT_IMPLEMENTED, \"PASS\", null));\n-                success = true;\n                 return;\n             }\n             \n@@ -133,14 +132,11 @@ public void execute(Connection connection,\n                     auth = new UsernamePasswordAuthentication(userName, password, userMetadata);\n                 }\n                 authenticatedUser = userManager.authenticate(auth);\n-                success = true;\n             } catch(AuthenticationFailedException e) { \n-                success = false;\n                 authenticatedUser = null;\n                 LOG.warn(\"User failed to log in\", e);                \n             }\n             catch(Exception e) {\n-                success = false;\n                 authenticatedUser = null;\n                 LOG.warn(\"PASS.execute()\", e);\n             }\n@@ -153,10 +149,11 @@ public void execute(Connection connection,\n             String oldUserArgument = session.getUserArgument();\n             int oldMaxIdleTime = session.getMaxIdleTime();\n \n-            if(success) {\n+            if(authenticatedUser != null) {\n                 session.setUser(authenticatedUser);\n                 session.setUserArgument(null);\n                 session.setMaxIdleTime(authenticatedUser.getMaxIdleTime());\n+                success = true;\n             } else {\n                 session.setUser(null);\n             }",
                "deletions": 5
            }
        ]
    },
    {
        "repo": "mina-ftpserver",
        "message": "Catch NPE in start server button behaviout in GUI - Sergey M Vladimirov\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/ftpserver/trunk@306734 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-ftpserver/commit/3074d6e4ff50c504bf002ff7537acdeb427926f9",
        "parent": "https://github.com/apache/mina-ftpserver/commit/1463907e0637bcf56b9b3e26b78a9a8ddf3737c4",
        "bug_id": "mina-ftpserver_13",
        "file": [
            {
                "sha": "979083c0aea98f887b21e5b98c1376121974d789",
                "filename": "src/java/org/apache/ftpserver/gui/RootPanel.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/3074d6e4ff50c504bf002ff7537acdeb427926f9/src/java/org/apache/ftpserver/gui/RootPanel.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/3074d6e4ff50c504bf002ff7537acdeb427926f9/src/java/org/apache/ftpserver/gui/RootPanel.java",
                "status": "modified",
                "changes": 7,
                "additions": 7,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/src/java/org/apache/ftpserver/gui/RootPanel.java?ref=3074d6e4ff50c504bf002ff7537acdeb427926f9",
                "patch": "@@ -325,6 +325,13 @@ public void startServer() {\n                     path = path.substring(1);\n                 }\n                 in = getClass().getClassLoader().getResourceAsStream(path);\n+                if (in == null) {\n+                    GuiUtils.showErrorMessage(RootPanel.this,\n+                                    \"Configuration file \" + path\n+                                  + \" not found in classpath\"\n+                                  + \" nor inside any of classpath JARs.\");\n+                    return;\n+                }\n             }\n             \n             // create configuration object",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "mina-ftpserver",
        "message": "Fix for SITE DESCUSER printing WriteRequest FQCN instead of true (FTPSERVER-257)\nFix for SITE WHO throwing NPE (FTPSERVER-256)\nAdded test for the above commands\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/ftpserver/trunk@732069 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-ftpserver/commit/0fe58af78fc805b025f78b32eeeeba38b64a0d77",
        "parent": "https://github.com/apache/mina-ftpserver/commit/29b02ca75c5c35a2cb511d5e1128019ca21455c0",
        "bug_id": "mina-ftpserver_14",
        "file": [
            {
                "sha": "7bef7151a5ba48dc1ffc06f3b52ae75f501d7801",
                "filename": "core/src/main/java/org/apache/ftpserver/command/impl/SITE_DESCUSER.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/0fe58af78fc805b025f78b32eeeeba38b64a0d77/core/src/main/java/org/apache/ftpserver/command/impl/SITE_DESCUSER.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/0fe58af78fc805b025f78b32eeeeba38b64a0d77/core/src/main/java/org/apache/ftpserver/command/impl/SITE_DESCUSER.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/core/src/main/java/org/apache/ftpserver/command/impl/SITE_DESCUSER.java?ref=0fe58af78fc805b025f78b32eeeeba38b64a0d77",
                "patch": "@@ -104,7 +104,7 @@ public void execute(final FtpIoSession session,\n         sb.append(\"homedirectory   : \").append(user.getHomeDirectory()).append(\n                 \"\\n\");\n         sb.append(\"writepermission : \").append(\n-                user.authorize(new WriteRequest())).append(\"\\n\");\n+                user.authorize(new WriteRequest()) != null).append(\"\\n\");\n         sb.append(\"enableflag      : \").append(user.getEnabled()).append(\"\\n\");\n         sb.append(\"idletime        : \").append(user.getMaxIdleTime()).append(\n                 \"\\n\");",
                "deletions": 1
            },
            {
                "sha": "44dabc3a00ab1d3f9bcd167da53058ae79df8c3f",
                "filename": "core/src/main/java/org/apache/ftpserver/impl/DefaultFtpHandler.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/0fe58af78fc805b025f78b32eeeeba38b64a0d77/core/src/main/java/org/apache/ftpserver/impl/DefaultFtpHandler.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/0fe58af78fc805b025f78b32eeeeba38b64a0d77/core/src/main/java/org/apache/ftpserver/impl/DefaultFtpHandler.java",
                "status": "modified",
                "changes": 4,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/core/src/main/java/org/apache/ftpserver/impl/DefaultFtpHandler.java?ref=0fe58af78fc805b025f78b32eeeeba38b64a0d77",
                "patch": "@@ -63,6 +63,8 @@ public void sessionCreated(final FtpIoSession session) throws Exception {\n     public void sessionOpened(final FtpIoSession session) throws Exception {\n         context.getFtpletContainer().onConnect(session.getFtpletSession());\n \n+        session.updateLastAccessTime();\n+        \n         session.write(LocalizedFtpReply.translate(session, null, context,\n                 FtpReply.REPLY_220_SERVICE_READY, null, null));\n     }\n@@ -114,6 +116,8 @@ private boolean isCommandOkWithoutAuthentication(String command) {\n     public void messageReceived(final FtpIoSession session,\n             final FtpRequest request) throws Exception {\n         try {\n+            session.updateLastAccessTime();\n+            \n             String commandName = request.getCommand();\n             CommandFactory commandFactory = context.getCommandFactory();\n             Command command = commandFactory.getCommand(commandName);",
                "deletions": 0
            },
            {
                "sha": "0a1a5afb68a7fcebc6fc5c5f2e1034bd1a45f256",
                "filename": "core/src/test/java/org/apache/ftpserver/clienttests/SiteTest.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/0fe58af78fc805b025f78b32eeeeba38b64a0d77/core/src/test/java/org/apache/ftpserver/clienttests/SiteTest.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/0fe58af78fc805b025f78b32eeeeba38b64a0d77/core/src/test/java/org/apache/ftpserver/clienttests/SiteTest.java",
                "status": "added",
                "changes": 76,
                "additions": 76,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/core/src/test/java/org/apache/ftpserver/clienttests/SiteTest.java?ref=0fe58af78fc805b025f78b32eeeeba38b64a0d77",
                "patch": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.ftpserver.clienttests;\n+\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import org.apache.commons.net.ftp.FTPReply;\n+\n+/**\n+*\n+* @author The Apache MINA Project (dev@mina.apache.org)\n+* @version $Rev$, $Date$\n+*\n+*/\n+public class SiteTest extends ClientTestTemplate {\n+\n+    public void testSiteDescUser() throws Exception {\n+        client.login(ADMIN_USERNAME, ADMIN_PASSWORD);\n+\n+        client.sendCommand(\"SITE DESCUSER admin\");\n+        String[] siteReplies = client.getReplyString().split(\"\\r\\n\");\n+\n+        assertEquals(\"200-\", siteReplies[0]);\n+        assertEquals(\"userid          : admin\", siteReplies[1]);\n+        assertEquals(\"userpassword    : ********\", siteReplies[2]);\n+        assertEquals(\"homedirectory   : ./test-tmp/ftproot\", siteReplies[3]);\n+        assertEquals(\"writepermission : true\", siteReplies[4]);\n+        assertEquals(\"enableflag      : true\", siteReplies[5]);\n+        assertEquals(\"idletime        : 0\", siteReplies[6]);\n+        assertEquals(\"uploadrate      : 0\", siteReplies[7]);\n+        assertEquals(\"200 downloadrate    : 0\", siteReplies[8]);\n+    }\n+\n+    public void testAnonNotAllowed() throws Exception {\n+        client.login(ANONYMOUS_USERNAME, ANONYMOUS_PASSWORD);\n+\n+        assertTrue(FTPReply.isNegativePermanent(client.sendCommand(\"SITE DESCUSER admin\")));\n+    }\n+\n+    public void testSiteWho() throws Exception {\n+        client.login(ADMIN_USERNAME, ADMIN_PASSWORD);\n+\n+        client.sendCommand(\"SITE WHO\");\n+        String[] siteReplies = client.getReplyString().split(\"\\r\\n\");\n+\n+        assertEquals(\"200-\", siteReplies[0]);\n+        \n+        String timestampPattern = \"\\\\d{4}-\\\\d{2}-\\\\d{2}T\\\\d{2}:\\\\d{2}:\\\\d{2}\";\n+        System.out.println(\">>\" + siteReplies[1] + \"<<\");\n+        \n+        String pattern = \"200 admin           127.0.0.1       \" + timestampPattern + \" \" + timestampPattern + \" \"; \n+        \n+        assertTrue(Pattern.matches(pattern, siteReplies[1]));\n+    }\n+\n+\n+    \n+}",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "mina-ftpserver",
        "message": "fix NPE due to prev. patch (User is null in Request until login)\nintroduce maxIdleTime variable in request (set in ConnectionManager, chainge in PASS command)\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/ftpserver/trunk@405674 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-ftpserver/commit/81f3e4787910b3bd4a930e9a375c91d3d64d45af",
        "parent": "https://github.com/apache/mina-ftpserver/commit/04e9ec0e2fcb9322de18de50a7cdf078aac3111d",
        "bug_id": "mina-ftpserver_15",
        "file": [
            {
                "sha": "bf8b46558a7385084febc8df379eafdbc221630e",
                "filename": "src/java/org/apache/ftpserver/ConnectionManagerImpl.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/81f3e4787910b3bd4a930e9a375c91d3d64d45af/src/java/org/apache/ftpserver/ConnectionManagerImpl.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/81f3e4787910b3bd4a930e9a375c91d3d64d45af/src/java/org/apache/ftpserver/ConnectionManagerImpl.java",
                "status": "modified",
                "changes": 20,
                "additions": 10,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/src/java/org/apache/ftpserver/ConnectionManagerImpl.java?ref=81f3e4787910b3bd4a930e9a375c91d3d64d45af",
                "patch": "@@ -16,12 +16,7 @@\n  */\n package org.apache.ftpserver;\n \n-import java.util.ArrayList;\n-import java.util.Iterator;\n-import java.util.List;\n-import java.util.Timer;\n-import java.util.TimerTask;\n-import java.util.Vector;\n+import java.util.*;\n \n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n@@ -31,7 +26,6 @@\n import org.apache.ftpserver.interfaces.ConnectionManagerObserver;\n import org.apache.ftpserver.interfaces.IConnection;\n import org.apache.ftpserver.interfaces.IConnectionManager;\n-import org.apache.ftpserver.usermanager.BaseUser;\n \n /**\n  * Connection service to manage all the connections (request handlers).\n@@ -114,6 +108,10 @@ public boolean isAnonymousLoginEnabled() {\n         return anonEnabled;\n     }\n     \n+    public int getDefaultIdleSec() {\n+        return defaultIdleSec;\n+    }\n+    \n     /**\n      * Get maximum anonymous logins\n      */\n@@ -156,9 +154,11 @@ public void newConnection(IConnection connection) {\n             observer.updatedConnection(connection);\n         }\n         \n-        // set default idle time\n-        BaseUser user = (BaseUser)connection.getRequest().getUser();\n-        user.setMaxIdleTime(defaultIdleSec);\n+        /*\n+         * set default idle time for request. This value should be overrided\n+         * after user login\n+         */\n+        connection.getRequest().setMaxIdleTime(defaultIdleSec);\n         \n         // now start a new thread to serve this connection\n         new Thread(connection).start();",
                "deletions": 10
            },
            {
                "sha": "897e367bdecd617bcff083213c0ee7993ceafa27",
                "filename": "src/java/org/apache/ftpserver/FtpRequestImpl.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/81f3e4787910b3bd4a930e9a375c91d3d64d45af/src/java/org/apache/ftpserver/FtpRequestImpl.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/81f3e4787910b3bd4a930e9a375c91d3d64d45af/src/java/org/apache/ftpserver/FtpRequestImpl.java",
                "status": "modified",
                "changes": 11,
                "additions": 10,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/src/java/org/apache/ftpserver/FtpRequestImpl.java?ref=81f3e4787910b3bd4a930e9a375c91d3d64d45af",
                "patch": "@@ -51,6 +51,7 @@\n     private ConnectionObserver observer;\n     private String language;\n     \n+    private int maxIdleTime = 0;\n     private long connectionTime = 0L;\n     private long loginTime = 0L;\n     private long lastAccessTime = 0L;\n@@ -403,7 +404,7 @@ public void clear() {\n      */\n     public boolean isTimeout(long currTime) {\n          boolean bActive = true;\n-         int maxIdleTime = user.getMaxIdleTime();\n+         int maxIdleTime = getMaxIdleTime();\n          if(maxIdleTime > 0) {\n              long currIdleTimeMillis = currTime - lastAccessTime;\n              long maxIdleTimeMillis = maxIdleTime * 1000L;\n@@ -418,4 +419,12 @@ public boolean isTimeout(long currTime) {\n     public boolean isTimeout() {\n         return isTimeout(System.currentTimeMillis());\n     }\n+\n+    public int getMaxIdleTime() {\n+        return this.maxIdleTime;\n+    }\n+\n+    public void setMaxIdleTime(int maxIdleTimeSec) {\n+        this.maxIdleTime = maxIdleTimeSec;\n+    }\n }",
                "deletions": 1
            },
            {
                "sha": "65a388be5c4f77cbcbbb4c78b5f3f133f88f7cb6",
                "filename": "src/java/org/apache/ftpserver/command/PASS.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/81f3e4787910b3bd4a930e9a375c91d3d64d45af/src/java/org/apache/ftpserver/command/PASS.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/81f3e4787910b3bd4a930e9a375c91d3d64d45af/src/java/org/apache/ftpserver/command/PASS.java",
                "status": "modified",
                "changes": 1,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/src/java/org/apache/ftpserver/command/PASS.java?ref=81f3e4787910b3bd4a930e9a375c91d3d64d45af",
                "patch": "@@ -118,6 +118,7 @@ public void execute(RequestHandler handler,\n             if(bSuccess) {\n                 request.setUser(user);\n                 request.setUserArgument(null);\n+                request.setMaxIdleTime(user.getMaxIdleTime());\n             } else {\n                 log.warn(\"Login failure - \" + userName);\n                 out.send(530, \"PASS\", userName);",
                "deletions": 0
            },
            {
                "sha": "08d62a0478ede34b2e79daf881ae905979248506",
                "filename": "src/java/org/apache/ftpserver/ftplet/FtpRequest.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/81f3e4787910b3bd4a930e9a375c91d3d64d45af/src/java/org/apache/ftpserver/ftplet/FtpRequest.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/81f3e4787910b3bd4a930e9a375c91d3d64d45af/src/java/org/apache/ftpserver/ftplet/FtpRequest.java",
                "status": "modified",
                "changes": 16,
                "additions": 16,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/src/java/org/apache/ftpserver/ftplet/FtpRequest.java?ref=81f3e4787910b3bd4a930e9a375c91d3d64d45af",
                "patch": "@@ -22,6 +22,8 @@\n import java.net.InetAddress;\n import java.util.Date;\n \n+import org.apache.ftpserver.ConnectionManagerImpl;\n+\n /**\n  * Defines an object to provide client request information to a ftplet.\n  * Ftplet methods will always get the same instance of Ftplet request.\n@@ -67,6 +69,20 @@\n      * Get last access time.\n      */\n     Date getLastAccessTime();\n+\n+    /**\n+     * Returns maximum idle time. This time equals to\n+     * {@link ConnectionManagerImpl#getDefaultIdleSec()} until user login, and\n+     * {@link User#getMaxIdleTime()} after user login.\n+     */\n+    int getMaxIdleTime();\n+    \n+    /**\n+     * Set maximum idle time in seconds. This time equals to\n+     * {@link ConnectionManagerImpl#getDefaultIdleSec()} until user login, and\n+     * {@link User#getMaxIdleTime()} after user login.\n+     */\n+    void setMaxIdleTime(int maxIdleTimeSec);\n     \n     /**\n      * Get user object.",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "mina-ftpserver",
        "message": "Fix for FTPSERVER-241 where the JVM leaks file handles when using the SSLServerSocket (http://bugs.sun.com/view_bug.do?bug_id=6764972). While this bugs seems to be fixed in 1.6u12, we should fix it for users of other JVMs. Using the workaround described here http://www.nabble.com/-security-dev-00402-:-Re:-NullPointerException-at%09sun.security.ssl.OutputRecord.writeBuffer-td20492154.html. It's based on using a wrapper SSLSocket rather than creating an SSLServerSocket. Using this, the number of used file handles seems to be consistent and low when debugged using lsof -p <the PID> | grep sock | wc -l\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/ftpserver/trunk@726546 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-ftpserver/commit/bf0377a1bf61118246681633e7bb3a8fa42fd844",
        "parent": "https://github.com/apache/mina-ftpserver/commit/77907b39df636f8b5348f2fd7354c22f73767673",
        "bug_id": "mina-ftpserver_16",
        "file": [
            {
                "sha": "5cbbed8694df7d95085d6b0dd02ca0b086560a30",
                "filename": "core/src/main/java/org/apache/ftpserver/impl/IODataConnectionFactory.java",
                "blob_url": "https://github.com/apache/mina-ftpserver/blob/bf0377a1bf61118246681633e7bb3a8fa42fd844/core/src/main/java/org/apache/ftpserver/impl/IODataConnectionFactory.java",
                "raw_url": "https://github.com/apache/mina-ftpserver/raw/bf0377a1bf61118246681633e7bb3a8fa42fd844/core/src/main/java/org/apache/ftpserver/impl/IODataConnectionFactory.java",
                "status": "modified",
                "changes": 68,
                "additions": 42,
                "contents_url": "https://api.github.com/repos/apache/mina-ftpserver/contents/core/src/main/java/org/apache/ftpserver/impl/IODataConnectionFactory.java?ref=bf0377a1bf61118246681633e7bb3a8fa42fd844",
                "patch": "@@ -198,7 +198,7 @@ public synchronized InetSocketAddress initPassiveDataConnection()\n                     throw new DataConnectionException(\n                             \"Data connection SSL required but not configured.\");\n                 }\n-                servSoc = createServerSocket(ssl, address, passivePort);\n+                servSoc = createSecureServerSocket(address, passivePort);\n                 port = servSoc.getLocalPort();\n                 LOG\n                         .debug(\n@@ -232,35 +232,22 @@ public synchronized InetSocketAddress initPassiveDataConnection()\n         }\n     }\n \n-    private ServerSocket createServerSocket(final SslConfiguration ssl,\n+    private ServerSocket createSecureServerSocket(\n             final InetAddress address2, final int passivePort)\n             throws IOException, GeneralSecurityException {\n-        // get server socket factory\n-        SSLContext ctx = ssl.getSSLContext();\n-        SSLServerSocketFactory ssocketFactory = ctx.getServerSocketFactory();\n-\n-        // create server socket\n-        SSLServerSocket sslServerSocket = null;\n+        // this method does not actually create the SSL socket, due to a JVM bug \n+        // (https://issues.apache.org/jira/browse/FTPSERVER-241).\n+        // Instead, it creates a regular\n+        // ServerSocket that will be wrapped as a SSL socket in createDataSocket()\n+        \n+        ServerSocket internalServerSocket ;\n         if (address2 == null) {\n-            sslServerSocket = (SSLServerSocket) ssocketFactory\n-                    .createServerSocket(passivePort, 100);\n+            internalServerSocket = new ServerSocket(passivePort);\n         } else {\n-            sslServerSocket = (SSLServerSocket) ssocketFactory\n-                    .createServerSocket(passivePort, 100, address2);\n-        }\n-\n-        // initialize server socket\n-        if (ssl.getClientAuth() == ClientAuth.NEED) {\n-            sslServerSocket.setNeedClientAuth(true);\n-        } else if (ssl.getClientAuth() == ClientAuth.WANT) {\n-            sslServerSocket.setWantClientAuth(true);\n-        }\n-\n-        if (ssl.getEnabledCipherSuites() != null) {\n-            sslServerSocket\n-                    .setEnabledCipherSuites(ssl.getEnabledCipherSuites());\n+            internalServerSocket = new ServerSocket(passivePort, 100, address2);\n         }\n-        return sslServerSocket;\n+        \n+        return internalServerSocket;\n     }\n \n     /*\n@@ -329,7 +316,36 @@ private synchronized Socket createDataSocket() throws Exception {\n                 }\n             } else {\n                 LOG.debug(\"Opening passive data connection\");\n-                dataSoc = servSoc.accept();\n+\n+                if(secure) {\n+                    // get server socket factory\n+                    SslConfiguration ssl = getSslConfiguration();\n+\n+                    SSLContext ctx = ssl.getSSLContext();\n+                    SSLSocketFactory ssocketFactory = ctx.getSocketFactory();\n+                    \n+                    Socket serverSocket = servSoc.accept();\n+                    \n+                    SSLSocket sslSocket = (SSLSocket) ssocketFactory.createSocket(serverSocket,\n+                            serverSocket.getInetAddress().getHostName(), serverSocket.getPort(), false);\n+                    sslSocket.setUseClientMode(false);\n+                    \n+                    // initialize server socket\n+                    if (ssl.getClientAuth() == ClientAuth.NEED) {\n+                        sslSocket.setNeedClientAuth(true);\n+                    } else if (ssl.getClientAuth() == ClientAuth.WANT) {\n+                        sslSocket.setWantClientAuth(true);\n+                    }\n+    \n+                    if (ssl.getEnabledCipherSuites() != null) {\n+                        sslSocket\n+                                .setEnabledCipherSuites(ssl.getEnabledCipherSuites());\n+                    }\n+                    \n+                    dataSoc = sslSocket;\n+                } else {    \n+                    dataSoc = servSoc.accept();\n+                }\n                 LOG.debug(\"Passive data connection opened\");\n             }\n         } catch (Exception ex) {",
                "deletions": 26
            }
        ]
    }
]