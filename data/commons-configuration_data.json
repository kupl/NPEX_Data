[{"commit": "https://github.com/apache/commons-configuration/commit/68e832c7c4f948436de01a3b43ca8ed213e882b5", "parent": "https://github.com/apache/commons-configuration/commit/60b38833c29205039378c043fc3f1c10ec1cce70", "message": "- Replace Cobertura 2.1.1 with JaCoCo since Cobertura blows up on Java 8\ndefault methods.\n- Remove Clirr since it gives a false positive for new Java 8 default\nmethods.\n- Fix Javadoc warning by adding a Javadoc link to Spring's Javadoc.\n- Set JApiCmp for 0.13.1 because 0.14.0 blows up with an NPE.", "bug_id": "commons-configuration_1", "file": [{"additions": 24, "raw_url": "https://github.com/apache/commons-configuration/raw/68e832c7c4f948436de01a3b43ca8ed213e882b5/pom.xml", "blob_url": "https://github.com/apache/commons-configuration/blob/68e832c7c4f948436de01a3b43ca8ed213e882b5/pom.xml", "sha": "7f63dbe9122866ee2868b8b0b13a462603ad6b18", "changes": 38, "status": "modified", "deletions": 14, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/pom.xml?ref=68e832c7c4f948436de01a3b43ca8ed213e882b5", "patch": "@@ -568,8 +568,9 @@\n \n     <!-- generate report even if there are binary incompatible changes -->\n     <commons.japicmp.breakBuildOnBinaryIncompatibleModifications>false</commons.japicmp.breakBuildOnBinaryIncompatibleModifications>\n-    <commons.japicmp.version>0.14.0</commons.japicmp.version>\n+    <commons.japicmp.version>0.13.1</commons.japicmp.version>\n     <japicmp.skip>false</japicmp.skip>\n+    <commons.jacoco.version>0.8.4</commons.jacoco.version>\n \n     <!-- Commons Release Plugin -->\n     <commons.bc.version>2.4</commons.bc.version>\n@@ -746,6 +747,7 @@\n           <failOnError>false</failOnError>\n           <links>\n             <link>https://docs.oracle.com/javase/8/docs/api/</link>\n+            <link>https://docs.spring.io/spring/docs/${spring.version}/javadoc-api/</link>\n           </links>\n         </configuration>\n       </plugin>\n@@ -855,19 +857,8 @@\n         </configuration>\n       </plugin>\n       <plugin>\n-        <groupId>org.codehaus.mojo</groupId>\n-        <artifactId>cobertura-maven-plugin</artifactId>\n-        <version>2.7</version>\n-      </plugin>\n-      <plugin>\n-        <groupId>org.codehaus.mojo</groupId>\n-        <artifactId>clirr-maven-plugin</artifactId>\n-        <version>2.8</version>\n-        <configuration>\n-          <excludes>\n-            <exclude>org/apache/commons/configuration2/plist/PropertyListParser*</exclude>\n-          </excludes>\n-        </configuration>\n+        <groupId>org.jacoco</groupId>\n+        <artifactId>jacoco-maven-plugin</artifactId>\n       </plugin>\n       <plugin>\n         <artifactId>maven-javadoc-plugin</artifactId>\n@@ -889,6 +880,7 @@\n               <failOnError>false</failOnError>\n               <links>\n                 <link>https://docs.oracle.com/javase/8/docs/api/</link>\n+                <link>https://docs.spring.io/spring/docs/${spring.version}/javadoc-api/</link>\n               </links>\n               <!-- Disable Doclint since the Javadoc in the generated code does not comply. -->\n               <doclint>none</doclint>\n@@ -899,9 +891,27 @@\n           <failOnError>false</failOnError>\n           <links>\n             <link>https://docs.oracle.com/javase/8/docs/api/</link>\n+            <link>https://docs.spring.io/spring/docs/${spring.version}/javadoc-api/</link>\n           </links>\n         </configuration>\n       </plugin>\n+      <plugin>\n+        <groupId>com.github.siom79.japicmp</groupId>\n+        <artifactId>japicmp-maven-plugin</artifactId>\n+        <version>${commons.japicmp.version}</version>\n+        <configuration>\n+          <parameter>\n+            <onlyModified>true</onlyModified>\n+            <breakBuildOnBinaryIncompatibleModifications>${commons.japicmp.breakBuildOnBinaryIncompatibleModifications}</breakBuildOnBinaryIncompatibleModifications>\n+            <breakBuildOnSourceIncompatibleModifications>${commons.japicmp.breakBuildOnSourceIncompatibleModifications}</breakBuildOnSourceIncompatibleModifications>\n+            <!-- skip japicmp on \"mvn site\" - use \"mvn package site\" to include report -->\n+            <skipPomModules>true</skipPomModules>\n+            <ignoreMissingNewVersion>true</ignoreMissingNewVersion>\n+            <reportOnlyFilename>true</reportOnlyFilename>\n+            <ignoreMissingClasses>true</ignoreMissingClasses>\n+          </parameter>\n+        </configuration>\n+      </plugin>      \n     </plugins>\n   </reporting>\n ", "filename": "pom.xml"}], "repo": "commons-configuration"}, {"commit": "https://github.com/apache/commons-configuration/commit/4930140ec6fdceb7e15d31afa45243dee7d1e217", "parent": "https://github.com/apache/commons-configuration/commit/e9dcc716af5014485846d28e174164c2a3720c15", "message": "[CONFIGURATION-671] Fixed handling of empty sections in INIConfiguration.\n\nSaving of an INIConfiguration with an empty section caused a NPE. The\ncause was that nodes without children were not detected as section\nnodes. Now a different criterion is used.\n\ngit-svn-id: https://svn.apache.org/repos/asf/commons/proper/configuration/trunk@1806819 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "commons-configuration_2", "file": [{"additions": 5, "raw_url": "https://github.com/apache/commons-configuration/raw/4930140ec6fdceb7e15d31afa45243dee7d1e217/src/main/java/org/apache/commons/configuration2/INIConfiguration.java", "blob_url": "https://github.com/apache/commons-configuration/blob/4930140ec6fdceb7e15d31afa45243dee7d1e217/src/main/java/org/apache/commons/configuration2/INIConfiguration.java", "sha": "c9f516ab96610c24cf9ea3e15590c98880472cb1", "changes": 6, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/main/java/org/apache/commons/configuration2/INIConfiguration.java?ref=4930140ec6fdceb7e15d31afa45243dee7d1e217", "patch": "@@ -212,6 +212,10 @@\n  * <a href=\"http://commons.apache.org/proper/commons-configuration/userguide/howto_basicfeatures.html\">\n  * Basic features and AbstractConfiguration</a> of the user's guide.\n  * </p>\n+ * <p>\n+ * Note that this configuration does not support properties with null values.\n+ * Such properties are considered to be section nodes.\n+ * </p>\n  *\n  * @author <a\n  *         href=\"http://commons.apache.org/configuration/team-list.html\">Commons\n@@ -942,7 +946,7 @@ private SubnodeConfiguration getGlobalSection()\n      */\n     private static boolean isSectionNode(ImmutableNode node)\n     {\n-        return !node.getChildren().isEmpty();\n+        return node.getValue() == null;\n     }\n \n     /**", "filename": "src/main/java/org/apache/commons/configuration2/INIConfiguration.java"}, {"additions": 21, "raw_url": "https://github.com/apache/commons-configuration/raw/4930140ec6fdceb7e15d31afa45243dee7d1e217/src/test/java/org/apache/commons/configuration2/TestINIConfiguration.java", "blob_url": "https://github.com/apache/commons-configuration/blob/4930140ec6fdceb7e15d31afa45243dee7d1e217/src/test/java/org/apache/commons/configuration2/TestINIConfiguration.java", "sha": "30b8722610f11fd041252ceeadf01259a7ca0fcb", "changes": 21, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/test/java/org/apache/commons/configuration2/TestINIConfiguration.java?ref=4930140ec6fdceb7e15d31afa45243dee7d1e217", "patch": "@@ -1223,6 +1223,27 @@ public void testExpressionEngineIgnoringCase()\n                 config.getString(\"SECTION1.VAR1\"));\n     }\n \n+    /**\n+     * Tests whether an empty section can be saved. This is related to\n+     * CONFIGURATION-671.\n+     */\n+    @Test\n+    public void testWriteEmptySection()\n+            throws ConfigurationException, IOException\n+    {\n+        final String section = \"[EmptySection]\";\n+        INIConfiguration config = setUpConfig(section);\n+        assertEquals(\"Wrong number of sections\", 1,\n+                config.getSections().size());\n+        assertTrue(\"Section not found\",\n+                config.getSections().contains(\"EmptySection\"));\n+\n+        StringWriter writer = new StringWriter();\n+        config.write(writer);\n+        assertEquals(\"Wrong saved configuration\",\n+                section + LINE_SEPARATOR + LINE_SEPARATOR, writer.toString());\n+    }\n+\n     /**\n      * A thread class for testing concurrent access to the global section.\n      */", "filename": "src/test/java/org/apache/commons/configuration2/TestINIConfiguration.java"}], "repo": "commons-configuration"}, {"commit": "https://github.com/apache/commons-configuration/commit/4975496a3ec2c152fb48a7b681000447c784d336", "parent": "https://github.com/apache/commons-configuration/commit/55f62e3f0a761ba60300f70285d10b038092c36f", "message": "Fixed another IntelliJ warning related to a potential NPE.\n\ngit-svn-id: https://svn.apache.org/repos/asf/commons/proper/configuration/trunk@1674558 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "commons-configuration_3", "file": [{"additions": 1, "raw_url": "https://github.com/apache/commons-configuration/raw/4975496a3ec2c152fb48a7b681000447c784d336/src/main/java/org/apache/commons/configuration2/plist/XMLPropertyListConfiguration.java", "blob_url": "https://github.com/apache/commons-configuration/blob/4975496a3ec2c152fb48a7b681000447c784d336/src/main/java/org/apache/commons/configuration2/plist/XMLPropertyListConfiguration.java", "sha": "0a3a3dd8d6343ef98885953f8486631a1c3e9bc8", "changes": 1, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/main/java/org/apache/commons/configuration2/plist/XMLPropertyListConfiguration.java?ref=4975496a3ec2c152fb48a7b681000447c784d336", "patch": "@@ -574,6 +574,7 @@ else if (\"dict\".equals(qName))\n             {\n                 // remove the root of the XMLPropertyListConfiguration previously pushed on the stack\n                 PListNodeBuilder builder = pop();\n+                assert builder != null : \"Stack was empty!\";\n                 if (peek() instanceof ArrayNodeBuilder)\n                 {\n                     // create the configuration", "filename": "src/main/java/org/apache/commons/configuration2/plist/XMLPropertyListConfiguration.java"}], "repo": "commons-configuration"}, {"commit": "https://github.com/apache/commons-configuration/commit/3af8e6e23b211cd7d564b4d32cd214987131183d", "parent": "https://github.com/apache/commons-configuration/commit/997f50595fd7b2df1730c7d4f9a0332ae9aad9f6", "message": "Fixed IntelliJ warnings related to potential NPEs.\n\ngit-svn-id: https://svn.apache.org/repos/asf/commons/proper/configuration/trunk@1674555 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "commons-configuration_4", "file": [{"additions": 29, "raw_url": "https://github.com/apache/commons-configuration/raw/3af8e6e23b211cd7d564b4d32cd214987131183d/src/main/java/org/apache/commons/configuration2/plist/XMLPropertyListConfiguration.java", "blob_url": "https://github.com/apache/commons-configuration/blob/3af8e6e23b211cd7d564b4d32cd214987131183d/src/main/java/org/apache/commons/configuration2/plist/XMLPropertyListConfiguration.java", "sha": "4951804b8c0ca9343af354db9b2c9534d300cc6e", "changes": 40, "status": "modified", "deletions": 11, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/main/java/org/apache/commons/configuration2/plist/XMLPropertyListConfiguration.java?ref=3af8e6e23b211cd7d564b4d32cd214987131183d", "patch": "@@ -47,6 +47,7 @@\n import org.apache.commons.configuration2.HierarchicalConfiguration;\n import org.apache.commons.configuration2.MapConfiguration;\n import org.apache.commons.configuration2.ex.ConfigurationException;\n+import org.apache.commons.configuration2.ex.ConfigurationRuntimeException;\n import org.apache.commons.configuration2.io.FileLocator;\n import org.apache.commons.configuration2.io.FileLocatorAware;\n import org.apache.commons.configuration2.tree.ImmutableNode;\n@@ -413,7 +414,7 @@ else if (value instanceof Map)\n         }\n         else if (value instanceof byte[])\n         {\n-            String base64 = null;\n+            String base64;\n             try\n             {\n                 base64 = new String(Base64.encodeBase64((byte[]) value), DATA_ENCODING);\n@@ -501,6 +502,23 @@ private PListNodeBuilder peek()\n             }\n         }\n \n+        /**\n+         * Returns the node on top of the non-empty stack. Throws an exception if the\n+         * stack is empty.\n+         *\n+         * @return the top node of the stack\n+         * @throws ConfigurationRuntimeException if the stack is empty\n+         */\n+        private PListNodeBuilder peekNE()\n+        {\n+            PListNodeBuilder result = peek();\n+            if (result == null)\n+            {\n+                throw new ConfigurationRuntimeException(\"Access to empty stack!\");\n+            }\n+            return result;\n+        }\n+\n         /**\n          * Remove and return the node on the top of the stack.\n          */\n@@ -549,7 +567,7 @@ public void endElement(String uri, String localName, String qName) throws SAXExc\n                 // create a new node, link it to its parent and push it on the stack\n                 PListNodeBuilder node = new PListNodeBuilder();\n                 node.setName(buffer.toString());\n-                peek().addChild(node);\n+                peekNE().addChild(node);\n                 push(node);\n             }\n             else if (\"dict\".equals(qName))\n@@ -562,41 +580,41 @@ else if (\"dict\".equals(qName))\n                     XMLPropertyListConfiguration config = new XMLPropertyListConfiguration(builder.createNode());\n \n                     // add it to the ArrayNodeBuilder\n-                    ArrayNodeBuilder node = (ArrayNodeBuilder) peek();\n+                    ArrayNodeBuilder node = (ArrayNodeBuilder) peekNE();\n                     node.addValue(config);\n                 }\n             }\n             else\n             {\n                 if (\"string\".equals(qName))\n                 {\n-                    peek().addValue(buffer.toString());\n+                    peekNE().addValue(buffer.toString());\n                 }\n                 else if (\"integer\".equals(qName))\n                 {\n-                    peek().addIntegerValue(buffer.toString());\n+                    peekNE().addIntegerValue(buffer.toString());\n                 }\n                 else if (\"real\".equals(qName))\n                 {\n-                    peek().addRealValue(buffer.toString());\n+                    peekNE().addRealValue(buffer.toString());\n                 }\n                 else if (\"true\".equals(qName))\n                 {\n-                    peek().addTrueValue();\n+                    peekNE().addTrueValue();\n                 }\n                 else if (\"false\".equals(qName))\n                 {\n-                    peek().addFalseValue();\n+                    peekNE().addFalseValue();\n                 }\n                 else if (\"data\".equals(qName))\n                 {\n-                    peek().addDataValue(buffer.toString());\n+                    peekNE().addDataValue(buffer.toString());\n                 }\n                 else if (\"date\".equals(qName))\n                 {\n                     try\n                     {\n-                        peek().addDateValue(buffer.toString());\n+                        peekNE().addDateValue(buffer.toString());\n                     }\n                     catch (IllegalArgumentException iex)\n                     {\n@@ -607,7 +625,7 @@ else if (\"date\".equals(qName))\n                 else if (\"array\".equals(qName))\n                 {\n                     ArrayNodeBuilder array = (ArrayNodeBuilder) pop();\n-                    peek().addList(array);\n+                    peekNE().addList(array);\n                 }\n \n                 // remove the plist node on the stack once the value has been parsed,", "filename": "src/main/java/org/apache/commons/configuration2/plist/XMLPropertyListConfiguration.java"}], "repo": "commons-configuration"}, {"commit": "https://github.com/apache/commons-configuration/commit/97e542e3afed5e1045b64c983ebb428448e78d44", "parent": "https://github.com/apache/commons-configuration/commit/36bc1584500da7fb876211d26cfb4f2c0420f88c", "message": "Fixed a NPE in locate()\n\ngit-svn-id: https://svn.apache.org/repos/asf/jakarta/commons/proper/configuration/trunk@234094 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "commons-configuration_5", "file": [{"additions": 6, "raw_url": "https://github.com/apache/commons-configuration/raw/97e542e3afed5e1045b64c983ebb428448e78d44/src/java/org/apache/commons/configuration/ConfigurationUtils.java", "blob_url": "https://github.com/apache/commons-configuration/blob/97e542e3afed5e1045b64c983ebb428448e78d44/src/java/org/apache/commons/configuration/ConfigurationUtils.java", "sha": "9e45fdd3295813ab6da07c2cc185027bb0f65ae7", "changes": 6, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/java/org/apache/commons/configuration/ConfigurationUtils.java?ref=97e542e3afed5e1045b64c983ebb428448e78d44", "patch": "@@ -258,6 +258,12 @@ public static URL locate(String name)\n      */\n     public static URL locate(String base, String name)\n     {\n+        if (name == null)\n+        {\n+            // undefined, always return null\n+            return null;\n+        }\n+        \n         URL url = null;\n \n         // attempt to create an URL directly", "filename": "src/java/org/apache/commons/configuration/ConfigurationUtils.java"}], "repo": "commons-configuration"}, {"commit": "https://github.com/apache/commons-configuration/commit/66e3d461bdf5d35b9e6c49bf206f0c765c79e9e2", "parent": "https://github.com/apache/commons-configuration/commit/500c72a7474b58187b7ca476deee8769124a3d3c", "message": "Fixed NPE in AbstractFileConfiguration.getFile()\n\ngit-svn-id: https://svn.apache.org/repos/asf/jakarta/commons/proper/configuration/trunk@220277 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "commons-configuration_6", "file": [{"additions": 16, "raw_url": "https://github.com/apache/commons-configuration/raw/66e3d461bdf5d35b9e6c49bf206f0c765c79e9e2/src/java/org/apache/commons/configuration/AbstractFileConfiguration.java", "blob_url": "https://github.com/apache/commons-configuration/blob/66e3d461bdf5d35b9e6c49bf206f0c765c79e9e2/src/java/org/apache/commons/configuration/AbstractFileConfiguration.java", "sha": "cf5d7d65ab2e6c6147f0a23c54a6b117c788c8f1", "changes": 18, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/java/org/apache/commons/configuration/AbstractFileConfiguration.java?ref=66e3d461bdf5d35b9e6c49bf206f0c765c79e9e2", "patch": "@@ -530,11 +530,25 @@ public void setBasePath(String basePath)\n      * URL with a protocol different than &quot;file&quot;, the return value\n      * will not point to a valid file object.\n      * \n-     * @return the file where the configuration is stored\n+     * @return the file where the configuration is stored; this can be <b>null</b>\n      */\n     public File getFile()\n     {\n-        return ConfigurationUtils.getFile(getBasePath(), getFileName());\n+        if (getFileName() == null)\n+        {\n+            return null;\n+        }\n+        else\n+        {\n+            if (sourceURL != null)\n+            {\n+                return ConfigurationUtils.fileFromURL(sourceURL);\n+            }\n+            else\n+            {\n+                return ConfigurationUtils.getFile(getBasePath(), getFileName());\n+            }\n+        }\n     }\n \n     /**", "filename": "src/java/org/apache/commons/configuration/AbstractFileConfiguration.java"}, {"additions": 14, "raw_url": "https://github.com/apache/commons-configuration/raw/66e3d461bdf5d35b9e6c49bf206f0c765c79e9e2/src/test/org/apache/commons/configuration/TestFileConfiguration.java", "blob_url": "https://github.com/apache/commons-configuration/blob/66e3d461bdf5d35b9e6c49bf206f0c765c79e9e2/src/test/org/apache/commons/configuration/TestFileConfiguration.java", "sha": "eedef10f3385093ccd0609d130dd4794cacd4504", "changes": 14, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/test/org/apache/commons/configuration/TestFileConfiguration.java?ref=66e3d461bdf5d35b9e6c49bf206f0c765c79e9e2", "patch": "@@ -355,4 +355,18 @@ public void testPathWithSpaces() throws Exception\n             }\n         }\n     }\n+    \n+    /**\n+     * Tests the getFile() method.\n+     */\n+    public void testGetFile() throws ConfigurationException\n+    {\n+        FileConfiguration config = new PropertiesConfiguration();\n+        assertNull(config.getFile());\n+        File file = new File(\"conf/test.properties\").getAbsoluteFile();\n+        config.setFile(file);\n+        assertEquals(file, config.getFile());\n+        config.load();\n+        assertEquals(file, config.getFile());\n+    }\n }\n\\ No newline at end of file", "filename": "src/test/org/apache/commons/configuration/TestFileConfiguration.java"}], "repo": "commons-configuration"}, {"commit": "https://github.com/apache/commons-configuration/commit/514cdf8f1ae0ebff29e600e4888928bb28b18345", "parent": "https://github.com/apache/commons-configuration/commit/369a9ebc8de0d3324485c95576d8c984078109e0", "message": "Fixed a potential NPE in DefaultReloadingDetectorFactory.\n\nThe refreshDelay property of the parameters object can now be null.\n\ngit-svn-id: https://svn.apache.org/repos/asf/commons/proper/configuration/trunk@1463687 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "commons-configuration_7", "file": [{"additions": 4, "raw_url": "https://github.com/apache/commons-configuration/raw/514cdf8f1ae0ebff29e600e4888928bb28b18345/src/main/java/org/apache/commons/configuration/builder/DefaultReloadingDetectorFactory.java", "blob_url": "https://github.com/apache/commons-configuration/blob/514cdf8f1ae0ebff29e600e4888928bb28b18345/src/main/java/org/apache/commons/configuration/builder/DefaultReloadingDetectorFactory.java", "sha": "1b2a35fbcc061c031168b4c9f91ad52a0ec07622", "changes": 6, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/main/java/org/apache/commons/configuration/builder/DefaultReloadingDetectorFactory.java?ref=514cdf8f1ae0ebff29e600e4888928bb28b18345", "patch": "@@ -40,7 +40,9 @@ public ReloadingDetector createReloadingDetector(FileHandler handler,\n             FileBasedBuilderParametersImpl params)\n             throws ConfigurationException\n     {\n-        return new FileHandlerReloadingDetector(handler,\n-                params.getReloadingRefreshDelay());\n+        Long refreshDelay = params.getReloadingRefreshDelay();\n+        return (refreshDelay != null) ? new FileHandlerReloadingDetector(\n+                handler, refreshDelay) : new FileHandlerReloadingDetector(\n+                handler);\n     }\n }", "filename": "src/main/java/org/apache/commons/configuration/builder/DefaultReloadingDetectorFactory.java"}, {"additions": 19, "raw_url": "https://github.com/apache/commons-configuration/raw/514cdf8f1ae0ebff29e600e4888928bb28b18345/src/test/java/org/apache/commons/configuration/builder/TestDefaultReloadingDetectorFactory.java", "blob_url": "https://github.com/apache/commons-configuration/blob/514cdf8f1ae0ebff29e600e4888928bb28b18345/src/test/java/org/apache/commons/configuration/builder/TestDefaultReloadingDetectorFactory.java", "sha": "ec9ce39e3b16b24a8f813443c9252a170ebad96e", "changes": 21, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/test/java/org/apache/commons/configuration/builder/TestDefaultReloadingDetectorFactory.java?ref=514cdf8f1ae0ebff29e600e4888928bb28b18345", "patch": "@@ -18,6 +18,7 @@\n \n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertSame;\n+import static org.junit.Assert.assertTrue;\n \n import org.apache.commons.configuration.ConfigurationException;\n import org.apache.commons.configuration.io.FileHandler;\n@@ -50,13 +51,29 @@ public void testCreateReloadingDetector() throws ConfigurationException\n         FileHandler handler = new FileHandler();\n         FileBasedBuilderParametersImpl params =\n                 new FileBasedBuilderParametersImpl();\n-        final long refreshDelay = 10000L;\n+        final Long refreshDelay = 10000L;\n         params.setReloadingRefreshDelay(refreshDelay);\n         FileHandlerReloadingDetector detector =\n                 (FileHandlerReloadingDetector) factory.createReloadingDetector(\n                         handler, params);\n         assertSame(\"Wrong file handler\", handler, detector.getFileHandler());\n-        assertEquals(\"Wrong refresh delay\", refreshDelay,\n+        assertEquals(\"Wrong refresh delay\", refreshDelay.longValue(),\n                 detector.getRefreshDelay());\n     }\n+\n+    /**\n+     * Tests whether an undefined refresh delay is handled correctly.\n+     */\n+    @Test\n+    public void testCreateReloadingDetectorDefaultRefreshDelay()\n+            throws ConfigurationException\n+    {\n+        FileHandler handler = new FileHandler();\n+        FileBasedBuilderParametersImpl params =\n+                new FileBasedBuilderParametersImpl();\n+        FileHandlerReloadingDetector detector =\n+                (FileHandlerReloadingDetector) factory.createReloadingDetector(\n+                        handler, params);\n+        assertTrue(\"No default refresh delay\", detector.getRefreshDelay() != 0);\n+    }\n }", "filename": "src/test/java/org/apache/commons/configuration/builder/TestDefaultReloadingDetectorFactory.java"}], "repo": "commons-configuration"}, {"commit": "https://github.com/apache/commons-configuration/commit/be80820a0104abf78bf1d8dac736c638a07b6702", "parent": "https://github.com/apache/commons-configuration/commit/ef4f8d1c935572c1112330df6b760aa396bbf5a9", "message": "Fix NPE when no ReloadingStrategy and enable detection of newly created files.\n\ngit-svn-id: https://svn.apache.org/repos/asf/commons/proper/configuration/trunk@764689 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "commons-configuration_8", "file": [{"additions": 48, "raw_url": "https://github.com/apache/commons-configuration/raw/be80820a0104abf78bf1d8dac736c638a07b6702/src/java/org/apache/commons/configuration/MultiFileHierarchicalConfiguration.java", "blob_url": "https://github.com/apache/commons-configuration/blob/be80820a0104abf78bf1d8dac736c638a07b6702/src/java/org/apache/commons/configuration/MultiFileHierarchicalConfiguration.java", "sha": "f37aeb5fbe656e75543a7f15b4f7c3cce9310a28", "changes": 76, "status": "modified", "deletions": 28, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/java/org/apache/commons/configuration/MultiFileHierarchicalConfiguration.java?ref=be80820a0104abf78bf1d8dac736c638a07b6702", "patch": "@@ -92,6 +92,9 @@ protected synchronized Object initialValue()\n     /** The Logger name to use */\n     private String loggerName = \"\";\n \n+    /** The Reloading strategy to use on created configurations */\n+    private ReloadingStrategy fileStrategy;\n+\n     /**\n      * Default Constructor.\n      */\n@@ -156,6 +159,16 @@ public void setAttributeSplittingDisabled(boolean attributeSplittingDisabled)\n         this.attributeSplittingDisabled = attributeSplittingDisabled;\n     }\n \n+    public ReloadingStrategy getReloadingStrategy()\n+    {\n+        return fileStrategy;\n+    }\n+\n+    public void setReloadingStrategy(ReloadingStrategy strategy)\n+    {\n+        this.fileStrategy = strategy;\n+    }\n+\n     /**\n      * Set to true if an empty Configuration should be returned when loading fails. If\n      * false an exception will be thrown.\n@@ -669,36 +682,35 @@ public void save() throws ConfigurationException\n         }\n \n         XMLConfiguration configuration = new XMLConfiguration();\n-        try\n+\n+        if (loggerName != null)\n         {\n-            if (loggerName != null)\n+            Log log = LogFactory.getLog(loggerName);\n+            if (log != null)\n             {\n-                Log log = LogFactory.getLog(loggerName);\n-                if (log != null)\n-                {\n-                    configuration.setLogger(log);\n-                }\n+                configuration.setLogger(log);\n             }\n-            configuration.setBasePath(getBasePath());\n-            configuration.setFileName(path);\n-            configuration.setFileSystem(getFileSystem());\n-            configuration.setExpressionEngine(getExpressionEngine());\n-            configuration.setReloadingStrategy(createReloadingStrategy());\n-            configuration.setDelimiterParsingDisabled(isDelimiterParsingDisabled());\n-            configuration.setValidating(validating);\n-            configuration.setSchemaValidation(schemaValidation);\n-            configuration.setAttributeSplittingDisabled(attributeSplittingDisabled);\n-            configuration.setListDelimiter(getListDelimiter());\n-            configuration.addConfigurationListener(this);\n-            configuration.addErrorListener(this);\n+        }\n+        configuration.setBasePath(getBasePath());\n+        configuration.setFileName(path);\n+        configuration.setFileSystem(getFileSystem());\n+        configuration.setExpressionEngine(getExpressionEngine());\n+        ReloadingStrategy strategy = createReloadingStrategy();\n+        if (strategy != null)\n+        {\n+            configuration.setReloadingStrategy(strategy);\n+        }\n+        configuration.setDelimiterParsingDisabled(isDelimiterParsingDisabled());\n+        configuration.setValidating(validating);\n+        configuration.setSchemaValidation(schemaValidation);\n+        configuration.setAttributeSplittingDisabled(attributeSplittingDisabled);\n+        configuration.setListDelimiter(getListDelimiter());\n+        configuration.addConfigurationListener(this);\n+        configuration.addErrorListener(this);\n+\n+        try\n+        {\n             configuration.load();\n-            synchronized (configurationsMap)\n-            {\n-                if (!configurationsMap.containsKey(path))\n-                {\n-                    configurationsMap.put(path, configuration);\n-                }\n-            }\n         }\n         catch (ConfigurationException ce)\n         {\n@@ -707,6 +719,13 @@ public void save() throws ConfigurationException\n                 throw new ConfigurationRuntimeException(ce);\n             }\n         }\n+        synchronized (configurationsMap)\n+        {\n+            if (!configurationsMap.containsKey(path))\n+            {\n+                configurationsMap.put(path, configuration);\n+            }\n+        }\n \n         return configuration;\n     }\n@@ -717,13 +736,13 @@ public void save() throws ConfigurationException\n      */\n     private ReloadingStrategy createReloadingStrategy()\n     {\n-        if (getReloadingStrategy() == null)\n+        if (fileStrategy == null)\n         {\n             return null;\n         }\n         try\n         {\n-            ReloadingStrategy strategy = (ReloadingStrategy) BeanUtils.cloneBean(getReloadingStrategy());\n+            ReloadingStrategy strategy = (ReloadingStrategy) BeanUtils.cloneBean(fileStrategy);\n             strategy.setConfiguration(null);\n             return strategy;\n         }\n@@ -733,4 +752,5 @@ private ReloadingStrategy createReloadingStrategy()\n         }\n \n     }\n+\n }", "filename": "src/java/org/apache/commons/configuration/MultiFileHierarchicalConfiguration.java"}, {"additions": 32, "raw_url": "https://github.com/apache/commons-configuration/raw/be80820a0104abf78bf1d8dac736c638a07b6702/src/test/org/apache/commons/configuration/TestVFSConfigurationBuilder.java", "blob_url": "https://github.com/apache/commons-configuration/blob/be80820a0104abf78bf1d8dac736c638a07b6702/src/test/org/apache/commons/configuration/TestVFSConfigurationBuilder.java", "sha": "0783952b46ed8b324a3e4ff699dd6bd09909f02c", "changes": 35, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/test/org/apache/commons/configuration/TestVFSConfigurationBuilder.java?ref=be80820a0104abf78bf1d8dac736c638a07b6702", "patch": "@@ -929,7 +929,7 @@ else if (conf instanceof CombinedConfiguration)\n                     if (conf instanceof FileSystemBased)\n                     {\n                         assertTrue(\"Incorrect file system for Configuration \" + conf,\n-                            ((FileSystemBased)conf).getFileSystem() == fs); \n+                            ((FileSystemBased)conf).getFileSystem() == fs);\n                     }\n                 }\n             }\n@@ -973,12 +973,12 @@ else if (conf instanceof CombinedConfiguration)\n         }\n     }\n \n-    public void testFileMonitor() throws Exception\n+    public void testFileMonitor1() throws Exception\n     {\n-\n         // create a new configuration\n         File input = new File(\"target/test-classes/testMultiConfiguration_1001.xml\");\n         File output = new File(\"target/test-classes/testwrite/testMultiConfiguration_1001.xml\");\n+        output.delete();\n         output.getParentFile().mkdir();\n         copyFile(input, output);\n \n@@ -998,8 +998,37 @@ public void testFileMonitor() throws Exception\n         // Let FileMonitor detect the change.\n         Thread.sleep(2000);\n         verify(\"1001\", config, 50);\n+        output.delete();\n     }\n \n+    public void testFileMonitor2() throws Exception\n+    {\n+        // create a new configuration\n+        File input = new File(\"target/test-classes/testMultiConfiguration_1002.xml\");\n+        File output = new File(\"target/test-classes/testwrite/testMultiConfiguration_1002.xml\");\n+        output.delete();\n+\n+        factory.setFile(FILEMONITOR_FILE);\n+        FileSystem.resetDefaultFileSystem();\n+        System.getProperties().remove(\"Id\");\n+\n+        CombinedConfiguration config = factory.getConfiguration(true);\n+        assertNotNull(config);\n+\n+        verify(\"1002\", config, 50);\n+        Thread.sleep(1000);\n+\n+        output.getParentFile().mkdir();\n+        copyFile(input, output);\n+\n+        // Allow time for the monitor to notice the change.\n+        Thread.sleep(2000);\n+        verify(\"1002\", config, 25);\n+        output.delete();\n+    }\n+\n+\n+\n     private void copyFile(File input, File output) throws IOException\n     {\n         Reader reader = new FileReader(input);", "filename": "src/test/org/apache/commons/configuration/TestVFSConfigurationBuilder.java"}], "repo": "commons-configuration"}, {"commit": "https://github.com/apache/commons-configuration/commit/cfd2560843033325d5ed7001f363e93fd5294000", "parent": "https://github.com/apache/commons-configuration/commit/7a5182133f90f7d5d9981c5f0be59c315e0828ec", "message": "CONFIGURATION-301: Fix for NPE when saving an XMLConfiguration constructed from a HierarchicalConfiguration\n\ngit-svn-id: https://svn.apache.org/repos/asf/commons/proper/configuration/trunk@603841 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "commons-configuration_9", "file": [{"additions": 5, "raw_url": "https://github.com/apache/commons-configuration/raw/cfd2560843033325d5ed7001f363e93fd5294000/src/java/org/apache/commons/configuration/XMLConfiguration.java", "blob_url": "https://github.com/apache/commons-configuration/blob/cfd2560843033325d5ed7001f363e93fd5294000/src/java/org/apache/commons/configuration/XMLConfiguration.java", "sha": "041fb2f7e9386b2d55ba6a104c37cb2c7a69031a", "changes": 7, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/java/org/apache/commons/configuration/XMLConfiguration.java?ref=cfd2560843033325d5ed7001f363e93fd5294000", "patch": "@@ -200,6 +200,7 @@ public XMLConfiguration(HierarchicalConfiguration c)\n     {\n         super(c);\n         clearReferences(getRootNode());\n+        setRootElementName(getRootNode().getName());\n     }\n \n     /**\n@@ -1266,8 +1267,10 @@ static void updateAttribute(Node node, String name, char listDelimiter)\n          */\n         private Element getElement(Node node)\n         {\n-            // special treatement for root node of the hierarchy\n-            return (node.getName() != null) ? (Element) node.getReference() : document.getDocumentElement();\n+            // special treatment for root node of the hierarchy\n+            return (node.getName() != null && node.getReference() != null) ? (Element) node\n+                    .getReference()\n+                    : document.getDocumentElement();\n         }\n     }\n ", "filename": "src/java/org/apache/commons/configuration/XMLConfiguration.java"}, {"additions": 17, "raw_url": "https://github.com/apache/commons-configuration/raw/cfd2560843033325d5ed7001f363e93fd5294000/src/test/org/apache/commons/configuration/TestXMLConfiguration.java", "blob_url": "https://github.com/apache/commons-configuration/blob/cfd2560843033325d5ed7001f363e93fd5294000/src/test/org/apache/commons/configuration/TestXMLConfiguration.java", "sha": "ac379d31c7d6b7c2dcce37c83384b2e5f2401606", "changes": 17, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/test/org/apache/commons/configuration/TestXMLConfiguration.java?ref=cfd2560843033325d5ed7001f363e93fd5294000", "patch": "@@ -1278,6 +1278,23 @@ public void testRegisterEntityIdNull() throws IOException\n         }\n     }\n \n+    /**\n+     * Tests saving a configuration that was created from a hierarchical\n+     * configuration. This test exposes bug CONFIGURATION-301.\n+     */\n+    public void testSaveAfterCreateWithCopyConstructor()\n+            throws ConfigurationException\n+    {\n+        HierarchicalConfiguration hc = conf.configurationAt(\"element2\");\n+        conf = new XMLConfiguration(hc);\n+        conf.save(testSaveConf);\n+        XMLConfiguration checkConfig = new XMLConfiguration();\n+        checkConfig.setFile(testSaveConf);\n+        checkSavedConfig(checkConfig);\n+        assertEquals(\"Wrong name of root element\", \"element2\", checkConfig\n+                .getRootElementName());\n+    }\n+\n     /**\n      * Prepares a configuration object for testing a reload operation.\n      *", "filename": "src/test/org/apache/commons/configuration/TestXMLConfiguration.java"}, {"additions": 5, "raw_url": "https://github.com/apache/commons-configuration/raw/cfd2560843033325d5ed7001f363e93fd5294000/xdocs/changes.xml", "blob_url": "https://github.com/apache/commons-configuration/blob/cfd2560843033325d5ed7001f363e93fd5294000/xdocs/changes.xml", "sha": "a4616673ec529ae41c6acadd2ab846abdbeca978", "changes": 5, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/xdocs/changes.xml?ref=cfd2560843033325d5ed7001f363e93fd5294000", "patch": "@@ -23,6 +23,11 @@\n \n   <body>\n     <release version=\"1.6\" date=\"in SVN\" description=\"\">\n+      <action dev=\"oheger\" type=\"fix\" issue=\"CONFIGURATION-301\">\n+        Fixed a NullPointerException that could be thrown under certain\n+        circumstances when saving an XMLConfiguration that was created using\n+        the constructor that takes a HierarchicalConfiguration.\n+      </action>\n     </release>\n \n     <release version=\"1.5\" date=\"2007-11-24\" description=\"Many smaller bugfixes\">", "filename": "xdocs/changes.xml"}], "repo": "commons-configuration"}, {"commit": "https://github.com/apache/commons-configuration/commit/1c53281831611837de4358b6e75de594867f46b0", "parent": "https://github.com/apache/commons-configuration/commit/497bf061d76b0235738ad939d3196004036b207c", "message": "CONFIGURATION-282: Initialize default expression engine for HierarchicalConfiguration lazily if it is null. This should avoid NPEs after redeployment.\n\ngit-svn-id: https://svn.apache.org/repos/asf/jakarta/commons/proper/configuration/trunk@554746 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "commons-configuration_10", "file": [{"additions": 7, "raw_url": "https://github.com/apache/commons-configuration/raw/1c53281831611837de4358b6e75de594867f46b0/src/java/org/apache/commons/configuration/HierarchicalConfiguration.java", "blob_url": "https://github.com/apache/commons-configuration/blob/1c53281831611837de4358b6e75de594867f46b0/src/java/org/apache/commons/configuration/HierarchicalConfiguration.java", "sha": "ad839b9440c0f8bb5660fe53c69f89156401c164", "changes": 10, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/java/org/apache/commons/configuration/HierarchicalConfiguration.java?ref=1c53281831611837de4358b6e75de594867f46b0", "patch": "@@ -151,7 +151,7 @@\n     private static final long serialVersionUID = 3373812230395363192L;\n \n     /** Stores the default expression engine to be used for new objects.*/\n-    private static ExpressionEngine defaultExpressionEngine = new DefaultExpressionEngine();\n+    private static ExpressionEngine defaultExpressionEngine;\n \n     /** Stores the root node of this configuration. This field is required for\n      * backwards compatibility only.\n@@ -258,8 +258,12 @@ public void setRootNode(ConfigurationNode rootNode)\n      * @return the default expression engine\n      * @since 1.3\n      */\n-    public static ExpressionEngine getDefaultExpressionEngine()\n+    public static synchronized ExpressionEngine getDefaultExpressionEngine()\n     {\n+        if (defaultExpressionEngine == null)\n+        {\n+            defaultExpressionEngine = new DefaultExpressionEngine();\n+        }\n         return defaultExpressionEngine;\n     }\n \n@@ -272,7 +276,7 @@ public static ExpressionEngine getDefaultExpressionEngine()\n      * @param engine the new default expression engine\n      * @since 1.3\n      */\n-    public static void setDefaultExpressionEngine(ExpressionEngine engine)\n+    public static synchronized void setDefaultExpressionEngine(ExpressionEngine engine)\n     {\n         if (engine == null)\n         {", "filename": "src/java/org/apache/commons/configuration/HierarchicalConfiguration.java"}, {"additions": 5, "raw_url": "https://github.com/apache/commons-configuration/raw/1c53281831611837de4358b6e75de594867f46b0/xdocs/changes.xml", "blob_url": "https://github.com/apache/commons-configuration/blob/1c53281831611837de4358b6e75de594867f46b0/xdocs/changes.xml", "sha": "85b0ec1bb2152df35de1b6f475bcb2d99eb586e6", "changes": 5, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/xdocs/changes.xml?ref=1c53281831611837de4358b6e75de594867f46b0", "patch": "@@ -23,6 +23,11 @@\n \n   <body>\n     <release version=\"1.5-SNAPSHOT\" date=\"in SVN\" description=\"\">\n+      <action dev=\"oheger\" type=\"fix\" issue=\"CONFIGURATION-282\">\n+        The default expression engine used by HierarchicalConfiguration\n+        instances is now lazily initialized. This avoids NullPointerExceptions\n+        in certain server environments after a redeploy.\n+      </action>\n       <action dev=\"oheger\" type=\"fix\" issue=\"CONFIGURATION-281\">\n         Cycles in the JNDI tree no longer cause a stack overflow in\n         JNDIConfiguration.", "filename": "xdocs/changes.xml"}], "repo": "commons-configuration"}, {"commit": "https://github.com/apache/commons-configuration/commit/864a00382649bcea8f0bf2b7a04495c608922a67", "parent": "https://github.com/apache/commons-configuration/commit/beb37272963a9b9ee3185894e358e004606d6bc7", "message": "Bug 32236: Fixed NPE for file based configurations when constructed with invalid file name\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/jakarta/commons/proper/configuration/trunk@142024 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "commons-configuration_11", "file": [{"additions": 5, "raw_url": "https://github.com/apache/commons-configuration/raw/864a00382649bcea8f0bf2b7a04495c608922a67/src/java/org/apache/commons/configuration/AbstractFileConfiguration.java", "blob_url": "https://github.com/apache/commons-configuration/blob/864a00382649bcea8f0bf2b7a04495c608922a67/src/java/org/apache/commons/configuration/AbstractFileConfiguration.java", "sha": "1faeda1a2f78ace9aa9f4db4d0f94212d4812494", "changes": 6, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/java/org/apache/commons/configuration/AbstractFileConfiguration.java?ref=864a00382649bcea8f0bf2b7a04495c608922a67", "patch": "@@ -41,7 +41,7 @@\n  * and {@see AbstractFileConfiguration#save(Reader)}.\n  *\n  * @author Emmanuel Bourg\n- * @version $Revision: 1.7 $, $Date: 2004/10/19 11:44:31 $\n+ * @version $Revision: 1.8 $, $Date: 2004/11/14 18:29:02 $\n  * @since 1.0-rc2\n  */\n public abstract class AbstractFileConfiguration extends BaseConfiguration implements FileConfiguration\n@@ -80,6 +80,10 @@ public AbstractFileConfiguration(String fileName) throws ConfigurationException\n \n         // locate the file\n         url = ConfigurationUtils.locate(fileName);\n+        if(url == null)\n+        {\n+            throw new ConfigurationException(fileName + \" could not be found!\");\n+        }\n \n         // update the base path\n         setBasePath(ConfigurationUtils.getBasePath(url));", "filename": "src/java/org/apache/commons/configuration/AbstractFileConfiguration.java"}, {"additions": 14, "raw_url": "https://github.com/apache/commons-configuration/raw/864a00382649bcea8f0bf2b7a04495c608922a67/src/test/org/apache/commons/configuration/TestPropertiesConfiguration.java", "blob_url": "https://github.com/apache/commons-configuration/blob/864a00382649bcea8f0bf2b7a04495c608922a67/src/test/org/apache/commons/configuration/TestPropertiesConfiguration.java", "sha": "ea5663b0b247fa35f0466e11d7f05d7e05c51eec", "changes": 15, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/test/org/apache/commons/configuration/TestPropertiesConfiguration.java?ref=864a00382649bcea8f0bf2b7a04495c608922a67", "patch": "@@ -26,7 +26,7 @@\n /**\n  * Test for loading and saving properties files.\n  *\n- * @version $Id: TestPropertiesConfiguration.java,v 1.15 2004/10/18 21:38:45 epugh Exp $\n+ * @version $Id: TestPropertiesConfiguration.java,v 1.16 2004/11/14 18:29:02 oheger Exp $\n  */\n public class TestPropertiesConfiguration extends TestCase\n {\n@@ -207,6 +207,19 @@ public void testLoadFromFile() throws Exception\n \n         assertEquals(\"true\", conf.getString(\"configuration.loaded\"));\n     }\n+    \n+    public void testLoadUnexistingFile()\n+    {\n+        try\n+        {\n+            conf = new PropertiesConfiguration(\"Unexisting file\");\n+            fail(\"Unexisting file was loaded.\");\n+        }\n+        catch(ConfigurationException cex)\n+        {\n+            // fine\n+        }\n+    }\n \n     public void testGetStringWithEscapedChars()\n     {", "filename": "src/test/org/apache/commons/configuration/TestPropertiesConfiguration.java"}], "repo": "commons-configuration"}, {"commit": "https://github.com/apache/commons-configuration/commit/fc7db34c11272bceda6fee8a28607d31ee1f0782", "parent": "https://github.com/apache/commons-configuration/commit/b9987345e00d42463328a978bf839e2e780e2829", "message": "Handle NPE when missing resource. Patch from Bean Hutchison\n<Ben.Hutchison@sensis.com.au>.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/jakarta/commons/proper/configuration/trunk@141935 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "commons-configuration_12", "file": [{"additions": 7, "raw_url": "https://github.com/apache/commons-configuration/raw/fc7db34c11272bceda6fee8a28607d31ee1f0782/src/java/org/apache/commons/configuration/XMLConfiguration.java", "blob_url": "https://github.com/apache/commons-configuration/blob/fc7db34c11272bceda6fee8a28607d31ee1f0782/src/java/org/apache/commons/configuration/XMLConfiguration.java", "sha": "780131acac6e148f893ce6c22b3278aaaf39d9cb", "changes": 9, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/java/org/apache/commons/configuration/XMLConfiguration.java?ref=fc7db34c11272bceda6fee8a28607d31ee1f0782", "patch": "@@ -68,7 +68,7 @@\n  * @author <a href=\"mailto:kelvint@apache.org\">Kelvin Tan </a>\n  * @author <a href=\"mailto:dlr@apache.org\">Daniel Rall </a>\n  * @author Emmanuel Bourg\n- * @version $Revision: 1.11 $, $Date: 2004/09/03 16:36:20 $\n+ * @version $Revision: 1.12 $, $Date: 2004/09/06 11:40:34 $\n  */\n public class XMLConfiguration extends BasePathConfiguration {\n     // For conformance with xpath\n@@ -166,6 +166,11 @@ private static File resourceURLToFile(String resource) {\n         if (confURL == null) {\n             confURL = ClassLoader.getSystemResource(resource);\n         }\n+        if (confURL == null) {\n+            throw new IllegalArgumentException(\"Resource: \"\n+                    + resource + \" not found through context or \"\n+                    + \"system classloaders.\");\n+        }\n         return new File(confURL.getFile());\n     }\n \n@@ -696,4 +701,4 @@ protected static String parseAttributeName(String key) {\n \n         return name;\n     }\n-}\n\\ No newline at end of file\n+}", "filename": "src/java/org/apache/commons/configuration/XMLConfiguration.java"}], "repo": "commons-configuration"}, {"commit": "https://github.com/apache/commons-configuration/commit/ef6627d9de7f2d926ee211110bbe46fcad163010", "parent": "https://github.com/apache/commons-configuration/commit/d2f445fe15b4bcee24802885f3e09113dba43e62", "message": "Fixed bug 29722 (addProperty throws a NPE in DOMConfiguration)\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/jakarta/commons/proper/configuration/trunk@141888 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "commons-configuration_13", "file": [{"additions": 20, "raw_url": "https://github.com/apache/commons-configuration/raw/ef6627d9de7f2d926ee211110bbe46fcad163010/src/java/org/apache/commons/configuration/XMLConfiguration.java", "blob_url": "https://github.com/apache/commons-configuration/blob/ef6627d9de7f2d926ee211110bbe46fcad163010/src/java/org/apache/commons/configuration/XMLConfiguration.java", "sha": "0843f410c37a0d43033dd3990bd1417e202e2663", "changes": 35, "status": "modified", "deletions": 15, "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/java/org/apache/commons/configuration/XMLConfiguration.java?ref=ef6627d9de7f2d926ee211110bbe46fcad163010", "patch": "@@ -50,7 +50,7 @@\n  * @author J\ufffdrg Schaible\n  * @author <a href=\"mailto:kelvint@apache.org\">Kelvin Tan</a>\n  * @author <a href=\"mailto:dlr@apache.org\">Daniel Rall</a>\n- * @version $Revision: 1.4 $, $Date: 2004/07/12 12:14:38 $\n+ * @version $Revision: 1.5 $, $Date: 2004/07/12 14:40:54 $\n  */\n public class XMLConfiguration extends BasePathConfiguration\n {\n@@ -81,11 +81,20 @@\n \n     /**\n      * Empty construtor.  You must provide a file/fileName\n-     * and call the load method\n-     *\n+     * to save the configuration.\n      */\n     public XMLConfiguration()\n     {\n+        // build an empty document.\n+        DocumentBuilder builder = null;\n+        try {\n+            builder = DocumentBuilderFactory.newInstance().newDocumentBuilder();\n+        } catch (ParserConfigurationException e) {\n+            throw new ConfigurationRuntimeException(e.getMessage(), e);\n+        }\n+\n+        document = builder.newDocument();\n+        document.appendChild(document.createElement(\"configuration\"));\n     }\n \n     /**\n@@ -126,19 +135,19 @@ public void load() throws ConfigurationException\n         }\n         catch (IOException de)\n         {\n-            throw new ConfigurationException(\"Could not load from \" + file.getAbsolutePath());\n+            throw new ConfigurationException(\"Could not load from \" + file.getAbsolutePath(), de);\n         }\n         catch (ParserConfigurationException ex)\n         {\n-            throw new ConfigurationException(\"Could not configure parser\");\n+            throw new ConfigurationException(\"Could not configure parser\", ex);\n \t\t}\n         catch (FactoryConfigurationError ex)\n         {\n-            throw new ConfigurationException(\"Could not create parser\");\n+            throw new ConfigurationException(\"Could not create parser\", ex);\n         }\n         catch (SAXException ex)\n         {\n-            throw new ConfigurationException(\"Error parsing file \" + file.getAbsolutePath());\n+            throw new ConfigurationException(\"Error parsing file \" + file.getAbsolutePath(), ex);\n \t\t}\n \n         initProperties(document.getDocumentElement(), new StringBuffer());\n@@ -204,13 +213,9 @@ private void processAttributes(String hierarchy, Element element)\n         NamedNodeMap attributes = element.getAttributes();\n         for (int i = 0; i < attributes.getLength(); ++i)\n         {\n-            Node node = attributes.item(i);\n-            if (node instanceof Attr)\n-            {\n-                Attr attr = (Attr) node;\n-                String attrName = hierarchy + '[' + ATTRIB_MARKER + attr.getName() + ']';\n-                super.addProperty(attrName, attr.getValue());\n-            }\n+            Attr attr = (Attr) attributes.item(i);\n+            String attrName = hierarchy + '[' + ATTRIB_MARKER + attr.getName() + ']';\n+            super.addProperty(attrName, attr.getValue());\n         }\n     }\n \n@@ -441,7 +446,7 @@ public void setFileName(String fileName)\n \n     /**\n      * Returns the fileName.\n-     * \n+     *\n      * @return String\n      */\n     public String getFileName()", "filename": "src/java/org/apache/commons/configuration/XMLConfiguration.java"}], "repo": "commons-configuration"}]
