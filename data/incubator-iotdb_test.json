{
    "incubator-iotdb_e24236d": {
        "repo": "incubator-iotdb",
        "message": "fix an NPE in SGP during recovery",
        "commit": "https://github.com/apache/incubator-iotdb/commit/e24236d2a1f3585d6c92e24c3e11c0245514682b",
        "parent": "https://github.com/apache/incubator-iotdb/commit/c6362f15d77823ceccf5c6849785b678ee38a90d",
        "bug_id": "incubator-iotdb_e24236d",
        "file": [
            {
                "sha": "f9841e4662f31d498a35c8e78e9ef3262a2087ce",
                "filename": "iotdb/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java",
                "blob_url": "https://github.com/apache/incubator-iotdb/blob/e24236d2a1f3585d6c92e24c3e11c0245514682b/iotdb/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java",
                "raw_url": "https://github.com/apache/incubator-iotdb/raw/e24236d2a1f3585d6c92e24c3e11c0245514682b/iotdb/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java",
                "status": "modified",
                "changes": 12,
                "additions": 8,
                "contents_url": "https://api.github.com/repos/apache/incubator-iotdb/contents/iotdb/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java?ref=e24236d2a1f3585d6c92e24c3e11c0245514682b",
                "patch": "@@ -780,20 +780,24 @@ private void mergeEndAction(List<TsFileResource> seqFiles, List<TsFileResource>\n         try {\n           // remove old modifications and write modifications generated during merge\n           seqFile.removeModFile();\n-          for (Modification modification : mergingModification.getModifications()) {\n-            seqFile.getModFile().write(modification);\n+          if (mergingModification != null) {\n+            for (Modification modification : mergingModification.getModifications()) {\n+              seqFile.getModFile().write(modification);\n+            }\n           }\n         } catch (IOException e) {\n           logger.error(\"{} cannot clean the ModificationFile of {} after merge\", storageGroupName,\n               seqFile.getFile(), e);\n         }\n         if (i == seqFiles.size() - 1) {\n           try {\n-            mergingModification.remove();\n+            if (mergingModification != null) {\n+              mergingModification.remove();\n+              mergingModification = null;\n+            }\n           } catch (IOException e) {\n             logger.error(\"{} cannot remove merging modification \", storageGroupName, e);\n           }\n-          mergingModification = null;\n           isMerging = false;\n         }\n       } finally {",
                "deletions": 4
            }
        ],
        "patched_files": [
            "StorageGroupProcessor.java"
        ],
        "unit_tests": [
            "StorageGroupProcessorTest.java"
        ]
    },
    "incubator-iotdb_4baa36e": {
        "repo": "incubator-iotdb",
        "message": "fix an NPE when closing mergeLogger",
        "commit": "https://github.com/apache/incubator-iotdb/commit/4baa36eb3f143f79e12e7754e38b6acb918bb7ae",
        "parent": "https://github.com/apache/incubator-iotdb/commit/8cd144f3121398ddda6e70bd31e69e24de6345d7",
        "bug_id": "incubator-iotdb_4baa36e",
        "file": [
            {
                "sha": "efaf53497f1672191c830dec6ca3e87cdcd368a4",
                "filename": "iotdb/src/main/java/org/apache/iotdb/db/engine/merge/task/MergeTask.java",
                "blob_url": "https://github.com/apache/incubator-iotdb/blob/4baa36eb3f143f79e12e7754e38b6acb918bb7ae/iotdb/src/main/java/org/apache/iotdb/db/engine/merge/task/MergeTask.java",
                "raw_url": "https://github.com/apache/incubator-iotdb/raw/4baa36eb3f143f79e12e7754e38b6acb918bb7ae/iotdb/src/main/java/org/apache/iotdb/db/engine/merge/task/MergeTask.java",
                "status": "modified",
                "changes": 4,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/incubator-iotdb/contents/iotdb/src/main/java/org/apache/iotdb/db/engine/merge/task/MergeTask.java?ref=4baa36eb3f143f79e12e7754e38b6acb918bb7ae",
                "patch": "@@ -127,7 +127,9 @@ void cleanUp(boolean executeCallback) throws IOException {\n     unmergedChunkCnt.clear();\n     unmergedChunkStartTimes.clear();\n \n-    mergeLogger.close();\n+    if (mergeLogger != null) {\n+      mergeLogger.close();\n+    }\n \n     for (TsFileResource seqFile : resource.getSeqFiles()) {\n       File mergeFile = new File(seqFile.getFile().getPath() + MERGE_SUFFIX);",
                "deletions": 1
            }
        ],
        "patched_files": [
            "MergeTask.java"
        ],
        "unit_tests": [
            "MergeTaskTest.java"
        ]
    },
    "incubator-iotdb_bec56b7": {
        "repo": "incubator-iotdb",
        "message": "fix a NPE in merge recovery",
        "commit": "https://github.com/apache/incubator-iotdb/commit/bec56b7bbe6da764275a6ba287618fa06e8f50c2",
        "parent": "https://github.com/apache/incubator-iotdb/commit/33c605614e61667185bc43fb0cf5bc62fe2f232e",
        "bug_id": "incubator-iotdb_bec56b7",
        "file": [
            {
                "sha": "6c92d3c1c2390554481ff1ea314de54f2360882f",
                "filename": "iotdb/src/main/java/org/apache/iotdb/db/engine/merge/task/RecoverMergeTask.java",
                "blob_url": "https://github.com/apache/incubator-iotdb/blob/bec56b7bbe6da764275a6ba287618fa06e8f50c2/iotdb/src/main/java/org/apache/iotdb/db/engine/merge/task/RecoverMergeTask.java",
                "raw_url": "https://github.com/apache/incubator-iotdb/raw/bec56b7bbe6da764275a6ba287618fa06e8f50c2/iotdb/src/main/java/org/apache/iotdb/db/engine/merge/task/RecoverMergeTask.java",
                "status": "modified",
                "changes": 6,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/incubator-iotdb/contents/iotdb/src/main/java/org/apache/iotdb/db/engine/merge/task/RecoverMergeTask.java?ref=bec56b7bbe6da764275a6ba287618fa06e8f50c2",
                "patch": "@@ -47,9 +47,11 @@\n \n   private LogAnalyzer analyzer;\n \n-  public RecoverMergeTask(String storageGroupDir, MergeCallback callback, String taskName,\n+  public RecoverMergeTask(List<TsFileResource> seqFiles,\n+      List<TsFileResource> unseqFiles, String storageGroupDir,\n+      MergeCallback callback, String taskName,\n       boolean fullMerge) throws IOException {\n-    super(null, null, storageGroupDir, callback, taskName, fullMerge);\n+    super(seqFiles, unseqFiles, storageGroupDir, callback, taskName, fullMerge);\n   }\n \n   public void recoverMerge(boolean continueMerge) throws IOException {",
                "deletions": 2
            },
            {
                "sha": "29c1146787e300358ab0e3acf66cd50585794aa3",
                "filename": "iotdb/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java",
                "blob_url": "https://github.com/apache/incubator-iotdb/blob/bec56b7bbe6da764275a6ba287618fa06e8f50c2/iotdb/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java",
                "raw_url": "https://github.com/apache/incubator-iotdb/raw/bec56b7bbe6da764275a6ba287618fa06e8f50c2/iotdb/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java",
                "status": "modified",
                "changes": 5,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/incubator-iotdb/contents/iotdb/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java?ref=bec56b7bbe6da764275a6ba287618fa06e8f50c2",
                "patch": "@@ -201,8 +201,9 @@ private void recover() throws ProcessorException {\n       if (mergingMods.exists()) {\n         mergingModification = new ModificationFile(storageGroupSysDir + File.separator + MERGING_MODIFICAITON_FILE_NAME);\n       }\n-      RecoverMergeTask recoverMergeTask = new RecoverMergeTask(storageGroupSysDir.getPath(),\n-          this::mergeEndAction, taskName, IoTDBDescriptor.getInstance().getConfig().isForceFullMerge());\n+      RecoverMergeTask recoverMergeTask = new RecoverMergeTask(seqTsFiles, unseqTsFiles,\n+          storageGroupSysDir.getPath(), this::mergeEndAction, taskName,\n+          IoTDBDescriptor.getInstance().getConfig().isForceFullMerge());\n       logger.info(\"{} a RecoverMergeTask {} starts...\", storageGroupName, taskName);\n       recoverMergeTask.recoverMerge(IoTDBDescriptor.getInstance().getConfig().isContinueMergeAfterReboot());\n       if (!IoTDBDescriptor.getInstance().getConfig().isContinueMergeAfterReboot()) {",
                "deletions": 2
            }
        ],
        "patched_files": [
            "StorageGroupProcessor.java"
        ],
        "unit_tests": [
            "StorageGroupProcessorTest.java"
        ]
    },
    "incubator-iotdb_20b42cd": {
        "repo": "incubator-iotdb",
        "message": "Merge pull request #693 from LeiRui/IOTDB-159\n\n[IOTDB-159] Fix NullPointerException in SeqTsFileRecoverTest and UnseqTsFileRecoverTest",
        "commit": "https://github.com/apache/incubator-iotdb/commit/20b42cd1af03b689d85bd2ba6c50a4cca1ebbdde",
        "parent": "https://github.com/apache/incubator-iotdb/commit/cd776ce2b5e8dc0a1cb5f3b00985e8a3ee9903e8",
        "bug_id": "incubator-iotdb_20b42cd",
        "file": [
            {
                "sha": "cbfd1fa2aa0bf14f31d719a3d4d84f33b5d021f4",
                "filename": "server/src/test/java/org/apache/iotdb/db/writelog/recover/SeqTsFileRecoverTest.java",
                "blob_url": "https://github.com/apache/incubator-iotdb/blob/20b42cd1af03b689d85bd2ba6c50a4cca1ebbdde/server/src/test/java/org/apache/iotdb/db/writelog/recover/SeqTsFileRecoverTest.java",
                "raw_url": "https://github.com/apache/incubator-iotdb/raw/20b42cd1af03b689d85bd2ba6c50a4cca1ebbdde/server/src/test/java/org/apache/iotdb/db/writelog/recover/SeqTsFileRecoverTest.java",
                "status": "modified",
                "changes": 3,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/incubator-iotdb/contents/server/src/test/java/org/apache/iotdb/db/writelog/recover/SeqTsFileRecoverTest.java?ref=20b42cd1af03b689d85bd2ba6c50a4cca1ebbdde",
                "patch": "@@ -28,6 +28,7 @@\n import org.apache.commons.io.FileUtils;\n import org.apache.iotdb.db.conf.adapter.ActiveTimeSeriesCounter;\n import org.apache.iotdb.db.engine.fileSystem.SystemFileFactory;\n+import org.apache.iotdb.db.engine.flush.pool.FlushSubTaskPoolManager;\n import org.apache.iotdb.db.engine.storagegroup.TsFileResource;\n import org.apache.iotdb.db.engine.version.VersionController;\n import org.apache.iotdb.db.exception.storageGroup.StorageGroupProcessorException;\n@@ -78,6 +79,7 @@ public long currVersion() {\n \n   @Before\n   public void setup() throws IOException, WriteProcessException {\n+    FlushSubTaskPoolManager.getInstance().start();\n     tsF = SystemFileFactory.INSTANCE.getFile(logNodePrefix, \"test.ts\");\n     tsF.getParentFile().mkdirs();\n \n@@ -130,6 +132,7 @@ public void tearDown() throws IOException {\n     FileUtils.deleteDirectory(tsF.getParentFile());\n     resource.close();\n     node.delete();\n+    FlushSubTaskPoolManager.getInstance().stop();\n   }\n \n   @Test",
                "deletions": 0
            },
            {
                "sha": "351228c3a5b0f3b9fea8e835d82287554f758ffe",
                "filename": "server/src/test/java/org/apache/iotdb/db/writelog/recover/UnseqTsFileRecoverTest.java",
                "blob_url": "https://github.com/apache/incubator-iotdb/blob/20b42cd1af03b689d85bd2ba6c50a4cca1ebbdde/server/src/test/java/org/apache/iotdb/db/writelog/recover/UnseqTsFileRecoverTest.java",
                "raw_url": "https://github.com/apache/incubator-iotdb/raw/20b42cd1af03b689d85bd2ba6c50a4cca1ebbdde/server/src/test/java/org/apache/iotdb/db/writelog/recover/UnseqTsFileRecoverTest.java",
                "status": "modified",
                "changes": 3,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/incubator-iotdb/contents/server/src/test/java/org/apache/iotdb/db/writelog/recover/UnseqTsFileRecoverTest.java?ref=20b42cd1af03b689d85bd2ba6c50a4cca1ebbdde",
                "patch": "@@ -26,6 +26,7 @@\n import org.apache.commons.io.FileUtils;\n import org.apache.iotdb.db.conf.adapter.ActiveTimeSeriesCounter;\n import org.apache.iotdb.db.engine.fileSystem.SystemFileFactory;\n+import org.apache.iotdb.db.engine.flush.pool.FlushSubTaskPoolManager;\n import org.apache.iotdb.db.engine.storagegroup.TsFileResource;\n import org.apache.iotdb.db.engine.version.VersionController;\n import org.apache.iotdb.db.exception.storageGroup.StorageGroupProcessorException;\n@@ -80,6 +81,7 @@ public long currVersion() {\n \n   @Before\n   public void setup() throws IOException, WriteProcessException {\n+    FlushSubTaskPoolManager.getInstance().start();\n     tsF = SystemFileFactory.INSTANCE.getFile(logNodePrefix, \"test.ts\");\n     tsF.getParentFile().mkdirs();\n \n@@ -138,6 +140,7 @@ public void setup() throws IOException, WriteProcessException {\n   public void tearDown() throws IOException {\n     FileUtils.deleteDirectory(tsF.getParentFile());\n     node.delete();\n+    FlushSubTaskPoolManager.getInstance().stop();\n   }\n \n   @Test",
                "deletions": 0
            }
        ],
        "patched_files": [],
        "unit_tests": [
            "SeqTsFileRecoverTest.java",
            "UnseqTsFileRecoverTest.java"
        ]
    }
}