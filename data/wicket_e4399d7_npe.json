[
    {
        "repo": "wicket",
        "commit": "https://github.com/apache/wicket/commit/e4399d74234b657435f44eb137969db1a22896d5",
        "bug_id": "wicket_e4399d7",
        "message": "WICKET-6031 NPE in PackageResourceReference#getResource() when there is no request",
        "parent": "https://github.com/apache/wicket/commit/490fdf67646f1b987c2c1065a3fa6c55f6c5b338",
        "patched_files": [
            "PackageResourceReference.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 26,
                "raw_url": "https://github.com/apache/wicket/raw/e4399d74234b657435f44eb137969db1a22896d5/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResourceReference.java",
                "contents_url": "https://api.github.com/repos/apache/wicket/contents/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResourceReference.java?ref=e4399d74234b657435f44eb137969db1a22896d5",
                "filename": "wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResourceReference.java",
                "deletions": 8,
                "sha": "f10a01cb83b22133f83f457d6db6fbc5c0dbb966",
                "blob_url": "https://github.com/apache/wicket/blob/e4399d74234b657435f44eb137969db1a22896d5/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResourceReference.java",
                "patch": "@@ -111,10 +111,16 @@ public PackageResource getResource()\n \t\tfinal String extension = getExtension();\n \n \t\tfinal PackageResource resource;\n-\t\t\n-\t\tfinal Url url = RequestCycle.get().getRequest().getUrl();\n-\t\t//resource attributes (locale, style, variation) might be encoded in the URL\n-\t\tfinal UrlAttributes urlAttributes = ResourceUtil.decodeResourceReferenceAttributes(url);\n+\n+\t\tRequestCycle requestCycle = RequestCycle.get();\n+\t\tUrlAttributes urlAttributes = null;\n+\t\tif (requestCycle != null)\n+\t\t{\n+\t\t\t//resource attributes (locale, style, variation) might be encoded in the URL\n+\t\t\tfinal Url url = requestCycle.getRequest().getUrl();\n+\t\t\turlAttributes = ResourceUtil.decodeResourceReferenceAttributes(url);\n+\t\t}\n+\n \t\tfinal String currentVariation = getCurrentVariation(urlAttributes);\n \t\tfinal String currentStyle = getCurrentStyle(urlAttributes);\n \t\tfinal Locale currentLocale = getCurrentLocale(urlAttributes);\n@@ -185,7 +191,11 @@ private Locale getCurrentLocale(UrlAttributes attributes)\n \t{\n \t\tLocale currentLocale = getCurrentLocale();\n \n-\t\treturn currentLocale != null ? currentLocale : attributes.getLocale();\n+\t\treturn currentLocale != null\n+\t\t\t\t? currentLocale\n+\t\t\t\t: attributes != null\n+\t\t\t\t\t? attributes.getLocale()\n+\t\t\t\t\t: null;\n \t}\n \n \tprivate Locale getCurrentLocale()\n@@ -208,8 +218,12 @@ private Locale getCurrentLocale()\n \tprivate String getCurrentStyle(UrlAttributes attributes)\n \t{\n \t\tString currentStyle = getCurrentStyle();\n-\t\t\n-\t\treturn currentStyle != null ? currentStyle : attributes.getStyle();\n+\n+\t\treturn currentStyle != null\n+\t\t\t\t? currentStyle\n+\t\t\t\t: attributes != null\n+\t\t\t\t\t? attributes.getStyle()\n+\t\t\t\t\t: null;\n \t}\n \t\n \tprivate String getCurrentStyle()\n@@ -233,7 +247,11 @@ private String getCurrentVariation(UrlAttributes attributes)\n \t{\n \t\tfinal String variation = getVariation();\n \n-\t\treturn variation != null ? variation : attributes.getVariation();\n+\t\treturn variation != null\n+\t\t\t\t? variation\n+\t\t\t\t: attributes != null\n+\t\t\t\t\t? attributes.getVariation()\n+\t\t\t\t\t: null;\n \t}\n \n \t/**",
                "changes": 34
            },
            {
                "status": "modified",
                "additions": 19,
                "raw_url": "https://github.com/apache/wicket/raw/e4399d74234b657435f44eb137969db1a22896d5/wicket-core/src/test/java/org/apache/wicket/request/resource/PackageResourceReferenceTest.java",
                "contents_url": "https://api.github.com/repos/apache/wicket/contents/wicket-core/src/test/java/org/apache/wicket/request/resource/PackageResourceReferenceTest.java?ref=e4399d74234b657435f44eb137969db1a22896d5",
                "filename": "wicket-core/src/test/java/org/apache/wicket/request/resource/PackageResourceReferenceTest.java",
                "deletions": 0,
                "sha": "de7a0a55b3f91d97e34e9685dbf9aef74a77c3e0",
                "blob_url": "https://github.com/apache/wicket/blob/e4399d74234b657435f44eb137969db1a22896d5/wicket-core/src/test/java/org/apache/wicket/request/resource/PackageResourceReferenceTest.java",
                "patch": "@@ -21,6 +21,7 @@\n import java.util.Locale;\r\n \r\n import org.apache.wicket.Application;\r\n+import org.apache.wicket.ThreadContext;\r\n import org.apache.wicket.protocol.http.mock.MockHttpServletRequest;\r\n import org.apache.wicket.protocol.http.mock.MockHttpServletResponse;\r\n import org.apache.wicket.request.Request;\r\n@@ -355,5 +356,23 @@ public void testContentRangeHeaders()\n \t\t\tnew String(mockHttpServletResponse.getBinaryContent()));\r\n \t}\r\n \r\n+\t/**\r\n+\t * https://issues.apache.org/jira/browse/WICKET-6031\r\n+\t */\r\n+\t@Test\r\n+\tpublic void noRequestCycle()\r\n+\t{\r\n+\t\tThreadContext.setRequestCycle(null);\r\n+\r\n+\t\tPackageResourceReference reference = new PackageResourceReference(scope, \"resource.txt\",\r\n+\t\t\t\tlocales[1], styles[1], variations[1]);\r\n+\r\n+\t\tPackageResource resource = reference.getResource();\r\n+\t\tassertNotNull(resource);\r\n+\r\n+\t\tassertEquals(locales[1], resource.getResourceStream().getLocale());\r\n+\t\tassertEquals(styles[1], resource.getResourceStream().getStyle());\r\n+\t\tassertEquals(variations[1], resource.getResourceStream().getVariation());\r\n+\t}\r\n \r\n }\r",
                "changes": 19
            }
        ],
        "unit_tests": [
            "PackageResourceReferenceTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "wicket-core/src/test/java/org/apache/wicket/request/resource/PackageResourceReferenceTest.java",
        "buggy_files": [
            "wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResourceReference.java"
        ],
        "fixed": true
    }
]