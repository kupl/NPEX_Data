{
    "incubator-tez_150ebd3": {
        "bug_id": "incubator-tez_150ebd3",
        "commit": "https://github.com/apache/incubator-tez/commit/150ebd3c7934339f31a7b24012ece8e171e1f993",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/incubator-tez/blob/150ebd3c7934339f31a7b24012ece8e171e1f993/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/shuffle/impl/ShuffleInputEventHandler.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/shuffle/impl/ShuffleInputEventHandler.java?ref=150ebd3c7934339f31a7b24012ece8e171e1f993",
                "deletions": 1,
                "filename": "tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/shuffle/impl/ShuffleInputEventHandler.java",
                "patch": "@@ -90,7 +90,8 @@ private void processDataMovementEvent(DataMovementEvent dmEvent) {\n         byte[] emptyPartitions = TezUtils.decompressByteStringToByteArray(shufflePayload.getEmptyPartitions());\n         BitSet emptyPartitionsBitSet = TezUtils.fromByteArray(emptyPartitions);\n         if (emptyPartitionsBitSet.get(partitionId)) {\n-          LOG.info(\"Source partition: \" + partitionId + \" did not generate any data. Not fetching.\");\n+          LOG.info(\"Source partition: \" + partitionId + \" did not generate any data. SrcAttempt: [\"\n+              + srcAttemptIdentifier + \"]. Not fetching.\");\n           scheduler.copySucceeded(srcAttemptIdentifier, null, 0, 0, 0, null);\n           return;\n         }",
                "raw_url": "https://github.com/apache/incubator-tez/raw/150ebd3c7934339f31a7b24012ece8e171e1f993/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/shuffle/impl/ShuffleInputEventHandler.java",
                "sha": "e0a416090b60f28e22e2c04124f23b0cc61ed144",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/incubator-tez/blob/150ebd3c7934339f31a7b24012ece8e171e1f993/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/shuffle/impl/ShuffleScheduler.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/shuffle/impl/ShuffleScheduler.java?ref=150ebd3c7934339f31a7b24012ece8e171e1f993",
                "deletions": 1,
                "filename": "tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/shuffle/impl/ShuffleScheduler.java",
                "patch": "@@ -203,7 +203,11 @@ public synchronized void copySucceeded(InputAttemptIdentifier srcAttemptIdentifi\n       // input is already finished. duplicate fetch.\n       LOG.warn(\"Duplicate fetch of input no longer needs to be fetched: \" + srcAttemptIdentifier);\n       // free the resource - specially memory\n-      output.abort();\n+      \n+      // If the src does not generate data, output will be null.\n+      if (output != null) {\n+        output.abort();\n+      }\n     }\n     // TODO NEWTEZ Should this be releasing the output, if not committed ? Possible memory leak in case of speculation.\n   }",
                "raw_url": "https://github.com/apache/incubator-tez/raw/150ebd3c7934339f31a7b24012ece8e171e1f993/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/shuffle/impl/ShuffleScheduler.java",
                "sha": "45a50ad8394514d558a2d79eb1e8dce1ef689ea9",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/incubator-tez/blob/150ebd3c7934339f31a7b24012ece8e171e1f993/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/shuffle/common/impl/ShuffleInputEventHandlerImpl.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/shuffle/common/impl/ShuffleInputEventHandlerImpl.java?ref=150ebd3c7934339f31a7b24012ece8e171e1f993",
                "deletions": 1,
                "filename": "tez-runtime-library/src/main/java/org/apache/tez/runtime/library/shuffle/common/impl/ShuffleInputEventHandlerImpl.java",
                "patch": "@@ -106,7 +106,8 @@ private void processDataMovementEvent(DataMovementEvent dme) throws IOException\n       if (emptyPartionsBitSet.get(srcIndex)) {\n         InputAttemptIdentifier srcAttemptIdentifier = new InputAttemptIdentifier(dme.getTargetIndex(),\n             dme.getVersion());\n-        LOG.info(\"Source partition: \" + srcIndex + \" did not generate any data. Not fetching.\");\n+        LOG.info(\"Source partition: \" + srcIndex + \" did not generate any data. SrcAttempt: [\"\n+            + srcAttemptIdentifier + \"]. Not fetching.\");\n         shuffleManager.addCompletedInputWithNoData(srcAttemptIdentifier);\n         return;\n       }",
                "raw_url": "https://github.com/apache/incubator-tez/raw/150ebd3c7934339f31a7b24012ece8e171e1f993/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/shuffle/common/impl/ShuffleInputEventHandlerImpl.java",
                "sha": "ac5da74ec0686acc2af40fca318eed3bc941cee4",
                "status": "modified"
            }
        ],
        "message": "TEZ-1048. Fix an NPE which can occur when the source task generates no\ndata for a partition, and runs multiple attempts. (sseth)",
        "parent": "https://github.com/apache/incubator-tez/commit/a786e41a3c0a164c649ef4922ebbc5a5f3d59201",
        "repo": "incubator-tez",
        "unit_tests": [
            "TestShuffleInputEventHandlerImpl.java"
        ]
    },
    "incubator-tez_3d0edf4": {
        "bug_id": "incubator-tez_3d0edf4",
        "commit": "https://github.com/apache/incubator-tez/commit/3d0edf44e001e74ad50301e700ecdc807af8221e",
        "file": [
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/incubator-tez/blob/3d0edf44e001e74ad50301e700ecdc807af8221e/tez-dag/src/main/java/org/apache/tez/dag/app/rm/TaskSchedulerEventHandler.java",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-dag/src/main/java/org/apache/tez/dag/app/rm/TaskSchedulerEventHandler.java?ref=3d0edf44e001e74ad50301e700ecdc807af8221e",
                "deletions": 1,
                "filename": "tez-dag/src/main/java/org/apache/tez/dag/app/rm/TaskSchedulerEventHandler.java",
                "patch": "@@ -24,6 +24,7 @@\n import java.util.Map;\n import java.util.concurrent.BlockingQueue;\n import java.util.concurrent.LinkedBlockingQueue;\n+import java.util.concurrent.atomic.AtomicBoolean;\n \n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n@@ -81,6 +82,8 @@\n   final DAGClientServer clientService;\n   private final ContainerSignatureMatcher containerSignatureMatcher;\n   private int cachedNodeCount = -1;\n+  private AtomicBoolean shouldUnregisterFlag =\n+      new AtomicBoolean(false);\n \n   BlockingQueue<AMSchedulerEvent> eventQueue\n                               = new LinkedBlockingQueue<AMSchedulerEvent>();\n@@ -353,6 +356,11 @@ public synchronized void serviceStart() {\n         serviceAddr.getPort(), \"\", appContext);\n     taskScheduler.init(getConfig());\n     taskScheduler.start();\n+    if (shouldUnregisterFlag.get()) {\n+      // Flag may have been set earlier when task scheduler was not initialized\n+      taskScheduler.setShouldUnregister();\n+    }\n+\n     this.eventHandlingThread = new Thread(\"TaskSchedulerEventHandlerThread\") {\n       @Override\n       public void run() {\n@@ -552,8 +560,11 @@ public void preemptContainer(ContainerId containerId) {\n   }\n \n   public void setShouldUnregisterFlag() {\n-    this.taskScheduler.setShouldUnregister();\n     LOG.info(\"TaskScheduler notified that it should unregister from RM\");\n+    this.shouldUnregisterFlag.set(true);\n+    if (this.taskScheduler != null) {\n+      this.taskScheduler.setShouldUnregister();\n+    }\n   }\n \n }",
                "raw_url": "https://github.com/apache/incubator-tez/raw/3d0edf44e001e74ad50301e700ecdc807af8221e/tez-dag/src/main/java/org/apache/tez/dag/app/rm/TaskSchedulerEventHandler.java",
                "sha": "66ef81996034f4f6925964d43cdcc55bf944c986",
                "status": "modified"
            }
        ],
        "message": "TEZ-928. NPE in last app attempt caused by registering for an RM unregister. (hitesh)",
        "parent": "https://github.com/apache/incubator-tez/commit/2118e96446bd3ca8858c831a5cf7ebc07d683007",
        "repo": "incubator-tez",
        "unit_tests": [
            "TestTaskSchedulerEventHandler.java"
        ]
    },
    "incubator-tez_7b2a0e6": {
        "bug_id": "incubator-tez_7b2a0e6",
        "commit": "https://github.com/apache/incubator-tez/commit/7b2a0e6f3427182e0c7d55f3da1c369500770ab0",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/incubator-tez/blob/7b2a0e6f3427182e0c7d55f3da1c369500770ab0/tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java?ref=7b2a0e6f3427182e0c7d55f3da1c369500770ab0",
                "deletions": 1,
                "filename": "tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java",
                "patch": "@@ -373,7 +373,9 @@ static ApplicationSubmissionContext createApplicationSubmissionContext(\n         if (v.getTaskLocalResources() == null) {\n           v.setTaskLocalResources(new TreeMap<String, LocalResource>());\n         }\n-        v.getTaskLocalResources().putAll(tezJarResources);\n+        if (tezJarResources != null) {\n+          v.getTaskLocalResources().putAll(tezJarResources);\n+        }\n         v.getTaskLocalResources().put(TezConfiguration.TEZ_PB_BINARY_CONF_NAME,\n             binaryConfLRsrc);\n ",
                "raw_url": "https://github.com/apache/incubator-tez/raw/7b2a0e6f3427182e0c7d55f3da1c369500770ab0/tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java",
                "sha": "c415f8ae49dc22cdc3371e1604e0c0d5e081362b",
                "status": "modified"
            }
        ],
        "message": "TEZ-616. Addendum patch for OrderedWordCount with -generateSplitsInClient true throws NPE. (hitesh)",
        "parent": "https://github.com/apache/incubator-tez/commit/6ccebe747217adcef05a7137eb8844c11e8ae18c",
        "repo": "incubator-tez",
        "unit_tests": [
            "TestTezClientUtils.java"
        ]
    },
    "incubator-tez_8a3dcf4": {
        "bug_id": "incubator-tez_8a3dcf4",
        "commit": "https://github.com/apache/incubator-tez/commit/8a3dcf4763ad1eaefd0b6d08685a3ade91977324",
        "file": [
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/incubator-tez/blob/8a3dcf4763ad1eaefd0b6d08685a3ade91977324/tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java?ref=8a3dcf4763ad1eaefd0b6d08685a3ade91977324",
                "deletions": 3,
                "filename": "tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java",
                "patch": "@@ -364,9 +364,16 @@ static ApplicationSubmissionContext createApplicationSubmissionContext(\n     if(dag != null) {\n \n       for (Vertex v : dag.getVertices()) {\n+        if (v.getTaskLocalResources() == null) {\n+          v.setTaskLocalResources(new TreeMap<String, LocalResource>());\n+        }\n         v.getTaskLocalResources().putAll(tezJarResources);\n         v.getTaskLocalResources().put(TezConfiguration.TEZ_PB_BINARY_CONF_NAME,\n             binaryConfLRsrc);\n+\n+        if (v.getTaskEnvironment() == null) {\n+          v.setTaskEnvironment(new TreeMap<String, String>());\n+        }\n         Map<String, String> taskEnv = v.getTaskEnvironment();\n         for (Map.Entry<String, String> entry : environment.entrySet()) {\n           String key = entry.getKey();\n@@ -399,9 +406,9 @@ static ApplicationSubmissionContext createApplicationSubmissionContext(\n       }\n \n       localResources.put(TezConfiguration.TEZ_PB_PLAN_BINARY_NAME,\n-          TezClientUtils.createLocalResource(fs,\n-              binaryPath, LocalResourceType.FILE,\n-              LocalResourceVisibility.APPLICATION));\n+        TezClientUtils.createLocalResource(fs,\n+          binaryPath, LocalResourceType.FILE,\n+          LocalResourceVisibility.APPLICATION));\n \n       if (Level.DEBUG.isGreaterOrEqual(Level.toLevel(amLogLevel))) {\n         Path textPath = localizeDagPlanAsText(dagPB, fs,",
                "raw_url": "https://github.com/apache/incubator-tez/raw/8a3dcf4763ad1eaefd0b6d08685a3ade91977324/tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java",
                "sha": "042ff91885e232ddf6a15a2ee127a020b0c46823",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/incubator-tez/blob/8a3dcf4763ad1eaefd0b6d08685a3ade91977324/tez-dag/src/main/java/org/apache/tez/dag/app/rm/TaskScheduler.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-dag/src/main/java/org/apache/tez/dag/app/rm/TaskScheduler.java?ref=8a3dcf4763ad1eaefd0b6d08685a3ade91977324",
                "deletions": 1,
                "filename": "tez-dag/src/main/java/org/apache/tez/dag/app/rm/TaskScheduler.java",
                "patch": "@@ -670,7 +670,7 @@ public void onContainersAllocated(List<Container> containers) {\n             boolean safeToRelease = true;\n             Priority topPendingPriority = amRmClient.getTopPriority();\n             Priority containerPriority = heldContainer.container.getPriority();\n-            if (topPendingPriority != null && \n+            if (isNew && topPendingPriority != null &&\n                 containerPriority.compareTo(topPendingPriority) < 0) {\n               // this container is of lower priority and given to us by the RM for\n               // a task that will be matched after the current top priority. Keep ",
                "raw_url": "https://github.com/apache/incubator-tez/raw/8a3dcf4763ad1eaefd0b6d08685a3ade91977324/tez-dag/src/main/java/org/apache/tez/dag/app/rm/TaskScheduler.java",
                "sha": "6eedb15adab8267cc86ce5fd8cb42609a6ce8e0a",
                "status": "modified"
            }
        ],
        "message": "TEZ-615. OrderedWordCount with -DUSE_TEZ_SESSION=false throws NPE. (hitesh)",
        "parent": "https://github.com/apache/incubator-tez/commit/d4bb730eaa4b8b793b2c7f8b08e1faa50ed566e8",
        "repo": "incubator-tez",
        "unit_tests": [
            "TestTaskScheduler.java"
        ]
    }
}