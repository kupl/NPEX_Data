[
    {
        "repo": "tika",
        "commit": "https://github.com/apache/tika/commit/65aea2b06b33c6b53999b6c52e017c38bf2af0b4",
        "bug_id": "tika_65aea2b",
        "message": "- TIKA-1378: MicrosoftTranslator setClient and setId NPE (thanks to tpalsulich for the review!)\n\ngit-svn-id: https://svn.apache.org/repos/asf/tika/trunk@1614488 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tika/commit/ed355dd561963ab4eb6cc9423e4b86e4e817f26e",
        "patched_files": [
            "MicrosoftTranslator.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 10,
                "raw_url": "https://github.com/apache/tika/raw/65aea2b06b33c6b53999b6c52e017c38bf2af0b4/tika-translate/src/main/java/org/apache/tika/language/translate/MicrosoftTranslator.java",
                "contents_url": "https://api.github.com/repos/apache/tika/contents/tika-translate/src/main/java/org/apache/tika/language/translate/MicrosoftTranslator.java?ref=65aea2b06b33c6b53999b6c52e017c38bf2af0b4",
                "filename": "tika-translate/src/main/java/org/apache/tika/language/translate/MicrosoftTranslator.java",
                "deletions": 3,
                "sha": "85575debaeef2e5e65fcf8260229a0e016140ec9",
                "blob_url": "https://github.com/apache/tika/blob/65aea2b06b33c6b53999b6c52e017c38bf2af0b4/tika-translate/src/main/java/org/apache/tika/language/translate/MicrosoftTranslator.java",
                "patch": "@@ -56,7 +56,7 @@ public MicrosoftTranslator() {\n                 props.load(stream);\n                 clientId = props.getProperty(ID_PROPERTY);\n                 clientSecret = props.getProperty(SECRET_PROPERTY);\n-                if (!clientId.equals(DEFAULT_ID) && !clientSecret.equals(DEFAULT_SECRET)) available = true;\n+                this.available = checkAvailable();   \n             }\n         } catch (IOException e) {\n         \te.printStackTrace();\n@@ -119,7 +119,7 @@ public boolean isAvailable(){\n      */\n     public void setId(String id){\n     \tthis.clientId = id;\n-        if (!clientId.equals(DEFAULT_ID) && !clientSecret.equals(DEFAULT_SECRET)) available = true;\n+        this.available = checkAvailable();   \n     }\n     \n     /**\n@@ -128,6 +128,13 @@ public void setId(String id){\n      */\n     public void setSecret(String secret){\n     \tthis.clientSecret = secret;\n-        if (!clientId.equals(DEFAULT_ID) && !clientSecret.equals(DEFAULT_SECRET)) available = true;    \t\n+        this.available = checkAvailable();   \t\n+    }\n+    \n+    private boolean checkAvailable(){\n+       return clientId != null && \n+    \t\t   !clientId.equals(DEFAULT_ID) && \n+    \t\t   clientSecret != null && \n+    \t\t   !clientSecret.equals(DEFAULT_SECRET);\n     }\n }",
                "changes": 13
            },
            {
                "status": "modified",
                "additions": 29,
                "raw_url": "https://github.com/apache/tika/raw/65aea2b06b33c6b53999b6c52e017c38bf2af0b4/tika-translate/src/test/java/org/apache/tika/language/translate/MicrosoftTranslatorTest.java",
                "contents_url": "https://api.github.com/repos/apache/tika/contents/tika-translate/src/test/java/org/apache/tika/language/translate/MicrosoftTranslatorTest.java?ref=65aea2b06b33c6b53999b6c52e017c38bf2af0b4",
                "filename": "tika-translate/src/test/java/org/apache/tika/language/translate/MicrosoftTranslatorTest.java",
                "deletions": 8,
                "sha": "a35281d5131e1b6dba3dfc6c74a8660d1ea89b33",
                "blob_url": "https://github.com/apache/tika/blob/65aea2b06b33c6b53999b6c52e017c38bf2af0b4/tika-translate/src/test/java/org/apache/tika/language/translate/MicrosoftTranslatorTest.java",
                "patch": "@@ -21,35 +21,56 @@\n import org.junit.Test;\n \n import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n \n /**\n  * Test cases for the {@link MicrosoftTranslator} class.\n  */\n public class MicrosoftTranslatorTest {\n-    Tika tika;\n+    MicrosoftTranslator translator;\n     @Before\n     public void setUp() {\n-        tika = new Tika();\n+        translator = new MicrosoftTranslator();\n     }\n \n     @Test\n     public void testSimpleTranslate() throws Exception {\n         String source = \"hello\";\n         String expected = \"salut\";\n-        String translated = tika.translate(source, \"en\", \"fr\");\n-        System.err.println(tika.getTranslator().isAvailable());\n-        if (tika.getTranslator().isAvailable()) assertTrue(\"Translate \" + source + \" to \" + expected + \" (was \" + translated + \")\",\n+        String translated = translator.translate(source, \"en\", \"fr\");\n+        if (translator.isAvailable()) assertTrue(\"Translate \" + source + \" to \" + expected + \" (was \" + translated + \")\",\n                 expected.equalsIgnoreCase(translated));\n     }\n \n     @Test\n     public void testSimpleDetectTranslate() throws Exception {\n         String source = \"hello\";\n         String expected = \"salut\";\n-        String translated = tika.translate(source, \"fr\");\n-        System.err.println(tika.getTranslator().isAvailable());\n-        if (tika.getTranslator().isAvailable()) assertTrue(\"Translate \" + source + \" to \" + expected + \" (was \" + translated + \")\",\n+        String translated = translator.translate(source, \"fr\");\n+        if (translator.isAvailable()) assertTrue(\"Translate \" + source + \" to \" + expected + \" (was \" + translated + \")\",\n                 expected.equalsIgnoreCase(translated));\n     }\n+    \n+    @Test\n+    public void testSettersAndIsAvailable(){\n+    \ttry{\n+    \t\ttranslator.setId(\"foo\");\n+    \t\ttranslator.setSecret(\"bar\");\n+    \t}\n+    \tcatch(Exception e){\n+    \t\te.printStackTrace();\n+    \t\tfail(e.getMessage());\n+    \t}\n+    \t//reset\n+    \ttranslator = new MicrosoftTranslator();\n+    \ttry{\n+    \t\ttranslator.setSecret(\"bar\");\n+    \t\ttranslator.setId(\"foo\");\n+    \t}\n+    \tcatch(Exception e){\n+    \t\te.printStackTrace();\n+    \t\tfail(e.getMessage());\n+    \t}\n+    }\n \n }",
                "changes": 37
            }
        ],
        "unit_tests": [
            "MicrosoftTranslatorTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "tika-translate/src/test/java/org/apache/tika/language/translate/MicrosoftTranslatorTest.java",
        "buggy_files": [
            "tika-translate/src/main/java/org/apache/tika/language/translate/MicrosoftTranslator.java"
        ],
        "fixed": true
    }
]