{
    "ftpserver_0fe58af": {
        "bug_id": "ftpserver_0fe58af",
        "commit": "https://github.com/apache/ftpserver/commit/0fe58af78fc805b025f78b32eeeeba38b64a0d77",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/ftpserver/blob/0fe58af78fc805b025f78b32eeeeba38b64a0d77/core/src/main/java/org/apache/ftpserver/command/impl/SITE_DESCUSER.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/ftpserver/contents/core/src/main/java/org/apache/ftpserver/command/impl/SITE_DESCUSER.java?ref=0fe58af78fc805b025f78b32eeeeba38b64a0d77",
                "deletions": 1,
                "filename": "core/src/main/java/org/apache/ftpserver/command/impl/SITE_DESCUSER.java",
                "patch": "@@ -104,7 +104,7 @@ public void execute(final FtpIoSession session,\n         sb.append(\"homedirectory   : \").append(user.getHomeDirectory()).append(\n                 \"\\n\");\n         sb.append(\"writepermission : \").append(\n-                user.authorize(new WriteRequest())).append(\"\\n\");\n+                user.authorize(new WriteRequest()) != null).append(\"\\n\");\n         sb.append(\"enableflag      : \").append(user.getEnabled()).append(\"\\n\");\n         sb.append(\"idletime        : \").append(user.getMaxIdleTime()).append(\n                 \"\\n\");",
                "raw_url": "https://github.com/apache/ftpserver/raw/0fe58af78fc805b025f78b32eeeeba38b64a0d77/core/src/main/java/org/apache/ftpserver/command/impl/SITE_DESCUSER.java",
                "sha": "7bef7151a5ba48dc1ffc06f3b52ae75f501d7801",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/ftpserver/blob/0fe58af78fc805b025f78b32eeeeba38b64a0d77/core/src/main/java/org/apache/ftpserver/impl/DefaultFtpHandler.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/ftpserver/contents/core/src/main/java/org/apache/ftpserver/impl/DefaultFtpHandler.java?ref=0fe58af78fc805b025f78b32eeeeba38b64a0d77",
                "deletions": 0,
                "filename": "core/src/main/java/org/apache/ftpserver/impl/DefaultFtpHandler.java",
                "patch": "@@ -63,6 +63,8 @@ public void sessionCreated(final FtpIoSession session) throws Exception {\n     public void sessionOpened(final FtpIoSession session) throws Exception {\n         context.getFtpletContainer().onConnect(session.getFtpletSession());\n \n+        session.updateLastAccessTime();\n+        \n         session.write(LocalizedFtpReply.translate(session, null, context,\n                 FtpReply.REPLY_220_SERVICE_READY, null, null));\n     }\n@@ -114,6 +116,8 @@ private boolean isCommandOkWithoutAuthentication(String command) {\n     public void messageReceived(final FtpIoSession session,\n             final FtpRequest request) throws Exception {\n         try {\n+            session.updateLastAccessTime();\n+            \n             String commandName = request.getCommand();\n             CommandFactory commandFactory = context.getCommandFactory();\n             Command command = commandFactory.getCommand(commandName);",
                "raw_url": "https://github.com/apache/ftpserver/raw/0fe58af78fc805b025f78b32eeeeba38b64a0d77/core/src/main/java/org/apache/ftpserver/impl/DefaultFtpHandler.java",
                "sha": "44dabc3a00ab1d3f9bcd167da53058ae79df8c3f",
                "status": "modified"
            },
            {
                "additions": 76,
                "blob_url": "https://github.com/apache/ftpserver/blob/0fe58af78fc805b025f78b32eeeeba38b64a0d77/core/src/test/java/org/apache/ftpserver/clienttests/SiteTest.java",
                "changes": 76,
                "contents_url": "https://api.github.com/repos/apache/ftpserver/contents/core/src/test/java/org/apache/ftpserver/clienttests/SiteTest.java?ref=0fe58af78fc805b025f78b32eeeeba38b64a0d77",
                "deletions": 0,
                "filename": "core/src/test/java/org/apache/ftpserver/clienttests/SiteTest.java",
                "patch": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.ftpserver.clienttests;\n+\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import org.apache.commons.net.ftp.FTPReply;\n+\n+/**\n+*\n+* @author The Apache MINA Project (dev@mina.apache.org)\n+* @version $Rev$, $Date$\n+*\n+*/\n+public class SiteTest extends ClientTestTemplate {\n+\n+    public void testSiteDescUser() throws Exception {\n+        client.login(ADMIN_USERNAME, ADMIN_PASSWORD);\n+\n+        client.sendCommand(\"SITE DESCUSER admin\");\n+        String[] siteReplies = client.getReplyString().split(\"\\r\\n\");\n+\n+        assertEquals(\"200-\", siteReplies[0]);\n+        assertEquals(\"userid          : admin\", siteReplies[1]);\n+        assertEquals(\"userpassword    : ********\", siteReplies[2]);\n+        assertEquals(\"homedirectory   : ./test-tmp/ftproot\", siteReplies[3]);\n+        assertEquals(\"writepermission : true\", siteReplies[4]);\n+        assertEquals(\"enableflag      : true\", siteReplies[5]);\n+        assertEquals(\"idletime        : 0\", siteReplies[6]);\n+        assertEquals(\"uploadrate      : 0\", siteReplies[7]);\n+        assertEquals(\"200 downloadrate    : 0\", siteReplies[8]);\n+    }\n+\n+    public void testAnonNotAllowed() throws Exception {\n+        client.login(ANONYMOUS_USERNAME, ANONYMOUS_PASSWORD);\n+\n+        assertTrue(FTPReply.isNegativePermanent(client.sendCommand(\"SITE DESCUSER admin\")));\n+    }\n+\n+    public void testSiteWho() throws Exception {\n+        client.login(ADMIN_USERNAME, ADMIN_PASSWORD);\n+\n+        client.sendCommand(\"SITE WHO\");\n+        String[] siteReplies = client.getReplyString().split(\"\\r\\n\");\n+\n+        assertEquals(\"200-\", siteReplies[0]);\n+        \n+        String timestampPattern = \"\\\\d{4}-\\\\d{2}-\\\\d{2}T\\\\d{2}:\\\\d{2}:\\\\d{2}\";\n+        System.out.println(\">>\" + siteReplies[1] + \"<<\");\n+        \n+        String pattern = \"200 admin           127.0.0.1       \" + timestampPattern + \" \" + timestampPattern + \" \"; \n+        \n+        assertTrue(Pattern.matches(pattern, siteReplies[1]));\n+    }\n+\n+\n+    \n+}",
                "raw_url": "https://github.com/apache/ftpserver/raw/0fe58af78fc805b025f78b32eeeeba38b64a0d77/core/src/test/java/org/apache/ftpserver/clienttests/SiteTest.java",
                "sha": "0a1a5afb68a7fcebc6fc5c5f2e1034bd1a45f256",
                "status": "added"
            }
        ],
        "message": "Fix for SITE DESCUSER printing WriteRequest FQCN instead of true (FTPSERVER-257)\nFix for SITE WHO throwing NPE (FTPSERVER-256)\nAdded test for the above commands\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/ftpserver/trunk@732069 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/ftpserver/commit/29b02ca75c5c35a2cb511d5e1128019ca21455c0",
        "patched_files": [
            "SITE_DESCUSER.java",
            "DefaultFtpHandler.java"
        ],
        "repo": "ftpserver",
        "unit_tests": [
            "SiteTest.java"
        ]
    },
    "ftpserver_10df732": {
        "bug_id": "ftpserver_10df732",
        "commit": "https://github.com/apache/ftpserver/commit/10df73239d9ff8274dfe8f3fa59be14a49dad49f",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/ftpserver/blob/10df73239d9ff8274dfe8f3fa59be14a49dad49f/core/src/main/java/org/apache/ftpserver/impl/DefaultFtpServer.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/ftpserver/contents/core/src/main/java/org/apache/ftpserver/impl/DefaultFtpServer.java?ref=10df73239d9ff8274dfe8f3fa59be14a49dad49f",
                "deletions": 1,
                "filename": "core/src/main/java/org/apache/ftpserver/impl/DefaultFtpServer.java",
                "patch": "@@ -67,6 +67,10 @@ public DefaultFtpServer(final FtpServerContext serverContext) {\n      * @throws FtpException \n      */\n     public void start() throws FtpException {\n+        if (serverContext == null) {\n+            // we have already been stopped, can not be restarted\n+            throw new IllegalStateException(\"FtpServer has been stopped. Restart is not supported\");\n+        }\n \n         List<Listener> startedListeners = new ArrayList<Listener>();\n         \n@@ -99,7 +103,8 @@ public void start() throws FtpException {\n     }\n \n     /**\n-     * Stop the server. Stop the listener thread.\n+     * Stop the server. Stopping the server will close completely and \n+     * it not supported to restart using {@link #start()}.\n      */\n     public void stop() {\n         if (serverContext == null) {",
                "raw_url": "https://github.com/apache/ftpserver/raw/10df73239d9ff8274dfe8f3fa59be14a49dad49f/core/src/main/java/org/apache/ftpserver/impl/DefaultFtpServer.java",
                "sha": "680bd19a8471015094d9f525cab79ad6f6eed736",
                "status": "modified"
            }
        ],
        "message": "Fixing NPE thrown when restarting a stopped FtpServer and improving Javadoc for this (FTPSERVER-340)\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/ftpserver/trunk@882110 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/ftpserver/commit/8497b0b094d6caa110602b695055c965c567c537",
        "patched_files": [
            "DefaultFtpServer.java"
        ],
        "repo": "ftpserver",
        "unit_tests": [
            "DefaultFtpServerTest.java"
        ]
    },
    "ftpserver_43692fc": {
        "bug_id": "ftpserver_43692fc",
        "commit": "https://github.com/apache/ftpserver/commit/43692fc3904e1f05da3cfa93806cc241cab77661",
        "file": [
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/ftpserver/blob/43692fc3904e1f05da3cfa93806cc241cab77661/core/src/java/org/apache/ftpserver/command/PASS.java",
                "changes": 17,
                "contents_url": "https://api.github.com/repos/apache/ftpserver/contents/core/src/java/org/apache/ftpserver/command/PASS.java?ref=43692fc3904e1f05da3cfa93806cc241cab77661",
                "deletions": 7,
                "filename": "core/src/java/org/apache/ftpserver/command/PASS.java",
                "patch": "@@ -98,14 +98,17 @@ public void execute(Connection connection,\n             }\n             \n             // anonymous login limit check\n-            boolean anonymous = userName.equals(\"anonymous\");\n-            int currAnonLogin = stat.getCurrentAnonymousLoginNumber();\n-            int maxAnonLogin = conManager.getMaxAnonymousLogins();\n-            if( anonymous && (currAnonLogin >= maxAnonLogin) ) {\n-                out.write(FtpReplyUtil.translate(session, FtpReply.REPLY_421_SERVICE_NOT_AVAILABLE_CLOSING_CONTROL_CONNECTION, \"PASS.anonymous\", null));\n-                return;\n-            }\n             \n+            boolean anonymous = userName != null && userName.equals(\"anonymous\");\n+            if(anonymous) {\n+\t            int currAnonLogin = stat.getCurrentAnonymousLoginNumber();\n+\t            int maxAnonLogin = conManager.getMaxAnonymousLogins();\n+\t            if( currAnonLogin >= maxAnonLogin ) {\n+\t                out.write(FtpReplyUtil.translate(session, FtpReply.REPLY_421_SERVICE_NOT_AVAILABLE_CLOSING_CONTROL_CONNECTION, \"PASS.anonymous\", null));\n+\t                return;\n+\t            }\n+            }\n+\t            \n             // login limit check\n             int currLogin = stat.getCurrentLoginNumber();\n             int maxLogin = conManager.getMaxLogins();",
                "raw_url": "https://github.com/apache/ftpserver/raw/43692fc3904e1f05da3cfa93806cc241cab77661/core/src/java/org/apache/ftpserver/command/PASS.java",
                "sha": "6353365712645eeef4f553d052cb89cd33b40c1b",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/ftpserver/blob/43692fc3904e1f05da3cfa93806cc241cab77661/core/src/java/org/apache/ftpserver/util/ClassUtils.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/ftpserver/contents/core/src/java/org/apache/ftpserver/util/ClassUtils.java?ref=43692fc3904e1f05da3cfa93806cc241cab77661",
                "deletions": 2,
                "filename": "core/src/java/org/apache/ftpserver/util/ClassUtils.java",
                "patch": "@@ -76,9 +76,12 @@ private static void setProperty(Object target, PropertyDescriptor setter, Object\n                 throw new RuntimeException(\"Failed invoking setter \" + setter.getDisplayName() + \" on \" + target, e);\n             }\n         } else {\n-            throw new RuntimeException(\"Property \\\"\" + setter.getDisplayName() + \"\\\" is not settable on class \"+ target.getClass());\n+        \tif(setter != null) {\n+        \t\tthrow new RuntimeException(\"Property \\\"\" + setter.getDisplayName() + \"\\\" is not settable on class \"+ target.getClass());\n+        \t} else {\n+        \t\tthrow new RuntimeException(\"Property is not settable on class \"+ target.getClass());\n+        \t}\n         }\n-        \n     }\n     \n     private static void setProperty(Object target, PropertyDescriptor setter, String propertyValue) {",
                "raw_url": "https://github.com/apache/ftpserver/raw/43692fc3904e1f05da3cfa93806cc241cab77661/core/src/java/org/apache/ftpserver/util/ClassUtils.java",
                "sha": "6c0390ebb3dfdc45d0c61afc6a28c6e22447ad1c",
                "status": "modified"
            }
        ],
        "message": "Fixed potential NPEs\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/ftpserver/trunk@581383 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/ftpserver/commit/c1b8e1ff1036b154e7d1f033592292b57f8dc6d8",
        "patched_files": [
            "ClassUtils.java"
        ],
        "repo": "ftpserver",
        "unit_tests": [
            "ClassUtilsTest.java"
        ]
    },
    "ftpserver_81ac8af": {
        "bug_id": "ftpserver_81ac8af",
        "commit": "https://github.com/apache/ftpserver/commit/81ac8af8dde8197681884f644627a7f7b8c34971",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/ftpserver/blob/81ac8af8dde8197681884f644627a7f7b8c34971/core/src/main/java/org/apache/ftpserver/usermanager/BaseUser.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/ftpserver/contents/core/src/main/java/org/apache/ftpserver/usermanager/BaseUser.java?ref=81ac8af8dde8197681884f644627a7f7b8c34971",
                "deletions": 0,
                "filename": "core/src/main/java/org/apache/ftpserver/usermanager/BaseUser.java",
                "patch": "@@ -180,6 +180,11 @@ public String toString() {\n     public AuthorizationRequest authorize(AuthorizationRequest request) {\n         Authority[] authorities = getAuthorities();\n \n+        // check for no authorities at all\n+        if(authorities == null) {\n+            return null;\n+        }\n+        \n         boolean someoneCouldAuthorize = false;\n         for (int i = 0; i < authorities.length; i++) {\n             Authority authority = authorities[i];",
                "raw_url": "https://github.com/apache/ftpserver/raw/81ac8af8dde8197681884f644627a7f7b8c34971/core/src/main/java/org/apache/ftpserver/usermanager/BaseUser.java",
                "sha": "85d1293c8fa46cbe7b5321ca3070d8e6dca6d0f2",
                "status": "modified"
            }
        ],
        "message": "Added protection against NPE in the unlikely case that the user has no authorities\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/ftpserver/trunk@689490 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/ftpserver/commit/5c8579b25ebbab0af702e52dfdeb0c3cb3c8dce2",
        "patched_files": [
            "BaseUser.java"
        ],
        "repo": "ftpserver",
        "unit_tests": [
            "BaseUserTest.java"
        ]
    },
    "ftpserver_e934827": {
        "bug_id": "ftpserver_e934827",
        "commit": "https://github.com/apache/ftpserver/commit/e934827758f0019c2dd23c42da27673356125790",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/ftpserver/blob/e934827758f0019c2dd23c42da27673356125790/core/src/main/java/org/apache/ftpserver/usermanager/PropertiesUserManager.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/ftpserver/contents/core/src/main/java/org/apache/ftpserver/usermanager/PropertiesUserManager.java?ref=e934827758f0019c2dd23c42da27673356125790",
                "deletions": 1,
                "filename": "core/src/main/java/org/apache/ftpserver/usermanager/PropertiesUserManager.java",
                "patch": "@@ -224,7 +224,7 @@ public synchronized void save(User usr) throws FtpException {\n      * @throws FtpException\n      */\n     private void saveUserData() throws FtpException {\n-        File dir = userDataFile.getParentFile();\n+        File dir = userDataFile.getAbsoluteFile().getParentFile();\n         if(dir != null && !dir.exists() && !dir.mkdirs() ) {\n             String dirName = dir.getAbsolutePath();\n             throw new FtpServerConfigurationException(\"Cannot create directory for user data file : \" + dirName);",
                "raw_url": "https://github.com/apache/ftpserver/raw/e934827758f0019c2dd23c42da27673356125790/core/src/main/java/org/apache/ftpserver/usermanager/PropertiesUserManager.java",
                "sha": "2406c9a494b5f131baa6744f5b573a36ff8d12f6",
                "status": "modified"
            }
        ],
        "message": "Fix potential NPE in PropertiesUserManager (FTPSERVER-145)\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/ftpserver/trunk@683615 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/ftpserver/commit/a63073007ab5cd1c8e638b747b8693d01c5445b5",
        "patched_files": [
            "PropertiesUserManager.java"
        ],
        "repo": "ftpserver",
        "unit_tests": [
            "PropertiesUserManagerTest.java"
        ]
    }
}