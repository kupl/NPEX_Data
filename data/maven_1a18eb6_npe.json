[
    {
        "repo": "maven",
        "commit": "https://github.com/apache/maven/commit/1a18eb6c9c7ac24adc9d57781e85fb3f60b6b65f",
        "bug_id": "maven_1a18eb6",
        "message": "[MNG-6626] fix DefaultExceptionHandler NPE\n\nCloses #241",
        "parent": "https://github.com/apache/maven/commit/3ac9718f8267b2fb9636f1a58acc6bb53356c329",
        "patched_files": [
            "DefaultExceptionHandler.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 6,
                "raw_url": "https://github.com/apache/maven/raw/1a18eb6c9c7ac24adc9d57781e85fb3f60b6b65f/maven-core/src/main/java/org/apache/maven/exception/DefaultExceptionHandler.java",
                "contents_url": "https://api.github.com/repos/apache/maven/contents/maven-core/src/main/java/org/apache/maven/exception/DefaultExceptionHandler.java?ref=1a18eb6c9c7ac24adc9d57781e85fb3f60b6b65f",
                "filename": "maven-core/src/main/java/org/apache/maven/exception/DefaultExceptionHandler.java",
                "deletions": 3,
                "sha": "2193e61a35ed40c4fb0a79a7098832a586d4c39b",
                "blob_url": "https://github.com/apache/maven/blob/1a18eb6c9c7ac24adc9d57781e85fb3f60b6b65f/maven-core/src/main/java/org/apache/maven/exception/DefaultExceptionHandler.java",
                "patch": "@@ -209,10 +209,13 @@ else if ( exception instanceof PluginExecutionException )\n                 {\n                     Throwable cause2 = cause.getCause();\n \n-                    if ( cause2 instanceof NoClassDefFoundError\n-                        && cause2.getMessage().contains( \"org/sonatype/aether/\" ) )\n+                    if ( cause2 instanceof NoClassDefFoundError )\n                     {\n-                        reference = \"AetherClassNotFound\";\n+                        String message = cause2.getMessage();\n+                        if ( message != null && message.contains( \"org/sonatype/aether/\" ) )\n+                        {\n+                            reference = \"AetherClassNotFound\";\n+                        }\n                     }\n                 }\n ",
                "changes": 9
            },
            {
                "status": "modified",
                "additions": 49,
                "raw_url": "https://github.com/apache/maven/raw/1a18eb6c9c7ac24adc9d57781e85fb3f60b6b65f/maven-core/src/test/java/org/apache/maven/exception/DefaultExceptionHandlerTest.java",
                "contents_url": "https://api.github.com/repos/apache/maven/contents/maven-core/src/test/java/org/apache/maven/exception/DefaultExceptionHandlerTest.java?ref=1a18eb6c9c7ac24adc9d57781e85fb3f60b6b65f",
                "filename": "maven-core/src/test/java/org/apache/maven/exception/DefaultExceptionHandlerTest.java",
                "deletions": 4,
                "sha": "9fe6d4f30fd380b3f43f5b176bde37151b90f0ab",
                "blob_url": "https://github.com/apache/maven/blob/1a18eb6c9c7ac24adc9d57781e85fb3f60b6b65f/maven-core/src/test/java/org/apache/maven/exception/DefaultExceptionHandlerTest.java",
                "patch": "@@ -22,15 +22,22 @@\n import java.io.IOException;\n import java.net.ConnectException;\n \n+import org.apache.maven.model.Plugin;\n+import org.apache.maven.plugin.MojoExecution;\n import org.apache.maven.plugin.MojoExecutionException;\n \n-import junit.framework.TestCase;\n+import org.apache.maven.plugin.PluginContainerException;\n+import org.apache.maven.plugin.PluginExecutionException;\n+import org.apache.maven.plugin.descriptor.MojoDescriptor;\n+import org.apache.maven.plugin.descriptor.PluginDescriptor;\n+import org.junit.Test;\n+\n+import static org.junit.Assert.assertEquals;\n \n /**\n  * @author <a href=\"mailto:baerrach@apache.org\">Barrie Treloar</a>\n  */\n public class DefaultExceptionHandlerTest\n-    extends TestCase\n {\n     /**\n      * Running Maven under JDK7 may cause connection issues because IPv6 is used by default.\n@@ -42,11 +49,11 @@\n      * http://cwiki.apache.org/confluence/display/MAVEN/ConnectException\n      * </p>\n      */\n+    @Test\n     public void testJdk7ipv6()\n     {\n         ConnectException connEx = new ConnectException( \"Connection refused: connect\" );\n-        IOException ioEx = new IOException( \"Unable to establish loopback connection\" );\n-        ioEx.initCause( connEx );\n+        IOException ioEx = new IOException( \"Unable to establish loopback connection\", connEx );\n         MojoExecutionException mojoEx =\n             new MojoExecutionException( \"Error executing Jetty: Unable to establish loopback connection\", ioEx );\n \n@@ -57,4 +64,42 @@ public void testJdk7ipv6()\n         assertEquals( expectedReference, exceptionSummary.getReference() );\n \n     }\n+\n+    @Test\n+    public void testHandleExceptionAetherClassNotFound()\n+    {\n+        Throwable cause2 = new NoClassDefFoundError( \"org/sonatype/aether/RepositorySystem\" );\n+        Plugin plugin = new Plugin();\n+        Exception cause = new PluginContainerException( plugin, null, null, cause2 );\n+        PluginDescriptor pluginDescriptor = new PluginDescriptor();\n+        MojoDescriptor mojoDescriptor = new MojoDescriptor();\n+        mojoDescriptor.setPluginDescriptor( pluginDescriptor );\n+        MojoExecution mojoExecution = new MojoExecution(mojoDescriptor);\n+        Throwable exception = new PluginExecutionException( mojoExecution, null, cause );\n+\n+        DefaultExceptionHandler handler = new DefaultExceptionHandler();\n+        ExceptionSummary summary = handler.handleException( exception );\n+\n+        String expectedReference = \"http://cwiki.apache.org/confluence/display/MAVEN/AetherClassNotFound\";\n+        assertEquals( expectedReference, summary.getReference() );\n+    }\n+\n+    @Test\n+    public void testHandleExceptionNoClassDefFoundErrorNull()\n+    {\n+        Throwable cause2 = new NoClassDefFoundError();\n+        Plugin plugin = new Plugin();\n+        Exception cause = new PluginContainerException( plugin, null, null, cause2 );\n+        PluginDescriptor pluginDescriptor = new PluginDescriptor();\n+        MojoDescriptor mojoDescriptor = new MojoDescriptor();\n+        mojoDescriptor.setPluginDescriptor( pluginDescriptor );\n+        MojoExecution mojoExecution = new MojoExecution(mojoDescriptor);\n+        Throwable exception = new PluginExecutionException( mojoExecution, null, cause );\n+\n+        DefaultExceptionHandler handler = new DefaultExceptionHandler();\n+        ExceptionSummary summary = handler.handleException( exception );\n+\n+        String expectedReference = \"http://cwiki.apache.org/confluence/display/MAVEN/PluginContainerException\";\n+        assertEquals( expectedReference, summary.getReference() );\n+    }\n }",
                "changes": 53
            }
        ],
        "unit_tests": [
            "DefaultExceptionHandlerTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "maven-core/src/test/java/org/apache/maven/exception/DefaultExceptionHandlerTest.java",
        "buggy_files": [
            "maven-core/src/main/java/org/apache/maven/exception/DefaultExceptionHandler.java"
        ],
        "fixed": true
    }
]