{
    "brooklyn-server_025077e": {
        "bug_id": "brooklyn-server_025077e",
        "commit": "https://github.com/apache/brooklyn-server/commit/025077ed601067335272512fd819a2237f9773cb",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/025077ed601067335272512fd819a2237f9773cb/usage/launcher/src/main/java/brooklyn/launcher/BrooklynWebServer.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/usage/launcher/src/main/java/brooklyn/launcher/BrooklynWebServer.java?ref=025077ed601067335272512fd819a2237f9773cb",
                "deletions": 1,
                "filename": "usage/launcher/src/main/java/brooklyn/launcher/BrooklynWebServer.java",
                "patch": "@@ -453,7 +453,7 @@ private String checkFileExists(String path, String name) {\n     public synchronized void stop() throws Exception {\n         if (server==null) return;\n         String root = getRootUrl();\n-        Threads.removeShutdownHook(shutdownHook);\n+        if (shutdownHook != null) Threads.removeShutdownHook(shutdownHook);\n         if (log.isDebugEnabled())\n             log.debug(\"Stopping Brooklyn web console at \"+root+ \" (\" + war + (wars != null ? \" and \" + wars.values() : \"\") + \")\");\n ",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/025077ed601067335272512fd819a2237f9773cb/usage/launcher/src/main/java/brooklyn/launcher/BrooklynWebServer.java",
                "sha": "f4bfacb07265dfe35012c6d0388ef873e0e5315e",
                "status": "modified"
            }
        ],
        "message": "Avoid NPE in BrooklynWebServer.stop",
        "parent": "https://github.com/apache/brooklyn-server/commit/58c0392d7d1a9d1fac21c4892b3a77125269b940",
        "repo": "brooklyn-server",
        "unit_tests": [
            "BrooklynWebServerTest.java"
        ]
    },
    "brooklyn-server_1754fe3": {
        "bug_id": "brooklyn-server_1754fe3",
        "commit": "https://github.com/apache/brooklyn-server/commit/1754fe33c85d0e1dd351281c4e83e8eb4277f9f0",
        "file": [
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/1754fe33c85d0e1dd351281c4e83e8eb4277f9f0/core/src/main/java/brooklyn/location/basic/FixedListMachineProvisioningLocation.java",
                "changes": 25,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/location/basic/FixedListMachineProvisioningLocation.java?ref=1754fe33c85d0e1dd351281c4e83e8eb4277f9f0",
                "deletions": 6,
                "filename": "core/src/main/java/brooklyn/location/basic/FixedListMachineProvisioningLocation.java",
                "patch": "@@ -28,13 +28,17 @@\n import java.util.Map;\n import java.util.Set;\n \n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n import brooklyn.location.Location;\n import brooklyn.location.LocationSpec;\n import brooklyn.location.MachineLocation;\n import brooklyn.location.MachineProvisioningLocation;\n import brooklyn.location.NoMachinesAvailableException;\n import brooklyn.management.LocationManager;\n import brooklyn.util.collections.MutableMap;\n+import brooklyn.util.collections.MutableSet;\n import brooklyn.util.flags.SetFromFlag;\n import brooklyn.util.stream.Streams;\n import brooklyn.util.text.WildcardGlobs;\n@@ -63,6 +67,8 @@\n     // and getMachines() returns the real sets risking \n     // ConcurrentModificationException in the caller if it iterates over them etc.\n     \n+    private static final Logger log = LoggerFactory.getLogger(FixedListMachineProvisioningLocation.class);\n+    \n     private final Object lock = new Object();\n     \n     @SetFromFlag\n@@ -89,14 +95,21 @@ public FixedListMachineProvisioningLocation(Map properties) {\n     public void init() {\n         super.init();\n         \n-        for (MachineLocation location: machines) {\n-            // FIXME Bad casting\n-            Location machine = (Location) location;\n-            Location parent = machine.getParent();\n-            if (parent == null) {\n-                addChild(machine);\n+        Set<T> machinesCopy = MutableSet.of();\n+        for (T location: machines) {\n+            if (location==null) {\n+                log.warn(\"\"+this+\" initialized with null location, removing (may be due to rebind with reference to an unmanaged location)\");\n+            } else {\n+                Location parent = location.getParent();\n+                if (parent == null) {\n+                    addChild(location);\n+                }\n+                machinesCopy.add(location);\n             }\n         }\n+        if (!machinesCopy.equals(machines)) {\n+            machines = machinesCopy;\n+        }\n     }\n     \n     @Override",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/1754fe33c85d0e1dd351281c4e83e8eb4277f9f0/core/src/main/java/brooklyn/location/basic/FixedListMachineProvisioningLocation.java",
                "sha": "595ab8a7285a03872d2e5ba275240ba6d11e5f75",
                "status": "modified"
            }
        ],
        "message": "avoid NPE on rebind when locations have been unmanaged",
        "parent": "https://github.com/apache/brooklyn-server/commit/a18ae6f129c8d2615c896121325d35a67008316f",
        "repo": "brooklyn-server",
        "unit_tests": [
            "FixedListMachineProvisioningLocationTest.java"
        ]
    },
    "brooklyn-server_1903230": {
        "bug_id": "brooklyn-server_1903230",
        "commit": "https://github.com/apache/brooklyn-server/commit/1903230dc242d42db12889284150f80660f6dd73",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/1903230dc242d42db12889284150f80660f6dd73/core/src/main/java/brooklyn/config/ConfigUtils.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/config/ConfigUtils.java?ref=1903230dc242d42db12889284150f80660f6dd73",
                "deletions": 5,
                "filename": "core/src/main/java/brooklyn/config/ConfigUtils.java",
                "patch": "@@ -92,19 +92,19 @@ public static BrooklynProperties filterForPrefixAndStrip(Map<String,?> propertie\n     @SuppressWarnings(\"rawtypes\")\n     public static Set<HasConfigKey<?>> getStaticKeysOnClass(Class<?> type) {\n         Set<HasConfigKey<?>> result = new LinkedHashSet<ConfigKey.HasConfigKey<?>>();\n-        try {\n-            for (Field f: type.getFields()) {\n+        for (Field f: type.getFields()) {\n+            try {\n                 if ((f.getModifiers() & Modifier.STATIC)==0)\n                     continue;\n                 if (ConfigKey.class.isAssignableFrom(f.getType()))\n                     result.add(new WrappedConfigKey((ConfigKey<?>) f.get(null)));\n                 else if (HasConfigKey.class.isAssignableFrom(f.getType()))\n                     result.add((HasConfigKey<?>) f.get(null));\n+            } catch (Exception e) {\n+                log.error(\"Error retrieving config key for field \"+f+\" on class \"+type+\"; rethrowing\", e);\n+                throw Exceptions.propagate(e);\n             }\n-        } catch (Exception e) {\n-            throw Exceptions.propagate(e);\n         }\n         return Collections.unmodifiableSet(result);\n     }\n-\n }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/1903230dc242d42db12889284150f80660f6dd73/core/src/main/java/brooklyn/config/ConfigUtils.java",
                "sha": "08a1963a6674263072102842296a80a1b35e3cdc",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/1903230dc242d42db12889284150f80660f6dd73/core/src/main/java/brooklyn/entity/basic/Attributes.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/entity/basic/Attributes.java?ref=1903230dc242d42db12889284150f80660f6dd73",
                "deletions": 1,
                "filename": "core/src/main/java/brooklyn/entity/basic/Attributes.java",
                "patch": "@@ -28,7 +28,7 @@\n     /**\n      * Application information sensors.\n      * \n-     * @deprecated since 0.5; see {@link ConfigKeys#SUGGESTED_VERSION}\n+     * @deprecated since 0.5; see {@link BrooklynConfigKeys#SUGGESTED_VERSION}\n      */\n     @Deprecated\n     AttributeSensor<String> VERSION = Sensors.newStringSensor( \"version\", \"Version information\");",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/1903230dc242d42db12889284150f80660f6dd73/core/src/main/java/brooklyn/entity/basic/Attributes.java",
                "sha": "6af95be92773598e35274f57ae13a63d05a65c51",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/1903230dc242d42db12889284150f80660f6dd73/core/src/main/java/brooklyn/entity/basic/ConfigKeys.java",
                "changes": 40,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/entity/basic/ConfigKeys.java?ref=1903230dc242d42db12889284150f80660f6dd73",
                "deletions": 40,
                "filename": "core/src/main/java/brooklyn/entity/basic/ConfigKeys.java",
                "patch": "@@ -136,44 +136,4 @@\n     public static ConfigKey<Boolean> newBooleanConfigKey(String name, String description, Boolean defaultValue) {\n         return newConfigKey(Boolean.class, name, description, defaultValue);\n     }\n-\n-    /* Key definitions were deprecated here in 0.6.0 because they introduce nasty circular dependencies on the\n-     * methods in this class, causing some final fields to be null when they are accessed. \n-     */\n-\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> BROOKLYN_DATA_DIR = BrooklynConfigKeys.BROOKLYN_DATA_DIR;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SUGGESTED_VERSION = BrooklynConfigKeys.SUGGESTED_VERSION;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SUGGESTED_INSTALL_DIR = BrooklynConfigKeys.SUGGESTED_INSTALL_DIR;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SUGGESTED_RUN_DIR = BrooklynConfigKeys.SUGGESTED_RUN_DIR;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<Boolean> START_LATCH = BrooklynConfigKeys.START_LATCH;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<Boolean> INSTALL_LATCH = BrooklynConfigKeys.INSTALL_LATCH;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<Boolean> CUSTOMIZE_LATCH = BrooklynConfigKeys.CUSTOMIZE_LATCH;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<Boolean> LAUNCH_LATCH = BrooklynConfigKeys.LAUNCH_LATCH;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<Integer> START_TIMEOUT = BrooklynConfigKeys.START_TIMEOUT;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SSH_TOOL_CLASS = BrooklynConfigKeys.SSH_TOOL_CLASS;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SSH_CONFIG_HOST = BrooklynConfigKeys.SSH_CONFIG_HOST;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<Integer> SSH_CONFIG_PORT = BrooklynConfigKeys.SSH_CONFIG_PORT;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SSH_CONFIG_USER = BrooklynConfigKeys.SSH_CONFIG_USER;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SSH_CONFIG_PASSWORD = BrooklynConfigKeys.SSH_CONFIG_PASSWORD;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SSH_CONFIG_SCRIPT_DIR = BrooklynConfigKeys.SSH_CONFIG_SCRIPT_DIR;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SSH_CONFIG_SCRIPT_HEADER = BrooklynConfigKeys.SSH_CONFIG_SCRIPT_HEADER;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SSH_CONFIG_DIRECT_HEADER = BrooklynConfigKeys.SSH_CONFIG_DIRECT_HEADER;\n-\n }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/1903230dc242d42db12889284150f80660f6dd73/core/src/main/java/brooklyn/entity/basic/ConfigKeys.java",
                "sha": "f4a27a7a4921369b651e823e92de197bffa63c64",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/1903230dc242d42db12889284150f80660f6dd73/core/src/main/java/brooklyn/entity/drivers/downloads/DownloadSubstituters.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/entity/drivers/downloads/DownloadSubstituters.java?ref=1903230dc242d42db12889284150f80660f6dd73",
                "deletions": 3,
                "filename": "core/src/main/java/brooklyn/entity/drivers/downloads/DownloadSubstituters.java",
                "patch": "@@ -13,7 +13,7 @@\n \n import brooklyn.entity.Entity;\n import brooklyn.entity.basic.Attributes;\n-import brooklyn.entity.basic.ConfigKeys;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.entity.drivers.EntityDriver;\n import brooklyn.entity.drivers.downloads.DownloadResolverManager.DownloadRequirement;\n import brooklyn.entity.drivers.downloads.DownloadResolverManager.DownloadTargets;\n@@ -92,14 +92,14 @@ public static String substitute(DownloadRequirement req, String basevalue) {\n         Entity entity = driver.getEntity();\n         String type = entity.getEntityType().getName();\n         String simpleType = type.substring(type.lastIndexOf(\".\")+1);\n-        String version = entity.getConfig(ConfigKeys.SUGGESTED_VERSION);\n+        String version = entity.getConfig(BrooklynConfigKeys.SUGGESTED_VERSION);\n         \n         String v2 = entity.getAttribute(Attributes.VERSION);\n         if (v2!=null && !v2.equals(version)) {\n             // Attributes.VERSION was deprecated in 0.5.0 but was preferred here without warning in 0.6.0\n             // now warn on use of deprecated key when it is different\n             LOG.warn(\"Using deprecated key \"+Attributes.VERSION+\", value \"+v2+\", which differs from the \" +\n-            \t\t\"preferred key \"+ConfigKeys.SUGGESTED_VERSION+\", value \"+version+\"; old key will be retired shortly!\");\n+            \t\t\"preferred key \"+BrooklynConfigKeys.SUGGESTED_VERSION+\", value \"+version+\"; old key will be retired shortly!\");\n             version = v2;\n         }\n         ",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/1903230dc242d42db12889284150f80660f6dd73/core/src/main/java/brooklyn/entity/drivers/downloads/DownloadSubstituters.java",
                "sha": "40c20b919763cabf2551d035a31e69d6d8a09424",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/1903230dc242d42db12889284150f80660f6dd73/core/src/main/java/brooklyn/location/basic/ByonLocationResolver.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/location/basic/ByonLocationResolver.java?ref=1903230dc242d42db12889284150f80660f6dd73",
                "deletions": 2,
                "filename": "core/src/main/java/brooklyn/location/basic/ByonLocationResolver.java",
                "patch": "@@ -13,7 +13,7 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n-import brooklyn.entity.basic.ConfigKeys;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.location.LocationRegistry;\n import brooklyn.location.LocationResolver;\n import brooklyn.location.LocationSpec;\n@@ -135,7 +135,7 @@ public void init(ManagementContext managementContext) {\n         if (user != null) flags.put(\"user\", user);\n         if (name != null) flags.put(\"name\", name);\n         if (registry != null) {\n-            String brooklynDataDir = (String) registry.getProperties().get(ConfigKeys.BROOKLYN_DATA_DIR.getName());\n+            String brooklynDataDir = (String) registry.getProperties().get(BrooklynConfigKeys.BROOKLYN_DATA_DIR.getName());\n             if (brooklynDataDir != null && brooklynDataDir.length() > 0) {\n                 flags.put(\"localTempDir\", new File(brooklynDataDir));\n             }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/1903230dc242d42db12889284150f80660f6dd73/core/src/main/java/brooklyn/location/basic/ByonLocationResolver.java",
                "sha": "1b8df65dae914ddd952b818d255127373af6e718",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/1903230dc242d42db12889284150f80660f6dd73/core/src/main/java/brooklyn/location/basic/LocalhostResolver.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/location/basic/LocalhostResolver.java?ref=1903230dc242d42db12889284150f80660f6dd73",
                "deletions": 5,
                "filename": "core/src/main/java/brooklyn/location/basic/LocalhostResolver.java",
                "patch": "@@ -12,9 +12,7 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n-import brooklyn.config.ConfigKey;\n-import brooklyn.config.ConfigUtils;\n-import brooklyn.entity.basic.ConfigKeys;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.location.Location;\n import brooklyn.location.LocationRegistry;\n import brooklyn.location.LocationResolver;\n@@ -24,7 +22,6 @@\n import brooklyn.util.text.KeyValueParser;\n \n import com.google.common.collect.ImmutableSet;\n-import com.google.common.collect.Maps;\n import com.google.common.collect.Sets;\n \n /**\n@@ -96,7 +93,7 @@ protected Location newLocationFromString(String spec, brooklyn.location.Location\n             flags.put(\"name\", namePart);\n         }\n         if (registry != null) {\n-            String brooklynDataDir = (String) registry.getProperties().get(ConfigKeys.BROOKLYN_DATA_DIR.getName());\n+            String brooklynDataDir = (String) registry.getProperties().get(BrooklynConfigKeys.BROOKLYN_DATA_DIR.getName());\n             if (brooklynDataDir != null && brooklynDataDir.length() > 0) {\n                 flags.put(\"localTempDir\", new File(brooklynDataDir));\n             }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/1903230dc242d42db12889284150f80660f6dd73/core/src/main/java/brooklyn/location/basic/LocalhostResolver.java",
                "sha": "ebd0d7636ae686baa7aec6400bba64af49bb322b",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/1903230dc242d42db12889284150f80660f6dd73/core/src/test/java/brooklyn/entity/drivers/downloads/BasicDownloadsRegistryTest.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/test/java/brooklyn/entity/drivers/downloads/BasicDownloadsRegistryTest.java?ref=1903230dc242d42db12889284150f80660f6dd73",
                "deletions": 2,
                "filename": "core/src/test/java/brooklyn/entity/drivers/downloads/BasicDownloadsRegistryTest.java",
                "patch": "@@ -10,7 +10,7 @@\n import brooklyn.config.BrooklynProperties;\n import brooklyn.entity.basic.ApplicationBuilder;\n import brooklyn.entity.basic.Attributes;\n-import brooklyn.entity.basic.ConfigKeys;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.entity.basic.Entities;\n import brooklyn.entity.proxying.EntitySpec;\n import brooklyn.location.Location;\n@@ -89,7 +89,7 @@ public void testReturnsLocalRepoThenOverrideThenAttributeValThenCloudsoftUrlThen\n         brooklynProperties.put(\"brooklyn.downloads.all.url\", \"http://fromprops/${version}.allprimary\");\n         brooklynProperties.put(\"brooklyn.downloads.all.fallbackurl\", \"http://fromfallback/${version}.allfallback\");\n         entity.setAttribute(Attributes.DOWNLOAD_URL, \"http://fromattrib/${version}.default\");\n-        entity.setConfig(ConfigKeys.SUGGESTED_VERSION, \"myversion\");\n+        entity.setConfig(BrooklynConfigKeys.SUGGESTED_VERSION, \"myversion\");\n         String expectedFilename = \"myversion.allprimary\";\n \n         String expectedLocalRepo = String.format(\"file://$HOME/.brooklyn/repository/%s/%s/%s\", \"TestEntity\", \"myversion\", expectedFilename);",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/1903230dc242d42db12889284150f80660f6dd73/core/src/test/java/brooklyn/entity/drivers/downloads/BasicDownloadsRegistryTest.java",
                "sha": "e4d13d8fe85a0da239ea512ca9d6ca3f4b460bb2",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/1903230dc242d42db12889284150f80660f6dd73/core/src/test/java/brooklyn/entity/drivers/downloads/DownloadProducerFromPropertiesTest.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/test/java/brooklyn/entity/drivers/downloads/DownloadProducerFromPropertiesTest.java?ref=1903230dc242d42db12889284150f80660f6dd73",
                "deletions": 4,
                "filename": "core/src/test/java/brooklyn/entity/drivers/downloads/DownloadProducerFromPropertiesTest.java",
                "patch": "@@ -10,7 +10,7 @@\n \n import brooklyn.config.BrooklynProperties;\n import brooklyn.entity.basic.ApplicationBuilder;\n-import brooklyn.entity.basic.ConfigKeys;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.entity.basic.Entities;\n import brooklyn.entity.drivers.downloads.DownloadResolverManager.DownloadRequirement;\n import brooklyn.entity.drivers.downloads.DownloadResolverManager.DownloadTargets;\n@@ -79,7 +79,7 @@ public void testReturnsGlobalFallbackUrl() throws Exception {\n     @Test\n     public void testSubstitutionsAppliedToFallbackUrl() throws Exception {\n         brooklynProperties.put(\"brooklyn.downloads.all.fallbackurl\", \"version=${version}\");\n-        entity.setConfig(ConfigKeys.SUGGESTED_VERSION, \"myversion\");\n+        entity.setConfig(BrooklynConfigKeys.SUGGESTED_VERSION, \"myversion\");\n         assertResolves(ImmutableList.<String>of(), ImmutableList.of(\"version=myversion\"));\n     }\n \n@@ -93,15 +93,15 @@ public void testReturnsGlobalFallbackUrlAsLast() throws Exception {\n     @Test\n     public void testReturnsGlobalUrlWithEntitySubstituions() throws Exception {\n         brooklynProperties.put(\"brooklyn.downloads.all.url\", \"version=${version}\");\n-        entity.setConfig(ConfigKeys.SUGGESTED_VERSION, \"myversion\");\n+        entity.setConfig(BrooklynConfigKeys.SUGGESTED_VERSION, \"myversion\");\n         assertResolves(\"version=myversion\");\n     }\n     \n     @Test\n     public void testEntitySpecificUrlOverridesGlobalUrl() throws Exception {\n         brooklynProperties.put(\"brooklyn.downloads.all.url\", \"version=${version}\");\n         brooklynProperties.put(\"brooklyn.downloads.entity.TestEntity.url\", \"overridden,version=${version}\");\n-        entity.setConfig(ConfigKeys.SUGGESTED_VERSION, \"myversion\");\n+        entity.setConfig(BrooklynConfigKeys.SUGGESTED_VERSION, \"myversion\");\n         assertResolves(\"overridden,version=myversion\", \"version=myversion\");\n     }\n     ",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/1903230dc242d42db12889284150f80660f6dd73/core/src/test/java/brooklyn/entity/drivers/downloads/DownloadProducerFromPropertiesTest.java",
                "sha": "f169bee621189aa2186d80cd49946c45e34503ce",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/1903230dc242d42db12889284150f80660f6dd73/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsByonLocationResolver.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsByonLocationResolver.java?ref=1903230dc242d42db12889284150f80660f6dd73",
                "deletions": 2,
                "filename": "locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsByonLocationResolver.java",
                "patch": "@@ -12,7 +12,7 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n-import brooklyn.entity.basic.ConfigKeys;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.location.LocationRegistry;\n import brooklyn.location.LocationResolver;\n import brooklyn.location.LocationSpec;\n@@ -147,7 +147,7 @@ public void init(ManagementContext managementContext) {\n         if (user != null) flags.put(\"user\", user);\n         if (name != null) flags.put(\"name\", name);\n         if (registry != null) {\n-            String brooklynDataDir = (String) registry.getProperties().get(ConfigKeys.BROOKLYN_DATA_DIR.getName());\n+            String brooklynDataDir = (String) registry.getProperties().get(BrooklynConfigKeys.BROOKLYN_DATA_DIR.getName());\n             if (brooklynDataDir != null && brooklynDataDir.length() > 0) {\n                 flags.put(\"localTempDir\", new File(brooklynDataDir));\n             }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/1903230dc242d42db12889284150f80660f6dd73/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsByonLocationResolver.java",
                "sha": "e9ac5b600cbd96274ed6a9a4f27a727e4874b6b4",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/1903230dc242d42db12889284150f80660f6dd73/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsPropertiesFromBrooklynProperties.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsPropertiesFromBrooklynProperties.java?ref=1903230dc242d42db12889284150f80660f6dd73",
                "deletions": 2,
                "filename": "locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsPropertiesFromBrooklynProperties.java",
                "patch": "@@ -7,7 +7,7 @@\n import org.slf4j.LoggerFactory;\n \n import brooklyn.config.ConfigUtils;\n-import brooklyn.entity.basic.ConfigKeys;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.location.basic.DeprecatedKeysMappingBuilder;\n import brooklyn.location.basic.LocationPropertiesFromBrooklynProperties;\n \n@@ -74,7 +74,7 @@\n         jcloudsProperties.putAll(transformDeprecated(getProviderOrApiJcloudsProperties(providerOrApi, properties)));\n         jcloudsProperties.putAll(transformDeprecated(getRegionJcloudsProperties(providerOrApi, regionName, properties)));\n         if (!Strings.isNullOrEmpty(namedLocation)) jcloudsProperties.putAll(transformDeprecated(getNamedJcloudsProperties(namedLocation, properties)));\n-        String brooklynDataDir = (String) properties.get(ConfigKeys.BROOKLYN_DATA_DIR.getName());\n+        String brooklynDataDir = (String) properties.get(BrooklynConfigKeys.BROOKLYN_DATA_DIR.getName());\n         if (brooklynDataDir != null && brooklynDataDir.length() > 0) {\n             jcloudsProperties.put(\"localTempDir\", new File(brooklynDataDir));\n         }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/1903230dc242d42db12889284150f80660f6dd73/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsPropertiesFromBrooklynProperties.java",
                "sha": "a3cef2ce3ffe8ec88bb3be62b4c8c370cbaa21ab",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/1903230dc242d42db12889284150f80660f6dd73/software/base/src/main/java/brooklyn/entity/basic/AbstractSoftwareProcessDriver.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/software/base/src/main/java/brooklyn/entity/basic/AbstractSoftwareProcessDriver.java?ref=1903230dc242d42db12889284150f80660f6dd73",
                "deletions": 5,
                "filename": "software/base/src/main/java/brooklyn/entity/basic/AbstractSoftwareProcessDriver.java",
                "patch": "@@ -56,17 +56,17 @@ public void rebind() {\n \t@Override\n \tpublic void start() {\n \t    DynamicTasks.queue(\"install\", new Runnable() { public void run() {\n-            waitForConfigKey(ConfigKeys.INSTALL_LATCH);\n+            waitForConfigKey(BrooklynConfigKeys.INSTALL_LATCH);\n             install();\n         }});\n         \n \t    DynamicTasks.queue(\"customize\", new Runnable() { public void run() {\n-            waitForConfigKey(ConfigKeys.CUSTOMIZE_LATCH);\n+            waitForConfigKey(BrooklynConfigKeys.CUSTOMIZE_LATCH);\n             customize();\n         }});\n         \n \t    DynamicTasks.queue(\"launch\", new Runnable() { public void run() {\n-            waitForConfigKey(ConfigKeys.LAUNCH_LATCH);\n+            waitForConfigKey(BrooklynConfigKeys.LAUNCH_LATCH);\n             launch();\n         }});\n         \n@@ -113,9 +113,11 @@ public void restart() {\n         }});\n \t}\n \t\n-\tpublic EntityLocal getEntity() { return entity; } \n+\t@Override\n+    public EntityLocal getEntity() { return entity; } \n \n-\tpublic Location getLocation() { return location; } \n+\t@Override\n+    public Location getLocation() { return location; } \n     \n     public InputStream getResource(String url) {\n         return new ResourceUtils(entity).getResourceFromUrl(url);",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/1903230dc242d42db12889284150f80660f6dd73/software/base/src/main/java/brooklyn/entity/basic/AbstractSoftwareProcessDriver.java",
                "sha": "1adc1ee0948935095c2056ec67f77797f7c71083",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/1903230dc242d42db12889284150f80660f6dd73/software/base/src/main/java/brooklyn/entity/brooklynnode/BrooklynNode.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/software/base/src/main/java/brooklyn/entity/brooklynnode/BrooklynNode.java?ref=1903230dc242d42db12889284150f80660f6dd73",
                "deletions": 1,
                "filename": "software/base/src/main/java/brooklyn/entity/brooklynnode/BrooklynNode.java",
                "patch": "@@ -5,6 +5,7 @@\n import java.util.Map;\n \n import brooklyn.config.ConfigKey;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.entity.basic.ConfigKeys;\n import brooklyn.entity.basic.SoftwareProcess;\n import brooklyn.entity.java.UsesJava;\n@@ -31,7 +32,7 @@\n             Map.class, \"brooklynnode.copytorundir\", \"URLs of resources to be copied across to the server, giving the path they are to be copied to\", MutableMap.of());\n     \n     @SetFromFlag(\"version\")\n-    public static final ConfigKey<String> SUGGESTED_VERSION = ConfigKeys.newConfigKeyWithDefault(ConfigKeys.SUGGESTED_VERSION, \"0.6.0-SNAPSHOT\"); // BROOKLYN_VERSION\n+    public static final ConfigKey<String> SUGGESTED_VERSION = ConfigKeys.newConfigKeyWithDefault(BrooklynConfigKeys.SUGGESTED_VERSION, \"0.6.0-SNAPSHOT\"); // BROOKLYN_VERSION\n \n     // Takes presidence over downloadUrl, if non-null\n     @SetFromFlag(\"distroUploadUrl\")",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/1903230dc242d42db12889284150f80660f6dd73/software/base/src/main/java/brooklyn/entity/brooklynnode/BrooklynNode.java",
                "sha": "b41bcad9694a57a5a38b1fe0917255d6bf0684bb",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/1903230dc242d42db12889284150f80660f6dd73/software/base/src/test/java/brooklyn/entity/basic/lifecycle/StartStopSshDriverTest.groovy",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/software/base/src/test/java/brooklyn/entity/basic/lifecycle/StartStopSshDriverTest.groovy?ref=1903230dc242d42db12889284150f80660f6dd73",
                "deletions": 5,
                "filename": "software/base/src/test/java/brooklyn/entity/basic/lifecycle/StartStopSshDriverTest.groovy",
                "patch": "@@ -12,8 +12,7 @@ import org.testng.annotations.BeforeMethod\n import org.testng.annotations.Test\n \n import brooklyn.entity.basic.AbstractSoftwareProcessSshDriver\n-import brooklyn.entity.basic.ConfigKeys\n-import brooklyn.entity.basic.Entities;\n+import brooklyn.entity.basic.BrooklynConfigKeys\n import brooklyn.location.basic.SshMachineLocation\n import brooklyn.test.entity.TestApplication\n import brooklyn.test.entity.TestApplicationImpl\n@@ -22,7 +21,7 @@ import brooklyn.test.entity.TestEntityImpl\n import brooklyn.util.internal.ssh.SshTool\n import brooklyn.util.internal.ssh.cli.SshCliTool\n import brooklyn.util.internal.ssh.sshj.SshjTool\n-import brooklyn.util.stream.StreamGobbler;\n+import brooklyn.util.stream.StreamGobbler\n \n class StartStopSshDriverTest {\n \n@@ -69,7 +68,7 @@ class StartStopSshDriverTest {\n \n     @Test(groups = [ \"Integration\" ])\n     public void testSshScriptHeaderUsedWhenSpecified() {\n-        entity.setConfig(ConfigKeys.SSH_CONFIG_SCRIPT_HEADER, \"#!/bin/bash -e\\necho hello world\");\n+        entity.setConfig(BrooklynConfigKeys.SSH_CONFIG_SCRIPT_HEADER, \"#!/bin/bash -e\\necho hello world\");\n         ByteArrayOutputStream out = new ByteArrayOutputStream();\n         driver.execute(out: out, Arrays.asList(\"echo goodbye\"), \"test\");\n         String s = out.toString();\n@@ -81,7 +80,7 @@ class StartStopSshDriverTest {\n \n     @Test(groups = [ \"Integration\" ])\n     public void testSshCliPickedUpWhenSpecified() {\n-        entity.setConfig(ConfigKeys.SSH_TOOL_CLASS, SshCliTool.class.getName());\n+        entity.setConfig(BrooklynConfigKeys.SSH_TOOL_CLASS, SshCliTool.class.getName());\n         driver.execute(Arrays.asList(\"echo hi\"), \"test\");\n         assertTrue(sshMachineLocation.lastTool instanceof SshCliTool, \"expect CLI tool, got \"+\n                         (sshMachineLocation.lastTool!=null ? \"\"+sshMachineLocation.lastTool.getClass()+\":\" : \"\") + sshMachineLocation.lastTool);",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/1903230dc242d42db12889284150f80660f6dd73/software/base/src/test/java/brooklyn/entity/basic/lifecycle/StartStopSshDriverTest.groovy",
                "sha": "84fdd44175812bd176981070400146c8c0830db6",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/1903230dc242d42db12889284150f80660f6dd73/usage/launcher/src/main/java/brooklyn/launcher/BrooklynWebServer.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/usage/launcher/src/main/java/brooklyn/launcher/BrooklynWebServer.java?ref=1903230dc242d42db12889284150f80660f6dd73",
                "deletions": 2,
                "filename": "usage/launcher/src/main/java/brooklyn/launcher/BrooklynWebServer.java",
                "patch": "@@ -30,7 +30,7 @@\n import brooklyn.BrooklynVersion;\n import brooklyn.config.BrooklynServiceAttributes;\n import brooklyn.config.ConfigKey;\n-import brooklyn.entity.basic.ConfigKeys;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.launcher.config.CustomResourceLocator;\n import brooklyn.location.PortRange;\n import brooklyn.location.basic.LocalhostMachineProvisioningLocation;\n@@ -147,7 +147,7 @@ public BrooklynWebServer(Map flags, ManagementContext managementContext) {\n         if (!leftovers.isEmpty())\n             log.warn(\"Ignoring unknown flags \" + leftovers);\n         \n-        String brooklynDataDir = checkNotNull(managementContext.getConfig().getConfig(ConfigKeys.BROOKLYN_DATA_DIR));\n+        String brooklynDataDir = checkNotNull(managementContext.getConfig().getConfig(BrooklynConfigKeys.BROOKLYN_DATA_DIR));\n         this.webappTempDir = new File(brooklynDataDir, \"jetty\");\n     }\n ",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/1903230dc242d42db12889284150f80660f6dd73/usage/launcher/src/main/java/brooklyn/launcher/BrooklynWebServer.java",
                "sha": "12d43ef9ba9ae8b384bb3130d0319a0057c4f865",
                "status": "modified"
            }
        ],
        "message": "Merge pull request #930 from aledsage/fix/NPE-from-ConfigKeys-fields-strike2\n\nFix: NPE from ConfigKeys fields",
        "parent": "https://github.com/apache/brooklyn-server/commit/8e130a5ea93a08b1b37d9695cd2f27af9bbafd7f",
        "repo": "brooklyn-server",
        "unit_tests": [
            "BrooklynWebServerTest.java"
        ]
    },
    "brooklyn-server_2531091": {
        "bug_id": "brooklyn-server_2531091",
        "commit": "https://github.com/apache/brooklyn-server/commit/25310914dd9a6a90c878c367caf38249e155bd1c",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/25310914dd9a6a90c878c367caf38249e155bd1c/extra/src/main/java/brooklyn/policy/loadbalancing/DefaultBalanceablePoolModel.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/extra/src/main/java/brooklyn/policy/loadbalancing/DefaultBalanceablePoolModel.java?ref=25310914dd9a6a90c878c367caf38249e155bd1c",
                "deletions": 2,
                "filename": "extra/src/main/java/brooklyn/policy/loadbalancing/DefaultBalanceablePoolModel.java",
                "patch": "@@ -156,8 +156,10 @@ public void onContainerAdded(ContainerType newContainer, double lowThreshold, do\n     @Override\n     public void onContainerRemoved(ContainerType oldContainer) {\n         containers.remove(oldContainer);\n-        poolLowThreshold -= containerToLowThreshold.remove(oldContainer);\n-        poolHighThreshold -= containerToHighThreshold.remove(oldContainer);\n+        Double containerLowThreshold = containerToLowThreshold.remove(oldContainer);\n+        Double containerHighThresold = containerToHighThreshold.remove(oldContainer);\n+        poolLowThreshold -= (containerLowThreshold != null ? containerLowThreshold : 0);\n+        poolHighThreshold -= (containerHighThresold != null ? containerHighThresold : 0);\n         \n         // TODO: assert no orphaned items\n     }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/25310914dd9a6a90c878c367caf38249e155bd1c/extra/src/main/java/brooklyn/policy/loadbalancing/DefaultBalanceablePoolModel.java",
                "sha": "589683c81882049847bc481aeaea75e64d7359dc",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/25310914dd9a6a90c878c367caf38249e155bd1c/extra/src/main/java/brooklyn/policy/loadbalancing/LoadBalancingPolicy.groovy",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/extra/src/main/java/brooklyn/policy/loadbalancing/LoadBalancingPolicy.groovy?ref=25310914dd9a6a90c878c367caf38249e155bd1c",
                "deletions": 0,
                "filename": "extra/src/main/java/brooklyn/policy/loadbalancing/LoadBalancingPolicy.groovy",
                "patch": "@@ -181,6 +181,7 @@ public class LoadBalancingPolicy extends AbstractPolicy {\n         return null\n     }\n     \n+    // TODO Receiving duplicates of onContainerRemoved (e.g. when running LoadBalancingInmemorySoakTest)\n     private void onContainerRemoved(Entity oldContainer, boolean rebalanceNow) {\n         if (LOG.isTraceEnabled()) LOG.trace(\"{} recording removal of container {}\", this, oldContainer)\n         model.onContainerRemoved(oldContainer)",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/25310914dd9a6a90c878c367caf38249e155bd1c/extra/src/main/java/brooklyn/policy/loadbalancing/LoadBalancingPolicy.groovy",
                "sha": "78a5c6ecffd73a48d13859d66b72aa9b32659957",
                "status": "modified"
            }
        ],
        "message": "BalanceablePoolModel: avoid NPE if duplicate onContainerRemoved received",
        "parent": "https://github.com/apache/brooklyn-server/commit/7eeb411e6017208146a0a3c2027c5037d4ea7d46",
        "repo": "brooklyn-server",
        "unit_tests": [
            "LoadBalancingPolicyTest.java"
        ]
    },
    "brooklyn-server_28acb75": {
        "bug_id": "brooklyn-server_28acb75",
        "commit": "https://github.com/apache/brooklyn-server/commit/28acb753c869b98ca1a71c09d978a1d211531f69",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/28acb753c869b98ca1a71c09d978a1d211531f69/core/src/main/java/brooklyn/location/basic/AbstractLocation.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/location/basic/AbstractLocation.java?ref=28acb753c869b98ca1a71c09d978a1d211531f69",
                "deletions": 1,
                "filename": "core/src/main/java/brooklyn/location/basic/AbstractLocation.java",
                "patch": "@@ -167,7 +167,7 @@ public void setManagementContext(ManagementContextInternal managementContext) {\n         Location oldParent = parent.get();\n         Set<Location> oldChildren = children;\n         Map<String, Object> oldConfig = configBag.getAllConfig();\n-        long oldCreationTimeUtc = creationTimeUtc.get();\n+        Long oldCreationTimeUtc = creationTimeUtc.get();\n         String oldDisplayName = name.get();\n         HostGeoInfo oldHostGeoInfo = hostGeoInfo.get();\n         ",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/28acb753c869b98ca1a71c09d978a1d211531f69/core/src/main/java/brooklyn/location/basic/AbstractLocation.java",
                "sha": "808653f53ed4670023e6b36c80730ee4692696da",
                "status": "modified"
            }
        ],
        "message": "avoid NPE in AbstractLocation if creationTimeUtc null\n\n- happens if you unmanaged and then remanage an entity.\n- the old creationTimeUtc will have been deleted from storage so will\n  be null, so doing `long l = createTimeUtc.get()` NPEs",
        "parent": "https://github.com/apache/brooklyn-server/commit/e13d809383f534d2ce0323662bb2c62b5c4b94d2",
        "repo": "brooklyn-server",
        "unit_tests": [
            "AbstractLocationTest.java"
        ]
    },
    "brooklyn-server_28fc3cd": {
        "bug_id": "brooklyn-server_28fc3cd",
        "commit": "https://github.com/apache/brooklyn-server/commit/28fc3cd8bf031ec0c9d2efa93796cbe8b6e526b0",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/28fc3cd8bf031ec0c9d2efa93796cbe8b6e526b0/core/src/main/java/brooklyn/event/adapter/AbstractPollHelper.groovy",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/event/adapter/AbstractPollHelper.groovy?ref=28fc3cd8bf031ec0c9d2efa93796cbe8b6e526b0",
                "deletions": 1,
                "filename": "core/src/main/java/brooklyn/event/adapter/AbstractPollHelper.groovy",
                "patch": "@@ -18,7 +18,7 @@ public abstract class AbstractPollHelper {\n \n     final Map<AttributeSensor, Closure> polledSensors = [:]\n \n-    boolean lastWasSuccessful = false;\n+    boolean lastWasSuccessful = true;\n \n     AbstractSensorAdapter adapter;\n     public AbstractPollHelper(AbstractSensorAdapter adapter) {",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/28fc3cd8bf031ec0c9d2efa93796cbe8b6e526b0/core/src/main/java/brooklyn/event/adapter/AbstractPollHelper.groovy",
                "sha": "50c3d2a57e2cb8566b30623df2dddaf53ebfc606",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/28fc3cd8bf031ec0c9d2efa93796cbe8b6e526b0/core/src/main/java/brooklyn/event/adapter/JmxAttributeAdapter.groovy",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/event/adapter/JmxAttributeAdapter.groovy?ref=28fc3cd8bf031ec0c9d2efa93796cbe8b6e526b0",
                "deletions": 1,
                "filename": "core/src/main/java/brooklyn/event/adapter/JmxAttributeAdapter.groovy",
                "patch": "@@ -67,7 +67,9 @@ public class JmxAttributeAdapter extends AbstractSensorAdapter {\n         super.activateAdapter();\n         if (adapter.checkObjectNameExists(objectName)) {\n             if (log.isDebugEnabled()) \n-                log.debug(\"Initial value of $entity ${adapter.helper.url} JMX is: \"+adapter.helper.getAttribute(objectName, attributeName));\n+                log.debug(\"For $entity ${adapter.helper.url}, MBean ${objectName} exists\");\n+        } else {\n+            log.warn(\"For $entity ${adapter.helper.url}, MBean ${objectName} does not yet exist; continuing...\");\n         }\n     }\n }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/28fc3cd8bf031ec0c9d2efa93796cbe8b6e526b0/core/src/main/java/brooklyn/event/adapter/JmxAttributeAdapter.groovy",
                "sha": "d76be3d89288544b15a8948a14dd9d0ca0c8e2ec",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/28fc3cd8bf031ec0c9d2efa93796cbe8b6e526b0/core/src/main/java/brooklyn/event/adapter/JmxHelper.groovy",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/event/adapter/JmxHelper.groovy?ref=28fc3cd8bf031ec0c9d2efa93796cbe8b6e526b0",
                "deletions": 2,
                "filename": "core/src/main/java/brooklyn/event/adapter/JmxHelper.groovy",
                "patch": "@@ -159,14 +159,14 @@ public class JmxHelper {\n \n         triedConnecting = true\n         if (connector) connector.close()\n-        JMXServiceURL url = new JMXServiceURL(url)\n+        JMXServiceURL serviceUrl = new JMXServiceURL(url)\n         Map env = [:]\n         if (user && password) {\n             String[] creds = [user, password]\n             env.put(JMXConnector.CREDENTIALS, creds);\n         }\n         try {\n-            connector = JMXConnectorFactory.connect(url, env);\n+            connector = JMXConnectorFactory.connect(serviceUrl, env);\n         } catch (NullPointerException npe) {\n             //some software -- eg WSO2 -- will throw an NPE exception if the JMX connection can't be created, instead of an IOException.\n             //this is a break of contract with the JMXConnectorFactory.connect method, so this code verifies if the NPE is",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/28fc3cd8bf031ec0c9d2efa93796cbe8b6e526b0/core/src/main/java/brooklyn/event/adapter/JmxHelper.groovy",
                "sha": "a3e21d3f756233c2599bf40cc0c9dda8a111c914",
                "status": "modified"
            }
        ],
        "message": "Fix JMX adapter for when ActiveMQ throwns NPE\n\nActiveMQ sometimes throws NPE in MBeanServer during startup,\nbut when retrying then the problem goes away it seems.\n\nThese changes make the JmxSensorAdapter code more robust to this\nkind of error.",
        "parent": "https://github.com/apache/brooklyn-server/commit/0f3ea547b4f6b9f2c5f124e358d66c612615e2cb",
        "repo": "brooklyn-server",
        "unit_tests": [
            "JmxHelperTest.java"
        ]
    },
    "brooklyn-server_2dadb24": {
        "bug_id": "brooklyn-server_2dadb24",
        "commit": "https://github.com/apache/brooklyn-server/commit/2dadb24b9b8e458d4dc1ebe4429d070913036679",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/2dadb24b9b8e458d4dc1ebe4429d070913036679/core/src/main/java/org/apache/brooklyn/core/mgmt/persist/XmlMementoSerializer.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/org/apache/brooklyn/core/mgmt/persist/XmlMementoSerializer.java?ref=2dadb24b9b8e458d4dc1ebe4429d070913036679",
                "deletions": 1,
                "filename": "core/src/main/java/org/apache/brooklyn/core/mgmt/persist/XmlMementoSerializer.java",
                "patch": "@@ -315,7 +315,10 @@ public void marshal(Object source, HierarchicalStreamWriter writer, MarshallingC\n             if (source == null) return;\n             if (((Task<?>)source).isDone() && !((Task<?>)source).isError()) {\n                 try {\n-                    context.convertAnother(((Task<?>)source).get());\n+                    Object nextItem = ((Task<?>)source).get();\n+                    if (nextItem != null) {\n+                        context.convertAnother(nextItem);\n+                    }\n                 } catch (InterruptedException e) {\n                     throw Exceptions.propagate(e);\n                 } catch (ExecutionException e) {",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/2dadb24b9b8e458d4dc1ebe4429d070913036679/core/src/main/java/org/apache/brooklyn/core/mgmt/persist/XmlMementoSerializer.java",
                "sha": "e9085dc52d51cc6b962ac1e36a7fb23a861163dc",
                "status": "modified"
            }
        ],
        "message": "Task serializer: avoid NPE if task result is null",
        "parent": "https://github.com/apache/brooklyn-server/commit/f0b1bf8cb832f4c000f3c9a7c43327ec5aabd82f",
        "repo": "brooklyn-server",
        "unit_tests": [
            "XmlMementoSerializerTest.java"
        ]
    },
    "brooklyn-server_30292c9": {
        "bug_id": "brooklyn-server_30292c9",
        "commit": "https://github.com/apache/brooklyn-server/commit/30292c967b3368b2b58d2b00de965ab32ea456d6",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/30292c967b3368b2b58d2b00de965ab32ea456d6/rest/rest-resources/src/main/java/org/apache/brooklyn/rest/resources/CatalogResource.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/rest/rest-resources/src/main/java/org/apache/brooklyn/rest/resources/CatalogResource.java?ref=30292c967b3368b2b58d2b00de965ab32ea456d6",
                "deletions": 1,
                "filename": "rest/rest-resources/src/main/java/org/apache/brooklyn/rest/resources/CatalogResource.java",
                "patch": "@@ -171,7 +171,7 @@ public String getMessage() {\n         public static BundleInstallationRestResult of(OsgiBundleInstallationResult in, ManagementContext mgmt, BrooklynRestResourceUtils brooklynU, UriInfo ui) {\n             BundleInstallationRestResult result = new BundleInstallationRestResult();\n             result.message = in.getMessage();\n-            result.bundle = in.getMetadata().getVersionedName().toString();\n+            result.bundle = in.getVersionedName() != null ? in.getVersionedName().toString() : \"\";\n             result.code = in.getCode();\n             if (in.getCatalogItemsInstalled()!=null) {\n                 result.types = MutableMap.of();",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/30292c967b3368b2b58d2b00de965ab32ea456d6/rest/rest-resources/src/main/java/org/apache/brooklyn/rest/resources/CatalogResource.java",
                "sha": "2d7487d481152cdb8c8946b7390df09452520a3f",
                "status": "modified"
            }
        ],
        "message": "Closes #719\n\nCheck versionedName to avoid NPE.\n\nFixes break from https://github.com/apache/brooklyn-server/pull/672,\nI merged without re-running unit tests :-(",
        "parent": "https://github.com/apache/brooklyn-server/commit/57b9d7270ba87486f311020bf62b37105d4ca0e4",
        "repo": "brooklyn-server",
        "unit_tests": [
            "CatalogResourceTest.java"
        ]
    },
    "brooklyn-server_33df067": {
        "bug_id": "brooklyn-server_33df067",
        "commit": "https://github.com/apache/brooklyn-server/commit/33df0677c32650d668c0b4a41f03df106a9462ef",
        "file": [
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/33df0677c32650d668c0b4a41f03df106a9462ef/locations/jclouds/src/main/java/org/apache/brooklyn/location/jclouds/JcloudsLocation.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/locations/jclouds/src/main/java/org/apache/brooklyn/location/jclouds/JcloudsLocation.java?ref=33df0677c32650d668c0b4a41f03df106a9462ef",
                "deletions": 2,
                "filename": "locations/jclouds/src/main/java/org/apache/brooklyn/location/jclouds/JcloudsLocation.java",
                "patch": "@@ -2515,8 +2515,16 @@ protected LoginCredentials waitForSshable(final ComputeService computeService, f\n         LoginCredentials nodeCreds = node.getCredentials();\n         String nodeUser = nodeCreds.getUser();\n         String loginUserOverride = setup.get(LOGIN_USER);\n-        Set<String> users = MutableSet.<String>builder().add(nodeUser).add(loginUserOverride).build();\n-        \n+        Set<String> users = MutableSet.of();\n+\n+        if (Strings.isNonBlank(nodeUser)) {\n+            users.add(nodeUser);\n+        }\n+\n+        if (Strings.isNonBlank(loginUserOverride)) {\n+            users.add(loginUserOverride);\n+        }\n+\n         // See https://issues.apache.org/jira/browse/BROOKLYN-186\n         // Handle where jclouds gives us the wrong login user (!) and both a password + ssh key.\n         // Try all the permutations to find the one that works.",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/33df0677c32650d668c0b4a41f03df106a9462ef/locations/jclouds/src/main/java/org/apache/brooklyn/location/jclouds/JcloudsLocation.java",
                "sha": "4c3297d92f9808e0f59390afd7955ff0afb81055",
                "status": "modified"
            }
        ],
        "message": "Fix NPE if loginUser is not present and useJcloudsSshInit is false",
        "parent": "https://github.com/apache/brooklyn-server/commit/998ee50761efe238785c3dceca0f780abc22af16",
        "repo": "brooklyn-server",
        "unit_tests": [
            "JcloudsLocationTest.java"
        ]
    },
    "brooklyn-server_3788c2d": {
        "bug_id": "brooklyn-server_3788c2d",
        "commit": "https://github.com/apache/brooklyn-server/commit/3788c2decd5ce7cce7ea48af6efb01ced435f317",
        "file": [
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/3788c2decd5ce7cce7ea48af6efb01ced435f317/software/base/src/main/java/brooklyn/entity/software/MachineLifecycleEffectorTasks.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/software/base/src/main/java/brooklyn/entity/software/MachineLifecycleEffectorTasks.java?ref=3788c2decd5ce7cce7ea48af6efb01ced435f317",
                "deletions": 1,
                "filename": "software/base/src/main/java/brooklyn/entity/software/MachineLifecycleEffectorTasks.java",
                "patch": "@@ -152,12 +152,18 @@ public void attachLifecycleEffectors(Entity entity) {\n         return new EffectorBody<Void>() {\n             @Override\n             public Void call(ConfigBag parameters) {\n+                Collection<? extends Location> locations  = null;\n+\n                 Object locationsRaw = parameters.getStringKey(LOCATIONS.getName());\n-                Collection<? extends Location> locations = Locations.coerceToCollection(entity().getManagementContext(), locationsRaw);\n+                if (locationsRaw != null) {\n+                    locations = Locations.coerceToCollection(entity().getManagementContext(), locationsRaw);\n+                }\n+\n                 if (locations==null) {\n                     // null/empty will mean to inherit from parent\n                     locations = Collections.emptyList();\n                 }\n+\n                 start(locations);\n                 return null;\n             }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/3788c2decd5ce7cce7ea48af6efb01ced435f317/software/base/src/main/java/brooklyn/entity/software/MachineLifecycleEffectorTasks.java",
                "sha": "8381e99ceb54bac71e9f0c64dfa563d6461f1ee9",
                "status": "modified"
            }
        ],
        "message": "Fix NPE on creating entities with no explicit location",
        "parent": "https://github.com/apache/brooklyn-server/commit/62a32e9cae4c924f3460772e80e0e148ada21682",
        "repo": "brooklyn-server",
        "unit_tests": [
            "MachineLifecycleEffectorTasksTest.java"
        ]
    },
    "brooklyn-server_3a477f9": {
        "bug_id": "brooklyn-server_3a477f9",
        "commit": "https://github.com/apache/brooklyn-server/commit/3a477f9db657fb7c89704ef2e4913e3ce3927c2b",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/3a477f9db657fb7c89704ef2e4913e3ce3927c2b/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java?ref=3a477f9db657fb7c89704ef2e4913e3ce3927c2b",
                "deletions": 3,
                "filename": "locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "patch": "@@ -1135,7 +1135,8 @@ protected SshMachineLocation createTemporarySshMachineLocation(HostAndPort hostA\n      * Create the user immediately - executing ssh commands as required.\n      */\n     protected LoginCredentials createUser(ComputeService computeService, NodeMetadata node, Optional<HostAndPort> hostAndPortOverride, ConfigBag config) {\n-        UserCreation userCreation = createUserStatements(computeService.getImage(node.getImageId()), config);\n+        Image image = (node.getImageId() != null) ? computeService.getImage(node.getImageId()) : null;\n+        UserCreation userCreation = createUserStatements(image, config);\n         \n         if (!userCreation.statements.isEmpty()) {\n             org.jclouds.compute.domain.OsFamily osFamily = node.getOperatingSystem().getFamily();\n@@ -1260,15 +1261,15 @@ public UserCreation(LoginCredentials creds, List<Statement> statements) {\n      * @param config Configuration for creating the VM\n      * @return       The commands required to create the user, along with the expected login credentials.\n      */\n-    protected UserCreation createUserStatements(Image image, ConfigBag config) {\n+    protected UserCreation createUserStatements(@Nullable Image image, ConfigBag config) {\n         //NB: we ignore private key here because, by default we probably should not be installing it remotely;\n         //also, it may not be valid for first login (it is created before login e.g. on amazon, so valid there;\n         //but not elsewhere, e.g. on rackspace).\n         \n         LoginCredentials loginCreds = null;\n         String user = getUser(config);\n         String explicitLoginUser = config.get(LOGIN_USER);\n-        String loginUser = groovyTruth(explicitLoginUser) ? explicitLoginUser : (image.getDefaultCredentials() != null) ? image.getDefaultCredentials().identity : null;\n+        String loginUser = groovyTruth(explicitLoginUser) ? explicitLoginUser : (image != null && image.getDefaultCredentials() != null) ? image.getDefaultCredentials().identity : null;\n         Boolean dontCreateUser = config.get(DONT_CREATE_USER);\n         Boolean grantUserSudo = config.get(GRANT_USER_SUDO);\n         String publicKeyData = LocationConfigUtils.getPublicKeyData(config);",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/3a477f9db657fb7c89704ef2e4913e3ce3927c2b/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "sha": "da5f5dd953b27ade3950c2cce01f1fc35ce7fa13",
                "status": "modified"
            }
        ],
        "message": "JcloudsLocation: avoid NPE if node.getImageId null",
        "parent": "https://github.com/apache/brooklyn-server/commit/e0c405a85f068451003f9634141f31229e9fdafe",
        "repo": "brooklyn-server",
        "unit_tests": [
            "JcloudsLocationTest.java"
        ]
    },
    "brooklyn-server_46bf6b5": {
        "bug_id": "brooklyn-server_46bf6b5",
        "commit": "https://github.com/apache/brooklyn-server/commit/46bf6b54365a0bdb0f80580a95a815a6ee85b8b8",
        "file": [
            {
                "additions": 16,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/46bf6b54365a0bdb0f80580a95a815a6ee85b8b8/core/src/main/java/org/apache/brooklyn/location/ssh/SshMachineLocation.java",
                "changes": 26,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/org/apache/brooklyn/location/ssh/SshMachineLocation.java?ref=46bf6b54365a0bdb0f80580a95a815a6ee85b8b8",
                "deletions": 10,
                "filename": "core/src/main/java/org/apache/brooklyn/location/ssh/SshMachineLocation.java",
                "patch": "@@ -457,10 +457,13 @@ protected void addSshPoolCacheCleanupTask() {\n                     .displayName(\"ssh-location cache cleaner\").body(new Callable<Void>() {\n                     @Override public Void call() {\n                         try {\n-                            if (sshPoolCacheOrNull != null) sshPoolCacheOrNull.cleanUp();\n+                            LoadingCache<Map<String, ?>, Pool<SshTool>> sshPoolCacheOrNullRef = sshPoolCacheOrNull;\n+                            Task<?> cleanupTaskRef = cleanupTask;\n+                            \n+                            if (sshPoolCacheOrNullRef != null) sshPoolCacheOrNullRef.cleanUp();\n                             if (!SshMachineLocation.this.isManaged()) {\n-                                if (sshPoolCacheOrNull != null) sshPoolCacheOrNull.invalidateAll();\n-                                cleanupTask.cancel(false);\n+                                if (sshPoolCacheOrNullRef != null) sshPoolCacheOrNullRef.invalidateAll();\n+                                if (cleanupTaskRef != null) cleanupTaskRef.cancel(false);\n                                 sshPoolCacheOrNull = null;\n                             }\n                             return null;\n@@ -486,17 +489,20 @@ protected void addSshPoolCacheCleanupTask() {\n     // we should probably expose a mechanism such as that in Entity (or re-use Entity for locations!)\n     @Override\n     public void close() throws IOException {\n-        if (sshPoolCacheOrNull != null) {\n+        LoadingCache<Map<String, ?>, Pool<SshTool>> sshPoolCacheOrNullRef = sshPoolCacheOrNull;\n+        Task<?> cleanupTaskRef = cleanupTask;\n+        \n+        if (sshPoolCacheOrNullRef != null) {\n             if (LOG.isDebugEnabled()) {\n-                LOG.debug(\"{} invalidating all entries in ssh pool cache. Final stats: {}\", this, sshPoolCacheOrNull.stats());\n+                LOG.debug(\"{} invalidating all entries in ssh pool cache. Final stats: {}\", this, sshPoolCacheOrNullRef.stats());\n             }\n-            sshPoolCacheOrNull.invalidateAll();\n+            sshPoolCacheOrNullRef.invalidateAll();\n         }\n-        if (cleanupTask != null) {\n-            cleanupTask.cancel(false);\n-            cleanupTask = null;\n-            sshPoolCacheOrNull = null;\n+        if (cleanupTaskRef != null) {\n+            cleanupTaskRef.cancel(false);\n         }\n+        cleanupTask = null;\n+        sshPoolCacheOrNull = null;\n     }\n \n     // should not be necessary, and causes objects to be kept around a lot longer than desired",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/46bf6b54365a0bdb0f80580a95a815a6ee85b8b8/core/src/main/java/org/apache/brooklyn/location/ssh/SshMachineLocation.java",
                "sha": "2ff94914f38d314264269c0d5a4d1cad99f842fb",
                "status": "modified"
            }
        ],
        "message": "BROOKLYN-225: avoid NPE in SshMachineLocation cleanup",
        "parent": "https://github.com/apache/brooklyn-server/commit/495b1d335ab01d832978e01956b81a34434f24af",
        "repo": "brooklyn-server",
        "unit_tests": [
            "SshMachineLocationTest.java"
        ]
    },
    "brooklyn-server_675dec1": {
        "bug_id": "brooklyn-server_675dec1",
        "commit": "https://github.com/apache/brooklyn-server/commit/675dec10cf017fb55eaec40702b7cecfe041f666",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/675dec10cf017fb55eaec40702b7cecfe041f666/core/src/main/java/brooklyn/location/basic/Locations.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/location/basic/Locations.java?ref=675dec10cf017fb55eaec40702b7cecfe041f666",
                "deletions": 0,
                "filename": "core/src/main/java/brooklyn/location/basic/Locations.java",
                "patch": "@@ -111,6 +111,8 @@ public static void manage(Location loc, ManagementContext managementContext) {\n     }\n \n     public static Location coerce(ManagementContext mgmt, Object rawO) {\n+        if (rawO==null)\n+            return null;\n         if (rawO instanceof Location)\n             return (Location)rawO;\n         ",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/675dec10cf017fb55eaec40702b7cecfe041f666/core/src/main/java/brooklyn/location/basic/Locations.java",
                "sha": "09cef7cc98c74098f0eca6dc1996852c70611805",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/675dec10cf017fb55eaec40702b7cecfe041f666/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java?ref=675dec10cf017fb55eaec40702b7cecfe041f666",
                "deletions": 0,
                "filename": "locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "patch": "@@ -888,6 +888,9 @@ public void apply(TemplateOptions t, ConfigBag props, Object v) {\n                         if (t instanceof EC2TemplateOptions) {\n                             if (v==null) return;\n                             ((EC2TemplateOptions)t).userData(v.toString().getBytes());\n+                            // TODO avail in next jclouds thanks to @andreaturli\n+//                          } else if (t instanceof SoftLayerTemplateOptions) {\n+//                              ((SoftLayerTemplateOptions)t).userData(Strings.toString(v));\n                         } else {\n                             LOG.info(\"ignoring userDataString({}) in VM creation because not supported for cloud/type ({})\", v, t.getClass());\n                         }\n@@ -897,6 +900,9 @@ public void apply(TemplateOptions t, ConfigBag props, Object v) {\n                         if (t instanceof EC2TemplateOptions) {\n                             byte[] bytes = toByteArray(v);\n                             ((EC2TemplateOptions)t).userData(bytes);\n+                          // TODO avail in next jclouds thanks to @andreaturli\n+//                        } else if (t instanceof SoftLayerTemplateOptions) {\n+//                            ((SoftLayerTemplateOptions)t).userData(Strings.toString(v));\n                         } else {\n                             LOG.info(\"ignoring userData({}) in VM creation because not supported for cloud/type ({})\", v, t.getClass());\n                         }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/675dec10cf017fb55eaec40702b7cecfe041f666/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "sha": "c58d9bebed5fc9fabd560f36285b2345c863506b",
                "status": "modified"
            }
        ],
        "message": "don't cause NPE inside location list coercions (alt fix for recent fix for NPE from where this is invoked in MachineLifecycleTasks), and some notes on jclouds location for softlayer",
        "parent": "https://github.com/apache/brooklyn-server/commit/ffc86359bf0689cc10785c3ed25c3d80885e38c8",
        "repo": "brooklyn-server",
        "unit_tests": [
            "JcloudsLocationTest.java"
        ]
    },
    "brooklyn-server_67f5a0d": {
        "bug_id": "brooklyn-server_67f5a0d",
        "commit": "https://github.com/apache/brooklyn-server/commit/67f5a0d1ea84e47785d4b22056730da1a5f82047",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/67f5a0d1ea84e47785d4b22056730da1a5f82047/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java?ref=67f5a0d1ea84e47785d4b22056730da1a5f82047",
                "deletions": 4,
                "filename": "locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "patch": "@@ -401,10 +401,12 @@ public JcloudsSshMachineLocation obtain(Map<?,?> flags) throws NoMachinesAvailab\n             if (!(waitForSshable!=null && \"false\".equalsIgnoreCase(waitForSshable))) {\n                String setupScript = setup.get(JcloudsLocationConfig.CUSTOM_MACHINE_SETUP_SCRIPT_URL);\n                 if(Strings.isNonBlank(setupScript)) {\n-                   String setupVarsString = setup.get(JcloudsLocationConfig.CUSTOM_MACHINE_SETUP_SCRIPT_VARS);\n-                   Map<String, String> substitutions = Splitter.on(\",\").withKeyValueSeparator(\":\").split(setupVarsString);\n-                   String script = TemplateProcessor.processTemplate(setupScript, substitutions);\n-                   sshMachineLocation.execCommands(\"Customizing node \" + this, ImmutableList.of(script));\n+                    String setupVarsString = setup.get(JcloudsLocationConfig.CUSTOM_MACHINE_SETUP_SCRIPT_VARS);\n+                    Map<String, String> substitutions = (setupVarsString != null)\n+                            ? Splitter.on(\",\").withKeyValueSeparator(\":\").split(setupVarsString)\n+                            : Maps.<String, String>newHashMap();\n+                    String script = TemplateProcessor.processTemplate(setupScript, substitutions);\n+                    sshMachineLocation.execCommands(\"Customizing node \" + this, ImmutableList.of(script));\n                 }\n                 \n                 if (setup.get(JcloudsLocationConfig.MAP_DEV_RANDOM_TO_DEV_URANDOM))",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/67f5a0d1ea84e47785d4b22056730da1a5f82047/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "sha": "ff6c596759fc01bbc473d4339e7509ec337d8b7b",
                "status": "modified"
            }
        ],
        "message": "JcloudsLocation: No NPE if setup.script is given but not setup.script.vars",
        "parent": "https://github.com/apache/brooklyn-server/commit/47352d9c7d3ef7356610a508d96c1e6eccfe1b36",
        "repo": "brooklyn-server",
        "unit_tests": [
            "JcloudsLocationTest.java"
        ]
    },
    "brooklyn-server_6a5d519": {
        "bug_id": "brooklyn-server_6a5d519",
        "commit": "https://github.com/apache/brooklyn-server/commit/6a5d519e2d203d611a4a5be966bf42777cbd44b0",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/6a5d519e2d203d611a4a5be966bf42777cbd44b0/software/base/src/main/java/brooklyn/entity/java/JmxSupport.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/software/base/src/main/java/brooklyn/entity/java/JmxSupport.java?ref=6a5d519e2d203d611a4a5be966bf42777cbd44b0",
                "deletions": 1,
                "filename": "software/base/src/main/java/brooklyn/entity/java/JmxSupport.java",
                "patch": "@@ -273,7 +273,8 @@ public String getJmxAgentJarUrl() {\n     public void applyJmxJavaSystemProperties(MutableMap.Builder<String,Object> result) {\n         if (!isJmx()) return ;\n \n-        HostAndPort jmx = BrooklynAccessUtils.getBrooklynAccessibleAddress(entity, entity.getAttribute(JMX_PORT));\n+        Integer jmxPort = Preconditions.checkNotNull(entity.getAttribute(JMX_PORT), \"jmx port must not be null for %s\", entity);\n+        HostAndPort jmx = BrooklynAccessUtils.getBrooklynAccessibleAddress(entity, jmxPort);\n         Integer jmxRemotePort = getEntity().getAttribute(JMX_PORT);\n         String hostName = jmx.getHostText();\n ",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/6a5d519e2d203d611a4a5be966bf42777cbd44b0/software/base/src/main/java/brooklyn/entity/java/JmxSupport.java",
                "sha": "f10cf8d591eb14eeb2df85f4b0c4fbfedb43dd71",
                "status": "modified"
            }
        ],
        "message": "JmxSupport: improve NPE message when jmxPort null\n\nWas previously throwing NPE converting the null attribute value to\nan `int`.",
        "parent": "https://github.com/apache/brooklyn-server/commit/6f506fc355b1050d164fbf6ef2e363e06122c02d",
        "repo": "brooklyn-server",
        "unit_tests": [
            "JmxSupportTest.java"
        ]
    },
    "brooklyn-server_6d2aaa2": {
        "bug_id": "brooklyn-server_6d2aaa2",
        "commit": "https://github.com/apache/brooklyn-server/commit/6d2aaa26e944c6bc5e52ea99fd16a82b35f841f5",
        "file": [
            {
                "additions": 15,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/6d2aaa26e944c6bc5e52ea99fd16a82b35f841f5/core/src/main/java/brooklyn/event/adapter/JmxHelper.groovy",
                "changes": 17,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/event/adapter/JmxHelper.groovy?ref=6d2aaa26e944c6bc5e52ea99fd16a82b35f841f5",
                "deletions": 2,
                "filename": "core/src/main/java/brooklyn/event/adapter/JmxHelper.groovy",
                "patch": "@@ -127,8 +127,21 @@ public class JmxHelper {\n \t\t\tString[] creds = [ user, password ]\n \t\t\tenv.put(JMXConnector.CREDENTIALS, creds);\n \t\t}\n-\t\tjmxc = JMXConnectorFactory.connect(url, env);\n-\t\tmbsc = jmxc.getMBeanServerConnection();\n+\t\ttry{\n+            jmxc = JMXConnectorFactory.connect(url, env);\n+        }catch(NullPointerException npe){\n+            //some software -- eg WSO2 -- will throw an NPE exception if the JMX connection can't be created, instead of an IOException.\n+            //this is a break of contract with the JMXConnectorFactory.connect method, so this code verifies if the NPE is\n+            //thrown by a known offender (wso2) and if so replaces the bad exception by a new IOException.\n+            //ideally WSO2 will fix this bug and we can remove this code.\n+            boolean thrownByWso2 = npe.stackTrace[0].toString().contains(\"org.wso2.carbon.core.security.CarbonJMXAuthenticator.authenticate\")\n+            if(thrownByWso2){\n+                throw new IOException(\"Failed to connect to url ${url}. NullPointerException is thrown, but replaced by an IOException to fix a WSO2 JMX problem\",npe)\n+            }else{\n+                throw npe\n+            }\n+        }\n+        mbsc = jmxc.getMBeanServerConnection();\n \t}\n \t\n \t/** continuously attempts to connect (blocking), for at least the indicated amount of time; or indefinitely if -1 */",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/6d2aaa26e944c6bc5e52ea99fd16a82b35f841f5/core/src/main/java/brooklyn/event/adapter/JmxHelper.groovy",
                "sha": "edb06d67c1edefdd2415934daf89af7ccae05fc3",
                "status": "modified"
            }
        ],
        "message": "workaround for WSO2-specific JMX error condition (throws NPE when contract expects an IOE) (via pveentjer)",
        "parent": "https://github.com/apache/brooklyn-server/commit/783e911cf21061a42651631bca563ae273182f0e",
        "repo": "brooklyn-server",
        "unit_tests": [
            "JmxHelperTest.java"
        ]
    },
    "brooklyn-server_6ed231c": {
        "bug_id": "brooklyn-server_6ed231c",
        "commit": "https://github.com/apache/brooklyn-server/commit/6ed231cf16bd4720f6e3788489655daa5cd44185",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/6ed231cf16bd4720f6e3788489655daa5cd44185/core/src/main/java/brooklyn/event/feed/http/JsonFunctions.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/event/feed/http/JsonFunctions.java?ref=6ed231cf16bd4720f6e3788489655daa5cd44185",
                "deletions": 1,
                "filename": "core/src/main/java/brooklyn/event/feed/http/JsonFunctions.java",
                "patch": "@@ -36,7 +36,9 @@ private JsonFunctions() {} // instead use static utility methods\n     public static <T> Function<JsonElement, T> cast(final Class<T> expected) {\n         return new Function<JsonElement, T>() {\n             @Override public T apply(JsonElement input) {\n-                if (input.isJsonNull()) {\n+                if (input == null) {\n+                    return (T) null;\n+                } else if (input.isJsonNull()) {\n                     return (T) null;\n                 } else if (expected == boolean.class || expected == Boolean.class) {\n                     return (T) (Boolean) input.getAsBoolean();",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/6ed231cf16bd4720f6e3788489655daa5cd44185/core/src/main/java/brooklyn/event/feed/http/JsonFunctions.java",
                "sha": "b41e3126956f8aceeed96ebe29b3c67832b097cd",
                "status": "modified"
            }
        ],
        "message": "Sensor feed JsonFunctions: avoid NPE\n\n- In cast(Class), return null if input is null",
        "parent": "https://github.com/apache/brooklyn-server/commit/4e2f1b4999b19d5747d5f88d90e6e2d31b67de12",
        "repo": "brooklyn-server",
        "unit_tests": [
            "JsonFunctionsTest.java"
        ]
    },
    "brooklyn-server_6f7eed1": {
        "bug_id": "brooklyn-server_6f7eed1",
        "commit": "https://github.com/apache/brooklyn-server/commit/6f7eed11b173274f4087a9e12dd314339fa36177",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/6f7eed11b173274f4087a9e12dd314339fa36177/core/src/main/java/brooklyn/entity/basic/EntityTransientCopyInternal.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/entity/basic/EntityTransientCopyInternal.java?ref=6f7eed11b173274f4087a9e12dd314339fa36177",
                "deletions": 0,
                "filename": "core/src/main/java/brooklyn/entity/basic/EntityTransientCopyInternal.java",
                "patch": "@@ -37,6 +37,7 @@\n import brooklyn.entity.rebind.RebindSupport;\n import brooklyn.event.AttributeSensor;\n import brooklyn.location.Location;\n+import brooklyn.management.ExecutionContext;\n import brooklyn.management.ManagementContext;\n import brooklyn.management.internal.EntityManagementSupport;\n import brooklyn.mementos.EntityMemento;\n@@ -102,5 +103,7 @@\n     Effector<?> getEffector(String effectorName);\n     FeedSupport getFeedSupport();\n     RebindSupport<EntityMemento> getRebindSupport();\n+    // for REST calls on read-only entities which want to resolve values\n+    ExecutionContext getExecutionContext();\n     \n }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/6f7eed11b173274f4087a9e12dd314339fa36177/core/src/main/java/brooklyn/entity/basic/EntityTransientCopyInternal.java",
                "sha": "3ca2d544f27be373b78031ad3754d0d51ee133ca",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/6f7eed11b173274f4087a9e12dd314339fa36177/core/src/main/java/brooklyn/location/basic/LocalhostMachineProvisioningLocation.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/location/basic/LocalhostMachineProvisioningLocation.java?ref=6f7eed11b173274f4087a9e12dd314339fa36177",
                "deletions": 0,
                "filename": "core/src/main/java/brooklyn/location/basic/LocalhostMachineProvisioningLocation.java",
                "patch": "@@ -256,6 +256,11 @@ public LocalhostMachine(Map properties) {\n             super(MutableMap.builder().putAll(properties).put(\"mutexSupport\", mutexSupport).build());\n         }\n         \n+        @Override\n+        protected WithMutexes getMutexSupport() {\n+            return mutexSupport;\n+        }\n+        \n         public boolean obtainSpecificPort(int portNumber) {\n             if (!isSudoAllowed() && portNumber <= 1024)\n                 return false;",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/6f7eed11b173274f4087a9e12dd314339fa36177/core/src/main/java/brooklyn/location/basic/LocalhostMachineProvisioningLocation.java",
                "sha": "113fb67e84bf0683ecf407367cc4a0db487630e5",
                "status": "modified"
            },
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/6f7eed11b173274f4087a9e12dd314339fa36177/core/src/main/java/brooklyn/location/basic/SshMachineLocation.java",
                "changes": 28,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/location/basic/SshMachineLocation.java?ref=6f7eed11b173274f4087a9e12dd314339fa36177",
                "deletions": 9,
                "filename": "core/src/main/java/brooklyn/location/basic/SshMachineLocation.java",
                "patch": "@@ -140,8 +140,11 @@\n     @SetFromFlag(nullable = false)\n     protected InetAddress address;\n \n+    // TODO should not allow this to be set from flag; it is not persisted so that will be lost\n+    // (mainly used for localhost currently so not a big problem)\n+    @Nullable  // lazily initialized; use getMutexSupport()\n     @SetFromFlag\n-    protected transient WithMutexes mutexSupport;\n+    private transient WithMutexes mutexSupport;\n \n     @SetFromFlag\n     private Set<Integer> usedPorts;\n@@ -336,10 +339,6 @@ public SshMachineLocation configure(Map properties) {\n         // TODO Note that check for addresss!=null is done automatically in super-constructor, in FlagUtils.checkRequiredFields\n         // Yikes, dangerous code for accessing fields of sub-class in super-class' constructor! But getting away with it so far!\n \n-        if (mutexSupport == null) {\n-            mutexSupport = new MutexSupport();\n-        }\n-\n         boolean deferConstructionChecks = (properties.containsKey(\"deferConstructionChecks\") && TypeCoercions.coerce(properties.get(\"deferConstructionChecks\"), Boolean.class));\n         if (!deferConstructionChecks) {\n             if (getDisplayName() == null) {\n@@ -349,6 +348,17 @@ public SshMachineLocation configure(Map properties) {\n         return this;\n     }\n     \n+    private transient final Object mutexSupportCreationLock = new Object();\n+    protected WithMutexes getMutexSupport() {\n+        synchronized (mutexSupportCreationLock) {\n+            // create on demand so that it is not null after serialization\n+            if (mutexSupport == null) {\n+                mutexSupport = new MutexSupport();\n+            }\n+            return mutexSupport;\n+        }\n+    }\n+    \n     protected void addSshPoolCacheCleanupTask() {\n         if (cleanupTask!=null && !cleanupTask.isDone()) {\n             return;\n@@ -895,25 +905,25 @@ protected MachineDetails inferMachineDetails() {\n     @Override\n     public void acquireMutex(String mutexId, String description) throws RuntimeInterruptedException {\n         try {\n-            mutexSupport.acquireMutex(mutexId, description);\n+            getMutexSupport().acquireMutex(mutexId, description);\n         } catch (InterruptedException ie) {\n             throw new RuntimeInterruptedException(\"Interrupted waiting for mutex: \" + mutexId, ie);\n         }\n     }\n \n     @Override\n     public boolean tryAcquireMutex(String mutexId, String description) {\n-        return mutexSupport.tryAcquireMutex(mutexId, description);\n+        return getMutexSupport().tryAcquireMutex(mutexId, description);\n     }\n \n     @Override\n     public void releaseMutex(String mutexId) {\n-        mutexSupport.releaseMutex(mutexId);\n+        getMutexSupport().releaseMutex(mutexId);\n     }\n \n     @Override\n     public boolean hasMutex(String mutexId) {\n-        return mutexSupport.hasMutex(mutexId);\n+        return getMutexSupport().hasMutex(mutexId);\n     }\n \n     //We want the SshMachineLocation to be serializable and therefore the pool needs to be dealt with correctly.",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/6f7eed11b173274f4087a9e12dd314339fa36177/core/src/main/java/brooklyn/location/basic/SshMachineLocation.java",
                "sha": "2bf81f967c41aca4fb9428e9b98727707f030109",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/6f7eed11b173274f4087a9e12dd314339fa36177/core/src/main/java/brooklyn/management/internal/LocalLocationManager.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/management/internal/LocalLocationManager.java?ref=6f7eed11b173274f4087a9e12dd314339fa36177",
                "deletions": 1,
                "filename": "core/src/main/java/brooklyn/management/internal/LocalLocationManager.java",
                "patch": "@@ -376,7 +376,7 @@ private synchronized void unmanageNonRecursiveOnlyClearItsFields(Location loc, M\n             // if not destroying, don't change the parent's children list\n             ((AbstractLocation)loc).setParent(null, false);\n         }\n-        // clear config to help with GC\n+        // clear config to help with GC; i know you're not supposed to, but this seems to help, else config bag is littered with refs to entities etc\n         ((AbstractLocation)loc).getLocalConfigBag().clear();\n     }\n     ",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/6f7eed11b173274f4087a9e12dd314339fa36177/core/src/main/java/brooklyn/management/internal/LocalLocationManager.java",
                "sha": "f1da1142c0d0ac3b38b9fc5608a1d3863a4fa44c",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/6f7eed11b173274f4087a9e12dd314339fa36177/usage/rest-server/src/main/java/brooklyn/rest/resources/ApplicationResource.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/usage/rest-server/src/main/java/brooklyn/rest/resources/ApplicationResource.java?ref=6f7eed11b173274f4087a9e12dd314339fa36177",
                "deletions": 2,
                "filename": "usage/rest-server/src/main/java/brooklyn/rest/resources/ApplicationResource.java",
                "patch": "@@ -47,6 +47,7 @@\n import brooklyn.entity.Application;\n import brooklyn.entity.Entity;\n import brooklyn.entity.Group;\n+import brooklyn.entity.basic.AbstractGroup;\n import brooklyn.entity.basic.Attributes;\n import brooklyn.entity.basic.Lifecycle;\n import brooklyn.entity.trait.Startable;\n@@ -144,8 +145,12 @@ private JsonNode fromEntity(Entity entity) {\n         if (!entity.getChildren().isEmpty())\n             aRoot.put(\"children\", entitiesIdAndNameAsArray(entity.getChildren()));\n \n-        if ((entity instanceof Group) && !((Group) entity).getMembers().isEmpty())\n-            aRoot.put(\"members\", entitiesIdAndNameAsArray(((Group) entity).getMembers()));\n+        if (entity instanceof Group) {\n+            // use attribute instead of method in case it is read-only\n+            Collection<Entity> members = entity.getAttribute(AbstractGroup.GROUP_MEMBERS);\n+            if (members!=null && !members.isEmpty())\n+                aRoot.put(\"members\", entitiesIdAndNameAsArray(members));\n+        }\n \n         return aRoot;\n     }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/6f7eed11b173274f4087a9e12dd314339fa36177/usage/rest-server/src/main/java/brooklyn/rest/resources/ApplicationResource.java",
                "sha": "6b9be050698f67898fd2cfc1afce7a72faabce22",
                "status": "modified"
            }
        ],
        "message": "fix misc errors during hot standby (access to unavailable methods, clearing more things on location unmanagement) and after rebind (NPE in SshMachineLocation), and fix sensor logic bug in tomcat",
        "parent": "https://github.com/apache/brooklyn-server/commit/d542630d30559845b7247a67c1e75e148b4107d4",
        "repo": "brooklyn-server",
        "unit_tests": [
            "ApplicationResourceTest.java"
        ]
    },
    "brooklyn-server_7a602e8": {
        "bug_id": "brooklyn-server_7a602e8",
        "commit": "https://github.com/apache/brooklyn-server/commit/7a602e883bc7bca24da8ea288f483dca949d7546",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/7a602e883bc7bca24da8ea288f483dca949d7546/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java?ref=7a602e883bc7bca24da8ea288f483dca949d7546",
                "deletions": 3,
                "filename": "locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "patch": "@@ -1290,11 +1290,13 @@ public Template buildTemplate(ComputeService computeService, ConfigBag config) {\n \n         // Finally try to build the template\n         Template template;\n+        Image image;\n         try {\n             template = templateBuilder.build();\n             if (template==null) throw new NullPointerException(\"No template found (templateBuilder.build returned null)\");\n-            LOG.debug(\"jclouds found template \"+template+\" (image \"+template.getImage()+\") for provisioning in \"+this+\" for \"+config.getDescription());\n-            if (template.getImage()==null) throw new NullPointerException(\"Template does not contain an image (templateBuilder.build returned invalid template)\");\n+            image = template.getImage();\n+            LOG.debug(\"jclouds found template \"+template+\" (image \"+image+\") for provisioning in \"+this+\" for \"+config.getDescription());\n+            if (image==null) throw new NullPointerException(\"Template does not contain an image (templateBuilder.build returned invalid template)\");\n         } catch (AuthorizationException e) {\n             LOG.warn(\"Error resolving template: not authorized (rethrowing: \"+e+\")\");\n             throw new IllegalStateException(\"Not authorized to access cloud \"+this+\" to resolve \"+templateBuilder, e);\n@@ -1319,7 +1321,8 @@ public Template buildTemplate(ComputeService computeService, ConfigBag config) {\n         }\n         TemplateOptions options = template.getOptions();\n \n-        if (template.getImage().getOperatingSystem().getFamily().equals(OsFamily.WINDOWS)) {\n+        OsFamily osFamily = (image.getOperatingSystem() != null) ? image.getOperatingSystem().getFamily() : null;\n+        if (OsFamily.WINDOWS == osFamily) {\n             if (!(config.containsKey(JcloudsLocationConfig.USER_METADATA_STRING) || config.containsKey(JcloudsLocationConfig.USER_METADATA_MAP))) {\n                 config.put(JcloudsLocationConfig.USER_METADATA_STRING, WinRmMachineLocation.getDefaultUserMetadataString());\n             }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/7a602e883bc7bca24da8ea288f483dca949d7546/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "sha": "23b79eda356903266026e7d71d493c5206300616",
                "status": "modified"
            }
        ],
        "message": "Fix NPE when jclouds image does not have OsFamily",
        "parent": "https://github.com/apache/brooklyn-server/commit/5f6b47cf2f39f06697fbc31017d02d226f0b9dd1",
        "repo": "brooklyn-server",
        "unit_tests": [
            "JcloudsLocationTest.java"
        ]
    },
    "brooklyn-server_7b809ed": {
        "bug_id": "brooklyn-server_7b809ed",
        "commit": "https://github.com/apache/brooklyn-server/commit/7b809ed557c280775278bd642f49e7e8ac626fa8",
        "file": [
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/7b809ed557c280775278bd642f49e7e8ac626fa8/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java?ref=7b809ed557c280775278bd642f49e7e8ac626fa8",
                "deletions": 4,
                "filename": "locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "patch": "@@ -1242,10 +1242,15 @@ protected LoginCredentials createUser(ComputeService computeService, NodeMetadat\n         UserCreation userCreation = createUserStatements(image, config);\n         \n         if (!userCreation.statements.isEmpty()) {\n-            org.jclouds.compute.domain.OsFamily osFamily = node.getOperatingSystem().getFamily();\n-            org.jclouds.scriptbuilder.domain.OsFamily scriptOsFamily = (osFamily == org.jclouds.compute.domain.OsFamily.WINDOWS) \n-                    ? org.jclouds.scriptbuilder.domain.OsFamily.WINDOWS\n-                    : org.jclouds.scriptbuilder.domain.OsFamily.UNIX;\n+            // If unsure of OS family, default to unix for rendering statements.\n+            org.jclouds.scriptbuilder.domain.OsFamily scriptOsFamily;\n+            if (node.getOperatingSystem() == null) {\n+                scriptOsFamily = org.jclouds.scriptbuilder.domain.OsFamily.UNIX;\n+            } else {\n+                scriptOsFamily = (node.getOperatingSystem().getFamily() == org.jclouds.compute.domain.OsFamily.WINDOWS) \n+                        ? org.jclouds.scriptbuilder.domain.OsFamily.WINDOWS\n+                        : org.jclouds.scriptbuilder.domain.OsFamily.UNIX;\n+            }\n             \n             List<String> commands = Lists.newArrayList();\n             for (Statement statement : userCreation.statements) {",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/7b809ed557c280775278bd642f49e7e8ac626fa8/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "sha": "cafe1c7c54a9f7d12809c8d68f2864bf1fb78044",
                "status": "modified"
            }
        ],
        "message": "JcloudsLocation: avoid NPE on user-creation\n\nIf jclouds node doesn\u2019t know its operatingSystem, then was\ngetting NPE. Guard against that, and default to unix.",
        "parent": "https://github.com/apache/brooklyn-server/commit/145e800b6fbfc78b1916f73246b39ee3da827874",
        "repo": "brooklyn-server",
        "unit_tests": [
            "JcloudsLocationTest.java"
        ]
    },
    "brooklyn-server_7d2bed5": {
        "bug_id": "brooklyn-server_7d2bed5",
        "commit": "https://github.com/apache/brooklyn-server/commit/7d2bed5ceddc5a7a22214d9890b250fe548f49b2",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/7d2bed5ceddc5a7a22214d9890b250fe548f49b2/utils/common/src/main/java/brooklyn/util/text/Strings.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/utils/common/src/main/java/brooklyn/util/text/Strings.java?ref=7d2bed5ceddc5a7a22214d9890b250fe548f49b2",
                "deletions": 0,
                "filename": "utils/common/src/main/java/brooklyn/util/text/Strings.java",
                "patch": "@@ -181,6 +181,7 @@ public static String removeAllFromStart(String string, String ...prefixes) {\n \n     /** convenience for {@link com.google.common.base.Joiner} */\n     public static String join(Iterable<? extends Object> list, String seperator) {\n+        if (list==null) return null;\n         boolean app = false;\n         StringBuilder out = new StringBuilder();\n         for (Object s: list) {",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/7d2bed5ceddc5a7a22214d9890b250fe548f49b2/utils/common/src/main/java/brooklyn/util/text/Strings.java",
                "sha": "c619565c38c9dce58704e179d0a81271808c8240",
                "status": "modified"
            }
        ],
        "message": "strings.join does not throw NPE\n\nuseful when using the joiner enricher if the inputted list is null",
        "parent": "https://github.com/apache/brooklyn-server/commit/c489122bb4678860d7715cf25871c20760006ee0",
        "repo": "brooklyn-server",
        "unit_tests": [
            "StringsTest.java"
        ]
    },
    "brooklyn-server_7f32d2a": {
        "bug_id": "brooklyn-server_7f32d2a",
        "commit": "https://github.com/apache/brooklyn-server/commit/7f32d2a4d8e6420d2e133a7d7ff5b95eb5caf8b3",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/7f32d2a4d8e6420d2e133a7d7ff5b95eb5caf8b3/core/src/main/java/brooklyn/entity/basic/Entities.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/entity/basic/Entities.java?ref=7f32d2a4d8e6420d2e133a7d7ff5b95eb5caf8b3",
                "deletions": 1,
                "filename": "core/src/main/java/brooklyn/entity/basic/Entities.java",
                "patch": "@@ -1022,7 +1022,7 @@ public static void waitForServiceUp(final Entity entity, Duration timeout) {\n                     .rethrowException().backoffTo(Duration.ONE_SECOND)\n                     .until(new Callable<Boolean>() {\n                         public Boolean call() {\n-                            return entity.getAttribute(Startable.SERVICE_UP);\n+                            return Boolean.TRUE.equals(entity.getAttribute(Startable.SERVICE_UP));\n                         }})\n                     .run()) {\n                 throw new IllegalStateException(\"Timeout waiting for SERVICE_UP from \"+entity);",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/7f32d2a4d8e6420d2e133a7d7ff5b95eb5caf8b3/core/src/main/java/brooklyn/entity/basic/Entities.java",
                "sha": "51f86f67075c10f8489008ac25105e27364a8f67",
                "status": "modified"
            }
        ],
        "message": "Fix Entities.waitForServiceUp to avoid NPE\n\n- Never return null for repeater\u2019s `until`; always return TRUE or FALSE.\n  Otherwise it will NPE.",
        "parent": "https://github.com/apache/brooklyn-server/commit/445906abcb7ba34aabfa49f57c5d7e859868ace1",
        "repo": "brooklyn-server",
        "unit_tests": [
            "EntitiesTest.java"
        ]
    },
    "brooklyn-server_86b4fe4": {
        "bug_id": "brooklyn-server_86b4fe4",
        "commit": "https://github.com/apache/brooklyn-server/commit/86b4fe4440d46431476618bcbda2c1c219f4db2e",
        "file": [
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/86b4fe4440d46431476618bcbda2c1c219f4db2e/core/src/main/java/brooklyn/management/internal/AbstractManagementContext.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/management/internal/AbstractManagementContext.java?ref=86b4fe4440d46431476618bcbda2c1c219f4db2e",
                "deletions": 0,
                "filename": "core/src/main/java/brooklyn/management/internal/AbstractManagementContext.java",
                "patch": "@@ -275,15 +275,22 @@ public T call() {\n \n     protected abstract <T> Task<T> runAtEntity(final Entity entity, final Effector<T> eff, @SuppressWarnings(\"rawtypes\") final Map parameters);\n \n+    @Override\n     public abstract void addEntitySetListener(CollectionChangeListener<Entity> listener);\n \n+    @Override\n     public abstract void removeEntitySetListener(CollectionChangeListener<Entity> listener);\n     \n     @Override\n     public StringConfigMap getConfig() {\n         return configMap;\n     }\n \n+    @Override\n+    public BrooklynProperties getBrooklynProperties() {\n+        return configMap;\n+    }\n+\n     @Override\n     public synchronized LocationRegistry getLocationRegistry() {\n         if (locationRegistry==null) locationRegistry = new BasicLocationRegistry(this);",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/86b4fe4440d46431476618bcbda2c1c219f4db2e/core/src/main/java/brooklyn/management/internal/AbstractManagementContext.java",
                "sha": "d5d353fba9804d284eef2177a3a8bc3d906d21dd",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/86b4fe4440d46431476618bcbda2c1c219f4db2e/core/src/main/java/brooklyn/management/internal/ManagementContextInternal.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/management/internal/ManagementContextInternal.java?ref=86b4fe4440d46431476618bcbda2c1c219f4db2e",
                "deletions": 0,
                "filename": "core/src/main/java/brooklyn/management/internal/ManagementContextInternal.java",
                "patch": "@@ -4,6 +4,7 @@\n import java.util.Map;\n import java.util.concurrent.ExecutionException;\n \n+import brooklyn.config.BrooklynProperties;\n import brooklyn.config.ConfigKey;\n import brooklyn.entity.Effector;\n import brooklyn.entity.Entity;\n@@ -41,4 +42,6 @@\n     <T> Task<T> invokeEffector(final Entity entity, final Effector<T> eff, @SuppressWarnings(\"rawtypes\") final Map parameters);\n \n     BrooklynStorage getStorage();\n+    \n+    BrooklynProperties getBrooklynProperties();\n }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/86b4fe4440d46431476618bcbda2c1c219f4db2e/core/src/main/java/brooklyn/management/internal/ManagementContextInternal.java",
                "sha": "57139e3bdab9edee45c896b93b7045ed93ed61e3",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/86b4fe4440d46431476618bcbda2c1c219f4db2e/core/src/main/java/brooklyn/management/internal/NonDeploymentManagementContext.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/management/internal/NonDeploymentManagementContext.java?ref=86b4fe4440d46431476618bcbda2c1c219f4db2e",
                "deletions": 0,
                "filename": "core/src/main/java/brooklyn/management/internal/NonDeploymentManagementContext.java",
                "patch": "@@ -13,6 +13,7 @@\n import java.util.concurrent.TimeoutException;\n \n import brooklyn.catalog.BrooklynCatalog;\n+import brooklyn.config.BrooklynProperties;\n import brooklyn.config.StringConfigMap;\n import brooklyn.entity.Application;\n import brooklyn.entity.Effector;\n@@ -154,6 +155,12 @@ public StringConfigMap getConfig() {\n         return initialManagementContext.getConfig();\n     }\n \n+    @Override\n+    public BrooklynProperties getBrooklynProperties() {\n+        checkInitialManagementContextReal();\n+        return initialManagementContext.getBrooklynProperties();\n+    }\n+\n     @Override\n     public BrooklynStorage getStorage() {\n         checkInitialManagementContextReal();",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/86b4fe4440d46431476618bcbda2c1c219f4db2e/core/src/main/java/brooklyn/management/internal/NonDeploymentManagementContext.java",
                "sha": "a4ef9b798647a2ae906645253f025f7a4ebffa57",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/86b4fe4440d46431476618bcbda2c1c219f4db2e/usage/launcher/src/main/java/brooklyn/launcher/BrooklynLauncher.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/usage/launcher/src/main/java/brooklyn/launcher/BrooklynLauncher.java?ref=86b4fe4440d46431476618bcbda2c1c219f4db2e",
                "deletions": 0,
                "filename": "usage/launcher/src/main/java/brooklyn/launcher/BrooklynLauncher.java",
                "patch": "@@ -331,7 +331,10 @@ protected BrooklynLauncher doLaunch() {\n                 brooklynProperties = builder.build();\n             }\n             managementContext = new LocalManagementContext(brooklynProperties);\n+        } else if (brooklynProperties == null) {\n+            brooklynProperties = ((ManagementContextInternal)managementContext).getBrooklynProperties();\n         }\n+        \n         for (Map.Entry<String, Object> entry : brooklynAdditionalProperties.entrySet()) {\n             brooklynProperties.put(entry.getKey(), entry.getValue());\n         }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/86b4fe4440d46431476618bcbda2c1c219f4db2e/usage/launcher/src/main/java/brooklyn/launcher/BrooklynLauncher.java",
                "sha": "20425ed86bae779fc9d849ff5416e9e5f4bf55a6",
                "status": "modified"
            }
        ],
        "message": "Merge pull request #920 from aledsage/fix/BrooklynLauncher-supplying-ManagementContext\n\nFix NPE when BrooklynLauncher given ManagementContext",
        "parent": "https://github.com/apache/brooklyn-server/commit/4f9a75304670074c3b7fb111c9918994a170510d",
        "repo": "brooklyn-server",
        "unit_tests": [
            "BrooklynLauncherTest.java"
        ]
    },
    "brooklyn-server_88cc87c": {
        "bug_id": "brooklyn-server_88cc87c",
        "commit": "https://github.com/apache/brooklyn-server/commit/88cc87c5dfbe248556a616277143d5879cf32519",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/88cc87c5dfbe248556a616277143d5879cf32519/core/src/main/java/brooklyn/entity/basic/EntityDynamicType.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/entity/basic/EntityDynamicType.java?ref=88cc87c5dfbe248556a616277143d5879cf32519",
                "deletions": 5,
                "filename": "core/src/main/java/brooklyn/entity/basic/EntityDynamicType.java",
                "patch": "@@ -24,10 +24,10 @@\n import brooklyn.entity.EntityType;\n import brooklyn.entity.effector.EffectorAndBody;\n import brooklyn.entity.effector.EffectorBody;\n-import brooklyn.entity.effector.EffectorWithBody;\n-import brooklyn.entity.effector.Effectors;\n import brooklyn.entity.effector.EffectorTasks.EffectorBodyTaskFactory;\n import brooklyn.entity.effector.EffectorTasks.EffectorTaskFactory;\n+import brooklyn.entity.effector.EffectorWithBody;\n+import brooklyn.entity.effector.Effectors;\n import brooklyn.event.Sensor;\n import brooklyn.event.basic.BasicConfigKey.BasicConfigKeyOverwriting;\n import brooklyn.util.flags.FlagUtils;\n@@ -87,15 +87,15 @@ private EntityDynamicType(Class<? extends Entity> clazz, AbstractEntity entity)\n         setName((clazz.getCanonicalName() == null) ? clazz.getName() : clazz.getCanonicalName());\n         String id = entity==null ? clazz.getName() : entity.getId();\n         \n-        effectors.putAll(findEffectors(clazz, entity));\n+        effectors.putAll(findEffectors(clazz, null));\n         if (LOG.isTraceEnabled())\n             LOG.trace(\"Entity {} effectors: {}\", id, Joiner.on(\", \").join(effectors.keySet()));\n         \n-        sensors.putAll(findSensors(clazz, entity));\n+        sensors.putAll(findSensors(clazz, null));\n         if (LOG.isTraceEnabled())\n             LOG.trace(\"Entity {} sensors: {}\", id, Joiner.on(\", \").join(sensors.keySet()));\n         \n-        buildConfigKeys(clazz, entity, configKeys);\n+        buildConfigKeys(clazz, null, configKeys);\n         if (LOG.isTraceEnabled())\n             LOG.trace(\"Entity {} config keys: {}\", id, Joiner.on(\", \").join(configKeys.keySet()));\n ",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/88cc87c5dfbe248556a616277143d5879cf32519/core/src/main/java/brooklyn/entity/basic/EntityDynamicType.java",
                "sha": "69615fdfa39f66981dd9081f2f6318ee53c1f20f",
                "status": "modified"
            },
            {
                "additions": 28,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/88cc87c5dfbe248556a616277143d5879cf32519/core/src/test/java/brooklyn/entity/basic/EntityTypeTest.java",
                "changes": 31,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/test/java/brooklyn/entity/basic/EntityTypeTest.java?ref=88cc87c5dfbe248556a616277143d5879cf32519",
                "deletions": 3,
                "filename": "core/src/test/java/brooklyn/entity/basic/EntityTypeTest.java",
                "patch": "@@ -1,12 +1,12 @@\n package brooklyn.entity.basic;\n \n+import static brooklyn.entity.basic.AbstractEntity.EFFECTOR_ADDED;\n+import static brooklyn.entity.basic.AbstractEntity.EFFECTOR_CHANGED;\n+import static brooklyn.entity.basic.AbstractEntity.EFFECTOR_REMOVED;\n import static brooklyn.entity.basic.AbstractEntity.POLICY_ADDED;\n import static brooklyn.entity.basic.AbstractEntity.POLICY_REMOVED;\n import static brooklyn.entity.basic.AbstractEntity.SENSOR_ADDED;\n import static brooklyn.entity.basic.AbstractEntity.SENSOR_REMOVED;\n-import static brooklyn.entity.basic.AbstractEntity.EFFECTOR_ADDED;\n-import static brooklyn.entity.basic.AbstractEntity.EFFECTOR_REMOVED;\n-import static brooklyn.entity.basic.AbstractEntity.EFFECTOR_CHANGED;\n import static org.testng.Assert.assertEquals;\n import static org.testng.Assert.assertFalse;\n import static org.testng.Assert.assertNotNull;\n@@ -31,6 +31,7 @@\n import brooklyn.test.TestUtils;\n import brooklyn.test.entity.TestApplication;\n import brooklyn.test.entity.TestEntity;\n+import brooklyn.test.entity.TestEntityImpl;\n import brooklyn.util.collections.CollectionFunctionals;\n import brooklyn.util.collections.MutableSet;\n \n@@ -221,4 +222,28 @@ public void testHasSensor() throws Exception {\n         assertTrue(entity.getEntityType().hasSensor(\"entity.sensor.added\"));\n         assertFalse(entity.getEntityType().hasSensor(\"does.not.exist\"));\n     }\n+    \n+    // Previously EntityDynamicType's constructor when passed `entity` during the entity's construction (!)\n+    // would pass this to EntityDynamicType.findEffectors, which would do log.warn in some cirumstances,\n+    // with entity.toString as part of the log message. But if the toString called getConfig() this would \n+    // fail because we were still in the middle of constructing the entity.entityType!\n+    @Test\n+    public void testEntityDynamicTypeDoesNotCallToStringDuringConstruction() throws Exception {\n+        entity = app.createAndManageChild(EntitySpec.create(TestEntity.class).impl(EntityWithToStringAccessingConfig.class));\n+        entity.toString();\n+    }\n+    \n+    public static class EntityWithToStringAccessingConfig extends TestEntityImpl {\n+        \n+        // to cause warning to be logged: non-static constant\n+        public final MethodEffector<Void> NON_STATIC_EFFECTOR = new MethodEffector<Void>(EntityWithToStringAccessingConfig.class, \"nonStaticEffector\");\n+\n+        public void nonStaticEffector() {\n+        }\n+        \n+        @Override\n+        public String toString() {\n+            return super.toString() + getConfig(CONF_NAME);\n+        }\n+    }\n }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/88cc87c5dfbe248556a616277143d5879cf32519/core/src/test/java/brooklyn/entity/basic/EntityTypeTest.java",
                "sha": "9f62dca25504e983b4025da632a70c63f1205b08",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/88cc87c5dfbe248556a616277143d5879cf32519/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "changes": 16,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java?ref=88cc87c5dfbe248556a616277143d5879cf32519",
                "deletions": 6,
                "filename": "locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "patch": "@@ -88,6 +88,7 @@\n import com.google.common.base.Function;\n import com.google.common.base.Objects;\n import com.google.common.base.Splitter;\n+import com.google.common.base.Stopwatch;\n import com.google.common.base.Throwables;\n import com.google.common.collect.ImmutableList;\n import com.google.common.collect.ImmutableMap;\n@@ -1150,11 +1151,10 @@ protected void waitForReachable(final ComputeService computeService, NodeMetadat\n             delayMs = Time.parseTimeString(WAIT_FOR_SSHABLE.getDefaultValue());\n         \n         String user = expectedCredentialsRef.getUser();\n-        LOG.info(\"Started VM in {}; waiting {} for it to be sshable on {}@{}{}\",\n-                new Object[] {\n-                        setup.getDescription(),Time.makeTimeString(delayMs),\n-                        user, vmIp, Objects.equal(user, getUser(setup)) ? \"\" : \" (setup user is different: \"+getUser(setup)+\")\"\n-                });\n+        LOG.info(\"Started VM {}; waiting {} for it to be sshable on {}@{}{}\", new Object[] {\n+                setup.getDescription(), Time.makeTimeStringRounded(delayMs),\n+                user, vmIp, Objects.equal(user, getUser(setup)) ? \"\" : \" (setup user is different: \"+getUser(setup)+\")\"});\n+        Stopwatch stopwatch = new Stopwatch().start();\n         \n         boolean reachable = new Repeater()\n             .repeat()\n@@ -1173,8 +1173,12 @@ public Boolean call() {\n         if (!reachable) {\n             throw new IllegalStateException(\"SSH failed for \"+\n                     user+\"@\"+vmIp+\" (\"+setup.getDescription()+\") after waiting \"+\n-                    Time.makeTimeString(delayMs));\n+                    Time.makeTimeStringRounded(delayMs));\n         }\n+        \n+        LOG.info(\"VM {}; is sshable after {} on {}@{}\",new Object[] {\n+                setup.getDescription(), Time.makeTimeStringRounded(stopwatch),\n+                user, vmIp});\n     }\n     \n     // -------------------- hostnames ------------------------",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/88cc87c5dfbe248556a616277143d5879cf32519/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "sha": "818b50e91019f9b0da6f2941898f425a6b0515ba",
                "status": "modified"
            }
        ],
        "message": "Merge pull request #951 from aledsage/fix/NPE-EntityDynamicType-constructor-calling-entity.toString\n\nFix NPE when EntityDynamicType constructor calling entity.toString",
        "parent": "https://github.com/apache/brooklyn-server/commit/6c2624d948361f4a144df965ade963094b0d0253",
        "repo": "brooklyn-server",
        "unit_tests": [
            "JcloudsLocationTest.java"
        ]
    },
    "brooklyn-server_8fe4140": {
        "bug_id": "brooklyn-server_8fe4140",
        "commit": "https://github.com/apache/brooklyn-server/commit/8fe4140936792581b311cff39510b84f06ee22a0",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/8fe4140936792581b311cff39510b84f06ee22a0/camp/camp-brooklyn/src/test/java/org/apache/brooklyn/camp/brooklyn/EmptyWindowsProcessYamlTest.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/camp/camp-brooklyn/src/test/java/org/apache/brooklyn/camp/brooklyn/EmptyWindowsProcessYamlTest.java?ref=8fe4140936792581b311cff39510b84f06ee22a0",
                "deletions": 2,
                "filename": "camp/camp-brooklyn/src/test/java/org/apache/brooklyn/camp/brooklyn/EmptyWindowsProcessYamlTest.java",
                "patch": "@@ -32,14 +32,17 @@\n @Test\n public class EmptyWindowsProcessYamlTest extends AbstractYamlTest {\n \n-    @Test(groups=\"Integration\")\n+    // takes couple of seconds unfortunately (why?!), but our only unit-test coverage of \n+    // EmptyWindowsProcess so including in unit tests anyway.\n+    @Test\n     public void testNoWinrm() throws Exception {\n         Entity app = createAndStartApplication(\n                 \"location: byon:(hosts=\\\"1.2.3.4\\\",osFamily=windows)\",\n                 \"services:\",\n                 \"- type: \"+EmptyWindowsProcess.class.getName(),\n                 \"  brooklyn.config:\",\n-                \"    winrmMonitoring.enabled: false\");\n+                \"    winrmMonitoring.enabled: false\",\n+                \"    onbox.base.dir.skipResolution: true\");\n         waitForApplicationTasks(app);\n \n         EmptyWindowsProcess entity = Iterables.getOnlyElement(Entities.descendants(app, EmptyWindowsProcess.class));",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/8fe4140936792581b311cff39510b84f06ee22a0/camp/camp-brooklyn/src/test/java/org/apache/brooklyn/camp/brooklyn/EmptyWindowsProcessYamlTest.java",
                "sha": "3eaa963589dd01e58f9495669bd90f36d71f14c2",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/8fe4140936792581b311cff39510b84f06ee22a0/software/base/src/main/java/org/apache/brooklyn/entity/software/base/EmptyWindowsProcessWinRmDriver.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/software/base/src/main/java/org/apache/brooklyn/entity/software/base/EmptyWindowsProcessWinRmDriver.java?ref=8fe4140936792581b311cff39510b84f06ee22a0",
                "deletions": 1,
                "filename": "software/base/src/main/java/org/apache/brooklyn/entity/software/base/EmptyWindowsProcessWinRmDriver.java",
                "patch": "@@ -28,6 +28,8 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+import com.google.common.base.Optional;\n+\n public class EmptyWindowsProcessWinRmDriver extends AbstractSoftwareProcessWinRmDriver implements VanillaWindowsProcessDriver {\n     @SuppressWarnings(\"unused\")\n     private static final Logger LOG = LoggerFactory.getLogger(EmptyWindowsProcessWinRmDriver.class);\n@@ -41,7 +43,8 @@ public EmptyWindowsProcessWinRmDriver(EmptyWindowsProcessImpl entity, WinRmMachi\n     @Override\n     public void start() {\n         WinRmMachineLocation machine = (WinRmMachineLocation) location;\n-        UserAndHostAndPort winrmAddress = UserAndHostAndPort.fromParts(machine.getUser(), machine.getAddress().getHostName(), entity.getConfig(WinRmTool.PROP_PORT));\n+        Integer port = entity.getConfig(WinRmTool.PROP_PORT);\n+        UserAndHostAndPort winrmAddress = UserAndHostAndPort.fromParts(machine.getUser(), machine.getAddress().getHostName(), Optional.fromNullable(port));\n         getEntity().sensors().set(Attributes.WINRM_ADDRESS, winrmAddress);\n \n         super.start();",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/8fe4140936792581b311cff39510b84f06ee22a0/software/base/src/main/java/org/apache/brooklyn/entity/software/base/EmptyWindowsProcessWinRmDriver.java",
                "sha": "c7842bae8c992a47b42cd6ae6b841b0911bd3a75",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/8fe4140936792581b311cff39510b84f06ee22a0/utils/common/src/main/java/org/apache/brooklyn/util/net/UserAndHostAndPort.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/utils/common/src/main/java/org/apache/brooklyn/util/net/UserAndHostAndPort.java?ref=8fe4140936792581b311cff39510b84f06ee22a0",
                "deletions": 0,
                "filename": "utils/common/src/main/java/org/apache/brooklyn/util/net/UserAndHostAndPort.java",
                "patch": "@@ -21,6 +21,7 @@\n import java.io.Serializable;\n \n import com.google.common.base.Objects;\n+import com.google.common.base.Optional;\n import com.google.common.net.HostAndPort;\n \n public class UserAndHostAndPort implements Serializable {\n@@ -31,6 +32,14 @@ public static UserAndHostAndPort fromParts(String user, String host, int port) {\n         return new UserAndHostAndPort(user, HostAndPort.fromParts(host, port));\n     }\n \n+    public static UserAndHostAndPort fromParts(String user, String host, Optional<Integer> port) {\n+        HostAndPort hostAndPort = port.isPresent() ? HostAndPort.fromParts(host, port.get()) : HostAndPort.fromString(host);\n+        if (!port.isPresent() && hostAndPort.hasPort()) {\n+            throw new IllegalArgumentException(\"optional port absent, but host '\"+host+\"' parsed as containing port\");\n+        }\n+        return new UserAndHostAndPort(user, hostAndPort);\n+    }\n+\n     public static UserAndHostAndPort fromParts(String user, HostAndPort hostAndPort) {\n         return new UserAndHostAndPort(user, hostAndPort);\n     }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/8fe4140936792581b311cff39510b84f06ee22a0/utils/common/src/main/java/org/apache/brooklyn/util/net/UserAndHostAndPort.java",
                "sha": "558af0cb1a03a1372fa26148b73e0daa548259ae",
                "status": "modified"
            }
        ],
        "message": "BROOKLYN-303: Fix EmptyWindowsProcess\n\nPreviously gave NPE in driver",
        "parent": "https://github.com/apache/brooklyn-server/commit/82511c3b1602225f070258944935196174e8cd8b",
        "repo": "brooklyn-server",
        "unit_tests": [
            "UserAndHostAndPortTest.java"
        ]
    },
    "brooklyn-server_a039fb9": {
        "bug_id": "brooklyn-server_a039fb9",
        "commit": "https://github.com/apache/brooklyn-server/commit/a039fb95a98ff3a39828c372844c23f641d4925e",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/a039fb95a98ff3a39828c372844c23f641d4925e/policy/src/main/java/brooklyn/policy/followthesun/FollowTheSunPool.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/policy/src/main/java/brooklyn/policy/followthesun/FollowTheSunPool.java?ref=a039fb95a98ff3a39828c372844c23f641d4925e",
                "deletions": 1,
                "filename": "policy/src/main/java/brooklyn/policy/followthesun/FollowTheSunPool.java",
                "patch": "@@ -155,7 +155,7 @@ public Integer resize(Integer desiredSize) {\n \n     private void onContainerAdded(Entity newContainer) {\n         subscribe(newContainer, Startable.SERVICE_UP, eventHandler);\n-        if (!(newContainer instanceof Startable) || newContainer.getAttribute(Startable.SERVICE_UP)) {\n+        if (!(newContainer instanceof Startable) || Boolean.TRUE.equals(newContainer.getAttribute(Startable.SERVICE_UP))) {\n             onContainerUp(newContainer);\n         }\n     }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/a039fb95a98ff3a39828c372844c23f641d4925e/policy/src/main/java/brooklyn/policy/followthesun/FollowTheSunPool.java",
                "sha": "01869e0be4d2ab8bc4ddc592cf66c50a3c842762",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/a039fb95a98ff3a39828c372844c23f641d4925e/policy/src/main/java/brooklyn/policy/loadbalancing/BalanceableWorkerPool.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/policy/src/main/java/brooklyn/policy/loadbalancing/BalanceableWorkerPool.java?ref=a039fb95a98ff3a39828c372844c23f641d4925e",
                "deletions": 1,
                "filename": "policy/src/main/java/brooklyn/policy/loadbalancing/BalanceableWorkerPool.java",
                "patch": "@@ -168,7 +168,7 @@ public Integer resize(Integer desiredSize) {\n     \n     private void onContainerAdded(BalanceableContainer<?> newContainer) {\n         subscribe(newContainer, Startable.SERVICE_UP, eventHandler);\n-        if (!(newContainer instanceof Startable) || newContainer.getAttribute(Startable.SERVICE_UP)) {\n+        if (!(newContainer instanceof Startable) || Boolean.TRUE.equals(newContainer.getAttribute(Startable.SERVICE_UP))) {\n             onContainerUp(newContainer);\n         }\n     }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/a039fb95a98ff3a39828c372844c23f641d4925e/policy/src/main/java/brooklyn/policy/loadbalancing/BalanceableWorkerPool.java",
                "sha": "7dc3ac7b2cf11126d771256a2bbdb5ac3193c1dc",
                "status": "modified"
            }
        ],
        "message": "Fixed the NPE problems with the pools",
        "parent": "https://github.com/apache/brooklyn-server/commit/efcc1ade93f49c8736805e0ba0053647490d14e4",
        "repo": "brooklyn-server",
        "unit_tests": [
            "BalanceableWorkerPoolTest.java"
        ]
    },
    "brooklyn-server_a78b98c": {
        "bug_id": "brooklyn-server_a78b98c",
        "commit": "https://github.com/apache/brooklyn-server/commit/a78b98c9761b5e0c644da4aa0835d133402dfd91",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/a78b98c9761b5e0c644da4aa0835d133402dfd91/core/src/main/java/org/apache/brooklyn/core/mgmt/ha/HighAvailabilityManagerImpl.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/org/apache/brooklyn/core/mgmt/ha/HighAvailabilityManagerImpl.java?ref=a78b98c9761b5e0c644da4aa0835d133402dfd91",
                "deletions": 3,
                "filename": "core/src/main/java/org/apache/brooklyn/core/mgmt/ha/HighAvailabilityManagerImpl.java",
                "patch": "@@ -129,7 +129,7 @@\n     private static final Logger LOG = LoggerFactory.getLogger(HighAvailabilityManagerImpl.class);\n \n     private final ManagementContextInternal managementContext;\n-    private volatile String ownNodeId;\n+    private final String ownNodeId;\n     private volatile ManagementPlaneSyncRecordPersister persister;\n     private volatile PromotionListener promotionListener;\n     private volatile MasterChooser masterChooser = new AlphabeticMasterChooser();\n@@ -163,6 +163,7 @@ public long read() {\n \n     public HighAvailabilityManagerImpl(ManagementContextInternal managementContext) {\n         this.managementContext = managementContext;\n+        ownNodeId = managementContext.getManagementNodeId();\n         startTimeUtc = localTickerUtc.read();\n     }\n \n@@ -242,7 +243,6 @@ public boolean isRunning() {\n     @Override\n     public void disabled() {\n         disabled = true;\n-        ownNodeId = managementContext.getManagementNodeId();\n         // this is notionally the master, just not running; see javadoc for more info\n         stop(ManagementNodeState.MASTER);\n         \n@@ -276,7 +276,6 @@ public void changeMode(HighAvailabilityMode startMode, boolean preventElectionOn\n             }\n         }\n         \n-        ownNodeId = managementContext.getManagementNodeId();\n         // TODO Small race in that we first check, and then we'll do checkMaster() on first poll,\n         // so another node could have already become master or terminated in that window.\n         ManagementPlaneSyncRecord planeRec = loadManagementPlaneSyncRecord(false);",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/a78b98c9761b5e0c644da4aa0835d133402dfd91/core/src/main/java/org/apache/brooklyn/core/mgmt/ha/HighAvailabilityManagerImpl.java",
                "sha": "a4f88705fbcef111ba6015e3bf7f97184624a427",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/a78b98c9761b5e0c644da4aa0835d133402dfd91/core/src/main/java/org/apache/brooklyn/core/mgmt/internal/AbstractManagementContext.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/org/apache/brooklyn/core/mgmt/internal/AbstractManagementContext.java?ref=a78b98c9761b5e0c644da4aa0835d133402dfd91",
                "deletions": 0,
                "filename": "core/src/main/java/org/apache/brooklyn/core/mgmt/internal/AbstractManagementContext.java",
                "patch": "@@ -80,6 +80,7 @@\n import org.apache.brooklyn.util.exceptions.Exceptions;\n import org.apache.brooklyn.util.guava.Maybe;\n import org.apache.brooklyn.util.javalang.Reflections;\n+import org.apache.brooklyn.util.text.Strings;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n@@ -132,6 +133,7 @@ public BrooklynClassLoadingContext apply(@Nullable Object input) {\n     }\n \n     private final AtomicLong totalEffectorInvocationCount = new AtomicLong();\n+    private final String managementNodeId;\n \n     protected DeferredBrooklynProperties configMap;\n     protected Scratchpad scratchpad;\n@@ -163,6 +165,8 @@ public BrooklynClassLoadingContext apply(@Nullable Object input) {\n     protected CatalogInitialization catalogInitialization;\n \n     public AbstractManagementContext(BrooklynProperties brooklynProperties) {\n+        this.managementNodeId = Strings.makeRandomId(8);\n+\n         this.configMap = new DeferredBrooklynProperties(brooklynProperties, this);\n         this.scratchpad = new BasicScratchpad();\n         this.entityDriverManager = new BasicEntityDriverManager();\n@@ -200,6 +204,11 @@ public boolean isStartupComplete() {\n         return startupComplete;\n     }\n \n+    @Override\n+    public String getManagementNodeId() {\n+        return managementNodeId;\n+    }\n+    \n     @Override\n     public BrooklynStorage getStorage() {\n         return storage;",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/a78b98c9761b5e0c644da4aa0835d133402dfd91/core/src/main/java/org/apache/brooklyn/core/mgmt/internal/AbstractManagementContext.java",
                "sha": "b04cea437d1a48ed61917f695692c23cc594ad12",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/a78b98c9761b5e0c644da4aa0835d133402dfd91/core/src/main/java/org/apache/brooklyn/core/mgmt/internal/LocalManagementContext.java",
                "changes": 15,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/org/apache/brooklyn/core/mgmt/internal/LocalManagementContext.java?ref=a78b98c9761b5e0c644da4aa0835d133402dfd91",
                "deletions": 11,
                "filename": "core/src/main/java/org/apache/brooklyn/core/mgmt/internal/LocalManagementContext.java",
                "patch": "@@ -127,9 +127,8 @@ public static int terminateAll() {\n         return closed;\n     }\n \n-    private AtomicBoolean terminated = new AtomicBoolean(false);\n+    private final AtomicBoolean terminated = new AtomicBoolean(false);\n     private String managementPlaneId;\n-    private String managementNodeId;\n     private BasicExecutionManager execution;\n     private SubscriptionManager subscriptions;\n     private LocalEntityManager entityManager;\n@@ -172,7 +171,6 @@ public LocalManagementContext(Builder builder, Map<String, Object> brooklynAddit\n         \n         checkNotNull(configMap, \"brooklynProperties\");\n         \n-        this.managementNodeId = Strings.makeRandomId(8);\n         this.builder = builder;\n         this.brooklynAdditionalProperties = brooklynAdditionalProperties;\n         if (brooklynAdditionalProperties != null)\n@@ -206,24 +204,19 @@ public String getManagementPlaneId() {\n     \n     public void setManagementPlaneId(String newPlaneId) {\n         if (managementPlaneId != null && !managementPlaneId.equals(newPlaneId)) {\n-            log.warn(\"Management plane ID at {} {} changed from {} to {} (can happen on concurrent startup of multiple nodes)\", new Object[] { managementNodeId, getHighAvailabilityManager().getNodeState(), managementPlaneId, newPlaneId });\n-            log.debug(\"Management plane ID at {} {} changed from {} to {} (can happen on concurrent startup of multiple nodes)\", new Object[] {managementNodeId, getHighAvailabilityManager().getNodeState(), managementPlaneId, newPlaneId, new RuntimeException(\"Stack trace for setManagementPlaneId\")});\n+            log.warn(\"Management plane ID at {} {} changed from {} to {} (can happen on concurrent startup of multiple nodes)\", new Object[] { getManagementNodeId(), getHighAvailabilityManager().getNodeState(), managementPlaneId, newPlaneId });\n+            log.debug(\"Management plane ID at {} {} changed from {} to {} (can happen on concurrent startup of multiple nodes)\", new Object[] {getManagementNodeId(), getHighAvailabilityManager().getNodeState(), managementPlaneId, newPlaneId, new RuntimeException(\"Stack trace for setManagementPlaneId\")});\n         }\n         this.managementPlaneId = newPlaneId;\n     }\n \n     public void generateManagementPlaneId() {\n         if (this.managementPlaneId != null) {\n-            throw new IllegalStateException(\"Request to generate a management plane ID for node \"+managementNodeId+\" but one already exists (\" + managementPlaneId + \")\");\n+            throw new IllegalStateException(\"Request to generate a management plane ID for node \"+getManagementNodeId()+\" but one already exists (\" + managementPlaneId + \")\");\n         }\n         this.managementPlaneId = Strings.makeRandomId(8);\n     }\n     \n-    @Override\n-    public String getManagementNodeId() {\n-        return managementNodeId;\n-    }\n-    \n     @Override\n     public void prePreManage(Entity entity) {\n         getEntityManager().prePreManage(entity);",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/a78b98c9761b5e0c644da4aa0835d133402dfd91/core/src/main/java/org/apache/brooklyn/core/mgmt/internal/LocalManagementContext.java",
                "sha": "4836d7061a37b1a16ab7b423ec994c1c51629b7b",
                "status": "modified"
            }
        ],
        "message": "BROOKLYN-120: fix NPE in /v1/server/up/extended",
        "parent": "https://github.com/apache/brooklyn-server/commit/6e5c2c25230861fe2ccc002f8cd8830aca08e906",
        "repo": "brooklyn-server",
        "unit_tests": [
            "LocalManagementContextTest.java"
        ]
    },
    "brooklyn-server_a7f2d40": {
        "bug_id": "brooklyn-server_a7f2d40",
        "commit": "https://github.com/apache/brooklyn-server/commit/a7f2d402d0ef7e7961fc79e8076e7f6e8fb81370",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/a7f2d402d0ef7e7961fc79e8076e7f6e8fb81370/core/src/main/java/brooklyn/location/basic/SshMachineLocation.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/location/basic/SshMachineLocation.java?ref=a7f2d402d0ef7e7961fc79e8076e7f6e8fb81370",
                "deletions": 2,
                "filename": "core/src/main/java/brooklyn/location/basic/SshMachineLocation.java",
                "patch": "@@ -46,7 +46,6 @@\n import com.google.common.base.Preconditions;\n import com.google.common.base.Throwables;\n import com.google.common.collect.ImmutableList;\n-import com.google.common.collect.ImmutableMap;\n import com.google.common.collect.ImmutableSet;\n import com.google.common.collect.Maps;\n import com.google.common.collect.Sets;\n@@ -439,7 +438,7 @@ public int installTo(ResourceUtils loader, String url, String destination) {\n     \n     @Override\n     public String toString() {\n-        return address.toString();\n+        return (address != null) ? address.toString() : \"SshMachineLocation(null)\";\n     }\n \n     /**",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/a7f2d402d0ef7e7961fc79e8076e7f6e8fb81370/core/src/main/java/brooklyn/location/basic/SshMachineLocation.java",
                "sha": "9275374a162b0f0c7f5b68b38998478ee0650a51",
                "status": "modified"
            }
        ],
        "message": "Avoids npe in SshMachineLocation.toString\n\n(e.g. if exception during configure(), before address has been set).",
        "parent": "https://github.com/apache/brooklyn-server/commit/701818ef012910988ac2c5f3285e1b4b6de1e849",
        "repo": "brooklyn-server",
        "unit_tests": [
            "SshMachineLocationTest.java"
        ]
    },
    "brooklyn-server_b6a6565": {
        "bug_id": "brooklyn-server_b6a6565",
        "commit": "https://github.com/apache/brooklyn-server/commit/b6a65650e4a629eef3172c02a075df15419f9ffb",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/b6a65650e4a629eef3172c02a075df15419f9ffb/camp/camp-brooklyn/src/test/java/org/apache/brooklyn/camp/brooklyn/EmptyWindowsProcessYamlTest.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/camp/camp-brooklyn/src/test/java/org/apache/brooklyn/camp/brooklyn/EmptyWindowsProcessYamlTest.java?ref=b6a65650e4a629eef3172c02a075df15419f9ffb",
                "deletions": 2,
                "filename": "camp/camp-brooklyn/src/test/java/org/apache/brooklyn/camp/brooklyn/EmptyWindowsProcessYamlTest.java",
                "patch": "@@ -32,14 +32,17 @@\n @Test\n public class EmptyWindowsProcessYamlTest extends AbstractYamlTest {\n \n-    @Test(groups=\"Integration\")\n+    // takes couple of seconds unfortunately (why?!), but our only unit-test coverage of \n+    // EmptyWindowsProcess so including in unit tests anyway.\n+    @Test\n     public void testNoWinrm() throws Exception {\n         Entity app = createAndStartApplication(\n                 \"location: byon:(hosts=\\\"1.2.3.4\\\",osFamily=windows)\",\n                 \"services:\",\n                 \"- type: \"+EmptyWindowsProcess.class.getName(),\n                 \"  brooklyn.config:\",\n-                \"    winrmMonitoring.enabled: false\");\n+                \"    winrmMonitoring.enabled: false\",\n+                \"    onbox.base.dir.skipResolution: true\");\n         waitForApplicationTasks(app);\n \n         EmptyWindowsProcess entity = Iterables.getOnlyElement(Entities.descendants(app, EmptyWindowsProcess.class));",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/b6a65650e4a629eef3172c02a075df15419f9ffb/camp/camp-brooklyn/src/test/java/org/apache/brooklyn/camp/brooklyn/EmptyWindowsProcessYamlTest.java",
                "sha": "3eaa963589dd01e58f9495669bd90f36d71f14c2",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/b6a65650e4a629eef3172c02a075df15419f9ffb/software/base/src/main/java/org/apache/brooklyn/entity/software/base/EmptyWindowsProcessWinRmDriver.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/software/base/src/main/java/org/apache/brooklyn/entity/software/base/EmptyWindowsProcessWinRmDriver.java?ref=b6a65650e4a629eef3172c02a075df15419f9ffb",
                "deletions": 1,
                "filename": "software/base/src/main/java/org/apache/brooklyn/entity/software/base/EmptyWindowsProcessWinRmDriver.java",
                "patch": "@@ -28,6 +28,8 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+import com.google.common.base.Optional;\n+\n public class EmptyWindowsProcessWinRmDriver extends AbstractSoftwareProcessWinRmDriver implements VanillaWindowsProcessDriver {\n     @SuppressWarnings(\"unused\")\n     private static final Logger LOG = LoggerFactory.getLogger(EmptyWindowsProcessWinRmDriver.class);\n@@ -41,7 +43,8 @@ public EmptyWindowsProcessWinRmDriver(EmptyWindowsProcessImpl entity, WinRmMachi\n     @Override\n     public void start() {\n         WinRmMachineLocation machine = (WinRmMachineLocation) location;\n-        UserAndHostAndPort winrmAddress = UserAndHostAndPort.fromParts(machine.getUser(), machine.getAddress().getHostName(), entity.getConfig(WinRmTool.PROP_PORT));\n+        Integer port = entity.getConfig(WinRmTool.PROP_PORT);\n+        UserAndHostAndPort winrmAddress = UserAndHostAndPort.fromParts(machine.getUser(), machine.getAddress().getHostName(), Optional.fromNullable(port));\n         getEntity().sensors().set(Attributes.WINRM_ADDRESS, winrmAddress);\n \n         super.start();",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/b6a65650e4a629eef3172c02a075df15419f9ffb/software/base/src/main/java/org/apache/brooklyn/entity/software/base/EmptyWindowsProcessWinRmDriver.java",
                "sha": "c7842bae8c992a47b42cd6ae6b841b0911bd3a75",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/b6a65650e4a629eef3172c02a075df15419f9ffb/utils/common/src/main/java/org/apache/brooklyn/util/net/UserAndHostAndPort.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/utils/common/src/main/java/org/apache/brooklyn/util/net/UserAndHostAndPort.java?ref=b6a65650e4a629eef3172c02a075df15419f9ffb",
                "deletions": 0,
                "filename": "utils/common/src/main/java/org/apache/brooklyn/util/net/UserAndHostAndPort.java",
                "patch": "@@ -21,6 +21,7 @@\n import java.io.Serializable;\n \n import com.google.common.base.Objects;\n+import com.google.common.base.Optional;\n import com.google.common.net.HostAndPort;\n \n public class UserAndHostAndPort implements Serializable {\n@@ -31,6 +32,14 @@ public static UserAndHostAndPort fromParts(String user, String host, int port) {\n         return new UserAndHostAndPort(user, HostAndPort.fromParts(host, port));\n     }\n \n+    public static UserAndHostAndPort fromParts(String user, String host, Optional<Integer> port) {\n+        HostAndPort hostAndPort = port.isPresent() ? HostAndPort.fromParts(host, port.get()) : HostAndPort.fromString(host);\n+        if (!port.isPresent() && hostAndPort.hasPort()) {\n+            throw new IllegalArgumentException(\"optional port absent, but host '\"+host+\"' parsed as containing port\");\n+        }\n+        return new UserAndHostAndPort(user, hostAndPort);\n+    }\n+\n     public static UserAndHostAndPort fromParts(String user, HostAndPort hostAndPort) {\n         return new UserAndHostAndPort(user, hostAndPort);\n     }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/b6a65650e4a629eef3172c02a075df15419f9ffb/utils/common/src/main/java/org/apache/brooklyn/util/net/UserAndHostAndPort.java",
                "sha": "558af0cb1a03a1372fa26148b73e0daa548259ae",
                "status": "modified"
            }
        ],
        "message": "Closes #205\n\nBROOKLYN-303: Fix EmptyWindowsProcess\n\nPreviously gave NPE in driver",
        "parent": "https://github.com/apache/brooklyn-server/commit/460db56a4763feb7eb610c5657b8eca9d60585de",
        "repo": "brooklyn-server",
        "unit_tests": [
            "UserAndHostAndPortTest.java"
        ]
    },
    "brooklyn-server_bfe7f8c": {
        "bug_id": "brooklyn-server_bfe7f8c",
        "commit": "https://github.com/apache/brooklyn-server/commit/bfe7f8c8d31103c097cdda0205f20a2733e44c46",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/bfe7f8c8d31103c097cdda0205f20a2733e44c46/usage/rest-server/src/main/java/brooklyn/rest/resources/SensorResource.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/usage/rest-server/src/main/java/brooklyn/rest/resources/SensorResource.java?ref=bfe7f8c8d31103c097cdda0205f20a2733e44c46",
                "deletions": 1,
                "filename": "usage/rest-server/src/main/java/brooklyn/rest/resources/SensorResource.java",
                "patch": "@@ -124,7 +124,7 @@ public void delete(String application, String entityToken, String sensorName) {\n         final EntityLocal entity = brooklyn().getEntity(application, entityToken);\n         AttributeSensor<?> sensor = findSensor(entity, sensorName);\n         if (log.isDebugEnabled())\n-            log.debug(\"REST user \"+Entitlements.getEntitlementContext().user()+\" deleting sensor \"+sensorName);\n+            log.debug(\"REST user \"+Entitlements.getEntitlementContext()+\" deleting sensor \"+sensorName);\n         ((EntityInternal)entity).removeAttribute(sensor);\n     }\n     ",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/bfe7f8c8d31103c097cdda0205f20a2733e44c46/usage/rest-server/src/main/java/brooklyn/rest/resources/SensorResource.java",
                "sha": "fedd60dc9614620058012b4cbd7a61d9c43561fe",
                "status": "modified"
            }
        ],
        "message": "fix NPE in SensorResource",
        "parent": "https://github.com/apache/brooklyn-server/commit/fb265335b7bf9d082670431a9953e6eb48b9a859",
        "repo": "brooklyn-server",
        "unit_tests": [
            "SensorResourceTest.java"
        ]
    },
    "brooklyn-server_c545381": {
        "bug_id": "brooklyn-server_c545381",
        "commit": "https://github.com/apache/brooklyn-server/commit/c545381152a22df29d16c063fd6cd2fab4ec7b33",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/c545381152a22df29d16c063fd6cd2fab4ec7b33/rest/rest-resources/src/main/java/org/apache/brooklyn/rest/resources/CatalogResource.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/rest/rest-resources/src/main/java/org/apache/brooklyn/rest/resources/CatalogResource.java?ref=c545381152a22df29d16c063fd6cd2fab4ec7b33",
                "deletions": 1,
                "filename": "rest/rest-resources/src/main/java/org/apache/brooklyn/rest/resources/CatalogResource.java",
                "patch": "@@ -171,7 +171,7 @@ public String getMessage() {\n         public static BundleInstallationRestResult of(OsgiBundleInstallationResult in, ManagementContext mgmt, BrooklynRestResourceUtils brooklynU, UriInfo ui) {\n             BundleInstallationRestResult result = new BundleInstallationRestResult();\n             result.message = in.getMessage();\n-            result.bundle = in.getMetadata().getVersionedName().toString();\n+            result.bundle = in.getVersionedName() != null ? in.getVersionedName().toString() : \"\";\n             result.code = in.getCode();\n             if (in.getCatalogItemsInstalled()!=null) {\n                 result.types = MutableMap.of();",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/c545381152a22df29d16c063fd6cd2fab4ec7b33/rest/rest-resources/src/main/java/org/apache/brooklyn/rest/resources/CatalogResource.java",
                "sha": "2d7487d481152cdb8c8946b7390df09452520a3f",
                "status": "modified"
            }
        ],
        "message": "Check versionedName to avoid NPE.\n\nFixes break from https://github.com/apache/brooklyn-server/pull/672,\nI merged without re-running unit tests :-(",
        "parent": "https://github.com/apache/brooklyn-server/commit/57b9d7270ba87486f311020bf62b37105d4ca0e4",
        "repo": "brooklyn-server",
        "unit_tests": [
            "CatalogResourceTest.java"
        ]
    },
    "brooklyn-server_c713529": {
        "bug_id": "brooklyn-server_c713529",
        "commit": "https://github.com/apache/brooklyn-server/commit/c713529a99bdb4b22ed4035c4d1b9bff05229cd0",
        "file": [
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/c713529a99bdb4b22ed4035c4d1b9bff05229cd0/core/src/main/java/org/apache/brooklyn/core/mgmt/rebind/BasicCatalogItemRebindSupport.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/org/apache/brooklyn/core/mgmt/rebind/BasicCatalogItemRebindSupport.java?ref=c713529a99bdb4b22ed4035c4d1b9bff05229cd0",
                "deletions": 3,
                "filename": "core/src/main/java/org/apache/brooklyn/core/mgmt/rebind/BasicCatalogItemRebindSupport.java",
                "patch": "@@ -18,15 +18,12 @@\n  */\n package org.apache.brooklyn.core.mgmt.rebind;\n \n-import java.util.Set;\n-\n import org.apache.brooklyn.api.mgmt.rebind.RebindContext;\n import org.apache.brooklyn.api.mgmt.rebind.mementos.CatalogItemMemento;\n import org.apache.brooklyn.core.catalog.internal.CatalogItemDtoAbstract;\n import org.apache.brooklyn.core.typereg.BundleUpgradeParser.CatalogUpgrades;\n import org.apache.brooklyn.util.collections.MutableMap;\n import org.apache.brooklyn.util.core.flags.FlagUtils;\n-import org.apache.brooklyn.util.osgi.VersionedName;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n ",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/c713529a99bdb4b22ed4035c4d1b9bff05229cd0/core/src/main/java/org/apache/brooklyn/core/mgmt/rebind/BasicCatalogItemRebindSupport.java",
                "sha": "ee2871c2289f5e0d22f545d94a62687de218a924",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/c713529a99bdb4b22ed4035c4d1b9bff05229cd0/core/src/main/java/org/apache/brooklyn/core/typereg/BundleUpgradeParser.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/org/apache/brooklyn/core/typereg/BundleUpgradeParser.java?ref=c713529a99bdb4b22ed4035c4d1b9bff05229cd0",
                "deletions": 1,
                "filename": "core/src/main/java/org/apache/brooklyn/core/typereg/BundleUpgradeParser.java",
                "patch": "@@ -352,7 +352,8 @@ public static CatalogUpgrades getFromManagementContext(ManagementContext managem\n \n         @Beta\n         public static String getBundleUpgradedIfNecessary(ManagementContext mgmt, String vName) {\n-            if (vName==null) return null;\n+            // mgmt can be null in some edge cases, eg BasicCatalogItemRebindSupport.possiblyUpgradedBundle \n+            if (vName==null || mgmt==null) return null;\n             Maybe<OsgiManager> osgi = ((ManagementContextInternal)mgmt).getOsgiManager();\n             if (osgi.isAbsent()) {\n                 // ignore upgrades if not osgi",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/c713529a99bdb4b22ed4035c4d1b9bff05229cd0/core/src/main/java/org/apache/brooklyn/core/typereg/BundleUpgradeParser.java",
                "sha": "d808c24f66264e902e7c32fe5c9f1d2ebf506bb2",
                "status": "modified"
            }
        ],
        "message": "guard against possible NPE when rebinding legacy catalog items",
        "parent": "https://github.com/apache/brooklyn-server/commit/34016b66b0cfdfc2b4cff75ba7215832e417f40b",
        "repo": "brooklyn-server",
        "unit_tests": [
            "BundleUpgradeParserTest.java"
        ]
    },
    "brooklyn-server_c85d25f": {
        "bug_id": "brooklyn-server_c85d25f",
        "commit": "https://github.com/apache/brooklyn-server/commit/c85d25f2962f2e9ea39eeb04d8809449d01d3da6",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/c85d25f2962f2e9ea39eeb04d8809449d01d3da6/usage/rest-server/src/test/java/brooklyn/rest/BrooklynRestApiLauncher.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/usage/rest-server/src/test/java/brooklyn/rest/BrooklynRestApiLauncher.java?ref=c85d25f2962f2e9ea39eeb04d8809449d01d3da6",
                "deletions": 0,
                "filename": "usage/rest-server/src/test/java/brooklyn/rest/BrooklynRestApiLauncher.java",
                "patch": "@@ -171,6 +171,8 @@ public static Server startServer(ManagementContext mgmt, ContextHandler context,\n                 ((BrooklynProperties)mgmt.getConfig()).put(BrooklynWebConfig.SECURITY_PROVIDER_CLASSNAME, AnyoneSecurityProvider.class.getName());\n             }\n         }\n+        if (mgmt != null)\n+            mgmt.getHighAvailabilityManager().disabled();\n         InetSocketAddress bindLocation = new InetSocketAddress(\n                 secure ? Networking.ANY_NIC : Networking.LOOPBACK, \n                         Networking.nextAvailablePort(FAVOURITE_PORT));",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/c85d25f2962f2e9ea39eeb04d8809449d01d3da6/usage/rest-server/src/test/java/brooklyn/rest/BrooklynRestApiLauncher.java",
                "sha": "6465799758bb9eccc8a0a72232750a93afcf4fb2",
                "status": "modified"
            }
        ],
        "message": "Disable HA when running from BrooklynRestApiLauncher\n\nOtherwise HighAvailabilityManagerImpl throws NPE when creating\nmanagement record",
        "parent": "https://github.com/apache/brooklyn-server/commit/c461f9486254892a5da28a3c8375c3fb214f1ad9",
        "repo": "brooklyn-server",
        "unit_tests": [
            "BrooklynRestApiLauncherTest.java"
        ]
    },
    "brooklyn-server_d29a912": {
        "bug_id": "brooklyn-server_d29a912",
        "commit": "https://github.com/apache/brooklyn-server/commit/d29a912e1a4f9a6e1c88194d15ae614853734d7b",
        "file": [
            {
                "additions": 22,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/d29a912e1a4f9a6e1c88194d15ae614853734d7b/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "changes": 38,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java?ref=d29a912e1a4f9a6e1c88194d15ae614853734d7b",
                "deletions": 16,
                "filename": "locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "patch": "@@ -742,25 +742,31 @@ protected JcloudsSshMachineLocation obtainOnce(ConfigBag setup) throws NoMachine\n                 }\n \n                 if (setup.get(OPEN_IPTABLES)) {\n-                    customisationForLogging.add(\"open iptables\");\n-                    \n                     @SuppressWarnings(\"unchecked\")\n-                    List<String> iptablesRules = createIptablesRulesForNetworkInterface((Iterable<Integer>) setup.get(INBOUND_PORTS));\n-                    iptablesRules.add(IptablesCommands.saveIptablesRules());\n-                    List<String> batch = Lists.newArrayList();\n-                    // Some entities, such as Riak (erlang based) have a huge range of ports, which leads to a script that\n-                    // is too large to run (fails with a broken pipe). Batch the rules into batches of 50\n-                    for (String rule : iptablesRules) {\n-                        batch.add(rule);\n-                        if (batch.size() == 50) {\n-                            sshMachineLocation.execCommands(\"Inserting iptables rules, 50 command batch\", batch);\n-                            batch.clear();\n+                    Iterable<Integer> inboundPorts = (Iterable<Integer>) setup.get(INBOUND_PORTS);\n+                    \n+                    if (inboundPorts == null || Iterables.isEmpty(inboundPorts)) {\n+                        LOG.info(\"No ports to open in iptables (no inbound ports) for {} at {}\", sshMachineLocation, this);\n+                    } else {\n+                        customisationForLogging.add(\"open iptables\");\n+                        \n+                        List<String> iptablesRules = createIptablesRulesForNetworkInterface(inboundPorts);\n+                        iptablesRules.add(IptablesCommands.saveIptablesRules());\n+                        List<String> batch = Lists.newArrayList();\n+                        // Some entities, such as Riak (erlang based) have a huge range of ports, which leads to a script that\n+                        // is too large to run (fails with a broken pipe). Batch the rules into batches of 50\n+                        for (String rule : iptablesRules) {\n+                            batch.add(rule);\n+                            if (batch.size() == 50) {\n+                                sshMachineLocation.execCommands(\"Inserting iptables rules, 50 command batch\", batch);\n+                                batch.clear();\n+                            }\n                         }\n+                        if (batch.size() > 0) {\n+                            sshMachineLocation.execCommands(\"Inserting iptables rules\", batch);\n+                        }\n+                        sshMachineLocation.execCommands(\"List iptables rules\", ImmutableList.of(IptablesCommands.listIptablesRule()));\n                     }\n-                    if (batch.size() > 0) {\n-                        sshMachineLocation.execCommands(\"Inserting iptables rules\", batch);\n-                    }\n-                    sshMachineLocation.execCommands(\"List iptables rules\", ImmutableList.of(IptablesCommands.listIptablesRule()));\n                 }\n                 \n                 if (setup.get(STOP_IPTABLES)) {",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/d29a912e1a4f9a6e1c88194d15ae614853734d7b/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "sha": "706b3eefa95df870850d375206b85bc14e5ed187",
                "status": "modified"
            }
        ],
        "message": "Jclouds openIptables: avoid NPE if no inboundPorts",
        "parent": "https://github.com/apache/brooklyn-server/commit/524b660d64fc3873fa78478c31af44df02430efa",
        "repo": "brooklyn-server",
        "unit_tests": [
            "JcloudsLocationTest.java"
        ]
    },
    "brooklyn-server_d3c8dc1": {
        "bug_id": "brooklyn-server_d3c8dc1",
        "commit": "https://github.com/apache/brooklyn-server/commit/d3c8dc1f14f99049991c704c697138553c6f129b",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/d3c8dc1f14f99049991c704c697138553c6f129b/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java?ref=d3c8dc1f14f99049991c704c697138553c6f129b",
                "deletions": 1,
                "filename": "locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "patch": "@@ -1517,7 +1517,7 @@ protected JcloudsSshMachineLocation createJcloudsSshMachineLocation(ComputeServi\n     \n     protected Map<String,Object> extractSshConfig(ConfigBag setup, NodeMetadata node) {\n         ConfigBag nodeConfig = new ConfigBag();\n-        if (node!=null) {\n+        if (node!=null && node.getCredentials() != null) {\n             nodeConfig.putIfNotNull(PASSWORD, node.getCredentials().getPassword());\n             nodeConfig.putIfNotNull(PRIVATE_KEY_DATA, node.getCredentials().getPrivateKey());\n         }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/d3c8dc1f14f99049991c704c697138553c6f129b/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "sha": "51f5aa8ceb7c816c7302559f9ba7405fd5ac02b9",
                "status": "modified"
            }
        ],
        "message": "JcloudsLocation: avoid NPE on rebindMachine",
        "parent": "https://github.com/apache/brooklyn-server/commit/832007029a537dac5d35718e190640c86b8023ba",
        "repo": "brooklyn-server",
        "unit_tests": [
            "JcloudsLocationTest.java"
        ]
    },
    "brooklyn-server_ea43742": {
        "bug_id": "brooklyn-server_ea43742",
        "commit": "https://github.com/apache/brooklyn-server/commit/ea43742db5bf96dc37e4ced97c72c72c78318252",
        "file": [
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/ea43742db5bf96dc37e4ced97c72c72c78318252/core/src/main/java/brooklyn/management/internal/AbstractManagementContext.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/management/internal/AbstractManagementContext.java?ref=ea43742db5bf96dc37e4ced97c72c72c78318252",
                "deletions": 0,
                "filename": "core/src/main/java/brooklyn/management/internal/AbstractManagementContext.java",
                "patch": "@@ -275,15 +275,22 @@ public T call() {\n \n     protected abstract <T> Task<T> runAtEntity(final Entity entity, final Effector<T> eff, @SuppressWarnings(\"rawtypes\") final Map parameters);\n \n+    @Override\n     public abstract void addEntitySetListener(CollectionChangeListener<Entity> listener);\n \n+    @Override\n     public abstract void removeEntitySetListener(CollectionChangeListener<Entity> listener);\n     \n     @Override\n     public StringConfigMap getConfig() {\n         return configMap;\n     }\n \n+    @Override\n+    public BrooklynProperties getBrooklynProperties() {\n+        return configMap;\n+    }\n+\n     @Override\n     public synchronized LocationRegistry getLocationRegistry() {\n         if (locationRegistry==null) locationRegistry = new BasicLocationRegistry(this);",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/ea43742db5bf96dc37e4ced97c72c72c78318252/core/src/main/java/brooklyn/management/internal/AbstractManagementContext.java",
                "sha": "d5d353fba9804d284eef2177a3a8bc3d906d21dd",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/ea43742db5bf96dc37e4ced97c72c72c78318252/core/src/main/java/brooklyn/management/internal/ManagementContextInternal.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/management/internal/ManagementContextInternal.java?ref=ea43742db5bf96dc37e4ced97c72c72c78318252",
                "deletions": 0,
                "filename": "core/src/main/java/brooklyn/management/internal/ManagementContextInternal.java",
                "patch": "@@ -4,6 +4,7 @@\n import java.util.Map;\n import java.util.concurrent.ExecutionException;\n \n+import brooklyn.config.BrooklynProperties;\n import brooklyn.config.ConfigKey;\n import brooklyn.entity.Effector;\n import brooklyn.entity.Entity;\n@@ -41,4 +42,6 @@\n     <T> Task<T> invokeEffector(final Entity entity, final Effector<T> eff, @SuppressWarnings(\"rawtypes\") final Map parameters);\n \n     BrooklynStorage getStorage();\n+    \n+    BrooklynProperties getBrooklynProperties();\n }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/ea43742db5bf96dc37e4ced97c72c72c78318252/core/src/main/java/brooklyn/management/internal/ManagementContextInternal.java",
                "sha": "57139e3bdab9edee45c896b93b7045ed93ed61e3",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/ea43742db5bf96dc37e4ced97c72c72c78318252/core/src/main/java/brooklyn/management/internal/NonDeploymentManagementContext.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/management/internal/NonDeploymentManagementContext.java?ref=ea43742db5bf96dc37e4ced97c72c72c78318252",
                "deletions": 0,
                "filename": "core/src/main/java/brooklyn/management/internal/NonDeploymentManagementContext.java",
                "patch": "@@ -13,6 +13,7 @@\n import java.util.concurrent.TimeoutException;\n \n import brooklyn.catalog.BrooklynCatalog;\n+import brooklyn.config.BrooklynProperties;\n import brooklyn.config.StringConfigMap;\n import brooklyn.entity.Application;\n import brooklyn.entity.Effector;\n@@ -154,6 +155,12 @@ public StringConfigMap getConfig() {\n         return initialManagementContext.getConfig();\n     }\n \n+    @Override\n+    public BrooklynProperties getBrooklynProperties() {\n+        checkInitialManagementContextReal();\n+        return initialManagementContext.getBrooklynProperties();\n+    }\n+\n     @Override\n     public BrooklynStorage getStorage() {\n         checkInitialManagementContextReal();",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/ea43742db5bf96dc37e4ced97c72c72c78318252/core/src/main/java/brooklyn/management/internal/NonDeploymentManagementContext.java",
                "sha": "a4ef9b798647a2ae906645253f025f7a4ebffa57",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/ea43742db5bf96dc37e4ced97c72c72c78318252/usage/launcher/src/main/java/brooklyn/launcher/BrooklynLauncher.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/usage/launcher/src/main/java/brooklyn/launcher/BrooklynLauncher.java?ref=ea43742db5bf96dc37e4ced97c72c72c78318252",
                "deletions": 0,
                "filename": "usage/launcher/src/main/java/brooklyn/launcher/BrooklynLauncher.java",
                "patch": "@@ -331,7 +331,10 @@ protected BrooklynLauncher doLaunch() {\n                 brooklynProperties = builder.build();\n             }\n             managementContext = new LocalManagementContext(brooklynProperties);\n+        } else if (brooklynProperties == null) {\n+            brooklynProperties = ((ManagementContextInternal)managementContext).getBrooklynProperties();\n         }\n+        \n         for (Map.Entry<String, Object> entry : brooklynAdditionalProperties.entrySet()) {\n             brooklynProperties.put(entry.getKey(), entry.getValue());\n         }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/ea43742db5bf96dc37e4ced97c72c72c78318252/usage/launcher/src/main/java/brooklyn/launcher/BrooklynLauncher.java",
                "sha": "20425ed86bae779fc9d849ff5416e9e5f4bf55a6",
                "status": "modified"
            }
        ],
        "message": "Fix NPE when BrooklynLauncher given ManagementContext\n\n- caused by brooklynProperties being null",
        "parent": "https://github.com/apache/brooklyn-server/commit/b8a8d0783f59d54fae8efb003d89dcb4da74ec58",
        "repo": "brooklyn-server",
        "unit_tests": [
            "BrooklynLauncherTest.java"
        ]
    },
    "brooklyn-server_ec3ebf3": {
        "bug_id": "brooklyn-server_ec3ebf3",
        "commit": "https://github.com/apache/brooklyn-server/commit/ec3ebf35a94b3e83aa70297093737d3fc521f057",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/ec3ebf35a94b3e83aa70297093737d3fc521f057/software/base/src/main/java/brooklyn/entity/basic/SoftwareProcessEntity.groovy",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/software/base/src/main/java/brooklyn/entity/basic/SoftwareProcessEntity.groovy?ref=ec3ebf35a94b3e83aa70297093737d3fc521f057",
                "deletions": 2,
                "filename": "software/base/src/main/java/brooklyn/entity/basic/SoftwareProcessEntity.groovy",
                "patch": "@@ -1,5 +1,7 @@\n package brooklyn.entity.basic\n \n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n import groovy.time.TimeDuration\n \n import java.util.concurrent.TimeUnit\n@@ -219,9 +221,10 @@ public abstract class SoftwareProcessEntity extends AbstractEntity implements St\n \n     @Override\n \tpublic void start(Collection<? extends Location> locations) {\n+        checkNotNull(locations, \"locations\");\n \t\tsetAttribute(SERVICE_STATE, Lifecycle.STARTING)\n \t\tif (!sensorRegistry) sensorRegistry = new SensorRegistry(this)\n-\n+        \n \t\tstartInLocation locations\n \t\tpostStart()\n \t\tsensorRegistry.activateAdapters()\n@@ -234,7 +237,7 @@ public abstract class SoftwareProcessEntity extends AbstractEntity implements St\n \t\tif (locations.size() != 1) {\n             throw new IllegalArgumentException(\"Expected one location when starting \"+this+\", but given \"+locations);\n \t\t}\n-\t\tLocation location = Iterables.getOnlyElement(locations)\n+\t\tLocation location = checkNotNull(Iterables.getOnlyElement(locations), \"location\");\n \t\tstartInLocation(location)\n \t}\n ",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/ec3ebf35a94b3e83aa70297093737d3fc521f057/software/base/src/main/java/brooklyn/entity/basic/SoftwareProcessEntity.groovy",
                "sha": "48c94b5b82a1746b15a27d36ca42aff171804e0f",
                "status": "modified"
            }
        ],
        "message": "Avoid NPE on SoftwareProcessEntity.start(null)",
        "parent": "https://github.com/apache/brooklyn-server/commit/7c8fde76a7bbebc4dd95fe77605fc66383dc9990",
        "repo": "brooklyn-server",
        "unit_tests": [
            "SoftwareProcessEntityTest.java"
        ]
    },
    "brooklyn-server_f08b868": {
        "bug_id": "brooklyn-server_f08b868",
        "commit": "https://github.com/apache/brooklyn-server/commit/f08b868dbb755518810b42084ed6b22c6223c877",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/f08b868dbb755518810b42084ed6b22c6223c877/core/src/main/java/brooklyn/entity/basic/Attributes.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/entity/basic/Attributes.java?ref=f08b868dbb755518810b42084ed6b22c6223c877",
                "deletions": 1,
                "filename": "core/src/main/java/brooklyn/entity/basic/Attributes.java",
                "patch": "@@ -28,7 +28,7 @@\n     /**\n      * Application information sensors.\n      * \n-     * @deprecated since 0.5; see {@link ConfigKeys#SUGGESTED_VERSION}\n+     * @deprecated since 0.5; see {@link BrooklynConfigKeys#SUGGESTED_VERSION}\n      */\n     @Deprecated\n     AttributeSensor<String> VERSION = Sensors.newStringSensor( \"version\", \"Version information\");",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/f08b868dbb755518810b42084ed6b22c6223c877/core/src/main/java/brooklyn/entity/basic/Attributes.java",
                "sha": "6af95be92773598e35274f57ae13a63d05a65c51",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/f08b868dbb755518810b42084ed6b22c6223c877/core/src/main/java/brooklyn/entity/basic/ConfigKeys.java",
                "changes": 40,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/entity/basic/ConfigKeys.java?ref=f08b868dbb755518810b42084ed6b22c6223c877",
                "deletions": 40,
                "filename": "core/src/main/java/brooklyn/entity/basic/ConfigKeys.java",
                "patch": "@@ -136,44 +136,4 @@\n     public static ConfigKey<Boolean> newBooleanConfigKey(String name, String description, Boolean defaultValue) {\n         return newConfigKey(Boolean.class, name, description, defaultValue);\n     }\n-\n-    /* Key definitions were deprecated here in 0.6.0 because they introduce nasty circular dependencies on the\n-     * methods in this class, causing some final fields to be null when they are accessed. \n-     */\n-\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> BROOKLYN_DATA_DIR = BrooklynConfigKeys.BROOKLYN_DATA_DIR;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SUGGESTED_VERSION = BrooklynConfigKeys.SUGGESTED_VERSION;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SUGGESTED_INSTALL_DIR = BrooklynConfigKeys.SUGGESTED_INSTALL_DIR;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SUGGESTED_RUN_DIR = BrooklynConfigKeys.SUGGESTED_RUN_DIR;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<Boolean> START_LATCH = BrooklynConfigKeys.START_LATCH;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<Boolean> INSTALL_LATCH = BrooklynConfigKeys.INSTALL_LATCH;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<Boolean> CUSTOMIZE_LATCH = BrooklynConfigKeys.CUSTOMIZE_LATCH;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<Boolean> LAUNCH_LATCH = BrooklynConfigKeys.LAUNCH_LATCH;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<Integer> START_TIMEOUT = BrooklynConfigKeys.START_TIMEOUT;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SSH_TOOL_CLASS = BrooklynConfigKeys.SSH_TOOL_CLASS;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SSH_CONFIG_HOST = BrooklynConfigKeys.SSH_CONFIG_HOST;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<Integer> SSH_CONFIG_PORT = BrooklynConfigKeys.SSH_CONFIG_PORT;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SSH_CONFIG_USER = BrooklynConfigKeys.SSH_CONFIG_USER;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SSH_CONFIG_PASSWORD = BrooklynConfigKeys.SSH_CONFIG_PASSWORD;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SSH_CONFIG_SCRIPT_DIR = BrooklynConfigKeys.SSH_CONFIG_SCRIPT_DIR;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SSH_CONFIG_SCRIPT_HEADER = BrooklynConfigKeys.SSH_CONFIG_SCRIPT_HEADER;\n-    /** @deprecated since 0.6.0; use {@link BrooklynConfigKeys} to prevent classload ordering problems */ @Deprecated\n-    public static final ConfigKey<String> SSH_CONFIG_DIRECT_HEADER = BrooklynConfigKeys.SSH_CONFIG_DIRECT_HEADER;\n-\n }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/f08b868dbb755518810b42084ed6b22c6223c877/core/src/main/java/brooklyn/entity/basic/ConfigKeys.java",
                "sha": "f4a27a7a4921369b651e823e92de197bffa63c64",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/f08b868dbb755518810b42084ed6b22c6223c877/core/src/main/java/brooklyn/entity/drivers/downloads/DownloadSubstituters.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/entity/drivers/downloads/DownloadSubstituters.java?ref=f08b868dbb755518810b42084ed6b22c6223c877",
                "deletions": 3,
                "filename": "core/src/main/java/brooklyn/entity/drivers/downloads/DownloadSubstituters.java",
                "patch": "@@ -13,7 +13,7 @@\n \n import brooklyn.entity.Entity;\n import brooklyn.entity.basic.Attributes;\n-import brooklyn.entity.basic.ConfigKeys;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.entity.drivers.EntityDriver;\n import brooklyn.entity.drivers.downloads.DownloadResolverManager.DownloadRequirement;\n import brooklyn.entity.drivers.downloads.DownloadResolverManager.DownloadTargets;\n@@ -92,14 +92,14 @@ public static String substitute(DownloadRequirement req, String basevalue) {\n         Entity entity = driver.getEntity();\n         String type = entity.getEntityType().getName();\n         String simpleType = type.substring(type.lastIndexOf(\".\")+1);\n-        String version = entity.getConfig(ConfigKeys.SUGGESTED_VERSION);\n+        String version = entity.getConfig(BrooklynConfigKeys.SUGGESTED_VERSION);\n         \n         String v2 = entity.getAttribute(Attributes.VERSION);\n         if (v2!=null && !v2.equals(version)) {\n             // Attributes.VERSION was deprecated in 0.5.0 but was preferred here without warning in 0.6.0\n             // now warn on use of deprecated key when it is different\n             LOG.warn(\"Using deprecated key \"+Attributes.VERSION+\", value \"+v2+\", which differs from the \" +\n-            \t\t\"preferred key \"+ConfigKeys.SUGGESTED_VERSION+\", value \"+version+\"; old key will be retired shortly!\");\n+            \t\t\"preferred key \"+BrooklynConfigKeys.SUGGESTED_VERSION+\", value \"+version+\"; old key will be retired shortly!\");\n             version = v2;\n         }\n         ",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/f08b868dbb755518810b42084ed6b22c6223c877/core/src/main/java/brooklyn/entity/drivers/downloads/DownloadSubstituters.java",
                "sha": "40c20b919763cabf2551d035a31e69d6d8a09424",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/f08b868dbb755518810b42084ed6b22c6223c877/core/src/main/java/brooklyn/location/basic/ByonLocationResolver.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/location/basic/ByonLocationResolver.java?ref=f08b868dbb755518810b42084ed6b22c6223c877",
                "deletions": 2,
                "filename": "core/src/main/java/brooklyn/location/basic/ByonLocationResolver.java",
                "patch": "@@ -13,7 +13,7 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n-import brooklyn.entity.basic.ConfigKeys;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.location.LocationRegistry;\n import brooklyn.location.LocationResolver;\n import brooklyn.location.LocationSpec;\n@@ -135,7 +135,7 @@ public void init(ManagementContext managementContext) {\n         if (user != null) flags.put(\"user\", user);\n         if (name != null) flags.put(\"name\", name);\n         if (registry != null) {\n-            String brooklynDataDir = (String) registry.getProperties().get(ConfigKeys.BROOKLYN_DATA_DIR.getName());\n+            String brooklynDataDir = (String) registry.getProperties().get(BrooklynConfigKeys.BROOKLYN_DATA_DIR.getName());\n             if (brooklynDataDir != null && brooklynDataDir.length() > 0) {\n                 flags.put(\"localTempDir\", new File(brooklynDataDir));\n             }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/f08b868dbb755518810b42084ed6b22c6223c877/core/src/main/java/brooklyn/location/basic/ByonLocationResolver.java",
                "sha": "1b8df65dae914ddd952b818d255127373af6e718",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/f08b868dbb755518810b42084ed6b22c6223c877/core/src/main/java/brooklyn/location/basic/LocalhostResolver.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/location/basic/LocalhostResolver.java?ref=f08b868dbb755518810b42084ed6b22c6223c877",
                "deletions": 5,
                "filename": "core/src/main/java/brooklyn/location/basic/LocalhostResolver.java",
                "patch": "@@ -12,9 +12,7 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n-import brooklyn.config.ConfigKey;\n-import brooklyn.config.ConfigUtils;\n-import brooklyn.entity.basic.ConfigKeys;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.location.Location;\n import brooklyn.location.LocationRegistry;\n import brooklyn.location.LocationResolver;\n@@ -24,7 +22,6 @@\n import brooklyn.util.text.KeyValueParser;\n \n import com.google.common.collect.ImmutableSet;\n-import com.google.common.collect.Maps;\n import com.google.common.collect.Sets;\n \n /**\n@@ -96,7 +93,7 @@ protected Location newLocationFromString(String spec, brooklyn.location.Location\n             flags.put(\"name\", namePart);\n         }\n         if (registry != null) {\n-            String brooklynDataDir = (String) registry.getProperties().get(ConfigKeys.BROOKLYN_DATA_DIR.getName());\n+            String brooklynDataDir = (String) registry.getProperties().get(BrooklynConfigKeys.BROOKLYN_DATA_DIR.getName());\n             if (brooklynDataDir != null && brooklynDataDir.length() > 0) {\n                 flags.put(\"localTempDir\", new File(brooklynDataDir));\n             }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/f08b868dbb755518810b42084ed6b22c6223c877/core/src/main/java/brooklyn/location/basic/LocalhostResolver.java",
                "sha": "ebd0d7636ae686baa7aec6400bba64af49bb322b",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/f08b868dbb755518810b42084ed6b22c6223c877/core/src/test/java/brooklyn/entity/drivers/downloads/BasicDownloadsRegistryTest.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/test/java/brooklyn/entity/drivers/downloads/BasicDownloadsRegistryTest.java?ref=f08b868dbb755518810b42084ed6b22c6223c877",
                "deletions": 2,
                "filename": "core/src/test/java/brooklyn/entity/drivers/downloads/BasicDownloadsRegistryTest.java",
                "patch": "@@ -10,7 +10,7 @@\n import brooklyn.config.BrooklynProperties;\n import brooklyn.entity.basic.ApplicationBuilder;\n import brooklyn.entity.basic.Attributes;\n-import brooklyn.entity.basic.ConfigKeys;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.entity.basic.Entities;\n import brooklyn.entity.proxying.EntitySpec;\n import brooklyn.location.Location;\n@@ -89,7 +89,7 @@ public void testReturnsLocalRepoThenOverrideThenAttributeValThenCloudsoftUrlThen\n         brooklynProperties.put(\"brooklyn.downloads.all.url\", \"http://fromprops/${version}.allprimary\");\n         brooklynProperties.put(\"brooklyn.downloads.all.fallbackurl\", \"http://fromfallback/${version}.allfallback\");\n         entity.setAttribute(Attributes.DOWNLOAD_URL, \"http://fromattrib/${version}.default\");\n-        entity.setConfig(ConfigKeys.SUGGESTED_VERSION, \"myversion\");\n+        entity.setConfig(BrooklynConfigKeys.SUGGESTED_VERSION, \"myversion\");\n         String expectedFilename = \"myversion.allprimary\";\n \n         String expectedLocalRepo = String.format(\"file://$HOME/.brooklyn/repository/%s/%s/%s\", \"TestEntity\", \"myversion\", expectedFilename);",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/f08b868dbb755518810b42084ed6b22c6223c877/core/src/test/java/brooklyn/entity/drivers/downloads/BasicDownloadsRegistryTest.java",
                "sha": "e4d13d8fe85a0da239ea512ca9d6ca3f4b460bb2",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/f08b868dbb755518810b42084ed6b22c6223c877/core/src/test/java/brooklyn/entity/drivers/downloads/DownloadProducerFromPropertiesTest.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/test/java/brooklyn/entity/drivers/downloads/DownloadProducerFromPropertiesTest.java?ref=f08b868dbb755518810b42084ed6b22c6223c877",
                "deletions": 4,
                "filename": "core/src/test/java/brooklyn/entity/drivers/downloads/DownloadProducerFromPropertiesTest.java",
                "patch": "@@ -10,7 +10,7 @@\n \n import brooklyn.config.BrooklynProperties;\n import brooklyn.entity.basic.ApplicationBuilder;\n-import brooklyn.entity.basic.ConfigKeys;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.entity.basic.Entities;\n import brooklyn.entity.drivers.downloads.DownloadResolverManager.DownloadRequirement;\n import brooklyn.entity.drivers.downloads.DownloadResolverManager.DownloadTargets;\n@@ -79,7 +79,7 @@ public void testReturnsGlobalFallbackUrl() throws Exception {\n     @Test\n     public void testSubstitutionsAppliedToFallbackUrl() throws Exception {\n         brooklynProperties.put(\"brooklyn.downloads.all.fallbackurl\", \"version=${version}\");\n-        entity.setConfig(ConfigKeys.SUGGESTED_VERSION, \"myversion\");\n+        entity.setConfig(BrooklynConfigKeys.SUGGESTED_VERSION, \"myversion\");\n         assertResolves(ImmutableList.<String>of(), ImmutableList.of(\"version=myversion\"));\n     }\n \n@@ -93,15 +93,15 @@ public void testReturnsGlobalFallbackUrlAsLast() throws Exception {\n     @Test\n     public void testReturnsGlobalUrlWithEntitySubstituions() throws Exception {\n         brooklynProperties.put(\"brooklyn.downloads.all.url\", \"version=${version}\");\n-        entity.setConfig(ConfigKeys.SUGGESTED_VERSION, \"myversion\");\n+        entity.setConfig(BrooklynConfigKeys.SUGGESTED_VERSION, \"myversion\");\n         assertResolves(\"version=myversion\");\n     }\n     \n     @Test\n     public void testEntitySpecificUrlOverridesGlobalUrl() throws Exception {\n         brooklynProperties.put(\"brooklyn.downloads.all.url\", \"version=${version}\");\n         brooklynProperties.put(\"brooklyn.downloads.entity.TestEntity.url\", \"overridden,version=${version}\");\n-        entity.setConfig(ConfigKeys.SUGGESTED_VERSION, \"myversion\");\n+        entity.setConfig(BrooklynConfigKeys.SUGGESTED_VERSION, \"myversion\");\n         assertResolves(\"overridden,version=myversion\", \"version=myversion\");\n     }\n     ",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/f08b868dbb755518810b42084ed6b22c6223c877/core/src/test/java/brooklyn/entity/drivers/downloads/DownloadProducerFromPropertiesTest.java",
                "sha": "f169bee621189aa2186d80cd49946c45e34503ce",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/f08b868dbb755518810b42084ed6b22c6223c877/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsByonLocationResolver.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsByonLocationResolver.java?ref=f08b868dbb755518810b42084ed6b22c6223c877",
                "deletions": 2,
                "filename": "locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsByonLocationResolver.java",
                "patch": "@@ -12,7 +12,7 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n-import brooklyn.entity.basic.ConfigKeys;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.location.LocationRegistry;\n import brooklyn.location.LocationResolver;\n import brooklyn.location.LocationSpec;\n@@ -147,7 +147,7 @@ public void init(ManagementContext managementContext) {\n         if (user != null) flags.put(\"user\", user);\n         if (name != null) flags.put(\"name\", name);\n         if (registry != null) {\n-            String brooklynDataDir = (String) registry.getProperties().get(ConfigKeys.BROOKLYN_DATA_DIR.getName());\n+            String brooklynDataDir = (String) registry.getProperties().get(BrooklynConfigKeys.BROOKLYN_DATA_DIR.getName());\n             if (brooklynDataDir != null && brooklynDataDir.length() > 0) {\n                 flags.put(\"localTempDir\", new File(brooklynDataDir));\n             }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/f08b868dbb755518810b42084ed6b22c6223c877/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsByonLocationResolver.java",
                "sha": "e9ac5b600cbd96274ed6a9a4f27a727e4874b6b4",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/f08b868dbb755518810b42084ed6b22c6223c877/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsPropertiesFromBrooklynProperties.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsPropertiesFromBrooklynProperties.java?ref=f08b868dbb755518810b42084ed6b22c6223c877",
                "deletions": 2,
                "filename": "locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsPropertiesFromBrooklynProperties.java",
                "patch": "@@ -7,7 +7,7 @@\n import org.slf4j.LoggerFactory;\n \n import brooklyn.config.ConfigUtils;\n-import brooklyn.entity.basic.ConfigKeys;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.location.basic.DeprecatedKeysMappingBuilder;\n import brooklyn.location.basic.LocationPropertiesFromBrooklynProperties;\n \n@@ -74,7 +74,7 @@\n         jcloudsProperties.putAll(transformDeprecated(getProviderOrApiJcloudsProperties(providerOrApi, properties)));\n         jcloudsProperties.putAll(transformDeprecated(getRegionJcloudsProperties(providerOrApi, regionName, properties)));\n         if (!Strings.isNullOrEmpty(namedLocation)) jcloudsProperties.putAll(transformDeprecated(getNamedJcloudsProperties(namedLocation, properties)));\n-        String brooklynDataDir = (String) properties.get(ConfigKeys.BROOKLYN_DATA_DIR.getName());\n+        String brooklynDataDir = (String) properties.get(BrooklynConfigKeys.BROOKLYN_DATA_DIR.getName());\n         if (brooklynDataDir != null && brooklynDataDir.length() > 0) {\n             jcloudsProperties.put(\"localTempDir\", new File(brooklynDataDir));\n         }",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/f08b868dbb755518810b42084ed6b22c6223c877/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsPropertiesFromBrooklynProperties.java",
                "sha": "a3cef2ce3ffe8ec88bb3be62b4c8c370cbaa21ab",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/f08b868dbb755518810b42084ed6b22c6223c877/software/base/src/main/java/brooklyn/entity/basic/AbstractSoftwareProcessDriver.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/software/base/src/main/java/brooklyn/entity/basic/AbstractSoftwareProcessDriver.java?ref=f08b868dbb755518810b42084ed6b22c6223c877",
                "deletions": 5,
                "filename": "software/base/src/main/java/brooklyn/entity/basic/AbstractSoftwareProcessDriver.java",
                "patch": "@@ -56,17 +56,17 @@ public void rebind() {\n \t@Override\n \tpublic void start() {\n \t    DynamicTasks.queue(\"install\", new Runnable() { public void run() {\n-            waitForConfigKey(ConfigKeys.INSTALL_LATCH);\n+            waitForConfigKey(BrooklynConfigKeys.INSTALL_LATCH);\n             install();\n         }});\n         \n \t    DynamicTasks.queue(\"customize\", new Runnable() { public void run() {\n-            waitForConfigKey(ConfigKeys.CUSTOMIZE_LATCH);\n+            waitForConfigKey(BrooklynConfigKeys.CUSTOMIZE_LATCH);\n             customize();\n         }});\n         \n \t    DynamicTasks.queue(\"launch\", new Runnable() { public void run() {\n-            waitForConfigKey(ConfigKeys.LAUNCH_LATCH);\n+            waitForConfigKey(BrooklynConfigKeys.LAUNCH_LATCH);\n             launch();\n         }});\n         \n@@ -113,9 +113,11 @@ public void restart() {\n         }});\n \t}\n \t\n-\tpublic EntityLocal getEntity() { return entity; } \n+\t@Override\n+    public EntityLocal getEntity() { return entity; } \n \n-\tpublic Location getLocation() { return location; } \n+\t@Override\n+    public Location getLocation() { return location; } \n     \n     public InputStream getResource(String url) {\n         return new ResourceUtils(entity).getResourceFromUrl(url);",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/f08b868dbb755518810b42084ed6b22c6223c877/software/base/src/main/java/brooklyn/entity/basic/AbstractSoftwareProcessDriver.java",
                "sha": "1adc1ee0948935095c2056ec67f77797f7c71083",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/f08b868dbb755518810b42084ed6b22c6223c877/software/base/src/main/java/brooklyn/entity/brooklynnode/BrooklynNode.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/software/base/src/main/java/brooklyn/entity/brooklynnode/BrooklynNode.java?ref=f08b868dbb755518810b42084ed6b22c6223c877",
                "deletions": 1,
                "filename": "software/base/src/main/java/brooklyn/entity/brooklynnode/BrooklynNode.java",
                "patch": "@@ -5,6 +5,7 @@\n import java.util.Map;\n \n import brooklyn.config.ConfigKey;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.entity.basic.ConfigKeys;\n import brooklyn.entity.basic.SoftwareProcess;\n import brooklyn.entity.java.UsesJava;\n@@ -31,7 +32,7 @@\n             Map.class, \"brooklynnode.copytorundir\", \"URLs of resources to be copied across to the server, giving the path they are to be copied to\", MutableMap.of());\n     \n     @SetFromFlag(\"version\")\n-    public static final ConfigKey<String> SUGGESTED_VERSION = ConfigKeys.newConfigKeyWithDefault(ConfigKeys.SUGGESTED_VERSION, \"0.6.0-SNAPSHOT\"); // BROOKLYN_VERSION\n+    public static final ConfigKey<String> SUGGESTED_VERSION = ConfigKeys.newConfigKeyWithDefault(BrooklynConfigKeys.SUGGESTED_VERSION, \"0.6.0-SNAPSHOT\"); // BROOKLYN_VERSION\n \n     // Takes presidence over downloadUrl, if non-null\n     @SetFromFlag(\"distroUploadUrl\")",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/f08b868dbb755518810b42084ed6b22c6223c877/software/base/src/main/java/brooklyn/entity/brooklynnode/BrooklynNode.java",
                "sha": "b41bcad9694a57a5a38b1fe0917255d6bf0684bb",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/f08b868dbb755518810b42084ed6b22c6223c877/software/base/src/test/java/brooklyn/entity/basic/lifecycle/StartStopSshDriverTest.groovy",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/software/base/src/test/java/brooklyn/entity/basic/lifecycle/StartStopSshDriverTest.groovy?ref=f08b868dbb755518810b42084ed6b22c6223c877",
                "deletions": 5,
                "filename": "software/base/src/test/java/brooklyn/entity/basic/lifecycle/StartStopSshDriverTest.groovy",
                "patch": "@@ -12,8 +12,7 @@ import org.testng.annotations.BeforeMethod\n import org.testng.annotations.Test\n \n import brooklyn.entity.basic.AbstractSoftwareProcessSshDriver\n-import brooklyn.entity.basic.ConfigKeys\n-import brooklyn.entity.basic.Entities;\n+import brooklyn.entity.basic.BrooklynConfigKeys\n import brooklyn.location.basic.SshMachineLocation\n import brooklyn.test.entity.TestApplication\n import brooklyn.test.entity.TestApplicationImpl\n@@ -22,7 +21,7 @@ import brooklyn.test.entity.TestEntityImpl\n import brooklyn.util.internal.ssh.SshTool\n import brooklyn.util.internal.ssh.cli.SshCliTool\n import brooklyn.util.internal.ssh.sshj.SshjTool\n-import brooklyn.util.stream.StreamGobbler;\n+import brooklyn.util.stream.StreamGobbler\n \n class StartStopSshDriverTest {\n \n@@ -69,7 +68,7 @@ class StartStopSshDriverTest {\n \n     @Test(groups = [ \"Integration\" ])\n     public void testSshScriptHeaderUsedWhenSpecified() {\n-        entity.setConfig(ConfigKeys.SSH_CONFIG_SCRIPT_HEADER, \"#!/bin/bash -e\\necho hello world\");\n+        entity.setConfig(BrooklynConfigKeys.SSH_CONFIG_SCRIPT_HEADER, \"#!/bin/bash -e\\necho hello world\");\n         ByteArrayOutputStream out = new ByteArrayOutputStream();\n         driver.execute(out: out, Arrays.asList(\"echo goodbye\"), \"test\");\n         String s = out.toString();\n@@ -81,7 +80,7 @@ class StartStopSshDriverTest {\n \n     @Test(groups = [ \"Integration\" ])\n     public void testSshCliPickedUpWhenSpecified() {\n-        entity.setConfig(ConfigKeys.SSH_TOOL_CLASS, SshCliTool.class.getName());\n+        entity.setConfig(BrooklynConfigKeys.SSH_TOOL_CLASS, SshCliTool.class.getName());\n         driver.execute(Arrays.asList(\"echo hi\"), \"test\");\n         assertTrue(sshMachineLocation.lastTool instanceof SshCliTool, \"expect CLI tool, got \"+\n                         (sshMachineLocation.lastTool!=null ? \"\"+sshMachineLocation.lastTool.getClass()+\":\" : \"\") + sshMachineLocation.lastTool);",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/f08b868dbb755518810b42084ed6b22c6223c877/software/base/src/test/java/brooklyn/entity/basic/lifecycle/StartStopSshDriverTest.groovy",
                "sha": "84fdd44175812bd176981070400146c8c0830db6",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/f08b868dbb755518810b42084ed6b22c6223c877/usage/launcher/src/main/java/brooklyn/launcher/BrooklynWebServer.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/usage/launcher/src/main/java/brooklyn/launcher/BrooklynWebServer.java?ref=f08b868dbb755518810b42084ed6b22c6223c877",
                "deletions": 2,
                "filename": "usage/launcher/src/main/java/brooklyn/launcher/BrooklynWebServer.java",
                "patch": "@@ -30,7 +30,7 @@\n import brooklyn.BrooklynVersion;\n import brooklyn.config.BrooklynServiceAttributes;\n import brooklyn.config.ConfigKey;\n-import brooklyn.entity.basic.ConfigKeys;\n+import brooklyn.entity.basic.BrooklynConfigKeys;\n import brooklyn.launcher.config.CustomResourceLocator;\n import brooklyn.location.PortRange;\n import brooklyn.location.basic.LocalhostMachineProvisioningLocation;\n@@ -147,7 +147,7 @@ public BrooklynWebServer(Map flags, ManagementContext managementContext) {\n         if (!leftovers.isEmpty())\n             log.warn(\"Ignoring unknown flags \" + leftovers);\n         \n-        String brooklynDataDir = checkNotNull(managementContext.getConfig().getConfig(ConfigKeys.BROOKLYN_DATA_DIR));\n+        String brooklynDataDir = checkNotNull(managementContext.getConfig().getConfig(BrooklynConfigKeys.BROOKLYN_DATA_DIR));\n         this.webappTempDir = new File(brooklynDataDir, \"jetty\");\n     }\n ",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/f08b868dbb755518810b42084ed6b22c6223c877/usage/launcher/src/main/java/brooklyn/launcher/BrooklynWebServer.java",
                "sha": "12d43ef9ba9ae8b384bb3130d0319a0057c4f865",
                "status": "modified"
            }
        ],
        "message": "Deletes keys defined in ConfigKeys\n\n- Update all uses to the new BrooklynConfigKeys\n- Was previously deprecated, with fields in ConfigKeys referencing\n  those in BrooklynConfigKeys. But this led to strange NPEs where\n  ConfigKeys fields were null (presumably due to ordering of\n  initialising the two classes' fields)!\n- Breaks backwards compatibility, but better to have a compilation error\n  than a weird NPE.",
        "parent": "https://github.com/apache/brooklyn-server/commit/b98c6f3bc74a7dcd91b372109540bf18622e560a",
        "repo": "brooklyn-server",
        "unit_tests": [
            "BrooklynWebServerTest.java"
        ]
    },
    "brooklyn-server_f787be3": {
        "bug_id": "brooklyn-server_f787be3",
        "commit": "https://github.com/apache/brooklyn-server/commit/f787be37fa3b04d9e702cdc6e74dbbddd43f362c",
        "file": [
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/f787be37fa3b04d9e702cdc6e74dbbddd43f362c/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "changes": 30,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java?ref=f787be37fa3b04d9e702cdc6e74dbbddd43f362c",
                "deletions": 11,
                "filename": "locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "patch": "@@ -580,27 +580,35 @@ public void apply(TemplateOptions t, ConfigBag props, Object v) {\n                     }})\n             .put(LOGIN_USER, new CustomizeTemplateOptions() {\n                     public void apply(TemplateOptions t, ConfigBag props, Object v) {\n-                        t.overrideLoginUser(((CharSequence)v).toString());\n+                        if (v != null) {\n+                            t.overrideLoginUser(((CharSequence)v).toString());\n+                        }\n                     }})\n             .put(LOGIN_USER_PASSWORD, new CustomizeTemplateOptions() {\n                     public void apply(TemplateOptions t, ConfigBag props, Object v) {\n-                        t.overrideLoginPassword(((CharSequence)v).toString());\n+                        if (v != null) {\n+                            t.overrideLoginPassword(((CharSequence)v).toString());\n+                        }\n                     }})\n             .put(LOGIN_USER_PRIVATE_KEY_FILE, new CustomizeTemplateOptions() {\n                     public void apply(TemplateOptions t, ConfigBag props, Object v) {\n-                        String privateKeyFileName = ((CharSequence)v).toString();\n-                        String privateKey;\n-                        try {\n-                            privateKey = Files.toString(new File(ResourceUtils.tidyFilePath(privateKeyFileName)), Charsets.UTF_8);\n-                        } catch (IOException e) {\n-                            LOG.error(privateKeyFileName + \"not found\", e);\n-                            throw Exceptions.propagate(e);\n+                        if (v != null) {\n+                            String privateKeyFileName = ((CharSequence)v).toString();\n+                            String privateKey;\n+                            try {\n+                                privateKey = Files.toString(new File(ResourceUtils.tidyFilePath(privateKeyFileName)), Charsets.UTF_8);\n+                            } catch (IOException e) {\n+                                LOG.error(privateKeyFileName + \"not found\", e);\n+                                throw Exceptions.propagate(e);\n+                            }\n+                            t.overrideLoginPrivateKey(privateKey);\n                         }\n-                        t.overrideLoginPrivateKey(privateKey);\n                     }})\n             .put(LOGIN_USER_PRIVATE_KEY_DATA, new CustomizeTemplateOptions() {\n                     public void apply(TemplateOptions t, ConfigBag props, Object v) {\n-                        t.overrideLoginPrivateKey(((CharSequence)v).toString());\n+                        if (v != null) {\n+                            t.overrideLoginPrivateKey(((CharSequence)v).toString());\n+                        }\n                     }})                    \n             .put(KEY_PAIR, new CustomizeTemplateOptions() {\n                     public void apply(TemplateOptions t, ConfigBag props, Object v) {",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/f787be37fa3b04d9e702cdc6e74dbbddd43f362c/locations/jclouds/src/main/java/brooklyn/location/jclouds/JcloudsLocation.java",
                "sha": "dc20f471bd6dc48659e17878e72b700e8b39ba9a",
                "status": "modified"
            }
        ],
        "message": "JcloudsLocation: support unsetting config\n\n- if set null loginUser, loginUserPassword, etc then don't pass it\n  through to jclouds (i.e. don't NPE)",
        "parent": "https://github.com/apache/brooklyn-server/commit/462fd6e65ae33367a2174a193e6ef241f28cd842",
        "repo": "brooklyn-server",
        "unit_tests": [
            "JcloudsLocationTest.java"
        ]
    },
    "brooklyn-server_f9b52ce": {
        "bug_id": "brooklyn-server_f9b52ce",
        "commit": "https://github.com/apache/brooklyn-server/commit/f9b52ce37f395e44aed819794957f4ed88811b38",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/f9b52ce37f395e44aed819794957f4ed88811b38/utils/common/src/main/java/brooklyn/util/collections/Jsonya.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/utils/common/src/main/java/brooklyn/util/collections/Jsonya.java?ref=f9b52ce37f395e44aed819794957f4ed88811b38",
                "deletions": 1,
                "filename": "utils/common/src/main/java/brooklyn/util/collections/Jsonya.java",
                "patch": "@@ -213,9 +213,10 @@ protected void putInternal(Map target, Object k1, Object v1, Object ...kvOthers)\n             }\n         }\n \n-        /** as {@link #put(Object, Object, Object...)} for the kv-pairs in the given map */\n+        /** as {@link #put(Object, Object, Object...)} for the kv-pairs in the given map; ignores null for convenience */\n         public Navigator<T> put(Map map) {\n             map();\n+            if (map==null) return this;\n             ((Map)focus).putAll((Map)translate(map));\n             return this;\n         }\n@@ -388,6 +389,8 @@ protected void addFlattened(Collection target, Object item) {\n             target.add(translate(item));\n         }\n         \n+        /** Returns JSON serialized output for given focus in the given jsonya;\n+         * applies a naive toString for specialized types */\n         @Override\n         public String toString() {\n             return render(get());",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/f9b52ce37f395e44aed819794957f4ed88811b38/utils/common/src/main/java/brooklyn/util/collections/Jsonya.java",
                "sha": "c4bac406647a98e9dbf5f6b66218fd31d5fc5276",
                "status": "modified"
            }
        ],
        "message": "jsonya now no-op if put(null), previously threw NPE",
        "parent": "https://github.com/apache/brooklyn-server/commit/137209577b35f97bf1927b0c0d8e00928a0e933c",
        "repo": "brooklyn-server",
        "unit_tests": [
            "JsonyaTest.java"
        ]
    },
    "brooklyn-server_fe1aec0": {
        "bug_id": "brooklyn-server_fe1aec0",
        "commit": "https://github.com/apache/brooklyn-server/commit/fe1aec08f9cf3524d508ae5796603361f21dfde1",
        "file": [
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/brooklyn-server/blob/fe1aec08f9cf3524d508ae5796603361f21dfde1/core/src/main/java/brooklyn/location/basic/SshMachineLocation.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/brooklyn-server/contents/core/src/main/java/brooklyn/location/basic/SshMachineLocation.java?ref=fe1aec08f9cf3524d508ae5796603361f21dfde1",
                "deletions": 3,
                "filename": "core/src/main/java/brooklyn/location/basic/SshMachineLocation.java",
                "patch": "@@ -345,10 +345,12 @@ public void init() {\n     \n     @Override\n     public void close() throws IOException {\n-        if (LOG.isDebugEnabled()) {\n-            LOG.debug(\"{} invalidating all entries in ssh pool cache. Final stats: {}\", this, sshPoolCache.stats());\n+        if (sshPoolCache != null) {\n+            if (LOG.isDebugEnabled()) {\n+                LOG.debug(\"{} invalidating all entries in ssh pool cache. Final stats: {}\", this, sshPoolCache.stats());\n+            }\n+            sshPoolCache.invalidateAll();\n         }\n-        sshPoolCache.invalidateAll();\n         if (cleanupTask != null) cleanupTask.cancel(false);\n     }\n \n@@ -389,6 +391,10 @@ public int getPort() {\n     }\n \n     protected <T> T execSsh(Map<String, ?> props, Function<ShellTool, T> task) {\n+        if (sshPoolCache == null) {\n+            // required for uses that instantiate SshMachineLocation directly, so init() will not have been called\n+            sshPoolCache = buildSshToolPoolCacheLoader();\n+        }\n         Pool<SshTool> pool = sshPoolCache.getUnchecked(props);\n         if (LOG.isTraceEnabled()) {\n             LOG.trace(\"{} execSsh got pool: {}\", this, pool);",
                "raw_url": "https://github.com/apache/brooklyn-server/raw/fe1aec08f9cf3524d508ae5796603361f21dfde1/core/src/main/java/brooklyn/location/basic/SshMachineLocation.java",
                "sha": "3bcb45131aac6c1b03dca25ac21c54669dac86fb",
                "status": "modified"
            }
        ],
        "message": "Fix SshMachineLocation NPE\n\n- sshPoolCache initialisation was moved to init() previously\n  But for things that instantiate SshMachineLocation directly then\n  the framework won't have called init.",
        "parent": "https://github.com/apache/brooklyn-server/commit/2ec4c9eb0ddaf57cc045ab910de4a1e98557889a",
        "repo": "brooklyn-server",
        "unit_tests": [
            "SshMachineLocationTest.java"
        ]
    }
}