[
    {
        "repo": "commons-configuration",
        "commit": "https://github.com/apache/commons-configuration/commit/746821e2568246d8d7b09403f68930ab000a9592",
        "bug_id": "commons-configuration_746821e",
        "message": "[CONFIGURATION-767] NullPointerException in\nXMLConfiguration#createTransformer() when no FileLocator is set.",
        "parent": "https://github.com/apache/commons-configuration/commit/a76a3a65c4d2e3530c69c1fecc6e4fe6f2f221ed",
        "patched_files": [
            "changes.xml",
            "XMLConfiguration.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/commons-configuration/raw/746821e2568246d8d7b09403f68930ab000a9592/src/changes/changes.xml",
                "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/changes/changes.xml?ref=746821e2568246d8d7b09403f68930ab000a9592",
                "filename": "src/changes/changes.xml",
                "deletions": 0,
                "sha": "ad5d6da91862deba0b1ee8077cfe4a63adb2a88c",
                "blob_url": "https://github.com/apache/commons-configuration/blob/746821e2568246d8d7b09403f68930ab000a9592/src/changes/changes.xml",
                "patch": "@@ -41,6 +41,9 @@\n       <action dev=\"ggregory\" type=\"add\" issue=\"CONFIGURATION-765\" due-to=\"Gary Gregory\">\r\n         Refactor XMLConfiguration.write(Writer) to add XMLConfiguration.write(Writer, Transformer).\r\n       </action>\r\n+      <action dev=\"ggregory\" type=\"fix\" issue=\"CONFIGURATION-767\" due-to=\"Gary Gregory\">\r\n+        NullPointerException in XMLConfiguration#createTransformer() when no FileLocator is set.\r\n+      </action>\r\n     </release>\r\n     <release version=\"2.6\" date=\"2019-09-13\"\r\n              description=\"Minor release with new features and updated dependencies.\">\r",
                "changes": 3
            },
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/commons-configuration/raw/746821e2568246d8d7b09403f68930ab000a9592/src/main/java/org/apache/commons/configuration2/XMLConfiguration.java",
                "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/main/java/org/apache/commons/configuration2/XMLConfiguration.java?ref=746821e2568246d8d7b09403f68930ab000a9592",
                "filename": "src/main/java/org/apache/commons/configuration2/XMLConfiguration.java",
                "deletions": 5,
                "sha": "469b22690327aaa9f81dcc669b4dafb2634364f8",
                "blob_url": "https://github.com/apache/commons-configuration/blob/746821e2568246d8d7b09403f68930ab000a9592/src/main/java/org/apache/commons/configuration2/XMLConfiguration.java",
                "patch": "@@ -881,19 +881,17 @@ protected Transformer createTransformer() throws ConfigurationException\n         final Transformer transformer = XMLDocumentHelper.createTransformer();\n \n         transformer.setOutputProperty(OutputKeys.INDENT, \"yes\");\n-        if (locator.getEncoding() != null)\n+        if (locator != null && locator.getEncoding() != null)\n         {\n             transformer.setOutputProperty(OutputKeys.ENCODING, locator.getEncoding());\n         }\n         if (publicID != null)\n         {\n-            transformer.setOutputProperty(OutputKeys.DOCTYPE_PUBLIC,\n-                    publicID);\n+            transformer.setOutputProperty(OutputKeys.DOCTYPE_PUBLIC, publicID);\n         }\n         if (systemID != null)\n         {\n-            transformer.setOutputProperty(OutputKeys.DOCTYPE_SYSTEM,\n-                    systemID);\n+            transformer.setOutputProperty(OutputKeys.DOCTYPE_SYSTEM, systemID);\n         }\n \n         return transformer;",
                "changes": 8
            },
            {
                "status": "modified",
                "additions": 26,
                "raw_url": "https://github.com/apache/commons-configuration/raw/746821e2568246d8d7b09403f68930ab000a9592/src/test/java/org/apache/commons/configuration2/TestXMLConfiguration.java",
                "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/test/java/org/apache/commons/configuration2/TestXMLConfiguration.java?ref=746821e2568246d8d7b09403f68930ab000a9592",
                "filename": "src/test/java/org/apache/commons/configuration2/TestXMLConfiguration.java",
                "deletions": 7,
                "sha": "840bc964ac0aefd298ca47b88400305b5d309125",
                "blob_url": "https://github.com/apache/commons-configuration/blob/746821e2568246d8d7b09403f68930ab000a9592/src/test/java/org/apache/commons/configuration2/TestXMLConfiguration.java",
                "patch": "@@ -26,21 +26,23 @@\n import static org.junit.Assert.assertTrue;\n import static org.junit.Assert.fail;\n \n-import javax.xml.parsers.DocumentBuilder;\n-import javax.xml.parsers.DocumentBuilderFactory;\n-import javax.xml.parsers.ParserConfigurationException;\n-import javax.xml.transform.TransformerFactoryConfigurationError;\n import java.io.ByteArrayInputStream;\n import java.io.File;\n import java.io.FileOutputStream;\n import java.io.IOException;\n import java.io.StringReader;\n import java.io.StringWriter;\n+import java.nio.charset.StandardCharsets;\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.Collection;\n import java.util.List;\n \n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import javax.xml.transform.TransformerFactoryConfigurationError;\n+\n import org.apache.commons.configuration2.SynchronizerTestImpl.Methods;\n import org.apache.commons.configuration2.builder.FileBasedBuilderParametersImpl;\n import org.apache.commons.configuration2.builder.FileBasedConfigurationBuilder;\n@@ -52,10 +54,12 @@\n import org.apache.commons.configuration2.tree.ImmutableNode;\n import org.apache.commons.configuration2.tree.NodeStructureHelper;\n import org.apache.commons.configuration2.tree.xpath.XPathExpressionEngine;\n+import org.junit.Assert;\n import org.junit.Before;\n-import org.junit.Test;\n import org.junit.Rule;\n+import org.junit.Test;\n import org.junit.rules.TemporaryFolder;\n+import org.w3c.dom.Document;\n import org.xml.sax.SAXException;\n import org.xml.sax.SAXParseException;\n import org.xml.sax.helpers.DefaultHandler;\n@@ -230,6 +234,11 @@ public void error(final SAXParseException ex) throws SAXException\n         return builder;\n     }\n \n+    private Document parseXml(final String xml) throws SAXException, IOException, ParserConfigurationException {\n+        return DocumentBuilderFactory.newInstance().newDocumentBuilder()\n+                .parse(new ByteArrayInputStream(xml.getBytes(StandardCharsets.UTF_8)));\n+    }\n+\n     /**\n      * Removes the test output file if it exists.\n      */\n@@ -965,13 +974,13 @@ public void testgetProperty() {\n         assertEquals(\"three\", list.get(1));\n     }\n \n+\n     @Test\n     public void testGetProperty()\n     {\n         assertEquals(\"value\", conf.getProperty(\"element\"));\n     }\n \n-\n     @Test\n     public void testGetPropertyWithXMLEntity()\n     {\n@@ -1764,7 +1773,17 @@ public void testValidatingInvalidFile() throws ConfigurationException\n         conf.setValidating(true);\n         load(conf, \"testValidateInvalid.xml\");\n     }\n-\n+    \n+    @Test\n+    public void testWrite() throws Exception\n+    {\n+        XMLConfiguration xmlConfig = new XMLConfiguration();\n+        xmlConfig.setRootElementName(\"IAmRoot\");\n+        StringWriter sw = new StringWriter();\n+        xmlConfig.write(sw);\n+        // Check that we can parse the XML.\n+        Assert.assertNotNull(parseXml(sw.toString()));\n+    }\n     /**\n      * Tests accessing properties when the XPATH expression engine is set.\n      */",
                "changes": 33
            }
        ],
        "unit_tests": [
            "TestXMLConfiguration.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "src/test/java/org/apache/commons/configuration2/TestXMLConfiguration.java",
        "buggy_files": [
            "src/changes/changes.xml",
            "src/main/java/org/apache/commons/configuration2/XMLConfiguration.java"
        ],
        "fixed": true
    }
]