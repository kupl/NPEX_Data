[
    {
        "repo": "commons-exec",
        "commit": "https://github.com/apache/commons-exec/commit/770c4709fc729591b6de5cbb2c4981fbaa6b0622",
        "bug_id": "commons-exec_770c470",
        "message": "[EXEC-80] NPE in EnvironmentUtils.toString(map)\n\ngit-svn-id: https://svn.apache.org/repos/asf/commons/proper/exec/trunk@1564205 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/commons-exec/commit/d987abc9515458ccd6da3a279ef8fd4b0f9dd23a",
        "patched_files": [
            "EnvironmentUtils.java",
            "changes.xml"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/commons-exec/raw/770c4709fc729591b6de5cbb2c4981fbaa6b0622/src/changes/changes.xml",
                "contents_url": "https://api.github.com/repos/apache/commons-exec/contents/src/changes/changes.xml?ref=770c4709fc729591b6de5cbb2c4981fbaa6b0622",
                "filename": "src/changes/changes.xml",
                "deletions": 0,
                "sha": "ba1b73b066d3ec627a78e489c0fdc2dee2304744",
                "blob_url": "https://github.com/apache/commons-exec/blob/770c4709fc729591b6de5cbb2c4981fbaa6b0622/src/changes/changes.xml",
                "patch": "@@ -24,6 +24,9 @@\n     </properties>\n     <body>\n         <release version=\"1.3\" date=\"TBD\" description=\"Maintenance and feature Release\">\n+            <action issue=\"EXEC-80\" dev=\"ggregory\" type=\"fix\" date=\"2014-02-04\">\n+                NPE in EnvironmentUtils.toString(map)\n+            </action>\n             <action issue=\"EXEC-78\" dev=\"sebb\" type=\"update\" date=\"2014-01-11\">\n                 No need to use System.class.getMethod(\"getenv\",... any more\n             </action>",
                "changes": 3
            },
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/commons-exec/raw/770c4709fc729591b6de5cbb2c4981fbaa6b0622/src/main/java/org/apache/commons/exec/environment/EnvironmentUtils.java",
                "contents_url": "https://api.github.com/repos/apache/commons-exec/contents/src/main/java/org/apache/commons/exec/environment/EnvironmentUtils.java?ref=770c4709fc729591b6de5cbb2c4981fbaa6b0622",
                "filename": "src/main/java/org/apache/commons/exec/environment/EnvironmentUtils.java",
                "deletions": 1,
                "sha": "e90841fb9ae81f3192f1e1b265a1ef4039ad60a3",
                "blob_url": "https://github.com/apache/commons-exec/blob/770c4709fc729591b6de5cbb2c4981fbaa6b0622/src/main/java/org/apache/commons/exec/environment/EnvironmentUtils.java",
                "patch": "@@ -65,7 +65,9 @@ private EnvironmentUtils() {\n         for (final Iterator<Map.Entry<String, String>> iter = environment.entrySet().iterator(); iter.hasNext();) {\n             final Map.Entry<String, String> entry = iter.next();\n \n-            result[i] = entry.getKey().toString() + \"=\" + entry.getValue().toString();\n+            String key  = entry.getKey() == null ? \"\" : entry.getKey().toString();\n+            String value = entry.getValue() == null ? \"\" : entry.getValue().toString();\n+            result[i] = key + \"=\" + value;\n             i++;\n         }\n         return result;",
                "changes": 4
            },
            {
                "status": "modified",
                "additions": 26,
                "raw_url": "https://github.com/apache/commons-exec/raw/770c4709fc729591b6de5cbb2c4981fbaa6b0622/src/test/java/org/apache/commons/exec/environment/EnvironmentUtilsTest.java",
                "contents_url": "https://api.github.com/repos/apache/commons-exec/contents/src/test/java/org/apache/commons/exec/environment/EnvironmentUtilsTest.java?ref=770c4709fc729591b6de5cbb2c4981fbaa6b0622",
                "filename": "src/test/java/org/apache/commons/exec/environment/EnvironmentUtilsTest.java",
                "deletions": 0,
                "sha": "cabfa456d93fc6e5a0c3fa42e8570b53f2165d42",
                "blob_url": "https://github.com/apache/commons-exec/blob/770c4709fc729591b6de5cbb2c4981fbaa6b0622/src/test/java/org/apache/commons/exec/environment/EnvironmentUtilsTest.java",
                "patch": "@@ -129,4 +129,30 @@ public void testCaseInsensitiveVariableLookup() throws Exception {\n         assertEquals(\"bAr\", procEnvironment.get(\"foo\"));\n     }\n \n+    /**\n+     * Tests the behavior of the EnvironmentUtils.toStrings()\n+     * when using a <code>null</code> key given to the map.\n+     */\n+    @Test\n+    public void testToStringWithNullKey() {\n+        final Map<String, String> env = new HashMap<String, String>();\n+        env.put(null, \"TheNullKey\");\n+        String[] strings = EnvironmentUtils.toStrings(env);\n+        assertEquals(1, strings.length);\n+        assertEquals(\"=TheNullKey\", strings[0]);\n+    }\n+\n+    /**\n+     * Tests the behavior of the EnvironmentUtils.toStrings()\n+     * when using a <code>null</code> value given to the map.\n+     */\n+    @Test\n+    public void testToStringWithNullValue() {\n+        final Map<String, String> env = new HashMap<String, String>();\n+        env.put(\"key\", null);\n+        String[] strings = EnvironmentUtils.toStrings(env);\n+        assertEquals(1, strings.length);\n+        assertEquals(\"key=\", strings[0]);\n+    }\n+\n }",
                "changes": 26
            }
        ],
        "unit_tests": [
            "EnvironmentUtilsTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "src/test/java/org/apache/commons/exec/environment/EnvironmentUtilsTest.java",
        "buggy_files": [
            "src/main/java/org/apache/commons/exec/environment/EnvironmentUtils.java",
            "src/changes/changes.xml"
        ],
        "fixed": true
    }
]