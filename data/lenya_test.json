{
    "lenya_0da9bc3": {
        "bug_id": "lenya_0da9bc3",
        "commit": "https://github.com/apache/lenya/commit/0da9bc340236e6f10911b2a1c67c383e529d7c63",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/lenya/blob/0da9bc340236e6f10911b2a1c67c383e529d7c63/src/java/org/apache/lenya/cms/publication/DefaultDocument.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/publication/DefaultDocument.java?ref=0da9bc340236e6f10911b2a1c67c383e529d7c63",
                "deletions": 3,
                "filename": "src/java/org/apache/lenya/cms/publication/DefaultDocument.java",
                "patch": "@@ -1,5 +1,5 @@\n /*\n-$Id: DefaultDocument.java,v 1.20 2003/07/31 11:56:42 andreas Exp $\n+$Id: DefaultDocument.java,v 1.21 2003/08/08 08:35:58 gregor Exp $\n <License>\n \n  ============================================================================\n@@ -105,9 +105,11 @@ protected DefaultDocument(Publication publication, String id, String area) {\n \n         assert (publication != null) && !\"\".equals(publication);\n         this.publication = publication;\n+\n+\t\tsetArea(area);\n+\n \t\tthis.dublincore =  new DublinCore(this);\n \n-        setArea(area);\n     }\n \n \t/**\n@@ -124,9 +126,10 @@ protected DefaultDocument(Publication publication, String id, String area, Strin\n \t\tassert (publication != null) && !\"\".equals(publication);\n \t\tthis.publication = publication;\n \t\tthis.language = language;\n+\t\tsetArea(area);\n+\n \t\tthis.dublincore =  new DublinCore(this);\n \n-\t\tsetArea(area);\n \t}\n \n     /**",
                "raw_url": "https://github.com/apache/lenya/raw/0da9bc340236e6f10911b2a1c67c383e529d7c63/src/java/org/apache/lenya/cms/publication/DefaultDocument.java",
                "sha": "31fd40418246754dea36f5aea99419b697317728",
                "status": "modified"
            }
        ],
        "message": "we need to set the area before we call the DublinCore constructor or we'll get a NPE\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/lenya/trunk@40628 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/lenya/commit/7893547264e5734ac63d6f1fb3f6682420465f37",
        "patched_files": [
            "DefaultDocument.java"
        ],
        "repo": "lenya",
        "unit_tests": [
            "DefaultDocumentTest.java"
        ]
    },
    "lenya_19da45e": {
        "bug_id": "lenya_19da45e",
        "commit": "https://github.com/apache/lenya/commit/19da45e4e045790cdd3c559ff0802a5225cf3205",
        "file": [
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/SiteManager.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/site/SiteManager.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 1,
                "filename": "src/java/org/apache/lenya/cms/site/SiteManager.java",
                "patch": "@@ -147,10 +147,19 @@ boolean requires(DocumentIdentityMap map, Node dependingResource, Node requiredR\n      * It is meant to hide specific nodes within the \"public\" navigation whereas the node is visible within the info/site area.\n      * \n      * @param document The document.\n-     * @param label The label.\n+     * @param visibleInNav The visibility.\n      * @throws SiteException if an error occurs.\n      */\n     void setVisibleInNav(Document document, boolean visibleInNav) throws SiteException;\n+    \n+    /**\n+     * Returns the visibility of a node in the navigation. \n+     * \n+     * @param document The document.\n+     * @return A boolean value.\n+     * @throws SiteException if an error occurs.\n+     */\n+    boolean isVisibleInNav(Document document) throws SiteException;\n \n     /**\n      * Returns all documents in a certain area.",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/SiteManager.java",
                "sha": "b81699467e81276bb642896a144c7e3e242d2661",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/simple/SimpleSiteManager.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/site/simple/SimpleSiteManager.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 1,
                "filename": "src/java/org/apache/lenya/cms/site/simple/SimpleSiteManager.java",
                "patch": "@@ -201,7 +201,7 @@ public void setLabel(Document document, String label) throws SiteException {\n \n     /**\n      * @see org.apache.lenya.cms.site.SiteManager#setVisibleInNav(org.apache.lenya.cms.publication.Document,\n-     *      java.lang.String)\n+     *      boolean)\n      */\n     public void setVisibleInNav(Document document, boolean visibleInNav) throws SiteException {\n     }\n@@ -236,4 +236,8 @@ public Document getAvailableDocument(Document document) throws SiteException {\n         return document;\n     }\n \n+    public boolean isVisibleInNav(Document document) throws SiteException {\n+        return true;\n+    }\n+\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/simple/SimpleSiteManager.java",
                "sha": "7aebca3b3599b25c49eaf47ff3080386ffad02fb",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/topicmap/TopicMapSiteManager.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/site/topicmap/TopicMapSiteManager.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 1,
                "filename": "src/java/org/apache/lenya/cms/site/topicmap/TopicMapSiteManager.java",
                "patch": "@@ -118,7 +118,7 @@ public void setLabel(Document document, String label) throws SiteException {\n     \n     /**\n      * @see org.apache.lenya.cms.site.SiteManager#setVisibleInNav(org.apache.lenya.cms.publication.Document,\n-     *      java.lang.String)\n+     *      boolean)\n      */\n     public void setVisibleInNav(Document document, boolean visibleInNav) throws SiteException {\n     }\n@@ -151,4 +151,8 @@ public Document getAvailableDocument(Document document) throws SiteException {\n         return document;\n     }\n \n+    public boolean isVisibleInNav(Document document) throws SiteException {\n+        return true;\n+    }\n+\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/topicmap/TopicMapSiteManager.java",
                "sha": "5b51ec333cf574bfc494b3e37c78eb1452a68baa",
                "status": "modified"
            },
            {
                "additions": 25,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/usecases/CreateLanguage.java",
                "changes": 26,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/site/usecases/CreateLanguage.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 1,
                "filename": "src/java/org/apache/lenya/cms/site/usecases/CreateLanguage.java",
                "patch": "@@ -19,12 +19,14 @@\n import java.util.ArrayList;\n import java.util.List;\n \n+import org.apache.avalon.framework.service.ServiceSelector;\n import org.apache.lenya.cms.publication.Document;\n import org.apache.lenya.cms.publication.DocumentBuildException;\n import org.apache.lenya.cms.publication.DocumentException;\n import org.apache.lenya.cms.publication.DocumentIdentityMap;\n-import org.apache.lenya.cms.publication.ResourceType;\n import org.apache.lenya.cms.publication.Publication;\n+import org.apache.lenya.cms.publication.ResourceType;\n+import org.apache.lenya.cms.site.SiteManager;\n \n /**\n  * Usecase to create a new language version of a resource.\n@@ -88,6 +90,7 @@ protected void initParameters() {\n \n         Document source = getSourceDocument();\n         if (source != null) {\n+            setParameter(DOCUMENT_ID, source.getId());\n             try {\n                 List nonExistingLanguages = getNonExistingLanguages();\n                 setParameter(LANGUAGES, nonExistingLanguages\n@@ -142,4 +145,25 @@ protected String getDocumentTypeName() {\n         return this.documentTypeName;\n     }\n \n+    protected boolean getVisibleInNav() {\n+        Document source = getSourceDocument();\n+        ServiceSelector selector = null;\n+        SiteManager siteManager = null;\n+        try {\n+            selector = (ServiceSelector) manager.lookup(SiteManager.ROLE + \"Selector\");\n+            siteManager = (SiteManager) selector.select(source.getPublication()\n+                    .getSiteManagerHint());\n+            return siteManager.isVisibleInNav(source);\n+        } catch (Exception e) {\n+            throw new RuntimeException(e);\n+        } finally {\n+            if (selector != null) {\n+                if (siteManager != null) {\n+                    selector.release(siteManager);\n+                }\n+                manager.release(selector);\n+            }\n+        }\n+    }\n+\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/usecases/CreateLanguage.java",
                "sha": "7231a989e9079cd9675dd89d52905ad67cc58f9f",
                "status": "modified"
            },
            {
                "additions": 35,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/DefaultSiteTree.java",
                "changes": 53,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/DefaultSiteTree.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 18,
                "filename": "src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/DefaultSiteTree.java",
                "patch": "@@ -120,9 +120,8 @@ public synchronized Document createDocument() throws ParserConfigurationExceptio\n \n         Element root = document.getDocumentElement();\n         root.setAttribute(\"xmlns:xsi\", \"http://www.w3.org/2001/XMLSchema-instance\");\n-        root\n-                .setAttribute(\"xsi:schemaLocation\",\n-                        \"http://apache.org/cocoon/lenya/sitetree/1.0  ../../../../resources/entities/sitetree.xsd\");\n+        root.setAttribute(\"xsi:schemaLocation\",\n+                \"http://apache.org/cocoon/lenya/sitetree/1.0  ../../../../resources/entities/sitetree.xsd\");\n \n         return document;\n     }\n@@ -177,8 +176,8 @@ public synchronized void addNode(SiteTreeNode node, String refDocumentId) throws\n      * @see org.apache.lenya.cms.site.tree.SiteTree#addNode(java.lang.String, java.lang.String,\n      *      org.apache.lenya.cms.site.Label[], boolean)\n      */\n-    public synchronized void addNode(String parentid, String id, Label[] labels, boolean visibleInNav)\n-            throws SiteException {\n+    public synchronized void addNode(String parentid, String id, Label[] labels,\n+            boolean visibleInNav) throws SiteException {\n         addNode(parentid, id, labels, visibleInNav, null, null, false);\n     }\n \n@@ -194,8 +193,8 @@ public synchronized void addNode(SiteTreeNode node) throws SiteException {\n      *      org.apache.lenya.cms.site.Label[], boolean, java.lang.String, java.lang.String, boolean,\n      *      java.lang.String)\n      */\n-    public synchronized void addNode(String documentid, Label[] labels, boolean visibleInNav, String href, String suffix,\n-            boolean link, String refDocumentId) throws SiteException {\n+    public synchronized void addNode(String documentid, Label[] labels, boolean visibleInNav,\n+            String href, String suffix, boolean link, String refDocumentId) throws SiteException {\n         StringBuffer buf = new StringBuffer();\n         StringTokenizer st = new StringTokenizer(documentid, \"/\");\n         int length = st.countTokens();\n@@ -212,17 +211,17 @@ public synchronized void addNode(String documentid, Label[] labels, boolean visi\n      * @see org.apache.lenya.cms.site.tree.SiteTree#addNode(java.lang.String,\n      *      org.apache.lenya.cms.site.Label[], boolean, java.lang.String, java.lang.String, boolean)\n      */\n-    public synchronized void addNode(String documentid, Label[] labels, boolean visibleInNav, String href, String suffix,\n-            boolean link) throws SiteException {\n+    public synchronized void addNode(String documentid, Label[] labels, boolean visibleInNav,\n+            String href, String suffix, boolean link) throws SiteException {\n         addNode(documentid, labels, visibleInNav, href, suffix, link, null);\n     }\n \n     /**\n      * @see org.apache.lenya.cms.site.tree.SiteTree#addNode(java.lang.String, java.lang.String,\n      *      org.apache.lenya.cms.site.Label[], boolean, java.lang.String, java.lang.String, boolean)\n      */\n-    public synchronized void addNode(String parentid, String id, Label[] labels, boolean visibleInNav, String href,\n-            String suffix, boolean link) throws SiteException {\n+    public synchronized void addNode(String parentid, String id, Label[] labels,\n+            boolean visibleInNav, String href, String suffix, boolean link) throws SiteException {\n         addNode(parentid, id, labels, visibleInNav, href, suffix, link, null);\n     }\n \n@@ -231,8 +230,9 @@ public synchronized void addNode(String parentid, String id, Label[] labels, boo\n      *      org.apache.lenya.cms.site.Label[], boolean, java.lang.String, java.lang.String, boolean,\n      *      java.lang.String)\n      */\n-    public synchronized void addNode(String parentid, String id, Label[] labels, boolean visibleInNav, String href,\n-            String suffix, boolean link, String refDocumentId) throws SiteException {\n+    public synchronized void addNode(String parentid, String id, Label[] labels,\n+            boolean visibleInNav, String href, String suffix, boolean link, String refDocumentId)\n+            throws SiteException {\n \n         Node parentNode = getNodeInternal(parentid);\n \n@@ -263,7 +263,7 @@ public synchronized void addNode(String parentid, String id, Label[] labels, boo\n         } else {\n             child.setAttribute(SiteTreeNodeImpl.VISIBLEINNAV_ATTRIBUTE_NAME, \"false\");\n         }\n-        \n+\n         if ((href != null) && (href.length() > 0)) {\n             child.setAttribute(SiteTreeNodeImpl.HREF_ATTRIBUTE_NAME, href);\n         }\n@@ -514,8 +514,14 @@ public synchronized void importSubtree(SiteTreeNode newParent, SiteTreeNode subt\n         String parentId = newParent.getAbsoluteId();\n         String id = newid;\n \n-        this.addNode(parentId, id, subtreeRoot.getLabels(), subtreeRoot.visibleInNav(), subtreeRoot.getHref(), subtreeRoot\n-                .getSuffix(), subtreeRoot.hasLink(), refDocumentId);\n+        this.addNode(parentId,\n+                id,\n+                subtreeRoot.getLabels(),\n+                subtreeRoot.visibleInNav(),\n+                subtreeRoot.getHref(),\n+                subtreeRoot.getSuffix(),\n+                subtreeRoot.hasLink(),\n+                refDocumentId);\n         newParent = this.getNode(parentId + \"/\" + id);\n         if (newParent == null) {\n             throw new SiteException(\"The added node was not found.\");\n@@ -546,11 +552,12 @@ public synchronized void setLabel(String documentId, Label label) {\n             throw new RuntimeException(e);\n         }\n     }\n-    \n+\n     /**\n      * @see org.apache.lenya.cms.site.tree.SiteTree#setVisibleInNav(java.lang.String, boolean)\n      */\n-    public synchronized void setVisibleInNav(String documentId, boolean visibleInNav)  throws SiteException {\n+    public synchronized void setVisibleInNav(String documentId, boolean visibleInNav)\n+            throws SiteException {\n         SiteTreeNode node = getNode(documentId);\n         if (visibleInNav) {\n             node.setNodeAttribute(SiteTreeNodeImpl.VISIBLEINNAV_ATTRIBUTE_NAME, \"true\");\n@@ -601,4 +608,14 @@ public void save() throws SiteException {\n         saveDocument();\n     }\n \n+    public boolean isVisibleInNav(String documentId) throws SiteException {\n+        SiteTreeNode node = getNode(documentId);\n+        String value = node.getNodeAttribute(SiteTreeNodeImpl.VISIBLEINNAV_ATTRIBUTE_NAME);\n+        if (value != null && !value.equals(\"\")) {\n+            return Boolean.valueOf(value).booleanValue();\n+        } else {\n+            return true;\n+        }\n+    }\n+\n }",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/DefaultSiteTree.java",
                "sha": "3f929d3b28e28af33265726350f4462c057c33ba",
                "status": "modified"
            },
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTree.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTree.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 2,
                "filename": "src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTree.java",
                "patch": "@@ -158,9 +158,19 @@ void addNode(String documentid, Label[] labels, boolean visibleInNav, String hre\n      * Sets the visibility in the navigation of an existing node. \n      * \n      * @param documentId the document-id to which the visibility is to be added.\n-     * @param visiblieInNav \n+     * @param visibleInNav The visibility. \n+     * @throws SiteException if an error occurs.\n+     */\n+    void setVisibleInNav(String documentId, boolean visibleInNav) throws SiteException;\n+    \n+    /**\n+     * Returns the visibility in the navigation of an existing node.\n+     *  \n+     * @param documentId The document ID.\n+     * @return A boolean value.\n+     * @throws SiteException\n      */\n-    void setVisibleInNav (String documentId, boolean visibleInNav) throws SiteException;\n+    boolean isVisibleInNav(String documentId) throws SiteException;\n \n     /**\n      * Remove a label from a node",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTree.java",
                "sha": "2768394aa3661ec5c911e42bb3e0dcbfa8893e4f",
                "status": "modified"
            },
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNode.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNode.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 0,
                "filename": "src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNode.java",
                "patch": "@@ -204,6 +204,14 @@\n      */\n     void setNodeAttribute (String attributeName, String attributeValue);\n \n+    /**\n+     * Returns an attribute of this node.\n+     *\n+     * @param attributeName name of the attribute\n+     * @return The value.\n+     */\n+    String getNodeAttribute (String attributeName);\n+\n     /**\n      * Give a list of the children and this node in a pre order way\n      * @return The list",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNode.java",
                "sha": "3e70570046622b3e2617256099ef30b52fc18ffb",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 0,
                "filename": "src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java",
                "patch": "@@ -490,4 +490,9 @@ public List preOrder() {\n         return list;\n     }\n \n+    public String getNodeAttribute(String attributeName) {\n+        Element element = (Element) this.node;\n+        return element.getAttribute(attributeName);\n+    }\n+\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java",
                "sha": "6bbd43c8bdb8a47b95a5ebcb7aa8940e013fba40",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/TreeSiteManager.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/TreeSiteManager.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 2,
                "filename": "src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/TreeSiteManager.java",
                "patch": "@@ -302,10 +302,9 @@ public void setLabel(Document document, String label) throws SiteException {\n \n     /**\n      * @see org.apache.lenya.cms.site.SiteManager#setVisibleInNav(org.apache.lenya.cms.publication.Document,\n-     *      java.lang.String)\n+     *      boolean)\n      */\n     public void setVisibleInNav(Document document, boolean visibleInNav) throws SiteException {\n-\n         SiteTree tree = getTree(document);\n         tree.setVisibleInNav(document.getId(), visibleInNav);\n     }\n@@ -469,4 +468,9 @@ protected String computeUniqueDocumentId(Document document) throws SiteException\n \n         return documentId;\n     }\n+\n+    public boolean isVisibleInNav(Document document) throws SiteException {\n+        SiteTree tree = getTree(document);\n+        return tree.isVisibleInNav(document.getId());\n+    }\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/TreeSiteManager.java",
                "sha": "5988d9e589c558938415fb00be9fe50f51e81ac4",
                "status": "modified"
            }
        ],
        "message": "Added isVisibleInNav() method to SiteManager. This allows to fix an NPE in the CreateLanguage usecase.\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@370125 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/lenya/commit/8397f305e42a57724b179d160014b23c9de92395",
        "patched_files": [
            "SiteTreeNodeImpl.java",
            "DefaultSiteTree.java"
        ],
        "repo": "lenya",
        "unit_tests": [
            "SiteTreeNodeImplTest.java",
            "DefaultSiteTreeTest.java"
        ]
    },
    "lenya_2c9f20d": {
        "bug_id": "lenya_2c9f20d",
        "commit": "https://github.com/apache/lenya/commit/2c9f20dbf6d8813f8662f4c4b904684f799289eb",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/lenya/blob/2c9f20dbf6d8813f8662f4c4b904684f799289eb/src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/AbstractUsecase.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/AbstractUsecase.java?ref=2c9f20dbf6d8813f8662f4c4b904684f799289eb",
                "deletions": 1,
                "filename": "src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/AbstractUsecase.java",
                "patch": "@@ -86,9 +86,11 @@ protected void advanceState(String event) {\n \n     /**\n      * @see org.apache.lenya.cms.usecase.Usecase#getSourceURL()\n+     * We don't use getParameterAsString() because this will typically\n+     * cause stack overflows or NPEs in connection with initParameters().\n      */\n     public String getSourceURL() {\n-        return getParameterAsString(SOURCE_URL);\n+        return (String) this.parameters.get(SOURCE_URL);\n     }\n \n     /**",
                "raw_url": "https://github.com/apache/lenya/raw/2c9f20dbf6d8813f8662f4c4b904684f799289eb/src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/AbstractUsecase.java",
                "sha": "0c4794e5e1671bc3792288dbc9991f5c09363462",
                "status": "modified"
            }
        ],
        "message": "AbstractUsecase.getSourceURL() doesn't use getParameter() to avoid NPEs\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@509212 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/lenya/commit/c6a254b0d3f138f57d0a626976573a734f31ae3a",
        "patched_files": [
            "AbstractUsecase.java"
        ],
        "repo": "lenya",
        "unit_tests": [
            "AbstractUsecaseTest.java"
        ]
    },
    "lenya_45149c0": {
        "bug_id": "lenya_45149c0",
        "commit": "https://github.com/apache/lenya/commit/45149c09a73b5afbc5c35113aa3b066d7839ac62",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/lenya/blob/45149c09a73b5afbc5c35113aa3b066d7839ac62/src/impl/test/org/apache/lenya/cms/rc/RevisionControllerTest.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/impl/test/org/apache/lenya/cms/rc/RevisionControllerTest.java?ref=45149c09a73b5afbc5c35113aa3b066d7839ac62",
                "deletions": 2,
                "filename": "src/impl/test/org/apache/lenya/cms/rc/RevisionControllerTest.java",
                "patch": "@@ -77,8 +77,8 @@ public void testRevisionController() throws RepositoryException, RevisionControl\n         String source = args[1];\n         String identityD = args[2];\n         String destination = args[3];\n-        doc1.getRepositoryNode().checkout();\n-        doc2.getRepositoryNode().checkin();\n+        //doc1.getRepositoryNode().checkout();\n+        //doc2.getRepositoryNode().checkin();\n     }\n \n }",
                "raw_url": "https://github.com/apache/lenya/raw/45149c09a73b5afbc5c35113aa3b066d7839ac62/src/impl/test/org/apache/lenya/cms/rc/RevisionControllerTest.java",
                "sha": "c0acd9def9765631dac6841f2398eb95be355923",
                "status": "modified"
            }
        ],
        "message": "Commented out invalid checks to avoid NPE in RevisionControllerTest\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@588618 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/lenya/commit/99e05a9a54c3804d1b62a14df42981642c401ed0",
        "patched_files": [],
        "repo": "lenya",
        "unit_tests": [
            "RevisionControllerTest.java"
        ]
    },
    "lenya_567529d": {
        "bug_id": "lenya_567529d",
        "commit": "https://github.com/apache/lenya/commit/567529dd9fa991b2c259da94a40c693da693acf0",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/lenya/blob/567529dd9fa991b2c259da94a40c693da693acf0/src/java/org/apache/lenya/cms/ac/FileUser.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/ac/FileUser.java?ref=567529dd9fa991b2c259da94a40c693da693acf0",
                "deletions": 3,
                "filename": "src/java/org/apache/lenya/cms/ac/FileUser.java",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * $Id: FileUser.java,v 1.10 2003/06/06 17:20:06 egli Exp $\n+ * $Id: FileUser.java,v 1.11 2003/06/10 14:40:51 egli Exp $\n  * <License>\n  * The Apache Software License\n  *\n@@ -106,6 +106,7 @@ public FileUser(\n \n \tpublic FileUser(Publication publication, Configuration config)\n \t\tthrows ConfigurationException {\n+\t\tthis.publication = publication;\n \t\tid = config.getAttribute(ID_ATTRIBUTE);\n \t\tsetEmail(config.getChild(EMAIL).getValue());\n \t\tsetFullName(config.getChild(FULL_NAME).getValue());\n@@ -201,9 +202,7 @@ public void save() throws AccessControlException {\n \t */\n \tpublic void delete() throws AccessControlException {\n \t\tsuper.delete();\n-\n \t\tUserManager manager = UserManager.instance(publication);\n-\n \t\tmanager.remove(this);\n \t\tFile xmlPath = manager.getPath();\n \t\tFile xmlfile = new File(xmlPath, getId() + UserManager.SUFFIX);",
                "raw_url": "https://github.com/apache/lenya/raw/567529dd9fa991b2c259da94a40c693da693acf0/src/java/org/apache/lenya/cms/ac/FileUser.java",
                "sha": "e24e121967b7ba90b76dbf50457e97d74e44263a",
                "status": "modified"
            }
        ],
        "message": "When initialized (in the constructor) with a publication, do\ntry to remember it, i.e. forgot to store the publication, so\nwhen trying to delete later it failed with NullPointerException.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/lenya/trunk@39900 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/lenya/commit/c3d8a70fecfc0dff46c47f8d3cd972dfb017fab0",
        "patched_files": [
            "FileUser.java"
        ],
        "repo": "lenya",
        "unit_tests": [
            "FileUserTest.java"
        ]
    },
    "lenya_6ab3f7a": {
        "bug_id": "lenya_6ab3f7a",
        "commit": "https://github.com/apache/lenya/commit/6ab3f7a37978c2bf4a91479bde794336a352ec09",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/lenya/blob/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/metadata/usecases/Metadata.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/metadata/usecases/Metadata.java?ref=6ab3f7a37978c2bf4a91479bde794336a352ec09",
                "deletions": 1,
                "filename": "src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/metadata/usecases/Metadata.java",
                "patch": "@@ -45,7 +45,10 @@\n      * @see org.apache.lenya.cms.usecase.AbstractUsecase#getNodesToLock()\n      */\n     protected Node[] getNodesToLock() throws UsecaseException {\n-        Node[] objects = { getSourceDocument().getRepositoryNode() };\n+        Node[] objects = new Node[0];\n+        if(getSourceDocument() != null) {\n+            objects = new Node[] { getSourceDocument().getRepositoryNode() };\n+        }\n         return objects;\n     }\n ",
                "raw_url": "https://github.com/apache/lenya/raw/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/metadata/usecases/Metadata.java",
                "sha": "a19f41b8a650c26c33bc2447f92f6f2b2105a895",
                "status": "modified"
            },
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/lenya/blob/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/MoveSubsite.java",
                "changes": 35,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/MoveSubsite.java?ref=6ab3f7a37978c2bf4a91479bde794336a352ec09",
                "deletions": 16,
                "filename": "src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/MoveSubsite.java",
                "patch": "@@ -98,27 +98,30 @@ protected void doCheckPreconditions() throws Exception {\n      * changes to the site structure would compromise the operation.\n      */\n     protected Node[] getNodesToLock() throws UsecaseException {\n-        try {\n+        Set nodes = new HashSet();\n+  \n+        if(getSourceDocument() != null) {\n+            try {\n \n-            Set nodes = new HashSet();\n+                SiteStructure sourceSite = getSourceDocument().area().getSite();\n+                SiteStructure targetSite = getSourceDocument().getPublication()\n+                        .getArea(getTargetArea()).getSite();\n \n-            SiteStructure sourceSite = getSourceDocument().area().getSite();\n-            SiteStructure targetSite = getSourceDocument().getPublication()\n-                    .getArea(getTargetArea()).getSite();\n+                nodes.add(sourceSite.getRepositoryNode());\n+                nodes.add(targetSite.getRepositoryNode());\n \n-            nodes.add(sourceSite.getRepositoryNode());\n-            nodes.add(targetSite.getRepositoryNode());\n+                Document[] docs = SiteUtil.getSubSite(this.manager,\n+                        getSourceDocument().getLink().getNode()).getDocuments();\n+                for (int i = 0; i < docs.length; i++) {\n+                    nodes.add(docs[i].getRepositoryNode());\n+                }\n \n-            Document[] docs = SiteUtil.getSubSite(this.manager,\n-                    getSourceDocument().getLink().getNode()).getDocuments();\n-            for (int i = 0; i < docs.length; i++) {\n-                nodes.add(docs[i].getRepositoryNode());\n+            } catch (PublicationException e) {\n+                throw new UsecaseException(e);\n             }\n-\n-            return (Node[]) nodes.toArray(new Node[nodes.size()]);\n-        } catch (PublicationException e) {\n-            throw new UsecaseException(e);\n         }\n+ \n+        return (Node[]) nodes.toArray(new Node[nodes.size()]);\n     }\n \n     /**\n@@ -215,4 +218,4 @@ protected static String getParentPath(String path) {\n         return path.substring(0, path.lastIndexOf(\"/\"));\n     }\n \n-}\n\\ No newline at end of file\n+}",
                "raw_url": "https://github.com/apache/lenya/raw/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/MoveSubsite.java",
                "sha": "4475477fb000b0d5be75bdbd5dc5d1c0fd74725c",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/lenya/blob/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Deactivate.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Deactivate.java?ref=6ab3f7a37978c2bf4a91479bde794336a352ec09",
                "deletions": 4,
                "filename": "src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Deactivate.java",
                "patch": "@@ -86,9 +86,11 @@ protected void doCheckPreconditions() throws Exception {\n             List nodes = new ArrayList();\n \n             Document doc = getSourceDocument();\n-            Document liveDoc = doc.getAreaVersion(Publication.LIVE_AREA);\n-            nodes.add(liveDoc.getRepositoryNode());\n-            nodes.add(liveDoc.area().getSite().getRepositoryNode());\n+            if(doc != null) {\n+                Document liveDoc = doc.getAreaVersion(Publication.LIVE_AREA);\n+                nodes.add(liveDoc.getRepositoryNode());\n+                nodes.add(liveDoc.area().getSite().getRepositoryNode());\n+            }\n             return (org.apache.lenya.cms.repository.Node[]) nodes.toArray(new org.apache.lenya.cms.repository.Node[nodes.size()]);\n \n         } catch (Exception e) {\n@@ -201,4 +203,4 @@ public LinkList(ServiceManager manager, Document doc) {\n \n     }\n \n-}\n\\ No newline at end of file\n+}",
                "raw_url": "https://github.com/apache/lenya/raw/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Deactivate.java",
                "sha": "84fa6bcf25cd4c45c3f7b21df43dc727a225f344",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/lenya/blob/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/InvokeWorkflow.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/InvokeWorkflow.java?ref=6ab3f7a37978c2bf4a91479bde794336a352ec09",
                "deletions": 2,
                "filename": "src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/InvokeWorkflow.java",
                "patch": "@@ -41,7 +41,10 @@\n      * @see org.apache.lenya.cms.usecase.AbstractUsecase#getNodesToLock()\n      */\n     protected Node[] getNodesToLock() throws UsecaseException {\n-        Node[] objects = { getSourceDocument().getRepositoryNode() };\n+        Node[] objects = new Node[0];\n+        if(getSourceDocument() != null) {\n+            objects = new Node[] { getSourceDocument().getRepositoryNode() };\n+        }\n         return objects;\n     }\n \n@@ -54,4 +57,4 @@ protected void doExecute() throws Exception {\n                 getEvent());\n     }\n \n-}\n\\ No newline at end of file\n+}",
                "raw_url": "https://github.com/apache/lenya/raw/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/InvokeWorkflow.java",
                "sha": "27718860a02b7452e0911ce1637afcdfdc8b7e68",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/lenya/blob/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Publish.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Publish.java?ref=6ab3f7a37978c2bf4a91479bde794336a352ec09",
                "deletions": 2,
                "filename": "src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Publish.java",
                "patch": "@@ -133,8 +133,10 @@ protected boolean hasBrokenLinks() {\n             List nodes = new ArrayList();\n \n             Document doc = getSourceDocument();\n-            nodes.add(doc.getRepositoryNode());\n-            nodes.add(doc.area().getSite().getRepositoryNode());\n+            if(doc != null) {\n+                nodes.add(doc.getRepositoryNode());\n+                nodes.add(doc.area().getSite().getRepositoryNode());\n+            }\n \n             return (org.apache.lenya.cms.repository.Node[]) nodes\n                     .toArray(new org.apache.lenya.cms.repository.Node[nodes.size()]);",
                "raw_url": "https://github.com/apache/lenya/raw/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Publish.java",
                "sha": "91d9590e14a9f422f7674e5d0ac14982191b7f5b",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/lenya/blob/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules/sitetree/java/src/org/apache/lenya/cms/site/usecases/Nudge.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/sitetree/java/src/org/apache/lenya/cms/site/usecases/Nudge.java?ref=6ab3f7a37978c2bf4a91479bde794336a352ec09",
                "deletions": 3,
                "filename": "src/modules/sitetree/java/src/org/apache/lenya/cms/site/usecases/Nudge.java",
                "patch": "@@ -104,8 +104,11 @@ protected void doCheckPreconditions() throws Exception {\n      * @see org.apache.lenya.cms.usecase.AbstractUsecase#getNodesToLock()\n      */\n     protected Node[] getNodesToLock() throws UsecaseException {\n-        Node node = getSourceDocument().area().getSite().getRepositoryNode();\n-        Node[] nodes = { node };\n+        Node[] nodes = new Node[0];\n+        if(getSourceDocument() != null) {\n+            Node node = getSourceDocument().area().getSite().getRepositoryNode();\n+            nodes = new Node[] { node };\n+        }\n         return nodes;\n     }\n \n@@ -150,4 +153,4 @@ protected void doExecute() throws Exception {\n         }\n \n     }\n-}\n\\ No newline at end of file\n+}",
                "raw_url": "https://github.com/apache/lenya/raw/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules/sitetree/java/src/org/apache/lenya/cms/site/usecases/Nudge.java",
                "sha": "a679fb525c08804a78d73f1fcbb1441c68fad95d",
                "status": "modified"
            }
        ],
        "message": "Last changes to prevent NPEs when selecting authoring node under site tab.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@559063 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/lenya/commit/e41efc2415df890373c182f00bcc54691819e623",
        "patched_files": [
            "MoveSubsite.java"
        ],
        "repo": "lenya",
        "unit_tests": [
            "MoveSubsiteTest.java"
        ]
    },
    "lenya_84e2ced": {
        "bug_id": "lenya_84e2ced",
        "commit": "https://github.com/apache/lenya/commit/84e2cedde53e39ef40a4d383dd549a2ed1bb892d",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/lenya/blob/84e2cedde53e39ef40a4d383dd549a2ed1bb892d/src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java?ref=84e2cedde53e39ef40a4d383dd549a2ed1bb892d",
                "deletions": 3,
                "filename": "src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java",
                "patch": "@@ -477,9 +477,11 @@ public boolean accept(File file) {\n                     return file.isDirectory() && !name.equals(\"rcml\") && !name.equals(\"rcbak\");\n                 }\n             });\n-            this.areas = new String[directories.length];\n-            for (int i = 0; i < directories.length; i++) {\n-                this.areas[i] = directories[i].getName();\n+            if (directories != null) {\n+                this.areas = new String[directories.length];\n+                for (int i = 0; i < directories.length; i++) {\n+                    this.areas[i] = directories[i].getName();\n+                }\n             }\n         }\n         return this.areas;",
                "raw_url": "https://github.com/apache/lenya/raw/84e2cedde53e39ef40a4d383dd549a2ed1bb892d/src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java",
                "sha": "302162aca45048dbff53441c93523568b5cccf54",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/lenya/blob/84e2cedde53e39ef40a4d383dd549a2ed1bb892d/src/modules/migration/java/test/org/apache/lenya/cms/migration/MigrateUuidsTest.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/migration/java/test/org/apache/lenya/cms/migration/MigrateUuidsTest.java?ref=84e2cedde53e39ef40a4d383dd549a2ed1bb892d",
                "deletions": 3,
                "filename": "src/modules/migration/java/test/org/apache/lenya/cms/migration/MigrateUuidsTest.java",
                "patch": "@@ -67,9 +67,11 @@ private void migratePublication(Publication pub) throws Exception {\n         getLogger().info(\"Migrating publication [\" + pub.getId() + \"]\");\n \n         String[] areaNames = pub.getAreaNames();\n-        for (int i = 0; i < areaNames.length; i++) {\n-            Area area = pub.getArea(areaNames[i]);\n-            migrateArea(area);\n+        if (areaNames != null) {\n+            for (int i = 0; i < areaNames.length; i++) {\n+                Area area = pub.getArea(areaNames[i]);\n+                migrateArea(area);\n+            }\n         }\n     }\n ",
                "raw_url": "https://github.com/apache/lenya/raw/84e2cedde53e39ef40a4d383dd549a2ed1bb892d/src/modules/migration/java/test/org/apache/lenya/cms/migration/MigrateUuidsTest.java",
                "sha": "91546bba901226db02aed34cb4136b199cde8d0e",
                "status": "modified"
            }
        ],
        "message": "fixed some NPEs when migrating a pub with no areas (should skip pub, not give npe)\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@438213 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/lenya/commit/35d8498948614372e5a9976d8c5b06c274d137c1",
        "patched_files": [
            "PublicationConfiguration.java"
        ],
        "repo": "lenya",
        "unit_tests": [
            "MigrateUuidsTest.java"
        ]
    },
    "lenya_8b2f5c3": {
        "bug_id": "lenya_8b2f5c3",
        "commit": "https://github.com/apache/lenya/commit/8b2f5c3a05d47823d5d1dcc60a93dde124223498",
        "file": [
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/lenya/blob/8b2f5c3a05d47823d5d1dcc60a93dde124223498/src/java/org/apache/lenya/cms/publication/DefaultDocument.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/publication/DefaultDocument.java?ref=8b2f5c3a05d47823d5d1dcc60a93dde124223498",
                "deletions": 4,
                "filename": "src/java/org/apache/lenya/cms/publication/DefaultDocument.java",
                "patch": "@@ -1,5 +1,5 @@\n /*\n-$Id: DefaultDocument.java,v 1.24 2003/08/13 09:57:31 egli Exp $\n+$Id: DefaultDocument.java,v 1.25 2003/08/13 15:05:59 egli Exp $\n <License>\n \n  ============================================================================\n@@ -187,9 +187,12 @@ public String getLanguage() {\n         SiteTree sitetree;\n         try {\n             sitetree = getPublication().getSiteTree(getArea());\n-            Label[] labels = sitetree.getNode(getId()).getLabels();\n-            for (int i = 0; i < labels.length; i++) {\n-                languages.add(labels[i].getLanguage());\n+            SiteTreeNode node = sitetree.getNode(getId());\n+            if (node != null) {\n+                Label[] labels = node.getLabels();\n+                for (int i = 0; i < labels.length; i++) {\n+                    languages.add(labels[i].getLanguage());\n+                }\n             }\n         } catch (SiteTreeException e) {\n             throw new DocumentException(e);",
                "raw_url": "https://github.com/apache/lenya/raw/8b2f5c3a05d47823d5d1dcc60a93dde124223498/src/java/org/apache/lenya/cms/publication/DefaultDocument.java",
                "sha": "f9409e73d8e39a441585bd4660608fbeef74a17a",
                "status": "modified"
            }
        ],
        "message": "Fix a nullPointerException by querying the node for != null\nbefore asking it for it's languages.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/lenya/trunk@40728 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/lenya/commit/7fcb989e2420ea4608f45caf180262ae1a4396bb",
        "patched_files": [
            "DefaultDocument.java"
        ],
        "repo": "lenya",
        "unit_tests": [
            "DefaultDocumentTest.java"
        ]
    },
    "lenya_a65be31": {
        "bug_id": "lenya_a65be31",
        "commit": "https://github.com/apache/lenya/commit/a65be31aeb23ee3db823c5cc68e8722c30dc1e1f",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/lenya/blob/a65be31aeb23ee3db823c5cc68e8722c30dc1e1f/src/java/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java?ref=a65be31aeb23ee3db823c5cc68e8722c30dc1e1f",
                "deletions": 2,
                "filename": "src/java/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java",
                "patch": "@@ -202,8 +202,7 @@ public void removeLabel(Label label) {\n                 Node child = children.item(i);\n \n                 if ((child.getNodeType() == Node.ELEMENT_NODE)\n-                        && child.getNodeName().equals(LABEL_NAME)\n-                        && child.getFirstChild().getNodeValue().equals(label.getLabel())) {\n+                        && child.getNodeName().equals(LABEL_NAME)) {\n \n                     Node languageAttribute = child.getAttributes()\n                             .getNamedItem(LANGUAGE_ATTRIBUTE_NAME);",
                "raw_url": "https://github.com/apache/lenya/raw/a65be31aeb23ee3db823c5cc68e8722c30dc1e1f/src/java/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java",
                "sha": "9d17668e0ba7192cba59d9a3b600870ea3656639",
                "status": "modified"
            }
        ],
        "message": "fixed NPE for empty sitetree node labels\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@155316 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/lenya/commit/51e791534aedcd9194479d18552cc4465590c54a",
        "patched_files": [
            "SiteTreeNodeImpl.java"
        ],
        "repo": "lenya",
        "unit_tests": [
            "SiteTreeNodeImplTest.java"
        ]
    },
    "lenya_cc8afb8": {
        "bug_id": "lenya_cc8afb8",
        "commit": "https://github.com/apache/lenya/commit/cc8afb8edfa19c03fca3c30177088f4546388b59",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/lenya/blob/cc8afb8edfa19c03fca3c30177088f4546388b59/src/test/org/apache/lenya/cms/rc/RevisionControllerTest.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/test/org/apache/lenya/cms/rc/RevisionControllerTest.java?ref=cc8afb8edfa19c03fca3c30177088f4546388b59",
                "deletions": 1,
                "filename": "src/test/org/apache/lenya/cms/rc/RevisionControllerTest.java",
                "patch": "@@ -53,7 +53,7 @@ public static void main(String[] args) {\n         String source = args[1];\n         String identityD = args[2];\n         String destination = args[3];\n-        RevisionController rc = new RevisionController(\"\", \"\", \"\");\n+        RevisionController rc = new RevisionController(null, null, null);\n         try {\n             rc.reservedCheckOut(source, identityS);\n         } catch (FileNotFoundException e) // No such source file",
                "raw_url": "https://github.com/apache/lenya/raw/cc8afb8edfa19c03fca3c30177088f4546388b59/src/test/org/apache/lenya/cms/rc/RevisionControllerTest.java",
                "sha": "18df08fbd26ab9f96e0c98554fb7e4fc3318ecfb",
                "status": "modified"
            }
        ],
        "message": "use NULL to generate NPEs instead of FileNotFoundException\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@123059 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/lenya/commit/88a8b5fd10d4b38ddff04f145ab014a220b4d3e2",
        "patched_files": [
            "RevisionController.java"
        ],
        "repo": "lenya",
        "unit_tests": [
            "RevisionControllerTest.java"
        ]
    },
    "lenya_ea6bb10": {
        "bug_id": "lenya_ea6bb10",
        "commit": "https://github.com/apache/lenya/commit/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
        "file": [
            {
                "additions": 87,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java",
                "changes": 138,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 51,
                "filename": "src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java",
                "patch": "@@ -30,7 +30,9 @@\n import org.apache.lenya.cms.repository.Node;\n \n /**\n- * A publication configuration.\n+ * A publication's configuration.\n+ * Keep in sync with src/webapp/lenya/resources/schemas/publication.rng!\n+ * FIXME: validate publication.xconf before attempting to parse\n  */\n public class PublicationConfiguration extends AbstractLogEnabled implements Publication {\n \n@@ -43,11 +45,6 @@\n     private String instantiatorHint = null;\n     private String contentDir = null;\n \n-    private static final String ELEMENT_PROXY = \"proxy\";\n-    private static final String ATTRIBUTE_AREA = \"area\";\n-    private static final String ATTRIBUTE_URL = \"url\";\n-    private static final String ATTRIBUTE_SSL = \"ssl\";\n-\n     private boolean isConfigLoaded = false;\n \n     /**\n@@ -56,20 +53,41 @@\n     public static final String CONFIGURATION_FILE = CONFIGURATION_PATH + File.separator\n             + \"publication.xconf\";\n \n-    private static final String ELEMENT_TEMPLATES = \"templates\";\n+    private static final String CONFIGURATION_NAMESPACE = \n+            \"http://apache.org/cocoon/lenya/publication/1.1\" ;\n+\n+    // properties marked with \"*\" are currently not parsed by this class.\n+    private static final String ELEMENT_NAME = \"name\";\n+    private static final String ELEMENT_DESCRIPTION = \"description\"; //*\n+    private static final String ELEMENT_LONGDESC = \"longdesc\"; //*\n+    private static final String ELEMENT_VERSION = \"version\"; //*\n+    private static final String ELEMENT_LENYA_VERSION = \"lenya-version\"; //*\n+    private static final String ELEMENT_LENYA_REVISION = \"lenya-revision\"; //*\n+    private static final String ELEMENT_COCOON_VERSION = \"cocoon-version\"; //*\n+    private static final String ELEMENT_LANGUAGES = \"languages\";\n+    private static final String ELEMENT_LANGUAGE = \"language\";\n+    private static final String ATTRIBUTE_DEFAULT_LANGUAGE = \"default\";\n     private static final String ELEMENT_TEMPLATE = \"template\";\n     private static final String ATTRIBUTE_ID = \"id\";\n+    private static final String ELEMENT_TEMPLATE_INSTANTIATOR = \"template-instantiator\";\n+    private static final String ATTRIBUTE_NAME = \"name\";\n     private static final String ELEMENT_PATH_MAPPER = \"path-mapper\";\n     private static final String ELEMENT_DOCUMENT_BUILDER = \"document-builder\";\n     private static final String ELEMENT_SITE_MANAGER = \"site-manager\";\n-    private static final String ATTRIBUTE_NAME = \"name\";\n-    private static final String ELEMENT_TEMPLATE_INSTANTIATOR = \"template-instantiator\";\n-    private static final String ELEMENT_CONTENT_DIR = \"content-dir\";\n-    private static final String LANGUAGES = \"languages\";\n-    private static final String DEFAULT_LANGUAGE_ATTR = \"default\";\n-    private static final String BREADCRUMB_PREFIX = \"breadcrumb-prefix\";\n-    private static final String ELEMENT_RESOURCE_TYPE = \"resource-type\";\n+    private static final String ELEMENT_RESOURCE_TYPES = \"resource-types\";//*\n+    private static final String ELEMENT_RESOURCE_TYPE = \"resource-type\";//*\n     private static final String ATTRIBUTE_WORKFLOW = \"workflow\";\n+    private static final String ELEMENT_MODULES = \"modules\";//*\n+    private static final String ELEMENT_MODULE = \"module\";//*\n+    private static final String ELEMENT_BREADCRUMB_PREFIX = \"breadcrumb-prefix\";\n+    private static final String ELEMENT_CONTENT_DIR = \"content-dir\";\n+    private static final String ATTRIBUTE_SRC = \"src\";\n+    private static final String ELEMENT_PROXIES = \"proxies\";\n+    private static final String ELEMENT_PROXY = \"proxy\";\n+    private static final String ATTRIBUTE_AREA = \"area\";\n+    private static final String ATTRIBUTE_URL = \"url\";\n+    private static final String ATTRIBUTE_SSL = \"ssl\";\n+\n \n     /**\n      * Creates a new instance of Publication\n@@ -108,8 +126,9 @@ protected void loadConfiguration() {\n         } else {\n             getLogger().debug(\"Configuration file [\" + configFile + \"] exists.\");\n         }\n-\n-        DefaultConfigurationBuilder builder = new DefaultConfigurationBuilder();\n+        \n+        final boolean ENABLE_XML_NAMESPACES = true;\n+        DefaultConfigurationBuilder builder = new DefaultConfigurationBuilder(ENABLE_XML_NAMESPACES);\n \n         Configuration config;\n \n@@ -119,6 +138,13 @@ protected void loadConfiguration() {\n             config = builder.buildFromFile(configFile);\n \n             try {\n+                // one sanity check for the proper namespace. we should really do that for every element,\n+                // but since ELEMENT_PATH_MAPPER is mandatory, this should catch most cases of forgotten namespace.\n+                if (config.getChild(ELEMENT_PATH_MAPPER).getNamespace() != CONFIGURATION_NAMESPACE) {\n+                   getLogger().warn(\"Deprecated configuration: the publication configuration elements in \"\n+                       + configFile + \" must be in the \" + CONFIGURATION_NAMESPACE + \" namespace.\"\n+                       + \" See webapp/lenya/resources/schemas/publication.xconf.\");\n+                }\n                 pathMapperClassName = config.getChild(ELEMENT_PATH_MAPPER).getValue();\n                 Class pathMapperClass = Class.forName(pathMapperClassName);\n                 this.mapper = (DocumentIdToPathMapper) pathMapperClass.newInstance();\n@@ -134,12 +160,12 @@ protected void loadConfiguration() {\n                         .getAttribute(ATTRIBUTE_NAME);\n             }\n \n-            Configuration[] _languages = config.getChild(LANGUAGES).getChildren();\n+            Configuration[] _languages = config.getChild(ELEMENT_LANGUAGES).getChildren(ELEMENT_LANGUAGE);\n             for (int i = 0; i < _languages.length; i++) {\n                 Configuration languageConfig = _languages[i];\n                 String language = languageConfig.getValue();\n                 this.languages.add(language);\n-                if (languageConfig.getAttribute(DEFAULT_LANGUAGE_ATTR, null) != null) {\n+                if (languageConfig.getAttribute(ATTRIBUTE_DEFAULT_LANGUAGE, null) != null) {\n                     this.defaultLanguage = language;\n                 }\n             }\n@@ -149,34 +175,41 @@ protected void loadConfiguration() {\n                 this.siteManagerName = siteManagerConfiguration.getAttribute(ATTRIBUTE_NAME);\n             }\n \n-            Configuration[] proxyConfigs = config.getChildren(ELEMENT_PROXY);\n-            for (int i = 0; i < proxyConfigs.length; i++) {\n-                String url = proxyConfigs[i].getAttribute(ATTRIBUTE_URL);\n-                String ssl = proxyConfigs[i].getAttribute(ATTRIBUTE_SSL);\n-                String area = proxyConfigs[i].getAttribute(ATTRIBUTE_AREA);\n-\n-                Proxy proxy = new Proxy();\n-                proxy.setUrl(url);\n-\n-                Object key = getProxyKey(area, Boolean.valueOf(ssl).booleanValue());\n-                this.areaSsl2proxy.put(key, proxy);\n-                if (getLogger().isDebugEnabled()) {\n-                    getLogger().debug(\n-                            \"Adding proxy: [\" + proxy + \"] for area=[\" + area + \"] SSL=[\" + ssl\n-                                    + \"]\");\n+            Configuration proxyConfig = config.getChild(ELEMENT_PROXIES);\n+            if (proxyConfig != null) {\n+                Configuration[] proxyConfigs = proxyConfig.getChildren(ELEMENT_PROXY);\n+                for (int i = 0; i < proxyConfigs.length; i++) {\n+                    String url = proxyConfigs[i].getAttribute(ATTRIBUTE_URL);\n+                    String ssl = proxyConfigs[i].getAttribute(ATTRIBUTE_SSL);\n+                    String area = proxyConfigs[i].getAttribute(ATTRIBUTE_AREA);\n+    \n+                    Proxy proxy = new Proxy();\n+                    proxy.setUrl(url);\n+    \n+                    Object key = getProxyKey(area, Boolean.valueOf(ssl).booleanValue());\n+                    this.areaSsl2proxy.put(key, proxy);\n+                    if (getLogger().isDebugEnabled()) {\n+                        getLogger().debug(\n+                                \"Adding proxy: [\" + proxy + \"] for area=[\" + area + \"] SSL=[\" + ssl\n+                                        + \"]\");\n+                    }\n                 }\n             }\n \n-            Configuration templatesConfig = config.getChild(ELEMENT_TEMPLATES);\n-            if (templatesConfig != null) {\n-                Configuration[] templateConfigs = templatesConfig.getChildren(ELEMENT_TEMPLATE);\n-                this.templates = new String[templateConfigs.length];\n-                for (int i = 0; i < templateConfigs.length; i++) {\n-                    String templateId = templateConfigs[i].getAttribute(ATTRIBUTE_ID);\n-                    this.templates[i] = templateId;\n-                }\n+            Configuration templateConfig = config.getChild(ELEMENT_TEMPLATE, false);\n+            //FIXME: this is a hack. For some reason, the old code seems to imply that a publication\n+            // can have multiple templates. This is not the case. All this code should use a simple string\n+            // rather than arrays at some point. For now, the old array is kept, to avoid having to deal\n+            // with all kinds of NPEs that keep cropping up...\n+            if (templateConfig == null) {\n+                this.templates = new String[0]; // ugh. empty array to keep the legacy code from breaking.\n+            }\n+            else {\n+                 this.templates = new String[1];\n+                 this.templates[0] = templateConfig.getAttribute(ATTRIBUTE_ID);\n             }\n \n+\n             Configuration templateInstantiatorConfig = config.getChild(\n                     ELEMENT_TEMPLATE_INSTANTIATOR, false);\n             if (templateInstantiatorConfig != null) {\n@@ -186,21 +219,24 @@ protected void loadConfiguration() {\n \n             Configuration contentDirConfig = config.getChild(ELEMENT_CONTENT_DIR, false);\n             if (contentDirConfig != null) {\n-                this.contentDir = contentDirConfig.getAttribute(\"src\");\n+                this.contentDir = contentDirConfig.getAttribute(ATTRIBUTE_SRC);\n                 getLogger().info(\n                         \"Content directory loaded from pub configuration: \" + this.contentDir);\n             } else {\n                 getLogger().info(\"No content directory specified within pub configuration!\");\n             }\n \n-            Configuration[] resourceTypeConfigs = config.getChildren(ELEMENT_RESOURCE_TYPE);\n-            for (int i = 0; i < resourceTypeConfigs.length; i++) {\n-                String name = resourceTypeConfigs[i].getAttribute(ATTRIBUTE_NAME);\n-                this.resourceTypes.add(name);\n-\n-                String workflow = resourceTypeConfigs[i].getAttribute(ATTRIBUTE_WORKFLOW, null);\n-                if (workflow != null) {\n-                    this.resourceType2workflow.put(name, workflow);\n+            Configuration resourceTypeConfig = config.getChild(ELEMENT_RESOURCE_TYPES);\n+            if (resourceTypeConfig != null) {\n+                Configuration[] resourceTypeConfigs = resourceTypeConfig.getChildren(ELEMENT_RESOURCE_TYPE);\n+                for (int i = 0; i < resourceTypeConfigs.length; i++) {\n+                    String name = resourceTypeConfigs[i].getAttribute(ATTRIBUTE_NAME);\n+                    this.resourceTypes.add(name);\n+    \n+                    String workflow = resourceTypeConfigs[i].getAttribute(ATTRIBUTE_WORKFLOW, null);\n+                    if (workflow != null) {\n+                        this.resourceType2workflow.put(name, workflow);\n+                    }\n                 }\n             }\n \n@@ -209,7 +245,7 @@ protected void loadConfiguration() {\n                     e);\n         }\n \n-        this.breadcrumbprefix = config.getChild(BREADCRUMB_PREFIX).getValue(\"\");\n+        this.breadcrumbprefix = config.getChild(ELEMENT_BREADCRUMB_PREFIX).getValue(\"\");\n \n         isConfigLoaded = true;\n     }",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java",
                "sha": "afc6d97fbb18f28d0d2ad60e12b6312ab7620e2f",
                "status": "modified"
            },
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/blog/config/publication.xconf",
                "changes": 26,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/pubs/blog/config/publication.xconf?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 14,
                "filename": "src/pubs/blog/config/publication.xconf",
                "patch": "@@ -18,7 +18,13 @@\n \n <!-- $Id$ -->\n \n-<publication>\n+<publication xmlns=\"http://apache.org/cocoon/lenya/publication/1.1\" show=\"true\">\n+  <name>Lenya Blog</name>\n+  <description>An experimental Lenya-based blog in proof-of-concept stage.</description>\n+  <version>@lenya.version@</version>\n+  <lenya-version>@lenya.version@</lenya-version>\n+  <lenya-revision>@lenya.revision@</lenya-revision>\n+  <cocoon-version>2.1.8+</cocoon-version>\n   <languages>\n     <language default=\"true\">en</language>\n     <language>de</language>\n@@ -28,17 +34,9 @@\n   <breadcrumb-prefix/>\n   <ssl-prefix/>\n   <site-manager name=\"simple\"/>\n-  <resource-type name=\"entry\" workflow=\"workflow.xml\"/>\n-  <resource-type name=\"sidebar\" workflow=\"workflow.xml\"/>\n-\n-  <!-- NOTE: The configuration of the content directory has NOT been fully tested yet and might lead to unexpected results. Use at own risk ;-) -->\n-  <!-- Relative to webapp context: -->\n-  <!--\n-  <content-dir src=\"lenya/pubs/blog\"/>\n-  -->\n-  <!-- Absolute: -->\n-  <!--\n-  <content-dir src=\"/home/USERNAME/data/blog\"/>\n-  <content-dir src=\"D:/tmp/blog\"/>\n-  -->\n+  <resource-types>\n+    <resource-type name=\"entry\" workflow=\"workflow.xml\"/>\n+    <resource-type name=\"sidebar\" workflow=\"workflow.xml\"/>\n+  </resource-types>\n </publication>\n+",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/blog/config/publication.xconf",
                "sha": "c4683826e8fa4b485fde5b0fc505b546c0394f73",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/lenya/blob/0db5be126f05d2c026e5cf63ef6ded6b2d3556a9/src/pubs/blog/publication-tests.xml",
                "changes": 27,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/pubs/blog/publication-tests.xml?ref=0db5be126f05d2c026e5cf63ef6ded6b2d3556a9",
                "deletions": 27,
                "filename": "src/pubs/blog/publication-tests.xml",
                "patch": "@@ -1,27 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>\n-<!--\n-  Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n--->\n-\n-<!-- $Id$ -->\n-\n-<lenya:publication xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.0\">\n-<lenya:tests>\n-  <lenya:test>Feed example: <a href=\"live/feeds/all/index.xml\">XML</a>, <a href=\"live/feeds/all/index.html\">HTML</a></lenya:test>\n-  <lenya:test>WebDAV: <a href=\"webdav://127.0.0.1:8080/lenya/blog/webdav/entries/2003/\">Collection</a></lenya:test>\n-  <lenya:test>Atom: <a href=\"atomapi/\">Introspection</a>, <a href=\"atomapi/search?atom-all\">atom-all</a></lenya:test>\n-</lenya:tests>\n-</lenya:publication>",
                "raw_url": "https://github.com/apache/lenya/raw/0db5be126f05d2c026e5cf63ef6ded6b2d3556a9/src/pubs/blog/publication-tests.xml",
                "sha": "0ae011ad5f9ce93f45bae13cb6798967d5e88d6d",
                "status": "removed"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/blog/publication.xml",
                "changes": 79,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/pubs/blog/publication.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 79,
                "filename": "src/pubs/blog/publication.xml",
                "patch": "@@ -1,79 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<!--\n-  Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n--->\n-\n-<!-- $Id$ -->\n-\n-<lenya:publication xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.0\" lenya:show=\"true\">\n-<lenya:pub-version>@lenya.version@</lenya:pub-version>\n-<lenya:lenya-version>@lenya.version@</lenya:lenya-version>\n-<lenya:lenya-revision>@lenya.revision@</lenya:lenya-revision>\n-<lenya:cocoon-version>2.1.8 or 2.1.9-dev</lenya:cocoon-version>\n-<lenya:name>Lenya's Weblog</lenya:name>\n-\n-<lenya:description>\n-This publication is an initiative to implement the <a href=\"http://www.intertwingly.net/wiki/pie/FrontPage\">\"Echo/Atom\"</a> specification for syndicating, archiving and\n-editing episodic web sites (e.g. weblogs).\n-</lenya:description>\n-\n-<lenya:readme>\n-<h3>Customizing the layout</h3>\n-The fonts and colors can be customized by editing the file <code>resources/css/styles.css</code>.\n-The positioning can be customized by editing the file <code>xslt/global.xsl</code>. The following CSS resources\n-might be helpful\n-<br /><a href=\"http://www.w3schools.com/css/css_reference.asp\">CSS2 Reference</a>\n-<br /><a href=\"http://www.csszengarden.com\">The Beauty of CSS Design</a>\n-<br /><a href=\"http://www.lightsphere.com/colors/\">216 Color Square</a>\n-\n-<h3>Weblog Resources</h3>\n-<a href=\"http://www.intertwingly.net/wiki/pie/Syntax\">Doctypes</a> (entry, feed, etc.)\n-<br />\n-<a href=\"http://www.imc.org/atom-syntax/mail-archive/maillist.html\">Mailing List</a>\n-<br />\n-<a href=\"http://intertwingly.net/stories/2003/07/01/example.necho\">XML proposal of doctype entry</a>\n-<br />\n-<a href=\"http://www.dynamicobjects.com/d2r/archives/001921.html\">A Review of Blogging APIs</a>\n-<br />\n-<a href=\"http://btrott.typepad.com/typepad/atom.xml\">Sample Feed by TypePad</a>\n-\n-<h3>Other Atom API Implementations</h3>\n-<a href=\"http://bitworking.org/rfc/\">Specification</a>\n-<br />\n-<a href=\"http://diveintomark.org/archives/2003/08/18/atom_api_implementation\">Overview</a>\n-<br />\n-<a href=\"http://bitworking.org/rfc/implementation/wxAtomClient_25Aug2003.zip\">Python Client</a>\n-<br />\n-<code>export HTTP_PROXY=http://127.0.0.1:4444</code>\n-<br />\n-<code>python wxAtomClientApp.py</code>\n-<br />\n-<a href=\"http://www.diveintomark.org/atom/\">Testing the client</a>\n-<br />\n-<code>java -classpath lib/axis.jar org.apache.axis.utils.tcpmon</code>\n-(Listen Port # 4444, Act as a ... Proxy, Options: HTTP Proxy Support)\n-<br />\n-<a href=\"http://diveintomark.org/public/2003/08/atom-api-20030825.py\">Python Server</a>\n-<br />\n-<a href=\"http://www.intertwingly.net/code/mombo/\">Python Server</a>\n-\n-<h3>Atom Misc</h3>\n-<a href=\"http://www.feedvalidator.org\">http://www.feedvalidator.org</a>\n-<br />\n-<a href=\"http://feedvalidator.org/download/rssvalidator-latest.zip\">Download Feed Validator</a>\n-</lenya:readme>\n-\n-</lenya:publication>",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/blog/publication.xml",
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "status": "modified"
            },
            {
                "additions": 79,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/blog/readme.xml",
                "changes": 79,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/pubs/blog/readme.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 0,
                "filename": "src/pubs/blog/readme.xml",
                "patch": "@@ -0,0 +1,79 @@\n+<?xml version=\"1.0\"?>\n+<!--\n+  Licensed to the Apache Software Foundation (ASF) under one or more\n+  contributor license agreements.  See the NOTICE file distributed with\n+  this work for additional information regarding copyright ownership.\n+  The ASF licenses this file to You under the Apache License, Version 2.0\n+  (the \"License\"); you may not use this file except in compliance with\n+  the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+-->\n+\n+<!-- $Id: introduction.xml 473861 2006-11-12 03:51:14Z gregor $ -->\n+\n+<page:page \n+  xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\n+  xmlns=\"http://www.w3.org/1999/xhtml\"\n+>\n+  <page:head/>\n+  <page:body>\n+    <h1>README: Blog</h1>\n+    <h2>Customizing the layout</h2>\n+    <p>\n+      The fonts and colors can be customized by editing the file <code>resources/css/styles.css</code>.\n+      The positioning can be customized by editing the file <code>xslt/global.xsl</code>. The following CSS resources\n+      might be helpful:\n+    </p>\n+    <ul>\n+      <li><a href=\"http://www.w3schools.com/css/css_reference.asp\">CSS2 Reference</a></li>\n+      <li><a href=\"http://www.csszengarden.com\">The Beauty of CSS Design</a></li>\n+      <li><a href=\"http://www.lightsphere.com/colors/\">216 Color Square</a></li>\n+    </ul>\n+    <h2>Testing the blog</h2>\n+    <ul>\n+      <li>Feed example: <a href=\"live/feeds/all/index.xml\">XML</a>, <a href=\"live/feeds/all/index.html\">HTML</a></li>\n+      <li>WebDAV: <a href=\"webdav://127.0.0.1:8080/lenya/blog/webdav/entries/2003/\">Collection</a></li>\n+      <li>Atom: <a href=\"atomapi/\">Introspection</a>, <a href=\"atomapi/search?atom-all\">atom-all</a></li>\n+    </ul>\n+    <h2>Weblog Resources</h2>\n+    <ul>\n+      <li><a href=\"http://www.intertwingly.net/wiki/pie/Syntax\">Doctypes</a> (entry, feed, etc.)</li>\n+      <li><a href=\"http://www.imc.org/atom-syntax/mail-archive/maillist.html\">Mailing List</a></li>\n+      <li><a href=\"http://intertwingly.net/stories/2003/07/01/example.necho\">XML proposal of doctype entry</a></li>\n+      <li><a href=\"http://www.dynamicobjects.com/d2r/archives/001921.html\">A Review of Blogging APIs</a></li>\n+      <li><a href=\"http://btrott.typepad.com/typepad/atom.xml\">Sample Feed by TypePad</a></li>\n+    </ul>\n+    \n+    <h2>Other Atom API Implementations</h2>\n+    <ul>\n+      <li><a href=\"http://bitworking.org/rfc/\">Specification</a></li>\n+      <li><a href=\"http://diveintomark.org/archives/2003/08/18/atom_api_implementation\">Overview</a></li>\n+      <li>\n+        <a href=\"http://bitworking.org/rfc/implementation/wxAtomClient_25Aug2003.zip\">Python Client</a><br />\n+        <code>export HTTP_PROXY=http://127.0.0.1:4444</code><br />\n+        <code>python wxAtomClientApp.py</code>\n+      </li>\n+      <li>\n+        <a href=\"http://www.diveintomark.org/atom/\">Testing the client</a><br />\n+        <code>java -classpath lib/axis.jar org.apache.axis.utils.tcpmon</code><br />\n+        (Listen Port # 4444, Act as a ... Proxy, Options: HTTP Proxy Support)\n+      </li>\n+      <li><a href=\"http://diveintomark.org/public/2003/08/atom-api-20030825.py\">Python Server</a></li>\n+      <li><a href=\"http://www.intertwingly.net/code/mombo/\">Python Server</a></li>\n+    </ul>\n+    \n+    <h2>Atom Misc</h2>\n+    <ul>\n+      <li><a href=\"http://www.feedvalidator.org\">http://www.feedvalidator.org</a></li>\n+      <li><a href=\"http://feedvalidator.org/download/rssvalidator-latest.zip\">Download Feed Validator</a></li>\n+    </ul>\n+  </page:body>\n+</page:page>\n+ ",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/blog/readme.xml",
                "sha": "64051a46651cb3cf4947079d02bdc5ce950b52ba",
                "status": "added"
            },
            {
                "additions": 65,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/default/config/publication.xconf",
                "changes": 113,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/pubs/default/config/publication.xconf?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 48,
                "filename": "src/pubs/default/config/publication.xconf",
                "patch": "@@ -18,76 +18,93 @@\n \n <!-- $Id$ -->\n \n-<publication>\n+<publication xmlns=\"http://apache.org/cocoon/lenya/publication/1.1\" >\n \n-  <!-- NOTE: The various languages need to be listed for verification and widget building -->\n+  <name>Default Publication</name>\n+  <description>This publication is a best practice, getting started publication.</description>\n+  <!-- the @...@ macros are evaluated by ant at build time -->\n+  <version>@lenya.version@</version>\n+  <lenya-version>@lenya.version@</lenya-version>\n+  <lenya-revision>@lenya.revision@</lenya-revision>\n+  <cocoon-version>2.1.10-dev</cocoon-version>\n+\n+  <!-- The various languages need to be listed for verification and widget building -->\n   <languages>\n     <language default=\"true\">en</language>\n     <language>de</language>\n     <language>he</language>\n     <language>es</language>\n     <language>fr</language>\n   </languages>\n+  <!-- A template instantiator is used to create new publications based on this one. -->\n   <template-instantiator name=\"default\"/>\n+  <!-- A publication can inherit from another publication. \"id\" corresponds to the publication id \n+       of that template (and thus to the name of the directory it's stored in) -->\n+  <!--\n+     <template id=\"some-pub-id\"/>\n+  -->\n   <path-mapper>org.apache.lenya.cms.publication.DefaultDocumentIdToPathMapper</path-mapper>\n   <document-builder name=\"default\"/>\n   <breadcrumb-prefix/>\n   <site-manager name=\"tree\"/>\n   \n-  <!-- NOTE: Resource types need to be listed because of the workflow resp. because the workflow depends on the publication and not on the resource type -->\n-  <resource-type name=\"xhtml\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n-  <resource-type name=\"homepage\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n-  <resource-type name=\"links\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n-  <resource-type name=\"cforms\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n-  <resource-type name=\"opendocument\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n-  <resource-type name=\"resource\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n-  <resource-type name=\"usecase\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n-  <resource-type name=\"news\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+  <!-- Resource types need to be listed because of the workflow resp. because the workflow depends on the publication and not on the resource type -->\n+  <resource-types>\n+    <resource-type name=\"xhtml\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+    <resource-type name=\"homepage\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+    <resource-type name=\"links\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+    <resource-type name=\"cforms\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+    <resource-type name=\"opendocument\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+    <resource-type name=\"resource\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+    <resource-type name=\"usecase\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+    <resource-type name=\"news\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+  </resource-types>\n   \n-  <!-- NOTE: Modules need to be listed because of the menu and i18n -->\n-  <module name=\"editors\"/>\n-  <module name=\"xhtml\"/>\n-  <module name=\"links\"/>\n-  <module name=\"opendocument\"/>\n-  <module name=\"cforms\"/>\n-  <module name=\"homepage\"/>\n-  <module name=\"resource\"/>\n-  <module name=\"sitemanagement\"/>\n-  <module name=\"sitetree\"/>\n-  <module name=\"export\"/>\n-  <module name=\"workflow\"/>\n-  <module name=\"notification\"/>\n-  <module name=\"svg\"/>\n-  <module name=\"lucene\"/>\n-  <module name=\"development\"/>\n-  <module name=\"languageselector\"/>\n-  <module name=\"administration\"/>\n-  <module name=\"news\"/>\n-  <module name=\"contactform\"/>\n+  <!-- Modules need to be listed because of the menu and i18n -->\n+  <modules>\n+    <module name=\"editors\"/>\n+    <module name=\"xhtml\"/>\n+    <module name=\"links\"/>\n+    <module name=\"opendocument\"/>\n+    <module name=\"cforms\"/>\n+    <module name=\"homepage\"/>\n+    <module name=\"resource\"/>\n+    <module name=\"sitemanagement\"/>\n+    <module name=\"sitetree\"/>\n+    <module name=\"export\"/>\n+    <module name=\"workflow\"/>\n+    <module name=\"notification\"/>\n+    <module name=\"svg\"/>\n+    <module name=\"lucene\"/>\n+    <module name=\"development\"/>\n+    <module name=\"languageselector\"/>\n+    <module name=\"administration\"/>\n+    <module name=\"news\"/>\n+  </modules>\n   <!-- TODO: The goal is to have a blog module ;-) -->\n   <!--\n   <module name=\"blog\"/>\n   -->\n \n-  <!-- NOTE: The configuration of the content directory has NOT been fully tested yet and might lead to unexpected results. Use at own risk ;-) -->\n-  <!-- Relative to webapp context: -->\n-  <!--\n-  <content-dir src=\"lenya/pubs/default\"/>\n-  -->\n-  <!-- Absolute: -->\n+  <!-- You can specify a custom location for your content, outside the Lenya build tree. Note that you will probably also want\n+       to specify custom locations for access control (see ac/ac.xconf), so that all your dynamically generated data is in one place\n+       for easy backup. -->\n   <!--\n-  <content-dir src=\"/home/USERNAME/data/default\"/>\n-  <content-dir src=\"D:/tmp/default\"/>\n+       Relative to webapp context: \n+          <content-dir src=\"lenya/pubs/default\"/>\n+       Absolute:\n+          <content-dir src=\"/home/USERNAME/data/default\"/>\n+          <content-dir src=\"D:/tmp/default\"/>\n   -->\n   \n-  <!--\n-       For information about these settings, read \n-       http://lenya.apache.org/1_2_x/components/deployment/proxying.html\n-\n-  <proxy area=\"live\" ssl=\"true\" url=\"https://www.host.com/ssl/default\"/>\n-  <proxy area=\"live\" ssl=\"false\" url=\"http://www.host.com/default\"/>\n-  <proxy area=\"authoring\" ssl=\"true\" url=\"https://www.host.com/lenya/default/authoring\"/>\n-  <proxy area=\"authoring\" ssl=\"false\" url=\"http://www.host.com/lenya/default/authoring\"/>\n+  <!-- Lenya can rewrite the links to cater to special proxy setups.\n+       For information about these settings, read http://lenya.apache.org/1_2_x/components/deployment/proxying.html\n+       (yes, this needs some updating... sorry.)\n+  <proxies>\n+    <proxy area=\"live\" ssl=\"true\" url=\"https://www.host.com/ssl/default\"/>\n+    <proxy area=\"live\" ssl=\"false\" url=\"http://www.host.com/default\"/>\n+    <proxy area=\"authoring\" ssl=\"true\" url=\"https://www.host.com/lenya/default/authoring\"/>\n+    <proxy area=\"authoring\" ssl=\"false\" url=\"http://www.host.com/lenya/default/authoring\"/>\n+  </proxies>\n   -->\n-  \n </publication>",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/default/config/publication.xconf",
                "sha": "ebee85052fe4795e0505c4b0d822d68f62e9628c",
                "status": "modified"
            },
            {
                "additions": 40,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/default/java/src/org/apache/lenya/defaultpub/cms/publication/templating/Instantiator.java",
                "changes": 65,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/pubs/default/java/src/org/apache/lenya/defaultpub/cms/publication/templating/Instantiator.java?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 25,
                "filename": "src/pubs/default/java/src/org/apache/lenya/defaultpub/cms/publication/templating/Instantiator.java",
                "patch": "@@ -28,7 +28,7 @@\n import javax.xml.transform.TransformerConfigurationException;\n import javax.xml.transform.TransformerException;\n \n-import org.apache.avalon.framework.configuration.Configuration;\n+import org.apache.avalon.framework.configuration.MutableConfiguration;\n import org.apache.avalon.framework.configuration.ConfigurationException;\n import org.apache.avalon.framework.configuration.DefaultConfiguration;\n import org.apache.avalon.framework.configuration.DefaultConfigurationBuilder;\n@@ -44,6 +44,7 @@\n import org.apache.excalibur.source.SourceResolver;\n import org.apache.excalibur.source.impl.FileSource;\n import org.apache.lenya.cms.publication.Publication;\n+//import org.apache.lenya.cms.publication.PublicationConfiguration;\n import org.apache.lenya.xml.DocumentHelper;\n import org.apache.lenya.xml.NamespaceHelper;\n import org.w3c.dom.Document;\n@@ -58,15 +59,27 @@\n public class Instantiator extends AbstractLogEnabled implements\n         org.apache.lenya.cms.publication.templating.Instantiator, Serviceable {\n \n-    protected static final String[] sourcesToCopy = { \"publication.xml\",\n-            \"config/publication.xconf\", \"config/ac/ac.xconf\",\n-            \"config/ac/policies/\", \"config/ac/usecase-policies.xml\", \"config/workflow/workflow.xml\",\n+    protected static final String[] sourcesToCopy = { \n+            \"config/publication.xconf\",\n+            \"config/ac/ac.xconf\", \"config/ac/policies/\", \"config/ac/usecase-policies.xml\", \n+            \"config/workflow/workflow.xml\",\n             \"config/\" + org.apache.cocoon.components.search.components.impl.IndexManagerImpl.INDEX_CONF_FILE};\n \n-    /*\n-     * \"config/cocoon-xconf/index_manager_index.xconf\", \"config/cocoon-xconf/index_manager.xconf\",\n-     */\n-\n+    // the following stuff should actually come from PublicationConfiguration, but there's currently no way to get at it.\n+    // the correct solution suggested by andreas is not to meddle with config files here at all, but instead implement\n+    // appropriate setter functions in the Publication class. postponed to after 1.4.\n+    // thus, don't waste too much effort on this file, it's all an intermediate hack.\n+    private static final String CONFIGURATION_FILE = \"config/publication.xconf\";\n+    private static final String CONFIGURATION_NAMESPACE = \"http://apache.org/cocoon/lenya/publication/1.1\";\n+    private static final String ELEMENT_NAME = \"name\";\n+    private static final String ELEMENT_TEMPLATES = \"templates\";\n+    private static final String ELEMENT_TEMPLATE = \"template\";\n+    private static final String ATTRIBUTE_ID = \"id\";\n+    private static final String ELEMENT_RESOURCE_TYPES = \"resource-types\";//*\n+    private static final String ELEMENT_RESOURCE_TYPE = \"resource-type\";//*\n+    private static final String ELEMENT_MODULES = \"modules\";//*\n+    private static final String ELEMENT_MODULE = \"module\";//*\n+ \n     /**\n      * @see org.apache.lenya.cms.publication.templating.Instantiator#instantiate(org.apache.lenya.cms.publication.Publication,\n      *      java.lang.String, java.lang.String)\n@@ -117,12 +130,12 @@ protected void updateMetaData(SourceResolver resolver, String newPublicationId,\n         ModifiableSource metaSource = null;\n         try {\n             metaSource = (ModifiableSource) resolver.resolveURI(publicationsUri + \"/\"\n-                    + newPublicationId + \"/publication.xml\");\n+                    + newPublicationId + \"/\" + CONFIGURATION_FILE);\n             Document metaDoc = DocumentHelper.readDocument(metaSource.getInputStream());\n-            NamespaceHelper helper = new NamespaceHelper(\"http://apache.org/cocoon/lenya/publication/1.0\",\n-                    \"lenya\",\n+            NamespaceHelper helper = new NamespaceHelper(CONFIGURATION_NAMESPACE,\n+                    \"\",\n                     metaDoc);\n-            Element nameElement = helper.getFirstChild(metaDoc.getDocumentElement(), \"name\");\n+            Element nameElement = helper.getFirstChild(metaDoc.getDocumentElement(), ELEMENT_NAME);\n             DocumentHelper.setSimpleElementText(nameElement, name);\n \n             save(metaDoc, metaSource);\n@@ -142,12 +155,15 @@ protected void updateConfiguration(SourceResolver resolver, Publication template\n         try {\n \n             configSource = (ModifiableSource) resolver.resolveURI(publicationsUri + \"/\"\n-                    + newPublicationId + \"/config/publication.xconf\");\n-            DefaultConfiguration config = (DefaultConfiguration) new DefaultConfigurationBuilder().build(configSource.getInputStream());\n+                    + newPublicationId + \"/\" + CONFIGURATION_FILE);\n+\n+            final boolean ENABLE_XML_NAMESPACES = true;\n+            DefaultConfiguration config = \n+                    (DefaultConfiguration) new DefaultConfigurationBuilder(ENABLE_XML_NAMESPACES).build(configSource.getInputStream());\n             addTemplateConfiguration(template, config);\n             \n-            removeChildren(config, \"module\");\n-            removeChildren(config, \"resource-type\");\n+            removeChildren(config.getMutableChild(ELEMENT_MODULES), ELEMENT_MODULE);\n+            removeChildren(config.getMutableChild(ELEMENT_RESOURCE_TYPES), ELEMENT_RESOURCE_TYPE);\n             \n             OutputStream oStream = configSource.getOutputStream();\n             new DefaultConfigurationSerializer().serialize(oStream, config);\n@@ -171,25 +187,24 @@ protected void updateConfiguration(SourceResolver resolver, Publication template\n         }\n     }\n \n-    protected void addTemplateConfiguration(Publication template, DefaultConfiguration config) {\n-        DefaultConfiguration templatesConfig = (DefaultConfiguration) config.getChild(\"templates\",\n-                false);\n+    protected void addTemplateConfiguration(Publication template, DefaultConfiguration config) throws ConfigurationException {\n+        MutableConfiguration templatesConfig = config.getMutableChild(ELEMENT_TEMPLATES, false);\n         if (templatesConfig == null) {\n-            templatesConfig = new DefaultConfiguration(\"templates\");\n+            templatesConfig = new DefaultConfiguration(ELEMENT_TEMPLATES, null, CONFIGURATION_NAMESPACE, \"\");\n             config.addChild(templatesConfig);\n         } else {\n-            Configuration[] templateConfigs = templatesConfig.getChildren(\"template\");\n+            MutableConfiguration[] templateConfigs = templatesConfig.getMutableChildren(ELEMENT_TEMPLATE);\n             for (int i = 0; i < templateConfigs.length; i++) {\n                 templatesConfig.removeChild(templateConfigs[i]);\n             }\n         }\n-        DefaultConfiguration templateConfig = new DefaultConfiguration(\"template\");\n-        templateConfig.setAttribute(\"id\", template.getId());\n+        DefaultConfiguration templateConfig = new DefaultConfiguration(ELEMENT_TEMPLATE, null, CONFIGURATION_NAMESPACE, \"\");\n+        templateConfig.setAttribute(ATTRIBUTE_ID, template.getId());\n         templatesConfig.addChild(templateConfig);\n     }\n \n-    protected void removeChildren(DefaultConfiguration config, String name) {\n-        Configuration[] moduleConfigs = config.getChildren(name);\n+    protected void removeChildren(MutableConfiguration config, String name) throws ConfigurationException {\n+        MutableConfiguration[] moduleConfigs = config.getMutableChildren(name);\n         for (int i = 0; i < moduleConfigs.length; i++) {\n             config.removeChild(moduleConfigs[i]);\n         }",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/default/java/src/org/apache/lenya/defaultpub/cms/publication/templating/Instantiator.java",
                "sha": "6cc4fd323f36634eb16b7f76e451287060794936",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/default/publication.xml",
                "changes": 69,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/pubs/default/publication.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 69,
                "filename": "src/pubs/default/publication.xml",
                "patch": "@@ -1,69 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<!--\n-  Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n--->\n-\n-<!-- $Id$ -->\n-\n-<lenya:publication xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.0\" lenya:show=\"true\">\n-  <lenya:name>Default Publication</lenya:name>\n-  <lenya:pub-version>@lenya.version@</lenya:pub-version>\n-  <lenya:lenya-version>@lenya.version@</lenya:lenya-version>\n-  <lenya:lenya-revision>@lenya.revision@</lenya:lenya-revision>\n-  <lenya:cocoon-version>2.1.8 or 2.1.9-dev</lenya:cocoon-version>\n-  <lenya:modules>\n-    <lenya:module>lucene</lenya:module>\n-    <lenya:module>homepage</lenya:module>\n-    <lenya:module>xhtml</lenya:module>\n-    <lenya:module>links</lenya:module>\n-    <lenya:module href=\"https://svn.apache.org/repos/asf/lenya/trunk/src/modules/opendocument\">opendocument</lenya:module>\n-    <lenya:module>cforms</lenya:module>\n-    <lenya:module>sitetree</lenya:module>\n-    <lenya:module>...</lenya:module>\n-  </lenya:modules>\n-  <lenya:description>This publication is a best practice, getting started publication.</lenya:description>\n-  <lenya:credits>Special thanks to </lenya:credits>\n-  <lenya:help></lenya:help>\n-  <lenya:changelog>changes.xml</lenya:changelog>\n-  <lenya:license></lenya:license>\n-  <lenya:readme>\n-    <ol>\n-      <li><a href=\"live/index.html\">Reader`s View</a> (Live)</li>\n-      <li><a href=\"authoring/index.html\">Editor`s View</a> (Authoring)</li>\n-    </ol>\n-\n-    <h4>Use WebDAV</h4>\n-    <ul>\n-      <li>Cadaver: cadaver http://127.0.0.1:8888/default/webdav</li>\n-      <li>More Info: <a href=\"http://wiki.apache.org/lenya/HowToEditWithWebDAV\">http://wiki.apache.org/lenya/HowToEditWithWebDAV</a></li>\n-    </ul>\n-\n-    <!--\n-    <h4>Enable JCR</h4>\n-    <ul>\n-      <li>Build Lenya and start it</li>\n-      <li>Import content from filesystem into JCR Repository by executing: <a href=\"../index.html?lenya.usecase=jcr.import\">../index.html?lenya.usecase=jcr.import</a>\n-      </li>\n-      <li>Stop Lenya</li>\n-      <li>Switch the NodeFactory within <i>build/lenya/webapp/WEB-INF/classes/org/apache/lenya/lenya.roles</i> to <i>org.apache.lenya.cms.jcr.JCRNodeFactory</i>\n-      </li>\n-      <li>Optional: The JCR implementation can be configured within local.build.properties resp. build.properties</li>\n-      <li>Start Lenya</li>\n-    </ul>\n-    -->\n-\n-  </lenya:readme>\n-</lenya:publication>",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/default/publication.xml",
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "status": "modified"
            },
            {
                "additions": 51,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/default/readme.xml",
                "changes": 51,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/pubs/default/readme.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 0,
                "filename": "src/pubs/default/readme.xml",
                "patch": "@@ -0,0 +1,51 @@\n+<?xml version=\"1.0\"?>\n+<!--\n+  Licensed to the Apache Software Foundation (ASF) under one or more\n+  contributor license agreements.  See the NOTICE file distributed with\n+  this work for additional information regarding copyright ownership.\n+  The ASF licenses this file to You under the Apache License, Version 2.0\n+  (the \"License\"); you may not use this file except in compliance with\n+  the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+-->\n+\n+<!-- $Id: introduction.xml 473861 2006-11-12 03:51:14Z gregor $ -->\n+\n+<page:page \n+  xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\n+  xmlns=\"http://www.w3.org/1999/xhtml\"\n+>\n+  <page:head/>\n+  <page:body>\n+    <h1>README: Default publication</h1>\n+    <h2>Use WebDAV:</h2>\n+    <ul>\n+      <li>Cadaver: cadaver http://127.0.0.1:8888/default/webdav</li>\n+      <li>More Info: <a href=\"http://wiki.apache.org/lenya/HowToEditWithWebDAV\">http://wiki.apache.org/lenya/HowToEditWithWebDAV</a></li>\n+    </ul>\n+<!--\n+    <h2>Enable JCR</h2>\n+    <ul>\n+      <li>Build Lenya and start it</li>\n+      <li>\n+        Import content from filesystem into JCR Repository by executing:\n+        <a href=\"../index.html?lenya.usecase=jcr.import\">../index.html?lenya.usecase=jcr.import</a>\n+      </li>\n+      <li>Stop Lenya</li>\n+      <li>\n+        Switch the NodeFactory within <i>build/lenya/webapp/WEB-INF/classes/org/apache/lenya/lenya.roles</i>\n+        to <i>org.apache.lenya.cms.jcr.JCRNodeFactory</i>\n+      </li>\n+      <li>Optional: The JCR implementation can be configured within local.build.properties resp. build.properties</li>\n+      <li>Start Lenya</li>\n+    </ul>\n+-->\n+  </page:body>\n+</page:page>",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/default/readme.xml",
                "sha": "b89bf4aee9952898b6004a107e49ee9724c008ec",
                "status": "added"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/resources/dev/eclipse/project",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/resources/dev/eclipse/project?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 1,
                "filename": "src/resources/dev/eclipse/project",
                "patch": "@@ -1,6 +1,6 @@\n <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <projectDescription>\n-  <name>Lenya @VERSION@</name>\n+  <name>Lenya @VERSION@ pubconf</name>\n   <comment></comment>\n   <projects>\n     <project>@COCOON_PROJECT@</project>",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/resources/dev/eclipse/project",
                "sha": "8612750ed1a277aa1de841f6aa0570da7ec083df",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/targets/dist-build.xml",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/targets/dist-build.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 2,
                "filename": "src/targets/dist-build.xml",
                "patch": "@@ -117,9 +117,9 @@\n   \t\n   \t<!-- Replace version placeholder with build version -->\n   \t<replace dir=\"${dist.src.dir}\">\n-  \t  <include name=\"**/introduction.xml\"/>\n+          <include name=\"**/welcome.xml\"/>\n   \t  <include name=\"**/about.xml\"/>\n-\t  <include name=\"**/publication.xml\"/>\n+\t  <include name=\"**/config/publication.xconf\"/>\n   \t  <replacefilter token=\"@lenya.version@\" value=\"${version}\"/>\n   \t  <replacefilter token=\"@lenya.revision@\" value=\"${lenya.revision}\"/>\n   \t</replace>",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/targets/dist-build.xml",
                "sha": "13ca2f98cf2004a4d7570da9507470e932326a36",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/targets/test-build.xml",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/targets/test-build.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 1,
                "filename": "src/targets/test-build.xml",
                "patch": "@@ -73,7 +73,7 @@\n       </fileset>\n     </copy>\n     <replace encoding=\"utf-8\"\n-      file=\"${build.webapp}/lenya/pubs/${test.pub.id}/publication.xml\"\n+      file=\"${build.webapp}/lenya/pubs/${test.pub.id}/config/publication.xconf\"\n       token=\"Default Publication\" value=\"Test Publication\"/>\n   </target>\n   ",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/targets/test-build.xml",
                "sha": "af078b305bd0a993342a02efd7d022c222313a2b",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/targets/webapp-build.xml",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/targets/webapp-build.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 2,
                "filename": "src/targets/webapp-build.xml",
                "patch": "@@ -194,9 +194,9 @@\n   \t\n     <!-- Replace version placeholder with build version -->\n     <replace dir=\"${build.webapp}\">\n-      <include name=\"lenya/content/introduction.xml\"/>\n+      <include name=\"lenya/content/welcome.xml\"/>\n       <include name=\"lenya/content/about.xml\"/>\n-      <include name=\"**/publication.xml\"/>\n+      <include name=\"**/config/publication.xconf\"/>\n       <replacefilter token=\"@lenya.version@\" value=\"${version}\"/>\n       <replacefilter token=\"@lenya.revision@\" value=\"${lenya.revision}\"/>\n     </replace>",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/targets/webapp-build.xml",
                "sha": "a99cae27199975c8cf9a87ed2adb57c35c4db737",
                "status": "modified"
            },
            {
                "additions": 15,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/global-sitemap.xmap",
                "changes": 31,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/global-sitemap.xmap?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 16,
                "filename": "src/webapp/global-sitemap.xmap",
                "patch": "@@ -89,9 +89,9 @@\n <!-- =========================== Pipelines ================================= -->\n \n     <map:pipeline>\n-      <map:match pattern=\"publications.xml\">\n+      <map:match pattern=\"aggregate-publications\">\n         <map:generate type=\"directory\" src=\"lenya/pubs\"/>\n-        <map:transform src=\"lenya/xslt/util/xinclude.xsl\"/>\n+        <map:transform src=\"lenya/xslt/util/aggregate-publications.xsl\"/>\n         <map:transform type=\"xinclude\"/>\n         <map:serialize type=\"xml\"/>\n       </map:match>\n@@ -210,8 +210,9 @@\n         <map:serialize type=\"xml\"/>\n       </map:match>\n       \n+    </map:pipeline>\n       <!-- menus -->\n-      \n+    <map:pipeline type=\"profile-noncaching\">  \n       <!-- menu-xml/modules -->\n       <!-- menu-xml/modules/{pub-id}/{area}.xml -->\n       <map:match pattern=\"menu-xml/modules/*/*.xml\">\n@@ -222,8 +223,9 @@\n         <map:transform type=\"xinclude\"/>\n         <map:serialize type=\"xml\"/>\n       </map:match>\n+    </map:pipeline>\n \n-\n+    <map:pipeline>\n       <!-- menu-xml/module/{area}/{module-id}.xml -->\n       <map:match pattern=\"menu-xml/module/*/*.xml\">\n         <map:select type=\"resource-exists\">\n@@ -307,9 +309,10 @@\n \n     <map:pipeline>\n       <map:match pattern=\"index.html\">\n-        <map:aggregate element=\"lenya\" ns=\"http://apache.org/cocoon/lenya/publication/1.0\" prefix=\"lenya\" label=\"aggregate\">\n-          <map:part src=\"cocoon:/publications.xml\"/>\n-          <map:part src=\"lenya/content/introduction.xml\"/>\n+        <map:aggregate element=\"aggregation-wrapper\" label=\"aggregate\">\n+          <map:part src=\"cocoon:/aggregate-publications\"/>\n+          <map:part src=\"lenya/content/welcome.xml\"/>\n+          <map:part src=\"readme.xml\"/>\n         </map:aggregate>\n         <map:transform src=\"lenya/xslt/util/welcome.xsl\"/>\n         <map:call resource=\"style-cms-page\"/>\n@@ -367,15 +370,11 @@\n \n       <!-- About Publication -->\n       <map:match pattern=\"*/introduction.html\">\n-        <map:generate src=\"lenya/pubs/{1}/publication.xml\" />\n-        <map:transform src=\"lenya/xslt/util/publication.xsl\"/>\n-        <map:call resource=\"style-cms-page\"/>\n-        <map:serialize />\n-      </map:match>\n-      <!-- Publication Tests-->\n-      <map:match pattern=\"*/tests.html\">\n-        <map:generate src=\"lenya/pubs/{1}/publication-tests.xml\" />\n-        <map:transform src=\"lenya/xslt/util/publication.xsl\"/>\n+        <map:aggregate element=\"aggregation-wrapper\">\n+          <map:part src=\"aggregate-fallback://readme.xml\"/>\n+          <map:part src=\"lenya/pubs/{1}/config/publication.xconf\"/>\n+        </map:aggregate>\n+        <map:transform src=\"lenya/xslt/util/introduction.xsl\"/>\n         <map:call resource=\"style-cms-page\"/>\n         <map:serialize />\n       </map:match>",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/global-sitemap.xmap",
                "sha": "a0965c60da79240358427e2bcbd6fe89fa5a380c",
                "status": "modified"
            },
            {
                "additions": 24,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/content/about.xml",
                "changes": 46,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/content/about.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 22,
                "filename": "src/webapp/lenya/content/about.xml",
                "patch": "@@ -18,25 +18,27 @@\n \n <!-- $Id$ -->\n \n-<page:page  \n-   xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\">\n-\n-<page:title>Apache Lenya @lenya.version@ (Revision: @lenya.revision@)</page:title>\n-<page:body>\n-<div class=\"lenya-box\">\n-<p>\n-This software consists of voluntary contributions made by many individuals\n-on behalf of the <br /><a href=\"http://www.apache.org/\">Apache Software Foundation</a> \n-and was originally created by <a href=\"mailto:michi@apache.org\">Michael Wechner</a>.\n-<br /><br />\n-Apache Lenya includes software developed by the <a href=\"http://www.apache.org/\">Apache Software Foundation</a>, \n-<a href=\"http://w3c.org\">W3C</a>, <br /> and <a href=\"http://sf.net/projects/websphinx\">WebSPHINX</a>.\n-<br /><br /> \n-Copyright (C) 2006 The Apache Software Foundation. All rights reserved.\n-</p>\n-<form id=\"form-about-back\">\n-<input type=\"button\" value=\"Back\" onClick=\"history.go(-1)\" name=\"input-back\"/>\n-</form>\t\t\n-</div>\n-      </page:body>\n-    </page:page>\n+<page:page xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\">\n+  <page:title>Apache Lenya @lenya.version@ (Revision: @lenya.revision@)</page:title>\n+  <page:body>\n+    <div class=\"lenya-box\">\n+      <p>\n+        This software consists of voluntary contributions made by many individuals\n+        on behalf of the <br /><a href=\"http://www.apache.org/\">Apache Software Foundation</a> \n+        and was originally created by <a href=\"mailto:michi@apache.org\">Michael Wechner</a>.\n+      </p>\n+      <p>\n+        Apache Lenya includes software developed by the \n+        <a href=\"http://www.apache.org/\">Apache Software Foundation</a>, \n+        <a href=\"http://w3c.org\">W3C</a>, and \n+        <a href=\"http://sf.net/projects/websphinx\">WebSPHINX</a>.\n+      </p>\n+      <p>\n+        Copyright (C) 2006 The Apache Software Foundation. All rights reserved.\n+      </p>\n+      <form id=\"form-about-back\">\n+        <input type=\"button\" value=\"Back\" onClick=\"history.go(-1)\" name=\"input-back\"/>\n+      </form>\t\t\n+    </div>\n+  </page:body>\n+</page:page>",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/content/about.xml",
                "sha": "d9f8ef177b4c266a14b57b011bb2137c6622ee47",
                "status": "modified"
            },
            {
                "additions": 57,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/content/introduction.xml",
                "changes": 80,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/content/introduction.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 23,
                "filename": "src/webapp/lenya/content/introduction.xml",
                "patch": "@@ -18,26 +18,60 @@\n \n <!-- $Id$ -->\n \n-<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lenya-frontpage\">\n-<h2>Welcome to Apache Lenya</h2>\n-<p>\n-You have successfully installed Apache Lenya <strong>@lenya.version@</strong> (Revision: @lenya.revision@). To start, click on any of the publications on the left.</p>\n-\n-<h3>About Apache Lenya</h3>\n-<p>\n-<a href=\"http://lenya.apache.org\">Apache Lenya</a> is a Java-based <a href=\"http://www.opensource.org\">Open-Source</a>\n-Content Management System. It\n-is based on open standards such as <a href=\"http://www.w3c.org/XML/\">XML</a> and <a href=\"http://www.w3c.org/TR/xslt\">XSLT</a>. One of its core\n-components is <a href=\"http://cocoon.apache.org\">Cocoon</a> from the\n-<a href=\"http://www.apache.org\">Apache Software Foundation</a>.\n-</p>\n-\t\t\n-<p>\n-Lenya supports inline WYSIWYG editors such as <a href=\"http://kupu.oscom.org\">Kupu</a> or <a href=\"http://bxe.oscom.org\">BXE</a>. Your site editors do\n-not have to learn XML. This is possible thanks to the support\n-of XML, XSLT and XML Schema on the client side.\n-An administration interface allows advanced users to\n-monitor the CMS, and perform configuration tasks.\n-</p>\n-\t\t\n-</div>\n+<page:page xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\">\n+  <page:title>Apache Lenya @lenya.version@ (Revision:@lenya.revision@)</page:title>\n+  <page:body>\n+  \n+    <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lenya-frontpage\">\n+    \n+      <h2>Welcome to Apache Lenya</h2>\n+      <p>\n+        You have successfully installed Apache Lenya \n+        <strong>@lenya.version@</strong> (Revision: @lenya.revision@).\n+        To start, click on any of the publications on the left, or create\n+        a new publication.\n+      </p>\n+    \n+      <h3>About</h3>\n+      <p>\n+        <a href=\"http://lenya.apache.org\">Apache Lenya</a> is a Java-based\n+        <a href=\"http://www.opensource.org\">open-source</a> Content Management \n+        System. It is based on open standards such as \n+        <a href=\"http://www.w3c.org/XML/\">XML</a> and \n+        <a href=\"http://www.w3c.org/TR/xslt\">XSLT</a>. It is based on\n+        <a href=\"http://cocoon.apache.org\">Apache Cocoon</a>.\n+      </p>\n+      <p>\n+        Lenya is a community project and is being developed under the aegis of the \n+        <a href=\"http://www.apache.org/\">Apache Software Foundation (ASF)</a>. The\n+        project was donated to the ASF by Michael Wechner of <a\n+        href=\"http://wyona.com\">Wyona AG</a> and accepted as a top-level ASF\n+        project in 2004. You are welcome to join our mailing lists and contribute!\n+      </p>\n+      \n+      <h3>Features</h3>\n+      <ul>\n+        <li>supports multi-lingual websites</li>\n+        <li>\n+          includes several client-side content editors, many of them\n+          WYSIWYG\n+        </li>\n+        <li>allows for complex workflows (edit/submit/review/publish)</li>\n+        <li>\n+          allows for arbitrary output, does not impose standard layouts or \n+          techniques (such as HTML tables) on the user\n+        </li>\n+        <li>\n+          provides revision control, old page versions can be viewed and restored\n+          if necessary\n+        </li>\n+        <li>\n+          powerful XML processing capabilities thanks to the underlying Cocoon\n+          engine\n+        </li>\n+        <li>...</li>\n+      </ul>\n+    </div>\n+  \n+  </page:body>\n+</page:page>",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/content/introduction.xml",
                "sha": "cf333b51f0192b3b8134b0ba79cf439fc4565489",
                "status": "modified"
            },
            {
                "additions": 77,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/content/welcome.xml",
                "changes": 77,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/content/welcome.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 0,
                "filename": "src/webapp/lenya/content/welcome.xml",
                "patch": "@@ -0,0 +1,77 @@\n+<?xml version=\"1.0\"?>\n+<!--\n+  Licensed to the Apache Software Foundation (ASF) under one or more\n+  contributor license agreements.  See the NOTICE file distributed with\n+  this work for additional information regarding copyright ownership.\n+  The ASF licenses this file to You under the Apache License, Version 2.0\n+  (the \"License\"); you may not use this file except in compliance with\n+  the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+-->\n+\n+<!-- $Id: introduction.xml 473861 2006-11-12 03:51:14Z gregor $ -->\n+\n+<page:page \n+  xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\n+  xmlns=\"http://www.w3.org/1999/xhtml\"\n+>\n+  <page:title>Apache Lenya @lenya.version@ (Revision:@lenya.revision@)</page:title>\n+  <page:body>\n+  \n+    <h1>Welcome to Apache Lenya</h1>\n+    <p>\n+      You have successfully installed Apache Lenya \n+      <strong>@lenya.version@</strong> (Revision: @lenya.revision@).\n+      To start, click on any of the publications on the left, or create\n+      a new publication.\n+    </p>\n+  \n+    <h2>About</h2>\n+    <p>\n+      <a href=\"http://lenya.apache.org\">Apache Lenya</a> is a Java-based\n+      <a href=\"http://www.opensource.org\">open-source</a> Content Management \n+      System. It is based on open standards such as \n+      <a href=\"http://www.w3c.org/XML/\">XML</a> and \n+      <a href=\"http://www.w3c.org/TR/xslt\">XSLT</a>. It is based on\n+      <a href=\"http://cocoon.apache.org\">Apache Cocoon</a>.\n+    </p>\n+    <p>\n+      Lenya is a community project and is being developed under the aegis of the \n+      <a href=\"http://www.apache.org/\">Apache Software Foundation (ASF)</a>. The\n+      project was donated to the ASF by Michael Wechner of <a\n+      href=\"http://wyona.com\">Wyona AG</a> and accepted as a top-level ASF\n+      project in 2004. You are welcome to join our mailing lists and contribute!\n+    </p>\n+    \n+    <h2>Features</h2>\n+    <ul>\n+      <li>supports multi-lingual websites</li>\n+      <li>\n+        includes several client-side content editors, many of them\n+        WYSIWYG\n+      </li>\n+      <li>allows for complex workflows (edit/submit/review/publish)</li>\n+      <li>\n+        allows for arbitrary output, does not impose standard layouts or \n+        techniques (such as HTML tables) on the user\n+      </li>\n+      <li>\n+        provides revision control, old page versions can be viewed and restored\n+        if necessary\n+      </li>\n+      <li>\n+        powerful XML processing capabilities thanks to the underlying Cocoon\n+        engine\n+      </li>\n+      <li>...</li>\n+    </ul>\n+  \n+  </page:body>\n+</page:page>",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/content/welcome.xml",
                "sha": "8c5c8d0f065d745c8940e5639eb835e0e27a97de",
                "status": "added"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/css/default.css",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/resources/css/default.css?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 2,
                "filename": "src/webapp/lenya/resources/css/default.css",
                "patch": "@@ -20,20 +20,25 @@\n @import url(menu.css);\n @import url(tabs.css);\n @import url(boxes.css);\n-\n+  \n body {\n     margin: 0px;\n     padding: 0px;\n     font-family: Verdana, sans-serif;\n }\n \n h1 {\n-    font-family: Verdana, sans-serif;\n     font-size: 150%;\n     padding: 0px;\n     margin: 0px;\n }\n \n+h2 { font-size: 120%; }\n+h3 { font-size: 110%; }\n+h4 { font-size: 100%; }\n+h5 { font-size: 90%; }\n+h6 { font-size: 80%; }\n+\n p {\n     font-size: small;\n }",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/css/default.css",
                "sha": "4465d70f857753b8fa482ca67baf81cea8c01433",
                "status": "modified"
            },
            {
                "additions": 14,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/css/tables.css",
                "changes": 17,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/resources/css/tables.css?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 3,
                "filename": "src/webapp/lenya/resources/css/tables.css",
                "patch": "@@ -28,29 +28,35 @@ table.lenya-table-noborder {\n }\n \n table.lenya-table th {\n-    background-color: #DDDCCF;\n+  background-color: #DDDCCF;\n \tborder: solid 1px #CCCCCC;\n \tcolor: Black;\n \tfont-weight: bold;\n \tpadding: 3px 10px;\n \ttext-align: left;\n+\tvertical-align: top;\n \tfont-size: small;\n }\n \n table.lenya-table td {\n-    background-color: #F5F4E9;\n+  background-color: #F5F4E9;\n \tborder: solid 1px #CCCCCC;\n \tpadding: 3px 10px;\n \tfont-size: small;\n \tcolor: Black;\n }\n \n-table.lenya-table-noborder td {\n+table.lenya-table-noborder td, table.lenya-table-noborder th {\n \tborder: 0px;\n \tpadding: 3px 10px;\n \tfont-size: small;\n }\n \n+table.lenya-table-noborder th {\n+  vertical-align: top;\n+  text-align: left;\n+}\n+\n table.lenya-table-noborder-nopadding td {\n \tborder: 0px;\n \tpadding: 0px;\n@@ -72,6 +78,7 @@ table.lenya-table-list td,\n table.lenya-table-list-noborder th,\n table.lenya-table-list-noborder td {\n   text-align: left;\n+  vertical-align: top;\n   padding: 2px 2em 2px 5px;\n   border-bottom: solid 1px #CCCCCC;\n \tfont-size: small;\n@@ -106,6 +113,10 @@ table.lenya-table-list-noborder td {\n   border-bottom: none;\n }\n \n+table.lenya-table-list-noborder td.border {\n+  border-bottom: solid 1px #CCCCCC;\n+}\n+\n table.lenya-table-list-noborder th,\n table.lenya-table-list-noborder td {\n   padding-left: 0px;",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/css/tables.css",
                "sha": "3234e6afc277eb345f2ab205a23de9d76f65a9d1",
                "status": "modified"
            },
            {
                "additions": 14,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/i18n/cmsui_de.xml",
                "changes": 16,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/resources/i18n/cmsui_de.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 2,
                "filename": "src/webapp/lenya/resources/i18n/cmsui_de.xml",
                "patch": "@@ -379,8 +379,19 @@\n   <message key=\"lenya.rc.checkedoutalready\">Die Ressource wurde bereits von jemand anders ausgecheckt.</message>\n   <message key=\"lenya.rc.nocheckin\">Resource konnte nicht eingecheckt werden</message>\n   <message key=\"Generic Exception\">Allgemeiner Fehler</message>\n-  <message key=\"Check the log files.\">\u00dc\tberpr\u00fcfen Sie die Logdatei.</message>\n-\n+  <message key=\"Check the log files.\">\u00dcberpr\u00fcfen Sie die Logdatei.</message>\n+  \n+  <!-- Publication introduction page -->\n+  <message key=\"Publication properties\">Eigenschaften der Publikation</message>\n+  <message key=\"Available languages\">Verf\u00fcgbare Sprachen</message>\n+  <message key=\"Available resource types\">Verf\u00fcgbare Ressource-Typen</message>\n+  <message key=\"Required Lenya version\">Ben\u00f6tigte Lenya-Version</message>\n+  <message key=\"Required Lenya revision\">Ben\u00f6tigte Lenya-Revision</message>\n+  <message key=\"Required Cocoon version\">Ben\u00f6tigte Cocoon-Version</message>\n+  <message key=\"Modules used\">Verwendete Module</message>\n+  <message key=\"Templates used\">Verwendete Templates</message>\n+  <message key=\"Inherited: see template publication\">Vererbt: Siehe Template-Publikation</message>\n+  \n   <!-- Error messages of a general nature -->\n   <message key=\"error-document-form\">Dokument ist nicht wohlgeformt: {0}</message>\n   <message key=\"error-validation\">Schema Validierung schlug fehl: {0}</message>\n@@ -389,5 +400,6 @@\n   <message key=\"error-document-existance\">Das angeforderte Dokument {0} existiert nicht.</message>\n   <message key=\"error-generic\">Ein Fehler ist aufgetreten.</message>\n   <message key=\"error-404\">404: Seite nicht gefunden</message>\n+  \n </catalogue>\n ",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/i18n/cmsui_de.xml",
                "sha": "0ac73bdc423416876f2791fb1d6125c9195c9a48",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/i18n/modules2xinclude.xsl",
                "changes": 16,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/resources/i18n/modules2xinclude.xsl?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 9,
                "filename": "src/webapp/lenya/resources/i18n/modules2xinclude.xsl",
                "patch": "@@ -21,27 +21,25 @@\n <xsl:stylesheet version=\"1.0\"\r\n   xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n   xmlns:xi=\"http://www.w3.org/2001/XInclude\"\r\n-  xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.0\"\r\n+  xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.1\"\r\n   >\r\n-  \r\n+\r\n   <xsl:param name=\"pubId\"/>\r\n   <xsl:param name=\"catalogue\"/>\r\n \r\n \r\n   <xsl:template match=\"catalogue\">\r\n     <xsl:copy>\r\n       <xsl:copy-of select=\"@*|node()\"/>\r\n-      <xsl:apply-templates select=\"document('aggregate-fallback://config/publication.xconf')/publication/module\"/>\r\n+      <xsl:apply-templates select=\"document('aggregate-fallback://config/publication.xconf')/*/lenya:modules/lenya:module\"/>\r\n     </xsl:copy>\r\n-  </xsl:template>  \r\n-  \r\n-  \r\n-  <xsl:template match=\"module\">\r\n+  </xsl:template>\r\n+\r\n+  <xsl:template match=\"lenya:module\">\r\n     <xsl:if test=\"not(preceding-sibling::module[@name = current()/@name])\">\r\n       <xi:include href=\"cocoon:/i18n-catalogue/module/{@name}/{$catalogue}\"\r\n         xpointer=\"xpointer(/catalogue/message)\"/>\r\n     </xsl:if>\r\n   </xsl:template>\r\n-  \r\n-  \r\n+\r\n </xsl:stylesheet>\r",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/i18n/modules2xinclude.xsl",
                "sha": "a5846365c27558edd25a3fa14a0ce33d76ac10e4",
                "status": "modified"
            },
            {
                "additions": 204,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/schemas/publication.rng",
                "changes": 204,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/resources/schemas/publication.rng?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 0,
                "filename": "src/webapp/lenya/resources/schemas/publication.rng",
                "patch": "@@ -0,0 +1,204 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<!--\n+  Licensed to the Apache Software Foundation (ASF) under one or more\n+  contributor license agreements.  See the NOTICE file distributed with\n+  this work for additional information regarding copyright ownership.\n+  The ASF licenses this file to You under the Apache License, Version 2.0\n+  (the \"License\"); you may not use this file except in compliance with\n+  the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+-->\n+\n+<!-- \n+  This RELAX NG grammar defines the configuration file of a. Lenya publication.\n+  Configuration files must be located under \"$YOURPUBROOT/$PUBNAME/config/publication.xconf\".\n+  \n+  This schema is new as of 2007-02-23. It is NOT backwards-compatible. It combines the\n+  contents of $YOURPUBROOT/$PUBNAME/publication.xml and $YOURPUBROOT/$PUBNAME/config/publication.xconf.\n+  \n+  The publication.xconf file is parsed by:\n+  \n+  * src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java\n+  * src/java/org/apache/lenya/cms/publication/templating/ExistingUsecaseResolver.java\n+  * src/modules/repository/java/src/org/apache/lenya/cms/migration/Migrate14.java (?)\n+  * src/webapp/lenya/xslt/util/aggregate-publications.xsl\n+  * webapp/lenya/resources/i18n/modules2xinclude.xsl\n+  * webapp/global-sitemap.xmap\n+  \n+  Please keep the implementations and this grammar in sync!\n+-->\n+\n+<grammar \n+  xmlns=\"http://relaxng.org/ns/structure/1.0\"\n+  datatypeLibrary=\"http://www.w3.org/2001/XMLSchema-datatypes\"\n+>\n+\n+  <!-- some convenience data types used in this grammar: -->\n+  \n+  <define name=\"booleanString\">\n+    <choice>\n+      <value>true</value>\n+      <value>false</value>\n+    </choice>\n+  </define>\n+  \n+  <define name=\"fileURL\">\n+    <!-- regex anyone? -->\n+    <data type=\"string\"/>\n+  </define>\n+  \n+  <define name=\"isoLanguage\">\n+    <data type=\"string\">\n+      <param name=\"pattern\">[a-zA-Z]{2}</param>\n+    </data>\n+  </define>\n+  \n+  <define name=\"lenyaAreaName\">\n+    <choice>\n+      <value>live</value>\n+      <value>authoring</value>\n+    </choice>\n+  </define>\n+  \n+  <define name=\"javaClassName\">\n+    <data type=\"string\">\n+      <!-- too lenient, needs tightening -->\n+      <param name=\"pattern\">([\\-_a-zA-Z0-9]+\\.)+[\\-_a-zA-Z0-9]+</param>\n+    </data>\n+  </define>\n+  \n+  <define name=\"moduleName\">\n+    <ref name=\"simpleNameToken\"/>\n+  </define>\n+\n+  <define name=\"resourceTypeName\">\n+    <ref name=\"simpleNameToken\"/>\n+  </define>\n+  \n+  <define name=\"revisionString\">\n+    <data type=\"string\">\n+    </data>\n+  </define>\n+  \n+  <define name=\"simpleNameToken\">\n+    <data type=\"string\">\n+      <param name=\"pattern\">[a-z]+</param>\n+    </data>\n+  </define>\n+  \n+  <define name=\"versionString\">\n+    <data type=\"string\">\n+      <param name=\"pattern\">(@lenya.version@)|(([0-9]+\\.)+[0-9]+(-[\\-_a-zA-Z0-9]+)?)</param>\n+    </data>\n+  </define>\n+  \n+  <define name=\"workflowUri\">\n+    <data type=\"anyURI\"/>\n+  </define>\n+  \n+  <define name=\"XPathExpression\">\n+    <!-- regex anyone? -->\n+    <data type=\"string\"/>\n+  </define>\n+  \n+<!-- here comes the important part -->\n+\n+<start>\n+\n+<element name=\"publication\"\n+  ns=\"http://apache.org/cocoon/lenya/publication/1.1\"\n+>\n+  <optional> \n+    <attribute name=\"show\"><ref name=\"booleanString\"/></attribute>\n+  </optional>\n+  <interleave>\n+    <element name=\"name\"><data type=\"string\"/></element>\n+    <optional>\n+      <element name=\"description\"><data type=\"string\"/></element>\n+    </optional>\n+    <optional>\n+      <element name=\"version\"><ref name=\"versionString\"/></element>\n+    </optional>\n+    <optional>\n+      <element name=\"lenya-version\"><ref name=\"versionString\"/></element>\n+    </optional>\n+    <optional>\n+      <element name=\"lenya-revision\"><ref name=\"revisionString\"/></element>\n+    </optional>\n+    <optional>\n+      <element name=\"cocoon-version\"><ref name=\"versionString\"/></element>\n+    </optional>\n+    <element name=\"languages\">\n+      <oneOrMore>\n+        <element name=\"language\">\n+          <optional>\n+            <attribute name=\"default\">\n+              <ref name=\"booleanString\"/>\n+            </attribute>\n+          </optional>\n+          <ref name=\"isoLanguage\"/>\n+        </element>\n+      </oneOrMore>\n+    </element>\n+    <optional>\n+      <element name=\"template\">\n+        <attribute name=\"id\">\n+          <ref name=\"simpleNameToken\"/>\n+        </attribute>\n+      </element>\n+    </optional>\n+    <!-- FIXME: is template-instantiator optional?-->\n+    <element name=\"template-instantiator\"><attribute name=\"name\"><data type=\"string\"/></attribute></element>\n+    <element name=\"path-mapper\">\n+      <ref name=\"javaClassName\"/>\n+    </element>\n+    <element name=\"document-builder\"><attribute name=\"name\"><data type=\"string\"/></attribute></element>\n+    <element name=\"site-manager\"><attribute name=\"name\"><data type=\"string\"/></attribute></element>\n+    <element name=\"resource-types\">\n+       <oneOrMore>\n+        <element name=\"resource-type\">\n+          <attribute name=\"name\"><ref name=\"resourceTypeName\"/></attribute>\n+          <attribute name=\"workflow\"><ref name=\"workflowUri\"/></attribute>\n+        </element>\n+      </oneOrMore>\n+    </element>\n+    <element name=\"modules\">\n+       <oneOrMore>\n+        <element name=\"module\">\n+          <attribute name=\"name\"><ref name=\"moduleName\"/></attribute>\n+        </element>\n+      </oneOrMore>\n+    </element>\n+    <element name=\"breadcrumb-prefix\"><data type=\"string\"/></element>\n+    <optional>\n+      <element name=\"content-dir\">\n+        <attribute name=\"src\">\n+          <ref name=\"fileURL\"/>\n+        </attribute>\n+      </element>\n+    </optional>\n+    <optional>\n+      <element name=\"proxies\">\n+        <oneOrMore>\n+          <element name=\"proxy\">\n+            <attribute name=\"area\"><ref name=\"lenyaAreaName\"/></attribute>\n+            <attribute name=\"ssl\"><ref name=\"booleanString\"/></attribute>\n+            <attribute name=\"url\"><data type=\"anyURI\"/></attribute>\n+          </element>\n+        </oneOrMore>\n+      </element>\n+    </optional>\n+  </interleave>\n+  \n+</element>\n+\n+</start>\n+\n+</grammar>",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/schemas/publication.rng",
                "sha": "e24bad0b95d55c07c24f5d5497b225a7a4104ba8",
                "status": "added"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/xslt/modules/modules2xinclude.xsl",
                "changes": 19,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/xslt/modules/modules2xinclude.xsl?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 10,
                "filename": "src/webapp/lenya/xslt/modules/modules2xinclude.xsl",
                "patch": "@@ -19,25 +19,24 @@\n <!-- $Id: xinclude.xsl 123414 2004-12-27 14:52:24Z gregor $ -->\r\n \r\n <xsl:stylesheet version=\"1.0\"\r\n-    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n-    xmlns:xi=\"http://www.w3.org/2001/XInclude\"\r\n-    xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.0\"\r\n-    xmlns:dir=\"http://apache.org/cocoon/directory/2.0\"\r\n+    xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.1\"\n     xmlns:menu=\"http://apache.org/cocoon/lenya/menubar/1.0\"\r\n-    >\r\n+    xmlns:xi=\"http://www.w3.org/2001/XInclude\"\r\n+    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n+>\r\n \r\n   <xsl:param name=\"area\"/>\r\n \r\n-  <xsl:template match=\"publication\">\n+  <xsl:template match=\"lenya:publication\">\n     <menu:menu>\n-      <xsl:apply-templates select=\"module\"/>\n+      <xsl:apply-templates select=\"lenya:modules/lenya:module\"/>\n     </menu:menu>\n   </xsl:template>\r\n \r\n-  <xsl:template match=\"module\">\n-    <xsl:if test=\"not(preceding-sibling::module[@name = current()/@name])\">\n+  <xsl:template match=\"lenya:module\">\n+    <xsl:if test=\"not(preceding-sibling::lenya:module[@name = current()/@name])\">\n       <xi:include href=\"cocoon:/menu-xml/module/{$area}/{@name}.xml\" xpointer=\"xpointer(/*/*)\"/>\r\n-    </xsl:if>\n+    </xsl:if>\r\n   </xsl:template>\r\n \r\n </xsl:stylesheet>\r",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/xslt/modules/modules2xinclude.xsl",
                "sha": "450403605b734759f9d8515d44369e9f577e3567",
                "status": "modified"
            },
            {
                "additions": 14,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/xslt/util/aggregate-publications.xsl",
                "changes": 24,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/xslt/util/aggregate-publications.xsl?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 10,
                "filename": "src/webapp/lenya/xslt/util/aggregate-publications.xsl",
                "patch": "@@ -16,30 +16,34 @@\n   limitations under the License.\n -->\n \n-<!-- $Id$ -->\n+<!-- $Id: xinclude.xsl 473861 2006-11-12 03:51:14Z gregor $ -->\n \n <xsl:stylesheet version=\"1.0\"\n     xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\n     xmlns:xi=\"http://www.w3.org/2001/XInclude\"\n-    xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.0\"\n+    xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.1\"\n     xmlns:dir=\"http://apache.org/cocoon/directory/2.0\"\n     >\n \n <xsl:template match=\"/\">\n   <xsl:apply-templates select=\"dir:directory\"/>\n </xsl:template>                                                                                                                             \n-<xsl:template match=\"dir:directory\" >\n-<lenya:publications>\n-  <xsl:for-each select=\"dir:directory\">\n-    <lenya:publication pid=\"{@name}\">\n-        <xi:include href=\"lenya/pubs/{@name}/publication.xml\">\n+\n+<xsl:template match=\"dir:directory\">\n+  <lenya:publications>\n+    <xsl:for-each select=\"dir:directory\">\n+      <lenya:publication dirname=\"{@name}\">\n+        <xi:include \n+          href=\"lenya/pubs/{@name}/config/publication.xconf\"\n+          xpointer=\"xpointer(/*/*)\"\n+        >\n           <xi:fallback>\n             <lenya:name name=\"{@name}\"/>\n           </xi:fallback>\n         </xi:include>\n-    </lenya:publication>\n-  </xsl:for-each>\n-</lenya:publications>\n+      </lenya:publication>\n+    </xsl:for-each>\n+  </lenya:publications>\n </xsl:template>\n \n </xsl:stylesheet>",
                "previous_filename": "src/webapp/lenya/xslt/util/xinclude.xsl",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/xslt/util/aggregate-publications.xsl",
                "sha": "ddded3c1d2cfae6dc5f79f9408c3d5c65a3c3656",
                "status": "renamed"
            },
            {
                "additions": 191,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/xslt/util/introduction.xsl",
                "changes": 191,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/xslt/util/introduction.xsl?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 0,
                "filename": "src/webapp/lenya/xslt/util/introduction.xsl",
                "patch": "@@ -0,0 +1,191 @@\n+<?xml version=\"1.0\"?>\n+<!--\n+  Licensed to the Apache Software Foundation (ASF) under one or more\n+  contributor license agreements.  See the NOTICE file distributed with\n+  this work for additional information regarding copyright ownership.\n+  The ASF licenses this file to You under the Apache License, Version 2.0\n+  (the \"License\"); you may not use this file except in compliance with\n+  the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+-->\n+\n+<!-- $Id: publication.xsl 473861 2006-11-12 03:51:14Z gregor $ -->\n+\n+<xsl:stylesheet\n+    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" version=\"1.0\"\n+    xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.1\"\n+    xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\n+    xmlns:xhtml=\"http://www.w3.org/1999/xhtml\"\n+    xmlns:i18n=\"http://apache.org/cocoon/i18n/2.1\"\n+    xmlns=\"http://www.w3.org/1999/xhtml\"\n+>\n+\n+\n+<xsl:key name=\"workflows\" match=\"lenya:resource-type\" use=\"@workflow\"/>   \n+\n+<xsl:template match=\"/*\">\n+<page:page>\n+  <page:title>Apache Lenya - <xsl:value-of select=\"lenya:publication/lenya:name\"/></page:title>\n+  <page:head/>\n+  <page:body>\n+    <div class=\"lenya-sidebar\">\n+      <div class=\"lenya-sidebar-heading\">This&#160;Publication</div>\n+      <ul>\n+        <li><a href=\"authoring/\">Login&#160;as&#160;Editor</a></li>\n+        <li><a href=\"live/\">Live&#160;View</a></li>\n+      </ul>\n+      <div class=\"lenya-publication-item\"><a href=\"../index.html\">Other&#160;Publications</a></div>\n+      <div class=\"lenya-publication-item\"><a href=\"http://lenya.apache.org/docs/index.html\">Documentation</a></div>\n+      <div class=\"lenya-publication-item\"><a href=\"http://wiki.apache.org/lenya\">Wiki</a></div>\n+    </div>\n+\n+    <div class=\"lenya-frontpage\">\n+      <h2><i18n:text>Publication properties</i18n:text>:</h2>\n+      <xsl:apply-templates select=\"lenya:publication\"/>\n+      <xsl:apply-templates select=\"page:page\"/>\n+      \n+    </div>\n+  </page:body>\n+</page:page>\n+</xsl:template>\n+\n+<xsl:template match=\"lenya:publication\">\n+  <table class=\"lenya-table-list-noborder\">\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Name</i18n:text></th>\n+      <td class=\"border\"><xsl:value-of select=\"lenya:name\"/></td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Revision</i18n:text></th>\n+      <td class=\"border\"><xsl:value-of select=\"lenya:version\"/></td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Description</i18n:text></th>\n+      <td class=\"border\"><xsl:value-of select=\"lenya:description\"/></td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Available languages</i18n:text></th>\n+      <td class=\"border\">\n+        <xsl:for-each select=\"lenya:languages/lenya:language\">\n+          <xsl:choose>\n+            <xsl:when test=\"@default\">\n+              <strong><xsl:value-of select=\".\"/></strong>\n+            </xsl:when>\n+            <xsl:otherwise>\n+              <xsl:value-of select=\".\"/>\n+            </xsl:otherwise>\n+          </xsl:choose>\n+          <xsl:if test=\"position() != last()\">\n+            <xsl:text>, </xsl:text>\n+          </xsl:if>\n+        </xsl:for-each>\n+      </td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Available resource types</i18n:text></th>\n+      <td class=\"border\">\n+        <xsl:if test=\"lenya:templates/lenya:template\">\n+          <i18n:text>Inherited: see template publication</i18n:text><br/>\n+        </xsl:if>\n+        <xsl:for-each \n+          select=\"lenya:resource-types/lenya:resource-type[generate-id(.)=generate-id(key('workflows', @workflow)[1])]\"\n+        >\n+          <xsl:sort select=\"@workflow\"/>\n+          <xsl:for-each select=\"key('workflows', @workflow)\">\n+            <xsl:sort select=\"@name\"/>\n+            <xsl:value-of select=\"@name\"/>\n+            <xsl:if test=\"position() != last()\">\n+              <xsl:text>, </xsl:text>\n+            </xsl:if>\n+          </xsl:for-each>\n+          <xsl:text> (Workflow: </xsl:text>\n+          <xsl:value-of select=\"@workflow\"/>\n+          <xsl:text>)</xsl:text>\n+          <xsl:if test=\"position() != last()\">\n+            <xsl:text>;</xsl:text><br />\n+          </xsl:if>\n+        </xsl:for-each>\n+      </td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Required Lenya version</i18n:text></th>\n+      <td class=\"border\"><xsl:value-of select=\"lenya:lenya-version\"/></td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Required Lenya revision</i18n:text></th>\n+      <td class=\"border\"><xsl:value-of select=\"lenya:lenya-revision\"/></td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Required Cocoon version</i18n:text></th>\n+      <td class=\"border\"><xsl:value-of select=\"lenya:cocoon-version\"/></td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Modules used</i18n:text></th>\n+      <td class=\"border\">\n+        <xsl:if test=\"lenya:templates/lenya:template\">\n+          <i18n:text>Inherited: see template publication</i18n:text><br/>\n+        </xsl:if>\n+        <xsl:for-each select=\"lenya:modules/lenya:module\">\n+          <xsl:value-of select=\"@name\"/>\n+          <xsl:if test=\"position() != last()\">\n+            <xsl:text>, </xsl:text>\n+          </xsl:if>\n+        </xsl:for-each>\n+      </td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Template used</i18n:text></th>\n+      <td class=\"border\">\n+        <xsl:choose>\n+          <xsl:when test=\"lenya:template\">\n+            <a href=\"../{lenya:template/@id}/introduction.html\">\n+              <xsl:value-of select=\"lenya:template/@id\"/>\n+            </a>\n+          </xsl:when>\n+          <xsl:otherwise>\n+            <i18n:text>none</i18n:text>\n+          </xsl:otherwise>\n+        </xsl:choose>\n+      </td>\n+    </tr>\n+  </table>\n+</xsl:template>\n+\n+<xsl:template match=\"page:page\">\n+<!-- FIXME: aggregate-fallback seems to return the last document twice.\n+     The position predicate is just a quick workaround and needs to be fixed! -->\n+  <xsl:for-each select=\"page:body[position() &lt; last()]\">\n+    <xsl:apply-templates select=\"*\"/>\n+  </xsl:for-each>\n+</xsl:template>\n+\n+<!-- we are aggretating into a new context: \n+     (another good reason to move to xhtml2) -->\n+<xsl:template match=\"xhtml:h1\">\n+  <h2><xsl:apply-templates select=\"@*|node()\"/></h2>\n+</xsl:template>\n+<xsl:template match=\"xhtml:h2\">\n+  <h3><xsl:apply-templates select=\"@*|node()\"/></h3>\n+</xsl:template>\n+<xsl:template match=\"xhtml:h3\">\n+  <h4><xsl:apply-templates select=\"@*|node()\"/></h4>\n+</xsl:template>\n+<xsl:template match=\"xhtml:h4\">\n+  <h5><xsl:apply-templates select=\"@*|node()\"/></h5>\n+</xsl:template>\n+<xsl:template match=\"xhtml:h5|xhtml:h6\">\n+  <h6><xsl:apply-templates select=\"@*|node()\"/></h6>\n+</xsl:template>\n+\n+<xsl:template match=\"@*|node()\">\n+  <xsl:copy><xsl:apply-templates select=\"@*|node()\"/></xsl:copy>\n+</xsl:template>\n+\n+</xsl:stylesheet>",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/xslt/util/introduction.xsl",
                "sha": "da71ba3748e9ad4c52136e1c3fb8d82889d27cfd",
                "status": "added"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/lenya/blob/0db5be126f05d2c026e5cf63ef6ded6b2d3556a9/src/webapp/lenya/xslt/util/publication.xsl",
                "changes": 122,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/xslt/util/publication.xsl?ref=0db5be126f05d2c026e5cf63ef6ded6b2d3556a9",
                "deletions": 122,
                "filename": "src/webapp/lenya/xslt/util/publication.xsl",
                "patch": "@@ -1,122 +0,0 @@\n-<?xml version=\"1.0\"?>\n-<!--\n-  Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n--->\n-\n-<!-- $Id$ -->\n-\n-<xsl:stylesheet\n-    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" version=\"1.0\"\n-    xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.0\"\n-    xmlns=\"http://www.w3.org/1999/xhtml\"\n-    xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\n->\n-\n-<xsl:template match=\"/\">\n-  <xsl:apply-templates select=\"/lenya:publication\"/>\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:publication\">\n-<page:page>\n-  <page:title>Lenya CMS Publication: <xsl:value-of select=\"lenya:name\"/></page:title>\n-  <page:body>\n-\n-<div class=\"lenya-sidebar\">\n-<div class=\"lenya-sidebar-heading\">This&#160;Publication</div>\n-<ul>\n-  <li><a href=\"authoring/\">Login&#160;as&#160;Editor</a></li>\n-</ul>\n-<div class=\"lenya-publication-item\"><a href=\"../index.html\">Other&#160;Publications</a></div>\n-<div class=\"lenya-publication-item\"><a href=\"http://lenya.apache.org/docs/index.html\">Documentation</a></div>\n-<div class=\"lenya-publication-item\"><a href=\"http://wiki.apache.org/lenya\">Wiki</a></div>\n-</div>\n-\n-<div class=\"lenya-frontpage\">\n-<h2><xsl:value-of select=\"lenya:name\"/></h2>\n-\n-<xsl:apply-templates select=\"lenya:pub-version\"/>\n-\n-<xsl:apply-templates select=\"lenya:description\"/>\n-\n-<h3>Requirements and Dependencies</h3>\n-<p>\n-<xsl:apply-templates select=\"lenya:lenya-version\"/>\n-<xsl:apply-templates select=\"lenya:cocoon-version\"/>\n-<xsl:apply-templates select=\"lenya:modules\"/>\n-</p>\n-\n-<xsl:apply-templates select=\"lenya:readme\"/>\n-<xsl:apply-templates select=\"lenya:tests\"/>\n-</div>\n-\n-</page:body>\n-</page:page>\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:description\">\n-<h3>About</h3>\n-<p>\n-  <xsl:apply-templates />\n-</p>\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:readme\">\n-<h3>Readme</h3>\n-  <xsl:apply-templates />\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:version|lenya:lenya-version\">\n-Lenya: <strong><xsl:value-of select=\".\"/></strong> <xsl:apply-templates select=\"../lenya:lenya-revision\"/><br/>\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:lenya-revision\">\n-(Revision: <xsl:value-of select=\".\"/>)\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:cocoon-version\">\n-Cocoon: <strong><xsl:value-of select=\".\"/></strong><br/>\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:modules\">\n-Modules:\n-<ul>\n-<xsl:for-each select=\"lenya:module\">\n-  <li><xsl:value-of select=\".\"/></li>\n-</xsl:for-each>\n-</ul>\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:pub-version\">\n-Publication Version: <strong><xsl:value-of select=\".\"/></strong><br/>\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:tests\">\n-<a name=\"lenya:tests\" />\n-<h3>Tests</h3>\n-<ol>\n-  <xsl:apply-templates select=\"lenya:test\"/>\n-</ol>\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:test\">\n-  <li><xsl:apply-templates /></li>\n-</xsl:template>\n-\n-<xsl:template match=\"@*|node()\">\n-  <xsl:copy><xsl:apply-templates select=\"@*|node()\"/></xsl:copy>\n-</xsl:template>\n-\n-</xsl:stylesheet>",
                "raw_url": "https://github.com/apache/lenya/raw/0db5be126f05d2c026e5cf63ef6ded6b2d3556a9/src/webapp/lenya/xslt/util/publication.xsl",
                "sha": "9de100f04553eb3a31a12b4a56cda35f8aeb363a",
                "status": "removed"
            },
            {
                "additions": 51,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/xslt/util/welcome.xsl",
                "changes": 82,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/xslt/util/welcome.xsl?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 31,
                "filename": "src/webapp/lenya/xslt/util/welcome.xsl",
                "patch": "@@ -19,50 +19,70 @@\n <!-- $Id$ -->\n \n <xsl:stylesheet version=\"1.0\"\n+    xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.1\"\n+    xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\n+    xmlns:xhtml=\"http://www.w3.org/1999/xhtml\"\n     xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\n-    xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.0\"\n     xmlns=\"http://www.w3.org/1999/xhtml\"\n-    xmlns:xhtml=\"http://www.w3.org/1999/xhtml\"\n-    xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\n-    >\n+>\n \n-<xsl:template match=\"lenya:lenya\">\n+<xsl:template match=\"/*\">\n   <page:page>\n-    \n-  <page:title>Apache Lenya - Content Management System</page:title>\n-  <page:head>\n-    <xhtml:meta http-equiv=\"cache-control\" content=\"no-cache\"/>\n-    <xhtml:meta http-equiv=\"pragma\" content=\"no-cache\"/>\n-  </page:head>  \n-  <page:body>\n-    <xsl:apply-templates select=\"xhtml:div[@class = 'lenya-frontpage']\"/>\n-    <xsl:apply-templates select=\"lenya:publications\"/>\n-  </page:body>\n+    <page:title>Apache Lenya - Content Management System</page:title>\n+    <page:head>\n+      <xhtml:meta http-equiv=\"cache-control\" content=\"no-cache\"/>\n+      <xhtml:meta http-equiv=\"pragma\" content=\"no-cache\"/>\n+    </page:head>  \n+    <page:body>\n+      <xsl:apply-templates select=\"lenya:publications\"/>\n+      <xsl:apply-templates select=\"page:page\"/>\n+    </page:body>\n   </page:page>\n </xsl:template>\n \n <xsl:template match=\"lenya:publications\">\n-<div class=\"lenya-sidebar\">\n-<div class=\"lenya-sidebar-heading\">Publications</div>\n+  <div class=\"lenya-sidebar\">\n+  <div class=\"lenya-sidebar-heading\">Publications</div>\n   <div class=\"lenya-publication-item\">\n     <strong><a href=\"index.html?lenya.usecase=templating.createPublicationFromTemplate\">New publication</a></strong>\n   </div>\n-<xsl:for-each select=\"lenya:publication\">\n-  <xsl:choose>\n-    <xsl:when test=\"lenya:publication/@lenya:show = 'false'\">\n-      <!-- do not list this publication. Might be a \"template\" publication -->\n-    </xsl:when>\n-    <xsl:otherwise>\n-      <div class=\"lenya-publication-item\">\n-        <a href=\"{@pid}/introduction.html\">\n-        <xsl:value-of select=\"lenya:publication/lenya:name|lenya:publication/lenya:name/@name\"/></a>\n-      </div>\n-    </xsl:otherwise>\n-  </xsl:choose>\n-</xsl:for-each>\n-</div>\n+  <!-- do not list publications with @show=\"false\" \n+     (can be used to hide template publications -->\n+  <xsl:for-each select=\"lenya:publication[not(@show) or @show != 'false']\">\n+    <div class=\"lenya-publication-item\">\n+      <a>\n+        <xsl:attribute name=\"href\"><xsl:value-of select=\"@dirname\"/><xsl:text>/introduction.html</xsl:text></xsl:attribute>\n+        <xsl:attribute name=\"title\"><xsl:value-of select=\"lenya:description\"/></xsl:attribute>\n+        <xsl:value-of select=\"lenya:name\"/>\n+      </a>\n+    </div>\n+  </xsl:for-each>\n+  </div>\n+</xsl:template>\n+\n+<xsl:template match=\"page:page\">\n+   <xsl:apply-templates select=\"page:body/*\"/>\n </xsl:template>\n \n+<!-- we are aggretating into a new context: \n+     (another good reason to move to xhtml2) -->\n+<xsl:template match=\"xhtml:h1\">\n+  <h2><xsl:apply-templates select=\"@*|node()\"/></h2>\n+</xsl:template>\n+<xsl:template match=\"xhtml:h2\">\n+  <h3><xsl:apply-templates select=\"@*|node()\"/></h3>\n+</xsl:template>\n+<xsl:template match=\"xhtml:h3\">\n+  <h4><xsl:apply-templates select=\"@*|node()\"/></h4>\n+</xsl:template>\n+<xsl:template match=\"xhtml:h4\">\n+  <h5><xsl:apply-templates select=\"@*|node()\"/></h5>\n+</xsl:template>\n+<xsl:template match=\"xhtml:h5|xhtml:h6\">\n+  <h6><xsl:apply-templates select=\"@*|node()\"/></h6>\n+</xsl:template>\n+\n+\n <xsl:template match=\"@*|node()\">\n   <xsl:copy><xsl:apply-templates select=\"@*|node()\"/></xsl:copy>\n </xsl:template>",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/xslt/util/welcome.xsl",
                "sha": "a77f0b6190f052c3c90f46ce554a3d778c4d6fd9",
                "status": "modified"
            },
            {
                "additions": 71,
                "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/readme.xml",
                "changes": 71,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/readme.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9",
                "deletions": 0,
                "filename": "src/webapp/readme.xml",
                "patch": "@@ -0,0 +1,71 @@\n+<?xml version=\"1.0\"?>\n+<!--\n+  Licensed to the Apache Software Foundation (ASF) under one or more\n+  contributor license agreements.  See the NOTICE file distributed with\n+  this work for additional information regarding copyright ownership.\n+  The ASF licenses this file to You under the Apache License, Version 2.0\n+  (the \"License\"); you may not use this file except in compliance with\n+  the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+-->\n+\n+<!-- $Id: introduction.xml 473861 2006-11-12 03:51:14Z gregor $ -->\n+\n+<page:page \n+  xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\n+  xmlns=\"http://www.w3.org/1999/xhtml\"\n+>\n+  <page:head/>\n+  <page:body>\n+    <h1>README: Apache Lenya</h1>\n+    <h2>Note to developers</h2>\n+    <p>\n+      Please use this new README to inform users\n+      about changes in the code or behaviour of Lenya. It is located under\n+      <code>src/webapp/readme.xml</code>. Its contents will be shown on the global \n+      welcome page, and also on the introduction page of every publication.\n+    </p>\n+    <h2>Important note for beta testers of Lenya 1.4</h2>\n+    <p><strong><em>You need to update your custom publication.xconf files!</em></strong></p>\n+    <p>\n+      As of revision FIXME, the file <code>$YOURPUB/publication.xml</code>\n+      is no longer used. Its contents should be moved to <code>$YOURPUB/config/publication.xconf.</code>\n+      To accomodate this, the format of <code>publication.xconf</code> has changed a bit (see\n+      below).<br />\n+      Sorry for the breakage, but we were able to eliminate a lot of old ad-hoc code\n+      and duplication with this change, and the new xconf file looks a lot nicer and more intuitive.\n+    </p>\n+    <p>\n+      <em>Most important changes:</em> All elements in <code>publication.xconf</code> \n+      must now be in the namespace <code>http://apache.org/cocoon/lenya/publication/1.1</code>,\n+      and <code>&lt;module/&gt;</code>, <code>&lt;proxy/&gt;</code>, and \n+      <code>&lt;resource-type&gt;</code> elements must now be grouped \n+      in <code>&lt;modules/&gt;</code>, <code>&lt;proxies/&gt;</code>, \n+      and <code>&lt;resource-types/&gt;</code>. See the default publication\n+      for an example.<br />\n+      You can use the RNG schema at <code>webapp/lenya/resources/schemas/publication.rng</code>\n+      to verify that your file is correct:\n+      <blockquote>\n+        <code>\n+          cd $LENYA_HOME<br />\n+          java -jar lib/jing-20030619.jar src/webapp/lenya/resources/schemas/publication.rng $YOURPUB/config/publication.xconf\n+        </code>\n+      </blockquote>\n+    </p>\n+    <h2>New per-publication <code>readme.xml</code></h2>\n+    <p>\n+      If you want to provide a custom README for your publication (maybe you\n+      have used the old &lt;lenya:readme/&gt; in the now gone\n+      publication.xml), you can put it in <code>$YOURPUB/readme.xml</code>. \n+      It is now a standard Lenya CMS page in the\n+      <code>http://apache.org/cocoon/lenya/cms-page/1.0</code> namespace.\n+    </p>  \n+  </page:body>\n+</page:page>",
                "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/readme.xml",
                "sha": "bad4cdc1a9a30292e8c0ff6742ba6829c3a3fe81",
                "status": "added"
            }
        ],
        "message": "merged new publication configuration from branch trunk-rework-pubconf.\nworks for me, please test.\n\nHEADSUP:\nTHIS COMMIT WILL BREAK YOUR EXISTING PUBLICATIONS.\nyou will need to tweak your publication.xconf file. for details, just\nbuild the trunk and read the introductory page you see after starting\nlenya. take a look at src/pubs/default/config/publication.xconf for\nwhat's changed.\n\nTODO:\n* fix NPE during build if src/pubs/[default|blog]/publication.xml is\n  deleted entirely (as a workaround, it's now a null-byte file).\n* get rid of multiple-inheritance templating code (which does not work).\n  currently, that stuff has only been removed from the user-visible\n  configuration. under the hood, it still looks as if we supported it.\n  some weird empty-array semantics and a world of null objects pain...\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@528490 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/lenya/commit/0db5be126f05d2c026e5cf63ef6ded6b2d3556a9",
        "patched_files": [
            "readme.java",
            "cmsui_de.java",
            "Instantiator.java",
            "introduction.java",
            "modules2xinclude.java",
            "project.java",
            "PublicationConfiguration.java",
            "global-sitemap.java",
            "about.java",
            "welcome.java",
            "publication.java",
            "webapp-build.java",
            "publication-tests.java",
            "default.java",
            "tables.java",
            "dist-build.java",
            "aggregate-publications.java"
        ],
        "repo": "lenya",
        "unit_tests": [
            "test-build.java"
        ]
    }
}