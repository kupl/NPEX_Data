{
    "tomcat80_008da9e": {
        "bug_id": "tomcat80_008da9e",
        "commit": "https://github.com/apache/tomcat80/commit/008da9eeff22400400075638a05afa4f4b0c5b0b",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tomcat80/blob/008da9eeff22400400075638a05afa4f4b0c5b0b/java/org/apache/catalina/core/AsyncContextImpl.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/AsyncContextImpl.java?ref=008da9eeff22400400075638a05afa4f4b0c5b0b",
                "deletions": 0,
                "filename": "java/org/apache/catalina/core/AsyncContextImpl.java",
                "patch": "@@ -123,6 +123,8 @@ public void fireOnComplete() {\n     public boolean timeout() {\n         AtomicBoolean result = new AtomicBoolean();\n         request.getCoyoteRequest().action(ActionCode.ASYNC_TIMEOUT, result);\n+        // Avoids NPEs during shutdown. A call to recycle will null this field.\n+        Context context = this.context;\n \n         if (result.get()) {\n             ClassLoader oldCL = context.bind(false, null);",
                "raw_url": "https://github.com/apache/tomcat80/raw/008da9eeff22400400075638a05afa4f4b0c5b0b/java/org/apache/catalina/core/AsyncContextImpl.java",
                "sha": "6f6855c78f2741e9441094c31b8eeaaac67c28b0",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/008da9eeff22400400075638a05afa4f4b0c5b0b/webapps/docs/changelog.xml",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=008da9eeff22400400075638a05afa4f4b0c5b0b",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -72,6 +72,10 @@\n         ensure that an HTTP session exists when initiating a WebSocket\n         connection. Patch provided by isapir. (markt)\n       </add>\n+      <fix>\n+        Avoid a possible <code>NullPointerException</code> when timing out\n+        <code>AsyncContext</code> instances during shut down. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/008da9eeff22400400075638a05afa4f4b0c5b0b/webapps/docs/changelog.xml",
                "sha": "d5fd449bc5c40df585f8b680e2b043fa43b72f01",
                "status": "modified"
            }
        ],
        "message": "Avoid a possible NullPointerException when timing out AsyncContext instances during shut down.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1815507 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/2fcc6ab799351f8872836354e39c74c94247d788",
        "patched_files": [
            "AsyncContextImpl.java",
            "changelog.xml"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestAsyncContextImpl.java"
        ]
    },
    "tomcat80_00ee85d": {
        "bug_id": "tomcat80_00ee85d",
        "commit": "https://github.com/apache/tomcat80/commit/00ee85d234cc83d3738c00758a695310fa9b4a52",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/00ee85d234cc83d3738c00758a695310fa9b4a52/java/org/apache/jasper/compiler/Validator.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/Validator.java?ref=00ee85d234cc83d3738c00758a695310fa9b4a52",
                "deletions": 6,
                "filename": "java/org/apache/jasper/compiler/Validator.java",
                "patch": "@@ -652,6 +652,7 @@ public void visit(Node.UseBean n) throws JasperException {\n             visitBody(n);\n         }\n \n+        @SuppressWarnings(\"null\") // type can't be null after initial test\n         @Override\n         public void visit(Node.PlugIn n) throws JasperException {\n             JspUtil.checkAttributes(\"Plugin\", n, plugInAttrs, err);\n@@ -803,6 +804,7 @@ private boolean containsDeferredSyntax(String value) {\n             return false;\n         }\n \n+        @SuppressWarnings(\"null\") // tagInfo can't be null after initial test\n         @Override\n         public void visit(Node.CustomTag n) throws JasperException {\n \n@@ -1071,9 +1073,6 @@ private void checkXmlAttributes(Node.CustomTag n,\n                 throws JasperException {\n \n             TagInfo tagInfo = n.getTagInfo();\n-            if (tagInfo == null) {\n-                err.jspError(n, \"jsp.error.missing.tagInfo\", n.getQName());\n-            }\n             TagAttributeInfo[] tldAttrs = tagInfo.getAttributes();\n             Attributes attrs = n.getAttributes();\n \n@@ -1279,9 +1278,6 @@ private void checkNamedAttributes(Node.CustomTag n,\n                 throws JasperException {\n \n             TagInfo tagInfo = n.getTagInfo();\n-            if (tagInfo == null) {\n-                err.jspError(n, \"jsp.error.missing.tagInfo\", n.getQName());\n-            }\n             TagAttributeInfo[] tldAttrs = tagInfo.getAttributes();\n             Node.Nodes naNodes = n.getNamedAttributeNodes();\n \n@@ -1663,6 +1659,7 @@ public Method resolveFunction(String prefix, String localName) {\n                     this.fmapper = fmapper;\n                 }\n \n+                @SuppressWarnings(\"null\") // c can't be null after catch block\n                 @Override\n                 public void visit(ELNode.Function n) throws JasperException {\n \n@@ -1726,6 +1723,7 @@ public void visit(Node.CustomTag n) throws JasperException {\n                 err.jspError(n, \"jsp.error.missing.tagInfo\", n.getQName());\n             }\n \n+            @SuppressWarnings(\"null\") // tagInfo can't be null here\n             ValidationMessage[] errors = tagInfo.validate(n.getTagData());\n             if (errors != null && errors.length != 0) {\n                 StringBuilder errMsg = new StringBuilder();",
                "raw_url": "https://github.com/apache/tomcat80/raw/00ee85d234cc83d3738c00758a695310fa9b4a52/java/org/apache/jasper/compiler/Validator.java",
                "sha": "0d3a5ad6147a25c30dfaa0caa00dd2439389a929",
                "status": "modified"
            }
        ],
        "message": "Clean-up\n- fix false positive NPE warnings by removing redundant tests and suppressing remaining warnings\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1380380 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/bb797dfa08a2569694eb768545b4de1dcfaf5ae3",
        "patched_files": [
            "Validator.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestValidator.java"
        ]
    },
    "tomcat80_00f2257": {
        "bug_id": "tomcat80_00f2257",
        "commit": "https://github.com/apache/tomcat80/commit/00f225772e7b9a0397ee2116478ff4ee10294787",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tomcat80/blob/00f225772e7b9a0397ee2116478ff4ee10294787/java/org/apache/catalina/webresources/AbstractResourceSet.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/webresources/AbstractResourceSet.java?ref=00f225772e7b9a0397ee2116478ff4ee10294787",
                "deletions": 1,
                "filename": "java/org/apache/catalina/webresources/AbstractResourceSet.java",
                "patch": "@@ -39,7 +39,8 @@\n \n     protected final void checkPath(String path) {\n         if (path == null || path.length() == 0 || path.charAt(0) != '/') {\n-            throw new IllegalArgumentException();\n+            throw new IllegalArgumentException(\n+                    sm.getString(\"abstractResourceSet.checkPath\", path));\n         }\n     }\n ",
                "raw_url": "https://github.com/apache/tomcat80/raw/00f225772e7b9a0397ee2116478ff4ee10294787/java/org/apache/catalina/webresources/AbstractResourceSet.java",
                "sha": "05e14eb705d13530dda9760a17448c25cfa7eb14",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/00f225772e7b9a0397ee2116478ff4ee10294787/java/org/apache/catalina/webresources/Cache.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/webresources/Cache.java?ref=00f225772e7b9a0397ee2116478ff4ee10294787",
                "deletions": 1,
                "filename": "java/org/apache/catalina/webresources/Cache.java",
                "patch": "@@ -145,7 +145,7 @@ protected void backgroundProcess() {\n \n     private boolean noCache(String path) {\n         // Don't cache resources used by the class loader (it has its own cache)\n-        if (path == null || path.startsWith(\"/WEB-INF/classes\") ||\n+        if (path.startsWith(\"/WEB-INF/classes\") ||\n                 path.startsWith(\"/WEB-INF/lib\")) {\n             return true;\n         }",
                "raw_url": "https://github.com/apache/tomcat80/raw/00f225772e7b9a0397ee2116478ff4ee10294787/java/org/apache/catalina/webresources/Cache.java",
                "sha": "f5abdbf0c3af67a7e08b393b9f91a333cd3b1adf",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/00f225772e7b9a0397ee2116478ff4ee10294787/java/org/apache/catalina/webresources/LocalStrings.properties",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/webresources/LocalStrings.properties?ref=00f225772e7b9a0397ee2116478ff4ee10294787",
                "deletions": 0,
                "filename": "java/org/apache/catalina/webresources/LocalStrings.properties",
                "patch": "@@ -14,9 +14,12 @@\n # limitations under the License.\n \n abstractArchiveResourceSet.setReadOnlyFalse=Archive based WebResourceSets such as those based on JARs are hard-coded to be read-only and may not be configured to be read-write\n+\n abstractResource.getContentFail=Unable to return [{0}] as a byte array\n abstractResource.getContentTooLarge=Unable to return [{0}] as a byte array since the resource is [{1}] bytes in size which is larger than the maximum size of a byte array\n \n+abstractResourceSet.checkPath=The requested path [{0}] is not valid. It must begin with \"/\".\n+\n cache.addFail=Unable to add the resource at [{0}] to the cache because there was insufficient free space available after evicting expired cache entries - consider increasing the maximum size of the cache\n cache.backgroundEvictFail=The background cache eviction process was unable to free [{0}] percent of the cache for Context [{1}] - consider increasing the maximum size of the cache. After eviction approximately [{2}] KB of data remained in the cache.\n cache.objectMaxSizeTooBig=The value of [{0}]kB for objectMaxSize is larger than the limit of maxSize/20 so has been reduced to [{1}]kB\n@@ -37,6 +40,7 @@ standardRoot.createInvalidFile=Unable to create WebResourceSet from [{0}]\n standardRoot.createNoFileResourceSet=The FileResourceSet feature has not yet been implemented\n standardRoot.createUnknownType=Unable to create WebResourceSet of unknown type [{0}]\n standardRoot.invalidPath=The resource path [{0}] is not valid\n+standardRoot.invalidPathNormal=The resource path [{0}] has been normalized to [{1}] which is not valid\n standardRoot.lockedFile=The web application [{0}] failed to close the file [{1}] opened via the following stack trace\n standardRoot.noContext=A Context has not been configured for this WebResourceRoot\n standardRoot.startInvalidMain=The main resource set specified [{0}] is not valid",
                "raw_url": "https://github.com/apache/tomcat80/raw/00f225772e7b9a0397ee2116478ff4ee10294787/java/org/apache/catalina/webresources/LocalStrings.properties",
                "sha": "770b5e83125334114b9313d762a6593d2d3de2e6",
                "status": "modified"
            },
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/tomcat80/blob/00f225772e7b9a0397ee2116478ff4ee10294787/java/org/apache/catalina/webresources/StandardRoot.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/webresources/StandardRoot.java?ref=00f225772e7b9a0397ee2116478ff4ee10294787",
                "deletions": 1,
                "filename": "java/org/apache/catalina/webresources/StandardRoot.java",
                "patch": "@@ -237,7 +237,14 @@ private String validate(String path) {\n             throw new IllegalArgumentException(\n                     sm.getString(\"standardRoot.invalidPath\", path));\n         }\n-        return RequestUtil.normalize(path);\n+\n+        String result = RequestUtil.normalize(path);\n+        if (result == null || result.length() == 0 || !result.startsWith(\"/\")) {\n+            throw new IllegalArgumentException(\n+                    sm.getString(\"standardRoot.invalidPathNormal\", path, result));\n+        }\n+\n+        return result;\n     }\n \n     protected final WebResource getResourceInternal(String path,",
                "raw_url": "https://github.com/apache/tomcat80/raw/00f225772e7b9a0397ee2116478ff4ee10294787/java/org/apache/catalina/webresources/StandardRoot.java",
                "sha": "0020ddb67e88fe8386547ff6c05d260b80743495",
                "status": "modified"
            }
        ],
        "message": "Better way to avoid NPE in resource cache - don't let the request get that far when we know we are going to fail it anyway.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1573370 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/9531d972240b60a336d3a86e738161623943b042",
        "patched_files": [
            "LocalStrings.properties",
            "StandardRoot.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestStandardRoot.java"
        ]
    },
    "tomcat80_011c645": {
        "bug_id": "tomcat80_011c645",
        "commit": "https://github.com/apache/tomcat80/commit/011c6456105a9fc35052043c7aedc3a9814a13e6",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/011c6456105a9fc35052043c7aedc3a9814a13e6/java/org/apache/catalina/core/AsyncContextImpl.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/AsyncContextImpl.java?ref=011c6456105a9fc35052043c7aedc3a9814a13e6",
                "deletions": 0,
                "filename": "java/org/apache/catalina/core/AsyncContextImpl.java",
                "patch": "@@ -431,6 +431,10 @@ public void setErrorState(Throwable t, boolean fireOnError) {\n         if (result.get()) {\n             // No listener called dispatch() or complete(). This is an error.\n             // SRV.2.3.3.3 (search for \"error dispatch\")\n+            // Take a local copy to avoid threading issues if another thread\n+            // clears this (can happen during error handling with non-container\n+            // threads)\n+            ServletResponse servletResponse = this.servletResponse;\n             if (servletResponse instanceof HttpServletResponse) {\n                 ((HttpServletResponse) servletResponse).setStatus(\n                         HttpServletResponse.SC_INTERNAL_SERVER_ERROR);",
                "raw_url": "https://github.com/apache/tomcat80/raw/011c6456105a9fc35052043c7aedc3a9814a13e6/java/org/apache/catalina/core/AsyncContextImpl.java",
                "sha": "82a37677c0fc52381ce88975499c1fc3b94a2d6b",
                "status": "modified"
            }
        ],
        "message": "Avoid NPE during non-container thread error handling\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1799934 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/ff95c6e45429ffa6c98977de5b7441037b6803e5",
        "patched_files": [
            "AsyncContextImpl.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestAsyncContextImpl.java"
        ]
    },
    "tomcat80_03beb42": {
        "bug_id": "tomcat80_03beb42",
        "commit": "https://github.com/apache/tomcat80/commit/03beb42e1d3990c738aae51b740a94a039ca764d",
        "file": [
            {
                "additions": 26,
                "blob_url": "https://github.com/apache/tomcat80/blob/03beb42e1d3990c738aae51b740a94a039ca764d/java/org/apache/tomcat/util/http/parser/HttpParser.java",
                "changes": 44,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/http/parser/HttpParser.java?ref=03beb42e1d3990c738aae51b740a94a039ca764d",
                "deletions": 18,
                "filename": "java/org/apache/tomcat/util/http/parser/HttpParser.java",
                "patch": "@@ -577,45 +577,50 @@ static int readHostIPv6(Reader reader) throws IOException {\n         int h16Size = 0;\n         int pos = 1;\n         boolean parsedDoubleColon = false;\n-        boolean previousWasColon = false;\n+        int precedingColonsCount = 0;\n \n         do {\n             c = reader.read();\n-            if (h16Count == 0 && previousWasColon && c != ':') {\n+            if (h16Count == 0 && precedingColonsCount == 1 && c != ':') {\n                 // Can't start with a single :\n                 throw new IllegalArgumentException();\n             }\n             if (HttpParser.isHex(c)) {\n                 if (h16Size == 0) {\n                     // Start of a new h16 block\n-                    previousWasColon = false;\n+                    precedingColonsCount = 0;\n                     h16Count++;\n-                    reader.mark(4);\n                 }\n                 h16Size++;\n                 if (h16Size > 4) {\n                     throw new IllegalArgumentException();\n                 }\n             } else if (c == ':') {\n-                if (previousWasColon) {\n-                    // End of ::\n-                    if (parsedDoubleColon) {\n-                        // Only allowed one :: sequence\n-                        throw new IllegalArgumentException();\n-                    }\n-                    parsedDoubleColon = true;\n-                    previousWasColon = false;\n-                    // :: represents at least one h16 block\n-                    h16Count++;\n+                if (precedingColonsCount >=2 ) {\n+                    // ::: is not allowed\n+                    throw new IllegalArgumentException();\n                 } else {\n-                    previousWasColon = true;\n+                    if(precedingColonsCount == 1) {\n+                        // End of ::\n+                        if (parsedDoubleColon ) {\n+                            // Only allowed one :: sequence\n+                            throw new IllegalArgumentException();\n+                        }\n+                        parsedDoubleColon = true;\n+                        // :: represents at least one h16 block\n+                        h16Count++;\n+                    }\n+                    precedingColonsCount++;\n+                    // mark if the next symbol is hex before the actual read\n+                    reader.mark(4);\n                 }\n                 h16Size = 0;\n             } else if (c == ']') {\n-                if (previousWasColon) {\n+                if (precedingColonsCount == 1) {\n                     // Can't end on a single ':'\n                     throw new IllegalArgumentException();\n                 }\n+                pos++;\n                 break;\n             } else if (c == '.') {\n                 if (h16Count == 7 || h16Count < 7 && parsedDoubleColon) {\n@@ -641,9 +646,12 @@ static int readHostIPv6(Reader reader) throws IOException {\n \n         c = reader.read();\n         if (c == ':') {\n-            return pos + 1;\n+            return pos;\n         } else {\n-            return -1;\n+            if(c == -1) {\n+                return -1;\n+            }\n+            throw new IllegalArgumentException();\n         }\n     }\n ",
                "raw_url": "https://github.com/apache/tomcat80/raw/03beb42e1d3990c738aae51b740a94a039ca764d/java/org/apache/tomcat/util/http/parser/HttpParser.java",
                "sha": "a9454935827cc52782656a770924b8c876764831",
                "status": "modified"
            },
            {
                "additions": 53,
                "blob_url": "https://github.com/apache/tomcat80/blob/03beb42e1d3990c738aae51b740a94a039ca764d/res/maven/mvn-pub.xml",
                "changes": 133,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/res/maven/mvn-pub.xml?ref=03beb42e1d3990c738aae51b740a94a039ca764d",
                "deletions": 80,
                "filename": "res/maven/mvn-pub.xml",
                "patch": "@@ -49,35 +49,18 @@\n     </copy>\n \n     <!--sign the jar, the source and the pom -->\n-    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n-          inputstring=\"${gpg.passphrase}\">\n-      <arg value=\"--batch\"/>\n-      <arg value=\"--passphrase-fd\"/>\n-      <arg value=\"0\"/>\n-      <arg value=\"-a\"/>\n-      <arg value=\"-b\"/>\n-      <arg value=\"${file}\"/>\n-    </exec>\n-    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n-          inputstring=\"${gpg.passphrase}\">\n-      <arg value=\"--batch\"/>\n-      <arg value=\"--passphrase-fd\"/>\n-      <arg value=\"0\"/>\n-      <arg value=\"-a\"/>\n-      <arg value=\"-b\"/>\n-      <arg value=\"${src}\"/>\n-    </exec>\n-    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n-          inputstring=\"${gpg.passphrase}\">\n-      <arg value=\"--batch\"/>\n-      <arg value=\"--passphrase-fd\"/>\n-      <arg value=\"0\"/>\n-      <arg value=\"-a\"/>\n-      <arg value=\"-b\"/>\n-      <arg value=\"-o\"/>\n-      <arg value=\"${pom}.asc\"/>\n-      <arg value=\"${pom}.tmp\"/>\n-    </exec>\n+    <antcall target=\"-sign\" >\n+      <param name=\"file.in\" value=\"@{file}\" />\n+      <param name=\"file.out\" value=\"@{file}.asc\" />\n+    </antcall>\n+    <antcall target=\"-sign\" >\n+      <param name=\"file.in\" value=\"@{src}\" />\n+      <param name=\"file.out\" value=\"@{src}.asc\" />\n+    </antcall>\n+    <antcall target=\"-sign\" >\n+      <param name=\"file.in\" value=\"@{pom}.tmp\" />\n+      <param name=\"file.out\" value=\"@{pom}.asc\" />\n+    </antcall>\n \n     <artifact:deploy file=\"${file}\">\n         <pom file=\"${pom}.tmp\"/>\n@@ -131,26 +114,14 @@\n     </copy>\n \n     <!--sign the file and pom -->\n-    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n-          inputstring=\"${gpg.passphrase}\">\n-      <arg value=\"--batch\"/>\n-      <arg value=\"--passphrase-fd\"/>\n-      <arg value=\"0\"/>\n-      <arg value=\"-a\"/>\n-      <arg value=\"-b\"/>\n-      <arg value=\"${file}\"/>\n-    </exec>\n-    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n-          inputstring=\"${gpg.passphrase}\">\n-      <arg value=\"--batch\"/>\n-      <arg value=\"--passphrase-fd\"/>\n-      <arg value=\"0\"/>\n-      <arg value=\"-a\"/>\n-      <arg value=\"-b\"/>\n-      <arg value=\"-o\"/>\n-      <arg value=\"${pom}.asc\"/>\n-      <arg value=\"${pom}.tmp\"/>\n-    </exec>\n+    <antcall target=\"-sign\" >\n+      <param name=\"file.in\" value=\"@{file}\" />\n+      <param name=\"file.out\" value=\"@{file}.asc\" />\n+    </antcall>\n+    <antcall target=\"-sign\" >\n+      <param name=\"file.in\" value=\"@{pom}.tmp\" />\n+      <param name=\"file.out\" value=\"@{pom}.asc\" />\n+    </antcall>\n \n     <artifact:deploy file=\"${file}\">\n       <pom file=\"${pom}.tmp\"/>\n@@ -198,35 +169,18 @@\n     </copy>\n \n     <!--sign the zip, the tar.gz and the pom -->\n-    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n-          inputstring=\"${gpg.passphrase}\">\n-      <arg value=\"--batch\"/>\n-      <arg value=\"--passphrase-fd\"/>\n-      <arg value=\"0\"/>\n-      <arg value=\"-a\"/>\n-      <arg value=\"-b\"/>\n-      <arg value=\"${file}.zip\"/>\n-    </exec>\n-    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n-          inputstring=\"${gpg.passphrase}\">\n-      <arg value=\"--batch\"/>\n-      <arg value=\"--passphrase-fd\"/>\n-      <arg value=\"0\"/>\n-      <arg value=\"-a\"/>\n-      <arg value=\"-b\"/>\n-      <arg value=\"${file}.tar.gz\"/>\n-    </exec>\n-    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n-          inputstring=\"${gpg.passphrase}\">\n-      <arg value=\"--batch\"/>\n-      <arg value=\"--passphrase-fd\"/>\n-      <arg value=\"0\"/>\n-      <arg value=\"-a\"/>\n-      <arg value=\"-b\"/>\n-      <arg value=\"-o\"/>\n-      <arg value=\"${pom}.asc\"/>\n-      <arg value=\"${pom}.tmp\"/>\n-    </exec>\n+    <antcall target=\"-sign\" >\n+      <param name=\"file.in\" value=\"@{file}\" />\n+      <param name=\"file.out\" value=\"@{file}.asc\" />\n+    </antcall>\n+    <antcall target=\"-sign\" >\n+      <param name=\"file.in\" value=\"@{file}.tar.gz\" />\n+      <param name=\"file.out\" value=\"@{file}.tar.gz.asc\" />\n+    </antcall>\n+    <antcall target=\"-sign\" >\n+      <param name=\"file.in\" value=\"@{pom}.tmp\" />\n+      <param name=\"file.out\" value=\"@{pom}.asc\" />\n+    </antcall>\n \n     <artifact:deploy file=\"${pom}\">\n         <pom file=\"${pom}.tmp\"/>\n@@ -262,7 +216,7 @@\n     </sequential>\n   </macrodef>\n \n-  <target name=\"generic-deploy\" depends=\"init-maven,init-gpg,init-ldap\">\n+  <target name=\"generic-deploy\" depends=\"init-maven,init-gpg-1,init-gpg-2,init-ldap\">\n     <!-- Standard jars in bin directory -->\n     <!-- Skip bootstrap.jar - it is just a subset of catalina.jar -->\n     <doMavenDeploy artifactId=\"tomcat-juli\"\n@@ -413,7 +367,11 @@\n     </antcall>\n   </target>\n \n-  <target name=\"init-gpg\">\n+  <target name=\"init-gpg-1\">\n+    <available file=\"${gpg.exec}\" property=\"gpg.exec.available\"/>\n+  </target>\n+\n+  <target name=\"init-gpg-2\" if=\"${gpg.exec.available}\">\n     <input message=\"Enter GPG pass-phrase\" addproperty=\"gpg.passphrase\" >\n       <handler type=\"secure\"/>\n     </input>\n@@ -426,4 +384,19 @@\n     </input>\n   </target>\n \n+  <target name=\"-sign\" if=\"gpg.passphrase\">\n+    <fail unless=\"file\" />\n+    <exec executable=\"${gpg.exec}\" failonerror=\"true\"\n+          inputstring=\"${gpg.passphrase}\">\n+      <arg value=\"--batch\"/>\n+      <arg value=\"--passphrase-fd\"/>\n+      <arg value=\"0\"/>\n+      <arg value=\"-a\"/>\n+      <arg value=\"-b\"/>\n+      <arg value=\"-o\"/>\n+      <arg value=\"${file.out}\"/>\n+      <arg value=\"${file.in}\"/>\n+    </exec>\n+  </target>\n+\n </project>",
                "raw_url": "https://github.com/apache/tomcat80/raw/03beb42e1d3990c738aae51b740a94a039ca764d/res/maven/mvn-pub.xml",
                "sha": "b8504a51cbfc5aa68eba34469bdcd433a313152a",
                "status": "modified"
            },
            {
                "additions": 15,
                "blob_url": "https://github.com/apache/tomcat80/blob/03beb42e1d3990c738aae51b740a94a039ca764d/test/org/apache/tomcat/util/http/parser/TestHttpParserHost.java",
                "changes": 15,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/tomcat/util/http/parser/TestHttpParserHost.java?ref=03beb42e1d3990c738aae51b740a94a039ca764d",
                "deletions": 0,
                "filename": "test/org/apache/tomcat/util/http/parser/TestHttpParserHost.java",
                "patch": "@@ -66,6 +66,7 @@\n         result.add(new Object[] { TestType.IPv4, \"0.0.0.256\", Integer.valueOf(-1), IAE} );\n         result.add(new Object[] { TestType.IPv4, \"0.a.0.0\", Integer.valueOf(-1), IAE} );\n         result.add(new Object[] { TestType.IPv4, \"0..0.0\", Integer.valueOf(-1), IAE} );\n+        result.add(new Object[] { TestType.IPv4, \"0]\", Integer.valueOf(-1), IAE} );\n         // Domain Name - valid\n         result.add(new Object[] { TestType.DOMAIN_NAME, \"localhost\", Integer.valueOf(-1), null} );\n         result.add(new Object[] { TestType.DOMAIN_NAME, \"localhost:8080\", Integer.valueOf(9), null} );\n@@ -121,6 +122,7 @@\n         result.add(new Object[] { TestType.IPv6, \"[0:0:0:0:0:0:127.0.0.1]\", Integer.valueOf(-1), null} );\n         result.add(new Object[] { TestType.IPv6, \"[0:0:0:0:0:0:127.0.0.1]:8080\",\n                 Integer.valueOf(23), null} );\n+        result.add(new Object[] { TestType.IPv6, \"[::1.2.3.4]\", Integer.valueOf(-1), null} );\n         // IPv6 - invalid\n         result.add(new Object[] { TestType.IPv6, \"[1234:5678:90AB:CDEF:1234:127.0.0.1]\",\n                 Integer.valueOf(-1), IAE} );\n@@ -136,6 +138,18 @@\n         result.add(new Object[] { TestType.IPv6, \"[0::0::127.0.0.1]\", Integer.valueOf(-1), IAE} );\n         result.add(new Object[] { TestType.IPv6, \"[0:0:G:0:0:0:127.0.0.1]\", Integer.valueOf(-1), IAE} );\n         result.add(new Object[] { TestType.IPv6, \"[00000:0:0:0:0:0:127.0.0.1]\", Integer.valueOf(-1), IAE} );\n+        result.add(new Object[] { TestType.IPv6, \"[::1]'\", Integer.valueOf(-1), IAE} );\n+        result.add(new Object[] { TestType.IPv6, \"[:2222:3333:4444:5555:6666:7777:8888]\",\n+                Integer.valueOf(-1), IAE} );\n+        result.add(new Object[] { TestType.IPv6, \"[1111:::3333:4444:5555:6666:7777:8888]\",\n+                Integer.valueOf(-1), IAE} );\n+        result.add(new Object[] { TestType.IPv6, \"::1]\", Integer.valueOf(-1), IAE} );\n+        result.add(new Object[] { TestType.IPv6, \"[1111:2222:3333:4444:5555:6666:7777:8888:9999]\",\n+                Integer.valueOf(-1), IAE} );\n+        result.add(new Object[] { TestType.IPv6, \"[1111:2222:3333:4444:5555:6666:7777:1.2.3.4]\",\n+            Integer.valueOf(-1), IAE} );\n+        result.add(new Object[] { TestType.IPv6, \"[1111:2222:3333]\",\n+            Integer.valueOf(-1), IAE} );\n         return result;\n     }\n \n@@ -165,6 +179,7 @@ public void testHost() {\n         if (expectedException == null) {\n             Assert.assertNull(input, exceptionClass);\n         } else {\n+            Assert.assertNotNull(exceptionClass);\n             Assert.assertTrue(input, expectedException.isAssignableFrom(exceptionClass));\n         }\n     }",
                "raw_url": "https://github.com/apache/tomcat80/raw/03beb42e1d3990c738aae51b740a94a039ca764d/test/org/apache/tomcat/util/http/parser/TestHttpParserHost.java",
                "sha": "a6f98ba54d53ac329258e403b3875985918e0a6e",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/03beb42e1d3990c738aae51b740a94a039ca764d/webapps/docs/changelog.xml",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=03beb42e1d3990c738aae51b740a94a039ca764d",
                "deletions": 1,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -64,7 +64,7 @@\n         when the Valve is configured on a Host or an Engine. (fschumacher)\n       </fix>\n     </changelog>\n-  </subsection>  \n+  </subsection>\n   <subsection name=\"Jasper\">\n     <changelog>\n       <fix>",
                "raw_url": "https://github.com/apache/tomcat80/raw/03beb42e1d3990c738aae51b740a94a039ca764d/webapps/docs/changelog.xml",
                "sha": "40f60d37f6a6de67f261fcf522d03c39d204dc48",
                "status": "modified"
            }
        ],
        "message": "Correct various edge cases in the new HTTP Host header validation parser.\nPatch provided by Katya Todorova.\n\nFix IPv6/IPv4 parsing for host header:\n    - chars other than : should not be allowed in IPv6 address after ]\n    - ::: should not present in IPv6 address\n    - IPv4 part of IPv6 address was not correctly parsed (1 symbol of IPv4 part was ignored)\n    - tests added to cover IPv4/6 parsing \n    - parsed test class fixed not to throw NPE when an exception is expected but not thrown \n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1830251 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/c7f74e6c3fc3b1fc197f680262b6fd9ad1a0438b",
        "patched_files": [
            "HttpParser.java",
            "mvn-pub.xml",
            "changelog.xml"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestHttpParserHost.java",
            "TestHttpParser.java"
        ]
    },
    "tomcat80_0472c8b": {
        "bug_id": "tomcat80_0472c8b",
        "commit": "https://github.com/apache/tomcat80/commit/0472c8b228fdbc4e2ab3362ec83d0e2cc30062b7",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/0472c8b228fdbc4e2ab3362ec83d0e2cc30062b7/java/org/apache/jasper/resources/LocalStrings.properties",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/resources/LocalStrings.properties?ref=0472c8b228fdbc4e2ab3362ec83d0e2cc30062b7",
                "deletions": 1,
                "filename": "java/org/apache/jasper/resources/LocalStrings.properties",
                "patch": "@@ -402,4 +402,4 @@ org.apache.jasper.compiler.TldCache.servletContextNull=The provided SevletContex\n org.apache.jasper.servlet.JasperInitializer.onStartup=Initializing Jasper for context [{0}]\n org.apache.jasper.servlet.TldScanner.webxmlSkip=Skipping load of TLD for URI {1} from resource path {0} as it has already been defined in <jsp-config>\n org.apache.jasper.servlet.TldScanner.webxmlAdd=Loading TLD for URI {1} from resource path {0}\n-\n+org.apache.jasper.servlet.TldScanner.webxmlFailPathDoesNotExist=Failed to process TLD with path [{0}] and URI [{1}]. The specified path does not exist.",
                "raw_url": "https://github.com/apache/tomcat80/raw/0472c8b228fdbc4e2ab3362ec83d0e2cc30062b7/java/org/apache/jasper/resources/LocalStrings.properties",
                "sha": "cc26ee3847a5aff98468701412ce27b9cb6e7da7",
                "status": "modified"
            },
            {
                "additions": 20,
                "blob_url": "https://github.com/apache/tomcat80/blob/0472c8b228fdbc4e2ab3362ec83d0e2cc30062b7/java/org/apache/jasper/servlet/TldScanner.java",
                "changes": 34,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/servlet/TldScanner.java?ref=0472c8b228fdbc4e2ab3362ec83d0e2cc30062b7",
                "deletions": 14,
                "filename": "java/org/apache/jasper/servlet/TldScanner.java",
                "patch": "@@ -175,21 +175,27 @@ protected void scanJspConfig() throws IOException, SAXException {\n             }\n \n             URL url = context.getResource(resourcePath);\n-            TldResourcePath tldResourcePath;\n-            if (resourcePath.endsWith(\".jar\")) {\n-                // if the path points to a jar file, the TLD is presumed to be\n-                // inside at META-INF/taglib.tld\n-                tldResourcePath = new TldResourcePath(\n-                        url, resourcePath, \"META-INF/taglib.tld\");\n+            if (url != null) {\n+                TldResourcePath tldResourcePath;\n+                if (resourcePath.endsWith(\".jar\")) {\n+                    // if the path points to a jar file, the TLD is presumed to be\n+                    // inside at META-INF/taglib.tld\n+                    tldResourcePath = new TldResourcePath(url, resourcePath, \"META-INF/taglib.tld\");\n+                } else {\n+                    tldResourcePath = new TldResourcePath(url, resourcePath);\n+                }\n+                // parse TLD but store using the URI supplied in the descriptor\n+                TaglibXml tld = tldParser.parse(tldResourcePath);\n+                uriTldResourcePathMap.put(taglibURI, tldResourcePath);\n+                tldResourcePathTaglibXmlMap.put(tldResourcePath, tld);\n+                if (tld.getListeners() != null) {\n+                    listeners.addAll(tld.getListeners());\n+                }\n             } else {\n-                tldResourcePath = new TldResourcePath(url, resourcePath);\n-            }\n-            // parse TLD but store using the URI supplied in the descriptor\n-            TaglibXml tld = tldParser.parse(tldResourcePath);\n-            uriTldResourcePathMap.put(taglibURI, tldResourcePath);\n-            tldResourcePathTaglibXmlMap.put(tldResourcePath, tld);\n-            if (tld.getListeners() != null) {\n-                listeners.addAll(tld.getListeners());\n+                log.warn(Localizer.getMessage(MSG + \".webxmlFailPathDoesNotExist\",\n+                        resourcePath,\n+                        taglibURI));\n+                continue;\n             }\n         }\n     }",
                "raw_url": "https://github.com/apache/tomcat80/raw/0472c8b228fdbc4e2ab3362ec83d0e2cc30062b7/java/org/apache/jasper/servlet/TldScanner.java",
                "sha": "8d56b5f1ed5c1420302d9d4e28d7ccfcee8c5347",
                "status": "modified"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55905\nPrevent NPE when the specified tld resource does not exists.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1552071 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/8e6eeab4915980d96fd50d4dfb178ca285c98823",
        "patched_files": [
            "TldScanner.java",
            "LocalStrings.properties"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestTldScanner.java"
        ]
    },
    "tomcat80_04df311": {
        "bug_id": "tomcat80_04df311",
        "commit": "https://github.com/apache/tomcat80/commit/04df311069738ac186f44ab619fe1921dc8a0794",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tomcat80/blob/04df311069738ac186f44ab619fe1921dc8a0794/java/org/apache/catalina/startup/WebappServiceLoader.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/startup/WebappServiceLoader.java?ref=04df311069738ac186f44ab619fe1921dc8a0794",
                "deletions": 1,
                "filename": "java/org/apache/catalina/startup/WebappServiceLoader.java",
                "patch": "@@ -34,6 +34,7 @@\n import javax.servlet.ServletContext;\n \n import org.apache.catalina.Context;\n+import org.apache.tomcat.util.scan.JarFactory;\n \n /**\n  * A variation of Java's JAR ServiceLoader that respects exclusion rules for\n@@ -112,7 +113,7 @@ public WebappServiceLoader(Context context) {\n                 if (base.endsWith(\"/\")) {\n                     url = new URL(base + configFile);\n                 } else {\n-                    url = new URL(\"jar:\" + base + \"!/\" + configFile);\n+                    url = JarFactory.getJarEntryURL(jarUrl, configFile);\n                 }\n                 try {\n                     parseConfigFile(applicationServicesFound, url);",
                "raw_url": "https://github.com/apache/tomcat80/raw/04df311069738ac186f44ab619fe1921dc8a0794/java/org/apache/catalina/startup/WebappServiceLoader.java",
                "sha": "03811a4eb23c9823e84f67624011375f13642a0c",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/tomcat80/blob/04df311069738ac186f44ab619fe1921dc8a0794/webapps/docs/changelog.xml",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=04df311069738ac186f44ab619fe1921dc8a0794",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -45,6 +45,15 @@\n   issues do not \"pop up\" wrt. others).\n -->\n <section name=\"Tomcat 8.0.29 (markt)\" rtext=\"in development\">\n+  <subsection name=\"Catalina\">\n+    <changelog>\n+      <fix>\n+        <bug>58490</bug>: Fixed NPE thrown when scanning for\n+        <code>javax.servlet.ServletContainerInitializer</code> in case the web\n+        application is not extracted. (violetagg)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection name=\"Cluster\">\n     <changelog>\n       <fix>",
                "raw_url": "https://github.com/apache/tomcat80/raw/04df311069738ac186f44ab619fe1921dc8a0794/webapps/docs/changelog.xml",
                "sha": "1ec09ba1cce0c942ba851eda1e94bed268fa8145",
                "status": "modified"
            }
        ],
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58490\nMerged revision 1710134 from tomcat/trunk:\nFix NPE when searching for SCIs in case the web app is not extracted \n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1710136 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/799454d1a9b09f23f0751d8927761069cba92aca",
        "patched_files": [
            "changelog.xml",
            "WebappServiceLoader.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestWebappServiceLoader.java"
        ]
    },
    "tomcat80_0656fc7": {
        "bug_id": "tomcat80_0656fc7",
        "commit": "https://github.com/apache/tomcat80/commit/0656fc7a775bdde7ca883483d71057c149f317ee",
        "file": [
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tomcat80/blob/0656fc7a775bdde7ca883483d71057c149f317ee/java/javax/servlet/jsp/PageContext.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/javax/servlet/jsp/PageContext.java?ref=0656fc7a775bdde7ca883483d71057c149f317ee",
                "deletions": 2,
                "filename": "java/javax/servlet/jsp/PageContext.java",
                "patch": "@@ -513,10 +513,18 @@ public BodyContent pushBody() {\n      * @since 2.0\n      */\n     public ErrorData getErrorData() {\n+        int status = 0;\n+        \n+        Integer status_code = (Integer)getRequest().getAttribute( \n+                \"javax.servlet.error.status_code\");\n+        // Avoid NPE if attribute is not set\n+        if (status_code != null) {\n+            status = status_code.intValue();\n+        }\n+\n         return new ErrorData( \n             (Throwable)getRequest().getAttribute( \"javax.servlet.error.exception\" ),\n-            ((Integer)getRequest().getAttribute( \n-                \"javax.servlet.error.status_code\" )).intValue(),\n+            status,\n             (String)getRequest().getAttribute( \"javax.servlet.error.request_uri\" ),\n             (String)getRequest().getAttribute( \"javax.servlet.error.servlet_name\" ) );\n     }",
                "raw_url": "https://github.com/apache/tomcat80/raw/0656fc7a775bdde7ca883483d71057c149f317ee/java/javax/servlet/jsp/PageContext.java",
                "sha": "b3507fa7ff596be198368dbb58e92cf67a349125",
                "status": "modified"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49196\nAvoid NPE on PageContext.getErrorData()\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@948057 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/c695e9d02b6e10c7061b69a24690fe3934a2352f",
        "patched_files": [
            "PageContext.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestPageContext.java"
        ]
    },
    "tomcat80_083c4fa": {
        "bug_id": "tomcat80_083c4fa",
        "commit": "https://github.com/apache/tomcat80/commit/083c4fab768e9c75a742fddab933a5afd4bb117f",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/083c4fab768e9c75a742fddab933a5afd4bb117f/java/org/apache/catalina/connector/Request.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/Request.java?ref=083c4fab768e9c75a742fddab933a5afd4bb117f",
                "deletions": 0,
                "filename": "java/org/apache/catalina/connector/Request.java",
                "patch": "@@ -1519,6 +1519,9 @@ public void setAttribute(String name, Object value) {\n     private void notifyAttributeAssigned(String name, Object value,\n             Object oldValue) {\n         Context context = getContext();\n+        if (context == null) {\n+            return;\n+        }\n         Object listeners[] = context.getApplicationEventListeners();\n         if ((listeners == null) || (listeners.length == 0)) {\n             return;",
                "raw_url": "https://github.com/apache/tomcat80/raw/083c4fab768e9c75a742fddab933a5afd4bb117f/java/org/apache/catalina/connector/Request.java",
                "sha": "bc2402b19769ce39ade98ffa8814bd5d55268766",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tomcat80/blob/083c4fab768e9c75a742fddab933a5afd4bb117f/webapps/docs/changelog.xml",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=083c4fab768e9c75a742fddab933a5afd4bb117f",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -111,6 +111,11 @@\n         of the <code>JreMemoryLeakPreventionListener</code> when running on Java\n         9 and above since the underlying JRE bug has been fixed. (markt)\n       </add>\n+      <fix>\n+        <bug>62263</bug>: Avoid a <code>NullPointerException</code> when the\n+        <code>RemoteIpValve</code> processes a request for which no Context can\n+        be found. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/083c4fab768e9c75a742fddab933a5afd4bb117f/webapps/docs/changelog.xml",
                "sha": "990e1d6c8995cfad501fd7c571bbcc583760c030",
                "status": "modified"
            }
        ],
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=62263\nAvoid a NullPointerException when the RemoteIpValve processes a request for which no Context can be found.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1828567 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/be096d832f07a8ea176c6dd59b969ec7b0e02614",
        "patched_files": [
            "changelog.xml",
            "Request.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestRequest.java"
        ]
    },
    "tomcat80_0a3cf76": {
        "bug_id": "tomcat80_0a3cf76",
        "commit": "https://github.com/apache/tomcat80/commit/0a3cf7642ded410c5b46327d8d4ebad0764960dc",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/0a3cf7642ded410c5b46327d8d4ebad0764960dc/test/org/apache/tomcat/util/net/TestSsl.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/tomcat/util/net/TestSsl.java?ref=0a3cf7642ded410c5b46327d8d4ebad0764960dc",
                "deletions": 1,
                "filename": "test/org/apache/tomcat/util/net/TestSsl.java",
                "patch": "@@ -35,6 +35,7 @@\n \n import org.junit.Test;\n \n+import org.apache.catalina.Context;\n import org.apache.catalina.startup.Tomcat;\n import org.apache.catalina.startup.TomcatBaseTest;\n import org.apache.tomcat.util.buf.ByteChunk;\n@@ -167,7 +168,9 @@ public void testRenegotiateWorks() throws Exception {\n \n         File appDir = new File(getBuildDirectory(), \"webapps/examples\");\n         // app dir is relative to server home\n-        tomcat.addWebapp(null, \"/examples\", appDir.getAbsolutePath());\n+        Context ctx = tomcat.addWebapp(null, \"/examples\",\n+                appDir.getAbsolutePath());\n+        ctx.addApplicationListener(WsListener.class.getName());\n \n         TesterSupport.initSsl(tomcat);\n ",
                "raw_url": "https://github.com/apache/tomcat80/raw/0a3cf7642ded410c5b46327d8d4ebad0764960dc/test/org/apache/tomcat/util/net/TestSsl.java",
                "sha": "651b178e8dc4066bb80c6b2bc1c56d7c0a4b5e65",
                "status": "modified"
            }
        ],
        "message": "Correctly init WebSocket to avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1485833 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/cee3cf2488a977536a765b0118220685cce1ae43",
        "patched_files": [],
        "repo": "tomcat80",
        "unit_tests": [
            "TestSsl.java"
        ]
    },
    "tomcat80_0bac694": {
        "bug_id": "tomcat80_0bac694",
        "commit": "https://github.com/apache/tomcat80/commit/0bac6949b2008a3d03d37b1dba13eecd778d5282",
        "file": [
            {
                "additions": 17,
                "blob_url": "https://github.com/apache/tomcat80/blob/0bac6949b2008a3d03d37b1dba13eecd778d5282/test/org/apache/tomcat/util/threads/TestLimitLatch.java",
                "changes": 39,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/tomcat/util/threads/TestLimitLatch.java?ref=0bac6949b2008a3d03d37b1dba13eecd778d5282",
                "deletions": 22,
                "filename": "test/org/apache/tomcat/util/threads/TestLimitLatch.java",
                "patch": "@@ -20,26 +20,17 @@\n \n public class TestLimitLatch extends TestCase {\n \n-    private volatile LimitLatch latch = null;\n-\n-    @Override\n-    public void tearDown() {\n-        LimitLatch temp = latch;\n-        if (temp!=null) temp.releaseAll();\n-        latch = null;\n-    }\n-\n     public void testNoThreads() throws Exception {\n-        latch = new LimitLatch(0);\n+        LimitLatch latch = new LimitLatch(0);\n         assertEquals(\"No threads should be waiting\", false,\n                 latch.hasQueuedThreads());\n     }\n \n     public void testOneThreadNoWait() throws Exception {\n-        latch = new LimitLatch(1);\n+        LimitLatch latch = new LimitLatch(1);\n         assertEquals(\"No threads should be waiting\", false,\n                 latch.hasQueuedThreads());\n-        Thread testThread = new TestThread();\n+        Thread testThread = new TestThread(latch);\n         testThread.start();\n         Thread.sleep(50);\n         assertEquals(\"0 threads should be waiting\", 0,\n@@ -51,10 +42,10 @@ public void testOneThreadNoWait() throws Exception {\n     }\n \n     public void testOneThreadWaitCountUp() throws Exception {\n-        latch = new LimitLatch(1);\n+        LimitLatch latch = new LimitLatch(1);\n         assertEquals(\"No threads should be waiting\", false,\n                 latch.hasQueuedThreads());\n-        Thread testThread = new TestThread();\n+        Thread testThread = new TestThread(latch);\n         latch.countUpOrAwait();\n         testThread.start();\n         Thread.sleep(50);\n@@ -67,10 +58,10 @@ public void testOneThreadWaitCountUp() throws Exception {\n     }\n \n     public void testOneRelease() throws Exception {\n-        latch = new LimitLatch(1);\n+        LimitLatch latch = new LimitLatch(1);\n         assertEquals(\"No threads should be waiting\", false,\n                 latch.hasQueuedThreads());\n-        Thread testThread = new TestThread();\n+        Thread testThread = new TestThread(latch);\n         latch.countUpOrAwait();\n         testThread.start();\n         Thread.sleep(50);\n@@ -83,12 +74,12 @@ public void testOneRelease() throws Exception {\n     }\n \n     public void testTenWait() throws Exception {\n-        latch = new LimitLatch(10);\n+        LimitLatch latch = new LimitLatch(10);\n         assertEquals(\"No threads should be waiting\", false,\n                 latch.hasQueuedThreads());\n         Thread[] testThread = new TestThread[30];\n         for (int i = 0; i < 30; i++) {\n-            testThread[i] = new TestThread(1000);\n+            testThread[i] = new TestThread(latch, 1000);\n             testThread[i].start();\n         }\n         Thread.sleep(50);\n@@ -105,12 +96,14 @@ public void testTenWait() throws Exception {\n     private class TestThread extends Thread {\n         \n         private int holdTime;\n-        \n-        public TestThread() {\n-            this(100);\n+        private LimitLatch latch;\n+\n+        public TestThread(LimitLatch latch) {\n+            this(latch, 100);\n         }\n         \n-        public TestThread(int holdTime) {\n+        public TestThread(LimitLatch latch, int holdTime) {\n+            this.latch = latch;\n             this.holdTime = holdTime;\n         }\n  \n@@ -120,6 +113,8 @@ public void run() {\n                 latch.countUpOrAwait();\n                 Thread.sleep(holdTime);\n                 latch.countDown();\n+            } catch (NullPointerException npe) {\n+                npe.printStackTrace();\n             } catch (InterruptedException x) {\n                 x.printStackTrace();\n             }",
                "raw_url": "https://github.com/apache/tomcat80/raw/0bac6949b2008a3d03d37b1dba13eecd778d5282/test/org/apache/tomcat/util/threads/TestLimitLatch.java",
                "sha": "1c9559604df4cfb9ff78c7230af5204b59de5902",
                "status": "modified"
            }
        ],
        "message": "Refactor to avoid NPEs during test\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1143488 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/bf5c51ee3e6e6b7db667b17aa14a38088f830ce7",
        "patched_files": [
            "LimitLatch.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestLimitLatch.java"
        ]
    },
    "tomcat80_0ec7ef6": {
        "bug_id": "tomcat80_0ec7ef6",
        "commit": "https://github.com/apache/tomcat80/commit/0ec7ef6717eccc88fc14b317db8bb6930db74903",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/0ec7ef6717eccc88fc14b317db8bb6930db74903/java/org/apache/tomcat/util/net/jsse/openssl/OpenSSLCipherConfigurationParser.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/net/jsse/openssl/OpenSSLCipherConfigurationParser.java?ref=0ec7ef6717eccc88fc14b317db8bb6930db74903",
                "deletions": 1,
                "filename": "java/org/apache/tomcat/util/net/jsse/openssl/OpenSSLCipherConfigurationParser.java",
                "patch": "@@ -632,7 +632,7 @@ static void remove(final LinkedHashSet<Cipher> ciphers, final String alias) {\n                 add(ciphers, element);\n             } else if (element.contains(AND)) {\n                 String[] intersections = element.split(\"\\\\\" + AND);\n-                if(intersections.length > 0) {\n+                if(intersections.length > 0 && aliases.containsKey(intersections[0])) {\n                     List<Cipher> result = new ArrayList<>(aliases.get(intersections[0]));\n                     for(int i = 1; i < intersections.length; i++) {\n                         if(aliases.containsKey(intersections[i])) {",
                "raw_url": "https://github.com/apache/tomcat80/raw/0ec7ef6717eccc88fc14b317db8bb6930db74903/java/org/apache/tomcat/util/net/jsse/openssl/OpenSSLCipherConfigurationParser.java",
                "sha": "fb6b257d51b31eae8f90dba8cc230f239df5975c",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/tomcat80/blob/0ec7ef6717eccc88fc14b317db8bb6930db74903/webapps/docs/changelog.xml",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=0ec7ef6717eccc88fc14b317db8bb6930db74903",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -45,6 +45,15 @@\n   issues to not \"pop up\" wrt. others).\n -->\n <section name=\"Tomcat 8.0.12 (markt)\">\n+  <subsection name=\"Coyote\">\n+    <changelog>\n+      <fix>\n+        When building a list of JSSE ciphers from an OpenSSL cipher defintiion,\n+        ignore unknown criteria rather than throwing a\n+        <code>NullPointerException</code>. (markt)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection name=\"Jasper\">\n     <changelog>\n       <fix>",
                "raw_url": "https://github.com/apache/tomcat80/raw/0ec7ef6717eccc88fc14b317db8bb6930db74903/webapps/docs/changelog.xml",
                "sha": "9a0893553c54c2573f9d77500c5781a230d6d3d6",
                "status": "modified"
            }
        ],
        "message": "Avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1619765 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/d506b8acf8612e829284486841e12e4c978977ae",
        "patched_files": [
            "changelog.xml",
            "OpenSSLCipherConfigurationParser.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestOpenSSLCipherConfigurationParser.java"
        ]
    },
    "tomcat80_104d174": {
        "bug_id": "tomcat80_104d174",
        "commit": "https://github.com/apache/tomcat80/commit/104d174591704638510ef47afd61c4d33fc3fc9b",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/104d174591704638510ef47afd61c4d33fc3fc9b/java/org/apache/tomcat/websocket/Util.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/Util.java?ref=104d174591704638510ef47afd61c4d33fc3fc9b",
                "deletions": 0,
                "filename": "java/org/apache/tomcat/websocket/Util.java",
                "patch": "@@ -208,6 +208,10 @@ static CloseCode getCloseCode(int code) {\n         @SuppressWarnings(\"unchecked\")\n         Class<? extends T> superClazz =\n                 (Class<? extends T>) clazz.getSuperclass();\n+        if (superClazz == null) {\n+            // Finished looking up the class hierarchy without finding anything\n+            return null;\n+        }\n \n         TypeResult superClassTypeResult = getGenericType(type, superClazz);\n         int dimension = superClassTypeResult.getDimension();",
                "raw_url": "https://github.com/apache/tomcat80/raw/104d174591704638510ef47afd61c4d33fc3fc9b/java/org/apache/tomcat/websocket/Util.java",
                "sha": "05d5d3d4fe966987a587add5f1f3c5f3e72c72e7",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/104d174591704638510ef47afd61c4d33fc3fc9b/webapps/docs/changelog.xml",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=104d174591704638510ef47afd61c4d33fc3fc9b",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -158,6 +158,10 @@\n         Fix log name typo in <code>WsRemoteEndpointImplServer</code> class,\n         caused by a copy-paste. (markt/kkolinko)\n       </fix>\n+      <fix>\n+        <bug>57788</bug>: Avoid NPE when looking up a class hierarchy without\n+        finding anything. (remm)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Web applications\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/104d174591704638510ef47afd61c4d33fc3fc9b/webapps/docs/changelog.xml",
                "sha": "7212ee92e6fc686c1b3475708ce2cd91edaed9a2",
                "status": "modified"
            }
        ],
        "message": "Merge r1672628\n57788: Avoid NPE if nothing is found after going through the whole class hierarchy.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1672629 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/81ac2d3e66941c3e8bb464a768f8b3054da8e41c",
        "patched_files": [
            "Util.java",
            "changelog.xml"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestUtil.java"
        ]
    },
    "tomcat80_10e7e94": {
        "bug_id": "tomcat80_10e7e94",
        "commit": "https://github.com/apache/tomcat80/commit/10e7e94f8672c35bb72a7480e3ad679094ef02c4",
        "file": [
            {
                "additions": 20,
                "blob_url": "https://github.com/apache/tomcat80/blob/10e7e94f8672c35bb72a7480e3ad679094ef02c4/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/StatementCache.java",
                "changes": 29,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/StatementCache.java?ref=10e7e94f8672c35bb72a7480e3ad679094ef02c4",
                "deletions": 9,
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/StatementCache.java",
                "patch": "@@ -25,6 +25,8 @@\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.atomic.AtomicInteger;\n \n+import org.apache.juli.logging.Log;\n+import org.apache.juli.logging.LogFactory;\n import org.apache.tomcat.jdbc.pool.ConnectionPool;\n import org.apache.tomcat.jdbc.pool.PoolProperties.InterceptorProperty;\n import org.apache.tomcat.jdbc.pool.PooledConnection;\n@@ -34,6 +36,7 @@\n  * {@code CallableStatement} instances on a connection.\n  */\n public class StatementCache extends StatementDecoratorInterceptor {\n+    private static final Log log = LogFactory.getLog(StatementCache.class);\n     protected static final String[] ALL_TYPES = new String[] {PREPARE_STATEMENT,PREPARE_CALL};\n     protected static final String[] CALLABLE_TYPE = new String[] {PREPARE_CALL};\n     protected static final String[] PREPARED_TYPE = new String[] {PREPARE_STATEMENT};\n@@ -198,16 +201,14 @@ public CachedStatement isCached(String sql) {\n     }\n \n     public CachedStatement isCached(Method method, Object[] args) {\n-        @SuppressWarnings(\"unchecked\")\n-        ConcurrentHashMap<CacheKey,CachedStatement> cache =\n-            (ConcurrentHashMap<CacheKey,CachedStatement>)pcon.getAttributes().get(STATEMENT_CACHE_ATTR);\n+        ConcurrentHashMap<CacheKey,CachedStatement> cache = getCache();\n+        if (cache == null) return null;\n         return cache.get(createCacheKey(method, args));\n     }\n \n     public boolean cacheStatement(CachedStatement proxy) {\n-        @SuppressWarnings(\"unchecked\")\n-        ConcurrentHashMap<CacheKey,CachedStatement> cache =\n-            (ConcurrentHashMap<CacheKey,CachedStatement>)pcon.getAttributes().get(STATEMENT_CACHE_ATTR);\n+        ConcurrentHashMap<CacheKey,CachedStatement> cache = getCache();\n+        if (cache == null) return false;\n         if (proxy.getCacheKey()==null) {\n             return false;\n         } else if (cache.containsKey(proxy.getCacheKey())) {\n@@ -225,9 +226,8 @@ public boolean cacheStatement(CachedStatement proxy) {\n     }\n \n     public boolean removeStatement(CachedStatement proxy) {\n-        @SuppressWarnings(\"unchecked\")\n-        ConcurrentHashMap<CacheKey,CachedStatement> cache =\n-            (ConcurrentHashMap<CacheKey,CachedStatement>)pcon.getAttributes().get(STATEMENT_CACHE_ATTR);\n+        ConcurrentHashMap<CacheKey,CachedStatement> cache = getCache();\n+        if (cache == null) return false;\n         if (cache.remove(proxy.getCacheKey()) != null) {\n             cacheSize.decrementAndGet();\n             return true;\n@@ -237,6 +237,17 @@ public boolean removeStatement(CachedStatement proxy) {\n     }\n     /*end the actual statement cache*/\n \n+    protected ConcurrentHashMap<CacheKey,CachedStatement> getCache() {\n+        PooledConnection pCon = this.pcon;\n+        if (pCon == null) {\n+            if (log.isWarnEnabled()) log.warn(\"Connection has already been closed or abandoned\");\n+            return null;\n+        }\n+        @SuppressWarnings(\"unchecked\")\n+        ConcurrentHashMap<CacheKey,CachedStatement> cache =\n+                (ConcurrentHashMap<CacheKey,CachedStatement>)pCon.getAttributes().get(STATEMENT_CACHE_ATTR);\n+        return cache;\n+    }\n \n     protected class CachedStatement extends StatementDecoratorInterceptor.StatementProxy<Statement> {\n         boolean cached = false;",
                "raw_url": "https://github.com/apache/tomcat80/raw/10e7e94f8672c35bb72a7480e3ad679094ef02c4/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/StatementCache.java",
                "sha": "58bd091fb114a835548b03f7bf5343388aceabef",
                "status": "modified"
            },
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/tomcat80/blob/10e7e94f8672c35bb72a7480e3ad679094ef02c4/webapps/docs/changelog.xml",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=10e7e94f8672c35bb72a7480e3ad679094ef02c4",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -128,6 +128,14 @@\n       </add>\n     </changelog>\n   </subsection>\n+  <subsection name=\"jdbc-pool\">\n+    <changelog>\n+      <fix>\n+        <bug>61312</bug>: Prevent <code>NullPointerException</code>n when using\n+        the statement cache of connection that has been closed. (kfujino)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection name=\"Other\">\n     <changelog>\n       <update>",
                "raw_url": "https://github.com/apache/tomcat80/raw/10e7e94f8672c35bb72a7480e3ad679094ef02c4/webapps/docs/changelog.xml",
                "sha": "78e8bd04b1943de07f4c4e0f628f61bfab031ee6",
                "status": "modified"
            }
        ],
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61312\nPrevent NullPointerException when using the statement cache of connection that has been closed.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1820818 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/df1b0ff968f1f03cc661e3837de2eda91bd30c74",
        "patched_files": [
            "changelog.xml",
            "StatementCache.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestStatementCache.java"
        ]
    },
    "tomcat80_12353ac": {
        "bug_id": "tomcat80_12353ac",
        "commit": "https://github.com/apache/tomcat80/commit/12353ac09eeb7db48230474653e9e148817a86a8",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/12353ac09eeb7db48230474653e9e148817a86a8/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/QueryTimeoutInterceptor.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/QueryTimeoutInterceptor.java?ref=12353ac09eeb7db48230474653e9e148817a86a8",
                "deletions": 2,
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/QueryTimeoutInterceptor.java",
                "patch": "@@ -28,12 +28,13 @@\n \n public class QueryTimeoutInterceptor extends AbstractCreateStatementInterceptor {\n     private static Log log = LogFactory.getLog(QueryTimeoutInterceptor.class);\n-    int timeout;\n+    int timeout = 1;\n \n     @Override\n     public void setProperties(Map<String,InterceptorProperty> properties) {\n         super.setProperties(properties);\n-        timeout = properties.get(\"queryTimeout\").getValueAsInt(-1);\n+        InterceptorProperty p = properties.get(\"queryTimeout\");\n+        if (p!=null) timeout = p.getValueAsInt(timeout);\n     }\n \n     @Override",
                "raw_url": "https://github.com/apache/tomcat80/raw/12353ac09eeb7db48230474653e9e148817a86a8/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/QueryTimeoutInterceptor.java",
                "sha": "3d35cb6eb384218a86fdc7d5567d1e9c7bd1dd2d",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/12353ac09eeb7db48230474653e9e148817a86a8/webapps/docs/changelog.xml",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=12353ac09eeb7db48230474653e9e148817a86a8",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -121,6 +121,9 @@\n         of <code>SlowQueryReport</code> is changed to <code>false</code> so that\n         the failed queries are not logged by default. (kfujino)\n       </fix>\n+      <fix>\n+        Fix potential NPE in <code>QueryTimeoutInterceptor</code>. (kfujino)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Other\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/12353ac09eeb7db48230474653e9e148817a86a8/webapps/docs/changelog.xml",
                "sha": "0cd49923e78add0138af9ee85c72944d380f6cac",
                "status": "modified"
            }
        ],
        "message": "Fix potential NPE in QueryTimeoutInterceptor.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1692056 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/3a5c868535418ef954656366610df2d69d630d7b",
        "patched_files": [
            "QueryTimeoutInterceptor.java",
            "changelog.xml"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestQueryTimeoutInterceptor.java"
        ]
    },
    "tomcat80_1303e33": {
        "bug_id": "tomcat80_1303e33",
        "commit": "https://github.com/apache/tomcat80/commit/1303e336c1ba34a1b82374347483a2c5fe4221e9",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/1303e336c1ba34a1b82374347483a2c5fe4221e9/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java?ref=1303e336c1ba34a1b82374347483a2c5fe4221e9",
                "deletions": 1,
                "filename": "java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "patch": "@@ -553,7 +553,7 @@ public MessageHandlerInfo(Method m, List<DecoderEntry> decoderEntries) {\n                             m, session, config, null, params, indexInputStream,\n                             true, indexSession, true, maxMessageSize);\n                     results.add(mh);\n-                } else if (decoderMatch.hasMatches()) {\n+                } else if (decoderMatch != null && decoderMatch.hasMatches()) {\n                     if (decoderMatch.getBinaryDecoders().size() > 0) {\n                         MessageHandler mh = new PojoMessageHandlerWholeBinary(\n                                 pojo, m, session, config,",
                "raw_url": "https://github.com/apache/tomcat80/raw/1303e336c1ba34a1b82374347483a2c5fe4221e9/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "sha": "9ade75aa3ec7057f38640c99ebd460349b8b202b",
                "status": "modified"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55184\nAvoid NPE.\nPatch provided by Niki Dokovski.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1499011 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/753e52c1fc82230138c475ebe9345d0601760810",
        "patched_files": [
            "PojoMethodMapping.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestPojoMethodMapping.java"
        ]
    },
    "tomcat80_18f3157": {
        "bug_id": "tomcat80_18f3157",
        "commit": "https://github.com/apache/tomcat80/commit/18f315750c375c12f1a75d55f867d39ddb9ade57",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/18f315750c375c12f1a75d55f867d39ddb9ade57/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java?ref=18f315750c375c12f1a75d55f867d39ddb9ade57",
                "deletions": 1,
                "filename": "java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "patch": "@@ -375,7 +375,7 @@ public MessageHandlerInfo(Method m, List<DecoderEntry> decoderEntries) {\n                                 m.getName(), m.getDeclaringClass().getName()));\n                     }\n                 } else {\n-                    if (decoderMatch != null || decoderMatch.hasMatches()) {\n+                    if (decoderMatch != null && decoderMatch.hasMatches()) {\n                         throw new IllegalArgumentException(sm.getString(\n                                 \"pojoMethodMapping.duplicateMessageParam\",\n                                 m.getName(), m.getDeclaringClass().getName()));",
                "raw_url": "https://github.com/apache/tomcat80/raw/18f315750c375c12f1a75d55f867d39ddb9ade57/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "sha": "6729ff22c7c902819b4fcad35e686cb9cf952c4d",
                "status": "modified"
            }
        ],
        "message": "Fix logic error that triggered an NPE and associated test failures\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1497308 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/a67468d744261b0b635b46ec5bd91237efa423ac",
        "patched_files": [
            "PojoMethodMapping.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestPojoMethodMapping.java"
        ]
    },
    "tomcat80_208c18d": {
        "bug_id": "tomcat80_208c18d",
        "commit": "https://github.com/apache/tomcat80/commit/208c18d4e6c980fe5b6676a93e2cac3a13a2ebec",
        "file": [
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tomcat80/blob/208c18d4e6c980fe5b6676a93e2cac3a13a2ebec/java/org/apache/catalina/core/StandardContext.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/StandardContext.java?ref=208c18d4e6c980fe5b6676a93e2cac3a13a2ebec",
                "deletions": 3,
                "filename": "java/org/apache/catalina/core/StandardContext.java",
                "patch": "@@ -1760,9 +1760,13 @@ public void setNamingResources(NamingResources namingResources) {\n         support.firePropertyChange(\"namingResources\",\n                                    oldNamingResources, this.namingResources);\n         \n-        unregister(onameNamingResources);\n-        onameNamingResources = register(namingResources,\n-                \"type=NamingResources,\" + getObjectKeyPropertiesNameOnly());\n+        // If set from server.xml, getObjectKeyPropertiesNameOnly() will\n+        // trigger an NPE. Initial registration takes place on INIT. \n+        if (getState() != LifecycleState.NEW) {\n+            unregister(onameNamingResources);\n+            onameNamingResources = register(namingResources,\n+                    \"type=NamingResources,\" + getObjectKeyPropertiesNameOnly());\n+        }\n     }\n \n ",
                "raw_url": "https://github.com/apache/tomcat80/raw/208c18d4e6c980fe5b6676a93e2cac3a13a2ebec/java/org/apache/catalina/core/StandardContext.java",
                "sha": "e810ebf38dba7291a070d21b9eac83438571cf5e",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/208c18d4e6c980fe5b6676a93e2cac3a13a2ebec/webapps/docs/changelog.xml",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=208c18d4e6c980fe5b6676a93e2cac3a13a2ebec",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -103,6 +103,10 @@\n         <bug>50017</bug>: Code clean-up. No functional change. Patch provided by\n         sebb. (markt)\n       </update>\n+      <fix>\n+        <bug>50027</bug>: Avoid NPE on start when a Context is defined in\n+        server.xml with one or more JNDI resources. (markt)\n+      </fix>\n       <fix>\n         <bug>50059</bug>: JARs should always be searched for static resources\n         even if the web application is marked as meta-data complete. (markt)",
                "raw_url": "https://github.com/apache/tomcat80/raw/208c18d4e6c980fe5b6676a93e2cac3a13a2ebec/webapps/docs/changelog.xml",
                "sha": "9175867b56af57c14d57ae5d8a1b9d882f578dc3",
                "status": "modified"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50027\nAvoid NPE on start when a Context is defined in server.xml with one or more JNDI resources.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1006037 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/1525c85670ba7033c3d6272896334eb47bf1fd2d",
        "patched_files": [
            "StandardContext.java",
            "changelog.xml"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestStandardContext.java"
        ]
    },
    "tomcat80_283a305": {
        "bug_id": "tomcat80_283a305",
        "commit": "https://github.com/apache/tomcat80/commit/283a30571cdd6a4499052f6b9e667d351e314bf1",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tomcat80/blob/283a30571cdd6a4499052f6b9e667d351e314bf1/java/org/apache/jasper/compiler/Compiler.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/Compiler.java?ref=283a30571cdd6a4499052f6b9e667d351e314bf1",
                "deletions": 4,
                "filename": "java/org/apache/jasper/compiler/Compiler.java",
                "patch": "@@ -255,10 +255,12 @@ public void init(JspCompilationContext ctxt, JspServletWrapper jsw) {\n             // to be GC'd and save memory.\n             ctxt.setWriter(null);\n \n-            // Need to know if the JSP is an error page at runtime to determine\n-            // which HTTP methods are permitted. Error pages permit any. Normal\n-            // pages only permit GET, POST or HEAD.\n-            jsw.setErrorPage(pageInfo.isErrorPage());\n+            if (jsw != null) {\n+                // Need to know if the JSP is an error page at runtime to determine\n+                // which HTTP methods are permitted. Error pages permit any. Normal\n+                // pages only permit GET, POST or HEAD.\n+                jsw.setErrorPage(pageInfo.isErrorPage());\n+            }\n \n             if (log.isDebugEnabled()) {\n                 t4 = System.currentTimeMillis();",
                "raw_url": "https://github.com/apache/tomcat80/raw/283a30571cdd6a4499052f6b9e667d351e314bf1/java/org/apache/jasper/compiler/Compiler.java",
                "sha": "6d2182273ea420c83c5977ecf890f681c346a046",
                "status": "modified"
            }
        ],
        "message": "Avoid NPE when using JspC\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1620822 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/bfc7550283277ad20b347dd94f85abbc3e578059",
        "patched_files": [
            "Compiler.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestCompiler.java"
        ]
    },
    "tomcat80_29aa284": {
        "bug_id": "tomcat80_29aa284",
        "commit": "https://github.com/apache/tomcat80/commit/29aa2849e35b29cf2334aeeb984c330287b3c737",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/29aa2849e35b29cf2334aeeb984c330287b3c737/test/org/apache/catalina/core/TestDefaultInstanceManager.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/core/TestDefaultInstanceManager.java?ref=29aa2849e35b29cf2334aeeb984c330287b3c737",
                "deletions": 0,
                "filename": "test/org/apache/catalina/core/TestDefaultInstanceManager.java",
                "patch": "@@ -24,6 +24,7 @@\n import org.apache.catalina.Wrapper;\n import org.apache.catalina.startup.Tomcat;\n import org.apache.catalina.startup.TomcatBaseTest;\n+import org.apache.jasper.servlet.JasperInitializer;\n \n \n public class TestDefaultInstanceManager extends TomcatBaseTest {\n@@ -73,6 +74,8 @@ private DefaultInstanceManager doClassUnloadingPrep() throws Exception {\n         StandardContext ctxt = (StandardContext) tomcat.addContext(\n                 null, \"/test\", appDir.getAbsolutePath());\n \n+        ctxt.addServletContainerInitializer(new JasperInitializer(), null);\n+\n         // Configure the defaults and then tweak the JSP servlet settings\n         // Note: Min value for maxLoadedJsps is 2\n         Tomcat.initWebappDefaults(ctxt);",
                "raw_url": "https://github.com/apache/tomcat80/raw/29aa2849e35b29cf2334aeeb984c330287b3c737/test/org/apache/catalina/core/TestDefaultInstanceManager.java",
                "sha": "c5c37b6376fec08c89c58bcf49f21cfec0c3cefc",
                "status": "modified"
            }
        ],
        "message": "Fix NPEs in test\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1553605 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/6b9081da8a4dca82c749cbeaae9e035e72c55714",
        "patched_files": [
            "DefaultInstanceManager.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestDefaultInstanceManager.java"
        ]
    },
    "tomcat80_2d13074": {
        "bug_id": "tomcat80_2d13074",
        "commit": "https://github.com/apache/tomcat80/commit/2d13074fe9080148395447aee5c26bb1266e6f56",
        "file": [
            {
                "additions": 31,
                "blob_url": "https://github.com/apache/tomcat80/blob/2d13074fe9080148395447aee5c26bb1266e6f56/java/org/apache/catalina/core/AsyncContextImpl.java",
                "changes": 35,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/AsyncContextImpl.java?ref=2d13074fe9080148395447aee5c26bb1266e6f56",
                "deletions": 4,
                "filename": "java/org/apache/catalina/core/AsyncContextImpl.java",
                "patch": "@@ -48,6 +48,7 @@\n import org.apache.juli.logging.Log;\n import org.apache.juli.logging.LogFactory;\n import org.apache.tomcat.InstanceManager;\n+import org.apache.tomcat.util.res.StringManager;\n /**\n  * \n  * @author fhanik\n@@ -57,6 +58,9 @@\n     \n     private static final Log log = LogFactory.getLog(AsyncContextImpl.class);\n     \n+    protected static final StringManager sm =\n+        StringManager.getManager(Constants.Package);\n+\n     private ServletRequest servletRequest = null;\n     private ServletResponse servletResponse = null;\n     private List<AsyncListenerWrapper> listeners = new ArrayList<AsyncListenerWrapper>();\n@@ -80,6 +84,7 @@ public void complete() {\n         if (log.isDebugEnabled()) {\n             logDebug(\"complete   \");\n         }\n+        check();\n         request.getCoyoteRequest().action(ActionCode.COMMIT, null);\n         request.getCoyoteRequest().action(ActionCode.ASYNC_COMPLETE, null);\n     }\n@@ -126,6 +131,7 @@ public boolean timeout() throws IOException {\n \n     @Override\n     public void dispatch() {\n+        check();\n         HttpServletRequest sr = (HttpServletRequest)getRequest();\n         String path = sr.getRequestURI();\n         String cpath = sr.getContextPath();\n@@ -135,6 +141,7 @@ public void dispatch() {\n \n     @Override\n     public void dispatch(String path) {\n+        check();\n         dispatch(request.getServletContext(),path);\n     }\n \n@@ -143,6 +150,7 @@ public void dispatch(ServletContext context, String path) {\n         if (log.isDebugEnabled()) {\n             logDebug(\"dispatch   \");\n         }\n+        check();\n         if (request.getAttribute(ASYNC_REQUEST_URI)==null) {\n             request.setAttribute(ASYNC_REQUEST_URI, request.getRequestURI()+\"?\"+request.getQueryString());\n             request.setAttribute(ASYNC_CONTEXT_PATH, request.getContextPath());\n@@ -178,11 +186,13 @@ public void run() {\n \n     @Override\n     public ServletRequest getRequest() {\n+        check();\n         return servletRequest;\n     }\n \n     @Override\n     public ServletResponse getResponse() {\n+        check();\n         return servletResponse;\n     }\n \n@@ -191,13 +201,14 @@ public void start(final Runnable run) {\n         if (log.isDebugEnabled()) {\n             logDebug(\"start      \");\n         }\n-\n+        check();\n         Runnable wrapper = new RunnableWrapper(run, context);\n         this.request.getCoyoteRequest().action(ActionCode.ASYNC_RUN, wrapper);\n     }\n     \n     @Override\n     public void addListener(AsyncListener listener) {\n+        check();\n         AsyncListenerWrapper wrapper = new AsyncListenerWrapper();\n         wrapper.setListener(listener);\n         listeners.add(wrapper);\n@@ -206,6 +217,7 @@ public void addListener(AsyncListener listener) {\n     @Override\n     public void addListener(AsyncListener listener, ServletRequest servletRequest,\n             ServletResponse servletResponse) {\n+        check();\n         AsyncListenerWrapper wrapper = new AsyncListenerWrapper();\n         wrapper.setListener(listener);\n         listeners.add(wrapper);\n@@ -215,6 +227,7 @@ public void addListener(AsyncListener listener, ServletRequest servletRequest,\n     @Override\n     public <T extends AsyncListener> T createListener(Class<T> clazz)\n             throws ServletException {\n+        check();\n         T listener = null;\n         try {\n              listener = (T) getInstanceManager().newInstance(clazz.getName(),\n@@ -242,12 +255,16 @@ public void recycle() {\n         if (log.isDebugEnabled()) {\n             logDebug(\"recycle    \");\n         }\n+        context = null;\n+        dispatch = null;\n+        event = null;\n+        hasOriginalRequestAndResponse = true;\n+        instanceManager = null;\n+        listeners.clear();\n+        request = null;\n         servletRequest = null;\n         servletResponse = null;\n-        hasOriginalRequestAndResponse = true;\n-        context = null;\n         timeout = -1;\n-        event = null;\n     }\n \n     public boolean isStarted() {\n@@ -285,6 +302,7 @@ public void setStarted(Context context, ServletRequest request,\n \n     @Override\n     public boolean hasOriginalRequestAndResponse() {\n+        check();\n         return hasOriginalRequestAndResponse;\n     }\n \n@@ -309,12 +327,14 @@ protected void doInternalDispatch() throws ServletException, IOException {\n     \n     @Override\n     public long getTimeout() {\n+        check();\n         return timeout;\n     }\n \n \n     @Override\n     public void setTimeout(long timeout) {\n+        check();\n         this.timeout = timeout;\n         request.getCoyoteRequest().action(ActionCode.ASYNC_SETTIMEOUT,\n                 Long.valueOf(timeout));\n@@ -407,6 +427,13 @@ private InstanceManager getInstanceManager() {\n         return instanceManager;\n     }\n \n+    private void check() {\n+        if (request == null) {\n+            // AsyncContext has been recycled and should not be being used\n+            throw new IllegalStateException(sm.getString(\n+                    \"asyncContextImpl.requestEnded\"));\n+        }\n+    }\n     private static class DebugException extends Exception {\n         private static final long serialVersionUID = 1L;\n     }",
                "raw_url": "https://github.com/apache/tomcat80/raw/2d13074fe9080148395447aee5c26bb1266e6f56/java/org/apache/catalina/core/AsyncContextImpl.java",
                "sha": "2e6d6e0ca33eb2b9d77e6d8340e97788d2b1e188",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/2d13074fe9080148395447aee5c26bb1266e6f56/java/org/apache/catalina/core/LocalStrings.properties",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/LocalStrings.properties?ref=2d13074fe9080148395447aee5c26bb1266e6f56",
                "deletions": 0,
                "filename": "java/org/apache/catalina/core/LocalStrings.properties",
                "patch": "@@ -59,6 +59,7 @@ aprListener.aprDestroy=Failed shutdown of APR based Apache Tomcat Native library\n aprListener.sslInit=Failed to initialize the SSLEngine.\n aprListener.tcnValid=Loaded APR based Apache Tomcat Native library {0}.\n aprListener.flags=APR capabilities: IPv6 [{0}], sendfile [{1}], accept filters [{2}], random [{3}].\n+asyncContextImpl.requestEnded=The request associated with the AsyncContext has already completed processing.\n containerBase.alreadyStarted=Container {0} has already been started\n containerBase.notConfigured=No basic Valve has been configured\n containerBase.notStarted=Container {0} has not been started",
                "raw_url": "https://github.com/apache/tomcat80/raw/2d13074fe9080148395447aee5c26bb1266e6f56/java/org/apache/catalina/core/LocalStrings.properties",
                "sha": "f49e83198edb8ca1d7ceb9a96a9fdd053804ec61",
                "status": "modified"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50353\nRather than the eventual NPE, throw an ISE if an application attempts to access an AsyncContext after the request processing has ended.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1140738 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/c616e9e1211ddaff0e72a1de06fdd885de6beb4c",
        "patched_files": [
            "LocalStrings.properties",
            "AsyncContextImpl.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestAsyncContextImpl.java"
        ]
    },
    "tomcat80_2df2b2d": {
        "bug_id": "tomcat80_2df2b2d",
        "commit": "https://github.com/apache/tomcat80/commit/2df2b2d7fd7b652cee7c4428154bf387c2702bbf",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tomcat80/blob/2df2b2d7fd7b652cee7c4428154bf387c2702bbf/java/org/apache/catalina/connector/Request.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/Request.java?ref=2df2b2d7fd7b652cee7c4428154bf387c2702bbf",
                "deletions": 1,
                "filename": "java/org/apache/catalina/connector/Request.java",
                "patch": "@@ -2818,7 +2818,9 @@ protected void parseParameters() {\n                 }\n                 return;\n             }\n-            parameters.processParameters(formData, 0, formData.length);\n+            if (formData != null) {\n+                parameters.processParameters(formData, 0, formData.length);\n+            }\n         }\n \n     }\n@@ -2864,6 +2866,9 @@ protected int readPostBody(byte body[], int len)\n                 body.append(buffer, 0, len);\n             }\n         }\n+        if (body.getLength() == 0) {\n+            return null;\n+        }\n         if (body.getLength() < body.getBuffer().length) {\n             int length = body.getLength();\n             byte[] result = new byte[length];",
                "raw_url": "https://github.com/apache/tomcat80/raw/2df2b2d7fd7b652cee7c4428154bf387c2702bbf/java/org/apache/catalina/connector/Request.java",
                "sha": "4ed0f6061b2c98e1652c71ea421b901c561a4adc",
                "status": "modified"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49424\nAvoid NPE if no input data is provided in a chunked POST request\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@953434 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/2b9ee088b2eeb182bfabe9ad9b680f2e2d98a9d9",
        "patched_files": [
            "Request.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestRequest.java"
        ]
    },
    "tomcat80_2e793b3": {
        "bug_id": "tomcat80_2e793b3",
        "commit": "https://github.com/apache/tomcat80/commit/2e793b3151fda0e67e19cca835a225887073f69e",
        "file": [
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/tomcat80/blob/2e793b3151fda0e67e19cca835a225887073f69e/test/org/apache/catalina/valves/TestRemoteIpValve.java",
                "changes": 31,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/valves/TestRemoteIpValve.java?ref=2e793b3151fda0e67e19cca835a225887073f69e",
                "deletions": 12,
                "filename": "test/org/apache/catalina/valves/TestRemoteIpValve.java",
                "patch": "@@ -70,7 +70,14 @@ public void invoke(Request request, Response response) throws IOException, Servl\n             this.serverPort = request.getServerPort();\n         }\n     }\n-    \n+\n+    public static class MockRequest extends Request {\n+        @Override\n+        public void setAttribute(String name, Object value) {\n+            // NOOP. Prevents NPE during testing.\n+        }\n+    }\n+\n     public void testListToCommaDelimitedString() {\n         List<String> elements = Arrays.asList(\"element1\", \"element2\", \"element3\");\n         String actual = RemoteIpValve.listToCommaDelimitedString(elements);\n@@ -98,7 +105,7 @@ public void testInvokeAllowedRemoteAddrWithNullRemoteIpHeader() throws Exception\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         request.setRemoteAddr(\"192.168.0.10\");\n         request.setRemoteHost(\"remote-host-original-value\");\n@@ -138,7 +145,7 @@ public void testInvokeAllProxiesAreTrusted() throws Exception {\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         request.setRemoteAddr(\"192.168.0.10\");\n         request.setRemoteHost(\"remote-host-original-value\");\n@@ -178,7 +185,7 @@ public void testInvokeAllProxiesAreTrustedOrInternal() throws Exception {\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         request.setRemoteAddr(\"192.168.0.10\");\n         request.setRemoteHost(\"remote-host-original-value\");\n@@ -219,7 +226,7 @@ public void testInvokeAllProxiesAreInternal() throws Exception {\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         request.setRemoteAddr(\"192.168.0.10\");\n         request.setRemoteHost(\"remote-host-original-value\");\n@@ -259,7 +266,7 @@ public void testInvokeAllProxiesAreTrustedAndRemoteAddrMatchRegexp() throws Exce\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         request.setRemoteAddr(\"192.168.0.10\");\n         request.setRemoteHost(\"remote-host-original-value\");\n@@ -299,7 +306,7 @@ public void testInvokeXforwardedProtoSaysHttpsForIncomingHttpRequest() throws Ex\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         // client ip\n         request.setRemoteAddr(\"192.168.0.10\");\n@@ -363,7 +370,7 @@ public void testInvokeXforwardedProtoIsNullForIncomingHttpRequest() throws Excep\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         // client ip\n         request.setRemoteAddr(\"192.168.0.10\");\n@@ -427,7 +434,7 @@ public void testInvokeXforwardedProtoSaysHttpForIncomingHttpsRequest() throws Ex\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         // client ip\n         request.setRemoteAddr(\"192.168.0.10\");\n@@ -491,7 +498,7 @@ public void testInvokeXforwardedProtoIsNullForIncomingHttpsRequest() throws Exce\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         // client ip\n         request.setRemoteAddr(\"192.168.0.10\");\n@@ -556,7 +563,7 @@ public void testInvokeNotAllowedRemoteAddr() throws Exception {\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         request.setRemoteAddr(\"not-allowed-internal-proxy\");\n         request.setRemoteHost(\"not-allowed-internal-proxy-host\");\n@@ -595,7 +602,7 @@ public void testInvokeUntrustedProxyInTheChain() throws Exception {\n         RemoteAddrAndHostTrackerValve remoteAddrAndHostTrackerValve = new RemoteAddrAndHostTrackerValve();\n         remoteIpValve.setNext(remoteAddrAndHostTrackerValve);\n         \n-        Request request = new Request();\n+        Request request = new MockRequest();\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n         request.setRemoteAddr(\"192.168.0.10\");\n         request.setRemoteHost(\"remote-host-original-value\");",
                "raw_url": "https://github.com/apache/tomcat80/raw/2e793b3151fda0e67e19cca835a225887073f69e/test/org/apache/catalina/valves/TestRemoteIpValve.java",
                "sha": "13812533fe71d2e464b1fe4275c5a7af6b37448d",
                "status": "modified"
            }
        ],
        "message": "Prevent NPE in unit tests as a result of r1067718\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1071559 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/e30f94e3d0e263dfae4d4801b8340cdbb22e34b2",
        "patched_files": [
            "RemoteIpValve.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestRemoteIpValve.java"
        ]
    },
    "tomcat80_3225c19": {
        "bug_id": "tomcat80_3225c19",
        "commit": "https://github.com/apache/tomcat80/commit/3225c197cc032b9a143f89999354a71fe943a65d",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tomcat80/blob/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/Util.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/Util.java?ref=3225c197cc032b9a143f89999354a71fe943a65d",
                "deletions": 4,
                "filename": "java/org/apache/tomcat/websocket/Util.java",
                "patch": "@@ -332,7 +332,7 @@ public static Object coerceToType(Class<?> type, String value) {\n \n \n     public static List<DecoderEntry> getDecoders(\n-            Class<? extends Decoder>[] decoderClazzes)\n+            List<Class<? extends Decoder>> decoderClazzes)\n                     throws DeploymentException{\n \n         List<DecoderEntry> result = new ArrayList<>();\n@@ -465,9 +465,7 @@ private static DecoderMatch matchDecoders(Class<?> target,\n         try {\n             List<Class<? extends Decoder>> decoders =\n                     endpointConfig.getDecoders();\n-            @SuppressWarnings(\"unchecked\")\n-            List<DecoderEntry> decoderEntries = getDecoders(\n-                    decoders.toArray(new Class[decoders.size()]));\n+            List<DecoderEntry> decoderEntries = getDecoders(decoders);\n             decoderMatch = new DecoderMatch(target, decoderEntries);\n         } catch (DeploymentException e) {\n             throw new IllegalArgumentException(e);",
                "raw_url": "https://github.com/apache/tomcat80/raw/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/Util.java",
                "sha": "0288868ad432a7a0bc4e47cfb2df26ad2ebbee85",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsWebSocketContainer.java?ref=3225c197cc032b9a143f89999354a71fe943a65d",
                "deletions": 1,
                "filename": "java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "patch": "@@ -140,7 +140,7 @@ public Session connectToServer(Object pojo, URI path)\n                             pojo.getClass().getName()));\n         }\n \n-        Endpoint ep = new PojoEndpointClient(pojo, annotation.decoders());\n+        Endpoint ep = new PojoEndpointClient(pojo, Arrays.asList(annotation.decoders()));\n \n         Class<? extends ClientEndpointConfig.Configurator> configuratorClazz =\n                 annotation.configurator();",
                "raw_url": "https://github.com/apache/tomcat80/raw/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "sha": "53058e74f38d1c75842fd1794a5e042be89b2641",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tomcat80/blob/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/pojo/PojoEndpointClient.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/pojo/PojoEndpointClient.java?ref=3225c197cc032b9a143f89999354a71fe943a65d",
                "deletions": 1,
                "filename": "java/org/apache/tomcat/websocket/pojo/PojoEndpointClient.java",
                "patch": "@@ -17,6 +17,7 @@\n package org.apache.tomcat.websocket.pojo;\n \n import java.util.Collections;\n+import java.util.List;\n \n import javax.websocket.Decoder;\n import javax.websocket.DeploymentException;\n@@ -32,7 +33,7 @@\n public class PojoEndpointClient extends PojoEndpointBase {\n \n     public PojoEndpointClient(Object pojo,\n-            Class<? extends Decoder>[] decoders) throws DeploymentException {\n+            List<Class<? extends Decoder>> decoders) throws DeploymentException {\n         setPojo(pojo);\n         setMethodMapping(\n                 new PojoMethodMapping(pojo.getClass(), decoders, null));",
                "raw_url": "https://github.com/apache/tomcat80/raw/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/pojo/PojoEndpointClient.java",
                "sha": "f4d0567a3b1dd23c78a6ac1e1e6204ad2c38569c",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java?ref=3225c197cc032b9a143f89999354a71fe943a65d",
                "deletions": 1,
                "filename": "java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "patch": "@@ -71,7 +71,7 @@\n \n \n     public PojoMethodMapping(Class<?> clazzPojo,\n-            Class<? extends Decoder>[] decoderClazzes, String wsPath)\n+            List<Class<? extends Decoder>> decoderClazzes, String wsPath)\n                     throws DeploymentException {\n \n         this.wsPath = wsPath;",
                "raw_url": "https://github.com/apache/tomcat80/raw/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java",
                "sha": "d6f8cc0303739e3c1ba6d26f19db50329f2fcf06",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tomcat80/blob/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/server/WsServerContainer.java?ref=3225c197cc032b9a143f89999354a71fe943a65d",
                "deletions": 7,
                "filename": "java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "patch": "@@ -184,6 +184,13 @@ public void addEndpoint(ServerEndpointConfig sec)\n         }\n         String path = sec.getPath();\n \n+        // Add method mapping to user properties\n+        PojoMethodMapping methodMapping = new PojoMethodMapping(sec.getEndpointClass(),\n+                sec.getDecoders(), path);\n+        sec.getUserProperties().put(\n+                PojoEndpointServer.POJO_METHOD_MAPPING_KEY,\n+                methodMapping);\n+\n         UriTemplate uriTemplate = new UriTemplate(path);\n         if (uriTemplate.hasParameters()) {\n             Integer key = Integer.valueOf(uriTemplate.getSegmentCount());\n@@ -241,10 +248,6 @@ public void addEndpoint(Class<?> pojo) throws DeploymentException {\n         // Validate encoders\n         validateEncoders(annotation.encoders());\n \n-        // Method mapping\n-        PojoMethodMapping methodMapping = new PojoMethodMapping(pojo,\n-                annotation.decoders(), path);\n-\n         // ServerEndpointConfig\n         ServerEndpointConfig sec;\n         Class<? extends Configurator> configuratorClazz =\n@@ -266,9 +269,6 @@ public void addEndpoint(Class<?> pojo) throws DeploymentException {\n                 subprotocols(Arrays.asList(annotation.subprotocols())).\n                 configurator(configurator).\n                 build();\n-        sec.getUserProperties().put(\n-                PojoEndpointServer.POJO_METHOD_MAPPING_KEY,\n-                methodMapping);\n \n         addEndpoint(sec);\n     }",
                "raw_url": "https://github.com/apache/tomcat80/raw/3225c197cc032b9a143f89999354a71fe943a65d/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "sha": "9e578d52eea0826f81b69dca17f7a9789417613a",
                "status": "modified"
            },
            {
                "additions": 47,
                "blob_url": "https://github.com/apache/tomcat80/blob/3225c197cc032b9a143f89999354a71fe943a65d/test/org/apache/tomcat/websocket/server/TestWsServerContainer.java",
                "changes": 47,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/tomcat/websocket/server/TestWsServerContainer.java?ref=3225c197cc032b9a143f89999354a71fe943a65d",
                "deletions": 0,
                "filename": "test/org/apache/tomcat/websocket/server/TestWsServerContainer.java",
                "patch": "@@ -16,8 +16,16 @@\n  */\n package org.apache.tomcat.websocket.server;\n \n+import java.net.URI;\n+import java.util.Queue;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n import javax.servlet.ServletContextEvent;\n+import javax.websocket.ContainerProvider;\n import javax.websocket.DeploymentException;\n+import javax.websocket.Session;\n+import javax.websocket.WebSocketContainer;\n import javax.websocket.server.ServerContainer;\n import javax.websocket.server.ServerEndpointConfig;\n \n@@ -31,6 +39,8 @@\n import org.apache.catalina.startup.Tomcat;\n import org.apache.catalina.startup.TomcatBaseTest;\n import org.apache.tomcat.websocket.TesterEchoServer;\n+import org.apache.tomcat.websocket.TesterMessageCountClient.BasicText;\n+import org.apache.tomcat.websocket.pojo.TesterUtil.SimpleClient;\n \n \n public class TestWsServerContainer extends TomcatBaseTest {\n@@ -50,6 +60,43 @@ public void testBug54807() throws Exception {\n     }\n \n \n+    @Test\n+    public void testBug58232() throws Exception {\n+        Tomcat tomcat = getTomcatInstance();\n+        // No file system docBase required\n+        Context ctx = tomcat.addContext(\"\", null);\n+        ctx.addApplicationListener(Bug54807Config.class.getName());\n+        Tomcat.addServlet(ctx, \"default\", new DefaultServlet());\n+        ctx.addServletMapping(\"/\", \"default\");\n+\n+        WebSocketContainer wsContainer =\n+                ContainerProvider.getWebSocketContainer();\n+\n+        tomcat.start();\n+\n+        Assert.assertEquals(LifecycleState.STARTED, ctx.getState());\n+\n+        SimpleClient client = new SimpleClient();\n+        URI uri = new URI(\"ws://localhost:\" + getPort() + \"/echoBasic\");\n+\n+        try (Session session = wsContainer.connectToServer(client, uri);) {\n+            CountDownLatch latch = new CountDownLatch(1);\n+            BasicText handler = new BasicText(latch);\n+            session.addMessageHandler(handler);\n+            session.getBasicRemote().sendText(\"echoBasic\");\n+\n+            boolean latchResult = handler.getLatch().await(10, TimeUnit.SECONDS);\n+            Assert.assertTrue(latchResult);\n+\n+            Queue<String> messages = handler.getMessages();\n+            Assert.assertEquals(1, messages.size());\n+            for (String message : messages) {\n+                Assert.assertEquals(\"echoBasic\", message);\n+            }\n+        }\n+    }\n+\n+\n     public static class Bug54807Config extends WsContextListener {\n \n         @Override",
                "raw_url": "https://github.com/apache/tomcat80/raw/3225c197cc032b9a143f89999354a71fe943a65d/test/org/apache/tomcat/websocket/server/TestWsServerContainer.java",
                "sha": "558c70a9523f1b2d9a0a792c97680e6029ff8b26",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/tomcat80/blob/3225c197cc032b9a143f89999354a71fe943a65d/webapps/docs/changelog.xml",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=3225c197cc032b9a143f89999354a71fe943a65d",
                "deletions": 3,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -103,7 +103,7 @@\n       <fix>\n         <bug>58192</bug>: Correct a regression in the previous fix for\n         <bug>58023</bug>. Ensure that classes are associated with their manifest\n-        even if the class file is frist read (and cached) without the manifest.\n+        even if the class file is first read (and cached) without the manifest.\n         (markt)\n       </fix>\n       <fix>\n@@ -123,7 +123,7 @@\n         <bug>58230</bug>: Fix input stream corruption if non-blocking I/O is\n         used and the first read is made immediately after the switch to async\n         mode rather than in response to <code>onDataAvaiable()</code> and that\n-        read does not read all the avaiable data. (markt)\n+        read does not read all the available data. (markt)\n       </fix>\n     </changelog>\n   </subsection>\n@@ -173,7 +173,7 @@\n       </fix>\n       <fix>\n         Following on from the fix for <bug>58178</bug>, expressions in a tag\n-        file should use the tag file&apos;s improts rather than those of the\n+        file should use the tag file&apos;s imports rather than those of the\n         containing page. (markt)\n       </fix>\n     </changelog>\n@@ -184,6 +184,12 @@\n         <bug>58166</bug>: Allow applications to send close codes in the range\n         3000-4999 inclusive. (markt)\n       </fix>\n+      <fix>\n+        <bug>58232</bug>: Avoid possible NPE when adding endpoints\n+        programmatically to the\n+        <code>javax.websocket.server.ServerContainer</code>.\n+        Based on a patch provided by bastian.(violetagg)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Web applications\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/3225c197cc032b9a143f89999354a71fe943a65d/webapps/docs/changelog.xml",
                "sha": "5cae80c0781bbd53f012a575a2fbe1fcf26bdcf7",
                "status": "modified"
            }
        ],
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58232\nMerged revision 1695706 from tomcat/trunk:\nWhen ServerEndpointConfig is added programatically and the endpoint class that it provides is annotated, NPE is thrown while initializing HTTP upgrade handler. Based on a patch provided by bastian at diqube dot org\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1695721 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/ac1f1cbb4f3b79f1c7339be571fb140578a4a1bd",
        "patched_files": [
            "WsWebSocketContainer.java",
            "PojoMethodMapping.java",
            "Util.java",
            "PojoEndpointClient.java",
            "changelog.xml",
            "WsServerContainer.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestUtil.java",
            "TestPojoMethodMapping.java",
            "TestWsServerContainer.java",
            "TestWsWebSocketContainer.java"
        ]
    },
    "tomcat80_33f2b55": {
        "bug_id": "tomcat80_33f2b55",
        "commit": "https://github.com/apache/tomcat80/commit/33f2b557bc35f0f379a2f201c20ae66e6f5d78d0",
        "file": [
            {
                "additions": 26,
                "blob_url": "https://github.com/apache/tomcat80/blob/33f2b557bc35f0f379a2f201c20ae66e6f5d78d0/java/org/apache/catalina/startup/WebXml.java",
                "changes": 44,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/startup/WebXml.java?ref=33f2b557bc35f0f379a2f201c20ae66e6f5d78d0",
                "deletions": 18,
                "filename": "java/org/apache/catalina/startup/WebXml.java",
                "patch": "@@ -706,15 +706,19 @@ public boolean merge(Set<WebXml> fragments) {\n                     mergeFilter(entry.getValue(),\n                             filters.get(entry.getKey()), false);\n                 } else {\n-                    if (!(mergeFilter(entry.getValue(),\n-                            temp.getFilters().get(entry.getKey()), true))) {\n-                        log.error(sm.getString(\n-                                \"webXml.mergeConflictFilter\",\n-                                entry.getKey(),\n-                                fragment.getName(),\n-                                fragment.getURL()));\n-\n-                        return false;\n+                    if (temp.getFilters().containsKey(entry.getKey())) {\n+                        if (!(mergeFilter(entry.getValue(),\n+                                temp.getFilters().get(entry.getKey()), true))) {\n+                            log.error(sm.getString(\n+                                    \"webXml.mergeConflictFilter\",\n+                                    entry.getKey(),\n+                                    fragment.getName(),\n+                                    fragment.getURL()));\n+    \n+                            return false;\n+                        }\n+                    } else {\n+                        temp.getFilters().put(entry.getKey(), entry.getValue());\n                     }\n                 }\n             }\n@@ -845,15 +849,19 @@ public boolean merge(Set<WebXml> fragments) {\n                     mergeServlet(entry.getValue(),\n                             servlets.get(entry.getKey()), false);\n                 } else {\n-                    if (!(mergeServlet(entry.getValue(),\n-                            temp.getServlets().get(entry.getKey()), true))) {\n-                        log.error(sm.getString(\n-                                \"webXml.mergeConflictServlet\",\n-                                entry.getKey(),\n-                                fragment.getName(),\n-                                fragment.getURL()));\n-\n-                        return false;\n+                    if (temp.getServlets().containsKey(entry.getKey())) {\n+                        if (!(mergeServlet(entry.getValue(),\n+                                temp.getServlets().get(entry.getKey()), true))) {\n+                            log.error(sm.getString(\n+                                    \"webXml.mergeConflictServlet\",\n+                                    entry.getKey(),\n+                                    fragment.getName(),\n+                                    fragment.getURL()));\n+    \n+                            return false;\n+                        }\n+                    } else {\n+                        temp.getServlets().put(entry.getKey(), entry.getValue());\n                     }\n                 }\n             }",
                "raw_url": "https://github.com/apache/tomcat80/raw/33f2b557bc35f0f379a2f201c20ae66e6f5d78d0/java/org/apache/catalina/startup/WebXml.java",
                "sha": "f258459e5de670dd42ccf9682718cdc81bf36588",
                "status": "modified"
            }
        ],
        "message": "Fix a couple of potential NPEs\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@888203 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/59167839576902a959bd97fcdf73077be3084f54",
        "patched_files": [
            "WebXml.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestWebXml.java"
        ]
    },
    "tomcat80_39a5d13": {
        "bug_id": "tomcat80_39a5d13",
        "commit": "https://github.com/apache/tomcat80/commit/39a5d138b59f84575045bf81c79c21a028c8700f",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/39a5d138b59f84575045bf81c79c21a028c8700f/java/org/apache/tomcat/util/http/Parameters.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/http/Parameters.java?ref=39a5d138b59f84575045bf81c79c21a028c8700f",
                "deletions": 0,
                "filename": "java/org/apache/tomcat/util/http/Parameters.java",
                "patch": "@@ -122,6 +122,9 @@ public void addParameterValues( String key, String[] newValues) {\n         handleQueryParameters();\n         // no \"facade\"\n         ArrayList<String> values = paramHashValues.get(name);\n+        if (values == null) {\n+            return null;\n+        }\n         return values.toArray(new String[values.size()]);\n     }\n ",
                "raw_url": "https://github.com/apache/tomcat80/raw/39a5d138b59f84575045bf81c79c21a028c8700f/java/org/apache/tomcat/util/http/Parameters.java",
                "sha": "8270e1e55b213d46aa3979f2c2a2271290a5c577",
                "status": "modified"
            }
        ],
        "message": "Fix NPE in parameter re-factoring identified by JSP TCK.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1190481 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/7085f3a599852a958412c6a5330e3dda73ba11c7",
        "patched_files": [
            "Parameters.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestParameters.java"
        ]
    },
    "tomcat80_3c1dc52": {
        "bug_id": "tomcat80_3c1dc52",
        "commit": "https://github.com/apache/tomcat80/commit/3c1dc52bac8f3c5e307342aa1fa99d475ebec580",
        "file": [
            {
                "additions": 33,
                "blob_url": "https://github.com/apache/tomcat80/blob/3c1dc52bac8f3c5e307342aa1fa99d475ebec580/java/org/apache/tomcat/util/scan/StandardJarScanner.java",
                "changes": 64,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/scan/StandardJarScanner.java?ref=3c1dc52bac8f3c5e307342aa1fa99d475ebec580",
                "deletions": 31,
                "filename": "java/org/apache/tomcat/util/scan/StandardJarScanner.java",
                "patch": "@@ -366,40 +366,42 @@ private static void processManifest(Jar jar, boolean isWebapp,\n         }\n \n         Manifest manifest = jar.getManifest();\n-        Attributes attributes = manifest.getMainAttributes();\n-        String classPathAttribute = attributes.getValue(\"Class-Path\");\n-        if (classPathAttribute == null) {\n-            return;\n-        }\n-        String[] classPathEntries = classPathAttribute.split(\" \");\n-        for (String classPathEntry : classPathEntries) {\n-            classPathEntry = classPathEntry.trim();\n-            if (classPathEntry.length() == 0) {\n-                continue;\n+        if (manifest != null) {\n+            Attributes attributes = manifest.getMainAttributes();\n+            String classPathAttribute = attributes.getValue(\"Class-Path\");\n+            if (classPathAttribute == null) {\n+                return;\n             }\n-            URL jarURL = jar.getJarFileURL();\n-            URI jarURI;\n-            try {\n-                jarURI = jarURL.toURI();\n-            } catch (URISyntaxException e) {\n-                if (log.isDebugEnabled()) {\n-                    log.debug(sm.getString(\"jarScan.invalidUri\", jarURL));\n+            String[] classPathEntries = classPathAttribute.split(\" \");\n+            for (String classPathEntry : classPathEntries) {\n+                classPathEntry = classPathEntry.trim();\n+                if (classPathEntry.length() == 0) {\n+                    continue;\n+                }\n+                URL jarURL = jar.getJarFileURL();\n+                URI jarURI;\n+                try {\n+                    jarURI = jarURL.toURI();\n+                } catch (URISyntaxException e) {\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(sm.getString(\"jarScan.invalidUri\", jarURL));\n+                    }\n+                    continue;\n                 }\n-                continue;\n+                /*\n+                 * Note: Resolving the relative URLs from the manifest has the\n+                 *       potential to introduce security concerns. However, since\n+                 *       only JARs provided by the container and NOT those provided\n+                 *       by web applications are processed, there should be no\n+                 *       issues.\n+                 *       If this feature is ever extended to include JARs provided\n+                 *       by web applications, checks should be added to ensure that\n+                 *       any relative URL does not step outside the web application.\n+                 */\n+                URI classPathEntryURI = jarURI.resolve(classPathEntry);\n+                URL classPathEntryURL = classPathEntryURI.toURL();\n+                classPathUrlsToProcess.add(classPathEntryURL);\n             }\n-            /*\n-             * Note: Resolving the relative URLs from the manifest has the\n-             *       potential to introduce security concerns. However, since\n-             *       only JARs provided by the container and NOT those provided\n-             *       by web applications are processed, there should be no\n-             *       issues.\n-             *       If this feature is ever extended to include JARs provided\n-             *       by web applications, checks should be added to ensure that\n-             *       any relative URL does not step outside the web application.\n-             */\n-            URI classPathEntryURI = jarURI.resolve(classPathEntry);\n-            URL classPathEntryURL = classPathEntryURI.toURL();\n-            classPathUrlsToProcess.add(classPathEntryURL);\n         }\n     }\n ",
                "raw_url": "https://github.com/apache/tomcat80/raw/3c1dc52bac8f3c5e307342aa1fa99d475ebec580/java/org/apache/tomcat/util/scan/StandardJarScanner.java",
                "sha": "45a82633ff6a087baf9917160f03fc0eb96674ba",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/3c1dc52bac8f3c5e307342aa1fa99d475ebec580/webapps/docs/changelog.xml",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=3c1dc52bac8f3c5e307342aa1fa99d475ebec580",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -53,6 +53,10 @@\n         around. Therefore, start logging RMI Target related memory leaks on web\n         application stop. (markt)\n       </fix>\n+      <fix>\n+        Ensure NPE will not be thrown during deployment when scanning jar files\n+        without MANIFEST.MF file. (violetagg)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/3c1dc52bac8f3c5e307342aa1fa99d475ebec580/webapps/docs/changelog.xml",
                "sha": "d917e821dbf419538f964fca5225d1750d815ba7",
                "status": "modified"
            }
        ],
        "message": "Merged revision 1744194 from tomcat/trunk:\nEnsure NPE will not be thrown during deployment when scanning jar files without MANIFEST.MF file.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1744197 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/1d1a64b2925f2ba77bba86fd99b6c69f5445b19e",
        "patched_files": [
            "changelog.xml",
            "StandardJarScanner.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestStandardJarScanner.java"
        ]
    },
    "tomcat80_3c3f7db": {
        "bug_id": "tomcat80_3c3f7db",
        "commit": "https://github.com/apache/tomcat80/commit/3c3f7db0a6da802e7f31e00622f80eaee2656c8c",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tomcat80/blob/3c3f7db0a6da802e7f31e00622f80eaee2656c8c/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/CoyoteAdapter.java?ref=3c3f7db0a6da802e7f31e00622f80eaee2656c8c",
                "deletions": 1,
                "filename": "java/org/apache/catalina/connector/CoyoteAdapter.java",
                "patch": "@@ -26,6 +26,7 @@\n import javax.servlet.SessionTrackingMode;\n \n import org.apache.catalina.Context;\n+import org.apache.catalina.Host;\n import org.apache.catalina.Wrapper;\n import org.apache.catalina.comet.CometEvent;\n import org.apache.catalina.comet.CometEvent.EventType;\n@@ -642,7 +643,11 @@ protected boolean postParseRequest(org.apache.coyote.Request req,\n                 res.setStatus(404);\n                 res.setMessage(\"Not found\");\n                 // No context, so use host\n-                request.getHost().logAccess(request, response, 0, true);\n+                Host host = request.getHost();\n+                // Make sure there is a host (might not be during shutdown)\n+                if (host != null) {\n+                    host.logAccess(request, response, 0, true);\n+                }\n                 return false;\n             }\n         ",
                "raw_url": "https://github.com/apache/tomcat80/raw/3c3f7db0a6da802e7f31e00622f80eaee2656c8c/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "sha": "7fef9b9690741c10c79096b58c266fcf310a4ebf",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/3c3f7db0a6da802e7f31e00622f80eaee2656c8c/webapps/docs/changelog.xml",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=3c3f7db0a6da802e7f31e00622f80eaee2656c8c",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -67,6 +67,10 @@\n         Enable remaining valves for Servlet 3 asynchronous processing support.\n         (markt)\n       </fix>\n+      <fix>\n+        Avoid possible NPE when logging requests received during embedded Tomcat\n+        shutdown. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/3c3f7db0a6da802e7f31e00622f80eaee2656c8c/webapps/docs/changelog.xml",
                "sha": "34374e6a6470a8bd70256a1f9539d4a4a724121a",
                "status": "modified"
            }
        ],
        "message": "Avoid possible NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1133401 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/eb0e7af0917978a82653a41af6ffd5651ea2c24e",
        "patched_files": [
            "changelog.xml",
            "CoyoteAdapter.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestCoyoteAdapter.java"
        ]
    },
    "tomcat80_3df633a": {
        "bug_id": "tomcat80_3df633a",
        "commit": "https://github.com/apache/tomcat80/commit/3df633a4332bec9f33a57ba189258c5d359c35a0",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tomcat80/blob/3df633a4332bec9f33a57ba189258c5d359c35a0/java/org/apache/tomcat/util/http/parser/HttpParser.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/http/parser/HttpParser.java?ref=3df633a4332bec9f33a57ba189258c5d359c35a0",
                "deletions": 3,
                "filename": "java/org/apache/tomcat/util/http/parser/HttpParser.java",
                "patch": "@@ -208,11 +208,13 @@ public static MediaType parseMediaType(StringReader input)\n         while (lookForSemiColon == SkipConstantResult.FOUND) {\n             String attribute = readToken(input);\n \n+            String value = \"\";\n             if (skipConstant(input, \"=\") == SkipConstantResult.FOUND) {\n-                String value = readTokenOrQuotedString(input, true);\n+                value = readTokenOrQuotedString(input, true);\n+            }\n+\n+            if (attribute != null) {\n                 parameters.put(attribute.toLowerCase(Locale.ENGLISH), value);\n-            } else {\n-                parameters.put(attribute.toLowerCase(Locale.ENGLISH), \"\");\n             }\n \n             lookForSemiColon = skipConstant(input, \";\");",
                "raw_url": "https://github.com/apache/tomcat80/raw/3df633a4332bec9f33a57ba189258c5d359c35a0/java/org/apache/tomcat/util/http/parser/HttpParser.java",
                "sha": "69654048060c2d3872049a646932ad002f5e3c49",
                "status": "modified"
            },
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/tomcat80/blob/3df633a4332bec9f33a57ba189258c5d359c35a0/test/org/apache/tomcat/util/http/parser/TestMediaType.java",
                "changes": 19,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/tomcat/util/http/parser/TestMediaType.java?ref=3df633a4332bec9f33a57ba189258c5d359c35a0",
                "deletions": 0,
                "filename": "test/org/apache/tomcat/util/http/parser/TestMediaType.java",
                "patch": "@@ -212,6 +212,25 @@ public void testBug53353() throws IOException {\n     }\n \n \n+    @Test\n+    public void testBug55454() throws IOException {\n+        String input = \"text/html;;charset=UTF-8\";\n+\n+        StringReader sr = new StringReader(input);\n+        MediaType m = HttpParser.parseMediaType(sr);\n+\n+        assertEquals(\"text\", m.getType());\n+        assertEquals(\"html\", m.getSubtype());\n+\n+        assertTrue(m.getParameterCount() == 1);\n+\n+        assertEquals(\"UTF-8\", m.getParameterValue(\"charset\"));\n+        assertEquals(\"UTF-8\", m.getCharset());\n+\n+        assertEquals(\"text/html; charset=UTF-8\", m.toString());\n+    }\n+\n+\n     private void doTest(Parameter... parameters) throws IOException {\n         for (String lws : LWS_VALUES) {\n             doTest(lws, parameters);",
                "raw_url": "https://github.com/apache/tomcat80/raw/3df633a4332bec9f33a57ba189258c5d359c35a0/test/org/apache/tomcat/util/http/parser/TestMediaType.java",
                "sha": "b564ed8afa327430cdb919d8ec196a78bab1a500",
                "status": "modified"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55454\nFixed NPE thrown when parsing an invalid content type.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1515841 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/e454ea98e12f5190ae18da7587389a4c6e2a2d7c",
        "patched_files": [
            "MediaType.java",
            "HttpParser.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestMediaType.java"
        ]
    },
    "tomcat80_40e130e": {
        "bug_id": "tomcat80_40e130e",
        "commit": "https://github.com/apache/tomcat80/commit/40e130e02b66993a5178a5ac72f938e69bb62462",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/40e130e02b66993a5178a5ac72f938e69bb62462/test/org/apache/catalina/valves/TestRequestFilterValve.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/valves/TestRequestFilterValve.java?ref=40e130e02b66993a5178a5ac72f938e69bb62462",
                "deletions": 5,
                "filename": "test/org/apache/catalina/valves/TestRequestFilterValve.java",
                "patch": "@@ -24,6 +24,7 @@\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.fail;\n \n+import org.junit.Assert;\n import org.junit.Test;\n \n import org.apache.catalina.Context;\n@@ -97,9 +98,7 @@ private void oneTest(String allow, String deny, boolean denyStatus,\n         request.getMappingData().context = context;\n         request.setCoyoteRequest(new org.apache.coyote.Request());\n \n-        if (type == null) {\n-            fail(\"Invalid test with null type\");\n-        }\n+        Assert.assertNotNull(\"Invalid test with null type\", type);\n         if (property != null) {\n             if (type.equals(\"Addr\")) {\n                 valve = new RemoteAddrValve();\n@@ -109,10 +108,9 @@ private void oneTest(String allow, String deny, boolean denyStatus,\n                 valve = new RemoteHostValve();\n                 request.setRemoteHost(property);\n                 msg.append(\" host='\" + property + \"'\");\n-            } else {\n-                fail(\"Invalid test type\" + type);\n             }\n         }\n+        Assert.assertNotNull(\"Invalid test type\" + type, valve);\n         valve.setNext(new TerminatingValve());\n \n         if (allow != null) {",
                "raw_url": "https://github.com/apache/tomcat80/raw/40e130e02b66993a5178a5ac72f938e69bb62462/test/org/apache/catalina/valves/TestRequestFilterValve.java",
                "sha": "3ddcf2f7acdba50c8ceeb05d74eaacb5ce38efef",
                "status": "modified"
            }
        ],
        "message": "Refactor test to stop IDE complaining about possible NPEs.\nAlso requires slightly less code.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1644525 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/53ddb093650360dfe1cc1e47458035294f7b8451",
        "patched_files": [
            "RequestFilterValve.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestRequestFilterValve.java"
        ]
    },
    "tomcat80_4210f76": {
        "bug_id": "tomcat80_4210f76",
        "commit": "https://github.com/apache/tomcat80/commit/4210f7699291523d8de3e7ddaf583122053915b7",
        "file": [
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tomcat80/blob/4210f7699291523d8de3e7ddaf583122053915b7/java/org/apache/catalina/core/ApplicationContext.java",
                "changes": 18,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/ApplicationContext.java?ref=4210f7699291523d8de3e7ddaf583122053915b7",
                "deletions": 8,
                "filename": "java/org/apache/catalina/core/ApplicationContext.java",
                "patch": "@@ -1248,16 +1248,18 @@ public void addListener(Class<? extends EventListener> listenerClass) {\n     public void addListener(String className) {\n \n         try {\n-            Object obj = context.getInstanceManager().newInstance(className);\n+            if (context.getInstanceManager() != null) {\n+                Object obj = context.getInstanceManager().newInstance(className);\n \n-            if (!(obj instanceof EventListener)) {\n-                throw new IllegalArgumentException(sm.getString(\n-                        \"applicationContext.addListener.iae.wrongType\",\n-                        className));\n-            }\n+                if (!(obj instanceof EventListener)) {\n+                    throw new IllegalArgumentException(sm.getString(\n+                            \"applicationContext.addListener.iae.wrongType\",\n+                            className));\n+                }\n \n-            EventListener listener = (EventListener) obj;\n-            addListener(listener);\n+                EventListener listener = (EventListener) obj;\n+                addListener(listener);\n+            }\n         } catch (IllegalAccessException e) {\n             throw new IllegalArgumentException(sm.getString(\n                     \"applicationContext.addListener.iae.cnfe\", className),",
                "raw_url": "https://github.com/apache/tomcat80/raw/4210f7699291523d8de3e7ddaf583122053915b7/java/org/apache/catalina/core/ApplicationContext.java",
                "sha": "4c8805f2d9dae74ddd552aa23891d9c648a45798",
                "status": "modified"
            },
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/tomcat80/blob/4210f7699291523d8de3e7ddaf583122053915b7/java/org/apache/catalina/core/StandardContext.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/StandardContext.java?ref=4210f7699291523d8de3e7ddaf583122053915b7",
                "deletions": 4,
                "filename": "java/org/apache/catalina/core/StandardContext.java",
                "patch": "@@ -4647,7 +4647,7 @@ public boolean listenerStart() {\n                     listeners[i] + \"'\");\n             try {\n                 String listener = listeners[i];\n-                results[i] = instanceManager.newInstance(listener);\n+                results[i] = getInstanceManager().newInstance(listener);\n             } catch (Throwable t) {\n                 t = ExceptionUtils.unwrapInvocationTargetException(t);\n                 ExceptionUtils.handleThrowable(t);\n@@ -4785,7 +4785,9 @@ public boolean listenerStop() {\n                     }\n                 }\n                 try {\n-                    getInstanceManager().destroyInstance(listeners[j]);\n+                    if (getInstanceManager() != null) {\n+                        getInstanceManager().destroyInstance(listeners[j]);\n+                    }\n                 } catch (Throwable t) {\n                     t = ExceptionUtils.unwrapInvocationTargetException(t);\n                     ExceptionUtils.handleThrowable(t);\n@@ -4805,7 +4807,9 @@ public boolean listenerStop() {\n                 if (listeners[j] == null)\n                     continue;\n                 try {\n-                    getInstanceManager().destroyInstance(listeners[j]);\n+                    if (getInstanceManager() != null) {\n+                        getInstanceManager().destroyInstance(listeners[j]);\n+                    }\n                 } catch (Throwable t) {\n                     t = ExceptionUtils.unwrapInvocationTargetException(t);\n                     ExceptionUtils.handleThrowable(t);\n@@ -5453,7 +5457,7 @@ protected synchronized void stopInternal() throws LifecycleException {\n         }\n \n         //reset the instance manager\n-        instanceManager = null;\n+        setInstanceManager(null);\n \n         if (log.isDebugEnabled())\n             log.debug(\"Stopping complete\");",
                "raw_url": "https://github.com/apache/tomcat80/raw/4210f7699291523d8de3e7ddaf583122053915b7/java/org/apache/catalina/core/StandardContext.java",
                "sha": "9a21f8ee63c06ccff930e6089dd7e65fb20e3b92",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tomcat80/blob/4210f7699291523d8de3e7ddaf583122053915b7/webapps/docs/changelog.xml",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=4210f7699291523d8de3e7ddaf583122053915b7",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -114,6 +114,11 @@\n         <bug>57675</bug>: Correctly quote strings when using the extended\n         access log. (markt)\n       </fix>\n+      <fix>\n+        <bug>57704</bug>: Fix potential NPEs during web application start/stop\n+        when <code>org.apache.tomcat.InstanceManager</code> is not initialized.\n+        (violetagg)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/4210f7699291523d8de3e7ddaf583122053915b7/webapps/docs/changelog.xml",
                "sha": "ec01ba7a231309a1060be68fc0b89ec49a156f97",
                "status": "modified"
            }
        ],
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57704\nMerged revision 1666649 from tomcat/trunk:\nAccess instanceManager via get/set methods.\nFix potential NPEs. In web app start if a problem occur prior to instanceManager initialization then:\n- SCI.onStart will fail if it tries to use instanceManager\n- During web app stop, StandardContext.listenerStop will fail if it tries to use instanceManager\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1666650 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/3d1a2bb161686246caca796d4fdfcea9fce23ba2",
        "patched_files": [
            "StandardContext.java",
            "changelog.xml",
            "ApplicationContext.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestStandardContext.java",
            "TestApplicationContext.java"
        ]
    },
    "tomcat80_4733d60": {
        "bug_id": "tomcat80_4733d60",
        "commit": "https://github.com/apache/tomcat80/commit/4733d60734853e3aff03b16292b6b07fefa53617",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tomcat80/blob/4733d60734853e3aff03b16292b6b07fefa53617/java/org/apache/jasper/compiler/TagLibraryInfoImpl.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/TagLibraryInfoImpl.java?ref=4733d60734853e3aff03b16292b6b07fefa53617",
                "deletions": 0,
                "filename": "java/org/apache/jasper/compiler/TagLibraryInfoImpl.java",
                "patch": "@@ -174,8 +174,14 @@ public TagLibraryInfoImpl(JspCompilationContext ctxt, ParserController pc,\n             }\n \n             // Get the representation of the TLD\n+            if (tldResourcePath.getUrl() == null) {\n+                err.jspError(\"jsp.error.tld.missing\", prefix, uri);\n+            }\n             TaglibXml taglibXml =\n                     ctxt.getOptions().getTldCache().getTaglibXml(tldResourcePath);\n+            if (taglibXml == null) {\n+                err.jspError(\"jsp.error.tld.missing\", prefix, uri);\n+            }\n \n             // Populate the TagLibraryInfo attributes\n             this.jspversion = taglibXml.getJspVersion();",
                "raw_url": "https://github.com/apache/tomcat80/raw/4733d60734853e3aff03b16292b6b07fefa53617/java/org/apache/jasper/compiler/TagLibraryInfoImpl.java",
                "sha": "3699af1b45dd3a9f6db51b2c1ee2359c2b695c55",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/4733d60734853e3aff03b16292b6b07fefa53617/java/org/apache/jasper/compiler/TldCache.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/TldCache.java?ref=4733d60734853e3aff03b16292b6b07fefa53617",
                "deletions": 0,
                "filename": "java/org/apache/jasper/compiler/TldCache.java",
                "patch": "@@ -93,6 +93,9 @@ public TldResourcePath getTldResourcePath(String uri) {\n \n     public TaglibXml getTaglibXml(TldResourcePath tldResourcePath) throws JasperException {\n         TaglibXmlCacheEntry cacheEntry = tldResourcePathTaglibXmlMap.get(tldResourcePath);\n+        if (cacheEntry == null) {\n+            return null;\n+        }\n         long lastModified[] = getLastModified(tldResourcePath);\n         if (lastModified[0] != cacheEntry.getWebAppPathLastModified() ||\n                 lastModified[1] != cacheEntry.getEntryLastModified()) {",
                "raw_url": "https://github.com/apache/tomcat80/raw/4733d60734853e3aff03b16292b6b07fefa53617/java/org/apache/jasper/compiler/TldCache.java",
                "sha": "60daed583daf61a1fc617b29cd05008988ac040a",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/4733d60734853e3aff03b16292b6b07fefa53617/java/org/apache/jasper/resources/LocalStrings.properties",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/resources/LocalStrings.properties?ref=4733d60734853e3aff03b16292b6b07fefa53617",
                "deletions": 0,
                "filename": "java/org/apache/jasper/resources/LocalStrings.properties",
                "patch": "@@ -140,6 +140,7 @@ jsp.error.file.not.found=File [{0}] not found\n jsp.error.missing_attribute=According to the TLD or the tag file, attribute {0} is mandatory for tag {1}\n jsp.error.bad_attribute=Attribute {0} invalid for tag {1} according to TLD\n jsp.error.tld.unable_to_get_jar=Unable to get JAR resource \\\"{0}\\\" containing TLD: {1}\n+jsp.error.tld.missing=Unable to find taglib \\\"{0}\\\" for URI: {1}\n jsp.error.tld.missing_jar=Missing JAR resource \\\"{0}\\\" containing TLD\n jsp.error.unable.to_find_method=Unable to find setter method for attribute: {0}\n jsp.error.bad_tag=No tag \\\"{0}\\\" defined in tag library imported with prefix \\\"{1}\\\"",
                "raw_url": "https://github.com/apache/tomcat80/raw/4733d60734853e3aff03b16292b6b07fefa53617/java/org/apache/jasper/resources/LocalStrings.properties",
                "sha": "7b497486c9e0ec10592f1496f2164f42438cebdb",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/4733d60734853e3aff03b16292b6b07fefa53617/webapps/docs/changelog.xml",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=4733d60734853e3aff03b16292b6b07fefa53617",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -95,6 +95,9 @@\n         the class loader of the first web application to use expressions to be\n         pinned in memory. (markt)\n       </fix>\n+      <fix>\n+        <bug>59640</bug>: NPEs with not found TLDs. (remm)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Web applications\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/4733d60734853e3aff03b16292b6b07fefa53617/webapps/docs/changelog.xml",
                "sha": "4cbc9b96a085b3ad9c753841293132aa4d380959",
                "status": "modified"
            }
        ],
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59640\nBack port remm's NPE fix for missing TLDs\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1746475 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/4e00d79dd51d81663caf707e5a1cee1bac48cad3",
        "patched_files": [
            "TagLibraryInfoImpl.java",
            "LocalStrings.properties",
            "changelog.xml"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestTagLibraryInfoImpl.java"
        ]
    },
    "tomcat80_47cbff6": {
        "bug_id": "tomcat80_47cbff6",
        "commit": "https://github.com/apache/tomcat80/commit/47cbff667bbf3b6679d626ba45de0fc769884aac",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/47cbff667bbf3b6679d626ba45de0fc769884aac/java/org/apache/el/lang/ELSupport.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/el/lang/ELSupport.java?ref=47cbff667bbf3b6679d626ba45de0fc769884aac",
                "deletions": 1,
                "filename": "java/org/apache/el/lang/ELSupport.java",
                "patch": "@@ -341,7 +341,7 @@ public final static void checkType(final Object obj, final Class type)\n     public final static Object coerceToType(final Object obj, final Class type)\n             throws IllegalArgumentException {\n         if (type == null || Object.class.equals(type) ||\n-                type.equals(obj.getClass())) {\n+                (obj != null && type.equals(obj.getClass()))) {\n             return obj;\n         }\n         if (String.class.equals(type)) {",
                "raw_url": "https://github.com/apache/tomcat80/raw/47cbff667bbf3b6679d626ba45de0fc769884aac/java/org/apache/el/lang/ELSupport.java",
                "sha": "5bddf4fc91bde4bca552c233ccad267ffce59ce0",
                "status": "modified"
            }
        ],
        "message": "Add Remy's NPE fix to trunk.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@653038 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/1b708c4027a1bb56c4e06d62575130b317e59ee8",
        "patched_files": [
            "ELSupport.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestELSupport.java"
        ]
    },
    "tomcat80_482896e": {
        "bug_id": "tomcat80_482896e",
        "commit": "https://github.com/apache/tomcat80/commit/482896eda00a43cac282a2f7735e0f0e7a7e3fcd",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/482896eda00a43cac282a2f7735e0f0e7a7e3fcd/java/org/apache/catalina/core/LocalStrings.properties",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/LocalStrings.properties?ref=482896eda00a43cac282a2f7735e0f0e7a7e3fcd",
                "deletions": 0,
                "filename": "java/org/apache/catalina/core/LocalStrings.properties",
                "patch": "@@ -179,6 +179,7 @@ standardHost.noContext=No Context configured to process this request\n standardHost.notContext=Child of a Host must be a Context\n standardHost.nullName=Host name is required\n standardHost.problematicAppBase=Using an empty string for appBase on host [{0}] will set it to CATALINA_BASE, which is a bad idea\n+standardHostValue.customStatusFailed=Custom error page [{0}] could not be dispatched correctly\n standardServer.accept.timeout=The socket listening for the shutdown command experienced an unexpected timeout [{0}] milliseconds after the call to accept(). Is this an instance of bug 56684?\n standardServer.shutdownViaPort=A valid shutdown command was received via the shutdown port. Stopping the Server instance.\n standardServer.storeConfig.notAvailable=No StoreConfig implementation was registered as an MBean named [{0}] so no configuration could be saved. A suitable MBean is normally registered via the StoreConfigLifecyleListener.",
                "raw_url": "https://github.com/apache/tomcat80/raw/482896eda00a43cac282a2f7735e0f0e7a7e3fcd/java/org/apache/catalina/core/LocalStrings.properties",
                "sha": "b0b8ff2c619ed73f58fb14e3a3088d5497549493",
                "status": "modified"
            },
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/tomcat80/blob/482896eda00a43cac282a2f7735e0f0e7a7e3fcd/java/org/apache/catalina/core/StandardHostValve.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/StandardHostValve.java?ref=482896eda00a43cac282a2f7735e0f0e7a7e3fcd",
                "deletions": 1,
                "filename": "java/org/apache/catalina/core/StandardHostValve.java",
                "patch": "@@ -278,7 +278,7 @@ private void status(Request request, Response response) {\n             // Look for a default error page\n             errorPage = context.findErrorPage(0);\n         }\n-        if (errorPage != null && response.setErrorReported()) {\n+        if (errorPage != null && response.isErrorReportRequired()) {\n             response.setAppCommitted(false);\n             request.setAttribute(RequestDispatcher.ERROR_STATUS_CODE,\n                               Integer.valueOf(statusCode));\n@@ -302,6 +302,7 @@ private void status(Request request, Response response) {\n             request.setAttribute(RequestDispatcher.ERROR_REQUEST_URI,\n                                  request.getRequestURI());\n             if (custom(request, response, errorPage)) {\n+                response.setErrorReported();\n                 try {\n                     response.finishResponse();\n                 } catch (ClientAbortException e) {\n@@ -426,6 +427,12 @@ private boolean custom(Request request, Response response,\n             RequestDispatcher rd =\n                 servletContext.getRequestDispatcher(errorPage.getLocation());\n \n+            if (rd == null) {\n+                container.getLogger().error(\n+                    sm.getString(\"standardHostValue.customStatusFailed\", errorPage.getLocation()));\n+                return false;\n+            }\n+\n             if (response.isCommitted()) {\n                 // Response is committed - including the error page is the\n                 // best we can do",
                "raw_url": "https://github.com/apache/tomcat80/raw/482896eda00a43cac282a2f7735e0f0e7a7e3fcd/java/org/apache/catalina/core/StandardHostValve.java",
                "sha": "ee635c0d9b0f065a8099e7d850849750ce1cee35",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tomcat80/blob/482896eda00a43cac282a2f7735e0f0e7a7e3fcd/webapps/docs/changelog.xml",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=482896eda00a43cac282a2f7735e0f0e7a7e3fcd",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -148,6 +148,11 @@\n         Avoid UnsupportedOperationException when releasing an user-provided\n         URLStreamHandlerFactory. Patch provided by Cristian Talau. (violetagg)\n       </fix>\n+      <fix>\n+        <bug>58581</bug>: If a custom error page fails, fall back to the\n+        standard error page rather than throwing an NPE. Based on a patch by\n+        Huxing Zhang. (markt)\n+      </fix>\n       <fix>\n         <bug>58582</bug>: Combined realm should perform background processing\n         on its sub-realms. Based upon a patch provided by Aidan. (schultz)",
                "raw_url": "https://github.com/apache/tomcat80/raw/482896eda00a43cac282a2f7735e0f0e7a7e3fcd/webapps/docs/changelog.xml",
                "sha": "f35d06ba67349b8f2ee4c9e20de2804679c38532",
                "status": "modified"
            }
        ],
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58581\nIf custom error page fails, fall back to standard error page rather than throwing an NPE.\nBased on a patch by Huxing Zhang.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1712975 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/a7884bdf779828052415258bbbf3becd62141f25",
        "patched_files": [
            "StandardHostValve.java",
            "LocalStrings.properties",
            "changelog.xml"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestStandardHostValve.java"
        ]
    },
    "tomcat80_48e2f27": {
        "bug_id": "tomcat80_48e2f27",
        "commit": "https://github.com/apache/tomcat80/commit/48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tomcat80/blob/48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6/java/org/apache/catalina/mapper/LocalStrings.properties",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/mapper/LocalStrings.properties?ref=48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6",
                "deletions": 0,
                "filename": "java/org/apache/catalina/mapper/LocalStrings.properties",
                "patch": "@@ -14,6 +14,8 @@\n # limitations under the License.\n \n mapper.removeWrapper=Removing wrapper from Context [{0}] with path [{1}]\n+mapper.duplicateHost=Duplicate Host [{0}]. The name is already used by Host [{1}]. This Host will be ignored.\n+mapper.duplicateHostAlias=Duplicate host Alias [{0}] in Host [{1}]. The name is already used by Host [{2}]. This Alias will be ignored.\n \n mapperListener.unknownDefaultHost=Unknown default host [{0}] for service [{1}]\n mapperListener.registerHost=Register host [{0}] at domain [{1}] for service [{2}]",
                "raw_url": "https://github.com/apache/tomcat80/raw/48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6/java/org/apache/catalina/mapper/LocalStrings.properties",
                "sha": "df0734c091c3b386e6e96faf69794d24e0626a8d",
                "status": "modified"
            },
            {
                "additions": 273,
                "blob_url": "https://github.com/apache/tomcat80/blob/48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6/java/org/apache/catalina/mapper/Mapper.java",
                "changes": 543,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/mapper/Mapper.java?ref=48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6",
                "deletions": 270,
                "filename": "java/org/apache/catalina/mapper/Mapper.java",
                "patch": "@@ -94,16 +94,16 @@ public synchronized void addHost(String name, String[] aliases,\n         newHost.object = host;\n         if (insertMap(hosts, newHosts, newHost)) {\n             hosts = newHosts;\n+        } else {\n+            MappedHost duplicate = hosts[find(hosts, name)];\n+            String duplicateHostName = duplicate.object.getName();\n+            log.error(sm.getString(\"mapper.duplicateHost\", name,\n+                    duplicateHostName));\n+            // Do not add aliases, as removeHost(hostName) won't be able to remove them\n+            return;\n         }\n-        for (int i = 0; i < aliases.length; i++) {\n-            newHosts = new MappedHost[hosts.length + 1];\n-            newHost = new MappedHost();\n-            newHost.name = aliases[i];\n-            newHost.contextList = contextList;\n-            newHost.object = host;\n-            if (insertMap(hosts, newHosts, newHost)) {\n-                hosts = newHosts;\n-            }\n+        for (String alias : aliases) {\n+            addHostAliasImpl(newHost, alias);\n         }\n     }\n \n@@ -115,15 +115,16 @@ public synchronized void addHost(String name, String[] aliases,\n      */\n     public synchronized void removeHost(String name) {\n         // Find and remove the old host\n-        int pos = find(hosts, name);\n-        if (pos < 0) {\n+        MappedHost mappedHost = exactFind(hosts, name);\n+        if (mappedHost == null) {\n             return;\n         }\n-        Host host = hosts[pos].object;\n+        Host host = mappedHost.object;\n         MappedHost[] newHosts = new MappedHost[hosts.length - 1];\n         if (removeMap(hosts, newHosts, name)) {\n             hosts = newHosts;\n         }\n+\n         // Remove all aliases (they will map to the same host object)\n         for (int i = 0; i < newHosts.length; i++) {\n             if (newHosts[i].object == host) {\n@@ -141,21 +142,34 @@ public synchronized void removeHost(String name) {\n      * @param alias The alias to add\n      */\n     public synchronized void addHostAlias(String name, String alias) {\n-        int pos = find(hosts, name);\n-        if (pos < 0) {\n+        MappedHost realHost = exactFind(hosts, name);\n+        if (realHost == null) {\n             // Should not be adding an alias for a host that doesn't exist but\n             // just in case...\n             return;\n         }\n-        MappedHost realHost = hosts[pos];\n+        addHostAliasImpl(realHost, alias);\n+    }\n \n+    private void addHostAliasImpl(MappedHost realHost, String alias) {\n+        if (alias.equals(realHost.name)) {\n+            // An Alias with the same name as its own Host.\n+            // A harmless redundancy. E.g.\n+            // <Host name=\"localhost\"><Alias>localhost</Alias></Host>\n+            return;\n+        }\n         MappedHost[] newHosts = new MappedHost[hosts.length + 1];\n         MappedHost newHost = new MappedHost();\n         newHost.name = alias;\n         newHost.contextList = realHost.contextList;\n         newHost.object = realHost.object;\n         if (insertMap(hosts, newHosts, newHost)) {\n             hosts = newHosts;\n+        } else {\n+            MappedHost duplicate = hosts[find(hosts, alias)];\n+            String duplicateHostName = duplicate.object.getName();\n+            log.error(sm.getString(\"mapper.duplicateHostAlias\", alias,\n+                    realHost.name, duplicateHostName));\n         }\n     }\n \n@@ -165,8 +179,7 @@ public synchronized void addHostAlias(String name, String alias) {\n      */\n     public synchronized void removeHostAlias(String alias) {\n         // Find and remove the alias\n-        int pos = find(hosts, alias);\n-        if (pos < 0) {\n+        if (exactFind(hosts, alias) == null) {\n             return;\n         }\n         MappedHost[] newHosts = new MappedHost[hosts.length - 1];\n@@ -193,52 +206,51 @@ public void addContextVersion(String hostName, Host host, String path,\n             WebResourceRoot resources) {\n \n         MappedHost[] hosts = this.hosts;\n-        int pos = find(hosts, hostName);\n-        if( pos <0 ) {\n+        MappedHost mappedHost = exactFind(hosts, hostName);\n+        if (mappedHost == null) {\n             addHost(hostName, new String[0], host);\n             hosts = this.hosts;\n-            pos = find(hosts, hostName);\n-        }\n-        if (pos < 0) {\n-            log.error(\"No host found: \" + hostName);\n+            mappedHost = exactFind(hosts, hostName);\n+            if (mappedHost == null) {\n+                log.error(\"No host found: \" + hostName);\n+                return;\n+            }\n         }\n-        MappedHost mappedHost = hosts[pos];\n-        if (mappedHost.name.equals(hostName)) {\n-            int slashCount = slashCount(path);\n-            synchronized (mappedHost) {\n+        int slashCount = slashCount(path);\n+        synchronized (mappedHost) {\n+            // Update nesting\n+            if (slashCount > mappedHost.contextList.nesting) {\n+                mappedHost.contextList.nesting = slashCount;\n+            }\n+            MappedContext mappedContext;\n+            {\n                 MappedContext[] contexts = mappedHost.contextList.contexts;\n-                // Update nesting\n-                if (slashCount > mappedHost.contextList.nesting) {\n-                    mappedHost.contextList.nesting = slashCount;\n-                }\n-                int pos2 = find(contexts, path);\n-                if (pos2 < 0 || !path.equals(contexts[pos2].name)) {\n-                    MappedContext newContext = new MappedContext();\n-                    newContext.name = path;\n+                mappedContext = exactFind(contexts, path);\n+                if (mappedContext == null) {\n+                    mappedContext = new MappedContext();\n+                    mappedContext.name = path;\n                     MappedContext[] newContexts = new MappedContext[contexts.length + 1];\n-                    if (insertMap(contexts, newContexts, newContext)) {\n+                    if (insertMap(contexts, newContexts, mappedContext)) {\n                         mappedHost.contextList.contexts = newContexts;\n+                        // contexts = newContexts;\n                     }\n-                    pos2 = find(newContexts, path);\n                 }\n+            }\n \n-                MappedContext mappedContext = mappedHost.contextList.contexts[pos2];\n-\n-                ContextVersion[] contextVersions = mappedContext.versions;\n-                ContextVersion[] newContextVersions =\n-                    new ContextVersion[contextVersions.length + 1];\n-                ContextVersion newContextVersion = new ContextVersion();\n-                newContextVersion.path = path;\n-                newContextVersion.slashCount = slashCount;\n-                newContextVersion.name = version;\n-                newContextVersion.object = context;\n-                newContextVersion.welcomeResources = welcomeResources;\n-                newContextVersion.resources = resources;\n-                if (insertMap(contextVersions, newContextVersions, newContextVersion)) {\n-                    mappedContext.versions = newContextVersions;\n-                    contextObjectToContextVersionMap.put(\n-                            context, newContextVersion);\n-                }\n+            ContextVersion[] contextVersions = mappedContext.versions;\n+            ContextVersion[] newContextVersions =\n+                new ContextVersion[contextVersions.length + 1];\n+            ContextVersion newContextVersion = new ContextVersion();\n+            newContextVersion.path = path;\n+            newContextVersion.slashCount = slashCount;\n+            newContextVersion.name = version;\n+            newContextVersion.object = context;\n+            newContextVersion.welcomeResources = welcomeResources;\n+            newContextVersion.resources = resources;\n+            if (insertMap(contextVersions, newContextVersions, newContextVersion)) {\n+                mappedContext.versions = newContextVersions;\n+                contextObjectToContextVersionMap.put(\n+                        context, newContextVersion);\n             }\n         }\n \n@@ -258,43 +270,39 @@ public void removeContextVersion(Context ctxt, String hostName,\n \n         contextObjectToContextVersionMap.remove(ctxt);\n \n-        MappedHost[] hosts = this.hosts;\n-        int pos = find(hosts, hostName);\n-        if (pos < 0) {\n+        MappedHost host = exactFind(this.hosts, hostName);\n+        if (host == null) {\n             return;\n         }\n-        MappedHost host = hosts[pos];\n-        if (host.name.equals(hostName)) {\n-            synchronized (host) {\n-                MappedContext[] contexts = host.contextList.contexts;\n-                if (contexts.length == 0 ){\n-                    return;\n-                }\n \n-                int pos2 = find(contexts, path);\n-                if (pos2 < 0 || !path.equals(contexts[pos2].name)) {\n-                    return;\n-                }\n-                MappedContext context = contexts[pos2];\n-\n-                ContextVersion[] contextVersions = context.versions;\n-                ContextVersion[] newContextVersions =\n-                    new ContextVersion[contextVersions.length - 1];\n-                if (removeMap(contextVersions, newContextVersions, version)) {\n-                    context.versions = newContextVersions;\n-\n-                    if (context.versions.length == 0) {\n-                        // Remove the context\n-                        MappedContext[] newContexts = new MappedContext[contexts.length -1];\n-                        if (removeMap(contexts, newContexts, path)) {\n-                            host.contextList.contexts = newContexts;\n-                            // Recalculate nesting\n-                            host.contextList.nesting = 0;\n-                            for (int i = 0; i < newContexts.length; i++) {\n-                                int slashCount = slashCount(newContexts[i].name);\n-                                if (slashCount > host.contextList.nesting) {\n-                                    host.contextList.nesting = slashCount;\n-                                }\n+        synchronized (host) {\n+            MappedContext[] contexts = host.contextList.contexts;\n+            if (contexts.length == 0 ){\n+                return;\n+            }\n+\n+            MappedContext context = exactFind(contexts, path);\n+            if (context == null) {\n+                return;\n+            }\n+\n+            ContextVersion[] contextVersions = context.versions;\n+            ContextVersion[] newContextVersions =\n+                new ContextVersion[contextVersions.length - 1];\n+            if (removeMap(contextVersions, newContextVersions, version)) {\n+                context.versions = newContextVersions;\n+\n+                if (context.versions.length == 0) {\n+                    // Remove the context\n+                    MappedContext[] newContexts = new MappedContext[contexts.length -1];\n+                    if (removeMap(contexts, newContexts, path)) {\n+                        host.contextList.contexts = newContexts;\n+                        // Recalculate nesting\n+                        host.contextList.nesting = 0;\n+                        for (int i = 0; i < newContexts.length; i++) {\n+                            int slashCount = slashCount(newContexts[i].name);\n+                            if (slashCount > host.contextList.nesting) {\n+                                host.contextList.nesting = slashCount;\n                             }\n                         }\n                     }\n@@ -308,34 +316,24 @@ public void addWrapper(String hostName, String contextPath, String version,\n                            String path, Wrapper wrapper, boolean jspWildCard,\n                            boolean resourceOnly) {\n         MappedHost[] hosts = this.hosts;\n-        int pos = find(hosts, hostName);\n-        if (pos < 0) {\n+        MappedHost host = exactFind(hosts, hostName);\n+        if (host == null) {\n             return;\n         }\n-        MappedHost host = hosts[pos];\n-        if (host.name.equals(hostName)) {\n-            MappedContext[] contexts = host.contextList.contexts;\n-            int pos2 = find(contexts, contextPath);\n-            if (pos2 < 0) {\n-                log.error(\"No context found: \" + contextPath );\n-                return;\n-            }\n-            MappedContext context = contexts[pos2];\n-            if (context.name.equals(contextPath)) {\n-                ContextVersion[] contextVersions = context.versions;\n-                int pos3 = find(contextVersions, version);\n-                if( pos3<0 ) {\n-                    log.error(\"No context version found: \" + contextPath + \" \" +\n-                            version);\n-                    return;\n-                }\n-                ContextVersion contextVersion = contextVersions[pos3];\n-                if (contextVersion.name.equals(version)) {\n-                    addWrapper(contextVersion, path, wrapper, jspWildCard,\n-                            resourceOnly);\n-                }\n-            }\n+        MappedContext[] contexts = host.contextList.contexts;\n+        MappedContext context = exactFind(contexts, contextPath);\n+        if (context == null) {\n+            log.error(\"No context found: \" + contextPath );\n+            return;\n+        }\n+        ContextVersion[] contextVersions = context.versions;\n+        ContextVersion contextVersion = exactFind(contextVersions, version);\n+        if (contextVersion == null) {\n+            log.error(\"No context version found: \" + contextPath + \" \" +\n+                    version);\n+            return;\n         }\n+        addWrapper(contextVersion, path, wrapper, jspWildCard, resourceOnly);\n     }\n \n \n@@ -411,33 +409,24 @@ protected void addWrapper(ContextVersion context, String path,\n      * @param contextPath Context path this wrapper belongs to\n      * @param path Wrapper mapping\n      */\n-    public void removeWrapper\n-        (String hostName, String contextPath, String version, String path) {\n+    public void removeWrapper(String hostName, String contextPath,\n+            String version, String path) {\n         MappedHost[] hosts = this.hosts;\n-        int pos = find(hosts, hostName);\n-        if (pos < 0) {\n+        MappedHost host = exactFind(hosts, hostName);\n+        if (host == null) {\n             return;\n         }\n-        MappedHost host = hosts[pos];\n-        if (host.name.equals(hostName)) {\n-            MappedContext[] contexts = host.contextList.contexts;\n-            int pos2 = find(contexts, contextPath);\n-            if (pos2 < 0) {\n-                return;\n-            }\n-            MappedContext context = contexts[pos2];\n-            if (context.name.equals(contextPath)) {\n-                ContextVersion[] contextVersions = context.versions;\n-                int pos3 = find(contextVersions, version);\n-                if( pos3<0 ) {\n-                    return;\n-                }\n-                ContextVersion contextVersion = contextVersions[pos3];\n-                if (contextVersion.name.equals(version)) {\n-                    removeWrapper(contextVersion, path);\n-                }\n-            }\n+        MappedContext[] contexts = host.contextList.contexts;\n+        MappedContext context = exactFind(contexts, contextPath);\n+        if (context == null) {\n+            return;\n+        }\n+        ContextVersion[] contextVersions = context.versions;\n+        ContextVersion contextVersion = exactFind(contextVersions, version);\n+        if (contextVersion == null) {\n+            return;\n         }\n+        removeWrapper(contextVersion, path);\n     }\n \n     protected void removeWrapper(ContextVersion context, String path) {\n@@ -516,41 +505,31 @@ protected void removeWrapper(ContextVersion context, String path) {\n     public void addWelcomeFile(String hostName, String contextPath,\n             String version, String welcomeFile) {\n         MappedHost[] hosts = this.hosts;\n-        int pos = find(hosts, hostName);\n-        if (pos < 0) {\n+        MappedHost host = exactFind(hosts, hostName);\n+        if (host == null) {\n             return;\n         }\n-        MappedHost host = hosts[pos];\n-        if (host.name.equals(hostName)) {\n-            MappedContext[] contexts = host.contextList.contexts;\n-            int pos2 = find(contexts, contextPath);\n-            if (pos2 < 0) {\n-                log.error(\"No context found: \" + contextPath );\n-                return;\n-            }\n-            MappedContext context = contexts[pos2];\n-            if (context.name.equals(contextPath)) {\n-                ContextVersion[] contextVersions = context.versions;\n-                int pos3 = find(contextVersions, version);\n-                if( pos3<0 ) {\n-                    log.error(\"No context version found: \" + contextPath + \" \" +\n-                            version);\n-                    return;\n-                }\n-                ContextVersion contextVersion = contextVersions[pos3];\n-                if (contextVersion.name.equals(version)) {\n-                    int len = contextVersion.welcomeResources.length + 1;\n-                    String[] newWelcomeResources = new String[len];\n-                    System.arraycopy(contextVersion.welcomeResources, 0,\n-                            newWelcomeResources, 0, len - 1);\n-                    newWelcomeResources[len - 1] = welcomeFile;\n-                    contextVersion.welcomeResources = newWelcomeResources;\n-                }\n-            }\n+        MappedContext[] contexts = host.contextList.contexts;\n+        MappedContext context = exactFind(contexts, contextPath);\n+        if (context == null) {\n+            log.error(\"No context found: \" + contextPath);\n+            return;\n         }\n+        ContextVersion[] contextVersions = context.versions;\n+        ContextVersion contextVersion = exactFind(contextVersions, version);\n+        if (contextVersion == null) {\n+            log.error(\"No context version found: \" + contextPath + \" \"\n+                    + version);\n+            return;\n+        }\n+        int len = contextVersion.welcomeResources.length + 1;\n+        String[] newWelcomeResources = new String[len];\n+        System.arraycopy(contextVersion.welcomeResources, 0,\n+                newWelcomeResources, 0, len - 1);\n+        newWelcomeResources[len - 1] = welcomeFile;\n+        contextVersion.welcomeResources = newWelcomeResources;\n     }\n \n-\n     /**\n      * Remove a welcome file from the given context.\n      *\n@@ -561,53 +540,43 @@ public void addWelcomeFile(String hostName, String contextPath,\n     public void removeWelcomeFile(String hostName, String contextPath,\n             String version, String welcomeFile) {\n         MappedHost[] hosts = this.hosts;\n-        int pos = find(hosts, hostName);\n-        if (pos < 0) {\n+        MappedHost host = exactFind(hosts, hostName);\n+        if (host == null) {\n             return;\n         }\n-        MappedHost host = hosts[pos];\n-        if (host.name.equals(hostName)) {\n-            MappedContext[] contexts = host.contextList.contexts;\n-            int pos2 = find(contexts, contextPath);\n-            if (pos2 < 0) {\n-                log.error(\"No context found: \" + contextPath );\n-                return;\n+        MappedContext[] contexts = host.contextList.contexts;\n+        MappedContext context = exactFind(contexts, contextPath);\n+        if (context == null) {\n+            log.error(\"No context found: \" + contextPath);\n+            return;\n+        }\n+        ContextVersion[] contextVersions = context.versions;\n+        ContextVersion contextVersion = exactFind(contextVersions, version);\n+        if (contextVersion == null) {\n+            log.error(\"No context version found: \" + contextPath + \" \"\n+                    + version);\n+            return;\n+        }\n+        int match = -1;\n+        for (int i = 0; i < contextVersion.welcomeResources.length; i++) {\n+            if (welcomeFile.equals(contextVersion.welcomeResources[i])) {\n+                match = i;\n+                break;\n             }\n-            MappedContext context = contexts[pos2];\n-            if (context.name.equals(contextPath)) {\n-                ContextVersion[] contextVersions = context.versions;\n-                int pos3 = find(contextVersions, version);\n-                if( pos3<0 ) {\n-                    log.error(\"No context version found: \" + contextPath + \" \" +\n-                            version);\n-                    return;\n-                }\n-                ContextVersion contextVersion = contextVersions[pos3];\n-                if (contextVersion.name.equals(version)) {\n-                    int match = -1;\n-                    for (int i = 0; i < contextVersion.welcomeResources.length; i++) {\n-                        if (welcomeFile.equals(contextVersion.welcomeResources[i])) {\n-                            match = i;\n-                            break;\n-                        }\n-                    }\n-                    if (match > -1) {\n-                        int len = contextVersion.welcomeResources.length - 1;\n-                        String[] newWelcomeResources = new String[len];\n-                        System.arraycopy(contextVersion.welcomeResources, 0,\n-                                newWelcomeResources, 0, match);\n-                        if (match < len) {\n-                            System.arraycopy(contextVersion.welcomeResources, match + 1,\n-                                    newWelcomeResources, match, len - match);\n-                        }\n-                        contextVersion.welcomeResources = newWelcomeResources;\n-                    }\n-                }\n+        }\n+        if (match > -1) {\n+            int len = contextVersion.welcomeResources.length - 1;\n+            String[] newWelcomeResources = new String[len];\n+            System.arraycopy(contextVersion.welcomeResources, 0,\n+                    newWelcomeResources, 0, match);\n+            if (match < len) {\n+                System.arraycopy(contextVersion.welcomeResources, match + 1,\n+                        newWelcomeResources, match, len - match);\n             }\n+            contextVersion.welcomeResources = newWelcomeResources;\n         }\n     }\n \n-\n     /**\n      * Clear the welcome files for the given context.\n      *\n@@ -617,36 +586,26 @@ public void removeWelcomeFile(String hostName, String contextPath,\n     public void clearWelcomeFiles(String hostName, String contextPath,\n             String version) {\n         MappedHost[] hosts = this.hosts;\n-        int pos = find(hosts, hostName);\n-        if (pos < 0) {\n+        MappedHost host = exactFind(hosts, hostName);\n+        if (host == null) {\n             return;\n         }\n-        MappedHost host = hosts[pos];\n-        if (host.name.equals(hostName)) {\n-            MappedContext[] contexts = host.contextList.contexts;\n-            int pos2 = find(contexts, contextPath);\n-            if (pos2 < 0) {\n-                log.error(\"No context found: \" + contextPath );\n-                return;\n-            }\n-            MappedContext context = contexts[pos2];\n-            if (context.name.equals(contextPath)) {\n-                ContextVersion[] contextVersions = context.versions;\n-                int pos3 = find(contextVersions, version);\n-                if( pos3<0 ) {\n-                    log.error(\"No context version found: \" + contextPath + \" \" +\n-                            version);\n-                    return;\n-                }\n-                ContextVersion contextVersion = contextVersions[pos3];\n-                if (contextVersion.name.equals(version)) {\n-                    contextVersion.welcomeResources = new String[0];\n-                }\n-            }\n+        MappedContext[] contexts = host.contextList.contexts;\n+        MappedContext context = exactFind(contexts, contextPath);\n+        if (context == null) {\n+            log.error(\"No context found: \" + contextPath);\n+            return;\n+        }\n+        ContextVersion[] contextVersions = context.versions;\n+        ContextVersion contextVersion = exactFind(contextVersions, version);\n+        if (contextVersion == null) {\n+            log.error(\"No context version found: \" + contextPath + \" \"\n+                    + version);\n+            return;\n         }\n+        contextVersion.welcomeResources = new String[0];\n     }\n \n-\n     /**\n      * Map the specified host name and URI, mutating the given mapping data.\n      *\n@@ -712,24 +671,19 @@ private final void internalMap(CharChunk host, CharChunk uri,\n         // Virtual host mapping\n         if (mappingData.host == null) {\n             MappedHost[] hosts = this.hosts;\n-            int pos = findIgnoreCase(hosts, host);\n-            if ((pos != -1) && (host.equalsIgnoreCase(hosts[pos].name))) {\n-                mappingData.host = hosts[pos].object;\n-                contexts = hosts[pos].contextList.contexts;\n-                nesting = hosts[pos].contextList.nesting;\n-            } else {\n+            MappedHost mappedHost = exactFindIgnoreCase(hosts, host);\n+            if (mappedHost == null) {\n                 if (defaultHostName == null) {\n                     return;\n                 }\n-                pos = find(hosts, defaultHostName);\n-                if ((pos != -1) && (defaultHostName.equals(hosts[pos].name))) {\n-                    mappingData.host = hosts[pos].object;\n-                    contexts = hosts[pos].contextList.contexts;\n-                    nesting = hosts[pos].contextList.nesting;\n-                } else {\n+                mappedHost = exactFind(hosts, defaultHostName);\n+                if (mappedHost == null) {\n                     return;\n                 }\n             }\n+            mappingData.host = mappedHost.object;\n+            contexts = mappedHost.contextList.contexts;\n+            nesting = mappedHost.contextList.nesting;\n         }\n \n         // Context mapping\n@@ -764,13 +718,12 @@ private final void internalMap(CharChunk host, CharChunk uri,\n             }\n             uri.setEnd(uriEnd);\n \n-            if (!found) {\n-                if (contexts[0].name.equals(\"\")) {\n-                    context = contexts[0];\n-                }\n-            } else {\n+            if (found) {\n                 context = contexts[pos];\n+            } else if (contexts[0].name.equals(\"\")) {\n+                context = contexts[0];\n             }\n+\n             if (context != null) {\n                 mappingData.contextPath.setString(context.name);\n             }\n@@ -787,17 +740,12 @@ private final void internalMap(CharChunk host, CharChunk uri,\n                 mappingData.contexts = contextObjects;\n             }\n \n-            if (version == null) {\n+            if (version != null) {\n+                contextVersion = exactFind(contextVersions, version);\n+            }\n+            if (contextVersion == null) {\n                 // Return the latest version\n                 contextVersion = contextVersions[versionCount - 1];\n-            } else {\n-                int pos = find(contextVersions, version);\n-                if (pos < 0 || !contextVersions[pos].name.equals(version)) {\n-                    // Return the latest version\n-                    contextVersion = contextVersions[versionCount - 1];\n-                } else {\n-                    contextVersion = contextVersions[pos];\n-                }\n             }\n             mappingData.context = contextVersion.object;\n             mappingData.contextSlashCount = contextVersion.slashCount;\n@@ -1015,18 +963,18 @@ private final void internalMapWrapper(ContextVersion contextVersion,\n      */\n     private final void internalMapExactWrapper\n         (MappedWrapper[] wrappers, CharChunk path, MappingData mappingData) {\n-        int pos = find(wrappers, path);\n-        if ((pos != -1) && (path.equals(wrappers[pos].name))) {\n-            mappingData.requestPath.setString(wrappers[pos].name);\n-            mappingData.wrapper = wrappers[pos].object;\n+        MappedWrapper wrapper = exactFind(wrappers, path);\n+        if (wrapper != null) {\n+            mappingData.requestPath.setString(wrapper.name);\n+            mappingData.wrapper = wrapper.object;\n             if (path.equals(\"/\")) {\n                 // Special handling for Context Root mapped servlet\n                 mappingData.pathInfo.setString(\"/\");\n                 mappingData.wrapperPath.setString(\"\");\n                 // This seems wrong but it is what the spec says...\n                 mappingData.contextPath.setString(\"\");\n             } else {\n-                mappingData.wrapperPath.setString(wrappers[pos].name);\n+                mappingData.wrapperPath.setString(wrapper.name);\n             }\n         }\n     }\n@@ -1114,14 +1062,14 @@ private final void internalMapExtensionWrapper(MappedWrapper[] wrappers,\n             if (period >= 0) {\n                 path.setOffset(period + 1);\n                 path.setEnd(pathEnd);\n-                int pos = find(wrappers, path);\n-                if ((pos != -1) && (path.equals(wrappers[pos].name)) &&\n-                        (resourceExpected || !wrappers[pos].resourceOnly)) {\n-                    mappingData.wrapperPath.setChars\n-                        (buf, servletPath, pathEnd - servletPath);\n-                    mappingData.requestPath.setChars\n-                        (buf, servletPath, pathEnd - servletPath);\n-                    mappingData.wrapper = wrappers[pos].object;\n+                MappedWrapper wrapper = exactFind(wrappers, path);\n+                if (wrapper != null\n+                        && (resourceExpected || !wrapper.resourceOnly)) {\n+                    mappingData.wrapperPath.setChars(buf, servletPath, pathEnd\n+                            - servletPath);\n+                    mappingData.requestPath.setChars(buf, servletPath, pathEnd\n+                            - servletPath);\n+                    mappingData.wrapper = wrapper.object;\n                 }\n                 path.setOffset(servletPath);\n                 path.setEnd(pathEnd);\n@@ -1246,6 +1194,7 @@ private final void internalMapExtensionWrapper(MappedWrapper[] wrappers,\n      * Find a map element given its name in a sorted array of map elements.\n      * This will return the index for the closest inferior or equal item in the\n      * given array.\n+     * @see #exactFind(MapElement[], String)\n      */\n     private static final <T> int find(MapElement<T>[] map, String name) {\n \n@@ -1288,6 +1237,60 @@ private final void internalMapExtensionWrapper(MappedWrapper[] wrappers,\n     }\n \n \n+    /**\n+     * Find a map element given its name in a sorted array of map elements. This\n+     * will return the element that you were searching for. Otherwise it will\n+     * return <code>null</code>.\n+     * @see #find(MapElement[], String)\n+     */\n+    private static final <T, E extends MapElement<T>> E exactFind(E[] map,\n+            String name) {\n+        int pos = find(map, name);\n+        if (pos >= 0) {\n+            E result = map[pos];\n+            if (name.equals(result.name)) {\n+                return result;\n+            }\n+        }\n+        return null;\n+    }\n+\n+    /**\n+     * Find a map element given its name in a sorted array of map elements. This\n+     * will return the element that you were searching for. Otherwise it will\n+     * return <code>null</code>.\n+     */\n+    private static final <T, E extends MapElement<T>> E exactFind(E[] map,\n+            CharChunk name) {\n+        int pos = find(map, name);\n+        if (pos >= 0) {\n+            E result = map[pos];\n+            if (name.equals(result.name)) {\n+                return result;\n+            }\n+        }\n+        return null;\n+    }\n+\n+    /**\n+     * Find a map element given its name in a sorted array of map elements. This\n+     * will return the element that you were searching for. Otherwise it will\n+     * return <code>null</code>.\n+     * @see #findIgnoreCase(MapElement[], CharChunk)\n+     */\n+    private static final <T, E extends MapElement<T>> E exactFindIgnoreCase(\n+            E[] map, CharChunk name) {\n+        int pos = findIgnoreCase(map, name);\n+        if (pos >= 0) {\n+            E result = map[pos];\n+            if (name.equalsIgnoreCase(result.name)) {\n+                return result;\n+            }\n+        }\n+        return null;\n+    }\n+\n+\n     /**\n      * Compare given char chunk with String.\n      * Return -1, 0 or +1 if inferior, equal, or superior to the String.",
                "raw_url": "https://github.com/apache/tomcat80/raw/48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6/java/org/apache/catalina/mapper/Mapper.java",
                "sha": "7a963a558edf777b189ef5019e2e76332a8e76f4",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6/webapps/docs/changelog.xml",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -47,6 +47,10 @@\n <section name=\"Tomcat 8.0.10 (markt)\">\n   <subsection name=\"Catalina\">\n     <changelog>\n+      <fix>\n+        <bug>44312</bug>: Log an error if there is a conflict between Host and\n+        Alias names. (kkolinko)\n+      </fix>\n       <scode>\n         <bug>56611</bug>: Refactor code to remove inefficient calls to\n         <code>Method.isAnnotationPresent()</code>. Based on a patch by Jian Mou.",
                "raw_url": "https://github.com/apache/tomcat80/raw/48e2f27faf2b7c9eb087a883313a34bcb5d1e4e6/webapps/docs/changelog.xml",
                "sha": "5e0c393e9c202cce1b93ce4852c03c2361ac66c4",
                "status": "modified"
            }
        ],
        "message": "Fix http://issues.apache.org/bugzilla/show_bug.cgi?id=44312\nLog an error if there is a conflict between Host and Alias names.\n\nThis also includes the following:\n\n1. Implemented exactFind() methods that combine find() with a check that an exact match was found.\nThis allows to simplify the code.\n\n2. Fixed behaviour of Mapper.removeHost() in case if the host is not found. Now it won't throw an NPE.\n\n3. Fixed error logging of various Mapper.removeXxx() methods, where only \"(pos<0)\" case was logged as \"not found\". The change is that now it logs in wrong-match-found case as well.\nI did not introduce i18n there, as I do not see a real use case for those messages.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1604066 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/068893a5c8080b224cbac54e832984b37a40ac64",
        "patched_files": [
            "changelog.xml",
            "LocalStrings.properties",
            "Mapper.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestMapper.java"
        ]
    },
    "tomcat80_4da15b0": {
        "bug_id": "tomcat80_4da15b0",
        "commit": "https://github.com/apache/tomcat80/commit/4da15b07aa5f0c79462c254f75f2c4c14d0136df",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/4da15b07aa5f0c79462c254f75f2c4c14d0136df/java/org/apache/jasper/compiler/JspUtil.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/JspUtil.java?ref=4da15b07aa5f0c79462c254f75f2c4c14d0136df",
                "deletions": 0,
                "filename": "java/org/apache/jasper/compiler/JspUtil.java",
                "patch": "@@ -119,6 +119,7 @@ public static void checkAttributes(String typeOfTag, Node n,\n         int tempLength = (attrs == null) ? 0 : attrs.getLength();\n         Vector<String> temp = new Vector<String>(tempLength, 1);\n         for (int i = 0; i < tempLength; i++) {\n+            @SuppressWarnings(\"null\")  // If attrs==null, tempLength == 0\n             String qName = attrs.getQName(i);\n             if ((!qName.equals(\"xmlns\")) && (!qName.startsWith(\"xmlns:\")))\n                 temp.addElement(qName);",
                "raw_url": "https://github.com/apache/tomcat80/raw/4da15b07aa5f0c79462c254f75f2c4c14d0136df/java/org/apache/jasper/compiler/JspUtil.java",
                "sha": "1383f16d3d109da1c02a96a59a2d3ad1e97e6079",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tomcat80/blob/4da15b07aa5f0c79462c254f75f2c4c14d0136df/java/org/apache/jasper/compiler/PageDataImpl.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/PageDataImpl.java?ref=4da15b07aa5f0c79462c254f75f2c4c14d0136df",
                "deletions": 0,
                "filename": "java/org/apache/jasper/compiler/PageDataImpl.java",
                "patch": "@@ -510,6 +510,7 @@ private void appendPageDirective(Node.PageDirective n) {\n             Attributes attrs = n.getAttributes();\n             int len = (attrs == null) ? 0 : attrs.getLength();\n             for (int i=0; i<len; i++) {\n+                @SuppressWarnings(\"null\")  // If attrs==null, len == 0\n                 String attrName = attrs.getQName(i);\n                 if (!\"pageEncoding\".equals(attrName)\n                         && !\"contentType\".equals(attrName)) {\n@@ -530,6 +531,7 @@ private void appendPageDirective(Node.PageDirective n) {\n \n             // append remaining attributes\n             for (int i=0; i<len; i++) {\n+                @SuppressWarnings(\"null\")  // If attrs==null, len == 0\n                 String attrName = attrs.getQName(i);\n                 if (\"import\".equals(attrName) || \"contentType\".equals(attrName)\n                         || \"pageEncoding\".equals(attrName)) {\n@@ -601,6 +603,7 @@ private void appendTagDirective(Node.TagDirective n)\n             Attributes attrs = n.getAttributes();\n             int len = (attrs == null) ? 0 : attrs.getLength();\n             for (int i=0; i<len; i++) {\n+                @SuppressWarnings(\"null\")  // If attrs==null, len == 0\n                 String attrName = attrs.getQName(i);\n                 if (!\"pageEncoding\".equals(attrName)) {\n                     append = true;\n@@ -696,6 +699,7 @@ private void printAttributes(Node n, boolean addDefaultNS) {\n             Attributes attrs = n.getTaglibAttributes();\n             int len = (attrs == null) ? 0 : attrs.getLength();\n             for (int i=0; i<len; i++) {\n+                @SuppressWarnings(\"null\")  // If attrs==null, len == 0\n                 String name = attrs.getQName(i);\n                 String value = attrs.getValue(i);\n                 buf.append(\"  \").append(name).append(\"=\\\"\").append(value).append(\"\\\"\\n\");\n@@ -708,6 +712,7 @@ private void printAttributes(Node n, boolean addDefaultNS) {\n             len = (attrs == null) ? 0 : attrs.getLength();\n             boolean defaultNSSeen = false;\n             for (int i=0; i<len; i++) {\n+                @SuppressWarnings(\"null\")  // If attrs==null, len == 0\n                 String name = attrs.getQName(i);\n                 String value = attrs.getValue(i);\n                 buf.append(\"  \").append(name).append(\"=\\\"\").append(value).append(\"\\\"\\n\");\n@@ -724,6 +729,7 @@ private void printAttributes(Node n, boolean addDefaultNS) {\n             attrs = n.getAttributes();\n             len = (attrs == null) ? 0 : attrs.getLength();\n             for (int i=0; i<len; i++) {\n+                @SuppressWarnings(\"null\")  // If attrs==null, len == 0\n                 String name = attrs.getQName(i);\n                 String value = attrs.getValue(i);\n                 buf.append(\"  \").append(name).append(\"=\\\"\");",
                "raw_url": "https://github.com/apache/tomcat80/raw/4da15b07aa5f0c79462c254f75f2c4c14d0136df/java/org/apache/jasper/compiler/PageDataImpl.java",
                "sha": "665d74393d9042d9ef8be44f36a455bb7734a8b2",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/4da15b07aa5f0c79462c254f75f2c4c14d0136df/java/org/apache/jasper/compiler/Validator.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/Validator.java?ref=4da15b07aa5f0c79462c254f75f2c4c14d0136df",
                "deletions": 0,
                "filename": "java/org/apache/jasper/compiler/Validator.java",
                "patch": "@@ -896,6 +896,7 @@ public void visit(Node.JspElement n) throws JasperException {\n             if (attrs == null) {\n                 err.jspError(n, \"jsp.error.jspelement.missing.name\");\n             }\n+            @SuppressWarnings(\"null\") // Exception will have been thrown above\n             int xmlAttrLen = attrs.getLength();\n \n             Node.Nodes namedAttrs = n.getNamedAttributeNodes();",
                "raw_url": "https://github.com/apache/tomcat80/raw/4da15b07aa5f0c79462c254f75f2c4c14d0136df/java/org/apache/jasper/compiler/Validator.java",
                "sha": "ce6ee9f3b9f9a41b5cbabd0ec743d376328cdbd6",
                "status": "modified"
            }
        ],
        "message": "Fix some false npe warnings\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1154579 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/d158eee63a5cc96df3d597b0814de186afd6287a",
        "patched_files": [
            "Validator.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestValidator.java"
        ]
    },
    "tomcat80_5051dcd": {
        "bug_id": "tomcat80_5051dcd",
        "commit": "https://github.com/apache/tomcat80/commit/5051dcda5ab12e461bed38ff77d64f9f6aa83ce9",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/5051dcda5ab12e461bed38ff77d64f9f6aa83ce9/java/org/apache/tomcat/websocket/WsFrameClient.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsFrameClient.java?ref=5051dcda5ab12e461bed38ff77d64f9f6aa83ce9",
                "deletions": 0,
                "filename": "java/org/apache/tomcat/websocket/WsFrameClient.java",
                "patch": "@@ -37,7 +37,10 @@ public WsFrameClient(ByteBuffer response, AsyncChannelWrapper channel,\n         this.response = response;\n         this.channel = channel;\n         this.handler = new WsFrameClientCompletionHandler();\n+    }\n+\n \n+    void startInputProcessing() {\n         try {\n             processSocketRead();\n         } catch (IOException e) {",
                "raw_url": "https://github.com/apache/tomcat80/raw/5051dcda5ab12e461bed38ff77d64f9f6aa83ce9/java/org/apache/tomcat/websocket/WsFrameClient.java",
                "sha": "41cf71287fe18937d559e046ea7a06e1a0d5ead2",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/5051dcda5ab12e461bed38ff77d64f9f6aa83ce9/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java?ref=5051dcda5ab12e461bed38ff77d64f9f6aa83ce9",
                "deletions": 3,
                "filename": "java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "patch": "@@ -260,9 +260,7 @@ void startMessage(byte opCode, ByteBuffer payload, boolean last,\n         messageParts.add(new MessagePart(opCode, payload, last,\n                 new EndMessageHandler(this, handler)));\n \n-        if (transformation != null) {\n-            messageParts = transformation.sendMessagePart(messageParts);\n-        }\n+        messageParts = transformation.sendMessagePart(messageParts);\n \n         MessagePart mp = messageParts.remove(0);\n ",
                "raw_url": "https://github.com/apache/tomcat80/raw/5051dcda5ab12e461bed38ff77d64f9f6aa83ce9/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java",
                "sha": "e4a16e04bad51ca96b4ea09611ea255bb279576c",
                "status": "modified"
            },
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/tomcat80/blob/5051dcda5ab12e461bed38ff77d64f9f6aa83ce9/java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsWebSocketContainer.java?ref=5051dcda5ab12e461bed38ff77d64f9f6aa83ce9",
                "deletions": 6,
                "filename": "java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "patch": "@@ -316,22 +316,24 @@ public Session connectToServer(Endpoint endpoint,\n                     sm.getString(\"wsWebSocketContainer.httpRequestFailed\"), e);\n         }\n \n-        // TODO Add extension/transformation support to the client\n-\n         // Switch to WebSocket\n         WsRemoteEndpointImplClient wsRemoteEndpointClient = new WsRemoteEndpointImplClient(channel);\n \n         WsSession wsSession = new WsSession(endpoint, wsRemoteEndpointClient,\n                 this, null, null, null, null, null, subProtocol,\n                 Collections.<String, String> emptyMap(), secure,\n                 clientEndpointConfiguration);\n-        endpoint.onOpen(wsSession, clientEndpointConfiguration);\n-        registerSession(endpoint, wsSession);\n \n-        // Object creation will trigger input processing\n-        @SuppressWarnings(\"unused\")\n         WsFrameClient wsFrameClient = new WsFrameClient(response, channel,\n                 wsSession);\n+        // WsFrame adds the necessary final transformations. Copy the\n+        // completed transformation chain to the remote end point.\n+        wsRemoteEndpointClient.setTransformation(wsFrameClient.getTransformation());\n+\n+        endpoint.onOpen(wsSession, clientEndpointConfiguration);\n+        registerSession(endpoint, wsSession);\n+\n+        wsFrameClient.startInputProcessing();\n \n         return wsSession;\n     }",
                "raw_url": "https://github.com/apache/tomcat80/raw/5051dcda5ab12e461bed38ff77d64f9f6aa83ce9/java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "sha": "591e42965df958a2121c2f99a9e8590fbe99dd56",
                "status": "modified"
            }
        ],
        "message": "Fix root cause of NPE when using WebSocket clients.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1606653 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/59a648d056f9d4db4f76360b32cb15c1ad2e73b6",
        "patched_files": [
            "WsWebSocketContainer.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestWsWebSocketContainer.java"
        ]
    },
    "tomcat80_55192da": {
        "bug_id": "tomcat80_55192da",
        "commit": "https://github.com/apache/tomcat80/commit/55192da8e61ac69e1155af65f7077b97f3f7880f",
        "file": [
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tomcat80/blob/55192da8e61ac69e1155af65f7077b97f3f7880f/java/org/apache/coyote/Response.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/Response.java?ref=55192da8e61ac69e1155af65f7077b97f3f7880f",
                "deletions": 4,
                "filename": "java/org/apache/coyote/Response.java",
                "patch": "@@ -464,11 +464,14 @@ public void setContentType(String type) {\n \n         this.contentType = m.toStringNoCharset();\n \n-        String charsetValue = m.getCharset().trim();\n+        String charsetValue = m.getCharset();\n \n-        if (charsetValue != null && charsetValue.length() > 0) {\n-            charsetSet = true;\n-            this.characterEncoding = charsetValue;\n+        if (charsetValue != null) {\n+            charsetValue = charsetValue.trim();\n+            if (charsetValue.length() > 0) {\n+                charsetSet = true;\n+                this.characterEncoding = charsetValue;\n+            }\n         }\n     }\n ",
                "raw_url": "https://github.com/apache/tomcat80/raw/55192da8e61ac69e1155af65f7077b97f3f7880f/java/org/apache/coyote/Response.java",
                "sha": "b2eca8fe7ffa9fa5fc9d4575a156893ae8f8cc38",
                "status": "modified"
            }
        ],
        "message": "Avoid possible NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1552804 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/78f1151c1ab540f309dfb61a68252c5a75e0d26a",
        "patched_files": [
            "Response.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestResponse.java"
        ]
    },
    "tomcat80_5e07426": {
        "bug_id": "tomcat80_5e07426",
        "commit": "https://github.com/apache/tomcat80/commit/5e0742639558185a2a0a63b8ad5d7d75ec6055e0",
        "file": [
            {
                "additions": 17,
                "blob_url": "https://github.com/apache/tomcat80/blob/5e0742639558185a2a0a63b8ad5d7d75ec6055e0/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java",
                "changes": 27,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java?ref=5e0742639558185a2a0a63b8ad5d7d75ec6055e0",
                "deletions": 10,
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java",
                "patch": "@@ -102,9 +102,11 @@ protected String reportFailedQuery(String query, Object[] args, String name, lon\n             long now = System.currentTimeMillis();\n             long delta = now - start;\n             QueryStats qs = this.getQueryStats(sql);\n-            qs.failure(delta, now);\n-            if (isLogFailed() && log.isWarnEnabled()) {\n-                log.warn(\"Failed Query Report SQL=\"+sql+\"; time=\"+delta+\" ms;\");\n+            if (qs != null) {\n+                qs.failure(delta, now);\n+                if (isLogFailed() && log.isWarnEnabled()) {\n+                    log.warn(\"Failed Query Report SQL=\"+sql+\"; time=\"+delta+\" ms;\");\n+                }\n             }\n         }\n         return sql;\n@@ -115,7 +117,7 @@ protected String reportQuery(String query, Object[] args, final String name, lon\n         String sql = super.reportQuery(query, args, name, start, delta);\n         if (this.maxQueries > 0 ) {\n             QueryStats qs = this.getQueryStats(sql);\n-            qs.add(delta, start);\n+            if (qs != null) qs.add(delta, start);\n         }\n         return sql;\n     }\n@@ -125,9 +127,11 @@ protected String reportSlowQuery(String query, Object[] args, String name, long\n         String sql = super.reportSlowQuery(query, args, name, start, delta);\n         if (this.maxQueries > 0 ) {\n             QueryStats qs = this.getQueryStats(sql);\n-            qs.add(delta, start);\n-            if (isLogSlow() && log.isWarnEnabled()) {\n-                log.warn(\"Slow Query Report SQL=\"+sql+\"; time=\"+delta+\" ms;\");\n+            if (qs != null) {\n+                qs.add(delta, start);\n+                if (isLogSlow() && log.isWarnEnabled()) {\n+                    log.warn(\"Slow Query Report SQL=\"+sql+\"; time=\"+delta+\" ms;\");\n+                }\n             }\n         }\n         return sql;\n@@ -145,13 +149,13 @@ public void closeInvoked() {\n     @Override\n     public void prepareStatement(String sql, long time) {\n         QueryStats qs = getQueryStats(sql);\n-        qs.prepare(time);\n+        if (qs != null) qs.prepare(time);\n     }\n \n     @Override\n     public void prepareCall(String sql, long time) {\n         QueryStats qs = getQueryStats(sql);\n-        qs.prepare(time);\n+        if (qs != null) qs.prepare(time);\n     }\n \n     /**\n@@ -186,7 +190,10 @@ public void poolClosed(ConnectionPool pool) {\n     protected QueryStats getQueryStats(String sql) {\n         if (sql==null) sql = \"\";\n         ConcurrentHashMap<String,QueryStats> queries = SlowQueryReport.this.queries;\n-        if (queries==null) return null;\n+        if (queries==null) {\n+            if (log.isWarnEnabled()) log.warn(\"Connection has already been closed or abandoned\");\n+            return null;\n+        }\n         QueryStats qs = queries.get(sql);\n         if (qs == null) {\n             qs = new QueryStats(sql);",
                "raw_url": "https://github.com/apache/tomcat80/raw/5e0742639558185a2a0a63b8ad5d7d75ec6055e0/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java",
                "sha": "7f7a4021f1c3646d78e49f2fe923b7004f14b4ba",
                "status": "modified"
            }
        ],
        "message": "Avoid NPE if connection has been abandoned.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1686975 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/fe1a907ae2f8f1ce32570269a4a848ce2416d3ab",
        "patched_files": [
            "SlowQueryReport.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestSlowQueryReport.java"
        ]
    },
    "tomcat80_5e6bb3f": {
        "bug_id": "tomcat80_5e6bb3f",
        "commit": "https://github.com/apache/tomcat80/commit/5e6bb3f57008cab73a2dca0046a21108c80da06c",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/5e6bb3f57008cab73a2dca0046a21108c80da06c/java/org/apache/tomcat/websocket/BackgroundProcessManager.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/BackgroundProcessManager.java?ref=5e6bb3f57008cab73a2dca0046a21108c80da06c",
                "deletions": 1,
                "filename": "java/org/apache/tomcat/websocket/BackgroundProcessManager.java",
                "patch": "@@ -71,7 +71,7 @@ public void register(BackgroundProcess process) {\n     public void unregister(BackgroundProcess process) {\n         synchronized (processesLock) {\n             processes.remove(process);\n-            if (processes.size() == 0) {\n+            if (wsBackgroundThread != null && processes.size() == 0) {\n                 wsBackgroundThread.halt();\n                 wsBackgroundThread = null;\n             }",
                "raw_url": "https://github.com/apache/tomcat80/raw/5e6bb3f57008cab73a2dca0046a21108c80da06c/java/org/apache/tomcat/websocket/BackgroundProcessManager.java",
                "sha": "ccb6d868b77052ae0be5a2621a08760585bff352",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/5e6bb3f57008cab73a2dca0046a21108c80da06c/java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsWebSocketContainer.java?ref=5e6bb3f57008cab73a2dca0046a21108c80da06c",
                "deletions": 0,
                "filename": "java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "patch": "@@ -256,6 +256,10 @@ public Session connectToServer(Endpoint endpoint,\n \n \n     protected void registerSession(Class<?> endpoint, WsSession wsSession) {\n+        if (!wsSession.isOpen()) {\n+            // The session was closed during onOpen. No need to register it.\n+            return;\n+        }\n         synchronized (endPointSessionMapLock) {\n             if (endpointSessionMap.size() == 0) {\n                 BackgroundProcessManager.getInstance().register(this);",
                "raw_url": "https://github.com/apache/tomcat80/raw/5e6bb3f57008cab73a2dca0046a21108c80da06c/java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "sha": "b7ff5d6f5fb239276aba824d9b5b0ffb4f9b4623",
                "status": "modified"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54716\nAdditional fix. Avoid NPE on session de-registration.\nBased on a patch by Nick Williams.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1458484 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/928e645c6105d80ed74d858b7188cb057adfa98c",
        "patched_files": [
            "WsWebSocketContainer.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestWsWebSocketContainer.java"
        ]
    },
    "tomcat80_6033526": {
        "bug_id": "tomcat80_6033526",
        "commit": "https://github.com/apache/tomcat80/commit/6033526aa54a3b6ceb6a7d2f48db01a403f529a1",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/6033526aa54a3b6ceb6a7d2f48db01a403f529a1/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java?ref=6033526aa54a3b6ceb6a7d2f48db01a403f529a1",
                "deletions": 0,
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java",
                "patch": "@@ -149,6 +149,7 @@ public void poolClosed(ConnectionPool pool) {\n     }\n \n     protected QueryStats getQueryStats(String sql) {\n+        if (sql==null) sql = \"\";\n         ConcurrentHashMap<String,QueryStats> queries = SlowQueryReport.this.queries;\n         if (queries==null) return null;\n         QueryStats qs = queries.get(sql);",
                "raw_url": "https://github.com/apache/tomcat80/raw/6033526aa54a3b6ceb6a7d2f48db01a403f529a1/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java",
                "sha": "585ea18bbf4e370d323ed1ccee655761255a00b9",
                "status": "modified"
            }
        ],
        "message": "https://issues.apache.org/bugzilla/show_bug.cgi?id=51582\nFix NPE when the query is not available. This is a temporary work around until we know why SQL is null\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1189978 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/8cc3df2973be5f564bbbc1a8f0c5ff51e41da5ae",
        "patched_files": [
            "SlowQueryReport.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestSlowQueryReport.java"
        ]
    },
    "tomcat80_62958f8": {
        "bug_id": "tomcat80_62958f8",
        "commit": "https://github.com/apache/tomcat80/commit/62958f89b8d4a9a7800b5588e509685aa8bb23b9",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/62958f89b8d4a9a7800b5588e509685aa8bb23b9/test/org/apache/catalina/startup/TomcatBaseTest.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/startup/TomcatBaseTest.java?ref=62958f89b8d4a9a7800b5588e509685aa8bb23b9",
                "deletions": 1,
                "filename": "test/org/apache/catalina/startup/TomcatBaseTest.java",
                "patch": "@@ -304,7 +304,7 @@ public int getLength() {\n \n             @Override\n             public int available() {\n-                if (done) return 0;\n+                if (done || body == null) return 0;\n                 else return body.length;\n             }\n         };",
                "raw_url": "https://github.com/apache/tomcat80/raw/62958f89b8d4a9a7800b5588e509685aa8bb23b9/test/org/apache/catalina/startup/TomcatBaseTest.java",
                "sha": "fd03a912861a28bfb1d8d07e9aea05a29005bbec",
                "status": "modified"
            }
        ],
        "message": "Fix NPE triggered by r1356852\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1356867 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/3c0f43e97054f374c0bfcfa6d17820ad0ba4c7a9",
        "patched_files": [],
        "repo": "tomcat80",
        "unit_tests": [
            "TomcatBaseTest.java"
        ]
    },
    "tomcat80_63a92a6": {
        "bug_id": "tomcat80_63a92a6",
        "commit": "https://github.com/apache/tomcat80/commit/63a92a6343e2c5574e184a3be7350e7463290a4c",
        "file": [
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/tomcat80/blob/63a92a6343e2c5574e184a3be7350e7463290a4c/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/CoyoteAdapter.java?ref=63a92a6343e2c5574e184a3be7350e7463290a4c",
                "deletions": 1,
                "filename": "java/org/apache/catalina/connector/CoyoteAdapter.java",
                "patch": "@@ -249,6 +249,10 @@ public boolean event(org.apache.coyote.Request req,\n             req.getRequestProcessor().setWorkerThreadName(null);\n             // Recycle the wrapper request and response\n             if (error || response.isClosed() || !request.isComet()) {\n+                ((Context) request.getMappingData().context).logAccess(\n+                        request, response,\n+                        System.currentTimeMillis() - req.getStartTime(),\n+                        false);\n                 request.recycle();\n                 request.setFilterChain(null);\n                 response.recycle();\n@@ -430,9 +434,12 @@ public void service(org.apache.coyote.Request req,\n             } else if (!comet) {\n                 request.finishRequest();\n                 response.finishResponse();\n-                if (postParseSuccess) {\n+                if (postParseSuccess &&\n+                        request.getMappingData().context != null) {\n                     // Log only if processing was invoked.\n                     // If postParseRequest() failed, it has already logged it.\n+                    // If context is null this was the start of a comet request\n+                    // that failed and has already been logged.\n                     ((Context) request.getMappingData().context).logAccess(\n                             request, response,\n                             System.currentTimeMillis() - req.getStartTime(),",
                "raw_url": "https://github.com/apache/tomcat80/raw/63a92a6343e2c5574e184a3be7350e7463290a4c/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "sha": "e38fcdcb86439a4f0301e5c575e4ca0bb12f03b4",
                "status": "modified"
            },
            {
                "additions": 101,
                "blob_url": "https://github.com/apache/tomcat80/blob/63a92a6343e2c5574e184a3be7350e7463290a4c/test/org/apache/catalina/comet/TestCometProcessor.java",
                "changes": 131,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/comet/TestCometProcessor.java?ref=63a92a6343e2c5574e184a3be7350e7463290a4c",
                "deletions": 30,
                "filename": "test/org/apache/catalina/comet/TestCometProcessor.java",
                "patch": "@@ -36,12 +36,14 @@\n import org.junit.Test;\n \n import org.apache.catalina.Context;\n+import org.apache.catalina.Wrapper;\n import org.apache.catalina.comet.CometEvent.EventType;\n import org.apache.catalina.connector.CometEventImpl;\n import org.apache.catalina.connector.Request;\n import org.apache.catalina.connector.Response;\n import org.apache.catalina.startup.Tomcat;\n import org.apache.catalina.startup.TomcatBaseTest;\n+import org.apache.catalina.valves.TesterAccessLogValve;\n import org.apache.catalina.valves.ValveBase;\n \n public class TestCometProcessor extends TomcatBaseTest {\n@@ -116,16 +118,41 @@ public void testAsyncClose() throws Exception {\n \n     @Test\n     public void testSimpleCometClient() throws Exception {\n+        doSimpleCometTest(null);\n+    }\n+\n+    @Test\n+    public void testSimpleCometClientBeginFail() throws Exception {\n+        doSimpleCometTest(SimpleCometServlet.FAIL_ON_BEGIN);\n+    }\n \n+    @Test\n+    public void testSimpleCometClientReadFail() throws Exception {\n+        doSimpleCometTest(SimpleCometServlet.FAIL_ON_READ);\n+    }\n+\n+    @Test\n+    public void testSimpleCometClientEndFail() throws Exception {\n+        doSimpleCometTest(SimpleCometServlet.FAIL_ON_END);\n+    }\n+\n+    private void doSimpleCometTest(String initParam) throws Exception {\n         if (!isCometSupported()) {\n             return;\n         }\n \n         // Setup Tomcat instance\n         Tomcat tomcat = getTomcatInstance();\n         Context root = tomcat.addContext(\"\", TEMP_DIR);\n-        Tomcat.addServlet(root, \"comet\", new SimpleCometServlet());\n+        Wrapper w = Tomcat.addServlet(root, \"comet\", new SimpleCometServlet());\n+        if (initParam != null) {\n+            w.addInitParameter(initParam, \"true\");\n+        }\n         root.addServletMapping(\"/\", \"comet\");\n+\n+        TesterAccessLogValve alv = new TesterAccessLogValve();\n+        root.getPipeline().addValve(alv);\n+\n         tomcat.start();\n \n         // Create connection to Comet servlet\n@@ -151,36 +178,51 @@ public void testSimpleCometClient() throws Exception {\n         os.close();\n         is.close();\n \n-        // Validate response\n         String[] response = readThread.getResponse().split(\"\\r\\n\");\n-        assertEquals(\"HTTP/1.1 200 OK\", response[0]);\n-        assertEquals(\"Server: Apache-Coyote/1.1\", response[1]);\n-        assertTrue(response[2].startsWith(\"Set-Cookie: JSESSIONID=\"));\n-        assertEquals(\"Content-Type: text/plain;charset=ISO-8859-1\", response[3]);\n-        assertEquals(\"Transfer-Encoding: chunked\", response[4]);\n-        assertTrue(response[5].startsWith(\"Date: \"));\n-        assertEquals(\"\", response[6]);\n-        assertEquals(\"7\", response[7]);\n-        assertEquals(\"BEGIN\", response[8]);\n-        assertEquals(\"\", response[9]);\n-        assertEquals(\"17\", response[10]);\n-        assertEquals(\"Client: READ: 4 bytes\", response[11]);\n-        assertEquals(\"\", response[12]);\n-        assertEquals(\"17\", response[13]);\n-        assertEquals(\"Client: READ: 4 bytes\", response[14]);\n-        assertEquals(\"\", response[15]);\n-        assertEquals(\"17\", response[16]);\n-        assertEquals(\"Client: READ: 4 bytes\", response[17]);\n-        assertEquals(\"\", response[18]);\n-        assertEquals(\"17\", response[19]);\n-        assertEquals(\"Client: READ: 4 bytes\", response[20]);\n-        assertEquals(\"\", response[21]);\n-        assertEquals(\"d\", response[22]);\n-        assertEquals(\"Client: END\", response[23]);\n-        assertEquals(\"\", response[24]);\n-        assertEquals(\"0\", response[25]);\n-        // Expect 26 lines\n-        assertEquals(26, response.length);\n+        if (initParam == null) {\n+            // Normal response expected\n+            // Validate response\n+            assertEquals(\"HTTP/1.1 200 OK\", response[0]);\n+            assertEquals(\"Server: Apache-Coyote/1.1\", response[1]);\n+            assertTrue(response[2].startsWith(\"Set-Cookie: JSESSIONID=\"));\n+            assertEquals(\"Content-Type: text/plain;charset=ISO-8859-1\", response[3]);\n+            assertEquals(\"Transfer-Encoding: chunked\", response[4]);\n+            assertTrue(response[5].startsWith(\"Date: \"));\n+            assertEquals(\"\", response[6]);\n+            assertEquals(\"7\", response[7]);\n+            assertEquals(\"BEGIN\", response[8]);\n+            assertEquals(\"\", response[9]);\n+            assertEquals(\"17\", response[10]);\n+            assertEquals(\"Client: READ: 4 bytes\", response[11]);\n+            assertEquals(\"\", response[12]);\n+            assertEquals(\"17\", response[13]);\n+            assertEquals(\"Client: READ: 4 bytes\", response[14]);\n+            assertEquals(\"\", response[15]);\n+            assertEquals(\"17\", response[16]);\n+            assertEquals(\"Client: READ: 4 bytes\", response[17]);\n+            assertEquals(\"\", response[18]);\n+            assertEquals(\"17\", response[19]);\n+            assertEquals(\"Client: READ: 4 bytes\", response[20]);\n+            assertEquals(\"\", response[21]);\n+            assertEquals(\"d\", response[22]);\n+            assertEquals(\"Client: END\", response[23]);\n+            assertEquals(\"\", response[24]);\n+            assertEquals(\"0\", response[25]);\n+            // Expect 26 lines\n+            assertEquals(26, response.length);\n+        } else {\n+            // Failure expected only expected for the fail on begin\n+            // Failure at any later stage and the reponse headers (including the\n+            // 200 response code will already have been sent to the client\n+            if (initParam == SimpleCometServlet.FAIL_ON_BEGIN) {\n+                assertEquals(\"HTTP/1.1 500 Internal Server Error\", response[0]);\n+                alv.validateAccessLog(1, 500, 0, 1000);\n+            } else {\n+                assertEquals(\"HTTP/1.1 200 OK\", response[0]);\n+                alv.validateAccessLog(1, 200, 0, 5000);\n+            }\n+\n+        }\n     }\n \n     /**\n@@ -267,6 +309,26 @@ private boolean isCometSupported() {\n \n         private static final long serialVersionUID = 1L;\n \n+        public static final String FAIL_ON_BEGIN = \"failOnBegin\";\n+        public static final String FAIL_ON_READ = \"failOnRead\";\n+        public static final String FAIL_ON_END = \"failOnEnd\";\n+\n+        private boolean failOnBegin = false;\n+        private boolean failOnRead = false;\n+        private boolean failOnEnd = false;\n+\n+\n+        @Override\n+        public void init() throws ServletException {\n+            failOnBegin = Boolean.valueOf(getServletConfig().getInitParameter(\n+                    FAIL_ON_BEGIN)).booleanValue();\n+            failOnRead = Boolean.valueOf(getServletConfig().getInitParameter(\n+                    FAIL_ON_READ)).booleanValue();\n+            failOnEnd = Boolean.valueOf(getServletConfig().getInitParameter(\n+                    FAIL_ON_END)).booleanValue();\n+        }\n+\n+\n         @Override\n         public void event(CometEvent event) throws IOException,\n                 ServletException {\n@@ -278,9 +340,15 @@ public void event(CometEvent event) throws IOException,\n             session.setMaxInactiveInterval(30);\n \n             if (event.getEventType() == EventType.BEGIN) {\n+                if (failOnBegin) {\n+                    throw new IOException(\"Fail on begin\");\n+                }\n                 response.setContentType(\"text/plain\");\n                 response.getWriter().print(\"BEGIN\" + \"\\r\\n\");\n             } else if (event.getEventType() == EventType.READ) {\n+                if (failOnRead) {\n+                    throw new IOException(\"Fail on read\");\n+                }\n                 InputStream is = request.getInputStream();\n                 int count = 0;\n                 while (is.available() > 0) {\n@@ -290,6 +358,9 @@ public void event(CometEvent event) throws IOException,\n                 String msg = \"READ: \" + count + \" bytes\";\n                 response.getWriter().print(\"Client: \" + msg + \"\\r\\n\");\n             } else if (event.getEventType() == EventType.END) {\n+                if (failOnEnd) {\n+                    throw new IOException(\"Fail on end\");\n+                }\n                 String msg = \"END\";\n                 response.getWriter().print(\"Client: \" + msg + \"\\r\\n\");\n                 event.close();",
                "raw_url": "https://github.com/apache/tomcat80/raw/63a92a6343e2c5574e184a3be7350e7463290a4c/test/org/apache/catalina/comet/TestCometProcessor.java",
                "sha": "481bdd3bf4243671392c32ca3c96670c4953f6fc",
                "status": "modified"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52009\nFix the NPE if an error occurs during comet processing\nAdd test cases for errors during comet processing\nEnsure access log entries are made if an error occurs\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1183494 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/660456b211bf806107fdc23632f4b53e99a64534",
        "patched_files": [
            "CometProcessor.java",
            "CoyoteAdapter.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestCometProcessor.java",
            "TestCoyoteAdapter.java"
        ]
    },
    "tomcat80_65a4638": {
        "bug_id": "tomcat80_65a4638",
        "commit": "https://github.com/apache/tomcat80/commit/65a46388d124139fd5792a3953b136099f61aae0",
        "file": [
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/tomcat80/blob/65a46388d124139fd5792a3953b136099f61aae0/java/org/apache/catalina/servlets/WebdavServlet.java",
                "changes": 16,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/servlets/WebdavServlet.java?ref=65a46388d124139fd5792a3953b136099f61aae0",
                "deletions": 7,
                "filename": "java/org/apache/catalina/servlets/WebdavServlet.java",
                "patch": "@@ -1337,13 +1337,15 @@ protected void doLock(HttpServletRequest req, HttpServletResponse resp)\n             LockInfo toRenew = resourceLocks.get(path);\n             Enumeration<String> tokenList = null;\n \n-            // At least one of the tokens of the locks must have been given\n-            tokenList = toRenew.tokens.elements();\n-            while (tokenList.hasMoreElements()) {\n-                String token = tokenList.nextElement();\n-                if (ifHeader.indexOf(token) != -1) {\n-                    toRenew.expiresAt = lock.expiresAt;\n-                    lock = toRenew;\n+            if (toRenew != null) {\n+                // At least one of the tokens of the locks must have been given\n+                tokenList = toRenew.tokens.elements();\n+                while (tokenList.hasMoreElements()) {\n+                    String token = tokenList.nextElement();\n+                    if (ifHeader.indexOf(token) != -1) {\n+                        toRenew.expiresAt = lock.expiresAt;\n+                        lock = toRenew;\n+                    }\n                 }\n             }\n ",
                "raw_url": "https://github.com/apache/tomcat80/raw/65a46388d124139fd5792a3953b136099f61aae0/java/org/apache/catalina/servlets/WebdavServlet.java",
                "sha": "d08dbd0207b2d76f9ef28e2dec898005cf6d3fbb",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/65a46388d124139fd5792a3953b136099f61aae0/webapps/docs/changelog.xml",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=65a46388d124139fd5792a3953b136099f61aae0",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -85,6 +85,9 @@\n         <bug>51344</bug>: Fix problem with Lifecycle re-factoring for deprecated\n         embedded class that prevented events being triggered. (markt) \n       </fix>\n+      <fix>\n+        Prevent possible NPE when processing WebDAV locks. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/65a46388d124139fd5792a3953b136099f61aae0/webapps/docs/changelog.xml",
                "sha": "9545dcecf1d6c72dcce4376492ae69b7d70d4da4",
                "status": "modified"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51348\nPrevent possible NPE when processing WebDAV locks.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1134048 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/b49117759b180a1b2c04138e4f636530b4f6ea4f",
        "patched_files": [
            "WebdavServlet.java",
            "changelog.xml"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestWebdavServlet.java"
        ]
    },
    "tomcat80_66cbdea": {
        "bug_id": "tomcat80_66cbdea",
        "commit": "https://github.com/apache/tomcat80/commit/66cbdeaa71d345aa35c776e9c08921b2929efbc2",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/66cbdeaa71d345aa35c776e9c08921b2929efbc2/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/server/WsServerContainer.java?ref=66cbdeaa71d345aa35c776e9c08921b2929efbc2",
                "deletions": 1,
                "filename": "java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "patch": "@@ -403,7 +403,10 @@ private void registerAuthenticatedSession(WsSession wsSession,\n     private void unregisterAuthenticatedSession(WsSession wsSession,\n             String httpSessionId) {\n         Set<WsSession> wsSessions = authenticatedSessions.get(httpSessionId);\n-        wsSessions.remove(wsSession);\n+        // wsSessions will be null if the HTTP session has ended\n+        if (wsSessions != null) {\n+            wsSessions.remove(wsSession);\n+        }\n     }\n \n ",
                "raw_url": "https://github.com/apache/tomcat80/raw/66cbdeaa71d345aa35c776e9c08921b2929efbc2/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "sha": "4f196825dcd3b43783345bbaf7b851cf60b86bc2",
                "status": "modified"
            }
        ],
        "message": "Fix NPE reported on users list when HTTP session ends\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1546372 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/9b33cb8ad7d2e9c60a51234db274321f15d9ef1c",
        "patched_files": [
            "WsServerContainer.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestWsServerContainer.java"
        ]
    },
    "tomcat80_6a067b5": {
        "bug_id": "tomcat80_6a067b5",
        "commit": "https://github.com/apache/tomcat80/commit/6a067b521d9a04cac0f75565b1eac00713fc4d6b",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/6a067b521d9a04cac0f75565b1eac00713fc4d6b/java/org/apache/jasper/util/FastRemovalDequeue.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/util/FastRemovalDequeue.java?ref=6a067b521d9a04cac0f75565b1eac00713fc4d6b",
                "deletions": 1,
                "filename": "java/org/apache/jasper/util/FastRemovalDequeue.java",
                "patch": "@@ -174,7 +174,7 @@ public synchronized T pop() {\n      * Removes any element of the list and returns its content.\n      **/\n     public synchronized void remove(final Entry element) {\n-        if (!element.getValid()) {\n+        if (element == null || !element.getValid()) {\n             return;\n         }\n         Entry next = element.getNext();",
                "raw_url": "https://github.com/apache/tomcat80/raw/6a067b521d9a04cac0f75565b1eac00713fc4d6b/java/org/apache/jasper/util/FastRemovalDequeue.java",
                "sha": "3a7cc220f182bfd692b74aa515cc47ffecf97791",
                "status": "modified"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54260\nAvoid NPE when using JSP unloading and tag files.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1428355 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/91fc32b77f019a6f75ce4f20b4186973bb1291f3",
        "patched_files": [
            "FastRemovalDequeue.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestFastRemovalDequeue.java"
        ]
    },
    "tomcat80_6cc8e2e": {
        "bug_id": "tomcat80_6cc8e2e",
        "commit": "https://github.com/apache/tomcat80/commit/6cc8e2e4306ad86c7ec71c581f3eb11ff067de59",
        "file": [
            {
                "additions": 21,
                "blob_url": "https://github.com/apache/tomcat80/blob/6cc8e2e4306ad86c7ec71c581f3eb11ff067de59/java/org/apache/catalina/webresources/StandardRoot.java",
                "changes": 21,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/webresources/StandardRoot.java?ref=6cc8e2e4306ad86c7ec71c581f3eb11ff067de59",
                "deletions": 0,
                "filename": "java/org/apache/catalina/webresources/StandardRoot.java",
                "patch": "@@ -117,6 +117,9 @@ public StandardRoot(Context context) {\n         if (validate) {\n             path = validate(path);\n         }\n+        if (path == null) {\n+            return new String[] {};\n+        }\n \n         // Set because we don't want duplicates\n         // LinkedHashSet to retain the order. It is the order of the\n@@ -140,6 +143,9 @@ public StandardRoot(Context context) {\n     @Override\n     public Set<String> listWebAppPaths(String path) {\n         path = validate(path);\n+        if (path == null) {\n+            return null;\n+        }\n \n         // Set because we don't want duplicates\n         HashSet<String> result = new HashSet<>();\n@@ -159,6 +165,9 @@ public StandardRoot(Context context) {\n     @Override\n     public boolean mkdir(String path) {\n         path = validate(path);\n+        if (path == null) {\n+            return false;\n+        }\n \n         if (preResourceExists(path)) {\n             return false;\n@@ -170,6 +179,9 @@ public boolean mkdir(String path) {\n     @Override\n     public boolean write(String path, InputStream is, boolean overwrite) {\n         path = validate(path);\n+        if (path == null) {\n+            return false;\n+        }\n \n         if (!overwrite && preResourceExists(path)) {\n             return false;\n@@ -198,6 +210,9 @@ private WebResource getResource(String path, boolean validate,\n         if (validate) {\n             path = validate(path);\n         }\n+        if (path == null) {\n+            return null;\n+        }\n \n         if (isCachingAllowed()) {\n             return cache.getResource(path, useClassLoaderResources);\n@@ -280,6 +295,9 @@ protected final WebResource getResourceInternal(String path,\n     private WebResource[] getResources(String path,\n             boolean useClassLoaderResources) {\n         path = validate(path);\n+        if (path == null) {\n+            return new WebResource[] {};\n+        }\n \n         ArrayList<WebResource> result = new ArrayList<>();\n         for (ArrayList<WebResourceSet> list : allResources) {\n@@ -309,6 +327,9 @@ protected final WebResource getResourceInternal(String path,\n         if (validate) {\n             path = validate(path);\n         }\n+        if (path == null) {\n+            return new WebResource[] {};\n+        }\n \n         String[] resources = list(path, false);\n         WebResource[] result = new WebResource[resources.length];",
                "raw_url": "https://github.com/apache/tomcat80/raw/6cc8e2e4306ad86c7ec71c581f3eb11ff067de59/java/org/apache/catalina/webresources/StandardRoot.java",
                "sha": "16aa5ede9275616a65dac2bc49eaca6b7d0c8c0b",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/6cc8e2e4306ad86c7ec71c581f3eb11ff067de59/webapps/docs/changelog.xml",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=6cc8e2e4306ad86c7ec71c581f3eb11ff067de59",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -74,6 +74,10 @@\n         elements and attributes supported by the Servlet version of the merged\n         file. (markt)\n       </fix>\n+      <fix>\n+        Avoid internal <code>NullPointerException</code>s if a resource is\n+        requested from outside the web application root. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/6cc8e2e4306ad86c7ec71c581f3eb11ff067de59/webapps/docs/changelog.xml",
                "sha": "bbb5d0efff926a06afebb2083c21e72333c15039",
                "status": "modified"
            }
        ],
        "message": "Avoid internal NullPointerExceptions if a resource is requested from outside the web application root.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1573321 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/70068f19489d674d04ef09b971ce29b7bdbb4f77",
        "patched_files": [
            "StandardRoot.java",
            "changelog.xml"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestStandardRoot.java"
        ]
    },
    "tomcat80_7699864": {
        "bug_id": "tomcat80_7699864",
        "commit": "https://github.com/apache/tomcat80/commit/76998644c2465473e886211fbf9bc42932d07be5",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/76998644c2465473e886211fbf9bc42932d07be5/java/org/apache/catalina/startup/ContextConfig.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/startup/ContextConfig.java?ref=76998644c2465473e886211fbf9bc42932d07be5",
                "deletions": 0,
                "filename": "java/org/apache/catalina/startup/ContextConfig.java",
                "patch": "@@ -2101,6 +2101,9 @@ private void populateJavaClassCache(String className) {\n             String name = className.replace('.', '/') + \".class\";\n             InputStream is =\n                     context.getLoader().getClassLoader().getResourceAsStream(name);\n+            if (is == null) {\n+                return;\n+            }\n             ClassParser parser = new ClassParser(is, null);\n             try {\n                 JavaClass clazz = parser.parse();",
                "raw_url": "https://github.com/apache/tomcat80/raw/76998644c2465473e886211fbf9bc42932d07be5/java/org/apache/catalina/startup/ContextConfig.java",
                "sha": "cf4887b9113bdad2cdc6c9dd8434d1456dc197da",
                "status": "modified"
            }
        ],
        "message": "Avoid NPE if class / interface is not present\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1239024 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/858dc0a4f7f8069237abda6454e1536270880b59",
        "patched_files": [
            "ContextConfig.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestContextConfig.java"
        ]
    },
    "tomcat80_78d7976": {
        "bug_id": "tomcat80_78d7976",
        "commit": "https://github.com/apache/tomcat80/commit/78d7976e2c456b312a9aff971721d47c66ca480f",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/78d7976e2c456b312a9aff971721d47c66ca480f/java/org/apache/catalina/filters/RemoteIpFilter.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/filters/RemoteIpFilter.java?ref=78d7976e2c456b312a9aff971721d47c66ca480f",
                "deletions": 2,
                "filename": "java/org/apache/catalina/filters/RemoteIpFilter.java",
                "patch": "@@ -859,8 +859,9 @@ public void doFilter(HttpServletRequest request, HttpServletResponse response, F\n             }\n \n             HttpServletResponse xResponse;\n-            if (!xRequest.getScheme().equals(request.getScheme()) ||\n-                    xRequest.getServerPort() != request.getServerPort()) {\n+            if (xRequest.getScheme() != null &&\n+                    (!xRequest.getScheme().equals(request.getScheme()) ||\n+                    xRequest.getServerPort() != request.getServerPort())) {\n                 xResponse = new XForwardedResponse(response, xRequest.getScheme(), xRequest.getServerPort());\n             } else {\n                 xResponse = response;",
                "raw_url": "https://github.com/apache/tomcat80/raw/78d7976e2c456b312a9aff971721d47c66ca480f/java/org/apache/catalina/filters/RemoteIpFilter.java",
                "sha": "6dc2b31f39cd512dd3fa6ff112010aae705ea019",
                "status": "modified"
            }
        ],
        "message": "Fix NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1687433 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/d1512649e7996f403be825f949039dd855e455d6",
        "patched_files": [
            "RemoteIpFilter.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestRemoteIpFilter.java"
        ]
    },
    "tomcat80_7a450a6": {
        "bug_id": "tomcat80_7a450a6",
        "commit": "https://github.com/apache/tomcat80/commit/7a450a6f04418ec1eebf0f5791ca6bf06e3d9a9d",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tomcat80/blob/7a450a6f04418ec1eebf0f5791ca6bf06e3d9a9d/java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/WsWebSocketContainer.java?ref=7a450a6f04418ec1eebf0f5791ca6bf06e3d9a9d",
                "deletions": 2,
                "filename": "java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "patch": "@@ -190,8 +190,12 @@ public Session connectToServer(Object pojo, URI path)\n             }\n         }\n \n-        ClientEndpointConfig config = ClientEndpointConfig.Builder.create().\n-                configurator(configurator).\n+        ClientEndpointConfig.Builder builder = ClientEndpointConfig.Builder.create();\n+        // Avoid NPE when using RI API JAR - see BZ 56343\n+        if (configurator != null) {\n+            builder.configurator(configurator);\n+        }\n+        ClientEndpointConfig config = builder.\n                 decoders(Arrays.asList(annotation.decoders())).\n                 encoders(Arrays.asList(annotation.encoders())).\n                 build();",
                "raw_url": "https://github.com/apache/tomcat80/raw/7a450a6f04418ec1eebf0f5791ca6bf06e3d9a9d/java/org/apache/tomcat/websocket/WsWebSocketContainer.java",
                "sha": "8d099367c75fceb5ba77fece996007e6080e819b",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/tomcat80/blob/7a450a6f04418ec1eebf0f5791ca6bf06e3d9a9d/webapps/docs/changelog.xml",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=7a450a6f04418ec1eebf0f5791ca6bf06e3d9a9d",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -138,6 +138,15 @@\n       </fix>\n     </changelog>\n   </subsection>\n+  <subsection name=\"WebSocket\">\n+    <changelog>\n+      <fix>\n+        <bug>56343</bug>: Avoid a NPE if Tomcat&apos;s Java WebSocket 1.0\n+        implementation is used with the Java WebSocket 1.0 API JAR from the\n+        reference implementation. (markt)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection name=\"Web applications\">\n     <changelog>\n       <fix>",
                "raw_url": "https://github.com/apache/tomcat80/raw/7a450a6f04418ec1eebf0f5791ca6bf06e3d9a9d/webapps/docs/changelog.xml",
                "sha": "a3f18a11f9e8b3b84a5585c01460fc289f8dc5f7",
                "status": "modified"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56343\nAvoid NPE if WebSocket API JAR from RI is used.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1584922 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/7e59abe631c91819505c3d2961bee62dce3a286b",
        "patched_files": [
            "WsWebSocketContainer.java",
            "changelog.xml"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestWsWebSocketContainer.java"
        ]
    },
    "tomcat80_8027c55": {
        "bug_id": "tomcat80_8027c55",
        "commit": "https://github.com/apache/tomcat80/commit/8027c55543233a44f9e13f270fde2284cee539f6",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/8027c55543233a44f9e13f270fde2284cee539f6/java/org/apache/jasper/servlet/TldScanner.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/servlet/TldScanner.java?ref=8027c55543233a44f9e13f270fde2284cee539f6",
                "deletions": 0,
                "filename": "java/org/apache/jasper/servlet/TldScanner.java",
                "patch": "@@ -397,6 +397,9 @@ public void scanWebInfClasses() throws IOException {\n             // IDEs.\n \n             Set<String> paths = context.getResourcePaths(WEB_INF + \"classes/META-INF\");\n+            if (paths == null) {\n+                return;\n+            }\n \n             for (String path : paths) {\n                 if (path.endsWith(TLD_EXT)) {",
                "raw_url": "https://github.com/apache/tomcat80/raw/8027c55543233a44f9e13f270fde2284cee539f6/java/org/apache/jasper/servlet/TldScanner.java",
                "sha": "d95f676c2a640e0e09b493aaefbc4197ffca12f1",
                "status": "modified"
            },
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/tomcat80/blob/8027c55543233a44f9e13f270fde2284cee539f6/webapps/docs/changelog.xml",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=8027c55543233a44f9e13f270fde2284cee539f6",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -74,6 +74,14 @@\n       </fix>\n     </changelog>\n   </subsection>\n+  <subsection name=\"Jasper\">\n+    <changelog>\n+      <fix>\n+        <bug>59567</bug>: Fix NPE scanning webapps for TLDs when an exploded\n+        JAR has an empty WEB-INF/classes/META-INF folder. (remm)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection name=\"Other\">\n     <changelog>\n       <update>",
                "raw_url": "https://github.com/apache/tomcat80/raw/8027c55543233a44f9e13f270fde2284cee539f6/webapps/docs/changelog.xml",
                "sha": "54f6c6640de4d25472dd274ed1eb2e640affe6cf",
                "status": "modified"
            }
        ],
        "message": "59567: Fix a rare NPE scanning for TLDs\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1744434 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/48b2d8ad6cb938f445d2dd009c8bbeb27d470713",
        "patched_files": [
            "TldScanner.java",
            "changelog.xml"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestTldScanner.java"
        ]
    },
    "tomcat80_8036b19": {
        "bug_id": "tomcat80_8036b19",
        "commit": "https://github.com/apache/tomcat80/commit/8036b1905fc2cfdfd200873c7c7da1d03ba5dc3b",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/8036b1905fc2cfdfd200873c7c7da1d03ba5dc3b/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/server/WsServerContainer.java?ref=8036b1905fc2cfdfd200873c7c7da1d03ba5dc3b",
                "deletions": 1,
                "filename": "java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "patch": "@@ -347,7 +347,7 @@ protected void unregisterSession(Endpoint endpoint, WsSession wsSession) {\n     private void registerAuthenticatedSession(WsSession wsSession,\n             String httpSessionId) {\n         Set<WsSession> wsSessions = authenticatedSessions.get(httpSessionId);\n-        if (wsSession == null) {\n+        if (wsSessions == null) {\n             wsSessions = Collections.newSetFromMap(\n                      new ConcurrentHashMap<WsSession,Boolean>());\n              authenticatedSessions.putIfAbsent(httpSessionId, wsSessions);",
                "raw_url": "https://github.com/apache/tomcat80/raw/8036b1905fc2cfdfd200873c7c7da1d03ba5dc3b/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "sha": "d111cb4917321692eae7b72265bc657c89787e37",
                "status": "modified"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55291\nAvoid NPE when registering a session. Patch provided by rstoyanchev.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1505689 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/f830be1c9709dc0aa1a0859e983f5d3c1abfb1aa",
        "patched_files": [
            "WsServerContainer.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestWsServerContainer.java"
        ]
    },
    "tomcat80_818a9a9": {
        "bug_id": "tomcat80_818a9a9",
        "commit": "https://github.com/apache/tomcat80/commit/818a9a962bdfab5bf66d330734c0225c0877f64a",
        "file": [
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tomcat80/blob/818a9a962bdfab5bf66d330734c0225c0877f64a/java/org/apache/catalina/connector/Request.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/Request.java?ref=818a9a962bdfab5bf66d330734c0225c0877f64a",
                "deletions": 3,
                "filename": "java/org/apache/catalina/connector/Request.java",
                "patch": "@@ -2513,9 +2513,13 @@ private void parseParts() {\n                 parts.add(part);\n                 if (part.getFilename() == null) {\n                     try {\n-                        parameters.addParameterValues(part.getName(),\n+                        String encoding = parameters.getEncoding();\n+                        if(encoding == null) {\n+                        \tencoding = Parameters.DEFAULT_ENCODING;\n+                        }\n+ \t\t\t\t\t\tparameters.addParameterValues(part.getName(),\n                                 new String[] {part.getString(\n-                                        parameters.getEncoding())});\n+                                        encoding)});\n                     } catch (UnsupportedEncodingException uee) {\n                         try {\n                             parameters.addParameterValues(part.getName(),\n@@ -2533,7 +2537,7 @@ private void parseParts() {\n         } catch (FileUploadBase.SizeException e) {\n             partsParseException = new IllegalStateException(e);\n         } catch (FileUploadException e) {\n-            partsParseException = new IOException();\n+            partsParseException = new IOException(e);\n         }\n         \n         return;",
                "raw_url": "https://github.com/apache/tomcat80/raw/818a9a962bdfab5bf66d330734c0225c0877f64a/java/org/apache/catalina/connector/Request.java",
                "sha": "f187eacdfc96caed57f84524c4057d2297eb2755",
                "status": "modified"
            }
        ],
        "message": "Fix NPE if no encoding parameter exists at request!\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@939639 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/7b2dc061c7e6483cde3dbc51ee7f7df9f1fc9832",
        "patched_files": [
            "Request.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestRequest.java"
        ]
    },
    "tomcat80_81b3662": {
        "bug_id": "tomcat80_81b3662",
        "commit": "https://github.com/apache/tomcat80/commit/81b36625d33f1e25c416dfd9dd1c92e139d7582e",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tomcat80/blob/81b36625d33f1e25c416dfd9dd1c92e139d7582e/java/org/apache/catalina/connector/LocalStrings.properties",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/LocalStrings.properties?ref=81b36625d33f1e25c416dfd9dd1c92e139d7582e",
                "deletions": 0,
                "filename": "java/org/apache/catalina/connector/LocalStrings.properties",
                "patch": "@@ -63,6 +63,8 @@ coyoteResponse.setBufferSize.ise=Cannot change buffer size after data has been w\n \n inputBuffer.streamClosed=Stream closed\n \n+outputBuffer.writeNull=The String argument to write(String,int,int) may not be null\n+\n request.asyncNotSupported=A filter or servlet of the current chain does not support asynchronous operations.\n \n requestFacade.nullRequest=The request object has been recycled and is no longer associated with this facade",
                "raw_url": "https://github.com/apache/tomcat80/raw/81b36625d33f1e25c416dfd9dd1c92e139d7582e/java/org/apache/catalina/connector/LocalStrings.properties",
                "sha": "14c40ad98bf9feda3bd156d5a1c021ad9413a07c",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tomcat80/blob/81b36625d33f1e25c416dfd9dd1c92e139d7582e/java/org/apache/catalina/connector/OutputBuffer.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/OutputBuffer.java?ref=81b36625d33f1e25c416dfd9dd1c92e139d7582e",
                "deletions": 1,
                "filename": "java/org/apache/catalina/connector/OutputBuffer.java",
                "patch": "@@ -32,6 +32,7 @@\n import org.apache.tomcat.util.buf.ByteChunk;\n import org.apache.tomcat.util.buf.C2BConverter;\n import org.apache.tomcat.util.buf.CharChunk;\n+import org.apache.tomcat.util.res.StringManager;\n \n /**\n  * The buffer used by Tomcat response. This is a derivative of the Tomcat 3.3\n@@ -44,6 +45,9 @@\n public class OutputBuffer extends Writer\n     implements ByteChunk.ByteOutputChannel, CharChunk.CharOutputChannel {\n \n+    private static final StringManager sm =\n+            StringManager.getManager(Constants.Package);\n+\n     // -------------------------------------------------------------- Constants\n \n     public static final String DEFAULT_ENCODING =\n@@ -524,7 +528,7 @@ public void write(String s, int off, int len)\n         }\n \n         if (s == null) {\n-            s = \"null\";\n+            throw new NullPointerException(sm.getString(\"outputBuffer.writeNull\"));\n         }\n         cb.append(s, off, len);\n         charsWritten += len;",
                "raw_url": "https://github.com/apache/tomcat80/raw/81b36625d33f1e25c416dfd9dd1c92e139d7582e/java/org/apache/catalina/connector/OutputBuffer.java",
                "sha": "4a3265061517afd1bb17440d500d5fda7c4c6739",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tomcat80/blob/81b36625d33f1e25c416dfd9dd1c92e139d7582e/webapps/docs/changelog.xml",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=81b36625d33f1e25c416dfd9dd1c92e139d7582e",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -169,6 +169,12 @@\n         Update storeconfig with newly introduced elements: SessionIdGenerator,\n         CookieProcessor, JarScanner and JarScanFilter. (remm)\n       </fix>\n+      <fix>\n+        Throw a <code>NullPointerException</code> if a null string is passed to\n+        the <code>write(String,int,int)</code> method of the\n+        <code>PrintWriter</code> obtained from the <code>ServletResponse</code>.\n+        (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/81b36625d33f1e25c416dfd9dd1c92e139d7582e/webapps/docs/changelog.xml",
                "sha": "00aaa1221e7e43a8336b52a060929aead5c53f1a",
                "status": "modified"
            }
        ],
        "message": "Throw a NPE if a null string is passed to the write(String,int,int) method of the PrintWriter obtained from the ServletResponse.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1634139 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/69ea86fe54e7bd929e053703129c1ba1ccecce95",
        "patched_files": [
            "LocalStrings.properties",
            "changelog.xml",
            "OutputBuffer.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestOutputBuffer.java"
        ]
    },
    "tomcat80_81be4f6": {
        "bug_id": "tomcat80_81be4f6",
        "commit": "https://github.com/apache/tomcat80/commit/81be4f6f86eca01102721a3b5de6913b5ef6eb49",
        "file": [
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tomcat80/blob/81be4f6f86eca01102721a3b5de6913b5ef6eb49/java/org/apache/catalina/core/DefaultInstanceManager.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/DefaultInstanceManager.java?ref=81be4f6f86eca01102721a3b5de6913b5ef6eb49",
                "deletions": 5,
                "filename": "java/org/apache/catalina/core/DefaultInstanceManager.java",
                "patch": "@@ -423,11 +423,6 @@ protected void populateAnnotationsCache(Class<?> clazz,\n                             new WeakReference<List<AnnotationCacheEntry>>(\n                                     annotations));\n                 }\n-            } else {\n-                // If the annotations for this class have been cached, the\n-                // annotations for all the super classes will have been cachced\n-                // as well\n-                break;\n             }\n             clazz = clazz.getSuperclass();\n         }",
                "raw_url": "https://github.com/apache/tomcat80/raw/81be4f6f86eca01102721a3b5de6913b5ef6eb49/java/org/apache/catalina/core/DefaultInstanceManager.java",
                "sha": "eaac06f76936b5d27e37ac7727e42ee140deaf3b",
                "status": "modified"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52042\nCorrect threading issue in annotation caching that could lead to an\nNPE if multiple threads were processing the same class hierarchy for\nannotations\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1186042 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/1cbec226c87bda22f05d792e47847e793b24447a",
        "patched_files": [
            "DefaultInstanceManager.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestDefaultInstanceManager.java"
        ]
    },
    "tomcat80_856b281": {
        "bug_id": "tomcat80_856b281",
        "commit": "https://github.com/apache/tomcat80/commit/856b28186141781e36fbdbe59112a56a88e113d6",
        "file": [
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/doc/jdbc-pool.xml",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/doc/jdbc-pool.xml?ref=856b28186141781e36fbdbe59112a56a88e113d6",
                "deletions": 0,
                "filename": "modules/jdbc-pool/doc/jdbc-pool.xml",
                "patch": "@@ -274,6 +274,15 @@\n          Example values are <code>SELECT 1</code>(mysql), <code>select 1 from dual</code>(oracle), <code>SELECT 1</code>(MS Sql Server)\n       </p>\n     </attribute>\n+    \n+    <attribute name=\"validationQueryTimeout\" required=\"false\">\n+      <p>(int) The timeout in seconds before a connection validation queries fail.  This works by calling \n+         <code>java.sql.Statement.setQueryTimeout(seconds)</code> on the statement that executes the <code>validationQuery</code>.\n+         The pool itself doesn't timeout the query, it is still up to the JDBC driver to enforce query timeouts. \n+         A value less than or equal to zero will disable this feature. \n+         The default value is <code>-1</code>.\n+      </p>\n+    </attribute>\n \n     <attribute name=\"validatorClassName\" required=\"false\">\n       <p>(String) The name of a class which implements the",
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/doc/jdbc-pool.xml",
                "sha": "81eecf25d44ef6f2c942da19eddd330ac26e8d99",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java?ref=856b28186141781e36fbdbe59112a56a88e113d6",
                "deletions": 2,
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java",
                "patch": "@@ -712,7 +712,7 @@ protected PooledConnection createConnection(long now, PooledConnection notUsed,\n             } else {\n                 //validation failed, make sure we disconnect\n                 //and clean up\n-                error =true;\n+                throw new SQLException(\"Validation Query Failed, enable logValidationErrors for more details.\");\n             } //end if\n         } catch (Exception e) {\n             error = true;\n@@ -732,7 +732,6 @@ protected PooledConnection createConnection(long now, PooledConnection notUsed,\n             }\n             con.unlock();\n         }//catch\n-        return null;\n     }\n \n     /**",
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java",
                "sha": "0b2dcdb4b323466be340ff9f678b30c5c7ea32f4",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java?ref=856b28186141781e36fbdbe59112a56a88e113d6",
                "deletions": 0,
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java",
                "patch": "@@ -80,6 +80,7 @@\n     protected static final String PROP_TESTWHILEIDLE = \"testWhileIdle\";\n     protected static final String PROP_TESTONCONNECT = \"testOnConnect\";\n     protected static final String PROP_VALIDATIONQUERY = \"validationQuery\";\n+    protected static final String PROP_VALIDATIONQUERY_TIMEOUT = \"validationQueryTimeout\";\n     protected static final String PROP_VALIDATOR_CLASS_NAME = \"validatorClassName\";\n \n     protected static final String PROP_NUMTESTSPEREVICTIONRUN = \"numTestsPerEvictionRun\";\n@@ -151,6 +152,7 @@\n         PROP_URL,\n         PROP_USERNAME,\n         PROP_VALIDATIONQUERY,\n+        PROP_VALIDATIONQUERY_TIMEOUT,\n         PROP_VALIDATOR_CLASS_NAME,\n         PROP_VALIDATIONINTERVAL,\n         PROP_ACCESSTOUNDERLYINGCONNECTIONALLOWED,\n@@ -369,6 +371,11 @@ public static PoolConfiguration parsePoolProperties(Properties properties) {\n         if (value != null) {\n             poolProperties.setValidationQuery(value);\n         }\n+        \n+        value = properties.getProperty(PROP_VALIDATIONQUERY_TIMEOUT);\n+        if (value != null) {\n+            poolProperties.setValidationQueryTimeout(Integer.parseInt(value));\n+        }\n \n         value = properties.getProperty(PROP_VALIDATOR_CLASS_NAME);\n         if (value != null) {",
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java",
                "sha": "6d204ee7d6af4397485488620d583a96c57f432a",
                "status": "modified"
            },
            {
                "additions": 18,
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java",
                "changes": 18,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java?ref=856b28186141781e36fbdbe59112a56a88e113d6",
                "deletions": 0,
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java",
                "patch": "@@ -452,6 +452,15 @@ public void setValidationQuery(String validationQuery) {\n     public void setValidatorClassName(String className) {\n         this.poolProperties.setValidatorClassName(className);\n     }\n+    \n+    /**\n+     * {@inheritDoc}\n+     */\n+    \n+    @Override\n+    public void setValidationQueryTimeout(int validationQueryTimeout) {\n+        this.poolProperties.setValidationQueryTimeout(validationQueryTimeout);\n+    }\n \n     /**\n      * {@inheritDoc}\n@@ -925,6 +934,15 @@ public String getValidationQuery() {\n         return getPoolProperties().getValidationQuery();\n     }\n \n+    /**\n+     * {@inheritDoc}\n+     */\n+    \n+    @Override\n+    public int getValidationQueryTimeout() {\n+        return getPoolProperties().getValidationQueryTimeout();\n+    }\n+    \n     /**\n      * {@inheritDoc}\n      */",
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java",
                "sha": "3e3af9ada851b61fda4329a3aa10621e1e1de22d",
                "status": "modified"
            },
            {
                "additions": 13,
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java?ref=856b28186141781e36fbdbe59112a56a88e113d6",
                "deletions": 0,
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java",
                "patch": "@@ -523,6 +523,19 @@\n      */\n     public void setValidationQuery(String validationQuery);\n \n+    /**\n+     * The timeout in seconds before a connection validation queries fail.\n+     * A value less than or equal to zero will disable this feature.  Defaults to -1. \n+     * @return the timeout value in seconds \n+     */\n+    public int getValidationQueryTimeout();\n+    \n+    /**\n+     * The timeout in seconds before a connection validation queries fail.\n+     * A value less than or equal to zero will disable this feature.  Defaults to -1. \n+     */\n+    public void setValidationQueryTimeout(int validationQueryTimeout);\n+    \n     /**\n      * Return the name of the optional validator class - may be null.\n      *",
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java",
                "sha": "bc854cc7440da9a03bcc6f98cb978384c3a16caa",
                "status": "modified"
            },
            {
                "additions": 17,
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java",
                "changes": 17,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java?ref=856b28186141781e36fbdbe59112a56a88e113d6",
                "deletions": 0,
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java",
                "patch": "@@ -57,6 +57,7 @@\n     private volatile int minIdle = initialSize;\n     private volatile int maxWait = 30000;\n     private volatile String validationQuery;\n+    private volatile int validationQueryTimeout = -1;\n     private volatile String validatorClassName;\n     private volatile Validator validator;\n     private volatile boolean testOnBorrow = false;\n@@ -379,6 +380,22 @@ public String getValidationQuery() {\n         return validationQuery;\n     }\n \n+    /**\n+     * {@inheritDoc}\n+     */\n+    @Override\n+    public int getValidationQueryTimeout() {\n+        return validationQueryTimeout;\n+    }\n+    \n+    /**\n+     * {@inheritDoc}\n+     */\n+    @Override\n+    public void setValidationQueryTimeout(int validationQueryTimeout) {\n+        this.validationQueryTimeout = validationQueryTimeout;\n+    }\n+    \n     /**\n      * {@inheritDoc}\n      */",
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java",
                "sha": "136a2c5fdcfbdd9a019036d93727e3164d70b686",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java?ref=856b28186141781e36fbdbe59112a56a88e113d6",
                "deletions": 0,
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java",
                "patch": "@@ -451,6 +451,12 @@ public boolean validate(int validateAction,String sql) {\n         Statement stmt = null;\n         try {\n             stmt = connection.createStatement();\n+            \n+            int validationQueryTimeout = poolProperties.getValidationQueryTimeout();\n+            if (validationQueryTimeout > 0) {\n+                stmt.setQueryTimeout(validationQueryTimeout);\n+            }\n+            \n             stmt.execute(query);\n             stmt.close();\n             this.lastValidated = now;",
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java",
                "sha": "02a986896348af8594d1038f89d43f9c3d907c59",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java?ref=856b28186141781e36fbdbe59112a56a88e113d6",
                "deletions": 0,
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java",
                "patch": "@@ -310,6 +310,11 @@ public long getValidationInterval() {\n     public String getValidationQuery() {\n         return getPoolProperties().getValidationQuery();\n     }\n+    \n+    @Override\n+    public int getValidationQueryTimeout() {\n+        return getPoolProperties().getValidationQueryTimeout();\n+    }\n \n     /**\n      * {@inheritDoc}\n@@ -664,6 +669,11 @@ public void setValidationQuery(String validationQuery) {\n         getPoolProperties().setValidationQuery(validationQuery);\n     }\n \n+    @Override\n+    public void setValidationQueryTimeout(int validationQueryTimeout) {\n+        getPoolProperties().setValidationQueryTimeout(validationQueryTimeout);\n+    }\n+    \n     /**\n      * {@inheritDoc}\n      */",
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java",
                "sha": "66013d9a30b8dd9bab9343151cdc183618c663c5",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/mbeans-descriptors.xml",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/mbeans-descriptors.xml?ref=856b28186141781e36fbdbe59112a56a88e113d6",
                "deletions": 0,
                "filename": "modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/mbeans-descriptors.xml",
                "patch": "@@ -125,6 +125,11 @@\n            description=\"The query to run during validation\"\n                   type=\"java.lang.String\"\n              writeable=\"false\"/>\n+             \n+    <attribute    name=\"validationQueryTimeout\"\n+           description=\"The timeout in seconds before a connection validation queries fail\"\n+                  type=\"java.lang.Integer\"\n+             writeable=\"false\" />\n \n     <attribute    name=\"testOnBorrow\"\n            description=\"True if validation happens when a connection is requested\"",
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/mbeans-descriptors.xml",
                "sha": "0e6682ebdd6085491af58b824ec4fccb37d994c2",
                "status": "modified"
            },
            {
                "additions": 249,
                "blob_url": "https://github.com/apache/tomcat80/blob/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/test/java/org/apache/tomcat/jdbc/test/TestValidationQueryTimeout.java",
                "changes": 249,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/modules/jdbc-pool/src/test/java/org/apache/tomcat/jdbc/test/TestValidationQueryTimeout.java?ref=856b28186141781e36fbdbe59112a56a88e113d6",
                "deletions": 0,
                "filename": "modules/jdbc-pool/src/test/java/org/apache/tomcat/jdbc/test/TestValidationQueryTimeout.java",
                "patch": "@@ -0,0 +1,249 @@\n+package org.apache.tomcat.jdbc.test;\n+\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.DriverPropertyInfo;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.sql.SQLFeatureNotSupportedException;\n+import java.sql.Statement;\n+import java.util.Properties;\n+import java.util.logging.Logger;\n+\n+import junit.framework.Assert;\n+\n+import org.apache.tomcat.jdbc.pool.interceptor.QueryTimeoutInterceptor;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+public class TestValidationQueryTimeout extends DefaultTestCase {\n+    \n+    private static int TIMEOUT = 10;\n+    private static boolean isTimeoutSet;\n+    private static final String longQuery = \"select * from test as A, test as B, test as C, test as D, test as E\";\n+    \n+    @Before\n+    public void setUp() throws SQLException {\n+        DriverManager.registerDriver(new MockDriver());\n+        \n+        // use our mock driver\n+        this.datasource.setDriverClassName(MockDriver.class.getName());\n+        this.datasource.setUrl(MockDriver.url);\n+        \n+        // Required to trigger validation query's execution \n+        this.datasource.setInitialSize(1);\n+        this.datasource.setTestOnBorrow(true);\n+        this.datasource.setValidationInterval(-1);\n+        this.datasource.setValidationQuery(\"SELECT 1\");\n+        this.datasource.setValidationQueryTimeout(TIMEOUT);\n+        \n+        TIMEOUT = 10;\n+        isTimeoutSet = false;\n+    }\n+    \n+    @After\n+    public void tearDown() throws SQLException {\n+        DriverManager.deregisterDriver(new MockDriver());\n+    }\n+    \n+    @Test\n+    public void testValidationQueryTimeoutEnabled() throws Exception {\n+        // because testOnBorrow is true, this triggers the validation query\n+        this.datasource.getConnection();\n+        Assert.assertTrue(isTimeoutSet);\n+    }\n+    \n+    @Test\n+    public void testValidationQueryTimeoutDisabled() throws Exception {\n+        this.datasource.setValidationQueryTimeout(-1);\n+        \n+        // because testOnBorrow is true, this triggers the validation query\n+        this.datasource.getConnection();\n+        Assert.assertFalse(isTimeoutSet);\n+    }\n+    \n+    @Test\n+    public void testValidationQueryTimeoutWithQueryTimeoutInterceptor() throws Exception {\n+        int interceptorTimeout = 30;\n+        this.datasource.setJdbcInterceptors(\n+                            QueryTimeoutInterceptor.class.getName()+\n+                            \"(queryTimeout=\"+ interceptorTimeout +\")\");\n+        \n+        // because testOnBorrow is true, this triggers the validation query\n+        Connection con = this.datasource.getConnection();\n+        Assert.assertTrue(isTimeoutSet);\n+        \n+        // increase the expected timeout to 30, which is what we set for the interceptor\n+        TIMEOUT = 30;\n+        \n+        // now create a statement, make sure the query timeout is set by the interceptor\n+        Statement st = con.createStatement();\n+        Assert.assertEquals(interceptorTimeout, st.getQueryTimeout());\n+        st.close();\n+        st = con.prepareStatement(\"\");\n+        Assert.assertEquals(interceptorTimeout, st.getQueryTimeout());\n+        st.close();\n+        st = con.prepareCall(\"\");\n+        Assert.assertEquals(interceptorTimeout, st.getQueryTimeout());\n+        st.close();\n+        con.close();\n+        \n+        // pull another connection and check it\n+        TIMEOUT = 10;\n+        isTimeoutSet = false;\n+        this.datasource.getConnection();\n+        Assert.assertTrue(isTimeoutSet);\n+    }\n+    \n+    // this test depends on the execution time of the validation query\n+    //   specifically, it needs to run for longer than 1 second to pass\n+    //   if this fails\n+    @Test(expected=SQLException.class) \n+    public void testValidationQueryTimeoutOnConnection() throws Exception {\n+        // use our mock driver\n+        this.datasource.setDriverClassName(\"org.h2.Driver\");\n+        this.datasource.setUrl(\"jdbc:h2:~/.h2/test;QUERY_TIMEOUT=0;DB_CLOSE_ON_EXIT=FALSE\");\n+        \n+        // Required to trigger validation query's execution \n+        this.datasource.setTestOnConnect(true);\n+        this.datasource.setValidationInterval(-1);\n+        this.datasource.setValidationQuery(longQuery);\n+        this.datasource.setValidationQueryTimeout(1);\n+        \n+        this.datasource.getConnection();\n+    }\n+    \n+    @Test(expected=SQLException.class)\n+    public void testValidationInvalidOnConnection() throws Exception {\n+        // use our mock driver\n+        this.datasource.setDriverClassName(\"org.h2.Driver\");\n+        this.datasource.setUrl(\"jdbc:h2:~/.h2/test;QUERY_TIMEOUT=0;DB_CLOSE_ON_EXIT=FALSE\");\n+        \n+        // Required to trigger validation query's execution \n+        this.datasource.setTestOnBorrow(true);\n+        this.datasource.setInitialSize(1);\n+        this.datasource.setTestOnConnect(true);\n+        this.datasource.setValidationInterval(-1);\n+        this.datasource.setValidationQuery(\"SELECT\");\n+        this.datasource.setValidationQueryTimeout(1);\n+        \n+        this.datasource.getConnection();\n+    }\n+    \n+    @Test\n+    public void testLongValidationQueryTime() throws Exception {\n+        // use our mock driver\n+        this.datasource.setDriverClassName(\"org.h2.Driver\");\n+        this.datasource.setUrl(\"jdbc:h2:~/.h2/test;QUERY_TIMEOUT=0;DB_CLOSE_ON_EXIT=FALSE\");\n+        Connection con = this.datasource.getConnection();\n+        Statement stmt = null;\n+        long start = 0, end = 0;\n+        try {\n+            stmt = con.createStatement();\n+            // set the query timeout to 2 sec\n+            //  this keeps this test from slowing things down too much\n+            stmt.setQueryTimeout(2);\n+            // assert that our long query takes longer than one second to run\n+            //  this is a requirement for other tests to run properly\n+            start = System.currentTimeMillis();\n+            stmt.execute(longQuery);\n+        } catch (SQLException ex) {}\n+        finally {\n+            end = System.currentTimeMillis();\n+        \n+            if (stmt != null) { stmt.close(); }\n+            if (con != null) { con.close(); }\n+            \n+            Assert.assertTrue(start != 0 && end != 0);\n+            Assert.assertTrue((end - start) > 1000);\n+        }\n+    }\n+    \n+    @Test\n+    public void testValidationQueryTimeoutOnBorrow() throws Exception {\n+        // use our mock driver\n+        this.datasource.setDriverClassName(\"org.h2.Driver\");\n+        this.datasource.setUrl(\"jdbc:h2:~/.h2/test;QUERY_TIMEOUT=0;DB_CLOSE_ON_EXIT=FALSE\");\n+        \n+        // Required to trigger validation query's execution \n+        this.datasource.setTestOnBorrow(true);\n+        this.datasource.setValidationInterval(-1);\n+        this.datasource.setValidationQuery(longQuery);\n+        this.datasource.setValidationQueryTimeout(1);\n+        \n+        // assert that even though the validation query times out, we still get a connection\n+        Connection con = this.datasource.getConnection();\n+        Assert.assertNotNull(con);\n+        Statement st = con.createStatement();\n+        ResultSet rs = st.executeQuery(\"SELECT 1\");\n+        rs.close();\n+        st.close();\n+        con.close();\n+    }\n+    \n+    /**\n+     * Mock Driver, Connection and Statement implementations use to verify setQueryTimeout was called.\n+     */\n+    public static class MockDriver implements java.sql.Driver {\n+        public static final String url = \"jdbc:tomcat:mock\";\n+\n+        public MockDriver() {\n+        }\n+\n+        @Override\n+        public boolean acceptsURL(String url) throws SQLException {\n+            return url!=null && url.equals(MockDriver.url);\n+        }\n+\n+        @Override\n+        public Connection connect(String url, Properties info) throws SQLException {\n+            return new MockConnection(info);\n+        }\n+\n+        @Override\n+        public int getMajorVersion() {\n+            return 0;\n+        }\n+\n+        @Override\n+        public int getMinorVersion() {\n+            return 0;\n+        }\n+\n+        @Override\n+        public DriverPropertyInfo[] getPropertyInfo(String url, Properties info) throws SQLException {\n+            return null;\n+        }\n+\n+        @Override\n+        public boolean jdbcCompliant() {\n+            return false;\n+        }\n+\n+        @Override\n+        public Logger getParentLogger() throws SQLFeatureNotSupportedException {\n+            return null;\n+        }\n+    }\n+    \n+    public static class MockConnection extends org.apache.tomcat.jdbc.test.driver.Connection {\n+        public MockConnection(Properties info) {\n+            super(info);\n+        }\n+\n+        @Override\n+        public Statement createStatement() throws SQLException {\n+            return new MockStatement();\n+        }\n+    }\n+    \n+    public static class MockStatement extends org.apache.tomcat.jdbc.test.driver.Statement {\n+        @Override\n+        public void setQueryTimeout(int seconds) throws SQLException {\n+            super.setQueryTimeout(seconds);\n+            Assert.assertEquals(TIMEOUT, seconds);\n+            isTimeoutSet = true;\n+        }\n+    }\n+}",
                "raw_url": "https://github.com/apache/tomcat80/raw/856b28186141781e36fbdbe59112a56a88e113d6/modules/jdbc-pool/src/test/java/org/apache/tomcat/jdbc/test/TestValidationQueryTimeout.java",
                "sha": "c681e52828c5818f982d82473635d7ea65f99204",
                "status": "added"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54693.\n- Add a validationQueryTimeout property\n- Avoid NPE caused by createConnection(..) returns null. (see Comment 6)\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1521024 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/591de4be74f0ea552b124f3be8e9d395664ff389",
        "patched_files": [
            "PoolProperties.java",
            "PooledConnection.java",
            "DataSourceProxy.java",
            "jdbc-pool.xml",
            "mbeans-descriptors.xml",
            "ConnectionPool.java",
            "PoolConfiguration.java",
            "DataSourceFactory.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestValidationQueryTimeout.java"
        ]
    },
    "tomcat80_860e0c3": {
        "bug_id": "tomcat80_860e0c3",
        "commit": "https://github.com/apache/tomcat80/commit/860e0c31a8b8f2d158e0ed094480d72188b1a18c",
        "file": [
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tomcat80/blob/860e0c31a8b8f2d158e0ed094480d72188b1a18c/java/org/apache/tomcat/util/scan/AbstractInputStreamJar.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/scan/AbstractInputStreamJar.java?ref=860e0c31a8b8f2d158e0ed094480d72188b1a18c",
                "deletions": 3,
                "filename": "java/org/apache/tomcat/util/scan/AbstractInputStreamJar.java",
                "patch": "@@ -163,11 +163,15 @@ public void reset() throws IOException {\n         if (multiRelease == null) {\n             if (JreCompat.isJre9Available()) {\n                 Manifest manifest = jarInputStream.getManifest();\n-                String mrValue = manifest.getMainAttributes().getValue(\"Multi-Release\");\n-                if (mrValue == null) {\n+                if (manifest == null) {\n                     multiRelease = Boolean.FALSE;\n                 } else {\n-                    multiRelease = Boolean.valueOf(mrValue);\n+                    String mrValue = manifest.getMainAttributes().getValue(\"Multi-Release\");\n+                    if (mrValue == null) {\n+                        multiRelease = Boolean.FALSE;\n+                    } else {\n+                        multiRelease = Boolean.valueOf(mrValue);\n+                    }\n                 }\n             } else {\n                 multiRelease = Boolean.FALSE;",
                "raw_url": "https://github.com/apache/tomcat80/raw/860e0c31a8b8f2d158e0ed094480d72188b1a18c/java/org/apache/tomcat/util/scan/AbstractInputStreamJar.java",
                "sha": "e765c463b4eef2c4b52da9a78a380ec8ca6802a9",
                "status": "modified"
            }
        ],
        "message": "Avoid possible NPE if no manifest is present.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1815327 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/59a6d2fa55ac9b4b0457fe949be50628adf998e1",
        "patched_files": [
            "AbstractInputStreamJar.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestAbstractInputStreamJar.java"
        ]
    },
    "tomcat80_881e4d4": {
        "bug_id": "tomcat80_881e4d4",
        "commit": "https://github.com/apache/tomcat80/commit/881e4d4e67d81ad9a297fcc9bae753557a5b0604",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/881e4d4e67d81ad9a297fcc9bae753557a5b0604/java/org/apache/coyote/http11/AbstractHttp11Processor.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/coyote/http11/AbstractHttp11Processor.java?ref=881e4d4e67d81ad9a297fcc9bae753557a5b0604",
                "deletions": 1,
                "filename": "java/org/apache/coyote/http11/AbstractHttp11Processor.java",
                "patch": "@@ -898,7 +898,10 @@ public final void action(ActionCode actionCode, Object param) {\n             break;\n         }\n         case DISPATCH_EXECUTE: {\n-            getEndpoint().executeNonBlockingDispatches(socketWrapper);\n+            SocketWrapper<S> wrapper = socketWrapper;\n+            if (wrapper != null) {\n+                getEndpoint().executeNonBlockingDispatches(wrapper);\n+            }\n             break;\n         }\n         case CLOSE_NOW: {",
                "raw_url": "https://github.com/apache/tomcat80/raw/881e4d4e67d81ad9a297fcc9bae753557a5b0604/java/org/apache/coyote/http11/AbstractHttp11Processor.java",
                "sha": "57f66cb542f1d301e6730d8c55abc6705773c0ae",
                "status": "modified"
            }
        ],
        "message": "Avoid possible NPE (unlikely but observed while stepping through code investogating BZ 56739)\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1616204 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/c5bf93a6dd4d7ba2cc92e948d9c9124fa89db1a9",
        "patched_files": [
            "AbstractHttp11Processor.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestAbstractHttp11Processor.java"
        ]
    },
    "tomcat80_8975107": {
        "bug_id": "tomcat80_8975107",
        "commit": "https://github.com/apache/tomcat80/commit/89751070d7066131b84fc57adaf4aa6c0aae237b",
        "file": [
            {
                "additions": 15,
                "blob_url": "https://github.com/apache/tomcat80/blob/89751070d7066131b84fc57adaf4aa6c0aae237b/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "changes": 27,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/CoyoteAdapter.java?ref=89751070d7066131b84fc57adaf4aa6c0aae237b",
                "deletions": 12,
                "filename": "java/org/apache/catalina/connector/CoyoteAdapter.java",
                "patch": "@@ -25,6 +25,7 @@\n import javax.servlet.ReadListener;\n import javax.servlet.RequestDispatcher;\n import javax.servlet.SessionTrackingMode;\n+import javax.servlet.WriteListener;\n import javax.servlet.http.HttpServletResponse;\n \n import org.apache.catalina.Context;\n@@ -313,14 +314,15 @@ public boolean asyncDispatch(org.apache.coyote.Request req,\n                 Throwable t = (Throwable)req.getAttribute(\n                         RequestDispatcher.ERROR_EXCEPTION);\n                 req.getAttributes().remove(RequestDispatcher.ERROR_EXCEPTION);\n-                if (req.getReadListener() != null) {\n+                ReadListener readListener = req.getReadListener();\n+                if (readListener != null) {\n                     ClassLoader oldCL =\n                             Thread.currentThread().getContextClassLoader();\n                     ClassLoader newCL =\n                             request.getContext().getLoader().getClassLoader();\n                     try {\n                         Thread.currentThread().setContextClassLoader(newCL);\n-                        req.getReadListener().onError(t);\n+                        readListener.onError(t);\n                     } finally {\n                         Thread.currentThread().setContextClassLoader(oldCL);\n                     }\n@@ -355,41 +357,42 @@ public boolean asyncDispatch(org.apache.coyote.Request req,\n \n             // Check to see if non-blocking writes or reads are being used\n             if (!request.isAsyncDispatching() && request.isAsync()) {\n-                if (res.getWriteListener() != null &&\n-                        status == SocketStatus.OPEN_WRITE) {\n+                WriteListener writeListener = res.getWriteListener();\n+                ReadListener readListener = req.getReadListener();\n+                if (writeListener != null && status == SocketStatus.OPEN_WRITE) {\n                     ClassLoader oldCL =\n                             Thread.currentThread().getContextClassLoader();\n                     ClassLoader newCL =\n                             request.getContext().getLoader().getClassLoader();\n                     try {\n                         Thread.currentThread().setContextClassLoader(newCL);\n                         res.onWritePossible();\n-                        if (request.isFinished() && req.sendAllDataReadEvent()) {\n-                            req.getReadListener().onAllDataRead();\n+                        if (request.isFinished() && req.sendAllDataReadEvent() &&\n+                                readListener != null) {\n+                            readListener.onAllDataRead();\n                         }\n                     } catch (Throwable t) {\n                         ExceptionUtils.handleThrowable(t);\n-                        res.getWriteListener().onError(t);\n+                        writeListener.onError(t);\n                         throw t;\n                     } finally {\n                         Thread.currentThread().setContextClassLoader(oldCL);\n                     }\n                     success = true;\n-                } else if (req.getReadListener() != null &&\n-                        status == SocketStatus.OPEN_READ) {\n+                } else if (readListener != null && status == SocketStatus.OPEN_READ) {\n                     ClassLoader oldCL =\n                             Thread.currentThread().getContextClassLoader();\n                     ClassLoader newCL =\n                             request.getContext().getLoader().getClassLoader();\n                     try {\n                         Thread.currentThread().setContextClassLoader(newCL);\n-                        req.getReadListener().onDataAvailable();\n+                        readListener.onDataAvailable();\n                         if (request.isFinished() && req.sendAllDataReadEvent()) {\n-                            req.getReadListener().onAllDataRead();\n+                            readListener.onAllDataRead();\n                         }\n                     } catch (Throwable t) {\n                         ExceptionUtils.handleThrowable(t);\n-                        req.getReadListener().onError(t);\n+                        readListener.onError(t);\n                         throw t;\n                     } finally {\n                         Thread.currentThread().setContextClassLoader(oldCL);",
                "raw_url": "https://github.com/apache/tomcat80/raw/89751070d7066131b84fc57adaf4aa6c0aae237b/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "sha": "c59b5ffdbf48fdcef108e76cf5bda99fe3ead964",
                "status": "modified"
            }
        ],
        "message": "Avoid NPEs if asyncContext is completed by listener\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1545801 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/0e4aa717854539253ed67b4818fb86015a787ab6",
        "patched_files": [
            "CoyoteAdapter.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestCoyoteAdapter.java"
        ]
    },
    "tomcat80_8ea3473": {
        "bug_id": "tomcat80_8ea3473",
        "commit": "https://github.com/apache/tomcat80/commit/8ea34734e24362e84be84325b88690e9e5f87f1a",
        "file": [
            {
                "additions": 23,
                "blob_url": "https://github.com/apache/tomcat80/blob/8ea34734e24362e84be84325b88690e9e5f87f1a/java/org/apache/catalina/startup/WebXml.java",
                "changes": 36,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/startup/WebXml.java?ref=8ea34734e24362e84be84325b88690e9e5f87f1a",
                "deletions": 13,
                "filename": "java/org/apache/catalina/startup/WebXml.java",
                "patch": "@@ -590,9 +590,11 @@ public String toXml() {\n             appendElement(sb, INDENT4, \"enabled\", servletDef.getEnabled());\n             appendElement(sb, INDENT4, \"async-supported\",\n                     servletDef.getAsyncSupported());\n-            sb.append(\"    <run-as>\\n\");\n-            appendElement(sb, INDENT6, \"role-name\", servletDef.getRunAs());\n-            sb.append(\"    </run-as>\\n\");\n+            if (servletDef.getRunAs() != null) {\n+                sb.append(\"    <run-as>\\n\");\n+                appendElement(sb, INDENT6, \"role-name\", servletDef.getRunAs());\n+                sb.append(\"    </run-as>\\n\");\n+            }\n             for (SecurityRoleRef roleRef : servletDef.getSecurityRoleRefs()) {\n                 sb.append(\"    <security-role-ref>\\n\");\n                 appendElement(sb, INDENT6, \"role-name\", roleRef.getName());\n@@ -1491,8 +1493,10 @@ public boolean merge(Set<WebXml> fragments) {\n                     }\n                 }\n             }\n-            sessionConfig.setSessionTimeout(\n-                    temp.getSessionConfig().getSessionTimeout().toString());\n+            if (temp.getSessionConfig().getSessionTimeout() != null) {\n+                sessionConfig.setSessionTimeout(\n+                        temp.getSessionConfig().getSessionTimeout().toString());\n+            }\n         }\n         \n         if (sessionConfig.getCookieName() == null) {\n@@ -1597,8 +1601,10 @@ public boolean merge(Set<WebXml> fragments) {\n                     }\n                 }\n             }\n-            sessionConfig.setCookieHttpOnly(\n-                    temp.getSessionConfig().getCookieHttpOnly().toString());\n+            if (temp.getSessionConfig().getCookieHttpOnly() != null) {\n+                sessionConfig.setCookieHttpOnly(\n+                        temp.getSessionConfig().getCookieHttpOnly().toString());\n+            }\n         }\n         if (sessionConfig.getCookieSecure() == null) {\n             for (WebXml fragment : fragments) {\n@@ -1618,8 +1624,10 @@ public boolean merge(Set<WebXml> fragments) {\n                     }\n                 }\n             }\n-            sessionConfig.setCookieSecure(\n-                    temp.getSessionConfig().getCookieSecure().toString());\n+            if (temp.getSessionConfig().getCookieSecure() != null) {\n+                sessionConfig.setCookieSecure(\n+                        temp.getSessionConfig().getCookieSecure().toString());\n+            }\n         }\n         if (sessionConfig.getCookieMaxAge() == null) {\n             for (WebXml fragment : fragments) {\n@@ -1639,8 +1647,10 @@ public boolean merge(Set<WebXml> fragments) {\n                     }\n                 }\n             }\n-            sessionConfig.setCookieMaxAge(\n-                    temp.getSessionConfig().getCookieMaxAge().toString());\n+            if (temp.getSessionConfig().getCookieMaxAge() != null) {\n+                sessionConfig.setCookieMaxAge(\n+                        temp.getSessionConfig().getCookieMaxAge().toString());\n+            }\n         }\n \n         if (sessionConfig.getSessionTrackingModes().size() == 0) {\n@@ -1662,8 +1672,8 @@ public boolean merge(Set<WebXml> fragments) {\n                     }\n                 }\n             }\n-            sessionConfig.setSessionTimeout(\n-                    temp.getSessionConfig().getSessionTimeout().toString());\n+            sessionConfig.getSessionTrackingModes().addAll(\n+                    temp.getSessionConfig().getSessionTrackingModes());\n         }\n         \n         for (WebXml fragment : fragments) {",
                "raw_url": "https://github.com/apache/tomcat80/raw/8ea34734e24362e84be84325b88690e9e5f87f1a/java/org/apache/catalina/startup/WebXml.java",
                "sha": "64d0d91826f6d0968cfc8366c740866a401a8592",
                "status": "modified"
            }
        ],
        "message": "XML output tweaks\nFix some NPEs in the merge of session-config elements\nFix a copy and paste error in the merge of session-config elements\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@894457 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/f08f71991df0b26681a2dd22363e48640e1fb90c",
        "patched_files": [
            "WebXml.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestWebXml.java"
        ]
    },
    "tomcat80_913cb9f": {
        "bug_id": "tomcat80_913cb9f",
        "commit": "https://github.com/apache/tomcat80/commit/913cb9f866c0a4bc0079991c60c03443637cb43c",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/913cb9f866c0a4bc0079991c60c03443637cb43c/test/org/apache/coyote/http11/upgrade/TestUpgrade.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/coyote/http11/upgrade/TestUpgrade.java?ref=913cb9f866c0a4bc0079991c60c03443637cb43c",
                "deletions": 1,
                "filename": "test/org/apache/coyote/http11/upgrade/TestUpgrade.java",
                "patch": "@@ -132,12 +132,15 @@ private UpgradeConnection doUpgrade(\n \n         String status = reader.readLine();\n \n+        Assert.assertNotNull(status);\n         Assert.assertEquals(\"HTTP/1.1 101 Switching Protocols\",\n                 status.substring(0, 32));\n \n         // Skip the remaining response headers\n-        while (reader.readLine().length() > 0) {\n+        String line = reader.readLine();\n+        while (line != null && line.length() > 0) {\n             // Skip\n+            line = reader.readLine();\n         }\n \n         return new UpgradeConnection(writer, reader);",
                "raw_url": "https://github.com/apache/tomcat80/raw/913cb9f866c0a4bc0079991c60c03443637cb43c/test/org/apache/coyote/http11/upgrade/TestUpgrade.java",
                "sha": "f01730925feb2e1abce3670b8cc67e6fad74ad76",
                "status": "modified"
            }
        ],
        "message": "FindBugs - avoid NPEs\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1434735 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/38a066bf910b9dd215b738b01ca455626f097f8e",
        "patched_files": [],
        "repo": "tomcat80",
        "unit_tests": [
            "TestUpgrade.java"
        ]
    },
    "tomcat80_9171061": {
        "bug_id": "tomcat80_9171061",
        "commit": "https://github.com/apache/tomcat80/commit/917106163e077b03a6ec2d4c22a17904aa286611",
        "file": [
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/tomcat80/blob/917106163e077b03a6ec2d4c22a17904aa286611/java/org/apache/catalina/deploy/WebXml.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/deploy/WebXml.java?ref=917106163e077b03a6ec2d4c22a17904aa286611",
                "deletions": 3,
                "filename": "java/org/apache/catalina/deploy/WebXml.java",
                "patch": "@@ -1934,7 +1934,9 @@ private static boolean mergeServlet(ServletDef src, ServletDef dest,\n         }\n         \n         if (dest.getLoadOnStartup() == null) {\n-            dest.setLoadOnStartup(src.getLoadOnStartup().toString());\n+            if (src.getLoadOnStartup() != null) {\n+                dest.setLoadOnStartup(src.getLoadOnStartup().toString());\n+            }\n         } else if (src.getLoadOnStartup() != null) {\n             if (failOnConflict &&\n                     !src.getLoadOnStartup().equals(dest.getLoadOnStartup())) {\n@@ -1943,7 +1945,9 @@ private static boolean mergeServlet(ServletDef src, ServletDef dest,\n         }\n         \n         if (dest.getEnabled() == null) {\n-            dest.setEnabled(src.getEnabled().toString());\n+            if (src.getEnabled() != null) {\n+                dest.setEnabled(src.getEnabled().toString());\n+            }\n         } else if (src.getEnabled() != null) {\n             if (failOnConflict &&\n                     !src.getEnabled().equals(dest.getEnabled())) {\n@@ -1971,7 +1975,9 @@ private static boolean mergeServlet(ServletDef src, ServletDef dest,\n         }\n         \n         if (dest.getAsyncSupported() == null) {\n-            dest.setAsyncSupported(src.getAsyncSupported().toString());\n+            if (src.getAsyncSupported() != null) {\n+                dest.setAsyncSupported(src.getAsyncSupported().toString());\n+            }\n         } else if (src.getAsyncSupported() != null) {\n             if (failOnConflict &&\n                     !src.getAsyncSupported().equals(dest.getAsyncSupported())) {",
                "raw_url": "https://github.com/apache/tomcat80/raw/917106163e077b03a6ec2d4c22a17904aa286611/java/org/apache/catalina/deploy/WebXml.java",
                "sha": "8b3b528294f3709a01f4af847ab9ea3163999ecf",
                "status": "modified"
            }
        ],
        "message": "Avoid NPEs\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@907497 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/8e6eb7dba173480d22de0f8beca422aea807f809",
        "patched_files": [
            "WebXml.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestWebXml.java"
        ]
    },
    "tomcat80_91b8d8c": {
        "bug_id": "tomcat80_91b8d8c",
        "commit": "https://github.com/apache/tomcat80/commit/91b8d8cb9c950672c69bfa41ba883ff93d2f4912",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/91b8d8cb9c950672c69bfa41ba883ff93d2f4912/java/javax/el/BeanELResolver.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/javax/el/BeanELResolver.java?ref=91b8d8cb9c950672c69bfa41ba883ff93d2f4912",
                "deletions": 9,
                "filename": "java/javax/el/BeanELResolver.java",
                "patch": "@@ -205,10 +205,6 @@ public boolean isReadOnly(ELContext context, Object base, Object property) {\n \n     @Override\n     public Iterator<FeatureDescriptor> getFeatureDescriptors(ELContext context, Object base) {\n-        if (context == null) {\n-            throw new NullPointerException();\n-        }\n-\n         if (base == null) {\n             return null;\n         }\n@@ -230,10 +226,6 @@ public boolean isReadOnly(ELContext context, Object base, Object property) {\n \n     @Override\n     public Class<?> getCommonPropertyType(ELContext context, Object base) {\n-        if (context == null) {\n-            throw new NullPointerException();\n-        }\n-\n         if (base != null) {\n             return Object.class;\n         }\n@@ -319,7 +311,7 @@ private Method write(ELContext ctx) {\n             if (this.write == null) {\n                 this.write = Util.getMethod(this.owner, descriptor.getWriteMethod());\n                 if (this.write == null) {\n-                    throw new PropertyNotFoundException(Util.message(ctx,\n+                    throw new PropertyNotWritableException(Util.message(ctx,\n                             \"propertyNotWritable\", new Object[] {\n                                     owner.getName(), descriptor.getName() }));\n                 }",
                "raw_url": "https://github.com/apache/tomcat80/raw/91b8d8cb9c950672c69bfa41ba883ff93d2f4912/java/javax/el/BeanELResolver.java",
                "sha": "8a6c02f1325afeb35eea09a0700ba8255da6fdea",
                "status": "modified"
            },
            {
                "additions": 445,
                "blob_url": "https://github.com/apache/tomcat80/blob/91b8d8cb9c950672c69bfa41ba883ff93d2f4912/test/javax/el/TestBeanELResolver.java",
                "changes": 446,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/javax/el/TestBeanELResolver.java?ref=91b8d8cb9c950672c69bfa41ba883ff93d2f4912",
                "deletions": 1,
                "filename": "test/javax/el/TestBeanELResolver.java",
                "patch": "@@ -16,14 +16,26 @@\n  */\n package javax.el;\n \n-import org.junit.Assert;\n+import java.beans.FeatureDescriptor;\n+import java.beans.PropertyDescriptor;\n+import java.util.Iterator;\n \n+import org.junit.Assert;\n import org.junit.Test;\n \n import org.apache.jasper.el.ELContextImpl;\n \n public class TestBeanELResolver {\n \n+    private static final String METHOD01_NAME = \"toString\";\n+    private static final String METHOD02_NAME = \"<init>\";\n+    private static final String METHOD03_NAME = \"nonExistingMethod\";\n+    private static final String BEAN_NAME = \"test\";\n+    private static final String PROPERTY01_NAME = \"valueA\";\n+    private static final String PROPERTY02_NAME = \"valueB\";\n+    private static final String PROPERTY03_NAME = \"name\";\n+    private static final String PROPERTY_VALUE = \"test1\";\n+\n     @Test\n     public void testBug53421() {\n         ExpressionFactory factory = ExpressionFactory.newInstance();\n@@ -54,11 +66,443 @@ public void testBug53421() {\n                 msg.contains(type));\n     }\n \n+    /**\n+     * Tests that a null context results in an NPE as per EL Javadoc.\n+     */\n+    @Test(expected = NullPointerException.class)\n+    public void testGetType01() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        resolver.getType(null, new Object(), new Object());\n+    }\n+\n+    /**\n+     * Tests that a valid property is not resolved if base is null.\n+     */\n+    @Test\n+    public void testGetType02() {\n+        doNegativeTest(null, new Object(), MethodUnderTest.GET_TYPE, true);\n+    }\n+\n+    /**\n+     * Tests that a valid property is resolved.\n+     */\n+    @Test\n+    public void testGetType03() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        Class<?> result = resolver.getType(context, new Bean(), PROPERTY01_NAME);\n+\n+        Assert.assertEquals(String.class, result);\n+        Assert.assertTrue(context.isPropertyResolved());\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when the property does not exist.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testGetType04() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.getType(context, new Bean(), PROPERTY02_NAME);\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when a coercion cannot be\n+     * performed.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testGetType05() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.getType(context, new Bean(), new Object());\n+    }\n+\n+    /**\n+     * Tests that a null context results in an NPE as per EL Javadoc.\n+     */\n+    @Test(expected = NullPointerException.class)\n+    public void testGetValue01() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        resolver.getValue(null, new Object(), new Object());\n+    }\n+\n+    /**\n+     * Tests that a valid property is not resolved if base is null.\n+     */\n+    @Test\n+    public void testGetValue02() {\n+        doNegativeTest(null, new Object(), MethodUnderTest.GET_VALUE, true);\n+    }\n+\n+    /**\n+     * Tests that a valid property is resolved.\n+     */\n+    @Test\n+    public void testGetValue03() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        Object result = resolver.getValue(context, new TesterBean(BEAN_NAME), PROPERTY03_NAME);\n+\n+        Assert.assertEquals(BEAN_NAME, result);\n+        Assert.assertTrue(context.isPropertyResolved());\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when the property does not exist.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testGetValue04() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.getValue(context, new Bean(), PROPERTY02_NAME);\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when a coercion cannot be\n+     * performed.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testGetValue05() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.getValue(context, new Bean(), new Object());\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when the property is not readable.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testGetValue06() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.getValue(context, new Bean(), PROPERTY01_NAME);\n+    }\n+\n+    /**\n+     * Tests that getter method throws exception which should be propagated.\n+     */\n+    @Test(expected = ELException.class)\n+    public void testGetValue07() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.getValue(context, new TesterBean(BEAN_NAME), PROPERTY01_NAME);\n+    }\n+\n+    /**\n+     * Tests that a null context results in an NPE as per EL Javadoc.\n+     */\n+    @Test(expected = NullPointerException.class)\n+    public void testSetValue01() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        resolver.setValue(null, new Object(), new Object(), new Object());\n+    }\n+\n+    /**\n+     * Tests that a valid property is not resolved if base is null.\n+     */\n+    @Test\n+    public void testSetValue02() {\n+        doNegativeTest(null, new Object(), MethodUnderTest.SET_VALUE, true);\n+    }\n+\n+    /**\n+     * Tests that an exception is thrown when readOnly is true.\n+     */\n+    @Test(expected = PropertyNotWritableException.class)\n+    public void testSetValue03() {\n+        BeanELResolver resolver = new BeanELResolver(true);\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.setValue(context, new Bean(), new Object(), new Object());\n+    }\n+\n+    /**\n+     * Tests that a valid property is resolved.\n+     */\n+    @Test\n+    public void testSetValue04() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        TesterBean bean = new TesterBean(BEAN_NAME);\n+        resolver.setValue(context, bean, PROPERTY03_NAME, PROPERTY_VALUE);\n+\n+        Assert.assertEquals(PROPERTY_VALUE, resolver.getValue(context, bean, PROPERTY03_NAME));\n+        Assert.assertTrue(context.isPropertyResolved());\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when a coercion cannot be\n+     * performed.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testSetValue05() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.setValue(context, new Bean(), new Object(), PROPERTY_VALUE);\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when the property does not exist.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testSetValue06() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.setValue(context, new Bean(), PROPERTY02_NAME, PROPERTY_VALUE);\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when the property does not have\n+     * setter method.\n+     */\n+    @Test(expected = PropertyNotWritableException.class)\n+    public void testSetValue07() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.setValue(context, new TesterBean(BEAN_NAME), PROPERTY01_NAME, PROPERTY_VALUE);\n+    }\n+\n+    /**\n+     * Tests that a null context results in an NPE as per EL Javadoc.\n+     */\n+    @Test(expected = NullPointerException.class)\n+    public void testIsReadOnly01() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        resolver.isReadOnly(null, new Object(), new Object());\n+    }\n+\n+    /**\n+     * Tests that the propertyResolved is false if base is null.\n+     */\n+    @Test\n+    public void testIsReadOnly02() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.isReadOnly(context, null, new Object());\n+\n+        Assert.assertFalse(context.isPropertyResolved());\n+\n+        resolver = new BeanELResolver(true);\n+\n+        resolver.isReadOnly(context, null, new Object());\n+\n+        Assert.assertFalse(context.isPropertyResolved());\n+    }\n+\n+    /**\n+     * Tests that if the BeanELResolver is constructed with readOnly the method\n+     * will return always true.\n+     */\n+    @Test\n+    public void testIsReadOnly03() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        boolean result = resolver.isReadOnly(context, new TesterBean(BEAN_NAME), PROPERTY03_NAME);\n+\n+        Assert.assertFalse(result);\n+        Assert.assertTrue(context.isPropertyResolved());\n+\n+        resolver = new BeanELResolver(true);\n+\n+        result = resolver.isReadOnly(context, new TesterBean(BEAN_NAME), PROPERTY03_NAME);\n+\n+        Assert.assertTrue(result);\n+        Assert.assertTrue(context.isPropertyResolved());\n+    }\n+\n+    /**\n+     * Tests that an exception is thrown when a coercion cannot be performed.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testIsReadOnly04() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.isReadOnly(context, new TesterBean(BEAN_NAME), new Integer(0));\n+    }\n+\n+    /**\n+     * Tests that an exception will be thrown when the property does not exist.\n+     */\n+    @Test(expected = PropertyNotFoundException.class)\n+    public void testIsReadOnly05() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.isReadOnly(context, new Bean(), PROPERTY02_NAME);\n+    }\n+\n+    /**\n+     * Tests that true will be returned when the property does not have setter\n+     * method.\n+     */\n+    @Test\n+    public void testIsReadOnly06() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        boolean result = resolver.isReadOnly(context, new TesterBean(BEAN_NAME), PROPERTY01_NAME);\n+\n+        Assert.assertTrue(result);\n+        Assert.assertTrue(context.isPropertyResolved());\n+    }\n+\n+    /**\n+     * Tests that a valid FeatureDescriptors are not returned if base is not\n+     * Map.\n+     */\n+    @Test\n+    public void testGetFeatureDescriptors01() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        Iterator<FeatureDescriptor> result = resolver.getFeatureDescriptors(context, null);\n+\n+        Assert.assertNull(result);\n+    }\n+\n+    /**\n+     * Tests that a valid FeatureDescriptors are returned.\n+     */\n+    @Test\n+    public void testGetFeatureDescriptors02() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        Iterator<FeatureDescriptor> result = resolver.getFeatureDescriptors(context, new Bean());\n+\n+        while (result.hasNext()) {\n+            PropertyDescriptor featureDescriptor = (PropertyDescriptor) result.next();\n+            Assert.assertEquals(featureDescriptor.getPropertyType(),\n+                    featureDescriptor.getValue(ELResolver.TYPE));\n+            Assert.assertEquals(Boolean.TRUE,\n+                    featureDescriptor.getValue(ELResolver.RESOLVABLE_AT_DESIGN_TIME));\n+        }\n+    }\n+\n+    /**\n+     * Tests that a null context results in an NPE as per EL Javadoc.\n+     */\n+    @Test(expected = NullPointerException.class)\n+    public void testInvoke01() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        resolver.invoke(null, new Object(), new Object(), new Class<?>[0], new Object[0]);\n+    }\n+\n+    /**\n+     * Tests that a valid property is not resolved if base is null.\n+     */\n+    @Test\n+    public void testInvoke02() {\n+        doNegativeTest(null, new Object(), MethodUnderTest.INVOKE, true);\n+    }\n+\n+    /**\n+     * Tests a method invocation.\n+     */\n+    @Test\n+    public void testInvoke03() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        Object result = resolver.invoke(context, new TesterBean(BEAN_NAME), METHOD01_NAME,\n+                new Class<?>[] {}, new Object[] {});\n+\n+        Assert.assertEquals(BEAN_NAME, result);\n+        Assert.assertTrue(context.isPropertyResolved());\n+    }\n+\n+    /**\n+     * Tests that the method name cannot be coerced to String.\n+     */\n+    @Test\n+    public void testInvoke04() {\n+        doNegativeTest(new Bean(), null, MethodUnderTest.INVOKE, true);\n+    }\n+\n+    /**\n+     * Tests that a call to &lt;init&gt; as a method name will throw an exception.\n+     */\n+    @Test(expected = MethodNotFoundException.class)\n+    public void testInvoke05() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.invoke(context, new TesterBean(BEAN_NAME), METHOD02_NAME, new Class<?>[] {},\n+                new Object[] {});\n+    }\n+\n+    /**\n+     * Tests that a call to a non existing method will throw an exception.\n+     */\n+    @Test(expected = MethodNotFoundException.class)\n+    public void testInvoke06() {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        resolver.invoke(context, new TesterBean(BEAN_NAME), METHOD03_NAME, new Class<?>[] {},\n+                new Object[] {});\n+    }\n+\n     private static class Bean {\n \n         @SuppressWarnings(\"unused\")\n         public void setValueA(String valueA) {\n             // NOOP\n         }\n     }\n+\n+    private void doNegativeTest(Object base, Object trigger, MethodUnderTest method,\n+            boolean checkResult) {\n+        BeanELResolver resolver = new BeanELResolver();\n+        ELContext context = new StandardELContext(ELManager.getExpressionFactory());\n+\n+        Object result = null;\n+        switch (method) {\n+        case GET_VALUE: {\n+            result = resolver.getValue(context, base, trigger);\n+            break;\n+        }\n+        case SET_VALUE: {\n+            resolver.setValue(context, base, trigger, new Object());\n+            break;\n+        }\n+        case GET_TYPE: {\n+            result = resolver.getType(context, base, trigger);\n+            break;\n+        }\n+        case INVOKE: {\n+            result = resolver.invoke(context, base, trigger, new Class<?>[0], new Object[0]);\n+            break;\n+        }\n+        default: {\n+            // Should never happen\n+            Assert.fail(\"Missing case for method\");\n+        }\n+        }\n+\n+        if (checkResult) {\n+            Assert.assertNull(result);\n+        }\n+        Assert.assertFalse(context.isPropertyResolved());\n+    }\n+\n+    private static enum MethodUnderTest {\n+        GET_VALUE, SET_VALUE, GET_TYPE, INVOKE\n+    }\n+\n }",
                "raw_url": "https://github.com/apache/tomcat80/raw/91b8d8cb9c950672c69bfa41ba883ff93d2f4912/test/javax/el/TestBeanELResolver.java",
                "sha": "44fbdc32bb9d60a5f332e105910c161bfa3e3747",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/tomcat80/blob/91b8d8cb9c950672c69bfa41ba883ff93d2f4912/test/javax/el/TesterBean.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/javax/el/TesterBean.java?ref=91b8d8cb9c950672c69bfa41ba883ff93d2f4912",
                "deletions": 1,
                "filename": "test/javax/el/TesterBean.java",
                "patch": "@@ -18,7 +18,7 @@\n \n public class TesterBean {\n \n-    private final String name;\n+    private String name;\n \n     public TesterBean(String name) {\n         this.name = name;\n@@ -28,8 +28,16 @@ public String getName() {\n         return name;\n     }\n \n+    public void setName(String name) {\n+        this.name = name;\n+    }\n+\n     @Override\n     public String toString() {\n         return getName();\n     }\n+\n+    public String getValueA() throws Exception {\n+        throw new Exception();\n+    }\n }",
                "raw_url": "https://github.com/apache/tomcat80/raw/91b8d8cb9c950672c69bfa41ba883ff93d2f4912/test/javax/el/TesterBean.java",
                "sha": "2169d5952f514fc4ebf28b31168b4e113a4783c3",
                "status": "modified"
            }
        ],
        "message": "javax.el.BeanELResolver:\n- getFeatureDescriptors, getCommonPropertyType do not throw NPE when the supplied context is null.\n- setValue will throw PropertyNotWritableException instead of PropertyNotFoundException when there is no setter for the property.\n- unit test is added\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1517536 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/5e29adf957b1e9cef7a0b39dc073d31609d9f06b",
        "patched_files": [
            "BeanELResolver.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TesterBean.java",
            "TestBeanELResolver.java"
        ]
    },
    "tomcat80_98b9ead": {
        "bug_id": "tomcat80_98b9ead",
        "commit": "https://github.com/apache/tomcat80/commit/98b9ead22e60f9b3b7f0412f0f6c318798639e99",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tomcat80/blob/98b9ead22e60f9b3b7f0412f0f6c318798639e99/java/org/apache/catalina/realm/MemoryRealm.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/realm/MemoryRealm.java?ref=98b9ead22e60f9b3b7f0412f0f6c318798639e99",
                "deletions": 1,
                "filename": "java/org/apache/catalina/realm/MemoryRealm.java",
                "patch": "@@ -113,7 +113,12 @@ public Principal authenticate(String username, String credentials) {\n \n         GenericPrincipal principal = principals.get(username);\n \n-        boolean validated = compareCredentials(credentials, principal.getPassword());\n+        boolean validated;\n+        if (principal == null) {\n+            validated = false;\n+        } else {\n+            validated = compareCredentials(credentials, principal.getPassword());\n+        }\n \n         if (validated) {\n             if (log.isDebugEnabled())",
                "raw_url": "https://github.com/apache/tomcat80/raw/98b9ead22e60f9b3b7f0412f0f6c318798639e99/java/org/apache/catalina/realm/MemoryRealm.java",
                "sha": "52aad26752aebdbe7cfa91c5ae100fef9203433d",
                "status": "modified"
            },
            {
                "additions": 37,
                "blob_url": "https://github.com/apache/tomcat80/blob/98b9ead22e60f9b3b7f0412f0f6c318798639e99/test/org/apache/catalina/realm/TestMemoryRealm.java",
                "changes": 37,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/realm/TestMemoryRealm.java?ref=98b9ead22e60f9b3b7f0412f0f6c318798639e99",
                "deletions": 0,
                "filename": "test/org/apache/catalina/realm/TestMemoryRealm.java",
                "patch": "@@ -0,0 +1,37 @@\n+/*\n+* Licensed to the Apache Software Foundation (ASF) under one or more\n+* contributor license agreements.  See the NOTICE file distributed with\n+* this work for additional information regarding copyright ownership.\n+* The ASF licenses this file to You under the Apache License, Version 2.0\n+* (the \"License\"); you may not use this file except in compliance with\n+* the License.  You may obtain a copy of the License at\n+*\n+*     http://www.apache.org/licenses/LICENSE-2.0\n+*\n+* Unless required by applicable law or agreed to in writing, software\n+* distributed under the License is distributed on an \"AS IS\" BASIS,\n+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+* See the License for the specific language governing permissions and\n+* limitations under the License.\n+*/\n+package org.apache.catalina.realm;\n+\n+import java.security.Principal;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+public class TestMemoryRealm {\n+\n+    /**\n+     * Unknown user triggers NPE.\n+     */\n+    @Test\n+    public void testBug56246() {\n+        MemoryRealm memoryRealm = new MemoryRealm();\n+\n+        Principal p = memoryRealm.authenticate(\"foo\", \"bar\");\n+\n+        Assert.assertNull(p);\n+    }\n+}",
                "raw_url": "https://github.com/apache/tomcat80/raw/98b9ead22e60f9b3b7f0412f0f6c318798639e99/test/org/apache/catalina/realm/TestMemoryRealm.java",
                "sha": "27c1af172be84688fe0fdc9028623cefb3626dee",
                "status": "added"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/98b9ead22e60f9b3b7f0412f0f6c318798639e99/webapps/docs/changelog.xml",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=98b9ead22e60f9b3b7f0412f0f6c318798639e99",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -108,6 +108,10 @@\n         Add methods of get the idle time from last client access time to\n         <code>org.apache.catalina.Session</code>. (kfujino)\n       </add>\n+      <fix>\n+        <bug>56246</bug>: Fix NullPointerException in MemoryRealm when\n+        authenticating an unknown user. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/98b9ead22e60f9b3b7f0412f0f6c318798639e99/webapps/docs/changelog.xml",
                "sha": "22a882d50443f0e2c73afd58593fac90bc87315e",
                "status": "modified"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56246\nFix NullPointerException in MemoryRealm when authenticating an unknown user.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1576768 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/d56fe405c6546e3972dfb074469738f6448a98b2",
        "patched_files": [
            "MemoryRealm.java",
            "changelog.xml"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestMemoryRealm.java"
        ]
    },
    "tomcat80_98c01e9": {
        "bug_id": "tomcat80_98c01e9",
        "commit": "https://github.com/apache/tomcat80/commit/98c01e9780dfb628dbb19bea0f07b080bb55c318",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/98c01e9780dfb628dbb19bea0f07b080bb55c318/java/org/apache/jasper/compiler/JspConfig.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/JspConfig.java?ref=98c01e9780dfb628dbb19bea0f07b080bb55c318",
                "deletions": 0,
                "filename": "java/org/apache/jasper/compiler/JspConfig.java",
                "patch": "@@ -83,6 +83,7 @@ private void processWebDotXml() {\n             return;\n         }\n \n+        jspProperties = new Vector<>();\n         Collection<JspPropertyGroupDescriptor> jspPropertyGroups =\n                 jspConfig.getJspPropertyGroups();\n ",
                "raw_url": "https://github.com/apache/tomcat80/raw/98c01e9780dfb628dbb19bea0f07b080bb55c318/java/org/apache/jasper/compiler/JspConfig.java",
                "sha": "2d7f05c0af347c75f92813c4c34aa48eb2cfb08b",
                "status": "modified"
            }
        ],
        "message": "Another NPE fox after the switch to obtaining the JspConfigDescription from the ServletContext\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1501926 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/6375510e8e4dd9466fa8a708a9ffa40459342d5f",
        "patched_files": [
            "JspConfig.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestJspConfig.java"
        ]
    },
    "tomcat80_9974718": {
        "bug_id": "tomcat80_9974718",
        "commit": "https://github.com/apache/tomcat80/commit/997471832bd5bac0055b7bfaedb6f0db24ea42cd",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tomcat80/blob/997471832bd5bac0055b7bfaedb6f0db24ea42cd/test/org/apache/catalina/loader/TestWebappClassLoaderMemoryLeak.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/loader/TestWebappClassLoaderMemoryLeak.java?ref=997471832bd5bac0055b7bfaedb6f0db24ea42cd",
                "deletions": 1,
                "filename": "test/org/apache/catalina/loader/TestWebappClassLoaderMemoryLeak.java",
                "patch": "@@ -36,7 +36,8 @@ public void testTimerThreadLeak() throws Exception {\n         // If the thread still exists, we have a thread/memory leak\n         Thread[] threads = getThreads();\n         for (Thread thread : threads) {\n-            if (thread.getName().equals(TaskServlet.TIMER_THREAD_NAME)) {\n+            if (thread != null &&\n+                    TaskServlet.TIMER_THREAD_NAME.equals(thread.getName())) {\n                 fail(\"Timer thread still running\");\n             }\n         }",
                "raw_url": "https://github.com/apache/tomcat80/raw/997471832bd5bac0055b7bfaedb6f0db24ea42cd/test/org/apache/catalina/loader/TestWebappClassLoaderMemoryLeak.java",
                "sha": "52882bd68e7d16e8979e67509f705814e8ebb113",
                "status": "modified"
            }
        ],
        "message": "Protect against NPE whilst running the test\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@907651 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/0d4d9996af1be0bf038fcb0ec64dd10d70793941",
        "patched_files": [],
        "repo": "tomcat80",
        "unit_tests": [
            "TestWebappClassLoaderMemoryLeak.java"
        ]
    },
    "tomcat80_9bf702b": {
        "bug_id": "tomcat80_9bf702b",
        "commit": "https://github.com/apache/tomcat80/commit/9bf702b76dfa5b6736dcc49486349209ad0b3964",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tomcat80/blob/9bf702b76dfa5b6736dcc49486349209ad0b3964/java/org/apache/catalina/connector/Connector.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/Connector.java?ref=9bf702b76dfa5b6736dcc49486349209ad0b3964",
                "deletions": 1,
                "filename": "java/org/apache/catalina/connector/Connector.java",
                "patch": "@@ -765,7 +765,11 @@ public String getURIEncodingLower() {\n       */\n      public void setURIEncoding(String URIEncoding) {\n          this.URIEncoding = URIEncoding;\n-         this.URIEncodingLower = URIEncoding.toLowerCase(Locale.US);\n+         if (URIEncoding == null) {\n+             URIEncodingLower = null;\n+         } else {\n+             this.URIEncodingLower = URIEncoding.toLowerCase(Locale.US);\n+         }\n          setProperty(\"uRIEncoding\", URIEncoding);\n      }\n ",
                "raw_url": "https://github.com/apache/tomcat80/raw/9bf702b76dfa5b6736dcc49486349209ad0b3964/java/org/apache/catalina/connector/Connector.java",
                "sha": "05a66365a5177b055e7ad8c776df3843efaf54a4",
                "status": "modified"
            }
        ],
        "message": "FindBugs: Avoid possible NPE.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1401092 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/26ad376ce7cb0c5991742414c5bf72da2d4bd30d",
        "patched_files": [
            "Connector.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestConnector.java"
        ]
    },
    "tomcat80_9c088d6": {
        "bug_id": "tomcat80_9c088d6",
        "commit": "https://github.com/apache/tomcat80/commit/9c088d6c4bae793af1a4fbf1402a996ef0821bf1",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tomcat80/blob/9c088d6c4bae793af1a4fbf1402a996ef0821bf1/test/org/apache/catalina/filters/TestRemoteIpFilter.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/filters/TestRemoteIpFilter.java?ref=9c088d6c4bae793af1a4fbf1402a996ef0821bf1",
                "deletions": 0,
                "filename": "test/org/apache/catalina/filters/TestRemoteIpFilter.java",
                "patch": "@@ -118,6 +118,11 @@ public void addHeader(String name, String value) {\n         public void setScheme(String scheme) {\n             getCoyoteRequest().scheme().setString(scheme);\n         }\n+\n+        @Override\n+        public void setAttribute(String name, Object value) {\n+            // NOOP. Prevents NPE during testing.\n+        }\n     }\n \n     public static final String TEMP_DIR = System.getProperty(\"java.io.tmpdir\");",
                "raw_url": "https://github.com/apache/tomcat80/raw/9c088d6c4bae793af1a4fbf1402a996ef0821bf1/test/org/apache/catalina/filters/TestRemoteIpFilter.java",
                "sha": "4c3be0f9cc392f791a8e73aac02ae5dab3ef0071",
                "status": "modified"
            }
        ],
        "message": "Prevent NPE in unit tests as a result of r1067718\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1071556 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/3ffa3bd00398bf3ea88be7b04c9b791e0b55e04c",
        "patched_files": [
            "RemoteIpFilter.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestRemoteIpFilter.java"
        ]
    },
    "tomcat80_9c26a10": {
        "bug_id": "tomcat80_9c26a10",
        "commit": "https://github.com/apache/tomcat80/commit/9c26a10513ba19a167c1e0dd3d5a976f351f324a",
        "file": [
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tomcat80/blob/9c26a10513ba19a167c1e0dd3d5a976f351f324a/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/CoyoteAdapter.java?ref=9c26a10513ba19a167c1e0dd3d5a976f351f324a",
                "deletions": 4,
                "filename": "java/org/apache/catalina/connector/CoyoteAdapter.java",
                "patch": "@@ -375,7 +375,8 @@ public void service(org.apache.coyote.Request req,\n             // Parse and set Catalina and configuration specific \n             // request parameters\n             req.getRequestProcessor().setWorkerThreadName(Thread.currentThread().getName());\n-            if (postParseRequest(req, request, res, response)) {\n+            boolean postParseSuccess = postParseRequest(req, request, res, response);\n+            if (postParseSuccess) {\n                 //check valves if we support async\n                 request.setAsyncSupported(connector.getService().getContainer().getPipeline().isAsyncSupported());\n                 // Calling the container\n@@ -406,9 +407,14 @@ public void service(org.apache.coyote.Request req,\n                 async = true;\n             } else if (!comet) {\n                 response.finishResponse();\n-                ((Context) request.getMappingData().context).logAccess(request,\n-                        response,\n-                        System.currentTimeMillis() - req.getStartTime(), false);\n+                if (postParseSuccess) {\n+                    // Log only if processing was invoked.\n+                    // If postParseRequest() failed, it has already logged it.\n+                    ((Context) request.getMappingData().context).logAccess(\n+                            request, response,\n+                            System.currentTimeMillis() - req.getStartTime(),\n+                            false);\n+                }\n                 req.action(ActionCode.POST_REQUEST , null);\n             }\n ",
                "raw_url": "https://github.com/apache/tomcat80/raw/9c26a10513ba19a167c1e0dd3d5a976f351f324a/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "sha": "153788f91449be1349457c63c925f30a8e21ee6b",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/tomcat80/blob/9c26a10513ba19a167c1e0dd3d5a976f351f324a/webapps/docs/changelog.xml",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=9c26a10513ba19a167c1e0dd3d5a976f351f324a",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -41,6 +41,15 @@\n <!--\n   General, Catalina, Coyote, Jasper, Cluster, Web applications, Extras, Other\n -->\n+<section name=\"Tomcat 7.0.8 (markt)\">\n+  <subsection name=\"Catalina\">\n+    <changelog>\n+      <fix>\n+        Fix NPE in CoyoteAdapter when postParseRequest() call fails. (kkolinko)\n+      </fix>\n+    </changelog>\n+  </subsection>\n+</section>\n <section name=\"Tomcat 7.0.7 (markt)\">\n   <subsection name=\"Catalina\">\n     <changelog>",
                "raw_url": "https://github.com/apache/tomcat80/raw/9c26a10513ba19a167c1e0dd3d5a976f351f324a/webapps/docs/changelog.xml",
                "sha": "c0f994d8d5e44c83186a8e2b3015e847b37fb76b",
                "status": "modified"
            }
        ],
        "message": "Fix NPE in CoyoteAdapter when postParseRequest() call fails.\n\nThat was caused by mappingData.context being null.\nThis NPE occurence in 7.0.7 was reported on the users list.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1067072 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/b917ed40248458a5f5f6ef15b28288bec4399386",
        "patched_files": [
            "changelog.xml",
            "CoyoteAdapter.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestCoyoteAdapter.java"
        ]
    },
    "tomcat80_a8b950f": {
        "bug_id": "tomcat80_a8b950f",
        "commit": "https://github.com/apache/tomcat80/commit/a8b950f2d5f4783215c12d4448bdb743c1ab5315",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tomcat80/blob/a8b950f2d5f4783215c12d4448bdb743c1ab5315/java/org/apache/catalina/startup/ContextConfig.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/startup/ContextConfig.java?ref=a8b950f2d5f4783215c12d4448bdb743c1ab5315",
                "deletions": 3,
                "filename": "java/org/apache/catalina/startup/ContextConfig.java",
                "patch": "@@ -1960,10 +1960,13 @@ protected void processAnnotationsFile(File file, WebXml fragment,\n             boolean handlesTypesOnly) {\n \n         if (file.isDirectory()) {\n+            // Returns null if directory is not readable\n             String[] dirs = file.list();\n-            for (String dir : dirs) {\n-                processAnnotationsFile(\n-                        new File(file,dir), fragment, handlesTypesOnly);\n+            if (dirs != null) {\n+                for (String dir : dirs) {\n+                    processAnnotationsFile(\n+                            new File(file,dir), fragment, handlesTypesOnly);\n+                }\n             }\n         } else if (file.canRead() && file.getName().endsWith(\".class\")) {\n             try (FileInputStream fis = new FileInputStream(file)) {",
                "raw_url": "https://github.com/apache/tomcat80/raw/a8b950f2d5f4783215c12d4448bdb743c1ab5315/java/org/apache/catalina/startup/ContextConfig.java",
                "sha": "82e5ed9e0f869e7a33934b463b100c555e3d03c6",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tomcat80/blob/a8b950f2d5f4783215c12d4448bdb743c1ab5315/webapps/docs/changelog.xml",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=a8b950f2d5f4783215c12d4448bdb743c1ab5315",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -80,6 +80,11 @@\n         and it need not be fatal when the Realm starts. Based on a patch by\n         C\u00e9dric Couralet. (markt)\n       </fix>\n+      <fix>\n+        <bug>56785</bug>: Avoid <code>NullPointerException</code> if directory\n+        exists on the class path that is not readable by the Tomcat user.\n+        (markt)\n+      </fix>\n       <fix>\n         <bug>56796</bug>: Remove unnecessary sleep when stopping a web\n         application. (markt)",
                "raw_url": "https://github.com/apache/tomcat80/raw/a8b950f2d5f4783215c12d4448bdb743c1ab5315/webapps/docs/changelog.xml",
                "sha": "a2c78120754d345073ac9fa34416ee866128ca5c",
                "status": "modified"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56785\nAvoid NullPointerException if directory exists on the class path that is not readable by the Tomcat user.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1615920 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/e5816721ded13fde916818a4dac2afdc9c399839",
        "patched_files": [
            "ContextConfig.java",
            "changelog.xml"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestContextConfig.java"
        ]
    },
    "tomcat80_a95730b": {
        "bug_id": "tomcat80_a95730b",
        "commit": "https://github.com/apache/tomcat80/commit/a95730b2e3482971545598f2565b0ddebf205ac1",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/a95730b2e3482971545598f2565b0ddebf205ac1/test/org/apache/catalina/core/TestAsyncContextImpl.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/core/TestAsyncContextImpl.java?ref=a95730b2e3482971545598f2565b0ddebf205ac1",
                "deletions": 0,
                "filename": "test/org/apache/catalina/core/TestAsyncContextImpl.java",
                "patch": "@@ -1169,6 +1169,7 @@ public void run() {\n \n     @Test\n     public void testErrorHandling() throws Exception {\n+        resetTracker();\n         // Setup Tomcat instance\n         Tomcat tomcat = getTomcatInstance();\n ",
                "raw_url": "https://github.com/apache/tomcat80/raw/a95730b2e3482971545598f2565b0ddebf205ac1/test/org/apache/catalina/core/TestAsyncContextImpl.java",
                "sha": "e08bd30d57eb03040b63eba51426a7cc5d8ccba0",
                "status": "modified"
            }
        ],
        "message": "Avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1738163 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/cf777bb2214d00a644217b419b18bf4cdf156a01",
        "patched_files": [
            "AsyncContextImpl.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestAsyncContextImpl.java"
        ]
    },
    "tomcat80_b5d4010": {
        "bug_id": "tomcat80_b5d4010",
        "commit": "https://github.com/apache/tomcat80/commit/b5d40104595e08ddaff20a592c4387049126301a",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/b5d40104595e08ddaff20a592c4387049126301a/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/CoyoteAdapter.java?ref=b5d40104595e08ddaff20a592c4387049126301a",
                "deletions": 1,
                "filename": "java/org/apache/catalina/connector/CoyoteAdapter.java",
                "patch": "@@ -500,7 +500,7 @@ public void log(org.apache.coyote.Request req,\n                             request, response, time, true);\n                 } else if (request.mappingData.host != null) {\n                     logged = true;\n-                    ((Context) request.mappingData.context).logAccess(\n+                    ((Host) request.mappingData.host).logAccess(\n                             request, response, time, true);\n                 }\n             }",
                "raw_url": "https://github.com/apache/tomcat80/raw/b5d40104595e08ddaff20a592c4387049126301a/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "sha": "428868164369c064569838e5b54b2554ca35dbf3",
                "status": "modified"
            }
        ],
        "message": "Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51658\nFix copy/paste error that could trigger an NPE.\nBased on a suggestion by Felix Schumacher\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1158155 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/b45452785335a2c442abfb59348e80fbc0ea7594",
        "patched_files": [
            "CoyoteAdapter.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestCoyoteAdapter.java"
        ]
    },
    "tomcat80_b96d85a": {
        "bug_id": "tomcat80_b96d85a",
        "commit": "https://github.com/apache/tomcat80/commit/b96d85aa3485f625749e14d78d5ea442079d2a59",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tomcat80/blob/b96d85aa3485f625749e14d78d5ea442079d2a59/java/org/apache/catalina/startup/Tomcat.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/startup/Tomcat.java?ref=b96d85aa3485f625749e14d78d5ea442079d2a59",
                "deletions": 1,
                "filename": "java/org/apache/catalina/startup/Tomcat.java",
                "patch": "@@ -668,7 +668,11 @@ public void setSilent(boolean silent) {\n \n     private void silence(Host host, String ctx) {\n         String base = \"org.apache.catalina.core.ContainerBase.[default].[\";\n-        base += host.getName();\n+        if (host == null) {\n+            base += getHost().getName();\n+        } else {\n+            base += host.getName();\n+        }\n         base += \"].[\";\n         base += ctx;\n         base += \"]\";",
                "raw_url": "https://github.com/apache/tomcat80/raw/b96d85aa3485f625749e14d78d5ea442079d2a59/java/org/apache/catalina/startup/Tomcat.java",
                "sha": "dd1385d2bf0599b52eb5b89866a71c512a95ecbe",
                "status": "modified"
            }
        ],
        "message": "Fix possible NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1226177 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/ca8c65c09b8610536a7ed312db10a7fe0a078d48",
        "patched_files": [
            "Tomcat.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestTomcat.java"
        ]
    },
    "tomcat80_b9ea759": {
        "bug_id": "tomcat80_b9ea759",
        "commit": "https://github.com/apache/tomcat80/commit/b9ea75942a6e65ab67ded5005175ab56d4f8d758",
        "file": [
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/tomcat80/blob/b9ea75942a6e65ab67ded5005175ab56d4f8d758/java/org/apache/jasper/compiler/Generator.java",
                "changes": 16,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/Generator.java?ref=b9ea75942a6e65ab67ded5005175ab56d4f8d758",
                "deletions": 5,
                "filename": "java/org/apache/jasper/compiler/Generator.java",
                "patch": "@@ -1868,18 +1868,24 @@ public void visit(Node.JspElement n) throws JasperException {\n                 if (attrs[i].isNamedAttribute()) {\n                     NamedAttribute attr = attrs[i].getNamedAttributeNode();\n                     Node.JspAttribute omitAttr = attr.getOmit();\n-                    String omit = attributeValue(omitAttr, false, boolean.class);\n-                    if (\"true\".equals(omit)) {\n-                        continue;\n+                    String omit;\n+                    if (omitAttr == null) {\n+                        omit = \"false\";\n+                    } else {\n+                        omit = attributeValue(omitAttr, false, boolean.class);\n+                        if (\"true\".equals(omit)) {\n+                            continue;\n+                        }\n                     }\n                     value = generateNamedAttributeValue(\n                             attrs[i].getNamedAttributeNode());\n                     if (\"false\".equals(omit)) {\n                         nvp = \" + \\\" \" + attrs[i].getName() + \"=\\\\\\\"\\\" + \" +\n                                 value + \" + \\\"\\\\\\\"\\\"\";\n                     } else {\n-                        nvp = \" + (Boolean.valueOf(\" + omit + \")?\\\"\\\":\\\" \" + attrs[i].getName() +\n-                                \"=\\\\\\\"\\\" + \" + value + \" + \\\"\\\\\\\"\\\")\";\n+                        nvp = \" + (Boolean.valueOf(\" + omit + \")?\\\"\\\":\\\" \" +\n+                                attrs[i].getName() + \"=\\\\\\\"\\\" + \" + value +\n+                                \" + \\\"\\\\\\\"\\\")\";\n                     }\n                 } else {\n                     value = attributeValue(attrs[i], false, Object.class);",
                "raw_url": "https://github.com/apache/tomcat80/raw/b9ea75942a6e65ab67ded5005175ab56d4f8d758/java/org/apache/jasper/compiler/Generator.java",
                "sha": "0d4321e10adbe300b26fc378a515bb33f7e092c3",
                "status": "modified"
            }
        ],
        "message": "Fix NPE and TCK failures caused by previous fix for bug 49799.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1003891 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/f6e4352c347b3e0f11d5cf75c47922c0a2987c47",
        "patched_files": [
            "Generator.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestGenerator.java"
        ]
    },
    "tomcat80_ba618c9": {
        "bug_id": "tomcat80_ba618c9",
        "commit": "https://github.com/apache/tomcat80/commit/ba618c9565772e293c1b15e7c7836a1e5ad60b39",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tomcat80/blob/ba618c9565772e293c1b15e7c7836a1e5ad60b39/test/org/apache/catalina/authenticator/TesterDigestAuthenticatorPerformance.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/authenticator/TesterDigestAuthenticatorPerformance.java?ref=ba618c9565772e293c1b15e7c7836a1e5ad60b39",
                "deletions": 0,
                "filename": "test/org/apache/catalina/authenticator/TesterDigestAuthenticatorPerformance.java",
                "patch": "@@ -266,5 +266,10 @@ public String getQueryString() {\n         public String getRequestURI() {\n             return CONTEXT_PATH + URI;\n         }\n+\n+        @Override\n+        public org.apache.coyote.Request getCoyoteRequest() {\n+            return new org.apache.coyote.Request();\n+        }\n     }\n }",
                "raw_url": "https://github.com/apache/tomcat80/raw/ba618c9565772e293c1b15e7c7836a1e5ad60b39/test/org/apache/catalina/authenticator/TesterDigestAuthenticatorPerformance.java",
                "sha": "68a4d59f6a01ecfedf70001601dba09ef5817253",
                "status": "modified"
            }
        ],
        "message": "Fix NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1667633 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/f027684137ac50da01e203d6cadb8a4b40921123",
        "patched_files": [],
        "repo": "tomcat80",
        "unit_tests": [
            "TesterDigestAuthenticatorPerformance.java"
        ]
    },
    "tomcat80_bc74aea": {
        "bug_id": "tomcat80_bc74aea",
        "commit": "https://github.com/apache/tomcat80/commit/bc74aeacaa80733ddaca728fdda44e1a92c94711",
        "file": [
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/tomcat80/blob/bc74aeacaa80733ddaca728fdda44e1a92c94711/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/server/WsServerContainer.java?ref=bc74aeacaa80733ddaca728fdda44e1a92c94711",
                "deletions": 6,
                "filename": "java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "patch": "@@ -367,12 +367,14 @@ private void unregisterAuthenticatedSession(WsSession wsSession,\n     public void closeAuthenticatedSession(String httpSessionId) {\n         Set<WsSession> wsSessions = authenticatedSessions.remove(httpSessionId);\n \n-        for (WsSession wsSession : wsSessions) {\n-            try {\n-                wsSession.close(AUTHENTICATED_HTTP_SESSION_CLOSED);\n-            } catch (IOException e) {\n-                // Any IOExceptions during close will have been caught and the\n-                // onError method called.\n+        if (wsSessions != null && !wsSessions.isEmpty()) {\n+            for (WsSession wsSession : wsSessions) {\n+                try {\n+                    wsSession.close(AUTHENTICATED_HTTP_SESSION_CLOSED);\n+                } catch (IOException e) {\n+                    // Any IOExceptions during close will have been caught and the\n+                    // onError method called.\n+                }\n             }\n         }\n     }",
                "raw_url": "https://github.com/apache/tomcat80/raw/bc74aeacaa80733ddaca728fdda44e1a92c94711/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "sha": "c704d9fd21cc8b1e28272c9700230f6c0fd681ad",
                "status": "modified"
            }
        ],
        "message": "Avoid NPE when a background thread tries to expire the HTTP sessions.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1499534 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/df74e687dea4ddc8afd05222487702ece4572627",
        "patched_files": [
            "WsServerContainer.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestWsServerContainer.java"
        ]
    },
    "tomcat80_bea00bb": {
        "bug_id": "tomcat80_bea00bb",
        "commit": "https://github.com/apache/tomcat80/commit/bea00bb9065b096e2b26e2e1603fd2e6ebb50200",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/bea00bb9065b096e2b26e2e1603fd2e6ebb50200/java/org/apache/tomcat/util/res/StringManager.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/res/StringManager.java?ref=bea00bb9065b096e2b26e2e1603fd2e6ebb50200",
                "deletions": 1,
                "filename": "java/org/apache/tomcat/util/res/StringManager.java",
                "patch": "@@ -109,7 +109,10 @@ public String getString(String key) {\n         String str = null;\n \n         try {\n-            str = bundle.getString(key);\n+            // Avoid NPE if bundle is null and treat it like an MRE\n+            if (bundle != null) {\n+                str = bundle.getString(key);\n+            }\n         } catch(MissingResourceException mre) {\n             //bad: shouldn't mask an exception the following way:\n             //   str = \"[cannot find message associated with key '\" + key + \"' due to \" + mre + \"]\";",
                "raw_url": "https://github.com/apache/tomcat80/raw/bea00bb9065b096e2b26e2e1603fd2e6ebb50200/java/org/apache/tomcat/util/res/StringManager.java",
                "sha": "4f3eb189e803b275d44db891ed3ede214229e8de",
                "status": "modified"
            }
        ],
        "message": "Avoid NPE if bundle is missing\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@898297 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/1d2db306032e5e3ef0d69ed1ee1d3c3dd0e71545",
        "patched_files": [
            "StringManager.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestStringManager.java"
        ]
    },
    "tomcat80_bfda055": {
        "bug_id": "tomcat80_bfda055",
        "commit": "https://github.com/apache/tomcat80/commit/bfda05544d3fe91a5fa06ffd99f48b27ba5fcb8c",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/bfda05544d3fe91a5fa06ffd99f48b27ba5fcb8c/java/org/apache/catalina/loader/VirtualWebappLoader.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/loader/VirtualWebappLoader.java?ref=bfda05544d3fe91a5fa06ffd99f48b27ba5fcb8c",
                "deletions": 1,
                "filename": "java/org/apache/catalina/loader/VirtualWebappLoader.java",
                "patch": "@@ -57,7 +57,7 @@\n     /**\n      * <code>;</code> separated list of additional path elements.\n      */\n-    private String virtualClasspath;\n+    private String virtualClasspath = \"\";\n \n     /**\n      * Construct a new WebappLoader with no defined parent class loader (so that",
                "raw_url": "https://github.com/apache/tomcat80/raw/bfda05544d3fe91a5fa06ffd99f48b27ba5fcb8c/java/org/apache/catalina/loader/VirtualWebappLoader.java",
                "sha": "2d69c4cee05ad8c69f5e84a525852e0476fba7a5",
                "status": "modified"
            }
        ],
        "message": "Fix NPE in unconfigured VirtualWebappLoader.\nStringTokenizer throws the NPE if the virtualClassPath\nwasn't explicitely configured (null by default).\n\nThis might not be observed in the wild because a\nVirtualWebappLoader without a configured virtualClassPath\nisn't expected. But if you extend the class and add\nfeatures, then this might well happen.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1401472 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/34e0ec91253747c000605210f190b1c96f518df2",
        "patched_files": [
            "VirtualWebappLoader.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestVirtualWebappLoader.java"
        ]
    },
    "tomcat80_c0df5fa": {
        "bug_id": "tomcat80_c0df5fa",
        "commit": "https://github.com/apache/tomcat80/commit/c0df5fab662abc752b4b63ac00a16987d0c2ab2c",
        "file": [
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tomcat80/blob/c0df5fab662abc752b4b63ac00a16987d0c2ab2c/java/javax/el/ELContext.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/javax/el/ELContext.java?ref=c0df5fab662abc752b4b63ac00a16987d0c2ab2c",
                "deletions": 0,
                "filename": "java/javax/el/ELContext.java",
                "patch": "@@ -77,7 +77,14 @@ public void putContext(@SuppressWarnings(\"rawtypes\") Class key,\n     }\n \n     // Can't use Class<?> because API needs to match specification\n+    /**\n+     * @throws NullPointerException\n+     *              If the key is <code>null</code>\n+     */\n     public Object getContext(@SuppressWarnings(\"rawtypes\") Class key) {\n+        if (key == null) {\n+            throw new NullPointerException();\n+        }\n         if (this.map == null) {\n             return null;\n         }",
                "raw_url": "https://github.com/apache/tomcat80/raw/c0df5fab662abc752b4b63ac00a16987d0c2ab2c/java/javax/el/ELContext.java",
                "sha": "014e802d4c259b4bd78b48fa5aed7fe3153a27af",
                "status": "modified"
            },
            {
                "additions": 32,
                "blob_url": "https://github.com/apache/tomcat80/blob/c0df5fab662abc752b4b63ac00a16987d0c2ab2c/test/javax/el/TestELContext.java",
                "changes": 32,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/javax/el/TestELContext.java?ref=c0df5fab662abc752b4b63ac00a16987d0c2ab2c",
                "deletions": 0,
                "filename": "test/javax/el/TestELContext.java",
                "patch": "@@ -0,0 +1,32 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package javax.el;\n+\n+import org.junit.Test;\n+\n+public class TestELContext {\n+\n+    /**\n+     * Tests that a null key results in an NPE as per EL Javadoc.\n+     */\n+    @Test(expected = NullPointerException.class)\n+    public void testGetContext() {\n+        ELContext elContext = new TesterELContext();\n+        elContext.getContext(null);\n+    }\n+\n+}",
                "raw_url": "https://github.com/apache/tomcat80/raw/c0df5fab662abc752b4b63ac00a16987d0c2ab2c/test/javax/el/TestELContext.java",
                "sha": "d59b19a5e46b738878505df81ea0a2c0605feb64",
                "status": "added"
            },
            {
                "additions": 36,
                "blob_url": "https://github.com/apache/tomcat80/blob/c0df5fab662abc752b4b63ac00a16987d0c2ab2c/test/javax/el/TesterELContext.java",
                "changes": 36,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/javax/el/TesterELContext.java?ref=c0df5fab662abc752b4b63ac00a16987d0c2ab2c",
                "deletions": 0,
                "filename": "test/javax/el/TesterELContext.java",
                "patch": "@@ -0,0 +1,36 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package javax.el;\n+\n+public class TesterELContext extends ELContext {\n+\n+    @Override\n+    public ELResolver getELResolver() {\n+        return null;\n+    }\n+\n+    @Override\n+    public FunctionMapper getFunctionMapper() {\n+        return null;\n+    }\n+\n+    @Override\n+    public VariableMapper getVariableMapper() {\n+        return null;\n+    }\n+\n+}",
                "raw_url": "https://github.com/apache/tomcat80/raw/c0df5fab662abc752b4b63ac00a16987d0c2ab2c/test/javax/el/TesterELContext.java",
                "sha": "c0fd1a2f7c1ddf2cac43c0f64463a1888da788ce",
                "status": "added"
            }
        ],
        "message": "Since EL 2.2 javadoc ELContext.getContext must throw NPE when the key that is provided in NULL.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1499953 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/732f6f3c82166c81710a0dbe1ecbdbf02f5a0561",
        "patched_files": [
            "ELContext.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestELContext.java",
            "TesterELContext.java"
        ]
    },
    "tomcat80_c267e9b": {
        "bug_id": "tomcat80_c267e9b",
        "commit": "https://github.com/apache/tomcat80/commit/c267e9bcf0c14e4fa95d2c3aac793a3db5090e55",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/c267e9bcf0c14e4fa95d2c3aac793a3db5090e55/java/org/apache/catalina/core/StandardContext.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/StandardContext.java?ref=c267e9bcf0c14e4fa95d2c3aac793a3db5090e55",
                "deletions": 1,
                "filename": "java/org/apache/catalina/core/StandardContext.java",
                "patch": "@@ -5755,7 +5755,7 @@ protected ClassLoader bindThread() {\n         ClassLoader oldContextClassLoader =\n             Thread.currentThread().getContextClassLoader();\n \n-        if (getLoader().getClassLoader() != null) {\n+        if (getLoader() != null && getLoader().getClassLoader() != null) {\n             Thread.currentThread().setContextClassLoader\n                 (getLoader().getClassLoader());\n         }",
                "raw_url": "https://github.com/apache/tomcat80/raw/c267e9bcf0c14e4fa95d2c3aac793a3db5090e55/java/org/apache/catalina/core/StandardContext.java",
                "sha": "ceee4af447aa6a75bcc2e909e76eeb75f3a3ee05",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/c267e9bcf0c14e4fa95d2c3aac793a3db5090e55/java/org/apache/catalina/webresources/StandardRoot.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/webresources/StandardRoot.java?ref=c267e9bcf0c14e4fa95d2c3aac793a3db5090e55",
                "deletions": 1,
                "filename": "java/org/apache/catalina/webresources/StandardRoot.java",
                "patch": "@@ -486,7 +486,9 @@ protected void stopInternal() throws LifecycleException {\n             }\n         }\n \n-        main.destroy();\n+        if (main != null) {\n+            main.destroy();\n+        }\n         mainResources.clear();\n \n         for (WebResourceSet webResourceSet : jarResources) {",
                "raw_url": "https://github.com/apache/tomcat80/raw/c267e9bcf0c14e4fa95d2c3aac793a3db5090e55/java/org/apache/catalina/webresources/StandardRoot.java",
                "sha": "047783c0be32542cb60f028a39d3fa5deec040b4",
                "status": "modified"
            }
        ],
        "message": "Avoid NPEs when attempting to destroy contexts that failed to start.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1482602 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/d6c14fd6bad608a68bc9cff712ee17a5359d86c1",
        "patched_files": [
            "StandardContext.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestStandardContext.java"
        ]
    },
    "tomcat80_c2bd6e1": {
        "bug_id": "tomcat80_c2bd6e1",
        "commit": "https://github.com/apache/tomcat80/commit/c2bd6e13f776c37680851bc9863e9ee291e79910",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/c2bd6e13f776c37680851bc9863e9ee291e79910/java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java?ref=c2bd6e13f776c37680851bc9863e9ee291e79910",
                "deletions": 0,
                "filename": "java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java",
                "patch": "@@ -82,6 +82,7 @@ protected void doWrite(SendHandler handler, ByteBuffer... buffers) {\n \n \n     public void onWritePossible(boolean useDispatch) {\n+        ByteBuffer[] buffers = this.buffers;\n         if (buffers == null) {\n             // Servlet 3.1 will call the write listener once even if nothing\n             // was written",
                "raw_url": "https://github.com/apache/tomcat80/raw/c2bd6e13f776c37680851bc9863e9ee291e79910/java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java",
                "sha": "fc1fb7ffb98411f695c17cb728ad2631e22d8f53",
                "status": "modified"
            }
        ],
        "message": "Avoid NPE causing failure in TestClose\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1719745 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/fd7e6ee3167b4fb43f2ef81edbb9af3841a00425",
        "patched_files": [
            "WsRemoteEndpointImplServer.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestWsRemoteEndpointImplServer.java"
        ]
    },
    "tomcat80_c52fc22": {
        "bug_id": "tomcat80_c52fc22",
        "commit": "https://github.com/apache/tomcat80/commit/c52fc2252a9bf807c2bddf5b5f8aab37fe515f19",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tomcat80/blob/c52fc2252a9bf807c2bddf5b5f8aab37fe515f19/test/org/apache/catalina/loader/TestWebappClassLoaderExecutorMemoryLeak.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/loader/TestWebappClassLoaderExecutorMemoryLeak.java?ref=c52fc2252a9bf807c2bddf5b5f8aab37fe515f19",
                "deletions": 4,
                "filename": "test/org/apache/catalina/loader/TestWebappClassLoaderExecutorMemoryLeak.java",
                "patch": "@@ -49,7 +49,8 @@ public void testTimerThreadLeak() throws Exception {\n             ((StandardContext) ctx).setClearReferencesStopThreads(true);\n         }\n \n-        Tomcat.addServlet(ctx, \"taskServlet\", new ExecutorServlet());\n+        ExecutorServlet executorServlet = new ExecutorServlet();\n+        Tomcat.addServlet(ctx, \"taskServlet\", executorServlet);\n         ctx.addServletMapping(\"/\", \"taskServlet\");\n \n         tomcat.start();\n@@ -67,8 +68,8 @@ public void testTimerThreadLeak() throws Exception {\n             // ignore\n         }\n \n-        Assert.assertTrue(ExecutorServlet.tpe.isShutdown());\n-        Assert.assertTrue(ExecutorServlet.tpe.isTerminated());\n+        Assert.assertTrue(executorServlet.tpe.isShutdown());\n+        Assert.assertTrue(executorServlet.tpe.isTerminated());\n     }\n \n     static class ExecutorServlet extends HttpServlet {\n@@ -79,7 +80,7 @@ public void testTimerThreadLeak() throws Exception {\n         long n = 1000L;\n         int tpSize = 10;\n \n-        public static ThreadPoolExecutor tpe;\n+        public volatile ThreadPoolExecutor tpe;\n \n         @Override\n         protected void doGet(HttpServletRequest req, HttpServletResponse resp)",
                "raw_url": "https://github.com/apache/tomcat80/raw/c52fc2252a9bf807c2bddf5b5f8aab37fe515f19/test/org/apache/catalina/loader/TestWebappClassLoaderExecutorMemoryLeak.java",
                "sha": "641066980b548bd7f4d25c01b88c7f2b664d3366",
                "status": "modified"
            }
        ],
        "message": "Observed strange NPE while running tests. This isn't much more than a guess at what might have caused it.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1304037 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/a86c3e93c401f5a3beba487f312fbf57dd471e58",
        "patched_files": [],
        "repo": "tomcat80",
        "unit_tests": [
            "TestWebappClassLoaderExecutorMemoryLeak.java"
        ]
    },
    "tomcat80_cd2fc4a": {
        "bug_id": "tomcat80_cd2fc4a",
        "commit": "https://github.com/apache/tomcat80/commit/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tomcat80/blob/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872/java/org/apache/el/Messages.properties",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/el/Messages.properties?ref=cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872",
                "deletions": 0,
                "filename": "java/org/apache/el/Messages.properties",
                "patch": "@@ -21,6 +21,8 @@ error.unreachable.base=Target Unreachable, identifier ''{0}'' resolved to null\n error.unreachable.property=Target Unreachable, ''{0}'' returned null\n error.resolver.unhandled=ELResolver did not handle type: {0} with property of ''{1}''\n error.resolver.unhandled.null=ELResolver cannot handle a null base Object with identifier ''{0}''\n+error.invoke.wrongParams=The method [{0}] was called with [{1}] parameter(s) when it expected [{2}]\n+error.invoke.tooFewParams=The method [{0}] was called with [{1}] parameter(s) when it expected at least [{2}]\n \n # ValueExpressionLiteral\n error.value.literal.write=ValueExpression is a literal and not writable: {0}",
                "raw_url": "https://github.com/apache/tomcat80/raw/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872/java/org/apache/el/Messages.properties",
                "sha": "f3d87089a630e3d8ad8e85cb821429b123d29731",
                "status": "modified"
            },
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/tomcat80/blob/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872/java/org/apache/el/parser/AstValue.java",
                "changes": 20,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/el/parser/AstValue.java?ref=cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872",
                "deletions": 1,
                "filename": "java/org/apache/el/parser/AstValue.java",
                "patch": "@@ -237,7 +237,7 @@ public Object invoke(EvaluationContext ctx,\n         }\n         m = ReflectionUtil.getMethod(ctx, t.base, t.property, types, values);\n \n-        // Handle varArgs and any co-ercion required\n+        // Handle varArgs and any coercion required\n         values = convertArgs(ctx, values, m);\n \n         Object result = null;\n@@ -268,6 +268,24 @@ public Object invoke(EvaluationContext ctx,\n \n         int paramCount = types.length;\n \n+        if (paramCount > 0 && src == null ||\n+                m.isVarArgs() && src.length < paramCount ||\n+                !m.isVarArgs() && src.length != paramCount) {\n+            String inputParamCount = null;\n+            if (src != null) {\n+                inputParamCount = Integer.toString(src.length);\n+            }\n+            String msg;\n+            if (m.isVarArgs()) {\n+                msg = MessageFactory.get(\"error.invoke.tooFewParams\",\n+                        m.getName(), inputParamCount, Integer.toString(paramCount));\n+            } else {\n+                msg = MessageFactory.get(\"error.invoke.wrongParams\",\n+                        m.getName(), inputParamCount, Integer.toString(paramCount));\n+            }\n+            throw new IllegalArgumentException(msg);\n+        }\n+\n         Object[] dest = new Object[paramCount];\n \n         for (int i = 0; i < paramCount - 1; i++) {",
                "raw_url": "https://github.com/apache/tomcat80/raw/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872/java/org/apache/el/parser/AstValue.java",
                "sha": "f20b170200e3a1f2a086ebf5d986f8e66be43a39",
                "status": "modified"
            },
            {
                "additions": 16,
                "blob_url": "https://github.com/apache/tomcat80/blob/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872/test/org/apache/el/TestMethodExpressionImpl.java",
                "changes": 16,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/el/TestMethodExpressionImpl.java?ref=cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872",
                "deletions": 0,
                "filename": "test/org/apache/el/TestMethodExpressionImpl.java",
                "patch": "@@ -482,4 +482,20 @@ public void testBug56797b() {\n         Object r = me.invoke(context, null);\n         assertEquals(\"AA2Hello World!\", r.toString());\n     }\n+\n+\n+    @Test(expected=IllegalArgumentException.class)\n+    public void testBug57855a() {\n+        MethodExpression me = factory.createMethodExpression(context,\n+                \"${beanAA.echo2}\", null , new Class[]{String.class});\n+        me.invoke(context, new Object[0]);\n+    }\n+\n+\n+    @Test(expected=IllegalArgumentException.class)\n+    public void testBug57855b() {\n+        MethodExpression me = factory.createMethodExpression(context,\n+                \"${beanAA.echo2}\", null , new Class[]{String.class});\n+        me.invoke(context, null);\n+    }\n }",
                "raw_url": "https://github.com/apache/tomcat80/raw/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872/test/org/apache/el/TestMethodExpressionImpl.java",
                "sha": "1ddea069db1e1c93866cc17bf603e3e1851fcf6e",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/tomcat80/blob/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872/webapps/docs/changelog.xml",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -146,6 +146,15 @@\n         the JSP are visible (subject to the normal rules on re-compilation)\n         regardless of how the JSP is accessed. (markt)\n       </fix>\n+      <fix>\n+        <bug>57855</bug>: Explicitly handle the case where a\n+        <code>MethodExpression</code> is invoked with null or the wrong number\n+        of parameters. Rather than failing with an\n+        <code>ArrayIndexOutOfBoundsException</code> or a\n+        <code>NullPointerException</code> throw an\n+        <code>IllegalArgumentException</code> with a useful error message.\n+        (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Cluster\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/cd2fc4a6f4d2f3711c2ccc7de2f7ed2a3728a872/webapps/docs/changelog.xml",
                "sha": "9d61b709064f58ffd31689fb7fcdd7c564db5ad5",
                "status": "modified"
            }
        ],
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57855\nExplicitly handle the case where a MethodExpression is invoked with null or the wrong number of parameters. Rather than failing with ArrayIndexOutOfBoundsException or NullPointerException throw an IllegalArgumentException with a useful error message.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1676232 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/caf7e49f3aeef05c8bbd49fb58ce2141c23b7d52",
        "patched_files": [
            "Messages.properties",
            "MethodExpressionImpl.java",
            "AstValue.java",
            "changelog.xml"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestMethodExpressionImpl.java"
        ]
    },
    "tomcat80_ce66490": {
        "bug_id": "tomcat80_ce66490",
        "commit": "https://github.com/apache/tomcat80/commit/ce664906aaeae4ed836e7b8252c820fecdb5cf15",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tomcat80/blob/ce664906aaeae4ed836e7b8252c820fecdb5cf15/java/org/apache/catalina/mapper/Mapper.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/mapper/Mapper.java?ref=ce664906aaeae4ed836e7b8252c820fecdb5cf15",
                "deletions": 2,
                "filename": "java/org/apache/catalina/mapper/Mapper.java",
                "patch": "@@ -878,7 +878,7 @@ private final void internalMapWrapper(ContextVersion contextVersion,\n         }\n \n         if(mappingData.wrapper == null && noServletPath &&\n-                mappingData.context.getMapperContextRootRedirectEnabled()) {\n+                contextVersion.object.getMapperContextRootRedirectEnabled()) {\n             // The path is empty, redirect to \"/\"\n             path.append('/');\n             pathEnd = path.getEnd();\n@@ -1006,7 +1006,7 @@ private final void internalMapWrapper(ContextVersion contextVersion,\n                     file = contextVersion.resources.getResource(pathStr);\n                 }\n                 if (file != null && file.isDirectory() &&\n-                        mappingData.context.getMapperDirectoryRedirectEnabled()) {\n+                        contextVersion.object.getMapperDirectoryRedirectEnabled()) {\n                     // Note: this mutates the path: do not do any processing\n                     // after this (since we set the redirectPath, there\n                     // shouldn't be any)",
                "raw_url": "https://github.com/apache/tomcat80/raw/ce664906aaeae4ed836e7b8252c820fecdb5cf15/java/org/apache/catalina/mapper/Mapper.java",
                "sha": "6de03dd32a7b25354ce1105e6f7abe5cfe6a9b54",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/ce664906aaeae4ed836e7b8252c820fecdb5cf15/webapps/docs/changelog.xml",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=ce664906aaeae4ed836e7b8252c820fecdb5cf15",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -69,6 +69,9 @@\n         and <code>javax.servlet.AsyncEvent.getSuppliedResponse</code>\n         (violetagg)\n       </fix>\n+      <fix>\n+        <bug>59255</bug>: Fix posible NPE in mapper. (kkolinko/remm)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/ce664906aaeae4ed836e7b8252c820fecdb5cf15/webapps/docs/changelog.xml",
                "sha": "acf322adeef7d1dc81824d42c33b80b9a02a9ae5",
                "status": "modified"
            }
        ],
        "message": "59255: Fix posible NPE in mapper, using Konstantin Kolinko's idea.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1737278 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/92ddade6536af5079bee484bd51fb00e66f3ca48",
        "patched_files": [
            "changelog.xml",
            "Mapper.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestMapper.java"
        ]
    },
    "tomcat80_cf5b134": {
        "bug_id": "tomcat80_cf5b134",
        "commit": "https://github.com/apache/tomcat80/commit/cf5b1344dcd9ccce9435b07b2e20435e493b66a2",
        "file": [
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/tomcat80/blob/cf5b1344dcd9ccce9435b07b2e20435e493b66a2/test/org/apache/juli/TestFileHandler.java",
                "changes": 21,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/juli/TestFileHandler.java?ref=cf5b1344dcd9ccce9435b07b2e20435e493b66a2",
                "deletions": 9,
                "filename": "test/org/apache/juli/TestFileHandler.java",
                "patch": "@@ -67,18 +67,21 @@ public void setUp() throws Exception {\n \n     @After\n     public void tearDown() {\n-        for (File file : logsDir.listFiles()) {\n-            file.delete();\n+        File[] files = logsDir.listFiles();\n+        if (files != null) {\n+            for (File file : files) {\n+                file.delete();\n+            }\n+            logsDir.delete();\n         }\n-        logsDir.delete();\n     }\n \n     @SuppressWarnings(\"unused\")\n     @Test\n     public void testCleanOnInitOneHandler() throws Exception {\n         generateLogFiles(logsDir, PREFIX_1, SUFIX_1, 3);\n \n-        FileHandler handler = new FileHandler(logsDir.getAbsolutePath(), PREFIX_1, SUFIX_1, 2);\n+        new FileHandler(logsDir.getAbsolutePath(), PREFIX_1, SUFIX_1, 2);\n \n         Thread.sleep(1000);\n \n@@ -90,10 +93,10 @@ public void testCleanOnInitOneHandler() throws Exception {\n     public void testCleanOnInitMultipleHandlers() throws Exception {\n         generateLogFiles(logsDir, PREFIX_1, SUFIX_1, 3);\n \n-        FileHandler handler1 = new FileHandler(logsDir.getAbsolutePath(), PREFIX_1, SUFIX_1, 2);\n-        FileHandler handler2 = new FileHandler(logsDir.getAbsolutePath(), PREFIX_1, SUFIX_2, 2);\n-        FileHandler handler3 = new FileHandler(logsDir.getAbsolutePath(), PREFIX_2, SUFIX_1, 2);\n-        FileHandler handler4 = new FileHandler(logsDir.getAbsolutePath(), PREFIX_3, SUFIX_1, 2);\n+        new FileHandler(logsDir.getAbsolutePath(), PREFIX_1, SUFIX_1, 2);\n+        new FileHandler(logsDir.getAbsolutePath(), PREFIX_1, SUFIX_2, 2);\n+        new FileHandler(logsDir.getAbsolutePath(), PREFIX_2, SUFIX_1, 2);\n+        new FileHandler(logsDir.getAbsolutePath(), PREFIX_3, SUFIX_1, 2);\n \n         Thread.sleep(1000);\n \n@@ -105,7 +108,7 @@ public void testCleanOnInitMultipleHandlers() throws Exception {\n     public void testCleanDisabled() throws Exception {\n         generateLogFiles(logsDir, PREFIX_1, SUFIX_1, 3);\n \n-        FileHandler handler = new FileHandler(logsDir.getAbsolutePath(), PREFIX_1, SUFIX_1, -1);\n+        new FileHandler(logsDir.getAbsolutePath(), PREFIX_1, SUFIX_1, -1);\n \n         Thread.sleep(1000);\n ",
                "raw_url": "https://github.com/apache/tomcat80/raw/cf5b1344dcd9ccce9435b07b2e20435e493b66a2/test/org/apache/juli/TestFileHandler.java",
                "sha": "b0969a387f61dce40d3999422c7c040d090deb8a",
                "status": "modified"
            }
        ],
        "message": "Fix NPE and dead store warnings.\nReported by FindBugs.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1800990 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/e6a1cd1901713624d8d1ef24e265034aa367e376",
        "patched_files": [
            "FileHandler.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestFileHandler.java"
        ]
    },
    "tomcat80_cfca14d": {
        "bug_id": "tomcat80_cfca14d",
        "commit": "https://github.com/apache/tomcat80/commit/cfca14d137fb5ba64720b318cd54dba28e0d43c5",
        "file": [
            {
                "additions": 16,
                "blob_url": "https://github.com/apache/tomcat80/blob/cfca14d137fb5ba64720b318cd54dba28e0d43c5/java/org/apache/tomcat/websocket/Util.java",
                "changes": 30,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/Util.java?ref=cfca14d137fb5ba64720b318cd54dba28e0d43c5",
                "deletions": 14,
                "filename": "java/org/apache/tomcat/websocket/Util.java",
                "patch": "@@ -332,21 +332,23 @@ public static Object coerceToType(Class<?> type, String value) {\n                     throws DeploymentException{\n \n         List<DecoderEntry> result = new ArrayList<>();\n-        for (Class<? extends Decoder> decoderClazz : decoderClazzes) {\n-            // Need to instantiate decoder to ensure it is valid and that\n-            // deployment can be failed if it is not\n-            @SuppressWarnings(\"unused\")\n-            Decoder instance;\n-            try {\n-                instance = decoderClazz.newInstance();\n-            } catch (InstantiationException | IllegalAccessException e) {\n-                throw new DeploymentException(\n-                        sm.getString(\"pojoMethodMapping.invalidDecoder\",\n-                                decoderClazz.getName()), e);\n+        if (decoderClazzes != null) {\n+            for (Class<? extends Decoder> decoderClazz : decoderClazzes) {\n+                // Need to instantiate decoder to ensure it is valid and that\n+                // deployment can be failed if it is not\n+                @SuppressWarnings(\"unused\")\n+                Decoder instance;\n+                try {\n+                    instance = decoderClazz.newInstance();\n+                } catch (InstantiationException | IllegalAccessException e) {\n+                    throw new DeploymentException(\n+                            sm.getString(\"pojoMethodMapping.invalidDecoder\",\n+                                    decoderClazz.getName()), e);\n+                }\n+                DecoderEntry entry = new DecoderEntry(\n+                        Util.getDecoderType(decoderClazz), decoderClazz);\n+                result.add(entry);\n             }\n-            DecoderEntry entry = new DecoderEntry(\n-                    Util.getDecoderType(decoderClazz), decoderClazz);\n-            result.add(entry);\n         }\n \n         return result;",
                "raw_url": "https://github.com/apache/tomcat80/raw/cfca14d137fb5ba64720b318cd54dba28e0d43c5/java/org/apache/tomcat/websocket/Util.java",
                "sha": "22d3b4514d1a79e8f2407efd3b3235646a1107a0",
                "status": "modified"
            }
        ],
        "message": "NPE protection. Note NPE only possible with test code.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1630199 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/c9d804dd1c75eb63cb0c7a6e59d85d0c77d67bb1",
        "patched_files": [
            "Util.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestUtil.java"
        ]
    },
    "tomcat80_d03ccdc": {
        "bug_id": "tomcat80_d03ccdc",
        "commit": "https://github.com/apache/tomcat80/commit/d03ccdc1609048791c6efaf6a1a70ff1a36afa91",
        "file": [
            {
                "additions": 26,
                "blob_url": "https://github.com/apache/tomcat80/blob/d03ccdc1609048791c6efaf6a1a70ff1a36afa91/test/org/apache/catalina/websocket/TestWebSocket.java",
                "changes": 49,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/websocket/TestWebSocket.java?ref=d03ccdc1609048791c6efaf6a1a70ff1a36afa91",
                "deletions": 23,
                "filename": "test/org/apache/catalina/websocket/TestWebSocket.java",
                "patch": "@@ -38,10 +38,7 @@\n import javax.naming.NamingException;\n import javax.servlet.http.HttpServletRequest;\n \n-import static org.junit.Assert.assertEquals;\n-import static org.junit.Assert.assertFalse;\n-import static org.junit.Assert.assertTrue;\n-\n+import org.junit.Assert;\n import org.junit.Test;\n \n import org.apache.catalina.Context;\n@@ -84,19 +81,20 @@ public void testSimple() throws Exception {\n \n         // Make sure we got an upgrade response\n         String responseLine = client.reader.readLine();\n-        assertTrue(responseLine.startsWith(\"HTTP/1.1 101\"));\n+        Assert.assertNotNull(responseLine);\n+        Assert.assertTrue(responseLine.startsWith(\"HTTP/1.1 101\"));\n \n         // Swallow the headers\n         String responseHeaderLine = client.reader.readLine();\n-        while (!responseHeaderLine.equals(\"\")) {\n+        while (!\"\".equals(responseHeaderLine)) {\n             responseHeaderLine = client.reader.readLine();\n         }\n \n         // Now we can do WebSocket\n         client.sendMessage(\"foo\", false);\n         client.sendMessage(\"foo\", true);\n \n-        assertEquals(\"foofoo\", client.readMessage());\n+        Assert.assertEquals(\"foofoo\", client.readMessage());\n \n         // Finished with the socket\n         client.close();\n@@ -123,17 +121,18 @@ public void testDetectWrongVersion() throws Exception {\n \n         // Make sure we got an upgrade response\n         String responseLine = client.reader.readLine();\n-        assertTrue(responseLine.startsWith(\"HTTP/1.1 426\"));\n+        Assert.assertNotNull(responseLine);\n+        Assert.assertTrue(responseLine.startsWith(\"HTTP/1.1 426\"));\n \n-        List<String> headerlines = new ArrayList<String>();\n+        List<String> headerlines = new ArrayList<>();\n \n         String responseHeaderLine = client.reader.readLine();\n-        while (!responseHeaderLine.equals(\"\")) {\n+        while (!\"\".equals(responseHeaderLine)) {\n             headerlines.add(responseHeaderLine);\n             responseHeaderLine = client.reader.readLine();\n         }\n \n-        assertTrue(headerlines.contains(\"Sec-WebSocket-Version: 13\"));\n+        Assert.assertTrue(headerlines.contains(\"Sec-WebSocket-Version: 13\"));\n         // Finished with the socket\n         client.close();\n     }\n@@ -159,7 +158,8 @@ public void testNoConnection() throws Exception {\n \n         // Make sure we got an upgrade response\n         String responseLine = client.reader.readLine();\n-        assertTrue(responseLine.startsWith(\"HTTP/1.1 400\"));\n+        Assert.assertNotNull(responseLine);\n+        Assert.assertTrue(responseLine.startsWith(\"HTTP/1.1 400\"));\n \n         // Finished with the socket\n         client.close();\n@@ -186,7 +186,8 @@ public void testNoUpgrade() throws Exception {\n \n         // Make sure we got an upgrade response\n         String responseLine = client.reader.readLine();\n-        assertTrue(responseLine.startsWith(\"HTTP/1.1 400\"));\n+        Assert.assertNotNull(responseLine);\n+        Assert.assertTrue(responseLine.startsWith(\"HTTP/1.1 400\"));\n \n         // Finished with the socket\n         client.close();\n@@ -213,28 +214,29 @@ public void testKey() throws Exception {\n \n         // Make sure we got an upgrade response\n         String responseLine = client.reader.readLine();\n-        assertTrue(responseLine.startsWith(\"HTTP/1.1 101\"));\n+        Assert.assertNotNull(responseLine);\n+        Assert.assertTrue(responseLine.startsWith(\"HTTP/1.1 101\"));\n \n         String accept = null;\n         String responseHeaderLine = client.reader.readLine();\n-        while (!responseHeaderLine.equals(\"\")) {\n+        while (!\"\".equals(responseHeaderLine)) {\n             if(responseHeaderLine.startsWith(\"Sec-WebSocket-Accept: \")) {\n                 accept = responseHeaderLine.substring(responseHeaderLine.indexOf(\":\")+2);\n                 break;\n             }\n             responseHeaderLine = client.reader.readLine();\n         }\n-        assertTrue(accept != null);\n+        Assert.assertTrue(accept != null);\n         MessageDigest sha1Helper = MessageDigest.getInstance(\"SHA1\");\n         sha1Helper.reset();\n         sha1Helper.update(\"TODO\".getBytes(B2CConverter.ISO_8859_1));\n         String source = Base64.encode(sha1Helper.digest(WS_ACCEPT));\n-        assertEquals(source,accept);\n+        Assert.assertEquals(source,accept);\n \n         sha1Helper.reset();\n         sha1Helper.update(\"TOD\".getBytes(B2CConverter.ISO_8859_1));\n         source = Base64.encode(sha1Helper.digest(WS_ACCEPT));\n-        assertFalse(source.equals(accept));\n+        Assert.assertFalse(source.equals(accept));\n         // Finished with the socket\n         client.close();\n     }\n@@ -275,17 +277,18 @@ public void testBug53339() throws Exception {\n \n         // Make sure we got an upgrade response\n         String responseLine = client.reader.readLine();\n-        assertTrue(responseLine.startsWith(\"HTTP/1.1 101\"));\n+        Assert.assertNotNull(responseLine);\n+        Assert.assertTrue(responseLine.startsWith(\"HTTP/1.1 101\"));\n \n         // Swallow the headers\n         String responseHeaderLine = client.reader.readLine();\n-        while (!responseHeaderLine.equals(\"\")) {\n+        while (!\"\".equals(responseHeaderLine)) {\n             responseHeaderLine = client.reader.readLine();\n         }\n \n         // Now we can do WebSocket\n         String msg = client.readMessage();\n-        assertEquals(Bug53339WsInbound.TEST_MESSAGE, msg);\n+        Assert.assertEquals(Bug53339WsInbound.TEST_MESSAGE, msg);\n \n         // Finished with the socket\n         client.close();\n@@ -377,7 +380,7 @@ private void sendMessage(String message, boolean finalFragment)\n             c2b.flushBuffer();\n \n             int len = bc.getLength();\n-            assertTrue(len < 126);\n+            Assert.assertTrue(len < 126);\n \n             byte first;\n             if (isContinuation) {\n@@ -416,7 +419,7 @@ private String readMessage() throws IOException {\n \n             // Get payload length\n             int len = is.read() & 0x7F;\n-            assertTrue(len < 126);\n+            Assert.assertTrue(len < 126);\n \n             // Read payload\n             int read = 0;",
                "raw_url": "https://github.com/apache/tomcat80/raw/d03ccdc1609048791c6efaf6a1a70ff1a36afa91/test/org/apache/catalina/websocket/TestWebSocket.java",
                "sha": "0f4b4e4a0a02cc05bb12adee9611e936f3952d0d",
                "status": "modified"
            }
        ],
        "message": "Clean-up\n- Fix FindBugs NPE warnings\n- Java 7 <>\n- Remove static imports (auto completes are easier without them)\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1377835 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/f126dbec60acfa91c03e0c16bc770bafaf9ac4c5",
        "patched_files": [],
        "repo": "tomcat80",
        "unit_tests": [
            "TestWebSocket.java"
        ]
    },
    "tomcat80_d4ab316": {
        "bug_id": "tomcat80_d4ab316",
        "commit": "https://github.com/apache/tomcat80/commit/d4ab3162002c6cf37f73e36875e3eb704ad74537",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/d4ab3162002c6cf37f73e36875e3eb704ad74537/java/org/apache/catalina/core/StandardWrapper.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/core/StandardWrapper.java?ref=d4ab3162002c6cf37f73e36875e3eb704ad74537",
                "deletions": 3,
                "filename": "java/org/apache/catalina/core/StandardWrapper.java",
                "patch": "@@ -1115,10 +1115,11 @@ public synchronized Servlet loadServlet() throws ServletException {\n \n             classLoadTime=(int) (System.currentTimeMillis() -t1);\n \n-            singleThreadModel = servlet instanceof SingleThreadModel;\n-            if (singleThreadModel) {\n-                if (instancePool == null)\n+            if (servlet instanceof SingleThreadModel) {\n+                if (instancePool == null) {\n                     instancePool = new Stack<Servlet>();\n+                }\n+                singleThreadModel = true;\n             }\n \n             initServlet(servlet);",
                "raw_url": "https://github.com/apache/tomcat80/raw/d4ab3162002c6cf37f73e36875e3eb704ad74537/java/org/apache/catalina/core/StandardWrapper.java",
                "sha": "95d857fb8822fa5d3581093ba8920243fe92460d",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/d4ab3162002c6cf37f73e36875e3eb704ad74537/webapps/docs/changelog.xml",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=d4ab3162002c6cf37f73e36875e3eb704ad74537",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -186,6 +186,10 @@\n         support (enhancement <bug>12428</bug>) that could trigger authentication\n         even if preemptive authentication was disabled. (markt) \n       </fix>\n+      <fix>\n+        Prevent possible NPE when serving Servlets that implement the\n+        SingleThreadModel interface. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/d4ab3162002c6cf37f73e36875e3eb704ad74537/webapps/docs/changelog.xml",
                "sha": "1408706322c26e2bf4cada206b61ea90e1eacfac",
                "status": "modified"
            }
        ],
        "message": "Fix possible NPE when serving STM servlets\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1141948 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/385a83b9408c2cf7738eeecaa911a4ca2f651ff3",
        "patched_files": [
            "StandardWrapper.java",
            "changelog.xml"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestStandardWrapper.java"
        ]
    },
    "tomcat80_d75ddaf": {
        "bug_id": "tomcat80_d75ddaf",
        "commit": "https://github.com/apache/tomcat80/commit/d75ddafcc629ae61fc024252ddbc86305283954a",
        "file": [
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/tomcat80/blob/d75ddafcc629ae61fc024252ddbc86305283954a/java/org/apache/catalina/ha/context/ReplicatedContext.java",
                "changes": 15,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/ha/context/ReplicatedContext.java?ref=d75ddafcc629ae61fc024252ddbc86305283954a",
                "deletions": 3,
                "filename": "java/org/apache/catalina/ha/context/ReplicatedContext.java",
                "patch": "@@ -83,13 +83,15 @@ protected synchronized void startInternal() throws LifecycleException {\n     @Override\n     protected synchronized void stopInternal() throws LifecycleException {\n \n+        Map<String, Object> map = ((ReplApplContext) this.context)\n+                .getAttributeMap();\n+\n         super.stopInternal();\n \n-        Map<String,Object> map =\n-                ((ReplApplContext)this.context).getAttributeMap();\n         if ( map!=null && map instanceof ReplicatedMap) {\n-            ((ReplicatedMap<?,?>)map).breakdown();\n+            ((ReplicatedMap<?, ?>) map).breakdown();\n         }\n+\n     }\n \n \n@@ -160,6 +162,13 @@ public void removeAttribute(String name) {\n \n         @Override\n         public void setAttribute(String name, Object value) {\n+            if (name == null) {\n+                throw new IllegalArgumentException(sm.getString(\"applicationContext.setAttribute.namenull\"));\n+            }\n+            if (value == null) {\n+                removeAttribute(name);\n+                return;\n+            }\n             if ( (!getParent().getState().isAvailable()) || \"org.apache.jasper.runtime.JspApplicationContextImpl\".equals(name) ){\n                 tomcatAttributes.put(name,value);\n             } else",
                "raw_url": "https://github.com/apache/tomcat80/raw/d75ddafcc629ae61fc024252ddbc86305283954a/java/org/apache/catalina/ha/context/ReplicatedContext.java",
                "sha": "7349bd92b27c718f0804d56532c0ba93596f5146",
                "status": "modified"
            },
            {
                "additions": 56,
                "blob_url": "https://github.com/apache/tomcat80/blob/d75ddafcc629ae61fc024252ddbc86305283954a/test/org/apache/catalina/ha/context/TestReplicatedContext.java",
                "changes": 56,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/ha/context/TestReplicatedContext.java?ref=d75ddafcc629ae61fc024252ddbc86305283954a",
                "deletions": 0,
                "filename": "test/org/apache/catalina/ha/context/TestReplicatedContext.java",
                "patch": "@@ -0,0 +1,56 @@\n+package org.apache.catalina.ha.context;\n+\n+import java.io.File;\n+import java.io.IOException;\n+\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServlet;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+\n+import org.apache.catalina.Context;\n+import org.apache.catalina.Host;\n+import org.apache.catalina.LifecycleException;\n+import org.apache.catalina.core.StandardHost;\n+import org.apache.catalina.startup.Tomcat;\n+import org.apache.catalina.startup.TomcatBaseTest;\n+import org.apache.tomcat.util.buf.ByteChunk;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+public class TestReplicatedContext extends TomcatBaseTest {\n+\n+    @Test\n+    public void testBug57425() throws LifecycleException, IOException, ServletException {\n+        Tomcat tomcat = getTomcatInstance();\n+        Host host = tomcat.getHost();\n+        if (host instanceof StandardHost) {\n+            ((StandardHost) host).setContextClass(ReplicatedContext.class.getName());\n+        }\n+\n+        File root = new File(\"test/webapp\");\n+        Context context = tomcat.addWebapp(host, \"\", \"\", root.getAbsolutePath());\n+\n+        Tomcat.addServlet(context, \"test\", new AccessContextServlet());\n+        context.addServletMapping(\"/access\", \"test\");\n+\n+        tomcat.start();\n+\n+        ByteChunk result = getUrl(\"http://localhost:\" + getPort() + \"/access\");\n+\n+        Assert.assertEquals(\"OK\", result.toString());\n+\n+    }\n+\n+    private static class AccessContextServlet extends HttpServlet {\n+\n+        private static final long serialVersionUID = 1L;\n+\n+        @Override\n+        protected void doGet(HttpServletRequest req, HttpServletResponse resp)\n+                throws ServletException, IOException {\n+            getServletContext().setAttribute(\"NULL\", null);\n+            resp.getWriter().print(\"OK\");\n+        }\n+    }\n+}",
                "raw_url": "https://github.com/apache/tomcat80/raw/d75ddafcc629ae61fc024252ddbc86305283954a/test/org/apache/catalina/ha/context/TestReplicatedContext.java",
                "sha": "ab0c978e4961bb7fb2a9079b4cd3779effc4459b",
                "status": "added"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/d75ddafcc629ae61fc024252ddbc86305283954a/webapps/docs/changelog.xml",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=d75ddafcc629ae61fc024252ddbc86305283954a",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -47,6 +47,9 @@\n <section name=\"Tomcat 8.0.18 (markt)\">\n   <subsection name=\"Catalina\">\n     <changelog>\n+      <fix>\n+        <bug>57425</bug> Don't add attributes with null value or name to the replicated context. (fschumacher)\n+      </fix>\n       <add>\n         <bug>57431</bug> Enable usage of custom class for context creation when using embedded tomcat. (fschumacher)\n       </add>",
                "raw_url": "https://github.com/apache/tomcat80/raw/d75ddafcc629ae61fc024252ddbc86305283954a/webapps/docs/changelog.xml",
                "sha": "b4b668eca31d6dee3bb5948db1f892e6ada6b151",
                "status": "modified"
            }
        ],
        "message": "Don't add orderedLibs attribute if it is null.\nReplicatedContext will fail otherwise.\n\nAvoid NPE on shutdown of ReplicatedContext.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1651421 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/5355d7f2104b627527b389eb341073d9147fc586",
        "patched_files": [
            "ReplicatedContext.java",
            "changelog.xml"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestReplicatedContext.java"
        ]
    },
    "tomcat80_e2cf873": {
        "bug_id": "tomcat80_e2cf873",
        "commit": "https://github.com/apache/tomcat80/commit/e2cf8739888fa7cf01f7beba4ef50906044217e2",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/e2cf8739888fa7cf01f7beba4ef50906044217e2/java/org/apache/catalina/loader/WebappLoader.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/loader/WebappLoader.java?ref=e2cf8739888fa7cf01f7beba4ef50906044217e2",
                "deletions": 1,
                "filename": "java/org/apache/catalina/loader/WebappLoader.java",
                "patch": "@@ -487,7 +487,9 @@ protected void stopInternal() throws LifecycleException {\n         servletContext.removeAttribute(Globals.CLASS_PATH_ATTR);\n \n         // Throw away our current class loader\n-        ((Lifecycle) classLoader).stop();\n+        if (classLoader != null) {\n+            ((Lifecycle) classLoader).stop();\n+        }\n \n         try {\n             String contextName = context.getName();",
                "raw_url": "https://github.com/apache/tomcat80/raw/e2cf8739888fa7cf01f7beba4ef50906044217e2/java/org/apache/catalina/loader/WebappLoader.java",
                "sha": "be429bdf1fdc65de0bf6e0cdc292196d2d0a7aa1",
                "status": "modified"
            },
            {
                "additions": 106,
                "blob_url": "https://github.com/apache/tomcat80/blob/e2cf8739888fa7cf01f7beba4ef50906044217e2/test/org/apache/catalina/core/TestStandardContext.java",
                "changes": 107,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/core/TestStandardContext.java?ref=e2cf8739888fa7cf01f7beba4ef50906044217e2",
                "deletions": 1,
                "filename": "test/org/apache/catalina/core/TestStandardContext.java",
                "patch": "@@ -49,12 +49,17 @@\n import org.junit.Test;\n \n import org.apache.catalina.Context;\n+import org.apache.catalina.Lifecycle;\n+import org.apache.catalina.LifecycleEvent;\n+import org.apache.catalina.LifecycleException;\n+import org.apache.catalina.LifecycleListener;\n import org.apache.catalina.LifecycleState;\n import org.apache.catalina.Wrapper;\n import org.apache.catalina.authenticator.BasicAuthenticator;\n import org.apache.catalina.deploy.FilterDef;\n import org.apache.catalina.deploy.FilterMap;\n import org.apache.catalina.deploy.LoginConfig;\n+import org.apache.catalina.loader.WebappLoader;\n import org.apache.catalina.startup.SimpleHttpClient;\n import org.apache.catalina.startup.TestTomcat.MapRealm;\n import org.apache.catalina.startup.Tomcat;\n@@ -166,13 +171,113 @@ public void doFilter(ServletRequest request, ServletResponse response,\n         public void init(FilterConfig filterConfig) throws ServletException {\n             boolean fail = filterConfig.getInitParameter(\"fail\").equals(\"true\");\n             if (fail) {\n-                throw new ServletException(\"Init fail\",\n+                throw new ServletException(\"Init fail (test)\",\n                         new ClassNotFoundException());\n             }\n         }\n \n     }\n \n+    @Test\n+    public void testWebappLoaderStartFail() throws Exception {\n+        // Test that if WebappLoader start() fails and if the cause of\n+        // the failure is gone, the context can be started without\n+        // a need to redeploy it.\n+\n+        // Set up a container\n+        Tomcat tomcat = getTomcatInstance();\n+        tomcat.start();\n+        // To not start Context automatically, as we have to configure it first\n+        ((ContainerBase) tomcat.getHost()).setStartChildren(false);\n+\n+        FailingWebappLoader loader = new FailingWebappLoader();\n+        File root = new File(\"test/webapp-3.0\");\n+        Context context = tomcat.addWebapp(\"\", root.getAbsolutePath());\n+        context.setLoader(loader);\n+\n+        try {\n+            context.start();\n+            fail();\n+        } catch (LifecycleException ex) {\n+            // As expected\n+        }\n+        assertEquals(LifecycleState.FAILED, context.getState());\n+\n+        // The second attempt\n+        loader.setFail(false);\n+        context.start();\n+        assertEquals(LifecycleState.STARTED, context.getState());\n+\n+        // Using a test from testBug49922() to check that the webapp is running\n+        ByteChunk result = getUrl(\"http://localhost:\" + getPort() +\n+                \"/bug49922/target\");\n+        assertEquals(\"Target\", result.toString());\n+    }\n+\n+    @Test\n+    public void testWebappListenerConfigureFail() throws Exception {\n+        // Test that if LifecycleListener on webapp fails during\n+        // configure_start event and if the cause of the failure is gone,\n+        // the context can be started without a need to redeploy it.\n+\n+        // Set up a container\n+        Tomcat tomcat = getTomcatInstance();\n+        tomcat.start();\n+        // To not start Context automatically, as we have to configure it first\n+        ((ContainerBase) tomcat.getHost()).setStartChildren(false);\n+\n+        FailingLifecycleListener listener = new FailingLifecycleListener();\n+        File root = new File(\"test/webapp-3.0\");\n+        Context context = tomcat.addWebapp(\"\", root.getAbsolutePath());\n+        context.addLifecycleListener(listener);\n+\n+        try {\n+            context.start();\n+            fail();\n+        } catch (LifecycleException ex) {\n+            // As expected\n+        }\n+        assertEquals(LifecycleState.FAILED, context.getState());\n+\n+        // The second attempt\n+        listener.setFail(false);\n+        context.start();\n+        assertEquals(LifecycleState.STARTED, context.getState());\n+\n+        // Using a test from testBug49922() to check that the webapp is running\n+        ByteChunk result = getUrl(\"http://localhost:\" + getPort() +\n+                \"/bug49922/target\");\n+        assertEquals(\"Target\", result.toString());\n+    }\n+\n+    private static class FailingWebappLoader extends WebappLoader {\n+        private boolean fail = true;\n+        protected void setFail(boolean fail) {\n+            this.fail = fail;\n+        }\n+        @Override\n+        protected void startInternal() throws LifecycleException {\n+            if (fail) {\n+                throw new RuntimeException(\"Start fail (test)\");\n+            }\n+            super.startInternal();\n+        }\n+    }\n+\n+    private static class FailingLifecycleListener implements LifecycleListener {\n+        private final String failEvent = Lifecycle.CONFIGURE_START_EVENT;\n+        private boolean fail = true;\n+        protected void setFail(boolean fail) {\n+            this.fail = fail;\n+        }\n+        @Override\n+        public void lifecycleEvent(LifecycleEvent event) {\n+            if (fail && event.getType().equals(failEvent)) {\n+                throw new RuntimeException(failEvent + \" fail (test)\");\n+            }\n+        }\n+    }\n+\n     @Test\n     public void testBug49922() throws Exception {\n         // Test that filter mapping works. Test that the same filter is",
                "raw_url": "https://github.com/apache/tomcat80/raw/e2cf8739888fa7cf01f7beba4ef50906044217e2/test/org/apache/catalina/core/TestStandardContext.java",
                "sha": "47f9ddc3f752949bcdc6d77460760480ab3ae7cb",
                "status": "modified"
            }
        ],
        "message": "Fix NPE in WebappLoader that happens when stop() is called after a failed start.\nAdd tests that a context can be started again after a failure.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1430165 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/77d990ec578deb7e65f59e0a1c2e3d29db4be282",
        "patched_files": [
            "StandardContext.java",
            "WebappLoader.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestStandardContext.java"
        ]
    },
    "tomcat80_e775419": {
        "bug_id": "tomcat80_e775419",
        "commit": "https://github.com/apache/tomcat80/commit/e775419f0bdf7b226d2af1f3b5d3622d9ec619d4",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tomcat80/blob/e775419f0bdf7b226d2af1f3b5d3622d9ec619d4/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/websocket/server/WsServerContainer.java?ref=e775419f0bdf7b226d2af1f3b5d3622d9ec619d4",
                "deletions": 0,
                "filename": "java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "patch": "@@ -451,6 +451,9 @@ ExecutorService getExecutorService() {\n \n \n     void shutdownExecutor() {\n+        if (executorService == null) {\n+            return;\n+        }\n         executorService.shutdown();\n         try {\n             executorService.awaitTermination(10, TimeUnit.SECONDS);",
                "raw_url": "https://github.com/apache/tomcat80/raw/e775419f0bdf7b226d2af1f3b5d3622d9ec619d4/java/org/apache/tomcat/websocket/server/WsServerContainer.java",
                "sha": "ff3f636e01b3284957340c2bf860662b9b218f11",
                "status": "modified"
            }
        ],
        "message": "Avoid NPE on shutdown if application doesn't use WebSocket\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1551481 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/779c15f2cd38624b1086e1a562d0f9a0e51059c5",
        "patched_files": [
            "WsServerContainer.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestWsServerContainer.java"
        ]
    },
    "tomcat80_e7fa400": {
        "bug_id": "tomcat80_e7fa400",
        "commit": "https://github.com/apache/tomcat80/commit/e7fa400322af857dda52466e3c80fcc2a40a297d",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/e7fa400322af857dda52466e3c80fcc2a40a297d/java/org/apache/catalina/mapper/Mapper.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/mapper/Mapper.java?ref=e7fa400322af857dda52466e3c80fcc2a40a297d",
                "deletions": 1,
                "filename": "java/org/apache/catalina/mapper/Mapper.java",
                "patch": "@@ -740,7 +740,7 @@ private final void internalMap(CharChunk host, CharChunk uri,\n         }\n \n         // Context mapping\n-        if (mappingData.context == null) {\n+        if (mappingData.context == null && contexts != null) {\n             int pos = find(contexts, uri);\n             if (pos == -1) {\n                 return;",
                "raw_url": "https://github.com/apache/tomcat80/raw/e7fa400322af857dda52466e3c80fcc2a40a297d/java/org/apache/catalina/mapper/Mapper.java",
                "sha": "3dd168d5229dacaf2543a01c30cd8374c7ca56de",
                "status": "modified"
            }
        ],
        "message": "Avoid unlikely NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1367330 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/4879b6cdb9b8eeacf757c48a885fe05703b28841",
        "patched_files": [
            "Mapper.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestMapper.java"
        ]
    },
    "tomcat80_e864641": {
        "bug_id": "tomcat80_e864641",
        "commit": "https://github.com/apache/tomcat80/commit/e864641a42063e10cc14cc71682b722743c529c2",
        "file": [
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tomcat80/blob/e864641a42063e10cc14cc71682b722743c529c2/java/org/apache/juli/FileHandler.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/juli/FileHandler.java?ref=e864641a42063e10cc14cc71682b722743c529c2",
                "deletions": 3,
                "filename": "java/org/apache/juli/FileHandler.java",
                "patch": "@@ -106,9 +106,13 @@\n \n                 {\n                     SecurityManager s = System.getSecurityManager();\n-                    this.isSecurityEnabled = s != null;\n-                    this.group = isSecurityEnabled ? s.getThreadGroup()\n-                            : Thread.currentThread().getThreadGroup();\n+                    if (s == null) {\n+                        this.isSecurityEnabled = false;\n+                        this.group = Thread.currentThread().getThreadGroup();\n+                    } else {\n+                        this.isSecurityEnabled = true;\n+                        this.group = s.getThreadGroup();\n+                    }\n                 }\n \n                 @Override",
                "raw_url": "https://github.com/apache/tomcat80/raw/e864641a42063e10cc14cc71682b722743c529c2/java/org/apache/juli/FileHandler.java",
                "sha": "8a1233329e2772b97532ea04d31817bc8f0abcfc",
                "status": "modified"
            }
        ],
        "message": "Refactor.\nIt is more verbose but it stops Eclipse complaining about a possible NPE.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1800314 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/f9127cd06f94a2be4b8857d557801bb6979ec615",
        "patched_files": [
            "FileHandler.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestFileHandler.java"
        ]
    },
    "tomcat80_e87faf4": {
        "bug_id": "tomcat80_e87faf4",
        "commit": "https://github.com/apache/tomcat80/commit/e87faf42a998e7bb59d43ceb3daa7deb15b40b93",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/e87faf42a998e7bb59d43ceb3daa7deb15b40b93/java/org/apache/catalina/realm/RealmBase.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/realm/RealmBase.java?ref=e87faf42a998e7bb59d43ceb3daa7deb15b40b93",
                "deletions": 1,
                "filename": "java/org/apache/catalina/realm/RealmBase.java",
                "patch": "@@ -1200,7 +1200,7 @@ protected String digest(String credentials)  {\n     }\n \n     protected boolean hasMessageDigest() {\n-        return !(getDigest() == null && getDigest().length() > 0);\n+        return getDigest() != null;\n     }\n \n     /**",
                "raw_url": "https://github.com/apache/tomcat80/raw/e87faf42a998e7bb59d43ceb3daa7deb15b40b93/java/org/apache/catalina/realm/RealmBase.java",
                "sha": "cedb63a5457f817521ea549e6d31c6fc1f0887af",
                "status": "modified"
            }
        ],
        "message": "Doh! Fix NPE.\nNote digest isn't tested for zero length anywhere else so don't introduce a test here.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1623851 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/ea9f7f787a1ff7aa6b31c25c9441fa337af957a0",
        "patched_files": [
            "RealmBase.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestRealmBase.java"
        ]
    },
    "tomcat80_eacc263": {
        "bug_id": "tomcat80_eacc263",
        "commit": "https://github.com/apache/tomcat80/commit/eacc263964b46ee32e77eb99d7bcdd074cc5a2bb",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/eacc263964b46ee32e77eb99d7bcdd074cc5a2bb/java/org/apache/catalina/connector/Request.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/Request.java?ref=eacc263964b46ee32e77eb99d7bcdd074cc5a2bb",
                "deletions": 0,
                "filename": "java/org/apache/catalina/connector/Request.java",
                "patch": "@@ -2965,6 +2965,10 @@ protected void convertCookies() {\n \n         cookiesConverted = true;\n \n+        if (getContext() == null) {\n+            return;\n+        }\n+\n         parseCookies();\n \n         ServerCookies serverCookies = coyoteRequest.getCookies();",
                "raw_url": "https://github.com/apache/tomcat80/raw/eacc263964b46ee32e77eb99d7bcdd074cc5a2bb/java/org/apache/catalina/connector/Request.java",
                "sha": "ed061c2806becc7b68e397180e5c8758bb5baa50",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/eacc263964b46ee32e77eb99d7bcdd074cc5a2bb/webapps/docs/changelog.xml",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=eacc263964b46ee32e77eb99d7bcdd074cc5a2bb",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -134,6 +134,10 @@\n         to occur even in blocking mode, which caused problems with NIO2.\n         (remm)\n       </fix>\n+      <fix>\n+        <bug>58578</bug>: Avoid NPE accessing cookies during access logging\n+        for request that had no context mapping. (remm)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/eacc263964b46ee32e77eb99d7bcdd074cc5a2bb/webapps/docs/changelog.xml",
                "sha": "20f0390d45a4f362ed27fe5af851b2bfb7821759",
                "status": "modified"
            }
        ],
        "message": "58578: Avoid NPE when trying to do access logging on cookies for an unmapped request.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1712358 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/1a03e76aa8ee5c08f731b0f827c35b8d33ce260a",
        "patched_files": [
            "changelog.xml",
            "Request.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestRequest.java"
        ]
    },
    "tomcat80_eb4a6a1": {
        "bug_id": "tomcat80_eb4a6a1",
        "commit": "https://github.com/apache/tomcat80/commit/eb4a6a19f5428646f5ebeba2b56e37a6396ccbe9",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tomcat80/blob/eb4a6a19f5428646f5ebeba2b56e37a6396ccbe9/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/CoyoteAdapter.java?ref=eb4a6a19f5428646f5ebeba2b56e37a6396ccbe9",
                "deletions": 3,
                "filename": "java/org/apache/catalina/connector/CoyoteAdapter.java",
                "patch": "@@ -1182,9 +1182,11 @@ protected void parseSessionSslId(Request request) {\n                 SSL_ONLY.equals(request.getServletContext()\n                         .getEffectiveSessionTrackingModes()) &&\n                         request.connector.secure) {\n-            request.setRequestedSessionId(\n-                    request.getAttribute(SSLSupport.SESSION_ID_KEY).toString());\n-            request.setRequestedSessionSSL(true);\n+            String sessionId = (String) request.getAttribute(SSLSupport.SESSION_ID_KEY);\n+            if (sessionId != null) {\n+                request.setRequestedSessionId(sessionId.toString());\n+                request.setRequestedSessionSSL(true);\n+            }\n         }\n     }\n ",
                "raw_url": "https://github.com/apache/tomcat80/raw/eb4a6a19f5428646f5ebeba2b56e37a6396ccbe9/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "sha": "408a534ad2540f320314f9d441dd6b659de8f55d",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tomcat80/blob/eb4a6a19f5428646f5ebeba2b56e37a6396ccbe9/webapps/docs/changelog.xml",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=eb4a6a19f5428646f5ebeba2b56e37a6396ccbe9",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -57,6 +57,10 @@\n         by the <code>Rfc6265CookieProcessor</code> are aligned with the\n         specification. Patch provided by Jim Griswold. (markt)\n       </fix>\n+      <fix>\n+        <bug>60911</bug>: Ensure NPE will not be thrown when looking for SSL\n+        session ID. Based on a patch by Didier Gutacker. (violetagg)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">",
                "raw_url": "https://github.com/apache/tomcat80/raw/eb4a6a19f5428646f5ebeba2b56e37a6396ccbe9/webapps/docs/changelog.xml",
                "sha": "67f535077bcaec714989787a0e0aaeebdbeee162",
                "status": "modified"
            }
        ],
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60911\nEnsure NPE will not be thrown when looking for SSL session ID. Based on a patch by Didier Gutacker.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1788745 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/07034b7019be3542fd29cb5b64cf4be78ea76fff",
        "patched_files": [
            "changelog.xml",
            "CoyoteAdapter.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestCoyoteAdapter.java"
        ]
    },
    "tomcat80_eceef19": {
        "bug_id": "tomcat80_eceef19",
        "commit": "https://github.com/apache/tomcat80/commit/eceef193c57cf3864d943771a32b31097bf8ae43",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tomcat80/blob/eceef193c57cf3864d943771a32b31097bf8ae43/java/org/apache/juli/FileHandler.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/juli/FileHandler.java?ref=eceef193c57cf3864d943771a32b31097bf8ae43",
                "deletions": 1,
                "filename": "java/org/apache/juli/FileHandler.java",
                "patch": "@@ -562,7 +562,11 @@ public boolean accept(Path path) throws IOException {\n     }\n \n     private String obtainDateFromPath(Path path) {\n-        String date = path.getFileName().toString();\n+        Path fileName = path.getFileName();\n+        if (fileName == null) {\n+            return null;\n+        }\n+        String date = fileName.toString();\n         if (pattern.matcher(date).matches()) {\n             date = date.substring(prefix.length());\n             return date.substring(0, date.length() - suffix.length());",
                "raw_url": "https://github.com/apache/tomcat80/raw/eceef193c57cf3864d943771a32b31097bf8ae43/java/org/apache/juli/FileHandler.java",
                "sha": "5467a32728814c968030a14bede323d70cdf321c",
                "status": "modified"
            }
        ],
        "message": "Avoid possible NPE.\nReported by FindBugs.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1800983 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/edc67a8bfdb0751a61ff75fb8fc55d170bac2108",
        "patched_files": [
            "FileHandler.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestFileHandler.java"
        ]
    },
    "tomcat80_edf5091": {
        "bug_id": "tomcat80_edf5091",
        "commit": "https://github.com/apache/tomcat80/commit/edf5091642d2c0d32b49ec5f9dd718d241529f3f",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tomcat80/blob/edf5091642d2c0d32b49ec5f9dd718d241529f3f/java/org/apache/catalina/webresources/StandardRoot.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/webresources/StandardRoot.java?ref=edf5091642d2c0d32b49ec5f9dd718d241529f3f",
                "deletions": 1,
                "filename": "java/org/apache/catalina/webresources/StandardRoot.java",
                "patch": "@@ -592,7 +592,7 @@ public void deregisterTrackedResource(TrackedWebResource trackedResource) {\n     // ----------------------------------------------------------- JMX Lifecycle\n     @Override\n     protected String getDomainInternal() {\n-        return context.getDomain();\n+        return (context != null) ? context.getDomain() : null;\n     }\n \n     @Override",
                "raw_url": "https://github.com/apache/tomcat80/raw/edf5091642d2c0d32b49ec5f9dd718d241529f3f/java/org/apache/catalina/webresources/StandardRoot.java",
                "sha": "07f90d40f3234bc389ba42f3360a9e496129018b",
                "status": "modified"
            }
        ],
        "message": "Avoid NPE with storeconfig.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1605723 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/d6bea5551b41bc44ddaaa9eb9d294982fba3bf8d",
        "patched_files": [
            "StandardRoot.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestStandardRoot.java"
        ]
    },
    "tomcat80_ee83f85": {
        "bug_id": "tomcat80_ee83f85",
        "commit": "https://github.com/apache/tomcat80/commit/ee83f85a29a4c0b67425c00eedea454ce320b82a",
        "file": [
            {
                "additions": 25,
                "blob_url": "https://github.com/apache/tomcat80/blob/ee83f85a29a4c0b67425c00eedea454ce320b82a/java/org/apache/tomcat/util/file/ConfigFileLoader.java",
                "changes": 30,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/file/ConfigFileLoader.java?ref=ee83f85a29a4c0b67425c00eedea454ce320b82a",
                "deletions": 5,
                "filename": "java/org/apache/tomcat/util/file/ConfigFileLoader.java",
                "patch": "@@ -24,19 +24,30 @@\n import java.net.URI;\n import java.net.URL;\n \n+import org.apache.tomcat.util.res.StringManager;\n+\n /**\n  * This class is used to obtain {@link InputStream}s for configuration files\n  * from a given location String. This allows greater flexibility than these\n  * files having to be loaded directly from a file system.\n  */\n public class ConfigFileLoader {\n \n+    private static final StringManager sm = StringManager.getManager(ConfigFileLoader.class\n+            .getPackage().getName());\n+\n     private static final File CATALINA_BASE_FILE;\n     private static final URI CATALINA_BASE_URI;\n \n     static {\n-        CATALINA_BASE_FILE = new File(System.getProperty(\"catalina.base\"));\n-        CATALINA_BASE_URI = CATALINA_BASE_FILE.toURI();\n+        String catalinaBase = System.getProperty(\"catalina.base\");\n+        if (catalinaBase != null) {\n+            CATALINA_BASE_FILE = new File(catalinaBase);\n+            CATALINA_BASE_URI = CATALINA_BASE_FILE.toURI();\n+        } else {\n+            CATALINA_BASE_FILE = null;\n+            CATALINA_BASE_URI = null;\n+        }\n     }\n \n     private ConfigFileLoader() {\n@@ -72,10 +83,19 @@ public static InputStream getInputStream(String location) throws IOException {\n         // File didn't work so try URI.\n         // Using resolve() enables the code to handle relative paths that did\n         // not point to a file\n-        URI uri = CATALINA_BASE_URI.resolve(location);\n+        URI uri;\n+        if (CATALINA_BASE_URI != null) {\n+            uri = CATALINA_BASE_URI.resolve(location);\n+        } else {\n+            uri = URI.create(location);\n+        }\n \n         // Obtain the input stream we need\n-        URL url = uri.toURL();\n-        return url.openConnection().getInputStream();\n+        try {\n+            URL url = uri.toURL();\n+            return url.openConnection().getInputStream();\n+        } catch (IllegalArgumentException e) {\n+            throw new IOException(sm.getString(\"configFileLoader.cannotObtainURL\", location), e);\n+        }\n     }\n }",
                "raw_url": "https://github.com/apache/tomcat80/raw/ee83f85a29a4c0b67425c00eedea454ce320b82a/java/org/apache/tomcat/util/file/ConfigFileLoader.java",
                "sha": "12cc533276d87c05e47a32b2ea7b74afd4f239c4",
                "status": "modified"
            },
            {
                "additions": 16,
                "blob_url": "https://github.com/apache/tomcat80/blob/ee83f85a29a4c0b67425c00eedea454ce320b82a/java/org/apache/tomcat/util/file/LocalStrings.properties",
                "changes": 16,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/tomcat/util/file/LocalStrings.properties?ref=ee83f85a29a4c0b67425c00eedea454ce320b82a",
                "deletions": 0,
                "filename": "java/org/apache/tomcat/util/file/LocalStrings.properties",
                "patch": "@@ -0,0 +1,16 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+configFileLoader.cannotObtainURL=Cannot obtain URL for the relative path [{0}]. Check that catalina.base is set.\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tomcat80/raw/ee83f85a29a4c0b67425c00eedea454ce320b82a/java/org/apache/tomcat/util/file/LocalStrings.properties",
                "sha": "5bbf626ba2a62320493984e1086fb0ba9da612e1",
                "status": "added"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/tomcat80/blob/ee83f85a29a4c0b67425c00eedea454ce320b82a/webapps/docs/changelog.xml",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/webapps/docs/changelog.xml?ref=ee83f85a29a4c0b67425c00eedea454ce320b82a",
                "deletions": 0,
                "filename": "webapps/docs/changelog.xml",
                "patch": "@@ -45,6 +45,15 @@\n   issues do not \"pop up\" wrt. others).\n -->\n <section name=\"Tomcat 8.0.34 (markt)\" rtext=\"development in progress\">\n+  <subsection name=\"Catalina\">\n+    <changelog>\n+      <fix>\n+        <bug>59206</bug>: Ensure NPE will not be thrown by\n+        <code>o.a.tomcat.util.file.ConfigFileLoader</code> when\n+        <code>catalina.base</code> is not specified. (violetagg)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection name=\"Tribes\">\n     <changelog>\n       <fix>",
                "raw_url": "https://github.com/apache/tomcat80/raw/ee83f85a29a4c0b67425c00eedea454ce320b82a/webapps/docs/changelog.xml",
                "sha": "575f896e978d37aa76b5a2ff8b6da184cdff6b10",
                "status": "modified"
            }
        ],
        "message": "Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59206\nMerged revision 1736209 from tomcat/trunk:\nEnsure NPE will not be thrown by when catalina.base is not specified.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1736239 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/b94eeb9c81a521577a3443200fbce8dad75b3c4f",
        "patched_files": [
            "LocalStrings.properties",
            "ConfigFileLoader.java",
            "changelog.xml"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestConfigFileLoader.java"
        ]
    },
    "tomcat80_f03fb0a": {
        "bug_id": "tomcat80_f03fb0a",
        "commit": "https://github.com/apache/tomcat80/commit/f03fb0a95d4097f2252df44c4ac97f7eee892f27",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tomcat80/blob/f03fb0a95d4097f2252df44c4ac97f7eee892f27/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/connector/CoyoteAdapter.java?ref=f03fb0a95d4097f2252df44c4ac97f7eee892f27",
                "deletions": 4,
                "filename": "java/org/apache/catalina/connector/CoyoteAdapter.java",
                "patch": "@@ -426,10 +426,12 @@ public boolean asyncDispatch(org.apache.coyote.Request req,\n             if (!request.isAsync() && !comet) {\n                 request.finishRequest();\n                 response.finishResponse();\n-                request.getMappingData().context.logAccess(\n-                        request, response,\n-                        System.currentTimeMillis() - req.getStartTime(),\n-                        false);\n+                if (request.getMappingData().context != null) {\n+                    request.getMappingData().context.logAccess(\n+                            request, response,\n+                            System.currentTimeMillis() - req.getStartTime(),\n+                            false);\n+                }\n             }\n \n         } catch (IOException e) {",
                "raw_url": "https://github.com/apache/tomcat80/raw/f03fb0a95d4097f2252df44c4ac97f7eee892f27/java/org/apache/catalina/connector/CoyoteAdapter.java",
                "sha": "296a7cb3b664bf8dba6b9d6725526462da6c0e48",
                "status": "modified"
            }
        ],
        "message": "Avoid possible NPE.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1574167 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/7ece13100bbdf1bacb564b0c790d9f1f63a8ffea",
        "patched_files": [
            "CoyoteAdapter.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestCoyoteAdapter.java"
        ]
    },
    "tomcat80_f40e4e2": {
        "bug_id": "tomcat80_f40e4e2",
        "commit": "https://github.com/apache/tomcat80/commit/f40e4e2dc135fdc90d122b8c60cfddce5861048d",
        "file": [
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tomcat80/blob/f40e4e2dc135fdc90d122b8c60cfddce5861048d/java/org/apache/catalina/session/StandardSession.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/session/StandardSession.java?ref=f40e4e2dc135fdc90d122b8c60cfddce5861048d",
                "deletions": 1,
                "filename": "java/org/apache/catalina/session/StandardSession.java",
                "patch": "@@ -1753,8 +1753,17 @@ protected boolean exclude(String name, Object value) {\n         if (Constants.excludedAttributeNames.contains(name)) {\n             return true;\n         }\n+\n+        // Manager is required for remaining check\n+        Manager manager = getManager();\n+        if (manager == null) {\n+            // Manager may be null during replication of new sessions in a\n+            // cluster. Avoid the NPE.\n+            return false;\n+        }\n+\n         // Last check so use a short-cut\n-        return !getManager().willAttributeDistribute(name, value);\n+        return !manager.willAttributeDistribute(name, value);\n     }\n \n ",
                "raw_url": "https://github.com/apache/tomcat80/raw/f40e4e2dc135fdc90d122b8c60cfddce5861048d/java/org/apache/catalina/session/StandardSession.java",
                "sha": "b8ba4ca08408492c013891ad3854c3bcc82d8f3c",
                "status": "modified"
            }
        ],
        "message": "Avoid NPE when clustering\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1727671 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/0c65dfcf206332ea684b4378aac6a81ba2a7e956",
        "patched_files": [
            "StandardSession.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestStandardSession.java"
        ]
    },
    "tomcat80_f469d86": {
        "bug_id": "tomcat80_f469d86",
        "commit": "https://github.com/apache/tomcat80/commit/f469d86a6738ead7283c974e1c7ee2a81e82f32b",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tomcat80/blob/f469d86a6738ead7283c974e1c7ee2a81e82f32b/java/org/apache/jasper/compiler/ELParser.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/jasper/compiler/ELParser.java?ref=f469d86a6738ead7283c974e1c7ee2a81e82f32b",
                "deletions": 2,
                "filename": "java/org/apache/jasper/compiler/ELParser.java",
                "patch": "@@ -152,7 +152,7 @@ private boolean parseFunction() {\n                 if (hasNext()) {\n                     Token t2 = nextToken();\n                     if (t2 instanceof Id) {\n-                        s1 = s2;\n+                        s1 = s2.trim();\n                         s2 = t2.toString();\n                         if (hasNext()) {\n                             curToken = nextToken();\n@@ -161,7 +161,7 @@ private boolean parseFunction() {\n                 }\n             }\n             if (curToken.toChar() == '(') {\n-                ELexpr.add(new ELNode.Function(s1.trim(), s2.trim()));\n+                ELexpr.add(new ELNode.Function(s1, s2.trim()));\n                 return true;\n             }\n             curToken = original;",
                "raw_url": "https://github.com/apache/tomcat80/raw/f469d86a6738ead7283c974e1c7ee2a81e82f32b/java/org/apache/jasper/compiler/ELParser.java",
                "sha": "c4e22b3ee3d297135b3c61de2f04212c3498f9e5",
                "status": "modified"
            }
        ],
        "message": "Fix for NPE introduced by r1559707 that caused ELParser test to fail.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1559798 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/56f5dd9c8549b135e77ba5fc60d23c140ac6b2cb",
        "patched_files": [
            "ELParser.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestELParser.java"
        ]
    },
    "tomcat80_fe5f290": {
        "bug_id": "tomcat80_fe5f290",
        "commit": "https://github.com/apache/tomcat80/commit/fe5f290bd0c8e8b4fb949d4e097dbbc418187a68",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tomcat80/blob/fe5f290bd0c8e8b4fb949d4e097dbbc418187a68/java/org/apache/catalina/loader/WebappLoader.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/java/org/apache/catalina/loader/WebappLoader.java?ref=fe5f290bd0c8e8b4fb949d4e097dbbc418187a68",
                "deletions": 4,
                "filename": "java/org/apache/catalina/loader/WebappLoader.java",
                "patch": "@@ -483,17 +483,15 @@ public String getClasspath() {\n      * such that the loaded classes should be reloaded?\n      */\n     public boolean modified() {\n-\n-        return (classLoader.modified());\n-\n+        return classLoader != null ? classLoader.modified() : false ;\n     }\n \n \n     /**\n      * Used to periodically signal to the classloader to release JAR resources.\n      */\n     public void closeJARs(boolean force) {\n-        if (classLoader !=null){\n+        if (classLoader !=null) {\n             classLoader.closeJARs(force);\n         }\n     }",
                "raw_url": "https://github.com/apache/tomcat80/raw/fe5f290bd0c8e8b4fb949d4e097dbbc418187a68/java/org/apache/catalina/loader/WebappLoader.java",
                "sha": "f5bcac311ded08843a0f5fc87b6ae560a2ed02a1",
                "status": "modified"
            },
            {
                "additions": 67,
                "blob_url": "https://github.com/apache/tomcat80/blob/fe5f290bd0c8e8b4fb949d4e097dbbc418187a68/test/org/apache/catalina/loader/TestVirtualWebappLoader.java",
                "changes": 67,
                "contents_url": "https://api.github.com/repos/apache/tomcat80/contents/test/org/apache/catalina/loader/TestVirtualWebappLoader.java?ref=fe5f290bd0c8e8b4fb949d4e097dbbc418187a68",
                "deletions": 0,
                "filename": "test/org/apache/catalina/loader/TestVirtualWebappLoader.java",
                "patch": "@@ -0,0 +1,67 @@\n+/*\n+ *  Licensed to the Apache Software Foundation (ASF) under one or more\n+ *  contributor license agreements.  See the NOTICE file distributed with\n+ *  this work for additional information regarding copyright ownership.\n+ *  The ASF licenses this file to You under the Apache License, Version 2.0\n+ *  (the \"License\"); you may not use this file except in compliance with\n+ *  the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package org.apache.catalina.loader;\n+\n+import java.io.File;\n+\n+import org.apache.catalina.core.StandardContext;\n+import org.apache.catalina.startup.Tomcat;\n+import org.apache.catalina.startup.TomcatBaseTest;\n+import org.apache.naming.resources.FileDirContext;\n+\n+public class TestVirtualWebappLoader extends TomcatBaseTest {\n+\n+    public void testModified() throws Exception {\n+        WebappLoader loader = new WebappLoader();\n+        assertNull(loader.getClassLoader());\n+        assertFalse(loader.modified());\n+    }\n+    \n+    public void testStartInternal() throws Exception {\n+        Tomcat tomcat = getTomcatInstance();\n+        File appDir = new File(\"test/webapp-3.0\");      \n+        // Must have a real docBase - just use temp\n+        StandardContext ctx = \n+            (StandardContext)tomcat.addContext(\"/\",  appDir.getAbsolutePath());\n+\n+        VirtualWebappLoader loader = new VirtualWebappLoader();\n+         \n+        loader.setContainer(ctx);\n+        ctx.setLoader(loader);\n+        ctx.setResources(new FileDirContext());\n+        ctx.resourcesStart();\n+        File dir = new File(\"test/webapp-3.0-fragments/WEB-INF/lib\");\n+        loader.setVirtualClasspath(dir.getAbsolutePath() + \"/*.jar\");\n+        loader.startInternal();\n+        String[] repos = loader.getRepositories();\n+        assertEquals(2,repos.length);\n+        loader.stopInternal();\n+        // ToDo: Why doesn't remove repositories?\n+        repos = loader.getRepositories();\n+        assertEquals(2, repos.length);\n+        \n+        // no leak\n+        loader.startInternal();\n+        repos = loader.getRepositories();\n+        assertEquals(2,repos.length);\n+        \n+        // clear loader\n+        ctx.setLoader(null);\n+        // see tearDown()!\n+        tomcat.start();\n+    }\n+}",
                "raw_url": "https://github.com/apache/tomcat80/raw/fe5f290bd0c8e8b4fb949d4e097dbbc418187a68/test/org/apache/catalina/loader/TestVirtualWebappLoader.java",
                "sha": "4e3cdb7d2d46094f1b6a67ac5ebc2efd668776f1",
                "status": "added"
            }
        ],
        "message": "Fix NPE and add small test case to check VirtualWebappLoader.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@960284 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/tomcat80/commit/ac3378c67d22428573a27053b8f02614191021a1",
        "patched_files": [
            "WebappLoader.java",
            "VirtualWebappLoader.java"
        ],
        "repo": "tomcat80",
        "unit_tests": [
            "TestVirtualWebappLoader.java"
        ]
    }
}