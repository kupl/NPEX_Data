{
    "shiro_1425926": {
        "bug_id": "shiro_1425926",
        "commit": "https://github.com/apache/shiro/commit/1425926a0d032d6f3153db87d2709a371bec110a",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/shiro/blob/1425926a0d032d6f3153db87d2709a371bec110a/src/org/jsecurity/realm/ldap/DefaultLdapContextFactory.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/shiro/contents/src/org/jsecurity/realm/ldap/DefaultLdapContextFactory.java?ref=1425926a0d032d6f3153db87d2709a371bec110a",
                "deletions": 1,
                "filename": "src/org/jsecurity/realm/ldap/DefaultLdapContextFactory.java",
                "patch": "@@ -223,7 +223,7 @@ public LdapContext getLdapContext(String username, String password) throws Namin\n         env.put(Context.REFERRAL, referral);\n \n         // Only pool connections for system contexts\n-        if (usePooling && username.equals(systemUsername)) {\n+        if (usePooling && username != null && username.equals(systemUsername)) {\n             // Enable connection pooling\n             env.put(SUN_CONNECTION_POOLING_PROPERTY, \"true\");\n         }",
                "raw_url": "https://github.com/apache/shiro/raw/1425926a0d032d6f3153db87d2709a371bec110a/src/org/jsecurity/realm/ldap/DefaultLdapContextFactory.java",
                "sha": "7d03db9a2c050d90f71b4c9ebb08cfee25944f7c",
                "status": "modified"
            }
        ],
        "message": "enabled one more username null check to avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jsecurity/trunk@710952 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/shiro/commit/06d61339196a57e30f60ba10e36d1aa96d20f0dc",
        "repo": "shiro",
        "unit_tests": [
            "DefaultLdapContextFactoryTest.java"
        ]
    },
    "shiro_8b4324c": {
        "bug_id": "shiro_8b4324c",
        "commit": "https://github.com/apache/shiro/commit/8b4324cb359375f8b5b9538a7b5021a39c9d0873",
        "file": [
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/shiro/blob/8b4324cb359375f8b5b9538a7b5021a39c9d0873/src/org/jsecurity/authc/SimpleAuthenticationInfo.java",
                "changes": 33,
                "contents_url": "https://api.github.com/repos/apache/shiro/contents/src/org/jsecurity/authc/SimpleAuthenticationInfo.java?ref=8b4324cb359375f8b5b9538a7b5021a39c9d0873",
                "deletions": 14,
                "filename": "src/org/jsecurity/authc/SimpleAuthenticationInfo.java",
                "patch": "@@ -70,38 +70,43 @@ public void setCredentials(Object credentials) {\n \n     @SuppressWarnings(\"unchecked\")\n     public void merge(AuthenticationInfo info) {\n-        if (info == null || info.getPrincipals() == null) {\n+        if (info == null || info.getPrincipals() == null || info.getPrincipals().isEmpty()) {\n             return;\n         }\n \n         if (this.principals == null) {\n-            this.principals = new SimplePrincipalCollection();\n-        }\n-\n-        if (this.principals instanceof MutablePrincipalCollection) {\n-            ((MutablePrincipalCollection) this.principals).addAll(info.getPrincipals());\n+            this.principals = info.getPrincipals();\n         } else {\n-            throw new IllegalStateException(\"Attempt to merge authentication info, but PrincipalCollection is not an \" +\n-                    \"instance of MutablePrincipalCollection.\");\n+            if (this.principals instanceof MutablePrincipalCollection) {\n+                ((MutablePrincipalCollection) this.principals).addAll(info.getPrincipals());\n+            } else {\n+                this.principals = new SimplePrincipalCollection(this.principals);\n+            }\n         }\n \n         Object thisCredentials = getCredentials();\n         Object otherCredentials = info.getCredentials();\n \n+        if (otherCredentials == null) {\n+            return;\n+        }\n+\n+        if (thisCredentials == null) {\n+            this.credentials = otherCredentials;\n+            return;\n+        }\n+\n         if (!(thisCredentials instanceof Collection)) {\n             Set newSet = new HashSet();\n-            if (thisCredentials != null) {\n-                newSet.add(thisCredentials);\n-                setCredentials(newSet);\n-            }\n+            newSet.add(thisCredentials);\n+            setCredentials(newSet);\n         }\n \n         // At this point, the credentials should be a collection\n         Collection credentialCollection = (Collection) getCredentials();\n         if (otherCredentials instanceof Collection) {\n             credentialCollection.addAll((Collection) otherCredentials);\n-\n-        } else if (otherCredentials != null) {\n+        } else {\n             credentialCollection.add(otherCredentials);\n         }\n     }",
                "raw_url": "https://github.com/apache/shiro/raw/8b4324cb359375f8b5b9538a7b5021a39c9d0873/src/org/jsecurity/authc/SimpleAuthenticationInfo.java",
                "sha": "0a442cb52c518edbafc83db955f2bc25c859beed",
                "status": "modified"
            },
            {
                "additions": 45,
                "blob_url": "https://github.com/apache/shiro/blob/8b4324cb359375f8b5b9538a7b5021a39c9d0873/test/org/jsecurity/authc/SimpleAuthenticationInfoTest.java",
                "changes": 45,
                "contents_url": "https://api.github.com/repos/apache/shiro/contents/test/org/jsecurity/authc/SimpleAuthenticationInfoTest.java?ref=8b4324cb359375f8b5b9538a7b5021a39c9d0873",
                "deletions": 0,
                "filename": "test/org/jsecurity/authc/SimpleAuthenticationInfoTest.java",
                "patch": "@@ -0,0 +1,45 @@\n+/*\r\n+ * Licensed to the Apache Software Foundation (ASF) under one\r\n+ * or more contributor license agreements.  See the NOTICE file\r\n+ * distributed with this work for additional information\r\n+ * regarding copyright ownership.  The ASF licenses this file\r\n+ * to you under the Apache License, Version 2.0 (the\r\n+ * \"License\"); you may not use this file except in compliance\r\n+ * with the License.  You may obtain a copy of the License at\r\n+ *\r\n+ *     http://www.apache.org/licenses/LICENSE-2.0\r\n+ *\r\n+ * Unless required by applicable law or agreed to in writing,\r\n+ * software distributed under the License is distributed on an\r\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+ * KIND, either express or implied.  See the License for the\r\n+ * specific language governing permissions and limitations\r\n+ * under the License.\r\n+ */\r\n+package org.jsecurity.authc;\r\n+\r\n+import org.junit.Test;\r\n+\r\n+/**\r\n+ * @author Les Hazlewood\r\n+ * @since 0.9\r\n+ */\r\n+public class SimpleAuthenticationInfoTest {\r\n+\r\n+    @Test\r\n+    public void testMergeWithEmptyInstances() {\r\n+        SimpleAuthenticationInfo aggregate = new SimpleAuthenticationInfo();\r\n+        SimpleAuthenticationInfo local = new SimpleAuthenticationInfo();\r\n+        aggregate.merge(local);\r\n+    }\r\n+\r\n+    /**\r\n+     * Verifies fix for JSEC-122\r\n+     */\r\n+    @Test\r\n+    public void testMergeWithAggregateNullCredentials() {\r\n+        SimpleAuthenticationInfo aggregate = new SimpleAuthenticationInfo();\r\n+        SimpleAuthenticationInfo local = new SimpleAuthenticationInfo(\"username\", \"password\", \"testRealm\");\r\n+        aggregate.merge(local);\r\n+    }\r\n+}\r",
                "raw_url": "https://github.com/apache/shiro/raw/8b4324cb359375f8b5b9538a7b5021a39c9d0873/test/org/jsecurity/authc/SimpleAuthenticationInfoTest.java",
                "sha": "2d449c80dbf52face34d4af5ae7c4fabe3427c3e",
                "status": "added"
            }
        ],
        "message": "JSEC-122 - fixed NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jsecurity/trunk@711065 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/shiro/commit/8e2b39e9c73a8215520688017acd77cbe2f47dbc",
        "repo": "shiro",
        "unit_tests": [
            "SimpleAuthenticationInfoTest.java"
        ]
    }
}