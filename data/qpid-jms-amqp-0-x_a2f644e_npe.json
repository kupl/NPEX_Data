[
    {
        "repo": "qpid-jms-amqp-0-x",
        "commit": "https://github.com/apache/qpid-jms-amqp-0-x/commit/a2f644ec25319b6c4736c408a58e120937dcffe7",
        "bug_id": "qpid-jms-amqp-0-x_a2f644e",
        "message": "QPID-6687: Fix NPE on stopping logging for Broker and VirtualHost file loggers in ERRORED state",
        "parent": "https://github.com/apache/qpid-jms-amqp-0-x/commit/a6299b644733aedc951b342697f5b17f9158a0b6",
        "patched_files": [
            "BrokerFileLoggerImpl.java",
            "BrokerFileLogger.java",
            "VirtualHostFileLoggerImpl.java",
            "VirtualHostLogger.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 4,
                "raw_url": "https://github.com/apache/qpid-jms-amqp-0-x/raw/a2f644ec25319b6c4736c408a58e120937dcffe7/broker-core/src/main/java/org/apache/qpid/server/logging/BrokerFileLoggerImpl.java",
                "contents_url": "https://api.github.com/repos/apache/qpid-jms-amqp-0-x/contents/broker-core/src/main/java/org/apache/qpid/server/logging/BrokerFileLoggerImpl.java?ref=a2f644ec25319b6c4736c408a58e120937dcffe7",
                "filename": "broker-core/src/main/java/org/apache/qpid/server/logging/BrokerFileLoggerImpl.java",
                "deletions": 1,
                "sha": "36329f15c88812452fe63a7a7ce3c66cfe27cbf4",
                "blob_url": "https://github.com/apache/qpid-jms-amqp-0-x/blob/a2f644ec25319b6c4736c408a58e120937dcffe7/broker-core/src/main/java/org/apache/qpid/server/logging/BrokerFileLoggerImpl.java",
                "patch": "@@ -192,7 +192,10 @@ public Content getAllFiles()\n     public void stopLogging()\n     {\n         super.stopLogging();\n-        _rolledPolicyExecutor.shutdown();\n+        if (_rolledPolicyExecutor != null)\n+        {\n+            _rolledPolicyExecutor.shutdown();\n+        }\n     }\n \n     @Override",
                "changes": 5
            },
            {
                "status": "modified",
                "additions": 4,
                "raw_url": "https://github.com/apache/qpid-jms-amqp-0-x/raw/a2f644ec25319b6c4736c408a58e120937dcffe7/broker-core/src/main/java/org/apache/qpid/server/logging/VirtualHostFileLoggerImpl.java",
                "contents_url": "https://api.github.com/repos/apache/qpid-jms-amqp-0-x/contents/broker-core/src/main/java/org/apache/qpid/server/logging/VirtualHostFileLoggerImpl.java?ref=a2f644ec25319b6c4736c408a58e120937dcffe7",
                "filename": "broker-core/src/main/java/org/apache/qpid/server/logging/VirtualHostFileLoggerImpl.java",
                "deletions": 1,
                "sha": "f5eb2925275365b2476426b5e5b1d20ac26d821c",
                "blob_url": "https://github.com/apache/qpid-jms-amqp-0-x/blob/a2f644ec25319b6c4736c408a58e120937dcffe7/broker-core/src/main/java/org/apache/qpid/server/logging/VirtualHostFileLoggerImpl.java",
                "patch": "@@ -182,7 +182,10 @@ public Content getAllFiles()\n     public void stopLogging()\n     {\n         super.stopLogging();\n-        _rolledPolicyExecutor.shutdown();\n+        if (_rolledPolicyExecutor != null)\n+        {\n+            _rolledPolicyExecutor.shutdown();\n+        }\n     }\n \n     @Override",
                "changes": 5
            },
            {
                "status": "modified",
                "additions": 16,
                "raw_url": "https://github.com/apache/qpid-jms-amqp-0-x/raw/a2f644ec25319b6c4736c408a58e120937dcffe7/broker-core/src/test/java/org/apache/qpid/server/logging/BrokerFileLoggerTest.java",
                "contents_url": "https://api.github.com/repos/apache/qpid-jms-amqp-0-x/contents/broker-core/src/test/java/org/apache/qpid/server/logging/BrokerFileLoggerTest.java?ref=a2f644ec25319b6c4736c408a58e120937dcffe7",
                "filename": "broker-core/src/test/java/org/apache/qpid/server/logging/BrokerFileLoggerTest.java",
                "deletions": 5,
                "sha": "3cab982e42e8aef9d6118739e8858052fbd5986d",
                "blob_url": "https://github.com/apache/qpid-jms-amqp-0-x/blob/a2f644ec25319b6c4736c408a58e120937dcffe7/broker-core/src/test/java/org/apache/qpid/server/logging/BrokerFileLoggerTest.java",
                "patch": "@@ -25,8 +25,8 @@\n import static org.mockito.Mockito.when;\n \n import java.io.File;\n-import java.util.Collection;\n import java.util.HashMap;\n+import java.util.List;\n import java.util.Map;\n \n import org.apache.qpid.server.configuration.updater.TaskExecutor;\n@@ -48,6 +48,7 @@\n     private File _baseFolder;\n     private File _logFile;\n     private Broker _broker;\n+    private BrokerFileLogger<?> _logger;\n \n     @Override\n     public void setUp() throws Exception\n@@ -87,7 +88,11 @@ public void tearDown() throws Exception\n     {\n         try\n         {\n-            _broker.close();\n+            if (_logger != null)\n+            {\n+                _logger.close();\n+                _logger.stopLogging();\n+            }\n             _taskExecutor.stopImmediately();\n             if (_baseFolder != null && _baseFolder.exists())\n             {\n@@ -101,6 +106,14 @@ public void tearDown() throws Exception\n     }\n \n     public void testGetLogFilesOnResolutionErrors()\n+    {\n+        _logger = createLoggerInErroredState();\n+\n+        List<LogFileDetails> logFileDetails = _logger.getLogFiles();\n+        assertTrue(\"File details should be empty\", logFileDetails.isEmpty());\n+    }\n+\n+    private BrokerFileLogger createLoggerInErroredState()\n     {\n         Map<String, Object> attributes = new HashMap<>();\n         attributes.put(BrokerLogger.NAME, getTestName());\n@@ -112,9 +125,7 @@ public void testGetLogFilesOnResolutionErrors()\n         logger.open();\n \n         assertEquals(\"Unexpected state\", State.ERRORED, logger.getState());\n-\n-        Collection<LogFileDetails> logFileDetails = logger.getLogFiles();\n-        assertTrue(\"File details should be empty\", logFileDetails.isEmpty());\n+        return logger;\n     }\n \n }",
                "changes": 21
            },
            {
                "status": "modified",
                "additions": 15,
                "raw_url": "https://github.com/apache/qpid-jms-amqp-0-x/raw/a2f644ec25319b6c4736c408a58e120937dcffe7/broker-core/src/test/java/org/apache/qpid/server/logging/VirtualHostLoggerTest.java",
                "contents_url": "https://api.github.com/repos/apache/qpid-jms-amqp-0-x/contents/broker-core/src/test/java/org/apache/qpid/server/logging/VirtualHostLoggerTest.java?ref=a2f644ec25319b6c4736c408a58e120937dcffe7",
                "filename": "broker-core/src/test/java/org/apache/qpid/server/logging/VirtualHostLoggerTest.java",
                "deletions": 3,
                "sha": "edd751ca4f8622ef4c30205d570a6256758941d3",
                "blob_url": "https://github.com/apache/qpid-jms-amqp-0-x/blob/a2f644ec25319b6c4736c408a58e120937dcffe7/broker-core/src/test/java/org/apache/qpid/server/logging/VirtualHostLoggerTest.java",
                "patch": "@@ -204,6 +204,20 @@ public void testGetLogFiles()\n     }\n \n     public void testGetLogFilesOnResolutionErrors()\n+    {\n+        VirtualHostFileLogger logger = createErrorredLogger();\n+\n+        Collection<LogFileDetails> logFileDetails = logger.getLogFiles();\n+        assertTrue(\"File details should be empty\", logFileDetails.isEmpty());\n+    }\n+\n+    public void testStopLoggingLoggerInErroredState()\n+    {\n+        VirtualHostFileLogger logger = createErrorredLogger();\n+        logger.stopLogging();\n+    }\n+\n+    private VirtualHostFileLogger createErrorredLogger()\n     {\n         Map<String, Object> attributes = new HashMap<>();\n         attributes.put(VirtualHostLogger.NAME, getTestName());\n@@ -215,9 +229,7 @@ public void testGetLogFilesOnResolutionErrors()\n         logger.open();\n \n         assertEquals(\"Unexpected state\", State.ERRORED, logger.getState());\n-\n-        Collection<LogFileDetails> logFileDetails = logger.getLogFiles();\n-        assertTrue(\"File details should be empty\", logFileDetails.isEmpty());\n+        return logger;\n     }\n \n     private VirtualHostLogger createVirtualHostLogger()",
                "changes": 18
            }
        ],
        "unit_tests": [
            "BrokerFileLoggerTest.java",
            "VirtualHostLoggerTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "broker-core/src/test/java/org/apache/qpid/server/logging/BrokerFileLoggerTest.java",
        "buggy_files": [
            "broker-core/src/main/java/org/apache/qpid/server/logging/BrokerFileLoggerImpl.java",
            "broker-core/src/main/java/org/apache/qpid/server/logging/BrokerFileLogger.java",
            "broker-core/src/main/java/org/apache/qpid/server/logging/VirtualHostFileLoggerImpl.java",
            "broker-core/src/main/java/org/apache/qpid/server/model/VirtualHostLogger.java"
        ],
        "fixed": true
    }
]