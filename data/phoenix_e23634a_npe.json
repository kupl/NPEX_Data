[
    {
        "repo": "phoenix",
        "commit": "https://github.com/apache/phoenix/commit/e23634a358929516ce210fe06d668ce475eccccb",
        "bug_id": "phoenix_e23634a",
        "message": "PHOENIX-3505 Avoid NPE on close() in OrderedResultIterator",
        "parent": "https://github.com/apache/phoenix/commit/c5046047a78e0365d75bc696dff4870304c2b5b2",
        "patched_files": [
            "OrderedResultIterator.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 4,
                "raw_url": "https://github.com/apache/phoenix/raw/e23634a358929516ce210fe06d668ce475eccccb/phoenix-core/src/main/java/org/apache/phoenix/iterate/OrderedResultIterator.java",
                "contents_url": "https://api.github.com/repos/apache/phoenix/contents/phoenix-core/src/main/java/org/apache/phoenix/iterate/OrderedResultIterator.java?ref=e23634a358929516ce210fe06d668ce475eccccb",
                "filename": "phoenix-core/src/main/java/org/apache/phoenix/iterate/OrderedResultIterator.java",
                "deletions": 1,
                "sha": "da75bb7bd7cb9e5f309a231c8618a04fff851b62",
                "blob_url": "https://github.com/apache/phoenix/blob/e23634a358929516ce210fe06d668ce475eccccb/phoenix-core/src/main/java/org/apache/phoenix/iterate/OrderedResultIterator.java",
                "patch": "@@ -279,7 +279,10 @@ public Tuple peek() throws SQLException {\n \n     @Override\n     public void close() throws SQLException {\n-        resultIterator.close();\n+        // Guard against resultIterator being null\n+        if (null != resultIterator) {\n+            resultIterator.close();\n+        }\n         resultIterator = PeekingResultIterator.EMPTY_ITERATOR;\n     }\n ",
                "changes": 5
            },
            {
                "status": "added",
                "additions": 41,
                "raw_url": "https://github.com/apache/phoenix/raw/e23634a358929516ce210fe06d668ce475eccccb/phoenix-core/src/test/java/org/apache/phoenix/iterate/OrderedResultIteratorTest.java",
                "contents_url": "https://api.github.com/repos/apache/phoenix/contents/phoenix-core/src/test/java/org/apache/phoenix/iterate/OrderedResultIteratorTest.java?ref=e23634a358929516ce210fe06d668ce475eccccb",
                "filename": "phoenix-core/src/test/java/org/apache/phoenix/iterate/OrderedResultIteratorTest.java",
                "deletions": 0,
                "sha": "50ed8e9df79907c35b0fcc1847732e05b3d6f8c0",
                "blob_url": "https://github.com/apache/phoenix/blob/e23634a358929516ce210fe06d668ce475eccccb/phoenix-core/src/test/java/org/apache/phoenix/iterate/OrderedResultIteratorTest.java",
                "patch": "@@ -0,0 +1,41 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to you under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.phoenix.iterate;\n+\n+import java.sql.SQLException;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import org.apache.phoenix.expression.OrderByExpression;\n+import org.junit.Test;\n+\n+/**\n+ * Test class for {@link OrderedResultIterator}.\n+ */\n+public class OrderedResultIteratorTest {\n+\n+  @Test\n+  public void testNullIteratorOnClose() throws SQLException {\n+      ResultIterator delegate =  ResultIterator.EMPTY_ITERATOR;\n+      List<OrderByExpression> orderByExpressions = Collections.singletonList(null);\n+      int thresholdBytes = Integer.MAX_VALUE;\n+      OrderedResultIterator iterator = new OrderedResultIterator(delegate, orderByExpressions, thresholdBytes);\n+      // Should not throw an exception\n+      iterator.close();\n+  }\n+\n+}",
                "changes": 41
            }
        ],
        "unit_tests": [
            "OrderedResultIteratorTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "phoenix-core/src/test/java/org/apache/phoenix/iterate/OrderedResultIteratorTest.java",
        "buggy_files": [
            "phoenix-core/src/main/java/org/apache/phoenix/iterate/OrderedResultIterator.java"
        ],
        "fixed": true
    }
]