[
    {
        "repo": "jackrabbit-oak",
        "commit": "https://github.com/apache/jackrabbit-oak/commit/50c12c33f7bc381d413f9354f67573a7b180a765",
        "bug_id": "jackrabbit-oak_50c12c3",
        "message": "OAK-642: NPE trying to add a node to an nt:folder node\n\ngit-svn-id: https://svn.apache.org/repos/asf/jackrabbit/oak/trunk@1447940 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jackrabbit-oak/commit/5320dc096065db80daed31e620db835baf96b0d2",
        "patched_files": [
            "NodeImpl.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 4,
                "raw_url": "https://github.com/apache/jackrabbit-oak/raw/50c12c33f7bc381d413f9354f67573a7b180a765/oak-jcr/src/main/java/org/apache/jackrabbit/oak/jcr/NodeImpl.java",
                "contents_url": "https://api.github.com/repos/apache/jackrabbit-oak/contents/oak-jcr/src/main/java/org/apache/jackrabbit/oak/jcr/NodeImpl.java?ref=50c12c33f7bc381d413f9354f67573a7b180a765",
                "filename": "oak-jcr/src/main/java/org/apache/jackrabbit/oak/jcr/NodeImpl.java",
                "deletions": 5,
                "sha": "7cb7e2c47789b3168d49b265a56ea6ada7edc182",
                "blob_url": "https://github.com/apache/jackrabbit-oak/blob/50c12c33f7bc381d413f9354f67573a7b180a765/oak-jcr/src/main/java/org/apache/jackrabbit/oak/jcr/NodeImpl.java",
                "patch": "@@ -250,11 +250,10 @@ public Node perform() throws RepositoryException {\n                 String ntName = primaryNodeTypeName;\n                 if (ntName == null) {\n                     DefinitionProvider dp = sessionDelegate.getDefinitionProvider();\n-                    try {\n-                        String childName = sessionDelegate.getOakName(PathUtils.getName(relPath));\n-                        NodeDefinition def = dp.getDefinition(new NodeImpl<NodeDelegate>(parent), childName);\n-                        ntName = def.getDefaultPrimaryTypeName();\n-                    } catch (RepositoryException e) {\n+                    String childName = sessionDelegate.getOakName(PathUtils.getName(relPath));\n+                    NodeDefinition def = dp.getDefinition(new NodeImpl<NodeDelegate>(parent), childName);\n+                    ntName = def.getDefaultPrimaryTypeName();\n+                    if (ntName == null) {\n                         throw new ConstraintViolationException(\n                                 \"no matching child node definition found for \" + relPath);\n                     }",
                "changes": 9
            },
            {
                "status": "modified",
                "additions": 0,
                "raw_url": "https://github.com/apache/jackrabbit-oak/raw/50c12c33f7bc381d413f9354f67573a7b180a765/oak-jcr/src/test/java/org/apache/jackrabbit/oak/jcr/CRUDTest.java",
                "contents_url": "https://api.github.com/repos/apache/jackrabbit-oak/contents/oak-jcr/src/test/java/org/apache/jackrabbit/oak/jcr/CRUDTest.java?ref=50c12c33f7bc381d413f9354f67573a7b180a765",
                "filename": "oak-jcr/src/test/java/org/apache/jackrabbit/oak/jcr/CRUDTest.java",
                "deletions": 2,
                "sha": "13757ed002833b205b076ba84eeb595a39584169",
                "blob_url": "https://github.com/apache/jackrabbit-oak/blob/50c12c33f7bc381d413f9354f67573a7b180a765/oak-jcr/src/test/java/org/apache/jackrabbit/oak/jcr/CRUDTest.java",
                "patch": "@@ -24,7 +24,6 @@\n import javax.jcr.Session;\n import javax.jcr.nodetype.ConstraintViolationException;\n \n-import org.junit.Ignore;\n import org.junit.Test;\n \n import static junit.framework.Assert.assertEquals;\n@@ -119,7 +118,6 @@ public void testRootPropertyPath() throws RepositoryException {\n     }\n     \n     @Test(expected = ConstraintViolationException.class)\n-    @Ignore(\"OAK-642\")\n     public void nodeType() throws RepositoryException {\n             Session s = getAdminSession();\n             s.getRootNode().addNode(\"a\", \"nt:folder\").addNode(\"b\");",
                "changes": 2
            }
        ],
        "unit_tests": [
            "CRUDTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "oak-jcr/src/test/java/org/apache/jackrabbit/oak/jcr/CRUDTest.java",
        "buggy_files": [
            "oak-mongomk/src/main/java/org/apache/jackrabbit/mongomk/impl/model/NodeImpl.java",
            "oak-jcr/src/main/java/org/apache/jackrabbit/oak/jcr/NodeImpl.java",
            "oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/old/mk/simple/NodeImpl.java"
        ],
        "fixed": true
    }
]