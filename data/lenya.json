{
    "lenya_06f0c37": {
        "bug_id": "lenya_06f0c37",
        "commit": "https://github.com/apache/lenya/commit/06f0c37c65d1df32b4e573fed7b2641840aba5f8",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/lenya/blob/06f0c37c65d1df32b4e573fed7b2641840aba5f8/src/java/org/apache/lenya/cms/publication/URLInformation.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/publication/URLInformation.java?ref=06f0c37c65d1df32b4e573fed7b2641840aba5f8",
                "deletions": 2,
                "filename": "src/java/org/apache/lenya/cms/publication/URLInformation.java",
                "patch": "@@ -53,8 +53,9 @@ public String getArea() {\n      * @return A string.\n      */\n     public String getCompleteArea() {\n-        if (this.completeArea == null) {\n-            String pubUrl = this.url.substring(getPublicationId().length());\n+        String pubId = getPublicationId();\n+        if (this.completeArea == null && pubId != null) {\n+            String pubUrl = this.url.substring(pubId.length());\n             if (pubUrl.startsWith(\"/\")) {\n                 this.completeArea = extractBeforeSlash(pubUrl.substring(1));\n             } else {",
                "raw_url": "https://github.com/apache/lenya/raw/06f0c37c65d1df32b4e573fed7b2641840aba5f8/src/java/org/apache/lenya/cms/publication/URLInformation.java",
                "sha": "bc8f53d75244b73ae00a682b942587bafc21abec",
                "status": "modified"
            }
        ],
        "message": "URLInformation: avoid NPE for '/' URLs\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@550461 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/lenya/commit/233e23b0e96b861b8de98ec9aa45cfbce22029e9",
        "repo": "lenya",
        "unit_tests": [
            "URLInformationTest.java"
        ]
    },
    "lenya_0da9bc3": {
        "bug_id": "lenya_0da9bc3",
        "commit": "https://github.com/apache/lenya/commit/0da9bc340236e6f10911b2a1c67c383e529d7c63",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/lenya/blob/0da9bc340236e6f10911b2a1c67c383e529d7c63/src/java/org/apache/lenya/cms/publication/DefaultDocument.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/publication/DefaultDocument.java?ref=0da9bc340236e6f10911b2a1c67c383e529d7c63",
                "deletions": 3,
                "filename": "src/java/org/apache/lenya/cms/publication/DefaultDocument.java",
                "patch": "@@ -1,5 +1,5 @@\n /*\n-$Id: DefaultDocument.java,v 1.20 2003/07/31 11:56:42 andreas Exp $\n+$Id: DefaultDocument.java,v 1.21 2003/08/08 08:35:58 gregor Exp $\n <License>\n \n  ============================================================================\n@@ -105,9 +105,11 @@ protected DefaultDocument(Publication publication, String id, String area) {\n \n         assert (publication != null) && !\"\".equals(publication);\n         this.publication = publication;\n+\n+\t\tsetArea(area);\n+\n \t\tthis.dublincore =  new DublinCore(this);\n \n-        setArea(area);\n     }\n \n \t/**\n@@ -124,9 +126,10 @@ protected DefaultDocument(Publication publication, String id, String area, Strin\n \t\tassert (publication != null) && !\"\".equals(publication);\n \t\tthis.publication = publication;\n \t\tthis.language = language;\n+\t\tsetArea(area);\n+\n \t\tthis.dublincore =  new DublinCore(this);\n \n-\t\tsetArea(area);\n \t}\n \n     /**",
                "raw_url": "https://github.com/apache/lenya/raw/0da9bc340236e6f10911b2a1c67c383e529d7c63/src/java/org/apache/lenya/cms/publication/DefaultDocument.java",
                "sha": "31fd40418246754dea36f5aea99419b697317728",
                "status": "modified"
            }
        ],
        "message": "we need to set the area before we call the DublinCore constructor or we'll get a NPE\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/lenya/trunk@40628 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/lenya/commit/7893547264e5734ac63d6f1fb3f6682420465f37",
        "repo": "lenya",
        "unit_tests": [
            "DefaultDocumentTest.java"
        ]
    },
    "lenya_19da45e": {
        "bug_id": "lenya_19da45e",
        "commit": "https://github.com/apache/lenya/commit/19da45e4e045790cdd3c559ff0802a5225cf3205",
        "file": [
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/SiteManager.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/site/SiteManager.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 1,
                "filename": "src/java/org/apache/lenya/cms/site/SiteManager.java",
                "patch": "@@ -147,10 +147,19 @@ boolean requires(DocumentIdentityMap map, Node dependingResource, Node requiredR\n      * It is meant to hide specific nodes within the \"public\" navigation whereas the node is visible within the info/site area.\n      * \n      * @param document The document.\n-     * @param label The label.\n+     * @param visibleInNav The visibility.\n      * @throws SiteException if an error occurs.\n      */\n     void setVisibleInNav(Document document, boolean visibleInNav) throws SiteException;\n+    \n+    /**\n+     * Returns the visibility of a node in the navigation. \n+     * \n+     * @param document The document.\n+     * @return A boolean value.\n+     * @throws SiteException if an error occurs.\n+     */\n+    boolean isVisibleInNav(Document document) throws SiteException;\n \n     /**\n      * Returns all documents in a certain area.",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/SiteManager.java",
                "sha": "b81699467e81276bb642896a144c7e3e242d2661",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/simple/SimpleSiteManager.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/site/simple/SimpleSiteManager.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 1,
                "filename": "src/java/org/apache/lenya/cms/site/simple/SimpleSiteManager.java",
                "patch": "@@ -201,7 +201,7 @@ public void setLabel(Document document, String label) throws SiteException {\n \n     /**\n      * @see org.apache.lenya.cms.site.SiteManager#setVisibleInNav(org.apache.lenya.cms.publication.Document,\n-     *      java.lang.String)\n+     *      boolean)\n      */\n     public void setVisibleInNav(Document document, boolean visibleInNav) throws SiteException {\n     }\n@@ -236,4 +236,8 @@ public Document getAvailableDocument(Document document) throws SiteException {\n         return document;\n     }\n \n+    public boolean isVisibleInNav(Document document) throws SiteException {\n+        return true;\n+    }\n+\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/simple/SimpleSiteManager.java",
                "sha": "7aebca3b3599b25c49eaf47ff3080386ffad02fb",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/topicmap/TopicMapSiteManager.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/site/topicmap/TopicMapSiteManager.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 1,
                "filename": "src/java/org/apache/lenya/cms/site/topicmap/TopicMapSiteManager.java",
                "patch": "@@ -118,7 +118,7 @@ public void setLabel(Document document, String label) throws SiteException {\n     \n     /**\n      * @see org.apache.lenya.cms.site.SiteManager#setVisibleInNav(org.apache.lenya.cms.publication.Document,\n-     *      java.lang.String)\n+     *      boolean)\n      */\n     public void setVisibleInNav(Document document, boolean visibleInNav) throws SiteException {\n     }\n@@ -151,4 +151,8 @@ public Document getAvailableDocument(Document document) throws SiteException {\n         return document;\n     }\n \n+    public boolean isVisibleInNav(Document document) throws SiteException {\n+        return true;\n+    }\n+\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/topicmap/TopicMapSiteManager.java",
                "sha": "5b51ec333cf574bfc494b3e37c78eb1452a68baa",
                "status": "modified"
            },
            {
                "additions": 25,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/usecases/CreateLanguage.java",
                "changes": 26,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/site/usecases/CreateLanguage.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 1,
                "filename": "src/java/org/apache/lenya/cms/site/usecases/CreateLanguage.java",
                "patch": "@@ -19,12 +19,14 @@\n import java.util.ArrayList;\n import java.util.List;\n \n+import org.apache.avalon.framework.service.ServiceSelector;\n import org.apache.lenya.cms.publication.Document;\n import org.apache.lenya.cms.publication.DocumentBuildException;\n import org.apache.lenya.cms.publication.DocumentException;\n import org.apache.lenya.cms.publication.DocumentIdentityMap;\n-import org.apache.lenya.cms.publication.ResourceType;\n import org.apache.lenya.cms.publication.Publication;\n+import org.apache.lenya.cms.publication.ResourceType;\n+import org.apache.lenya.cms.site.SiteManager;\n \n /**\n  * Usecase to create a new language version of a resource.\n@@ -88,6 +90,7 @@ protected void initParameters() {\n \n         Document source = getSourceDocument();\n         if (source != null) {\n+            setParameter(DOCUMENT_ID, source.getId());\n             try {\n                 List nonExistingLanguages = getNonExistingLanguages();\n                 setParameter(LANGUAGES, nonExistingLanguages\n@@ -142,4 +145,25 @@ protected String getDocumentTypeName() {\n         return this.documentTypeName;\n     }\n \n+    protected boolean getVisibleInNav() {\n+        Document source = getSourceDocument();\n+        ServiceSelector selector = null;\n+        SiteManager siteManager = null;\n+        try {\n+            selector = (ServiceSelector) manager.lookup(SiteManager.ROLE + \"Selector\");\n+            siteManager = (SiteManager) selector.select(source.getPublication()\n+                    .getSiteManagerHint());\n+            return siteManager.isVisibleInNav(source);\n+        } catch (Exception e) {\n+            throw new RuntimeException(e);\n+        } finally {\n+            if (selector != null) {\n+                if (siteManager != null) {\n+                    selector.release(siteManager);\n+                }\n+                manager.release(selector);\n+            }\n+        }\n+    }\n+\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/usecases/CreateLanguage.java",
                "sha": "7231a989e9079cd9675dd89d52905ad67cc58f9f",
                "status": "modified"
            },
            {
                "additions": 35,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/DefaultSiteTree.java",
                "changes": 53,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/DefaultSiteTree.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 18,
                "filename": "src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/DefaultSiteTree.java",
                "patch": "@@ -120,9 +120,8 @@ public synchronized Document createDocument() throws ParserConfigurationExceptio\n \n         Element root = document.getDocumentElement();\n         root.setAttribute(\"xmlns:xsi\", \"http://www.w3.org/2001/XMLSchema-instance\");\n-        root\n-                .setAttribute(\"xsi:schemaLocation\",\n-                        \"http://apache.org/cocoon/lenya/sitetree/1.0  ../../../../resources/entities/sitetree.xsd\");\n+        root.setAttribute(\"xsi:schemaLocation\",\n+                \"http://apache.org/cocoon/lenya/sitetree/1.0  ../../../../resources/entities/sitetree.xsd\");\n \n         return document;\n     }\n@@ -177,8 +176,8 @@ public synchronized void addNode(SiteTreeNode node, String refDocumentId) throws\n      * @see org.apache.lenya.cms.site.tree.SiteTree#addNode(java.lang.String, java.lang.String,\n      *      org.apache.lenya.cms.site.Label[], boolean)\n      */\n-    public synchronized void addNode(String parentid, String id, Label[] labels, boolean visibleInNav)\n-            throws SiteException {\n+    public synchronized void addNode(String parentid, String id, Label[] labels,\n+            boolean visibleInNav) throws SiteException {\n         addNode(parentid, id, labels, visibleInNav, null, null, false);\n     }\n \n@@ -194,8 +193,8 @@ public synchronized void addNode(SiteTreeNode node) throws SiteException {\n      *      org.apache.lenya.cms.site.Label[], boolean, java.lang.String, java.lang.String, boolean,\n      *      java.lang.String)\n      */\n-    public synchronized void addNode(String documentid, Label[] labels, boolean visibleInNav, String href, String suffix,\n-            boolean link, String refDocumentId) throws SiteException {\n+    public synchronized void addNode(String documentid, Label[] labels, boolean visibleInNav,\n+            String href, String suffix, boolean link, String refDocumentId) throws SiteException {\n         StringBuffer buf = new StringBuffer();\n         StringTokenizer st = new StringTokenizer(documentid, \"/\");\n         int length = st.countTokens();\n@@ -212,17 +211,17 @@ public synchronized void addNode(String documentid, Label[] labels, boolean visi\n      * @see org.apache.lenya.cms.site.tree.SiteTree#addNode(java.lang.String,\n      *      org.apache.lenya.cms.site.Label[], boolean, java.lang.String, java.lang.String, boolean)\n      */\n-    public synchronized void addNode(String documentid, Label[] labels, boolean visibleInNav, String href, String suffix,\n-            boolean link) throws SiteException {\n+    public synchronized void addNode(String documentid, Label[] labels, boolean visibleInNav,\n+            String href, String suffix, boolean link) throws SiteException {\n         addNode(documentid, labels, visibleInNav, href, suffix, link, null);\n     }\n \n     /**\n      * @see org.apache.lenya.cms.site.tree.SiteTree#addNode(java.lang.String, java.lang.String,\n      *      org.apache.lenya.cms.site.Label[], boolean, java.lang.String, java.lang.String, boolean)\n      */\n-    public synchronized void addNode(String parentid, String id, Label[] labels, boolean visibleInNav, String href,\n-            String suffix, boolean link) throws SiteException {\n+    public synchronized void addNode(String parentid, String id, Label[] labels,\n+            boolean visibleInNav, String href, String suffix, boolean link) throws SiteException {\n         addNode(parentid, id, labels, visibleInNav, href, suffix, link, null);\n     }\n \n@@ -231,8 +230,9 @@ public synchronized void addNode(String parentid, String id, Label[] labels, boo\n      *      org.apache.lenya.cms.site.Label[], boolean, java.lang.String, java.lang.String, boolean,\n      *      java.lang.String)\n      */\n-    public synchronized void addNode(String parentid, String id, Label[] labels, boolean visibleInNav, String href,\n-            String suffix, boolean link, String refDocumentId) throws SiteException {\n+    public synchronized void addNode(String parentid, String id, Label[] labels,\n+            boolean visibleInNav, String href, String suffix, boolean link, String refDocumentId)\n+            throws SiteException {\n \n         Node parentNode = getNodeInternal(parentid);\n \n@@ -263,7 +263,7 @@ public synchronized void addNode(String parentid, String id, Label[] labels, boo\n         } else {\n             child.setAttribute(SiteTreeNodeImpl.VISIBLEINNAV_ATTRIBUTE_NAME, \"false\");\n         }\n-        \n+\n         if ((href != null) && (href.length() > 0)) {\n             child.setAttribute(SiteTreeNodeImpl.HREF_ATTRIBUTE_NAME, href);\n         }\n@@ -514,8 +514,14 @@ public synchronized void importSubtree(SiteTreeNode newParent, SiteTreeNode subt\n         String parentId = newParent.getAbsoluteId();\n         String id = newid;\n \n-        this.addNode(parentId, id, subtreeRoot.getLabels(), subtreeRoot.visibleInNav(), subtreeRoot.getHref(), subtreeRoot\n-                .getSuffix(), subtreeRoot.hasLink(), refDocumentId);\n+        this.addNode(parentId,\n+                id,\n+                subtreeRoot.getLabels(),\n+                subtreeRoot.visibleInNav(),\n+                subtreeRoot.getHref(),\n+                subtreeRoot.getSuffix(),\n+                subtreeRoot.hasLink(),\n+                refDocumentId);\n         newParent = this.getNode(parentId + \"/\" + id);\n         if (newParent == null) {\n             throw new SiteException(\"The added node was not found.\");\n@@ -546,11 +552,12 @@ public synchronized void setLabel(String documentId, Label label) {\n             throw new RuntimeException(e);\n         }\n     }\n-    \n+\n     /**\n      * @see org.apache.lenya.cms.site.tree.SiteTree#setVisibleInNav(java.lang.String, boolean)\n      */\n-    public synchronized void setVisibleInNav(String documentId, boolean visibleInNav)  throws SiteException {\n+    public synchronized void setVisibleInNav(String documentId, boolean visibleInNav)\n+            throws SiteException {\n         SiteTreeNode node = getNode(documentId);\n         if (visibleInNav) {\n             node.setNodeAttribute(SiteTreeNodeImpl.VISIBLEINNAV_ATTRIBUTE_NAME, \"true\");\n@@ -601,4 +608,14 @@ public void save() throws SiteException {\n         saveDocument();\n     }\n \n+    public boolean isVisibleInNav(String documentId) throws SiteException {\n+        SiteTreeNode node = getNode(documentId);\n+        String value = node.getNodeAttribute(SiteTreeNodeImpl.VISIBLEINNAV_ATTRIBUTE_NAME);\n+        if (value != null && !value.equals(\"\")) {\n+            return Boolean.valueOf(value).booleanValue();\n+        } else {\n+            return true;\n+        }\n+    }\n+\n }",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/DefaultSiteTree.java",
                "sha": "3f929d3b28e28af33265726350f4462c057c33ba",
                "status": "modified"
            },
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTree.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTree.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 2,
                "filename": "src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTree.java",
                "patch": "@@ -158,9 +158,19 @@ void addNode(String documentid, Label[] labels, boolean visibleInNav, String hre\n      * Sets the visibility in the navigation of an existing node. \n      * \n      * @param documentId the document-id to which the visibility is to be added.\n-     * @param visiblieInNav \n+     * @param visibleInNav The visibility. \n+     * @throws SiteException if an error occurs.\n+     */\n+    void setVisibleInNav(String documentId, boolean visibleInNav) throws SiteException;\n+    \n+    /**\n+     * Returns the visibility in the navigation of an existing node.\n+     *  \n+     * @param documentId The document ID.\n+     * @return A boolean value.\n+     * @throws SiteException\n      */\n-    void setVisibleInNav (String documentId, boolean visibleInNav) throws SiteException;\n+    boolean isVisibleInNav(String documentId) throws SiteException;\n \n     /**\n      * Remove a label from a node",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTree.java",
                "sha": "2768394aa3661ec5c911e42bb3e0dcbfa8893e4f",
                "status": "modified"
            },
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNode.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNode.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 0,
                "filename": "src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNode.java",
                "patch": "@@ -204,6 +204,14 @@\n      */\n     void setNodeAttribute (String attributeName, String attributeValue);\n \n+    /**\n+     * Returns an attribute of this node.\n+     *\n+     * @param attributeName name of the attribute\n+     * @return The value.\n+     */\n+    String getNodeAttribute (String attributeName);\n+\n     /**\n      * Give a list of the children and this node in a pre order way\n      * @return The list",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNode.java",
                "sha": "3e70570046622b3e2617256099ef30b52fc18ffb",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 0,
                "filename": "src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java",
                "patch": "@@ -490,4 +490,9 @@ public List preOrder() {\n         return list;\n     }\n \n+    public String getNodeAttribute(String attributeName) {\n+        Element element = (Element) this.node;\n+        return element.getAttribute(attributeName);\n+    }\n+\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java",
                "sha": "6bbd43c8bdb8a47b95a5ebcb7aa8940e013fba40",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/TreeSiteManager.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/TreeSiteManager.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205",
                "deletions": 2,
                "filename": "src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/TreeSiteManager.java",
                "patch": "@@ -302,10 +302,9 @@ public void setLabel(Document document, String label) throws SiteException {\n \n     /**\n      * @see org.apache.lenya.cms.site.SiteManager#setVisibleInNav(org.apache.lenya.cms.publication.Document,\n-     *      java.lang.String)\n+     *      boolean)\n      */\n     public void setVisibleInNav(Document document, boolean visibleInNav) throws SiteException {\n-\n         SiteTree tree = getTree(document);\n         tree.setVisibleInNav(document.getId(), visibleInNav);\n     }\n@@ -469,4 +468,9 @@ protected String computeUniqueDocumentId(Document document) throws SiteException\n \n         return documentId;\n     }\n+\n+    public boolean isVisibleInNav(Document document) throws SiteException {\n+        SiteTree tree = getTree(document);\n+        return tree.isVisibleInNav(document.getId());\n+    }\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/TreeSiteManager.java",
                "sha": "5988d9e589c558938415fb00be9fe50f51e81ac4",
                "status": "modified"
            }
        ],
        "message": "Added isVisibleInNav() method to SiteManager. This allows to fix an NPE in the CreateLanguage usecase.\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@370125 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/lenya/commit/8397f305e42a57724b179d160014b23c9de92395",
        "repo": "lenya",
        "unit_tests": [
            "SimpleSiteManagerTest.java"
        ]
    },
    "lenya_2c9f20d": {
        "bug_id": "lenya_2c9f20d",
        "commit": "https://github.com/apache/lenya/commit/2c9f20dbf6d8813f8662f4c4b904684f799289eb",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/lenya/blob/2c9f20dbf6d8813f8662f4c4b904684f799289eb/src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/AbstractUsecase.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/AbstractUsecase.java?ref=2c9f20dbf6d8813f8662f4c4b904684f799289eb",
                "deletions": 1,
                "filename": "src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/AbstractUsecase.java",
                "patch": "@@ -86,9 +86,11 @@ protected void advanceState(String event) {\n \n     /**\n      * @see org.apache.lenya.cms.usecase.Usecase#getSourceURL()\n+     * We don't use getParameterAsString() because this will typically\n+     * cause stack overflows or NPEs in connection with initParameters().\n      */\n     public String getSourceURL() {\n-        return getParameterAsString(SOURCE_URL);\n+        return (String) this.parameters.get(SOURCE_URL);\n     }\n \n     /**",
                "raw_url": "https://github.com/apache/lenya/raw/2c9f20dbf6d8813f8662f4c4b904684f799289eb/src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/AbstractUsecase.java",
                "sha": "0c4794e5e1671bc3792288dbc9991f5c09363462",
                "status": "modified"
            }
        ],
        "message": "AbstractUsecase.getSourceURL() doesn't use getParameter() to avoid NPEs\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@509212 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/lenya/commit/c6a254b0d3f138f57d0a626976573a734f31ae3a",
        "repo": "lenya",
        "unit_tests": [
            "AbstractUsecaseTest.java"
        ]
    },
    "lenya_6aca987": {
        "bug_id": "lenya_6aca987",
        "commit": "https://github.com/apache/lenya/commit/6aca9871fde3ef7e3d8e82e0026c073d299c8f10",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/lenya/blob/6aca9871fde3ef7e3d8e82e0026c073d299c8f10/src/java/org/apache/lenya/cms/publication/URLInformation.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/publication/URLInformation.java?ref=6aca9871fde3ef7e3d8e82e0026c073d299c8f10",
                "deletions": 1,
                "filename": "src/java/org/apache/lenya/cms/publication/URLInformation.java",
                "patch": "@@ -39,7 +39,7 @@\n     public String getArea() {\n         if (this.area == null) {\n             String completeArea = getCompleteArea();\n-            if (completeArea.equals(Publication.DAV_AREA)) {\n+            if (Publication.DAV_AREA.equals(completeArea)) {\n                 this.area = Publication.AUTHORING_AREA;\n             } else {\n                 this.area = completeArea;",
                "raw_url": "https://github.com/apache/lenya/raw/6aca9871fde3ef7e3d8e82e0026c073d299c8f10/src/java/org/apache/lenya/cms/publication/URLInformation.java",
                "sha": "9ffb6d2201bfbdffacd350672169388858db2c0c",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/lenya/blob/6aca9871fde3ef7e3d8e82e0026c073d299c8f10/src/modules-core/ac/java/src/org/apache/lenya/cms/ac/DocumentPolicyManagerWrapper.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/ac/java/src/org/apache/lenya/cms/ac/DocumentPolicyManagerWrapper.java?ref=6aca9871fde3ef7e3d8e82e0026c073d299c8f10",
                "deletions": 2,
                "filename": "src/modules-core/ac/java/src/org/apache/lenya/cms/ac/DocumentPolicyManagerWrapper.java",
                "patch": "@@ -95,10 +95,14 @@ protected String getPolicyURL(String webappUrl)\n             // have to exist\n \n             URLInformation info = new URLInformation(webappUrl);\n+            // Danger, Will Robinson! If area or pubId is null, webappUrl.substring()\n+            // will be out of bounds, because null becomes \"null\" in string concatenation\n             String pubId = info.getPublicationId();\n             String area = info.getArea();\n-            String prefix = \"/\" + pubId + \"/\";\n-            String prefixWithArea = prefix + area;\n+            String prefix = \"/\" + ((pubId != null) ? pubId : \"\");\n+            // String prefix = \"/\" + pubId + \"/\";\n+            String prefixWithArea = prefix + ((area != null) ? area : \"\");\n+            // String prefixWithArea = prefix + area;\n             String authoringUrl = prefix + Publication.AUTHORING_AREA\n                     + webappUrl.substring(prefixWithArea.length());\n ",
                "raw_url": "https://github.com/apache/lenya/raw/6aca9871fde3ef7e3d8e82e0026c073d299c8f10/src/modules-core/ac/java/src/org/apache/lenya/cms/ac/DocumentPolicyManagerWrapper.java",
                "sha": "db7a06eb142ab6b756d503b350fdfd59634c9066",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/lenya/blob/6aca9871fde3ef7e3d8e82e0026c073d299c8f10/src/webapp/global-sitemap.xmap",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/global-sitemap.xmap?ref=6aca9871fde3ef7e3d8e82e0026c073d299c8f10",
                "deletions": 4,
                "filename": "src/webapp/global-sitemap.xmap",
                "patch": "@@ -301,10 +301,6 @@\n     </map:pipeline>\n \n     <map:pipeline>\n-      <map:match pattern=\"\">\n-        <map:redirect-to uri=\"index.html\"/>\n-      </map:match>\n-\n       <map:match pattern=\"index.html\">\n         <map:aggregate element=\"lenya\" ns=\"http://apache.org/cocoon/lenya/publication/1.0\" prefix=\"lenya\" label=\"aggregate\">\n           <map:part src=\"cocoon:/publications.xml\"/>\n@@ -320,6 +316,10 @@\n         <map:serialize />\n       </map:match>\n \n+      <map:match pattern=\"*\">\n+        <map:redirect-to uri=\"index.html\"/>\n+      </map:match>\n+\n       <!-- Publications -->\n       <map:match pattern=\"*\">\n         <map:select type=\"request-method\">",
                "raw_url": "https://github.com/apache/lenya/raw/6aca9871fde3ef7e3d8e82e0026c073d299c8f10/src/webapp/global-sitemap.xmap",
                "sha": "afa68a2650c2fed7ca9065c0148a06a6ed13cb71",
                "status": "modified"
            }
        ],
        "message": "avoid NPE when a user requests <host>:<port>/foo.\nsee bug http://issues.apache.org/bugzilla/show_bug.cgi?id=41694.\n* make URLInformation handle null strings gracefully\n* check for null strings in DocumentPolicyManagerWrapper\n\nadditionally, redirect \"*\" to \"index.html\" in global-sitemap.xmap to\navoid spurious authentication warnings.\nFIXME: a request of the form <pub-id> without a trailing slash is not\nyet handled - it triggers a login usecase, but permission is not granted\nregardless of credentials.\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@511371 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/lenya/commit/b8008f6b754cec3a4e111579ac1a8c4b7cb6d5a0",
        "repo": "lenya",
        "unit_tests": [
            "URLInformationTest.java"
        ]
    }
}