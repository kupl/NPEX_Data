[
    {
        "repo": "commons-vfs",
        "commit": "https://github.com/apache/commons-vfs/commit/0e681a785066d2bbecaed0deb9366586d156ca49",
        "bug_id": "commons-vfs_0e681a7",
        "message": "[VFS-427][HTTP] NPE on HttpFileObject.getContent().getContentInfo().\n\ngit-svn-id: https://svn.apache.org/repos/asf/commons/proper/vfs/trunk@1362235 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/commons-vfs/commit/4b9ef61dfe2b904af86a09be6d5dbe77482ba32c",
        "patched_files": [
            "changes.xml",
            "HttpFileObject.java",
            "HttpFileContentInfoFactory.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 14,
                "raw_url": "https://github.com/apache/commons-vfs/raw/0e681a785066d2bbecaed0deb9366586d156ca49/core/src/main/java/org/apache/commons/vfs2/provider/http/HttpFileContentInfoFactory.java",
                "contents_url": "https://api.github.com/repos/apache/commons-vfs/contents/core/src/main/java/org/apache/commons/vfs2/provider/http/HttpFileContentInfoFactory.java?ref=0e681a785066d2bbecaed0deb9366586d156ca49",
                "filename": "core/src/main/java/org/apache/commons/vfs2/provider/http/HttpFileContentInfoFactory.java",
                "deletions": 3,
                "sha": "3c6cfcfdfc18563fbecd3b8f8d27105e616d6b15",
                "blob_url": "https://github.com/apache/commons-vfs/blob/0e681a785066d2bbecaed0deb9366586d156ca49/core/src/main/java/org/apache/commons/vfs2/provider/http/HttpFileContentInfoFactory.java",
                "patch": "@@ -16,8 +16,11 @@\n  */\n package org.apache.commons.vfs2.provider.http;\n \n+import java.io.IOException;\n+\n import org.apache.commons.httpclient.Header;\n import org.apache.commons.httpclient.HeaderElement;\n+import org.apache.commons.httpclient.methods.HeadMethod;\n import org.apache.commons.vfs2.FileContent;\n import org.apache.commons.vfs2.FileContentInfo;\n import org.apache.commons.vfs2.FileContentInfoFactory;\n@@ -26,7 +29,7 @@\n import org.apache.commons.vfs2.util.FileObjectUtils;\n \n /**\n- * Creates the FileContentInfo.\n+ * Creates FileContentInfo instances for HTTP.\n  */\n public class HttpFileContentInfoFactory implements FileContentInfoFactory\n {\n@@ -38,7 +41,15 @@ public FileContentInfo create(FileContent fileContent) throws FileSystemExceptio\n         String contentType = null;\n         String contentEncoding = null;\n \n-        Header header = httpFile.getHeadMethod().getResponseHeader(\"content-type\");\n+        HeadMethod headMethod;\n+        try\n+        {\n+            headMethod = httpFile.getHeadMethod();\n+        } catch (IOException e)\n+        {\n+            throw new FileSystemException(e);\n+        }\n+        Header header = headMethod.getResponseHeader(\"content-type\");\n         if (header != null)\n         {\n             HeaderElement[] element = header.getElements();\n@@ -48,7 +59,7 @@ public FileContentInfo create(FileContent fileContent) throws FileSystemExceptio\n             }\n         }\n \n-        contentEncoding = httpFile.getHeadMethod().getResponseCharSet();\n+        contentEncoding = headMethod.getResponseCharSet();\n \n         return new DefaultFileContentInfo(contentType, contentEncoding);\n     }",
                "changes": 17
            },
            {
                "status": "modified",
                "additions": 10,
                "raw_url": "https://github.com/apache/commons-vfs/raw/0e681a785066d2bbecaed0deb9366586d156ca49/core/src/main/java/org/apache/commons/vfs2/provider/http/HttpFileObject.java",
                "contents_url": "https://api.github.com/repos/apache/commons-vfs/contents/core/src/main/java/org/apache/commons/vfs2/provider/http/HttpFileObject.java?ref=0e681a785066d2bbecaed0deb9366586d156ca49",
                "filename": "core/src/main/java/org/apache/commons/vfs2/provider/http/HttpFileObject.java",
                "deletions": 6,
                "sha": "c8b044bb5fdd7d2a6bd74b03a8f95f345328cb85",
                "blob_url": "https://github.com/apache/commons-vfs/blob/0e681a785066d2bbecaed0deb9366586d156ca49/core/src/main/java/org/apache/commons/vfs2/provider/http/HttpFileObject.java",
                "patch": "@@ -74,11 +74,7 @@ protected void doDetach() throws Exception\n     protected FileType doGetType() throws Exception\n     {\n         // Use the HEAD method to probe the file.\n-        method = new HeadMethod();\n-        setupMethod(method);\n-        final HttpClient client = fileSystem.getClient();\n-        final int status = client.executeMethod(method);\n-        method.releaseConnection();\n+        final int status = this.getHeadMethod().getStatusCode();\n         if (status == HttpURLConnection.HTTP_OK)\n         {\n             return FileType.FILE;\n@@ -216,8 +212,16 @@ protected FileContentInfoFactory getFileContentInfoFactory()\n         return new HttpFileContentInfoFactory();\n     }\n \n-    HeadMethod getHeadMethod()\n+    HeadMethod getHeadMethod() throws IOException\n     {\n+        if (method != null) {\n+            return method;\n+        }\n+        method = new HeadMethod();\n+        setupMethod(method);\n+        final HttpClient client = fileSystem.getClient();\n+        client.executeMethod(method);\n+        method.releaseConnection();\n         return method;\n     }\n ",
                "changes": 16
            },
            {
                "status": "added",
                "additions": 35,
                "raw_url": "https://github.com/apache/commons-vfs/raw/0e681a785066d2bbecaed0deb9366586d156ca49/core/src/test/java/org/apache/commons/vfs2/provider/http/test/GetContentInfoFunctionalTest.java",
                "contents_url": "https://api.github.com/repos/apache/commons-vfs/contents/core/src/test/java/org/apache/commons/vfs2/provider/http/test/GetContentInfoFunctionalTest.java?ref=0e681a785066d2bbecaed0deb9366586d156ca49",
                "filename": "core/src/test/java/org/apache/commons/vfs2/provider/http/test/GetContentInfoFunctionalTest.java",
                "deletions": 0,
                "sha": "7c1c4c5d91c9905baa4c90ec0417de5a78d9100f",
                "blob_url": "https://github.com/apache/commons-vfs/blob/0e681a785066d2bbecaed0deb9366586d156ca49/core/src/test/java/org/apache/commons/vfs2/provider/http/test/GetContentInfoFunctionalTest.java",
                "patch": "@@ -0,0 +1,35 @@\n+package org.apache.commons.vfs2.provider.http.test;\n+\n+import org.apache.commons.vfs2.FileContent;\n+import org.apache.commons.vfs2.FileObject;\n+import org.apache.commons.vfs2.FileSystemException;\n+import org.apache.commons.vfs2.FileSystemManager;\n+import org.apache.commons.vfs2.VFS;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+/**\n+ * Tests VFS-427 NPE on HttpFileObject.getContent().getContentInfo()\n+ * \n+ * @since 2.1\n+ */\n+public class GetContentInfoFunctionalTest\n+{\n+\n+    /**\n+     * Tests VFS-427 NPE on HttpFileObject.getContent().getContentInfo().\n+     * \n+     * @throws FileSystemException\n+     *             thrown when the getContentInfo API fails.\n+     */\n+    @Test\n+    public void testGoogle() throws FileSystemException\n+    {\n+        final FileSystemManager fsManager = VFS.getManager();\n+        final FileObject fo = fsManager.resolveFile(\"http://www.google.com/images/logos/ps_logo2.png\");\n+        final FileContent content = fo.getContent();\n+        Assert.assertNotNull(content);\n+        // Used to NPE before fix:\n+        content.getContentInfo();\n+    }\n+}",
                "changes": 35
            },
            {
                "status": "added",
                "additions": 35,
                "raw_url": "https://github.com/apache/commons-vfs/raw/0e681a785066d2bbecaed0deb9366586d156ca49/core/src/test/java/org/apache/commons/vfs2/provider/https/test/GetContentInfoFunctionalTest.java",
                "contents_url": "https://api.github.com/repos/apache/commons-vfs/contents/core/src/test/java/org/apache/commons/vfs2/provider/https/test/GetContentInfoFunctionalTest.java?ref=0e681a785066d2bbecaed0deb9366586d156ca49",
                "filename": "core/src/test/java/org/apache/commons/vfs2/provider/https/test/GetContentInfoFunctionalTest.java",
                "deletions": 0,
                "sha": "5b9ca1388be1231b1917cfadad52c8e9989819ba",
                "blob_url": "https://github.com/apache/commons-vfs/blob/0e681a785066d2bbecaed0deb9366586d156ca49/core/src/test/java/org/apache/commons/vfs2/provider/https/test/GetContentInfoFunctionalTest.java",
                "patch": "@@ -0,0 +1,35 @@\n+package org.apache.commons.vfs2.provider.https.test;\n+\n+import org.apache.commons.vfs2.FileContent;\n+import org.apache.commons.vfs2.FileObject;\n+import org.apache.commons.vfs2.FileSystemException;\n+import org.apache.commons.vfs2.FileSystemManager;\n+import org.apache.commons.vfs2.VFS;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+/**\n+ * Tests VFS-427 NPE on HttpFileObject.getContent().getContentInfo()\n+ * \n+ * @since 2.1\n+ */\n+public class GetContentInfoFunctionalTest\n+{\n+\n+    /**\n+     * Tests VFS-427 NPE on HttpFileObject.getContent().getContentInfo().\n+     * \n+     * @throws FileSystemException\n+     *             thrown when the getContentInfo API fails.\n+     */\n+    @Test\n+    public void testGoogle() throws FileSystemException\n+    {\n+        final FileSystemManager fsManager = VFS.getManager();\n+        final FileObject fo = fsManager.resolveFile(\"https://www.google.com/images/logos/ps_logo2.png\");\n+        final FileContent content = fo.getContent();\n+        Assert.assertNotNull(content);\n+        // Used to NPE before fix:\n+        content.getContentInfo();\n+    }\n+}",
                "changes": 35
            },
            {
                "status": "modified",
                "additions": 4,
                "raw_url": "https://github.com/apache/commons-vfs/raw/0e681a785066d2bbecaed0deb9366586d156ca49/src/changes/changes.xml",
                "contents_url": "https://api.github.com/repos/apache/commons-vfs/contents/src/changes/changes.xml?ref=0e681a785066d2bbecaed0deb9366586d156ca49",
                "filename": "src/changes/changes.xml",
                "deletions": 1,
                "sha": "4effa43c6956f27c2f2ebd1c756fef9ba8ecccc8",
                "blob_url": "https://github.com/apache/commons-vfs/blob/0e681a785066d2bbecaed0deb9366586d156ca49/src/changes/changes.xml",
                "patch": "@@ -23,6 +23,9 @@\n \n   <body>\n     <release version=\"2.1\" date=\"TBD\" description=\"New features and bug fix release.\">\n+      <action issue=\"VFS-427\" dev=\"ggregory\" type=\"add\" due-to=\"awelynant\">\n+        [HTTP] NPE on HttpFileObject.getContent().getContentInfo().\n+      </action>\n       <action issue=\"VFS-405\" dev=\"ggregory\" type=\"add\" due-to=\"dwaszak\">\n         Get/set the file permissions.\n       </action>\n@@ -108,7 +111,7 @@\n         [RAM] Reading a RAM FileSystem file fails because it never returns EOF -1.\n       </action>\n       <action issue=\"VFS-404\" dev=\"ggregory\" type=\"update\">\n-        [FTP][FTPS] Update Apache Commons Net to 3.1 from 3.0.1\n+        [FTP][FTPS] Update Apache Commons Net to 3.1 from 3.0.1.\n       </action>\n       <action issue=\"VFS-402\" dev=\"ggregory\" type=\"update\">\n         [WebDAV] Update Apache Jackrabbit 1.5.2 to 1.6.5.",
                "changes": 5
            }
        ],
        "unit_tests": [
            "GetContentInfoFunctionalTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "core/src/test/java/org/apache/commons/vfs2/provider/http/test/GetContentInfoFunctionalTest.java",
        "buggy_files": [
            "src/changes/changes.xml",
            "core/src/main/java/org/apache/commons/vfs2/provider/http/HttpFileObject.java",
            "core/src/main/java/org/apache/commons/vfs2/provider/http/HttpFileContentInfoFactory.java"
        ],
        "fixed": true
    }
]