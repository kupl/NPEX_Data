[
    {
        "repo": "zeppelin",
        "commit": "https://github.com/apache/zeppelin/commit/baab124cf310545cbc6cf0b4e29b4f20b54d4f48",
        "bug_id": "zeppelin_baab124",
        "message": "ZEPPELIN-349: Resolve NPE on null cell values\n\nWhen the query response contains null column values the following NPE is thrown:\njava.lang.NullPointerException\nat org.apache.zeppelin.postgresql.PostgreSqlInterpreter.replaceReservedChars(PostgreSqlInterpreter.java:278)\nat org.apache.zeppelin.postgresql.PostgreSqlInterpreter.executeSql(PostgreSqlInterpreter.java:235)\n\nAuthor: tzolov <christian.tzolov@gmail.com>\n\nCloses #348 from tzolov/ZEPPELIN-349 and squashes the following commits:\n\nde70c88 [tzolov] ZEPPELIN-349: Format test code\nfff3448 [tzolov] ZEPPELIN-349: Resolve NPE on null cell values",
        "parent": "https://github.com/apache/zeppelin/commit/ecc497011a9c355d26f15b919509057c04c070ae",
        "patched_files": [
            "PostgreSqlInterpreter.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 4,
                "raw_url": "https://github.com/apache/zeppelin/raw/baab124cf310545cbc6cf0b4e29b4f20b54d4f48/postgresql/src/main/java/org/apache/zeppelin/postgresql/PostgreSqlInterpreter.java",
                "contents_url": "https://api.github.com/repos/apache/zeppelin/contents/postgresql/src/main/java/org/apache/zeppelin/postgresql/PostgreSqlInterpreter.java?ref=baab124cf310545cbc6cf0b4e29b4f20b54d4f48",
                "filename": "postgresql/src/main/java/org/apache/zeppelin/postgresql/PostgreSqlInterpreter.java",
                "deletions": 0,
                "sha": "4189a747c4b136fbc2f49ee853c4f1440bd2a78a",
                "blob_url": "https://github.com/apache/zeppelin/blob/baab124cf310545cbc6cf0b4e29b4f20b54d4f48/postgresql/src/main/java/org/apache/zeppelin/postgresql/PostgreSqlInterpreter.java",
                "patch": "@@ -89,6 +89,7 @@\n   static final String POSTGRESQL_SERVER_PASSWORD = \"postgresql.password\";\n   static final String POSTGRESQL_SERVER_DRIVER_NAME = \"postgresql.driver.name\";\n   static final String POSTGRESQL_SERVER_MAX_RESULT = \"postgresql.max.result\";\n+  static final String EMPTY_COLUMN_VALUE = \"\";\n \n   static {\n     Interpreter.register(\n@@ -275,6 +276,9 @@ private InterpreterResult executeSql(String sql) {\n    * For %table response replace Tab and Newline characters from the content.\n    */\n   private String replaceReservedChars(boolean isTableResponseType, String str) {\n+    if (str == null) {\n+      return EMPTY_COLUMN_VALUE;\n+    }\n     return (!isTableResponseType) ? str : str.replace(TAB, WhITESPACE).replace(NEWLINE, WhITESPACE);\n   }\n ",
                "changes": 4
            },
            {
                "status": "modified",
                "additions": 21,
                "raw_url": "https://github.com/apache/zeppelin/raw/baab124cf310545cbc6cf0b4e29b4f20b54d4f48/postgresql/src/test/java/org/apache/zeppelin/postgresql/PostgreSqlInterpreterTest.java",
                "contents_url": "https://api.github.com/repos/apache/zeppelin/contents/postgresql/src/test/java/org/apache/zeppelin/postgresql/PostgreSqlInterpreterTest.java?ref=baab124cf310545cbc6cf0b4e29b4f20b54d4f48",
                "filename": "postgresql/src/test/java/org/apache/zeppelin/postgresql/PostgreSqlInterpreterTest.java",
                "deletions": 0,
                "sha": "9c8eae113ebf2bcdd2bf7a44c1269e347909cc4f",
                "blob_url": "https://github.com/apache/zeppelin/blob/baab124cf310545cbc6cf0b4e29b4f20b54d4f48/postgresql/src/test/java/org/apache/zeppelin/postgresql/PostgreSqlInterpreterTest.java",
                "patch": "@@ -126,6 +126,27 @@ public void testStatementCancel() throws SQLException {\n         .getJdbcConnection().isClosed());\n   }\n \n+  @Test\n+  public void testNullColumnResult() throws SQLException {\n+\n+    when(psqlInterpreter.getMaxResult()).thenReturn(1000);\n+\n+    String sqlQuery = \"select * from t\";\n+\n+    result.addColumn(\"col1\", new String[] {\"val11\", null});\n+    result.addColumn(\"col2\", new String[] {null, \"val22\"});\n+\n+    InterpreterResult interpreterResult = psqlInterpreter.interpret(sqlQuery, null);\n+\n+    assertEquals(InterpreterResult.Code.SUCCESS, interpreterResult.code());\n+    assertEquals(InterpreterResult.Type.TABLE, interpreterResult.type());\n+    assertEquals(\"col1\\tcol2\\nval11\\t\\n\\tval22\\n\", interpreterResult.message());\n+\n+    verifySQLStatementExecuted(sqlQuery);\n+    verifyAllResultSetsClosed();\n+    verifyAllStatementsClosed();\n+  }\n+\n   @Test\n   public void testSelectQuery() throws SQLException {\n ",
                "changes": 21
            }
        ],
        "unit_tests": [
            "PostgreSqlInterpreterTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "postgresql/src/test/java/org/apache/zeppelin/postgresql/PostgreSqlInterpreterTest.java",
        "buggy_files": [
            "postgresql/src/main/java/org/apache/zeppelin/postgresql/PostgreSqlInterpreter.java"
        ],
        "fixed": true
    }
]