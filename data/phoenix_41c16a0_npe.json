[
    {
        "repo": "phoenix",
        "commit": "https://github.com/apache/phoenix/commit/41c16a020fcd1cb143675ea17e2d9d3a56750a8a",
        "bug_id": "phoenix_41c16a0",
        "message": "PHOENIX-3386 PhoenixStorageHandler throws NPE if local tasks executed via child\n\nSigned-off-by: Sergey Soldatov <ssa@apache.org>",
        "parent": "https://github.com/apache/phoenix/commit/c83d272b565447d39c42a4a8d3b0687bb2b5a16c",
        "patched_files": [
            "PhoenixConfigurationUtil.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 2,
                "raw_url": "https://github.com/apache/phoenix/raw/41c16a020fcd1cb143675ea17e2d9d3a56750a8a/phoenix-core/src/main/java/org/apache/phoenix/mapreduce/util/PhoenixConfigurationUtil.java",
                "contents_url": "https://api.github.com/repos/apache/phoenix/contents/phoenix-core/src/main/java/org/apache/phoenix/mapreduce/util/PhoenixConfigurationUtil.java?ref=41c16a020fcd1cb143675ea17e2d9d3a56750a8a",
                "filename": "phoenix-core/src/main/java/org/apache/phoenix/mapreduce/util/PhoenixConfigurationUtil.java",
                "deletions": 0,
                "sha": "2264acd54e1ecbf43d104eeb9640e8a7eef61295",
                "blob_url": "https://github.com/apache/phoenix/blob/41c16a020fcd1cb143675ea17e2d9d3a56750a8a/phoenix-core/src/main/java/org/apache/phoenix/mapreduce/util/PhoenixConfigurationUtil.java",
                "patch": "@@ -55,6 +55,8 @@\n public final class PhoenixConfigurationUtil {\n \n     private static final Log LOG = LogFactory.getLog(PhoenixInputFormat.class);\n+\n+    public static final String SESSION_ID = \"phoenix.sessionid\";\n     \n     public static final String UPSERT_STATEMENT = \"phoenix.upsert.stmt\";\n     ",
                "changes": 2
            },
            {
                "status": "modified",
                "additions": 4,
                "raw_url": "https://github.com/apache/phoenix/raw/41c16a020fcd1cb143675ea17e2d9d3a56750a8a/phoenix-hive/src/main/java/org/apache/phoenix/hive/PhoenixStorageHandler.java",
                "contents_url": "https://api.github.com/repos/apache/phoenix/contents/phoenix-hive/src/main/java/org/apache/phoenix/hive/PhoenixStorageHandler.java?ref=41c16a020fcd1cb143675ea17e2d9d3a56750a8a",
                "filename": "phoenix-hive/src/main/java/org/apache/phoenix/hive/PhoenixStorageHandler.java",
                "deletions": 0,
                "sha": "bda2282e5f41d15b31b739876697537e3bd89b01",
                "blob_url": "https://github.com/apache/phoenix/blob/41c16a020fcd1cb143675ea17e2d9d3a56750a8a/phoenix-hive/src/main/java/org/apache/phoenix/hive/PhoenixStorageHandler.java",
                "patch": "@@ -31,6 +31,7 @@\n import org.apache.hadoop.hive.ql.metadata.InputEstimator;\n import org.apache.hadoop.hive.ql.plan.ExprNodeDesc;\n import org.apache.hadoop.hive.ql.plan.TableDesc;\n+import org.apache.hadoop.hive.ql.session.SessionState;\n import org.apache.hadoop.hive.serde2.Deserializer;\n import org.apache.hadoop.hive.serde2.SerDe;\n import org.apache.hadoop.mapred.InputFormat;\n@@ -142,7 +143,10 @@ protected void configureJobProperties(TableDesc tableDesc, Map<String, String> j\n             tableProperties.setProperty(PhoenixStorageHandlerConstants.PHOENIX_TABLE_NAME,\n                     tableName);\n         }\n+        SessionState sessionState = SessionState.get();\n \n+        String sessionId = sessionState.getSessionId();\n+        jobProperties.put(PhoenixConfigurationUtil.SESSION_ID, sessionId);\n         jobProperties.put(PhoenixConfigurationUtil.INPUT_TABLE_NAME, tableName);\n         jobProperties.put(PhoenixStorageHandlerConstants.ZOOKEEPER_QUORUM, tableProperties\n                 .getProperty(PhoenixStorageHandlerConstants.ZOOKEEPER_QUORUM,",
                "changes": 4
            },
            {
                "status": "modified",
                "additions": 2,
                "raw_url": "https://github.com/apache/phoenix/raw/41c16a020fcd1cb143675ea17e2d9d3a56750a8a/phoenix-hive/src/main/java/org/apache/phoenix/hive/util/PhoenixStorageHandlerUtil.java",
                "contents_url": "https://api.github.com/repos/apache/phoenix/contents/phoenix-hive/src/main/java/org/apache/phoenix/hive/util/PhoenixStorageHandlerUtil.java?ref=41c16a020fcd1cb143675ea17e2d9d3a56750a8a",
                "filename": "phoenix-hive/src/main/java/org/apache/phoenix/hive/util/PhoenixStorageHandlerUtil.java",
                "deletions": 3,
                "sha": "1313fdb704309e5a6dcecc85a48184b273563a50",
                "blob_url": "https://github.com/apache/phoenix/blob/41c16a020fcd1cb143675ea17e2d9d3a56750a8a/phoenix-hive/src/main/java/org/apache/phoenix/hive/util/PhoenixStorageHandlerUtil.java",
                "patch": "@@ -33,6 +33,7 @@\n import org.apache.hadoop.net.DNS;\n import org.apache.phoenix.hive.constants.PhoenixStorageHandlerConstants;\n import org.apache.phoenix.hive.ql.index.IndexSearchCondition;\n+import org.apache.phoenix.mapreduce.util.PhoenixConfigurationUtil;\n \n import javax.naming.NamingException;\n import java.io.ByteArrayInputStream;\n@@ -182,10 +183,8 @@ private static String reverseDNS(InetAddress ipAddress) throws NamingException,\n     }\n \n     public static String getTableKeyOfSession(JobConf jobConf, String tableName) {\n-        SessionState sessionState = SessionState.get();\n-\n-        String sessionId = sessionState.getSessionId();\n \n+        String sessionId = jobConf.get(PhoenixConfigurationUtil.SESSION_ID);\n         return new StringBuilder(\"[\").append(sessionId).append(\"]-\").append(tableName).toString();\n     }\n ",
                "changes": 5
            }
        ],
        "unit_tests": [
            "PhoenixConfigurationUtilTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "phoenix-core/src/test/java/org/apache/phoenix/mapreduce/util/PhoenixConfigurationUtilTest.java",
        "buggy_files": [
            "phoenix-core/src/main/java/org/apache/phoenix/mapreduce/util/PhoenixConfigurationUtil.java"
        ],
        "fixed": true
    }
]