[{"commit": "https://github.com/apache/netbeans/commit/031deb38b043cd03555f77b64059041a4e763850", "parent": "https://github.com/apache/netbeans/commit/bdb598113b00659527c033d7f1fdceb03783efa8", "message": "[NETBEANS-3276] Fix NPE on PropertyListener deregistrtation", "bug_id": "netbeans_1", "file": [{"additions": 4, "raw_url": "https://github.com/apache/netbeans/raw/031deb38b043cd03555f77b64059041a4e763850/groovy/gradle.javaee/src/org/netbeans/modules/gradle/javaee/web/WebProjectBrowserProvider.java", "blob_url": "https://github.com/apache/netbeans/blob/031deb38b043cd03555f77b64059041a4e763850/groovy/gradle.javaee/src/org/netbeans/modules/gradle/javaee/web/WebProjectBrowserProvider.java", "sha": "97c5c91fca83891870a12c9775c6d2c00aa89826", "changes": 15, "status": "modified", "deletions": 11, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle.javaee/src/org/netbeans/modules/gradle/javaee/web/WebProjectBrowserProvider.java?ref=031deb38b043cd03555f77b64059041a4e763850", "patch": "@@ -72,12 +72,8 @@ public WebBrowser getActiveBrowser() {\n \n     @Override\n     public void setActiveBrowser(final WebBrowser browser) throws IllegalArgumentException, IOException {\n-        ProjectManager.mutex().writeAccess(new Runnable() {\n-\n-            @Override\n-            public void run() {\n-                JavaEEProjectSettings.setBrowserID(project, browser.getId());\n-            }\n+        ProjectManager.mutex().writeAccess(() -> {\n+            JavaEEProjectSettings.setBrowserID(project, browser.getId());\n         });\n         pcs.firePropertyChange(PROP_BROWSER_ACTIVE, null, null);\n     }\n@@ -116,12 +112,9 @@ public void preferenceChange(PreferenceChangeEvent evt) {\n     }\n     \n     private Preferences getPreferences() {\n-        Preferences prefs = project.getLookup().lookup(GradleJavaEEProjectSettings.class).getPreferences();\n         if (preferences == null) {\n-            preferences = prefs;\n-        } else {\n-            assert preferences == prefs : \"Project JavaEE preferences has been changed on: \" + project.getProjectDirectory();\n+            preferences = project.getLookup().lookup(GradleJavaEEProjectSettings.class).getPreferences();\n         }\n-        return prefs;\n+        return preferences;\n     }\n }", "filename": "groovy/gradle.javaee/src/org/netbeans/modules/gradle/javaee/web/WebProjectBrowserProvider.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/eff347e09da3940ce63487cdeee7a6553089a58f", "parent": "https://github.com/apache/netbeans/commit/7337d1eab5bfe20f59ae0b7d5b547ab6033691d8", "message": "Merge pull request #1382 from akuhtz/fix-pac-npe\n\nFix NPE if PAC cannot be resolved", "bug_id": "netbeans_2", "file": [{"additions": 3, "raw_url": "https://github.com/apache/netbeans/raw/eff347e09da3940ce63487cdeee7a6553089a58f/platform/core.network/src/org/netbeans/core/network/proxy/ProxyAutoConfig.java", "blob_url": "https://github.com/apache/netbeans/blob/eff347e09da3940ce63487cdeee7a6553089a58f/platform/core.network/src/org/netbeans/core/network/proxy/ProxyAutoConfig.java", "sha": "992e9c1ab4911c94f894b78bf2669812ce1e8d4a", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/platform/core.network/src/org/netbeans/core/network/proxy/ProxyAutoConfig.java?ref=eff347e09da3940ce63487cdeee7a6553089a58f", "patch": "@@ -138,6 +138,9 @@ public void run() {\n                 }\n             }\n         }\n+        if (evaluator == null) {\n+            return Collections.singletonList(Proxy.NO_PROXY);\n+        }\n         try {\n             return evaluator.findProxyForURL(u);\n         } catch (PacValidationException ex) {", "filename": "platform/core.network/src/org/netbeans/core/network/proxy/ProxyAutoConfig.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/b3601d6958c12eda5031ffda5abe34ff00603a3e", "parent": "https://github.com/apache/netbeans/commit/18203cea4e5776d25893de172929c9b64603cab0", "message": "[NETBEANS-2980] Fix potential NPE on ImportAnalysis2.getPackage()", "bug_id": "netbeans_3", "file": [{"additions": 2, "raw_url": "https://github.com/apache/netbeans/raw/b3601d6958c12eda5031ffda5abe34ff00603a3e/java/java.source.base/src/org/netbeans/modules/java/source/pretty/ImportAnalysis2.java", "blob_url": "https://github.com/apache/netbeans/blob/b3601d6958c12eda5031ffda5abe34ff00603a3e/java/java.source.base/src/org/netbeans/modules/java/source/pretty/ImportAnalysis2.java", "sha": "e88ef5d79e27518dfbe38f8c7bbb7f04d54b151c", "changes": 4, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.source.base/src/org/netbeans/modules/java/source/pretty/ImportAnalysis2.java?ref=b3601d6958c12eda5031ffda5abe34ff00603a3e", "patch": "@@ -258,7 +258,7 @@ private void addImport(ImportTree imp) {\n \n     //Note: this method should return either \"orig\" or a IdentifierTree or MemberSelectTree\n     //no other tree type is not allowed - see ImmutableTreeTranslator.translateStable(Tree)\n-    public ExpressionTree resolveImport(MemberSelectTree orig, Element element) {\n+    public ExpressionTree resolveImport(MemberSelectTree orig, final Element element) {\n         if (visibleThroughClasses == null || element == null || cs != null && cs.useFQNs()) {\n             //may happen for package clause\n             return orig;\n@@ -390,7 +390,7 @@ private boolean checkPackagesForStarImport(String pkgName, CodeStyle cs) {\n     }\n \n     private PackageElement getPackageOf(Element el) {\n-        while (el.getKind() != ElementKind.PACKAGE) el = el.getEnclosingElement();\n+        while ((el != null) && (el.getKind() != ElementKind.PACKAGE)) el = el.getEnclosingElement();\n \n         return (PackageElement) el;\n     }", "filename": "java/java.source.base/src/org/netbeans/modules/java/source/pretty/ImportAnalysis2.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/2274b812325181e62ebffdaaa81ba1dd30510e7c", "parent": "https://github.com/apache/netbeans/commit/40b6820b7ac67ccd40e6a2836608e4be047ae388", "message": "[NETBEANS-2953] Fix for NPE after pressing 'DTDs and XML Schemas' menu entry (#1491)", "bug_id": "netbeans_4", "file": [{"additions": 2, "raw_url": "https://github.com/apache/netbeans/raw/2274b812325181e62ebffdaaa81ba1dd30510e7c/enterprise/payara.jakartaee/src/org/netbeans/modules/payara/jakartaee/layer.xml", "blob_url": "https://github.com/apache/netbeans/blob/2274b812325181e62ebffdaaa81ba1dd30510e7c/enterprise/payara.jakartaee/src/org/netbeans/modules/payara/jakartaee/layer.xml", "sha": "416a4603c320abc3a0f8ccbd79948081fb4ac3d3", "changes": 4, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/enterprise/payara.jakartaee/src/org/netbeans/modules/payara/jakartaee/layer.xml?ref=2274b812325181e62ebffdaaa81ba1dd30510e7c", "patch": "@@ -237,14 +237,14 @@\n         <folder name=\"XML\">\n             <folder name=\"UserCatalogs\">\n                 <file name=\"org-netbeans-modules-payara-jakartaee-RunTimeDDCatalog.instance\">\n-                    <attr name=\"instanceCreate\" methodvalue=\"org.netbeans.modules.payara.jakartaee.RunTimeDDCatalog.getRunTimeDDCatalog\"/>\n+                    <attr name=\"instanceCreate\" methodvalue=\"org.netbeans.modules.payara.jakartaee.RunTimeDDCatalog.getDefaultRunTimeDDCatalog\"/>\n                     <attr name=\"instanceOf\" stringvalue=\"org.netbeans.modules.xml.catalog.spi.CatalogReader\"/>\n                 </file>\n             </folder>\n             <folder name=\"GrammarQueryManagers\">\n                 <file name=\"org-netbeans-modules-payara-jakartaee-RunTimeDDCatalog.instance\">\n                     <attr name=\"position\" intvalue=\"350\"/>\n-                    <attr name=\"instanceCreate\" methodvalue=\"org.netbeans.modules.payara.jakartaee.RunTimeDDCatalog.getRunTimeDDCatalog\"/>\n+                    <attr name=\"instanceCreate\" methodvalue=\"org.netbeans.modules.payara.jakartaee.RunTimeDDCatalog.getDefaultRunTimeDDCatalog\"/>\n                 </file>\n             </folder> <!-- GrammarQueryManagers -->\n         </folder>", "filename": "enterprise/payara.jakartaee/src/org/netbeans/modules/payara/jakartaee/layer.xml"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/588a8e4e57301e5b4fb4a907301f578ff1e80ea4", "parent": "https://github.com/apache/netbeans/commit/f3279577e7b79506dd41d16268a8b3a76192c797", "message": "[NETBEANS-3023] Added null check to prevent the NPE", "bug_id": "netbeans_5", "file": [{"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/588a8e4e57301e5b4fb4a907301f578ff1e80ea4/java/java.j2seplatform/src/org/netbeans/modules/java/j2seplatform/platformdefinition/J2SEPlatformCustomizer.java", "blob_url": "https://github.com/apache/netbeans/blob/588a8e4e57301e5b4fb4a907301f578ff1e80ea4/java/java.j2seplatform/src/org/netbeans/modules/java/j2seplatform/platformdefinition/J2SEPlatformCustomizer.java", "sha": "33b4d7f44b2d01fa7d084d084e782256a2f8e7ef", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.j2seplatform/src/org/netbeans/modules/java/j2seplatform/platformdefinition/J2SEPlatformCustomizer.java?ref=588a8e4e57301e5b4fb4a907301f578ff1e80ea4", "patch": "@@ -797,7 +797,7 @@ public Component getListCellRendererComponent(JList<?> list, Object value, int i\n             if (\"jar\".equals(url.getProtocol())) {      //NOI18N\n                 iconKind = IconKind.ARCHVIVE;\n                 URL fileURL = FileUtil.getArchiveFile (url);\n-                if (FileUtil.getArchiveRoot(fileURL).equals(url)) {\n+                if ((fileURL != null) && FileUtil.getArchiveRoot(fileURL).equals(url)) {\n                     // really the root\n                     url = fileURL;\n                 } else {", "filename": "java/java.j2seplatform/src/org/netbeans/modules/java/j2seplatform/platformdefinition/J2SEPlatformCustomizer.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/cf1bd51421d6cccdeb8bce079eb59544c0c4da25", "parent": "https://github.com/apache/netbeans/commit/28e2d100cb33401940421bddd8ed9d0543bc101b", "message": "Popupswitcher npe fixes (#1219)\n\n* Fix two rare but annoying NPEs from popup switcher\r\n* Update spec version", "bug_id": "netbeans_6", "file": [{"additions": 3, "raw_url": "https://github.com/apache/netbeans/raw/cf1bd51421d6cccdeb8bce079eb59544c0c4da25/platform/o.n.swing.tabcontrol/src/org/netbeans/swing/tabcontrol/ButtonPopupSwitcher.java", "blob_url": "https://github.com/apache/netbeans/blob/cf1bd51421d6cccdeb8bce079eb59544c0c4da25/platform/o.n.swing.tabcontrol/src/org/netbeans/swing/tabcontrol/ButtonPopupSwitcher.java", "sha": "c357cab6e52cbcff4a5046ccd01af14f01f247f8", "changes": 4, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/platform/o.n.swing.tabcontrol/src/org/netbeans/swing/tabcontrol/ButtonPopupSwitcher.java?ref=cf1bd51421d6cccdeb8bce079eb59544c0c4da25", "patch": "@@ -186,7 +186,9 @@ public void run() {\n     @Override\n     public void valueChanged( ListSelectionEvent e ) {\n         SwitcherTableItem item = pTable.getSelectedItem();\n-        StatusDisplayer.getDefault().setStatusText( null == item ? null : item.getDescription() );\n+        if (item != null) {\n+            StatusDisplayer.getDefault().setStatusText( item.getDescription() );\n+        }\n     }\n     \n     @Override", "filename": "platform/o.n.swing.tabcontrol/src/org/netbeans/swing/tabcontrol/ButtonPopupSwitcher.java"}, {"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/cf1bd51421d6cccdeb8bce079eb59544c0c4da25/platform/o.n.swing.tabcontrol/src/org/netbeans/swing/tabcontrol/DocumentSwitcherTable.java", "blob_url": "https://github.com/apache/netbeans/blob/cf1bd51421d6cccdeb8bce079eb59544c0c4da25/platform/o.n.swing.tabcontrol/src/org/netbeans/swing/tabcontrol/DocumentSwitcherTable.java", "sha": "528961b5cfb4132c9cb23dfca5d4576956c8d612", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/platform/o.n.swing.tabcontrol/src/org/netbeans/swing/tabcontrol/DocumentSwitcherTable.java?ref=cf1bd51421d6cccdeb8bce079eb59544c0c4da25", "patch": "@@ -163,7 +163,7 @@ public TabData getTabData() {\n     }\n \n     boolean isClosable( Item item ) {\n-        if( !SHOW_CLOSE_BUTTON )\n+        if( !SHOW_CLOSE_BUTTON || item == null)\n             return false;\n \n         WinsysInfoForTabbedContainer winsysInfo = displayer.getContainerWinsysInfo();", "filename": "platform/o.n.swing.tabcontrol/src/org/netbeans/swing/tabcontrol/DocumentSwitcherTable.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/3c8e4f4be88bd054649efc1f5d179a001d6cff61", "parent": "https://github.com/apache/netbeans/commit/ac510a00be35b5c04054a14b9394f5419c3ca7c4", "message": "Merge pull request #1211 from vikasprabhakar/NPE_Switch_expression\n\n[NETBEANS-2350]NPE while doing auto complete in rule switch block", "bug_id": "netbeans_7", "file": [{"additions": 8, "raw_url": "https://github.com/apache/netbeans/raw/3c8e4f4be88bd054649efc1f5d179a001d6cff61/java/java.completion/src/org/netbeans/modules/java/completion/JavaCompletionTask.java", "blob_url": "https://github.com/apache/netbeans/blob/3c8e4f4be88bd054649efc1f5d179a001d6cff61/java/java.completion/src/org/netbeans/modules/java/completion/JavaCompletionTask.java", "sha": "fb901e34081c0e46274b4131e818aa8afc8d6d57", "changes": 9, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.completion/src/org/netbeans/modules/java/completion/JavaCompletionTask.java?ref=3c8e4f4be88bd054649efc1f5d179a001d6cff61", "patch": "@@ -2293,7 +2293,14 @@ private void insideSwitch(Env env) throws IOException {\n             }\n             if (lastCase != null) {\n                 StatementTree last = null;\n-                for (StatementTree stat : lastCase.getStatements()) {\n+                List<? extends StatementTree> statements = lastCase.getStatements();\n+                if (statements == null) {\n+                    Tree caseBody = TreeShims.getBody(lastCase);\n+                    if (caseBody instanceof StatementTree) {\n+                        statements = Collections.singletonList((StatementTree) caseBody);\n+                    }\n+                }\n+                for (StatementTree stat : statements) {\n                     int pos = (int) sourcePositions.getStartPosition(root, stat);\n                     if (pos == Diagnostic.NOPOS || offset <= pos) {\n                         break;", "filename": "java/java.completion/src/org/netbeans/modules/java/completion/JavaCompletionTask.java"}, {"additions": 2, "raw_url": "https://github.com/apache/netbeans/raw/3c8e4f4be88bd054649efc1f5d179a001d6cff61/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/1.7/ruleSwitchAutoCompleteCaseValues.pass", "blob_url": "https://github.com/apache/netbeans/blob/3c8e4f4be88bd054649efc1f5d179a001d6cff61/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/1.7/ruleSwitchAutoCompleteCaseValues.pass", "sha": "9ce5b1998d5fc3ef3e8d3e62ec1d022ec49995f6", "changes": 2, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/1.7/ruleSwitchAutoCompleteCaseValues.pass?ref=3c8e4f4be88bd054649efc1f5d179a001d6cff61", "patch": "@@ -0,0 +1,2 @@\n+case\n+", "filename": "java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/1.7/ruleSwitchAutoCompleteCaseValues.pass"}, {"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/3c8e4f4be88bd054649efc1f5d179a001d6cff61/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/1.8/ruleSwitchAutoCompleteCaseValues.pass", "blob_url": "https://github.com/apache/netbeans/blob/3c8e4f4be88bd054649efc1f5d179a001d6cff61/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/1.8/ruleSwitchAutoCompleteCaseValues.pass", "sha": "9a333834d7f76d26bf24f07f0d8ab00010e78b91", "changes": 1, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/1.8/ruleSwitchAutoCompleteCaseValues.pass?ref=3c8e4f4be88bd054649efc1f5d179a001d6cff61", "patch": "@@ -0,0 +1 @@\n+case", "filename": "java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/1.8/ruleSwitchAutoCompleteCaseValues.pass"}, {"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/3c8e4f4be88bd054649efc1f5d179a001d6cff61/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/10/ruleSwitchAutoCompleteCaseValues.pass", "blob_url": "https://github.com/apache/netbeans/blob/3c8e4f4be88bd054649efc1f5d179a001d6cff61/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/10/ruleSwitchAutoCompleteCaseValues.pass", "sha": "9a333834d7f76d26bf24f07f0d8ab00010e78b91", "changes": 1, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/10/ruleSwitchAutoCompleteCaseValues.pass?ref=3c8e4f4be88bd054649efc1f5d179a001d6cff61", "patch": "@@ -0,0 +1 @@\n+case", "filename": "java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/10/ruleSwitchAutoCompleteCaseValues.pass"}, {"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/3c8e4f4be88bd054649efc1f5d179a001d6cff61/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/11/ruleSwitchAutoCompleteCaseValues.pass", "blob_url": "https://github.com/apache/netbeans/blob/3c8e4f4be88bd054649efc1f5d179a001d6cff61/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/11/ruleSwitchAutoCompleteCaseValues.pass", "sha": "9a333834d7f76d26bf24f07f0d8ab00010e78b91", "changes": 1, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/11/ruleSwitchAutoCompleteCaseValues.pass?ref=3c8e4f4be88bd054649efc1f5d179a001d6cff61", "patch": "@@ -0,0 +1 @@\n+case", "filename": "java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/11/ruleSwitchAutoCompleteCaseValues.pass"}, {"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/3c8e4f4be88bd054649efc1f5d179a001d6cff61/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/12/ruleSwitchAutoCompleteCaseValues.pass", "blob_url": "https://github.com/apache/netbeans/blob/3c8e4f4be88bd054649efc1f5d179a001d6cff61/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/12/ruleSwitchAutoCompleteCaseValues.pass", "sha": "9a333834d7f76d26bf24f07f0d8ab00010e78b91", "changes": 1, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/12/ruleSwitchAutoCompleteCaseValues.pass?ref=3c8e4f4be88bd054649efc1f5d179a001d6cff61", "patch": "@@ -0,0 +1 @@\n+case", "filename": "java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/12/ruleSwitchAutoCompleteCaseValues.pass"}, {"additions": 33, "raw_url": "https://github.com/apache/netbeans/raw/3c8e4f4be88bd054649efc1f5d179a001d6cff61/java/java.completion/test/unit/data/org/netbeans/modules/java/completion/data/RuleSwitchAutoCompleteCaseValue.java", "blob_url": "https://github.com/apache/netbeans/blob/3c8e4f4be88bd054649efc1f5d179a001d6cff61/java/java.completion/test/unit/data/org/netbeans/modules/java/completion/data/RuleSwitchAutoCompleteCaseValue.java", "sha": "8a5c95d9b2d5917b9452a8299f7109d755f26022", "changes": 33, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.completion/test/unit/data/org/netbeans/modules/java/completion/data/RuleSwitchAutoCompleteCaseValue.java?ref=3c8e4f4be88bd054649efc1f5d179a001d6cff61", "patch": "@@ -0,0 +1,33 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package test;\n+\n+public class Test {\n+\n+    enum colors {RED, GREEN, BLUE}\n+\n+    public void op(int a) {\n+        colors color = colors.RED;\n+        switch (color) {\n+            case RED -> a = 10;\n+                \n+\t}\n+    }\n+}", "filename": "java/java.completion/test/unit/data/org/netbeans/modules/java/completion/data/RuleSwitchAutoCompleteCaseValue.java"}, {"additions": 4, "raw_url": "https://github.com/apache/netbeans/raw/3c8e4f4be88bd054649efc1f5d179a001d6cff61/java/java.completion/test/unit/src/org/netbeans/modules/java/completion/JavaCompletionTask112FeaturesTest.java", "blob_url": "https://github.com/apache/netbeans/blob/3c8e4f4be88bd054649efc1f5d179a001d6cff61/java/java.completion/test/unit/src/org/netbeans/modules/java/completion/JavaCompletionTask112FeaturesTest.java", "sha": "242a2bc7072ad19e37ed40f4ccbf5183b9551472", "changes": 4, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.completion/test/unit/src/org/netbeans/modules/java/completion/JavaCompletionTask112FeaturesTest.java?ref=3c8e4f4be88bd054649efc1f5d179a001d6cff61", "patch": "@@ -73,6 +73,10 @@ public void testRuleSwitchMultiEnumCaseValue() throws Exception {\n         performTest(\"RuleSwitchWithMultiEnumValues\", 1024, null, \"ruleSwitchEnumCaseValues.pass\");\n     }\n \n+    public void testRuleSwitchAutoCompleteCaseValue() throws Exception {\n+        performTest(\"RuleSwitchAutoCompleteCaseValue\", 1013, \"ca\", \"ruleSwitchAutoCompleteCaseValues.pass\");\n+    }\n+\n     public void noop() {\n     }\n ", "filename": "java/java.completion/test/unit/src/org/netbeans/modules/java/completion/JavaCompletionTask112FeaturesTest.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/40b6820b7ac67ccd40e6a2836608e4be047ae388", "parent": "https://github.com/apache/netbeans/commit/f5c28b0dc8b6ae662ebe7af455af787759ddc19a", "message": "[NETBEANS-3078]:Provided Error Hint to turn on Preview Features in An\u2026 (#1487)\n\n* [NETBEANS-3078]:Provided Error Hint to turn on Preview Features in Ant Java projects\r\n\r\n* [NETBEANS-3078]:Fix for NPE on opening single source file", "bug_id": "netbeans_8", "file": [{"additions": 26, "raw_url": "https://github.com/apache/netbeans/raw/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/ant.hints/build.xml", "blob_url": "https://github.com/apache/netbeans/blob/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/ant.hints/build.xml", "sha": "cea076486d61235bb72f27f91e495c620285b409", "changes": 26, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/ant.hints/build.xml?ref=40b6820b7ac67ccd40e6a2836608e4be047ae388", "patch": "@@ -0,0 +1,26 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+\n+-->\n+\n+<project basedir=\".\" default=\"build\" name=\"java/ant.hints\">\n+    <description>Builds, tests, and runs the project org.netbeans.modules.ant.hints</description>\n+    <import file=\"../../nbbuild/templates/projectized.xml\"/>\n+</project>", "filename": "java/ant.hints/build.xml"}, {"additions": 6, "raw_url": "https://github.com/apache/netbeans/raw/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/ant.hints/manifest.mf", "blob_url": "https://github.com/apache/netbeans/blob/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/ant.hints/manifest.mf", "sha": "09e0a7e8bade4b4b83a24b73d627c5fd9fe9be0a", "changes": 6, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/ant.hints/manifest.mf?ref=40b6820b7ac67ccd40e6a2836608e4be047ae388", "patch": "@@ -0,0 +1,6 @@\n+Manifest-Version: 1.0\n+OpenIDE-Module: org.netbeans.modules.ant.hints/1\n+OpenIDE-Module-Specification-Version: 1.0\n+OpenIDE-Module-Localizing-Bundle: org/netbeans/modules/ant/hints/Bundle.properties\n+OpenIDE-Module-Layer: org/netbeans/modules/ant/hints/layer.xml\n+AutoUpdate-Show-In-Client: false", "filename": "java/ant.hints/manifest.mf"}, {"additions": 19, "raw_url": "https://github.com/apache/netbeans/raw/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/ant.hints/nbproject/project.properties", "blob_url": "https://github.com/apache/netbeans/blob/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/ant.hints/nbproject/project.properties", "sha": "2fe9adf290437cbded30a54f7ee4f30edc36cf09", "changes": 19, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/ant.hints/nbproject/project.properties?ref=40b6820b7ac67ccd40e6a2836608e4be047ae388", "patch": "@@ -0,0 +1,19 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+is.eager=true\n+javac.source=1.8", "filename": "java/ant.hints/nbproject/project.properties"}, {"additions": 143, "raw_url": "https://github.com/apache/netbeans/raw/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/ant.hints/nbproject/project.xml", "blob_url": "https://github.com/apache/netbeans/blob/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/ant.hints/nbproject/project.xml", "sha": "7da0176faf0a03c84880c224d961036c45a9094c", "changes": 143, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/ant.hints/nbproject/project.xml?ref=40b6820b7ac67ccd40e6a2836608e4be047ae388", "patch": "@@ -0,0 +1,143 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+\n+-->\n+<project xmlns=\"http://www.netbeans.org/ns/project/1\">\n+    <type>org.netbeans.modules.apisupport.project</type>\n+    <configuration>\n+        <data xmlns=\"http://www.netbeans.org/ns/nb-module-project/3\">\n+            <code-name-base>org.netbeans.modules.ant.hints</code-name-base>\n+            <module-dependencies>\n+                <dependency>\n+                    <code-name-base>org.netbeans.api.annotations.common</code-name-base>\n+                    <build-prerequisite/>\n+                    <compile-dependency/>\n+                    <run-dependency>\n+                        <release-version>1</release-version>\n+                        <specification-version>1.33</specification-version>\n+                    </run-dependency>\n+                </dependency>\n+                <dependency>\n+                    <code-name-base>org.netbeans.libs.javacapi</code-name-base>\n+                    <build-prerequisite/>\n+                    <compile-dependency/>\n+                    <run-dependency>\n+                        <specification-version>8.27</specification-version>\n+                    </run-dependency>\n+                </dependency>\n+                <dependency>\n+                    <code-name-base>org.netbeans.modules.editor.mimelookup</code-name-base>\n+                    <build-prerequisite/>\n+                    <compile-dependency/>\n+                    <run-dependency>\n+                        <release-version>1</release-version>\n+                        <specification-version>1.20</specification-version>\n+                    </run-dependency>\n+                </dependency>\n+                <dependency>\n+                    <code-name-base>org.netbeans.modules.java.hints.legacy.spi</code-name-base>\n+                    <build-prerequisite/>\n+                    <compile-dependency/>\n+                    <run-dependency>\n+                        <release-version>1</release-version>\n+                        <specification-version>1.0</specification-version>\n+                    </run-dependency>\n+                </dependency>\n+                <dependency>\n+                    <code-name-base>org.netbeans.modules.java.source.base</code-name-base>\n+                    <build-prerequisite/>\n+                    <compile-dependency/>\n+                    <run-dependency>\n+                        <specification-version>1.0</specification-version>\n+                    </run-dependency>\n+                </dependency>\n+                <dependency>\n+                    <code-name-base>org.netbeans.modules.project.ant</code-name-base>\n+                    <build-prerequisite/>\n+                    <compile-dependency/>\n+                    <run-dependency>\n+                        <release-version>1</release-version>\n+                        <specification-version>1.73</specification-version>\n+                    </run-dependency>\n+                </dependency>\n+                <dependency>\n+                    <code-name-base>org.netbeans.modules.projectapi</code-name-base>\n+                    <build-prerequisite/>\n+                    <compile-dependency/>\n+                    <run-dependency>\n+                        <release-version>1</release-version>\n+                        <specification-version>1.73</specification-version>\n+                    </run-dependency>\n+                </dependency>\n+                <dependency>\n+                    <code-name-base>org.netbeans.spi.editor.hints</code-name-base>\n+                    <build-prerequisite/>\n+                    <compile-dependency/>\n+                    <run-dependency>\n+                        <release-version>0</release-version>\n+                        <specification-version>1.48</specification-version>\n+                    </run-dependency>\n+                </dependency>\n+                <dependency>\n+                    <code-name-base>org.openide.filesystems</code-name-base>\n+                    <build-prerequisite/>\n+                    <compile-dependency/>\n+                    <run-dependency>\n+                        <specification-version>9.0</specification-version>\n+                    </run-dependency>\n+                </dependency>\n+                <dependency>\n+                    <code-name-base>org.openide.modules</code-name-base>\n+                    <build-prerequisite/>\n+                    <compile-dependency/>\n+                    <run-dependency>\n+                        <specification-version>7.7</specification-version>\n+                    </run-dependency>\n+                </dependency>\n+                <dependency>\n+                    <code-name-base>org.openide.util</code-name-base>\n+                    <build-prerequisite/>\n+                    <compile-dependency/>\n+                    <run-dependency>\n+                        <specification-version>9.13</specification-version>\n+                    </run-dependency>\n+                </dependency>\n+                <dependency>\n+                    <code-name-base>org.openide.util.lookup</code-name-base>\n+                    <build-prerequisite/>\n+                    <compile-dependency/>\n+                    <run-dependency>\n+                        <specification-version>8.0</specification-version>\n+                    </run-dependency>\n+                </dependency>\n+                <dependency>\n+                    <code-name-base>org.openide.util.ui</code-name-base>\n+                    <build-prerequisite/>\n+                    <compile-dependency/>\n+                    <run-dependency>\n+                        <specification-version>9.3</specification-version>\n+                    </run-dependency>\n+                </dependency>\n+            </module-dependencies>\n+            <test-dependencies/>\n+            <public-packages/>\n+        </data>\n+    </configuration>\n+</project>", "filename": "java/ant.hints/nbproject/project.xml"}, {"additions": 21, "raw_url": "https://github.com/apache/netbeans/raw/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/ant.hints/src/org/netbeans/modules/ant/hints/Bundle.properties", "blob_url": "https://github.com/apache/netbeans/blob/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/ant.hints/src/org/netbeans/modules/ant/hints/Bundle.properties", "sha": "26cf804fbbaed6384f1f0a209adce0a7e6c26673", "changes": 21, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/ant.hints/src/org/netbeans/modules/ant/hints/Bundle.properties?ref=40b6820b7ac67ccd40e6a2836608e4be047ae388", "patch": "@@ -0,0 +1,21 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+OpenIDE-Module-Display-Category=Ant\n+OpenIDE-Module-Name=Ant Hints\n+OpenIDE-Module-Long-Description=Providing Ant Hints set for common mistakes and best practices\n+org-netbeans-modules-java-hints/rules/hints/ant=Ant", "filename": "java/ant.hints/src/org/netbeans/modules/ant/hints/Bundle.properties"}, {"additions": 18, "raw_url": "https://github.com/apache/netbeans/raw/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/ant.hints/src/org/netbeans/modules/ant/hints/errors/Bundle.properties", "blob_url": "https://github.com/apache/netbeans/blob/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/ant.hints/src/org/netbeans/modules/ant/hints/errors/Bundle.properties", "sha": "c30ea1d755ea45b9b84cc4ee168fbc55c332e3cb", "changes": 18, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/ant.hints/src/org/netbeans/modules/ant/hints/errors/Bundle.properties?ref=40b6820b7ac67ccd40e6a2836608e4be047ae388", "patch": "@@ -0,0 +1,18 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+FIX_EnablePreviewFeature=Enable Preview Feature", "filename": "java/ant.hints/src/org/netbeans/modules/ant/hints/errors/Bundle.properties"}, {"additions": 219, "raw_url": "https://github.com/apache/netbeans/raw/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/ant.hints/src/org/netbeans/modules/ant/hints/errors/EnablePreviewAntProj.java", "blob_url": "https://github.com/apache/netbeans/blob/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/ant.hints/src/org/netbeans/modules/ant/hints/errors/EnablePreviewAntProj.java", "sha": "c884782c725cc4f376270b9bea44b44d98cbb38d", "changes": 219, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/ant.hints/src/org/netbeans/modules/ant/hints/errors/EnablePreviewAntProj.java?ref=40b6820b7ac67ccd40e6a2836608e4be047ae388", "patch": "@@ -0,0 +1,219 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.netbeans.modules.ant.hints.errors;\n+\n+import com.sun.source.util.TreePath;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.OutputStream;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+import javax.lang.model.SourceVersion;\n+import org.netbeans.api.annotations.common.NonNull;\n+import org.netbeans.api.java.source.CompilationInfo;\n+import org.netbeans.api.project.FileOwnerQuery;\n+import org.netbeans.modules.java.hints.spi.ErrorRule;\n+import org.netbeans.spi.editor.hints.ChangeInfo;\n+import org.netbeans.spi.editor.hints.Fix;\n+import org.openide.filesystems.FileObject;\n+import org.openide.util.NbBundle;\n+import org.openide.util.Parameters;\n+import org.netbeans.api.project.Project;\n+import org.netbeans.api.project.ProjectManager;\n+import org.netbeans.spi.project.support.ant.AntProjectHelper;\n+import org.openide.util.EditableProperties;\n+import org.openide.util.Mutex;\n+import org.openide.util.MutexException;\n+\n+/**\n+ * Handle error rule \"compiler.err.preview.feature.disabled.plural\" and provide\n+ * the fix for Ant type project.\n+ *\n+ * @author arusinha\n+ */\n+public class EnablePreviewAntProj implements ErrorRule<Void> {\n+\n+    private static final Set<String> ERROR_CODES = new HashSet<String>(Arrays.asList(\n+            \"compiler.err.preview.feature.disabled.plural\")); // NOI18N\n+    private static final String ENABLE_PREVIEW_FLAG = \"--enable-preview\";   // NOI18N\n+    private static final String JAVAC_COMPILER_ARGS = \"javac.compilerargs\"; // NOI18N\n+    private static final String RUN_JVMARGS = \"run.jvmargs\"; // NOI18N\n+\n+    @Override\n+    public Set<String> getCodes() {\n+        return Collections.unmodifiableSet(ERROR_CODES);\n+    }\n+\n+    @Override\n+    @NonNull\n+    public List<Fix> run(CompilationInfo compilationInfo, String diagnosticKey, int offset, TreePath treePath, Data<Void> data) {\n+\n+        if (SourceVersion.latest() != compilationInfo.getSourceVersion()) {\n+            return Collections.<Fix>emptyList();\n+        }\n+\n+        final FileObject file = compilationInfo.getFileObject();\n+        Fix fix = null;\n+        if (file != null) {\n+            final Project prj = FileOwnerQuery.getOwner(file);\n+\n+            if (isAntProject(prj)) {\n+                fix = new EnablePreviewAntProj.ResolveAntFix(prj);\n+            } else {\n+                fix = null;\n+            }\n+        }\n+        return (fix != null) ? Collections.<Fix>singletonList(fix) : Collections.<Fix>emptyList();\n+    }\n+\n+    @Override\n+    public String getId() {\n+        return EnablePreviewAntProj.class.getName();\n+    }\n+\n+    @Override\n+    public String getDisplayName() {\n+        return NbBundle.getMessage(EnablePreviewAntProj.class, \"FIX_EnablePreviewFeature\"); // NOI18N\n+    }\n+\n+    public String getDescription() {\n+        return NbBundle.getMessage(EnablePreviewAntProj.class, \"FIX_EnablePreviewFeature\"); // NOI18N\n+    }\n+\n+    @Override\n+    public void cancel() {\n+    }\n+\n+    private static final class ResolveAntFix implements Fix {\n+\n+        private final Project prj;\n+\n+        ResolveAntFix(@NonNull final Project prj) {\n+            Parameters.notNull(\"prj\", prj); //NOI18N\n+            this.prj = prj;\n+        }\n+\n+        @Override\n+        public String getText() {\n+            return NbBundle.getMessage(EnablePreviewAntProj.class, \"FIX_EnablePreviewFeature\");  // NOI18N\n+        }\n+\n+        @Override\n+        public ChangeInfo implement() throws Exception {\n+\n+            EditableProperties ep = getEditableProperties(prj, AntProjectHelper.PROJECT_PROPERTIES_PATH);\n+\n+            String compilerArgs = ep.getProperty(JAVAC_COMPILER_ARGS);\n+            compilerArgs = compilerArgs != null ? compilerArgs + \" \" + ENABLE_PREVIEW_FLAG : ENABLE_PREVIEW_FLAG;\n+\n+            String runJVMArgs = ep.getProperty(RUN_JVMARGS);\n+            if (!runJVMArgs.contains(ENABLE_PREVIEW_FLAG)) {\n+                runJVMArgs = runJVMArgs != null ? runJVMArgs + \" \" + ENABLE_PREVIEW_FLAG : ENABLE_PREVIEW_FLAG;\n+            }\n+\n+            ep.setProperty(JAVAC_COMPILER_ARGS, compilerArgs);\n+            ep.setProperty(RUN_JVMARGS, runJVMArgs);\n+            storeEditableProperties(prj, AntProjectHelper.PROJECT_PROPERTIES_PATH, ep);\n+            return null;\n+        }\n+\n+    }\n+\n+    private static void storeEditableProperties(final Project prj, final String propertiesPath, final EditableProperties ep)\n+            throws IOException {\n+        try {\n+            ProjectManager.mutex().writeAccess(new Mutex.ExceptionAction<Void>() {\n+                @Override\n+                public Void run() throws IOException {\n+                    FileObject propertiesFo = prj.getProjectDirectory().getFileObject(propertiesPath);\n+                    if (propertiesFo != null) {\n+                        OutputStream os = null;\n+                        try {\n+                            os = propertiesFo.getOutputStream();\n+                            ep.store(os);\n+                        } finally {\n+                            if (os != null) {\n+                                os.close();\n+                            }\n+                        }\n+                    }\n+                    return null;\n+                }\n+            });\n+        } catch (MutexException ex) {\n+        }\n+    }\n+\n+    private static EditableProperties getEditableProperties(final Project prj, final String propertiesPath)\n+            throws IOException {\n+        try {\n+            return ProjectManager.mutex().readAccess(new Mutex.ExceptionAction<EditableProperties>() {\n+                @Override\n+                public EditableProperties run() throws IOException {\n+                    FileObject propertiesFo = prj.getProjectDirectory().getFileObject(propertiesPath);\n+                    EditableProperties ep = null;\n+                    if (propertiesFo != null) {\n+                        InputStream is = null;\n+                        ep = new EditableProperties(false);\n+                        try {\n+                            is = propertiesFo.getInputStream();\n+                            ep.load(is);\n+                        } finally {\n+                            if (is != null) {\n+                                is.close();\n+                            }\n+                        }\n+                    }\n+                    return ep;\n+                }\n+            });\n+        } catch (MutexException ex) {\n+            return null;\n+        }\n+    }\n+\n+    private boolean isAntProject(Project prj) {\n+        if (prj == null) {\n+            return false;\n+        }\n+        FileObject prjDir = prj.getProjectDirectory();\n+        if (prjDir == null) {\n+            return false;\n+        }\n+        List<FileObject> antProjectFiles = new ArrayList();\n+        antProjectFiles.add(prjDir.getFileObject(\"build.xml\"));   // NOI18N\n+        antProjectFiles.add(prjDir.getFileObject(\"nbproject/project.properties\"));   // NOI18N\n+        antProjectFiles.add(prjDir.getFileObject(\"nbproject/project.xml\"));   // NOI18N\n+        boolean isAntProject = true;\n+        for (FileObject file : antProjectFiles) {\n+            if (!(file != null && file.isValid())) {\n+                isAntProject = false;\n+                break;\n+            }\n+        }\n+\n+        return isAntProject;\n+\n+    }\n+\n+}", "filename": "java/ant.hints/src/org/netbeans/modules/ant/hints/errors/EnablePreviewAntProj.java"}, {"additions": 32, "raw_url": "https://github.com/apache/netbeans/raw/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/ant.hints/src/org/netbeans/modules/ant/hints/layer.xml", "blob_url": "https://github.com/apache/netbeans/blob/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/ant.hints/src/org/netbeans/modules/ant/hints/layer.xml", "sha": "5e050e8bfffefcddd9939a629f81faa6b9d958e4", "changes": 32, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/ant.hints/src/org/netbeans/modules/ant/hints/layer.xml?ref=40b6820b7ac67ccd40e6a2836608e4be047ae388", "patch": "@@ -0,0 +1,32 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+\n+-->\n+<!DOCTYPE filesystem PUBLIC \"-//NetBeans//DTD Filesystem 1.1//EN\" \"http://www.netbeans.org/dtds/filesystem-1_1.dtd\">\n+<filesystem>\n+    <folder name=\"org-netbeans-modules-java-hints\">\n+        <folder name=\"rules\">\n+            <folder name=\"errors\">\n+                <file name=\"org-netbeans-modules-ant-hints-errors-EnablePreviewAntProj.instance\"/>\n+            </folder>\n+        </folder>\n+    </folder>\n+\n+</filesystem>", "filename": "java/ant.hints/src/org/netbeans/modules/ant/hints/layer.xml"}, {"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/java.hints.legacy.spi/nbproject/project.xml", "blob_url": "https://github.com/apache/netbeans/blob/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/java.hints.legacy.spi/nbproject/project.xml", "sha": "33301bdba1da64d238be70e50805ff3b9b68b3b7", "changes": 1, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.hints.legacy.spi/nbproject/project.xml?ref=40b6820b7ac67ccd40e6a2836608e4be047ae388", "patch": "@@ -126,6 +126,7 @@\n             </module-dependencies>\n             <friend-packages>\n                 <friend>org.netbeans.modules.apisupport.ant</friend>\n+                <friend>org.netbeans.modules.ant.hints</friend>\n                 <friend>org.netbeans.modules.javadoc</friend>\n                 <friend>org.netbeans.modules.javahints</friend>\n                 <friend>org.netbeans.modules.maven.hints</friend>", "filename": "java/java.hints.legacy.spi/nbproject/project.xml"}, {"additions": 8, "raw_url": "https://github.com/apache/netbeans/raw/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/maven.hints/src/org/netbeans/modules/maven/hints/errors/EnablePreviewMavenProj.java", "blob_url": "https://github.com/apache/netbeans/blob/40b6820b7ac67ccd40e6a2836608e4be047ae388/java/maven.hints/src/org/netbeans/modules/maven/hints/errors/EnablePreviewMavenProj.java", "sha": "08b39165ac56d79676797d5c7a29b26165c2869e", "changes": 9, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/maven.hints/src/org/netbeans/modules/maven/hints/errors/EnablePreviewMavenProj.java?ref=40b6820b7ac67ccd40e6a2836608e4be047ae388", "patch": "@@ -166,8 +166,15 @@ public void run() throws IOException {\n     }\n \n     private boolean isMavenProject(Project prj) {\n+        if (prj == null) {\n+            return false;\n+        }\n+        FileObject prjDir = prj.getProjectDirectory();\n+        if (prjDir == null) {\n+            return false;\n+        }\n \n-        FileObject pom = prj.getProjectDirectory().getFileObject(\"pom.xml\");\n+        FileObject pom = prjDir.getFileObject(\"pom.xml\");\n         return (pom != null) && pom.isValid();\n \n     }", "filename": "java/maven.hints/src/org/netbeans/modules/maven/hints/errors/EnablePreviewMavenProj.java"}, {"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/40b6820b7ac67ccd40e6a2836608e4be047ae388/nbbuild/cluster.properties", "blob_url": "https://github.com/apache/netbeans/blob/40b6820b7ac67ccd40e6a2836608e4be047ae388/nbbuild/cluster.properties", "sha": "5eb4cbe022f013d1a3b8d9aff67951967b74552b", "changes": 1, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/nbbuild/cluster.properties?ref=40b6820b7ac67ccd40e6a2836608e4be047ae388", "patch": "@@ -565,6 +565,7 @@ nb.cluster.java=\\\n         ant.debugger,\\\n         ant.freeform,\\\n         ant.grammar,\\\n+        ant.hints,\\\n         ant.kit,\\\n         api.debugger.jpda,\\\n         api.java,\\", "filename": "nbbuild/cluster.properties"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/d39ec0dc8658bb332c3a315b66a3b8b0df03aca5", "parent": "https://github.com/apache/netbeans/commit/9bb7769200b89e46ccd1a3c9cf93712449d82bdf", "message": "Merge pull request #1340 from lkishalmi/NETBEANS-2753\n\n[NETBEANS-2753] Fixed NPE on Java Stacktrace processing.", "bug_id": "netbeans_9", "file": [{"additions": 19, "raw_url": "https://github.com/apache/netbeans/raw/d39ec0dc8658bb332c3a315b66a3b8b0df03aca5/groovy/gradle.java/nbproject/project.xml", "blob_url": "https://github.com/apache/netbeans/blob/d39ec0dc8658bb332c3a315b66a3b8b0df03aca5/groovy/gradle.java/nbproject/project.xml", "sha": "b2c293fb04873e1f12f6f798723c10222624920e", "changes": 19, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle.java/nbproject/project.xml?ref=d39ec0dc8658bb332c3a315b66a3b8b0df03aca5", "patch": "@@ -305,6 +305,25 @@\n                     </run-dependency>\n                 </dependency>\n             </module-dependencies>\n+            <test-dependencies>\n+                <test-type>\n+                    <name>unit</name>\n+                    <test-dependency>\n+                        <code-name-base>org.netbeans.libs.junit4</code-name-base>\n+                        <compile-dependency/>\n+                    </test-dependency>\n+                    <test-dependency>\n+                        <code-name-base>org.netbeans.modules.nbjunit</code-name-base>\n+                        <recursive/>\n+                        <compile-dependency/>\n+                    </test-dependency>\n+                    <test-dependency>\n+                        <code-name-base>org.netbeans.modules.gradle</code-name-base>\n+                        <compile-dependency/>\n+                        <test/>\n+                    </test-dependency>\n+                </test-type>\n+            </test-dependencies>\n             <public-packages>\n                 <package>org.netbeans.modules.gradle.java.api</package>\n                 <package>org.netbeans.modules.gradle.java.api.output</package>", "filename": "groovy/gradle.java/nbproject/project.xml"}, {"additions": 10, "raw_url": "https://github.com/apache/netbeans/raw/d39ec0dc8658bb332c3a315b66a3b8b0df03aca5/groovy/gradle.java/src/org/netbeans/modules/gradle/java/output/JavaCompilerProcessorFactory.java", "blob_url": "https://github.com/apache/netbeans/blob/d39ec0dc8658bb332c3a315b66a3b8b0df03aca5/groovy/gradle.java/src/org/netbeans/modules/gradle/java/output/JavaCompilerProcessorFactory.java", "sha": "0b9d64792dcc815bf87548e023a4a30cd06939e5", "changes": 14, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle.java/src/org/netbeans/modules/gradle/java/output/JavaCompilerProcessorFactory.java?ref=d39ec0dc8658bb332c3a315b66a3b8b0df03aca5", "patch": "@@ -48,20 +48,26 @@\n  * @author Laszlo Kishalmi\n  */\n @ProjectServiceProvider(service = OutputProcessorFactory.class, projectType = NbGradleProject.GRADLE_PLUGIN_TYPE + \"/java-base\")\n-public class JavaCompilerProcessorFactory implements OutputProcessorFactory {\n+public final class JavaCompilerProcessorFactory implements OutputProcessorFactory {\n \n     @Override\n     public Set<? extends OutputProcessor> createOutputProcessors(RunConfig cfg) {\n         return new HashSet<>(Arrays.asList(new StackTraceProcessor(cfg)));\n     }\n \n-    private static class StackTraceProcessor implements OutputProcessor {\n+    static class StackTraceProcessor implements OutputProcessor {\n \n         private static final Pattern STACKTRACE_PATTERN = Pattern.compile(\"(.*)at ((\\\\w[\\\\w\\\\.]*)/)?(\\\\w[\\\\w\\\\.\\\\$<>]*)\\\\((\\\\w+)\\\\.java\\\\:([0-9]+)\\\\)(.*)\");\n         private static final IOColors.OutputType OUT_TYPE = IOColors.OutputType.ERROR;\n         private final Project project;\n         private final ClassPath classPath;\n \n+        // Used in unittest only\n+        StackTraceProcessor() {\n+            project = null;\n+            classPath = null;\n+        }\n+\n         private StackTraceProcessor(RunConfig cfg) {\n             project = cfg.getProject();\n             ProjectSourcesClassPathProvider cpProvider = project.getLookup().lookup(ProjectSourcesClassPathProvider.class);\n@@ -78,15 +84,15 @@ public boolean processLine(OutputDisplayer out, String line) {\n             Matcher m = STACKTRACE_PATTERN.matcher(line);\n             if (m.matches()) {\n                 String prefix = m.group(1);\n-                String modulePrefix = m.group(2);\n+                String modulePrefix = m.group(2) != null ? m.group(2) : \"\"; //NOI18N\n                 //String module = m.group(3);\n                 String method = m.group(4);\n                 String fileName = m.group(5);\n                 String lineNum = m.group(6);\n                 String postfix = m.group(7);\n \n                 int ppos = method.indexOf(fileName);\n-                if ((ppos >= 0) && (project != null)) {\n+                if (ppos >= 0) {\n                     String pack = method.substring(0, ppos).replace('.', '/');\n                     String javaName = pack + fileName + \".java\"; //NOI18N\n ", "filename": "groovy/gradle.java/src/org/netbeans/modules/gradle/java/output/JavaCompilerProcessorFactory.java"}, {"additions": 67, "raw_url": "https://github.com/apache/netbeans/raw/d39ec0dc8658bb332c3a315b66a3b8b0df03aca5/groovy/gradle.java/test/unit/src/org/netbeans/modules/gradle/java/output/JavaCompilerProcessorFactoryTest.java", "blob_url": "https://github.com/apache/netbeans/blob/d39ec0dc8658bb332c3a315b66a3b8b0df03aca5/groovy/gradle.java/test/unit/src/org/netbeans/modules/gradle/java/output/JavaCompilerProcessorFactoryTest.java", "sha": "df2e3ce7229e9f68f522522197f50445d2038759", "changes": 67, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle.java/test/unit/src/org/netbeans/modules/gradle/java/output/JavaCompilerProcessorFactoryTest.java?ref=d39ec0dc8658bb332c3a315b66a3b8b0df03aca5", "patch": "@@ -0,0 +1,67 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.netbeans.modules.gradle.java.output;\n+\n+import static org.junit.Assert.*;\n+import org.junit.Test;\n+import org.netbeans.modules.gradle.api.output.OutputDisplayerMock;\n+\n+/**\n+ *\n+ * @author lkishalmi\n+ */\n+public class JavaCompilerProcessorFactoryTest {\n+\n+    private final String JAVA_8_STACKTRACE_1  = \"        at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)\";\n+    private final String JAVA_9_STACKTRACE_1  = \"        at jdk.zipfs/jdk.nio.zipfs.JarFileSystem.getVersionMap(JarFileSystem.java:137)\";\n+    private final String JAVA_COMPILE_ERROR_1 = \"/home/netbeans/NetBeansProjects/gradleproject3/common/src/main/java/gradleproject3/common/NewClass1.java:1: error: class, interface, or enum expected\";\n+\n+    @Test\n+    public void testStackTraceProcessor1() {\n+        JavaCompilerProcessorFactory.StackTraceProcessor stp = new JavaCompilerProcessorFactory.StackTraceProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(stp.processLine(od, JAVA_8_STACKTRACE_1));\n+        assertEquals(JAVA_8_STACKTRACE_1, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(outputs[2].text, \"\");\n+        assertEquals(outputs[3].text, \"org.junit.jupiter.api.AssertionUtils.fail\");\n+        assertEquals(outputs[5].text, \"AssertionUtils.java:55\");\n+        assertNotNull(outputs[5].action);\n+    }\n+\n+    @Test\n+    public void testStackTraceProcessor2() {\n+        JavaCompilerProcessorFactory.StackTraceProcessor stp = new JavaCompilerProcessorFactory.StackTraceProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(stp.processLine(od, JAVA_9_STACKTRACE_1));\n+        assertEquals(JAVA_9_STACKTRACE_1, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(outputs[2].text, \"jdk.zipfs/\");\n+        assertEquals(outputs[3].text, \"jdk.nio.zipfs.JarFileSystem.getVersionMap\");\n+        assertEquals(outputs[5].text, \"JarFileSystem.java:137\");\n+        assertNotNull(outputs[5].action);\n+    }\n+\n+    @Test\n+    public void testStackTraceProcessor3() {\n+        JavaCompilerProcessorFactory.StackTraceProcessor stp = new JavaCompilerProcessorFactory.StackTraceProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertFalse(stp.processLine(od, JAVA_COMPILE_ERROR_1));\n+    }\n+}", "filename": "groovy/gradle.java/test/unit/src/org/netbeans/modules/gradle/java/output/JavaCompilerProcessorFactoryTest.java"}, {"additions": 14, "raw_url": "https://github.com/apache/netbeans/raw/d39ec0dc8658bb332c3a315b66a3b8b0df03aca5/groovy/gradle/src/org/netbeans/modules/gradle/api/output/OutputListeners.java", "blob_url": "https://github.com/apache/netbeans/blob/d39ec0dc8658bb332c3a315b66a3b8b0df03aca5/groovy/gradle/src/org/netbeans/modules/gradle/api/output/OutputListeners.java", "sha": "44518f20bec214f1ebc080d8a98c4412707365a2", "changes": 26, "status": "modified", "deletions": 12, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle/src/org/netbeans/modules/gradle/api/output/OutputListeners.java?ref=d39ec0dc8658bb332c3a315b66a3b8b0df03aca5", "patch": "@@ -42,21 +42,23 @@ public static Runnable openFileAt(final FileObject file, final int line, final i\n \n             @Override\n             public void run() {\n-                try {\n-                    DataObject data = DataObject.find(file);\n-                    if (data != null) {\n-                        EditorCookie cookie = data.getLookup().lookup(EditorCookie.class);\n-                        if (cookie != null) {\n-                            try {\n-                                cookie.getLineSet().getOriginal(line - 1).show(Line.ShowOpenType.REUSE, Line.ShowVisibilityType.FOCUS, col - 1);\n-                            } catch (IndexOutOfBoundsException ex) {\n-                                cookie.open();\n+                if (file != null) {\n+                    try {\n+                        DataObject data = DataObject.find(file);\n+                        if (data != null) {\n+                            EditorCookie cookie = data.getLookup().lookup(EditorCookie.class);\n+                            if (cookie != null) {\n+                                try {\n+                                    cookie.getLineSet().getOriginal(line - 1).show(Line.ShowOpenType.REUSE, Line.ShowVisibilityType.FOCUS, col - 1);\n+                                } catch (IndexOutOfBoundsException ex) {\n+                                    cookie.open();\n+                                }\n+\n                             }\n \n                         }\n-\n+                    } catch (DataObjectNotFoundException ex) {\n                     }\n-                } catch (DataObjectNotFoundException ex) {\n                 }\n             }\n \n@@ -73,7 +75,7 @@ public void run() {\n \n         };\n     }\n-    \n+\n     public static Runnable displayStatusText(final String text) {\n         return new Runnable() {\n ", "filename": "groovy/gradle/src/org/netbeans/modules/gradle/api/output/OutputListeners.java"}, {"additions": 41, "raw_url": "https://github.com/apache/netbeans/raw/d39ec0dc8658bb332c3a315b66a3b8b0df03aca5/groovy/gradle/src/org/netbeans/modules/gradle/output/GradleProcessorFactory.java", "blob_url": "https://github.com/apache/netbeans/blob/d39ec0dc8658bb332c3a315b66a3b8b0df03aca5/groovy/gradle/src/org/netbeans/modules/gradle/output/GradleProcessorFactory.java", "sha": "d7c9dbb27f8d0da33fa5382c2ac7d4315ec006fa", "changes": 85, "status": "modified", "deletions": 44, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle/src/org/netbeans/modules/gradle/output/GradleProcessorFactory.java?ref=d39ec0dc8658bb332c3a315b66a3b8b0df03aca5", "patch": "@@ -54,16 +54,16 @@\n     private static final OutputProcessor JAVAC_PROCESSOR = new JavaCompilerProcessor();\n     private static final OutputProcessor GROOVYC_PROCESSOR = new GroovyCompilerProcessor();\n \n-    \n+\n     @Override\n     public Set<? extends OutputProcessor> createOutputProcessors(RunConfig cfg) {\n         return new HashSet<>(Arrays.asList(URL_PROCESSOR, GRADLE_PROCESSOR, JAVAC_PROCESSOR, GROOVYC_PROCESSOR));\n     }\n \n-    private static final class URLOutputProcessor implements OutputProcessor {\n+    static final class URLOutputProcessor implements OutputProcessor {\n+\n+        private static final Pattern URL_PATTERN = Pattern.compile(\"(((https?|ftp|file)://|file:/)[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|])\");\n \n-        private static final Pattern URL_PATTERN = Pattern.compile(\"((https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|])\");\n-        \n         @Override\n         public boolean processLine(OutputDisplayer out, String line) {\n             Matcher m = URL_PATTERN.matcher(line);\n@@ -84,10 +84,10 @@ public boolean processLine(OutputDisplayer out, String line) {\n             }\n             return last > 0;\n         }\n-        \n+\n     }\n \n-    private static class GradleOutputProcessor implements OutputProcessor {\n+    static class GradleOutputProcessor implements OutputProcessor {\n \n         private static final Pattern GRADLE_ERROR = Pattern.compile(\"(Build file|Script) '(.*)\\\\.gradle' line: ([0-9]+)\");\n \n@@ -100,21 +100,19 @@ public boolean processLine(OutputDisplayer out, String line) {\n \n                 File gradleFile = FileUtil.normalizeFile(new File( buildFile + \".gradle\"));\n                 FileObject file = FileUtil.toFileObject(gradleFile);\n-                if (file != null) {\n-                    int l = 1;\n-                    try {\n-                        l = Integer.parseInt(lineNum);\n-                    } catch (NumberFormatException ex) {\n-                    }\n-                    out.print(\"Script '\" + buildFile + \".gradle' line: \" + lineNum, OutputListeners.openFileAt(file, l, 1));\n-                    return true;\n+                int l = 1;\n+                try {\n+                    l = Integer.parseInt(lineNum);\n+                } catch (NumberFormatException ex) {\n                 }\n+                out.print(\"Script '\" + buildFile + \".gradle' line: \" + lineNum, OutputListeners.openFileAt(file, l, 1));\n+                return true;\n             }\n             return false;\n-        }    \n+        }\n     }\n \n-    private static class JavaCompilerProcessor implements OutputProcessor {\n+    static class JavaCompilerProcessor implements OutputProcessor {\n \n         private static final Pattern JAVA_ERROR = Pattern.compile(\"(.*)\\\\.java\\\\:([0-9]+)\\\\: (error|warning)\\\\:(.*)\");\n \n@@ -129,25 +127,24 @@ public boolean processLine(OutputDisplayer out, String line) {\n \n                 File javaFile = FileUtil.normalizeFile(new File(classBase + \".java\"));\n                 FileObject file = FileUtil.toFileObject(javaFile);\n-                if (file != null) {\n-                    int l = 1;\n-                    try {\n-                        l = Integer.parseInt(lineNum);\n-                    } catch (NumberFormatException ex) {\n-                    }\n-                    out.print(classBase + \".java:\" + lineNum, OutputListeners.openFileAt(file, l, 1));\n-                    out.print(\": \" + type + \":\" + text);\n-                    return true;\n+                int l = 1;\n+                try {\n+                    l = Integer.parseInt(lineNum);\n+                } catch (NumberFormatException ex) {\n                 }\n+                out.print(classBase + \".java:\" + lineNum, OutputListeners.openFileAt(file, l, 1));\n+                out.print(\": \" + type + \":\" + text);\n+                return true;\n             }\n             return false;\n         }\n \n     }\n \n-    private static class GroovyCompilerProcessor implements OutputProcessor {\n+    static class GroovyCompilerProcessor implements OutputProcessor {\n \n-        private static final Pattern GROOVY_ERROR = Pattern.compile(\"(.*)\\\\.groovy\\\\: ([0-9]+)\\\\: (.*)( at line: ([0-9]+) column: ([0-9]+). File: (.*) @ (.*))?\");\n+        private static final Pattern GROOVY_ERROR = Pattern.compile(\"(.*)\\\\.groovy\\\\: ([0-9]+)\\\\: (.+)\");\n+        private static final Pattern COLUMN_INFO = Pattern.compile(\" @ line ([0-9]+), column ([0-9]+)\\\\.$\");\n \n         @Override\n         public boolean processLine(OutputDisplayer out, String line) {\n@@ -157,29 +154,29 @@ public boolean processLine(OutputDisplayer out, String line) {\n                 String text = m.group(3);\n                 String lineNum = m.group(2);\n                 String colNum = \"1\";\n-                if (m.group(4) != null) {\n-                    lineNum = m.group(5);\n-                    colNum = m.group(6);\n+\n+                Matcher colm = COLUMN_INFO.matcher(text);\n+                if (colm.find()) {\n+                    lineNum = colm.group(1);\n+                    colNum = colm.group(2);\n                 }\n \n-                File javaFile = FileUtil.normalizeFile(new File(classBase + \".groovy\"));\n-                FileObject file = FileUtil.toFileObject(javaFile);\n-                if (file != null) {\n-                    int l = 1;\n-                    int c = 1;\n-                    try {\n-                        l = Integer.parseInt(lineNum);\n-                        c = Integer.parseInt(colNum);\n-                    } catch (NumberFormatException ex) {\n-                    }\n-                    out.print(classBase + \".groovy:\" + lineNum + ':' + colNum, OutputListeners.openFileAt(file, l, c));\n-                    out.print(\": \" + text);\n-                    return true;\n+                File groovyFile = FileUtil.normalizeFile(new File(classBase + \".groovy\"));\n+                FileObject file = FileUtil.toFileObject(groovyFile);\n+                int l = 1;\n+                int c = 1;\n+                try {\n+                    l = Integer.parseInt(lineNum);\n+                    c = Integer.parseInt(colNum);\n+                } catch (NumberFormatException ex) {\n                 }\n+                out.print(classBase + \".groovy: \" + lineNum, OutputListeners.openFileAt(file, l, c));\n+                out.print(\": \" + text);\n+                return true;\n             }\n             return false;\n         }\n \n     }\n-    \n+\n }", "filename": "groovy/gradle/src/org/netbeans/modules/gradle/output/GradleProcessorFactory.java"}, {"additions": 65, "raw_url": "https://github.com/apache/netbeans/raw/d39ec0dc8658bb332c3a315b66a3b8b0df03aca5/groovy/gradle/test/unit/src/org/netbeans/modules/gradle/api/output/OutputDisplayerMock.java", "blob_url": "https://github.com/apache/netbeans/blob/d39ec0dc8658bb332c3a315b66a3b8b0df03aca5/groovy/gradle/test/unit/src/org/netbeans/modules/gradle/api/output/OutputDisplayerMock.java", "sha": "9515ce527e87f1b77e590b33f12a76382d7e3c66", "changes": 65, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle/test/unit/src/org/netbeans/modules/gradle/api/output/OutputDisplayerMock.java?ref=d39ec0dc8658bb332c3a315b66a3b8b0df03aca5", "patch": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.netbeans.modules.gradle.api.output;\n+\n+import java.util.ArrayList;\n+import org.openide.windows.IOColors;\n+\n+/**\n+ *\n+ * @author lkishalmi\n+ */\n+public class OutputDisplayerMock extends OutputDisplayer {\n+\n+    private final ArrayList<OutputItem> items = new ArrayList<>();\n+\n+    @Override\n+    protected void doPrint(CharSequence text, Runnable action, IOColors.OutputType type) {\n+        items.add(new OutputItem(text.toString(), action, type));\n+    }\n+\n+    public OutputItem[] getOutputs() {\n+        return items.toArray(new OutputItem[items.size()]);\n+    }\n+\n+    public String getOutput() {\n+        StringBuilder sb = new StringBuilder();\n+        for (OutputItem item : items) {\n+            sb.append(item);\n+        }\n+        return sb.toString();\n+    }\n+\n+    public class OutputItem {\n+        public final String text;\n+        public final Runnable action;\n+        public final IOColors.OutputType type;\n+\n+        public OutputItem(String text, Runnable action, IOColors.OutputType type) {\n+            this.text = text;\n+            this.action = action;\n+            this.type = type;\n+        }\n+\n+        @Override\n+        public String toString() {\n+            return text;\n+        }\n+    }\n+}", "filename": "groovy/gradle/test/unit/src/org/netbeans/modules/gradle/api/output/OutputDisplayerMock.java"}, {"additions": 215, "raw_url": "https://github.com/apache/netbeans/raw/d39ec0dc8658bb332c3a315b66a3b8b0df03aca5/groovy/gradle/test/unit/src/org/netbeans/modules/gradle/output/GradleProcessorFactoryTest.java", "blob_url": "https://github.com/apache/netbeans/blob/d39ec0dc8658bb332c3a315b66a3b8b0df03aca5/groovy/gradle/test/unit/src/org/netbeans/modules/gradle/output/GradleProcessorFactoryTest.java", "sha": "50f36515df351b86e0841ed27ec617d06f534d1d", "changes": 215, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle/test/unit/src/org/netbeans/modules/gradle/output/GradleProcessorFactoryTest.java?ref=d39ec0dc8658bb332c3a315b66a3b8b0df03aca5", "patch": "@@ -0,0 +1,215 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.netbeans.modules.gradle.output;\n+\n+import org.junit.Test;\n+import static org.junit.Assert.*;\n+import org.netbeans.modules.gradle.api.output.OutputDisplayerMock;\n+\n+/**\n+ *\n+ * @author lkishalmi\n+ */\n+public class GradleProcessorFactoryTest {\n+\n+    private static final String JAVA_8_STACKTRACE_1  = \"        at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)\";\n+\n+    private static final String JAVA_COMPILE_ERROR_1 = \"/home/netbeans/NetBeansProjects/gradleproject3/common/src/main/java/gradleproject3/common/NewClass1.java:1: error: class, interface, or enum expected\";\n+    private static final String JAVA_COMPILE_ERROR_2 = \"D:\\\\Users\\\\netbeans\\\\NetBeansProjects\\\\gradleproject3\\\\common\\\\src\\\\main\\\\java\\\\gradleproject3\\\\common\\\\NewClass1.java:1: error: class, interface, or enum expected\";\n+\n+    private static final String GRADLE_SCRIPT_ERROR_1= \"Script '/home/netbeans/NetBeansProjects/gradleproject6/build.gradle' line: 6\";\n+\n+    private static final String GROOVY_COMPILE_ERROR_1 = \"/home/netbeans/NetBeansProjects/netbeans/groovy/gradle/netbeans-gradle-tooling/src/main/groovy/org/netbeans/modules/gradle/tooling/NetBeansExplodedWarPlugin.groovy: 33: unable to resolve class Prject\";\n+    private static final String GROOVY_COMPILE_ERROR_2 = \"/home/netbeans/NetBeansProjects/netbeans/groovy/gradle/netbeans-gradle-tooling/src/main/groovy/org/netbeans/modules/gradle/tooling/NetBeansExplodedWarPlugin.groovy: 43: expecting anything but ''\\\\n''; got it anyway @ line 43, column 28.\";\n+\n+    private static final String URL_PATTERN_1 = \"https://netbeans.apache.org/\";\n+    private static final String URL_PATTERN_2 = \"Hello https://netbeans.apache.org\";\n+    private static final String URL_PATTERN_3 = \"https://netbeans.apache.org then look at ftp://netbeans.apache.org/\";\n+    private static final String URL_PATTERN_4 = \"https://netbeans.apache.org then look at ftp://netbeans.apache.org/ and file:/home/netbeans \";\n+    private static final String URL_PATTERN_5 = \"https://netbeans.apache.org then look at ftp://netbeans.apache.org/ and file:///home/netbeans \";\n+\n+    @Test\n+    public void testJavaCompilerProcessor1() {\n+        GradleProcessorFactory.JavaCompilerProcessor jcp = new GradleProcessorFactory.JavaCompilerProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(jcp.processLine(od, JAVA_COMPILE_ERROR_1));\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(\"/home/netbeans/NetBeansProjects/gradleproject3/common/src/main/java/gradleproject3/common/NewClass1.java:1\", outputs[0].text);\n+        assertEquals(\": error: class, interface, or enum expected\", outputs[1].text);\n+    }\n+\n+    @Test\n+    public void testJavaCompilerProcessor2() {\n+        GradleProcessorFactory.JavaCompilerProcessor jcp = new GradleProcessorFactory.JavaCompilerProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(jcp.processLine(od, JAVA_COMPILE_ERROR_2));\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(\"D:\\\\Users\\\\netbeans\\\\NetBeansProjects\\\\gradleproject3\\\\common\\\\src\\\\main\\\\java\\\\gradleproject3\\\\common\\\\NewClass1.java:1\", outputs[0].text);\n+        assertEquals(\": error: class, interface, or enum expected\", outputs[1].text);\n+    }\n+\n+    @Test\n+    public void testJavaCompilerProcessor3() {\n+        GradleProcessorFactory.JavaCompilerProcessor jcp = new GradleProcessorFactory.JavaCompilerProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertFalse(jcp.processLine(od, GROOVY_COMPILE_ERROR_1));\n+    }\n+\n+    @Test\n+    public void testJavaCompilerProcessor4() {\n+        GradleProcessorFactory.JavaCompilerProcessor jcp = new GradleProcessorFactory.JavaCompilerProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertFalse(jcp.processLine(od, JAVA_8_STACKTRACE_1));\n+    }\n+\n+    @Test\n+    public void testGroovyCompilerProcessor1() {\n+        GradleProcessorFactory.GroovyCompilerProcessor gcp = new GradleProcessorFactory.GroovyCompilerProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(gcp.processLine(od, GROOVY_COMPILE_ERROR_1));\n+        assertEquals(GROOVY_COMPILE_ERROR_1, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(\"/home/netbeans/NetBeansProjects/netbeans/groovy/gradle/netbeans-gradle-tooling/src/main/groovy/org/netbeans/modules/gradle/tooling/NetBeansExplodedWarPlugin.groovy: 33\", outputs[0].text);\n+        assertNotNull(outputs[0].action);\n+        assertEquals(\": unable to resolve class Prject\", outputs[1].text);\n+    }\n+\n+    @Test\n+    public void testGroovyCompilerProcessor2() {\n+        GradleProcessorFactory.GroovyCompilerProcessor gcp = new GradleProcessorFactory.GroovyCompilerProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(gcp.processLine(od, GROOVY_COMPILE_ERROR_2));\n+        assertEquals(GROOVY_COMPILE_ERROR_2, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(\"/home/netbeans/NetBeansProjects/netbeans/groovy/gradle/netbeans-gradle-tooling/src/main/groovy/org/netbeans/modules/gradle/tooling/NetBeansExplodedWarPlugin.groovy: 43\", outputs[0].text);\n+        assertNotNull(outputs[0].action);\n+        assertEquals(\": expecting anything but ''\\\\n''; got it anyway @ line 43, column 28.\", outputs[1].text);\n+    }\n+\n+    @Test\n+    public void testGroovyCompilerProcessor3() {\n+        GradleProcessorFactory.GroovyCompilerProcessor gcp = new GradleProcessorFactory.GroovyCompilerProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertFalse(gcp.processLine(od, JAVA_COMPILE_ERROR_1));\n+    }\n+\n+    @Test\n+    public void testURLOutputProcessor1() {\n+        GradleProcessorFactory.URLOutputProcessor uop = new GradleProcessorFactory.URLOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertFalse(uop.processLine(od, JAVA_8_STACKTRACE_1));\n+    }\n+\n+    @Test\n+    public void testURLOutputProcessor2() {\n+        GradleProcessorFactory.URLOutputProcessor uop = new GradleProcessorFactory.URLOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertFalse(uop.processLine(od, JAVA_COMPILE_ERROR_1));\n+    }\n+\n+    @Test\n+    public void testURLOutputProcessor3() {\n+        GradleProcessorFactory.URLOutputProcessor uop = new GradleProcessorFactory.URLOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(uop.processLine(od, URL_PATTERN_1));\n+        assertEquals(URL_PATTERN_1, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(3, outputs.length);\n+        assertNotNull(outputs[1].action);\n+    }\n+\n+    @Test\n+    public void testURLOutputProcessor4() {\n+        GradleProcessorFactory.URLOutputProcessor uop = new GradleProcessorFactory.URLOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(uop.processLine(od, URL_PATTERN_2));\n+        assertEquals(URL_PATTERN_2, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertNotNull(outputs[1].action);\n+        assertEquals(3, outputs.length);\n+    }\n+\n+    @Test\n+    public void testURLOutputProcessor5() {\n+        GradleProcessorFactory.URLOutputProcessor uop = new GradleProcessorFactory.URLOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(uop.processLine(od, URL_PATTERN_3));\n+        assertEquals(URL_PATTERN_3, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(5, outputs.length);\n+        assertEquals(\" then look at \", outputs[2].text);\n+        assertNotNull(outputs[1].action);\n+        assertNotNull(outputs[3].action);\n+    }\n+\n+    @Test\n+    public void testURLOutputProcessor6() {\n+        GradleProcessorFactory.URLOutputProcessor uop = new GradleProcessorFactory.URLOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(uop.processLine(od, URL_PATTERN_4));\n+        assertEquals(URL_PATTERN_4, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(7, outputs.length);\n+        assertEquals(\" then look at \", outputs[2].text);\n+        assertNotNull(outputs[1].action);\n+        assertNotNull(outputs[3].action);\n+        assertNotNull(outputs[5].action);\n+        assertEquals(\"file:/home/netbeans\", outputs[5].text);\n+    }\n+\n+    @Test\n+    public void testURLOutputProcessor7() {\n+        GradleProcessorFactory.URLOutputProcessor uop = new GradleProcessorFactory.URLOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(uop.processLine(od, URL_PATTERN_5));\n+        assertEquals(URL_PATTERN_5, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(7, outputs.length);\n+        assertEquals(\" then look at \", outputs[2].text);\n+        assertNotNull(outputs[1].action);\n+        assertNotNull(outputs[3].action);\n+        assertNotNull(outputs[5].action);\n+        assertEquals(\"file:///home/netbeans\", outputs[5].text);\n+    }\n+\n+    @Test\n+    public void testGradleOutputProcessor1() {\n+        GradleProcessorFactory.GradleOutputProcessor uop = new GradleProcessorFactory.GradleOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(uop.processLine(od, GRADLE_SCRIPT_ERROR_1));\n+        assertEquals(GRADLE_SCRIPT_ERROR_1, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(1, outputs.length);\n+        assertEquals(GRADLE_SCRIPT_ERROR_1, outputs[0].text);\n+    }\n+\n+    @Test\n+    public void testGradleOutputProcessor2() {\n+        GradleProcessorFactory.GradleOutputProcessor uop = new GradleProcessorFactory.GradleOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertFalse(uop.processLine(od, JAVA_COMPILE_ERROR_1));\n+    }\n+\n+    @Test\n+    public void testGradleOutputProcessor3() {\n+        GradleProcessorFactory.GradleOutputProcessor uop = new GradleProcessorFactory.GradleOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertFalse(uop.processLine(od, JAVA_8_STACKTRACE_1));\n+    }\n+}", "filename": "groovy/gradle/test/unit/src/org/netbeans/modules/gradle/output/GradleProcessorFactoryTest.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/29109edc539886c294c2f91edf1a145687e9d45c", "parent": "https://github.com/apache/netbeans/commit/91c93f4b54f154a04fee5061042d37f37820f8f8", "message": "[NETBEANS-2753] Fixed NPE on Java Stacktrace processing. Added some unit tests for Gradle Output processors.", "bug_id": "netbeans_10", "file": [{"additions": 19, "raw_url": "https://github.com/apache/netbeans/raw/29109edc539886c294c2f91edf1a145687e9d45c/groovy/gradle.java/nbproject/project.xml", "blob_url": "https://github.com/apache/netbeans/blob/29109edc539886c294c2f91edf1a145687e9d45c/groovy/gradle.java/nbproject/project.xml", "sha": "b2c293fb04873e1f12f6f798723c10222624920e", "changes": 19, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle.java/nbproject/project.xml?ref=29109edc539886c294c2f91edf1a145687e9d45c", "patch": "@@ -305,6 +305,25 @@\n                     </run-dependency>\n                 </dependency>\n             </module-dependencies>\n+            <test-dependencies>\n+                <test-type>\n+                    <name>unit</name>\n+                    <test-dependency>\n+                        <code-name-base>org.netbeans.libs.junit4</code-name-base>\n+                        <compile-dependency/>\n+                    </test-dependency>\n+                    <test-dependency>\n+                        <code-name-base>org.netbeans.modules.nbjunit</code-name-base>\n+                        <recursive/>\n+                        <compile-dependency/>\n+                    </test-dependency>\n+                    <test-dependency>\n+                        <code-name-base>org.netbeans.modules.gradle</code-name-base>\n+                        <compile-dependency/>\n+                        <test/>\n+                    </test-dependency>\n+                </test-type>\n+            </test-dependencies>\n             <public-packages>\n                 <package>org.netbeans.modules.gradle.java.api</package>\n                 <package>org.netbeans.modules.gradle.java.api.output</package>", "filename": "groovy/gradle.java/nbproject/project.xml"}, {"additions": 10, "raw_url": "https://github.com/apache/netbeans/raw/29109edc539886c294c2f91edf1a145687e9d45c/groovy/gradle.java/src/org/netbeans/modules/gradle/java/output/JavaCompilerProcessorFactory.java", "blob_url": "https://github.com/apache/netbeans/blob/29109edc539886c294c2f91edf1a145687e9d45c/groovy/gradle.java/src/org/netbeans/modules/gradle/java/output/JavaCompilerProcessorFactory.java", "sha": "0b9d64792dcc815bf87548e023a4a30cd06939e5", "changes": 14, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle.java/src/org/netbeans/modules/gradle/java/output/JavaCompilerProcessorFactory.java?ref=29109edc539886c294c2f91edf1a145687e9d45c", "patch": "@@ -48,20 +48,26 @@\n  * @author Laszlo Kishalmi\n  */\n @ProjectServiceProvider(service = OutputProcessorFactory.class, projectType = NbGradleProject.GRADLE_PLUGIN_TYPE + \"/java-base\")\n-public class JavaCompilerProcessorFactory implements OutputProcessorFactory {\n+public final class JavaCompilerProcessorFactory implements OutputProcessorFactory {\n \n     @Override\n     public Set<? extends OutputProcessor> createOutputProcessors(RunConfig cfg) {\n         return new HashSet<>(Arrays.asList(new StackTraceProcessor(cfg)));\n     }\n \n-    private static class StackTraceProcessor implements OutputProcessor {\n+    static class StackTraceProcessor implements OutputProcessor {\n \n         private static final Pattern STACKTRACE_PATTERN = Pattern.compile(\"(.*)at ((\\\\w[\\\\w\\\\.]*)/)?(\\\\w[\\\\w\\\\.\\\\$<>]*)\\\\((\\\\w+)\\\\.java\\\\:([0-9]+)\\\\)(.*)\");\n         private static final IOColors.OutputType OUT_TYPE = IOColors.OutputType.ERROR;\n         private final Project project;\n         private final ClassPath classPath;\n \n+        // Used in unittest only\n+        StackTraceProcessor() {\n+            project = null;\n+            classPath = null;\n+        }\n+\n         private StackTraceProcessor(RunConfig cfg) {\n             project = cfg.getProject();\n             ProjectSourcesClassPathProvider cpProvider = project.getLookup().lookup(ProjectSourcesClassPathProvider.class);\n@@ -78,15 +84,15 @@ public boolean processLine(OutputDisplayer out, String line) {\n             Matcher m = STACKTRACE_PATTERN.matcher(line);\n             if (m.matches()) {\n                 String prefix = m.group(1);\n-                String modulePrefix = m.group(2);\n+                String modulePrefix = m.group(2) != null ? m.group(2) : \"\"; //NOI18N\n                 //String module = m.group(3);\n                 String method = m.group(4);\n                 String fileName = m.group(5);\n                 String lineNum = m.group(6);\n                 String postfix = m.group(7);\n \n                 int ppos = method.indexOf(fileName);\n-                if ((ppos >= 0) && (project != null)) {\n+                if (ppos >= 0) {\n                     String pack = method.substring(0, ppos).replace('.', '/');\n                     String javaName = pack + fileName + \".java\"; //NOI18N\n ", "filename": "groovy/gradle.java/src/org/netbeans/modules/gradle/java/output/JavaCompilerProcessorFactory.java"}, {"additions": 67, "raw_url": "https://github.com/apache/netbeans/raw/29109edc539886c294c2f91edf1a145687e9d45c/groovy/gradle.java/test/unit/src/org/netbeans/modules/gradle/java/output/JavaCompilerProcessorFactoryTest.java", "blob_url": "https://github.com/apache/netbeans/blob/29109edc539886c294c2f91edf1a145687e9d45c/groovy/gradle.java/test/unit/src/org/netbeans/modules/gradle/java/output/JavaCompilerProcessorFactoryTest.java", "sha": "df2e3ce7229e9f68f522522197f50445d2038759", "changes": 67, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle.java/test/unit/src/org/netbeans/modules/gradle/java/output/JavaCompilerProcessorFactoryTest.java?ref=29109edc539886c294c2f91edf1a145687e9d45c", "patch": "@@ -0,0 +1,67 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.netbeans.modules.gradle.java.output;\n+\n+import static org.junit.Assert.*;\n+import org.junit.Test;\n+import org.netbeans.modules.gradle.api.output.OutputDisplayerMock;\n+\n+/**\n+ *\n+ * @author lkishalmi\n+ */\n+public class JavaCompilerProcessorFactoryTest {\n+\n+    private final String JAVA_8_STACKTRACE_1  = \"        at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)\";\n+    private final String JAVA_9_STACKTRACE_1  = \"        at jdk.zipfs/jdk.nio.zipfs.JarFileSystem.getVersionMap(JarFileSystem.java:137)\";\n+    private final String JAVA_COMPILE_ERROR_1 = \"/home/netbeans/NetBeansProjects/gradleproject3/common/src/main/java/gradleproject3/common/NewClass1.java:1: error: class, interface, or enum expected\";\n+\n+    @Test\n+    public void testStackTraceProcessor1() {\n+        JavaCompilerProcessorFactory.StackTraceProcessor stp = new JavaCompilerProcessorFactory.StackTraceProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(stp.processLine(od, JAVA_8_STACKTRACE_1));\n+        assertEquals(JAVA_8_STACKTRACE_1, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(outputs[2].text, \"\");\n+        assertEquals(outputs[3].text, \"org.junit.jupiter.api.AssertionUtils.fail\");\n+        assertEquals(outputs[5].text, \"AssertionUtils.java:55\");\n+        assertNotNull(outputs[5].action);\n+    }\n+\n+    @Test\n+    public void testStackTraceProcessor2() {\n+        JavaCompilerProcessorFactory.StackTraceProcessor stp = new JavaCompilerProcessorFactory.StackTraceProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(stp.processLine(od, JAVA_9_STACKTRACE_1));\n+        assertEquals(JAVA_9_STACKTRACE_1, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(outputs[2].text, \"jdk.zipfs/\");\n+        assertEquals(outputs[3].text, \"jdk.nio.zipfs.JarFileSystem.getVersionMap\");\n+        assertEquals(outputs[5].text, \"JarFileSystem.java:137\");\n+        assertNotNull(outputs[5].action);\n+    }\n+\n+    @Test\n+    public void testStackTraceProcessor3() {\n+        JavaCompilerProcessorFactory.StackTraceProcessor stp = new JavaCompilerProcessorFactory.StackTraceProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertFalse(stp.processLine(od, JAVA_COMPILE_ERROR_1));\n+    }\n+}", "filename": "groovy/gradle.java/test/unit/src/org/netbeans/modules/gradle/java/output/JavaCompilerProcessorFactoryTest.java"}, {"additions": 14, "raw_url": "https://github.com/apache/netbeans/raw/29109edc539886c294c2f91edf1a145687e9d45c/groovy/gradle/src/org/netbeans/modules/gradle/api/output/OutputListeners.java", "blob_url": "https://github.com/apache/netbeans/blob/29109edc539886c294c2f91edf1a145687e9d45c/groovy/gradle/src/org/netbeans/modules/gradle/api/output/OutputListeners.java", "sha": "44518f20bec214f1ebc080d8a98c4412707365a2", "changes": 26, "status": "modified", "deletions": 12, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle/src/org/netbeans/modules/gradle/api/output/OutputListeners.java?ref=29109edc539886c294c2f91edf1a145687e9d45c", "patch": "@@ -42,21 +42,23 @@ public static Runnable openFileAt(final FileObject file, final int line, final i\n \n             @Override\n             public void run() {\n-                try {\n-                    DataObject data = DataObject.find(file);\n-                    if (data != null) {\n-                        EditorCookie cookie = data.getLookup().lookup(EditorCookie.class);\n-                        if (cookie != null) {\n-                            try {\n-                                cookie.getLineSet().getOriginal(line - 1).show(Line.ShowOpenType.REUSE, Line.ShowVisibilityType.FOCUS, col - 1);\n-                            } catch (IndexOutOfBoundsException ex) {\n-                                cookie.open();\n+                if (file != null) {\n+                    try {\n+                        DataObject data = DataObject.find(file);\n+                        if (data != null) {\n+                            EditorCookie cookie = data.getLookup().lookup(EditorCookie.class);\n+                            if (cookie != null) {\n+                                try {\n+                                    cookie.getLineSet().getOriginal(line - 1).show(Line.ShowOpenType.REUSE, Line.ShowVisibilityType.FOCUS, col - 1);\n+                                } catch (IndexOutOfBoundsException ex) {\n+                                    cookie.open();\n+                                }\n+\n                             }\n \n                         }\n-\n+                    } catch (DataObjectNotFoundException ex) {\n                     }\n-                } catch (DataObjectNotFoundException ex) {\n                 }\n             }\n \n@@ -73,7 +75,7 @@ public void run() {\n \n         };\n     }\n-    \n+\n     public static Runnable displayStatusText(final String text) {\n         return new Runnable() {\n ", "filename": "groovy/gradle/src/org/netbeans/modules/gradle/api/output/OutputListeners.java"}, {"additions": 41, "raw_url": "https://github.com/apache/netbeans/raw/29109edc539886c294c2f91edf1a145687e9d45c/groovy/gradle/src/org/netbeans/modules/gradle/output/GradleProcessorFactory.java", "blob_url": "https://github.com/apache/netbeans/blob/29109edc539886c294c2f91edf1a145687e9d45c/groovy/gradle/src/org/netbeans/modules/gradle/output/GradleProcessorFactory.java", "sha": "d7c9dbb27f8d0da33fa5382c2ac7d4315ec006fa", "changes": 85, "status": "modified", "deletions": 44, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle/src/org/netbeans/modules/gradle/output/GradleProcessorFactory.java?ref=29109edc539886c294c2f91edf1a145687e9d45c", "patch": "@@ -54,16 +54,16 @@\n     private static final OutputProcessor JAVAC_PROCESSOR = new JavaCompilerProcessor();\n     private static final OutputProcessor GROOVYC_PROCESSOR = new GroovyCompilerProcessor();\n \n-    \n+\n     @Override\n     public Set<? extends OutputProcessor> createOutputProcessors(RunConfig cfg) {\n         return new HashSet<>(Arrays.asList(URL_PROCESSOR, GRADLE_PROCESSOR, JAVAC_PROCESSOR, GROOVYC_PROCESSOR));\n     }\n \n-    private static final class URLOutputProcessor implements OutputProcessor {\n+    static final class URLOutputProcessor implements OutputProcessor {\n+\n+        private static final Pattern URL_PATTERN = Pattern.compile(\"(((https?|ftp|file)://|file:/)[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|])\");\n \n-        private static final Pattern URL_PATTERN = Pattern.compile(\"((https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|])\");\n-        \n         @Override\n         public boolean processLine(OutputDisplayer out, String line) {\n             Matcher m = URL_PATTERN.matcher(line);\n@@ -84,10 +84,10 @@ public boolean processLine(OutputDisplayer out, String line) {\n             }\n             return last > 0;\n         }\n-        \n+\n     }\n \n-    private static class GradleOutputProcessor implements OutputProcessor {\n+    static class GradleOutputProcessor implements OutputProcessor {\n \n         private static final Pattern GRADLE_ERROR = Pattern.compile(\"(Build file|Script) '(.*)\\\\.gradle' line: ([0-9]+)\");\n \n@@ -100,21 +100,19 @@ public boolean processLine(OutputDisplayer out, String line) {\n \n                 File gradleFile = FileUtil.normalizeFile(new File( buildFile + \".gradle\"));\n                 FileObject file = FileUtil.toFileObject(gradleFile);\n-                if (file != null) {\n-                    int l = 1;\n-                    try {\n-                        l = Integer.parseInt(lineNum);\n-                    } catch (NumberFormatException ex) {\n-                    }\n-                    out.print(\"Script '\" + buildFile + \".gradle' line: \" + lineNum, OutputListeners.openFileAt(file, l, 1));\n-                    return true;\n+                int l = 1;\n+                try {\n+                    l = Integer.parseInt(lineNum);\n+                } catch (NumberFormatException ex) {\n                 }\n+                out.print(\"Script '\" + buildFile + \".gradle' line: \" + lineNum, OutputListeners.openFileAt(file, l, 1));\n+                return true;\n             }\n             return false;\n-        }    \n+        }\n     }\n \n-    private static class JavaCompilerProcessor implements OutputProcessor {\n+    static class JavaCompilerProcessor implements OutputProcessor {\n \n         private static final Pattern JAVA_ERROR = Pattern.compile(\"(.*)\\\\.java\\\\:([0-9]+)\\\\: (error|warning)\\\\:(.*)\");\n \n@@ -129,25 +127,24 @@ public boolean processLine(OutputDisplayer out, String line) {\n \n                 File javaFile = FileUtil.normalizeFile(new File(classBase + \".java\"));\n                 FileObject file = FileUtil.toFileObject(javaFile);\n-                if (file != null) {\n-                    int l = 1;\n-                    try {\n-                        l = Integer.parseInt(lineNum);\n-                    } catch (NumberFormatException ex) {\n-                    }\n-                    out.print(classBase + \".java:\" + lineNum, OutputListeners.openFileAt(file, l, 1));\n-                    out.print(\": \" + type + \":\" + text);\n-                    return true;\n+                int l = 1;\n+                try {\n+                    l = Integer.parseInt(lineNum);\n+                } catch (NumberFormatException ex) {\n                 }\n+                out.print(classBase + \".java:\" + lineNum, OutputListeners.openFileAt(file, l, 1));\n+                out.print(\": \" + type + \":\" + text);\n+                return true;\n             }\n             return false;\n         }\n \n     }\n \n-    private static class GroovyCompilerProcessor implements OutputProcessor {\n+    static class GroovyCompilerProcessor implements OutputProcessor {\n \n-        private static final Pattern GROOVY_ERROR = Pattern.compile(\"(.*)\\\\.groovy\\\\: ([0-9]+)\\\\: (.*)( at line: ([0-9]+) column: ([0-9]+). File: (.*) @ (.*))?\");\n+        private static final Pattern GROOVY_ERROR = Pattern.compile(\"(.*)\\\\.groovy\\\\: ([0-9]+)\\\\: (.+)\");\n+        private static final Pattern COLUMN_INFO = Pattern.compile(\" @ line ([0-9]+), column ([0-9]+)\\\\.$\");\n \n         @Override\n         public boolean processLine(OutputDisplayer out, String line) {\n@@ -157,29 +154,29 @@ public boolean processLine(OutputDisplayer out, String line) {\n                 String text = m.group(3);\n                 String lineNum = m.group(2);\n                 String colNum = \"1\";\n-                if (m.group(4) != null) {\n-                    lineNum = m.group(5);\n-                    colNum = m.group(6);\n+\n+                Matcher colm = COLUMN_INFO.matcher(text);\n+                if (colm.find()) {\n+                    lineNum = colm.group(1);\n+                    colNum = colm.group(2);\n                 }\n \n-                File javaFile = FileUtil.normalizeFile(new File(classBase + \".groovy\"));\n-                FileObject file = FileUtil.toFileObject(javaFile);\n-                if (file != null) {\n-                    int l = 1;\n-                    int c = 1;\n-                    try {\n-                        l = Integer.parseInt(lineNum);\n-                        c = Integer.parseInt(colNum);\n-                    } catch (NumberFormatException ex) {\n-                    }\n-                    out.print(classBase + \".groovy:\" + lineNum + ':' + colNum, OutputListeners.openFileAt(file, l, c));\n-                    out.print(\": \" + text);\n-                    return true;\n+                File groovyFile = FileUtil.normalizeFile(new File(classBase + \".groovy\"));\n+                FileObject file = FileUtil.toFileObject(groovyFile);\n+                int l = 1;\n+                int c = 1;\n+                try {\n+                    l = Integer.parseInt(lineNum);\n+                    c = Integer.parseInt(colNum);\n+                } catch (NumberFormatException ex) {\n                 }\n+                out.print(classBase + \".groovy: \" + lineNum, OutputListeners.openFileAt(file, l, c));\n+                out.print(\": \" + text);\n+                return true;\n             }\n             return false;\n         }\n \n     }\n-    \n+\n }", "filename": "groovy/gradle/src/org/netbeans/modules/gradle/output/GradleProcessorFactory.java"}, {"additions": 65, "raw_url": "https://github.com/apache/netbeans/raw/29109edc539886c294c2f91edf1a145687e9d45c/groovy/gradle/test/unit/src/org/netbeans/modules/gradle/api/output/OutputDisplayerMock.java", "blob_url": "https://github.com/apache/netbeans/blob/29109edc539886c294c2f91edf1a145687e9d45c/groovy/gradle/test/unit/src/org/netbeans/modules/gradle/api/output/OutputDisplayerMock.java", "sha": "9515ce527e87f1b77e590b33f12a76382d7e3c66", "changes": 65, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle/test/unit/src/org/netbeans/modules/gradle/api/output/OutputDisplayerMock.java?ref=29109edc539886c294c2f91edf1a145687e9d45c", "patch": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.netbeans.modules.gradle.api.output;\n+\n+import java.util.ArrayList;\n+import org.openide.windows.IOColors;\n+\n+/**\n+ *\n+ * @author lkishalmi\n+ */\n+public class OutputDisplayerMock extends OutputDisplayer {\n+\n+    private final ArrayList<OutputItem> items = new ArrayList<>();\n+\n+    @Override\n+    protected void doPrint(CharSequence text, Runnable action, IOColors.OutputType type) {\n+        items.add(new OutputItem(text.toString(), action, type));\n+    }\n+\n+    public OutputItem[] getOutputs() {\n+        return items.toArray(new OutputItem[items.size()]);\n+    }\n+\n+    public String getOutput() {\n+        StringBuilder sb = new StringBuilder();\n+        for (OutputItem item : items) {\n+            sb.append(item);\n+        }\n+        return sb.toString();\n+    }\n+\n+    public class OutputItem {\n+        public final String text;\n+        public final Runnable action;\n+        public final IOColors.OutputType type;\n+\n+        public OutputItem(String text, Runnable action, IOColors.OutputType type) {\n+            this.text = text;\n+            this.action = action;\n+            this.type = type;\n+        }\n+\n+        @Override\n+        public String toString() {\n+            return text;\n+        }\n+    }\n+}", "filename": "groovy/gradle/test/unit/src/org/netbeans/modules/gradle/api/output/OutputDisplayerMock.java"}, {"additions": 215, "raw_url": "https://github.com/apache/netbeans/raw/29109edc539886c294c2f91edf1a145687e9d45c/groovy/gradle/test/unit/src/org/netbeans/modules/gradle/output/GradleProcessorFactoryTest.java", "blob_url": "https://github.com/apache/netbeans/blob/29109edc539886c294c2f91edf1a145687e9d45c/groovy/gradle/test/unit/src/org/netbeans/modules/gradle/output/GradleProcessorFactoryTest.java", "sha": "50f36515df351b86e0841ed27ec617d06f534d1d", "changes": 215, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle/test/unit/src/org/netbeans/modules/gradle/output/GradleProcessorFactoryTest.java?ref=29109edc539886c294c2f91edf1a145687e9d45c", "patch": "@@ -0,0 +1,215 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.netbeans.modules.gradle.output;\n+\n+import org.junit.Test;\n+import static org.junit.Assert.*;\n+import org.netbeans.modules.gradle.api.output.OutputDisplayerMock;\n+\n+/**\n+ *\n+ * @author lkishalmi\n+ */\n+public class GradleProcessorFactoryTest {\n+\n+    private static final String JAVA_8_STACKTRACE_1  = \"        at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)\";\n+\n+    private static final String JAVA_COMPILE_ERROR_1 = \"/home/netbeans/NetBeansProjects/gradleproject3/common/src/main/java/gradleproject3/common/NewClass1.java:1: error: class, interface, or enum expected\";\n+    private static final String JAVA_COMPILE_ERROR_2 = \"D:\\\\Users\\\\netbeans\\\\NetBeansProjects\\\\gradleproject3\\\\common\\\\src\\\\main\\\\java\\\\gradleproject3\\\\common\\\\NewClass1.java:1: error: class, interface, or enum expected\";\n+\n+    private static final String GRADLE_SCRIPT_ERROR_1= \"Script '/home/netbeans/NetBeansProjects/gradleproject6/build.gradle' line: 6\";\n+\n+    private static final String GROOVY_COMPILE_ERROR_1 = \"/home/netbeans/NetBeansProjects/netbeans/groovy/gradle/netbeans-gradle-tooling/src/main/groovy/org/netbeans/modules/gradle/tooling/NetBeansExplodedWarPlugin.groovy: 33: unable to resolve class Prject\";\n+    private static final String GROOVY_COMPILE_ERROR_2 = \"/home/netbeans/NetBeansProjects/netbeans/groovy/gradle/netbeans-gradle-tooling/src/main/groovy/org/netbeans/modules/gradle/tooling/NetBeansExplodedWarPlugin.groovy: 43: expecting anything but ''\\\\n''; got it anyway @ line 43, column 28.\";\n+\n+    private static final String URL_PATTERN_1 = \"https://netbeans.apache.org/\";\n+    private static final String URL_PATTERN_2 = \"Hello https://netbeans.apache.org\";\n+    private static final String URL_PATTERN_3 = \"https://netbeans.apache.org then look at ftp://netbeans.apache.org/\";\n+    private static final String URL_PATTERN_4 = \"https://netbeans.apache.org then look at ftp://netbeans.apache.org/ and file:/home/netbeans \";\n+    private static final String URL_PATTERN_5 = \"https://netbeans.apache.org then look at ftp://netbeans.apache.org/ and file:///home/netbeans \";\n+\n+    @Test\n+    public void testJavaCompilerProcessor1() {\n+        GradleProcessorFactory.JavaCompilerProcessor jcp = new GradleProcessorFactory.JavaCompilerProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(jcp.processLine(od, JAVA_COMPILE_ERROR_1));\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(\"/home/netbeans/NetBeansProjects/gradleproject3/common/src/main/java/gradleproject3/common/NewClass1.java:1\", outputs[0].text);\n+        assertEquals(\": error: class, interface, or enum expected\", outputs[1].text);\n+    }\n+\n+    @Test\n+    public void testJavaCompilerProcessor2() {\n+        GradleProcessorFactory.JavaCompilerProcessor jcp = new GradleProcessorFactory.JavaCompilerProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(jcp.processLine(od, JAVA_COMPILE_ERROR_2));\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(\"D:\\\\Users\\\\netbeans\\\\NetBeansProjects\\\\gradleproject3\\\\common\\\\src\\\\main\\\\java\\\\gradleproject3\\\\common\\\\NewClass1.java:1\", outputs[0].text);\n+        assertEquals(\": error: class, interface, or enum expected\", outputs[1].text);\n+    }\n+\n+    @Test\n+    public void testJavaCompilerProcessor3() {\n+        GradleProcessorFactory.JavaCompilerProcessor jcp = new GradleProcessorFactory.JavaCompilerProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertFalse(jcp.processLine(od, GROOVY_COMPILE_ERROR_1));\n+    }\n+\n+    @Test\n+    public void testJavaCompilerProcessor4() {\n+        GradleProcessorFactory.JavaCompilerProcessor jcp = new GradleProcessorFactory.JavaCompilerProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertFalse(jcp.processLine(od, JAVA_8_STACKTRACE_1));\n+    }\n+\n+    @Test\n+    public void testGroovyCompilerProcessor1() {\n+        GradleProcessorFactory.GroovyCompilerProcessor gcp = new GradleProcessorFactory.GroovyCompilerProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(gcp.processLine(od, GROOVY_COMPILE_ERROR_1));\n+        assertEquals(GROOVY_COMPILE_ERROR_1, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(\"/home/netbeans/NetBeansProjects/netbeans/groovy/gradle/netbeans-gradle-tooling/src/main/groovy/org/netbeans/modules/gradle/tooling/NetBeansExplodedWarPlugin.groovy: 33\", outputs[0].text);\n+        assertNotNull(outputs[0].action);\n+        assertEquals(\": unable to resolve class Prject\", outputs[1].text);\n+    }\n+\n+    @Test\n+    public void testGroovyCompilerProcessor2() {\n+        GradleProcessorFactory.GroovyCompilerProcessor gcp = new GradleProcessorFactory.GroovyCompilerProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(gcp.processLine(od, GROOVY_COMPILE_ERROR_2));\n+        assertEquals(GROOVY_COMPILE_ERROR_2, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(\"/home/netbeans/NetBeansProjects/netbeans/groovy/gradle/netbeans-gradle-tooling/src/main/groovy/org/netbeans/modules/gradle/tooling/NetBeansExplodedWarPlugin.groovy: 43\", outputs[0].text);\n+        assertNotNull(outputs[0].action);\n+        assertEquals(\": expecting anything but ''\\\\n''; got it anyway @ line 43, column 28.\", outputs[1].text);\n+    }\n+\n+    @Test\n+    public void testGroovyCompilerProcessor3() {\n+        GradleProcessorFactory.GroovyCompilerProcessor gcp = new GradleProcessorFactory.GroovyCompilerProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertFalse(gcp.processLine(od, JAVA_COMPILE_ERROR_1));\n+    }\n+\n+    @Test\n+    public void testURLOutputProcessor1() {\n+        GradleProcessorFactory.URLOutputProcessor uop = new GradleProcessorFactory.URLOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertFalse(uop.processLine(od, JAVA_8_STACKTRACE_1));\n+    }\n+\n+    @Test\n+    public void testURLOutputProcessor2() {\n+        GradleProcessorFactory.URLOutputProcessor uop = new GradleProcessorFactory.URLOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertFalse(uop.processLine(od, JAVA_COMPILE_ERROR_1));\n+    }\n+\n+    @Test\n+    public void testURLOutputProcessor3() {\n+        GradleProcessorFactory.URLOutputProcessor uop = new GradleProcessorFactory.URLOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(uop.processLine(od, URL_PATTERN_1));\n+        assertEquals(URL_PATTERN_1, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(3, outputs.length);\n+        assertNotNull(outputs[1].action);\n+    }\n+\n+    @Test\n+    public void testURLOutputProcessor4() {\n+        GradleProcessorFactory.URLOutputProcessor uop = new GradleProcessorFactory.URLOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(uop.processLine(od, URL_PATTERN_2));\n+        assertEquals(URL_PATTERN_2, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertNotNull(outputs[1].action);\n+        assertEquals(3, outputs.length);\n+    }\n+\n+    @Test\n+    public void testURLOutputProcessor5() {\n+        GradleProcessorFactory.URLOutputProcessor uop = new GradleProcessorFactory.URLOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(uop.processLine(od, URL_PATTERN_3));\n+        assertEquals(URL_PATTERN_3, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(5, outputs.length);\n+        assertEquals(\" then look at \", outputs[2].text);\n+        assertNotNull(outputs[1].action);\n+        assertNotNull(outputs[3].action);\n+    }\n+\n+    @Test\n+    public void testURLOutputProcessor6() {\n+        GradleProcessorFactory.URLOutputProcessor uop = new GradleProcessorFactory.URLOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(uop.processLine(od, URL_PATTERN_4));\n+        assertEquals(URL_PATTERN_4, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(7, outputs.length);\n+        assertEquals(\" then look at \", outputs[2].text);\n+        assertNotNull(outputs[1].action);\n+        assertNotNull(outputs[3].action);\n+        assertNotNull(outputs[5].action);\n+        assertEquals(\"file:/home/netbeans\", outputs[5].text);\n+    }\n+\n+    @Test\n+    public void testURLOutputProcessor7() {\n+        GradleProcessorFactory.URLOutputProcessor uop = new GradleProcessorFactory.URLOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(uop.processLine(od, URL_PATTERN_5));\n+        assertEquals(URL_PATTERN_5, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(7, outputs.length);\n+        assertEquals(\" then look at \", outputs[2].text);\n+        assertNotNull(outputs[1].action);\n+        assertNotNull(outputs[3].action);\n+        assertNotNull(outputs[5].action);\n+        assertEquals(\"file:///home/netbeans\", outputs[5].text);\n+    }\n+\n+    @Test\n+    public void testGradleOutputProcessor1() {\n+        GradleProcessorFactory.GradleOutputProcessor uop = new GradleProcessorFactory.GradleOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertTrue(uop.processLine(od, GRADLE_SCRIPT_ERROR_1));\n+        assertEquals(GRADLE_SCRIPT_ERROR_1, od.getOutput());\n+        OutputDisplayerMock.OutputItem[] outputs = od.getOutputs();\n+        assertEquals(1, outputs.length);\n+        assertEquals(GRADLE_SCRIPT_ERROR_1, outputs[0].text);\n+    }\n+\n+    @Test\n+    public void testGradleOutputProcessor2() {\n+        GradleProcessorFactory.GradleOutputProcessor uop = new GradleProcessorFactory.GradleOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertFalse(uop.processLine(od, JAVA_COMPILE_ERROR_1));\n+    }\n+\n+    @Test\n+    public void testGradleOutputProcessor3() {\n+        GradleProcessorFactory.GradleOutputProcessor uop = new GradleProcessorFactory.GradleOutputProcessor();\n+        OutputDisplayerMock od = new OutputDisplayerMock();\n+        assertFalse(uop.processLine(od, JAVA_8_STACKTRACE_1));\n+    }\n+}", "filename": "groovy/gradle/test/unit/src/org/netbeans/modules/gradle/output/GradleProcessorFactoryTest.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/0bcf9fefe1012f1456446038f1645b3610e66b36", "parent": "https://github.com/apache/netbeans/commit/ab4e095492d8837c0237e77790f90fcefed9e954", "message": "Fix NPE if PAC cannot be resolved, e.g. UnknownHostException if the proxy url is configured but not reachable.", "bug_id": "netbeans_11", "file": [{"additions": 3, "raw_url": "https://github.com/apache/netbeans/raw/0bcf9fefe1012f1456446038f1645b3610e66b36/platform/core.network/src/org/netbeans/core/network/proxy/ProxyAutoConfig.java", "blob_url": "https://github.com/apache/netbeans/blob/0bcf9fefe1012f1456446038f1645b3610e66b36/platform/core.network/src/org/netbeans/core/network/proxy/ProxyAutoConfig.java", "sha": "992e9c1ab4911c94f894b78bf2669812ce1e8d4a", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/platform/core.network/src/org/netbeans/core/network/proxy/ProxyAutoConfig.java?ref=0bcf9fefe1012f1456446038f1645b3610e66b36", "patch": "@@ -138,6 +138,9 @@ public void run() {\n                 }\n             }\n         }\n+        if (evaluator == null) {\n+            return Collections.singletonList(Proxy.NO_PROXY);\n+        }\n         try {\n             return evaluator.findProxyForURL(u);\n         } catch (PacValidationException ex) {", "filename": "platform/core.network/src/org/netbeans/core/network/proxy/ProxyAutoConfig.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/cc23fcf0e4c9d626109237d078c942661d80f00b", "parent": "https://github.com/apache/netbeans/commit/11e08db2accb068c1e16cc33c30d0e54ce1d5505", "message": "[NETBEANS-1775] Fix for NPE\n\nSimple typo: '&' should have been '&&'. This caused an NPE\nwhen NetBeans was used with a VPN connection.", "bug_id": "netbeans_12", "file": [{"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/cc23fcf0e4c9d626109237d078c942661d80f00b/platform/core.network/src/org/netbeans/core/network/utils/LocalAddressUtils.java", "blob_url": "https://github.com/apache/netbeans/blob/cc23fcf0e4c9d626109237d078c942661d80f00b/platform/core.network/src/org/netbeans/core/network/utils/LocalAddressUtils.java", "sha": "a2a57cfe1f9532700337033eea082dbb45d5370d", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/platform/core.network/src/org/netbeans/core/network/utils/LocalAddressUtils.java?ref=cc23fcf0e4c9d626109237d078c942661d80f00b", "patch": "@@ -521,7 +521,7 @@ public static boolean isSoftwareVirtualAdapter(NetworkInterface nif) {\n             // (above from VirtualBox source code)\n             //\n             byte[] macAddress = nif.getHardwareAddress();\n-            if (macAddress != null & macAddress.length >= 3) {\n+            if (macAddress != null && macAddress.length >= 3) {\n                 if ((macAddress[0] == 0x0A || macAddress[0] == 0x08) &&\n                         (macAddress[1] == 0x00) &&\n                         (macAddress[2] == 0x27)) {                ", "filename": "platform/core.network/src/org/netbeans/core/network/utils/LocalAddressUtils.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/0988bf3599dc42aa00941d0e51c4783fa82ec75a", "parent": "https://github.com/apache/netbeans/commit/b43cf15213ae8189245952c411a6ed1ac0528abe", "message": "[NETBEANS-2466] Guard JavaSource.create() result against possible NPE.", "bug_id": "netbeans_13", "file": [{"additions": 5, "raw_url": "https://github.com/apache/netbeans/raw/0988bf3599dc42aa00941d0e51c4783fa82ec75a/java/java.api.common/src/org/netbeans/modules/java/api/common/project/ActionProviderSupport.java", "blob_url": "https://github.com/apache/netbeans/blob/0988bf3599dc42aa00941d0e51c4783fa82ec75a/java/java.api.common/src/org/netbeans/modules/java/api/common/project/ActionProviderSupport.java", "sha": "0e334dee8f3a9f603171e7ac491135dfc00c6973", "changes": 8, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.api.common/src/org/netbeans/modules/java/api/common/project/ActionProviderSupport.java?ref=0988bf3599dc42aa00941d0e51c4783fa82ec75a", "patch": "@@ -912,9 +912,11 @@ private static void invokeByJavaSource (\n             ClassPathSupport.createClassPath(new URL[0]),\n             ClassPathSupport.createClassPath(new URL[0]));\n         final JavaSource js = JavaSource.create(info);\n-        js.runWhenScanFinished((final CompilationController controller) -> {\n-            runnable.run();\n-        }, true);\n+        if (js != null) {\n+            js.runWhenScanFinished((final CompilationController controller) -> {\n+                runnable.run();\n+            }, true);\n+        }\n     }\n \n     @CheckForNull", "filename": "java/java.api.common/src/org/netbeans/modules/java/api/common/project/ActionProviderSupport.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/37663fd3479a7e9afa41b8abd2ced67db37f32c2", "parent": "https://github.com/apache/netbeans/commit/6c46711600084e3adeba805d06ffdde58144426b", "message": "[NETBEANS-2185] Preventing NPE on close.", "bug_id": "netbeans_14", "file": [{"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/37663fd3479a7e9afa41b8abd2ced67db37f32c2/ide/lsp.client/src/org/netbeans/modules/lsp/client/LSPBindings.java", "blob_url": "https://github.com/apache/netbeans/blob/37663fd3479a7e9afa41b8abd2ced67db37f32c2/ide/lsp.client/src/org/netbeans/modules/lsp/client/LSPBindings.java", "sha": "5889b9b60137f485d445b2791833534f7c742677", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/ide/lsp.client/src/org/netbeans/modules/lsp/client/LSPBindings.java?ref=37663fd3479a7e9afa41b8abd2ced67db37f32c2", "patch": "@@ -239,7 +239,7 @@ public void scheduleBackgroundTasks(FileObject file) {\n         public void run() {\n             for (Map<String, LSPBindings> mime2Bindings : project2MimeType2Server.values()) {\n                 for (LSPBindings b : mime2Bindings.values()) {\n-                    if (b != null) {\n+                    if (b != null && b.process != null) {\n                         b.process.destroy();\n                     }\n                 }", "filename": "ide/lsp.client/src/org/netbeans/modules/lsp/client/LSPBindings.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/ce81a893ec0c52935e80bf80709859318fa78215", "parent": "https://github.com/apache/netbeans/commit/3f107ec47fa8a640a2e424f16b23fe2e216ec198", "message": "[NETBEANS-2293] Fix possible NPE on selected method detection.", "bug_id": "netbeans_15", "file": [{"additions": 24, "raw_url": "https://github.com/apache/netbeans/raw/ce81a893ec0c52935e80bf80709859318fa78215/groovy/gradle.java/src/org/netbeans/modules/gradle/java/GradleJavaTokenProvider.java", "blob_url": "https://github.com/apache/netbeans/blob/ce81a893ec0c52935e80bf80709859318fa78215/groovy/gradle.java/src/org/netbeans/modules/gradle/java/GradleJavaTokenProvider.java", "sha": "8e79ed4681a5427fd2259446848518980b96d3f4", "changes": 86, "status": "modified", "deletions": 62, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle.java/src/org/netbeans/modules/gradle/java/GradleJavaTokenProvider.java?ref=ce81a893ec0c52935e80bf80709859318fa78215", "patch": "@@ -24,24 +24,13 @@\n import org.netbeans.modules.gradle.java.api.GradleJavaProject;\n import org.netbeans.modules.gradle.java.api.GradleJavaSourceSet;\n import org.netbeans.modules.gradle.spi.actions.ReplaceTokenProvider;\n-import com.sun.source.tree.CompilationUnitTree;\n-import com.sun.source.tree.Tree;\n-import com.sun.source.util.Trees;\n import java.io.File;\n-import java.io.IOException;\n import java.util.Arrays;\n import java.util.Collections;\n import java.util.HashMap;\n import java.util.HashSet;\n-import java.util.List;\n import java.util.Map;\n import java.util.Set;\n-import javax.lang.model.element.Element;\n-import javax.lang.model.element.ElementKind;\n-import javax.lang.model.element.TypeElement;\n-import org.netbeans.api.java.source.CompilationController;\n-import org.netbeans.api.java.source.JavaSource;\n-import org.netbeans.api.java.source.Task;\n import org.netbeans.api.project.Project;\n import org.netbeans.spi.project.ProjectServiceProvider;\n import org.netbeans.spi.project.SingleMethod;\n@@ -85,32 +74,20 @@ public GradleJavaTokenProvider(Project project) {\n     private void processSelectedPackageAndClass(final Map<String, String> map, Lookup context) {\n         FileObject fo = RunUtils.extractFileObjectfromLookup(context);\n         GradleJavaProject gjp = GradleJavaProject.get(project);\n-        if ((gjp != null) && (fo != null)) {\n-            File f = FileUtil.toFile(fo);\n-            GradleJavaSourceSet sourceSet = gjp.containingSourceSet(f);\n-            if (sourceSet != null)  {\n-                if (f.isFile()) {\n-                    String relPath = sourceSet.relativePath(f);\n-                    String className = (relPath.lastIndexOf('.') > 0 ?\n-                            relPath.substring(0, relPath.lastIndexOf('.')) :\n-                            relPath).replace('/', '.');\n-                    map.put(\"selectedClass\", className);  //NOI18N\n-                    f = f.getParentFile();\n-                } else {\n-                    String pkg = sourceSet.relativePath(f).replace('/', '.');\n-                    map.put(\"selectedClass\", pkg + \"*\"); //NOI18N\n-                }\n-            }\n+        String className = evaluateClassName(gjp, fo);\n+        if (className != null) {\n+            map.put(\"selectedClass\", className);\n         }\n     }\n \n-    private static void processSelectedMethod(final Map<String, String> map, Lookup context) {\n+    private void processSelectedMethod(final Map<String, String> map, Lookup context) {\n         SingleMethod method = context.lookup(SingleMethod.class);\n         FileObject fo = method != null ? method.getFile() : RunUtils.extractFileObjectfromLookup(context);\n-        String methodName = method != null ? method.getMethodName() : null;\n-        if (fo != null) {\n-             String selectedMethod = evaluateSingleMethod(fo, methodName);\n-             map.put(\"selectedMethod\", selectedMethod); //NOI18N\n+        if ((fo != null) && fo.isData()) {\n+            GradleJavaProject gjp = GradleJavaProject.get(project);\n+            String className = evaluateClassName(gjp, fo);\n+            String selectedMethod = method != null ? className + '.' + method.getMethodName() : className;\n+            map.put(\"selectedMethod\", selectedMethod);\n         }\n     }\n \n@@ -137,37 +114,22 @@ private void processSourceSets(final Map<String, String> map, Lookup context) {\n         }\n     }\n \n-    private static String evaluateSingleMethod(final FileObject fo, final String method) {\n-        final Object[] ret = new Object[1];\n-        JavaSource javaSource = JavaSource.forFileObject(fo);\n-        if (javaSource != null) {\n-            try {\n-                javaSource.runUserActionTask(new Task<CompilationController>() {\n-                    @Override\n-                    public void run(CompilationController compilationController) throws Exception {\n-                        compilationController.toPhase(JavaSource.Phase.ELEMENTS_RESOLVED);\n-                        Trees trees = compilationController.getTrees();\n-                        CompilationUnitTree compilationUnitTree = compilationController.getCompilationUnit();\n-                        List<? extends Tree> typeDecls = compilationUnitTree.getTypeDecls();\n-                        for (Tree tree : typeDecls) {\n-                            Element element = trees.getElement(trees.getPath(compilationUnitTree, tree));\n-                            if (element != null && element.getKind() == ElementKind.CLASS && element.getSimpleName().contentEquals(fo.getName())) {\n-                                TypeElement type = (TypeElement) element;\n-                                StringBuilder sb = new StringBuilder(type.getQualifiedName());\n-                                if (method != null) {\n-                                    sb.append('.').append(method);\n-                                }\n-                                ret[0] = sb.toString();\n-                                break;\n-                            }\n-                        }\n-                    }\n-                }, true);\n-                return ret[0].toString();\n-            } catch (IOException ioe) {\n-                //TODO: Do nothing?\n+    private String evaluateClassName(GradleJavaProject gjp, FileObject fo) {\n+        String ret = null;\n+        if ((gjp != null) && (fo != null)) {\n+            File f = FileUtil.toFile(fo);\n+            GradleJavaSourceSet sourceSet = gjp.containingSourceSet(f);\n+            if (sourceSet != null) {\n+                String relPath = sourceSet.relativePath(f);\n+                ret = (relPath.lastIndexOf('.') > 0 ?\n+                        relPath.substring(0, relPath.lastIndexOf('.')) :\n+                        relPath).replace('/', '.');\n+                if (fo.isFolder()) {\n+                    ret = ret + '*';\n+                }\n             }\n         }\n-        return null;\n+        return ret;\n     }\n+\n }", "filename": "groovy/gradle.java/src/org/netbeans/modules/gradle/java/GradleJavaTokenProvider.java"}, {"additions": 2, "raw_url": "https://github.com/apache/netbeans/raw/ce81a893ec0c52935e80bf80709859318fa78215/groovy/gradle.java/src/org/netbeans/modules/gradle/java/action-mapping.xml", "blob_url": "https://github.com/apache/netbeans/blob/ce81a893ec0c52935e80bf80709859318fa78215/groovy/gradle.java/src/org/netbeans/modules/gradle/java/action-mapping.xml", "sha": "3a616bd51f74e8b6a6dfbf3ef94bb12b8e38c09b", "changes": 4, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle.java/src/org/netbeans/modules/gradle/java/action-mapping.xml?ref=ce81a893ec0c52935e80bf80709859318fa78215", "patch": "@@ -40,12 +40,12 @@\n         </action>\n \n         <action name=\"debug.fix\" repeatable=\"false\">\n-            <args>--offline --no-rebuild ${affectedBuildTasks}</args>\n+            <args>--offline ${affectedBuildTasks}</args>\n             <reload rule=\"NEVER\"/>\n         </action>\n \n         <action name=\"compile.single\" repetable=\"false\">\n-            <args>--offline --no-rebuild ${affectedBuildTasks}</args>\n+            <args>--offline ${affectedBuildTasks}</args>\n             <reload rule=\"NEVER\"/>\n         </action>\n ", "filename": "groovy/gradle.java/src/org/netbeans/modules/gradle/java/action-mapping.xml"}, {"additions": 26, "raw_url": "https://github.com/apache/netbeans/raw/ce81a893ec0c52935e80bf80709859318fa78215/groovy/gradle.java/src/org/netbeans/modules/gradle/java/api/output/LocationOpener.java", "blob_url": "https://github.com/apache/netbeans/blob/ce81a893ec0c52935e80bf80709859318fa78215/groovy/gradle.java/src/org/netbeans/modules/gradle/java/api/output/LocationOpener.java", "sha": "0974c80f97ed81c642e6d42bcd04e87ca076aacd", "changes": 58, "status": "modified", "deletions": 32, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle.java/src/org/netbeans/modules/gradle/java/api/output/LocationOpener.java?ref=ce81a893ec0c52935e80bf80709859318fa78215", "patch": "@@ -85,23 +85,20 @@ private int getMethodLine(final FileObject fo, final String methodName) {\n         JavaSource javaSource = JavaSource.forFileObject(fo);\n         if (javaSource != null) {\n             try {\n-                javaSource.runUserActionTask(new Task<CompilationController>() {\n-                    @Override\n-                    public void run(CompilationController compilationController) throws Exception {\n-                        compilationController.toPhase(JavaSource.Phase.ELEMENTS_RESOLVED);\n-                        Trees trees = compilationController.getTrees();\n-                        CompilationUnitTree compilationUnitTree = compilationController.getCompilationUnit();\n-                        List<? extends Tree> typeDecls = compilationUnitTree.getTypeDecls();\n-                        for (Tree tree : typeDecls) {\n-                            Element element = trees.getElement(trees.getPath(compilationUnitTree, tree));\n-                            if (element != null && element.getKind() == ElementKind.CLASS && element.getSimpleName().contentEquals(fo.getName())) {\n-                                List<? extends ExecutableElement> methodElements = ElementFilter.methodsIn(element.getEnclosedElements());\n-                                for (Element child : methodElements) {\n-                                    if (child.getSimpleName().contentEquals(methodName)) {\n-                                        long pos = trees.getSourcePositions().getStartPosition(compilationUnitTree, trees.getTree(child));\n-                                        line[0] = (int) compilationUnitTree.getLineMap().getLineNumber(pos);\n-                                        break;\n-                                    }\n+                javaSource.runUserActionTask((CompilationController compilationController) -> {\n+                    compilationController.toPhase(JavaSource.Phase.ELEMENTS_RESOLVED);\n+                    Trees trees = compilationController.getTrees();\n+                    CompilationUnitTree compilationUnitTree = compilationController.getCompilationUnit();\n+                    List<? extends Tree> typeDecls = compilationUnitTree.getTypeDecls();\n+                    for (Tree tree : typeDecls) {\n+                        Element element = trees.getElement(trees.getPath(compilationUnitTree, tree));\n+                        if (element != null && element.getKind() == ElementKind.CLASS && element.getSimpleName().contentEquals(fo.getName())) {\n+                            List<? extends ExecutableElement> methodElements = ElementFilter.methodsIn(element.getEnclosedElements());\n+                            for (Element child : methodElements) {\n+                                if (child.getSimpleName().contentEquals(methodName)) {\n+                                    long pos = trees.getSourcePositions().getStartPosition(compilationUnitTree, trees.getTree(child));\n+                                    line[0] = (int) compilationUnitTree.getLineMap().getLineNumber(pos);\n+                                    break;\n                                 }\n                             }\n                         }\n@@ -120,20 +117,17 @@ private int getTargetLine(final FileObject fo) {\n         JavaSource javaSource = JavaSource.forFileObject(fo);\n         if (javaSource != null) {\n             try {\n-                javaSource.runUserActionTask(new Task<CompilationController>() {\n-                    @Override\n-                    public void run(CompilationController compilationController) throws Exception {\n-                        compilationController.toPhase(JavaSource.Phase.ELEMENTS_RESOLVED);\n-                        Trees trees = compilationController.getTrees();\n-                        CompilationUnitTree compilationUnitTree = compilationController.getCompilationUnit();\n-                        List<? extends Tree> typeDecls = compilationUnitTree.getTypeDecls();\n-                        for (Tree tree : typeDecls) {\n-                            Element element = trees.getElement(trees.getPath(compilationUnitTree, tree));\n-                            if (element != null && element.getKind() == ElementKind.CLASS && element.getSimpleName().contentEquals(fo.getName())) {\n-                                long pos = trees.getSourcePositions().getStartPosition(compilationUnitTree, tree);\n-                                line[0] = (int) compilationUnitTree.getLineMap().getLineNumber(pos);\n-                                break;\n-                            }\n+                javaSource.runUserActionTask((CompilationController compilationController) -> {\n+                    compilationController.toPhase(JavaSource.Phase.ELEMENTS_RESOLVED);\n+                    Trees trees = compilationController.getTrees();\n+                    CompilationUnitTree compilationUnitTree = compilationController.getCompilationUnit();\n+                    List<? extends Tree> typeDecls = compilationUnitTree.getTypeDecls();\n+                    for (Tree tree : typeDecls) {\n+                        Element element = trees.getElement(trees.getPath(compilationUnitTree, tree));\n+                        if (element != null && element.getKind() == ElementKind.CLASS && element.getSimpleName().contentEquals(fo.getName())) {\n+                            long pos = trees.getSourcePositions().getStartPosition(compilationUnitTree, tree);\n+                            line[0] = (int) compilationUnitTree.getLineMap().getLineNumber(pos);\n+                            break;\n                         }\n                     }\n                 }, true);\n@@ -147,7 +141,7 @@ public void run(CompilationController compilationController) throws Exception {\n     public static void openAtLine(FileObject file, final int line) {\n         openAtLine(file, line, false);\n     }\n-    \n+\n     public static void openAtLine(FileObject file, final int line, final boolean reuse) {\n         try {\n             DataObject data = DataObject.find(file);", "filename": "groovy/gradle.java/src/org/netbeans/modules/gradle/java/api/output/LocationOpener.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/a2af32da3af7e818b86bba234aa45639d3ed4ca2", "parent": "https://github.com/apache/netbeans/commit/a50d777343e1ee0f9248344d4b17f779d1e78adf", "message": "[NETBEANS-2350]NPE while doing auto complete in rule switch block", "bug_id": "netbeans_16", "file": [{"additions": 8, "raw_url": "https://github.com/apache/netbeans/raw/a2af32da3af7e818b86bba234aa45639d3ed4ca2/java/java.completion/src/org/netbeans/modules/java/completion/JavaCompletionTask.java", "blob_url": "https://github.com/apache/netbeans/blob/a2af32da3af7e818b86bba234aa45639d3ed4ca2/java/java.completion/src/org/netbeans/modules/java/completion/JavaCompletionTask.java", "sha": "ddfd78aa4b9230248941ab3beda9cbf62e39969c", "changes": 9, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.completion/src/org/netbeans/modules/java/completion/JavaCompletionTask.java?ref=a2af32da3af7e818b86bba234aa45639d3ed4ca2", "patch": "@@ -2293,7 +2293,14 @@ private void insideSwitch(Env env) throws IOException {\n             }\n             if (lastCase != null) {\n                 StatementTree last = null;\n-                for (StatementTree stat : lastCase.getStatements()) {\n+                List<? extends StatementTree> statements = lastCase.getStatements();\n+                if (statements == null) {\n+                    Tree caseBody = TreeShims.getBody(lastCase);\n+                    if (caseBody instanceof StatementTree) {\n+                        statements = Collections.singletonList((StatementTree) caseBody);\n+                    }\n+                }\n+                for (StatementTree stat : statements) {\n                     int pos = (int) sourcePositions.getStartPosition(root, stat);\n                     if (pos == Diagnostic.NOPOS || offset <= pos) {\n                         break;", "filename": "java/java.completion/src/org/netbeans/modules/java/completion/JavaCompletionTask.java"}, {"additions": 2, "raw_url": "https://github.com/apache/netbeans/raw/a2af32da3af7e818b86bba234aa45639d3ed4ca2/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/1.7/ruleSwitchAutoCompleteCaseValues.pass", "blob_url": "https://github.com/apache/netbeans/blob/a2af32da3af7e818b86bba234aa45639d3ed4ca2/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/1.7/ruleSwitchAutoCompleteCaseValues.pass", "sha": "9ce5b1998d5fc3ef3e8d3e62ec1d022ec49995f6", "changes": 2, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/1.7/ruleSwitchAutoCompleteCaseValues.pass?ref=a2af32da3af7e818b86bba234aa45639d3ed4ca2", "patch": "@@ -0,0 +1,2 @@\n+case\n+", "filename": "java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/1.7/ruleSwitchAutoCompleteCaseValues.pass"}, {"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/a2af32da3af7e818b86bba234aa45639d3ed4ca2/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/1.8/ruleSwitchAutoCompleteCaseValues.pass", "blob_url": "https://github.com/apache/netbeans/blob/a2af32da3af7e818b86bba234aa45639d3ed4ca2/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/1.8/ruleSwitchAutoCompleteCaseValues.pass", "sha": "9a333834d7f76d26bf24f07f0d8ab00010e78b91", "changes": 1, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/1.8/ruleSwitchAutoCompleteCaseValues.pass?ref=a2af32da3af7e818b86bba234aa45639d3ed4ca2", "patch": "@@ -0,0 +1 @@\n+case", "filename": "java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/1.8/ruleSwitchAutoCompleteCaseValues.pass"}, {"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/a2af32da3af7e818b86bba234aa45639d3ed4ca2/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/10/ruleSwitchAutoCompleteCaseValues.pass", "blob_url": "https://github.com/apache/netbeans/blob/a2af32da3af7e818b86bba234aa45639d3ed4ca2/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/10/ruleSwitchAutoCompleteCaseValues.pass", "sha": "9a333834d7f76d26bf24f07f0d8ab00010e78b91", "changes": 1, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/10/ruleSwitchAutoCompleteCaseValues.pass?ref=a2af32da3af7e818b86bba234aa45639d3ed4ca2", "patch": "@@ -0,0 +1 @@\n+case", "filename": "java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/10/ruleSwitchAutoCompleteCaseValues.pass"}, {"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/a2af32da3af7e818b86bba234aa45639d3ed4ca2/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/11/ruleSwitchAutoCompleteCaseValues.pass", "blob_url": "https://github.com/apache/netbeans/blob/a2af32da3af7e818b86bba234aa45639d3ed4ca2/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/11/ruleSwitchAutoCompleteCaseValues.pass", "sha": "9a333834d7f76d26bf24f07f0d8ab00010e78b91", "changes": 1, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/11/ruleSwitchAutoCompleteCaseValues.pass?ref=a2af32da3af7e818b86bba234aa45639d3ed4ca2", "patch": "@@ -0,0 +1 @@\n+case", "filename": "java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/11/ruleSwitchAutoCompleteCaseValues.pass"}, {"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/a2af32da3af7e818b86bba234aa45639d3ed4ca2/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/12/ruleSwitchAutoCompleteCaseValues.pass", "blob_url": "https://github.com/apache/netbeans/blob/a2af32da3af7e818b86bba234aa45639d3ed4ca2/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/12/ruleSwitchAutoCompleteCaseValues.pass", "sha": "9a333834d7f76d26bf24f07f0d8ab00010e78b91", "changes": 1, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/12/ruleSwitchAutoCompleteCaseValues.pass?ref=a2af32da3af7e818b86bba234aa45639d3ed4ca2", "patch": "@@ -0,0 +1 @@\n+case", "filename": "java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/12/ruleSwitchAutoCompleteCaseValues.pass"}, {"additions": 33, "raw_url": "https://github.com/apache/netbeans/raw/a2af32da3af7e818b86bba234aa45639d3ed4ca2/java/java.completion/test/unit/data/org/netbeans/modules/java/completion/data/RuleSwitchAutoCompleteCaseValue.java", "blob_url": "https://github.com/apache/netbeans/blob/a2af32da3af7e818b86bba234aa45639d3ed4ca2/java/java.completion/test/unit/data/org/netbeans/modules/java/completion/data/RuleSwitchAutoCompleteCaseValue.java", "sha": "8a5c95d9b2d5917b9452a8299f7109d755f26022", "changes": 33, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.completion/test/unit/data/org/netbeans/modules/java/completion/data/RuleSwitchAutoCompleteCaseValue.java?ref=a2af32da3af7e818b86bba234aa45639d3ed4ca2", "patch": "@@ -0,0 +1,33 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package test;\n+\n+public class Test {\n+\n+    enum colors {RED, GREEN, BLUE}\n+\n+    public void op(int a) {\n+        colors color = colors.RED;\n+        switch (color) {\n+            case RED -> a = 10;\n+                \n+\t}\n+    }\n+}", "filename": "java/java.completion/test/unit/data/org/netbeans/modules/java/completion/data/RuleSwitchAutoCompleteCaseValue.java"}, {"additions": 4, "raw_url": "https://github.com/apache/netbeans/raw/a2af32da3af7e818b86bba234aa45639d3ed4ca2/java/java.completion/test/unit/src/org/netbeans/modules/java/completion/JavaCompletionTask112FeaturesTest.java", "blob_url": "https://github.com/apache/netbeans/blob/a2af32da3af7e818b86bba234aa45639d3ed4ca2/java/java.completion/test/unit/src/org/netbeans/modules/java/completion/JavaCompletionTask112FeaturesTest.java", "sha": "242a2bc7072ad19e37ed40f4ccbf5183b9551472", "changes": 4, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.completion/test/unit/src/org/netbeans/modules/java/completion/JavaCompletionTask112FeaturesTest.java?ref=a2af32da3af7e818b86bba234aa45639d3ed4ca2", "patch": "@@ -73,6 +73,10 @@ public void testRuleSwitchMultiEnumCaseValue() throws Exception {\n         performTest(\"RuleSwitchWithMultiEnumValues\", 1024, null, \"ruleSwitchEnumCaseValues.pass\");\n     }\n \n+    public void testRuleSwitchAutoCompleteCaseValue() throws Exception {\n+        performTest(\"RuleSwitchAutoCompleteCaseValue\", 1013, \"ca\", \"ruleSwitchAutoCompleteCaseValues.pass\");\n+    }\n+\n     public void noop() {\n     }\n ", "filename": "java/java.completion/test/unit/src/org/netbeans/modules/java/completion/JavaCompletionTask112FeaturesTest.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/8fa7812c140977cf7962a548c10a65c9bd732d34", "parent": "https://github.com/apache/netbeans/commit/53f4d8faf53842342b5b972ce114e7e877bd8618", "message": "[NETBEANS-586]: NPE findUsages (#1016)\n\n* [NETBEANS-586]: NPE findUsages\r\n\r\n* Update FindUsagesVisitor.java\r\n\r\n* [NETBEANS-586] NPE findUsages", "bug_id": "netbeans_17", "file": [{"additions": 4, "raw_url": "https://github.com/apache/netbeans/raw/8fa7812c140977cf7962a548c10a65c9bd732d34/java/refactoring.java/src/org/netbeans/modules/refactoring/java/plugins/FindUsagesVisitor.java", "blob_url": "https://github.com/apache/netbeans/blob/8fa7812c140977cf7962a548c10a65c9bd732d34/java/refactoring.java/src/org/netbeans/modules/refactoring/java/plugins/FindUsagesVisitor.java", "sha": "422b5609de373dd83d8f8d31bf62dd3643fb6748", "changes": 11, "status": "modified", "deletions": 7, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/refactoring.java/src/org/netbeans/modules/refactoring/java/plugins/FindUsagesVisitor.java?ref=8fa7812c140977cf7962a548c10a65c9bd732d34", "patch": "@@ -393,13 +393,10 @@ public Tree visitNewClass(NewClassTree node, Element p) {\n         Trees trees = workingCopy.getTrees();\n         ClassTree classTree = ((NewClassTree) node).getClassBody();\n         if (classTree != null && p.getKind() == ElementKind.CONSTRUCTOR) {\n-            Element anonClass = workingCopy.getTrees().getElement(TreePath.getPath(workingCopy.getCompilationUnit(), classTree));\n-            if (anonClass == null) {\n-                Logger.getLogger(\"org.netbeans.modules.refactoring.java\").log(Level.SEVERE, \"FindUsages cannot resolve {0}\", classTree); // NOI18N\n-            } else {\n-                for (ExecutableElement c : ElementFilter.constructorsIn(anonClass.getEnclosedElements())) {\n-                    MethodTree t = workingCopy.getTrees().getTree(c);\n-                    TreePath superCall = trees.getPath(workingCopy.getCompilationUnit(), ((ExpressionStatementTree) t.getBody().getStatements().get(0)).getExpression());\n+            for (Tree t : classTree.getMembers()) {\n+                Element elem = workingCopy.getTrees().getElement(TreePath.getPath(workingCopy.getCompilationUnit(), t));\n+                if (elem.getKind() == ElementKind.CONSTRUCTOR) {\n+                    TreePath superCall = trees.getPath(workingCopy.getCompilationUnit(), ((ExpressionStatementTree) ((MethodTree) t).getBody().getStatements().get(0)).getExpression());\n                     Element superCallElement = trees.getElement(superCall);\n                     if (superCallElement != null && superCallElement.equals(p) && !workingCopy.getTreeUtilities().isSynthetic(superCall)) {\n                         addUsage(superCall);", "filename": "java/refactoring.java/src/org/netbeans/modules/refactoring/java/plugins/FindUsagesVisitor.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/8b7f076e1dfc363ad8ab5cc06bba4f729e9884bc", "parent": "https://github.com/apache/netbeans/commit/11e08db2accb068c1e16cc33c30d0e54ce1d5505", "message": "Merge pull request #1189 from lbruun/NETBEANS-1775-fix\n\n[NETBEANS-1775] Fix for NPE", "bug_id": "netbeans_18", "file": [{"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/8b7f076e1dfc363ad8ab5cc06bba4f729e9884bc/platform/core.network/src/org/netbeans/core/network/utils/LocalAddressUtils.java", "blob_url": "https://github.com/apache/netbeans/blob/8b7f076e1dfc363ad8ab5cc06bba4f729e9884bc/platform/core.network/src/org/netbeans/core/network/utils/LocalAddressUtils.java", "sha": "a2a57cfe1f9532700337033eea082dbb45d5370d", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/platform/core.network/src/org/netbeans/core/network/utils/LocalAddressUtils.java?ref=8b7f076e1dfc363ad8ab5cc06bba4f729e9884bc", "patch": "@@ -521,7 +521,7 @@ public static boolean isSoftwareVirtualAdapter(NetworkInterface nif) {\n             // (above from VirtualBox source code)\n             //\n             byte[] macAddress = nif.getHardwareAddress();\n-            if (macAddress != null & macAddress.length >= 3) {\n+            if (macAddress != null && macAddress.length >= 3) {\n                 if ((macAddress[0] == 0x0A || macAddress[0] == 0x08) &&\n                         (macAddress[1] == 0x00) &&\n                         (macAddress[2] == 0x27)) {                ", "filename": "platform/core.network/src/org/netbeans/core/network/utils/LocalAddressUtils.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/2fa2a71edc8c2ce1d1597d0d0f9a0707cea4c45a", "parent": "https://github.com/apache/netbeans/commit/4deb79abbe89a149ac3caa45db18c6b39df5ac4c", "message": "[NETBEANS-2220] Preventing NPE when there is no item at the specified cell in the table.", "bug_id": "netbeans_19", "file": [{"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/2fa2a71edc8c2ce1d1597d0d0f9a0707cea4c45a/platform/o.n.swing.tabcontrol/src/org/netbeans/swing/tabcontrol/DocumentSwitcherTable.java", "blob_url": "https://github.com/apache/netbeans/blob/2fa2a71edc8c2ce1d1597d0d0f9a0707cea4c45a/platform/o.n.swing.tabcontrol/src/org/netbeans/swing/tabcontrol/DocumentSwitcherTable.java", "sha": "11ee0ffc02939699ca9de48a47071e6573ee748f", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/platform/o.n.swing.tabcontrol/src/org/netbeans/swing/tabcontrol/DocumentSwitcherTable.java?ref=2fa2a71edc8c2ce1d1597d0d0f9a0707cea4c45a", "patch": "@@ -85,7 +85,7 @@ boolean onMouseEvent( MouseEvent e ) {\n             return false;\n         Item item = ( Item ) getModel().getValueAt( selRow, selCol );\n         // #268040 - check whether the item is closable\n-        if (isClosable(item)) {\n+        if (null != item && isClosable(item)) {\n             Rectangle rect = getCellRect( selRow, selCol, false );\n             if( rect.contains( p ) ) {\n                 Dimension size = btnClose.getPreferredSize();", "filename": "platform/o.n.swing.tabcontrol/src/org/netbeans/swing/tabcontrol/DocumentSwitcherTable.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/d83c8a8f47a9abad9a2174a78907e8764d06ba46", "parent": "https://github.com/apache/netbeans/commit/a760f722373cff71180b0a5c9843373dabb19e95", "message": "Trivial fix for NPE on some Gradle Action execution", "bug_id": "netbeans_20", "file": [{"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/d83c8a8f47a9abad9a2174a78907e8764d06ba46/groovy/gradle/src/org/netbeans/modules/gradle/api/execute/GradleCommandLine.java", "blob_url": "https://github.com/apache/netbeans/blob/d83c8a8f47a9abad9a2174a78907e8764d06ba46/groovy/gradle/src/org/netbeans/modules/gradle/api/execute/GradleCommandLine.java", "sha": "574bffec30c85688dcc0f1574cab6ec3fdc12b50", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle/src/org/netbeans/modules/gradle/api/execute/GradleCommandLine.java?ref=d83c8a8f47a9abad9a2174a78907e8764d06ba46", "patch": "@@ -96,7 +96,7 @@\n         RECOMPILE_SCRIPTS(UNSUPPORTED, \"--recompile-scripts\"),\n         VERSION(UNSUPPORTED, \"--version\", \"-v\");\n \n-        private Set<Flag> incompatible;\n+        private Set<Flag> incompatible = Collections.emptySet();\n         private final Argument.Kind kind;\n         private final List<String> flags;\n         static {", "filename": "groovy/gradle/src/org/netbeans/modules/gradle/api/execute/GradleCommandLine.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/cd48e225be0ae95fa2e978117369ba8dc5e3574a", "parent": "https://github.com/apache/netbeans/commit/93192ad1b8b586d339ebc0afa8e24712ee89e1af", "message": "Handle the NPE cases when the default Gradle distribution is not available.", "bug_id": "netbeans_21", "file": [{"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/cd48e225be0ae95fa2e978117369ba8dc5e3574a/groovy/gradle/src/org/netbeans/modules/gradle/classpath/AbstractGradleScriptClassPath.java", "blob_url": "https://github.com/apache/netbeans/blob/cd48e225be0ae95fa2e978117369ba8dc5e3574a/groovy/gradle/src/org/netbeans/modules/gradle/classpath/AbstractGradleScriptClassPath.java", "sha": "9a7f1d5f1828adfa2461ce61feeb661ceea424a8", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle/src/org/netbeans/modules/gradle/classpath/AbstractGradleScriptClassPath.java?ref=cd48e225be0ae95fa2e978117369ba8dc5e3574a", "patch": "@@ -104,7 +104,7 @@ public void propertyChange(PropertyChangeEvent evt) {\n     public final List<? extends PathResourceImplementation> getResources() {\n         if (resources == null) {\n             resources = new ArrayList<>();\n-            if (distDir.isDirectory()) {\n+            if ((distDir !=null) && distDir.isDirectory()) {\n                 for (FileObject fo : createPath()) {\n                     resources.add(ClassPathSupport.createResource(fo.toURL()));\n                 }", "filename": "groovy/gradle/src/org/netbeans/modules/gradle/classpath/AbstractGradleScriptClassPath.java"}, {"additions": 14, "raw_url": "https://github.com/apache/netbeans/raw/cd48e225be0ae95fa2e978117369ba8dc5e3574a/groovy/gradle/src/org/netbeans/modules/gradle/classpath/ScriptClassPathProvider.java", "blob_url": "https://github.com/apache/netbeans/blob/cd48e225be0ae95fa2e978117369ba8dc5e3574a/groovy/gradle/src/org/netbeans/modules/gradle/classpath/ScriptClassPathProvider.java", "sha": "5c4fd75772433d59e03e23867640458c39fa795f", "changes": 24, "status": "modified", "deletions": 10, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle/src/org/netbeans/modules/gradle/classpath/ScriptClassPathProvider.java?ref=cd48e225be0ae95fa2e978117369ba8dc5e3574a", "patch": "@@ -42,7 +42,7 @@\n public class ScriptClassPathProvider implements ClassPathProvider {\n \n     private static final String GRADLE_EXT = \"gradle\";\n-    \n+\n     final ClassPath BOOT_CP;\n     final ClassPath GRADLE_CP;\n     final ClassPath SOURCE_CP;\n@@ -56,7 +56,7 @@ public ScriptClassPathProvider() {\n     }\n \n     HashMap<FileObject, ClassPath> cache = new HashMap<>();\n-    \n+\n     @Override\n     public ClassPath findClassPath(FileObject fo, String type) {\n         if (\"classpath/html5\".equals(type)) {\n@@ -72,7 +72,7 @@ public ClassPath findClassPath(FileObject fo, String type) {\n                 case ClassPath.BOOT:    return BOOT_CP;\n                 case ClassPath.SOURCE:  return SOURCE_CP;\n                 case ClassPath.COMPILE: return GRADLE_CP;\n-                case ClassPath.EXECUTE: return GRADLE_CP;                    \n+                case ClassPath.EXECUTE: return GRADLE_CP;\n                 }\n                 }\n         return null;\n@@ -87,11 +87,13 @@ public ClassPath findClassPath(FileObject fo, String type) {\n         @Override\n         protected List<FileObject> createPath() {\n             List<FileObject> ret = new ArrayList<>();\n-            FileObject srcDir = FileUtil.toFileObject(new File(distDir, \"src\"));\n-            if ((srcDir != null) && srcDir.isFolder()) {\n-                Enumeration<? extends FileObject> folders = srcDir.getFolders(false);\n-                while (folders.hasMoreElements()) {\n-                    ret.add(folders.nextElement());\n+            if (distDir != null) {\n+                FileObject srcDir = FileUtil.toFileObject(new File(distDir, \"src\"));\n+                if ((srcDir != null) && srcDir.isFolder()) {\n+                    Enumeration<? extends FileObject> folders = srcDir.getFolders(false);\n+                    while (folders.hasMoreElements()) {\n+                        ret.add(folders.nextElement());\n+                    }\n                 }\n             }\n             return ret;\n@@ -103,8 +105,10 @@ public ClassPath findClassPath(FileObject fo, String type) {\n         @Override\n         protected List<FileObject> createPath() {\n             List<FileObject> ret = new ArrayList<>();\n-            addJars(ret, FileUtil.toFileObject(new File(distDir, \"lib\")));\n-            addJars(ret, FileUtil.toFileObject(new File(distDir, \"lib/plugins\")));\n+            if (distDir != null) {\n+                addJars(ret, FileUtil.toFileObject(new File(distDir, \"lib\")));\n+                addJars(ret, FileUtil.toFileObject(new File(distDir, \"lib/plugins\")));\n+            }\n             return ret;\n         }\n ", "filename": "groovy/gradle/src/org/netbeans/modules/gradle/classpath/ScriptClassPathProvider.java"}, {"additions": 4, "raw_url": "https://github.com/apache/netbeans/raw/cd48e225be0ae95fa2e978117369ba8dc5e3574a/groovy/gradle/src/org/netbeans/modules/gradle/queries/GradleSourceForBinary.java", "blob_url": "https://github.com/apache/netbeans/blob/cd48e225be0ae95fa2e978117369ba8dc5e3574a/groovy/gradle/src/org/netbeans/modules/gradle/queries/GradleSourceForBinary.java", "sha": "5be571c9882b8994a248f1af06fc89bec56188f3", "changes": 6, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/groovy/gradle/src/org/netbeans/modules/gradle/queries/GradleSourceForBinary.java?ref=cd48e225be0ae95fa2e978117369ba8dc5e3574a", "patch": "@@ -19,6 +19,7 @@\n \n package org.netbeans.modules.gradle.queries;\n \n+import java.io.File;\n import java.net.URI;\n import java.net.URISyntaxException;\n import java.net.URL;\n@@ -55,8 +56,9 @@ public GradleSourceForBinary() {\n     @Override\n     public Result findSourceRoots2(URL binaryRoot) {\n         Res ret = cache.get(binaryRoot);\n-        if (ret == null) {\n-            FileObject distDir = FileUtil.toFileObject(RunUtils.evaluateGradleDistribution(null, false));\n+        File dist = RunUtils.evaluateGradleDistribution(null, false);\n+        if ((ret == null) && (dist != null)) {\n+            FileObject distDir = FileUtil.toFileObject(dist);\n             FileObject srcDir = distDir == null ? null : distDir.getFileObject(\"src\"); //NOI18N\n             if ((srcDir != null) && (\"jar\".equals(binaryRoot.getProtocol()))) {  //NOI18N\n ", "filename": "groovy/gradle/src/org/netbeans/modules/gradle/queries/GradleSourceForBinary.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/d305cd16e9a4ab88a71ced7e7b8622d26542b2f1", "parent": "https://github.com/apache/netbeans/commit/d7d467c342a7ab4d0759f67c276d4d75ef8fb275", "message": "[NETBEANS-1586] Make ImageUtilities.createDisabledIcon work with HiDPI icons\n\nIntroduced a FilteredIcon class which extends from a new CachedHiDPIIcon class.\nThe CachedHiDPIIcon class will be used again in the future; it was originally\ndesigned for an SVG-based Icon implementation, which will be contributed\nseparately in the future. It is generic enough to work with any kind of custom\nIcon implementation that needs caching.\n\nAlso make color filtering of icons for dark themes work with HiDPI icons, using\nthe same FilteredIcon class.\n\nAlso improved a null handling case in ImageUtilities.loadImage. Passing a null\nresource used to be valid before (yielding a null return value), but caused a\nNPE on dark LAFs. Since it worked in the common non-dark case, it should\narguably work in the dark case as well. This might fix NETBEANS-2401, or it\nmight just lead to an NPE elsewhere in that case.", "bug_id": "netbeans_22", "file": [{"additions": 211, "raw_url": "https://github.com/apache/netbeans/raw/d305cd16e9a4ab88a71ced7e7b8622d26542b2f1/platform/openide.util.ui/src/org/openide/util/CachedHiDPIIcon.java", "blob_url": "https://github.com/apache/netbeans/blob/d305cd16e9a4ab88a71ced7e7b8622d26542b2f1/platform/openide.util.ui/src/org/openide/util/CachedHiDPIIcon.java", "sha": "ecce663bcc761bd4656eb28751121f6b48b5edea", "changes": 211, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/platform/openide.util.ui/src/org/openide/util/CachedHiDPIIcon.java?ref=d305cd16e9a4ab88a71ced7e7b8622d26542b2f1", "patch": "@@ -0,0 +1,211 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.openide.util;\n+\n+import java.awt.Component;\n+import java.awt.Graphics;\n+import java.awt.Graphics2D;\n+import java.awt.GraphicsConfiguration;\n+import java.awt.Image;\n+import java.awt.geom.AffineTransform;\n+import java.util.Iterator;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import java.util.Objects;\n+import javax.swing.Icon;\n+import javax.swing.ImageIcon;\n+\n+/**\n+ * Abstract base class for {@link javax.swing.Icon} implementations that need to cache scaled bitmap\n+ * representations for HiDPI displays. Bitmaps for multiple HiDPI scaling factors can be cached at\n+ * the same time, e.g. for multi-monitor setups.\n+ */\n+abstract class CachedHiDPIIcon extends ImageIcon {\n+    /**\n+     * The maximum size of the cache, as a multiple of the size of the icon at 100% scaling. For\n+     * example, storing three images at 100%, 150%, and 200% scaling, respectively, yields a total\n+     * cache size of 1.0^2 + 1.5^2 + 2^2 = 7.2.\n+     */\n+    private static final double MAX_CACHE_SIZE = 10.0;\n+    private final int width;\n+    private final int height;\n+    /**\n+     * Cache map with least-recently-used iteration order.\n+     */\n+    private final Map<CachedImageKey, Image> cache =\n+            new LinkedHashMap<CachedImageKey, Image>(16, 0.75f, true);\n+    /**\n+     * Total size of the images currently in the cache, in the same units as\n+     * {@link #MAX_CACHE_SIZE}.\n+     */\n+    private double cacheSize = 0.0;\n+\n+    /**\n+     * Constructor to be used by subclasses.\n+     */\n+    protected CachedHiDPIIcon(int width, int height) {\n+        if (width < 0) {\n+            throw new IllegalArgumentException();\n+        }\n+        if (height < 0) {\n+            throw new IllegalArgumentException();\n+        }\n+        this.width = width;\n+        this.height = height;\n+    }\n+\n+    private synchronized Image getScaledImageCached(Component c, CachedImageKey key) {\n+        Image ret = cache.get(key);\n+        if (ret != null) {\n+            return ret;\n+        }\n+        final double scale = key.getScale();\n+        final int deviceWidth = (int) Math.ceil(getIconWidth() * scale);\n+        final int deviceHeight = (int) Math.ceil(getIconHeight() * scale);\n+        final Image img =\n+                createImage(c, key.getGraphicsConfiguration(), deviceWidth, deviceHeight, scale);\n+        final double imgSize = key.getSize();\n+        if (imgSize <= MAX_CACHE_SIZE) {\n+            /* Evict least-recently-used images from the cache until we have space for the latest\n+            image. */\n+            final Iterator<CachedImageKey> iter = cache.keySet().iterator();\n+            while (cacheSize + imgSize > MAX_CACHE_SIZE && iter.hasNext()) {\n+                CachedImageKey removeKey = iter.next();\n+                iter.remove();\n+                cacheSize -= removeKey.getSize();\n+            }\n+            cache.put(key, img);\n+            cacheSize += imgSize;\n+        }\n+        return img;\n+    }\n+\n+    @Override\n+    public final void paintIcon(Component c, Graphics g0, int x, int y) {\n+        final Graphics2D g = (Graphics2D) g0;\n+        CachedImageKey key = CachedImageKey.create(g);\n+        final AffineTransform oldTransform = g.getTransform();\n+        try {\n+            g.translate(x, y);\n+            Image scaledImage = getScaledImageCached(c, key);\n+            /* Scale the image down to its logical dimensions, then draw it at the device pixel\n+            boundary. In VectorIcon, we tried to be a lot more conservative, taking great care not\n+            to draw on any device pixels that were only partially bounded by the icon (due to\n+            non-integral scaling factors, e.g. 150%). That was probably overkill; it's a lot easier\n+            to assume that partially bounded pixels are OK to draw on, since all icon bitmaps of a\n+            given scaling factor then end up being the same number of device pixels wide and tall.\n+            And we need consistent dimensions to be able keep cached images in any case. For these\n+            reasons, round the X and Y translations (which denote the position in device pixels)\n+            _down_ here.*/\n+            AffineTransform tx2 = g.getTransform();\n+            g.setTransform(new AffineTransform(1, 0, 0, 1,\n+                    (int) tx2.getTranslateX(),\n+                    (int) tx2.getTranslateY()));\n+            g.drawImage(scaledImage, 0, 0, null);\n+        } finally {\n+            g.setTransform(oldTransform);\n+        }\n+    }\n+\n+    @Override\n+    public final int getIconWidth() {\n+        return width;\n+    }\n+\n+    @Override\n+    public final int getIconHeight() {\n+        return height;\n+    }\n+\n+    /**\n+     * Create a scaled image containing the graphics of this icon. The result may be cached.\n+     *\n+     * @param c the component that was passed to {@link Icon#paintIcon(Component,Graphics,int,int)}.\n+     *        The cache will <em>not</em> be invalidated if {@code c} or its state changes, so \n+     *        subclasses should avoid depending on it if possible. This parameter exists mainly to\n+     *        ensure compatibility with existing Icon implementations that may be used as delegates.\n+     *        Future implementations might also elect to simply pass a dummy Component instance\n+     *        here.\n+     * @param graphicsConfiguration the configuration of the surface on which the image will be\n+     * painted\n+     * @param deviceWidth the required width of the image, with scaling already applied\n+     * @param deviceHeight the required height of the image, with scaling already applied\n+     * @param scale the HiDPI scaling factor detected in {@code graphicsConfiguration}\n+     */\n+    protected abstract Image createImage(Component c, GraphicsConfiguration graphicsConfiguration,\n+            int deviceWidth, int deviceHeight, double scale);\n+\n+    private static final class CachedImageKey {\n+        private final GraphicsConfiguration gconf;\n+        private final double scale;\n+\n+        public CachedImageKey(GraphicsConfiguration gconf, double scale) {\n+            Parameters.notNull(\"gconf\", gconf);\n+            if (scale <= 0.0) {\n+                throw new IllegalArgumentException();\n+            }\n+            this.gconf = gconf;\n+            this.scale = scale;\n+        }\n+\n+        public static CachedImageKey create(Graphics2D g) {\n+            final AffineTransform tx = g.getTransform();\n+            final int txType = tx.getType();\n+            final double scale;\n+            if (txType == AffineTransform.TYPE_UNIFORM_SCALE ||\n+                txType == (AffineTransform.TYPE_UNIFORM_SCALE | AffineTransform.TYPE_TRANSLATION))\n+            {\n+                scale = tx.getScaleX();\n+            } else {\n+                scale = 1.0;\n+            }\n+            return new CachedImageKey(g.getDeviceConfiguration(), scale);\n+        }\n+\n+        public double getScale() {\n+            return scale;\n+        }\n+\n+        /**\n+         * Get the size of this image as a multiple of the original image's size at 100% scaling.\n+         */\n+        public double getSize() {\n+            return Math.pow(getScale(), 2.0);\n+        }\n+\n+        public GraphicsConfiguration getGraphicsConfiguration() {\n+            return gconf;\n+        }\n+\n+        @Override\n+        public int hashCode() {\n+            return Objects.hash(gconf, scale);\n+        }\n+\n+        @Override\n+        public boolean equals(Object obj) {\n+            if (!(obj instanceof CachedImageKey)) {\n+                return false;\n+            }\n+            final CachedImageKey other = (CachedImageKey) obj;\n+            return this.gconf.equals(other.gconf) &&\n+                   this.scale == other.scale;\n+        }\n+    }\n+}", "filename": "platform/openide.util.ui/src/org/openide/util/CachedHiDPIIcon.java"}, {"additions": 79, "raw_url": "https://github.com/apache/netbeans/raw/d305cd16e9a4ab88a71ced7e7b8622d26542b2f1/platform/openide.util.ui/src/org/openide/util/FilteredIcon.java", "blob_url": "https://github.com/apache/netbeans/blob/d305cd16e9a4ab88a71ced7e7b8622d26542b2f1/platform/openide.util.ui/src/org/openide/util/FilteredIcon.java", "sha": "94499eb8a2cc284103ffda0821cb5caaffe7217b", "changes": 79, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/platform/openide.util.ui/src/org/openide/util/FilteredIcon.java?ref=d305cd16e9a4ab88a71ced7e7b8622d26542b2f1", "patch": "@@ -0,0 +1,79 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.openide.util;\n+\n+import java.awt.Component;\n+import java.awt.Graphics;\n+import java.awt.Graphics2D;\n+import java.awt.GraphicsConfiguration;\n+import java.awt.Image;\n+import java.awt.Rectangle;\n+import java.awt.Toolkit;\n+import java.awt.Transparency;\n+import java.awt.image.BufferedImage;\n+import java.awt.image.FilteredImageSource;\n+import java.awt.image.RGBImageFilter;\n+import javax.swing.Icon;\n+import javax.swing.ImageIcon;\n+\n+/**\n+ * A filtered variation of a provided delegate icon. Any kind of delegate implementation can be\n+ * used. In particular, this class preserves the full fidelity of HiDPI icons, such as instances\n+ * of {@link VectorIcon}, or {@link ImageIcon} instances delegating to a\n+ * {@code java.awt.image.MultiResolutionImage} (available since Java 9 and above).\n+ *\n+ * <p>Note that state passed through the {code Component} parameter of the\n+ * {@link Icon#paintIcon(Component,Graphics,int,int)} method will only be current as of the time the\n+ * icon is initially entered into the cache.\n+ */\n+final class FilteredIcon extends CachedHiDPIIcon {\n+    private final RGBImageFilter filter;\n+    private final Icon delegate;\n+\n+    private FilteredIcon(RGBImageFilter filter, Icon delegate) {\n+        super(delegate.getIconWidth(), delegate.getIconHeight());\n+        Parameters.notNull(\"filter\", filter);\n+        Parameters.notNull(\"delegate\", delegate);\n+        this.filter = filter;\n+        this.delegate = delegate;\n+    }\n+\n+    public static Icon create(RGBImageFilter filter, Icon delegate) {\n+        return new FilteredIcon(filter, delegate);\n+    }\n+\n+    @Override\n+    protected Image createImage(\n+            Component c, GraphicsConfiguration graphicsConfiguration,\n+            int deviceWidth, int deviceHeight, double scale)\n+    {\n+        final BufferedImage img = graphicsConfiguration.createCompatibleImage(\n+                deviceWidth, deviceHeight, Transparency.TRANSLUCENT);\n+        final Graphics2D imgG = img.createGraphics();\n+        try {\n+            imgG.clip(new Rectangle(0, 0, img.getWidth(), img.getHeight()));\n+            imgG.scale(scale, scale);\n+            delegate.paintIcon(c, imgG, 0, 0);\n+        } finally {\n+            imgG.dispose();\n+        }\n+        return Toolkit.getDefaultToolkit().createImage(\n+                new FilteredImageSource(img.getSource(), filter));\n+    }\n+}", "filename": "platform/openide.util.ui/src/org/openide/util/FilteredIcon.java"}, {"additions": 18, "raw_url": "https://github.com/apache/netbeans/raw/d305cd16e9a4ab88a71ced7e7b8622d26542b2f1/platform/openide.util.ui/src/org/openide/util/ImageUtilities.java", "blob_url": "https://github.com/apache/netbeans/blob/d305cd16e9a4ab88a71ced7e7b8622d26542b2f1/platform/openide.util.ui/src/org/openide/util/ImageUtilities.java", "sha": "4a46b6ad2d9430b618374b25294c8101f0ea7941", "changes": 62, "status": "modified", "deletions": 44, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/platform/openide.util.ui/src/org/openide/util/ImageUtilities.java?ref=d305cd16e9a4ab88a71ced7e7b8622d26542b2f1", "patch": "@@ -19,7 +19,6 @@\n \n package org.openide.util;\n \n-import java.awt.Color;\n import java.awt.Component;\n import java.awt.Graphics;\n import java.awt.HeadlessException;\n@@ -31,8 +30,6 @@\n import java.awt.image.ColorModel;\n import java.awt.image.FilteredImageSource;\n import java.awt.image.ImageObserver;\n-import java.awt.image.ImageProducer;\n-import java.awt.image.IndexColorModel;\n import java.awt.image.RGBImageFilter;\n import java.awt.image.WritableRaster;\n import java.io.IOException;\n@@ -138,6 +135,10 @@ public static final Image loadImage(String resourceID) {\n      * @return icon's Image or null if the icon cannot be loaded\n      */\n     public static final Image loadImage(String resource, boolean localized) {\n+        // Avoid a NPE that could previously occur in the isDarkLaF case only. See NETBEANS-2401.\n+        if (resource == null) {\n+            return null;\n+        }\n         Image image = null;\n         if( isDarkLaF() ) {\n             image = getIcon(addDarkSuffix(resource), localized);\n@@ -149,8 +150,7 @@ public static final Image loadImage(String resource, boolean localized) {\n             // only non _dark images need filtering\n             RGBImageFilter imageFilter = getImageIconFilter();\n             if (null != image && null != imageFilter) {\n-                image = Toolkit.getDefaultToolkit()\n-                        .createImage(new FilteredImageSource(image.getSource(), imageFilter));\n+                image = createFilteredImage(imageFilter, image);\n             }\n         }\n         return image;\n@@ -342,7 +342,10 @@ public static final Image addToolTipToImage(Image image, String text) {\n      */\n     public static Icon createDisabledIcon(Icon icon)  {\n         Parameters.notNull(\"icon\", icon);\n-        return new LazyDisabledIcon(icon2Image(icon));\n+        /* FilteredIcon's Javadoc mentions a caveat about the Component parameter that is passed to\n+        Icon.paintIcon. It's not really a problem; previous implementations had the same\n+        behavior. */\n+        return FilteredIcon.create(DisabledButtonFilter.INSTANCE, icon);\n     }\n \n     /**\n@@ -353,7 +356,14 @@ public static Icon createDisabledIcon(Icon icon)  {\n      */\n     public static Image createDisabledImage(Image image)  {\n         Parameters.notNull(\"image\", image);\n-        return LazyDisabledIcon.createDisabledImage(image);\n+        return createFilteredImage(DisabledButtonFilter.INSTANCE, image);\n+    }\n+\n+    private static Image createFilteredImage(RGBImageFilter filter, Image image) {\n+        Parameters.notNull(\"filter\", filter);\n+        Parameters.notNull(\"image\", image);\n+        return Toolkit.getDefaultToolkit().createImage(\n+                new FilteredImageSource(image.getSource(), filter));\n     }\n \n     /**\n@@ -880,44 +890,8 @@ public Object getProperty(String name, ImageObserver observer) {\n         }\n     }\n \n-    private static class LazyDisabledIcon implements Icon {\n-\n-        /** Shared instance of filter for disabled icons */\n-        private static final RGBImageFilter DISABLED_BUTTON_FILTER = new DisabledButtonFilter();\n-        private Image img;\n-        private Icon disabledIcon;\n-\n-        public LazyDisabledIcon(Image img) {\n-            assert null != img;\n-            this.img = img;\n-        }\n-\n-        public void paintIcon(Component c, Graphics g, int x, int y) {\n-            getDisabledIcon().paintIcon(c, g, x, y);\n-        }\n-\n-        public int getIconWidth() {\n-            return getDisabledIcon().getIconWidth();\n-        }\n-\n-        public int getIconHeight() {\n-            return getDisabledIcon().getIconHeight();\n-        }\n-\n-        private synchronized Icon getDisabledIcon() {\n-            if (null == disabledIcon) {\n-                disabledIcon = new ImageIcon(createDisabledImage(img));\n-            }\n-            return disabledIcon;\n-        }\n-\n-        static Image createDisabledImage(Image img) {\n-            ImageProducer prod = new FilteredImageSource(img.getSource(), DISABLED_BUTTON_FILTER);\n-            return Toolkit.getDefaultToolkit().createImage(prod);\n-        }\n-    }\n-\n     private static class DisabledButtonFilter extends RGBImageFilter {\n+        public static final RGBImageFilter INSTANCE = new DisabledButtonFilter();\n \n         DisabledButtonFilter() {\n             canFilterIndexColorModel = true;", "filename": "platform/openide.util.ui/src/org/openide/util/ImageUtilities.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "parent": "https://github.com/apache/netbeans/commit/af00a5b578d484cda12e06258fd2830d882e0fee", "message": "Inline parameter name hints for Java (#1247)\n\n* A crude prototype of inline (parameter) hints.\r\n\r\n* Improving appearance of the inline hints.\r\n\r\n* Generalizing highlighting test infrastructure.\r\n\r\n* Adding option to disable/enable the inline hints.\r\n\r\n* Preventing NPE while preparing compound highlights, adding simple tests.\r\n\r\n* Adding simple tests for the parameter name hints.\r\n\r\n* Fixing varargs usage.\r\n\r\n* Improving the view structure by creating a wrapper view over the existing highlight view.\r\n\r\n* Cleaning the views implementation.\r\n\r\n* Fix behavior of String literals which contain embedded escape sequences.\r\n\r\n* Resolving review comments Junichi", "bug_id": "netbeans_23", "file": [{"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.actions/src/org/netbeans/modules/editor/actions/Bundle.properties", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.actions/src/org/netbeans/modules/editor/actions/Bundle.properties", "sha": "17b02bc04830f82648103c679bb8613a315e9751", "changes": 1, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/ide/editor.actions/src/org/netbeans/modules/editor/actions/Bundle.properties?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -44,6 +44,7 @@ caret-next-word=Insertion Point to Next Word\n caret-previous-word=Insertion Point to Previous Word\n selection-next-word=Extend Selection to Next Word\n selection-previous-word=Extend Selection to Previous Word\n+toggle-inline-hints=Show Inline &Hints\n toggle-lines-view=Show &Indent Guide Lines\n clipboard-lines=Paste as Lines\n remove-last-caret=Remove Last Caret", "filename": "ide/editor.actions/src/org/netbeans/modules/editor/actions/Bundle.properties"}, {"additions": 37, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.actions/src/org/netbeans/modules/editor/actions/ShowInlineHintsAction.java", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.actions/src/org/netbeans/modules/editor/actions/ShowInlineHintsAction.java", "sha": "a97a8efeaa1bda03618f4f741cf65343e0be1825", "changes": 37, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/ide/editor.actions/src/org/netbeans/modules/editor/actions/ShowInlineHintsAction.java?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -0,0 +1,37 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.netbeans.modules.editor.actions;\n+\n+import java.awt.event.ActionEvent;\n+import javax.swing.AbstractAction;\n+import org.netbeans.api.editor.EditorActionRegistration;\n+\n+@EditorActionRegistration(name=\"toggle-inline-hints\",\n+                          menuPath=\"View\",\n+                          menuPosition=899,\n+                          preferencesKey=ShowInlineHintsAction.KEY_LINES,\n+                          preferencesDefault=ShowInlineHintsAction.DEF_LINES)\n+public class ShowInlineHintsAction extends AbstractAction {\n+    public static final String KEY_LINES = \"enable.inline.hints\";\n+    public static final boolean DEF_LINES = false;\n+    @Override\n+    public void actionPerformed(ActionEvent e) {\n+    }\n+\n+}", "filename": "ide/editor.actions/src/org/netbeans/modules/editor/actions/ShowInlineHintsAction.java"}, {"additions": 15, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/apichanges.xml", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/apichanges.xml", "sha": "03211f4ff7229dfdec90661bf0d0331c0c3cde9f", "changes": 15, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/ide/editor.lib2/apichanges.xml?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -83,6 +83,21 @@ is the proper place.\n     <!-- ACTUAL CHANGES BEGIN HERE: -->\n \n     <changes>\n+        <change id=\"PrependedTextOpt\">\n+            <summary>Prepended text for highlights</summary>\n+            <version major=\"2\" minor=\"24\"/>\n+            <date day=\"14\" month=\"5\" year=\"2019\"/>\n+            <author login=\"jlahoda\"/>\n+            <compatibility binary=\"compatible\" source=\"compatible\" semantic=\"compatible\" addition=\"yes\" deprecation=\"no\" deletion=\"no\" modification=\"no\" />\n+            <description>\n+                <p>If AttributeSet returned from HighlightsSequence contains key \"virtual-text-prepend\"\n+                   with a value of type String, the UI may optionally render the value as a\n+                   virtual text before the text of the highlight. It is recommended to make the\n+                   span of length 1, to avoid problems when the AttributeSet with \"virtual-test-prepend\"\n+                   is merged with other AttributeSets, which could lead to duplication.</p>\n+            </description>\n+            <class name=\"HighlightsSequence\" package=\"org.netbeans.spi.editor.highlighting\"/>\n+        </change>\n         <change id=\"EditorActionRegistration.category\">\n             <summary>Added category to EditorActionRegistration</summary>\n             <version major=\"2\" minor=\"15\"/>", "filename": "ide/editor.lib2/apichanges.xml"}, {"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/nbproject/project.properties", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/nbproject/project.properties", "sha": "f3f622d22629b35a0538ab532c211008e1469041", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/ide/editor.lib2/nbproject/project.properties?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -18,7 +18,7 @@\n is.autoload=true\n javac.source=1.7\n javac.compilerargs=-Xlint:unchecked\n-spec.version.base=2.23.0\n+spec.version.base=2.24.0\n \n javadoc.arch=${basedir}/arch.xml\n javadoc.apichanges=${basedir}/apichanges.xml", "filename": "ide/editor.lib2/nbproject/project.properties"}, {"additions": 6, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/highlighting/HighlightsList.java", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/highlighting/HighlightsList.java", "sha": "a97a9598ed37e208c9077c70be0aa10a24f97c19", "changes": 8, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/highlighting/HighlightsList.java?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -20,6 +20,7 @@\n package org.netbeans.modules.editor.lib2.highlighting;\n \n import java.awt.Font;\n+import java.util.Objects;\n import java.util.logging.Logger;\n import javax.swing.text.AttributeSet;\n import org.netbeans.lib.editor.util.ArrayUtilities;\n@@ -117,9 +118,10 @@ public void add(HighlightItem item) {\n      * @param wsEndOffset whitespace end offset must be lower than or equal to maxEndOffset\n      *  and when exceeded a first whitespace char in docText means that the cutting will end there.\n      * @param docText document text in order properly handle wsEndOffset parameter.\n+     * @param usePrependText reflect the prepended text setting.\n      * @return either simple or compound attribute set.\n      */\n-    public AttributeSet cutSameFont(Font defaultFont, int maxEndOffset, int wsEndOffset, CharSequence docText) {\n+    public AttributeSet cutSameFont(Font defaultFont, int maxEndOffset, int wsEndOffset, CharSequence docText, boolean usePrependText) {\n         assert (maxEndOffset <= endOffset()) :\n                 \"maxEndOffset=\" + maxEndOffset + \" > endOffset()=\" + endOffset() + \", \" + this; // NOI18N\n         HighlightItem item = get(0);\n@@ -157,12 +159,14 @@ public AttributeSet cutSameFont(Font defaultFont, int maxEndOffset, int wsEndOff\n \n         // Extends beyond first highlight\n         Font firstFont = ViewUtils.getFont(firstAttrs, defaultFont);\n+        Object firstPrependText = usePrependText && firstAttrs != null ? firstAttrs.getAttribute(ViewUtils.KEY_VIRTUAL_TEXT_PREPEND) : null;\n         int index = 1;\n         while (true) {\n             item = get(index);\n             AttributeSet attrs = item.getAttributes();\n             Font font = ViewUtils.getFont(attrs, defaultFont);\n-            if (!font.equals(firstFont)) { // Stop at itemEndOffset\n+            Object prependText = usePrependText && attrs != null ? attrs.getAttribute(ViewUtils.KEY_VIRTUAL_TEXT_PREPEND) : null;\n+            if (!font.equals(firstFont) || !Objects.equals(firstPrependText, prependText)) { // Stop at itemEndOffset\n                 if (index == 1) { // Just single attribute set\n                     cutStartItems(1);\n                     startOffset = itemEndOffset; // end offset of first item", "filename": "ide/editor.lib2/src/org/netbeans/modules/editor/lib2/highlighting/HighlightsList.java"}, {"additions": 15, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/DocumentViewOp.java", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/DocumentViewOp.java", "sha": "80f1b9ac14d1641ee18115e8e61041d4c0dded3e", "changes": 16, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/DocumentViewOp.java?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -291,6 +291,7 @@\n     private Map<Font,FontInfo> fontInfos = new HashMap<Font, FontInfo>(4);\n     \n     private Font defaultFont;\n+    private Font defaultHintFont;\n     \n     private boolean fontRenderContextFromPaint;\n \n@@ -314,6 +315,7 @@\n     boolean asTextField;\n     \n     private boolean guideLinesEnable;\n+    private boolean inlineHintsEnable;\n     \n     private int indentLevelSize;\n     \n@@ -921,10 +923,13 @@ public void run() {\n         // Line height correction\n         float lineHeightCorrectionOrig = rowHeightCorrection;\n         rowHeightCorrection = prefs.getFloat(SimpleValueNames.LINE_HEIGHT_CORRECTION, 1.0f);\n+        boolean inlineHintsEnableOrig = inlineHintsEnable;\n+        inlineHintsEnable = Boolean.TRUE.equals(prefs.getBoolean(\"enable.inline.hints\", false)); // NOI18N\n         boolean updateMetrics = (rowHeightCorrection != lineHeightCorrectionOrig);\n         boolean releaseChildren = nonInitialUpdate && \n                 ((nonPrintableCharactersVisible != nonPrintableCharactersVisibleOrig) ||\n-                 (rowHeightCorrection != lineHeightCorrectionOrig));  \n+                 (rowHeightCorrection != lineHeightCorrectionOrig) ||\n+                 (inlineHintsEnable != inlineHintsEnableOrig));\n         indentLevelSize = getIndentSize();\n         tabSize = prefs.getInt(SimpleValueNames.TAB_SIZE, EditorPreferencesDefaults.defaultTabSize);\n         if (updateMetrics) {\n@@ -1060,6 +1065,7 @@ private void updateCharMetrics() { // Update default row height and other params\n             fontInfos.put(null, defaultFontInfo); // Alternative way to find default font info\n             updateRowHeight(defaultFontInfo, true);\n             defaultFont = font;\n+            defaultHintFont = font.deriveFont((float) (font.getSize2D() * 0.75));\n             defaultCharWidth = defaultFontInfo.charWidth;\n             \n             tabTextLayout = null;\n@@ -1165,6 +1171,10 @@ public boolean isGuideLinesEnable() {\n         return guideLinesEnable && !asTextField;\n     }\n \n+    public boolean isInlineHintsEnable() {\n+        return inlineHintsEnable;\n+    }\n+\n     public int getIndentLevelSize() {\n         return indentLevelSize;\n     }\n@@ -1259,6 +1269,10 @@ public Font getDefaultFont() {\n         return defaultFont;\n     }\n \n+    public Font getDefaultHintFont() {\n+        return defaultHintFont;\n+    }\n+\n     public float getDefaultRowHeight() {\n         checkSettingsInfo();\n         return defaultRowHeightInt;", "filename": "ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/DocumentViewOp.java"}, {"additions": 24, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/HighlightsViewFactory.java", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/HighlightsViewFactory.java", "sha": "fce916dd5bbacc0481e3bb5fdd9e6b715136ab94", "changes": 33, "status": "modified", "deletions": 9, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/HighlightsViewFactory.java?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -28,6 +28,8 @@\n import javax.swing.text.AttributeSet;\n import javax.swing.text.Element;\n import javax.swing.text.View;\n+import org.netbeans.api.annotations.common.NonNull;\n+import org.netbeans.api.annotations.common.NullAllowed;\n import org.netbeans.lib.editor.util.CharSequenceUtilities;\n import org.netbeans.lib.editor.util.swing.DocumentUtilities;\n import org.netbeans.modules.editor.lib2.highlighting.DirectMergeContainer;\n@@ -188,7 +190,7 @@ public EditorView createView(int startOffset, int limitOffset, boolean forcedLim\n         }\n         if (startOffset == lineEndOffset - 1) {\n             AttributeSet attrs = hList.cutSingleChar();\n-            return new NewlineView(attrs);\n+            return wrapWithPrependedText(new NewlineView(attrs), attrs);\n         } else { // Regular view with possible highlight(s) or tab view\n             updateTabsAndHighlightsAndRTL(startOffset);\n             if (charType == TAB_CHAR_TYPE) {\n@@ -198,7 +200,7 @@ public EditorView createView(int startOffset, int limitOffset, boolean forcedLim\n                     limitOffset = tabsEndOffset;\n                 }\n                 attrs = hList.cut(limitOffset);\n-                return new TabView(limitOffset - startOffset, attrs);\n+                return wrapWithPrependedText(new TabView(limitOffset - startOffset, attrs), attrs);\n \n             } else { // Create regular view with either LTR or RTL text\n                 limitOffset = Math.min(limitOffset, nextTabOrRTLOffset); // nextTabOrRTLOffset < lineEndOffset \n@@ -216,11 +218,13 @@ public EditorView createView(int startOffset, int limitOffset, boolean forcedLim\n                     }\n                             \n                 }\n-                AttributeSet attrs = hList.cutSameFont(defaultFont, limitOffset, wsEndOffset, docText);\n+                boolean inlineHints = documentView().op.isInlineHintsEnable();\n+                AttributeSet attrs = hList.cutSameFont(defaultFont, limitOffset, wsEndOffset, docText, inlineHints);\n                 int length = hList.startOffset() - startOffset;\n-                HighlightsView view = new HighlightsView(length, attrs);\n-                if (origView instanceof HighlightsView && origView.getLength() == length) { // Reuse\n-                    HighlightsView origHView = (HighlightsView) origView;\n+                EditorView view = wrapWithPrependedText(new HighlightsView(length, attrs), attrs);\n+                EditorView origViewUnwrapped = origView instanceof PrependedTextView ? ((PrependedTextView) origView).getDelegate() : origView;\n+                if (origViewUnwrapped != null && origViewUnwrapped.getClass() == HighlightsView.class && origViewUnwrapped.getLength() == length) {\n+                    HighlightsView origHView = (HighlightsView) origViewUnwrapped;\n                     TextLayout origTextLayout = origHView.getTextLayout();\n                     if (origTextLayout != null) {\n                         if (ViewHierarchyImpl.CHECK_LOG.isLoggable(Level.FINE)) {\n@@ -235,11 +239,12 @@ public EditorView createView(int startOffset, int limitOffset, boolean forcedLim\n                             }\n                         }\n                         Font font = ViewUtils.getFont(attrs, defaultFont);\n-                        Font origFont = ViewUtils.getFont(origView.getAttributes(), defaultFont);\n+                        Font origFont = ViewUtils.getFont(origViewUnwrapped.getAttributes(), defaultFont);\n                         if (font != null && font.equals(origFont)) {\n                             float origWidth = origHView.getWidth();\n-                            view.setTextLayout(origTextLayout, origWidth);\n-                            view.setBreakInfo(origHView.getBreakInfo());\n+                            HighlightsView hv = (HighlightsView) (view instanceof PrependedTextView ? ((PrependedTextView) view).getDelegate() : view);\n+                            hv.setTextLayout(origTextLayout, origWidth);\n+                            hv.setBreakInfo(origHView.getBreakInfo());\n                             ViewStats.incrementTextLayoutReused(length);\n                         }\n                     }\n@@ -249,6 +254,16 @@ public EditorView createView(int startOffset, int limitOffset, boolean forcedLim\n         }\n     }\n \n+    private @NonNull EditorView wrapWithPrependedText(@NonNull EditorView origView, @NullAllowed AttributeSet attrs) {\n+        boolean inlineHints = documentView().op.isInlineHintsEnable();\n+\n+        if (attrs != null && inlineHints && attrs.getAttribute(ViewUtils.KEY_VIRTUAL_TEXT_PREPEND) instanceof String) {\n+            return new PrependedTextView(documentView().op, attrs, origView);\n+        }\n+\n+        return origView;\n+    }\n+\n     private void updateTabsAndHighlightsAndRTL(int offset) {\n         if (offset >= nextTabOrRTLOffset) { // Update nextTabOrRTLOffset\n             // Determine situation right at offset", "filename": "ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/HighlightsViewFactory.java"}, {"additions": 2, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/ParagraphViewChildren.java", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/ParagraphViewChildren.java", "sha": "38c2787ed78b81d117dcb9f3b783251b2d7e122d", "changes": 4, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/ParagraphViewChildren.java?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -168,8 +168,8 @@ void replace(ParagraphView pView, int index, int removeCount, View[] addedViews)\n                 view.setRawEndOffset(relEndOffset); // Below offset-gap\n                 view.setParent(pView);\n                 // Possibly assign text layout\n-                if (view instanceof HighlightsView) {\n-                    HighlightsView hView = (HighlightsView) view;\n+                if (view instanceof HighlightsView || (view instanceof PrependedTextView && ((PrependedTextView) view).getDelegate() instanceof HighlightsView)) {\n+                    HighlightsView hView = (HighlightsView) (view instanceof HighlightsView ? view : ((PrependedTextView) view).getDelegate());\n                     // Fill in text layout if necessary\n                     if (hView.getTextLayout() == null) { // Fill in text layout\n                         if (docText == null) {", "filename": "ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/ParagraphViewChildren.java"}, {"additions": 155, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/PrependedTextView.java", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/PrependedTextView.java", "sha": "472c8f2bc63f2536e0eb3257d87050a6208b0eef", "changes": 155, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/PrependedTextView.java?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -0,0 +1,155 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.netbeans.modules.editor.lib2.view;\n+\n+import java.awt.Color;\n+import java.awt.Font;\n+import java.awt.Graphics2D;\n+import java.awt.Rectangle;\n+import java.awt.Shape;\n+import java.awt.font.TextLayout;\n+import java.awt.geom.Rectangle2D;\n+import javax.swing.text.AttributeSet;\n+import javax.swing.text.Position;\n+import javax.swing.text.Position.Bias;\n+import javax.swing.text.View;\n+import org.netbeans.spi.editor.highlighting.HighlightsSequence;\n+\n+/**\n+ * TODO\n+ */\n+public final class PrependedTextView extends EditorView {\n+\n+    private final AttributeSet attributes;\n+    private final EditorView delegate;\n+    private final TextLayout prependedTextLayout;\n+    private final double leftShift;\n+    private final double prependedTextWidth;\n+\n+    public PrependedTextView(DocumentViewOp op, AttributeSet attributes, EditorView delegate) {\n+        super(null);\n+        this.attributes = attributes;\n+        this.delegate = delegate;\n+        Font font = ViewUtils.getFont(attributes, op.getDefaultHintFont());\n+        prependedTextLayout = op.createTextLayout((String) attributes.getAttribute(ViewUtils.KEY_VIRTUAL_TEXT_PREPEND), font);\n+        Rectangle2D textBounds = prependedTextLayout.getBounds(); //TODO: allocation!\n+        double em = op.getDefaultCharWidth();\n+        leftShift = em / 2;\n+        prependedTextWidth = Math.ceil(textBounds.getWidth() + em);\n+    }\n+\n+    @Override\n+    public float getPreferredSpan(int axis) {\n+        float superSpan = delegate.getPreferredSpan(axis);\n+        if (axis == View.X_AXIS) {\n+            superSpan += prependedTextWidth;\n+        }\n+        return superSpan;\n+    }\n+\n+    @Override\n+    public AttributeSet getAttributes() {\n+        return attributes;\n+    }\n+    \n+    @Override\n+    public Shape modelToViewChecked(int offset, Shape alloc, Bias bias) {\n+        Shape res = delegate.modelToViewChecked(offset, alloc, bias);\n+        Rectangle2D rect = ViewUtils.shapeAsRect(res);\n+        rect.setRect(rect.getX() + prependedTextWidth, rect.getY(), rect.getWidth(), rect.getHeight());\n+        return rect;\n+    }\n+\n+    @Override\n+    public void paint(Graphics2D g, Shape hViewAlloc, Rectangle clipBounds) {\n+        Rectangle2D span = ViewUtils.shapeAsRect(hViewAlloc);\n+        span.setRect(span.getX() + prependedTextWidth, span.getY(), span.getWidth() - prependedTextWidth, span.getHeight());\n+        delegate.paint(g, span, clipBounds);\n+        span.setRect(span.getX() - prependedTextWidth, span.getY(), prependedTextWidth, span.getHeight());\n+\n+        HighlightsSequence highlights = getDocumentView().getPaintHighlights(this, 0);\n+\n+        if (highlights.moveNext()) {\n+            AttributeSet attrs = highlights.getAttributes();\n+            HighlightsViewUtils.fillBackground(g, span, attrs, getDocumentView().getTextComponent());\n+            HighlightsViewUtils.paintBackgroundHighlights(g, span, attrs, getDocumentView()); //TODO: clear some attributes (like boxes)???\n+        }\n+\n+        g.setColor(Color.gray);\n+        span.setRect(span.getX() + leftShift, span.getY(), prependedTextWidth - 2 * leftShift, span.getHeight());\n+        HighlightsViewUtils.paintTextLayout(g, span, prependedTextLayout, getDocumentView());\n+    }\n+\n+    ParagraphView getParagraphView() {\n+        return (ParagraphView) getParent();\n+    }\n+\n+    DocumentView getDocumentView() {\n+        ParagraphView paragraphView = getParagraphView();\n+        return (paragraphView != null) ? paragraphView.getDocumentView() : null;\n+    }\n+\n+    @Override\n+    public int getRawEndOffset() {\n+        return delegate.getRawEndOffset();\n+    }\n+\n+    @Override\n+    public void setRawEndOffset(int offset) {\n+        delegate.setRawEndOffset(offset);\n+    }\n+\n+    @Override\n+    public int viewToModelChecked(double x, double y, Shape alloc, Position.Bias[] biasReturn) {\n+        Rectangle2D bounds = ViewUtils.shapeAsRect(alloc);\n+        bounds.setRect(bounds.getX() + prependedTextWidth, bounds.getY(),\n+                       bounds.getWidth() - prependedTextWidth, bounds.getHeight());\n+        if (x <= bounds.getX()) {\n+            return getStartOffset();\n+        }\n+        return delegate.viewToModelChecked(x, y, bounds, biasReturn);\n+    }\n+\n+    @Override\n+    public int getLength() {\n+        return delegate.getLength();\n+    }\n+\n+    @Override\n+    public int getStartOffset() {\n+        return delegate.getStartOffset();\n+    }\n+\n+    @Override\n+    public int getEndOffset() {\n+        return delegate.getEndOffset();\n+    }\n+\n+    @Override\n+    public void setParent(View parent) {\n+        super.setParent(parent);\n+        delegate.setParent(parent);\n+    }\n+\n+    EditorView getDelegate() {\n+        return delegate;\n+    }\n+\n+}", "filename": "ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/PrependedTextView.java"}, {"additions": 3, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/ViewUtils.java", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/ViewUtils.java", "sha": "bda7b075175957a5f46fbb18e4f4b75c7bd3b4b1", "changes": 4, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/ViewUtils.java?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -43,7 +43,9 @@\n  */\n \n public final class ViewUtils {\n-    \n+\n+    public static final String KEY_VIRTUAL_TEXT_PREPEND = \"virtual-text-prepend\"; //NOI18N\n+\n     private ViewUtils() { // No instances\n     }\n ", "filename": "ide/editor.lib2/src/org/netbeans/modules/editor/lib2/view/ViewUtils.java"}, {"additions": 99, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/test/unit/src/org/netbeans/modules/editor/lib2/highlighting/HighlightsListTest.java", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/ide/editor.lib2/test/unit/src/org/netbeans/modules/editor/lib2/highlighting/HighlightsListTest.java", "sha": "86e06938767b34c0904b43fb90928b09ff5a5a94", "changes": 110, "status": "modified", "deletions": 11, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/ide/editor.lib2/test/unit/src/org/netbeans/modules/editor/lib2/highlighting/HighlightsListTest.java?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -26,6 +26,7 @@\n import javax.swing.text.StyleConstants;\n import org.junit.Test;\n import org.netbeans.api.editor.settings.AttributesUtilities;\n+import org.netbeans.modules.editor.lib2.view.ViewUtils;\n import org.netbeans.spi.editor.highlighting.HighlightsContainer;\n import org.netbeans.spi.editor.highlighting.support.OffsetsBag;\n \n@@ -67,7 +68,7 @@ public void testSimple() throws Exception {\n \n         HighlightsList hList = highlightsListSimple(doc);\n         // Fetch first\n-        AttributeSet attrs = hList.cutSameFont(defaultFont, 10, 10, null);\n+        AttributeSet attrs = hList.cutSameFont(defaultFont, 10, 10, null, false);\n         assert (attrs instanceof CompoundAttributes) : \"Non-CompoundAttributes attrs=\" + attrs;\n         CompoundAttributes cAttrs = (CompoundAttributes) attrs;\n         assert (cAttrs.startOffset() == 0) : \"startOffset=\" + cAttrs.startOffset();\n@@ -78,21 +79,21 @@ public void testSimple() throws Exception {\n         assertItem(items[2], 6, null);\n         // Fetch next\n         assert (hList.startOffset() == 6);\n-        attrs = hList.cutSameFont(defaultFont, 10, 10, null);\n+        attrs = hList.cutSameFont(defaultFont, 10, 10, null, false);\n         assert !(attrs instanceof CompoundAttributes);\n         assert attrs == attrSets[1];\n         assert (hList.startOffset() == 8);\n-        attrs = hList.cutSameFont(defaultFont, 10, 10, null);\n+        attrs = hList.cutSameFont(defaultFont, 10, 10, null, false);\n         assert !(attrs instanceof CompoundAttributes);\n         assert (attrs == null);\n         assert (hList.startOffset() == 10);\n         \n         \n         hList = highlightsListSimple(doc);\n-        attrs = hList.cutSameFont(defaultFont, 2, 2, null);\n+        attrs = hList.cutSameFont(defaultFont, 2, 2, null, false);\n         assert !(attrs instanceof CompoundAttributes);\n         assert (attrs == null);\n-        attrs = hList.cutSameFont(defaultFont, 10, 10, null);\n+        attrs = hList.cutSameFont(defaultFont, 10, 10, null, false);\n         assert (hList.startOffset() == 6);\n         assert (attrs instanceof CompoundAttributes) : \"Non-CompoundAttributes attrs=\" + attrs;\n         cAttrs = (CompoundAttributes) attrs;\n@@ -103,38 +104,38 @@ public void testSimple() throws Exception {\n         assertItem(items[1], 6, null);\n         \n         hList = highlightsListSimple(doc);\n-        attrs = hList.cutSameFont(defaultFont, 3, 3, null);\n+        attrs = hList.cutSameFont(defaultFont, 3, 3, null, false);\n         cAttrs = (CompoundAttributes) attrs;\n         assert (cAttrs.startOffset() == 0) : \"startOffset=\" + cAttrs.startOffset();\n         items = cAttrs.highlightItems();\n         assert (items.length == 2);\n         assertItem(items[0], 2, null);\n         assertItem(items[1], 3, attrSets[0]);\n         // Next\n-        attrs = hList.cutSameFont(defaultFont, 5, 5, null);\n+        attrs = hList.cutSameFont(defaultFont, 5, 5, null, false);\n         cAttrs = (CompoundAttributes) attrs;\n         assert (cAttrs.startOffset() == 3) : \"startOffset=\" + cAttrs.startOffset();\n         items = cAttrs.highlightItems();\n         assert (items.length == 2);\n         assertItem(items[0], 4, attrSets[0]);\n         assertItem(items[1], 5, null);\n         // Next\n-        attrs = hList.cutSameFont(defaultFont, 7, 7, null);\n+        attrs = hList.cutSameFont(defaultFont, 7, 7, null, false);\n         assert !(attrs instanceof CompoundAttributes);\n         assert (attrs == null);\n         assert (hList.startOffset() == 6);\n         // Next\n-        attrs = hList.cutSameFont(defaultFont, 7, 7, null);\n+        attrs = hList.cutSameFont(defaultFont, 7, 7, null, false);\n         assert !(attrs instanceof CompoundAttributes);\n         assert (attrs == attrSets[1]);\n         assert (hList.startOffset() == 7);\n         // Next\n-        attrs = hList.cutSameFont(defaultFont, 10, 10, null);\n+        attrs = hList.cutSameFont(defaultFont, 10, 10, null, false);\n         assert !(attrs instanceof CompoundAttributes);\n         assert (attrs == attrSets[1]);\n         assert (hList.startOffset() == 8);\n         // Next\n-        attrs = hList.cutSameFont(defaultFont, 10, 10, null);\n+        attrs = hList.cutSameFont(defaultFont, 10, 10, null, false);\n         assert !(attrs instanceof CompoundAttributes);\n         assert (attrs == null);\n         assert (hList.startOffset() == 10);\n@@ -151,6 +152,93 @@ private HighlightsList highlightsListSimple(Document doc) {\n         return reader.highlightsList();\n     }\n     \n+    @Test\n+    public void testSplitPrependText() throws Exception {\n+        Document doc = document();\n+\n+        OffsetsBag bag = new OffsetsBag(doc);\n+        AttributeSet attrs1 = AttributesUtilities.createImmutable(\n+                StyleConstants.Foreground, Color.RED,\n+                StyleConstants.FontFamily, fontNames[0]);\n+        AttributeSet attrs2 = AttributesUtilities.createImmutable(\n+                StyleConstants.Foreground, Color.RED,\n+                StyleConstants.FontFamily, fontNames[0],\n+                ViewUtils.KEY_VIRTUAL_TEXT_PREPEND, \"test\");\n+        AttributeSet attrs3 = AttributesUtilities.createImmutable(\n+                StyleConstants.Foreground, Color.RED,\n+                StyleConstants.FontFamily, fontNames[1]);\n+\n+        bag.addHighlight(0, 2, attrs1);\n+        bag.addHighlight(2, 4, attrs2);\n+        bag.addHighlight(4, 6, attrs1);\n+        bag.addHighlight(8, 10, attrs3);\n+\n+        int end = 14;\n+        DirectMergeContainer dmc = new DirectMergeContainer(new HighlightsContainer[]{ bag }, true);\n+\n+        {\n+        HighlightsReader reader = new HighlightsReader(dmc, 0, end);\n+        reader.readUntil(end);\n+        HighlightsList hList = reader.highlightsList();\n+\n+        // Fetch first\n+        AttributeSet attrs = hList.cutSameFont(defaultFont, end, end, null, false);\n+        assert (attrs instanceof CompoundAttributes) : \"Non-CompoundAttributes attrs=\" + attrs;\n+        CompoundAttributes cAttrs = (CompoundAttributes) attrs;\n+        assert (cAttrs.startOffset() == 0) : \"startOffset=\" + cAttrs.startOffset();\n+        HighlightItem[] items = cAttrs.highlightItems();\n+        assert (items.length == 4);\n+        assertItem(items[0], 2, attrs1);\n+        assertItem(items[1], 4, attrs2);\n+        assertItem(items[2], 6, attrs1);\n+        assertItem(items[3], 8, null);\n+        // Fetch next\n+        assert (hList.startOffset() == 8);\n+        attrs = hList.cutSameFont(defaultFont, end, end, null, false);\n+        assert !(attrs instanceof CompoundAttributes);\n+        assert attrs == attrs3;\n+        assert (hList.startOffset() == 10);\n+        attrs = hList.cutSameFont(defaultFont, end, end, null, false);\n+        assert !(attrs instanceof CompoundAttributes);\n+        assert (attrs == null);\n+        assert (hList.startOffset() == 14);\n+        }\n+\n+        {\n+        HighlightsReader reader = new HighlightsReader(dmc, 0, end);\n+        reader.readUntil(end);\n+        HighlightsList hList = reader.highlightsList();\n+\n+        // Fetch first\n+        AttributeSet attrs = hList.cutSameFont(defaultFont, end, end, null, true);\n+        assert !(attrs instanceof CompoundAttributes) : \"CompoundAttributes attrs=\" + attrs;\n+        assert attrs == attrs1;\n+        assert (hList.startOffset() == 2);\n+        attrs = hList.cutSameFont(defaultFont, end, end, null, true);\n+        assert !(attrs instanceof CompoundAttributes);\n+        assert (attrs == attrs2);\n+        assert (hList.startOffset() == 4);\n+        attrs = hList.cutSameFont(defaultFont, end, end, null, true);\n+        assert (attrs instanceof CompoundAttributes) : \"Non-CompoundAttributes attrs=\" + attrs;\n+        CompoundAttributes cAttrs = (CompoundAttributes) attrs;\n+        assert (cAttrs.startOffset() == 4) : \"startOffset=\" + cAttrs.startOffset();\n+        HighlightItem[] items = cAttrs.highlightItems();\n+        assert (items.length == 2);\n+        assertItem(items[0], 6, attrs1);\n+        assertItem(items[1], 8, null);\n+        // Fetch next\n+        assert (hList.startOffset() == 8);\n+        attrs = hList.cutSameFont(defaultFont, end, end, null, true);\n+        assert !(attrs instanceof CompoundAttributes);\n+        assert attrs == attrs3;\n+        assert (hList.startOffset() == 10);\n+        attrs = hList.cutSameFont(defaultFont, end, end, null, true);\n+        assert !(attrs instanceof CompoundAttributes);\n+        assert (attrs == null);\n+        assert (hList.startOffset() == 14);\n+        }\n+    }\n+\n     private static void assertItem(HighlightItem item, int endOffset, AttributeSet attrs) {\n         assert (item.getEndOffset() == endOffset) : \"itemEndOffset=\" + item.getEndOffset() + \" != endOffset=\" + endOffset; // NOI18N\n         assert (item.getAttributes() == attrs) : \"itemAttrs=\" + item.getAttributes() + \" != attrs=\" + attrs; // NOI18N", "filename": "ide/editor.lib2/test/unit/src/org/netbeans/modules/editor/lib2/highlighting/HighlightsListTest.java"}, {"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/java/java.editor.base/nbproject/project.properties", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/java/java.editor.base/nbproject/project.properties", "sha": "8d8f77e133abe943ec9c8788781d7c40a442a67a", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.editor.base/nbproject/project.properties?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -16,7 +16,7 @@\n # under the License.\n spec.version.base=2.70.0\n is.autoload=true\n-javac.source=1.7\n+javac.source=1.8\n javac.compilerargs=-Xlint -Xlint:-serial\n \n test.config.semantic.includes=\\", "filename": "java/java.editor.base/nbproject/project.properties"}, {"additions": 27, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/java/java.editor.base/src/org/netbeans/modules/java/editor/base/semantic/SemanticHighlighterBase.java", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/java/java.editor.base/src/org/netbeans/modules/java/editor/base/semantic/SemanticHighlighterBase.java", "sha": "58c7a053ed7fb6405e4b7694f9f6c2f5ea06e4cf", "changes": 29, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.editor.base/src/org/netbeans/modules/java/editor/base/semantic/SemanticHighlighterBase.java?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -27,6 +27,7 @@\n import com.sun.source.tree.ExportsTree;\n import com.sun.source.tree.IdentifierTree;\n import com.sun.source.tree.LambdaExpressionTree;\n+import com.sun.source.tree.LiteralTree;\n import com.sun.source.tree.MemberReferenceTree;\n import com.sun.source.tree.MemberSelectTree;\n import com.sun.source.tree.MethodInvocationTree;\n@@ -319,7 +320,7 @@ protected boolean process(CompilationInfo info, final Document doc, ErrorDescrip\n             return true;\n         \n         if (computeUnusedImports) {\n-            setter.setHighlights(doc, imports);\n+            setter.setHighlights(doc, imports, v.preText);\n         }\n \n         setter.setColorings(doc, newColoring);\n@@ -406,6 +407,7 @@ public String toString() {\n         private Map<Element, List<Use>> type2Uses;        \n         private Map<Tree, List<Token>> tree2Tokens;\n         private List<Token> contextKeywords;\n+        private Map<int[], String> preText;\n         private TokenList tl;\n         private long memberSelectBypass = -1;        \n         private SourcePositions sourcePositions;\n@@ -419,6 +421,7 @@ private DetectorVisitor(org.netbeans.api.java.source.CompilationInfo info, final\n             type2Uses = new HashMap<Element, List<Use>>();\n             tree2Tokens = new IdentityHashMap<Tree, List<Token>>();\n             contextKeywords = new ArrayList<>();\n+            preText = new HashMap<>();\n \n             tl = new TokenList(info, doc, cancel);\n             \n@@ -1060,11 +1063,33 @@ public Void visitMemberReference(MemberReferenceTree node, Void p) {\n             return null;\n         }\n \n+        @Override\n+        public Void visitLiteral(LiteralTree node, Void p) {\n+            TreePath pp = getCurrentPath().getParentPath();\n+            if (pp.getLeaf() != null &&\n+                pp.getLeaf().getKind() == Kind.METHOD_INVOCATION) {\n+                MethodInvocationTree inv = (MethodInvocationTree) pp.getLeaf();\n+                int pos = inv.getArguments().indexOf(node);\n+                if (pos != (-1)) {\n+                    Element invoked = info.getTrees().getElement(pp);\n+                    if (invoked != null && (invoked.getKind() == ElementKind.METHOD || invoked.getKind() == ElementKind.CONSTRUCTOR)) {\n+                        long start = sourcePositions.getStartPosition(info.getCompilationUnit(), node);\n+                        long end = start + 1;\n+                        ExecutableElement invokedMethod = (ExecutableElement) invoked;\n+                        pos = Math.min(pos, invokedMethod.getParameters().size() - 1);\n+                        preText.put(new int[] {(int) start, (int) end},\n+                                    invokedMethod.getParameters().get(pos).getSimpleName() + \":\");\n+                    }\n+                }\n+            }\n+            return super.visitLiteral(node, p);\n+        }\n+\n     }\n \n     public static interface ErrorDescriptionSetter {\n         \n-        public void setHighlights(Document doc, Collection<int[]> highlights);\n+        public void setHighlights(Document doc, Collection<int[]> highlights, Map<int[], String> preText);\n         public void setColorings(Document doc, Map<Token, Coloring> colorings);\n     }    \n }", "filename": "java/java.editor.base/src/org/netbeans/modules/java/editor/base/semantic/SemanticHighlighterBase.java"}, {"additions": 60, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/DetectorTest.java", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/DetectorTest.java", "sha": "1f25ff4d3cbd5db700adf6db232d9bf5ac932098", "changes": 60, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/DetectorTest.java?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -252,6 +252,53 @@ public void testGenericBoundIsClassUse() throws Exception {\n         performTest(\"GenericBoundIsClassUse\");\n     }\n \n+    public void testParameterNames() throws Exception {\n+        setShowPrependedText(true);\n+        performTest(\"Test.java\",\n+                    \"package test;\" +\n+                    \"public class Test {\" +\n+                    \"    public void api(String param1, int param2, int param3, float param4, Object... param5) {\" +\n+                    \"    }\" +\n+                    \"    private int getValue() {\" +\n+                    \"        return -1;\" +\n+                    \"    }\" +\n+                    \"    private void test() {\" +\n+                    \"        api(\\\"\\\", 2, getValue(), 1.0f);\" +\n+                    \"        api(\\\"\\\", 2, getValue(), 1.0f, null);\" +\n+                    \"        api(\\\"\\\", 2, getValue(), 1.0f, null, null);\" +\n+                    \"    }\" +\n+                    \"}\",\n+                    \"[PUBLIC, CLASS, DECLARATION], 0:26-0:30\\n\" +\n+                    \"[PUBLIC, METHOD, DECLARATION], 0:48-0:51\\n\" +\n+                    \"[PUBLIC, CLASS], 0:52-0:58\\n\" +\n+                    \"[PARAMETER, DECLARATION], 0:59-0:65\\n\" +\n+                    \"[PARAMETER, DECLARATION], 0:71-0:77\\n\" +\n+                    \"[PARAMETER, DECLARATION], 0:83-0:89\\n\" +\n+                    \"[PARAMETER, DECLARATION], 0:97-0:103\\n\" +\n+                    \"[PUBLIC, CLASS], 0:105-0:111\\n\" +\n+                    \"[PARAMETER, DECLARATION], 0:115-0:121\\n\" +\n+                    \"[PRIVATE, METHOD, DECLARATION], 0:145-0:153\\n\" +\n+                    \"[PRIVATE, METHOD, UNUSED, DECLARATION], 0:197-0:201\\n\" +\n+                    \"[PUBLIC, METHOD], 0:213-0:216\\n\" +\n+                    \"[param1:], 0:217-0:218\\n\" +\n+                    \"[param2:], 0:221-0:222\\n\" +\n+                    \"[PRIVATE, METHOD], 0:224-0:232\\n\" +\n+                    \"[param4:], 0:236-0:237\\n\" +\n+                    \"[PUBLIC, METHOD], 0:250-0:253\\n\" +\n+                    \"[param1:], 0:254-0:255\\n\" +\n+                    \"[param2:], 0:258-0:259\\n\" +\n+                    \"[PRIVATE, METHOD], 0:261-0:269\\n\" +\n+                    \"[param4:], 0:273-0:274\\n\" +\n+                    \"[param5:], 0:279-0:280\\n\" +\n+                    \"[PUBLIC, METHOD], 0:293-0:296\\n\" +\n+                    \"[param1:], 0:297-0:298\\n\" +\n+                    \"[param2:], 0:301-0:302\\n\" +\n+                    \"[PRIVATE, METHOD], 0:304-0:312\\n\" +\n+                    \"[param4:], 0:316-0:317\\n\" +\n+                    \"[param5:], 0:322-0:323\\n\" +\n+                    \"[param5:], 0:328-0:329\\n\");\n+    }\n+\n     @RandomlyFails\n     public void testBLE91246() throws Exception {\n         final boolean wasThrown[] = new boolean[1];\n@@ -411,6 +458,19 @@ protected boolean process(CompilationInfo info, Document doc) {\n         });\n     }\n     \n+    private void performTest(String fileName, String content, String expected) throws Exception {\n+        performTest(fileName, content, new Performer() {\n+            public void compute(CompilationController parameter, Document doc, final ErrorDescriptionSetter setter) {\n+                new SemanticHighlighterBase() {\n+                    @Override\n+                    protected boolean process(CompilationInfo info, Document doc) {\n+                        return process(info, doc, setter);\n+                    }\n+                }.process(parameter, doc);\n+            }\n+        }, false, expected);\n+    }\n+\n     private FileObject testSourceFO;\n     \n     static {", "filename": "java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/DetectorTest.java"}, {"additions": 18, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/HighlightImpl.java", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/HighlightImpl.java", "sha": "dffd3e5ec01b11de2b6eb74876d1c4da03b2e993", "changes": 19, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/HighlightImpl.java?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -40,6 +40,7 @@\n     private int start;\n     private int end;\n     private Collection<ColoringAttributes> colorings;\n+    private String textPrepend;\n     \n     public HighlightImpl(Document doc, Token token, Collection<ColoringAttributes> colorings) {\n         this.doc       = doc;\n@@ -55,6 +56,14 @@ public HighlightImpl(Document doc, int start, int end, Collection<ColoringAttrib\n         this.colorings = colorings;\n     }\n     \n+    public HighlightImpl(Document doc, int start, int end, String textPrepend) {\n+        this.doc = doc;\n+        this.start = start;\n+        this.end = end;\n+        this.colorings = ColoringAttributes.empty();\n+        this.textPrepend = textPrepend;\n+    }\n+\n     public int getStart() {\n         return start;\n     }\n@@ -88,7 +97,15 @@ private String coloringsToString() {\n                 result.append(attribute.name());\n             }\n         }\n-        \n+\n+        if (textPrepend != null) {\n+            if (!first) {\n+                result.append(\", \");\n+            }\n+\n+            result.append(textPrepend);\n+        }\n+\n         result.append(\"]\");\n         \n         return result.toString();", "filename": "java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/HighlightImpl.java"}, {"additions": 2, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/MarkOccDetTest.java", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/MarkOccDetTest.java", "sha": "cd07ba613aa4532ce6055ba32dc40c48f63b670e", "changes": 3, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/MarkOccDetTest.java?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -18,6 +18,7 @@\n  */\n package org.netbeans.modules.java.editor.base.semantic;\n \n+import java.util.Collections;\n import java.util.List;\n import javax.swing.text.Document;\n import javax.swing.text.StyledDocument;\n@@ -354,7 +355,7 @@ protected void process(CompilationInfo info, Document doc, SchedulerEvent event)\n                 }.processImpl(info, MarkOccurencesSettings.getCurrentNode(), doc, offset);\n                 \n                 if (spans != null) {\n-                    setter.setHighlights(doc, spans);\n+                    setter.setHighlights(doc, spans, Collections.<int[], String>emptyMap());\n                 }\n             }\n         }, doCompileRecursively);", "filename": "java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/MarkOccDetTest.java"}, {"additions": 88, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/TestBase.java", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/TestBase.java", "sha": "7b2aca547a2bc064e555956a8d990bc3543c5ad6", "changes": 125, "status": "modified", "deletions": 37, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/TestBase.java?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -26,6 +26,8 @@\n import java.io.IOException;\n import java.io.InputStream;\n import java.io.OutputStream;\n+import java.io.OutputStreamWriter;\n+import java.io.StringWriter;\n import java.io.Writer;\n import java.net.URL;\n import java.util.ArrayList;\n@@ -95,23 +97,76 @@ protected void performTest(String fileName, final Performer performer) throws Ex\n     }\n     \n     protected void performTest(String fileName, final Performer performer, boolean doCompileRecursively) throws Exception {\n+        performTest(() -> {\n+            File wd = getWorkDir();\n+            File testSource = new File(wd, \"test/\" + fileName + \".java\");\n+\n+            testSource.getParentFile().mkdirs();\n+\n+            File dataFolder = new File(getDataDir(), \"org/netbeans/modules/java/editor/base/semantic/data/\");\n+\n+            for (File f : dataFolder.listFiles()) {\n+                copyToWorkDir(f, new File(wd, \"test/\" + f.getName()));\n+            }\n+\n+            return FileUtil.toFileObject(testSource);\n+        }, performer, doCompileRecursively,\n+        actual -> {\n+            File output = new File(getWorkDir(), getName() + \".out\");\n+            try (Writer out2File = new FileWriter(output)) {\n+                out2File.append(actual);\n+            }\n+\n+            boolean wasException = true;\n+\n+            try {\n+                File goldenFile = getGoldenFile();\n+                File diffFile = new File(getWorkDir(), getName() + \".diff\");\n+\n+                assertFile(output, goldenFile, diffFile);\n+                wasException = false;\n+            } finally {\n+                if (wasException && SHOW_GUI_DIFF) {\n+                    try {\n+                        String name = getClass().getName();\n+\n+                        name = name.substring(name.lastIndexOf('.') + 1);\n+\n+                        ShowGoldenFiles.run(name, getName(), fileName);\n+\n+                    } catch (Exception e) {\n+                        e.printStackTrace();\n+                    }\n+                }\n+            }\n+        });\n+    }\n+\n+    protected void performTest(String filename, String content, final Performer performer, boolean doCompileRecursively, String expected) throws Exception {\n+        performTest(() -> {\n+            FileObject wd = FileUtil.toFileObject(getWorkDir());\n+            FileObject result = FileUtil.createData(wd, filename);\n+\n+            try (Writer out = new OutputStreamWriter(result.getOutputStream())) {\n+                out.write(content);\n+            }\n+\n+            return result;\n+        }, performer, doCompileRecursively,\n+        actual -> {\n+            assertEquals(expected, actual);\n+        });\n+    }\n+\n+    protected void performTest(Input input, final Performer performer, boolean doCompileRecursively, Validator validator) throws Exception {\n         SourceUtilsTestUtil.prepareTest(new String[] {\"org/netbeans/modules/java/editor/resources/layer.xml\"}, new Object[] {new MIMEResolverImpl()});\n         \n \tFileObject scratch = SourceUtilsTestUtil.makeScratchDir(this);\n \tFileObject cache   = scratch.createFolder(\"cache\");\n \t\n         File wd         = getWorkDir();\n-        File testSource = new File(wd, \"test/\" + fileName + \".java\");\n-        \n-        testSource.getParentFile().mkdirs();\n-        \n-        File dataFolder = new File(getDataDir(), \"org/netbeans/modules/java/editor/base/semantic/data/\");\n-        \n-        for (File f : dataFolder.listFiles()) {\n-            copyToWorkDir(f, new File(wd, \"test/\" + f.getName()));\n-        }\n-        \n-        testSourceFO = FileUtil.toFileObject(testSource);\n+\n+        testSourceFO = input.prepare();\n \n         assertNotNull(testSourceFO);\n \n@@ -123,7 +178,7 @@ protected void performTest(String fileName, final Performer performer, boolean d\n         \n         testBuildTo.mkdirs();\n         \n-        FileObject srcRoot = FileUtil.toFileObject(testSource.getParentFile());\n+        FileObject srcRoot = testSourceFO.getParent();\n         SourceUtilsTestUtil.prepareTest(srcRoot,FileUtil.toFileObject(testBuildTo), cache);\n         \n         if (doCompileRecursively) {\n@@ -162,8 +217,7 @@ public void run(CompilationController parameter) {\n \t\n         l.await();\n                 \n-        File output = new File(getWorkDir(), getName() + \".out\");\n-        Writer out = new FileWriter(output);\n+        StringWriter out = new StringWriter();\n         \n         for (HighlightImpl h : highlights) {\n             out.write(h.getHighlightTestData());\n@@ -172,29 +226,8 @@ public void run(CompilationController parameter) {\n         }\n         \n         out.close();\n-                \n-        boolean wasException = true;\n         \n-        try {\n-            File goldenFile = getGoldenFile();\n-            File diffFile = new File(getWorkDir(), getName() + \".diff\");\n-            \n-            assertFile(output, goldenFile, diffFile);\n-            wasException = false;\n-        } finally {\n-            if (wasException && SHOW_GUI_DIFF) {\n-                try {\n-                    String name = getClass().getName();\n-                    \n-                    name = name.substring(name.lastIndexOf('.') + 1);\n-                    \n-                    ShowGoldenFiles.run(name, getName(), fileName);\n-                    \n-                } catch (Exception e) {\n-                    e.printStackTrace();\n-                }\n-            }\n-        }\n+        validator.validate(out.toString());\n     }\n     \n     protected ColoringAttributes getColoringAttribute() {\n@@ -239,6 +272,12 @@ protected final void setSourceLevel(String sourceLevel) {\n         this.sourceLevel = sourceLevel;\n     }\n \n+    private boolean showPrependedText;\n+\n+    protected final void setShowPrependedText(boolean showPrependedText) {\n+        this.showPrependedText = showPrependedText;\n+    }\n+\n     final class ErrorDescriptionSetterImpl implements SemanticHighlighterBase.ErrorDescriptionSetter {\n         private final Set<HighlightImpl> highlights = new TreeSet<HighlightImpl>(new Comparator<HighlightImpl>() {\n             public int compare(HighlightImpl o1, HighlightImpl o2) {\n@@ -251,10 +290,15 @@ public void setErrors(Document doc, List<ErrorDescription> errs, List<TreePathHa\n         }\n     \n         @Override\n-        public void setHighlights(Document doc, Collection<int[]> highlights) {\n+        public void setHighlights(Document doc, Collection<int[]> highlights, Map<int[], String> preText) {\n             for (int[] h : highlights) {\n                 this.highlights.add(new HighlightImpl(doc, h[0], h[1], EnumSet.of(getColoringAttribute())));\n             }\n+            if (showPrependedText) {\n+                for (Entry<int[], String> e : preText.entrySet()) {\n+                    this.highlights.add(new HighlightImpl(doc, e.getKey()[0], e.getKey()[1], e.getValue()));\n+                }\n+            }\n         }\n \n         @Override\n@@ -273,4 +317,11 @@ public String findMIMEType(FileObject fo) {\n         }\n     }\n     \n+    protected interface Input {\n+        public FileObject prepare() throws Exception;\n+    }\n+\n+    protected interface Validator {\n+        public void validate(String actual) throws Exception;\n+    }\n }", "filename": "java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/TestBase.java"}, {"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/java/java.editor/src/org/netbeans/modules/java/editor/semantic/HighlightsLayerFactoryImpl.java", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/java/java.editor/src/org/netbeans/modules/java/editor/semantic/HighlightsLayerFactoryImpl.java", "sha": "03a98b4267ec101d658f4be157c6ea46d90beacb", "changes": 1, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.editor/src/org/netbeans/modules/java/editor/semantic/HighlightsLayerFactoryImpl.java?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -38,6 +38,7 @@\n         return new HighlightsLayer[] {\n             HighlightsLayer.create(SemanticHighlighter.class.getName() + \"-1\", ZOrder.SYNTAX_RACK.forPosition(1000), false,semantic),\n             HighlightsLayer.create(SemanticHighlighter.class.getName() + \"-2\", ZOrder.SYNTAX_RACK.forPosition(1500), false, SemanticHighlighter.getImportHighlightsBag(context.getDocument())),\n+            HighlightsLayer.create(SemanticHighlighter.class.getName() + \"-3\", ZOrder.SYNTAX_RACK.forPosition(1600), false, SemanticHighlighter.getPreTextBag(context.getDocument())),\n             //the mark occurrences layer should be \"above\" current row and \"below\" the search layers:\n             HighlightsLayer.create(MarkOccurrencesHighlighter.class.getName(), ZOrder.SHOW_OFF_RACK.forPosition(20), true, MarkOccurrencesHighlighter.getHighlightsBag(context.getDocument())),\n             //\"above\" mark occurrences, \"below\" search layers:", "filename": "java/java.editor/src/org/netbeans/modules/java/editor/semantic/HighlightsLayerFactoryImpl.java"}, {"additions": 26, "raw_url": "https://github.com/apache/netbeans/raw/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/java/java.editor/src/org/netbeans/modules/java/editor/semantic/SemanticHighlighter.java", "blob_url": "https://github.com/apache/netbeans/blob/89712349b8367ba74d1bc3d956ebe9c98d91cd3c/java/java.editor/src/org/netbeans/modules/java/editor/semantic/SemanticHighlighter.java", "sha": "065d8f80b04504a3df77b91eea8a1d1659d33dde", "changes": 27, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java/java.editor/src/org/netbeans/modules/java/editor/semantic/SemanticHighlighter.java?ref=89712349b8367ba74d1bc3d956ebe9c98d91cd3c", "patch": "@@ -23,12 +23,14 @@\n import java.util.IdentityHashMap;\n import java.util.List;\n import java.util.Map;\n+import java.util.Map.Entry;\n import java.util.Set;\n import java.util.logging.Level;\n import java.util.logging.Logger;\n \n import javax.swing.SwingUtilities;\n import javax.swing.text.Document;\n+import org.netbeans.api.editor.settings.AttributesUtilities;\n \n import org.netbeans.api.java.source.CompilationInfo;\n import org.netbeans.api.java.source.TreePathHandle;\n@@ -60,7 +62,7 @@ protected boolean process(final CompilationInfo info, final Document doc) {\n         \n         public void setErrors(Document doc, List<ErrorDescription> errors, List<TreePathHandle> allUnusedImports) {}\n         \n-        public void setHighlights(final Document doc, final Collection<int[]> highlights) {\n+        public void setHighlights(final Document doc, final Collection<int[]> highlights, Map<int[], String> preText) {\n             SwingUtilities.invokeLater(new Runnable() {\n                 public void run() {\n                     OffsetsBag bag = new OffsetsBag(doc);\n@@ -69,6 +71,12 @@ public void run() {\n                         bag.addHighlight(highlight[0], highlight[1], ColoringManager.getColoringImpl(unused));\n                     }\n                     getImportHighlightsBag(doc).setHighlights(bag);\n+                    \n+                    OffsetsBag preTextBag = new OffsetsBag(doc);\n+                    for (Entry<int[], String> e : preText.entrySet()) {\n+                        preTextBag.addHighlight(e.getKey()[0], e.getKey()[1], AttributesUtilities.createImmutable(\"virtual-text-prepend\", e.getValue()));\n+                    }\n+                    getPreTextBag(doc).setHighlights(preTextBag);\n                 }\n             });\n         }\n@@ -109,4 +117,21 @@ static OffsetsBag getImportHighlightsBag(Document doc) {\n         return bag;\n     }\n \n+    private static final Object KEY_PRE_TEXT = new Object();\n+    static OffsetsBag getPreTextBag(Document doc) {\n+        OffsetsBag bag = (OffsetsBag) doc.getProperty(KEY_PRE_TEXT);\n+        \n+        if (bag == null) {\n+            doc.putProperty(KEY_PRE_TEXT, bag = new OffsetsBag(doc));\n+            \n+            Object stream = doc.getProperty(Document.StreamDescriptionProperty);\n+            \n+            if (stream instanceof DataObject) {\n+//                TimesCollector.getDefault().reportReference(((DataObject) stream).getPrimaryFile(), \"ImportsHighlightsBag\", \"[M] Imports Highlights Bag\", bag);\n+            }\n+        }\n+        \n+        return bag;\n+    }\n+\n }", "filename": "java/java.editor/src/org/netbeans/modules/java/editor/semantic/SemanticHighlighter.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/7970e3eea62f3bd0ea81459a023c576fd84b6ce4", "parent": "https://github.com/apache/netbeans/commit/5eda3cb4da1045b5f9ceaf5f1a5c763cbdcef30a", "message": "Some more fixes for the Language Server Protocol client:\n\n-following TextDocumentSyncKind requestes\r\n-sending client configuration also when connecting to a server manually\r\n-prevent NPE when closing IDE when a server is configured manually", "bug_id": "netbeans_24", "file": [{"additions": 12, "raw_url": "https://github.com/apache/netbeans/raw/7970e3eea62f3bd0ea81459a023c576fd84b6ce4/ide/lsp.client/src/org/netbeans/modules/lsp/client/LSPBindings.java", "blob_url": "https://github.com/apache/netbeans/blob/7970e3eea62f3bd0ea81459a023c576fd84b6ce4/ide/lsp.client/src/org/netbeans/modules/lsp/client/LSPBindings.java", "sha": "110eefbc2b1b835299ded51e0aeb1a335a020d51", "changes": 24, "status": "modified", "deletions": 12, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/ide/lsp.client/src/org/netbeans/modules/lsp/client/LSPBindings.java?ref=7970e3eea62f3bd0ea81459a023c576fd84b6ce4", "patch": "@@ -109,12 +109,7 @@ public static synchronized LSPBindings getBindings(FileObject file) {\n                                                        Launcher<LanguageServer> launcher = LSPLauncher.createClientLauncher(lci, in, out);\n                                                        launcher.startListening();\n                                                        LanguageServer server = launcher.getRemoteProxy();\n-                                                       InitializeParams initParams = new InitializeParams();\n-                                                       initParams.setRootUri(Utils.toURI(prj.getProjectDirectory())); //XXX: what if a different root is expected????\n-                                                       initParams.setRootPath(FileUtil.toFile(prj.getProjectDirectory()).getAbsolutePath()); //some servers still expect root path\n-                                                       initParams.setProcessId(0);\n-                                                       initParams.setCapabilities(new ClientCapabilities(new WorkspaceClientCapabilities(), new TextDocumentClientCapabilities(), null));\n-                                                       InitializeResult result = server.initialize(initParams).get();\n+                                                       InitializeResult result = initServer(server, prj.getProjectDirectory()); //XXX: what if a different root is expected????\n                                                        LSPBindings b = new LSPBindings(server, result, LanguageServerProviderAccessor.getINSTANCE().getProcess(desc));\n                                                        lci.setBindings(b);\n                                                        return b;\n@@ -152,11 +147,7 @@ public void write(int w) throws IOException {\n                 });\n                 launcher.startListening();\n                 LanguageServer server = launcher.getRemoteProxy();\n-\n-                InitializeParams initParams = new InitializeParams();\n-                initParams.setRootUri(Utils.toURI(root));\n-                initParams.setProcessId(0);\n-                InitializeResult result = server.initialize(initParams).get();\n+                InitializeResult result = initServer(server, root);\n                 LSPBindings bindings = new LSPBindings(server, result, null);\n \n                 lc.setBindings(bindings);\n@@ -168,6 +159,15 @@ public void write(int w) throws IOException {\n         }, Bundle.LBL_Connecting());\n     }\n \n+    private static InitializeResult initServer(LanguageServer server, FileObject root) throws InterruptedException, ExecutionException {\n+       InitializeParams initParams = new InitializeParams();\n+       initParams.setRootUri(Utils.toURI(root));\n+       initParams.setRootPath(FileUtil.toFile(root).getAbsolutePath()); //some servers still expect root path\n+       initParams.setProcessId(0);\n+       initParams.setCapabilities(new ClientCapabilities(new WorkspaceClientCapabilities(), new TextDocumentClientCapabilities(), null));\n+       return server.initialize(initParams).get();\n+    }\n+\n     private final LanguageServer server;\n     private final InitializeResult initResult;\n     private final Process process;\n@@ -246,7 +246,7 @@ public void run() {\n             }\n             for (Map<String, LSPBindings> mime2Bindings : workspace2Extension2Server.values()) {\n                 for (LSPBindings b : mime2Bindings.values()) {\n-                    if (b != null) {\n+                    if (b != null && b.process != null) {\n                         b.process.destroy();\n                     }\n                 }", "filename": "ide/lsp.client/src/org/netbeans/modules/lsp/client/LSPBindings.java"}, {"additions": 38, "raw_url": "https://github.com/apache/netbeans/raw/7970e3eea62f3bd0ea81459a023c576fd84b6ce4/ide/lsp.client/src/org/netbeans/modules/lsp/client/bindings/TextDocumentSyncServerCapabilityHandler.java", "blob_url": "https://github.com/apache/netbeans/blob/7970e3eea62f3bd0ea81459a023c576fd84b6ce4/ide/lsp.client/src/org/netbeans/modules/lsp/client/bindings/TextDocumentSyncServerCapabilityHandler.java", "sha": "79c88af92fb2f9594a10c56f593d35ffcb8c8b4d", "changes": 43, "status": "modified", "deletions": 5, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/ide/lsp.client/src/org/netbeans/modules/lsp/client/bindings/TextDocumentSyncServerCapabilityHandler.java?ref=7970e3eea62f3bd0ea81459a023c576fd84b6ce4", "patch": "@@ -34,7 +34,10 @@\n import org.eclipse.lsp4j.Range;\n import org.eclipse.lsp4j.TextDocumentContentChangeEvent;\n import org.eclipse.lsp4j.TextDocumentItem;\n+import org.eclipse.lsp4j.TextDocumentSyncKind;\n+import org.eclipse.lsp4j.TextDocumentSyncOptions;\n import org.eclipse.lsp4j.VersionedTextDocumentIdentifier;\n+import org.eclipse.lsp4j.jsonrpc.messages.Either;\n import org.netbeans.api.editor.EditorRegistry;\n import org.netbeans.editor.BaseDocumentEvent;\n import org.netbeans.modules.editor.*;\n@@ -133,21 +136,51 @@ private void fireEvent(int start, String newText, String oldText) {\n                         }\n                         Position endPos = new Position(startPos.getLine() + additionalLines,\n                                                        startPos.getCharacter() + additionalChars);\n-                        TextDocumentContentChangeEvent event;\n-                        event = new TextDocumentContentChangeEvent(new Range(startPos,\n+                        TextDocumentContentChangeEvent[] event = new TextDocumentContentChangeEvent[1];\n+                        event[0] = new TextDocumentContentChangeEvent(new Range(startPos,\n                                                                              endPos),\n                                                                    oldText.length(),\n                                                                    newText);\n-                        VersionedTextDocumentIdentifier di = new VersionedTextDocumentIdentifier(++version);\n-                        di.setUri(org.netbeans.modules.lsp.client.Utils.toURI(file));\n-                        DidChangeTextDocumentParams params = new DidChangeTextDocumentParams(di, Arrays.asList(event));\n \n                         WORKER.post(() -> {\n                             LSPBindings server = LSPBindings.getBindings(file);\n \n                             if (server == null)\n                                 return ; //ignore\n \n+                            TextDocumentSyncKind syncKind = TextDocumentSyncKind.None;\n+                            Either<TextDocumentSyncKind, TextDocumentSyncOptions> sync = server.getInitResult().getCapabilities().getTextDocumentSync();\n+                            if (sync != null) {\n+                                if (sync.isLeft()) {\n+                                    syncKind = sync.getLeft();\n+                                } else {\n+                                    TextDocumentSyncKind change = sync.getRight().getChange();\n+                                    if (change != null)\n+                                        syncKind = change;\n+                                }\n+                            }\n+                            switch (syncKind) {\n+                                case None:\n+                                    return ;\n+                                case Full:\n+                                    doc.render(() -> {\n+                                        try {\n+                                            event[0] = new TextDocumentContentChangeEvent(doc.getText(0, doc.getLength()));\n+                                        } catch (BadLocationException ex) {\n+                                            Exceptions.printStackTrace(ex);\n+                                            event[0] = new TextDocumentContentChangeEvent(\"\");\n+                                        }\n+                                    });\n+                                    break;\n+                                case Incremental:\n+                                    //event already filled\n+                                    break;\n+                            }\n+\n+                            VersionedTextDocumentIdentifier di = new VersionedTextDocumentIdentifier(++version);\n+                            di.setUri(org.netbeans.modules.lsp.client.Utils.toURI(file));\n+                            DidChangeTextDocumentParams params = new DidChangeTextDocumentParams(di, Arrays.asList(event));\n+\n                             server.getTextDocumentService().didChange(params);\n                             server.scheduleBackgroundTasks(file);\n                         });", "filename": "ide/lsp.client/src/org/netbeans/modules/lsp/client/bindings/TextDocumentSyncServerCapabilityHandler.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/c43c9033f11952f73971ae4b1534b94883edef00", "parent": "https://github.com/apache/netbeans/commit/5de5478f2ca8c5ddcb2e8528094987f3db44cdb8", "message": "NETBEANS-1049: prevent NPE on unpersistable components (#638)", "bug_id": "netbeans_25", "file": [{"additions": 6, "raw_url": "https://github.com/apache/netbeans/raw/c43c9033f11952f73971ae4b1534b94883edef00/core.windows/src/org/netbeans/core/windows/documentgroup/GroupsManager.java", "blob_url": "https://github.com/apache/netbeans/blob/c43c9033f11952f73971ae4b1534b94883edef00/core.windows/src/org/netbeans/core/windows/documentgroup/GroupsManager.java", "sha": "180db3ced443270ac00f5192f40758b19d1abcb7", "changes": 6, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/core.windows/src/org/netbeans/core/windows/documentgroup/GroupsManager.java?ref=c43c9033f11952f73971ae4b1534b94883edef00", "patch": "@@ -348,7 +348,13 @@ boolean closeGroup(DocumentGroupImpl group) {\n             String id = wmi.findTopComponentID(tc);\n             if( tc.equals(welcomeTc) && !welcomeWasOpened )\n                 continue;\n+            if (tc.getPersistenceType() == TopComponent.PERSISTENCE_NEVER) {\n+                continue;\n+            }\n             FileObject tcFO = FileUtil.toFileObject(new File(componentRoot, id + \".\" + SETTINGS)); //NOI18N //NOI18N\n+            if (tcFO == null) {\n+                continue;\n+            }\n             try {\n                 tcFO.copy(groupFO, id, SETTINGS);\n             } catch( IOException ex ) {", "filename": "core.windows/src/org/netbeans/core/windows/documentgroup/GroupsManager.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/7fe2d3774f700650f532d15118d69e572d81c74e", "parent": "https://github.com/apache/netbeans/commit/e0ee00578ea26326b73681993c12df669c174f40", "message": "#268649-NPE opening JS file in JsStructureScanner.folds", "bug_id": "netbeans_26", "file": [{"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/7fe2d3774f700650f532d15118d69e572d81c74e/lexer.nbbridge/nbproject/project.properties", "blob_url": "https://github.com/apache/netbeans/blob/7fe2d3774f700650f532d15118d69e572d81c74e/lexer.nbbridge/nbproject/project.properties", "sha": "40c44bdf155b96419ac60b5f090015a4593a0e82", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/lexer.nbbridge/nbproject/project.properties?ref=7fe2d3774f700650f532d15118d69e572d81c74e", "patch": "@@ -16,6 +16,6 @@\n # under the License.\n is.eager=true\n javac.compilerargs=-Xlint:unchecked\n-javac.source=1.6\n+javac.source=1.8\n javadoc.arch=${basedir}/arch.xml\n spec.version.base=1.35.0", "filename": "lexer.nbbridge/nbproject/project.properties"}, {"additions": 37, "raw_url": "https://github.com/apache/netbeans/raw/7fe2d3774f700650f532d15118d69e572d81c74e/lexer.nbbridge/src/org/netbeans/modules/lexer/nbbridge/MimeLookupLanguageProvider.java", "blob_url": "https://github.com/apache/netbeans/blob/7fe2d3774f700650f532d15118d69e572d81c74e/lexer.nbbridge/src/org/netbeans/modules/lexer/nbbridge/MimeLookupLanguageProvider.java", "sha": "d82b1f71cdeaf21e30ba3815a156aed34998ad7e", "changes": 38, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/lexer.nbbridge/src/org/netbeans/modules/lexer/nbbridge/MimeLookupLanguageProvider.java?ref=7fe2d3774f700650f532d15118d69e572d81c74e", "patch": "@@ -19,6 +19,8 @@\n \n package org.netbeans.modules.lexer.nbbridge;\n \n+import java.util.HashMap;\n+import java.util.Map;\n import org.netbeans.api.editor.mimelookup.MimeLookup;\n import org.netbeans.api.editor.mimelookup.MimePath;\n import org.netbeans.api.lexer.InputAttributes;\n@@ -28,6 +30,8 @@\n import org.netbeans.spi.lexer.LanguageEmbedding;\n import org.netbeans.spi.lexer.LanguageProvider;\n import org.openide.util.Lookup;\n+import org.openide.util.LookupEvent;\n+import org.openide.util.LookupListener;\n \n /**\n  *\n@@ -36,18 +40,50 @@\n @org.openide.util.lookup.ServiceProvider(service=org.netbeans.spi.lexer.LanguageProvider.class)\n public final class MimeLookupLanguageProvider extends LanguageProvider {\n     \n+    private final Map<String, Lookup.Result<Language>> langLkpResultsMap = \n+                  new HashMap<>();\n+    private final Map<String, Lookup.Result<LanguagesEmbeddingMap>> embeddingsLkpResultsMap = \n+                  new HashMap<>();\n+    private final String LOCK = new String(\"MimeLookupLanguageProvider.LOCK\"); //NOI18N\n+ \n     public MimeLookupLanguageProvider() {\n         super();\n     }\n \n     public Language<?> findLanguage(String mimeType) {\n         Lookup lookup = MimeLookup.getLookup(MimePath.parse(mimeType));\n+ \n+        //268649: add lookup listener for Language.class\n+        synchronized (LOCK) {\n+            Lookup.Result result = langLkpResultsMap.get(mimeType);\n+            if (result == null) {\n+                result = lookup.lookup(new Lookup.Template(Language.class));\n+                result.addLookupListener((LookupEvent evt) -> {\n+                    firePropertyChange(PROP_LANGUAGE);\n+                });\n+                langLkpResultsMap.put(mimeType, result);\n+            }\n+        } \n         return (Language<?>)lookup.lookup(Language.class);\n     }\n \n     public LanguageEmbedding<?> findLanguageEmbedding(\n     Token<?> token, LanguagePath languagePath, InputAttributes inputAttributes) {\n-        Lookup lookup = MimeLookup.getLookup(MimePath.parse(languagePath.mimePath()));\n+        String mimePath = languagePath.mimePath();\n+        Lookup lookup = MimeLookup.getLookup(MimePath.parse(mimePath));\n+        \n+        //268649: add lookup listener for LanguagesEmbeddingMap.class            \n+        synchronized (LOCK) {\n+            Lookup.Result result = embeddingsLkpResultsMap.get(mimePath);\n+            if (result == null) {\n+                result = lookup.lookup(new Lookup.Template(LanguagesEmbeddingMap.class));\n+                result.addLookupListener((LookupEvent evt) -> {\n+                    firePropertyChange(PROP_EMBEDDED_LANGUAGE);\n+                });\n+                embeddingsLkpResultsMap.put(mimePath, result);\n+            }\n+        }\n+\n         LanguagesEmbeddingMap map = lookup.lookup(LanguagesEmbeddingMap.class);\n         return map == null ? null : map.getLanguageEmbeddingForTokenName(token.id().name());\n     }", "filename": "lexer.nbbridge/src/org/netbeans/modules/lexer/nbbridge/MimeLookupLanguageProvider.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/3b201fd09586758ff6229f2f311bba37b04db88e", "parent": "https://github.com/apache/netbeans/commit/144afc6076048be9436b309f9a84a973da256209", "message": "Merge pull request #340 from jlahoda/prevent-npe-indexing-computeFQNs\n\n[NETBEANS-227] Preventing NPE during indexing: the parsed fileobject \u2026", "bug_id": "netbeans_27", "file": [{"additions": 2, "raw_url": "https://github.com/apache/netbeans/raw/3b201fd09586758ff6229f2f311bba37b04db88e/java.source.base/src/org/netbeans/modules/java/source/parsing/WriteBackTransaction.java", "blob_url": "https://github.com/apache/netbeans/blob/3b201fd09586758ff6229f2f311bba37b04db88e/java.source.base/src/org/netbeans/modules/java/source/parsing/WriteBackTransaction.java", "sha": "bf135f72892e23cc4f8e28aed219657c74fe3e06", "changes": 2, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java.source.base/src/org/netbeans/modules/java/source/parsing/WriteBackTransaction.java?ref=3b201fd09586758ff6229f2f311bba37b04db88e", "patch": "@@ -18,6 +18,7 @@\n  */\n package org.netbeans.modules.java.source.parsing;\n \n+import com.sun.tools.javac.api.ClientCodeWrapper.Trusted;\n import java.io.ByteArrayInputStream;\n import java.io.ByteArrayOutputStream;\n import java.io.File;\n@@ -387,6 +388,7 @@ static File toFile(JavaFileObject o) {\n      * \n      * The CacheFO may be \"flushed\" (written to shadowFile) or \"committed\" (moved to the final dest).\n      */\n+    @Trusted\n     static class CachedFileObject extends FileObjects.FileBase {\n \n         private static final byte[] NOTHING = new byte[0];", "filename": "java.source.base/src/org/netbeans/modules/java/source/parsing/WriteBackTransaction.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/a640484d9e7fc5176aa137313699696eca533e4b", "parent": "https://github.com/apache/netbeans/commit/dc04a3e144276f2ce83991be0a92cc2c657e97a3", "message": "Merge pull request #620 from rtaneja1/rtaneja/donation2_merge268649\n\n#268649-NPE at JsStructureScanner.folds while opening .js file", "bug_id": "netbeans_28", "file": [{"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/a640484d9e7fc5176aa137313699696eca533e4b/lexer.nbbridge/nbproject/project.properties", "blob_url": "https://github.com/apache/netbeans/blob/a640484d9e7fc5176aa137313699696eca533e4b/lexer.nbbridge/nbproject/project.properties", "sha": "40c44bdf155b96419ac60b5f090015a4593a0e82", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/lexer.nbbridge/nbproject/project.properties?ref=a640484d9e7fc5176aa137313699696eca533e4b", "patch": "@@ -16,6 +16,6 @@\n # under the License.\n is.eager=true\n javac.compilerargs=-Xlint:unchecked\n-javac.source=1.6\n+javac.source=1.8\n javadoc.arch=${basedir}/arch.xml\n spec.version.base=1.35.0", "filename": "lexer.nbbridge/nbproject/project.properties"}, {"additions": 37, "raw_url": "https://github.com/apache/netbeans/raw/a640484d9e7fc5176aa137313699696eca533e4b/lexer.nbbridge/src/org/netbeans/modules/lexer/nbbridge/MimeLookupLanguageProvider.java", "blob_url": "https://github.com/apache/netbeans/blob/a640484d9e7fc5176aa137313699696eca533e4b/lexer.nbbridge/src/org/netbeans/modules/lexer/nbbridge/MimeLookupLanguageProvider.java", "sha": "d82b1f71cdeaf21e30ba3815a156aed34998ad7e", "changes": 38, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/lexer.nbbridge/src/org/netbeans/modules/lexer/nbbridge/MimeLookupLanguageProvider.java?ref=a640484d9e7fc5176aa137313699696eca533e4b", "patch": "@@ -19,6 +19,8 @@\n \n package org.netbeans.modules.lexer.nbbridge;\n \n+import java.util.HashMap;\n+import java.util.Map;\n import org.netbeans.api.editor.mimelookup.MimeLookup;\n import org.netbeans.api.editor.mimelookup.MimePath;\n import org.netbeans.api.lexer.InputAttributes;\n@@ -28,6 +30,8 @@\n import org.netbeans.spi.lexer.LanguageEmbedding;\n import org.netbeans.spi.lexer.LanguageProvider;\n import org.openide.util.Lookup;\n+import org.openide.util.LookupEvent;\n+import org.openide.util.LookupListener;\n \n /**\n  *\n@@ -36,18 +40,50 @@\n @org.openide.util.lookup.ServiceProvider(service=org.netbeans.spi.lexer.LanguageProvider.class)\n public final class MimeLookupLanguageProvider extends LanguageProvider {\n     \n+    private final Map<String, Lookup.Result<Language>> langLkpResultsMap = \n+                  new HashMap<>();\n+    private final Map<String, Lookup.Result<LanguagesEmbeddingMap>> embeddingsLkpResultsMap = \n+                  new HashMap<>();\n+    private final String LOCK = new String(\"MimeLookupLanguageProvider.LOCK\"); //NOI18N\n+ \n     public MimeLookupLanguageProvider() {\n         super();\n     }\n \n     public Language<?> findLanguage(String mimeType) {\n         Lookup lookup = MimeLookup.getLookup(MimePath.parse(mimeType));\n+ \n+        //268649: add lookup listener for Language.class\n+        synchronized (LOCK) {\n+            Lookup.Result result = langLkpResultsMap.get(mimeType);\n+            if (result == null) {\n+                result = lookup.lookup(new Lookup.Template(Language.class));\n+                result.addLookupListener((LookupEvent evt) -> {\n+                    firePropertyChange(PROP_LANGUAGE);\n+                });\n+                langLkpResultsMap.put(mimeType, result);\n+            }\n+        } \n         return (Language<?>)lookup.lookup(Language.class);\n     }\n \n     public LanguageEmbedding<?> findLanguageEmbedding(\n     Token<?> token, LanguagePath languagePath, InputAttributes inputAttributes) {\n-        Lookup lookup = MimeLookup.getLookup(MimePath.parse(languagePath.mimePath()));\n+        String mimePath = languagePath.mimePath();\n+        Lookup lookup = MimeLookup.getLookup(MimePath.parse(mimePath));\n+        \n+        //268649: add lookup listener for LanguagesEmbeddingMap.class            \n+        synchronized (LOCK) {\n+            Lookup.Result result = embeddingsLkpResultsMap.get(mimePath);\n+            if (result == null) {\n+                result = lookup.lookup(new Lookup.Template(LanguagesEmbeddingMap.class));\n+                result.addLookupListener((LookupEvent evt) -> {\n+                    firePropertyChange(PROP_EMBEDDED_LANGUAGE);\n+                });\n+                embeddingsLkpResultsMap.put(mimePath, result);\n+            }\n+        }\n+\n         LanguagesEmbeddingMap map = lookup.lookup(LanguagesEmbeddingMap.class);\n         return map == null ? null : map.getLanguageEmbeddingForTokenName(token.id().name());\n     }", "filename": "lexer.nbbridge/src/org/netbeans/modules/lexer/nbbridge/MimeLookupLanguageProvider.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/f793e2db47389e2afbf3e8f33ca60940ace9ad8e", "parent": "https://github.com/apache/netbeans/commit/c9b8c2a428285bff830208fda132c9ffa8fe64ca", "message": "Shielding against NPE when debugging Nashorn scripts", "bug_id": "netbeans_29", "file": [{"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/f793e2db47389e2afbf3e8f33ca60940ace9ad8e/debugger.jpda/src/org/netbeans/modules/debugger/jpda/expr/EvaluatorVisitor.java", "blob_url": "https://github.com/apache/netbeans/blob/f793e2db47389e2afbf3e8f33ca60940ace9ad8e/debugger.jpda/src/org/netbeans/modules/debugger/jpda/expr/EvaluatorVisitor.java", "sha": "04edbe72cc225dfdfb7538488951a477095bd427", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/debugger.jpda/src/org/netbeans/modules/debugger/jpda/expr/EvaluatorVisitor.java?ref=f793e2db47389e2afbf3e8f33ca60940ace9ad8e", "patch": "@@ -4217,7 +4217,7 @@ public static ReferenceType adjustBoxingType(ReferenceType type, PrimitiveType p\n         if (primitiveType instanceof DoubleType) {\n             typeClass = Double.class;\n         }\n-        if (typeClass != null) {\n+        if (typeClass != null && evaluationContext != null && evaluationContext.getVMCache() != null) {\n             type = evaluationContext.getVMCache().getClass(typeClass.getName());\n         }\n         return type;", "filename": "debugger.jpda/src/org/netbeans/modules/debugger/jpda/expr/EvaluatorVisitor.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/d65f2789d496ed57095ce9e243edb7cec2adaa32", "parent": "https://github.com/apache/netbeans/commit/1c8c1e52e5abb48eb05aaff392ea630d9e04cb83", "message": "Preventing NPE.", "bug_id": "netbeans_30", "file": [{"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/d65f2789d496ed57095ce9e243edb7cec2adaa32/java.source.base/src/org/netbeans/modules/java/source/PostFlowAnalysis.java", "blob_url": "https://github.com/apache/netbeans/blob/d65f2789d496ed57095ce9e243edb7cec2adaa32/java.source.base/src/org/netbeans/modules/java/source/PostFlowAnalysis.java", "sha": "edf0f313725bacc2959bf7729d5819a5ce03ab71", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java.source.base/src/org/netbeans/modules/java/source/PostFlowAnalysis.java?ref=d65f2789d496ed57095ce9e243edb7cec2adaa32", "patch": "@@ -160,7 +160,7 @@ public void visitMethodDef(JCMethodDecl tree) {\n     public void visitNewClass(JCNewClass tree) {\n         super.visitNewClass(tree);\n         Symbol c = tree.constructor != null ? tree.constructor.owner : null;\n-        if (c != null && c.hasOuterInstance()) {\n+        if (c != null && c != syms.noSymbol && c.hasOuterInstance()) {\n             if (tree.encl == null && c.isLocal()) {\n                 checkThis(tree.pos(), c.type.getEnclosingType().tsym);\n             }", "filename": "java.source.base/src/org/netbeans/modules/java/source/PostFlowAnalysis.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/a60cbbbd300d11c46adc38cf1aef53ec24a6c3a6", "parent": "https://github.com/apache/netbeans/commit/c62487d4e2d02723ac4e44e87429d16ca9757ffe", "message": "[NETBEANS-777] JDK10-LVTI: Fix for NPE on typing invalid block/javadoc comment just after var keyword", "bug_id": "netbeans_31", "file": [{"additions": 2, "raw_url": "https://github.com/apache/netbeans/raw/a60cbbbd300d11c46adc38cf1aef53ec24a6c3a6/java.lexer/src/org/netbeans/lib/java/lexer/JavaLexer.java", "blob_url": "https://github.com/apache/netbeans/blob/a60cbbbd300d11c46adc38cf1aef53ec24a6c3a6/java.lexer/src/org/netbeans/lib/java/lexer/JavaLexer.java", "sha": "d0a598df838885360cc593840c9451c20f8c20cf", "changes": 4, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java.lexer/src/org/netbeans/lib/java/lexer/JavaLexer.java?ref=a60cbbbd300d11c46adc38cf1aef53ec24a6c3a6", "patch": "@@ -1052,9 +1052,9 @@ else if ('0' <= c && c <= '9') { // float literal\n                                     if (AFTER_VAR_TOKENS.contains(next.id())) {\n                                         do {\n                                             next = nextToken();\n-                                        } while (AFTER_VAR_TOKENS.contains(next.id()));\n+                                        } while (next != null && AFTER_VAR_TOKENS.contains(next.id()));\n \n-                                        varKeyword = next.id() == JavaTokenId.IDENTIFIER;\n+                                        varKeyword = next != null && next.id() == JavaTokenId.IDENTIFIER;\n                                     }\n \n                                     input.backup(input.readLengthEOF()- len);", "filename": "java.lexer/src/org/netbeans/lib/java/lexer/JavaLexer.java"}, {"additions": 63, "raw_url": "https://github.com/apache/netbeans/raw/a60cbbbd300d11c46adc38cf1aef53ec24a6c3a6/java.lexer/test/unit/src/org/netbeans/lib/java/lexer/JavaLexerBatchTest.java", "blob_url": "https://github.com/apache/netbeans/blob/a60cbbbd300d11c46adc38cf1aef53ec24a6c3a6/java.lexer/test/unit/src/org/netbeans/lib/java/lexer/JavaLexerBatchTest.java", "sha": "b87cbddaf075e89fbcd586dbdce7db6aecc9d476", "changes": 63, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java.lexer/test/unit/src/org/netbeans/lib/java/lexer/JavaLexerBatchTest.java?ref=a60cbbbd300d11c46adc38cf1aef53ec24a6c3a6", "patch": "@@ -634,4 +634,67 @@ public void testVarIdentWithStringVersion() {\n         LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.INT_LITERAL, \"0\");\n         LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.SEMICOLON, \";\");\n     }\n+\n+    public void testVarWithIncompleteBlockComment() {\n+        String text = \"var /* i = 0;\";\n+        InputAttributes attr = new InputAttributes();\n+        attr.setValue(JavaTokenId.language(), \"version\", (Supplier<String>) () -> {\n+            return \"10\";\n+        }, true);\n+        TokenHierarchy<?> hi = TokenHierarchy.create(text, false, JavaTokenId.language(), EnumSet.noneOf(JavaTokenId.class), attr);\n+        TokenSequence<?> ts = hi.tokenSequence();\n+\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.IDENTIFIER, \"var\");\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.WHITESPACE, \" \");\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.BLOCK_COMMENT, \"/* i = 0;\");\n+    }\n+\n+    public void testVarWithIncompleteJavaDocComment() {\n+        String text = \"var /** i = 0;\";\n+        InputAttributes attr = new InputAttributes();\n+        attr.setValue(JavaTokenId.language(), \"version\", (Supplier<String>) () -> {\n+            return \"10\";\n+        }, true);\n+        TokenHierarchy<?> hi = TokenHierarchy.create(text, false, JavaTokenId.language(), EnumSet.noneOf(JavaTokenId.class), attr);\n+        TokenSequence<?> ts = hi.tokenSequence();\n+\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.IDENTIFIER, \"var\");\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.WHITESPACE, \" \");\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.JAVADOC_COMMENT, \"/** i = 0;\");\n+    }\n+\n+    public void testVarWithInvalidComment() {\n+        String text = \"var */ i = 0;\";\n+        InputAttributes attr = new InputAttributes();\n+        attr.setValue(JavaTokenId.language(), \"version\", (Supplier<String>) () -> {\n+            return \"10\";\n+        }, true);\n+        TokenHierarchy<?> hi = TokenHierarchy.create(text, false, JavaTokenId.language(), EnumSet.noneOf(JavaTokenId.class), attr);\n+        TokenSequence<?> ts = hi.tokenSequence();\n+\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.IDENTIFIER, \"var\");\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.WHITESPACE, \" \");\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.INVALID_COMMENT_END, \"*/\");\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.WHITESPACE, \" \");\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.IDENTIFIER, \"i\");\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.WHITESPACE, \" \");\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.EQ, \"=\");\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.WHITESPACE, \" \");\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.INT_LITERAL, \"0\");\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.SEMICOLON, \";\");\n+    }\n+\n+    public void testInvalidVarStatement() {\n+        String text = \"var \";\n+        InputAttributes attr = new InputAttributes();\n+        attr.setValue(JavaTokenId.language(), \"version\", (Supplier<String>) () -> {\n+            return \"10\";\n+        }, true);\n+        TokenHierarchy<?> hi = TokenHierarchy.create(text, false, JavaTokenId.language(), EnumSet.noneOf(JavaTokenId.class), attr);\n+        TokenSequence<?> ts = hi.tokenSequence();\n+\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.IDENTIFIER, \"var\");\n+        LexerTestUtilities.assertNextTokenEquals(ts, JavaTokenId.WHITESPACE, \" \");\n+    }\n+\n }", "filename": "java.lexer/test/unit/src/org/netbeans/lib/java/lexer/JavaLexerBatchTest.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/4df5f612746862d0bc9c2ab39f94fcf5bf272fbe", "parent": "https://github.com/apache/netbeans/commit/c0bee30f5ebf363567085c177a7c845a61e3f6ad", "message": "Merge pull request #462 from JaroslavTulach/JpdaNPE\n\nShielding against NPE when debugging Nashorn scripts", "bug_id": "netbeans_32", "file": [{"additions": 1, "raw_url": "https://github.com/apache/netbeans/raw/4df5f612746862d0bc9c2ab39f94fcf5bf272fbe/debugger.jpda/src/org/netbeans/modules/debugger/jpda/expr/EvaluatorVisitor.java", "blob_url": "https://github.com/apache/netbeans/blob/4df5f612746862d0bc9c2ab39f94fcf5bf272fbe/debugger.jpda/src/org/netbeans/modules/debugger/jpda/expr/EvaluatorVisitor.java", "sha": "04edbe72cc225dfdfb7538488951a477095bd427", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/debugger.jpda/src/org/netbeans/modules/debugger/jpda/expr/EvaluatorVisitor.java?ref=4df5f612746862d0bc9c2ab39f94fcf5bf272fbe", "patch": "@@ -4217,7 +4217,7 @@ public static ReferenceType adjustBoxingType(ReferenceType type, PrimitiveType p\n         if (primitiveType instanceof DoubleType) {\n             typeClass = Double.class;\n         }\n-        if (typeClass != null) {\n+        if (typeClass != null && evaluationContext != null && evaluationContext.getVMCache() != null) {\n             type = evaluationContext.getVMCache().getClass(typeClass.getName());\n         }\n         return type;", "filename": "debugger.jpda/src/org/netbeans/modules/debugger/jpda/expr/EvaluatorVisitor.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/a6ed9637ccadbd6e47fd2bac34a0d2b73c9d6371", "parent": "https://github.com/apache/netbeans/commit/a520c261a9c8bdde81988b09813452812a13d8e7", "message": "[NETBEANS-1342] Hide the panel for iOS in the Mobile Platforms Options (#953)\n\n* [NETBEANS-1342] Hide the panel for iOS in the Mobile Platforms Options\r\n\r\nJust hide the panel because the cordova.platforms.ios module is not available (see #856)\r\n\r\n* Prevent NPE\r\n\r\nJust check whether PlatformManager.getPlatform(PlatformManager.IOS_TYPE) is null\r\n\r\n* Hide iOSPanel in the CordovaPanel", "bug_id": "netbeans_33", "file": [{"additions": 11, "raw_url": "https://github.com/apache/netbeans/raw/a6ed9637ccadbd6e47fd2bac34a0d2b73c9d6371/webcommon/cordova/src/org/netbeans/modules/cordova/CordovaPerformer.java", "blob_url": "https://github.com/apache/netbeans/blob/a6ed9637ccadbd6e47fd2bac34a0d2b73c9d6371/webcommon/cordova/src/org/netbeans/modules/cordova/CordovaPerformer.java", "sha": "132a7f8d0d6ba0530d91b812ee789afe0cf24c61", "changes": 20, "status": "modified", "deletions": 9, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/webcommon/cordova/src/org/netbeans/modules/cordova/CordovaPerformer.java?ref=a6ed9637ccadbd6e47fd2bac34a0d2b73c9d6371", "patch": "@@ -171,6 +171,7 @@ private ExecutorTask perform(final String target, final Project project, final b\n         if (provider != null &&\n                 \"ios_1\".equals(provider.getActiveBrowser().getId()) && \n                 (target.equals(BuildPerformer.RUN_IOS) || target.equals(BuildPerformer.BUILD_IOS)) &&\n+                PlatformManager.getPlatform(PlatformManager.IOS_TYPE) != null &&\n                 PlatformManager.getPlatform(PlatformManager.IOS_TYPE).getProvisioningProfilePath() == null\n                 ) {\n             throw new IllegalStateException(Bundle.ERR_NO_Provisioning());\n@@ -324,15 +325,16 @@ private Properties properties(Project p) {\n         props.put(PROP_ANDROID_PROJECT_ACTIVITY, activity);//NOI18N\n         \n         MobilePlatform iosPlatform = PlatformManager.getPlatform(PlatformManager.IOS_TYPE);\n+        if (iosPlatform != null) {\n+            final String provisioningProfilePath = iosPlatform.getProvisioningProfilePath();\n+            if (provisioningProfilePath != null) {\n+                props.put(PROP_PROVISIONING_PROFILE, provisioningProfilePath);\n+            }\n+            final String codeSignIdentity = iosPlatform.getCodeSignIdentity();\n \n-        final String provisioningProfilePath = iosPlatform.getProvisioningProfilePath();\n-        if (provisioningProfilePath != null) {\n-            props.put(PROP_PROVISIONING_PROFILE, provisioningProfilePath);\n-        }\n-        final String codeSignIdentity = iosPlatform.getCodeSignIdentity();\n-\n-        if (codeSignIdentity != null) {\n-            props.put(PROP_CERTIFICATE_NAME, codeSignIdentity);\n+            if (codeSignIdentity != null) {\n+                props.put(PROP_CERTIFICATE_NAME, codeSignIdentity);\n+            }\n         }\n \n         //workaround for some strange behavior of ant execution in netbeans\n@@ -349,7 +351,7 @@ private Properties properties(Project p) {\n \n             props.put(PROP_CONFIG, mobileConfig.getId());\n             mobileConfig.getDevice().addProperties(props);\n-            if (mobileConfig.getId().equals(\"ios\")) { // NOI18N\n+            if (mobileConfig.getId().equals(\"ios\") && iosPlatform != null) { // NOI18N\n                 boolean sdkVerified = false;\n                 try {\n                     for (SDK sdk:iosPlatform.getSDKs()) {", "filename": "webcommon/cordova/src/org/netbeans/modules/cordova/CordovaPerformer.java"}, {"additions": 13, "raw_url": "https://github.com/apache/netbeans/raw/a6ed9637ccadbd6e47fd2bac34a0d2b73c9d6371/webcommon/cordova/src/org/netbeans/modules/cordova/options/MobilePlatformsPanel.java", "blob_url": "https://github.com/apache/netbeans/blob/a6ed9637ccadbd6e47fd2bac34a0d2b73c9d6371/webcommon/cordova/src/org/netbeans/modules/cordova/options/MobilePlatformsPanel.java", "sha": "66b586d0477df1eab3e081ccc3ea69bb4ba0d3ac", "changes": 19, "status": "modified", "deletions": 6, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/webcommon/cordova/src/org/netbeans/modules/cordova/options/MobilePlatformsPanel.java?ref=a6ed9637ccadbd6e47fd2bac34a0d2b73c9d6371", "patch": "@@ -24,6 +24,7 @@\n import java.net.MalformedURLException;\n import java.net.URL;\n import java.util.Collection;\n+import java.util.Collections;\n import javax.swing.DefaultComboBoxModel;\n import javax.swing.JLabel;\n import javax.swing.SwingUtilities;\n@@ -49,7 +50,7 @@\n     private final MobilePlatformsOptionsPanelController controller;\n     private DocumentListener documentL;\n     private String codeSignIdentity;\n-    private Collection<? extends ProvisioningProfile> provisioningProfiles;\n+    private Collection<? extends ProvisioningProfile> provisioningProfiles = Collections.emptyList();\n     private String provisioningProfilePath;\n     private boolean inited = false;\n     private RequestProcessor.Task versionTask;\n@@ -273,9 +274,11 @@ private void cordovaVersionBrowseActionPerformed(java.awt.event.ActionEvent evt)\n \n     void load() {\n         final MobilePlatform iosPlatform = PlatformManager.getPlatform(PlatformManager.IOS_TYPE);\n-        codeSignIdentity = iosPlatform.getCodeSignIdentity();\n-        provisioningProfiles = iosPlatform.getProvisioningProfiles();\n-        provisioningProfilePath = iosPlatform.getProvisioningProfilePath();\n+        if (iosPlatform != null) {\n+            codeSignIdentity = iosPlatform.getCodeSignIdentity();\n+            provisioningProfiles = iosPlatform.getProvisioningProfiles();\n+            provisioningProfilePath = iosPlatform.getProvisioningProfilePath();\n+        }\n         SwingUtilities.invokeLater(new Runnable() {\n             @Override\n             public void run() {\n@@ -309,8 +312,12 @@ public void run() {\n     void setupComponenets() {\n         if (!inited) {\n             removeAll();\n-            initComponents();            \n-            \n+            initComponents();\n+            MobilePlatform iosPlatform = PlatformManager.getPlatform(PlatformManager.IOS_TYPE);\n+            if (iosPlatform == null) {\n+                iOSPanel.setVisible(false);\n+            }\n+\n             cordovaPathField.getDocument().addDocumentListener(new DocumentListener() {\n                 @Override\n                 public void insertUpdate(DocumentEvent e) {", "filename": "webcommon/cordova/src/org/netbeans/modules/cordova/options/MobilePlatformsPanel.java"}, {"additions": 6, "raw_url": "https://github.com/apache/netbeans/raw/a6ed9637ccadbd6e47fd2bac34a0d2b73c9d6371/webcommon/cordova/src/org/netbeans/modules/cordova/project/CordovaPanel.java", "blob_url": "https://github.com/apache/netbeans/blob/a6ed9637ccadbd6e47fd2bac34a0d2b73c9d6371/webcommon/cordova/src/org/netbeans/modules/cordova/project/CordovaPanel.java", "sha": "2053510cda1aba48ff4d29484951efa3ae7c7718", "changes": 6, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/webcommon/cordova/src/org/netbeans/modules/cordova/project/CordovaPanel.java?ref=a6ed9637ccadbd6e47fd2bac34a0d2b73c9d6371", "patch": "@@ -22,6 +22,8 @@\n import javax.swing.event.DocumentEvent;\n import javax.swing.event.DocumentListener;\n import org.netbeans.modules.cordova.CordovaPerformer;\n+import org.netbeans.modules.cordova.platforms.api.PlatformManager;\n+import org.netbeans.modules.cordova.platforms.spi.MobilePlatform;\n import org.netbeans.modules.cordova.updatetask.SourceConfig;\n import org.netbeans.modules.cordova.wizard.CordovaTemplate;\n import org.openide.util.NbBundle;\n@@ -71,6 +73,10 @@ private void fireChange() {\n     public CordovaPanel() {\n         this(null);\n         platformsPane.setVisible(true);\n+        MobilePlatform iosPlatform = PlatformManager.getPlatform(PlatformManager.IOS_TYPE);\n+        if (iosPlatform == null) {\n+            iOSPanel.setVisible(false);\n+        }\n     }\n     \n     public void setControlsEnabled(boolean enabled) {", "filename": "webcommon/cordova/src/org/netbeans/modules/cordova/project/CordovaPanel.java"}, {"additions": 5, "raw_url": "https://github.com/apache/netbeans/raw/a6ed9637ccadbd6e47fd2bac34a0d2b73c9d6371/webcommon/cordova/src/org/netbeans/modules/cordova/wizard/CordovaProjectExtender.java", "blob_url": "https://github.com/apache/netbeans/blob/a6ed9637ccadbd6e47fd2bac34a0d2b73c9d6371/webcommon/cordova/src/org/netbeans/modules/cordova/wizard/CordovaProjectExtender.java", "sha": "c520f7b658c3eb07986f0b8982027a6aaa466e3b", "changes": 7, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/webcommon/cordova/src/org/netbeans/modules/cordova/wizard/CordovaProjectExtender.java?ref=a6ed9637ccadbd6e47fd2bac34a0d2b73c9d6371", "patch": "@@ -22,6 +22,7 @@\n import org.netbeans.modules.cordova.platforms.spi.Device;\n import java.io.File;\n import java.io.IOException;\n+import org.netbeans.modules.cordova.platforms.spi.MobilePlatform;\n import org.netbeans.modules.cordova.project.ConfigUtils;\n import org.netbeans.modules.web.clientproject.api.ClientSideModule;\n import org.netbeans.modules.web.clientproject.spi.ClientProjectExtender;\n@@ -67,7 +68,8 @@ public static void createMobileConfigs(FileObject projectRoot) throws IOExceptio\n             ios.put(ConfigUtils.DISPLAY_NAME_PROP, Bundle.LBL_iPhoneSimulator());\n             ios.put(Device.TYPE_PROP, PlatformManager.IOS_TYPE);\n             ios.put(Device.DEVICE_PROP, Device.EMULATOR);\n-            ios.put(\"ios.build.sdk\", PlatformManager.getPlatform(PlatformManager.IOS_TYPE).getPrefferedTarget().getIdentifier()); // NOI18N\n+            MobilePlatform iosPlatform = PlatformManager.getPlatform(PlatformManager.IOS_TYPE);\n+            ios.put(\"ios.build.sdk\", iosPlatform == null ? \"\" : iosPlatform.getPrefferedTarget().getIdentifier()); // NOI18N\n             ios.put(\"ios.build.arch\", \"i386\"); // NOI18N\n \n             ConfigUtils.createConfigFile(projectRoot, PlatformManager.IOS_TYPE, ios);//NOI18N\n@@ -82,7 +84,8 @@ public static void createMobileConfigs(FileObject projectRoot) throws IOExceptio\n             iosdev.put(ConfigUtils.DISPLAY_NAME_PROP, Bundle.LBL_iPhoneDevice());\n             iosdev.put(Device.TYPE_PROP, PlatformManager.IOS_TYPE);\n             iosdev.put(Device.DEVICE_PROP, Device.DEVICE);\n-            String sim = PlatformManager.getPlatform(PlatformManager.IOS_TYPE).getPrefferedTarget().getIdentifier();\n+            MobilePlatform iosPlatform = PlatformManager.getPlatform(PlatformManager.IOS_TYPE);\n+            String sim = iosPlatform == null ? \"\" : iosPlatform.getPrefferedTarget().getIdentifier();\n             iosdev.put(\"ios.build.sdk\", sim.replace(\"iphonesimulator\", \"iphoneos\")); // NOI18N\n             iosdev.put(\"ios.build.arch\", sim.startsWith(\"iphonesimulator6\")?\"armv6 armv7\":\"armv7 armv7s\"); // NOI18N\n ", "filename": "webcommon/cordova/src/org/netbeans/modules/cordova/wizard/CordovaProjectExtender.java"}, {"additions": 4, "raw_url": "https://github.com/apache/netbeans/raw/a6ed9637ccadbd6e47fd2bac34a0d2b73c9d6371/webcommon/cordova/test/unit/src/org/netbeans/modules/web/clientproject/cordova/AndroidPlatformTest.java", "blob_url": "https://github.com/apache/netbeans/blob/a6ed9637ccadbd6e47fd2bac34a0d2b73c9d6371/webcommon/cordova/test/unit/src/org/netbeans/modules/web/clientproject/cordova/AndroidPlatformTest.java", "sha": "a3609839b76ef480a421bcf01cb3c2a6aea5df1d", "changes": 6, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/webcommon/cordova/test/unit/src/org/netbeans/modules/web/clientproject/cordova/AndroidPlatformTest.java?ref=a6ed9637ccadbd6e47fd2bac34a0d2b73c9d6371", "patch": "@@ -180,8 +180,10 @@ private int getPid() throws IOException {\n     @Test\n     public void testListSdks() throws Exception {\n         MobilePlatform instance = org.netbeans.modules.cordova.platforms.api.PlatformManager.getPlatform(PlatformManager.IOS_TYPE);\n-        for (SDK sdks: instance.getSDKs()) {\n-            System.out.println(sdks);\n+        if (instance != null) {\n+            for (SDK sdks : instance.getSDKs()) {\n+                System.out.println(sdks);\n+            }\n         }\n     }\n     ", "filename": "webcommon/cordova/test/unit/src/org/netbeans/modules/web/clientproject/cordova/AndroidPlatformTest.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/06b7360ac4b7ad1fcbd5a1273abab4460fc0dc08", "parent": "https://github.com/apache/netbeans/commit/7cca20f7033ac169c859ae33ebf289d95e61639f", "message": "Modified to prevent NPEs from Elements.getTypeElement.", "bug_id": "netbeans_34", "file": [{"additions": 12, "raw_url": "https://github.com/apache/netbeans/raw/06b7360ac4b7ad1fcbd5a1273abab4460fc0dc08/j2ee.persistence/src/org/netbeans/modules/j2ee/persistence/wizard/fromdb/JavaPersistenceGenerator.java", "blob_url": "https://github.com/apache/netbeans/blob/06b7360ac4b7ad1fcbd5a1273abab4460fc0dc08/j2ee.persistence/src/org/netbeans/modules/j2ee/persistence/wizard/fromdb/JavaPersistenceGenerator.java", "sha": "08d45a92c9a0b1a599ce25a8fa2536fe2aab36c8", "changes": 17, "status": "modified", "deletions": 5, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/j2ee.persistence/src/org/netbeans/modules/j2ee/persistence/wizard/fromdb/JavaPersistenceGenerator.java?ref=06b7360ac4b7ad1fcbd5a1273abab4460fc0dc08", "patch": "@@ -990,9 +990,12 @@ private Property(Modifier modifier, List<AnnotationTree> annotations, Comment co\n                     if (xmlTransient) {\n                         AnnotationTree xmlTransientAn = genUtils.createAnnotation(\n                                 \"javax.xml.bind.annotation.XmlTransient\"); //NOI18N\n-                        TypeElement jsonIgnore = copy.getElements().getTypeElement(\n-                                moduleElement,\n-                                \"org.codehaus.jackson.annotate.JsonIgnore\");    // NOI18N\n+                        TypeElement jsonIgnore = moduleElement != null\n+                                ? copy.getElements().getTypeElement(\n+                                        moduleElement,\n+                                        \"org.codehaus.jackson.annotate.JsonIgnore\") // NOI18N\n+                                : copy.getElements().getTypeElement(\n+                                        \"org.codehaus.jackson.annotate.JsonIgnore\"); // NOI18N\n                         List<AnnotationTree> annotationTrees;\n                         if ( jsonIgnore == null ){\n                             annotationTrees = Collections.singletonList(xmlTransientAn);\n@@ -1456,7 +1459,9 @@ protected void generateRelationship(RelationshipRole role) throws IOException {\n                 if(replacedTypeNames.containsKey(typeName)) {\n                     typeName = replacedTypeNames.get(typeName);\n                 }\n-                TypeElement typeEl = copy.getElements().getTypeElement(moduleElement, typeName);\n+                TypeElement typeEl = moduleElement != null\n+                        ? copy.getElements().getTypeElement(moduleElement, typeName)\n+                        : copy.getElements().getTypeElement(typeName);\n                 //need some extended logging if null, see issue # 217461\n                 if(typeEl == null) {\n                      Logger.getLogger(JavaPersistenceGenerator.class.getName()).log(Level.WARNING, \"Null typeelement for {0}\", typeName); //NOI18N\n@@ -1474,7 +1479,9 @@ protected void generateRelationship(RelationshipRole role) throws IOException {\n                 TypeMirror fieldType = typeEl.asType();\n                 if (role.isToMany()) {\n                     // Use the collection type the user wants\n-                    TypeElement collectionTypeElem = copy.getElements().getTypeElement(moduleElement, collectionType.className());\n+                    TypeElement collectionTypeElem = moduleElement != null\n+                            ? copy.getElements().getTypeElement(moduleElement, collectionType.className())\n+                            : copy.getElements().getTypeElement(collectionType.className());\n                     fieldType = copy.getTypes().getDeclaredType(collectionTypeElem, fieldType);\n                 }\n ", "filename": "j2ee.persistence/src/org/netbeans/modules/j2ee/persistence/wizard/fromdb/JavaPersistenceGenerator.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/a53030d295bbebb42923cb0b427b427a31fb844b", "parent": "https://github.com/apache/netbeans/commit/fa4d649132b1bd3655595a7ee1e29638ff82cda9", "message": "[NETBEANS-229] Fixing NPE on creating Installers for Netbeans Platform Applications by adding missing resource", "bug_id": "netbeans_35", "file": [{"additions": 0, "raw_url": "https://github.com/apache/netbeans/raw/a53030d295bbebb42923cb0b427b427a31fb844b/nbi/engine/src/org/netbeans/installer/utils/applications/TestJDK.class", "blob_url": "https://github.com/apache/netbeans/blob/a53030d295bbebb42923cb0b427b427a31fb844b/nbi/engine/src/org/netbeans/installer/utils/applications/TestJDK.class", "sha": "f7425ed430833a613ddeef024c8d6fd1a84c941b", "changes": 0, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/nbi/engine/src/org/netbeans/installer/utils/applications/TestJDK.class?ref=a53030d295bbebb42923cb0b427b427a31fb844b", "filename": "nbi/engine/src/org/netbeans/installer/utils/applications/TestJDK.class"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/d73c4e7313d7c0d7d365b63d11520e188e95e5bc", "parent": "https://github.com/apache/netbeans/commit/d6a8f4db4486137ce98a5e51de250bc8a7d833c7", "message": "#270674:NPE from PersistentClassIndex due to null value from PCI.getRoot()", "bug_id": "netbeans_36", "file": [{"additions": 124, "raw_url": "https://github.com/apache/netbeans/raw/d73c4e7313d7c0d7d365b63d11520e188e95e5bc/java.source.base/src/org/netbeans/modules/java/source/usages/PersistentClassIndex.java", "blob_url": "https://github.com/apache/netbeans/blob/d73c4e7313d7c0d7d365b63d11520e188e95e5bc/java.source.base/src/org/netbeans/modules/java/source/usages/PersistentClassIndex.java", "sha": "0ea9494cfd852a725abfcbfcbef9b214c5c37f3e", "changes": 264, "status": "modified", "deletions": 140, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java.source.base/src/org/netbeans/modules/java/source/usages/PersistentClassIndex.java?ref=d73c4e7313d7c0d7d365b63d11520e188e95e5bc", "patch": "@@ -97,6 +97,7 @@\n     //@GuardedBy(\"this\")\n     private Set<String> rootPkgCache;\n     private volatile FileObject cachedRoot;\n+    @SuppressWarnings(\"VolatileArrayField\")\n     private volatile FileObject[] cachedAptRoots;\n     private static final Logger LOGGER = Logger.getLogger(PersistentClassIndex.class.getName());\n     private static final String REFERENCES = \"refs\";    // NOI18N\n@@ -165,6 +166,7 @@ public boolean isValid() {\n \n     @Override\n     @NonNull\n+    @SuppressWarnings(\"NestedAssignment\")\n     public FileObject[] getSourceRoots () {\n         if (getType() == Type.SOURCE) {\n             final FileObject rootFo = getRoot();\n@@ -207,7 +209,7 @@ public boolean isValid() {\n     public String getSourceName (final String binaryName) throws IOException, InterruptedException {\n         try {\n             final Query q = DocumentUtil.binaryNameQuery(binaryName);\n-            Set<String> names = new HashSet<String>();\n+            Set<String> names = new HashSet<>();\n             index.query(names, DocumentUtil.sourceNameConvertor(), DocumentUtil.sourceNameFieldSelector(), cancel.get(), q);\n             return names.isEmpty() ? null : names.iterator().next();\n         } catch (IOException e) {\n@@ -245,20 +247,17 @@ public static ClassIndexImpl create(\n             final String binaryName = SourceUtils.getJVMSignature(element)[0];\n             final ElementKind kind = element.getKind();\n             if (kind == ElementKind.PACKAGE) {\n-                IndexManager.priorityAccess(new IndexManager.Action<Void> () {\n-                    @Override\n-                    public Void run () throws IOException, InterruptedException {\n-                        final Query q = QueryUtil.scopeFilter(\n-                                QueryUtil.createPackageUsagesQuery(binaryName,usageType,Occur.SHOULD),\n-                                scope);\n-                        if (q!=null) {\n-                            index.query(result, ctu.first(), DocumentUtil.declaredTypesFieldSelector(false, false), cancel.get(), q);\n-                            if (ctu.second() != null) {\n-                                ctu.second().query(result, convertor, DocumentUtil.declaredTypesFieldSelector(false, false), cancel.get(), q);\n-                            }\n+                IndexManager.priorityAccess(() -> {\n+                    final Query q = QueryUtil.scopeFilter(\n+                            QueryUtil.createPackageUsagesQuery(binaryName,usageType,Occur.SHOULD),\n+                            scope);\n+                    if (q != null) {\n+                        index.query(result, ctu.first(), DocumentUtil.declaredTypesFieldSelector(false, false), cancel.get(), q);\n+                        if (ctu.second() != null) {\n+                            ctu.second().query(result, convertor, DocumentUtil.declaredTypesFieldSelector(false, false), cancel.get(), q);\n                         }\n-                        return null;\n                     }\n+                    return null;\n                 });\n             } else if (kind.isClass() ||\n                        kind.isInterface() ||\n@@ -272,20 +271,17 @@ public Void run () throws IOException, InterruptedException {\n                         convertor,\n                         result);\n                 } else {\n-                    IndexManager.priorityAccess(new IndexManager.Action<Void> () {\n-                        @Override\n-                        public Void run () throws IOException, InterruptedException {\n-                            final Query usagesQuery = QueryUtil.scopeFilter(\n-                                    QueryUtil.createUsagesQuery(binaryName, usageType, Occur.SHOULD),\n-                                    scope);\n-                            if (usagesQuery != null) {\n-                                index.query(result, ctu.first(), DocumentUtil.declaredTypesFieldSelector(false, false), cancel.get(), usagesQuery);\n-                                if (ctu.second() != null) {\n-                                    ctu.second().query(result, convertor, DocumentUtil.declaredTypesFieldSelector(false, false), cancel.get(), usagesQuery);\n-                                }\n+                    IndexManager.priorityAccess(() -> {\n+                        final Query usagesQuery = QueryUtil.scopeFilter(\n+                                QueryUtil.createUsagesQuery(binaryName, usageType, Occur.SHOULD),\n+                                scope);\n+                        if (usagesQuery != null) {\n+                            index.query(result, ctu.first(), DocumentUtil.declaredTypesFieldSelector(false, false), cancel.get(), usagesQuery);\n+                            if (ctu.second() != null) {\n+                                ctu.second().query(result, convertor, DocumentUtil.declaredTypesFieldSelector(false, false), cancel.get(), usagesQuery);\n                             }\n-                            return null;\n                         }\n+                        return null;\n                     });\n                 }\n             } else {\n@@ -307,24 +303,21 @@ public Void run () throws IOException, InterruptedException {\n             @NonNull final Collection<? super T> result) throws InterruptedException, IOException {\n         final Pair<Convertor<? super Document, T>,Index> ctu = indexPath.getPatch(convertor);\n         try {\n-            IndexManager.priorityAccess(new IndexManager.Action<Void> () {\n-                @Override\n-                public Void run () throws IOException, InterruptedException {\n-                    final Query query =  QueryUtil.scopeFilter(\n+            IndexManager.priorityAccess(() -> {\n+                final Query query =  QueryUtil.scopeFilter(\n                         Queries.createQuery(\n-                            DocumentUtil.FIELD_SIMPLE_NAME,\n-                            DocumentUtil.FIELD_CASE_INSENSITIVE_NAME,\n-                            simpleName,\n-                            DocumentUtil.translateQueryKind(kind)),\n+                                DocumentUtil.FIELD_SIMPLE_NAME,\n+                                DocumentUtil.FIELD_CASE_INSENSITIVE_NAME,\n+                                simpleName,\n+                                DocumentUtil.translateQueryKind(kind)),\n                         scope);\n-                    if (query != null) {\n-                        index.query(result, ctu.first(), selector, cancel.get(), query);\n-                        if (ctu.second() != null) {\n-                            ctu.second().query(result, convertor, selector, cancel.get(), query);\n-                        }\n+                if (query != null) {\n+                    index.query(result, ctu.first(), selector, cancel.get(), query);\n+                    if (ctu.second() != null) {\n+                        ctu.second().query(result, convertor, selector, cancel.get(), query);\n                     }\n-                    return null;\n                 }\n+                return null;\n             });\n         } catch (IOException ioe) {\n             this.<Void,IOException>handleException(null, ioe, root);\n@@ -339,39 +332,29 @@ public Void run () throws IOException, InterruptedException {\n             final Map<T,Set<String>> result) throws InterruptedException, IOException {\n         final Pair<Convertor<? super Document, T>,Index> ctu = indexPath.getPatch(convertor);\n         try {\n-            IndexManager.priorityAccess(new IndexManager.Action<Void>() {\n-                @Override\n-                public Void run () throws IOException, InterruptedException {\n-                    final Query query = Queries.createTermCollectingQuery(\n-                            DocumentUtil.FIELD_FEATURE_IDENTS,\n-                            DocumentUtil.FIELD_CASE_INSENSITIVE_FEATURE_IDENTS,\n-                            ident,\n-                            DocumentUtil.translateQueryKind(kind));\n-                    final Convertor<Term, String> t2s =\n-                        new Convertor<Term, String>(){\n-                            @Override\n-                            public String convert(Term p) {\n-                                return p.text();\n-                            }\n-                        };\n-                    index.queryDocTerms(\n-                            result,\n-                            ctu.first(),\n-                            t2s,\n-                            DocumentUtil.declaredTypesFieldSelector(false, false),\n-                            cancel.get(),\n-                            query);\n-                    if (ctu.second() != null) {\n-                        ctu.second().queryDocTerms(\n+            IndexManager.priorityAccess(() -> {\n+                final Query query = Queries.createTermCollectingQuery(\n+                        DocumentUtil.FIELD_FEATURE_IDENTS,\n+                        DocumentUtil.FIELD_CASE_INSENSITIVE_FEATURE_IDENTS,\n+                        ident,\n+                        DocumentUtil.translateQueryKind(kind));\n+                index.queryDocTerms(\n+                        result,\n+                        ctu.first(),\n+                        Term::text,\n+                        DocumentUtil.declaredTypesFieldSelector(false, false),\n+                        cancel.get(),\n+                        query);\n+                if (ctu.second() != null) {\n+                    ctu.second().queryDocTerms(\n                             result,\n                             convertor,\n-                            t2s,\n+                            Term::text,\n                             DocumentUtil.declaredTypesFieldSelector(false, false),\n                             cancel.get(),\n                             query);\n-                    }\n-                    return null;\n                 }\n+                return null;\n             });\n         } catch (IOException ioe) {\n             this.<Void,IOException>handleException(null, ioe, root);\n@@ -382,36 +365,33 @@ public String convert(Term p) {\n     @Override\n     public void getPackageNames (final String prefix, final boolean directOnly, final Set<String> result) throws InterruptedException, IOException {\n         try {\n-            IndexManager.priorityAccess(new IndexManager.Action<Void>() {\n-                @Override\n-                public Void run () throws IOException, InterruptedException {\n-                    final boolean cacheOp = directOnly && prefix.length() == 0;\n-                    Set<String> myPkgs = null;\n-                    Collection<String> collectInto;\n-                    if (cacheOp) {\n-                        synchronized (PersistentClassIndex.this) {\n-                            if (rootPkgCache != null) {\n-                                result.addAll(rootPkgCache);\n-                                return null;\n-                            }\n+            IndexManager.priorityAccess(() -> {\n+                final boolean cacheOp = directOnly && prefix.length() == 0;\n+                Set<String> myPkgs = null;\n+                Collection<String> collectInto;\n+                if (cacheOp) {\n+                    synchronized (PersistentClassIndex.this) {\n+                        if (rootPkgCache != null) {\n+                            result.addAll(rootPkgCache);\n+                            return null;\n                         }\n-                        myPkgs = new HashSet<String>();\n-                        collectInto = new TeeCollection(myPkgs,result);\n-                    } else {\n-                        collectInto = result;\n                     }\n-                    final Pair<StoppableConvertor<Term,String>,Term> filter = QueryUtil.createPackageFilter(prefix,directOnly);\n-                    index.queryTerms(collectInto, filter.second(), filter.first(), cancel.get());\n-                    if (cacheOp) {\n-                        synchronized (PersistentClassIndex.this) {\n-                            if (rootPkgCache == null) {\n-                                assert myPkgs != null;\n-                                rootPkgCache = myPkgs;\n-                            }\n+                    myPkgs = new HashSet<>();\n+                    collectInto = new TeeCollection(myPkgs,result);\n+                } else {\n+                    collectInto = result;\n+                }\n+                final Pair<StoppableConvertor<Term,String>,Term> filter = QueryUtil.createPackageFilter(prefix,directOnly);\n+                index.queryTerms(collectInto, filter.second(), filter.first(), cancel.get());\n+                if (cacheOp) {\n+                    synchronized (PersistentClassIndex.this) {\n+                        if (rootPkgCache == null) {\n+                            assert myPkgs != null;\n+                            rootPkgCache = myPkgs;\n                         }\n                     }\n-                    return null;\n                 }\n+                return null;\n             });\n         } catch (IOException ioe) {\n             this.<Void,IOException>handleException(null, ioe, root);\n@@ -428,19 +408,16 @@ public void getReferencesFrequences (\n             throw new IllegalStateException(\"Index does not support frequencies!\"); //NOI18N\n         }\n         try {\n-            IndexManager.priorityAccess(new IndexManager.Action<Void>() {\n-                @Override\n-                public Void run() throws IOException, InterruptedException {\n-                    final Term startTerm = DocumentUtil.referencesTerm(\"\", null, true);    //NOI18N\n-                    final StoppableConvertor<Index.WithTermFrequencies.TermFreq,Void> convertor = new FreqCollector(\n-                            startTerm, typeFreq, pkgFreq);\n-                    ((Index.WithTermFrequencies)index).queryTermFrequencies(\n+            IndexManager.priorityAccess(() -> {\n+                final Term startTerm = DocumentUtil.referencesTerm(\"\", null, true);    //NOI18N\n+                final StoppableConvertor<Index.WithTermFrequencies.TermFreq,Void> convertor = new FreqCollector(\n+                        startTerm, typeFreq, pkgFreq);\n+                ((Index.WithTermFrequencies)index).queryTermFrequencies(\n                         Collections.<Void>emptyList(),\n                         startTerm,\n                         convertor,\n                         cancel.get());\n-                    return null;\n-                }\n+                return null;\n             });\n         } catch (IOException ioe) {\n             this.<Void,IOException>handleException(null, ioe, root);\n@@ -532,8 +509,8 @@ public void deleteAndStore(List<Pair<Pair<BinaryName,String>, Object[]>> refs, S\n \n     private static class TeeCollection<T> extends AbstractCollection<T> {\n \n-        private Collection<T> primary;\n-        private Collection<T> secondary;\n+        private final Collection<T> primary;\n+        private final Collection<T> secondary;\n \n \n         TeeCollection(final @NonNull Collection<T> primary, @NonNull Collection<T> secondary) {\n@@ -578,7 +555,7 @@ public boolean add(T e) {\n                 final Pair<Index,Set<String>> data = updateDirty();\n                 if (data != null) {\n                     return Pair.<Convertor<? super Document, T>,Index>of(\n-                            new FilterConvertor<T>(data.second(), delegate),\n+                            new FilterConvertor<>(data.second(), delegate),\n                             data.first());\n                 }\n             } catch (IOException ioe) {\n@@ -606,38 +583,33 @@ synchronized void setDirtyFile(@NullAllowed final URL url) throws IOException {\n                 result = indexPatch;\n             }\n             if (url != null) {\n-                final FileObject file = url != null ? URLMapper.findFileObject(url) : null;\n+                final FileObject file = URLMapper.findFileObject(url);\n                 final JavaSource js = file != null ? JavaSource.forFileObject(file) : null;\n                 final long startTime = System.currentTimeMillis();\n                 final List[] dataHolder = new List[1];\n                 if (js != null) {\n                     final ClassPath scp = js.getClasspathInfo().getClassPath(PathKind.SOURCE);\n                     if (scp != null && scp.contains(file)) {\n-                        js.runUserActionTask(new Task<CompilationController>() {\n-                            @Override\n-                            public void run (final CompilationController controller) {\n+                        js.runUserActionTask((final CompilationController controller) -> {\n+                            try {\n+                                if (controller.toPhase(Phase.RESOLVED).compareTo(Phase.RESOLVED)<0) {\n+                                    return;\n+                                }\n                                 try {\n-                                    if (controller.toPhase(Phase.RESOLVED).compareTo(Phase.RESOLVED)<0) {\n-                                        return;\n-                                    }\n-                                    try {\n-                                        final SourceAnalyzerFactory.SimpleAnalyzer sa = SourceAnalyzerFactory.createSimpleAnalyzer();\n-                                        dataHolder[0] = sa.analyseUnit(\n+                                    final SourceAnalyzerFactory.SimpleAnalyzer sa = SourceAnalyzerFactory.createSimpleAnalyzer();\n+                                    dataHolder[0] = sa.analyseUnit(\n                                             controller.getCompilationUnit(),\n                                             JavaSourceAccessor.getINSTANCE().getJavacTask(controller));\n-                                    } catch (IllegalArgumentException ia) {\n-                                        //Debug info for issue #187344\n-                                        //seems that invalid dirty class index is used\n-                                        final ClassPath scp = controller.getClasspathInfo().getClassPath(PathKind.SOURCE);\n-                                        throw new IllegalArgumentException(\n-                                                String.format(\"Provided source path: %s root: %s\",    //NOI18N\n-                                                    scp == null ? \"<null>\" : scp.toString(),    //NOI18N\n-                                                    root.toExternalForm()),\n-                                                ia);\n-                                    }\n-                                } catch (IOException ioe) {\n-                                    Exceptions.printStackTrace(ioe);\n+                                } catch (IllegalArgumentException ia) {\n+                                    //Debug info for issue #187344\n+                                    //seems that invalid dirty class index is used\n+                                    final ClassPath scp1 = controller.getClasspathInfo().getClassPath(PathKind.SOURCE);\n+                                    throw new IllegalArgumentException(String.format(\"Provided source path: %s root: %s\", //NOI18N\n+                                    scp1 == null ? \"<null>\" : scp1.toString(), //NOI18N\n+                                    root.toExternalForm()), ia);\n                                 }\n+                            }catch (IOException ioe) {\n+                                Exceptions.printStackTrace(ioe);\n                             }\n                         }, true);\n                     } else {\n@@ -655,28 +627,38 @@ public void run (final CompilationController controller) {\n                 if (data != null) {\n                     if (filter == null) {\n                         try {\n-                            filter = new HashSet<String>();\n+                            filter = new HashSet<>();\n                             assert file != null : \"Null file for URL: \" + url;  //NOI18N\n                             final FileObject root = getRoot();\n-                            final String relPath = FileUtil.getRelativePath(root, file);\n-                            if (relPath != null) {\n-                                final String clsName = FileObjects.convertFolder2Package(\n-                                        FileObjects.stripExtension(relPath));\n-                                index.query(\n-                                        filter,\n-                                        DocumentUtil.binaryNameConvertor(),\n-                                        DocumentUtil.declaredTypesFieldSelector(false, false),\n-                                        null,\n-                                        DocumentUtil.queryClassWithEncConvertor(true).convert(Pair.<String,String>of(clsName,relPath)));\n+                            if (root != null) {\n+                                final String relPath = FileUtil.getRelativePath(root, file);\n+                                if (relPath != null) {\n+                                        final String clsName = FileObjects.convertFolder2Package(\n+                                                FileObjects.stripExtension(relPath));\n+                                        index.query(\n+                                                filter,\n+                                                DocumentUtil.binaryNameConvertor(),\n+                                                DocumentUtil.declaredTypesFieldSelector(false, false),\n+                                                null,\n+                                                DocumentUtil.queryClassWithEncConvertor(true).convert(Pair.<String,String>of(clsName,relPath)));\n+                                } else {\n+                                    LOGGER.log(\n+                                        Level.WARNING,\n+                                        \"File: {0}({1}) is not owned by root: {2}({3})\",    //NOI18N\n+                                        new Object[]{\n+                                            FileUtil.getFileDisplayName(file),\n+                                            file.isValid(),\n+                                            FileUtil.getFileDisplayName(root),\n+                                            root.isValid()\n+                                        });\n+                                }\n                             } else {\n                                 LOGGER.log(\n                                     Level.WARNING,\n-                                    \"File: {0}({1}) is not owned by root: {2}({3})\",\n+                                    \"File: {0}({1}) is has no root.\",   //NOI18N\n                                     new Object[]{\n                                         FileUtil.getFileDisplayName(file),\n-                                        file.isValid(),\n-                                        FileUtil.getFileDisplayName(root),\n-                                        root.isValid()\n+                                        file.isValid()\n                                     });\n                             }\n                         } catch (InterruptedException ie) {\n@@ -763,6 +745,7 @@ public T convert(F p) {\n \n         @CheckForNull\n         @Override\n+        @SuppressWarnings(\"StringEquality\")\n         public Void convert(@NonNull final Index.WithTermFrequencies.TermFreq param) throws Stop {\n             final Term term = param.getTerm();\n             if (fieldName != term.field()) {\n@@ -784,6 +767,7 @@ public Void convert(@NonNull final Index.WithTermFrequencies.TermFreq param) thr\n     }\n \n     @CheckForNull\n+    @SuppressWarnings(\"NestedAssignment\")\n     private FileObject getRoot() {\n         FileObject res = cachedRoot;\n         if (res == null || !res.isValid()) {", "filename": "java.source.base/src/org/netbeans/modules/java/source/usages/PersistentClassIndex.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/d55ebe6b3fd8b34e48000208d3807177d0c006ce", "parent": "https://github.com/apache/netbeans/commit/f83921ef0391c63534d3e891687152fde74a8069", "message": "Fixed potential NPE; JShell may throw ISE when terminated in parallel to navigator init", "bug_id": "netbeans_37", "file": [{"additions": 3, "raw_url": "https://github.com/apache/netbeans/raw/d55ebe6b3fd8b34e48000208d3807177d0c006ce/jshell.support/src/org/netbeans/modules/jshell/env/JShellEnvironment.java", "blob_url": "https://github.com/apache/netbeans/blob/d55ebe6b3fd8b34e48000208d3807177d0c006ce/jshell.support/src/org/netbeans/modules/jshell/env/JShellEnvironment.java", "sha": "0c4fd429f2d92eb58df82f2cb2553a1a700e5aa9", "changes": 4, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/jshell.support/src/org/netbeans/modules/jshell/env/JShellEnvironment.java?ref=d55ebe6b3fd8b34e48000208d3807177d0c006ce", "patch": "@@ -505,7 +505,9 @@ public void closed(ConsoleEvent e) {}\n         \n         res.second().addTaskListener(e -> {\n             starting = false;\n-            fireShellStarted(event);\n+            if (nss.isValid() && nss.isActive()) {\n+                fireShellStarted(event);\n+            }\n             fireShellStatus(event);\n         });\n         ", "filename": "jshell.support/src/org/netbeans/modules/jshell/env/JShellEnvironment.java"}, {"additions": 10, "raw_url": "https://github.com/apache/netbeans/raw/d55ebe6b3fd8b34e48000208d3807177d0c006ce/jshell.support/src/org/netbeans/modules/jshell/navigation/SnippetNodes.java", "blob_url": "https://github.com/apache/netbeans/blob/d55ebe6b3fd8b34e48000208d3807177d0c006ce/jshell.support/src/org/netbeans/modules/jshell/navigation/SnippetNodes.java", "sha": "2c51a4d727915392b5c212db8a4a7e2a576d852d", "changes": 13, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/jshell.support/src/org/netbeans/modules/jshell/navigation/SnippetNodes.java?ref=d55ebe6b3fd8b34e48000208d3807177d0c006ce", "patch": "@@ -255,9 +255,12 @@ private synchronized void attachTo(JShell shell) {\n             state = null;\n         }\n         if (shell != null) {\n+            NR subscription = new NR(this, shell);\n+            subscription.subscribe();\n+            // may fail in JShell, record in member variables only after successful\n+            // registration\n             state = shell;\n-            sub = new NR(this, shell);\n-            sub.subscribe();\n+            sub = subscription;\n         }\n     }\n \n@@ -270,7 +273,11 @@ public void shellStarted(ShellEvent ev) {\n             }\n         }\n         update();\n-        attachTo(ev.getEngine());\n+        try {\n+            attachTo(ev.getEngine());\n+        } catch (IllegalStateException ex) {\n+            // the shell may have terminated in between the event was generated and now. Ignore.\n+        }\n         refreshNodeNames();\n     }\n ", "filename": "jshell.support/src/org/netbeans/modules/jshell/navigation/SnippetNodes.java"}, {"additions": 4, "raw_url": "https://github.com/apache/netbeans/raw/d55ebe6b3fd8b34e48000208d3807177d0c006ce/jshell.support/src/org/netbeans/modules/jshell/parsing/SnippetRegistry.java", "blob_url": "https://github.com/apache/netbeans/blob/d55ebe6b3fd8b34e48000208d3807177d0c006ce/jshell.support/src/org/netbeans/modules/jshell/parsing/SnippetRegistry.java", "sha": "8651c3049cd5a041544a10410fbfb65388f5c8e1", "changes": 6, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/jshell.support/src/org/netbeans/modules/jshell/parsing/SnippetRegistry.java?ref=d55ebe6b3fd8b34e48000208d3807177d0c006ce", "patch": "@@ -476,8 +476,10 @@ private FileObject createSnippetFile(SnippetHandle info, String resName) {\n                     ows.flush();\n                 }\n                 FileObject ret = pkg.getFileObject(fn);\n-                synchronized (this) {\n-                    snippetTimeStamps.put(snip, ret.lastModified().getTime());\n+                if (snip != null) {\n+                    synchronized (this) {\n+                        snippetTimeStamps.put(snip, ret.lastModified().getTime());\n+                    }\n                 }\n                 ModelAccessor.INSTANCE.setFile(info, ret);\n                 return finalize(info, ret);", "filename": "jshell.support/src/org/netbeans/modules/jshell/parsing/SnippetRegistry.java"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/c3b5d9ae524420d75d1c689650ff253d91ded498", "parent": "https://github.com/apache/netbeans/commit/fa4d649132b1bd3655595a7ee1e29638ff82cda9", "message": "Merge pull request #339 from thilina01/NETBEANS-229-fix\n\n[NETBEANS-229] Fixing NPE on creating Installers for Netbeans Platform Applications", "bug_id": "netbeans_38", "file": [{"additions": 0, "raw_url": "https://github.com/apache/netbeans/raw/c3b5d9ae524420d75d1c689650ff253d91ded498/nbi/engine/src/org/netbeans/installer/utils/applications/TestJDK.class", "blob_url": "https://github.com/apache/netbeans/blob/c3b5d9ae524420d75d1c689650ff253d91ded498/nbi/engine/src/org/netbeans/installer/utils/applications/TestJDK.class", "sha": "f7425ed430833a613ddeef024c8d6fd1a84c941b", "changes": 0, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/nbi/engine/src/org/netbeans/installer/utils/applications/TestJDK.class?ref=c3b5d9ae524420d75d1c689650ff253d91ded498", "filename": "nbi/engine/src/org/netbeans/installer/utils/applications/TestJDK.class"}], "repo": "netbeans"}, {"commit": "https://github.com/apache/netbeans/commit/c55d2ab2ea518862e12c94dbc2550e9b207f44b4", "parent": "https://github.com/apache/netbeans/commit/a69042db639f538ac73fa55fd692dc86b8d27117", "message": "[NETBEANS-227] Preventing NPE during indexing: the parsed fileobject was wrapped and then not found in the tuple map", "bug_id": "netbeans_39", "file": [{"additions": 2, "raw_url": "https://github.com/apache/netbeans/raw/c55d2ab2ea518862e12c94dbc2550e9b207f44b4/java.source.base/src/org/netbeans/modules/java/source/parsing/WriteBackTransaction.java", "blob_url": "https://github.com/apache/netbeans/blob/c55d2ab2ea518862e12c94dbc2550e9b207f44b4/java.source.base/src/org/netbeans/modules/java/source/parsing/WriteBackTransaction.java", "sha": "bf135f72892e23cc4f8e28aed219657c74fe3e06", "changes": 2, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/netbeans/contents/java.source.base/src/org/netbeans/modules/java/source/parsing/WriteBackTransaction.java?ref=c55d2ab2ea518862e12c94dbc2550e9b207f44b4", "patch": "@@ -18,6 +18,7 @@\n  */\n package org.netbeans.modules.java.source.parsing;\n \n+import com.sun.tools.javac.api.ClientCodeWrapper.Trusted;\n import java.io.ByteArrayInputStream;\n import java.io.ByteArrayOutputStream;\n import java.io.File;\n@@ -387,6 +388,7 @@ static File toFile(JavaFileObject o) {\n      * \n      * The CacheFO may be \"flushed\" (written to shadowFile) or \"committed\" (moved to the final dest).\n      */\n+    @Trusted\n     static class CachedFileObject extends FileObjects.FileBase {\n \n         private static final byte[] NOTHING = new byte[0];", "filename": "java.source.base/src/org/netbeans/modules/java/source/parsing/WriteBackTransaction.java"}], "repo": "netbeans"}]
