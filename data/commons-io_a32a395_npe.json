[
    {
        "repo": "commons-io",
        "commit": "https://github.com/apache/commons-io/commit/a32a395a621098ce652ee8158e6320fa422f9fa3",
        "bug_id": "commons-io_a32a395",
        "message": "Add test for and fix NPE if thread stopped with no file found\n\ngit-svn-id: https://svn.apache.org/repos/asf/commons/proper/io/trunk@1002918 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/commons-io/commit/a360f974003c5c60c16d019e873314c09d965107",
        "patched_files": [
            "Tailer.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 5,
                "raw_url": "https://github.com/apache/commons-io/raw/a32a395a621098ce652ee8158e6320fa422f9fa3/src/java/org/apache/commons/io/input/Tailer.java",
                "contents_url": "https://api.github.com/repos/apache/commons-io/contents/src/java/org/apache/commons/io/input/Tailer.java?ref=a32a395a621098ce652ee8158e6320fa422f9fa3",
                "filename": "src/java/org/apache/commons/io/input/Tailer.java",
                "deletions": 4,
                "sha": "a8d36b3449514ae42da49c0f0838b112c6fddd37",
                "blob_url": "https://github.com/apache/commons-io/blob/a32a395a621098ce652ee8158e6320fa422f9fa3/src/java/org/apache/commons/io/input/Tailer.java",
                "patch": "@@ -148,13 +148,14 @@ public void run() {\n \n                 if (reader == null) {\n                     Thread.sleep(delay);\n+                } else {\n+                    // The current position in the file\n+                    position = end ? file.length() : 0;\n+                    last = System.currentTimeMillis();\n+                    reader.seek(position);                    \n                 }\n             }\n \n-            // The current position in the file\n-            position = end ? file.length() : 0;\n-            last = System.currentTimeMillis();\n-            reader.seek(position);\n \n             while (run) {\n ",
                "changes": 9
            },
            {
                "status": "modified",
                "additions": 20,
                "raw_url": "https://github.com/apache/commons-io/raw/a32a395a621098ce652ee8158e6320fa422f9fa3/src/test/org/apache/commons/io/input/TailerTest.java",
                "contents_url": "https://api.github.com/repos/apache/commons-io/contents/src/test/org/apache/commons/io/input/TailerTest.java?ref=a32a395a621098ce652ee8158e6320fa422f9fa3",
                "filename": "src/test/org/apache/commons/io/input/TailerTest.java",
                "deletions": 0,
                "sha": "1d69a98794b4d18441c50bf611283510512df5d4",
                "blob_url": "https://github.com/apache/commons-io/blob/a32a395a621098ce652ee8158e6320fa422f9fa3/src/test/org/apache/commons/io/input/TailerTest.java",
                "patch": "@@ -110,13 +110,29 @@ private void write(File file, String... lines) throws Exception {\n         }\n     }\n \n+    public void testStopWithNoFile() throws Exception {\n+        File file = new File(getTestDirectory(),\"nosuchfile\");\n+        assertFalse(\"nosuchfile should not exist\", file.exists());\n+        TestTailerListener listener = new TestTailerListener();\n+        int delay = 100;\n+        int idle = 50; // allow time for thread to work\n+        Tailer tailer = start(file, listener, delay, false);\n+        Thread.sleep(idle);\n+        tailer.stop();\n+        Thread.sleep(delay+idle);\n+        assertNull(listener.exception);\n+    }\n+\n     /**\n      * Test {@link TailerListener} implementation.\n      */\n     private static class TestTailerListener extends TailerListenerAdapter {\n \n         private final List<String> lines = new ArrayList<String>();\n \n+        volatile Exception exception = null;\n+        \n+        @Override\n         public void handle(String line) {\n             lines.add(line);\n         }\n@@ -126,5 +142,9 @@ public void handle(String line) {\n         public void clear() {\n             lines.clear();\n         }\n+        @Override\n+        public void handle(Exception e) {\n+            exception = e;\n+        }\n     }\n }",
                "changes": 20
            }
        ],
        "unit_tests": [
            "TailerTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "src/test/org/apache/commons/io/input/TailerTest.java",
        "buggy_files": [
            "src/java/org/apache/commons/io/input/Tailer.java"
        ],
        "fixed": true
    }
]