[
    {
        "repo": "shiro",
        "commit": "https://github.com/apache/shiro/commit/3ca513f1f2f0472251b73c16c1507034a7028b24",
        "bug_id": "shiro_3ca513f",
        "message": "SHIRO-473 Fix NPE thrown from DefaultAnnotationResolver.getAnnotation",
        "parent": "https://github.com/apache/shiro/commit/08a860f5ac0fcf9c64309981bdac6325a3360876",
        "patched_files": [
            "DefaultAnnotationResolver.java",
            "AnnotationResolver.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 6,
                "raw_url": "https://github.com/apache/shiro/raw/3ca513f1f2f0472251b73c16c1507034a7028b24/core/src/main/java/org/apache/shiro/aop/DefaultAnnotationResolver.java",
                "contents_url": "https://api.github.com/repos/apache/shiro/contents/core/src/main/java/org/apache/shiro/aop/DefaultAnnotationResolver.java?ref=3ca513f1f2f0472251b73c16c1507034a7028b24",
                "filename": "core/src/main/java/org/apache/shiro/aop/DefaultAnnotationResolver.java",
                "deletions": 1,
                "sha": "d7fd4aec7a22e9c0196009b28b98d94f28fb2a3b",
                "blob_url": "https://github.com/apache/shiro/blob/3ca513f1f2f0472251b73c16c1507034a7028b24/core/src/main/java/org/apache/shiro/aop/DefaultAnnotationResolver.java",
                "patch": "@@ -59,6 +59,11 @@ public Annotation getAnnotation(MethodInvocation mi, Class<? extends Annotation>\n \r\n         }\r\n         Annotation annotation = m.getAnnotation(clazz);\r\n-        return annotation == null ? mi.getThis().getClass().getAnnotation(clazz) : annotation;\r\n+        if (annotation == null ) {\r\n+            Object miThis = mi.getThis();\r\n+            //SHIRO-473 - miThis could be null for static methods, just return null\r\n+            annotation = miThis != null ? miThis.getClass().getAnnotation(clazz) : null;\r\n+        }\r\n+        return annotation;\r\n     }\r\n }\r",
                "changes": 7
            },
            {
                "status": "modified",
                "additions": 10,
                "raw_url": "https://github.com/apache/shiro/raw/3ca513f1f2f0472251b73c16c1507034a7028b24/core/src/test/java/org/apache/shiro/aop/AnnotationResolverTest.java",
                "contents_url": "https://api.github.com/repos/apache/shiro/contents/core/src/test/java/org/apache/shiro/aop/AnnotationResolverTest.java?ref=3ca513f1f2f0472251b73c16c1507034a7028b24",
                "filename": "core/src/test/java/org/apache/shiro/aop/AnnotationResolverTest.java",
                "deletions": 0,
                "sha": "1b2916c5e48b95b8db702462295afa49f11e443a",
                "blob_url": "https://github.com/apache/shiro/blob/3ca513f1f2f0472251b73c16c1507034a7028b24/core/src/test/java/org/apache/shiro/aop/AnnotationResolverTest.java",
                "patch": "@@ -60,5 +60,15 @@ public void testAnnotationFoundFromMethod() throws SecurityException, NoSuchMeth\n         replay(methodInvocation);\r\n \tassertNotNull(annotationResolver.getAnnotation(methodInvocation, RequiresUser.class));\r\n     }\r\n+\r\n+    @Test\r\n+    public void testNullMethodInvocation() throws SecurityException, NoSuchMethodException {\r\n+        MethodInvocation methodInvocation = createMock(MethodInvocation.class);\r\n+        Method method = MyFixture.class.getDeclaredMethod(\"operateThis\");\r\n+        expect(methodInvocation.getMethod()).andReturn(method);\r\n+        expect(methodInvocation.getThis()).andReturn(null);\r\n+        replay(methodInvocation);\r\n+        assertNull(annotationResolver.getAnnotation(methodInvocation, RequiresUser.class));\r\n+    }\r\n }\r\n \r",
                "changes": 10
            }
        ],
        "unit_tests": [
            "AnnotationResolverTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "core/src/test/java/org/apache/shiro/aop/AnnotationResolverTest.java",
        "buggy_files": [
            "core/src/main/java/org/apache/shiro/aop/DefaultAnnotationResolver.java",
            "core/src/main/java/org/apache/shiro/aop/AnnotationResolver.java"
        ],
        "fixed": true
    }
]