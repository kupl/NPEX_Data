[{"commit": "https://github.com/apache/sling-org-apache-sling-scripting-thymeleaf/commit/54d6e13b4fc52b8aa56559f2d603c7eab8c59c7a", "parent": "https://github.com/apache/sling-org-apache-sling-scripting-thymeleaf/commit/e617543ada113aa6319adf7e1ecfbb58fc5e524d", "message": "SLING-6487 Prevent possible NPE (templateMode) in SlingResourceTemplateResolver\n\ngit-svn-id: https://svn.apache.org/repos/asf/sling/trunk@1780482 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "sling-org-apache-sling-scripting-thymeleaf_1", "file": [{"additions": 9, "raw_url": "https://github.com/apache/sling-org-apache-sling-scripting-thymeleaf/raw/54d6e13b4fc52b8aa56559f2d603c7eab8c59c7a/src/main/java/org/apache/sling/scripting/thymeleaf/internal/SlingResourceTemplateResolver.java", "blob_url": "https://github.com/apache/sling-org-apache-sling-scripting-thymeleaf/blob/54d6e13b4fc52b8aa56559f2d603c7eab8c59c7a/src/main/java/org/apache/sling/scripting/thymeleaf/internal/SlingResourceTemplateResolver.java", "sha": "f28087b40c398b06f1b158ac447d8ea5b63fc64c", "changes": 13, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-scripting-thymeleaf/contents/src/main/java/org/apache/sling/scripting/thymeleaf/internal/SlingResourceTemplateResolver.java?ref=54d6e13b4fc52b8aa56559f2d603c7eab8c59c7a", "patch": "@@ -118,10 +118,15 @@ public TemplateResolution resolveTemplate(final IEngineConfiguration engineConfi\n             final ITemplateResource templateResource = new SlingTemplateResource(resource);\n             final boolean templateResourceExistenceVerified = false;\n             final TemplateMode templateMode = templateModeProvider.provideTemplateMode(resource);\n-            logger.debug(\"using template mode {} for template '{}'\", templateMode, template);\n-            final boolean useDecoupledLogic = templateMode.isMarkup() && configuration.useDecoupledLogic();\n-            final ICacheEntryValidity validity = NonCacheableCacheEntryValidity.INSTANCE;\n-            return new TemplateResolution(templateResource, templateResourceExistenceVerified, templateMode, useDecoupledLogic, validity);\n+            if (templateMode == null) {\n+                logger.warn(\"template mode for template '{}' is null, not resolving template\", template);\n+                return null;\n+            } else {\n+                logger.debug(\"using template mode {} for template '{}'\", templateMode, template);\n+                final boolean useDecoupledLogic = templateMode.isMarkup() && configuration.useDecoupledLogic();\n+                final ICacheEntryValidity validity = NonCacheableCacheEntryValidity.INSTANCE;\n+                return new TemplateResolution(templateResource, templateResourceExistenceVerified, templateMode, useDecoupledLogic, validity);\n+            }\n         } else {\n             logger.error(\"context is not an instance of SlingContext\");\n             return null;", "filename": "src/main/java/org/apache/sling/scripting/thymeleaf/internal/SlingResourceTemplateResolver.java"}], "repo": "sling-org-apache-sling-scripting-thymeleaf"}]
