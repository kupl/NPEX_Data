[{"commit": "https://github.com/apache/fineract-cn-portfolio/commit/bd0e1262ecaaabaf7aad639846c52fd993ee97d7", "parent": "https://github.com/apache/fineract-cn-portfolio/commit/d92410eb4ecbc03d9c81ce176cb69c4885ab4309", "message": "Fixed NPE.", "bug_id": "fineract-cn-portfolio_1", "file": [{"additions": 3, "raw_url": "https://github.com/apache/fineract-cn-portfolio/raw/bd0e1262ecaaabaf7aad639846c52fd993ee97d7/api/src/test/java/io/mifos/portfolio/api/v1/domain/CommandTest.java", "blob_url": "https://github.com/apache/fineract-cn-portfolio/blob/bd0e1262ecaaabaf7aad639846c52fd993ee97d7/api/src/test/java/io/mifos/portfolio/api/v1/domain/CommandTest.java", "sha": "1372188d5b337985b00597bc8e327df8d95c758e", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/fineract-cn-portfolio/contents/api/src/test/java/io/mifos/portfolio/api/v1/domain/CommandTest.java?ref=bd0e1262ecaaabaf7aad639846c52fd993ee97d7", "patch": "@@ -52,6 +52,9 @@ public static Collection testCases() {\n     ret.add(new ValidationTestCase<Command>(\"validAccountAssignment\")\n             .adjustment(x -> x.setOneTimeAccountAssignments(Collections.singletonList(new AccountAssignment(PROCESSING_FEE_ID, \"7534\"))))\n             .valid(true));\n+    ret.add(new ValidationTestCase<Command>(\"nullAccountAssignment\")\n+            .adjustment(x -> x.setOneTimeAccountAssignments(null))\n+            .valid(true));\n     return ret;\n   }\n }", "filename": "api/src/test/java/io/mifos/portfolio/api/v1/domain/CommandTest.java"}, {"additions": 6, "raw_url": "https://github.com/apache/fineract-cn-portfolio/raw/bd0e1262ecaaabaf7aad639846c52fd993ee97d7/component-test/src/main/java/io/mifos/portfolio/TestCommands.java", "blob_url": "https://github.com/apache/fineract-cn-portfolio/blob/bd0e1262ecaaabaf7aad639846c52fd993ee97d7/component-test/src/main/java/io/mifos/portfolio/TestCommands.java", "sha": "22b3b337465aaba45447eb2b39cd0d9219071766", "changes": 12, "status": "modified", "deletions": 6, "contents_url": "https://api.github.com/repos/apache/fineract-cn-portfolio/contents/component-test/src/main/java/io/mifos/portfolio/TestCommands.java?ref=bd0e1262ecaaabaf7aad639846c52fd993ee97d7", "patch": "@@ -39,29 +39,29 @@ public void testHappyWorkflow() throws InterruptedException {\n     checkNextActionsCorrect(product.getIdentifier(), customerCase.getIdentifier(), Action.OPEN);\n \n \n-    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.OPEN, Collections.emptyList(), OPEN_INDIVIDUALLOAN_CASE, Case.State.PENDING);\n+    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.OPEN, null, OPEN_INDIVIDUALLOAN_CASE, Case.State.PENDING);\n     checkNextActionsCorrect(product.getIdentifier(), customerCase.getIdentifier(), Action.APPROVE, Action.DENY);\n \n \n-    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.APPROVE, Collections.emptyList(), APPROVE_INDIVIDUALLOAN_CASE, Case.State.APPROVED);\n+    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.APPROVE, null, APPROVE_INDIVIDUALLOAN_CASE, Case.State.APPROVED);\n     checkNextActionsCorrect(product.getIdentifier(), customerCase.getIdentifier(), Action.DISBURSE, Action.CLOSE);\n \n \n-    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.DISBURSE, Collections.emptyList(), DISBURSE_INDIVIDUALLOAN_CASE, Case.State.ACTIVE);\n+    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.DISBURSE, null, DISBURSE_INDIVIDUALLOAN_CASE, Case.State.ACTIVE);\n     checkNextActionsCorrect(product.getIdentifier(), customerCase.getIdentifier(),\n             Action.APPLY_INTEREST, Action.MARK_LATE, Action.ACCEPT_PAYMENT, Action.DISBURSE, Action.WRITE_OFF, Action.CLOSE);\n \n \n-    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.ACCEPT_PAYMENT, Collections.emptyList(), ACCEPT_PAYMENT_INDIVIDUALLOAN_CASE, Case.State.ACTIVE);\n+    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.ACCEPT_PAYMENT, null, ACCEPT_PAYMENT_INDIVIDUALLOAN_CASE, Case.State.ACTIVE);\n     checkNextActionsCorrect(product.getIdentifier(), customerCase.getIdentifier(),\n             Action.APPLY_INTEREST, Action.MARK_LATE, Action.ACCEPT_PAYMENT, Action.DISBURSE, Action.WRITE_OFF, Action.CLOSE);\n \n \n-    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.ACCEPT_PAYMENT, Collections.emptyList(), ACCEPT_PAYMENT_INDIVIDUALLOAN_CASE, Case.State.ACTIVE);\n+    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.ACCEPT_PAYMENT, null, ACCEPT_PAYMENT_INDIVIDUALLOAN_CASE, Case.State.ACTIVE);\n     checkNextActionsCorrect(product.getIdentifier(), customerCase.getIdentifier(),\n             Action.APPLY_INTEREST, Action.MARK_LATE, Action.ACCEPT_PAYMENT, Action.DISBURSE, Action.WRITE_OFF, Action.CLOSE);\n \n-    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.CLOSE, Collections.emptyList(), CLOSE_INDIVIDUALLOAN_CASE, Case.State.CLOSED);\n+    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.CLOSE, null, CLOSE_INDIVIDUALLOAN_CASE, Case.State.CLOSED);\n     checkNextActionsCorrect(product.getIdentifier(), customerCase.getIdentifier());\n   }\n ", "filename": "component-test/src/main/java/io/mifos/portfolio/TestCommands.java"}, {"additions": 2, "raw_url": "https://github.com/apache/fineract-cn-portfolio/raw/bd0e1262ecaaabaf7aad639846c52fd993ee97d7/service/src/main/java/io/mifos/individuallending/internal/service/CostComponentService.java", "blob_url": "https://github.com/apache/fineract-cn-portfolio/blob/bd0e1262ecaaabaf7aad639846c52fd993ee97d7/service/src/main/java/io/mifos/individuallending/internal/service/CostComponentService.java", "sha": "1376692734b3a5a4e4d141be20b6a5a5586c6df7", "changes": 3, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/fineract-cn-portfolio/contents/service/src/main/java/io/mifos/individuallending/internal/service/CostComponentService.java?ref=bd0e1262ecaaabaf7aad639846c52fd993ee97d7", "patch": "@@ -32,6 +32,7 @@\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.stereotype.Service;\n \n+import javax.annotation.Nullable;\n import java.math.BigDecimal;\n import java.time.LocalDate;\n import java.time.ZoneId;\n@@ -68,7 +69,7 @@ public CostComponentService(\n   public DataContextOfAction checkedGetDataContext(\n           final String productIdentifier,\n           final String caseIdentifier,\n-          final List<AccountAssignment> oneTimeAccountAssignments) {\n+          final @Nullable List<AccountAssignment> oneTimeAccountAssignments) {\n \n     final ProductEntity product =\n             productRepository.findByIdentifier(productIdentifier)", "filename": "service/src/main/java/io/mifos/individuallending/internal/service/CostComponentService.java"}, {"additions": 12, "raw_url": "https://github.com/apache/fineract-cn-portfolio/raw/bd0e1262ecaaabaf7aad639846c52fd993ee97d7/service/src/main/java/io/mifos/individuallending/internal/service/DataContextOfAction.java", "blob_url": "https://github.com/apache/fineract-cn-portfolio/blob/bd0e1262ecaaabaf7aad639846c52fd993ee97d7/service/src/main/java/io/mifos/individuallending/internal/service/DataContextOfAction.java", "sha": "962efb23966b90a2782fa01bec551b16a2fb9091", "changes": 21, "status": "modified", "deletions": 9, "contents_url": "https://api.github.com/repos/apache/fineract-cn-portfolio/contents/service/src/main/java/io/mifos/individuallending/internal/service/DataContextOfAction.java?ref=bd0e1262ecaaabaf7aad639846c52fd993ee97d7", "patch": "@@ -20,6 +20,9 @@\n import io.mifos.portfolio.service.internal.repository.CaseEntity;\n import io.mifos.portfolio.service.internal.repository.ProductEntity;\n \n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import java.util.Collections;\n import java.util.List;\n \n /**\n@@ -31,29 +34,29 @@\n   private final CaseParameters caseParameters;\n   private final List<AccountAssignment> oneTimeAccountAssignments;\n \n-  DataContextOfAction(final ProductEntity product,\n-                      final CaseEntity customerCase,\n-                      final CaseParameters caseParameters,\n-                      final List<AccountAssignment> oneTimeAccountAssignments) {\n+  DataContextOfAction(final @Nonnull ProductEntity product,\n+                      final @Nonnull CaseEntity customerCase,\n+                      final @Nonnull CaseParameters caseParameters,\n+                      final @Nullable List<AccountAssignment> oneTimeAccountAssignments) {\n     this.product = product;\n     this.customerCase = customerCase;\n     this.caseParameters = caseParameters;\n-    this.oneTimeAccountAssignments = oneTimeAccountAssignments;\n+    this.oneTimeAccountAssignments = oneTimeAccountAssignments == null ? Collections.emptyList() : oneTimeAccountAssignments;\n   }\n \n-  public ProductEntity getProduct() {\n+  public @Nonnull ProductEntity getProduct() {\n     return product;\n   }\n \n-  public CaseEntity getCustomerCase() {\n+  public @Nonnull CaseEntity getCustomerCase() {\n     return customerCase;\n   }\n \n-  public CaseParameters getCaseParameters() {\n+  public @Nonnull CaseParameters getCaseParameters() {\n     return caseParameters;\n   }\n \n-  public List<AccountAssignment> getOneTimeAccountAssignments() {\n+  public @Nonnull List<AccountAssignment> getOneTimeAccountAssignments() {\n     return oneTimeAccountAssignments;\n   }\n }", "filename": "service/src/main/java/io/mifos/individuallending/internal/service/DataContextOfAction.java"}, {"additions": 7, "raw_url": "https://github.com/apache/fineract-cn-portfolio/raw/bd0e1262ecaaabaf7aad639846c52fd993ee97d7/service/src/main/java/io/mifos/individuallending/internal/service/DesignatorToAccountIdentifierMapper.java", "blob_url": "https://github.com/apache/fineract-cn-portfolio/blob/bd0e1262ecaaabaf7aad639846c52fd993ee97d7/service/src/main/java/io/mifos/individuallending/internal/service/DesignatorToAccountIdentifierMapper.java", "sha": "5b2fb94bd5172a008e1630ec0668c859855922d9", "changes": 13, "status": "modified", "deletions": 6, "contents_url": "https://api.github.com/repos/apache/fineract-cn-portfolio/contents/service/src/main/java/io/mifos/individuallending/internal/service/DesignatorToAccountIdentifierMapper.java?ref=bd0e1262ecaaabaf7aad639846c52fd993ee97d7", "patch": "@@ -23,6 +23,7 @@\n import io.mifos.portfolio.service.internal.repository.CaseAccountAssignmentEntity;\n import io.mifos.portfolio.service.internal.repository.ProductAccountAssignmentEntity;\n \n+import javax.annotation.Nonnull;\n import java.util.List;\n import java.util.Set;\n import java.util.stream.Stream;\n@@ -31,11 +32,11 @@\n  * @author Myrle Krantz\n  */\n public class DesignatorToAccountIdentifierMapper {\n-  private final Set<ProductAccountAssignmentEntity> productAccountAssignments;\n-  private final Set<CaseAccountAssignmentEntity> caseAccountAssignments;\n-  private final List<AccountAssignment> oneTimeAccountAssignments;\n+  private final @Nonnull Set<ProductAccountAssignmentEntity> productAccountAssignments;\n+  private final @Nonnull Set<CaseAccountAssignmentEntity> caseAccountAssignments;\n+  private final @Nonnull List<AccountAssignment> oneTimeAccountAssignments;\n \n-  public DesignatorToAccountIdentifierMapper(final DataContextOfAction dataContextOfAction) {\n+  public DesignatorToAccountIdentifierMapper(final @Nonnull DataContextOfAction dataContextOfAction) {\n     this.productAccountAssignments = dataContextOfAction.getProduct().getAccountAssignments();\n     this.caseAccountAssignments = dataContextOfAction.getCustomerCase().getAccountAssignments();\n     this.oneTimeAccountAssignments = dataContextOfAction.getOneTimeAccountAssignments();\n@@ -50,7 +51,7 @@ public DesignatorToAccountIdentifierMapper(final DataContextOfAction dataContext\n             productAccountAssignments.stream().map(ProductMapper::mapAccountAssignmentEntity));\n   }\n \n-  public String mapOrThrow(final String accountDesignator) {\n+  public String mapOrThrow(final @Nonnull String accountDesignator) {\n     return allAccountAssignmentsAsStream()\n             .filter(x -> x.getDesignator().equals(accountDesignator))\n             .findFirst()\n@@ -63,4 +64,4 @@ public String mapOrThrow(final String accountDesignator) {\n             .filter(x -> !x.getDesignator().equals(AccountDesignators.ENTRY))\n             .filter(x -> (x.getAccountIdentifier() == null) && (x.getLedgerIdentifier() != null));\n   }\n-}\n+}\n\\ No newline at end of file", "filename": "service/src/main/java/io/mifos/individuallending/internal/service/DesignatorToAccountIdentifierMapper.java"}], "repo": "fineract-cn-portfolio"}, {"commit": "https://github.com/apache/fineract-cn-portfolio/commit/eaeac763630d9e0bbdce81edfab795d51473de3d", "parent": "https://github.com/apache/fineract-cn-portfolio/commit/789d3bdac979724b9c12c5a4bec545a029bd4ebb", "message": "Merge pull request #28 from myrle-krantz/develop\n\nFixed NPE.", "bug_id": "fineract-cn-portfolio_2", "file": [{"additions": 3, "raw_url": "https://github.com/apache/fineract-cn-portfolio/raw/eaeac763630d9e0bbdce81edfab795d51473de3d/api/src/test/java/io/mifos/portfolio/api/v1/domain/CommandTest.java", "blob_url": "https://github.com/apache/fineract-cn-portfolio/blob/eaeac763630d9e0bbdce81edfab795d51473de3d/api/src/test/java/io/mifos/portfolio/api/v1/domain/CommandTest.java", "sha": "1372188d5b337985b00597bc8e327df8d95c758e", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/fineract-cn-portfolio/contents/api/src/test/java/io/mifos/portfolio/api/v1/domain/CommandTest.java?ref=eaeac763630d9e0bbdce81edfab795d51473de3d", "patch": "@@ -52,6 +52,9 @@ public static Collection testCases() {\n     ret.add(new ValidationTestCase<Command>(\"validAccountAssignment\")\n             .adjustment(x -> x.setOneTimeAccountAssignments(Collections.singletonList(new AccountAssignment(PROCESSING_FEE_ID, \"7534\"))))\n             .valid(true));\n+    ret.add(new ValidationTestCase<Command>(\"nullAccountAssignment\")\n+            .adjustment(x -> x.setOneTimeAccountAssignments(null))\n+            .valid(true));\n     return ret;\n   }\n }", "filename": "api/src/test/java/io/mifos/portfolio/api/v1/domain/CommandTest.java"}, {"additions": 6, "raw_url": "https://github.com/apache/fineract-cn-portfolio/raw/eaeac763630d9e0bbdce81edfab795d51473de3d/component-test/src/main/java/io/mifos/portfolio/TestCommands.java", "blob_url": "https://github.com/apache/fineract-cn-portfolio/blob/eaeac763630d9e0bbdce81edfab795d51473de3d/component-test/src/main/java/io/mifos/portfolio/TestCommands.java", "sha": "22b3b337465aaba45447eb2b39cd0d9219071766", "changes": 12, "status": "modified", "deletions": 6, "contents_url": "https://api.github.com/repos/apache/fineract-cn-portfolio/contents/component-test/src/main/java/io/mifos/portfolio/TestCommands.java?ref=eaeac763630d9e0bbdce81edfab795d51473de3d", "patch": "@@ -39,29 +39,29 @@ public void testHappyWorkflow() throws InterruptedException {\n     checkNextActionsCorrect(product.getIdentifier(), customerCase.getIdentifier(), Action.OPEN);\n \n \n-    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.OPEN, Collections.emptyList(), OPEN_INDIVIDUALLOAN_CASE, Case.State.PENDING);\n+    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.OPEN, null, OPEN_INDIVIDUALLOAN_CASE, Case.State.PENDING);\n     checkNextActionsCorrect(product.getIdentifier(), customerCase.getIdentifier(), Action.APPROVE, Action.DENY);\n \n \n-    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.APPROVE, Collections.emptyList(), APPROVE_INDIVIDUALLOAN_CASE, Case.State.APPROVED);\n+    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.APPROVE, null, APPROVE_INDIVIDUALLOAN_CASE, Case.State.APPROVED);\n     checkNextActionsCorrect(product.getIdentifier(), customerCase.getIdentifier(), Action.DISBURSE, Action.CLOSE);\n \n \n-    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.DISBURSE, Collections.emptyList(), DISBURSE_INDIVIDUALLOAN_CASE, Case.State.ACTIVE);\n+    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.DISBURSE, null, DISBURSE_INDIVIDUALLOAN_CASE, Case.State.ACTIVE);\n     checkNextActionsCorrect(product.getIdentifier(), customerCase.getIdentifier(),\n             Action.APPLY_INTEREST, Action.MARK_LATE, Action.ACCEPT_PAYMENT, Action.DISBURSE, Action.WRITE_OFF, Action.CLOSE);\n \n \n-    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.ACCEPT_PAYMENT, Collections.emptyList(), ACCEPT_PAYMENT_INDIVIDUALLOAN_CASE, Case.State.ACTIVE);\n+    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.ACCEPT_PAYMENT, null, ACCEPT_PAYMENT_INDIVIDUALLOAN_CASE, Case.State.ACTIVE);\n     checkNextActionsCorrect(product.getIdentifier(), customerCase.getIdentifier(),\n             Action.APPLY_INTEREST, Action.MARK_LATE, Action.ACCEPT_PAYMENT, Action.DISBURSE, Action.WRITE_OFF, Action.CLOSE);\n \n \n-    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.ACCEPT_PAYMENT, Collections.emptyList(), ACCEPT_PAYMENT_INDIVIDUALLOAN_CASE, Case.State.ACTIVE);\n+    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.ACCEPT_PAYMENT, null, ACCEPT_PAYMENT_INDIVIDUALLOAN_CASE, Case.State.ACTIVE);\n     checkNextActionsCorrect(product.getIdentifier(), customerCase.getIdentifier(),\n             Action.APPLY_INTEREST, Action.MARK_LATE, Action.ACCEPT_PAYMENT, Action.DISBURSE, Action.WRITE_OFF, Action.CLOSE);\n \n-    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.CLOSE, Collections.emptyList(), CLOSE_INDIVIDUALLOAN_CASE, Case.State.CLOSED);\n+    checkStateTransfer(product.getIdentifier(), customerCase.getIdentifier(), Action.CLOSE, null, CLOSE_INDIVIDUALLOAN_CASE, Case.State.CLOSED);\n     checkNextActionsCorrect(product.getIdentifier(), customerCase.getIdentifier());\n   }\n ", "filename": "component-test/src/main/java/io/mifos/portfolio/TestCommands.java"}, {"additions": 2, "raw_url": "https://github.com/apache/fineract-cn-portfolio/raw/eaeac763630d9e0bbdce81edfab795d51473de3d/service/src/main/java/io/mifos/individuallending/internal/service/CostComponentService.java", "blob_url": "https://github.com/apache/fineract-cn-portfolio/blob/eaeac763630d9e0bbdce81edfab795d51473de3d/service/src/main/java/io/mifos/individuallending/internal/service/CostComponentService.java", "sha": "1376692734b3a5a4e4d141be20b6a5a5586c6df7", "changes": 3, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/fineract-cn-portfolio/contents/service/src/main/java/io/mifos/individuallending/internal/service/CostComponentService.java?ref=eaeac763630d9e0bbdce81edfab795d51473de3d", "patch": "@@ -32,6 +32,7 @@\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.stereotype.Service;\n \n+import javax.annotation.Nullable;\n import java.math.BigDecimal;\n import java.time.LocalDate;\n import java.time.ZoneId;\n@@ -68,7 +69,7 @@ public CostComponentService(\n   public DataContextOfAction checkedGetDataContext(\n           final String productIdentifier,\n           final String caseIdentifier,\n-          final List<AccountAssignment> oneTimeAccountAssignments) {\n+          final @Nullable List<AccountAssignment> oneTimeAccountAssignments) {\n \n     final ProductEntity product =\n             productRepository.findByIdentifier(productIdentifier)", "filename": "service/src/main/java/io/mifos/individuallending/internal/service/CostComponentService.java"}, {"additions": 12, "raw_url": "https://github.com/apache/fineract-cn-portfolio/raw/eaeac763630d9e0bbdce81edfab795d51473de3d/service/src/main/java/io/mifos/individuallending/internal/service/DataContextOfAction.java", "blob_url": "https://github.com/apache/fineract-cn-portfolio/blob/eaeac763630d9e0bbdce81edfab795d51473de3d/service/src/main/java/io/mifos/individuallending/internal/service/DataContextOfAction.java", "sha": "962efb23966b90a2782fa01bec551b16a2fb9091", "changes": 21, "status": "modified", "deletions": 9, "contents_url": "https://api.github.com/repos/apache/fineract-cn-portfolio/contents/service/src/main/java/io/mifos/individuallending/internal/service/DataContextOfAction.java?ref=eaeac763630d9e0bbdce81edfab795d51473de3d", "patch": "@@ -20,6 +20,9 @@\n import io.mifos.portfolio.service.internal.repository.CaseEntity;\n import io.mifos.portfolio.service.internal.repository.ProductEntity;\n \n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import java.util.Collections;\n import java.util.List;\n \n /**\n@@ -31,29 +34,29 @@\n   private final CaseParameters caseParameters;\n   private final List<AccountAssignment> oneTimeAccountAssignments;\n \n-  DataContextOfAction(final ProductEntity product,\n-                      final CaseEntity customerCase,\n-                      final CaseParameters caseParameters,\n-                      final List<AccountAssignment> oneTimeAccountAssignments) {\n+  DataContextOfAction(final @Nonnull ProductEntity product,\n+                      final @Nonnull CaseEntity customerCase,\n+                      final @Nonnull CaseParameters caseParameters,\n+                      final @Nullable List<AccountAssignment> oneTimeAccountAssignments) {\n     this.product = product;\n     this.customerCase = customerCase;\n     this.caseParameters = caseParameters;\n-    this.oneTimeAccountAssignments = oneTimeAccountAssignments;\n+    this.oneTimeAccountAssignments = oneTimeAccountAssignments == null ? Collections.emptyList() : oneTimeAccountAssignments;\n   }\n \n-  public ProductEntity getProduct() {\n+  public @Nonnull ProductEntity getProduct() {\n     return product;\n   }\n \n-  public CaseEntity getCustomerCase() {\n+  public @Nonnull CaseEntity getCustomerCase() {\n     return customerCase;\n   }\n \n-  public CaseParameters getCaseParameters() {\n+  public @Nonnull CaseParameters getCaseParameters() {\n     return caseParameters;\n   }\n \n-  public List<AccountAssignment> getOneTimeAccountAssignments() {\n+  public @Nonnull List<AccountAssignment> getOneTimeAccountAssignments() {\n     return oneTimeAccountAssignments;\n   }\n }", "filename": "service/src/main/java/io/mifos/individuallending/internal/service/DataContextOfAction.java"}, {"additions": 7, "raw_url": "https://github.com/apache/fineract-cn-portfolio/raw/eaeac763630d9e0bbdce81edfab795d51473de3d/service/src/main/java/io/mifos/individuallending/internal/service/DesignatorToAccountIdentifierMapper.java", "blob_url": "https://github.com/apache/fineract-cn-portfolio/blob/eaeac763630d9e0bbdce81edfab795d51473de3d/service/src/main/java/io/mifos/individuallending/internal/service/DesignatorToAccountIdentifierMapper.java", "sha": "5b2fb94bd5172a008e1630ec0668c859855922d9", "changes": 13, "status": "modified", "deletions": 6, "contents_url": "https://api.github.com/repos/apache/fineract-cn-portfolio/contents/service/src/main/java/io/mifos/individuallending/internal/service/DesignatorToAccountIdentifierMapper.java?ref=eaeac763630d9e0bbdce81edfab795d51473de3d", "patch": "@@ -23,6 +23,7 @@\n import io.mifos.portfolio.service.internal.repository.CaseAccountAssignmentEntity;\n import io.mifos.portfolio.service.internal.repository.ProductAccountAssignmentEntity;\n \n+import javax.annotation.Nonnull;\n import java.util.List;\n import java.util.Set;\n import java.util.stream.Stream;\n@@ -31,11 +32,11 @@\n  * @author Myrle Krantz\n  */\n public class DesignatorToAccountIdentifierMapper {\n-  private final Set<ProductAccountAssignmentEntity> productAccountAssignments;\n-  private final Set<CaseAccountAssignmentEntity> caseAccountAssignments;\n-  private final List<AccountAssignment> oneTimeAccountAssignments;\n+  private final @Nonnull Set<ProductAccountAssignmentEntity> productAccountAssignments;\n+  private final @Nonnull Set<CaseAccountAssignmentEntity> caseAccountAssignments;\n+  private final @Nonnull List<AccountAssignment> oneTimeAccountAssignments;\n \n-  public DesignatorToAccountIdentifierMapper(final DataContextOfAction dataContextOfAction) {\n+  public DesignatorToAccountIdentifierMapper(final @Nonnull DataContextOfAction dataContextOfAction) {\n     this.productAccountAssignments = dataContextOfAction.getProduct().getAccountAssignments();\n     this.caseAccountAssignments = dataContextOfAction.getCustomerCase().getAccountAssignments();\n     this.oneTimeAccountAssignments = dataContextOfAction.getOneTimeAccountAssignments();\n@@ -50,7 +51,7 @@ public DesignatorToAccountIdentifierMapper(final DataContextOfAction dataContext\n             productAccountAssignments.stream().map(ProductMapper::mapAccountAssignmentEntity));\n   }\n \n-  public String mapOrThrow(final String accountDesignator) {\n+  public String mapOrThrow(final @Nonnull String accountDesignator) {\n     return allAccountAssignmentsAsStream()\n             .filter(x -> x.getDesignator().equals(accountDesignator))\n             .findFirst()\n@@ -63,4 +64,4 @@ public String mapOrThrow(final String accountDesignator) {\n             .filter(x -> !x.getDesignator().equals(AccountDesignators.ENTRY))\n             .filter(x -> (x.getAccountIdentifier() == null) && (x.getLedgerIdentifier() != null));\n   }\n-}\n+}\n\\ No newline at end of file", "filename": "service/src/main/java/io/mifos/individuallending/internal/service/DesignatorToAccountIdentifierMapper.java"}], "repo": "fineract-cn-portfolio"}, {"commit": "https://github.com/apache/fineract-cn-portfolio/commit/13ebfbcf454a02c7afcde855051637f7f9d23738", "parent": "https://github.com/apache/fineract-cn-portfolio/commit/ea286abbbf89ef28ab339459e37856e23e24a195", "message": "Fixing min max range checking.  By all appearances javascript was comparing object references instead of calling java .compareTo.  null value shouldn't cause a npe, and equal min and max should be allowed.", "bug_id": "fineract-cn-portfolio_3", "file": [{"additions": 1, "raw_url": "https://github.com/apache/fineract-cn-portfolio/raw/13ebfbcf454a02c7afcde855051637f7f9d23738/api/src/main/java/io/mifos/portfolio/api/v1/domain/BalanceRange.java", "blob_url": "https://github.com/apache/fineract-cn-portfolio/blob/13ebfbcf454a02c7afcde855051637f7f9d23738/api/src/main/java/io/mifos/portfolio/api/v1/domain/BalanceRange.java", "sha": "b6515b32fa0bfeb539a8eb287e5194b1525264af", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/fineract-cn-portfolio/contents/api/src/main/java/io/mifos/portfolio/api/v1/domain/BalanceRange.java?ref=13ebfbcf454a02c7afcde855051637f7f9d23738", "patch": "@@ -25,7 +25,7 @@\n  * @author Myrle Krantz\n  */\n @SuppressWarnings({\"WeakerAccess\", \"unused\"})\n-@ScriptAssert(lang = \"javascript\", script = \"_this.maximum > _this.minimum && _this.minimum.scale() <= 4 && _this.maximum.scale() <= 4\")\n+@ScriptAssert(lang = \"javascript\", script = \"_this.maximum != null && _this.minimum != null && _this.maximum.compareTo(_this.minimum) >= 0 && _this.minimum.scale() <= 4 && _this.maximum.scale() <= 4\")\n public final class BalanceRange {\n   @Range(min = 0)\n   private BigDecimal minimum;", "filename": "api/src/main/java/io/mifos/portfolio/api/v1/domain/BalanceRange.java"}, {"additions": 1, "raw_url": "https://github.com/apache/fineract-cn-portfolio/raw/13ebfbcf454a02c7afcde855051637f7f9d23738/api/src/main/java/io/mifos/portfolio/api/v1/domain/InterestRange.java", "blob_url": "https://github.com/apache/fineract-cn-portfolio/blob/13ebfbcf454a02c7afcde855051637f7f9d23738/api/src/main/java/io/mifos/portfolio/api/v1/domain/InterestRange.java", "sha": "9bb75c4095867aa0b3b2e3602544377d50570b1e", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/fineract-cn-portfolio/contents/api/src/main/java/io/mifos/portfolio/api/v1/domain/InterestRange.java?ref=13ebfbcf454a02c7afcde855051637f7f9d23738", "patch": "@@ -25,7 +25,7 @@\n  * @author Myrle Krantz\n  */\n @SuppressWarnings({\"WeakerAccess\", \"unused\"})\n-@ScriptAssert(lang = \"javascript\", script = \"_this.maximum > _this.minimum && _this.minimum.scale() == 2 && _this.maximum.scale() == 2\")\n+@ScriptAssert(lang = \"javascript\", script = \"_this.maximum != null && _this.minimum != null && _this.maximum.compareTo(_this.minimum) >= 0 && _this.minimum.scale() == 2 && _this.maximum.scale() == 2\")\n public class InterestRange {\n   @DecimalMin(value = \"0.00\")\n   @DecimalMax(value = \"999.99\")", "filename": "api/src/main/java/io/mifos/portfolio/api/v1/domain/InterestRange.java"}, {"additions": 12, "raw_url": "https://github.com/apache/fineract-cn-portfolio/raw/13ebfbcf454a02c7afcde855051637f7f9d23738/api/src/test/java/io/mifos/portfolio/api/v1/domain/BalanceRangeTest.java", "blob_url": "https://github.com/apache/fineract-cn-portfolio/blob/13ebfbcf454a02c7afcde855051637f7f9d23738/api/src/test/java/io/mifos/portfolio/api/v1/domain/BalanceRangeTest.java", "sha": "9a34e4356ec4d38e7006c4b62211594cf248b9bc", "changes": 12, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/fineract-cn-portfolio/contents/api/src/test/java/io/mifos/portfolio/api/v1/domain/BalanceRangeTest.java?ref=13ebfbcf454a02c7afcde855051637f7f9d23738", "patch": "@@ -54,6 +54,18 @@ public static Collection testCases() {\n     ret.add(new ValidationTestCase<BalanceRange>(\"minLargerthanMax\")\n             .adjustment((x) -> x.setMinimum(BigDecimal.TEN.multiply(BigDecimal.TEN)))\n             .valid(false));\n+    ret.add(new ValidationTestCase<BalanceRange>(\"5 and 10\")\n+            .adjustment(x -> {\n+              x.setMinimum(BigDecimal.valueOf(5L).setScale(2, BigDecimal.ROUND_UNNECESSARY));\n+              x.setMaximum(BigDecimal.valueOf(10L).setScale(2, BigDecimal.ROUND_UNNECESSARY));\n+            })\n+            .valid(true));\n+    ret.add(new ValidationTestCase<BalanceRange>(\"5 and 5\")\n+            .adjustment(x -> {\n+              x.setMinimum(BigDecimal.valueOf(5L).setScale(2, BigDecimal.ROUND_UNNECESSARY));\n+              x.setMaximum(BigDecimal.valueOf(5L).setScale(2, BigDecimal.ROUND_UNNECESSARY));\n+            })\n+            .valid(true));\n     return ret;\n   }\n }", "filename": "api/src/test/java/io/mifos/portfolio/api/v1/domain/BalanceRangeTest.java"}, {"additions": 59, "raw_url": "https://github.com/apache/fineract-cn-portfolio/raw/13ebfbcf454a02c7afcde855051637f7f9d23738/api/src/test/java/io/mifos/portfolio/api/v1/domain/InterestRangeTest.java", "blob_url": "https://github.com/apache/fineract-cn-portfolio/blob/13ebfbcf454a02c7afcde855051637f7f9d23738/api/src/test/java/io/mifos/portfolio/api/v1/domain/InterestRangeTest.java", "sha": "db1b3bc194fc41985570b2585b2db6e68cc94951", "changes": 59, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/fineract-cn-portfolio/contents/api/src/test/java/io/mifos/portfolio/api/v1/domain/InterestRangeTest.java?ref=13ebfbcf454a02c7afcde855051637f7f9d23738", "patch": "@@ -0,0 +1,59 @@\n+package io.mifos.portfolio.api.v1.domain;\n+\n+import io.mifos.core.test.domain.ValidationTest;\n+import io.mifos.core.test.domain.ValidationTestCase;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+\n+import java.math.BigDecimal;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+\n+import static org.junit.Assert.*;\n+\n+/**\n+ * @author Myrle Krantz\n+ */\n+@RunWith(Parameterized.class)\n+public class InterestRangeTest extends ValidationTest<InterestRange> {\n+  public InterestRangeTest(ValidationTestCase<InterestRange> testCase) {\n+    super(testCase);\n+  }\n+\n+  @Override\n+  protected InterestRange createValidTestSubject() {\n+    return new InterestRange(BigDecimal.valueOf(0.02d).setScale(2, BigDecimal.ROUND_UNNECESSARY),\n+            BigDecimal.valueOf(0.03d).setScale(2, BigDecimal.ROUND_UNNECESSARY));\n+  }\n+\n+  @Parameterized.Parameters\n+  public static Collection testCases() {\n+    final Collection<ValidationTestCase> ret = new ArrayList<>();\n+    ret.add(new ValidationTestCase<InterestRange>(\"basicCase\")\n+            .adjustment(x -> {})\n+            .valid(true));\n+    ret.add(new ValidationTestCase<InterestRange>(\"5 and 10\")\n+            .adjustment(x -> {\n+              x.setMinimum(BigDecimal.valueOf(5L).setScale(2, BigDecimal.ROUND_UNNECESSARY));\n+              x.setMaximum(BigDecimal.valueOf(10L).setScale(2, BigDecimal.ROUND_UNNECESSARY));\n+            })\n+            .valid(true));\n+    ret.add(new ValidationTestCase<InterestRange>(\"5 and 5\")\n+            .adjustment(x -> {\n+              x.setMinimum(BigDecimal.valueOf(5L).setScale(2, BigDecimal.ROUND_UNNECESSARY));\n+              x.setMaximum(BigDecimal.valueOf(5L).setScale(2, BigDecimal.ROUND_UNNECESSARY));\n+            })\n+            .valid(true));\n+    ret.add(new ValidationTestCase<InterestRange>(\"maxNull\")\n+            .adjustment((x) -> x.setMaximum(null))\n+            .valid(false));\n+    ret.add(new ValidationTestCase<InterestRange>(\"maximim smaller than minimum\")\n+            .adjustment(x -> {\n+              x.setMinimum(BigDecimal.valueOf(10L).setScale(2, BigDecimal.ROUND_UNNECESSARY));\n+              x.setMaximum(BigDecimal.valueOf(5L).setScale(2, BigDecimal.ROUND_UNNECESSARY));\n+            })\n+            .valid(false));\n+    return ret;\n+  }\n+\n+}\n\\ No newline at end of file", "filename": "api/src/test/java/io/mifos/portfolio/api/v1/domain/InterestRangeTest.java"}], "repo": "fineract-cn-portfolio"}]
