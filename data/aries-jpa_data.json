[
    {
        "repo": "aries-jpa",
        "message": "[ARIES-1615] Handle PreparedStatement to avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/aries/trunk/jpa@1766695 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/aries-jpa/commit/3b0e543e99c2c94f02153d2313ec8635c9ce56e8",
        "parent": "https://github.com/apache/aries-jpa/commit/d1ff32a52cbc71ff78bac257092be24913f2d61c",
        "bug_id": "aries-jpa_1",
        "file": [
            {
                "sha": "cac5635d422c44568c8891498b7c475d1535e84d",
                "filename": "jpa-container/src/main/java/org/apache/aries/jpa/container/weaving/impl/DummyDataSource.java",
                "blob_url": "https://github.com/apache/aries-jpa/blob/3b0e543e99c2c94f02153d2313ec8635c9ce56e8/jpa-container/src/main/java/org/apache/aries/jpa/container/weaving/impl/DummyDataSource.java",
                "raw_url": "https://github.com/apache/aries-jpa/raw/3b0e543e99c2c94f02153d2313ec8635c9ce56e8/jpa-container/src/main/java/org/apache/aries/jpa/container/weaving/impl/DummyDataSource.java",
                "status": "modified",
                "changes": 5,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/aries-jpa/contents/jpa-container/src/main/java/org/apache/aries/jpa/container/weaving/impl/DummyDataSource.java?ref=3b0e543e99c2c94f02153d2313ec8635c9ce56e8",
                "patch": "@@ -24,9 +24,11 @@\n import java.lang.reflect.Proxy;\n import java.sql.Connection;\n import java.sql.DatabaseMetaData;\n+import java.sql.PreparedStatement;\n import java.sql.ResultSet;\n import java.sql.SQLException;\n import java.sql.SQLFeatureNotSupportedException;\n+import java.sql.Statement;\n \n import javax.sql.DataSource;\n \n@@ -62,6 +64,9 @@ private Object proxyClasses(ClassLoader classLoader, Class<?> type) {\n             if (type == ResultSet.class) {\n                 return createProxy(classLoader, ResultSet.class);\n             }\n+            if (type == Statement.class) {\n+                return createProxy(classLoader, PreparedStatement.class);\n+            }\n             return null;\n         }\n ",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "aries-jpa",
        "message": "[ARIES-1533] Make sure interfaces do not cause a NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/aries/trunk/jpa@1739703 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/aries-jpa/commit/7712046a1e16b65dc1ad2b2dcc0a019c21d78336",
        "parent": "https://github.com/apache/aries-jpa/commit/97cb979df9d1672edc14aad00bd412943de34a5f",
        "bug_id": "aries-jpa_2",
        "file": [
            {
                "sha": "8fec1699a9c2a8c7df27b798ed9c25eacec7cb2f",
                "filename": "jpa-blueprint/src/main/java/org/apache/aries/jpa/blueprint/impl/AnnotationScanner.java",
                "blob_url": "https://github.com/apache/aries-jpa/blob/7712046a1e16b65dc1ad2b2dcc0a019c21d78336/jpa-blueprint/src/main/java/org/apache/aries/jpa/blueprint/impl/AnnotationScanner.java",
                "raw_url": "https://github.com/apache/aries-jpa/raw/7712046a1e16b65dc1ad2b2dcc0a019c21d78336/jpa-blueprint/src/main/java/org/apache/aries/jpa/blueprint/impl/AnnotationScanner.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/aries-jpa/contents/jpa-blueprint/src/main/java/org/apache/aries/jpa/blueprint/impl/AnnotationScanner.java?ref=7712046a1e16b65dc1ad2b2dcc0a019c21d78336",
                "patch": "@@ -29,7 +29,7 @@\n \n     public List<AccessibleObject> getJpaAnnotatedMembers(Class<?> c, Class<? extends Annotation> annotation) {\n         final List<AccessibleObject> jpaAnnotated = new ArrayList<AccessibleObject>();\n-        for (Class<?> cl = c; cl != Object.class; cl = cl.getSuperclass()) {  \n+        for (Class<?> cl = c; cl != Object.class && cl != null; cl = cl.getSuperclass()) {\n             parseClass(annotation, jpaAnnotated, cl);\n         }\n         return jpaAnnotated;",
                "deletions": 1
            },
            {
                "sha": "ebd3b85b5fbf977c01b0920b808dae5f8764bd42",
                "filename": "jpa-blueprint/src/test/java/org/apache/aries/jpa/blueprint/impl/AnnotationScannerTest.java",
                "blob_url": "https://github.com/apache/aries-jpa/blob/7712046a1e16b65dc1ad2b2dcc0a019c21d78336/jpa-blueprint/src/test/java/org/apache/aries/jpa/blueprint/impl/AnnotationScannerTest.java",
                "raw_url": "https://github.com/apache/aries-jpa/raw/7712046a1e16b65dc1ad2b2dcc0a019c21d78336/jpa-blueprint/src/test/java/org/apache/aries/jpa/blueprint/impl/AnnotationScannerTest.java",
                "status": "modified",
                "changes": 9,
                "additions": 9,
                "contents_url": "https://api.github.com/repos/apache/aries-jpa/contents/jpa-blueprint/src/test/java/org/apache/aries/jpa/blueprint/impl/AnnotationScannerTest.java?ref=7712046a1e16b65dc1ad2b2dcc0a019c21d78336",
                "patch": "@@ -87,5 +87,14 @@ public void getPUAnnotatedMembersTest() {\n         Assert.assertEquals(\"setEmf\", method.getName());\n     }\n \n+    /**\n+     * When using a factory the class can be an interface. We need to make sure this does not cause a NPE\n+     */\n+    @Test\n+    public void getFactoryTest() {\n+        AnnotationScanner scanner = new AnnotationScanner();\n+        List<AccessibleObject> members = scanner.getJpaAnnotatedMembers(TestInterface.class, PersistenceUnit.class);\n+        Assert.assertEquals(0, members.size());\n+    }\n     \n }",
                "deletions": 0
            },
            {
                "sha": "87303f8ca6765940a85c7c58c254df669869a33f",
                "filename": "jpa-blueprint/src/test/java/org/apache/aries/jpa/blueprint/impl/TestInterface.java",
                "blob_url": "https://github.com/apache/aries-jpa/blob/7712046a1e16b65dc1ad2b2dcc0a019c21d78336/jpa-blueprint/src/test/java/org/apache/aries/jpa/blueprint/impl/TestInterface.java",
                "raw_url": "https://github.com/apache/aries-jpa/raw/7712046a1e16b65dc1ad2b2dcc0a019c21d78336/jpa-blueprint/src/test/java/org/apache/aries/jpa/blueprint/impl/TestInterface.java",
                "status": "added",
                "changes": 5,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/aries-jpa/contents/jpa-blueprint/src/test/java/org/apache/aries/jpa/blueprint/impl/TestInterface.java?ref=7712046a1e16b65dc1ad2b2dcc0a019c21d78336",
                "patch": "@@ -0,0 +1,5 @@\n+package org.apache.aries.jpa.blueprint.impl;\n+\n+public interface TestInterface {\n+\n+}",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "aries-jpa",
        "message": "[ARIES-1438] Fixed NPE with thanks to Matthew Pitts\n\ngit-svn-id: https://svn.apache.org/repos/asf/aries/trunk/jpa@1710823 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/aries-jpa/commit/149994af7e4d4a754e6d899be25875f8081c426d",
        "parent": "https://github.com/apache/aries-jpa/commit/2284be88ca854a200738d4c7ce9404643933b1a5",
        "bug_id": "aries-jpa_3",
        "file": [
            {
                "sha": "9a62cea63b2d01a883f9a5bd7c3be206c00023f8",
                "filename": "jpa-support/src/main/java/org/apache/aries/jpa/support/impl/XAJpaTemplate.java",
                "blob_url": "https://github.com/apache/aries-jpa/blob/149994af7e4d4a754e6d899be25875f8081c426d/jpa-support/src/main/java/org/apache/aries/jpa/support/impl/XAJpaTemplate.java",
                "raw_url": "https://github.com/apache/aries-jpa/raw/149994af7e4d4a754e6d899be25875f8081c426d/jpa-support/src/main/java/org/apache/aries/jpa/support/impl/XAJpaTemplate.java",
                "status": "modified",
                "changes": 3,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/aries-jpa/contents/jpa-support/src/main/java/org/apache/aries/jpa/support/impl/XAJpaTemplate.java?ref=149994af7e4d4a754e6d899be25875f8081c426d",
                "patch": "@@ -74,7 +74,8 @@ public XAJpaTemplate(EmSupplier emSupplier, TransactionManager tm, Coordinator c\n                 LOGGER.debug(\"Exception during finish of transaction\", e);\n                 throw wrapThrowable(e, \"Exception during finish of transaction\");\n             } finally {\n-                coord.end();\n+                if (coord != null)\n+                    coord.end();\n             }\n         }\n     }",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "aries-jpa",
        "message": "[ARIES-1372] Avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/aries/trunk/jpa@1695097 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/aries-jpa/commit/25a144771f7761b95852227476a430345d34e5ce",
        "parent": "https://github.com/apache/aries-jpa/commit/505458a160fc82a5814acbdce19b70c00ab843b4",
        "bug_id": "aries-jpa_4",
        "file": [
            {
                "sha": "4821d7106b7ddd81b8328e45ad33855b9e4299a2",
                "filename": "jpa-blueprint/src/main/java/org/apache/aries/jpa/blueprint/impl/JpaInterceptor.java",
                "blob_url": "https://github.com/apache/aries-jpa/blob/25a144771f7761b95852227476a430345d34e5ce/jpa-blueprint/src/main/java/org/apache/aries/jpa/blueprint/impl/JpaInterceptor.java",
                "raw_url": "https://github.com/apache/aries-jpa/raw/25a144771f7761b95852227476a430345d34e5ce/jpa-blueprint/src/main/java/org/apache/aries/jpa/blueprint/impl/JpaInterceptor.java",
                "status": "modified",
                "changes": 8,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/aries-jpa/contents/jpa-blueprint/src/main/java/org/apache/aries/jpa/blueprint/impl/JpaInterceptor.java?ref=25a144771f7761b95852227476a430345d34e5ce",
                "patch": "@@ -65,13 +65,17 @@ public Object preCall(ComponentMetadata cm, Method m, Object... parameters) thro\n \n     public void postCallWithException(ComponentMetadata cm, Method m, Throwable ex, Object preCallToken) {\n         LOG.debug(\"PostCallWithException for bean {}, method {}\", cm.getId(), m.getName(), ex);\n-        ((Coordination) preCallToken).fail(ex);\n+        if (preCallToken != null) {\n+            ((Coordination) preCallToken).fail(ex);\n+        }\n     }\n \n     public void postCallWithReturn(ComponentMetadata cm, Method m, Object returnType, Object preCallToken)\n         throws Exception {\n         LOG.debug(\"PostCallWithReturn for bean {}, method {}\", cm.getId(), m.getName());\n-        ((Coordination) preCallToken).end();\n+        if (preCallToken != null) {\n+            ((Coordination) preCallToken).end();\n+        }\n     }\n \n ",
                "deletions": 2
            }
        ]
    }
]