[
    {
        "repo": "tinkerpop",
        "commit": "https://github.com/apache/tinkerpop/commit/b195b623d02dcfb5bf188ab10fba2e7a7ef399c7",
        "bug_id": "tinkerpop_b195b62",
        "message": "added NPE protection to ObjectWritable and added ObjectWritableTest which ensure ObjectWritable is comparable, gettable, toStringable, etc. even when its empty() -- that is, this.t == null. CTR. Fixed TINKERPOP-1251",
        "parent": "https://github.com/apache/tinkerpop/commit/45c4303125ffdec915b66258d560e7b9d86bcec5",
        "patched_files": [
            "ObjectWritable.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 6,
                "raw_url": "https://github.com/apache/tinkerpop/raw/b195b623d02dcfb5bf188ab10fba2e7a7ef399c7/hadoop-gremlin/src/main/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritable.java",
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/hadoop-gremlin/src/main/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritable.java?ref=b195b623d02dcfb5bf188ab10fba2e7a7ef399c7",
                "filename": "hadoop-gremlin/src/main/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritable.java",
                "deletions": 3,
                "sha": "9e101ef84f0b1357c06607acc270f5aed181516d",
                "blob_url": "https://github.com/apache/tinkerpop/blob/b195b623d02dcfb5bf188ab10fba2e7a7ef399c7/hadoop-gremlin/src/main/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritable.java",
                "patch": "@@ -36,6 +36,7 @@\n  */\n public final class ObjectWritable<T> implements WritableComparable<ObjectWritable>, Serializable {\n \n+    private static final String NULL = \"null\";\n     private static final ObjectWritable<MapReduce.NullObject> NULL_OBJECT_WRITABLE = new ObjectWritable<>(MapReduce.NullObject.instance());\n \n     T t;\n@@ -57,7 +58,7 @@ public void set(final T t) {\n \n     @Override\n     public String toString() {\n-        return this.t.toString();\n+        return null == this.t ? NULL : this.t.toString();\n     }\n \n     @Override\n@@ -97,7 +98,9 @@ private void readObject(final ObjectInputStream inputStream) throws IOException,\n \n     @Override\n     public int compareTo(final ObjectWritable objectWritable) {\n-        if (this.t instanceof Comparable)\n+        if (null == this.t)\n+            return objectWritable.isEmpty() ? 0 : -1;\n+        else if (this.t instanceof Comparable && !objectWritable.isEmpty())\n             return ((Comparable) this.t).compareTo(objectWritable.get());\n         else if (this.t.equals(objectWritable.get()))\n             return 0;\n@@ -110,7 +113,7 @@ public boolean isEmpty() {\n     }\n \n     public static ObjectWritable empty() {\n-        return new ObjectWritable(null);\n+        return new ObjectWritable<>(null);\n     }\n \n     @Override",
                "changes": 9
            },
            {
                "status": "added",
                "additions": 49,
                "raw_url": "https://github.com/apache/tinkerpop/raw/b195b623d02dcfb5bf188ab10fba2e7a7ef399c7/hadoop-gremlin/src/test/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritableTest.java",
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/hadoop-gremlin/src/test/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritableTest.java?ref=b195b623d02dcfb5bf188ab10fba2e7a7ef399c7",
                "filename": "hadoop-gremlin/src/test/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritableTest.java",
                "deletions": 0,
                "sha": "12f4694c03cb65ea384970e21c54fa7e97d3f742",
                "blob_url": "https://github.com/apache/tinkerpop/blob/b195b623d02dcfb5bf188ab10fba2e7a7ef399c7/hadoop-gremlin/src/test/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritableTest.java",
                "patch": "@@ -0,0 +1,49 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.tinkerpop.gremlin.hadoop.structure.io;\n+\n+import org.junit.Test;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+\n+/**\n+ * @author Marko A. Rodriguez (http://markorodriguez.com)\n+ */\n+public class ObjectWritableTest {\n+\n+    @Test\n+    public void shouldNotHaveANullPointerException() {\n+        final ObjectWritable object = new ObjectWritable<>(null);\n+        assertNull(object.get());\n+        assertTrue(object.isEmpty());\n+        assertTrue(object.equals(ObjectWritable.empty()));\n+        assertFalse(object.equals(new ObjectWritable<>(\"hello\")));\n+        assertEquals(\"null\", object.toString());\n+        assertEquals(-1, object.compareTo(new ObjectWritable<>(\"blah\")));\n+        assertEquals(-1, new ObjectWritable<>(\"bloop\").compareTo(ObjectWritable.empty()));\n+        assertEquals(-1, new ObjectWritable<>(\"bloop\").compareTo(object));\n+        assertEquals(0, ObjectWritable.empty().compareTo(object));\n+        assertEquals(0, object.compareTo(ObjectWritable.empty()));\n+        assertEquals(0, object.compareTo(object));\n+    }\n+}",
                "changes": 49
            }
        ],
        "unit_tests": [
            "ObjectWritableTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "hadoop-gremlin/src/test/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritableTest.java",
        "buggy_files": [
            "hadoop-gremlin/src/main/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritable.java"
        ],
        "fixed": true
    }
]