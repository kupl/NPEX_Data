{
    "incubator-retired-slider_00eca8f": {
        "bug_id": "incubator-retired-slider_00eca8f",
        "commit": "https://github.com/apache/incubator-retired-slider/commit/00eca8fc98bd151cb551354c518376f552806a36",
        "file": [
            {
                "additions": 17,
                "blob_url": "https://github.com/apache/incubator-retired-slider/blob/00eca8fc98bd151cb551354c518376f552806a36/pom.xml",
                "changes": 18,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-slider/contents/pom.xml?ref=00eca8fc98bd151cb551354c518376f552806a36",
                "deletions": 1,
                "filename": "pom.xml",
                "patch": "@@ -509,6 +509,10 @@\n             <groupId>com.sun.jersey.jersey-test-framework</groupId>\n             <artifactId>jersey-test-framework-grizzly2</artifactId>\n           </exclusion>\n+          <exclusion>\n+            <groupId>net.java.dev.jets3t</groupId>\n+            <artifactId>jets3t</artifactId>\n+          </exclusion>\n         </exclusions>\n       </dependency>\n \n@@ -613,7 +617,19 @@\n           </exclusion>\n         </exclusions>\n       </dependency>\n-      \n+\n+      <dependency>\n+        <groupId>org.apache.httpcomponents</groupId>\n+        <artifactId>httpclient</artifactId>\n+        <version>4.2.5</version>\n+      </dependency>\n+\n+      <dependency>\n+        <groupId>org.apache.httpcomponents</groupId>\n+        <artifactId>httpcore</artifactId>\n+        <version>4.2.5</version>\n+      </dependency>\n+  \n       <!-- ======================================================== -->\n       <!-- HBASE -->\n       <!-- ======================================================== -->",
                "raw_url": "https://github.com/apache/incubator-retired-slider/raw/00eca8fc98bd151cb551354c518376f552806a36/pom.xml",
                "sha": "7f73bbd640ac0177976740283a3562cb32c43a2b",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/incubator-retired-slider/blob/00eca8fc98bd151cb551354c518376f552806a36/slider-core/pom.xml",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-slider/contents/slider-core/pom.xml?ref=00eca8fc98bd151cb551354c518376f552806a36",
                "deletions": 1,
                "filename": "slider-core/pom.xml",
                "patch": "@@ -282,7 +282,6 @@\n       <scope>test</scope>\n     </dependency>\n \n-\n     <dependency>\n       <groupId>junit</groupId>\n       <artifactId>junit</artifactId>\n@@ -319,6 +318,16 @@\n       <artifactId>commons-httpclient</artifactId>\n     </dependency>\n \n+    <dependency>\n+      <groupId>org.apache.httpcomponents</groupId>\n+      <artifactId>httpclient</artifactId>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>org.apache.httpcomponents</groupId>\n+      <artifactId>httpcore</artifactId>\n+    </dependency>\n+\n     <dependency>\n       <groupId>commons-lang</groupId>\n       <artifactId>commons-lang</artifactId>",
                "raw_url": "https://github.com/apache/incubator-retired-slider/raw/00eca8fc98bd151cb551354c518376f552806a36/slider-core/pom.xml",
                "sha": "a36e915be08b55a16db7116124b2653b50186408",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/incubator-retired-slider/blob/00eca8fc98bd151cb551354c518376f552806a36/slider-core/src/test/groovy/org/apache/slider/agent/standalone/TestStandaloneAgentWeb.groovy",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-slider/contents/slider-core/src/test/groovy/org/apache/slider/agent/standalone/TestStandaloneAgentWeb.groovy?ref=00eca8fc98bd151cb551354c518376f552806a36",
                "deletions": 1,
                "filename": "slider-core/src/test/groovy/org/apache/slider/agent/standalone/TestStandaloneAgentWeb.groovy",
                "patch": "@@ -69,7 +69,7 @@ class TestStandaloneAgentWeb extends AgentMiniClusterTestBase {\n \n     def appmaster = report.trackingUrl\n \n-//    GET(appmaster)\n+    GET(appmaster)\n \n //    GET(appmaster, RestPaths.SYSTEM_HEALTHCHECK)\n //    GET(appmaster, RestPaths.SYSTEM_PING)",
                "raw_url": "https://github.com/apache/incubator-retired-slider/raw/00eca8fc98bd151cb551354c518376f552806a36/slider-core/src/test/groovy/org/apache/slider/agent/standalone/TestStandaloneAgentWeb.groovy",
                "sha": "458c92158c06b15a7ab1d59bcbf50926bdc6fe0c",
                "status": "modified"
            }
        ],
        "message": "SLIDER-670 NPE in RMAuthenticationFilter chain, missing httpclient method",
        "parent": "https://github.com/apache/incubator-retired-slider/commit/867b67d4e1b80ad1072a9347b310dc1f3d1d576b",
        "patched_files": [
            "pom.java"
        ],
        "repo": "incubator-retired-slider",
        "unit_tests": [
            "TestStandaloneAgentWeb.java"
        ]
    },
    "incubator-retired-slider_217e1f2": {
        "bug_id": "incubator-retired-slider_217e1f2",
        "commit": "https://github.com/apache/incubator-retired-slider/commit/217e1f27ac2dd4054ae4a87e1e6aaf999e4277d4",
        "file": [
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/incubator-retired-slider/blob/217e1f27ac2dd4054ae4a87e1e6aaf999e4277d4/slider-core/src/test/groovy/org/apache/slider/test/SliderTestUtils.groovy",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-slider/contents/slider-core/src/test/groovy/org/apache/slider/test/SliderTestUtils.groovy?ref=217e1f27ac2dd4054ae4a87e1e6aaf999e4277d4",
                "deletions": 0,
                "filename": "slider-core/src/test/groovy/org/apache/slider/test/SliderTestUtils.groovy",
                "patch": "@@ -475,6 +475,18 @@ class SliderTestUtils extends Assert {\n     assert 0 == service.serviceExitCode;\n   }\n \n+  public static void assertContainersLive(ClusterDescription clusterDescription,\n+      String component, int expected) {\n+    log.info(\"Asserting component $component expected count $expected}\",)\n+    def instances = clusterDescription?.instances?.get(component)\n+    int actual = instances != null ? instances.size() : 0\n+    if (expected != actual) {\n+      log.warn(\n+          \"$component actual=$actual, expected $expected in \\n$clusterDescription\")\n+    }\n+    assert expected == actual\n+  }\n+\n   /**\n    * Execute a closure, assert it fails with a given exit code and text\n    * @param exitCode exit code",
                "raw_url": "https://github.com/apache/incubator-retired-slider/raw/217e1f27ac2dd4054ae4a87e1e6aaf999e4277d4/slider-core/src/test/groovy/org/apache/slider/test/SliderTestUtils.groovy",
                "sha": "1b32471641ef319e4b63a6598519b56186eb7fca",
                "status": "modified"
            },
            {
                "additions": 41,
                "blob_url": "https://github.com/apache/incubator-retired-slider/blob/217e1f27ac2dd4054ae4a87e1e6aaf999e4277d4/slider-core/src/test/groovy/org/apache/slider/test/TestAssertions.groovy",
                "changes": 41,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-slider/contents/slider-core/src/test/groovy/org/apache/slider/test/TestAssertions.groovy?ref=217e1f27ac2dd4054ae4a87e1e6aaf999e4277d4",
                "deletions": 0,
                "filename": "slider-core/src/test/groovy/org/apache/slider/test/TestAssertions.groovy",
                "patch": "@@ -0,0 +1,41 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.slider.test\n+\n+import org.apache.slider.api.ClusterDescription\n+import org.junit.Test\n+\n+/**\n+ * Test for some of the command test base operations\n+ */\n+class TestAssertions {\n+  @Test\n+  public void testNoInstances() throws Throwable {\n+    ClusterDescription clusterDescription = new ClusterDescription();\n+    clusterDescription.instances = null\n+    SliderTestUtils.assertContainersLive(clusterDescription, \"example\", 0);\n+  }\n+\n+  @Test\n+  public void testEmptyInstances() throws Throwable {\n+    ClusterDescription clusterDescription = new ClusterDescription();\n+    SliderTestUtils.assertContainersLive(clusterDescription, \"example\", 0);\n+  }\n+\n+}",
                "raw_url": "https://github.com/apache/incubator-retired-slider/raw/217e1f27ac2dd4054ae4a87e1e6aaf999e4277d4/slider-core/src/test/groovy/org/apache/slider/test/TestAssertions.groovy",
                "sha": "abfbe656ae3491a0cf9082e4de5ff331208ffc9c",
                "status": "added"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/incubator-retired-slider/blob/217e1f27ac2dd4054ae4a87e1e6aaf999e4277d4/slider-funtest/src/main/groovy/org/apache/slider/funtest/framework/CommandTestBase.groovy",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-slider/contents/slider-funtest/src/main/groovy/org/apache/slider/funtest/framework/CommandTestBase.groovy?ref=217e1f27ac2dd4054ae4a87e1e6aaf999e4277d4",
                "deletions": 10,
                "filename": "slider-funtest/src/main/groovy/org/apache/slider/funtest/framework/CommandTestBase.groovy",
                "patch": "@@ -176,16 +176,6 @@ abstract class CommandTestBase extends SliderTestUtils {\n              \"and YARN RM @ ${SLIDER_CONFIG.get(YarnConfiguration.RM_ADDRESS)}\")\n   }\n \n-  public static void assertContainersLive(ClusterDescription clusterDescription,\n-      String component, int count) {\n-    log.info(\"Asserting component count.\")\n-    int instanceCount = clusterDescription.instances[component].size()\n-    if (count != instanceCount) {\n-      log.warn(clusterDescription.toString())\n-    }\n-    assert count == instanceCount \n-  }\n-\n   public static void logShell(SliderShell shell) {\n     shell.dumpOutput();\n   }",
                "raw_url": "https://github.com/apache/incubator-retired-slider/raw/217e1f27ac2dd4054ae4a87e1e6aaf999e4277d4/slider-funtest/src/main/groovy/org/apache/slider/funtest/framework/CommandTestBase.groovy",
                "sha": "f14e9f1cb71c576d1102b15efef8f5c97e5ece11",
                "status": "modified"
            }
        ],
        "message": "SLIDER-603 : NPE in AppsThroughAgentIT",
        "parent": "https://github.com/apache/incubator-retired-slider/commit/333b7ab33e8461fd0c4dc0f0e857a7b549054685",
        "patched_files": [
            "SliderTestUtils.java",
            "CommandTestBase.java"
        ],
        "repo": "incubator-retired-slider",
        "unit_tests": [
            "TestAssertions.java"
        ]
    },
    "incubator-retired-slider_7091397": {
        "bug_id": "incubator-retired-slider_7091397",
        "commit": "https://github.com/apache/incubator-retired-slider/commit/7091397447ab8c8c7a8f82465c3520f76b2a7a75",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/incubator-retired-slider/blob/7091397447ab8c8c7a8f82465c3520f76b2a7a75/slider-core/src/main/java/org/apache/slider/common/tools/SliderUtils.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-slider/contents/slider-core/src/main/java/org/apache/slider/common/tools/SliderUtils.java?ref=7091397447ab8c8c7a8f82465c3520f76b2a7a75",
                "deletions": 0,
                "filename": "slider-core/src/main/java/org/apache/slider/common/tools/SliderUtils.java",
                "patch": "@@ -18,6 +18,7 @@\n \n package org.apache.slider.common.tools;\n \n+import com.google.common.base.Preconditions;\n import org.apache.commons.compress.archivers.zip.ZipArchiveEntry;\n import org.apache.commons.compress.archivers.zip.ZipArchiveInputStream;\n import org.apache.commons.io.output.ByteArrayOutputStream;\n@@ -616,6 +617,8 @@ public static String appReportToString(ApplicationReport r, String separator) {\n    */\n   public static <T1, T2> Map<T1, T2> mergeMapsIgnoreDuplicateKeys(Map<T1, T2> first,\n                                                                   Map<T1, T2> second) {\n+    Preconditions.checkArgument(first != null, \"Null 'first' value\");\n+    Preconditions.checkArgument(second != null, \"Null 'second' value\");\n     for (Map.Entry<T1, T2> entry : second.entrySet()) {\n       T1 key = entry.getKey();\n       if (!first.containsKey(key)) {",
                "raw_url": "https://github.com/apache/incubator-retired-slider/raw/7091397447ab8c8c7a8f82465c3520f76b2a7a75/slider-core/src/main/java/org/apache/slider/common/tools/SliderUtils.java",
                "sha": "edbf2b253078c6886f1de816896d905846d5ae3a",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/incubator-retired-slider/blob/7091397447ab8c8c7a8f82465c3520f76b2a7a75/slider-core/src/main/java/org/apache/slider/server/appmaster/SliderAppMaster.java",
                "changes": 22,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-slider/contents/slider-core/src/main/java/org/apache/slider/server/appmaster/SliderAppMaster.java?ref=7091397447ab8c8c7a8f82465c3520f76b2a7a75",
                "deletions": 19,
                "filename": "slider-core/src/main/java/org/apache/slider/server/appmaster/SliderAppMaster.java",
                "patch": "@@ -111,7 +111,6 @@\n import org.apache.slider.server.appmaster.operations.AbstractRMOperation;\n import org.apache.slider.server.appmaster.state.AppState;\n import org.apache.slider.server.appmaster.state.ContainerAssignment;\n-import org.apache.slider.server.appmaster.state.ContainerPriority;\n import org.apache.slider.server.appmaster.operations.ContainerReleaseOperation;\n import org.apache.slider.server.appmaster.state.ProviderAppState;\n import org.apache.slider.server.appmaster.operations.RMOperationHandler;\n@@ -153,7 +152,6 @@\n import java.util.Map;\n import java.util.concurrent.ExecutorService;\n import java.util.concurrent.Executors;\n-import java.util.concurrent.ScheduledExecutorService;\n import java.util.concurrent.TimeUnit;\n import java.util.concurrent.atomic.AtomicBoolean;\n import java.util.concurrent.locks.Condition;\n@@ -1332,28 +1330,14 @@ public long getProtocolVersion(String protocol, long clientVersion) throws\n     String result;\n     //quick update\n     //query and json-ify\n-    ClusterDescription cd;\n-    cd = getCurrentClusterStatus();\n+    ClusterDescription cd = updateClusterStatus();\n     result = cd.toJsonString();\n     String stat = result;\n     return Messages.GetJSONClusterStatusResponseProto.newBuilder()\n       .setClusterSpec(stat)\n       .build();\n   }\n \n-  /**\n-   * Get the current cluster status, including any provider-specific info\n-   * @return a status document\n-   */\n-  public ClusterDescription getCurrentClusterStatus() {\n-    ClusterDescription cd;\n-    synchronized (this) {\n-      updateClusterStatus();\n-      cd = getClusterDescription();\n-    }\n-    return cd;\n-  }\n-\n \n   @Override\n   public Messages.GetInstanceDefinitionResponseProto getInstanceDefinition(\n@@ -1485,10 +1469,10 @@ public ClusterDescription getCurrentClusterStatus() {\n   /**\n    * Update the cluster description with anything interesting\n    */\n-  public synchronized void updateClusterStatus() {\n+  public synchronized ClusterDescription updateClusterStatus() {\n     Map<String, String> providerStatus = providerService.buildProviderStatus();\n     assert providerStatus != null : \"null provider status\";\n-    appState.refreshClusterStatus(providerStatus);\n+    return appState.refreshClusterStatus(providerStatus);\n   }\n \n   /**",
                "raw_url": "https://github.com/apache/incubator-retired-slider/raw/7091397447ab8c8c7a8f82465c3520f76b2a7a75/slider-core/src/main/java/org/apache/slider/server/appmaster/SliderAppMaster.java",
                "sha": "9f4567de1bb6e699852308f2cbf219b596a32387",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/incubator-retired-slider/blob/7091397447ab8c8c7a8f82465c3520f76b2a7a75/slider-core/src/main/java/org/apache/slider/server/appmaster/state/AppState.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-slider/contents/slider-core/src/main/java/org/apache/slider/server/appmaster/state/AppState.java?ref=7091397447ab8c8c7a8f82465c3520f76b2a7a75",
                "deletions": 3,
                "filename": "slider-core/src/main/java/org/apache/slider/server/appmaster/state/AppState.java",
                "patch": "@@ -1379,7 +1379,7 @@ public void refreshClusterStatus() {\n    * Update the cluster description with anything interesting\n    * @param providerStatus status from the provider for the cluster info section\n    */\n-  public void refreshClusterStatus(Map<String, String> providerStatus) {\n+  public synchronized ClusterDescription refreshClusterStatus(Map<String, String> providerStatus) {\n     ClusterDescription cd = getClusterStatus();\n     long now = now();\n     cd.setInfoTime(StatusKeys.INFO_STATUS_TIME_HUMAN,\n@@ -1390,7 +1390,7 @@ public void refreshClusterStatus(Map<String, String> providerStatus) {\n         cd.setInfo(entry.getKey(),entry.getValue());\n       }\n     }\n-    MapOperations infoOps = new MapOperations(\"info\",cd.info);\n+    MapOperations infoOps = new MapOperations(\"info\", cd.info);\n     infoOps.mergeWithoutOverwrite(applicationInfo);\n     SliderUtils.addBuildInfo(infoOps, \"status\");\n     cd.statistics = new HashMap<>();\n@@ -1436,7 +1436,7 @@ public void refreshClusterStatus(Map<String, String> providerStatus) {\n     sliderstats.put(StatusKeys.STATISTICS_CONTAINERS_UNKNOWN_COMPLETED,\n         completionOfUnknownContainerEvent.get());\n     cd.statistics.put(SliderKeys.COMPONENT_AM, sliderstats);\n-    \n+    return cd;\n   }\n \n   /**",
                "raw_url": "https://github.com/apache/incubator-retired-slider/raw/7091397447ab8c8c7a8f82465c3520f76b2a7a75/slider-core/src/main/java/org/apache/slider/server/appmaster/state/AppState.java",
                "sha": "48f97bbff0b4ad557b16c0445f6dd8a60d01e174",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/incubator-retired-slider/blob/7091397447ab8c8c7a8f82465c3520f76b2a7a75/slider-core/src/test/groovy/org/apache/slider/agent/freezethaw/TestFreezeThawMasterlessAM.groovy",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-slider/contents/slider-core/src/test/groovy/org/apache/slider/agent/freezethaw/TestFreezeThawMasterlessAM.groovy?ref=7091397447ab8c8c7a8f82465c3520f76b2a7a75",
                "deletions": 1,
                "filename": "slider-core/src/test/groovy/org/apache/slider/agent/freezethaw/TestFreezeThawMasterlessAM.groovy",
                "patch": "@@ -22,6 +22,7 @@ import groovy.transform.CompileStatic\n import groovy.util.logging.Slf4j\n import org.apache.hadoop.fs.FileSystem as HadoopFS\n import org.apache.hadoop.fs.Path\n+import org.apache.hadoop.yarn.api.records.ApplicationReport\n import org.apache.hadoop.yarn.conf.YarnConfiguration\n import org.apache.slider.agent.AgentMiniClusterTestBase\n import org.apache.slider.client.SliderClient\n@@ -76,8 +77,10 @@ class TestFreezeThawMasterlessAM extends AgentMiniClusterTestBase {\n     //now start the cluster\n     ServiceLauncher launcher2 = thawCluster(clustername, [], true);\n     SliderClient newCluster = launcher2.service\n+    addToTeardown(newCluster);\n+\n+//    ApplicationReport report = waitForClusterLive(newCluster)\n     newCluster.getClusterDescription(clustername);\n-    \n     //freeze\n     assert 0 == clusterActionFreeze(sliderClient, clustername)\n ",
                "raw_url": "https://github.com/apache/incubator-retired-slider/raw/7091397447ab8c8c7a8f82465c3520f76b2a7a75/slider-core/src/test/groovy/org/apache/slider/agent/freezethaw/TestFreezeThawMasterlessAM.groovy",
                "sha": "04be7c03018784c05c2c091a5c9d5a226726e232",
                "status": "modified"
            }
        ],
        "message": "SLIDER-312 Jenkins NPE in TestFreezeThawMasterlessAM",
        "parent": "https://github.com/apache/incubator-retired-slider/commit/fe6a72062d901fd1764f563e90fab351761b7c98",
        "patched_files": [
            "SliderAppMaster.java",
            "SliderUtils.java",
            "AppState.java"
        ],
        "repo": "incubator-retired-slider",
        "unit_tests": [
            "TestFreezeThawMasterlessAM.java",
            "TestSliderUtils.java"
        ]
    },
    "incubator-retired-slider_7ba5fd6": {
        "bug_id": "incubator-retired-slider_7ba5fd6",
        "commit": "https://github.com/apache/incubator-retired-slider/commit/7ba5fd6a939848af219455427e5d74b0f789914b",
        "file": [
            {
                "additions": 18,
                "blob_url": "https://github.com/apache/incubator-retired-slider/blob/7ba5fd6a939848af219455427e5d74b0f789914b/slider-core/src/main/java/org/apache/slider/providers/agent/AgentProviderService.java",
                "changes": 45,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-slider/contents/slider-core/src/main/java/org/apache/slider/providers/agent/AgentProviderService.java?ref=7ba5fd6a939848af219455427e5d74b0f789914b",
                "deletions": 27,
                "filename": "slider-core/src/main/java/org/apache/slider/providers/agent/AgentProviderService.java",
                "patch": "@@ -23,10 +23,11 @@\n import org.apache.hadoop.util.StringUtils;\n import org.apache.hadoop.yarn.api.ApplicationConstants;\n import org.apache.hadoop.yarn.api.records.Container;\n-import org.apache.hadoop.yarn.api.records.ContainerId;\n import org.apache.hadoop.yarn.api.records.LocalResource;\n import org.apache.hadoop.yarn.api.records.LocalResourceType;\n import org.apache.slider.api.ClusterDescription;\n+import org.apache.slider.api.ClusterDescriptionKeys;\n+import org.apache.slider.api.ClusterNode;\n import org.apache.slider.api.OptionKeys;\n import org.apache.slider.api.StatusKeys;\n import org.apache.slider.common.SliderKeys;\n@@ -50,7 +51,6 @@\n import org.apache.slider.providers.agent.application.metadata.Metainfo;\n import org.apache.slider.providers.agent.application.metadata.MetainfoParser;\n import org.apache.slider.providers.agent.application.metadata.Service;\n-import org.apache.slider.server.appmaster.state.RoleInstance;\n import org.apache.slider.server.appmaster.state.StateAccessForProviders;\n import org.apache.slider.server.appmaster.web.rest.agent.AgentCommandType;\n import org.apache.slider.server.appmaster.web.rest.agent.AgentRestOperations;\n@@ -74,6 +74,7 @@\n import java.net.URL;\n import java.util.ArrayList;\n import java.util.Arrays;\n+import java.util.Collection;\n import java.util.HashMap;\n import java.util.HashSet;\n import java.util.LinkedHashMap;\n@@ -260,22 +261,11 @@ protected void publishComponentConfiguration(String name, String description,\n     getStateAccessor().getPublishedConfigurations().put(name, pubconf);\n   }\n \n-  protected Map<String, Map<String, String>> getRoleClusterNodeMapping() {\n-    StateAccessForProviders accessor = getStateAccessor();\n-    assert accessor.isApplicationLive();\n-    Map<ContainerId, RoleInstance> liveNodes = accessor.getLiveNodes();\n-    Map<String, Map<String, String>> retVal = new HashMap<>();\n-    for (ContainerId cid : liveNodes.keySet()) {\n-      RoleInstance ri = liveNodes.get(cid);\n-      Map<String, String> containerMap = retVal.get(ri.role);\n-      if (containerMap == null) {\n-        containerMap = new HashMap<>();\n-        retVal.put(ri.role, containerMap);\n-      }\n-      containerMap.put(cid.toString(), ri.host);\n-    }\n-\n-    return retVal;\n+  protected Map<String, Map<String, ClusterNode>> getRoleClusterNodeMapping() {\n+    stateAccessor.refreshClusterStatus();\n+    return (Map<String, Map<String, ClusterNode>>)\n+        stateAccessor.getClusterStatus().status.get(\n+            ClusterDescriptionKeys.KEY_CLUSTER_LIVE);\n   }\n \n   private String getContainerLabel(Container container, String role) {\n@@ -459,8 +449,8 @@ protected void processReturnedStatus(HeartBeat heartBeat, ComponentInstanceState\n \n             // publish export groups if any\n             Map<String, String> replaceTokens = new HashMap<>();\n-            for (Map.Entry<String, Map<String, String>> entry : getRoleClusterNodeMapping().entrySet()) {\n-              String hostName = getHostsList(entry.getValue(), true).iterator().next();\n+            for (Map.Entry<String, Map<String, ClusterNode>> entry : getRoleClusterNodeMapping().entrySet()) {\n+              String hostName = getHostsList(entry.getValue().values(), true).iterator().next();\n               replaceTokens.put(String.format(hostKeyFormat, entry.getKey().toUpperCase(Locale.ENGLISH)), hostName);\n             }\n \n@@ -730,17 +720,18 @@ private void addNamedConfiguration(String configName, Map<String, String> source\n   }\n \n   protected void addRoleRelatedTokens(Map<String, String> tokens) {\n-    for (Map.Entry<String, Map<String, String>> entry : getRoleClusterNodeMapping().entrySet()) {\n+    for (Map.Entry<String, Map<String, ClusterNode>> entry : getRoleClusterNodeMapping().entrySet()) {\n       String tokenName = entry.getKey().toUpperCase(Locale.ENGLISH) + \"_HOST\";\n-      String hosts = StringUtils.join(\",\", getHostsList(entry.getValue(), true));\n+      String hosts = StringUtils.join(\",\", getHostsList(entry.getValue().values(), true));\n       tokens.put(\"${\" + tokenName + \"}\", hosts);\n     }\n   }\n \n-  private Iterable<String> getHostsList(Map<String, String> values, boolean hostOnly) {\n+  private Iterable<String> getHostsList(Collection<ClusterNode> values,\n+                                        boolean hostOnly) {\n     List<String> hosts = new ArrayList<>();\n-    for (Map.Entry<String, String> entry : values.entrySet()) {\n-      hosts.add(hostOnly ? entry.getValue() : entry.getValue() + \"/\" + entry.getKey());\n+    for (ClusterNode cn : values) {\n+      hosts.add(hostOnly ? cn.host : cn.host + \"/\" + cn.name);\n     }\n \n     return hosts;\n@@ -761,10 +752,10 @@ private void addDefaultGlobalConfig(Map<String, String> config) {\n   }\n \n   private void buildRoleHostDetails(Map<String, URL> details) {\n-    for (Map.Entry<String, Map<String, String>> entry :\n+    for (Map.Entry<String, Map<String, ClusterNode>> entry :\n         getRoleClusterNodeMapping().entrySet()) {\n       details.put(entry.getKey() + \" Host(s)/Container(s): \" +\n-                  getHostsList(entry.getValue(), false),\n+                  getHostsList(entry.getValue().values(), false),\n                   null);\n     }\n   }",
                "raw_url": "https://github.com/apache/incubator-retired-slider/raw/7ba5fd6a939848af219455427e5d74b0f789914b/slider-core/src/main/java/org/apache/slider/providers/agent/AgentProviderService.java",
                "sha": "f5ebe2e1cd7b54bf0450f2de5b6762a013e2bb42",
                "status": "modified"
            },
            {
                "additions": 36,
                "blob_url": "https://github.com/apache/incubator-retired-slider/blob/7ba5fd6a939848af219455427e5d74b0f789914b/slider-core/src/test/java/org/apache/slider/providers/agent/TestAgentProviderService.java",
                "changes": 68,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-slider/contents/slider-core/src/test/java/org/apache/slider/providers/agent/TestAgentProviderService.java?ref=7ba5fd6a939848af219455427e5d74b0f789914b",
                "deletions": 32,
                "filename": "slider-core/src/test/java/org/apache/slider/providers/agent/TestAgentProviderService.java",
                "patch": "@@ -33,6 +33,8 @@\n import org.apache.hadoop.yarn.api.records.Resource;\n import org.apache.hadoop.yarn.api.records.Token;\n import org.apache.slider.api.ClusterDescription;\n+import org.apache.slider.api.ClusterDescriptionKeys;\n+import org.apache.slider.api.ClusterNode;\n import org.apache.slider.api.OptionKeys;\n import org.apache.slider.api.StatusKeys;\n import org.apache.slider.common.tools.SliderFileSystem;\n@@ -253,47 +255,47 @@ public void testRoleHostMapping() throws Exception {\n     AgentProviderService aps = new AgentProviderService();\n     StateAccessForProviders appState = new AppState(null) {\n       @Override\n-      public Map<ContainerId, RoleInstance> getLiveNodes() {\n-        Map<ContainerId, RoleInstance> retVal = new HashMap<>();\n-        ContainerId cid = new MyContainerId(1);\n-        Container container = new MyContainer();\n-        container.setId(cid);\n-        RoleInstance ri = new RoleInstance(container);\n-        ri.host = \"FIRST_HOST\";\n-        ri.role = \"FIRST_ROLE\";\n-        retVal.put(cid, ri);\n-\n-        cid = new MyContainerId(2);\n-        container = new MyContainer();\n-        container.setId(cid);\n-        ri = new RoleInstance(container);\n-        ri.host = \"SECOND_HOST\";\n-        ri.role = \"SECOND_ROLE\";\n-        retVal.put(cid, ri);\n-\n-        cid = new MyContainerId(3);\n-        container = new MyContainer();\n-        container.setId(cid);\n-        ri = new RoleInstance(container);\n-        ri.host = \"THIRD_HOST\";\n-        ri.role = \"SECOND_ROLE\";\n-        retVal.put(cid, ri);\n-\n-        return retVal;\n+      public ClusterDescription getClusterStatus() {\n+        ClusterDescription cd = new ClusterDescription();\n+        cd.status = new HashMap<String,Object>();\n+        Map<String, Map<String,ClusterNode>> roleMap = new HashMap<>();\n+        ClusterNode cn1 = new ClusterNode(new MyContainerId(1));\n+        cn1.host = \"FIRST_HOST\";\n+        Map<String, ClusterNode> map1 = new HashMap<>();\n+        map1.put(\"FIRST_CONTAINER\", cn1);\n+        ClusterNode cn2 = new ClusterNode(new MyContainerId(2));\n+        cn2.host = \"SECOND_HOST\";\n+        Map<String, ClusterNode> map2 = new HashMap<>();\n+        map2.put(\"SECOND_CONTAINER\", cn2);\n+        ClusterNode cn3 = new ClusterNode(new MyContainerId(3));\n+        cn3.host = \"THIRD_HOST\";\n+        map2.put(\"THIRD_CONTAINER\", cn3);\n+\n+        roleMap.put(\"FIRST_ROLE\", map1);\n+        roleMap.put(\"SECOND_ROLE\", map2);\n+\n+        cd.status.put(ClusterDescriptionKeys.KEY_CLUSTER_LIVE, roleMap);\n+\n+        return cd;\n       }\n \n       @Override\n       public boolean isApplicationLive() {\n         return true;\n       }\n+\n+      @Override\n+      public void refreshClusterStatus() {\n+        // do nothing\n+      }\n     };\n \n     aps.setStateAccessor(appState);\n-    Map<String, String> tokens = new HashMap<>();\n+    Map<String, String> tokens = new HashMap<String, String>();\n     aps.addRoleRelatedTokens(tokens);\n     TestCase.assertEquals(2, tokens.size());\n     TestCase.assertEquals(\"FIRST_HOST\", tokens.get(\"${FIRST_ROLE_HOST}\"));\n-    TestCase.assertEquals(\"SECOND_HOST,THIRD_HOST\", tokens.get(\"${SECOND_ROLE_HOST}\"));\n+    TestCase.assertEquals(\"THIRD_HOST,SECOND_HOST\", tokens.get(\"${SECOND_ROLE_HOST}\"));\n     aps.close();\n   }\n \n@@ -317,9 +319,11 @@ public void testProcessConfig() throws Exception {\n     status.setConfigs(configs);\n     hb.setComponentStatus(new ArrayList<>(Arrays.asList(status)));\n \n-    Map<String, Map<String, String>> roleClusterNodeMap = new HashMap<>();\n-    Map<String, String> container = new HashMap<>();\n-    container.put(\"cid1\", \"HOST1\");\n+    Map<String, Map<String, ClusterNode>> roleClusterNodeMap = new HashMap<>();\n+    Map<String, ClusterNode> container = new HashMap<>();\n+    ClusterNode cn1 = new ClusterNode(new MyContainerId(1));\n+    cn1.host = \"HOST1\";\n+    container.put(\"cid1\", cn1);\n     roleClusterNodeMap.put(\"HBASE_MASTER\", container);\n \n     ComponentInstanceState componentStatus = new ComponentInstanceState(\"HBASE_MASTER\", \"aid\", \"cid\");",
                "raw_url": "https://github.com/apache/incubator-retired-slider/raw/7ba5fd6a939848af219455427e5d74b0f789914b/slider-core/src/test/java/org/apache/slider/providers/agent/TestAgentProviderService.java",
                "sha": "bf792f991fceae7c401f561f6200495350b7772d",
                "status": "modified"
            }
        ],
        "message": "SLIDER-48 reverted some recent changes and accounted for possible NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/slider/trunk@1594702 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/incubator-retired-slider/commit/d4a6cdaef092a979fd0d0d48ab2b17841c4fc0d6",
        "patched_files": [
            "AgentProviderService.java"
        ],
        "repo": "incubator-retired-slider",
        "unit_tests": [
            "TestAgentProviderService.java"
        ]
    },
    "incubator-retired-slider_eade257": {
        "bug_id": "incubator-retired-slider_eade257",
        "commit": "https://github.com/apache/incubator-retired-slider/commit/eade2578150249ea784b20b4c0d78a51435f0b29",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/incubator-retired-slider/blob/eade2578150249ea784b20b4c0d78a51435f0b29/slider-core/src/main/java/org/apache/slider/common/tools/SliderUtils.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-slider/contents/slider-core/src/main/java/org/apache/slider/common/tools/SliderUtils.java?ref=eade2578150249ea784b20b4c0d78a51435f0b29",
                "deletions": 1,
                "filename": "slider-core/src/main/java/org/apache/slider/common/tools/SliderUtils.java",
                "patch": "@@ -2139,7 +2139,10 @@ public static void validateExe(String program, File exe) throws IOException {\n    */\n   public static void write(File outfile, byte[] data, boolean createParent)\n       throws IOException {\n-    File parentDir = outfile.getParentFile();\n+    File parentDir = outfile.getCanonicalFile().getParentFile();\n+    if (parentDir == null) {\n+      throw new IOException(outfile.getPath() + \" has no parent dir\");\n+    }\n     if (createParent) {\n       parentDir.mkdirs();\n     }",
                "raw_url": "https://github.com/apache/incubator-retired-slider/raw/eade2578150249ea784b20b4c0d78a51435f0b29/slider-core/src/main/java/org/apache/slider/common/tools/SliderUtils.java",
                "sha": "9c0547fba48f4677e8e0ca84f72db104cb1bedaf",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/incubator-retired-slider/blob/eade2578150249ea784b20b4c0d78a51435f0b29/slider-core/src/test/java/org/apache/slider/common/tools/TestSliderUtils.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-slider/contents/slider-core/src/test/java/org/apache/slider/common/tools/TestSliderUtils.java?ref=eade2578150249ea784b20b4c0d78a51435f0b29",
                "deletions": 0,
                "filename": "slider-core/src/test/java/org/apache/slider/common/tools/TestSliderUtils.java",
                "patch": "@@ -16,6 +16,7 @@\n  */\n package org.apache.slider.common.tools;\n \n+import org.apache.commons.io.FileUtils;\n import org.apache.hadoop.conf.Configuration;\n import org.apache.hadoop.fs.FileSystem;\n import org.apache.hadoop.fs.Path;\n@@ -30,6 +31,8 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+import java.io.File;\n+import java.io.IOException;\n import java.io.InputStream;\n import java.util.ArrayList;\n import java.util.List;\n@@ -147,4 +150,10 @@ public void testIsHdp() {\n     Assert.assertFalse(\"Should be false\", SliderUtils.isHdp());\n   }\n \n+  @Test\n+  public void testWrite() throws IOException {\n+    File testWriteFile = folder.newFile(\"testWrite\");\n+    SliderUtils.write(testWriteFile, \"test\".getBytes(\"UTF-8\"), true);\n+    Assert.assertTrue(FileUtils.readFileToString(testWriteFile, \"UTF-8\").equals(\"test\"));\n+  }\n }",
                "raw_url": "https://github.com/apache/incubator-retired-slider/raw/eade2578150249ea784b20b4c0d78a51435f0b29/slider-core/src/test/java/org/apache/slider/common/tools/TestSliderUtils.java",
                "sha": "20e72c00530afabfa75e47c3bb2d36299cb23bfd",
                "status": "modified"
            }
        ],
        "message": "SLIDER-971 NPE when \"slider resolve\" with \"--out\" (kyungwan nam)",
        "parent": "https://github.com/apache/incubator-retired-slider/commit/e4ac8ac2c2c436b200a7a058ba0c919989442bc0",
        "patched_files": [
            "SliderUtils.java"
        ],
        "repo": "incubator-retired-slider",
        "unit_tests": [
            "TestSliderUtils.java"
        ]
    }
}