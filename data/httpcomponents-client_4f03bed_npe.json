[
    {
        "repo": "httpcomponents-client",
        "commit": "https://github.com/apache/httpcomponents-client/commit/4f03bedbf81d4a94d31542464598138243e255f8",
        "bug_id": "httpcomponents-client_4f03bed",
        "message": "HTTPCLIENT-1417: Fixed NPE in BrowserCompatSpec#formatCookies caused by version 1 cookies with null cookie value\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1530218 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/httpcomponents-client/commit/df36e1087cb3673ff7aac01fe7ff08f91e43422c",
        "patched_files": [
            "BrowserCompatSpec.java",
            "RELEASE_NOTES.txt"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 5,
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/4f03bedbf81d4a94d31542464598138243e255f8/RELEASE_NOTES.txt",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/RELEASE_NOTES.txt?ref=4f03bedbf81d4a94d31542464598138243e255f8",
                "filename": "RELEASE_NOTES.txt",
                "deletions": 1,
                "sha": "ad9b5ee8fb1c20056311ca09410599b01adbd962",
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/4f03bedbf81d4a94d31542464598138243e255f8/RELEASE_NOTES.txt",
                "patch": "@@ -1,6 +1,10 @@\n-Changes sicne 4.3.1\n+Changes since 4.3.1\n -------------------\n \n+* [HTTPCLIENT-1417] Fixed NPE in BrowserCompatSpec#formatCookies caused by version 1\n+  cookies with null cookie value.\n+  Contributed by Oleg Kalnichevski <olegk at apache.org>\n+\n * [HTTPCLIENT-1416] Fixed NPE in CachingHttpClientBuilder#build().\n   Contributed by Oleg Kalnichevski <olegk at apache.org>\n ",
                "changes": 6
            },
            {
                "status": "modified",
                "additions": 5,
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/4f03bedbf81d4a94d31542464598138243e255f8/httpclient/src/main/java/org/apache/http/impl/cookie/BrowserCompatSpec.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/main/java/org/apache/http/impl/cookie/BrowserCompatSpec.java?ref=4f03bedbf81d4a94d31542464598138243e255f8",
                "filename": "httpclient/src/main/java/org/apache/http/impl/cookie/BrowserCompatSpec.java",
                "deletions": 2,
                "sha": "ce5e2830d0fd48f61d3550384716da3a3bb3918d",
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/4f03bedbf81d4a94d31542464598138243e255f8/httpclient/src/main/java/org/apache/http/impl/cookie/BrowserCompatSpec.java",
                "patch": "@@ -168,6 +168,10 @@ public BrowserCompatSpec() {\n         return parse(helems, origin);\n     }\n \n+    private static boolean isQuoteEnclosed(final String s) {\n+        return s != null && s.startsWith(\"\\\"\") && s.endsWith(\"\\\"\");\n+    }\n+\n     public List<Header> formatCookies(final List<Cookie> cookies) {\n         Args.notEmpty(cookies, \"List of cookies\");\n         final CharArrayBuffer buffer = new CharArrayBuffer(20 * cookies.size());\n@@ -180,8 +184,7 @@ public BrowserCompatSpec() {\n             }\n             final String cookieName = cookie.getName();\n             final String cookieValue = cookie.getValue();\n-            if (cookie.getVersion() > 0 &&\n-                    !(cookieValue.startsWith(\"\\\"\") && cookieValue.endsWith(\"\\\"\"))) {\n+            if (cookie.getVersion() > 0 && !isQuoteEnclosed(cookieValue)) {\n                 BasicHeaderValueFormatter.INSTANCE.formatHeaderElement(\n                         buffer,\n                         new BasicHeaderElement(cookieName, cookieValue),",
                "changes": 7
            },
            {
                "status": "modified",
                "additions": 18,
                "raw_url": "https://github.com/apache/httpcomponents-client/raw/4f03bedbf81d4a94d31542464598138243e255f8/httpclient/src/test/java/org/apache/http/impl/cookie/TestBrowserCompatSpec.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-client/contents/httpclient/src/test/java/org/apache/http/impl/cookie/TestBrowserCompatSpec.java?ref=4f03bedbf81d4a94d31542464598138243e255f8",
                "filename": "httpclient/src/test/java/org/apache/http/impl/cookie/TestBrowserCompatSpec.java",
                "deletions": 0,
                "sha": "3cb0c92af1210a8dd6e3877ab45b9342b6367fc2",
                "blob_url": "https://github.com/apache/httpcomponents-client/blob/4f03bedbf81d4a94d31542464598138243e255f8/httpclient/src/test/java/org/apache/http/impl/cookie/TestBrowserCompatSpec.java",
                "patch": "@@ -922,6 +922,24 @@ public void testNullCookieValueFormatting() {\n         Assert.assertEquals(\"name=\", headers.get(0).getValue());\n     }\n \n+    @Test\n+    public void testNullCookieValueFormattingCookieVersion1() {\n+        final BasicClientCookie cookie = new BasicClientCookie(\"name\", null);\n+        cookie.setVersion(1);\n+        cookie.setDomain(\".whatever.com\");\n+        cookie.setAttribute(ClientCookie.DOMAIN_ATTR, cookie.getDomain());\n+        cookie.setPath(\"/\");\n+        cookie.setAttribute(ClientCookie.PATH_ATTR, cookie.getPath());\n+\n+        final CookieSpec cookiespec = new BrowserCompatSpec();\n+        final List<Cookie> cookies = new ArrayList<Cookie>(1);\n+        cookies.add(cookie);\n+        final List<Header> headers = cookiespec.formatCookies(cookies);\n+        Assert.assertNotNull(headers);\n+        Assert.assertEquals(1, headers.size());\n+        Assert.assertEquals(\"name\", headers.get(0).getValue());\n+    }\n+\n     /**\n      * Tests generic cookie formatting.\n      */",
                "changes": 18
            }
        ],
        "unit_tests": [
            "TestBrowserCompatSpec.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "httpclient/src/test/java/org/apache/http/impl/cookie/TestBrowserCompatSpec.java",
        "buggy_files": [
            "httpclient/src/main/java/org/apache/http/impl/cookie/BrowserCompatSpec.java",
            "RELEASE_NOTES.txt"
        ],
        "fixed": true
    }
]