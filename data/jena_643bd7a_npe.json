[
    {
        "repo": "jena",
        "commit": "https://github.com/apache/jena/commit/643bd7a944e23554d21d1f01c207fe7e1a3d3098",
        "bug_id": "jena_643bd7a",
        "message": "Fix and tests for possible NPE (JENA-1405)\n\nFixes a possible NPE in AdaptorFileManager by aligning its behaviour\nwith FileManager to throw NotFoundException\n\nAdds specific tests for these cases",
        "parent": "https://github.com/apache/jena/commit/875f8fedc2ea194e94fe71b69e6ec16ea05edc51",
        "patched_files": [
            "FileManager.java",
            "AdapterFileManager.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 7,
                "raw_url": "https://github.com/apache/jena/raw/643bd7a944e23554d21d1f01c207fe7e1a3d3098/jena-arq/src/main/java/org/apache/jena/riot/adapters/AdapterFileManager.java",
                "contents_url": "https://api.github.com/repos/apache/jena/contents/jena-arq/src/main/java/org/apache/jena/riot/adapters/AdapterFileManager.java?ref=643bd7a944e23554d21d1f01c207fe7e1a3d3098",
                "filename": "jena-arq/src/main/java/org/apache/jena/riot/adapters/AdapterFileManager.java",
                "deletions": 0,
                "sha": "b116f162f2df9768b31037c4ff74fba5ea8522a3",
                "blob_url": "https://github.com/apache/jena/blob/643bd7a944e23554d21d1f01c207fe7e1a3d3098/jena-arq/src/main/java/org/apache/jena/riot/adapters/AdapterFileManager.java",
                "patch": "@@ -28,6 +28,7 @@\n import org.apache.jena.riot.RDFLanguages ;\n import org.apache.jena.riot.SysRIOT ;\n import org.apache.jena.riot.system.stream.* ;\n+import org.apache.jena.shared.NotFoundException;\n import org.apache.jena.util.FileManager ;\n import org.apache.jena.util.FileUtils ;\n import org.apache.jena.util.TypedStream ;\n@@ -285,6 +286,12 @@ protected Model readModelWorker(Model model, String filenameOrURI, String baseUR\n         if ( baseURI == null )\n             baseURI = SysRIOT.chooseBaseIRI(filenameOrURI) ;\n         try(TypedInputStream in = streamManager.openNoMapOrNull(mappedURI)) {\n+            if ( in == null )\n+            {\n+                if ( log.isDebugEnabled() )\n+                    log.debug(\"Failed to locate '\"+mappedURI+\"'\") ;\n+                throw new NotFoundException(\"Not found: \"+filenameOrURI) ;\n+            }\n             Lang lang2 = RDFDataMgr.determineLang(mappedURI, in.getContentType(), lang);\n             // May be overridden by model implementation.\n             model.read(in, baseURI, lang2.getName()) ;",
                "changes": 7
            },
            {
                "status": "modified",
                "additions": 16,
                "raw_url": "https://github.com/apache/jena/raw/643bd7a944e23554d21d1f01c207fe7e1a3d3098/jena-arq/src/test/java/org/apache/jena/riot/adapters/TestFileManager.java",
                "contents_url": "https://api.github.com/repos/apache/jena/contents/jena-arq/src/test/java/org/apache/jena/riot/adapters/TestFileManager.java?ref=643bd7a944e23554d21d1f01c207fe7e1a3d3098",
                "filename": "jena-arq/src/test/java/org/apache/jena/riot/adapters/TestFileManager.java",
                "deletions": 0,
                "sha": "a0951e5ed1c97f528209613119859f17159405d4",
                "blob_url": "https://github.com/apache/jena/blob/643bd7a944e23554d21d1f01c207fe7e1a3d3098/jena-arq/src/test/java/org/apache/jena/riot/adapters/TestFileManager.java",
                "patch": "@@ -27,9 +27,11 @@\n import org.apache.jena.rdf.model.Model ;\n import org.apache.jena.rdf.model.ModelFactory ;\n import org.apache.jena.riot.stream.TestLocationMapper ;\n+import org.apache.jena.riot.system.stream.StreamManager;\n import org.apache.jena.shared.NotFoundException ;\n import org.apache.jena.util.FileManager ;\n import org.apache.jena.util.LocationMapper ;\n+import org.junit.Assert;\n import org.junit.Test ;\n import org.slf4j.Logger ;\n import org.slf4j.LoggerFactory ;\n@@ -71,6 +73,20 @@\n         } catch (NotFoundException ex) {}\n     }\n     \n+    @Test(expected = NotFoundException.class)\n+    public void testFileManagerNoFile2() {\n+        FileManager fileManager = new FileManager() ;\n+        fileManager.addLocatorFile() ;\n+        fileManager.readModel(ModelFactory.createDefaultModel(), filenameNonExistent);\n+    }\n+    \n+    @Test(expected = NotFoundException.class)\n+    public void testFileManagerNoFile3() {\n+        FileManager fileManager = new AdapterFileManager(new StreamManager(), new org.apache.jena.riot.system.stream.LocationMapper()) ;\n+        fileManager.addLocatorFile() ;\n+        fileManager.readModel(ModelFactory.createDefaultModel(), filenameNonExistent);\n+    }\n+    \n     @Test public void testFileManagerLocatorClassLoader() {\n         FileManager fileManager = new FileManager() ;\n         fileManager.addLocatorClassLoader(fileManager.getClass().getClassLoader()) ;",
                "changes": 16
            }
        ],
        "unit_tests": [
            "TestFileManager.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "jena-arq/src/test/java/org/apache/jena/riot/adapters/TestFileManager.java",
        "buggy_files": [
            "jena-core/src/main/java/org/apache/jena/util/FileManager.java",
            "jena-arq/src/main/java/org/apache/jena/riot/adapters/AdapterFileManager.java"
        ],
        "fixed": true
    }
]