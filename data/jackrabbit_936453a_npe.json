[
    {
        "repo": "jackrabbit",
        "commit": "https://github.com/apache/jackrabbit/commit/936453a1287000626f6074db6ad0537ece561d9c",
        "bug_id": "jackrabbit_936453a",
        "message": "JCR-3337 Negated descendant node query with no results throws NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/jackrabbit/trunk@1352053 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jackrabbit/commit/ac674fe9a3f293f97ecc194a5ec280b389290382",
        "patched_files": [
            "NotQuery.java",
            "ChildAxisQuery.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 8,
                "raw_url": "https://github.com/apache/jackrabbit/raw/936453a1287000626f6074db6ad0537ece561d9c/jackrabbit-core/src/main/java/org/apache/jackrabbit/core/query/lucene/NotQuery.java",
                "contents_url": "https://api.github.com/repos/apache/jackrabbit/contents/jackrabbit-core/src/main/java/org/apache/jackrabbit/core/query/lucene/NotQuery.java?ref=936453a1287000626f6074db6ad0537ece561d9c",
                "filename": "jackrabbit-core/src/main/java/org/apache/jackrabbit/core/query/lucene/NotQuery.java",
                "deletions": 0,
                "sha": "610c3b9494b14cbf68b467e862eb03476255db49",
                "blob_url": "https://github.com/apache/jackrabbit/blob/936453a1287000626f6074db6ad0537ece561d9c/jackrabbit-core/src/main/java/org/apache/jackrabbit/core/query/lucene/NotQuery.java",
                "patch": "@@ -185,6 +185,10 @@ public int nextDoc() throws IOException {\n             if (docNo == NO_MORE_DOCS) {\n                 return docNo;\n             }\n+            if (contextScorer == null) {\n+                docNo = NO_MORE_DOCS;\n+                return docNo;\n+            }\n \n             if (docNo == -1) {\n                 // get first doc of context scorer\n@@ -225,6 +229,10 @@ public int advance(int target) throws IOException {\n             if (docNo == NO_MORE_DOCS) {\n                 return docNo;\n             }\n+            if (contextScorer == null) {\n+                docNo = NO_MORE_DOCS;\n+                return docNo;\n+            }\n \n             // optimize in the case of an advance to finish.\n             // see https://issues.apache.org/jira/browse/JCR-3091",
                "changes": 8
            },
            {
                "status": "modified",
                "additions": 12,
                "raw_url": "https://github.com/apache/jackrabbit/raw/936453a1287000626f6074db6ad0537ece561d9c/jackrabbit-core/src/test/java/org/apache/jackrabbit/core/query/ChildAxisQueryTest.java",
                "contents_url": "https://api.github.com/repos/apache/jackrabbit/contents/jackrabbit-core/src/test/java/org/apache/jackrabbit/core/query/ChildAxisQueryTest.java?ref=936453a1287000626f6074db6ad0537ece561d9c",
                "filename": "jackrabbit-core/src/test/java/org/apache/jackrabbit/core/query/ChildAxisQueryTest.java",
                "deletions": 0,
                "sha": "31b1d560beaca24b8a6249255f91ceada7a33726",
                "blob_url": "https://github.com/apache/jackrabbit/blob/936453a1287000626f6074db6ad0537ece561d9c/jackrabbit-core/src/test/java/org/apache/jackrabbit/core/query/ChildAxisQueryTest.java",
                "patch": "@@ -243,4 +243,16 @@ public void testSimpleQuery() throws Exception {\n         executeSQLQuery(sql, new Node[] {foo});\n     }\n \n+    /**\n+     * JCR-3337\n+     */\n+    public void testNotIsDescendantNodeQuery() throws Exception {\n+        Node foo = testRootNode.addNode(\"foo\");\n+        testRootNode.getSession().save();\n+        String sql = \"SELECT a.* FROM [nt:base] as a WHERE isdescendantnode(a,'\"\n+                + testRootNode.getPath()\n+                + \"') and not isdescendantnode(a,'\"\n+                + foo.getPath() + \"')\";\n+        executeSQL2Query(sql, new Node[] {});\n+    }\n }",
                "changes": 12
            }
        ],
        "unit_tests": [
            "ChildAxisQueryTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "jackrabbit-core/src/test/java/org/apache/jackrabbit/core/query/ChildAxisQueryTest.java",
        "buggy_files": [
            "jackrabbit-core/src/main/java/org/apache/jackrabbit/core/query/lucene/NotQuery.java",
            "jackrabbit-core/src/main/java/org/apache/jackrabbit/core/query/lucene/ChildAxisQuery.java"
        ],
        "fixed": true
    }
]