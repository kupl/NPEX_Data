{
    "cayenne_5692a6a": {
        "bug_id": "cayenne_5692a6a",
        "commit": "https://github.com/apache/cayenne/commit/5692a6a7ddbc27600f67d2442183d14e6ed637d6",
        "file": [
            {
                "additions": 13,
                "blob_url": "https://github.com/apache/cayenne/blob/5692a6a7ddbc27600f67d2442183d14e6ed637d6/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/tools/DbGeneratorTask.java",
                "changes": 19,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/tools/DbGeneratorTask.java?ref=5692a6a7ddbc27600f67d2442183d14e6ed637d6",
                "deletions": 6,
                "filename": "framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/tools/DbGeneratorTask.java",
                "patch": "@@ -30,6 +30,7 @@\n import org.apache.tools.ant.Project;\n import org.xml.sax.InputSource;\n \n+\n import java.io.File;\n import java.sql.Driver;\n \n@@ -41,7 +42,7 @@\n  */\n // TODO: support classpath attribute for loading the driver\n public class DbGeneratorTask extends CayenneTask {\n-\n+    \n     protected DbAdapter adapter;\n     protected File map;\n     protected String driver;\n@@ -64,14 +65,14 @@ public void execute() {\n         if (adapter == null) {\n             adapter = new JdbcAdapter();\n         }\n-\n+        \n         log(String.format(\"connection settings - [driver: %s, url: %s, username: %s]\", driver, url, userName), Project.MSG_VERBOSE);\n \n         log(String.format(\"generator options - [dropTables: %s, dropPK: %s, createTables: %s, createPK: %s, createFK: %s]\",\n                 dropTables, dropPK, createTables, createPK, createFK), Project.MSG_VERBOSE);\n \n         validateAttributes();\n-\n+        \n         try {\n \n             // Load the data map and run the db generator.\n@@ -168,15 +169,21 @@ public void setMap(File map) {\n      * @param adapter The db adapter to set.\n      */\n     public void setAdapter(String adapter) {\n-\n+        ClassLoader loader = null;\n         if (adapter != null) {\n             // Try to create an instance of the DB adapter.\n             try {\n-                Class<?> c = Class.forName(adapter);\n+                loader = Thread.currentThread().getContextClassLoader();\n+                Thread.currentThread().setContextClassLoader(DbGeneratorTask.class.getClassLoader());\n+\n+                Class<?> c = Util.getJavaClass(adapter);\n                 this.adapter = (DbAdapter) c.newInstance();\n             }\n             catch (Exception e) {\n-                throw new BuildException(\"Can't load DbAdapter: \" + adapter);\n+                throw new BuildException(\"Can't load DbAdapter: \" + adapter,e);\n+            }\n+            finally{\n+                Thread.currentThread().setContextClassLoader(loader);\n             }\n         }\n     }",
                "raw_url": "https://github.com/apache/cayenne/raw/5692a6a7ddbc27600f67d2442183d14e6ed637d6/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/tools/DbGeneratorTask.java",
                "sha": "81908f7689815615b0be7a97bbfafc09b8415310",
                "status": "modified"
            }
        ],
        "message": "CAY-1170 cdbgen task fails due to NPE when instantiating TypesHandler\n\na patch by Dima Loiko that addresses cdbgen classloader issues\ncan't yet reproduce the problem the way the user described it\n\ngit-svn-id: https://svn.apache.org/repos/asf/cayenne/main/trunk@743287 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/cayenne/commit/ff59c130e2565f6a480d5461462fac4d4d30b543",
        "repo": "cayenne",
        "unit_tests": [
            "DbGeneratorTaskTest.java"
        ]
    },
    "cayenne_876f16d": {
        "bug_id": "cayenne_876f16d",
        "commit": "https://github.com/apache/cayenne/commit/876f16d40cfaa04fad57ac42b26d0ecee0dacaa8",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/cayenne/blob/876f16d40cfaa04fad57ac42b26d0ecee0dacaa8/docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/docs/doc/src/main/resources/RELEASE-NOTES.txt?ref=876f16d40cfaa04fad57ac42b26d0ecee0dacaa8",
                "deletions": 0,
                "filename": "docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "patch": "@@ -29,6 +29,7 @@ Bug Fixes Since 3.1M3:\n CAY-1477 Modeler: Better validation for erroneous horizontal inheritance mapping\n CAY-1513 Deadlock in PoolManager\n CAY-1623 [PATCH] PersistentObjectList.setValue does not work\n+CAY-1624 [PATCH] PersistentObjectHolder throws NPE is object is transient - not in an ObjectContext\n CAY-1627 CayenneModeler: collection types for to-many relationships are not saved\n CAY-1628 ClassCastException when using java.util.Set or java.util.Map as collection type for to-many relationship\n CAY-1631 Oracle - passing blobs as stored procedure parameters",
                "raw_url": "https://github.com/apache/cayenne/raw/876f16d40cfaa04fad57ac42b26d0ecee0dacaa8/docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "sha": "2de815dc20ff6e27839fdfa490f7664a54ba3c23",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/cayenne/blob/876f16d40cfaa04fad57ac42b26d0ecee0dacaa8/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/util/PersistentObjectHolder.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/util/PersistentObjectHolder.java?ref=876f16d40cfaa04fad57ac42b26d0ecee0dacaa8",
                "deletions": 1,
                "filename": "framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/util/PersistentObjectHolder.java",
                "patch": "@@ -86,7 +86,7 @@ public synchronized Object setValue(Object value) throws CayenneRuntimeException\n         }\n \n         Object oldValue = setValueDirectly(value);\n-        if (oldValue != value) {\n+        if (oldValue != value && relationshipOwner.getObjectContext() != null) {\n             relationshipOwner.getObjectContext().propertyChanged(relationshipOwner, relationshipName, oldValue, value);\n     \n             if (oldValue instanceof Persistent) {",
                "raw_url": "https://github.com/apache/cayenne/raw/876f16d40cfaa04fad57ac42b26d0ecee0dacaa8/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/util/PersistentObjectHolder.java",
                "sha": "078fa1eb3d03eb3e4abc3713f8f648413716db26",
                "status": "modified"
            }
        ],
        "message": "CAY-1624 [PATCH] PersistentObjectHolder throws NPE is object is transient - not in an ObjectContext\n\npatch by John Huss\n\ngit-svn-id: https://svn.apache.org/repos/asf/cayenne/main/trunk@1207109 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/cayenne/commit/b5d0c2d6862ad6f6b442049a282677a3431fd438",
        "repo": "cayenne",
        "unit_tests": [
            "PersistentObjectHolderTest.java"
        ]
    },
    "cayenne_aa75754": {
        "bug_id": "cayenne_aa75754",
        "commit": "https://github.com/apache/cayenne/commit/aa7575454f3c2851d7d3fe3fd9d393919277a71f",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/cayenne/blob/aa7575454f3c2851d7d3fe3fd9d393919277a71f/docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/docs/doc/src/main/resources/RELEASE-NOTES.txt?ref=aa7575454f3c2851d7d3fe3fd9d393919277a71f",
                "deletions": 0,
                "filename": "docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "patch": "@@ -36,6 +36,7 @@ CAY-832 enum-mapped columns improperly handled in in expressions\n CAY-835 setting meaningful pk to zero turn on autogenerated keys\n CAY-845 DataContext.localObject() object update race condition\n CAY-847 Expression NULL handling\n+CAY-852 NPE in Util.delete for read-protected directories\n \n \n ----------------------------------",
                "raw_url": "https://github.com/apache/cayenne/raw/aa7575454f3c2851d7d3fe3fd9d393919277a71f/docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "sha": "7860b1c8223fcbaf3c0ff952c0afb2db841520f5",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/cayenne/blob/aa7575454f3c2851d7d3fe3fd9d393919277a71f/framework/cayenne-jdk1.4-unpublished/src/main/java/org/apache/cayenne/util/Util.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/framework/cayenne-jdk1.4-unpublished/src/main/java/org/apache/cayenne/util/Util.java?ref=aa7575454f3c2851d7d3fe3fd9d393919277a71f",
                "deletions": 3,
                "filename": "framework/cayenne-jdk1.4-unpublished/src/main/java/org/apache/cayenne/util/Util.java",
                "patch": "@@ -201,9 +201,13 @@ public static boolean delete(String filePath, boolean recursive) {\n             return file.delete();\n \n         String[] list = file.list();\n-        for (int i = 0; i < list.length; i++) {\n-            if (!delete(filePath + File.separator + list[i], true))\n-                return false;\n+        \n+        // list can be null if directory doesn't have an 'x' permission bit set for the user\n+        if (list != null) {\n+            for (int i = 0; i < list.length; i++) {\n+                if (!delete(filePath + File.separator + list[i], true))\n+                    return false;\n+            }\n         }\n \n         return file.delete();",
                "raw_url": "https://github.com/apache/cayenne/raw/aa7575454f3c2851d7d3fe3fd9d393919277a71f/framework/cayenne-jdk1.4-unpublished/src/main/java/org/apache/cayenne/util/Util.java",
                "sha": "e42cd0e0ed570390fcb76c53777736336507863e",
                "status": "modified"
            }
        ],
        "message": "CAY-852 NPE in Util.delete for read-protected directories\n\ngit-svn-id: https://svn.apache.org/repos/asf/cayenne/main/trunk@569042 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/cayenne/commit/2bc3cad36e8459182a8f278f516441be653b3e24",
        "repo": "cayenne",
        "unit_tests": [
            "UtilTest.java"
        ]
    },
    "cayenne_f60ff78": {
        "bug_id": "cayenne_f60ff78",
        "commit": "https://github.com/apache/cayenne/commit/f60ff78dd6584ee195a11a091d5e41020b349408",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/cayenne/blob/f60ff78dd6584ee195a11a091d5e41020b349408/docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/docs/doc/src/main/resources/RELEASE-NOTES.txt?ref=f60ff78dd6584ee195a11a091d5e41020b349408",
                "deletions": 0,
                "filename": "docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "patch": "@@ -42,6 +42,7 @@ CAY-1155 Modeler template for SQLServer driver has a typo in the driver name\n CAY-1157 Modeler: Concurrent mod exception on removing DbRelationship\n CAY-1160 Default delete rule is not used when migrating schema (to model)\n CAY-1166 Type checking in the modeler\n+CAY-1170 cdbgen task fails due to NPE when instantiating TypesHandler\n CAY-1176 missing classes in ROP cayenne-client render nested contexts unusable\n CAY-1180 Model marked as dirty when leaving DataMap name field\n CAY-1183 commitToParent() makes object persistence state committed, produces exception when using object in parent context (ROP)",
                "raw_url": "https://github.com/apache/cayenne/raw/f60ff78dd6584ee195a11a091d5e41020b349408/docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "sha": "8236725d345d3781938fda3cf5ccc4e66b6ea1f7",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/cayenne/blob/f60ff78dd6584ee195a11a091d5e41020b349408/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/tools/DbGeneratorTask.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/tools/DbGeneratorTask.java?ref=f60ff78dd6584ee195a11a091d5e41020b349408",
                "deletions": 0,
                "filename": "framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/tools/DbGeneratorTask.java",
                "patch": "@@ -73,7 +73,10 @@ public void execute() {\n \n         validateAttributes();\n         \n+        ClassLoader loader = null;\n         try {\n+            loader = Thread.currentThread().getContextClassLoader();\n+            Thread.currentThread().setContextClassLoader(DbGeneratorTask.class.getClassLoader());\n \n             // Load the data map and run the db generator.\n             DataMap dataMap = loadDataMap();\n@@ -102,6 +105,9 @@ public void execute() {\n             super.log(message);\n             throw new BuildException(message, th);\n         }\n+        finally{\n+            Thread.currentThread().setContextClassLoader(loader);\n+        }\n     }\n \n     /**",
                "raw_url": "https://github.com/apache/cayenne/raw/f60ff78dd6584ee195a11a091d5e41020b349408/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/tools/DbGeneratorTask.java",
                "sha": "2e29f5af7d9558f62a316502d66dbc9fc416968a",
                "status": "modified"
            }
        ],
        "message": "CAY-1170 cdbgen task fails due to NPE when instantiating TypesHandler\n\npatch by Dima Loiko. Issue fixed\n\ngit-svn-id: https://svn.apache.org/repos/asf/cayenne/main/trunk@760797 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/cayenne/commit/5274ab1f1a2dad090e5fa68ab9805f98160e663f",
        "repo": "cayenne",
        "unit_tests": [
            "DbGeneratorTaskTest.java"
        ]
    },
    "cayenne_ff70edc": {
        "bug_id": "cayenne_ff70edc",
        "commit": "https://github.com/apache/cayenne/commit/ff70edcb491d94589c91c1c2d384c482e624e214",
        "file": [
            {
                "additions": 60,
                "blob_url": "https://github.com/apache/cayenne/blob/ff70edcb491d94589c91c1c2d384c482e624e214/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/BaseContext.java",
                "changes": 62,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/BaseContext.java?ref=ff70edcb491d94589c91c1c2d384c482e624e214",
                "deletions": 2,
                "filename": "framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/BaseContext.java",
                "patch": "@@ -18,6 +18,7 @@\n  ****************************************************************/\n package org.apache.cayenne;\n \n+import java.util.ArrayList;\n import java.util.Collection;\n import java.util.List;\n \n@@ -26,6 +27,11 @@\n import org.apache.cayenne.query.ObjectIdQuery;\n import org.apache.cayenne.query.Query;\n import org.apache.cayenne.reflect.Property;\n+import org.apache.cayenne.reflect.ClassDescriptor;\n+import org.apache.cayenne.reflect.PropertyVisitor;\n+import org.apache.cayenne.reflect.AttributeProperty;\n+import org.apache.cayenne.reflect.ToOneProperty;\n+import org.apache.cayenne.reflect.ToManyProperty;\n \n /**\n  * A common base superclass for Cayenne ObjectContext implementors.\n@@ -115,8 +121,60 @@ else if (objects.size() > 1) {\n \n         // resolve relationship fault\n         if (lazyFaulting && property != null) {\n-            Property propertyDescriptor = getEntityResolver().getClassDescriptor(\n-                    object.getObjectId().getEntityName()).getProperty(property);\n+            ClassDescriptor classDescriptor = getEntityResolver().getClassDescriptor(\n+                    object.getObjectId().getEntityName());\n+            Property propertyDescriptor = classDescriptor.getProperty(property);\n+\n+            // If we don't have a property descriptor, there's not much we can do.\n+            // Let the caller know that the specified property could not be found and list\n+            // all of the properties that could be so the caller knows what can be used.\n+            if (propertyDescriptor == null) {\n+                final StringBuilder errorMessage = new StringBuilder();\n+\n+                errorMessage.append(String.format(\"Property '%s' is not declared for entity '%s'.\",\n+                        property, object.getObjectId().getEntityName()));\n+                \n+                errorMessage.append(\" Declared properties are: \");\n+\n+                // Grab each of the declared properties.\n+                final List<String> properties = new ArrayList<String>();\n+                classDescriptor.visitProperties(new PropertyVisitor() {\n+                    public boolean visitAttribute(final AttributeProperty property) {\n+                        properties.add(property.getName());\n+\n+                        return true;\n+                    }\n+\n+                    public boolean visitToOne(final ToOneProperty property) {\n+                        properties.add(property.getName());\n+\n+                        return true;\n+                    }\n+\n+                    public boolean visitToMany(final ToManyProperty property) {\n+                        properties.add(property.getName());\n+\n+                        return true;\n+                    }\n+                });\n+\n+                // Now add the declared property names to the error message.\n+                boolean first = true;\n+                for (String declaredProperty : properties) {\n+                    if (first) {\n+                        errorMessage.append(String.format(\"'%s'\", declaredProperty));\n+\n+                        first = false;\n+                    }\n+                    else {\n+                        errorMessage.append(String.format(\", '%s'\", declaredProperty));\n+                    }\n+                }\n+\n+                errorMessage.append(\".\");\n+\n+                throw new CayenneRuntimeException(errorMessage.toString());\n+            }\n \n             // this should trigger fault resolving\n             propertyDescriptor.readProperty(object);",
                "raw_url": "https://github.com/apache/cayenne/raw/ff70edcb491d94589c91c1c2d384c482e624e214/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/BaseContext.java",
                "sha": "975c4d35cc4b162b22c2a05b22cf0dda45f6b639",
                "status": "modified"
            }
        ],
        "message": "Better error message on NPE.\n\ngit-svn-id: https://svn.apache.org/repos/asf/cayenne/main/trunk@619169 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/cayenne/commit/b5bc20be375487eebab8f201e71dfa0e3f2b4753",
        "repo": "cayenne",
        "unit_tests": [
            "BaseContextTest.java"
        ]
    }
}