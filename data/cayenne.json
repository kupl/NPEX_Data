{
    "cayenne_5692a6a": {
        "bug_id": "cayenne_5692a6a",
        "commit": "https://github.com/apache/cayenne/commit/5692a6a7ddbc27600f67d2442183d14e6ed637d6",
        "file": [
            {
                "additions": 13,
                "blob_url": "https://github.com/apache/cayenne/blob/5692a6a7ddbc27600f67d2442183d14e6ed637d6/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/tools/DbGeneratorTask.java",
                "changes": 19,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/tools/DbGeneratorTask.java?ref=5692a6a7ddbc27600f67d2442183d14e6ed637d6",
                "deletions": 6,
                "filename": "framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/tools/DbGeneratorTask.java",
                "patch": "@@ -30,6 +30,7 @@\n import org.apache.tools.ant.Project;\n import org.xml.sax.InputSource;\n \n+\n import java.io.File;\n import java.sql.Driver;\n \n@@ -41,7 +42,7 @@\n  */\n // TODO: support classpath attribute for loading the driver\n public class DbGeneratorTask extends CayenneTask {\n-\n+    \n     protected DbAdapter adapter;\n     protected File map;\n     protected String driver;\n@@ -64,14 +65,14 @@ public void execute() {\n         if (adapter == null) {\n             adapter = new JdbcAdapter();\n         }\n-\n+        \n         log(String.format(\"connection settings - [driver: %s, url: %s, username: %s]\", driver, url, userName), Project.MSG_VERBOSE);\n \n         log(String.format(\"generator options - [dropTables: %s, dropPK: %s, createTables: %s, createPK: %s, createFK: %s]\",\n                 dropTables, dropPK, createTables, createPK, createFK), Project.MSG_VERBOSE);\n \n         validateAttributes();\n-\n+        \n         try {\n \n             // Load the data map and run the db generator.\n@@ -168,15 +169,21 @@ public void setMap(File map) {\n      * @param adapter The db adapter to set.\n      */\n     public void setAdapter(String adapter) {\n-\n+        ClassLoader loader = null;\n         if (adapter != null) {\n             // Try to create an instance of the DB adapter.\n             try {\n-                Class<?> c = Class.forName(adapter);\n+                loader = Thread.currentThread().getContextClassLoader();\n+                Thread.currentThread().setContextClassLoader(DbGeneratorTask.class.getClassLoader());\n+\n+                Class<?> c = Util.getJavaClass(adapter);\n                 this.adapter = (DbAdapter) c.newInstance();\n             }\n             catch (Exception e) {\n-                throw new BuildException(\"Can't load DbAdapter: \" + adapter);\n+                throw new BuildException(\"Can't load DbAdapter: \" + adapter,e);\n+            }\n+            finally{\n+                Thread.currentThread().setContextClassLoader(loader);\n             }\n         }\n     }",
                "raw_url": "https://github.com/apache/cayenne/raw/5692a6a7ddbc27600f67d2442183d14e6ed637d6/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/tools/DbGeneratorTask.java",
                "sha": "81908f7689815615b0be7a97bbfafc09b8415310",
                "status": "modified"
            }
        ],
        "message": "CAY-1170 cdbgen task fails due to NPE when instantiating TypesHandler\n\na patch by Dima Loiko that addresses cdbgen classloader issues\ncan't yet reproduce the problem the way the user described it\n\ngit-svn-id: https://svn.apache.org/repos/asf/cayenne/main/trunk@743287 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/cayenne/commit/ff59c130e2565f6a480d5461462fac4d4d30b543",
        "repo": "cayenne",
        "unit_tests": [
            "DbGeneratorTaskTest.java"
        ]
    },
    "cayenne_65ebda9": {
        "bug_id": "cayenne_65ebda9",
        "commit": "https://github.com/apache/cayenne/commit/65ebda996b5dff7b9887a45fc1d5c5759192f8e3",
        "file": [
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/cayenne/blob/65ebda996b5dff7b9887a45fc1d5c5759192f8e3/cayenne-server/src/main/java/org/apache/cayenne/reflect/LifecycleCallbackEventHandler.java",
                "changes": 16,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/cayenne-server/src/main/java/org/apache/cayenne/reflect/LifecycleCallbackEventHandler.java?ref=65ebda996b5dff7b9887a45fc1d5c5759192f8e3",
                "deletions": 9,
                "filename": "cayenne-server/src/main/java/org/apache/cayenne/reflect/LifecycleCallbackEventHandler.java",
                "patch": "@@ -20,7 +20,6 @@\n \n import org.apache.cayenne.Persistent;\n import org.apache.cayenne.map.EntityResolver;\n-import org.apache.cayenne.map.ObjEntity;\n \n import java.lang.reflect.Method;\n import java.util.ArrayList;\n@@ -111,21 +110,20 @@ void addListener(Class<?> entityClass, Object listener, Method method) {\n      * Registers a callback object to be invoked when a lifecycle event occurs.\n      */\n     private void addCallback(Class<?> entityClass, AbstractCallback callback) {\n-        Collection<AbstractCallback> entityListeners = listeners.get(entityClass\n-                .getName());\n-\n-        if (entityListeners == null) {\n-            entityListeners = new ArrayList<>(3);\n-            listeners.put(entityClass.getName(), entityListeners);\n-        }\n-\n+        Collection<AbstractCallback> entityListeners = listeners\n+                .computeIfAbsent(entityClass.getName(), k -> new ArrayList<>(3));\n         entityListeners.add(callback);\n     }\n \n     /**\n      * Invokes callbacks for a given entity object.\n      */\n     void performCallbacks(Persistent object) {\n+        if(object == null) {\n+            // this can happen if object resolved to null from some query with outer join\n+            // (e.g. in EJBQL or SQLTemplate)\n+            return;\n+        }\n \n         // default listeners are invoked first\n         if (!defaultListeners.isEmpty()) {",
                "raw_url": "https://github.com/apache/cayenne/raw/65ebda996b5dff7b9887a45fc1d5c5759192f8e3/cayenne-server/src/main/java/org/apache/cayenne/reflect/LifecycleCallbackEventHandler.java",
                "sha": "fd044a63408e74adb8a08578ceeaf5ecd6f50cdc",
                "status": "modified"
            },
            {
                "additions": 29,
                "blob_url": "https://github.com/apache/cayenne/blob/65ebda996b5dff7b9887a45fc1d5c5759192f8e3/cayenne-server/src/test/java/org/apache/cayenne/query/EJBQLQueryIT.java",
                "changes": 29,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/cayenne-server/src/test/java/org/apache/cayenne/query/EJBQLQueryIT.java?ref=65ebda996b5dff7b9887a45fc1d5c5759192f8e3",
                "deletions": 0,
                "filename": "cayenne-server/src/test/java/org/apache/cayenne/query/EJBQLQueryIT.java",
                "patch": "@@ -28,6 +28,8 @@\n import org.apache.cayenne.exp.Expression;\n import org.apache.cayenne.map.EJBQLQueryDescriptor;\n import org.apache.cayenne.map.EntityResolver;\n+import org.apache.cayenne.map.LifecycleEvent;\n+import org.apache.cayenne.reflect.LifecycleCallbackRegistry;\n import org.apache.cayenne.test.jdbc.DBHelper;\n import org.apache.cayenne.test.jdbc.TableHelper;\n import org.apache.cayenne.testdo.testmap.Artist;\n@@ -645,4 +647,31 @@ public void testNullObjects() throws Exception {\n         }\n     }\n \n+    @Test\n+    public void testNullObjectsCallback() throws Exception {\n+        tArtist.insert(1, \"a1\");\n+        tArtist.insert(2, \"a2\");\n+        tArtist.insert(3, \"a3\");\n+\n+        tPainting.insert(1, 2, \"title1\");\n+        tPainting.insert(2, 1, \"title2\");\n+        tPainting.insert(3, 1, \"title3\");\n+\n+        // set callback to be called\n+        LifecycleCallbackRegistry registry = runtime\n+                .getDataDomain()\n+                .getEntityResolver()\n+                .getCallbackRegistry();\n+        registry.addCallback(LifecycleEvent.POST_LOAD, Painting.class, \"postAddCallback\");\n+\n+        // select Paintings, where one of it will be null\n+        EJBQLQuery queryFullProduct = new EJBQLQuery(\"select a.paintingArray+ from Artist a order by a.artistName\");\n+        List<Painting> result1 = context.performQuery(queryFullProduct);\n+        assertEquals(4, result1.size());\n+        assertNull(result1.get(3));\n+        for(int i=0; i<3; i++) {\n+            assertNotNull(result1.get(i));\n+            assertTrue(result1.get(i).isPostAdded());\n+        }\n+    }\n }",
                "raw_url": "https://github.com/apache/cayenne/raw/65ebda996b5dff7b9887a45fc1d5c5759192f8e3/cayenne-server/src/test/java/org/apache/cayenne/query/EJBQLQueryIT.java",
                "sha": "a760f3c91468540c20f9d78ea72556a3b54b1b45",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/cayenne/blob/65ebda996b5dff7b9887a45fc1d5c5759192f8e3/docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/docs/doc/src/main/resources/RELEASE-NOTES.txt?ref=65ebda996b5dff7b9887a45fc1d5c5759192f8e3",
                "deletions": 0,
                "filename": "docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "patch": "@@ -38,6 +38,7 @@ CAY-2353 Broken paginated column select with only one entity in the result\n CAY-2354 DbGenerator.runGenerator must commit its connection\n CAY-2356 EJBQL: Incorrect COUNT() on outer joined table\n CAY-2357 Generic select queries silently convert result to nulls if no PK column found\n+CAY-2358 NPE when callbacks invoked on null objects\n \n ----------------------------------\n Release: 4.0.B1",
                "raw_url": "https://github.com/apache/cayenne/raw/65ebda996b5dff7b9887a45fc1d5c5759192f8e3/docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "sha": "d80050a6238b528a68414242fa345e9cd20142fb",
                "status": "modified"
            }
        ],
        "message": "CAY-2358 NPE when callbacks invoked on null objects",
        "parent": "https://github.com/apache/cayenne/commit/8452d41def3796502d297456043d97822665e3b3",
        "repo": "cayenne",
        "unit_tests": [
            "LifecycleCallbackEventHandlerTest.java"
        ]
    },
    "cayenne_872f231": {
        "bug_id": "cayenne_872f231",
        "commit": "https://github.com/apache/cayenne/commit/872f231a1984033771867628b1e4f660dfec2b28",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/cayenne/blob/872f231a1984033771867628b1e4f660dfec2b28/RELEASE-NOTES.txt",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/RELEASE-NOTES.txt?ref=872f231a1984033771867628b1e4f660dfec2b28",
                "deletions": 0,
                "filename": "RELEASE-NOTES.txt",
                "patch": "@@ -59,6 +59,7 @@ CAY-2425 Modeler: Migrate DB Direction field is locked if no option was selected\n CAY-2427 Modeler: Undo throws exception\n CAY-2429 Generate classes: Invalid template type: EMBEDDABLE_SINGLE_CLASS\n CAY-2430 Modeler: Redo throws NPE\n+CAY-2436 NPE in CayenneRuntimeException constructor\n \n ----------------------------------\n Release: 4.1.M1",
                "raw_url": "https://github.com/apache/cayenne/raw/872f231a1984033771867628b1e4f660dfec2b28/RELEASE-NOTES.txt",
                "sha": "3806615e348c704318fc4fc7b2500ee5c4ddfae6",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/cayenne/blob/872f231a1984033771867628b1e4f660dfec2b28/cayenne-server/src/main/java/org/apache/cayenne/CayenneRuntimeException.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/cayenne-server/src/main/java/org/apache/cayenne/CayenneRuntimeException.java?ref=872f231a1984033771867628b1e4f660dfec2b28",
                "deletions": 1,
                "filename": "cayenne-server/src/main/java/org/apache/cayenne/CayenneRuntimeException.java",
                "patch": "@@ -37,7 +37,7 @@ public CayenneRuntimeException() {\n      * conventions.\n      */\n     public CayenneRuntimeException(String messageFormat, Object... messageArgs) {\n-        super(String.format(messageFormat, messageArgs));\n+        super(messageFormat == null ? null : String.format(messageFormat, messageArgs));\n     }\n \n     /**",
                "raw_url": "https://github.com/apache/cayenne/raw/872f231a1984033771867628b1e4f660dfec2b28/cayenne-server/src/main/java/org/apache/cayenne/CayenneRuntimeException.java",
                "sha": "135b50ce2b9e6495186b1408028dca2638be2a79",
                "status": "modified"
            },
            {
                "additions": 23,
                "blob_url": "https://github.com/apache/cayenne/blob/872f231a1984033771867628b1e4f660dfec2b28/cayenne-server/src/test/java/org/apache/cayenne/CayenneRuntimeExceptionTest.java",
                "changes": 33,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/cayenne-server/src/test/java/org/apache/cayenne/CayenneRuntimeExceptionTest.java?ref=872f231a1984033771867628b1e4f660dfec2b28",
                "deletions": 10,
                "filename": "cayenne-server/src/test/java/org/apache/cayenne/CayenneRuntimeExceptionTest.java",
                "patch": "@@ -29,26 +29,24 @@\n import static org.junit.Assert.assertSame;\n import static org.junit.Assert.assertTrue;\n \n-/**\n- */\n public class CayenneRuntimeExceptionTest {\n \n     @Test\n-    public void testConstructor1() throws Exception {\n+    public void testConstructor1() {\n         CayenneRuntimeException ex = new CayenneRuntimeException();\n         assertNull(ex.getCause());\n         assertTrue(ex.getMessage().startsWith(CayenneException.getExceptionLabel()));\n     }\n \n     @Test\n-    public void testConstructor2() throws Exception {\n+    public void testConstructor2() {\n         CayenneRuntimeException ex = new CayenneRuntimeException(\"abc\");\n         assertNull(ex.getCause());\n         assertEquals(CayenneException.getExceptionLabel() + \"abc\", ex.getMessage());\n     }\n \n     @Test\n-    public void testConstructor3() throws Exception {\n+    public void testConstructor3() {\n         Throwable cause = new Throwable();\n         CayenneRuntimeException ex = new CayenneRuntimeException(cause);\n         assertSame(cause, ex.getCause());\n@@ -58,15 +56,30 @@ public void testConstructor3() throws Exception {\n     }\n \n     @Test\n-    public void testConstructor4() throws Exception {\n+    public void testConstructor4() {\n         Throwable cause = new Throwable();\n         CayenneRuntimeException ex = new CayenneRuntimeException(\"abc\", cause);\n         assertSame(cause, ex.getCause());\n         assertEquals(CayenneException.getExceptionLabel() + \"abc\", ex.getMessage());\n     }\n \n     @Test\n-    public void testThrow1() throws Exception {\n+    public void testConstructorNullMessage() {\n+        Throwable cause = new Throwable();\n+\n+        CayenneRuntimeException ex = new CayenneRuntimeException(null, cause);\n+        assertSame(cause, ex.getCause());\n+        assertEquals(CayenneException.getExceptionLabel() + \"(no message)\", ex.getMessage());\n+        assertNull(ex.getUnlabeledMessage());\n+\n+        CayenneRuntimeException ex2 = new CayenneRuntimeException((String)null);\n+        assertNull(ex2.getCause());\n+        assertEquals(CayenneException.getExceptionLabel() + \"(no message)\", ex2.getMessage());\n+        assertNull(ex2.getUnlabeledMessage());\n+    }\n+\n+    @Test\n+    public void testThrow1() {\n         try {\n             throw new CayenneRuntimeException();\n         }\n@@ -77,7 +90,7 @@ public void testThrow1() throws Exception {\n     }\n \n     @Test\n-    public void testThrow2() throws Exception {\n+    public void testThrow2() {\n         try {\n             try {\n                 throw new Throwable(\"Test Cause\");\n@@ -93,13 +106,13 @@ public void testThrow2() throws Exception {\n     }\n \n     @Test\n-    public void testMessageFormatting1() throws Exception {\n+    public void testMessageFormatting1() {\n         CayenneRuntimeException ex = new CayenneRuntimeException(\"x%sx%sx\", \"a\", \"b\");\n         assertEquals(\"xaxbx\", ex.getUnlabeledMessage());\n     }\n \n     @Test\n-    public void testMessageFormatting2() throws Exception {\n+    public void testMessageFormatting2() {\n         Throwable cause = new Throwable();\n         CayenneRuntimeException ex = new CayenneRuntimeException(\"x%sx%sx\", cause, \"a\", \"b\");\n         assertEquals(\"xaxbx\", ex.getUnlabeledMessage());",
                "raw_url": "https://github.com/apache/cayenne/raw/872f231a1984033771867628b1e4f660dfec2b28/cayenne-server/src/test/java/org/apache/cayenne/CayenneRuntimeExceptionTest.java",
                "sha": "0e60ecfc17b09137bfeadee488a83510a60b564e",
                "status": "modified"
            }
        ],
        "message": "CAY-2436 NPE in CayenneRuntimeException constructor",
        "parent": "https://github.com/apache/cayenne/commit/57361b635f58afe0f06c332f8f57449dd2963836",
        "repo": "cayenne",
        "unit_tests": [
            "CayenneRuntimeExceptionTest.java"
        ]
    },
    "cayenne_876f16d": {
        "bug_id": "cayenne_876f16d",
        "commit": "https://github.com/apache/cayenne/commit/876f16d40cfaa04fad57ac42b26d0ecee0dacaa8",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/cayenne/blob/876f16d40cfaa04fad57ac42b26d0ecee0dacaa8/docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/docs/doc/src/main/resources/RELEASE-NOTES.txt?ref=876f16d40cfaa04fad57ac42b26d0ecee0dacaa8",
                "deletions": 0,
                "filename": "docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "patch": "@@ -29,6 +29,7 @@ Bug Fixes Since 3.1M3:\n CAY-1477 Modeler: Better validation for erroneous horizontal inheritance mapping\n CAY-1513 Deadlock in PoolManager\n CAY-1623 [PATCH] PersistentObjectList.setValue does not work\n+CAY-1624 [PATCH] PersistentObjectHolder throws NPE is object is transient - not in an ObjectContext\n CAY-1627 CayenneModeler: collection types for to-many relationships are not saved\n CAY-1628 ClassCastException when using java.util.Set or java.util.Map as collection type for to-many relationship\n CAY-1631 Oracle - passing blobs as stored procedure parameters",
                "raw_url": "https://github.com/apache/cayenne/raw/876f16d40cfaa04fad57ac42b26d0ecee0dacaa8/docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "sha": "2de815dc20ff6e27839fdfa490f7664a54ba3c23",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/cayenne/blob/876f16d40cfaa04fad57ac42b26d0ecee0dacaa8/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/util/PersistentObjectHolder.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/util/PersistentObjectHolder.java?ref=876f16d40cfaa04fad57ac42b26d0ecee0dacaa8",
                "deletions": 1,
                "filename": "framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/util/PersistentObjectHolder.java",
                "patch": "@@ -86,7 +86,7 @@ public synchronized Object setValue(Object value) throws CayenneRuntimeException\n         }\n \n         Object oldValue = setValueDirectly(value);\n-        if (oldValue != value) {\n+        if (oldValue != value && relationshipOwner.getObjectContext() != null) {\n             relationshipOwner.getObjectContext().propertyChanged(relationshipOwner, relationshipName, oldValue, value);\n     \n             if (oldValue instanceof Persistent) {",
                "raw_url": "https://github.com/apache/cayenne/raw/876f16d40cfaa04fad57ac42b26d0ecee0dacaa8/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/util/PersistentObjectHolder.java",
                "sha": "078fa1eb3d03eb3e4abc3713f8f648413716db26",
                "status": "modified"
            }
        ],
        "message": "CAY-1624 [PATCH] PersistentObjectHolder throws NPE is object is transient - not in an ObjectContext\n\npatch by John Huss\n\ngit-svn-id: https://svn.apache.org/repos/asf/cayenne/main/trunk@1207109 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/cayenne/commit/b5d0c2d6862ad6f6b442049a282677a3431fd438",
        "repo": "cayenne",
        "unit_tests": [
            "PersistentObjectHolderTest.java"
        ]
    },
    "cayenne_aa75754": {
        "bug_id": "cayenne_aa75754",
        "commit": "https://github.com/apache/cayenne/commit/aa7575454f3c2851d7d3fe3fd9d393919277a71f",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/cayenne/blob/aa7575454f3c2851d7d3fe3fd9d393919277a71f/docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/docs/doc/src/main/resources/RELEASE-NOTES.txt?ref=aa7575454f3c2851d7d3fe3fd9d393919277a71f",
                "deletions": 0,
                "filename": "docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "patch": "@@ -36,6 +36,7 @@ CAY-832 enum-mapped columns improperly handled in in expressions\n CAY-835 setting meaningful pk to zero turn on autogenerated keys\n CAY-845 DataContext.localObject() object update race condition\n CAY-847 Expression NULL handling\n+CAY-852 NPE in Util.delete for read-protected directories\n \n \n ----------------------------------",
                "raw_url": "https://github.com/apache/cayenne/raw/aa7575454f3c2851d7d3fe3fd9d393919277a71f/docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "sha": "7860b1c8223fcbaf3c0ff952c0afb2db841520f5",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/cayenne/blob/aa7575454f3c2851d7d3fe3fd9d393919277a71f/framework/cayenne-jdk1.4-unpublished/src/main/java/org/apache/cayenne/util/Util.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/framework/cayenne-jdk1.4-unpublished/src/main/java/org/apache/cayenne/util/Util.java?ref=aa7575454f3c2851d7d3fe3fd9d393919277a71f",
                "deletions": 3,
                "filename": "framework/cayenne-jdk1.4-unpublished/src/main/java/org/apache/cayenne/util/Util.java",
                "patch": "@@ -201,9 +201,13 @@ public static boolean delete(String filePath, boolean recursive) {\n             return file.delete();\n \n         String[] list = file.list();\n-        for (int i = 0; i < list.length; i++) {\n-            if (!delete(filePath + File.separator + list[i], true))\n-                return false;\n+        \n+        // list can be null if directory doesn't have an 'x' permission bit set for the user\n+        if (list != null) {\n+            for (int i = 0; i < list.length; i++) {\n+                if (!delete(filePath + File.separator + list[i], true))\n+                    return false;\n+            }\n         }\n \n         return file.delete();",
                "raw_url": "https://github.com/apache/cayenne/raw/aa7575454f3c2851d7d3fe3fd9d393919277a71f/framework/cayenne-jdk1.4-unpublished/src/main/java/org/apache/cayenne/util/Util.java",
                "sha": "e42cd0e0ed570390fcb76c53777736336507863e",
                "status": "modified"
            }
        ],
        "message": "CAY-852 NPE in Util.delete for read-protected directories\n\ngit-svn-id: https://svn.apache.org/repos/asf/cayenne/main/trunk@569042 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/cayenne/commit/2bc3cad36e8459182a8f278f516441be653b3e24",
        "repo": "cayenne",
        "unit_tests": [
            "UtilTest.java"
        ]
    },
    "cayenne_f60ff78": {
        "bug_id": "cayenne_f60ff78",
        "commit": "https://github.com/apache/cayenne/commit/f60ff78dd6584ee195a11a091d5e41020b349408",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/cayenne/blob/f60ff78dd6584ee195a11a091d5e41020b349408/docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/docs/doc/src/main/resources/RELEASE-NOTES.txt?ref=f60ff78dd6584ee195a11a091d5e41020b349408",
                "deletions": 0,
                "filename": "docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "patch": "@@ -42,6 +42,7 @@ CAY-1155 Modeler template for SQLServer driver has a typo in the driver name\n CAY-1157 Modeler: Concurrent mod exception on removing DbRelationship\n CAY-1160 Default delete rule is not used when migrating schema (to model)\n CAY-1166 Type checking in the modeler\n+CAY-1170 cdbgen task fails due to NPE when instantiating TypesHandler\n CAY-1176 missing classes in ROP cayenne-client render nested contexts unusable\n CAY-1180 Model marked as dirty when leaving DataMap name field\n CAY-1183 commitToParent() makes object persistence state committed, produces exception when using object in parent context (ROP)",
                "raw_url": "https://github.com/apache/cayenne/raw/f60ff78dd6584ee195a11a091d5e41020b349408/docs/doc/src/main/resources/RELEASE-NOTES.txt",
                "sha": "8236725d345d3781938fda3cf5ccc4e66b6ea1f7",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/cayenne/blob/f60ff78dd6584ee195a11a091d5e41020b349408/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/tools/DbGeneratorTask.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/tools/DbGeneratorTask.java?ref=f60ff78dd6584ee195a11a091d5e41020b349408",
                "deletions": 0,
                "filename": "framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/tools/DbGeneratorTask.java",
                "patch": "@@ -73,7 +73,10 @@ public void execute() {\n \n         validateAttributes();\n         \n+        ClassLoader loader = null;\n         try {\n+            loader = Thread.currentThread().getContextClassLoader();\n+            Thread.currentThread().setContextClassLoader(DbGeneratorTask.class.getClassLoader());\n \n             // Load the data map and run the db generator.\n             DataMap dataMap = loadDataMap();\n@@ -102,6 +105,9 @@ public void execute() {\n             super.log(message);\n             throw new BuildException(message, th);\n         }\n+        finally{\n+            Thread.currentThread().setContextClassLoader(loader);\n+        }\n     }\n \n     /**",
                "raw_url": "https://github.com/apache/cayenne/raw/f60ff78dd6584ee195a11a091d5e41020b349408/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/tools/DbGeneratorTask.java",
                "sha": "2e29f5af7d9558f62a316502d66dbc9fc416968a",
                "status": "modified"
            }
        ],
        "message": "CAY-1170 cdbgen task fails due to NPE when instantiating TypesHandler\n\npatch by Dima Loiko. Issue fixed\n\ngit-svn-id: https://svn.apache.org/repos/asf/cayenne/main/trunk@760797 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/cayenne/commit/5274ab1f1a2dad090e5fa68ab9805f98160e663f",
        "repo": "cayenne",
        "unit_tests": [
            "DbGeneratorTaskTest.java"
        ]
    },
    "cayenne_ff70edc": {
        "bug_id": "cayenne_ff70edc",
        "commit": "https://github.com/apache/cayenne/commit/ff70edcb491d94589c91c1c2d384c482e624e214",
        "file": [
            {
                "additions": 60,
                "blob_url": "https://github.com/apache/cayenne/blob/ff70edcb491d94589c91c1c2d384c482e624e214/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/BaseContext.java",
                "changes": 62,
                "contents_url": "https://api.github.com/repos/apache/cayenne/contents/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/BaseContext.java?ref=ff70edcb491d94589c91c1c2d384c482e624e214",
                "deletions": 2,
                "filename": "framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/BaseContext.java",
                "patch": "@@ -18,6 +18,7 @@\n  ****************************************************************/\n package org.apache.cayenne;\n \n+import java.util.ArrayList;\n import java.util.Collection;\n import java.util.List;\n \n@@ -26,6 +27,11 @@\n import org.apache.cayenne.query.ObjectIdQuery;\n import org.apache.cayenne.query.Query;\n import org.apache.cayenne.reflect.Property;\n+import org.apache.cayenne.reflect.ClassDescriptor;\n+import org.apache.cayenne.reflect.PropertyVisitor;\n+import org.apache.cayenne.reflect.AttributeProperty;\n+import org.apache.cayenne.reflect.ToOneProperty;\n+import org.apache.cayenne.reflect.ToManyProperty;\n \n /**\n  * A common base superclass for Cayenne ObjectContext implementors.\n@@ -115,8 +121,60 @@ else if (objects.size() > 1) {\n \n         // resolve relationship fault\n         if (lazyFaulting && property != null) {\n-            Property propertyDescriptor = getEntityResolver().getClassDescriptor(\n-                    object.getObjectId().getEntityName()).getProperty(property);\n+            ClassDescriptor classDescriptor = getEntityResolver().getClassDescriptor(\n+                    object.getObjectId().getEntityName());\n+            Property propertyDescriptor = classDescriptor.getProperty(property);\n+\n+            // If we don't have a property descriptor, there's not much we can do.\n+            // Let the caller know that the specified property could not be found and list\n+            // all of the properties that could be so the caller knows what can be used.\n+            if (propertyDescriptor == null) {\n+                final StringBuilder errorMessage = new StringBuilder();\n+\n+                errorMessage.append(String.format(\"Property '%s' is not declared for entity '%s'.\",\n+                        property, object.getObjectId().getEntityName()));\n+                \n+                errorMessage.append(\" Declared properties are: \");\n+\n+                // Grab each of the declared properties.\n+                final List<String> properties = new ArrayList<String>();\n+                classDescriptor.visitProperties(new PropertyVisitor() {\n+                    public boolean visitAttribute(final AttributeProperty property) {\n+                        properties.add(property.getName());\n+\n+                        return true;\n+                    }\n+\n+                    public boolean visitToOne(final ToOneProperty property) {\n+                        properties.add(property.getName());\n+\n+                        return true;\n+                    }\n+\n+                    public boolean visitToMany(final ToManyProperty property) {\n+                        properties.add(property.getName());\n+\n+                        return true;\n+                    }\n+                });\n+\n+                // Now add the declared property names to the error message.\n+                boolean first = true;\n+                for (String declaredProperty : properties) {\n+                    if (first) {\n+                        errorMessage.append(String.format(\"'%s'\", declaredProperty));\n+\n+                        first = false;\n+                    }\n+                    else {\n+                        errorMessage.append(String.format(\", '%s'\", declaredProperty));\n+                    }\n+                }\n+\n+                errorMessage.append(\".\");\n+\n+                throw new CayenneRuntimeException(errorMessage.toString());\n+            }\n \n             // this should trigger fault resolving\n             propertyDescriptor.readProperty(object);",
                "raw_url": "https://github.com/apache/cayenne/raw/ff70edcb491d94589c91c1c2d384c482e624e214/framework/cayenne-jdk1.5-unpublished/src/main/java/org/apache/cayenne/BaseContext.java",
                "sha": "975c4d35cc4b162b22c2a05b22cf0dda45f6b639",
                "status": "modified"
            }
        ],
        "message": "Better error message on NPE.\n\ngit-svn-id: https://svn.apache.org/repos/asf/cayenne/main/trunk@619169 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/cayenne/commit/b5bc20be375487eebab8f201e71dfa0e3f2b4753",
        "repo": "cayenne",
        "unit_tests": [
            "BaseContextTest.java"
        ]
    }
}