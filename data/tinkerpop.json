{
    "tinkerpop_1e0c581": {
        "bug_id": "tinkerpop_1e0c581",
        "commit": "https://github.com/apache/tinkerpop/commit/1e0c581c90b67a44121f8ec7258ea171e7c0bfe7",
        "file": [
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/tinkerpop/blob/1e0c581c90b67a44121f8ec7258ea171e7c0bfe7/tinkergraph-gremlin/src/main/java/org/apache/tinkerpop/gremlin/tinkergraph/structure/TinkerGraph.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/tinkergraph-gremlin/src/main/java/org/apache/tinkerpop/gremlin/tinkergraph/structure/TinkerGraph.java?ref=1e0c581c90b67a44121f8ec7258ea171e7c0bfe7",
                "deletions": 3,
                "filename": "tinkergraph-gremlin/src/main/java/org/apache/tinkerpop/gremlin/tinkergraph/structure/TinkerGraph.java",
                "patch": "@@ -351,9 +351,14 @@ public Features features() {\n     }\n \n     private void validateHomogenousIds(final List<Object> ids) {\n-        final Class firstClass = ids.get(0).getClass();\n-        for (Object id : ids) {\n-            if (!id.getClass().equals(firstClass))\n+        final Iterator<Object> iterator = ids.iterator();\n+        Object id = iterator.next();\n+        if (id == null)\n+            throw Graph.Exceptions.idArgsMustBeEitherIdOrElement();\n+        final Class firstClass = id.getClass();\n+        while (iterator.hasNext()) {\n+            id = iterator.next();\n+            if (id == null || !id.getClass().equals(firstClass))\n                 throw Graph.Exceptions.idArgsMustBeEitherIdOrElement();\n         }\n     }",
                "raw_url": "https://github.com/apache/tinkerpop/raw/1e0c581c90b67a44121f8ec7258ea171e7c0bfe7/tinkergraph-gremlin/src/main/java/org/apache/tinkerpop/gremlin/tinkergraph/structure/TinkerGraph.java",
                "sha": "af7245ac0a959d081ebd5674b49b76f69b5ed3e2",
                "status": "modified"
            }
        ],
        "message": "Removed potential for NPEs when validating IDs given to vertices()/edges()",
        "parent": "https://github.com/apache/tinkerpop/commit/099e6bc62468516974a3e76531d00444dbe89edc",
        "repo": "tinkerpop",
        "unit_tests": [
            "TinkerGraphTest.java"
        ]
    },
    "tinkerpop_1f0df4a": {
        "bug_id": "tinkerpop_1f0df4a",
        "commit": "https://github.com/apache/tinkerpop/commit/1f0df4a449fd0cf363e9e47e3864be4f3d845ad8",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tinkerpop/blob/1f0df4a449fd0cf363e9e47e3864be4f3d845ad8/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/structure/util/GraphFactory.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/structure/util/GraphFactory.java?ref=1f0df4a449fd0cf363e9e47e3864be4f3d845ad8",
                "deletions": 1,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/structure/util/GraphFactory.java",
                "patch": "@@ -116,7 +116,9 @@ private static Configuration getConfiguration(final File configurationFile) {\n             switch (fileExtension) {\n                 case \"yml\":\n                 case \"yaml\":\n-                    return new YamlConfiguration(configurationFile);\n+                    final YamlConfiguration config = new YamlConfiguration();\n+                    config.load(configurationFile);\n+                    return config;\n                 case \"xml\":\n                     return new XMLConfiguration(configurationFile);\n                 default:",
                "raw_url": "https://github.com/apache/tinkerpop/raw/1f0df4a449fd0cf363e9e47e3864be4f3d845ad8/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/structure/util/GraphFactory.java",
                "sha": "0a918208ebcd5369a3443ef2597738c14844a2ee",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tinkerpop/blob/1f0df4a449fd0cf363e9e47e3864be4f3d845ad8/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/util/config/YamlConfiguration.java",
                "changes": 20,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/util/config/YamlConfiguration.java?ref=1f0df4a449fd0cf363e9e47e3864be4f3d845ad8",
                "deletions": 20,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/util/config/YamlConfiguration.java",
                "patch": "@@ -51,26 +51,6 @@ public YamlConfiguration() {\n         initialize();\n     }\n \n-    public YamlConfiguration(final HierarchicalConfiguration c) {\n-        super(c);\n-        initialize();\n-    }\n-\n-    public YamlConfiguration(final String fileName) throws ConfigurationException {\n-        super(fileName);\n-        initialize();\n-    }\n-\n-    public YamlConfiguration(final File file) throws ConfigurationException {\n-        super(file);\n-        initialize();\n-    }\n-\n-    public YamlConfiguration(final URL url) throws ConfigurationException {\n-        super(url);\n-        initialize();\n-    }\n-\n     private void initialize() {\n         yamlOptions.setIndent(DEFAULT_IDENT);\n         yamlOptions.setDefaultFlowStyle(DumperOptions.FlowStyle.BLOCK);",
                "raw_url": "https://github.com/apache/tinkerpop/raw/1f0df4a449fd0cf363e9e47e3864be4f3d845ad8/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/util/config/YamlConfiguration.java",
                "sha": "4075c988512a399c8177d7bb02b9c034b7a0658f",
                "status": "modified"
            },
            {
                "additions": 41,
                "blob_url": "https://github.com/apache/tinkerpop/blob/1f0df4a449fd0cf363e9e47e3864be4f3d845ad8/gremlin-core/src/test/java/org/apache/tinkerpop/gremlin/TestHelper.java",
                "changes": 41,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/test/java/org/apache/tinkerpop/gremlin/TestHelper.java?ref=1f0df4a449fd0cf363e9e47e3864be4f3d845ad8",
                "deletions": 0,
                "filename": "gremlin-core/src/test/java/org/apache/tinkerpop/gremlin/TestHelper.java",
                "patch": "@@ -18,8 +18,11 @@\n  */\n package org.apache.tinkerpop.gremlin;\n \n+import java.io.File;\n+import java.io.IOException;\n import java.lang.reflect.Constructor;\n import java.lang.reflect.Modifier;\n+import java.net.URL;\n \n import static org.junit.Assert.assertTrue;\n \n@@ -34,4 +37,42 @@ public static void assertIsUtilityClass(final Class<?> utilityClass) throws Exce\n         constructor.setAccessible(true);\n         constructor.newInstance();\n     }\n+\n+    /**\n+     * See {@code TestHelper} in gremlin-test for the official version.\n+     */\n+    public static File generateTempFile(final Class clazz, final String fileName, final String fileNameSuffix) throws IOException {\n+        final File path = makeTestDataPath(clazz, \"temp\");\n+        if (!path.exists()) path.mkdirs();\n+        return File.createTempFile(fileName, fileNameSuffix, path);\n+    }\n+\n+    /**\n+     * See {@code TestHelper} in gremlin-test for the official version.\n+     */\n+    public static File makeTestDataPath(final Class clazz, final String childPath) {\n+        final String buildDirectory = System.getProperty(\"build.dir\");\n+        final File root = null == buildDirectory ? new File(computePath(clazz)).getParentFile() : new File(buildDirectory);\n+        return new File(root, cleanPathSegment(childPath));\n+    }\n+\n+    /**\n+     * See {@code TestHelper} in gremlin-test for the official version.\n+     */\n+    public static String cleanPathSegment(final String toClean) {\n+        final String cleaned = toClean.replaceAll(\"[.\\\\\\\\/:*?\\\"<>|\\\\[\\\\]\\\\(\\\\)]\", \"\");\n+        if (cleaned.length() == 0)\n+            throw new IllegalStateException(\"Path segment \" + toClean + \" has not valid characters and is thus empty\");\n+        return cleaned;\n+    }\n+\n+    /**\n+     * See {@code TestHelper} in gremlin-test for the official version.\n+     */\n+    private static String computePath(final Class clazz) {\n+        final String clsUri = clazz.getName().replace('.', '/') + \".class\";\n+        final URL url = clazz.getClassLoader().getResource(clsUri);\n+        final String clsPath = url.getPath();\n+        return clsPath.substring(0, clsPath.length() - clsUri.length());\n+    }\n }",
                "raw_url": "https://github.com/apache/tinkerpop/raw/1f0df4a449fd0cf363e9e47e3864be4f3d845ad8/gremlin-core/src/test/java/org/apache/tinkerpop/gremlin/TestHelper.java",
                "sha": "3a8f8c3676c1e3539a3890c0ebc32ac3b118ac79",
                "status": "modified"
            },
            {
                "additions": 18,
                "blob_url": "https://github.com/apache/tinkerpop/blob/1f0df4a449fd0cf363e9e47e3864be4f3d845ad8/gremlin-core/src/test/java/org/apache/tinkerpop/gremlin/util/config/YamlConfigurationTest.java",
                "changes": 18,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/test/java/org/apache/tinkerpop/gremlin/util/config/YamlConfigurationTest.java?ref=1f0df4a449fd0cf363e9e47e3864be4f3d845ad8",
                "deletions": 0,
                "filename": "gremlin-core/src/test/java/org/apache/tinkerpop/gremlin/util/config/YamlConfigurationTest.java",
                "patch": "@@ -18,12 +18,18 @@\n  */\n package org.apache.tinkerpop.gremlin.util.config;\n \n+import org.apache.commons.configuration.ConfigurationException;\n+import org.apache.tinkerpop.gremlin.TestHelper;\n import org.junit.Test;\n import org.yaml.snakeyaml.DumperOptions;\n import org.yaml.snakeyaml.Yaml;\n \n+import java.io.File;\n+import java.io.FileWriter;\n+import java.io.Reader;\n import java.io.StringReader;\n import java.io.StringWriter;\n+import java.io.Writer;\n import java.util.Arrays;\n import java.util.HashMap;\n import java.util.LinkedHashMap;\n@@ -36,6 +42,18 @@\n  */\n public class YamlConfigurationTest {\n \n+    @Test(expected = ConfigurationException.class)\n+    public void shouldThrowConfigurationExceptionIfLoadFails() throws Exception {\n+        final YamlConfiguration config = new YamlConfiguration();\n+        config.load((Reader) null);\n+    }\n+\n+    @Test(expected = ConfigurationException.class)\n+    public void shouldThrowConfigurationExceptionIfSaveFails() throws Exception {\n+        final YamlConfiguration config = new YamlConfiguration();\n+        config.save((Writer) null);\n+    }\n+\n     @Test\n     public void shouldLoadSaveConfiguration() throws Exception {\n         final YamlConfiguration config = new YamlConfiguration();",
                "raw_url": "https://github.com/apache/tinkerpop/raw/1f0df4a449fd0cf363e9e47e3864be4f3d845ad8/gremlin-core/src/test/java/org/apache/tinkerpop/gremlin/util/config/YamlConfigurationTest.java",
                "sha": "f75a6c46fba23b2672e0ed1efb9186666d130059",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tinkerpop/blob/1f0df4a449fd0cf363e9e47e3864be4f3d845ad8/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/TestHelper.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/TestHelper.java?ref=1f0df4a449fd0cf363e9e47e3864be4f3d845ad8",
                "deletions": 3,
                "filename": "gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/TestHelper.java",
                "patch": "@@ -23,7 +23,6 @@\n import org.apache.tinkerpop.gremlin.structure.Property;\n import org.apache.tinkerpop.gremlin.structure.Vertex;\n import org.apache.tinkerpop.gremlin.structure.VertexProperty;\n-import org.apache.tinkerpop.gremlin.structure.io.graphml.GraphMLResourceAccess;\n import org.apache.tinkerpop.gremlin.structure.util.Comparators;\n import org.apache.tinkerpop.gremlin.util.iterator.IteratorUtils;\n \n@@ -32,7 +31,6 @@\n import java.io.IOException;\n import java.io.InputStream;\n import java.net.URL;\n-import java.util.Comparator;\n import java.util.Iterator;\n import java.util.List;\n \n@@ -113,7 +111,6 @@ public static String cleanPathSegment(final String toClean) {\n         return cleaned;\n     }\n \n-\n     ///////////////\n \n     public static void validateVertexEquality(final Vertex originalVertex, final Vertex otherVertex, boolean testEdges) {",
                "raw_url": "https://github.com/apache/tinkerpop/raw/1f0df4a449fd0cf363e9e47e3864be4f3d845ad8/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/TestHelper.java",
                "sha": "d3dba57e9c91ed7fa0d953777699578ea069e3fc",
                "status": "modified"
            }
        ],
        "message": "Removed other constructors for YamlConfiguration as they were not working.\n\nThose constructors relied on calls to super() which immediately triggered a call to load() thus not allowing the yaml member variable to be initialized leaving a npe to deal with.",
        "parent": "https://github.com/apache/tinkerpop/commit/8eaa0c27a454fa4824ea2a0a9a14197f5aa2808e",
        "repo": "tinkerpop",
        "unit_tests": [
            "GraphFactoryTest.java"
        ]
    },
    "tinkerpop_2760645": {
        "bug_id": "tinkerpop_2760645",
        "commit": "https://github.com/apache/tinkerpop/commit/276064530617c04706b62ac57ec4e2e660a756a4",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tinkerpop/blob/276064530617c04706b62ac57ec4e2e660a756a4/CHANGELOG.asciidoc",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/CHANGELOG.asciidoc?ref=276064530617c04706b62ac57ec4e2e660a756a4",
                "deletions": 0,
                "filename": "CHANGELOG.asciidoc",
                "patch": "@@ -26,6 +26,8 @@ image::https://raw.githubusercontent.com/apache/tinkerpop/master/docs/static/ima\n TinkerPop 3.2.4 (Release Date: NOT OFFICIALLY RELEASED YET)\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n+* `PathRetractionStrategy` does not add a `NoOpBarrierStep` to the end of local children as its wasted computation in 99% of traversals.\n+* Fixed a bug in `AddVertexStartStep` where if a side-effect was being used in the parametrization, an NPE occurred.\n * Fixed a bug in `LazyBarrierStrategy` where `profile()` was deactivating it accidentally.\n * Fixed a bug in `RepeatUnrollStrategy` where stateful `DedupGlobalStep` was cloned and thus, maintained two deduplication sets.\n * Added documentation around \"terminal steps\" in Gremlin: `hasNext()`, `next()`, `toList()`, etc.",
                "raw_url": "https://github.com/apache/tinkerpop/raw/276064530617c04706b62ac57ec4e2e660a756a4/CHANGELOG.asciidoc",
                "sha": "4411f99b9c74caf34be039d93ad0744c50b676bf",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tinkerpop/blob/276064530617c04706b62ac57ec4e2e660a756a4/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/AddVertexStartStep.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/AddVertexStartStep.java?ref=276064530617c04706b62ac57ec4e2e660a756a4",
                "deletions": 3,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/AddVertexStartStep.java",
                "patch": "@@ -19,8 +19,10 @@\n package org.apache.tinkerpop.gremlin.process.traversal.step.map;\n \n import org.apache.tinkerpop.gremlin.process.traversal.Parameterizing;\n+import org.apache.tinkerpop.gremlin.process.traversal.Step;\n import org.apache.tinkerpop.gremlin.process.traversal.Traversal;\n import org.apache.tinkerpop.gremlin.process.traversal.Traverser;\n+import org.apache.tinkerpop.gremlin.process.traversal.TraverserGenerator;\n import org.apache.tinkerpop.gremlin.process.traversal.step.Mutating;\n import org.apache.tinkerpop.gremlin.process.traversal.step.TraversalParent;\n import org.apache.tinkerpop.gremlin.process.traversal.step.util.AbstractStep;\n@@ -29,7 +31,6 @@\n import org.apache.tinkerpop.gremlin.process.traversal.step.util.event.Event;\n import org.apache.tinkerpop.gremlin.process.traversal.step.util.event.ListCallbackRegistry;\n import org.apache.tinkerpop.gremlin.process.traversal.traverser.TraverserRequirement;\n-import org.apache.tinkerpop.gremlin.process.traversal.traverser.util.EmptyTraverser;\n import org.apache.tinkerpop.gremlin.process.traversal.util.FastNoSuchElementException;\n import org.apache.tinkerpop.gremlin.structure.T;\n import org.apache.tinkerpop.gremlin.structure.Vertex;\n@@ -75,12 +76,13 @@ public void addPropertyMutations(final Object... keyValues) {\n     protected Traverser.Admin<Vertex> processNextStart() {\n         if (this.first) {\n             this.first = false;\n-            final Vertex vertex = this.getTraversal().getGraph().get().addVertex(this.parameters.getKeyValues(EmptyTraverser.instance()));\n+            final TraverserGenerator generator = this.getTraversal().getTraverserGenerator();\n+            final Vertex vertex = this.getTraversal().getGraph().get().addVertex(this.parameters.getKeyValues(generator.generate(false, (Step) this, 1L)));\n             if (this.callbackRegistry != null) {\n                 final Event.VertexAddedEvent vae = new Event.VertexAddedEvent(DetachedFactory.detach(vertex, true));\n                 this.callbackRegistry.getCallbacks().forEach(c -> c.accept(vae));\n             }\n-            return this.getTraversal().getTraverserGenerator().generate(vertex, this, 1l);\n+            return generator.generate(vertex, this, 1L);\n         } else\n             throw FastNoSuchElementException.instance();\n     }",
                "raw_url": "https://github.com/apache/tinkerpop/raw/276064530617c04706b62ac57ec4e2e660a756a4/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/AddVertexStartStep.java",
                "sha": "58c3ef32b4aa3ab9a6417aff6b59e0786f1e5189",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tinkerpop/blob/276064530617c04706b62ac57ec4e2e660a756a4/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/strategy/optimization/PathRetractionStrategy.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/strategy/optimization/PathRetractionStrategy.java?ref=276064530617c04706b62ac57ec4e2e660a756a4",
                "deletions": 1,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/strategy/optimization/PathRetractionStrategy.java",
                "patch": "@@ -109,7 +109,8 @@ public void apply(final Traversal.Admin<?, ?> traversal) {\n                         !(currentStep instanceof MatchStep) &&\n                         !(currentStep instanceof Barrier) &&\n                         !(currentStep.getNextStep() instanceof Barrier) &&\n-                        !(currentStep.getTraversal().getParent() instanceof MatchStep))\n+                        !(currentStep.getTraversal().getParent() instanceof MatchStep) &&\n+                        TraversalHelper.isGlobalChild(currentStep.getTraversal()))\n                     TraversalHelper.insertAfterStep(new NoOpBarrierStep<>(traversal, this.standardBarrierSize), currentStep, traversal);\n             }\n         }",
                "raw_url": "https://github.com/apache/tinkerpop/raw/276064530617c04706b62ac57ec4e2e660a756a4/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/strategy/optimization/PathRetractionStrategy.java",
                "sha": "1d09748f42ddf0cda8e71f21417011a1241907fb",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tinkerpop/blob/276064530617c04706b62ac57ec4e2e660a756a4/gremlin-groovy-test/src/main/groovy/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroovyAddVertexTest.groovy",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-groovy-test/src/main/groovy/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroovyAddVertexTest.groovy?ref=276064530617c04706b62ac57ec4e2e660a756a4",
                "deletions": 0,
                "filename": "gremlin-groovy-test/src/main/groovy/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroovyAddVertexTest.groovy",
                "patch": "@@ -76,6 +76,16 @@ public abstract class GroovyAddVertexTest {\n             new ScriptTraversal<>(g, \"gremlin-groovy\", \"g.V.addV('animal').property('name', values('name')).property('name', 'an animal').property(values('name'), label())\")\n         }\n \n+        @Override\n+        public Traversal<Vertex, Map<String, List<String>>> get_g_withSideEffectXa_testX_V_hasLabelXsoftwareX_propertyXtemp_selectXaXX_valueMapXname_tempX() {\n+            new ScriptTraversal<>(g, \"gremlin-groovy\", \"g.withSideEffect('a', 'test').V.hasLabel('software').property('temp', select('a')).valueMap('name', 'temp')\")\n+        }\n+\n+        @Override\n+        public Traversal<Vertex, String> get_g_withSideEffectXa_markoX_addV_propertyXname_selectXaXX_name() {\n+            new ScriptTraversal<>(g, \"gremlin-groovy\", \"g.withSideEffect('a', 'marko').addV().property('name', select('a')).name\")\n+        }\n+\n         ///////// DEPRECATED BELOW\n \n         @Override",
                "raw_url": "https://github.com/apache/tinkerpop/raw/276064530617c04706b62ac57ec4e2e660a756a4/gremlin-groovy-test/src/main/groovy/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroovyAddVertexTest.groovy",
                "sha": "00312faf4e9dea5678b81d6ac6ffa43f103c3d2f",
                "status": "modified"
            },
            {
                "additions": 51,
                "blob_url": "https://github.com/apache/tinkerpop/blob/276064530617c04706b62ac57ec4e2e660a756a4/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/AddVertexTest.java",
                "changes": 53,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/AddVertexTest.java?ref=276064530617c04706b62ac57ec4e2e660a756a4",
                "deletions": 2,
                "filename": "gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/AddVertexTest.java",
                "patch": "@@ -32,11 +32,17 @@\n import org.junit.Test;\n import org.junit.runner.RunWith;\n \n+import java.util.Collections;\n import java.util.List;\n+import java.util.Map;\n \n import static org.apache.tinkerpop.gremlin.LoadGraphWith.GraphData.MODERN;\n+import static org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.__.select;\n import static org.hamcrest.Matchers.containsInAnyOrder;\n-import static org.junit.Assert.*;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n \n /**\n  * @author Marko A. Rodriguez (http://markorodriguez.com)\n@@ -62,6 +68,10 @@\n \n     public abstract Traversal<Vertex, Vertex> get_g_V_addVXanimalX_propertyXname_valuesXnameXX_propertyXname_an_animalX_propertyXvaluesXnameX_labelX();\n \n+    public abstract Traversal<Vertex, Map<String, List<String>>> get_g_withSideEffectXa_testX_V_hasLabelXsoftwareX_propertyXtemp_selectXaXX_valueMapXname_tempX();\n+\n+    public abstract Traversal<Vertex, String> get_g_withSideEffectXa_markoX_addV_propertyXname_selectXaXX_name();\n+\n     // 3.0.0 DEPRECATIONS\n     @Deprecated\n     public abstract Traversal<Vertex, Vertex> get_g_V_addVXlabel_animal_age_0X();\n@@ -275,12 +285,41 @@ public void g_addVXlabel_person_name_stephenX() {\n         assertEquals(7, IteratorUtils.count(g.V()));\n     }\n \n+    @Test\n+    @LoadGraphWith(MODERN)\n+    @FeatureRequirement(featureClass = Graph.Features.VertexFeatures.class, feature = Graph.Features.VertexFeatures.FEATURE_ADD_PROPERTY)\n+    public void g_withSideEffectXa_testX_V_hasLabelXsoftwareX_propertyXtemp_selectXaXX_valueMapXname_tempX() {\n+        final Traversal<Vertex, Map<String, List<String>>> traversal = get_g_withSideEffectXa_testX_V_hasLabelXsoftwareX_propertyXtemp_selectXaXX_valueMapXname_tempX();\n+        printTraversalForm(traversal);\n+        int counter = 0;\n+        while (traversal.hasNext()) {\n+            counter++;\n+            final Map<String, List<String>> valueMap = traversal.next();\n+            assertEquals(2, valueMap.size());\n+            assertEquals(Collections.singletonList(\"test\"), valueMap.get(\"temp\"));\n+            assertTrue(valueMap.get(\"name\").equals(Collections.singletonList(\"ripple\")) || valueMap.get(\"name\").equals(Collections.singletonList(\"lop\")));\n+        }\n+        assertEquals(2, counter);\n+        assertFalse(traversal.hasNext());\n+    }\n+\n+    @Test\n+    @LoadGraphWith(MODERN)\n+    @FeatureRequirement(featureClass = Graph.Features.VertexFeatures.class, feature = Graph.Features.VertexFeatures.FEATURE_ADD_VERTICES)\n+    @FeatureRequirement(featureClass = Graph.Features.VertexFeatures.class, feature = Graph.Features.VertexFeatures.FEATURE_ADD_PROPERTY)\n+    public void g_withSideEffectXa_markoX_addV_propertyXname_selectXaXX_name() {\n+        final Traversal<Vertex, String> traversal = get_g_withSideEffectXa_markoX_addV_propertyXname_selectXaXX_name();\n+        printTraversalForm(traversal);\n+        assertEquals(\"marko\", traversal.next());\n+        assertFalse(traversal.hasNext());\n+    }\n+\n \n     public static class Traversals extends AddVertexTest {\n \n         @Override\n         public Traversal<Vertex, Vertex> get_g_VX1X_addVXanimalX_propertyXage_selectXaX_byXageXX_propertyXname_puppyX(final Object v1Id) {\n-            return g.V(v1Id).as(\"a\").addV(\"animal\").property(\"age\", __.select(\"a\").by(\"age\")).property(\"name\", \"puppy\");\n+            return g.V(v1Id).as(\"a\").addV(\"animal\").property(\"age\", select(\"a\").by(\"age\")).property(\"name\", \"puppy\");\n         }\n \n         @Override\n@@ -332,5 +371,15 @@ public void g_addVXlabel_person_name_stephenX() {\n         public Traversal<Vertex, Vertex> get_g_addVXlabel_person_name_stephenX() {\n             return g.addV(T.label, \"person\", \"name\", \"stephen\");\n         }\n+\n+        @Override\n+        public Traversal<Vertex, Map<String, List<String>>> get_g_withSideEffectXa_testX_V_hasLabelXsoftwareX_propertyXtemp_selectXaXX_valueMapXname_tempX() {\n+            return g.withSideEffect(\"a\", \"test\").V().hasLabel(\"software\").property(\"temp\", select(\"a\")).valueMap(\"name\", \"temp\");\n+        }\n+\n+        @Override\n+        public Traversal<Vertex, String> get_g_withSideEffectXa_markoX_addV_propertyXname_selectXaXX_name() {\n+            return g.withSideEffect(\"a\", \"marko\").addV().property(\"name\", select(\"a\")).values(\"name\");\n+        }\n     }\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tinkerpop/raw/276064530617c04706b62ac57ec4e2e660a756a4/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/AddVertexTest.java",
                "sha": "f43c6125ebcdcd4e302687a5fad305d098131e8f",
                "status": "modified"
            }
        ],
        "message": "fixed an NPE in AddVertexStartStep. In PathRetractionStrategy, NoOpBarriers are only added to global children as 99% of local children are by()-modulation based and thus, there is no point to fully compute the traversal if only the first next() is going to be used.",
        "parent": "https://github.com/apache/tinkerpop/commit/2d824cf29f7d914405e262f4111aa2f5a7c272dc",
        "repo": "tinkerpop",
        "unit_tests": [
            "PathRetractionStrategyTest.java"
        ]
    },
    "tinkerpop_2fc49e1": {
        "bug_id": "tinkerpop_2fc49e1",
        "commit": "https://github.com/apache/tinkerpop/commit/2fc49e1b3045e9ad82410ecfd1141aaa861c96de",
        "file": [
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/tinkerpop/blob/2fc49e1b3045e9ad82410ecfd1141aaa861c96de/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarGraph.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarGraph.java?ref=2fc49e1b3045e9ad82410ecfd1141aaa861c96de",
                "deletions": 3,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarGraph.java",
                "patch": "@@ -31,6 +31,7 @@\n import org.apache.tinkerpop.gremlin.structure.Vertex;\n import org.apache.tinkerpop.gremlin.structure.VertexProperty;\n import org.apache.tinkerpop.gremlin.structure.util.ElementHelper;\n+import org.apache.tinkerpop.gremlin.structure.util.StringFactory;\n import org.apache.tinkerpop.gremlin.structure.util.detached.DetachedEdge;\n import org.apache.tinkerpop.gremlin.structure.util.detached.DetachedVertex;\n \n@@ -43,7 +44,7 @@\n /**\n  * @author Marko A. Rodriguez (http://markorodriguez.com)\n  */\n-public class StarGraph implements Graph {\n+public final class StarGraph implements Graph {\n \n     private static final Configuration EMPTY_CONFIGURATION = new BaseConfiguration();\n \n@@ -66,7 +67,6 @@ public GraphComputer compute() throws IllegalArgumentException {\n \n     @Override\n     public Iterator<Vertex> vertices(final Object... vertexIds) {\n-        System.out.println(this.starVertex.outEdges);\n         return null == this.starVertex ?\n                 Collections.emptyIterator() :\n                 Stream.concat(\n@@ -116,6 +116,11 @@ public void close() throws Exception {\n \n     }\n \n+    @Override\n+    public String toString() {\n+        return StringFactory.graphString(this, \"starOf:\" + this.starVertex);\n+    }\n+\n     public static StarGraph open() {\n         return new StarGraph();\n     }\n@@ -129,6 +134,7 @@ public static Vertex addTo(final StarGraph graph, final DetachedVertex detachedV\n             final VertexProperty<?> vertexProperty = graph.starVertex.property(VertexProperty.Cardinality.list, detachedVertexProperty.key(), detachedVertexProperty.value());\n             detachedVertexProperty.properties().forEachRemaining(detachedVertexPropertyProperty -> {\n                 vertexProperty.property(detachedVertexPropertyProperty.key(), detachedVertexPropertyProperty.value());\n+                // todo: id of vertex property\n             });\n         });\n         return graph.starVertex;\n@@ -150,5 +156,4 @@ public static Edge addTo(final StarGraph graph, final DetachedEdge edge) {\n     protected static Long randomId() {\n         return new Random().nextLong(); // TODO: you shouldn't need this!\n     }\n-\n }",
                "raw_url": "https://github.com/apache/tinkerpop/raw/2fc49e1b3045e9ad82410ecfd1141aaa861c96de/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarGraph.java",
                "sha": "f9f09411c4dbb79740eb1339f09755e4df44fae4",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tinkerpop/blob/2fc49e1b3045e9ad82410ecfd1141aaa861c96de/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarInEdge.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarInEdge.java?ref=2fc49e1b3045e9ad82410ecfd1141aaa861c96de",
                "deletions": 1,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarInEdge.java",
                "patch": "@@ -30,7 +30,7 @@\n /**\n  * @author Marko A. Rodriguez (http://markorodriguez.com)\n  */\n-public class StarInEdge extends StarEdge {\n+public final class StarInEdge extends StarEdge {\n \n     private final StarOutVertex starOutVertex;\n     private final StarVertex starVertex;",
                "raw_url": "https://github.com/apache/tinkerpop/raw/2fc49e1b3045e9ad82410ecfd1141aaa861c96de/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarInEdge.java",
                "sha": "5d382a8902e344abcf51e475f11e56802e11b2a9",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tinkerpop/blob/2fc49e1b3045e9ad82410ecfd1141aaa861c96de/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarInVertex.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarInVertex.java?ref=2fc49e1b3045e9ad82410ecfd1141aaa861c96de",
                "deletions": 1,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarInVertex.java",
                "patch": "@@ -31,7 +31,7 @@\n /**\n  * @author Marko A. Rodriguez (http://markorodriguez.com)\n  */\n-public class StarInVertex extends StarAdjacentVertex {\n+public final class StarInVertex extends StarAdjacentVertex {\n \n     public StarInVertex(final Object id, final StarVertex starVertex) {\n         super(id, starVertex);",
                "raw_url": "https://github.com/apache/tinkerpop/raw/2fc49e1b3045e9ad82410ecfd1141aaa861c96de/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarInVertex.java",
                "sha": "b9ea627e064f9ac2404ee011439e153cd012c2bf",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tinkerpop/blob/2fc49e1b3045e9ad82410ecfd1141aaa861c96de/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarOutEdge.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarOutEdge.java?ref=2fc49e1b3045e9ad82410ecfd1141aaa861c96de",
                "deletions": 1,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarOutEdge.java",
                "patch": "@@ -30,7 +30,7 @@\n /**\n  * @author Marko A. Rodriguez (http://markorodriguez.com)\n  */\n-public class StarOutEdge extends StarEdge {\n+public final class StarOutEdge extends StarEdge {\n \n     private final StarVertex starVertex;\n     private final StarInVertex starInVertex;",
                "raw_url": "https://github.com/apache/tinkerpop/raw/2fc49e1b3045e9ad82410ecfd1141aaa861c96de/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarOutEdge.java",
                "sha": "533bea6b67494f4e6e595db2c3ec523fe34112a8",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tinkerpop/blob/2fc49e1b3045e9ad82410ecfd1141aaa861c96de/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarOutVertex.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarOutVertex.java?ref=2fc49e1b3045e9ad82410ecfd1141aaa861c96de",
                "deletions": 1,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarOutVertex.java",
                "patch": "@@ -31,7 +31,7 @@\n /**\n  * @author Marko A. Rodriguez (http://markorodriguez.com)\n  */\n-public class StarOutVertex extends StarAdjacentVertex {\n+public final class StarOutVertex extends StarAdjacentVertex {\n \n     public StarOutVertex(final Object id, final StarVertex starVertex) {\n         super(id, starVertex);",
                "raw_url": "https://github.com/apache/tinkerpop/raw/2fc49e1b3045e9ad82410ecfd1141aaa861c96de/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarOutVertex.java",
                "sha": "c6ead652b9bcf51502c9bf2aafb4c971b42e26f9",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tinkerpop/blob/2fc49e1b3045e9ad82410ecfd1141aaa861c96de/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarProperty.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarProperty.java?ref=2fc49e1b3045e9ad82410ecfd1141aaa861c96de",
                "deletions": 1,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarProperty.java",
                "patch": "@@ -29,7 +29,7 @@\n /**\n  * @author Marko A. Rodriguez (http://markorodriguez.com)\n  */\n-public class StarProperty<V> implements Property<V> {\n+public final class StarProperty<V> implements Property<V> {\n \n     private final String key;\n     private final V value;",
                "raw_url": "https://github.com/apache/tinkerpop/raw/2fc49e1b3045e9ad82410ecfd1141aaa861c96de/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarProperty.java",
                "sha": "e884f30302c0bf87a1f6d2f6a2f3ea26436ff74f",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tinkerpop/blob/2fc49e1b3045e9ad82410ecfd1141aaa861c96de/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarVertex.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarVertex.java?ref=2fc49e1b3045e9ad82410ecfd1141aaa861c96de",
                "deletions": 2,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarVertex.java",
                "patch": "@@ -39,7 +39,7 @@\n /**\n  * @author Marko A. Rodriguez (http://markorodriguez.com)\n  */\n-public class StarVertex extends StarElement implements Vertex {\n+public final class StarVertex extends StarElement implements Vertex {\n \n     protected Map<String, List<VertexProperty<?>>> properties = null;\n     protected Map<String, List<Edge>> outEdges = new HashMap<>();\n@@ -113,7 +113,12 @@ public Edge addEdge(final String label, final Vertex inVertex, final Object... k\n                     .map(Edge::outVertex)\n                     .iterator();\n         } else {\n-            return null;\n+            return Stream.concat(this.outEdges.entrySet().stream(), this.inEdges.entrySet().stream())\n+                    .filter(entry -> ElementHelper.keyExists(entry.getKey(), edgeLabels))\n+                    .map(Map.Entry::getValue)\n+                    .flatMap(List::stream)\n+                    .map(Edge::outVertex)\n+                    .iterator();\n         }\n     }\n ",
                "raw_url": "https://github.com/apache/tinkerpop/raw/2fc49e1b3045e9ad82410ecfd1141aaa861c96de/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarVertex.java",
                "sha": "a66657a183e7f57af942176e49ca40bb6e5422cb",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tinkerpop/blob/2fc49e1b3045e9ad82410ecfd1141aaa861c96de/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarVertexProperty.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarVertexProperty.java?ref=2fc49e1b3045e9ad82410ecfd1141aaa861c96de",
                "deletions": 1,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarVertexProperty.java",
                "patch": "@@ -36,7 +36,7 @@\n /**\n  * @author Marko A. Rodriguez (http://markorodriguez.com)\n  */\n-public class StarVertexProperty<V> implements VertexProperty<V> {\n+public final class StarVertexProperty<V> implements VertexProperty<V> {\n \n     private final Object id;\n     private final String key;",
                "raw_url": "https://github.com/apache/tinkerpop/raw/2fc49e1b3045e9ad82410ecfd1141aaa861c96de/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/util/star/StarVertexProperty.java",
                "sha": "d3e35f54ea41ff590f6f321f50026c89a53c7d44",
                "status": "modified"
            }
        ],
        "message": "fixed an NPE with StarVertex.vertices(BOTH).",
        "parent": "https://github.com/apache/tinkerpop/commit/1478e778d2ffc0de1791323dcb8f7e8473bf75b2",
        "repo": "tinkerpop",
        "unit_tests": [
            "StarGraphTest.java"
        ]
    },
    "tinkerpop_3d70c3d": {
        "bug_id": "tinkerpop_3d70c3d",
        "commit": "https://github.com/apache/tinkerpop/commit/3d70c3d15d4591acab84420f86991cd98a187c38",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tinkerpop/blob/3d70c3d15d4591acab84420f86991cd98a187c38/CHANGELOG.asciidoc",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/CHANGELOG.asciidoc?ref=3d70c3d15d4591acab84420f86991cd98a187c38",
                "deletions": 0,
                "filename": "CHANGELOG.asciidoc",
                "patch": "@@ -26,6 +26,7 @@ image::https://raw.githubusercontent.com/apache/tinkerpop/master/docs/static/ima\n TinkerPop 3.2.4 (Release Date: NOT OFFICIALLY RELEASED YET)\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n+* Fixed a `NullPointerException` bug with profiling `GroupSideEffectStep` in OLTP.\n * Improved ability to release resources in `GraphProvider` instances in the test suite.\n * Added a `force` option for killing sessions without waiting for transaction close or timeout of a currently running job or multiple jobs.\n * Deprecated `Session.kill()` and `Session.manualKill()`.",
                "raw_url": "https://github.com/apache/tinkerpop/raw/3d70c3d15d4591acab84420f86991cd98a187c38/CHANGELOG.asciidoc",
                "sha": "766b135eb239710e62e9b719d7e0144b5c3a3119",
                "status": "modified"
            },
            {
                "additions": 20,
                "blob_url": "https://github.com/apache/tinkerpop/blob/3d70c3d15d4591acab84420f86991cd98a187c38/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroupStep.java",
                "changes": 33,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroupStep.java?ref=3d70c3d15d4591acab84420f86991cd98a187c38",
                "deletions": 13,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroupStep.java",
                "patch": "@@ -22,7 +22,6 @@\n import org.apache.tinkerpop.gremlin.process.traversal.Step;\n import org.apache.tinkerpop.gremlin.process.traversal.Traversal;\n import org.apache.tinkerpop.gremlin.process.traversal.Traverser;\n-import org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.DefaultGraphTraversal;\n import org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.__;\n import org.apache.tinkerpop.gremlin.process.traversal.lambda.ElementValueTraversal;\n import org.apache.tinkerpop.gremlin.process.traversal.lambda.FunctionTraverser;\n@@ -61,8 +60,8 @@\n \n     private char state = 'k';\n     private Traversal.Admin<S, K> keyTraversal = null;\n-    private Traversal.Admin<S, ?> preTraversal;\n-    private Traversal.Admin<S, V> valueTraversal;\n+    private Traversal.Admin<S, ?> preTraversal = null;\n+    private Traversal.Admin<S, V> valueTraversal = null;\n \n     public GroupStep(final Traversal.Admin traversal) {\n         super(traversal);\n@@ -109,10 +108,12 @@ public String toString() {\n \n     @Override\n     public List<Traversal.Admin<?, ?>> getLocalChildren() {\n-        final List<Traversal.Admin<?, ?>> children = new ArrayList<>(2);\n+        final List<Traversal.Admin<?, ?>> children = new ArrayList<>(3);\n         if (null != this.keyTraversal)\n-            children.add((Traversal.Admin) this.keyTraversal);\n+            children.add(this.keyTraversal);\n         children.add(this.valueTraversal);\n+        if (null != this.preTraversal)\n+            children.add(this.preTraversal);\n         return children;\n     }\n \n@@ -127,7 +128,8 @@ public String toString() {\n         if (null != this.keyTraversal)\n             clone.keyTraversal = this.keyTraversal.clone();\n         clone.valueTraversal = this.valueTraversal.clone();\n-        clone.preTraversal = this.integrateChild(GroupStep.generatePreTraversal(clone.valueTraversal));\n+        if (null != this.preTraversal)\n+            clone.preTraversal = this.preTraversal.clone();\n         return clone;\n     }\n \n@@ -332,26 +334,30 @@ private void readObject(final ObjectInputStream inputStream) throws IOException,\n \n     public static Traversal.Admin<?, ?> generatePreTraversal(final Traversal.Admin<?, ?> valueTraversal) {\n         if (!TraversalHelper.hasStepOfAssignableClass(Barrier.class, valueTraversal))\n-            return valueTraversal;\n+            return valueTraversal.clone();\n         final Traversal.Admin<?, ?> first = __.identity().asAdmin();\n+        boolean updated = false;\n         for (final Step step : valueTraversal.getSteps()) {\n             if (step instanceof Barrier)\n                 break;\n             first.addStep(step.clone());\n+            updated = true;\n         }\n-        return first.getSteps().size() == 1 ? null : first;\n+        return updated ? first : null;\n     }\n \n     public static <K, V> Map<K, V> doFinalReduction(final Map<K, Object> map, final Traversal.Admin<?, V> valueTraversal) {\n         final Map<K, V> reducedMap = new HashMap<>(map.size());\n         final Barrier reducingBarrierStep = TraversalHelper.getFirstStepOfAssignableClass(Barrier.class, valueTraversal).orElse(null);\n         IteratorUtils.removeOnNext(map.entrySet().iterator()).forEachRemaining(entry -> {\n-            valueTraversal.reset();\n             if (null == reducingBarrierStep) {\n-                reducedMap.put(entry.getKey(), entry.getValue() instanceof TraverserSet ?\n-                        ((TraverserSet<V>) entry.getValue()).iterator().next().get() :\n-                        (V) entry.getValue());\n+                if (entry.getValue() instanceof TraverserSet) {\n+                    if (!((TraverserSet) entry.getValue()).isEmpty())\n+                        reducedMap.put(entry.getKey(), ((TraverserSet<V>) entry.getValue()).peek().get());\n+                } else\n+                    reducedMap.put(entry.getKey(), (V) entry.getValue());\n             } else {\n+                valueTraversal.reset();\n                 if (entry.getValue() instanceof Traverser.Admin)\n                     ((Step) reducingBarrierStep).addStart((Traverser.Admin) entry.getValue());\n                 else if (entry.getValue() instanceof TraverserSet)\n@@ -361,7 +367,8 @@ else if (entry.getValue() instanceof Pair) {\n                     reducingBarrierStep.addBarrier((((Pair) entry.getValue()).getValue1()));\n                 } else\n                     reducingBarrierStep.addBarrier(entry.getValue());\n-                reducedMap.put(entry.getKey(), valueTraversal.next());\n+                if (valueTraversal.hasNext())\n+                    reducedMap.put(entry.getKey(), valueTraversal.next());\n             }\n         });\n         assert map.isEmpty();",
                "raw_url": "https://github.com/apache/tinkerpop/raw/3d70c3d15d4591acab84420f86991cd98a187c38/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroupStep.java",
                "sha": "737c5f9ccc165be802c5565c1a144a5f12d9ec0d",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tinkerpop/blob/3d70c3d15d4591acab84420f86991cd98a187c38/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupSideEffectStep.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupSideEffectStep.java?ref=3d70c3d15d4591acab84420f86991cd98a187c38",
                "deletions": 4,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupSideEffectStep.java",
                "patch": "@@ -45,7 +45,7 @@\n     private char state = 'k';\n     private Traversal.Admin<S, K> keyTraversal = null;\n     private Traversal.Admin<S, ?> preTraversal = null;\n-    private Traversal.Admin<S, V> valueTraversal = this.integrateChild(__.fold().asAdmin());\n+    private Traversal.Admin<S, V> valueTraversal = null;\n     ///\n     private String sideEffectKey;\n \n@@ -99,10 +99,12 @@ public String toString() {\n \n     @Override\n     public List<Traversal.Admin<?, ?>> getLocalChildren() {\n-        final List<Traversal.Admin<?, ?>> children = new ArrayList<>(2);\n+        final List<Traversal.Admin<?, ?>> children = new ArrayList<>(3);\n         if (null != this.keyTraversal)\n-            children.add((Traversal.Admin) this.keyTraversal);\n+            children.add(this.keyTraversal);\n         children.add(this.valueTraversal);\n+        if (null != this.preTraversal)\n+            children.add(this.preTraversal);\n         return children;\n     }\n \n@@ -117,7 +119,8 @@ public String toString() {\n         if (null != this.keyTraversal)\n             clone.keyTraversal = this.keyTraversal.clone();\n         clone.valueTraversal = this.valueTraversal.clone();\n-        clone.preTraversal = this.integrateChild(GroupStep.generatePreTraversal(clone.valueTraversal));\n+        if (null != this.preTraversal)\n+            clone.preTraversal = this.preTraversal.clone();\n         return clone;\n     }\n ",
                "raw_url": "https://github.com/apache/tinkerpop/raw/3d70c3d15d4591acab84420f86991cd98a187c38/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupSideEffectStep.java",
                "sha": "f2699e0ef8b187d508b79c6acd2e71f59f192e7d",
                "status": "modified"
            },
            {
                "additions": 39,
                "blob_url": "https://github.com/apache/tinkerpop/blob/3d70c3d15d4591acab84420f86991cd98a187c38/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/util/DefaultTraversalMetrics.java",
                "changes": 76,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/util/DefaultTraversalMetrics.java?ref=3d70c3d15d4591acab84420f86991cd98a187c38",
                "deletions": 37,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/util/DefaultTraversalMetrics.java",
                "patch": "@@ -37,6 +37,7 @@\n \n /**\n  * @author Bob Briody (http://bobbriody.com)\n+ * @author Marko A. Rodriguez (http://markorodriguez.com)\n  */\n public final class DefaultTraversalMetrics implements TraversalMetrics, Serializable {\n     /**\n@@ -61,29 +62,29 @@ public DefaultTraversalMetrics() {\n      */\n     public DefaultTraversalMetrics(final long totalStepDurationNs, final List<MutableMetrics> metricsMap) {\n         this.totalStepDuration = totalStepDurationNs;\n-        this.computedMetrics = new LinkedHashMap<>(metrics.size());\n-        metricsMap.forEach(m -> computedMetrics.put(m.getId(), m.getImmutableClone()));\n+        this.computedMetrics = new LinkedHashMap<>(this.metrics.size());\n+        metricsMap.forEach(metric -> this.computedMetrics.put(metric.getId(), metric.getImmutableClone()));\n     }\n \n     @Override\n     public long getDuration(final TimeUnit unit) {\n-        return unit.convert(totalStepDuration, MutableMetrics.SOURCE_UNIT);\n+        return unit.convert(this.totalStepDuration, MutableMetrics.SOURCE_UNIT);\n     }\n \n     @Override\n     public Metrics getMetrics(final int index) {\n         // adjust index to account for the injected profile steps\n-        return (Metrics) computedMetrics.get(indexToLabelMap.get(index));\n+        return this.computedMetrics.get(this.indexToLabelMap.get(index));\n     }\n \n     @Override\n     public Metrics getMetrics(final String id) {\n-        return computedMetrics.get(id);\n+        return this.computedMetrics.get(id);\n     }\n \n     @Override\n     public Collection<ImmutableMetrics> getMetrics() {\n-        return computedMetrics.values();\n+        return this.computedMetrics.values();\n     }\n \n     @Override\n@@ -96,7 +97,7 @@ public String toString() {\n \n         sb.append(\"\\n=============================================================================================================\");\n \n-        appendMetrics(computedMetrics.values(), sb, 0);\n+        appendMetrics(this.computedMetrics.values(), sb, 0);\n \n         // Append total duration\n         sb.append(String.format(\"%n%50s %21s %11s %15.3f %8s\",\n@@ -150,25 +151,25 @@ private void appendMetrics(final Collection<? extends Metrics> metrics, final St\n \n     private void computeTotals() {\n         // Create temp list of ordered metrics\n-        List<MutableMetrics> tempMetrics = new ArrayList<>(metrics.size());\n-        for (String label : indexToLabelMap.values()) {\n+        final List<MutableMetrics> tempMetrics = new ArrayList<>(this.metrics.size());\n+        for (final String label : this.indexToLabelMap.values()) {\n             // The indexToLabelMap is sorted by index (key)\n-            tempMetrics.add(metrics.get(label).clone());\n+            tempMetrics.add(this.metrics.get(label).clone());\n         }\n \n         // Calculate total duration\n         this.totalStepDuration = 0;\n-        tempMetrics.forEach(m -> this.totalStepDuration += m.getDuration(MutableMetrics.SOURCE_UNIT));\n+        tempMetrics.forEach(metric -> this.totalStepDuration += metric.getDuration(MutableMetrics.SOURCE_UNIT));\n \n         // Assign %'s\n         tempMetrics.forEach(m -> {\n-            double dur = m.getDuration(TimeUnit.NANOSECONDS) * 100.d / this.totalStepDuration;\n+            final double dur = m.getDuration(TimeUnit.NANOSECONDS) * 100.d / this.totalStepDuration;\n             m.setAnnotation(PERCENT_DURATION_KEY, dur);\n         });\n \n         // Store immutable instances of the calculated metrics\n-        computedMetrics = new LinkedHashMap<>(metrics.size());\n-        tempMetrics.forEach(it -> computedMetrics.put(it.getId(), it.getImmutableClone()));\n+        this.computedMetrics = new LinkedHashMap<>(this.metrics.size());\n+        tempMetrics.forEach(it -> this.computedMetrics.put(it.getId(), it.getImmutableClone()));\n     }\n \n     public static DefaultTraversalMetrics merge(final Iterator<DefaultTraversalMetrics> toMerge) {\n@@ -186,7 +187,7 @@ public static DefaultTraversalMetrics merge(final Iterator<DefaultTraversalMetri\n \n                     newTraversalMetrics.metrics.put(metricsId, aggregateMetrics);\n                     // Set the index of the Metrics\n-                    for (Map.Entry<Integer, String> entry : inTraversalMetrics.indexToLabelMap.entrySet()) {\n+                    for (final Map.Entry<Integer, String> entry : inTraversalMetrics.indexToLabelMap.entrySet()) {\n                         if (metricsId.equals(entry.getValue())) {\n                             newTraversalMetrics.indexToLabelMap.put(entry.getKey(), metricsId);\n                             break;\n@@ -199,7 +200,7 @@ public static DefaultTraversalMetrics merge(final Iterator<DefaultTraversalMetri\n         return newTraversalMetrics;\n     }\n \n-    public void setMetrics(Traversal.Admin traversal, boolean onGraphComputer) {\n+    public void setMetrics(final Traversal.Admin traversal, final boolean onGraphComputer) {\n         addTopLevelMetrics(traversal, onGraphComputer);\n         handleNestedTraversals(traversal, null, onGraphComputer);\n         computeTotals();\n@@ -222,36 +223,37 @@ private void addTopLevelMetrics(Traversal.Admin traversal, final boolean onGraph\n         }\n     }\n \n-    private void handleNestedTraversals(Traversal.Admin traversal, MutableMetrics parentMetrics, boolean onGraphComputer) {\n+    private void handleNestedTraversals(final Traversal.Admin traversal, final MutableMetrics parentMetrics, final boolean onGraphComputer) {\n         long prevDur = 0;\n-        for (int ii = 0; ii < traversal.getSteps().size(); ii++) {\n-            Step step = (Step) traversal.getSteps().get(ii);\n-            if (!(step instanceof ProfileStep)) {\n+        for (int i = 0; i < traversal.getSteps().size(); i++) {\n+            final Step step = (Step) traversal.getSteps().get(i);\n+            if (!(step instanceof ProfileStep))\n                 continue;\n-            }\n \n             final MutableMetrics metrics = onGraphComputer ?\n                     traversal.getSideEffects().get(step.getId()) :\n                     ((ProfileStep) step).getMetrics();\n \n-            if (!onGraphComputer) {\n-                // subtract upstream duration.\n-                long durBeforeAdjustment = metrics.getDuration(TimeUnit.NANOSECONDS);\n-                // adjust duration\n-                metrics.setDuration(metrics.getDuration(TimeUnit.NANOSECONDS) - prevDur, TimeUnit.NANOSECONDS);\n-                prevDur = durBeforeAdjustment;\n-            }\n-\n-            if (parentMetrics != null) {\n-                parentMetrics.addNested(metrics);\n-            }\n+            if (null != metrics) { // this happens when a particular branch never received a .next() call (the metrics were never initialized)\n+                if (!onGraphComputer) {\n+                    // subtract upstream duration.\n+                    long durBeforeAdjustment = metrics.getDuration(TimeUnit.NANOSECONDS);\n+                    // adjust duration\n+                    metrics.setDuration(metrics.getDuration(TimeUnit.NANOSECONDS) - prevDur, TimeUnit.NANOSECONDS);\n+                    prevDur = durBeforeAdjustment;\n+                }\n \n-            if (step.getPreviousStep() instanceof TraversalParent) {\n-                for (Traversal.Admin<?, ?> t : ((TraversalParent) step.getPreviousStep()).getLocalChildren()) {\n-                    handleNestedTraversals(t, metrics, onGraphComputer);\n+                if (parentMetrics != null) {\n+                    parentMetrics.addNested(metrics);\n                 }\n-                for (Traversal.Admin<?, ?> t : ((TraversalParent) step.getPreviousStep()).getGlobalChildren()) {\n-                    handleNestedTraversals(t, metrics, onGraphComputer);\n+\n+                if (step.getPreviousStep() instanceof TraversalParent) {\n+                    for (Traversal.Admin<?, ?> t : ((TraversalParent) step.getPreviousStep()).getLocalChildren()) {\n+                        handleNestedTraversals(t, metrics, onGraphComputer);\n+                    }\n+                    for (Traversal.Admin<?, ?> t : ((TraversalParent) step.getPreviousStep()).getGlobalChildren()) {\n+                        handleNestedTraversals(t, metrics, onGraphComputer);\n+                    }\n                 }\n             }\n         }",
                "raw_url": "https://github.com/apache/tinkerpop/raw/3d70c3d15d4591acab84420f86991cd98a187c38/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/util/DefaultTraversalMetrics.java",
                "sha": "ecf28e002d01e85c5c4e9150e3b95b66be826896",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tinkerpop/blob/3d70c3d15d4591acab84420f86991cd98a187c38/gremlin-groovy-test/src/main/groovy/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroovyGroupTest.groovy",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-groovy-test/src/main/groovy/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroovyGroupTest.groovy?ref=3d70c3d15d4591acab84420f86991cd98a187c38",
                "deletions": 0,
                "filename": "gremlin-groovy-test/src/main/groovy/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroovyGroupTest.groovy",
                "patch": "@@ -118,5 +118,10 @@ public abstract class GroovyGroupTest {\n         public Traversal<Vertex, Map<String, Map<String, Number>>> get_g_V_outXfollowedByX_group_byXsongTypeX_byXbothE_group_byXlabelX_byXweight_sumXX() {\n             new ScriptTraversal<>(g, \"gremlin-groovy\", \"g.V.out('followedBy').group.by('songType').by(bothE().group.by(label).by(values('weight').sum))\")\n         }\n+\n+        @Override\n+        public Traversal<Vertex, Map<String, String>> get_g_V_groupXmX_byXnameX_byXinXknowsX_nameX_capXmX() {\n+            new ScriptTraversal<>(g, \"gremlin-groovy\", \"g.V.group('m').by('name').by(__.in('knows').name).cap('m')\")\n+        }\n     }\n }",
                "raw_url": "https://github.com/apache/tinkerpop/raw/3d70c3d15d4591acab84420f86991cd98a187c38/gremlin-groovy-test/src/main/groovy/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroovyGroupTest.groovy",
                "sha": "84da296561380006687fcd3f09f406d3a4787b07",
                "status": "modified"
            },
            {
                "additions": 23,
                "blob_url": "https://github.com/apache/tinkerpop/blob/3d70c3d15d4591acab84420f86991cd98a187c38/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupTest.java",
                "changes": 23,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupTest.java?ref=3d70c3d15d4591acab84420f86991cd98a187c38",
                "deletions": 0,
                "filename": "gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupTest.java",
                "patch": "@@ -88,6 +88,8 @@\n \n     public abstract Traversal<Vertex, Map<String, Map<String, Number>>> get_g_V_outXfollowedByX_group_byXsongTypeX_byXbothE_group_byXlabelX_byXweight_sumXX();\n \n+    public abstract Traversal<Vertex, Map<String, String>> get_g_V_groupXmX_byXnameX_byXinXknowsX_nameX_capXmX();\n+\n     @Test\n     @LoadGraphWith(MODERN)\n     public void g_V_group_byXnameX() {\n@@ -364,6 +366,7 @@ public void g_V_repeatXunionXoutXknowsX_groupXaX_byXageX__outXcreatedX_groupXbX_\n     @LoadGraphWith(MODERN)\n     public void g_V_group_byXbothE_countX_byXgroup_byXlabelXX() {\n         final Traversal<Vertex, Map<Long, Map<String, List<Vertex>>>> traversal = get_g_V_group_byXbothE_countX_byXgroup_byXlabelXX();\n+        printTraversalForm(traversal);\n         final Map<Long, Map<String, List<Vertex>>> map = traversal.next();\n         assertFalse(traversal.hasNext());\n         assertEquals(2, map.size());\n@@ -399,6 +402,7 @@ public void g_V_group_byXbothE_countX_byXgroup_byXlabelXX() {\n     @LoadGraphWith(GRATEFUL)\n     public void g_V_outXfollowedByX_group_byXsongTypeX_byXbothE_group_byXlabelX_byXweight_sumXX() {\n         final Traversal<Vertex, Map<String, Map<String, Number>>> traversal = get_g_V_outXfollowedByX_group_byXsongTypeX_byXbothE_group_byXlabelX_byXweight_sumXX();\n+        printTraversalForm(traversal);\n         final Map<String, Map<String, Number>> map = traversal.next();\n         assertFalse(traversal.hasNext());\n         assertEquals(3, map.size());\n@@ -423,6 +427,20 @@ public void g_V_outXfollowedByX_group_byXsongTypeX_byXbothE_group_byXlabelX_byXw\n         assertEquals(0, subMap.get(\"sungBy\").intValue());\n     }\n \n+    @Test\n+    @LoadGraphWith(MODERN)\n+    public void g_V_groupXmX_byXnameX_byXinXknowsX_nameX_capXmX() {\n+        final Traversal<Vertex, Map<String, String>> traversal = get_g_V_groupXmX_byXnameX_byXinXknowsX_nameX_capXmX();\n+        printTraversalForm(traversal);\n+        final Map<String, String> map = traversal.next();\n+        assertFalse(traversal.hasNext());\n+        assertEquals(2, map.size());\n+        assertEquals(\"marko\", map.get(\"vadas\"));\n+        assertEquals(\"marko\", map.get(\"josh\"));\n+\n+        checkSideEffects(traversal.asAdmin().getSideEffects(), \"m\", HashMap.class);\n+    }\n+\n     public static class Traversals extends GroupTest {\n \n         @Override\n@@ -514,5 +532,10 @@ public void g_V_outXfollowedByX_group_byXsongTypeX_byXbothE_group_byXlabelX_byXw\n         public Traversal<Vertex, Map<String, Map<String, Number>>> get_g_V_outXfollowedByX_group_byXsongTypeX_byXbothE_group_byXlabelX_byXweight_sumXX() {\n             return g.V().out(\"followedBy\").<String, Map<String, Number>>group().by(\"songType\").by(__.bothE().group().by(T.label).by(__.values(\"weight\").sum()));\n         }\n+\n+        @Override\n+        public Traversal<Vertex, Map<String, String>> get_g_V_groupXmX_byXnameX_byXinXknowsX_nameX_capXmX() {\n+            return g.V().group(\"m\").by(\"name\").by(__.in(\"knows\").values(\"name\")).cap(\"m\");\n+        }\n     }\n }",
                "raw_url": "https://github.com/apache/tinkerpop/raw/3d70c3d15d4591acab84420f86991cd98a187c38/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupTest.java",
                "sha": "036c8c8a8342f383be1eda15b510aaef92d11ba4",
                "status": "modified"
            }
        ],
        "message": "fixed an NPE bug in profiling GroupSideEffectStep. It has to deal with how GroupSideEffectStep breaks apart the valueTraversal into a pre/post-traversal for pre-proecessing and reduction. While I was testing, I found another bug where if the reducing traversal has no data, then don't .next() it. Basically, it is possible for Profiling to get a traversal that has not been next'd because the traversal's pre/post was being worked with.",
        "parent": "https://github.com/apache/tinkerpop/commit/b4d0ef98aee1bde018698e726f0374ce61a37f3a",
        "repo": "tinkerpop",
        "unit_tests": [
            "GroupStepTest.java",
            "GroupSideEffectStepTest.java"
        ]
    },
    "tinkerpop_82295fe": {
        "bug_id": "tinkerpop_82295fe",
        "commit": "https://github.com/apache/tinkerpop/commit/82295fe1eaaeab86517c191c1d44dfe3f0b34d2a",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tinkerpop/blob/82295fe1eaaeab86517c191c1d44dfe3f0b34d2a/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/structure/util/star/StarGraph.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/structure/util/star/StarGraph.java?ref=82295fe1eaaeab86517c191c1d44dfe3f0b34d2a",
                "deletions": 1,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/structure/util/star/StarGraph.java",
                "patch": "@@ -290,7 +290,9 @@ public void dropVertexProperties(final String... propertyKeys) {\n         public Edge addEdge(final String label, final Vertex inVertex, final Object... keyValues) {\n             final Edge edge = this.addOutEdge(label, inVertex, keyValues);\n             if (inVertex.equals(this)) {\n-                List<Edge> inE = inEdges.get(label);\n+                if(null == this.inEdges)\n+                    this.inEdges = new HashMap<>();\n+                List<Edge> inE = this.inEdges.get(label);\n                 if (null == inE) {\n                     inE = new ArrayList<>();\n                     this.inEdges.put(label, inE);",
                "raw_url": "https://github.com/apache/tinkerpop/raw/82295fe1eaaeab86517c191c1d44dfe3f0b34d2a/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/structure/util/star/StarGraph.java",
                "sha": "f51663055068b592135184bf86bfea5c19f3c31f",
                "status": "modified"
            },
            {
                "additions": 16,
                "blob_url": "https://github.com/apache/tinkerpop/blob/82295fe1eaaeab86517c191c1d44dfe3f0b34d2a/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/structure/util/star/StarGraphTest.java",
                "changes": 16,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/structure/util/star/StarGraphTest.java?ref=82295fe1eaaeab86517c191c1d44dfe3f0b34d2a",
                "deletions": 0,
                "filename": "gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/structure/util/star/StarGraphTest.java",
                "patch": "@@ -229,8 +229,24 @@ public void shouldHandleSelfLoops() {\n         TestHelper.validateVertexEquality(vertex, starGraph.getStarVertex(), true);\n         TestHelper.validateVertexEquality(vertex, starGraphCopy.getStarVertex(), true);\n         TestHelper.validateVertexEquality(starGraph.getStarVertex(), starGraphCopy.getStarVertex(), true);\n+        // test native non-clone-based methods\n+        final StarGraph starGraphNative = StarGraph.open();\n+        Vertex v1 = starGraphNative.addVertex(T.label, \"thing\", T.id, \"v1\");\n+        assertEquals(\"v1\", v1.id());\n+        assertEquals(\"thing\", v1.label());\n+        Edge e1 = v1.addEdge(\"self\", v1, \"name\", \"pipes\");\n+        assertEquals(2l, IteratorUtils.count(v1.vertices(Direction.BOTH, \"self\", \"nothing\")));\n+        assertEquals(1l, IteratorUtils.count(v1.vertices(Direction.OUT)));\n+        assertEquals(1l, IteratorUtils.count(v1.vertices(Direction.IN, \"self\")));\n+        edgeIterator = v1.edges(Direction.BOTH);\n+        TestHelper.validateEdgeEquality(e1, edgeIterator.next());\n+        TestHelper.validateEdgeEquality(e1, edgeIterator.next());\n+        assertFalse(edgeIterator.hasNext());\n+        TestHelper.validateEdgeEquality(e1, v1.edges(Direction.OUT, \"self\", \"nothing\").next());\n+        TestHelper.validateEdgeEquality(e1, v1.edges(Direction.IN).next());\n     }\n \n+\n     private Pair<StarGraph, Integer> serializeDeserialize(final StarGraph starGraph) {\n         final ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n         try {",
                "raw_url": "https://github.com/apache/tinkerpop/raw/82295fe1eaaeab86517c191c1d44dfe3f0b34d2a/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/structure/util/star/StarGraphTest.java",
                "sha": "034afad089525e69be021a99a39538238946cdac",
                "status": "modified"
            }
        ],
        "message": "an untested addEdge method is now tested and the NPE thrown is now not there. Thank you @dalaro.",
        "parent": "https://github.com/apache/tinkerpop/commit/0563ec36bb823d617acde6a15217c2b61471408d",
        "repo": "tinkerpop",
        "unit_tests": [
            "StarGraphTest.java"
        ]
    },
    "tinkerpop_b195b62": {
        "bug_id": "tinkerpop_b195b62",
        "commit": "https://github.com/apache/tinkerpop/commit/b195b623d02dcfb5bf188ab10fba2e7a7ef399c7",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tinkerpop/blob/b195b623d02dcfb5bf188ab10fba2e7a7ef399c7/hadoop-gremlin/src/main/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritable.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/hadoop-gremlin/src/main/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritable.java?ref=b195b623d02dcfb5bf188ab10fba2e7a7ef399c7",
                "deletions": 3,
                "filename": "hadoop-gremlin/src/main/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritable.java",
                "patch": "@@ -36,6 +36,7 @@\n  */\n public final class ObjectWritable<T> implements WritableComparable<ObjectWritable>, Serializable {\n \n+    private static final String NULL = \"null\";\n     private static final ObjectWritable<MapReduce.NullObject> NULL_OBJECT_WRITABLE = new ObjectWritable<>(MapReduce.NullObject.instance());\n \n     T t;\n@@ -57,7 +58,7 @@ public void set(final T t) {\n \n     @Override\n     public String toString() {\n-        return this.t.toString();\n+        return null == this.t ? NULL : this.t.toString();\n     }\n \n     @Override\n@@ -97,7 +98,9 @@ private void readObject(final ObjectInputStream inputStream) throws IOException,\n \n     @Override\n     public int compareTo(final ObjectWritable objectWritable) {\n-        if (this.t instanceof Comparable)\n+        if (null == this.t)\n+            return objectWritable.isEmpty() ? 0 : -1;\n+        else if (this.t instanceof Comparable && !objectWritable.isEmpty())\n             return ((Comparable) this.t).compareTo(objectWritable.get());\n         else if (this.t.equals(objectWritable.get()))\n             return 0;\n@@ -110,7 +113,7 @@ public boolean isEmpty() {\n     }\n \n     public static ObjectWritable empty() {\n-        return new ObjectWritable(null);\n+        return new ObjectWritable<>(null);\n     }\n \n     @Override",
                "raw_url": "https://github.com/apache/tinkerpop/raw/b195b623d02dcfb5bf188ab10fba2e7a7ef399c7/hadoop-gremlin/src/main/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritable.java",
                "sha": "9e101ef84f0b1357c06607acc270f5aed181516d",
                "status": "modified"
            },
            {
                "additions": 49,
                "blob_url": "https://github.com/apache/tinkerpop/blob/b195b623d02dcfb5bf188ab10fba2e7a7ef399c7/hadoop-gremlin/src/test/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritableTest.java",
                "changes": 49,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/hadoop-gremlin/src/test/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritableTest.java?ref=b195b623d02dcfb5bf188ab10fba2e7a7ef399c7",
                "deletions": 0,
                "filename": "hadoop-gremlin/src/test/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritableTest.java",
                "patch": "@@ -0,0 +1,49 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.tinkerpop.gremlin.hadoop.structure.io;\n+\n+import org.junit.Test;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+\n+/**\n+ * @author Marko A. Rodriguez (http://markorodriguez.com)\n+ */\n+public class ObjectWritableTest {\n+\n+    @Test\n+    public void shouldNotHaveANullPointerException() {\n+        final ObjectWritable object = new ObjectWritable<>(null);\n+        assertNull(object.get());\n+        assertTrue(object.isEmpty());\n+        assertTrue(object.equals(ObjectWritable.empty()));\n+        assertFalse(object.equals(new ObjectWritable<>(\"hello\")));\n+        assertEquals(\"null\", object.toString());\n+        assertEquals(-1, object.compareTo(new ObjectWritable<>(\"blah\")));\n+        assertEquals(-1, new ObjectWritable<>(\"bloop\").compareTo(ObjectWritable.empty()));\n+        assertEquals(-1, new ObjectWritable<>(\"bloop\").compareTo(object));\n+        assertEquals(0, ObjectWritable.empty().compareTo(object));\n+        assertEquals(0, object.compareTo(ObjectWritable.empty()));\n+        assertEquals(0, object.compareTo(object));\n+    }\n+}",
                "raw_url": "https://github.com/apache/tinkerpop/raw/b195b623d02dcfb5bf188ab10fba2e7a7ef399c7/hadoop-gremlin/src/test/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritableTest.java",
                "sha": "12f4694c03cb65ea384970e21c54fa7e97d3f742",
                "status": "added"
            }
        ],
        "message": "added NPE protection to ObjectWritable and added ObjectWritableTest which ensure ObjectWritable is comparable, gettable, toStringable, etc. even when its empty() -- that is, this.t == null. CTR. Fixed TINKERPOP-1251",
        "parent": "https://github.com/apache/tinkerpop/commit/45c4303125ffdec915b66258d560e7b9d86bcec5",
        "repo": "tinkerpop",
        "unit_tests": [
            "ObjectWritableTest.java"
        ]
    },
    "tinkerpop_c890ceb": {
        "bug_id": "tinkerpop_c890ceb",
        "commit": "https://github.com/apache/tinkerpop/commit/c890cebad5231cdab8744878bebb4ea363689a3a",
        "file": [
            {
                "additions": 110,
                "blob_url": "https://github.com/apache/tinkerpop/blob/c890cebad5231cdab8744878bebb4ea363689a3a/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroupStep.java",
                "changes": 210,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroupStep.java?ref=c890cebad5231cdab8744878bebb4ea363689a3a",
                "deletions": 100,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroupStep.java",
                "patch": "@@ -29,7 +29,6 @@\n import org.apache.tinkerpop.gremlin.process.traversal.lambda.TokenTraversal;\n import org.apache.tinkerpop.gremlin.process.traversal.step.Barrier;\n import org.apache.tinkerpop.gremlin.process.traversal.step.ByModulating;\n-import org.apache.tinkerpop.gremlin.process.traversal.step.GraphComputing;\n import org.apache.tinkerpop.gremlin.process.traversal.step.TraversalParent;\n import org.apache.tinkerpop.gremlin.process.traversal.step.util.ReducingBarrierStep;\n import org.apache.tinkerpop.gremlin.process.traversal.traverser.TraverserRequirement;\n@@ -39,32 +38,32 @@\n import org.apache.tinkerpop.gremlin.structure.util.StringFactory;\n import org.apache.tinkerpop.gremlin.util.function.HashMapSupplier;\n import org.apache.tinkerpop.gremlin.util.iterator.IteratorUtils;\n+import org.javatuples.Pair;\n \n import java.io.Serializable;\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n-import java.util.Optional;\n import java.util.Set;\n import java.util.function.BinaryOperator;\n \n /**\n  * @author Marko A. Rodriguez (http://markorodriguez.com)\n  */\n-public final class GroupStep<S, K, V> extends ReducingBarrierStep<S, Map<K, V>> implements ByModulating, TraversalParent, GraphComputing {\n+public final class GroupStep<S, K, V> extends ReducingBarrierStep<S, Map<K, V>> implements ByModulating, TraversalParent {\n \n     private char state = 'k';\n     private Traversal.Admin<S, K> keyTraversal = null;\n-    private Traversal.Admin<S, V> valueTraversal = this.integrateChild(__.fold().asAdmin());\n-    private Traversal.Admin<S, ?> preTraversal = null;      // used in OLAP\n-    private ReducingBarrierStep reducingBarrierStep = null; // used in OLAP\n-    private boolean onGraphComputer = false;\n+    private Traversal.Admin<S, ?> preTraversal;\n+    private Traversal.Admin<S, V> valueTraversal;\n \n     public GroupStep(final Traversal.Admin traversal) {\n         super(traversal);\n-        this.setReducingBiOperator(new GroupBiOperator<>(this.valueTraversal, this.onGraphComputer));\n+        this.valueTraversal = this.integrateChild(__.fold().asAdmin());\n+        this.preTraversal = this.integrateChild(splitOnBarrierStep(this.valueTraversal).get(0));\n+        this.setReducingBiOperator(new GroupBiOperator<>(this.valueTraversal));\n         this.setSeedSupplier(HashMapSupplier.instance());\n     }\n \n@@ -75,7 +74,8 @@ public void modulateBy(final Traversal.Admin<?, ?> kvTraversal) {\n             this.state = 'v';\n         } else if ('v' == this.state) {\n             this.valueTraversal = this.integrateChild(convertValueTraversal(kvTraversal));\n-            this.setReducingBiOperator(new GroupBiOperator<>(this.valueTraversal, this.onGraphComputer));\n+            this.preTraversal = this.integrateChild(splitOnBarrierStep(this.valueTraversal).get(0));\n+            this.setReducingBiOperator(new GroupBiOperator<>(this.valueTraversal));\n             this.state = 'x';\n         } else {\n             throw new IllegalStateException(\"The key and value traversals for group()-step have already been set: \" + this);\n@@ -85,21 +85,11 @@ public void modulateBy(final Traversal.Admin<?, ?> kvTraversal) {\n     @Override\n     public Map<K, V> projectTraverser(final Traverser.Admin<S> traverser) {\n         final Map<K, V> map = new HashMap<>(1);\n-        final K key = TraversalUtil.applyNullable(traverser, this.keyTraversal);\n-        if (this.onGraphComputer) {\n-            if (null == this.reducingBarrierStep) {\n-                final TraverserSet traverserSet = new TraverserSet();\n-                this.preTraversal.reset();\n-                this.preTraversal.addStart(traverser.split());\n-                this.preTraversal.getEndStep().forEachRemaining(traverserSet::add);\n-                map.put(key, (V) traverserSet);\n-            } else {\n-                this.valueTraversal.reset();\n-                this.valueTraversal.addStart(traverser.split());\n-                map.put(key, (V) this.reducingBarrierStep.nextBarrier());\n-            }\n-        } else\n-            map.put(key, (V) traverser);\n+        final TraverserSet traverserSet = new TraverserSet<>();\n+        this.preTraversal.reset();\n+        this.preTraversal.addStart(traverser.split());\n+        this.preTraversal.getEndStep().forEachRemaining(traverserSet::add);\n+        map.put(TraversalUtil.applyNullable(traverser, this.keyTraversal), (V) traverserSet);\n         return map;\n     }\n \n@@ -128,11 +118,7 @@ public String toString() {\n         if (null != this.keyTraversal)\n             clone.keyTraversal = this.keyTraversal.clone();\n         clone.valueTraversal = this.valueTraversal.clone();\n-        if (null != this.preTraversal)\n-            clone.preTraversal = this.preTraversal.clone();\n-        final Optional<Barrier> optional = TraversalHelper.getFirstStepOfAssignableClass(Barrier.class, clone.valueTraversal);\n-        if (optional.isPresent() && optional.get() instanceof ReducingBarrierStep)\n-            clone.reducingBarrierStep = (ReducingBarrierStep) optional.get();\n+        clone.preTraversal = this.integrateChild(GroupStep.splitOnBarrierStep(clone.valueTraversal).get(0));\n         return clone;\n     }\n \n@@ -154,37 +140,19 @@ public int hashCode() {\n \n     @Override\n     public Map<K, V> generateFinalResult(final Map<K, V> object) {\n-        return GroupStep.doFinalReduction((Map<K, Object>) object, this.valueTraversal, this.onGraphComputer);\n-    }\n-\n-    @Override\n-    public void onGraphComputer() {\n-        this.preTraversal = this.integrateChild(splitOnBarrierStep(this.valueTraversal).get(0));\n-        final Optional<Barrier> optional = TraversalHelper.getFirstStepOfAssignableClass(Barrier.class, this.valueTraversal);\n-        if (optional.isPresent() && optional.get() instanceof ReducingBarrierStep)\n-            this.reducingBarrierStep = (ReducingBarrierStep) optional.get();\n-        this.setReducingBiOperator(new GroupBiOperator<>(this.valueTraversal, this.onGraphComputer = true));\n+        return GroupStep.doFinalReduction((Map<K, Object>) object, this.valueTraversal);\n     }\n \n     ///////////////////////\n \n     public static final class GroupBiOperator<K, V> implements BinaryOperator<Map<K, V>>, Serializable {\n \n-        private boolean onGraphComputer;\n-        private BinaryOperator reducingBinaryOperator;          // OLAP (w/ reducer)\n-        private transient Traversal.Admin<?, V> valueTraversal; // OLTP\n-        private transient Map<K, Integer> counters;             // OLTP\n+        private Traversal.Admin<?, V> valueTraversal;\n+        private ReducingBarrierStep reducingBarrierStep = null;\n \n-        public GroupBiOperator(final Traversal.Admin<?, V> valueTraversal, final boolean onGraphComputer) {\n-            this.onGraphComputer = onGraphComputer;\n-            if (this.onGraphComputer) {\n-                final Optional<Barrier> optional = TraversalHelper.getFirstStepOfAssignableClass(Barrier.class, valueTraversal);\n-                if (optional.isPresent() && optional.get() instanceof ReducingBarrierStep)\n-                    this.reducingBinaryOperator = ((ReducingBarrierStep) optional.get()).getBiOperator();\n-            } else {\n-                this.valueTraversal = valueTraversal;\n-                this.counters = new HashMap<>();\n-            }\n+        public GroupBiOperator(final Traversal.Admin<?, V> valueTraversal) {\n+            this.valueTraversal = valueTraversal.clone();\n+            this.reducingBarrierStep = TraversalHelper.getFirstStepOfAssignableClass(ReducingBarrierStep.class, this.valueTraversal).orElse(null);\n         }\n \n         public GroupBiOperator() {\n@@ -194,43 +162,84 @@ public GroupBiOperator() {\n         @Override\n         public Map<K, V> apply(final Map<K, V> mapA, final Map<K, V> mapB) {\n             for (final K key : mapB.keySet()) {\n-                if (this.onGraphComputer) {\n-                    final Object objectB = mapB.get(key);\n-                    if (null != this.reducingBinaryOperator) {\n-                        // OLAP -- if there is a mid-traversal, apply the binary reducer and propagate the mutating barrier\n-                        final Object objectA = mapA.get(key);\n-                        mapA.put(key, (V) (null == objectA ? objectB : this.reducingBinaryOperator.apply(objectA, objectB)));\n-                    } else {\n-                        // OLAP -- if there is no mid-traversal reducer, aggregate pre-barrier traversers into a traverser set (expensive, but that's that)\n-                        final Object objectA = mapA.get(key);\n-                        final TraverserSet traverserSet;\n-                        if (null == objectA) {\n-                            traverserSet = new TraverserSet();\n-                            mapA.put(key, (V) traverserSet);\n-                        } else\n-                            traverserSet = (TraverserSet) objectA;\n-                        traverserSet.addAll((TraverserSet) objectB);\n-                    }\n+                Object objectA = mapA.get(key);\n+                final Object objectB = mapB.get(key);\n+                assert null != objectB;\n+                if (null == objectA) {\n+                    objectA = objectB;\n                 } else {\n-                    // OLTP -- do mid-barrier reductions if they exist, else don't. Bulking is also available here because of addStart() prior to barrier.\n-                    final Traverser.Admin traverser = (Traverser.Admin) mapB.get(key);\n-                    Traversal.Admin valueTraversalClone = (Traversal.Admin) mapA.get(key);\n-                    if (null == valueTraversalClone) {\n-                        this.counters.put(key, 0);\n-                        valueTraversalClone = this.valueTraversal.clone();\n-                        mapA.put(key, (V) valueTraversalClone);\n-                    }\n-                    valueTraversalClone.addStart(traverser);\n-                    if (this.counters.compute(key, (k, i) -> ++i) > 1000) {\n-                        this.counters.put(key, 0);\n-                        TraversalHelper.getFirstStepOfAssignableClass(Barrier.class, valueTraversalClone).ifPresent(Barrier::processAllStarts);\n+                    if (objectA instanceof TraverserSet) {\n+                        if (objectB instanceof TraverserSet) {\n+                            final TraverserSet set = (TraverserSet) objectA;\n+                            set.addAll((TraverserSet) objectB);\n+                            if (null != this.reducingBarrierStep && set.size() > 1000) {\n+                                this.valueTraversal.reset();\n+                                this.reducingBarrierStep.addStarts(set.iterator());\n+                                objectA = this.reducingBarrierStep.nextBarrier();\n+                            }\n+                        } else if (objectB instanceof Pair) {\n+                            final TraverserSet set = (TraverserSet) objectA;\n+                            set.addAll((TraverserSet) ((Pair) objectB).getValue0());\n+                            if (set.size() > 1000) {\n+                                this.valueTraversal.reset();\n+                                this.reducingBarrierStep.addStarts(set.iterator());\n+                                this.reducingBarrierStep.addBarrier(((Pair) objectB).getValue1());\n+                                objectA = this.reducingBarrierStep.nextBarrier();\n+                            } else {\n+                                objectA = Pair.with(set, ((Pair) objectB).getValue1());\n+                            }\n+                        } else {\n+                            objectA = Pair.with(objectA, objectB);\n+                        }\n+                    } else if (objectA instanceof Pair) {\n+                        if (objectB instanceof TraverserSet) {\n+                            final TraverserSet set = (TraverserSet) ((Pair) objectA).getValue0();\n+                            set.addAll((TraverserSet) objectB);\n+                            if (null != this.reducingBarrierStep &&set.size() > 1000) {\n+                                this.valueTraversal.reset();\n+                                this.reducingBarrierStep.addStarts(set.iterator());\n+                                this.reducingBarrierStep.addBarrier(((Pair) objectA).getValue1());\n+                                objectA = this.reducingBarrierStep.nextBarrier();\n+                            }\n+                        } else if (objectB instanceof Pair) {\n+                            this.valueTraversal.reset();\n+                            this.reducingBarrierStep.addBarrier(((Pair) objectA).getValue1());\n+                            this.reducingBarrierStep.addBarrier(((Pair) objectB).getValue1());\n+                            this.reducingBarrierStep.addStarts(((TraverserSet) ((Pair) objectA).getValue0()).iterator());\n+                            this.reducingBarrierStep.addStarts(((TraverserSet) ((Pair) objectB).getValue0()).iterator());\n+                            objectA = this.reducingBarrierStep.nextBarrier();\n+                        } else {\n+                            this.valueTraversal.reset();\n+                            this.reducingBarrierStep.addBarrier(((Pair) objectA).getValue1());\n+                            this.reducingBarrierStep.addBarrier(objectB);\n+                            this.reducingBarrierStep.addStarts(((TraverserSet) ((Pair) objectA).getValue0()).iterator());\n+                            objectA = this.reducingBarrierStep.nextBarrier();\n+                        }\n+                    } else {\n+                        if (objectB instanceof TraverserSet) {\n+                            objectA = Pair.with(objectB, objectA);\n+                        } else if (objectB instanceof Pair) {\n+                            this.valueTraversal.reset();\n+                            this.reducingBarrierStep.addBarrier(objectA);\n+                            this.reducingBarrierStep.addBarrier(((Pair) objectB).getValue1());\n+                            this.reducingBarrierStep.addStarts(((TraverserSet) ((Pair) objectB).getValue0()).iterator());\n+                            objectA = this.reducingBarrierStep.nextBarrier();\n+                        } else {\n+                            this.valueTraversal.reset();\n+                            this.reducingBarrierStep.addBarrier(objectA);\n+                            this.reducingBarrierStep.addBarrier(objectB);\n+                            objectA = this.reducingBarrierStep.nextBarrier();\n+                        }\n                     }\n                 }\n+                mapA.put(key, (V) objectA);\n             }\n             return mapA;\n+\n         }\n     }\n \n+\n     ///////////////////////\n \n     public static <S, E> Traversal.Admin<S, E> convertValueTraversal(final Traversal.Admin<S, E> valueTraversal) {\n@@ -263,30 +272,31 @@ public GroupBiOperator() {\n         }\n     }\n \n-    public static <K, V> Map<K, V> doFinalReduction(final Map<K, Object> map, final Traversal.Admin<?, V> valueTraversal, final boolean onGraphComputer) {\n+    public static <K, V> Map<K, V> doFinalReduction(final Map<K, Object> map, final Traversal.Admin<?, V> valueTraversal) {\n         final Map<K, V> reducedMap = new HashMap<>(map.size());\n-        // if not on OLAP, who cares --- don't waste time computing barriers\n-        final boolean hasReducingBarrier = onGraphComputer &&\n-                TraversalHelper.getFirstStepOfAssignableClass(Barrier.class, valueTraversal).isPresent() &&\n-                TraversalHelper.getFirstStepOfAssignableClass(Barrier.class, valueTraversal).get() instanceof ReducingBarrierStep;\n-        final Traversal.Admin<?, ?> postTraversal = (onGraphComputer & !hasReducingBarrier) ? splitOnBarrierStep(valueTraversal.clone()).get(1) : null;\n+        final ReducingBarrierStep reducingBarrierStep = TraversalHelper.getFirstStepOfAssignableClass(ReducingBarrierStep.class, valueTraversal).orElse(null);\n         IteratorUtils.removeOnNext(map.entrySet().iterator()).forEachRemaining(entry -> {\n-            if (onGraphComputer) {\n-                if (hasReducingBarrier) {   // OLAP with reduction (barrier)\n-                    valueTraversal.reset();\n-                    TraversalHelper.getFirstStepOfAssignableClass(Barrier.class, valueTraversal).get().addBarrier(entry.getValue());\n-                    reducedMap.put(entry.getKey(), valueTraversal.next());\n-                } else {                    // OLAP without reduction (traverser set)\n-                    postTraversal.reset();\n-                    postTraversal.addStarts(((TraverserSet) entry.getValue()).iterator());\n-                    reducedMap.put(entry.getKey(), (V) postTraversal.next());\n-                }\n-            } else                          // OLTP is just a traversal\n-                reducedMap.put(entry.getKey(), ((Traversal.Admin<?, V>) entry.getValue()).next());\n+            valueTraversal.reset();\n+            if (null == reducingBarrierStep) {\n+                reducedMap.put(entry.getKey(), entry.getValue() instanceof TraverserSet ?\n+                        ((TraverserSet<V>) entry.getValue()).iterator().next().get() :\n+                        (V) entry.getValue());\n+            } else {\n+                if (entry.getValue() instanceof TraverserSet)\n+                    reducingBarrierStep.addStarts(((TraverserSet) entry.getValue()).iterator());\n+                else if (entry.getValue() instanceof Pair) {\n+                    reducingBarrierStep.addStarts(((TraverserSet) (((Pair) entry.getValue()).getValue0())).iterator());\n+                    reducingBarrierStep.addBarrier((((Pair) entry.getValue()).getValue1()));\n+                } else\n+                    reducingBarrierStep.addBarrier(entry.getValue());\n+                reducedMap.put(entry.getKey(), valueTraversal.next());\n+            }\n         });\n         assert map.isEmpty();\n         map.clear();\n         map.putAll(reducedMap);\n         return (Map<K, V>) map;\n     }\n }\n+\n+",
                "raw_url": "https://github.com/apache/tinkerpop/raw/c890cebad5231cdab8744878bebb4ea363689a3a/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroupStep.java",
                "sha": "b430d8f8fabfb465a4f8545a6194dfd08326c3ad",
                "status": "modified"
            },
            {
                "additions": 17,
                "blob_url": "https://github.com/apache/tinkerpop/blob/c890cebad5231cdab8744878bebb4ea363689a3a/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupSideEffectStep.java",
                "changes": 59,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupSideEffectStep.java?ref=c890cebad5231cdab8744878bebb4ea363689a3a",
                "deletions": 42,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupSideEffectStep.java",
                "patch": "@@ -21,16 +21,12 @@\n import org.apache.tinkerpop.gremlin.process.traversal.Traversal;\n import org.apache.tinkerpop.gremlin.process.traversal.Traverser;\n import org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.__;\n-import org.apache.tinkerpop.gremlin.process.traversal.step.Barrier;\n import org.apache.tinkerpop.gremlin.process.traversal.step.ByModulating;\n-import org.apache.tinkerpop.gremlin.process.traversal.step.GraphComputing;\n import org.apache.tinkerpop.gremlin.process.traversal.step.SideEffectCapable;\n import org.apache.tinkerpop.gremlin.process.traversal.step.TraversalParent;\n import org.apache.tinkerpop.gremlin.process.traversal.step.map.GroupStep;\n-import org.apache.tinkerpop.gremlin.process.traversal.step.util.ReducingBarrierStep;\n import org.apache.tinkerpop.gremlin.process.traversal.traverser.TraverserRequirement;\n import org.apache.tinkerpop.gremlin.process.traversal.traverser.util.TraverserSet;\n-import org.apache.tinkerpop.gremlin.process.traversal.util.TraversalHelper;\n import org.apache.tinkerpop.gremlin.process.traversal.util.TraversalUtil;\n import org.apache.tinkerpop.gremlin.structure.util.StringFactory;\n import org.apache.tinkerpop.gremlin.util.function.HashMapSupplier;\n@@ -39,27 +35,26 @@\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n-import java.util.Optional;\n import java.util.Set;\n \n /**\n  * @author Marko A. Rodriguez (http://markorodriguez.com)\n  */\n-public final class GroupSideEffectStep<S, K, V> extends SideEffectStep<S> implements SideEffectCapable<Map<K, ?>, Map<K, V>>, TraversalParent, ByModulating, GraphComputing {\n+public final class GroupSideEffectStep<S, K, V> extends SideEffectStep<S> implements SideEffectCapable<Map<K, ?>, Map<K, V>>, TraversalParent, ByModulating {\n \n     private char state = 'k';\n     private Traversal.Admin<S, K> keyTraversal = null;\n+    private Traversal.Admin<S, ?> preTraversal = null;\n     private Traversal.Admin<S, V> valueTraversal = this.integrateChild(__.fold().asAdmin());\n-    private Traversal.Admin<S, ?> preTraversal = null;      // used in OLAP\n-    private ReducingBarrierStep reducingBarrierStep = null; // used in OLAP\n-    private boolean onGraphComputer = false;\n     ///\n     private String sideEffectKey;\n \n     public GroupSideEffectStep(final Traversal.Admin traversal, final String sideEffectKey) {\n         super(traversal);\n         this.sideEffectKey = sideEffectKey;\n-        this.getTraversal().getSideEffects().registerIfAbsent(this.sideEffectKey, HashMapSupplier.instance(), new GroupStep.GroupBiOperator<>(this.valueTraversal, this.onGraphComputer));\n+        this.valueTraversal = this.integrateChild(__.fold().asAdmin());\n+        this.preTraversal = this.integrateChild(GroupStep.splitOnBarrierStep(this.valueTraversal).get(0));\n+        this.getTraversal().getSideEffects().registerIfAbsent(this.sideEffectKey, HashMapSupplier.instance(), new GroupStep.GroupBiOperator<>(this.valueTraversal));\n     }\n \n     @Override\n@@ -69,7 +64,8 @@ public void modulateBy(final Traversal.Admin<?, ?> kvTraversal) {\n             this.state = 'v';\n         } else if ('v' == this.state) {\n             this.valueTraversal = this.integrateChild(GroupStep.convertValueTraversal(kvTraversal));\n-            this.getTraversal().getSideEffects().register(this.sideEffectKey, null, new GroupStep.GroupBiOperator<>(this.valueTraversal, this.onGraphComputer));\n+            this.preTraversal = this.integrateChild(GroupStep.splitOnBarrierStep(this.valueTraversal).get(0));\n+            this.getTraversal().getSideEffects().register(this.sideEffectKey, null, new GroupStep.GroupBiOperator<>(this.valueTraversal));\n             this.state = 'x';\n         } else {\n             throw new IllegalStateException(\"The key and value traversals for group()-step have already been set: \" + this);\n@@ -78,22 +74,14 @@ public void modulateBy(final Traversal.Admin<?, ?> kvTraversal) {\n \n     @Override\n     protected void sideEffect(final Traverser.Admin<S> traverser) {\n-        final Map<K, Object> map = new HashMap<>(1);\n-        final K key = TraversalUtil.applyNullable(traverser, this.keyTraversal);\n-        if (this.onGraphComputer) {\n-            if (null == this.reducingBarrierStep) {\n-                final TraverserSet traverserSet = new TraverserSet<>();\n-                this.preTraversal.reset();\n-                this.preTraversal.addStart(traverser.split());\n-                this.preTraversal.getEndStep().forEachRemaining(traverserSet::add);\n-                map.put(key, traverserSet);\n-            } else {\n-                this.valueTraversal.reset();\n-                this.valueTraversal.addStart(traverser.split());\n-                map.put(key, (V) this.reducingBarrierStep.nextBarrier());\n-            }\n-        } else\n-            map.put(key, traverser.split());\n+        final Map<K, V> map = new HashMap<>(1);\n+        final TraverserSet midTraversers = new TraverserSet<>();\n+        this.preTraversal.reset();\n+        this.preTraversal.addStart(traverser.split());\n+        while (this.preTraversal.hasNext()) {\n+            midTraversers.add(this.preTraversal.getEndStep().next());\n+        }\n+        map.put(TraversalUtil.applyNullable(traverser, this.keyTraversal), (V) midTraversers);\n         this.getTraversal().getSideEffects().add(this.sideEffectKey, map);\n     }\n \n@@ -127,11 +115,7 @@ public String toString() {\n         if (null != this.keyTraversal)\n             clone.keyTraversal = this.keyTraversal.clone();\n         clone.valueTraversal = this.valueTraversal.clone();\n-        if (null != this.preTraversal)\n-            clone.preTraversal = this.preTraversal.clone();\n-        final Optional<Barrier> optional = TraversalHelper.getFirstStepOfAssignableClass(Barrier.class, clone.valueTraversal);\n-        if (optional.isPresent() && optional.get() instanceof ReducingBarrierStep)\n-            clone.reducingBarrierStep = (ReducingBarrierStep) optional.get();\n+        clone.preTraversal = this.integrateChild(GroupStep.splitOnBarrierStep(clone.valueTraversal).get(0));\n         return clone;\n     }\n \n@@ -153,15 +137,6 @@ public int hashCode() {\n \n     @Override\n     public Map<K, V> generateFinalResult(final Map<K, ?> object) {\n-        return GroupStep.doFinalReduction((Map<K, Object>) object, this.valueTraversal, this.onGraphComputer);\n-    }\n-\n-    @Override\n-    public void onGraphComputer() {\n-        this.preTraversal = this.integrateChild(GroupStep.splitOnBarrierStep(this.valueTraversal).get(0));\n-        final Optional<Barrier> optional = TraversalHelper.getFirstStepOfAssignableClass(Barrier.class, this.valueTraversal);\n-        if (optional.isPresent() && optional.get() instanceof ReducingBarrierStep)\n-            this.reducingBarrierStep = (ReducingBarrierStep) optional.get();\n-        this.getTraversal().getSideEffects().register(this.sideEffectKey, null, new GroupStep.GroupBiOperator<>(this.valueTraversal, this.onGraphComputer = true));\n+        return GroupStep.doFinalReduction((Map<K, Object>) object, this.valueTraversal);\n     }\n }",
                "raw_url": "https://github.com/apache/tinkerpop/raw/c890cebad5231cdab8744878bebb4ea363689a3a/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupSideEffectStep.java",
                "sha": "4fc4ffad2740fef5d29e30e14587043cd796ec56",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tinkerpop/blob/c890cebad5231cdab8744878bebb4ea363689a3a/gremlin-groovy-test/src/main/groovy/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroovyGroupTest.groovy",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-groovy-test/src/main/groovy/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroovyGroupTest.groovy?ref=c890cebad5231cdab8744878bebb4ea363689a3a",
                "deletions": 0,
                "filename": "gremlin-groovy-test/src/main/groovy/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroovyGroupTest.groovy",
                "patch": "@@ -108,5 +108,10 @@ public abstract class GroovyGroupTest {\n         public Traversal<Vertex, Map<String, Map<Object, Object>>> get_g_V_repeatXunionXoutXknowsX_groupXaX_byXageX__outXcreatedX_groupXbX_byXnameX_byXcountXX_groupXaX_byXnameXX_timesX2X_capXa_bX() {\n             new ScriptTraversal<>(g, \"gremlin-groovy\", \"g.V.repeat(union(out('knows').group('a').by('age'), out('created').group('b').by('name').by(count())).group('a').by('name')).times(2).cap('a', 'b')\")\n         }\n+\n+        @Override\n+        public Traversal<Vertex, Map<Long, Map<String, List<Vertex>>>> get_g_V_group_byXbothE_countX_byXgroup_byXlabelXX() {\n+            new ScriptTraversal<>(g, \"gremlin-groovy\", \"g.V.group().by(bothE().count).by(group.by(label))\")\n+        }\n     }\n }",
                "raw_url": "https://github.com/apache/tinkerpop/raw/c890cebad5231cdab8744878bebb4ea363689a3a/gremlin-groovy-test/src/main/groovy/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroovyGroupTest.groovy",
                "sha": "ddfb94a02c0b937d3617e2f23f07a45220e7605b",
                "status": "modified"
            },
            {
                "additions": 42,
                "blob_url": "https://github.com/apache/tinkerpop/blob/c890cebad5231cdab8744878bebb4ea363689a3a/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupTest.java",
                "changes": 42,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupTest.java?ref=c890cebad5231cdab8744878bebb4ea363689a3a",
                "deletions": 0,
                "filename": "gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupTest.java",
                "patch": "@@ -84,6 +84,8 @@\n \n     public abstract Traversal<Vertex, Map<String, Map<Object, Object>>> get_g_V_repeatXunionXoutXknowsX_groupXaX_byXageX__outXcreatedX_groupXbX_byXnameX_byXcountXX_groupXaX_byXnameXX_timesX2X_capXa_bX();\n \n+    public abstract Traversal<Vertex, Map<Long, Map<String, List<Vertex>>>> get_g_V_group_byXbothE_countX_byXgroup_byXlabelXX();\n+\n     @Test\n     @LoadGraphWith(MODERN)\n     public void g_V_group_byXnameX() {\n@@ -356,6 +358,41 @@ public void g_V_repeatXunionXoutXknowsX_groupXaX_byXageX__outXcreatedX_groupXbX_\n         checkSideEffects(traversal.asAdmin().getSideEffects(), \"a\", HashMap.class, \"b\", HashMap.class);\n     }\n \n+    @Test\n+    @LoadGraphWith(MODERN)\n+    public void g_V_group_byXbothE_countX_byXgroup_byXlabelXX() {\n+        final Traversal<Vertex, Map<Long, Map<String, List<Vertex>>>> traversal = get_g_V_group_byXbothE_countX_byXgroup_byXlabelXX();\n+        final Map<Long, Map<String, List<Vertex>>> map = traversal.next();\n+        assertFalse(traversal.hasNext());\n+        assertEquals(2, map.size());\n+        assertTrue(map.containsKey(1l));\n+        assertTrue(map.containsKey(3l));\n+        //\n+        Map<String, List<Vertex>> submap = map.get(1l);\n+        assertEquals(2, submap.size());\n+        assertTrue(submap.containsKey(\"software\"));\n+        assertTrue(submap.containsKey(\"person\"));\n+        List<Vertex> list = submap.get(\"software\");\n+        assertEquals(1, list.size());\n+        assertEquals(convertToVertex(graph, \"ripple\"), list.get(0));\n+        list = submap.get(\"person\");\n+        assertEquals(2, list.size());\n+        assertTrue(list.contains(convertToVertex(graph, \"vadas\")));\n+        assertTrue(list.contains(convertToVertex(graph, \"peter\")));\n+        //\n+        submap = map.get(3l);\n+        assertEquals(2, submap.size());\n+        assertTrue(submap.containsKey(\"software\"));\n+        assertTrue(submap.containsKey(\"person\"));\n+        list = submap.get(\"software\");\n+        assertEquals(1, list.size());\n+        assertEquals(convertToVertex(graph, \"lop\"), list.get(0));\n+        list = submap.get(\"person\");\n+        assertEquals(2, list.size());\n+        assertTrue(list.contains(convertToVertex(graph, \"marko\")));\n+        assertTrue(list.contains(convertToVertex(graph, \"josh\")));\n+    }\n+\n     public static class Traversals extends GroupTest {\n \n         @Override\n@@ -437,5 +474,10 @@ public void g_V_repeatXunionXoutXknowsX_groupXaX_byXageX__outXcreatedX_groupXbX_\n         public Traversal<Vertex, Map<String, Map<Object, Object>>> get_g_V_repeatXunionXoutXknowsX_groupXaX_byXageX__outXcreatedX_groupXbX_byXnameX_byXcountXX_groupXaX_byXnameXX_timesX2X_capXa_bX() {\n             return g.V().repeat(__.union(__.out(\"knows\").group(\"a\").by(\"age\"), __.out(\"created\").group(\"b\").by(\"name\").by(count())).group(\"a\").by(\"name\")).times(2).cap(\"a\", \"b\");\n         }\n+\n+        @Override\n+        public Traversal<Vertex, Map<Long, Map<String, List<Vertex>>>> get_g_V_group_byXbothE_countX_byXgroup_byXlabelXX() {\n+            return g.V().<Long, Map<String, List<Vertex>>>group().by(__.bothE().count()).by(__.group().by(T.label));\n+        }\n     }\n }",
                "raw_url": "https://github.com/apache/tinkerpop/raw/c890cebad5231cdab8744878bebb4ea363689a3a/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupTest.java",
                "sha": "d4c4d743cd5c1db62b75b787d54d2e14a2213688",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tinkerpop/blob/c890cebad5231cdab8744878bebb4ea363689a3a/spark-gremlin/src/main/java/org/apache/tinkerpop/gremlin/spark/process/computer/traversal/strategy/optimization/interceptor/SparkStarBarrierInterceptor.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/spark-gremlin/src/main/java/org/apache/tinkerpop/gremlin/spark/process/computer/traversal/strategy/optimization/interceptor/SparkStarBarrierInterceptor.java?ref=c890cebad5231cdab8744878bebb4ea363689a3a",
                "deletions": 1,
                "filename": "spark-gremlin/src/main/java/org/apache/tinkerpop/gremlin/spark/process/computer/traversal/strategy/optimization/interceptor/SparkStarBarrierInterceptor.java",
                "patch": "@@ -126,7 +126,6 @@ else if (endStep instanceof FoldStep) {\n                 }\n             }).fold(endStep.getSeedSupplier().get(), biOperator::apply);\n         } else if (endStep instanceof GroupStep) {\n-            ((GroupStep) endStep).onGraphComputer();\n             final GroupStep.GroupBiOperator<Object, Object> biOperator = (GroupStep.GroupBiOperator) endStep.getBiOperator();\n             result = ((GroupStep) endStep).generateFinalResult(nextRDD.\n                     mapPartitions(partitions -> {",
                "raw_url": "https://github.com/apache/tinkerpop/raw/c890cebad5231cdab8744878bebb4ea363689a3a/spark-gremlin/src/main/java/org/apache/tinkerpop/gremlin/spark/process/computer/traversal/strategy/optimization/interceptor/SparkStarBarrierInterceptor.java",
                "sha": "5c6d7299dc79bdf895d6ff167c0cd494c0d2a16e",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tinkerpop/blob/c890cebad5231cdab8744878bebb4ea363689a3a/tinkergraph-gremlin/src/test/java/org/apache/tinkerpop/gremlin/tinkergraph/structure/TinkerGraphPlayTest.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/tinkergraph-gremlin/src/test/java/org/apache/tinkerpop/gremlin/tinkergraph/structure/TinkerGraphPlayTest.java?ref=c890cebad5231cdab8744878bebb4ea363689a3a",
                "deletions": 2,
                "filename": "tinkergraph-gremlin/src/test/java/org/apache/tinkerpop/gremlin/tinkergraph/structure/TinkerGraphPlayTest.java",
                "patch": "@@ -86,11 +86,11 @@ public void testPlay8() throws Exception {\n     @Ignore\n     public void benchmarkGroup() throws Exception {\n         Graph graph = TinkerGraph.open();\n-        GraphTraversalSource g = graph.traversal().withComputer();\n+        GraphTraversalSource g = graph.traversal();\n         graph.io(GraphMLIo.build()).readGraph(\"../data/grateful-dead.xml\");\n         /////////\n \n-        g.V().group().by(T.label).by(values(\"name\")).forEachRemaining(x -> logger.info(x.toString()));\n+        //g.V().group().by(T.label).by(values(\"name\")).forEachRemaining(x -> logger.info(x.toString()));\n \n         System.out.println(\"group: \" + g.V().both(\"followedBy\").both(\"followedBy\").group().by(\"songType\").by(count()).next());\n         System.out.println(\"groupV3d0: \" + g.V().both(\"followedBy\").both(\"followedBy\").groupV3d0().by(\"songType\").by().by(__.count(Scope.local)).next());",
                "raw_url": "https://github.com/apache/tinkerpop/raw/c890cebad5231cdab8744878bebb4ea363689a3a/tinkergraph-gremlin/src/test/java/org/apache/tinkerpop/gremlin/tinkergraph/structure/TinkerGraphPlayTest.java",
                "sha": "555771645ea1cc7bdcc6fd3d4f950e0f0cd26022",
                "status": "modified"
            }
        ],
        "message": "fixed the NPE that occurs in OLAP when you have a local/OLTP group() nested within an OLAP group(). The solution is elegant, but the problem, its not as efficient as the code when we had the NPE.... dar. Going to fiddle some more tomorrow to see if I can get it faster --- 600ms vs 400ms differences.",
        "parent": "https://github.com/apache/tinkerpop/commit/44d40f60664b8b758f02bc8e04300b931b2c6622",
        "repo": "tinkerpop",
        "unit_tests": [
            "GroupStepTest.java",
            "GroupSideEffectStepTest.java"
        ]
    },
    "tinkerpop_e087123": {
        "bug_id": "tinkerpop_e087123",
        "commit": "https://github.com/apache/tinkerpop/commit/e087123ca9bf513a555b3666a201905df43d8f7c",
        "file": [
            {
                "additions": 104,
                "blob_url": "https://github.com/apache/tinkerpop/blob/e087123ca9bf513a555b3666a201905df43d8f7c/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroupStep.java",
                "changes": 168,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroupStep.java?ref=e087123ca9bf513a555b3666a201905df43d8f7c",
                "deletions": 64,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroupStep.java",
                "patch": "@@ -42,7 +42,6 @@\n \n import java.io.Serializable;\n import java.util.ArrayList;\n-import java.util.Arrays;\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n@@ -62,7 +61,7 @@\n     public GroupStep(final Traversal.Admin traversal) {\n         super(traversal);\n         this.valueTraversal = this.integrateChild(__.fold().asAdmin());\n-        this.preTraversal = this.integrateChild(splitOnBarrierStep(this.valueTraversal).get(0));\n+        this.preTraversal = this.integrateChild(generatePreTraversal(this.valueTraversal));\n         this.setReducingBiOperator(new GroupBiOperator<>(this.valueTraversal));\n         this.setSeedSupplier(HashMapSupplier.instance());\n     }\n@@ -74,7 +73,7 @@ public void modulateBy(final Traversal.Admin<?, ?> kvTraversal) {\n             this.state = 'v';\n         } else if ('v' == this.state) {\n             this.valueTraversal = this.integrateChild(convertValueTraversal(kvTraversal));\n-            this.preTraversal = this.integrateChild(splitOnBarrierStep(this.valueTraversal).get(0));\n+            this.preTraversal = this.integrateChild(generatePreTraversal(this.valueTraversal));\n             this.setReducingBiOperator(new GroupBiOperator<>(this.valueTraversal));\n             this.state = 'x';\n         } else {\n@@ -85,11 +84,15 @@ public void modulateBy(final Traversal.Admin<?, ?> kvTraversal) {\n     @Override\n     public Map<K, V> projectTraverser(final Traverser.Admin<S> traverser) {\n         final Map<K, V> map = new HashMap<>(1);\n-        final TraverserSet traverserSet = new TraverserSet<>();\n-        this.preTraversal.reset();\n-        this.preTraversal.addStart(traverser.split());\n-        this.preTraversal.getEndStep().forEachRemaining(traverserSet::add);\n-        map.put(TraversalUtil.applyNullable(traverser, this.keyTraversal), (V) traverserSet);\n+        if (null == this.preTraversal) {\n+            map.put(TraversalUtil.applyNullable(traverser, this.keyTraversal), (V) traverser.split());\n+        } else {\n+            final TraverserSet traverserSet = new TraverserSet<>();\n+            this.preTraversal.reset();\n+            this.preTraversal.addStart(traverser.split());\n+            this.preTraversal.getEndStep().forEachRemaining(traverserSet::add);\n+            map.put(TraversalUtil.applyNullable(traverser, this.keyTraversal), (V) traverserSet);\n+        }\n         return map;\n     }\n \n@@ -100,7 +103,7 @@ public String toString() {\n \n     @Override\n     public List<Traversal.Admin<?, ?>> getLocalChildren() {\n-        final List<Traversal.Admin<?, ?>> children = new ArrayList<>(4);\n+        final List<Traversal.Admin<?, ?>> children = new ArrayList<>(2);\n         if (null != this.keyTraversal)\n             children.add((Traversal.Admin) this.keyTraversal);\n         children.add(this.valueTraversal);\n@@ -118,7 +121,7 @@ public String toString() {\n         if (null != this.keyTraversal)\n             clone.keyTraversal = this.keyTraversal.clone();\n         clone.valueTraversal = this.valueTraversal.clone();\n-        clone.preTraversal = this.integrateChild(GroupStep.splitOnBarrierStep(clone.valueTraversal).get(0));\n+        clone.preTraversal = this.integrateChild(GroupStep.generatePreTraversal(clone.valueTraversal));\n         return clone;\n     }\n \n@@ -147,12 +150,14 @@ public int hashCode() {\n \n     public static final class GroupBiOperator<K, V> implements BinaryOperator<Map<K, V>>, Serializable {\n \n+        private static final int SIZE_LIMIT = 1000;\n+\n         private Traversal.Admin<?, V> valueTraversal;\n-        private ReducingBarrierStep reducingBarrierStep = null;\n+        private Barrier barrierStep;\n \n         public GroupBiOperator(final Traversal.Admin<?, V> valueTraversal) {\n             this.valueTraversal = valueTraversal.clone();\n-            this.reducingBarrierStep = TraversalHelper.getFirstStepOfAssignableClass(ReducingBarrierStep.class, this.valueTraversal).orElse(null);\n+            this.barrierStep = TraversalHelper.getFirstStepOfAssignableClass(Barrier.class, this.valueTraversal).orElse(null);\n         }\n \n         public GroupBiOperator() {\n@@ -168,74 +173,114 @@ public GroupBiOperator() {\n                 if (null == objectA) {\n                     objectA = objectB;\n                 } else {\n-                    if (objectA instanceof TraverserSet) {\n-                        if (objectB instanceof TraverserSet) {\n+                    if (objectA instanceof Traverser.Admin) {\n+                        if (objectB instanceof Traverser.Admin) {\n+                            final TraverserSet set = new TraverserSet();\n+                            set.add((Traverser.Admin) objectA);\n+                            set.add((Traverser.Admin) objectB);\n+                            objectA = set;\n+                        } else if (objectB instanceof TraverserSet) {\n+                            final TraverserSet set = (TraverserSet) objectB;\n+                            set.add((Traverser.Admin) objectA);\n+                            if (null != this.barrierStep && set.size() > SIZE_LIMIT) {\n+                                this.valueTraversal.reset();\n+                                ((Step) this.barrierStep).addStarts(set.iterator());\n+                                objectA = this.barrierStep.nextBarrier();\n+                            } else {\n+                                objectA = objectB;\n+                            }\n+                        } else if (objectB instanceof Pair) {\n+                            final TraverserSet set = (TraverserSet) ((Pair) objectB).getValue0();\n+                            set.add((Traverser.Admin) objectA);\n+                            if (set.size() > SIZE_LIMIT) {\n+                                this.valueTraversal.reset();\n+                                ((Step) this.barrierStep).addStarts(set.iterator());\n+                                this.barrierStep.addBarrier(((Pair) objectB).getValue1());\n+                                objectA = this.barrierStep.nextBarrier();\n+                            } else {\n+                                objectA = Pair.with(set, ((Pair) objectB).getValue1());\n+                            }\n+                        } else {\n+                            objectA = Pair.with(new TraverserSet((Traverser.Admin) objectA), objectB);\n+                        }\n+                    } else if (objectA instanceof TraverserSet) {\n+                        if (objectB instanceof Traverser.Admin) {\n+                            ((TraverserSet) objectA).add((Traverser.Admin) objectB);\n+                            if (null != this.barrierStep && ((TraverserSet) objectA).size() > SIZE_LIMIT) {\n+                                this.valueTraversal.reset();\n+                                ((Step) this.barrierStep).addStarts(((TraverserSet) objectA).iterator());\n+                                objectA = this.barrierStep.nextBarrier();\n+                            }\n+                        } else if (objectB instanceof TraverserSet) {\n                             final TraverserSet set = (TraverserSet) objectA;\n                             set.addAll((TraverserSet) objectB);\n-                            if (null != this.reducingBarrierStep && set.size() > 1000) {\n+                            if (null != this.barrierStep && set.size() > SIZE_LIMIT) {\n                                 this.valueTraversal.reset();\n-                                this.reducingBarrierStep.addStarts(set.iterator());\n-                                objectA = this.reducingBarrierStep.nextBarrier();\n+                                ((Step) this.barrierStep).addStarts(set.iterator());\n+                                objectA = this.barrierStep.nextBarrier();\n                             }\n                         } else if (objectB instanceof Pair) {\n                             final TraverserSet set = (TraverserSet) objectA;\n                             set.addAll((TraverserSet) ((Pair) objectB).getValue0());\n-                            if (set.size() > 1000) {\n+                            if (set.size() > SIZE_LIMIT) {\n                                 this.valueTraversal.reset();\n-                                this.reducingBarrierStep.addStarts(set.iterator());\n-                                this.reducingBarrierStep.addBarrier(((Pair) objectB).getValue1());\n-                                objectA = this.reducingBarrierStep.nextBarrier();\n+                                ((Step) this.barrierStep).addStarts(set.iterator());\n+                                this.barrierStep.addBarrier(((Pair) objectB).getValue1());\n+                                objectA = this.barrierStep.nextBarrier();\n                             } else {\n                                 objectA = Pair.with(set, ((Pair) objectB).getValue1());\n                             }\n                         } else {\n                             objectA = Pair.with(objectA, objectB);\n                         }\n                     } else if (objectA instanceof Pair) {\n-                        if (objectB instanceof TraverserSet) {\n+                        if (objectB instanceof Traverser.Admin) {\n+                            ((TraverserSet) ((Pair) objectA).getValue0()).add((Traverser.Admin) objectB);\n+                        } else if (objectB instanceof TraverserSet) {\n                             final TraverserSet set = (TraverserSet) ((Pair) objectA).getValue0();\n                             set.addAll((TraverserSet) objectB);\n-                            if (null != this.reducingBarrierStep &&set.size() > 1000) {\n+                            if (null != this.barrierStep && set.size() > SIZE_LIMIT) {\n                                 this.valueTraversal.reset();\n-                                this.reducingBarrierStep.addStarts(set.iterator());\n-                                this.reducingBarrierStep.addBarrier(((Pair) objectA).getValue1());\n-                                objectA = this.reducingBarrierStep.nextBarrier();\n+                                ((Step) this.barrierStep).addStarts(set.iterator());\n+                                this.barrierStep.addBarrier(((Pair) objectA).getValue1());\n+                                objectA = this.barrierStep.nextBarrier();\n                             }\n                         } else if (objectB instanceof Pair) {\n                             this.valueTraversal.reset();\n-                            this.reducingBarrierStep.addBarrier(((Pair) objectA).getValue1());\n-                            this.reducingBarrierStep.addBarrier(((Pair) objectB).getValue1());\n-                            this.reducingBarrierStep.addStarts(((TraverserSet) ((Pair) objectA).getValue0()).iterator());\n-                            this.reducingBarrierStep.addStarts(((TraverserSet) ((Pair) objectB).getValue0()).iterator());\n-                            objectA = this.reducingBarrierStep.nextBarrier();\n+                            this.barrierStep.addBarrier(((Pair) objectA).getValue1());\n+                            this.barrierStep.addBarrier(((Pair) objectB).getValue1());\n+                            ((Step) this.barrierStep).addStarts(((TraverserSet) ((Pair) objectA).getValue0()).iterator());\n+                            ((Step) this.barrierStep).addStarts(((TraverserSet) ((Pair) objectB).getValue0()).iterator());\n+                            objectA = this.barrierStep.nextBarrier();\n                         } else {\n                             this.valueTraversal.reset();\n-                            this.reducingBarrierStep.addBarrier(((Pair) objectA).getValue1());\n-                            this.reducingBarrierStep.addBarrier(objectB);\n-                            this.reducingBarrierStep.addStarts(((TraverserSet) ((Pair) objectA).getValue0()).iterator());\n-                            objectA = this.reducingBarrierStep.nextBarrier();\n+                            this.barrierStep.addBarrier(((Pair) objectA).getValue1());\n+                            this.barrierStep.addBarrier(objectB);\n+                            ((Step) this.barrierStep).addStarts(((TraverserSet) ((Pair) objectA).getValue0()).iterator());\n+                            objectA = this.barrierStep.nextBarrier();\n                         }\n                     } else {\n-                        if (objectB instanceof TraverserSet) {\n+                        if (objectB instanceof Traverser.Admin) {\n+                            objectA = Pair.with(new TraverserSet<>((Traverser.Admin) objectB), objectA);\n+                        } else if (objectB instanceof TraverserSet) {\n                             objectA = Pair.with(objectB, objectA);\n                         } else if (objectB instanceof Pair) {\n                             this.valueTraversal.reset();\n-                            this.reducingBarrierStep.addBarrier(objectA);\n-                            this.reducingBarrierStep.addBarrier(((Pair) objectB).getValue1());\n-                            this.reducingBarrierStep.addStarts(((TraverserSet) ((Pair) objectB).getValue0()).iterator());\n-                            objectA = this.reducingBarrierStep.nextBarrier();\n+                            this.barrierStep.addBarrier(objectA);\n+                            this.barrierStep.addBarrier(((Pair) objectB).getValue1());\n+                            ((Step) this.barrierStep).addStarts(((TraverserSet) ((Pair) objectB).getValue0()).iterator());\n+                            objectA = this.barrierStep.nextBarrier();\n                         } else {\n                             this.valueTraversal.reset();\n-                            this.reducingBarrierStep.addBarrier(objectA);\n-                            this.reducingBarrierStep.addBarrier(objectB);\n-                            objectA = this.reducingBarrierStep.nextBarrier();\n+                            this.barrierStep.addBarrier(objectA);\n+                            this.barrierStep.addBarrier(objectB);\n+                            objectA = this.barrierStep.nextBarrier();\n                         }\n                     }\n                 }\n                 mapA.put(key, (V) objectA);\n             }\n             return mapA;\n-\n         }\n     }\n \n@@ -253,39 +298,34 @@ public GroupBiOperator() {\n         }\n     }\n \n-    public static List<Traversal.Admin<?, ?>> splitOnBarrierStep(final Traversal.Admin<?, ?> valueTraversal) {\n-        if (TraversalHelper.getFirstStepOfAssignableClass(Barrier.class, valueTraversal).isPresent()) {\n-            final Traversal.Admin<?, ?> first = __.identity().asAdmin();\n-            final Traversal.Admin<?, ?> second = __.identity().asAdmin();\n-            boolean onSecond = false;\n-            for (final Step step : valueTraversal.getSteps()) {\n-                if (step instanceof Barrier)\n-                    onSecond = true;\n-                if (onSecond)\n-                    second.addStep(step.clone());\n-                else\n-                    first.addStep(step.clone());\n-            }\n-            return Arrays.asList(first, second);\n-        } else {\n-            return Arrays.asList(valueTraversal.clone(), __.identity().asAdmin());\n+    public static Traversal.Admin<?, ?> generatePreTraversal(final Traversal.Admin<?, ?> valueTraversal) {\n+        if (!TraversalHelper.hasStepOfAssignableClass(Barrier.class, valueTraversal))\n+            return valueTraversal;\n+        final Traversal.Admin<?, ?> first = __.identity().asAdmin();\n+        for (final Step step : valueTraversal.getSteps()) {\n+            if (step instanceof Barrier)\n+                break;\n+            first.addStep(step.clone());\n         }\n+        return first.getSteps().size() == 1 ? null : first;\n     }\n \n     public static <K, V> Map<K, V> doFinalReduction(final Map<K, Object> map, final Traversal.Admin<?, V> valueTraversal) {\n         final Map<K, V> reducedMap = new HashMap<>(map.size());\n-        final ReducingBarrierStep reducingBarrierStep = TraversalHelper.getFirstStepOfAssignableClass(ReducingBarrierStep.class, valueTraversal).orElse(null);\n+        final Barrier reducingBarrierStep = TraversalHelper.getFirstStepOfAssignableClass(Barrier.class, valueTraversal).orElse(null);\n         IteratorUtils.removeOnNext(map.entrySet().iterator()).forEachRemaining(entry -> {\n             valueTraversal.reset();\n             if (null == reducingBarrierStep) {\n                 reducedMap.put(entry.getKey(), entry.getValue() instanceof TraverserSet ?\n                         ((TraverserSet<V>) entry.getValue()).iterator().next().get() :\n                         (V) entry.getValue());\n             } else {\n-                if (entry.getValue() instanceof TraverserSet)\n-                    reducingBarrierStep.addStarts(((TraverserSet) entry.getValue()).iterator());\n+                if (entry.getValue() instanceof Traverser.Admin)\n+                    ((Step) reducingBarrierStep).addStart((Traverser.Admin) entry.getValue());\n+                else if (entry.getValue() instanceof TraverserSet)\n+                    ((Step) reducingBarrierStep).addStarts(((TraverserSet) entry.getValue()).iterator());\n                 else if (entry.getValue() instanceof Pair) {\n-                    reducingBarrierStep.addStarts(((TraverserSet) (((Pair) entry.getValue()).getValue0())).iterator());\n+                    ((Step) reducingBarrierStep).addStarts(((TraverserSet) (((Pair) entry.getValue()).getValue0())).iterator());\n                     reducingBarrierStep.addBarrier((((Pair) entry.getValue()).getValue1()));\n                 } else\n                     reducingBarrierStep.addBarrier(entry.getValue());",
                "raw_url": "https://github.com/apache/tinkerpop/raw/e087123ca9bf513a555b3666a201905df43d8f7c/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroupStep.java",
                "sha": "7a93796b721a5943a2c84a04af689888843111fa",
                "status": "modified"
            },
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/tinkerpop/blob/e087123ca9bf513a555b3666a201905df43d8f7c/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupSideEffectStep.java",
                "changes": 20,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupSideEffectStep.java?ref=e087123ca9bf513a555b3666a201905df43d8f7c",
                "deletions": 9,
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupSideEffectStep.java",
                "patch": "@@ -53,7 +53,7 @@ public GroupSideEffectStep(final Traversal.Admin traversal, final String sideEff\n         super(traversal);\n         this.sideEffectKey = sideEffectKey;\n         this.valueTraversal = this.integrateChild(__.fold().asAdmin());\n-        this.preTraversal = this.integrateChild(GroupStep.splitOnBarrierStep(this.valueTraversal).get(0));\n+        this.preTraversal = this.integrateChild(GroupStep.generatePreTraversal(this.valueTraversal));\n         this.getTraversal().getSideEffects().registerIfAbsent(this.sideEffectKey, HashMapSupplier.instance(), new GroupStep.GroupBiOperator<>(this.valueTraversal));\n     }\n \n@@ -64,7 +64,7 @@ public void modulateBy(final Traversal.Admin<?, ?> kvTraversal) {\n             this.state = 'v';\n         } else if ('v' == this.state) {\n             this.valueTraversal = this.integrateChild(GroupStep.convertValueTraversal(kvTraversal));\n-            this.preTraversal = this.integrateChild(GroupStep.splitOnBarrierStep(this.valueTraversal).get(0));\n+            this.preTraversal = this.integrateChild(GroupStep.generatePreTraversal(this.valueTraversal));\n             this.getTraversal().getSideEffects().register(this.sideEffectKey, null, new GroupStep.GroupBiOperator<>(this.valueTraversal));\n             this.state = 'x';\n         } else {\n@@ -75,13 +75,15 @@ public void modulateBy(final Traversal.Admin<?, ?> kvTraversal) {\n     @Override\n     protected void sideEffect(final Traverser.Admin<S> traverser) {\n         final Map<K, V> map = new HashMap<>(1);\n-        final TraverserSet midTraversers = new TraverserSet<>();\n-        this.preTraversal.reset();\n-        this.preTraversal.addStart(traverser.split());\n-        while (this.preTraversal.hasNext()) {\n-            midTraversers.add(this.preTraversal.getEndStep().next());\n+        if (null == this.preTraversal) {\n+            map.put(TraversalUtil.applyNullable(traverser, this.keyTraversal), (V) traverser.split());\n+        } else {\n+            final TraverserSet traverserSet = new TraverserSet<>();\n+            this.preTraversal.reset();\n+            this.preTraversal.addStart(traverser.split());\n+            this.preTraversal.getEndStep().forEachRemaining(traverserSet::add);\n+            map.put(TraversalUtil.applyNullable(traverser, this.keyTraversal), (V) traverserSet);\n         }\n-        map.put(TraversalUtil.applyNullable(traverser, this.keyTraversal), (V) midTraversers);\n         this.getTraversal().getSideEffects().add(this.sideEffectKey, map);\n     }\n \n@@ -115,7 +117,7 @@ public String toString() {\n         if (null != this.keyTraversal)\n             clone.keyTraversal = this.keyTraversal.clone();\n         clone.valueTraversal = this.valueTraversal.clone();\n-        clone.preTraversal = this.integrateChild(GroupStep.splitOnBarrierStep(clone.valueTraversal).get(0));\n+        clone.preTraversal = this.integrateChild(GroupStep.generatePreTraversal(clone.valueTraversal));\n         return clone;\n     }\n ",
                "raw_url": "https://github.com/apache/tinkerpop/raw/e087123ca9bf513a555b3666a201905df43d8f7c/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroupSideEffectStep.java",
                "sha": "b5deb02c296ec9360668624989e26376c96d865b",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tinkerpop/blob/e087123ca9bf513a555b3666a201905df43d8f7c/gremlin-groovy-test/src/main/groovy/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroovyGroupTest.groovy",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-groovy-test/src/main/groovy/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroovyGroupTest.groovy?ref=e087123ca9bf513a555b3666a201905df43d8f7c",
                "deletions": 1,
                "filename": "gremlin-groovy-test/src/main/groovy/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroovyGroupTest.groovy",
                "patch": "@@ -111,7 +111,7 @@ public abstract class GroovyGroupTest {\n \n         @Override\n         public Traversal<Vertex, Map<Long, Map<String, List<Vertex>>>> get_g_V_group_byXbothE_countX_byXgroup_byXlabelXX() {\n-            new ScriptTraversal<>(g, \"gremlin-groovy\", \"g.V.group().by(bothE().count).by(group.by(label))\")\n+            new ScriptTraversal<>(g, \"gremlin-groovy\", \"g.V.group().by(bothE().count).by(group().by(label))\")\n         }\n     }\n }",
                "raw_url": "https://github.com/apache/tinkerpop/raw/e087123ca9bf513a555b3666a201905df43d8f7c/gremlin-groovy-test/src/main/groovy/org/apache/tinkerpop/gremlin/process/traversal/step/sideEffect/GroovyGroupTest.groovy",
                "sha": "156b350e7fddad9cdf48892ee4fabb7d46d309be",
                "status": "modified"
            }
        ],
        "message": "came up with a nifty trick and now OLD and NEW group() are much closer in time. 432ms vs 456ms. Given that the solution is no longer an NPE in nested groups in OLAP -- this minor time hit is worth it. :). Running integration tests over night.",
        "parent": "https://github.com/apache/tinkerpop/commit/c890cebad5231cdab8744878bebb4ea363689a3a",
        "repo": "tinkerpop",
        "unit_tests": [
            "GroupStepTest.java",
            "GroupSideEffectStepTest.java"
        ]
    },
    "tinkerpop_fa2d626": {
        "bug_id": "tinkerpop_fa2d626",
        "commit": "https://github.com/apache/tinkerpop/commit/fa2d626951f799a0a50191f9653a17b5c18cdc20",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tinkerpop/blob/fa2d626951f799a0a50191f9653a17b5c18cdc20/hadoop-gremlin/src/main/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritable.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/hadoop-gremlin/src/main/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritable.java?ref=fa2d626951f799a0a50191f9653a17b5c18cdc20",
                "deletions": 3,
                "filename": "hadoop-gremlin/src/main/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritable.java",
                "patch": "@@ -36,6 +36,7 @@\n  */\n public final class ObjectWritable<T> implements WritableComparable<ObjectWritable>, Serializable {\n \n+    private static final String NULL = \"null\";\n     private static final ObjectWritable<MapReduce.NullObject> NULL_OBJECT_WRITABLE = new ObjectWritable<>(MapReduce.NullObject.instance());\n \n     T t;\n@@ -57,7 +58,7 @@ public void set(final T t) {\n \n     @Override\n     public String toString() {\n-        return this.t.toString();\n+        return null == this.t ? NULL : this.t.toString();\n     }\n \n     @Override\n@@ -97,7 +98,9 @@ private void readObject(final ObjectInputStream inputStream) throws IOException,\n \n     @Override\n     public int compareTo(final ObjectWritable objectWritable) {\n-        if (this.t instanceof Comparable)\n+        if (null == this.t)\n+            return objectWritable.isEmpty() ? 0 : -1;\n+        else if (this.t instanceof Comparable && !objectWritable.isEmpty())\n             return ((Comparable) this.t).compareTo(objectWritable.get());\n         else if (this.t.equals(objectWritable.get()))\n             return 0;\n@@ -125,7 +128,7 @@ else if (this.isEmpty())\n \n     @Override\n     public int hashCode() {\n-        return this.isEmpty() ? 0 : this.t.hashCode();\n+        return null == this.t ? 0 : this.t.hashCode();\n     }\n \n     public static ObjectWritable<MapReduce.NullObject> getNullObjectWritable() {",
                "raw_url": "https://github.com/apache/tinkerpop/raw/fa2d626951f799a0a50191f9653a17b5c18cdc20/hadoop-gremlin/src/main/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritable.java",
                "sha": "9a07f75723f60b0e2fe7a00758ac3f84eb0dc255",
                "status": "modified"
            },
            {
                "additions": 49,
                "blob_url": "https://github.com/apache/tinkerpop/blob/fa2d626951f799a0a50191f9653a17b5c18cdc20/hadoop-gremlin/src/test/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritableTest.java",
                "changes": 49,
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/hadoop-gremlin/src/test/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritableTest.java?ref=fa2d626951f799a0a50191f9653a17b5c18cdc20",
                "deletions": 0,
                "filename": "hadoop-gremlin/src/test/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritableTest.java",
                "patch": "@@ -0,0 +1,49 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.tinkerpop.gremlin.hadoop.structure.io;\n+\n+import org.junit.Test;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+\n+/**\n+ * @author Marko A. Rodriguez (http://markorodriguez.com)\n+ */\n+public class ObjectWritableTest {\n+\n+    @Test\n+    public void shouldNotHaveANullPointerException() {\n+        final ObjectWritable object = new ObjectWritable<>(null);\n+        assertNull(object.get());\n+        assertTrue(object.isEmpty());\n+        assertTrue(object.equals(ObjectWritable.empty()));\n+        assertFalse(object.equals(new ObjectWritable<>(\"hello\")));\n+        assertEquals(\"null\", object.toString());\n+        assertEquals(-1, object.compareTo(new ObjectWritable<>(\"blah\")));\n+        assertEquals(-1, new ObjectWritable<>(\"bloop\").compareTo(ObjectWritable.empty()));\n+        assertEquals(-1, new ObjectWritable<>(\"bloop\").compareTo(object));\n+        assertEquals(0, ObjectWritable.empty().compareTo(object));\n+        assertEquals(0, object.compareTo(ObjectWritable.empty()));\n+        assertEquals(0, object.compareTo(object));\n+    }\n+}",
                "raw_url": "https://github.com/apache/tinkerpop/raw/fa2d626951f799a0a50191f9653a17b5c18cdc20/hadoop-gremlin/src/test/java/org/apache/tinkerpop/gremlin/hadoop/structure/io/ObjectWritableTest.java",
                "sha": "12f4694c03cb65ea384970e21c54fa7e97d3f742",
                "status": "added"
            }
        ],
        "message": "merged tp31 ObjectWritable NPE fix.",
        "parent": "https://github.com/apache/tinkerpop/commit/ffde3fe419574d587911cc1b3979be042f70e140",
        "repo": "tinkerpop",
        "unit_tests": [
            "ObjectWritableTest.java"
        ]
    }
}