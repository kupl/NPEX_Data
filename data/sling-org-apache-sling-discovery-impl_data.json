[
    {
        "repo": "sling-org-apache-sling-discovery-impl",
        "message": "SLING-3233 NPE in TopologyRequestValidator\nFixed NPE caused by missing http headers if enabled.\n\ngit-svn-id: https://svn.apache.org/repos/asf/sling/trunk@1539358 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/sling-org-apache-sling-discovery-impl/commit/12ba50eb634249d1bd076f5186d99b161873eeb4",
        "parent": "https://github.com/apache/sling-org-apache-sling-discovery-impl/commit/83ba7bdfce10955a9069b297c6f76ddff8104389",
        "bug_id": "sling-org-apache-sling-discovery-impl_1",
        "file": [
            {
                "sha": "d649bb9528a50eed21c63750db27fc7d3bcbae05",
                "filename": "src/main/java/org/apache/sling/discovery/impl/topology/connector/TopologyRequestValidator.java",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-discovery-impl/blob/12ba50eb634249d1bd076f5186d99b161873eeb4/src/main/java/org/apache/sling/discovery/impl/topology/connector/TopologyRequestValidator.java",
                "raw_url": "https://github.com/apache/sling-org-apache-sling-discovery-impl/raw/12ba50eb634249d1bd076f5186d99b161873eeb4/src/main/java/org/apache/sling/discovery/impl/topology/connector/TopologyRequestValidator.java",
                "status": "modified",
                "changes": 5,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-discovery-impl/contents/src/main/java/org/apache/sling/discovery/impl/topology/connector/TopologyRequestValidator.java?ref=12ba50eb634249d1bd076f5186d99b161873eeb4",
                "patch": "@@ -346,6 +346,9 @@ private String createTrustHeader(String bodyHash) {\n      */\n     private boolean checkTrustHeader(String bodyHash, String signature) {\n         try {\n+            if (bodyHash == null || signature == null ) {\n+                return false;\n+            }\n             String[] parts = signature.split(\"/\", 2);\n             int keyNo = Integer.parseInt(parts[0]);\n             return hmac(keyNo, bodyHash).equals(parts[1]);\n@@ -361,6 +364,8 @@ private boolean checkTrustHeader(String bodyHash, String signature) {\n             throw new RuntimeException(e.getMessage(), e);\n         } catch (NoSuchAlgorithmException e) {\n             throw new RuntimeException(e.getMessage(), e);\n+        } catch (Exception e) {\n+            throw new RuntimeException(e.getMessage(), e);\n         }\n     }\n ",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "sling-org-apache-sling-discovery-impl",
        "message": "SLING-5918 : discovery: catching a NPE in a test\n\ngit-svn-id: https://svn.apache.org/repos/asf/sling/trunk@1756373 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/sling-org-apache-sling-discovery-impl/commit/9f3e5c040490781ea9873b29c93e1ef7981a823e",
        "parent": "https://github.com/apache/sling-org-apache-sling-discovery-impl/commit/46f69f47214f08369d805bfea3ad808284d0b394",
        "bug_id": "sling-org-apache-sling-discovery-impl_2",
        "file": [
            {
                "sha": "59b887d4b7ebd9ebcffb78d3b605cbdaf2923f8e",
                "filename": "src/test/java/org/apache/sling/discovery/impl/cluster/voting/VotingHandlerTest.java",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-discovery-impl/blob/9f3e5c040490781ea9873b29c93e1ef7981a823e/src/test/java/org/apache/sling/discovery/impl/cluster/voting/VotingHandlerTest.java",
                "raw_url": "https://github.com/apache/sling-org-apache-sling-discovery-impl/raw/9f3e5c040490781ea9873b29c93e1ef7981a823e/src/test/java/org/apache/sling/discovery/impl/cluster/voting/VotingHandlerTest.java",
                "status": "modified",
                "changes": 6,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-discovery-impl/contents/src/test/java/org/apache/sling/discovery/impl/cluster/voting/VotingHandlerTest.java?ref=9f3e5c040490781ea9873b29c93e1ef7981a823e",
                "patch": "@@ -535,7 +535,11 @@ public void doTestConcurrentVotes(int votingsLoopCnt, int perVotingInnerLoopCnt,\n //            if (expected>0) {\n //                assertEquals(expected, (int)noVotes);\n //            }\n-            totalPromotion += totalDetails.get(k).get(VotingDetail.PROMOTED);\n+            final Map<VotingDetail, Integer> map = totalDetails.get(k);\n+            final Integer i = map.get(VotingDetail.PROMOTED);\n+            if (i != null) {\n+                totalPromotion += i;\n+            }\n         }\n         assertEquals((int)votingsLoopCnt, totalPromotion);\n     }",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "sling-org-apache-sling-discovery-impl",
        "message": "SLING-4224 : avoid a NPE happening after bundle deactivation\n\ngit-svn-id: https://svn.apache.org/repos/asf/sling/trunk@1654748 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/sling-org-apache-sling-discovery-impl/commit/688edea614c262903cdb0768f162ffc30d4c5c1a",
        "parent": "https://github.com/apache/sling-org-apache-sling-discovery-impl/commit/6eac68b4ab80adbfdfb92e75c500bef92b283576",
        "bug_id": "sling-org-apache-sling-discovery-impl_3",
        "file": [
            {
                "sha": "2dde6a11940fa2efb0018039aa5a124ca30be79a",
                "filename": "src/main/java/org/apache/sling/discovery/impl/cluster/voting/VotingHelper.java",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-discovery-impl/blob/688edea614c262903cdb0768f162ffc30d4c5c1a/src/main/java/org/apache/sling/discovery/impl/cluster/voting/VotingHelper.java",
                "raw_url": "https://github.com/apache/sling-org-apache-sling-discovery-impl/raw/688edea614c262903cdb0768f162ffc30d4c5c1a/src/main/java/org/apache/sling/discovery/impl/cluster/voting/VotingHelper.java",
                "status": "modified",
                "changes": 6,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-discovery-impl/contents/src/main/java/org/apache/sling/discovery/impl/cluster/voting/VotingHelper.java?ref=688edea614c262903cdb0768f162ffc30d4c5c1a",
                "patch": "@@ -46,10 +46,14 @@\n      * <p>\n      * 'Not winning' means that a voting still did not receive a vote\n      * from everybody\n-     * @return the list of matching votings\n+     * @return the list of matching votings - never returns null\n      */\n     public static List<VotingView> listOpenNonWinningVotings(\n             final ResourceResolver resourceResolver, final Config config) {\n+        if (config==null) {\n+            logger.info(\"listOpenNonWinningVotings: config is null, bundle likely deactivated.\");\n+            return new ArrayList<VotingView>();\n+        }\n         final String ongoingVotingsPath = config.getOngoingVotingsPath();\n         final Resource ongoingVotingsResource = resourceResolver\n                 .getResource(ongoingVotingsPath);",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "sling-org-apache-sling-discovery-impl",
        "message": "SLING-3431 : avoid a NPE when in log level DEBUG\n\ngit-svn-id: https://svn.apache.org/repos/asf/sling/trunk@1574100 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/sling-org-apache-sling-discovery-impl/commit/1adefb35a0d626724fd751b1630c274ddf487777",
        "parent": "https://github.com/apache/sling-org-apache-sling-discovery-impl/commit/5d6bd2a5a33cdd899aa6926bc72213095d44f1fe",
        "bug_id": "sling-org-apache-sling-discovery-impl_4",
        "file": [
            {
                "sha": "95178a7013401cf6c1dfae8ae75b4cf7489095e6",
                "filename": "src/main/java/org/apache/sling/discovery/impl/cluster/voting/VotingHandler.java",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-discovery-impl/blob/1adefb35a0d626724fd751b1630c274ddf487777/src/main/java/org/apache/sling/discovery/impl/cluster/voting/VotingHandler.java",
                "raw_url": "https://github.com/apache/sling-org-apache-sling-discovery-impl/raw/1adefb35a0d626724fd751b1630c274ddf487777/src/main/java/org/apache/sling/discovery/impl/cluster/voting/VotingHandler.java",
                "status": "modified",
                "changes": 3,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-discovery-impl/contents/src/main/java/org/apache/sling/discovery/impl/cluster/voting/VotingHandler.java?ref=1adefb35a0d626724fd751b1630c274ddf487777",
                "patch": "@@ -191,8 +191,7 @@ public synchronized void analyzeVotings(final ResourceResolver resourceResolver)\n \n         if (winningVote != null) {\n         \tif (logger.isDebugEnabled()) {\n-\t            logger.debug(\"analyzeVotings: done with vote-handling. there was a winner: \"\n-\t                    + winningVote);\n+\t            logger.debug(\"analyzeVotings: done with vote-handling. there was a winner.\");\n         \t}\n             return;\n         }",
                "deletions": 2
            }
        ]
    },
    {
        "repo": "sling-org-apache-sling-discovery-impl",
        "message": "no-jira : avoid NPE on teardown if instance was not successfully started\n\ngit-svn-id: https://svn.apache.org/repos/asf/sling/trunk@1655748 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/sling-org-apache-sling-discovery-impl/commit/d9e7c4b628f8929c54e9b5e93474b9b019049b52",
        "parent": "https://github.com/apache/sling-org-apache-sling-discovery-impl/commit/3825ef3d9c96a3b8e904b0395273e85854d3af91",
        "bug_id": "sling-org-apache-sling-discovery-impl_5",
        "file": [
            {
                "sha": "bd30db5864f9b0963f9996c08e7e30068051ac92",
                "filename": "src/test/java/org/apache/sling/discovery/impl/cluster/SingleInstanceTest.java",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-discovery-impl/blob/d9e7c4b628f8929c54e9b5e93474b9b019049b52/src/test/java/org/apache/sling/discovery/impl/cluster/SingleInstanceTest.java",
                "raw_url": "https://github.com/apache/sling-org-apache-sling-discovery-impl/raw/d9e7c4b628f8929c54e9b5e93474b9b019049b52/src/test/java/org/apache/sling/discovery/impl/cluster/SingleInstanceTest.java",
                "status": "modified",
                "changes": 5,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-discovery-impl/contents/src/test/java/org/apache/sling/discovery/impl/cluster/SingleInstanceTest.java?ref=d9e7c4b628f8929c54e9b5e93474b9b019049b52",
                "patch": "@@ -71,7 +71,10 @@ public void tearDown() throws Exception {\n         final org.apache.log4j.Logger discoveryLogger = LogManager.getRootLogger().getLogger(\"org.apache.sling.discovery\");\n         discoveryLogger.setLevel(logLevel);\n         logger.info(\"tearDown: stopping standalone instance\");\n-        instance.stop();\n+        if (instance!=null) {\n+            instance.stop();\n+            instance = null;\n+        }\n         logger.info(\"tearDown: stopping standalone instance done\");\n     }\n ",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "sling-org-apache-sling-discovery-impl",
        "message": "SLING-4366 : avoid a NPE happening when log level is set to DEBUG\n\ngit-svn-id: https://svn.apache.org/repos/asf/sling/trunk@1655625 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/sling-org-apache-sling-discovery-impl/commit/d1c2df0d69d4ee837ed4406ec82e041e2b18d41a",
        "parent": "https://github.com/apache/sling-org-apache-sling-discovery-impl/commit/17a2bbcca2e3a8cbcdbe7096e06ced99d302c1aa",
        "bug_id": "sling-org-apache-sling-discovery-impl_6",
        "file": [
            {
                "sha": "bfdcba3a3e3572f4def770ec89e0df0df685bbbc",
                "filename": "src/main/java/org/apache/sling/discovery/impl/common/View.java",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-discovery-impl/blob/d1c2df0d69d4ee837ed4406ec82e041e2b18d41a/src/main/java/org/apache/sling/discovery/impl/common/View.java",
                "raw_url": "https://github.com/apache/sling-org-apache-sling-discovery-impl/raw/d1c2df0d69d4ee837ed4406ec82e041e2b18d41a/src/main/java/org/apache/sling/discovery/impl/common/View.java",
                "status": "modified",
                "changes": 6,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-discovery-impl/contents/src/main/java/org/apache/sling/discovery/impl/common/View.java?ref=d1c2df0d69d4ee837ed4406ec82e041e2b18d41a",
                "patch": "@@ -85,6 +85,12 @@ public int hashCode() {\n      */\n     public String getViewId() {\n     \tfinal ValueMap props = getResource().adaptTo(ValueMap.class);\n+    \tif (props==null) {\n+    \t    // avoid a NPE below\n+    \t    logger.warn(\"getViewId: could not get properties of \"+getResource().getPath()+\n+    \t            \", using resource name instead: \"+getResource().getName());\n+    \t    return getResource().getName();\n+    \t}\n     \tfinal String clusterId = props.get(VIEW_PROPERTY_CLUSTER_ID, String.class);\n     \tif (clusterId != null && clusterId.length() > 0) {\n     \t\treturn clusterId;",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "sling-org-apache-sling-discovery-impl",
        "message": "SLING-4303 : avoiding a NPE plus more logging added for an error case\n\ngit-svn-id: https://svn.apache.org/repos/asf/sling/trunk@1651360 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/sling-org-apache-sling-discovery-impl/commit/84ace78f0a0a4fabf88007bcaf5b592d9d29e728",
        "parent": "https://github.com/apache/sling-org-apache-sling-discovery-impl/commit/5a145542251dca8a3ade061bd563ebd63c366534",
        "bug_id": "sling-org-apache-sling-discovery-impl_7",
        "file": [
            {
                "sha": "59e59d93e5af00388991cbb1d93f05b8eee4d4c3",
                "filename": "src/test/java/org/apache/sling/discovery/impl/setup/MockedResource.java",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-discovery-impl/blob/84ace78f0a0a4fabf88007bcaf5b592d9d29e728/src/test/java/org/apache/sling/discovery/impl/setup/MockedResource.java",
                "raw_url": "https://github.com/apache/sling-org-apache-sling-discovery-impl/raw/84ace78f0a0a4fabf88007bcaf5b592d9d29e728/src/test/java/org/apache/sling/discovery/impl/setup/MockedResource.java",
                "status": "modified",
                "changes": 8,
                "additions": 8,
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-discovery-impl/contents/src/test/java/org/apache/sling/discovery/impl/setup/MockedResource.java?ref=84ace78f0a0a4fabf88007bcaf5b592d9d29e728",
                "patch": "@@ -37,9 +37,13 @@\n import org.apache.sling.api.resource.SyntheticResource;\n import org.apache.sling.api.resource.ValueMap;\n import org.apache.sling.api.wrappers.ValueMapDecorator;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n \n public class MockedResource extends SyntheticResource {\n \n+    private final Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n     private final MockedResourceResolver mockedResourceResolver;\n     private Session session;\n \n@@ -88,6 +92,7 @@ public void close() {\n             try {\n                 return (AdapterType) getSession().getNode(getPath());\n             } catch (Exception e) {\n+                logger.error(\"Exception occurred: \"+e, e);\n                 throw new RuntimeException(\"Exception occurred: \" + e, e);\n             }\n         } else if (type.equals(ValueMap.class)) {\n@@ -254,6 +259,9 @@ public void clear() {\n                         if (node==null) {\n                         \treturn null;\n                         }\n+                        if (!node.hasProperty(name)) {\n+                            return null;\n+                        }\n                         Property p = node.getProperty(name);\n                         if (p==null) {\n                         \treturn null;",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "sling-org-apache-sling-discovery-impl",
        "message": "SLING-2914 : fix NPE unveiled by SLING-2914 : a voting handler might be tempted to participate in a voting while the local instance doesnt send heartbeats\n\ngit-svn-id: https://svn.apache.org/repos/asf/sling/trunk@1490303 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/sling-org-apache-sling-discovery-impl/commit/8e85acdc6ec8b3e03181c856be3186145dc64a79",
        "parent": "https://github.com/apache/sling-org-apache-sling-discovery-impl/commit/04f064155626de843f3c714bfb92f4c2e0d4f2db",
        "bug_id": "sling-org-apache-sling-discovery-impl_8",
        "file": [
            {
                "sha": "538dd282cf9192661cc052f8a5e8d59d6dfb82ff",
                "filename": "src/main/java/org/apache/sling/discovery/impl/cluster/voting/VotingView.java",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-discovery-impl/blob/8e85acdc6ec8b3e03181c856be3186145dc64a79/src/main/java/org/apache/sling/discovery/impl/cluster/voting/VotingView.java",
                "raw_url": "https://github.com/apache/sling-org-apache-sling-discovery-impl/raw/8e85acdc6ec8b3e03181c856be3186145dc64a79/src/main/java/org/apache/sling/discovery/impl/cluster/voting/VotingView.java",
                "status": "modified",
                "changes": 6,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-discovery-impl/contents/src/main/java/org/apache/sling/discovery/impl/cluster/voting/VotingView.java?ref=8e85acdc6ec8b3e03181c856be3186145dc64a79",
                "patch": "@@ -204,7 +204,11 @@ public boolean hasNoVotes() {\n      * @return true if the given slingId has voted yes or is the initiator of this voting\n      */\n     public boolean hasVotedOrIsInitiator(final String slingId) {\n-        final Resource memberResource = getResource().getChild(\"members\").getChild(\n+        Resource members = getResource().getChild(\"members\");\n+        if (members==null) {\n+        \treturn false;\n+        }\n+\t\tfinal Resource memberResource = members.getChild(\n                 slingId);\n         if (memberResource == null) {\n             return false;",
                "deletions": 1
            }
        ]
    }
]