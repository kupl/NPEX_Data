[
    {
        "repo": "logging-log4j2",
        "commit": "https://github.com/apache/logging-log4j2/commit/147f78c45e181d78778a710d24510c9b03d97bc7",
        "bug_id": "logging-log4j2_147f78c",
        "message": "LOG4J2-1527 Prevent NPE in RingBufferLogEvent.getFormattedMessage() when used in web applications.\n\nThis closes #39 (https://github.com/apache/logging-log4j2/pull/39 )",
        "parent": "https://github.com/apache/logging-log4j2/commit/6a23301660830fcd4728b1b952b607a9e1e26f65",
        "patched_files": [
            "changes.xml",
            "RingBufferLogEvent.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/logging-log4j2/raw/147f78c45e181d78778a710d24510c9b03d97bc7/log4j-core/src/main/java/org/apache/logging/log4j/core/async/RingBufferLogEvent.java",
                "contents_url": "https://api.github.com/repos/apache/logging-log4j2/contents/log4j-core/src/main/java/org/apache/logging/log4j/core/async/RingBufferLogEvent.java?ref=147f78c45e181d78778a710d24510c9b03d97bc7",
                "filename": "log4j-core/src/main/java/org/apache/logging/log4j/core/async/RingBufferLogEvent.java",
                "deletions": 1,
                "sha": "76b00a1db8ceb2d49a6848759b1f4cfb51a927aa",
                "blob_url": "https://github.com/apache/logging-log4j2/blob/147f78c45e181d78778a710d24510c9b03d97bc7/log4j-core/src/main/java/org/apache/logging/log4j/core/async/RingBufferLogEvent.java",
                "patch": "@@ -210,7 +210,9 @@ public Message getMessage() {\n      */\n     @Override\n     public String getFormattedMessage() {\n-        return messageText.toString();\n+        return messageText != null // LOG4J2-1527: may be null in web apps\n+                ? messageText.toString() // note: please keep below \"redundant\" braces for readability\n+                : (message == null ? null : message.getFormattedMessage());\n     }\n \n     /**",
                "changes": 4
            },
            {
                "status": "modified",
                "additions": 14,
                "raw_url": "https://github.com/apache/logging-log4j2/raw/147f78c45e181d78778a710d24510c9b03d97bc7/log4j-core/src/test/java/org/apache/logging/log4j/core/async/RingBufferLogEventTest.java",
                "contents_url": "https://api.github.com/repos/apache/logging-log4j2/contents/log4j-core/src/test/java/org/apache/logging/log4j/core/async/RingBufferLogEventTest.java?ref=147f78c45e181d78778a710d24510c9b03d97bc7",
                "filename": "log4j-core/src/test/java/org/apache/logging/log4j/core/async/RingBufferLogEventTest.java",
                "deletions": 4,
                "sha": "5c7f467e360ce12ef9708538127a72224fa346a9",
                "blob_url": "https://github.com/apache/logging-log4j2/blob/147f78c45e181d78778a710d24510c9b03d97bc7/log4j-core/src/test/java/org/apache/logging/log4j/core/async/RingBufferLogEventTest.java",
                "patch": "@@ -121,11 +121,11 @@ public void testSerializationDeserialization() throws IOException, ClassNotFound\n         final long nanoTime = 1;\n         evt.setValues(null, loggerName, marker, fqcn, level, data, t, map,\n                 contextStack, -1, threadName, -1, location, currentTimeMillis, nanoTime);\n-        \n+\n         final ByteArrayOutputStream baos = new ByteArrayOutputStream();\n         final ObjectOutputStream out = new ObjectOutputStream(baos);\n         out.writeObject(evt);\n-        \n+\n         final ObjectInputStream in = new ObjectInputStream(new ByteArrayInputStream(baos.toByteArray()));\n         final RingBufferLogEvent other = (RingBufferLogEvent) in.readObject();\n         assertEquals(loggerName, other.getLoggerName());\n@@ -141,7 +141,7 @@ public void testSerializationDeserialization() throws IOException, ClassNotFound\n         assertEquals(location, other.getSource());\n         assertEquals(currentTimeMillis, other.getTimeMillis());\n     }\n-    \n+\n     @Test\n     public void testCreateMementoReturnsCopy() {\n         final RingBufferLogEvent evt = new RingBufferLogEvent();\n@@ -160,7 +160,7 @@ public void testCreateMementoReturnsCopy() {\n         final long nanoTime = 1;\n         evt.setValues(null, loggerName, marker, fqcn, level, data, t, map,\n                 contextStack, -1, threadName, -1, location, currentTimeMillis, nanoTime);\n-        \n+\n         final LogEvent actual = evt.createMemento();\n         assertEquals(evt.getLoggerName(), actual.getLoggerName());\n         assertEquals(evt.getMarker(), actual.getMarker());\n@@ -175,4 +175,14 @@ public void testCreateMementoReturnsCopy() {\n         assertEquals(evt.getSource(), actual.getSource());\n         assertEquals(evt.getThrownProxy(), actual.getThrownProxy());\n     }\n+\n+    @Test\n+    public void testMessageTextNeverThrowsNpe() {\n+        final RingBufferLogEvent evt = new RingBufferLogEvent();\n+        try {\n+            evt.getFormattedMessage();\n+        } catch (NullPointerException e) {\n+            fail(\"the messageText field was not set\");\n+        }\n+    }\n }",
                "changes": 18
            },
            {
                "status": "modified",
                "additions": 4,
                "raw_url": "https://github.com/apache/logging-log4j2/raw/147f78c45e181d78778a710d24510c9b03d97bc7/src/changes/changes.xml",
                "contents_url": "https://api.github.com/repos/apache/logging-log4j2/contents/src/changes/changes.xml?ref=147f78c45e181d78778a710d24510c9b03d97bc7",
                "filename": "src/changes/changes.xml",
                "deletions": 0,
                "sha": "1ea373c3bd88d328eb135e906b2b77c1f00ed2ac",
                "blob_url": "https://github.com/apache/logging-log4j2/blob/147f78c45e181d78778a710d24510c9b03d97bc7/src/changes/changes.xml",
                "patch": "@@ -24,6 +24,10 @@\n   </properties>\n   <body>\n     <release version=\"2.7\" date=\"2016-MM-DD\" description=\"GA Release 2.7\">\n+\n+      <action issue=\"LOG4J2-1527\" dev=\"rpopma\" type=\"fix\" due-to=\"Jose Leon\">\n+        Prevent NPE in RingBufferLogEvent.getFormattedMessage() when used in web applications.\n+      </action>\n       <action issue=\"LOG4J2-905\" dev=\"ggregory\" type=\"fix\" due-to=\"Gary Gregory, Moritz L\u00f6ser\">\n         Ability to disable (date) lookup completely, compatibility issues with other libraries like Camel.\n       </action>",
                "changes": 4
            }
        ],
        "unit_tests": [
            "RingBufferLogEventTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "log4j-core/src/test/java/org/apache/logging/log4j/core/async/RingBufferLogEventTest.java",
        "buggy_files": [
            "src/changes/changes.xml",
            "log4j-core/src/main/java/org/apache/logging/log4j/core/async/RingBufferLogEvent.java"
        ],
        "fixed": true
    }
]