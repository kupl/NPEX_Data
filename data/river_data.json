[{"commit": "https://github.com/apache/river/commit/276b713be1af0bfa36ec1127ad38d3eec233d7f8", "parent": "https://github.com/apache/river/commit/5389035809b20c937e05c32f43e8661686103b4b", "message": "Fix NPE that can occur during shutdown.  Note this NPE didn't cause a test failure, however I don't like NPE being thrown unless we're expecting it.  Also corrected synchronization comment.\n\ngit-svn-id: https://svn.apache.org/repos/asf/river/jtsk/skunk/qa-refactor-namespace/trunk@1716793 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "river_1", "file": [{"additions": 5, "raw_url": "https://github.com/apache/river/raw/276b713be1af0bfa36ec1127ad38d3eec233d7f8/src/net/jini/discovery/AbstractLookupDiscovery.java", "blob_url": "https://github.com/apache/river/blob/276b713be1af0bfa36ec1127ad38d3eec233d7f8/src/net/jini/discovery/AbstractLookupDiscovery.java", "sha": "d2f72ac70509462c59309449d4f092734ff54fa1", "changes": 7, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/river/contents/src/net/jini/discovery/AbstractLookupDiscovery.java?ref=276b713be1af0bfa36ec1127ad38d3eec233d7f8", "patch": "@@ -156,7 +156,10 @@\n     /* WakeupManager to delay tasks. */\r\n     private final WakeupManager discoveryWakeupMgr;\r\n     private final boolean isDefaultWakeupMgr;\r\n-    /* Outstanding tickets - Access synchronized on pendingDiscoveries */\r\n+    /* Outstanding tickets - Access synchronized on \r\n+     * UnicastDiscoveryTask instance, then on tickets.\r\n+     * Access only synchronized on tickets from nukeThreads \r\n+     */\r\n     private final List<Ticket> tickets;\r\n     /** Thread that handles incoming multicast announcements. */\r\n     private final AnnouncementListener announceeThread;\r\n@@ -1010,7 +1013,7 @@ private void doRun() {\n                     // Since this is a valid announcement, update the\r\n                     // sequence number.\r\n                     AnnouncementInfo aInfo = regInfo.get(srvcID);\r\n-                    if (!regInfo.replace\r\n+                    if (aInfo != null && !regInfo.replace // Avoid null pointer exception\r\n                             (   srvcID, \r\n                                 aInfo, \r\n                                 new AnnouncementInfo( \r", "filename": "src/net/jini/discovery/AbstractLookupDiscovery.java"}], "repo": "river"}, {"commit": "https://github.com/apache/river/commit/44ca7fd4e7e5ce5111e122dcb233ee984c670cf7", "parent": "https://github.com/apache/river/commit/e981fea7df9430810f285ab980d5e31df699983b", "message": "Fix NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/river/jtsk/skunk/qa_refactor/trunk@1448054 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "river_2", "file": [{"additions": 3, "raw_url": "https://github.com/apache/river/raw/44ca7fd4e7e5ce5111e122dcb233ee984c670cf7/qa/src/com/sun/jini/test/share/BaseQATest.java", "blob_url": "https://github.com/apache/river/blob/44ca7fd4e7e5ce5111e122dcb233ee984c670cf7/qa/src/com/sun/jini/test/share/BaseQATest.java", "sha": "0d5a9bdf49b4a72b0cc4c6e3ce74205f10f04e90", "changes": 4, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/river/contents/qa/src/com/sun/jini/test/share/BaseQATest.java?ref=44ca7fd4e7e5ce5111e122dcb233ee984c670cf7", "patch": "@@ -1551,7 +1551,9 @@ protected void waitForDiscovery(LookupListener listener)\n                         String[] groups = (String[])pair.getValue();\n                         logger.log(Level.FINE,\n                                          \"   discoveredMap.locator = \"+loc);\n-                        if( groups.length <= 0 ) {\n+                        if (groups == null) {\n+                            logger.log(Level.FINE, \"     discoveredMap.groups is null\");\n+                        } else if( groups.length <= 0 ) {\n                             logger.log(Level.FINE,\n                                    \"     discoveredMap.groups == NO_GROUPS\");\n                         } else {", "filename": "qa/src/com/sun/jini/test/share/BaseQATest.java"}], "repo": "river"}, {"commit": "https://github.com/apache/river/commit/0db2dad12135bc1cc69ced9b9cdfcddba9f16399", "parent": "https://github.com/apache/river/commit/11d6950730a16c3e3dde17dacb177de2e2798f2d", "message": "Work around sun bug ID6536522 NPE thrown instead of MalformedURLException\n\ngit-svn-id: https://svn.apache.org/repos/asf/river/jtsk/trunk@1369541 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "river_3", "file": [{"additions": 3, "raw_url": "https://github.com/apache/river/raw/0db2dad12135bc1cc69ced9b9cdfcddba9f16399/src/net/jini/loader/pref/PreferredClassLoader.java", "blob_url": "https://github.com/apache/river/blob/0db2dad12135bc1cc69ced9b9cdfcddba9f16399/src/net/jini/loader/pref/PreferredClassLoader.java", "sha": "7a89e8ec23fb2cdbe4814a3b8b03f03ac080da88", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/river/contents/src/net/jini/loader/pref/PreferredClassLoader.java?ref=0db2dad12135bc1cc69ced9b9cdfcddba9f16399", "patch": "@@ -707,6 +707,9 @@ private URLConnection getPreferredConnection(URL url, boolean closeAfter)\n \t\t\thconn.getResponseMessage());\n \t\t}\n \t    }\n+        } catch (NullPointerException e){\n+            e.fillInStackTrace();\n+            throw new IOException(url.toString(), e);\n \t} finally {\n \t    if (closeAfter && (closeConn != null)) {\n \t\t/* clean up after... */", "filename": "src/net/jini/loader/pref/PreferredClassLoader.java"}], "repo": "river"}, {"commit": "https://github.com/apache/river/commit/11d6950730a16c3e3dde17dacb177de2e2798f2d", "parent": "https://github.com/apache/river/commit/5b8c71bcc12aeb8b3ec1196bb0cca8752632a3bc", "message": "Work around sun bug ID6536522 NPE thrown instead of MalformedURLException\n\ngit-svn-id: https://svn.apache.org/repos/asf/river/jtsk/trunk@1369539 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "river_4", "file": [{"additions": 3, "raw_url": "https://github.com/apache/river/raw/11d6950730a16c3e3dde17dacb177de2e2798f2d/src/net/jini/loader/pref/PreferredClassLoader.java", "blob_url": "https://github.com/apache/river/blob/11d6950730a16c3e3dde17dacb177de2e2798f2d/src/net/jini/loader/pref/PreferredClassLoader.java", "sha": "6f857e17ac85f18e68b23269f67987c83f89d92b", "changes": 4, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/river/contents/src/net/jini/loader/pref/PreferredClassLoader.java?ref=11d6950730a16c3e3dde17dacb177de2e2798f2d", "patch": "@@ -1283,7 +1283,9 @@ static void addPermissionsForURLs(URL[] urls,\n \t\t * does, don't bother granting or requiring any permissions\n \t\t * for this URL.\n \t\t */\n-\t    }\n+\t    } catch (NullPointerException e){\n+                // Sun Bug ID: 6536522\n+            }\n \t}\n     }\n }", "filename": "src/net/jini/loader/pref/PreferredClassLoader.java"}], "repo": "river"}, {"commit": "https://github.com/apache/river/commit/5b8c71bcc12aeb8b3ec1196bb0cca8752632a3bc", "parent": "https://github.com/apache/river/commit/1d26cfbfe4713545fcb718516ede5ebf54cd3137", "message": "Work around sun bug ID6536522 NPE thrown instead of MalformedURLException\n\ngit-svn-id: https://svn.apache.org/repos/asf/river/jtsk/trunk@1369538 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "river_5", "file": [{"additions": 4, "raw_url": "https://github.com/apache/river/raw/5b8c71bcc12aeb8b3ec1196bb0cca8752632a3bc/src/net/jini/loader/pref/PreferredClassLoader.java", "blob_url": "https://github.com/apache/river/blob/5b8c71bcc12aeb8b3ec1196bb0cca8752632a3bc/src/net/jini/loader/pref/PreferredClassLoader.java", "sha": "dbbb7c42aa222cb36bc4483515404ee8455fa8e6", "changes": 6, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/river/contents/src/net/jini/loader/pref/PreferredClassLoader.java?ref=5b8c71bcc12aeb8b3ec1196bb0cca8752632a3bc", "patch": "@@ -604,7 +604,7 @@ private boolean jarExists(URL firstURL) throws IOException {\n                 // NullPointerException is thrown instead of MalformedURLException\n                 // Case is the same as above, we have no definite answer on\n                 // whether the JAR file and therefore the PREFERRED.LIST exists.\n-                System.err.println(\"NPE thrown while trying to open connection:\" +\n+                System.err.println(\"NPE thrown while trying to open connection :\" +\n                         baseURL);\n                 e.printStackTrace(System.err);\n             }\n@@ -713,7 +713,9 @@ private URLConnection getPreferredConnection(URL url, boolean closeAfter)\n \t\ttry {\n \t\t    closeConn.getInputStream().close();\n \t\t} catch (IOException e) {\n-\t\t}\n+\t\t} catch (NullPointerException e){\n+                    // Sun Bug ID: 6536522\n+                }\n \t    }\n \t}\n ", "filename": "src/net/jini/loader/pref/PreferredClassLoader.java"}], "repo": "river"}, {"commit": "https://github.com/apache/river/commit/21815d87d81b4efcad39ea8086e6ebf980208ea7", "parent": "https://github.com/apache/river/commit/2ea19b2b1453f1339f9f62dd08924cc0430a2c5e", "message": "Work around sun bug ID 6536522 NPE thrown instead of MalformedURLException\n\ngit-svn-id: https://svn.apache.org/repos/asf/river/jtsk/trunk@1369578 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "river_6", "file": [{"additions": 7, "raw_url": "https://github.com/apache/river/raw/21815d87d81b4efcad39ea8086e6ebf980208ea7/src/net/jini/loader/pref/PreferredClassLoader.java", "blob_url": "https://github.com/apache/river/blob/21815d87d81b4efcad39ea8086e6ebf980208ea7/src/net/jini/loader/pref/PreferredClassLoader.java", "sha": "4e89005e2100e7bab002b251c5e9971f006a49dc", "changes": 11, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/river/contents/src/net/jini/loader/pref/PreferredClassLoader.java?ref=21815d87d81b4efcad39ea8086e6ebf980208ea7", "patch": "@@ -707,10 +707,13 @@ private URLConnection getPreferredConnection(URL url, boolean closeAfter)\n \t\t\thconn.getResponseMessage());\n \t\t}\n \t    }\n-        } catch (NullPointerException e){\n-            // Sun Bug ID: 6536522\n-            e.fillInStackTrace();\n-            throw new IOException(url.toString(), e);\n+        } catch (RuntimeException e){\n+            if ( e instanceof NullPointerException || e.getCause() instanceof NullPointerException) {\n+                // Sun Bug ID: 6536522\n+                throw new IOException(url.toString(), e);\n+            } else {\n+                throw e;\n+            }\n \t} finally {\n \t    if (closeAfter && (closeConn != null)) {\n \t\t/* clean up after... */", "filename": "src/net/jini/loader/pref/PreferredClassLoader.java"}], "repo": "river"}, {"commit": "https://github.com/apache/river/commit/2ea19b2b1453f1339f9f62dd08924cc0430a2c5e", "parent": "https://github.com/apache/river/commit/5c81dfbaa2b5db269b450d81f329333462b2b344", "message": "Work around sun bug ID 6536522 NPE thrown instead of MalformedURLException\n\ngit-svn-id: https://svn.apache.org/repos/asf/river/jtsk/trunk@1369573 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "river_7", "file": [{"additions": 1, "raw_url": "https://github.com/apache/river/raw/2ea19b2b1453f1339f9f62dd08924cc0430a2c5e/src/net/jini/loader/pref/PreferredClassLoader.java", "blob_url": "https://github.com/apache/river/blob/2ea19b2b1453f1339f9f62dd08924cc0430a2c5e/src/net/jini/loader/pref/PreferredClassLoader.java", "sha": "c105008dc8ea305f8a912e2899c8ddf61eb1a426", "changes": 1, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/river/contents/src/net/jini/loader/pref/PreferredClassLoader.java?ref=2ea19b2b1453f1339f9f62dd08924cc0430a2c5e", "patch": "@@ -721,6 +721,7 @@ private URLConnection getPreferredConnection(URL url, boolean closeAfter)\n                     if ( e instanceof NullPointerException || e.getCause() instanceof NullPointerException) {\n                         // Sun Bug ID: 6536522\n                         // swallow\n+                        e.printStackTrace(System.err);\n                     } else {\n                         throw e;\n                     }", "filename": "src/net/jini/loader/pref/PreferredClassLoader.java"}], "repo": "river"}, {"commit": "https://github.com/apache/river/commit/5c81dfbaa2b5db269b450d81f329333462b2b344", "parent": "https://github.com/apache/river/commit/0db2dad12135bc1cc69ced9b9cdfcddba9f16399", "message": "Work around sun bug ID 6536522 NPE thrown instead of MalformedURLException\n\ngit-svn-id: https://svn.apache.org/repos/asf/river/jtsk/trunk@1369570 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "river_8", "file": [{"additions": 10, "raw_url": "https://github.com/apache/river/raw/5c81dfbaa2b5db269b450d81f329333462b2b344/src/net/jini/loader/pref/PreferredClassLoader.java", "blob_url": "https://github.com/apache/river/blob/5c81dfbaa2b5db269b450d81f329333462b2b344/src/net/jini/loader/pref/PreferredClassLoader.java", "sha": "5c9e3f578761fd4574d708b3627fffff53b560b7", "changes": 14, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/river/contents/src/net/jini/loader/pref/PreferredClassLoader.java?ref=5c81dfbaa2b5db269b450d81f329333462b2b344", "patch": "@@ -681,7 +681,7 @@ private URLConnection getPreferredConnection(URL url, boolean closeAfter)\n \t\tif (closeAfter) {\n \t\t    hconn.setRequestMethod(\"HEAD\");\n \t\t}\n-\t\tint responseCode = hconn.getResponseCode();\n+\t\tint responseCode = hconn.getResponseCode();//NPE\n \t\t\n \t\tswitch (responseCode) {\n \t\tcase HttpURLConnection.HTTP_OK:\n@@ -708,16 +708,22 @@ private URLConnection getPreferredConnection(URL url, boolean closeAfter)\n \t\t}\n \t    }\n         } catch (NullPointerException e){\n+            // Sun Bug ID: 6536522\n             e.fillInStackTrace();\n             throw new IOException(url.toString(), e);\n \t} finally {\n \t    if (closeAfter && (closeConn != null)) {\n \t\t/* clean up after... */\n \t\ttry {\n-\t\t    closeConn.getInputStream().close();\n+\t\t    closeConn.getInputStream().close();//RTE NPE\n \t\t} catch (IOException e) {\n-\t\t} catch (NullPointerException e){\n-                    // Sun Bug ID: 6536522\n+\t\t} catch (RuntimeException e){\n+                    if ( e instanceof NullPointerException || e.getCause() instanceof NullPointerException) {\n+                        // Sun Bug ID: 6536522\n+                        // swallow\n+                    } else {\n+                        throw e;\n+                    }\n                 }\n \t    }\n \t}", "filename": "src/net/jini/loader/pref/PreferredClassLoader.java"}], "repo": "river"}, {"commit": "https://github.com/apache/river/commit/1d26cfbfe4713545fcb718516ede5ebf54cd3137", "parent": "https://github.com/apache/river/commit/ae67fa02e76f80e37d4f0574d836faf860bc723c", "message": "Investigate test failure on Solaris x86, BadLocatorDiscoveryListener.\n\nSun Bug ID:6536522 NPE thrown instead of MalformedURLException\n\ngit-svn-id: https://svn.apache.org/repos/asf/river/jtsk/trunk@1369533 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "river_9", "file": [{"additions": 11, "raw_url": "https://github.com/apache/river/raw/1d26cfbfe4713545fcb718516ede5ebf54cd3137/src/net/jini/loader/pref/PreferredClassLoader.java", "blob_url": "https://github.com/apache/river/blob/1d26cfbfe4713545fcb718516ede5ebf54cd3137/src/net/jini/loader/pref/PreferredClassLoader.java", "sha": "870b778e0198f2bb5cfd79c19ae666cb1effe64a", "changes": 15, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/river/contents/src/net/jini/loader/pref/PreferredClassLoader.java?ref=1d26cfbfe4713545fcb718516ede5ebf54cd3137", "patch": "@@ -592,15 +592,22 @@ private boolean jarExists(URL firstURL) throws IOException {\n \t     * available upon the attempt (elsewhere) to obtain the preferred\n \t     * list\n \t     */\n+            URL baseURL = getBaseJarURL(firstURL);\n \t    try {\n-\t\tURL baseURL = getBaseJarURL(firstURL);\n \t\t((JarURLConnection) baseURL.openConnection()).getManifest();\n \t\texists = true;\n-\t    }\n-\t    catch (IOException e) {\n+\t    } catch (IOException e) {\n \t\t// we still have no definite answer on whether the JAR file\n \t\t// and therefore the PREFERRED.LIST exists\n-\t    }\n+\t    } catch (NullPointerException e){\n+                // Sun Bug ID: 6536522\n+                // NullPointerException is thrown instead of MalformedURLException\n+                // Case is the same as above, we have no definite answer on\n+                // whether the JAR file and therefore the PREFERRED.LIST exists.\n+                System.err.println(\"NPE thrown while trying to open connection:\" +\n+                        baseURL);\n+                e.printStackTrace(System.err);\n+            }\n \n \t    if (!exists) {\n \t\texists = (getPreferredConnection(firstURL, true) != null);", "filename": "src/net/jini/loader/pref/PreferredClassLoader.java"}], "repo": "river"}]
