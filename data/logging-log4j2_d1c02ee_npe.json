[
    {
        "repo": "logging-log4j2",
        "commit": "https://github.com/apache/logging-log4j2/commit/d1c02ee5e3a863528dfad66a9bbd17c45d475a25",
        "bug_id": "logging-log4j2_d1c02ee",
        "message": "[LOG4J2-1500] Merging configurations fail with an NPE when comparing\nNodes with different attributes. Closes #37.",
        "parent": "https://github.com/apache/logging-log4j2/commit/5b7b75d5f902d5f1427858c34330cf2550d308b7",
        "patched_files": [
            "CompositeConfiguration.java",
            "changes.xml",
            "log4j-comp-root-loggers.xml",
            "DefaultMergeStrategy.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 4,
                "raw_url": "https://github.com/apache/logging-log4j2/raw/d1c02ee5e3a863528dfad66a9bbd17c45d475a25/log4j-core/src/main/java/org/apache/logging/log4j/core/config/composite/DefaultMergeStrategy.java",
                "contents_url": "https://api.github.com/repos/apache/logging-log4j2/contents/log4j-core/src/main/java/org/apache/logging/log4j/core/config/composite/DefaultMergeStrategy.java?ref=d1c02ee5e3a863528dfad66a9bbd17c45d475a25",
                "filename": "log4j-core/src/main/java/org/apache/logging/log4j/core/config/composite/DefaultMergeStrategy.java",
                "deletions": 2,
                "sha": "c799e1d9b1bf08125ba7668eabcc58c8afff1598",
                "blob_url": "https://github.com/apache/logging-log4j2/blob/d1c02ee5e3a863528dfad66a9bbd17c45d475a25/log4j-core/src/main/java/org/apache/logging/log4j/core/config/composite/DefaultMergeStrategy.java",
                "patch": "@@ -260,10 +260,12 @@ private boolean isFilterNode(final Node node) {\n     }\n \n     private boolean isSameName(final Node node1, final Node node2) {\n-        return node1.getAttributes().get(NAME).toLowerCase().equals(node2.getAttributes().get(NAME).toLowerCase());\n+        final String value = node1.getAttributes().get(NAME);\n+        return value != null && value.toLowerCase().equals(node2.getAttributes().get(NAME).toLowerCase());\n     }\n \n     private boolean isSameReference(final Node node1, final Node node2) {\n-        return node1.getAttributes().get(REF).toLowerCase().equals(node2.getAttributes().get(REF).toLowerCase());\n+        final String value = node1.getAttributes().get(REF);\n+        return value != null && value.toLowerCase().equals(node2.getAttributes().get(REF).toLowerCase());\n     }\n }",
                "changes": 6
            },
            {
                "status": "modified",
                "additions": 19,
                "raw_url": "https://github.com/apache/logging-log4j2/raw/d1c02ee5e3a863528dfad66a9bbd17c45d475a25/log4j-core/src/test/java/org/apache/logging/log4j/core/config/CompositeConfigurationTest.java",
                "contents_url": "https://api.github.com/repos/apache/logging-log4j2/contents/log4j-core/src/test/java/org/apache/logging/log4j/core/config/CompositeConfigurationTest.java?ref=d1c02ee5e3a863528dfad66a9bbd17c45d475a25",
                "filename": "log4j-core/src/test/java/org/apache/logging/log4j/core/config/CompositeConfigurationTest.java",
                "deletions": 0,
                "sha": "8482cf475adbf16626ef5938c3b8069cfbd562c2",
                "blob_url": "https://github.com/apache/logging-log4j2/blob/d1c02ee5e3a863528dfad66a9bbd17c45d475a25/log4j-core/src/test/java/org/apache/logging/log4j/core/config/CompositeConfigurationTest.java",
                "patch": "@@ -18,6 +18,7 @@\n \n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n \n import java.util.Map;\n \n@@ -26,6 +27,7 @@\n import org.apache.logging.log4j.core.appender.FileAppender;\n import org.apache.logging.log4j.core.config.composite.CompositeConfiguration;\n import org.apache.logging.log4j.junit.LoggerContextRule;\n+import org.junit.Assert;\n import org.junit.Test;\n import org.junit.runner.Description;\n import org.junit.runners.model.Statement;\n@@ -110,6 +112,23 @@ public void evaluate() throws Throwable {\n         };\n         runTest(lcr, test);\n     }\n+\n+    @Test\n+    public void testAttributeCheckWhenMergingConfigurations() {\n+        final LoggerContextRule lcr = new LoggerContextRule(\"classpath:log4j-comp-root-loggers.xml,log4j-comp-logger.json\");\n+        final Statement test = new Statement() {\n+            @Override\n+            public void evaluate() throws Throwable {\n+                try {\n+                    final CompositeConfiguration config = (CompositeConfiguration) lcr.getConfiguration();\n+                    Assert.assertNotNull(config);\n+                } catch (NullPointerException e) {\n+                    fail(\"Should not throw NullPointerException when there are different nodes.\");\n+                }\n+            }\n+        };\n+        runTest(lcr, test);\n+    }\n /*\n     @Test\n     public void overrideFilter() {",
                "changes": 19
            },
            {
                "status": "added",
                "additions": 46,
                "raw_url": "https://github.com/apache/logging-log4j2/raw/d1c02ee5e3a863528dfad66a9bbd17c45d475a25/log4j-core/src/test/resources/log4j-comp-root-loggers.xml",
                "contents_url": "https://api.github.com/repos/apache/logging-log4j2/contents/log4j-core/src/test/resources/log4j-comp-root-loggers.xml?ref=d1c02ee5e3a863528dfad66a9bbd17c45d475a25",
                "filename": "log4j-core/src/test/resources/log4j-comp-root-loggers.xml",
                "deletions": 0,
                "sha": "79ea7e53d41d28a60ef92d67072fd188f8bb369c",
                "blob_url": "https://github.com/apache/logging-log4j2/blob/d1c02ee5e3a863528dfad66a9bbd17c45d475a25/log4j-core/src/test/resources/log4j-comp-root-loggers.xml",
                "patch": "@@ -0,0 +1,46 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+ Licensed to the Apache Software Foundation (ASF) under one or more\n+ contributor license agreements.  See the NOTICE file distributed with\n+ this work for additional information regarding copyright ownership.\n+ The ASF licenses this file to You under the Apache License, Version 2.0\n+ (the \"License\"); you may not use this file except in compliance with\n+ the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+ Unless required by applicable law or agreed to in writing, software\n+ distributed under the License is distributed on an \"AS IS\" BASIS,\n+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ See the License for the specific language governing permissions and\n+ limitations under the License.\n+\n+-->\n+<Configuration status=\"ERROR\" name=\"LoggerConfigTest\">\n+    <Appenders>\n+        <Console name=\"STDOUT\">\n+            <PatternLayout pattern=\"%m%n\"/>\n+        </Console>\n+        <File name=\"File\" fileName=\"${filename}\" bufferedIO=\"false\">\n+            <PatternLayout>\n+                <Pattern>%d %p %C{1.} [%t] %m%n</Pattern>\n+            </PatternLayout>\n+        </File>\n+    </Appenders>\n+\n+    <Loggers>\n+        <Logger name=\"cat1\" level=\"debug\" additivity=\"false\">\n+            <AppenderRef ref=\"File\"/>\n+        </Logger>\n+\n+        <Logger name=\"cat3\" level=\"debug\" additivity=\"false\">\n+            <AppenderRef ref=\"File\"/>\n+        </Logger>\n+\n+        <Root level=\"error\">\n+            <AppenderRef ref=\"STDOUT\"/>\n+            <Property name=\"hostname\">server1</Property>\n+        </Root>\n+    </Loggers>\n+\n+</Configuration>\n\\ No newline at end of file",
                "changes": 46
            },
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/logging-log4j2/raw/d1c02ee5e3a863528dfad66a9bbd17c45d475a25/src/changes/changes.xml",
                "contents_url": "https://api.github.com/repos/apache/logging-log4j2/contents/src/changes/changes.xml?ref=d1c02ee5e3a863528dfad66a9bbd17c45d475a25",
                "filename": "src/changes/changes.xml",
                "deletions": 0,
                "sha": "77bc02b71be1a33cee005247d727ce3e52c52f69",
                "blob_url": "https://github.com/apache/logging-log4j2/blob/d1c02ee5e3a863528dfad66a9bbd17c45d475a25/src/changes/changes.xml",
                "patch": "@@ -24,6 +24,9 @@\n   </properties>\n   <body>\n     <release version=\"2.7\" date=\"2016-MM-DD\" description=\"GA Release 2.7\">\n+      <action issue=\"LOG4J2-1500\" dev=\"ggregory\" type=\"fix\" due-to=\"Jose Leon\">\n+        Merging configurations fail with an NPE when comparing Nodes with different attributes.\n+      </action>\n       <action issue=\"LOG4J2-1482\" dev=\"ggregory\" type=\"fix\" due-to=\"Gary Gregory, Sumit Singhal\">\n         Improper header in CsvParameterLayout.\n       </action>",
                "changes": 3
            }
        ],
        "unit_tests": [
            "CompositeConfigurationTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "log4j-core/src/test/java/org/apache/logging/log4j/core/config/CompositeConfigurationTest.java",
        "buggy_files": [
            "log4j-core/src/main/java/org/apache/logging/log4j/core/config/composite/CompositeConfiguration.java",
            "src/changes/changes.xml",
            "log4j-core/src/test/resources/log4j-comp-root-loggers.xml",
            "log4j-core/src/main/java/org/apache/logging/log4j/core/config/composite/DefaultMergeStrategy.java"
        ],
        "fixed": true
    }
]