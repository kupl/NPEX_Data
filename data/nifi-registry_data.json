[{"commit": "https://github.com/apache/nifi-registry/commit/d4410de8c01e9a128dd8e6b2769aaf828aa73b24", "parent": "https://github.com/apache/nifi-registry/commit/1dcf960606ae72e18d7b17d5b60bdb2a86eeb8c3", "message": "NIFIREG-225: Fix NPE in getAccessPolicesForUser (#156)", "bug_id": "nifi-registry_1", "file": [{"additions": 10, "raw_url": "https://github.com/apache/nifi-registry/raw/d4410de8c01e9a128dd8e6b2769aaf828aa73b24/nifi-registry-core/nifi-registry-framework/src/main/java/org/apache/nifi/registry/service/AuthorizationService.java", "blob_url": "https://github.com/apache/nifi-registry/blob/d4410de8c01e9a128dd8e6b2769aaf828aa73b24/nifi-registry-core/nifi-registry-framework/src/main/java/org/apache/nifi/registry/service/AuthorizationService.java", "sha": "5190b64cf740cbfab9e2abcef2bfc52d9a250364", "changes": 12, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/nifi-registry/contents/nifi-registry-core/nifi-registry-framework/src/main/java/org/apache/nifi/registry/service/AuthorizationService.java?ref=d4410de8c01e9a128dd8e6b2769aaf828aa73b24", "patch": "@@ -361,7 +361,15 @@ public AccessPolicy getAccessPolicy(String resource, RequestAction action) {\n         readLock.lock();\n         try {\n             return accessPolicyProvider.getAccessPolicies().stream()\n-                    .filter(accessPolicy -> accessPolicy.getUsers().contains(userIdentifier))\n+                    .filter(accessPolicy -> {\n+                        if (accessPolicy.getUsers().contains(userIdentifier)) {\n+                            return true;\n+                        }\n+                        return accessPolicy.getGroups().stream().anyMatch(g -> {\n+                            final Group group = userGroupProvider.getGroup(g);\n+                            return group != null && group.getUsers().contains(userIdentifier);\n+                        });\n+                    })\n                     .map(this::accessPolicyToSummaryDTO)\n                     .collect(Collectors.toList());\n         } finally {\n@@ -572,7 +580,7 @@ private UserGroup userGroupToDTO(\n         }\n \n         Collection<Tenant> userTenants = userGroup.getUsers() != null\n-                ? userGroup.getUsers().stream().map(this::tenantIdToDTO).collect(Collectors.toSet()) : null;\n+                ? userGroup.getUsers().stream().map(this::tenantIdToDTO).filter(Objects::nonNull).collect(Collectors.toSet()) : null;\n         Collection<AccessPolicySummary> accessPolicySummaries = getAccessPolicySummariesForUserGroup(userGroup.getIdentifier());\n \n         UserGroup userGroupDTO = new UserGroup(userGroup.getIdentifier(), userGroup.getName());", "filename": "nifi-registry-core/nifi-registry-framework/src/main/java/org/apache/nifi/registry/service/AuthorizationService.java"}, {"additions": 22, "raw_url": "https://github.com/apache/nifi-registry/raw/d4410de8c01e9a128dd8e6b2769aaf828aa73b24/nifi-registry-core/nifi-registry-framework/src/test/groovy/org/apache/nifi/registry/service/AuthorizationServiceSpec.groovy", "blob_url": "https://github.com/apache/nifi-registry/blob/d4410de8c01e9a128dd8e6b2769aaf828aa73b24/nifi-registry-core/nifi-registry-framework/src/test/groovy/org/apache/nifi/registry/service/AuthorizationServiceSpec.groovy", "sha": "4646c2f9ffcf28d12f1e3330e40dfca05c6058fa", "changes": 34, "status": "modified", "deletions": 12, "contents_url": "https://api.github.com/repos/apache/nifi-registry/contents/nifi-registry-core/nifi-registry-framework/src/test/groovy/org/apache/nifi/registry/service/AuthorizationServiceSpec.groovy?ref=d4410de8c01e9a128dd8e6b2769aaf828aa73b24", "patch": "@@ -106,25 +106,36 @@ class AuthorizationServiceSpec extends Specification {\n     def \"get user\"() {\n \n         setup:\n-        userGroupProvider.getGroups() >> new HashSet<Group>()\n-        accessPolicyProvider.getAccessPolicies() >> new HashSet<AccessPolicy>()\n+        def user1 = new AuthUser.Builder().identifier(\"user-id-1\").identity(\"user1\").build()\n+        def group1 = new Group.Builder().identifier(\"group-id-1\").name(\"group1\").addUser(\"user-id-1\").build()\n+        def apBuilder = new org.apache.nifi.registry.security.authorization.AccessPolicy.Builder().resource(\"/fake-resource\").action(RequestAction.READ)\n+        def ap1 = apBuilder.identifier(\"policy-1\").addUser(\"user-id-1\").build()\n+        def ap2 = apBuilder.identifier(\"policy-2\").clearUsers().addGroup(\"group-id-1\").build()\n+        def ap3 = apBuilder.identifier(\"policy-3\").clearGroups().addGroup(\"does-not-exist\").build()\n+        userGroupProvider.getUser(\"does-not-exist\") >> null\n+        userGroupProvider.getUser(\"user-id-1\") >> user1\n+        userGroupProvider.getGroup(\"group-id-1\") >> group1\n+        userGroupProvider.getGroup(\"does-not-exist\") >> null\n+        userGroupProvider.getGroups() >> new HashSet<Group>([group1])\n+        accessPolicyProvider.getAccessPolicies() >> new HashSet<>([ap1, ap2, ap3])\n \n \n         when: \"get user for existing user identifier\"\n-        userGroupProvider.getUser(\"userId\") >> new AuthUser.Builder().identifier(\"userId\").identity(\"username\").build()\n-        def user1 = authorizationService.getUser(\"userId\")\n+        def userDto1 = authorizationService.getUser(\"user-id-1\")\n \n         then: \"user is returned converted to DTO\"\n-        with(user1) {\n-            identifier == \"userId\"\n-            identity == \"username\"\n+        with(userDto1) {\n+            identifier == \"user-id-1\"\n+            identity == \"user1\"\n+            userGroups.size() == 1\n+            userGroups[0].identifier == \"group-id-1\"\n+            accessPolicies.size() == 2\n+            accessPolicies.stream().noneMatch({it.identifier == \"policy-3\"})\n         }\n \n \n-        when: \"get user for non-existent user identifier\"\n-        userGroupProvider.getUser(\"nonExistentUserId\") >> null\n-        userGroupProvider.getGroup(\"nonExistentUserId\") >> null\n-        def user2 = authorizationService.getUser(\"nonExistentUserId\")\n+        when: \"get user for non-existent tenant identifier\"\n+        def user2 = authorizationService.getUser(\"does-not-exist\")\n \n         then: \"no user is returned\"\n         user2 == null\n@@ -375,7 +386,6 @@ class AuthorizationServiceSpec extends Specification {\n \n     }\n \n-\n     def \"update access policy\"() {\n \n         setup:", "filename": "nifi-registry-core/nifi-registry-framework/src/test/groovy/org/apache/nifi/registry/service/AuthorizationServiceSpec.groovy"}], "repo": "nifi-registry"}, {"commit": "https://github.com/apache/nifi-registry/commit/79e453fd2b3a13f244718084912fb884edf73afe", "parent": "https://github.com/apache/nifi-registry/commit/88584ec33c1bedca955398188f4a511393b58ead", "message": "NIFIREG-144 Fixing NPE when retrieving latest snapshot when no versions exist\n\nThis closes #105.\n\nSigned-off-by: Kevin Doran <kdoran@apache.org>", "bug_id": "nifi-registry_2", "file": [{"additions": 4, "raw_url": "https://github.com/apache/nifi-registry/raw/79e453fd2b3a13f244718084912fb884edf73afe/nifi-registry-framework/src/main/java/org/apache/nifi/registry/service/RegistryService.java", "blob_url": "https://github.com/apache/nifi-registry/blob/79e453fd2b3a13f244718084912fb884edf73afe/nifi-registry-framework/src/main/java/org/apache/nifi/registry/service/RegistryService.java", "sha": "b03116251d91a4a5a8be602a6b3ccf32ea0c447f", "changes": 27, "status": "modified", "deletions": 23, "contents_url": "https://api.github.com/repos/apache/nifi-registry/contents/nifi-registry-framework/src/main/java/org/apache/nifi/registry/service/RegistryService.java?ref=79e453fd2b3a13f244718084912fb884edf73afe", "patch": "@@ -150,7 +150,6 @@ public Bucket getBucket(final String bucketIdentifier) {\n             final BucketEntity bucket = metadataService.getBucketById(bucketIdentifier);\n             if (bucket == null) {\n                 LOGGER.warn(\"The specified bucket id [{}] does not exist.\", bucketIdentifier);\n-\n                 throw new ResourceNotFoundException(\"The specified bucket ID does not exist in this registry.\");\n             }\n \n@@ -199,7 +198,6 @@ public Bucket updateBucket(final Bucket bucket) {\n             final BucketEntity existingBucketById = metadataService.getBucketById(bucket.getIdentifier());\n             if (existingBucketById == null) {\n                 LOGGER.warn(\"The specified bucket id [{}] does not exist.\", bucket.getIdentifier());\n-\n                 throw new ResourceNotFoundException(\"The specified bucket ID does not exist in this registry.\");\n             }\n \n@@ -244,7 +242,6 @@ public Bucket deleteBucket(final String bucketIdentifier) {\n             final BucketEntity existingBucket = metadataService.getBucketById(bucketIdentifier);\n             if (existingBucket == null) {\n                 LOGGER.warn(\"The specified bucket id [{}] does not exist.\", bucketIdentifier);\n-\n                 throw new ResourceNotFoundException(\"The specified bucket ID does not exist in this registry.\");\n             }\n \n@@ -274,7 +271,6 @@ public Bucket deleteBucket(final String bucketIdentifier) {\n             final BucketEntity bucket = metadataService.getBucketById(bucketIdentifier);\n             if (bucket == null) {\n                 LOGGER.warn(\"The specified bucket id [{}] does not exist.\", bucketIdentifier);\n-\n                 throw new ResourceNotFoundException(\"The specified bucket ID does not exist in this registry.\");\n             }\n \n@@ -345,7 +341,6 @@ public VersionedFlow createFlow(final String bucketIdentifier, final VersionedFl\n             final BucketEntity existingBucket = metadataService.getBucketById(bucketIdentifier);\n             if (existingBucket == null) {\n                 LOGGER.warn(\"The specified bucket id [{}] does not exist.\", bucketIdentifier);\n-\n                 throw new ResourceNotFoundException(\"The specified bucket ID does not exist in this registry.\");\n             }\n \n@@ -382,14 +377,12 @@ public VersionedFlow getFlow(final String bucketIdentifier, final String flowIde\n             final BucketEntity existingBucket = metadataService.getBucketById(bucketIdentifier);\n             if (existingBucket == null) {\n                 LOGGER.warn(\"The specified bucket id [{}] does not exist.\", bucketIdentifier);\n-\n                 throw new ResourceNotFoundException(\"The specified bucket ID does not exist in this registry.\");\n             }\n \n             final FlowEntity existingFlow = metadataService.getFlowByIdWithSnapshotCounts(flowIdentifier);\n             if (existingFlow == null) {\n                 LOGGER.warn(\"The specified flow id [{}] does not exist.\", flowIdentifier);\n-\n                 throw new ResourceNotFoundException(\"The specified flow ID does not exist in this bucket.\");\n             }\n \n@@ -413,7 +406,6 @@ public VersionedFlow getFlow(final String bucketIdentifier, final String flowIde\n             final BucketEntity existingBucket = metadataService.getBucketById(bucketId);\n             if (existingBucket == null) {\n                 LOGGER.warn(\"The specified bucket id [{}] does not exist.\", bucketId);\n-\n                 throw new ResourceNotFoundException(\"The specified bucket ID does not exist in this registry.\");\n             }\n \n@@ -448,14 +440,12 @@ public VersionedFlow updateFlow(final VersionedFlow versionedFlow) {\n             final BucketEntity existingBucket = metadataService.getBucketById(versionedFlow.getBucketIdentifier());\n             if (existingBucket == null) {\n                 LOGGER.warn(\"The specified bucket id [{}] does not exist.\", versionedFlow.getBucketIdentifier());\n-\n                 throw new ResourceNotFoundException(\"The specified bucket ID does not exist in this registry.\");\n             }\n \n             final FlowEntity existingFlow = metadataService.getFlowByIdWithSnapshotCounts(versionedFlow.getIdentifier());\n             if (existingFlow == null) {\n                 LOGGER.warn(\"The specified flow id [{}] does not exist.\", versionedFlow.getIdentifier());\n-\n                 throw new ResourceNotFoundException(\"The specified flow ID does not exist in this bucket.\");\n             }\n \n@@ -507,15 +497,13 @@ public VersionedFlow deleteFlow(final String bucketIdentifier, final String flow\n             final BucketEntity existingBucket = metadataService.getBucketById(bucketIdentifier);\n             if (existingBucket == null) {\n                 LOGGER.warn(\"The specified bucket id [{}] does not exist.\", bucketIdentifier);\n-\n                 throw new ResourceNotFoundException(\"The specified bucket ID does not exist in this registry.\");\n             }\n \n             // ensure the flow exists\n             final FlowEntity existingFlow = metadataService.getFlowById(flowIdentifier);\n             if (existingFlow == null) {\n                 LOGGER.warn(\"The specified flow id [{}] does not exist.\", flowIdentifier);\n-\n                 throw new ResourceNotFoundException(\"The specified flow ID does not exist in this bucket.\");\n             }\n \n@@ -561,15 +549,13 @@ public VersionedFlowSnapshot createFlowSnapshot(final VersionedFlowSnapshot flow\n             final BucketEntity existingBucket = metadataService.getBucketById(snapshotMetadata.getBucketIdentifier());\n             if (existingBucket == null) {\n                 LOGGER.warn(\"The specified bucket id [{}] does not exist.\", snapshotMetadata.getBucketIdentifier());\n-\n                 throw new ResourceNotFoundException(\"The specified bucket ID does not exist in this registry.\");\n             }\n \n             // ensure the flow exists\n             final FlowEntity existingFlow = metadataService.getFlowById(snapshotMetadata.getFlowIdentifier());\n             if (existingFlow == null) {\n                 LOGGER.warn(\"The specified flow id [{}] does not exist.\", snapshotMetadata.getFlowIdentifier());\n-\n                 throw new ResourceNotFoundException(\"The specified flow ID does not exist in this bucket.\");\n             }\n \n@@ -650,15 +636,13 @@ public VersionedFlowSnapshot getFlowSnapshot(final String bucketIdentifier, fina\n             final BucketEntity existingBucket = metadataService.getBucketById(bucketIdentifier);\n             if (existingBucket == null) {\n                 LOGGER.warn(\"The specified bucket id [{}] does not exist.\", bucketIdentifier);\n-\n                 throw new ResourceNotFoundException(\"The specified bucket ID does not exist in this registry.\");\n             }\n \n             // we need to populate the version count here so we have to do this retrieval instead of snapshotEntity.getFlow()\n             final FlowEntity flowEntityWithCount = metadataService.getFlowByIdWithSnapshotCounts(flowIdentifier);\n             if (flowEntityWithCount == null) {\n                 LOGGER.warn(\"The specified flow id [{}] does not exist.\", flowIdentifier);\n-\n                 throw new ResourceNotFoundException(\"The specified flow ID does not exist in this bucket.\");\n             }\n \n@@ -670,7 +654,6 @@ public VersionedFlowSnapshot getFlowSnapshot(final String bucketIdentifier, fina\n             final FlowSnapshotEntity snapshotEntity = metadataService.getFlowSnapshot(flowIdentifier, version);\n             if (snapshotEntity == null) {\n                 LOGGER.warn(\"The specified flow snapshot id [{}] does not exist for version [{}].\", flowIdentifier, version);\n-\n                 throw new ResourceNotFoundException(\"The specified versioned flow snapshot does not exist for this flow.\");\n             }\n \n@@ -725,15 +708,13 @@ public VersionedFlowSnapshot getFlowSnapshot(final String bucketIdentifier, fina\n             final BucketEntity existingBucket = metadataService.getBucketById(bucketIdentifier);\n             if (existingBucket == null) {\n                 LOGGER.warn(\"The specified bucket id [{}] does not exist.\", bucketIdentifier);\n-\n                 throw new ResourceNotFoundException(\"The specified bucket ID does not exist in this registry.\");\n             }\n \n             // ensure the flow exists\n             final FlowEntity existingFlow = metadataService.getFlowById(flowIdentifier);\n             if (existingFlow == null) {\n                 LOGGER.warn(\"The specified flow id [{}] does not exist.\", flowIdentifier);\n-\n                 throw new ResourceNotFoundException(\"The specified flow ID does not exist in this bucket.\");\n             }\n \n@@ -770,15 +751,13 @@ public VersionedFlowSnapshotMetadata getLatestFlowSnapshotMetadata(final String\n             final BucketEntity existingBucket = metadataService.getBucketById(bucketIdentifier);\n             if (existingBucket == null) {\n                 LOGGER.warn(\"The specified bucket id [{}] does not exist.\", bucketIdentifier);\n-\n                 throw new ResourceNotFoundException(\"The specified bucket ID does not exist in this registry.\");\n             }\n \n             // ensure the flow exists\n             final FlowEntity existingFlow = metadataService.getFlowById(flowIdentifier);\n             if (existingFlow == null) {\n                 LOGGER.warn(\"The specified flow id [{}] does not exist.\", flowIdentifier);\n-\n                 throw new ResourceNotFoundException(\"The specified flow ID does not exist in this bucket.\");\n             }\n \n@@ -788,6 +767,10 @@ public VersionedFlowSnapshotMetadata getLatestFlowSnapshotMetadata(final String\n \n             // get latest snapshot for the flow\n             final FlowSnapshotEntity latestSnapshot = metadataService.getLatestSnapshot(existingFlow.getId());\n+            if (latestSnapshot == null) {\n+                throw new ResourceNotFoundException(\"The specified flow ID has no versions\");\n+            }\n+\n             return DataModelMapper.map(existingBucket, latestSnapshot);\n         } finally {\n             readLock.unlock();\n@@ -813,15 +796,13 @@ public VersionedFlowSnapshotMetadata deleteFlowSnapshot(final String bucketIdent\n             final BucketEntity existingBucket = metadataService.getBucketById(bucketIdentifier);\n             if (existingBucket == null) {\n                 LOGGER.warn(\"The specified bucket id [{}] does not exist.\", bucketIdentifier);\n-\n                 throw new ResourceNotFoundException(\"The specified bucket ID does not exist in this registry.\");\n             }\n \n             // ensure the flow exists\n             final FlowEntity existingFlow = metadataService.getFlowById(flowIdentifier);\n             if (existingFlow == null) {\n                 LOGGER.warn(\"The specified flow id [{}] does not exist.\", flowIdentifier);\n-\n                 throw new ResourceNotFoundException(\"The specified flow ID does not exist in this bucket.\");\n             }\n ", "filename": "nifi-registry-framework/src/main/java/org/apache/nifi/registry/service/RegistryService.java"}, {"additions": 74, "raw_url": "https://github.com/apache/nifi-registry/raw/79e453fd2b3a13f244718084912fb884edf73afe/nifi-registry-framework/src/test/java/org/apache/nifi/registry/service/TestRegistryService.java", "blob_url": "https://github.com/apache/nifi-registry/blob/79e453fd2b3a13f244718084912fb884edf73afe/nifi-registry-framework/src/test/java/org/apache/nifi/registry/service/TestRegistryService.java", "sha": "c35cda79a5aacd5fb045dcb7fde76cb0037c5e6c", "changes": 74, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/nifi-registry/contents/nifi-registry-framework/src/test/java/org/apache/nifi/registry/service/TestRegistryService.java?ref=79e453fd2b3a13f244718084912fb884edf73afe", "patch": "@@ -32,6 +32,7 @@\n import org.apache.nifi.registry.flow.VersionedProcessor;\n import org.apache.nifi.registry.serialization.Serializer;\n import org.apache.nifi.registry.serialization.VersionedProcessGroupSerializer;\n+import org.junit.Assert;\n import org.junit.Before;\n import org.junit.Test;\n import org.mockito.invocation.InvocationOnMock;\n@@ -862,6 +863,79 @@ public void testGetFlowSnapshotsWhenNoSnapshots() {\n         assertEquals(0, retrievedSnapshots.size());\n     }\n \n+    @Test\n+    public void testGetLatestSnapshotMetadataWhenVersionsExist() {\n+        final BucketEntity existingBucket = new BucketEntity();\n+        existingBucket.setId(\"b1\");\n+        existingBucket.setName(\"My Bucket\");\n+        existingBucket.setDescription(\"This is my bucket\");\n+        existingBucket.setCreated(new Date());\n+\n+        when(metadataService.getBucketById(existingBucket.getId())).thenReturn(existingBucket);\n+\n+        // return a flow with the existing snapshot when getFlowById is called\n+        final FlowEntity existingFlow = new FlowEntity();\n+        existingFlow.setId(\"flow1\");\n+        existingFlow.setName(\"My Flow\");\n+        existingFlow.setDescription(\"This is my flow.\");\n+        existingFlow.setCreated(new Date());\n+        existingFlow.setModified(new Date());\n+        existingFlow.setBucketId(existingBucket.getId());\n+\n+        when(metadataService.getFlowById(existingFlow.getId())).thenReturn(existingFlow);\n+\n+        final FlowSnapshotEntity existingSnapshot1 = new FlowSnapshotEntity();\n+        existingSnapshot1.setVersion(1);\n+        existingSnapshot1.setFlowId(existingFlow.getId());\n+        existingSnapshot1.setCreatedBy(\"user1\");\n+        existingSnapshot1.setCreated(new Date());\n+        existingSnapshot1.setComments(\"This is snapshot 1\");\n+\n+        when(metadataService.getLatestSnapshot(existingFlow.getId())).thenReturn(existingSnapshot1);\n+\n+        VersionedFlowSnapshotMetadata latestMetadata = registryService.getLatestFlowSnapshotMetadata(existingBucket.getId(), existingFlow.getId());\n+        assertNotNull(latestMetadata);\n+        assertEquals(1, latestMetadata.getVersion());\n+    }\n+\n+    @Test\n+    public void testGetLatestSnapshotMetadataWhenNoVersionsExist() {\n+        final BucketEntity existingBucket = new BucketEntity();\n+        existingBucket.setId(\"b1\");\n+        existingBucket.setName(\"My Bucket\");\n+        existingBucket.setDescription(\"This is my bucket\");\n+        existingBucket.setCreated(new Date());\n+\n+        when(metadataService.getBucketById(existingBucket.getId())).thenReturn(existingBucket);\n+\n+        // return a flow with the existing snapshot when getFlowById is called\n+        final FlowEntity existingFlow = new FlowEntity();\n+        existingFlow.setId(\"flow1\");\n+        existingFlow.setName(\"My Flow\");\n+        existingFlow.setDescription(\"This is my flow.\");\n+        existingFlow.setCreated(new Date());\n+        existingFlow.setModified(new Date());\n+        existingFlow.setBucketId(existingBucket.getId());\n+\n+        when(metadataService.getFlowById(existingFlow.getId())).thenReturn(existingFlow);\n+\n+        final FlowSnapshotEntity existingSnapshot1 = new FlowSnapshotEntity();\n+        existingSnapshot1.setVersion(1);\n+        existingSnapshot1.setFlowId(existingFlow.getId());\n+        existingSnapshot1.setCreatedBy(\"user1\");\n+        existingSnapshot1.setCreated(new Date());\n+        existingSnapshot1.setComments(\"This is snapshot 1\");\n+\n+        when(metadataService.getLatestSnapshot(existingFlow.getId())).thenReturn(null);\n+\n+        try {\n+            registryService.getLatestFlowSnapshotMetadata(existingBucket.getId(), existingFlow.getId());\n+            Assert.fail(\"Should have thrown exception\");\n+        } catch (ResourceNotFoundException e) {\n+            assertEquals(\"The specified flow ID has no versions\", e.getMessage());\n+        }\n+    }\n+\n     @Test(expected = ResourceNotFoundException.class)\n     public void testGetSnapshotDoesNotExistInMetadataProvider() {\n         final String bucketId = \"b1\";", "filename": "nifi-registry-framework/src/test/java/org/apache/nifi/registry/service/TestRegistryService.java"}, {"additions": 2, "raw_url": "https://github.com/apache/nifi-registry/raw/79e453fd2b3a13f244718084912fb884edf73afe/nifi-registry-web-api/src/main/java/org/apache/nifi/registry/web/api/BucketFlowResource.java", "blob_url": "https://github.com/apache/nifi-registry/blob/79e453fd2b3a13f244718084912fb884edf73afe/nifi-registry-web-api/src/main/java/org/apache/nifi/registry/web/api/BucketFlowResource.java", "sha": "64f18306285ffede0409e0a00c856eeca0ef505a", "changes": 17, "status": "modified", "deletions": 15, "contents_url": "https://api.github.com/repos/apache/nifi-registry/contents/nifi-registry-web-api/src/main/java/org/apache/nifi/registry/web/api/BucketFlowResource.java?ref=79e453fd2b3a13f244718084912fb884edf73afe", "patch": "@@ -27,7 +27,6 @@\n import org.apache.commons.lang3.StringUtils;\n import org.apache.nifi.registry.bucket.BucketItem;\n import org.apache.nifi.registry.diff.VersionedFlowDifference;\n-import org.apache.nifi.registry.exception.ResourceNotFoundException;\n import org.apache.nifi.registry.flow.VersionedFlow;\n import org.apache.nifi.registry.flow.VersionedFlowSnapshot;\n import org.apache.nifi.registry.flow.VersionedFlowSnapshotMetadata;\n@@ -376,14 +375,8 @@ public Response getLatestFlowVersion(\n \n         authorizeBucketAccess(RequestAction.READ, bucketId);\n \n-        final VersionedFlowSnapshotMetadata latest = registryService.getLatestFlowSnapshotMetadata(bucketId, flowId);\n-        if (latest == null) {\n-            logger.warn(\"The specified flow id [{}] does not exist.\", flowId);\n-\n-            throw new ResourceNotFoundException(\"The specified flow ID does not exist in this bucket.\");\n-        }\n-\n-        final VersionedFlowSnapshot lastSnapshot = registryService.getFlowSnapshot(bucketId, flowId, latest.getVersion());\n+        final VersionedFlowSnapshotMetadata latestMetadata = registryService.getLatestFlowSnapshotMetadata(bucketId, flowId);\n+        final VersionedFlowSnapshot lastSnapshot = registryService.getFlowSnapshot(bucketId, flowId, latestMetadata.getVersion());\n         populateLinksAndPermissions(lastSnapshot);\n \n         return Response.status(Response.Status.OK).entity(lastSnapshot).build();\n@@ -418,12 +411,6 @@ public Response getLatestFlowVersionMetadata(\n         authorizeBucketAccess(RequestAction.READ, bucketId);\n \n         final VersionedFlowSnapshotMetadata latest = registryService.getLatestFlowSnapshotMetadata(bucketId, flowId);\n-        if (latest == null) {\n-            logger.warn(\"The specified flow id [{}] does not exist.\", flowId);\n-\n-            throw new ResourceNotFoundException(\"The specified flow ID does not exist in this bucket.\");\n-        }\n-\n         linkService.populateSnapshotLinks(latest);\n \n         return Response.status(Response.Status.OK).entity(latest).build();", "filename": "nifi-registry-web-api/src/main/java/org/apache/nifi/registry/web/api/BucketFlowResource.java"}], "repo": "nifi-registry"}]
