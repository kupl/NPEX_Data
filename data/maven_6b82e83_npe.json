[
    {
        "repo": "maven",
        "commit": "https://github.com/apache/maven/commit/6b82e83024800c0c0e55d1da7282f0558a7278a4",
        "bug_id": "maven_6b82e83",
        "message": "[MNG-4776] NPE during build from parent but not from child\n\ngit-svn-id: https://svn.apache.org/repos/asf/maven/maven-3/trunk@989222 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/maven/commit/6c37a89744149e68f198429fb7eac70fe1707360",
        "patched_files": [
            "MojoDescriptorCreator.java",
            "LifecycleExecutionPlanCalculator.java",
            "LifecyclePluginResolver.java",
            "DefaultLifecycleExecutionPlanCalculator.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 6,
                "raw_url": "https://github.com/apache/maven/raw/6b82e83024800c0c0e55d1da7282f0558a7278a4/maven-core/src/main/java/org/apache/maven/lifecycle/internal/DefaultLifecycleExecutionPlanCalculator.java",
                "contents_url": "https://api.github.com/repos/apache/maven/contents/maven-core/src/main/java/org/apache/maven/lifecycle/internal/DefaultLifecycleExecutionPlanCalculator.java?ref=6b82e83024800c0c0e55d1da7282f0558a7278a4",
                "filename": "maven-core/src/main/java/org/apache/maven/lifecycle/internal/DefaultLifecycleExecutionPlanCalculator.java",
                "deletions": 3,
                "sha": "bc113350d725811dcf817b43b7b31fd5f3e47521",
                "blob_url": "https://github.com/apache/maven/blob/6b82e83024800c0c0e55d1da7282f0558a7278a4/maven-core/src/main/java/org/apache/maven/lifecycle/internal/DefaultLifecycleExecutionPlanCalculator.java",
                "patch": "@@ -483,11 +483,9 @@ public void calculateForkedExecutions( MojoExecution mojoExecution, MavenSession\n         PluginDescriptorParsingException, NoPluginFoundForPrefixException, InvalidPluginDescriptorException,\n         LifecyclePhaseNotFoundException, LifecycleNotFoundException, PluginVersionResolutionException\n     {\n-            calculateForkedExecutions( mojoExecution, session, session.getCurrentProject(), new HashSet<MojoDescriptor>() );\n-\n+        calculateForkedExecutions( mojoExecution, session, session.getCurrentProject(), new HashSet<MojoDescriptor>() );\n     }\n \n-\n     private void calculateForkedExecutions( MojoExecution mojoExecution, MavenSession session, MavenProject project,\n                                             Collection<MojoDescriptor> alreadyForkedExecutions )\n         throws MojoNotFoundException, PluginNotFoundException, PluginResolutionException,\n@@ -511,6 +509,11 @@ private void calculateForkedExecutions( MojoExecution mojoExecution, MavenSessio\n \n         for ( MavenProject forkedProject : forkedProjects )\n         {\n+            if ( forkedProject != project )\n+            {\n+                lifecyclePluginResolver.resolveMissingPluginVersions( forkedProject, session );\n+            }\n+\n             List<MojoExecution> forkedExecutions;\n \n             if ( StringUtils.isNotEmpty( mojoDescriptor.getExecutePhase() ) )",
                "changes": 9
            },
            {
                "status": "modified",
                "additions": 1,
                "raw_url": "https://github.com/apache/maven/raw/6b82e83024800c0c0e55d1da7282f0558a7278a4/maven-core/src/main/java/org/apache/maven/lifecycle/internal/LifecyclePluginResolver.java",
                "contents_url": "https://api.github.com/repos/apache/maven/contents/maven-core/src/main/java/org/apache/maven/lifecycle/internal/LifecyclePluginResolver.java?ref=6b82e83024800c0c0e55d1da7282f0558a7278a4",
                "filename": "maven-core/src/main/java/org/apache/maven/lifecycle/internal/LifecyclePluginResolver.java",
                "deletions": 1,
                "sha": "63ebcb7bb2b8c26580e23a7d859328f5ab5a6ed6",
                "blob_url": "https://github.com/apache/maven/blob/6b82e83024800c0c0e55d1da7282f0558a7278a4/maven-core/src/main/java/org/apache/maven/lifecycle/internal/LifecyclePluginResolver.java",
                "patch": "@@ -60,7 +60,7 @@ public LifecyclePluginResolver()\n     public void resolveMissingPluginVersions( MavenProject project, MavenSession session )\n         throws PluginVersionResolutionException\n     {\n-        Map<String, String> versions = new HashMap<String, String>();\n+        Map<String, String> versions = new HashMap<String, String>( 64 );\n \n         for ( Plugin plugin : project.getBuildPlugins() )\n         {",
                "changes": 2
            },
            {
                "status": "modified",
                "additions": 24,
                "raw_url": "https://github.com/apache/maven/raw/6b82e83024800c0c0e55d1da7282f0558a7278a4/maven-core/src/main/java/org/apache/maven/lifecycle/internal/MojoDescriptorCreator.java",
                "contents_url": "https://api.github.com/repos/apache/maven/contents/maven-core/src/main/java/org/apache/maven/lifecycle/internal/MojoDescriptorCreator.java?ref=6b82e83024800c0c0e55d1da7282f0558a7278a4",
                "filename": "maven-core/src/main/java/org/apache/maven/lifecycle/internal/MojoDescriptorCreator.java",
                "deletions": 1,
                "sha": "cdc9e7d8296fb9425a3f28764edf7db28dcca02d",
                "blob_url": "https://github.com/apache/maven/blob/6b82e83024800c0c0e55d1da7282f0558a7278a4/maven-core/src/main/java/org/apache/maven/lifecycle/internal/MojoDescriptorCreator.java",
                "patch": "@@ -42,6 +42,7 @@\n import org.codehaus.plexus.component.annotations.Component;\n import org.codehaus.plexus.component.annotations.Requirement;\n import org.codehaus.plexus.configuration.PlexusConfiguration;\n+import org.codehaus.plexus.logging.Logger;\n import org.codehaus.plexus.util.xml.Xpp3Dom;\n \n import java.util.ArrayList;\n@@ -63,6 +64,10 @@\n @Component( role = MojoDescriptorCreator.class )\n public class MojoDescriptorCreator\n {\n+\n+    @Requirement\n+    private Logger logger;\n+\n     @Requirement\n     private PluginVersionResolver pluginVersionResolver;\n \n@@ -72,17 +77,22 @@\n     @Requirement\n     private PluginPrefixResolver pluginPrefixResolver;\n \n+    @Requirement\n+    private LifecyclePluginResolver lifecyclePluginResolver;\n+\n     @SuppressWarnings( { \"UnusedDeclaration\" } )\n     public MojoDescriptorCreator()\n     {\n     }\n \n     public MojoDescriptorCreator( PluginVersionResolver pluginVersionResolver, BuildPluginManager pluginManager,\n-                                  PluginPrefixResolver pluginPrefixResolver )\n+                                  PluginPrefixResolver pluginPrefixResolver,\n+                                  LifecyclePluginResolver lifecyclePluginResolver )\n     {\n         this.pluginVersionResolver = pluginVersionResolver;\n         this.pluginManager = pluginManager;\n         this.pluginPrefixResolver = pluginPrefixResolver;\n+        this.lifecyclePluginResolver = lifecyclePluginResolver;\n     }\n \n     private Plugin findPlugin( String groupId, String artifactId, Collection<Plugin> plugins )\n@@ -221,6 +231,19 @@ public Plugin findPluginForPrefix( String prefix, MavenSession session )\n     {\n         // [prefix]:[goal]\n \n+        if ( session.getCurrentProject() != null )\n+        {\n+            try\n+            {\n+                lifecyclePluginResolver.resolveMissingPluginVersions( session.getCurrentProject(), session );\n+            }\n+            catch ( PluginVersionResolutionException e )\n+            {\n+                // not critical here\n+                logger.debug( e.getMessage(), e );\n+            }\n+        }\n+\n         PluginPrefixRequest prefixRequest = new DefaultPluginPrefixRequest( prefix, session );\n         PluginPrefixResult prefixResult = pluginPrefixResolver.resolve( prefixRequest );\n ",
                "changes": 25
            },
            {
                "status": "modified",
                "additions": 2,
                "raw_url": "https://github.com/apache/maven/raw/6b82e83024800c0c0e55d1da7282f0558a7278a4/maven-core/src/test/java/org/apache/maven/lifecycle/internal/LifecycleExecutionPlanCalculatorTest.java",
                "contents_url": "https://api.github.com/repos/apache/maven/contents/maven-core/src/test/java/org/apache/maven/lifecycle/internal/LifecycleExecutionPlanCalculatorTest.java?ref=6b82e83024800c0c0e55d1da7282f0558a7278a4",
                "filename": "maven-core/src/test/java/org/apache/maven/lifecycle/internal/LifecycleExecutionPlanCalculatorTest.java",
                "deletions": 1,
                "sha": "0e2ca5a9174aec7539b7d0512e6df4c610dd59aa",
                "blob_url": "https://github.com/apache/maven/blob/6b82e83024800c0c0e55d1da7282f0558a7278a4/maven-core/src/test/java/org/apache/maven/lifecycle/internal/LifecycleExecutionPlanCalculatorTest.java",
                "patch": "@@ -73,6 +73,7 @@ public static LifecycleExecutionPlanCalculator createExecutionPlaceCalculator(\n     public static MojoDescriptorCreator createMojoDescriptorCreator()\n     {\n         return new MojoDescriptorCreator( new PluginVersionResolverStub(), new BuildPluginManagerStub(),\n-                                          new PluginPrefixResolverStub() );\n+                                          new PluginPrefixResolverStub(),\n+                                          new LifecyclePluginResolver( new PluginVersionResolverStub() ) );\n     }\n }",
                "changes": 3
            }
        ],
        "unit_tests": [
            "LifecycleExecutionPlanCalculatorTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "maven-core/src/test/java/org/apache/maven/lifecycle/internal/LifecycleExecutionPlanCalculatorTest.java",
        "buggy_files": [
            "maven-core/src/main/java/org/apache/maven/lifecycle/internal/MojoDescriptorCreator.java",
            "maven-core/src/main/java/org/apache/maven/lifecycle/internal/LifecycleExecutionPlanCalculator.java",
            "maven-core/src/main/java/org/apache/maven/lifecycle/internal/LifecyclePluginResolver.java",
            "maven-core/src/main/java/org/apache/maven/lifecycle/internal/DefaultLifecycleExecutionPlanCalculator.java"
        ],
        "fixed": true
    }
]