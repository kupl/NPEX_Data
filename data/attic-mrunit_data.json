[{"commit": "https://github.com/apache/attic-mrunit/commit/57196c39a73cf2251e0f2ba7da225731362407ba", "parent": "https://github.com/apache/attic-mrunit/commit/2c24ab2af152bc7b41c4d52cba4883aacba40764", "message": "MRUNIT-193 - Serialization.copy throws NPE instead of ISE (missing serilization impl) for Hadoop 2.x (Cosmin Lehen via Brock Noland)", "bug_id": "attic-mrunit_1", "file": [{"additions": 9, "raw_url": "https://github.com/apache/attic-mrunit/raw/57196c39a73cf2251e0f2ba7da225731362407ba/src/main/java/org/apache/hadoop/mrunit/internal/io/Serialization.java", "blob_url": "https://github.com/apache/attic-mrunit/blob/57196c39a73cf2251e0f2ba7da225731362407ba/src/main/java/org/apache/hadoop/mrunit/internal/io/Serialization.java", "sha": "8301d41b7320c6723c8d14f37bf799289a5a3040", "changes": 12, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/attic-mrunit/contents/src/main/java/org/apache/hadoop/mrunit/internal/io/Serialization.java?ref=57196c39a73cf2251e0f2ba7da225731362407ba", "patch": "@@ -17,6 +17,8 @@\n  */\n package org.apache.hadoop.mrunit.internal.io;\n \n+import com.google.common.base.Preconditions;\n+\n import java.io.IOException;\n \n import org.apache.hadoop.conf.Configuration;\n@@ -58,16 +60,20 @@ public Serialization(Configuration conf) {\n     final Class<?> clazz = orig.getClass();\n     final Serializer<Object> serializer;\n     final Deserializer<Object> deserializer;\n+    String errorMsg = \"No applicable class implementing Serialization in conf \"\n+                      + \"at io.serializations: \" + clazz;\n     try {\n       serializer = (Serializer<Object>) serializationFactory\n           .getSerializer(clazz);\n       deserializer = (Deserializer<Object>) serializationFactory\n           .getDeserializer(clazz);\n+    // hadoop 1.x will throw\n     } catch (NullPointerException e) {\n-      throw new IllegalStateException(\n-          \"No applicable class implementing Serialization in conf at io.serializations for \"\n-              + orig.getClass(), e);\n+      throw new IllegalStateException(errorMsg, e);\n     }\n+    // hadoop 2.x will return a null\n+    Preconditions.checkState(serializer != null, errorMsg);\n+    Preconditions.checkState(deserializer != null, errorMsg);\n     try {\n       final DataOutputBuffer outputBuffer = new DataOutputBuffer();\n       serializer.open(outputBuffer);", "filename": "src/main/java/org/apache/hadoop/mrunit/internal/io/Serialization.java"}, {"additions": 12, "raw_url": "https://github.com/apache/attic-mrunit/raw/57196c39a73cf2251e0f2ba7da225731362407ba/src/test/java/org/apache/hadoop/mrunit/internal/io/TestSerialization.java", "blob_url": "https://github.com/apache/attic-mrunit/blob/57196c39a73cf2251e0f2ba7da225731362407ba/src/test/java/org/apache/hadoop/mrunit/internal/io/TestSerialization.java", "sha": "ac530ab80a180aba4be712940eb26d3da3dfb629", "changes": 15, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/attic-mrunit/contents/src/test/java/org/apache/hadoop/mrunit/internal/io/TestSerialization.java?ref=57196c39a73cf2251e0f2ba7da225731362407ba", "patch": "@@ -17,13 +17,14 @@\n  */\n package org.apache.hadoop.mrunit.internal.io;\n \n-import static org.junit.Assert.assertEquals;\n-\n import org.apache.hadoop.conf.Configuration;\n import org.apache.hadoop.io.IntWritable;\n-import org.apache.hadoop.mrunit.internal.io.Serialization;\n+import org.apache.hadoop.io.Writable;\n import org.junit.Test;\n \n+import static org.junit.Assert.assertEquals;\n+import static org.mockito.Mockito.mock;\n+\n public class TestSerialization {\n \n   @Test\n@@ -58,4 +59,12 @@ public void testDontChangeStateOfCopyArgument() {\n     assertEquals(new Integer(2), int2);\n   }\n \n+  @Test(expected = IllegalStateException.class)\n+  public void testCopyExceptionIfNoSerializer() {\n+    final Configuration conf = new Configuration();\n+    Serialization serialization = new Serialization(conf);\n+    // there's no implicit serializer for Integer, so it should throw ISE\n+    serialization.copy(1, 1);\n+  }\n+\n }", "filename": "src/test/java/org/apache/hadoop/mrunit/internal/io/TestSerialization.java"}], "repo": "attic-mrunit"}]
