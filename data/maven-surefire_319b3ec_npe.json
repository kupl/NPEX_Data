[
    {
        "repo": "maven-surefire",
        "commit": "https://github.com/apache/maven-surefire/commit/319b3ec6e2c44536bde521563654c5f7f4251255",
        "bug_id": "maven-surefire_319b3ec",
        "message": "[SUREFIRE-1121] NPE DefaultReporterFactory.mergeFromOtherFactories(DefaultReporterFactory.java:82)",
        "parent": "https://github.com/apache/maven-surefire/commit/65e062cb858a9f2b162e6acc00e980cb584819f4",
        "patched_files": [
            "DefaultReporterFactory.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 12,
                "raw_url": "https://github.com/apache/maven-surefire/raw/319b3ec6e2c44536bde521563654c5f7f4251255/maven-surefire-common/src/main/java/org/apache/maven/plugin/surefire/booterclient/ForkStarter.java",
                "contents_url": "https://api.github.com/repos/apache/maven-surefire/contents/maven-surefire-common/src/main/java/org/apache/maven/plugin/surefire/booterclient/ForkStarter.java?ref=319b3ec6e2c44536bde521563654c5f7f4251255",
                "filename": "maven-surefire-common/src/main/java/org/apache/maven/plugin/surefire/booterclient/ForkStarter.java",
                "deletions": 10,
                "sha": "acd8da9dfc324724e45b6bc6f049a8be3f40c084",
                "blob_url": "https://github.com/apache/maven-surefire/blob/319b3ec6e2c44536bde521563654c5f7f4251255/maven-surefire-common/src/main/java/org/apache/maven/plugin/surefire/booterclient/ForkStarter.java",
                "patch": "@@ -23,6 +23,7 @@\n import java.io.IOException;\n import java.io.InputStream;\n import java.util.ArrayList;\n+import java.util.Collection;\n import java.util.Iterator;\n import java.util.List;\n import java.util.Properties;\n@@ -36,6 +37,7 @@\n import java.util.concurrent.LinkedBlockingQueue;\n import java.util.concurrent.ThreadPoolExecutor;\n import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicReference;\n \n import org.apache.maven.plugin.logging.Log;\n import org.apache.maven.plugin.surefire.AbstractSurefireMojo;\n@@ -88,29 +90,29 @@\n     /**\n      * Closes an InputStream\n      */\n-    private final class InputStreamCloser\n+    private static class InputStreamCloser\n         implements Runnable\n     {\n-        private InputStream testProvidingInputStream;\n+        private final AtomicReference<InputStream> testProvidingInputStream;\n \n         public InputStreamCloser( InputStream testProvidingInputStream )\n         {\n-            this.testProvidingInputStream = testProvidingInputStream;\n+            this.testProvidingInputStream = new AtomicReference<InputStream>( testProvidingInputStream );\n         }\n \n-        public synchronized void run()\n+        public void run()\n         {\n-            if ( testProvidingInputStream != null )\n+            InputStream stream = testProvidingInputStream.getAndSet( null );\n+            if ( stream != null )\n             {\n                 try\n                 {\n-                    testProvidingInputStream.close();\n+                    stream.close();\n                 }\n                 catch ( IOException e )\n                 {\n                     // ignore\n                 }\n-                testProvidingInputStream = null;\n             }\n         }\n     }\n@@ -125,11 +127,11 @@ public synchronized void run()\n \n     private final StartupReportConfiguration startupReportConfiguration;\n \n-    private Log log;\n+    private final Log log;\n \n     private final DefaultReporterFactory defaultReporterFactory;\n \n-    private final List<DefaultReporterFactory> defaultReporterFactoryList;\n+    private final Collection<DefaultReporterFactory> defaultReporterFactoryList;\n \n     private static volatile int systemPropertiesFileCounter = 0;\n \n@@ -145,7 +147,7 @@ public ForkStarter( ProviderConfiguration providerConfiguration, StartupConfigur\n         this.log = log;\n         defaultReporterFactory = new DefaultReporterFactory( startupReportConfiguration );\n         defaultReporterFactory.runStarting();\n-        defaultReporterFactoryList = new ArrayList<DefaultReporterFactory>();\n+        defaultReporterFactoryList = new ConcurrentLinkedQueue<DefaultReporterFactory>();\n     }\n \n     public RunResult run( SurefireProperties effectiveSystemProperties, DefaultScanResult scanResult )",
                "changes": 22
            },
            {
                "status": "modified",
                "additions": 2,
                "raw_url": "https://github.com/apache/maven-surefire/raw/319b3ec6e2c44536bde521563654c5f7f4251255/maven-surefire-common/src/main/java/org/apache/maven/plugin/surefire/report/DefaultReporterFactory.java",
                "contents_url": "https://api.github.com/repos/apache/maven-surefire/contents/maven-surefire-common/src/main/java/org/apache/maven/plugin/surefire/report/DefaultReporterFactory.java?ref=319b3ec6e2c44536bde521563654c5f7f4251255",
                "filename": "maven-surefire-common/src/main/java/org/apache/maven/plugin/surefire/report/DefaultReporterFactory.java",
                "deletions": 1,
                "sha": "aeb3c2259c1ed0230e32d70c5406a69df212ef43",
                "blob_url": "https://github.com/apache/maven-surefire/blob/319b3ec6e2c44536bde521563654c5f7f4251255/maven-surefire-common/src/main/java/org/apache/maven/plugin/surefire/report/DefaultReporterFactory.java",
                "patch": "@@ -29,6 +29,7 @@\n import org.apache.maven.surefire.suite.RunResult;\n \n import java.util.ArrayList;\n+import java.util.Collection;\n import java.util.Collections;\n import java.util.HashMap;\n import java.util.List;\n@@ -75,7 +76,7 @@ public RunListener createReporter()\n         return createTestSetRunListener();\n     }\n \n-    public void mergeFromOtherFactories( List<DefaultReporterFactory> factories )\n+    public void mergeFromOtherFactories( Collection<DefaultReporterFactory> factories )\n     {\n         for ( DefaultReporterFactory factory : factories )\n         {",
                "changes": 3
            }
        ],
        "unit_tests": [
            "DefaultReporterFactoryTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "maven-surefire-common/src/test/java/org/apache/maven/plugin/surefire/report/DefaultReporterFactoryTest.java",
        "buggy_files": [
            "maven-surefire-common/src/main/java/org/apache/maven/plugin/surefire/report/DefaultReporterFactory.java"
        ],
        "fixed": true
    }
]