[
    {
        "repo": "incubator-dolphinscheduler",
        "commit": "https://github.com/apache/incubator-dolphinscheduler/commit/5212bab06166cc15c6b3d319e583a84b3b7870e9",
        "bug_id": "incubator-dolphinscheduler_5212bab",
        "message": "fix CheckUtils.checkUserParams method (#1090)\n\n* move updateTaskState into try/catch block in case of exception\r\n\r\n* fix NPE\r\n\r\n* using conf.getInt instead of getString\r\n\r\n* for AbstractZKClient, remove the log, for it will print the same log message in createZNodePath.\r\nfor AlertDao, correct the spelling.\r\n\r\n* duplicate\r\n\r\n* refactor getTaskWorkerGroupId\r\n\r\n* add friendly log\r\n\r\n* update hearbeat thread num = 1\r\n\r\n* fix the bug when worker execute task using queue. and remove checking Tenant user anymore in TaskScheduleThread\r\n\r\n* 1. move verifyTaskInstanceIsNull after taskInstance\r\n2. keep verifyTenantIsNull/verifyTaskInstanceIsNull clean and readable\r\n\r\n* fix the message\r\n\r\n* delete before check to avoid KeeperException$NoNodeException\r\n\r\n* fix the message\r\n\r\n* check processInstance state before delete tenant\r\n\r\n* check processInstance state before delete worker group\r\n\r\n* refactor\r\n\r\n* merge api constants into common constatns\r\n\r\n* update the resource perm\r\n\r\n* update the dataSource perm\r\n\r\n* fix CheckUtils.checkUserParams method",
        "parent": "https://github.com/apache/incubator-dolphinscheduler/commit/5fcfb6c66184b45cd655d01d263c513afd9390c0",
        "patched_files": [
            "UsersService.java",
            "ExecutorController.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 1,
                "raw_url": "https://github.com/apache/incubator-dolphinscheduler/raw/5212bab06166cc15c6b3d319e583a84b3b7870e9/dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ExecutorController.java",
                "contents_url": "https://api.github.com/repos/apache/incubator-dolphinscheduler/contents/dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ExecutorController.java?ref=5212bab06166cc15c6b3d319e583a84b3b7870e9",
                "filename": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ExecutorController.java",
                "deletions": 1,
                "sha": "12b0be04cbda9893f448b659bcb65f50dfe8832f",
                "blob_url": "https://github.com/apache/incubator-dolphinscheduler/blob/5212bab06166cc15c6b3d319e583a84b3b7870e9/dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ExecutorController.java",
                "patch": "@@ -95,7 +95,7 @@ public Result startProcessInstance(@ApiIgnore @RequestAttribute(value = Constant\n                     workerGroupId, timeout);\n \n             if (timeout == null) {\n-                timeout = org.apache.dolphinscheduler.common.Constants.MAX_TASK_TIMEOUT;\n+                timeout = Constants.MAX_TASK_TIMEOUT;\n             }\n \n             Map<String, Object> result = execService.execProcessInstance(loginUser, projectName, processDefinitionId, scheduleTime, execType, failureStrategy,",
                "changes": 2
            },
            {
                "status": "modified",
                "additions": 6,
                "raw_url": "https://github.com/apache/incubator-dolphinscheduler/raw/5212bab06166cc15c6b3d319e583a84b3b7870e9/dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/UsersService.java",
                "contents_url": "https://api.github.com/repos/apache/incubator-dolphinscheduler/contents/dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/UsersService.java?ref=5212bab06166cc15c6b3d319e583a84b3b7870e9",
                "filename": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/UsersService.java",
                "deletions": 4,
                "sha": "8b417c5a17a97531c67a19bccc4ab5792fd26dff",
                "blob_url": "https://github.com/apache/incubator-dolphinscheduler/blob/5212bab06166cc15c6b3d319e583a84b3b7870e9/dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/UsersService.java",
                "patch": "@@ -94,15 +94,17 @@\n                                           String queue) throws Exception {\n \n         Map<String, Object> result = new HashMap<>(5);\n-        result = CheckUtils.checkUserParams(userName, userPassword, email, phone);\n-        if (result.get(Constants.STATUS) != Status.SUCCESS) {\n+        if (!CheckUtils.checkUserParams(userName, userPassword, email, phone)) {\n+            putMsg(result, Status.REQUEST_PARAMS_NOT_VALID_ERROR);\n             return result;\n         }\n-        if (check(result, !isAdmin(loginUser), Status.USER_NO_OPERATION_PERM)) {\n+        if (!isAdmin(loginUser)) {\n+            putMsg(result, Status.USER_NO_OPERATION_PERM);\n             return result;\n         }\n \n-        if (check(result, checkTenant(tenantId), Status.TENANT_NOT_EXIST)) {\n+        if (checkTenant(tenantId)) {\n+            putMsg(result, Status.TENANT_NOT_EXIST);\n             return result;\n         }\n ",
                "changes": 10
            },
            {
                "status": "modified",
                "additions": 7,
                "raw_url": "https://github.com/apache/incubator-dolphinscheduler/raw/5212bab06166cc15c6b3d319e583a84b3b7870e9/dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/utils/CheckUtils.java",
                "contents_url": "https://api.github.com/repos/apache/incubator-dolphinscheduler/contents/dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/utils/CheckUtils.java?ref=5212bab06166cc15c6b3d319e583a84b3b7870e9",
                "filename": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/utils/CheckUtils.java",
                "deletions": 20,
                "sha": "1e37b884782f33957b0859357a5585569e3491c5",
                "blob_url": "https://github.com/apache/incubator-dolphinscheduler/blob/5212bab06166cc15c6b3d319e583a84b3b7870e9/dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/utils/CheckUtils.java",
                "patch": "@@ -42,7 +42,7 @@\n    * @param userName\n    */\n   public static boolean checkUserName(String userName) {\n-    return regexChecks(userName, org.apache.dolphinscheduler.common.Constants.REGEX_USER_NAME);\n+    return regexChecks(userName, Constants.REGEX_USER_NAME);\n   }\n \n   /**\n@@ -51,7 +51,7 @@ public static boolean checkUserName(String userName) {\n    * @param email\n    */\n   public static boolean checkEmail(String email) {\n-    return email.length() > 5 && email.length() <= 40 && regexChecks(email, org.apache.dolphinscheduler.common.Constants.REGEX_MAIL_NAME) ;\n+    return email.length() > 5 && email.length() <= 40 && regexChecks(email, Constants.REGEX_MAIL_NAME) ;\n   }\n \n   /**\n@@ -123,26 +123,13 @@ public static boolean checkTaskNodeParameters(String parameter, String taskType)\n    * @param phone\n    * @return\n    */\n-  public static Map<String, Object> checkUserParams(String userName, String password, String email, String phone){\n-      Map<String, Object> result = new HashMap<>();\n-     try{\n-       CheckUtils.checkUserName(userName);\n-       CheckUtils.checkEmail(email);\n-       CheckUtils.checkPassword(password);\n-       CheckUtils.checkPhone(phone);\n-       result.put(Constants.STATUS, Status.SUCCESS);\n-       result.put(Constants.MSG, Status.SUCCESS.getMsg());\n-     }catch (Exception e){\n-       result.put(Constants.STATUS, Status.REQUEST_PARAMS_NOT_VALID_ERROR);\n-       result.put(Constants.MSG, e.getMessage());\n-     }\n-      return result;\n+  public static boolean checkUserParams(String userName, String password, String email, String phone){\n+    return CheckUtils.checkUserName(userName) &&\n+            CheckUtils.checkEmail(email) &&\n+            CheckUtils.checkPassword(password) &&\n+            CheckUtils.checkPhone(phone);\n   }\n \n-\n-\n-\n-\n   /**\n    * \u6b63\u5219\u5339\u914d\n    *",
                "changes": 27
            }
        ],
        "unit_tests": [
            "ExecutorControllerTest.java",
            "UsersServiceTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "dolphinscheduler-api/src/test/java/org/apache/dolphinscheduler/api/controller/ExecutorControllerTest.java",
        "buggy_files": [
            "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/UsersService.java",
            "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ExecutorController.java"
        ],
        "fixed": true
    }
]