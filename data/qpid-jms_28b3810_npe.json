[
    {
        "repo": "qpid-jms",
        "commit": "https://github.com/apache/qpid-jms/commit/28b3810a11bb0c1a5b3033b90bdc25344116b564",
        "bug_id": "qpid-jms_28b3810",
        "message": "QPIDJMS-207 Handle null message passed to send calls\n\nThrow the correct exception when a null message gets passed to a send\nmethod (MessageFormatException) instead of waiting to hit an NPE",
        "parent": "https://github.com/apache/qpid-jms/commit/fdedbd2469b73d5de87a084824419a631e0fbb18",
        "patched_files": [
            "JmsProducer.java",
            "JmsSession.java",
            "JmsMessageProducer.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 5,
                "raw_url": "https://github.com/apache/qpid-jms/raw/28b3810a11bb0c1a5b3033b90bdc25344116b564/qpid-jms-client/src/main/java/org/apache/qpid/jms/JmsProducer.java",
                "contents_url": "https://api.github.com/repos/apache/qpid-jms/contents/qpid-jms-client/src/main/java/org/apache/qpid/jms/JmsProducer.java?ref=28b3810a11bb0c1a5b3033b90bdc25344116b564",
                "filename": "qpid-jms-client/src/main/java/org/apache/qpid/jms/JmsProducer.java",
                "deletions": 0,
                "sha": "307100935e6d3a007431a90b4d26c521bd61c216",
                "blob_url": "https://github.com/apache/qpid-jms/blob/28b3810a11bb0c1a5b3033b90bdc25344116b564/qpid-jms-client/src/main/java/org/apache/qpid/jms/JmsProducer.java",
                "patch": "@@ -34,6 +34,7 @@\n import javax.jms.JMSProducer;\n import javax.jms.MapMessage;\n import javax.jms.Message;\n+import javax.jms.MessageFormatException;\n import javax.jms.ObjectMessage;\n import javax.jms.TextMessage;\n \n@@ -149,6 +150,10 @@ public JMSProducer send(Destination destination, String body) {\n \n     private void doSend(Destination destination, Message message) throws JMSException {\n \n+        if (message == null) {\n+            throw new MessageFormatException(\"Message must not be null\");\n+        }\n+\n         for (Map.Entry<String, Object> entry : messageProperties.entrySet()) {\n             message.setObjectProperty(entry.getKey(), entry.getValue());\n         }",
                "changes": 5
            },
            {
                "status": "modified",
                "additions": 5,
                "raw_url": "https://github.com/apache/qpid-jms/raw/28b3810a11bb0c1a5b3033b90bdc25344116b564/qpid-jms-client/src/main/java/org/apache/qpid/jms/JmsSession.java",
                "contents_url": "https://api.github.com/repos/apache/qpid-jms/contents/qpid-jms-client/src/main/java/org/apache/qpid/jms/JmsSession.java?ref=28b3810a11bb0c1a5b3033b90bdc25344116b564",
                "filename": "qpid-jms-client/src/main/java/org/apache/qpid/jms/JmsSession.java",
                "deletions": 0,
                "sha": "e6c85cc892d0efbf2ee40e80ca0df8e48011fa2a",
                "blob_url": "https://github.com/apache/qpid-jms/blob/28b3810a11bb0c1a5b3033b90bdc25344116b564/qpid-jms-client/src/main/java/org/apache/qpid/jms/JmsSession.java",
                "patch": "@@ -44,6 +44,7 @@\n import javax.jms.MapMessage;\n import javax.jms.Message;\n import javax.jms.MessageConsumer;\n+import javax.jms.MessageFormatException;\n import javax.jms.MessageListener;\n import javax.jms.MessageProducer;\n import javax.jms.ObjectMessage;\n@@ -715,6 +716,10 @@ protected void send(JmsMessageProducer producer, Destination dest, Message msg,\n             throw new InvalidDestinationException(\"Destination must not be null\");\n         }\n \n+        if (msg == null) {\n+            throw new MessageFormatException(\"Message must not be null\");\n+        }\n+\n         JmsDestination destination = JmsMessageTransformation.transformDestination(connection, dest);\n \n         if (destination.isTemporary() && ((JmsTemporaryDestination) destination).isDeleted()) {",
                "changes": 5
            },
            {
                "status": "modified",
                "additions": 69,
                "raw_url": "https://github.com/apache/qpid-jms/raw/28b3810a11bb0c1a5b3033b90bdc25344116b564/qpid-jms-client/src/test/java/org/apache/qpid/jms/producer/JmsMessageProducerTest.java",
                "contents_url": "https://api.github.com/repos/apache/qpid-jms/contents/qpid-jms-client/src/test/java/org/apache/qpid/jms/producer/JmsMessageProducerTest.java?ref=28b3810a11bb0c1a5b3033b90bdc25344116b564",
                "filename": "qpid-jms-client/src/test/java/org/apache/qpid/jms/producer/JmsMessageProducerTest.java",
                "deletions": 0,
                "sha": "c0c92c315ce21d222d4906944ff65e8b3095d765",
                "blob_url": "https://github.com/apache/qpid-jms/blob/28b3810a11bb0c1a5b3033b90bdc25344116b564/qpid-jms-client/src/test/java/org/apache/qpid/jms/producer/JmsMessageProducerTest.java",
                "patch": "@@ -36,6 +36,7 @@\n import javax.jms.InvalidDestinationException;\n import javax.jms.JMSException;\n import javax.jms.Message;\n+import javax.jms.MessageFormatException;\n import javax.jms.MessageProducer;\n import javax.jms.Session;\n \n@@ -327,6 +328,74 @@ public void testExplicitProducerThrowsIAEWhenNullCompletionListenerIsProvided()\n         }\n     }\n \n+    @Test(timeout = 10000)\n+    public void testAnonymousProducerThrowsMFEWhenNullMessageProvided() throws Exception {\n+        JmsDestination dest = new JmsQueue(\"explicitDestination\");\n+        JmsMessageProducer producer = (JmsMessageProducer) session.createProducer(null);\n+\n+        try {\n+            producer.send(dest, (Message) null);\n+            fail(\"Expected exception not thrown\");\n+        } catch (MessageFormatException mfe) {\n+            // expected\n+        }\n+\n+        try {\n+            producer.send(dest, (Message) null, completionListener);\n+            fail(\"Expected exception not thrown\");\n+        } catch (MessageFormatException mfe) {\n+            // expected\n+        }\n+\n+        try {\n+            producer.send(dest, (Message) null, Message.DEFAULT_DELIVERY_MODE, Message.DEFAULT_PRIORITY, Message.DEFAULT_TIME_TO_LIVE);\n+            fail(\"Expected exception not thrown\");\n+        } catch (MessageFormatException mfe) {\n+            // expected\n+        }\n+\n+        try {\n+            producer.send(dest, (Message) null, Message.DEFAULT_DELIVERY_MODE, Message.DEFAULT_PRIORITY, Message.DEFAULT_TIME_TO_LIVE, completionListener);\n+            fail(\"Expected exception not thrown\");\n+        } catch (MessageFormatException mfe) {\n+            // expected\n+        }\n+    }\n+\n+    @Test(timeout = 10000)\n+    public void testExplicitProducerThrowsMFEWhenNullMessageProvided() throws Exception {\n+        JmsDestination dest = new JmsQueue(\"explicitDestination\");\n+        JmsMessageProducer producer = (JmsMessageProducer) session.createProducer(dest);\n+\n+        try {\n+            producer.send((Message) null);\n+            fail(\"Expected exception not thrown\");\n+        } catch (MessageFormatException mfe) {\n+            // expected\n+        }\n+\n+        try {\n+            producer.send((Message) null, completionListener);\n+            fail(\"Expected exception not thrown\");\n+        } catch (MessageFormatException mfe) {\n+            // expected\n+        }\n+\n+        try {\n+            producer.send((Message) null, Message.DEFAULT_DELIVERY_MODE, Message.DEFAULT_PRIORITY, Message.DEFAULT_TIME_TO_LIVE);\n+            fail(\"Expected exception not thrown\");\n+        } catch (MessageFormatException mfe) {\n+            // expected\n+        }\n+\n+        try {\n+            producer.send((Message) null, Message.DEFAULT_DELIVERY_MODE, Message.DEFAULT_PRIORITY, Message.DEFAULT_TIME_TO_LIVE, completionListener);\n+            fail(\"Expected exception not thrown\");\n+        } catch (MessageFormatException mfe) {\n+            // expected\n+        }\n+    }\n+\n     @Test(timeout = 10000)\n     public void testInOrderSendAcksCompletionsReturnInOrder() throws Exception {\n         final int MESSAGE_COUNT = 3;",
                "changes": 69
            },
            {
                "status": "modified",
                "additions": 16,
                "raw_url": "https://github.com/apache/qpid-jms/raw/28b3810a11bb0c1a5b3033b90bdc25344116b564/qpid-jms-client/src/test/java/org/apache/qpid/jms/producer/JmsProducerTest.java",
                "contents_url": "https://api.github.com/repos/apache/qpid-jms/contents/qpid-jms-client/src/test/java/org/apache/qpid/jms/producer/JmsProducerTest.java?ref=28b3810a11bb0c1a5b3033b90bdc25344116b564",
                "filename": "qpid-jms-client/src/test/java/org/apache/qpid/jms/producer/JmsProducerTest.java",
                "deletions": 0,
                "sha": "5cc381ed12c704e11f04c2a345ce9c9cb864546d",
                "blob_url": "https://github.com/apache/qpid-jms/blob/28b3810a11bb0c1a5b3033b90bdc25344116b564/qpid-jms-client/src/test/java/org/apache/qpid/jms/producer/JmsProducerTest.java",
                "patch": "@@ -813,6 +813,22 @@ public void testTimeToLive() {\n \n     //----- Test Send Methods -----------------------------------------------//\n \n+    @Test\n+    public void testSendNullMessageThrowsMFRE() throws JMSException {\n+        JmsSession session = Mockito.mock(JmsSession.class);\n+        JmsMessageProducer messageProducer = Mockito.mock(JmsMessageProducer.class);\n+\n+        JmsProducer producer = new JmsProducer(session, messageProducer);\n+\n+        try {\n+            producer.send(JMS_DESTINATION, (Message) null);\n+            fail(\"Should throw a MessageFormatRuntimeException\");\n+        } catch (MessageFormatRuntimeException mfre) {\n+        } catch (Exception e) {\n+            fail(\"Should throw a MessageFormatRuntimeException\");\n+        }\n+    }\n+\n     @Test\n     public void testSendJMSMessage() throws JMSException {\n         JmsSession session = Mockito.mock(JmsSession.class);",
                "changes": 16
            }
        ],
        "unit_tests": [
            "JmsProducerTest.java",
            "JmsMessageProducerTest.java",
            "JmsSessionTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "qpid-jms-client/src/test/java/org/apache/qpid/jms/producer/JmsProducerTest.java",
        "buggy_files": [
            "qpid-jms-client/src/main/java/org/apache/qpid/jms/JmsProducer.java",
            "qpid-jms-client/src/main/java/org/apache/qpid/jms/JmsSession.java",
            "qpid-jms-client/src/main/java/org/apache/qpid/jms/JmsMessageProducer.java"
        ],
        "fixed": true
    }
]