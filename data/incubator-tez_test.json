{
    "incubator-tez_0320cd7": {
        "bug_id": "incubator-tez_0320cd7",
        "commit": "https://github.com/apache/incubator-tez/commit/0320cd7acef31d2518fe09f0d8ede4eca259537f",
        "file": [
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/incubator-tez/blob/0320cd7acef31d2518fe09f0d8ede4eca259537f/tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java?ref=0320cd7acef31d2518fe09f0d8ede4eca259537f",
                "deletions": 6,
                "filename": "tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java",
                "patch": "@@ -477,18 +477,12 @@ static ApplicationSubmissionContext createApplicationSubmissionContext(\n     if(dag != null) {\n \n       for (Vertex v : dag.getVertices()) {\n-        if (v.getTaskLocalResources() == null) {\n-          v.setTaskLocalResources(new TreeMap<String, LocalResource>());\n-        }\n         if (tezJarResources != null) {\n           v.getTaskLocalResources().putAll(tezJarResources);\n         }\n         v.getTaskLocalResources().put(TezConfiguration.TEZ_PB_BINARY_CONF_NAME,\n             binaryConfLRsrc);\n \n-        if (v.getTaskEnvironment() == null) {\n-          v.setTaskEnvironment(new TreeMap<String, String>());\n-        }\n         Map<String, String> taskEnv = v.getTaskEnvironment();\n         for (Map.Entry<String, String> entry : environment.entrySet()) {\n           String key = entry.getKey();",
                "raw_url": "https://github.com/apache/incubator-tez/raw/0320cd7acef31d2518fe09f0d8ede4eca259537f/tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java",
                "sha": "82cb0c7dd4c905a568cfa7191a395d805211c9c7",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/incubator-tez/blob/0320cd7acef31d2518fe09f0d8ede4eca259537f/tez-api/src/main/java/org/apache/tez/client/TezSession.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-api/src/main/java/org/apache/tez/client/TezSession.java?ref=0320cd7acef31d2518fe09f0d8ede4eca259537f",
                "deletions": 4,
                "filename": "tez-api/src/main/java/org/apache/tez/client/TezSession.java",
                "patch": "@@ -153,10 +153,6 @@ public synchronized DAGClient submitDAG(DAG dag)\n         .getFrameworkClasspath(sessionConfig.getYarnConfiguration());\n     for (Vertex v : dag.getVertices()) {\n       Map<String, String> taskEnv = v.getTaskEnvironment();\n-      if (taskEnv == null) {\n-        taskEnv = Maps.newHashMap();\n-        v.setTaskEnvironment(taskEnv);\n-      }\n       Apps.addToEnvironment(taskEnv,\n           ApplicationConstants.Environment.CLASSPATH.name(),\n           classpath);",
                "raw_url": "https://github.com/apache/incubator-tez/raw/0320cd7acef31d2518fe09f0d8ede4eca259537f/tez-api/src/main/java/org/apache/tez/client/TezSession.java",
                "sha": "8f3101e2e31c5a523a6163e577b52f5afefc8a60",
                "status": "modified"
            },
            {
                "additions": 25,
                "blob_url": "https://github.com/apache/incubator-tez/blob/0320cd7acef31d2518fe09f0d8ede4eca259537f/tez-api/src/main/java/org/apache/tez/dag/api/DAG.java",
                "changes": 54,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-api/src/main/java/org/apache/tez/dag/api/DAG.java?ref=0320cd7acef31d2518fe09f0d8ede4eca259537f",
                "deletions": 29,
                "filename": "tez-api/src/main/java/org/apache/tez/dag/api/DAG.java",
                "patch": "@@ -506,39 +506,35 @@ public DAGPlan createDag(Configuration dagConf) {\n \n       taskConfigBuilder.setTaskModule(vertex.getVertexName());\n       PlanLocalResource.Builder localResourcesBuilder = PlanLocalResource.newBuilder();\n-      if (vertex.getTaskLocalResources() != null) {\n-        localResourcesBuilder.clear();\n-        for (Entry<String, LocalResource> entry :\n-          vertex.getTaskLocalResources().entrySet()) {\n-          String key = entry.getKey();\n-          LocalResource lr = entry.getValue();\n-          localResourcesBuilder.setName(key);\n-          localResourcesBuilder.setUri(\n-            DagTypeConverters.convertToDAGPlan(lr.getResource()));\n-          localResourcesBuilder.setSize(lr.getSize());\n-          localResourcesBuilder.setTimeStamp(lr.getTimestamp());\n-          localResourcesBuilder.setType(\n-            DagTypeConverters.convertToDAGPlan(lr.getType()));\n-          localResourcesBuilder.setVisibility(\n-            DagTypeConverters.convertToDAGPlan(lr.getVisibility()));\n-          if (lr.getType() == LocalResourceType.PATTERN) {\n-            if (lr.getPattern() == null || lr.getPattern().isEmpty()) {\n-              throw new TezUncheckedException(\"LocalResource type set to pattern\"\n-                + \" but pattern is null or empty\");\n-            }\n-            localResourcesBuilder.setPattern(lr.getPattern());\n+      localResourcesBuilder.clear();\n+      for (Entry<String, LocalResource> entry :\n+             vertex.getTaskLocalResources().entrySet()) {\n+        String key = entry.getKey();\n+        LocalResource lr = entry.getValue();\n+        localResourcesBuilder.setName(key);\n+        localResourcesBuilder.setUri(\n+          DagTypeConverters.convertToDAGPlan(lr.getResource()));\n+        localResourcesBuilder.setSize(lr.getSize());\n+        localResourcesBuilder.setTimeStamp(lr.getTimestamp());\n+        localResourcesBuilder.setType(\n+          DagTypeConverters.convertToDAGPlan(lr.getType()));\n+        localResourcesBuilder.setVisibility(\n+          DagTypeConverters.convertToDAGPlan(lr.getVisibility()));\n+        if (lr.getType() == LocalResourceType.PATTERN) {\n+          if (lr.getPattern() == null || lr.getPattern().isEmpty()) {\n+            throw new TezUncheckedException(\"LocalResource type set to pattern\"\n+              + \" but pattern is null or empty\");\n           }\n-          taskConfigBuilder.addLocalResource(localResourcesBuilder);\n+          localResourcesBuilder.setPattern(lr.getPattern());\n         }\n+        taskConfigBuilder.addLocalResource(localResourcesBuilder);\n       }\n       \n-      if (vertex.getTaskEnvironment() != null) {\n-        for (String key : vertex.getTaskEnvironment().keySet()) {\n-          PlanKeyValuePair.Builder envSettingBuilder = PlanKeyValuePair.newBuilder();\n-          envSettingBuilder.setKey(key);\n-          envSettingBuilder.setValue(vertex.getTaskEnvironment().get(key));\n-          taskConfigBuilder.addEnvironmentSetting(envSettingBuilder);\n-        }\n+      for (String key : vertex.getTaskEnvironment().keySet()) {\n+        PlanKeyValuePair.Builder envSettingBuilder = PlanKeyValuePair.newBuilder();\n+        envSettingBuilder.setKey(key);\n+        envSettingBuilder.setValue(vertex.getTaskEnvironment().get(key));\n+        taskConfigBuilder.addEnvironmentSetting(envSettingBuilder);\n       }\n \n       if (vertex.getTaskLocationsHint() != null) {",
                "raw_url": "https://github.com/apache/incubator-tez/raw/0320cd7acef31d2518fe09f0d8ede4eca259537f/tez-api/src/main/java/org/apache/tez/dag/api/DAG.java",
                "sha": "6433dc8410cfac816ddb0c60c64e1b188d1eb1c9",
                "status": "modified"
            },
            {
                "additions": 14,
                "blob_url": "https://github.com/apache/incubator-tez/blob/0320cd7acef31d2518fe09f0d8ede4eca259537f/tez-api/src/main/java/org/apache/tez/dag/api/Vertex.java",
                "changes": 18,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-api/src/main/java/org/apache/tez/dag/api/Vertex.java?ref=0320cd7acef31d2518fe09f0d8ede4eca259537f",
                "deletions": 4,
                "filename": "tez-api/src/main/java/org/apache/tez/dag/api/Vertex.java",
                "patch": "@@ -20,6 +20,7 @@\n \n import java.util.ArrayList;\n import java.util.Collections;\n+import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n \n@@ -42,8 +43,8 @@\n   private final int parallelism;\n   private VertexLocationHint taskLocationsHint;\n   private final Resource taskResource;\n-  private Map<String, LocalResource> taskLocalResources;\n-  private Map<String, String> taskEnvironment;\n+  private Map<String, LocalResource> taskLocalResources = new HashMap<String, LocalResource>();\n+  private Map<String, String> taskEnvironment = new HashMap<String, String>();\n   private final List<RootInputLeafOutput<InputDescriptor>> additionalInputs \n                       = new ArrayList<RootInputLeafOutput<InputDescriptor>>();\n   private final List<RootInputLeafOutput<OutputDescriptor>> additionalOutputs \n@@ -107,7 +108,11 @@ VertexLocationHint getTaskLocationsHint() {\n   }\n \n   public Vertex setTaskLocalResources(Map<String, LocalResource> localResources) {\n-    this.taskLocalResources = localResources;\n+    if (localResources == null) {\n+      this.taskLocalResources = new HashMap<String, LocalResource>();\n+    } else {\n+      this.taskLocalResources = localResources;\n+    }\n     return this;\n   }\n \n@@ -116,7 +121,12 @@ public Vertex setTaskLocalResources(Map<String, LocalResource> localResources) {\n   }\n \n   public Vertex setTaskEnvironment(Map<String, String> environment) {\n-    this.taskEnvironment = environment;\n+    if (environment == null) {\n+      this.taskEnvironment = new HashMap<String, String>();\n+    }\n+    else {\n+      this.taskEnvironment = environment;\n+    }\n     return this;\n   }\n ",
                "raw_url": "https://github.com/apache/incubator-tez/raw/0320cd7acef31d2518fe09f0d8ede4eca259537f/tez-api/src/main/java/org/apache/tez/dag/api/Vertex.java",
                "sha": "377f5514901f4df2577d15ca6b898b2aec802ac4",
                "status": "modified"
            }
        ],
        "message": "TEZ-807. Build broken due to NPE (Patch by Gunther Hagleitner, reviewed by Siddharth Seth)",
        "parent": "https://github.com/apache/incubator-tez/commit/6480f1bda362419e6e975072d2e557231911c94a",
        "patched_files": [
            "TezClientUtils.java"
        ],
        "repo": "incubator-tez",
        "unit_tests": [
            "TestTezClientUtils.java"
        ]
    },
    "incubator-tez_150ebd3": {
        "bug_id": "incubator-tez_150ebd3",
        "commit": "https://github.com/apache/incubator-tez/commit/150ebd3c7934339f31a7b24012ece8e171e1f993",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/incubator-tez/blob/150ebd3c7934339f31a7b24012ece8e171e1f993/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/shuffle/impl/ShuffleInputEventHandler.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/shuffle/impl/ShuffleInputEventHandler.java?ref=150ebd3c7934339f31a7b24012ece8e171e1f993",
                "deletions": 1,
                "filename": "tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/shuffle/impl/ShuffleInputEventHandler.java",
                "patch": "@@ -90,7 +90,8 @@ private void processDataMovementEvent(DataMovementEvent dmEvent) {\n         byte[] emptyPartitions = TezUtils.decompressByteStringToByteArray(shufflePayload.getEmptyPartitions());\n         BitSet emptyPartitionsBitSet = TezUtils.fromByteArray(emptyPartitions);\n         if (emptyPartitionsBitSet.get(partitionId)) {\n-          LOG.info(\"Source partition: \" + partitionId + \" did not generate any data. Not fetching.\");\n+          LOG.info(\"Source partition: \" + partitionId + \" did not generate any data. SrcAttempt: [\"\n+              + srcAttemptIdentifier + \"]. Not fetching.\");\n           scheduler.copySucceeded(srcAttemptIdentifier, null, 0, 0, 0, null);\n           return;\n         }",
                "raw_url": "https://github.com/apache/incubator-tez/raw/150ebd3c7934339f31a7b24012ece8e171e1f993/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/shuffle/impl/ShuffleInputEventHandler.java",
                "sha": "e0a416090b60f28e22e2c04124f23b0cc61ed144",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/incubator-tez/blob/150ebd3c7934339f31a7b24012ece8e171e1f993/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/shuffle/impl/ShuffleScheduler.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/shuffle/impl/ShuffleScheduler.java?ref=150ebd3c7934339f31a7b24012ece8e171e1f993",
                "deletions": 1,
                "filename": "tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/shuffle/impl/ShuffleScheduler.java",
                "patch": "@@ -203,7 +203,11 @@ public synchronized void copySucceeded(InputAttemptIdentifier srcAttemptIdentifi\n       // input is already finished. duplicate fetch.\n       LOG.warn(\"Duplicate fetch of input no longer needs to be fetched: \" + srcAttemptIdentifier);\n       // free the resource - specially memory\n-      output.abort();\n+      \n+      // If the src does not generate data, output will be null.\n+      if (output != null) {\n+        output.abort();\n+      }\n     }\n     // TODO NEWTEZ Should this be releasing the output, if not committed ? Possible memory leak in case of speculation.\n   }",
                "raw_url": "https://github.com/apache/incubator-tez/raw/150ebd3c7934339f31a7b24012ece8e171e1f993/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/shuffle/impl/ShuffleScheduler.java",
                "sha": "45a50ad8394514d558a2d79eb1e8dce1ef689ea9",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/incubator-tez/blob/150ebd3c7934339f31a7b24012ece8e171e1f993/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/shuffle/common/impl/ShuffleInputEventHandlerImpl.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/shuffle/common/impl/ShuffleInputEventHandlerImpl.java?ref=150ebd3c7934339f31a7b24012ece8e171e1f993",
                "deletions": 1,
                "filename": "tez-runtime-library/src/main/java/org/apache/tez/runtime/library/shuffle/common/impl/ShuffleInputEventHandlerImpl.java",
                "patch": "@@ -106,7 +106,8 @@ private void processDataMovementEvent(DataMovementEvent dme) throws IOException\n       if (emptyPartionsBitSet.get(srcIndex)) {\n         InputAttemptIdentifier srcAttemptIdentifier = new InputAttemptIdentifier(dme.getTargetIndex(),\n             dme.getVersion());\n-        LOG.info(\"Source partition: \" + srcIndex + \" did not generate any data. Not fetching.\");\n+        LOG.info(\"Source partition: \" + srcIndex + \" did not generate any data. SrcAttempt: [\"\n+            + srcAttemptIdentifier + \"]. Not fetching.\");\n         shuffleManager.addCompletedInputWithNoData(srcAttemptIdentifier);\n         return;\n       }",
                "raw_url": "https://github.com/apache/incubator-tez/raw/150ebd3c7934339f31a7b24012ece8e171e1f993/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/shuffle/common/impl/ShuffleInputEventHandlerImpl.java",
                "sha": "ac5da74ec0686acc2af40fca318eed3bc941cee4",
                "status": "modified"
            }
        ],
        "message": "TEZ-1048. Fix an NPE which can occur when the source task generates no\ndata for a partition, and runs multiple attempts. (sseth)",
        "parent": "https://github.com/apache/incubator-tez/commit/a786e41a3c0a164c649ef4922ebbc5a5f3d59201",
        "patched_files": [
            "ShuffleInputEventHandlerImpl.java"
        ],
        "repo": "incubator-tez",
        "unit_tests": [
            "TestShuffleInputEventHandlerImpl.java"
        ]
    },
    "incubator-tez_1795ea8": {
        "bug_id": "incubator-tez_1795ea8",
        "commit": "https://github.com/apache/incubator-tez/commit/1795ea84fc899f5e522680119b1853f559030a14",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/incubator-tez/blob/1795ea84fc899f5e522680119b1853f559030a14/tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/VertexImpl.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/VertexImpl.java?ref=1795ea84fc899f5e522680119b1853f559030a14",
                "deletions": 3,
                "filename": "tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/VertexImpl.java",
                "patch": "@@ -250,9 +250,6 @@\n               EnumSet.of(VertexState.TERMINATING, VertexState.KILLED, VertexState.FAILED),\n               VertexEventType.V_TASK_COMPLETED,\n               new TaskCompletedTransition())\n-          .addTransition(VertexState.TERMINATING, VertexState.TERMINATING,\n-              VertexEventType.V_TASK_ATTEMPT_COMPLETED,\n-              TASK_ATTEMPT_COMPLETED_EVENT_TRANSITION) // TODO shouldnt be done for KILL_WAIT vertex\n           .addTransition(VertexState.TERMINATING, VertexState.TERMINATING,\n               VertexEventType.V_SOURCE_TASK_ATTEMPT_COMPLETED,\n               SOURCE_TASK_ATTEMPT_COMPLETED_EVENT_TRANSITION)\n@@ -263,6 +260,7 @@\n           // Ignore-able events\n           .addTransition(VertexState.TERMINATING, VertexState.TERMINATING,\n               EnumSet.of(VertexEventType.V_TERMINATE,\n+                  VertexEventType.V_TASK_ATTEMPT_COMPLETED,\n                   VertexEventType.V_TASK_RESCHEDULED))\n \n           // Transitions from SUCCEEDED state\n@@ -301,6 +299,7 @@\n           // Ignore-able events\n           .addTransition(VertexState.KILLED, VertexState.KILLED,\n               EnumSet.of(VertexEventType.V_TERMINATE,\n+                  VertexEventType.V_SOURCE_VERTEX_STARTED,\n                   VertexEventType.V_START,\n                   VertexEventType.V_TASK_RESCHEDULED,\n                   VertexEventType.V_TASK_ATTEMPT_COMPLETED,\n@@ -311,6 +310,8 @@\n               VertexState.ERROR,\n               VertexState.ERROR,\n               EnumSet.of(VertexEventType.V_INIT,\n+                  VertexEventType.V_SOURCE_VERTEX_STARTED,\n+                  VertexEventType.V_START,\n                   VertexEventType.V_TERMINATE,\n                   VertexEventType.V_TASK_COMPLETED,\n                   VertexEventType.V_TASK_ATTEMPT_COMPLETED,",
                "raw_url": "https://github.com/apache/incubator-tez/raw/1795ea84fc899f5e522680119b1853f559030a14/tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/VertexImpl.java",
                "sha": "597acb2aa2545374a181e0df604e9aad1bea06bd",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/incubator-tez/blob/1795ea84fc899f5e522680119b1853f559030a14/tez-mapreduce-examples/src/main/java/org/apache/tez/processor/FilterByWordInputProcessor.java",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-mapreduce-examples/src/main/java/org/apache/tez/processor/FilterByWordInputProcessor.java?ref=1795ea84fc899f5e522680119b1853f559030a14",
                "deletions": 6,
                "filename": "tez-mapreduce-examples/src/main/java/org/apache/tez/processor/FilterByWordInputProcessor.java",
                "patch": "@@ -98,13 +98,14 @@ public void run(Map<String, LogicalInput> inputs,\n     OnFileUnorderedKVOutput kvOutput = (OnFileUnorderedKVOutput) lo;\n \n     Configuration updatedConf = mrInput.getConfigUpdates();\n-    String fileName = updatedConf.get(MRJobConfig.MAP_INPUT_FILE);\n-    LOG.info(\"Processing file: \" + fileName);\n     Text srcFile = new Text();\n-    if (fileName == null) {\n-      srcFile.set(\"UNKNOWN_FILENAME_IN_PROCESSOR\");\n-    } else {\n-      srcFile.set(fileName);\n+    srcFile.set(\"UNKNOWN_FILENAME_IN_PROCESSOR\");\n+    if (updatedConf != null) {\n+      String fileName = updatedConf.get(MRJobConfig.MAP_INPUT_FILE);\n+      if (fileName != null) {\n+        LOG.info(\"Processing file: \" + fileName);\n+        srcFile.set(fileName);\n+      }\n     }\n \n     KVReader kvReader = mrInput.getReader();",
                "raw_url": "https://github.com/apache/incubator-tez/raw/1795ea84fc899f5e522680119b1853f559030a14/tez-mapreduce-examples/src/main/java/org/apache/tez/processor/FilterByWordInputProcessor.java",
                "sha": "6c97430a889c5aab5beb9570b2b8fc6e833348ea",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/incubator-tez/blob/1795ea84fc899f5e522680119b1853f559030a14/tez-mapreduce/src/main/java/org/apache/tez/mapreduce/input/MRInput.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-mapreduce/src/main/java/org/apache/tez/mapreduce/input/MRInput.java?ref=1795ea84fc899f5e522680119b1853f559030a14",
                "deletions": 1,
                "filename": "tez-mapreduce/src/main/java/org/apache/tez/mapreduce/input/MRInput.java",
                "patch": "@@ -209,7 +209,7 @@ public void setNumPhysicalInputs(int numInputs) {\n    * @return the additional fields set by {@link MRInput}\n    */\n   public Configuration getConfigUpdates() {\n-    return new Configuration(incrementalConf);\n+    return incrementalConf;\n   }\n \n   public float getProgress() throws IOException, InterruptedException {",
                "raw_url": "https://github.com/apache/incubator-tez/raw/1795ea84fc899f5e522680119b1853f559030a14/tez-mapreduce/src/main/java/org/apache/tez/mapreduce/input/MRInput.java",
                "sha": "f0aea339ed7f7fe629d2adc4a6c9e08d72d94969",
                "status": "modified"
            }
        ],
        "message": "TEZ-510. Test MRRJobs failing with NPE (bikas)",
        "parent": "https://github.com/apache/incubator-tez/commit/38350663c4f367efb46f7cb488cd85607d1dfc24",
        "patched_files": [
            "VertexImpl.java"
        ],
        "repo": "incubator-tez",
        "unit_tests": [
            "TestVertexImpl.java"
        ]
    },
    "incubator-tez_2debbca": {
        "bug_id": "incubator-tez_2debbca",
        "commit": "https://github.com/apache/incubator-tez/commit/2debbca5921daa8fd4a9080e8390c0c086914d62",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/incubator-tez/blob/2debbca5921daa8fd4a9080e8390c0c086914d62/tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/VertexImpl.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/VertexImpl.java?ref=2debbca5921daa8fd4a9080e8390c0c086914d62",
                "deletions": 6,
                "filename": "tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/VertexImpl.java",
                "patch": "@@ -250,19 +250,15 @@\n               EnumSet.of(VertexState.TERMINATING, VertexState.KILLED, VertexState.FAILED),\n               VertexEventType.V_TASK_COMPLETED,\n               new TaskCompletedTransition())\n-          .addTransition(VertexState.TERMINATING, VertexState.TERMINATING,\n-              VertexEventType.V_TASK_ATTEMPT_COMPLETED,\n-              TASK_ATTEMPT_COMPLETED_EVENT_TRANSITION) // TODO shouldnt be done for KILL_WAIT vertex\n-          .addTransition(VertexState.TERMINATING, VertexState.TERMINATING,\n-              VertexEventType.V_SOURCE_TASK_ATTEMPT_COMPLETED,\n-              SOURCE_TASK_ATTEMPT_COMPLETED_EVENT_TRANSITION)\n           .addTransition(\n               VertexState.TERMINATING,\n               VertexState.ERROR, VertexEventType.V_INTERNAL_ERROR,\n               INTERNAL_ERROR_TRANSITION)\n           // Ignore-able events\n           .addTransition(VertexState.TERMINATING, VertexState.TERMINATING,\n               EnumSet.of(VertexEventType.V_TERMINATE,\n+                  VertexEventType.V_SOURCE_TASK_ATTEMPT_COMPLETED,\n+                  VertexEventType.V_TASK_ATTEMPT_COMPLETED,\n                   VertexEventType.V_TASK_RESCHEDULED))\n \n           // Transitions from SUCCEEDED state\n@@ -301,6 +297,7 @@\n           // Ignore-able events\n           .addTransition(VertexState.KILLED, VertexState.KILLED,\n               EnumSet.of(VertexEventType.V_TERMINATE,\n+                  VertexEventType.V_SOURCE_VERTEX_STARTED,\n                   VertexEventType.V_START,\n                   VertexEventType.V_TASK_RESCHEDULED,\n                   VertexEventType.V_TASK_ATTEMPT_COMPLETED,\n@@ -311,6 +308,8 @@\n               VertexState.ERROR,\n               VertexState.ERROR,\n               EnumSet.of(VertexEventType.V_INIT,\n+                  VertexEventType.V_SOURCE_VERTEX_STARTED,\n+                  VertexEventType.V_START,\n                   VertexEventType.V_TERMINATE,\n                   VertexEventType.V_TASK_COMPLETED,\n                   VertexEventType.V_TASK_ATTEMPT_COMPLETED,",
                "raw_url": "https://github.com/apache/incubator-tez/raw/2debbca5921daa8fd4a9080e8390c0c086914d62/tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/VertexImpl.java",
                "sha": "99dbb872f633b1545ebc2af2d52931d1c19bcc15",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/incubator-tez/blob/2debbca5921daa8fd4a9080e8390c0c086914d62/tez-mapreduce-examples/src/main/java/org/apache/tez/processor/FilterByWordInputProcessor.java",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-mapreduce-examples/src/main/java/org/apache/tez/processor/FilterByWordInputProcessor.java?ref=2debbca5921daa8fd4a9080e8390c0c086914d62",
                "deletions": 6,
                "filename": "tez-mapreduce-examples/src/main/java/org/apache/tez/processor/FilterByWordInputProcessor.java",
                "patch": "@@ -98,13 +98,14 @@ public void run(Map<String, LogicalInput> inputs,\n     OnFileUnorderedKVOutput kvOutput = (OnFileUnorderedKVOutput) lo;\n \n     Configuration updatedConf = mrInput.getConfigUpdates();\n-    String fileName = updatedConf.get(MRJobConfig.MAP_INPUT_FILE);\n-    LOG.info(\"Processing file: \" + fileName);\n     Text srcFile = new Text();\n-    if (fileName == null) {\n-      srcFile.set(\"UNKNOWN_FILENAME_IN_PROCESSOR\");\n-    } else {\n-      srcFile.set(fileName);\n+    srcFile.set(\"UNKNOWN_FILENAME_IN_PROCESSOR\");\n+    if (updatedConf != null) {\n+      String fileName = updatedConf.get(MRJobConfig.MAP_INPUT_FILE);\n+      if (fileName != null) {\n+        LOG.info(\"Processing file: \" + fileName);\n+        srcFile.set(fileName);\n+      }\n     }\n \n     KVReader kvReader = mrInput.getReader();",
                "raw_url": "https://github.com/apache/incubator-tez/raw/2debbca5921daa8fd4a9080e8390c0c086914d62/tez-mapreduce-examples/src/main/java/org/apache/tez/processor/FilterByWordInputProcessor.java",
                "sha": "6c97430a889c5aab5beb9570b2b8fc6e833348ea",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/incubator-tez/blob/2debbca5921daa8fd4a9080e8390c0c086914d62/tez-mapreduce/src/main/java/org/apache/tez/mapreduce/input/MRInput.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-mapreduce/src/main/java/org/apache/tez/mapreduce/input/MRInput.java?ref=2debbca5921daa8fd4a9080e8390c0c086914d62",
                "deletions": 1,
                "filename": "tez-mapreduce/src/main/java/org/apache/tez/mapreduce/input/MRInput.java",
                "patch": "@@ -209,7 +209,10 @@ public void setNumPhysicalInputs(int numInputs) {\n    * @return the additional fields set by {@link MRInput}\n    */\n   public Configuration getConfigUpdates() {\n-    return new Configuration(incrementalConf);\n+    if (incrementalConf != null) {\n+      return new Configuration(incrementalConf);\n+    }\n+    return null;\n   }\n \n   public float getProgress() throws IOException, InterruptedException {",
                "raw_url": "https://github.com/apache/incubator-tez/raw/2debbca5921daa8fd4a9080e8390c0c086914d62/tez-mapreduce/src/main/java/org/apache/tez/mapreduce/input/MRInput.java",
                "sha": "ed675a44ae397a5f552fd485391746410fc3b16d",
                "status": "modified"
            }
        ],
        "message": "Addendum TEZ-510. Test MRRJobs failing with NPE (bikas)",
        "parent": "https://github.com/apache/incubator-tez/commit/968e31f96e41ce4c4e7717c6264e70e627f99837",
        "patched_files": [
            "VertexImpl.java"
        ],
        "repo": "incubator-tez",
        "unit_tests": [
            "TestVertexImpl.java"
        ]
    },
    "incubator-tez_3d0edf4": {
        "bug_id": "incubator-tez_3d0edf4",
        "commit": "https://github.com/apache/incubator-tez/commit/3d0edf44e001e74ad50301e700ecdc807af8221e",
        "file": [
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/incubator-tez/blob/3d0edf44e001e74ad50301e700ecdc807af8221e/tez-dag/src/main/java/org/apache/tez/dag/app/rm/TaskSchedulerEventHandler.java",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-dag/src/main/java/org/apache/tez/dag/app/rm/TaskSchedulerEventHandler.java?ref=3d0edf44e001e74ad50301e700ecdc807af8221e",
                "deletions": 1,
                "filename": "tez-dag/src/main/java/org/apache/tez/dag/app/rm/TaskSchedulerEventHandler.java",
                "patch": "@@ -24,6 +24,7 @@\n import java.util.Map;\n import java.util.concurrent.BlockingQueue;\n import java.util.concurrent.LinkedBlockingQueue;\n+import java.util.concurrent.atomic.AtomicBoolean;\n \n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n@@ -81,6 +82,8 @@\n   final DAGClientServer clientService;\n   private final ContainerSignatureMatcher containerSignatureMatcher;\n   private int cachedNodeCount = -1;\n+  private AtomicBoolean shouldUnregisterFlag =\n+      new AtomicBoolean(false);\n \n   BlockingQueue<AMSchedulerEvent> eventQueue\n                               = new LinkedBlockingQueue<AMSchedulerEvent>();\n@@ -353,6 +356,11 @@ public synchronized void serviceStart() {\n         serviceAddr.getPort(), \"\", appContext);\n     taskScheduler.init(getConfig());\n     taskScheduler.start();\n+    if (shouldUnregisterFlag.get()) {\n+      // Flag may have been set earlier when task scheduler was not initialized\n+      taskScheduler.setShouldUnregister();\n+    }\n+\n     this.eventHandlingThread = new Thread(\"TaskSchedulerEventHandlerThread\") {\n       @Override\n       public void run() {\n@@ -552,8 +560,11 @@ public void preemptContainer(ContainerId containerId) {\n   }\n \n   public void setShouldUnregisterFlag() {\n-    this.taskScheduler.setShouldUnregister();\n     LOG.info(\"TaskScheduler notified that it should unregister from RM\");\n+    this.shouldUnregisterFlag.set(true);\n+    if (this.taskScheduler != null) {\n+      this.taskScheduler.setShouldUnregister();\n+    }\n   }\n \n }",
                "raw_url": "https://github.com/apache/incubator-tez/raw/3d0edf44e001e74ad50301e700ecdc807af8221e/tez-dag/src/main/java/org/apache/tez/dag/app/rm/TaskSchedulerEventHandler.java",
                "sha": "66ef81996034f4f6925964d43cdcc55bf944c986",
                "status": "modified"
            }
        ],
        "message": "TEZ-928. NPE in last app attempt caused by registering for an RM unregister. (hitesh)",
        "parent": "https://github.com/apache/incubator-tez/commit/2118e96446bd3ca8858c831a5cf7ebc07d683007",
        "patched_files": [
            "TaskSchedulerEventHandler.java"
        ],
        "repo": "incubator-tez",
        "unit_tests": [
            "TestTaskSchedulerEventHandler.java"
        ]
    },
    "incubator-tez_7b2a0e6": {
        "bug_id": "incubator-tez_7b2a0e6",
        "commit": "https://github.com/apache/incubator-tez/commit/7b2a0e6f3427182e0c7d55f3da1c369500770ab0",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/incubator-tez/blob/7b2a0e6f3427182e0c7d55f3da1c369500770ab0/tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java?ref=7b2a0e6f3427182e0c7d55f3da1c369500770ab0",
                "deletions": 1,
                "filename": "tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java",
                "patch": "@@ -373,7 +373,9 @@ static ApplicationSubmissionContext createApplicationSubmissionContext(\n         if (v.getTaskLocalResources() == null) {\n           v.setTaskLocalResources(new TreeMap<String, LocalResource>());\n         }\n-        v.getTaskLocalResources().putAll(tezJarResources);\n+        if (tezJarResources != null) {\n+          v.getTaskLocalResources().putAll(tezJarResources);\n+        }\n         v.getTaskLocalResources().put(TezConfiguration.TEZ_PB_BINARY_CONF_NAME,\n             binaryConfLRsrc);\n ",
                "raw_url": "https://github.com/apache/incubator-tez/raw/7b2a0e6f3427182e0c7d55f3da1c369500770ab0/tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java",
                "sha": "c415f8ae49dc22cdc3371e1604e0c0d5e081362b",
                "status": "modified"
            }
        ],
        "message": "TEZ-616. Addendum patch for OrderedWordCount with -generateSplitsInClient true throws NPE. (hitesh)",
        "parent": "https://github.com/apache/incubator-tez/commit/6ccebe747217adcef05a7137eb8844c11e8ae18c",
        "patched_files": [
            "TezClientUtils.java"
        ],
        "repo": "incubator-tez",
        "unit_tests": [
            "TestTezClientUtils.java"
        ]
    },
    "incubator-tez_8a3dcf4": {
        "bug_id": "incubator-tez_8a3dcf4",
        "commit": "https://github.com/apache/incubator-tez/commit/8a3dcf4763ad1eaefd0b6d08685a3ade91977324",
        "file": [
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/incubator-tez/blob/8a3dcf4763ad1eaefd0b6d08685a3ade91977324/tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java?ref=8a3dcf4763ad1eaefd0b6d08685a3ade91977324",
                "deletions": 3,
                "filename": "tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java",
                "patch": "@@ -364,9 +364,16 @@ static ApplicationSubmissionContext createApplicationSubmissionContext(\n     if(dag != null) {\n \n       for (Vertex v : dag.getVertices()) {\n+        if (v.getTaskLocalResources() == null) {\n+          v.setTaskLocalResources(new TreeMap<String, LocalResource>());\n+        }\n         v.getTaskLocalResources().putAll(tezJarResources);\n         v.getTaskLocalResources().put(TezConfiguration.TEZ_PB_BINARY_CONF_NAME,\n             binaryConfLRsrc);\n+\n+        if (v.getTaskEnvironment() == null) {\n+          v.setTaskEnvironment(new TreeMap<String, String>());\n+        }\n         Map<String, String> taskEnv = v.getTaskEnvironment();\n         for (Map.Entry<String, String> entry : environment.entrySet()) {\n           String key = entry.getKey();\n@@ -399,9 +406,9 @@ static ApplicationSubmissionContext createApplicationSubmissionContext(\n       }\n \n       localResources.put(TezConfiguration.TEZ_PB_PLAN_BINARY_NAME,\n-          TezClientUtils.createLocalResource(fs,\n-              binaryPath, LocalResourceType.FILE,\n-              LocalResourceVisibility.APPLICATION));\n+        TezClientUtils.createLocalResource(fs,\n+          binaryPath, LocalResourceType.FILE,\n+          LocalResourceVisibility.APPLICATION));\n \n       if (Level.DEBUG.isGreaterOrEqual(Level.toLevel(amLogLevel))) {\n         Path textPath = localizeDagPlanAsText(dagPB, fs,",
                "raw_url": "https://github.com/apache/incubator-tez/raw/8a3dcf4763ad1eaefd0b6d08685a3ade91977324/tez-api/src/main/java/org/apache/tez/client/TezClientUtils.java",
                "sha": "042ff91885e232ddf6a15a2ee127a020b0c46823",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/incubator-tez/blob/8a3dcf4763ad1eaefd0b6d08685a3ade91977324/tez-dag/src/main/java/org/apache/tez/dag/app/rm/TaskScheduler.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-dag/src/main/java/org/apache/tez/dag/app/rm/TaskScheduler.java?ref=8a3dcf4763ad1eaefd0b6d08685a3ade91977324",
                "deletions": 1,
                "filename": "tez-dag/src/main/java/org/apache/tez/dag/app/rm/TaskScheduler.java",
                "patch": "@@ -670,7 +670,7 @@ public void onContainersAllocated(List<Container> containers) {\n             boolean safeToRelease = true;\n             Priority topPendingPriority = amRmClient.getTopPriority();\n             Priority containerPriority = heldContainer.container.getPriority();\n-            if (topPendingPriority != null && \n+            if (isNew && topPendingPriority != null &&\n                 containerPriority.compareTo(topPendingPriority) < 0) {\n               // this container is of lower priority and given to us by the RM for\n               // a task that will be matched after the current top priority. Keep ",
                "raw_url": "https://github.com/apache/incubator-tez/raw/8a3dcf4763ad1eaefd0b6d08685a3ade91977324/tez-dag/src/main/java/org/apache/tez/dag/app/rm/TaskScheduler.java",
                "sha": "6eedb15adab8267cc86ce5fd8cb42609a6ce8e0a",
                "status": "modified"
            }
        ],
        "message": "TEZ-615. OrderedWordCount with -DUSE_TEZ_SESSION=false throws NPE. (hitesh)",
        "parent": "https://github.com/apache/incubator-tez/commit/d4bb730eaa4b8b793b2c7f8b08e1faa50ed566e8",
        "patched_files": [
            "TaskScheduler.java",
            "TezClientUtils.java"
        ],
        "repo": "incubator-tez",
        "unit_tests": [
            "TestTezClientUtils.java",
            "TestTaskScheduler.java"
        ]
    },
    "incubator-tez_968e31f": {
        "bug_id": "incubator-tez_968e31f",
        "commit": "https://github.com/apache/incubator-tez/commit/968e31f96e41ce4c4e7717c6264e70e627f99837",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/incubator-tez/blob/968e31f96e41ce4c4e7717c6264e70e627f99837/tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/VertexImpl.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/VertexImpl.java?ref=968e31f96e41ce4c4e7717c6264e70e627f99837",
                "deletions": 4,
                "filename": "tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/VertexImpl.java",
                "patch": "@@ -250,6 +250,9 @@\n               EnumSet.of(VertexState.TERMINATING, VertexState.KILLED, VertexState.FAILED),\n               VertexEventType.V_TASK_COMPLETED,\n               new TaskCompletedTransition())\n+          .addTransition(VertexState.TERMINATING, VertexState.TERMINATING,\n+              VertexEventType.V_TASK_ATTEMPT_COMPLETED,\n+              TASK_ATTEMPT_COMPLETED_EVENT_TRANSITION) // TODO shouldnt be done for KILL_WAIT vertex\n           .addTransition(VertexState.TERMINATING, VertexState.TERMINATING,\n               VertexEventType.V_SOURCE_TASK_ATTEMPT_COMPLETED,\n               SOURCE_TASK_ATTEMPT_COMPLETED_EVENT_TRANSITION)\n@@ -260,7 +263,6 @@\n           // Ignore-able events\n           .addTransition(VertexState.TERMINATING, VertexState.TERMINATING,\n               EnumSet.of(VertexEventType.V_TERMINATE,\n-                  VertexEventType.V_TASK_ATTEMPT_COMPLETED,\n                   VertexEventType.V_TASK_RESCHEDULED))\n \n           // Transitions from SUCCEEDED state\n@@ -299,7 +301,6 @@\n           // Ignore-able events\n           .addTransition(VertexState.KILLED, VertexState.KILLED,\n               EnumSet.of(VertexEventType.V_TERMINATE,\n-                  VertexEventType.V_SOURCE_VERTEX_STARTED,\n                   VertexEventType.V_START,\n                   VertexEventType.V_TASK_RESCHEDULED,\n                   VertexEventType.V_TASK_ATTEMPT_COMPLETED,\n@@ -310,8 +311,6 @@\n               VertexState.ERROR,\n               VertexState.ERROR,\n               EnumSet.of(VertexEventType.V_INIT,\n-                  VertexEventType.V_SOURCE_VERTEX_STARTED,\n-                  VertexEventType.V_START,\n                   VertexEventType.V_TERMINATE,\n                   VertexEventType.V_TASK_COMPLETED,\n                   VertexEventType.V_TASK_ATTEMPT_COMPLETED,",
                "raw_url": "https://github.com/apache/incubator-tez/raw/968e31f96e41ce4c4e7717c6264e70e627f99837/tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/VertexImpl.java",
                "sha": "67523284ecd9677245093934878a0ae22b114cae",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/incubator-tez/blob/968e31f96e41ce4c4e7717c6264e70e627f99837/tez-mapreduce-examples/src/main/java/org/apache/tez/processor/FilterByWordInputProcessor.java",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-mapreduce-examples/src/main/java/org/apache/tez/processor/FilterByWordInputProcessor.java?ref=968e31f96e41ce4c4e7717c6264e70e627f99837",
                "deletions": 7,
                "filename": "tez-mapreduce-examples/src/main/java/org/apache/tez/processor/FilterByWordInputProcessor.java",
                "patch": "@@ -98,14 +98,13 @@ public void run(Map<String, LogicalInput> inputs,\n     OnFileUnorderedKVOutput kvOutput = (OnFileUnorderedKVOutput) lo;\n \n     Configuration updatedConf = mrInput.getConfigUpdates();\n+    String fileName = updatedConf.get(MRJobConfig.MAP_INPUT_FILE);\n+    LOG.info(\"Processing file: \" + fileName);\n     Text srcFile = new Text();\n-    srcFile.set(\"UNKNOWN_FILENAME_IN_PROCESSOR\");\n-    if (updatedConf != null) {\n-      String fileName = updatedConf.get(MRJobConfig.MAP_INPUT_FILE);\n-      if (fileName != null) {\n-        LOG.info(\"Processing file: \" + fileName);\n-        srcFile.set(fileName);\n-      }\n+    if (fileName == null) {\n+      srcFile.set(\"UNKNOWN_FILENAME_IN_PROCESSOR\");\n+    } else {\n+      srcFile.set(fileName);\n     }\n \n     KVReader kvReader = mrInput.getReader();",
                "raw_url": "https://github.com/apache/incubator-tez/raw/968e31f96e41ce4c4e7717c6264e70e627f99837/tez-mapreduce-examples/src/main/java/org/apache/tez/processor/FilterByWordInputProcessor.java",
                "sha": "e8e315a536113b35b3ca2b2e337ee19ef206ba37",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/incubator-tez/blob/968e31f96e41ce4c4e7717c6264e70e627f99837/tez-mapreduce/src/main/java/org/apache/tez/mapreduce/input/MRInput.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-mapreduce/src/main/java/org/apache/tez/mapreduce/input/MRInput.java?ref=968e31f96e41ce4c4e7717c6264e70e627f99837",
                "deletions": 1,
                "filename": "tez-mapreduce/src/main/java/org/apache/tez/mapreduce/input/MRInput.java",
                "patch": "@@ -209,7 +209,7 @@ public void setNumPhysicalInputs(int numInputs) {\n    * @return the additional fields set by {@link MRInput}\n    */\n   public Configuration getConfigUpdates() {\n-    return incrementalConf;\n+    return new Configuration(incrementalConf);\n   }\n \n   public float getProgress() throws IOException, InterruptedException {",
                "raw_url": "https://github.com/apache/incubator-tez/raw/968e31f96e41ce4c4e7717c6264e70e627f99837/tez-mapreduce/src/main/java/org/apache/tez/mapreduce/input/MRInput.java",
                "sha": "b9f22421a40857c4f1117cefe25bcf8e7f57b725",
                "status": "modified"
            }
        ],
        "message": "Revert \"TEZ-510. Test MRRJobs failing with NPE (bikas)\"\n\nThis reverts commit 1795ea84fc899f5e522680119b1853f559030a14.",
        "parent": "https://github.com/apache/incubator-tez/commit/1795ea84fc899f5e522680119b1853f559030a14",
        "patched_files": [
            "VertexImpl.java"
        ],
        "repo": "incubator-tez",
        "unit_tests": [
            "TestVertexImpl.java"
        ]
    },
    "incubator-tez_a9bace0": {
        "bug_id": "incubator-tez_a9bace0",
        "commit": "https://github.com/apache/incubator-tez/commit/a9bace052a9dba4b1aa08c2e9310df73928dad84",
        "file": [
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/incubator-tez/blob/a9bace052a9dba4b1aa08c2e9310df73928dad84/tez-dag/src/main/java/org/apache/tez/dag/app/dag/Task.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-dag/src/main/java/org/apache/tez/dag/app/dag/Task.java?ref=a9bace052a9dba4b1aa08c2e9310df73928dad84",
                "deletions": 2,
                "filename": "tez-dag/src/main/java/org/apache/tez/dag/app/dag/Task.java",
                "patch": "@@ -78,8 +78,6 @@\n   public List<TezEvent> getTaskAttemptTezEvents(TezTaskAttemptID attemptID,\n       int fromEventId, int maxEvents);\n   \n-  public List<TezEvent> getAndClearTaskTezEvents();\n-\n   public List<String> getDiagnostics();\n \n }",
                "raw_url": "https://github.com/apache/incubator-tez/raw/a9bace052a9dba4b1aa08c2e9310df73928dad84/tez-dag/src/main/java/org/apache/tez/dag/app/dag/Task.java",
                "sha": "8243b7047e2aa349ba73b6814c64065e7faf6aa3",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/incubator-tez/blob/a9bace052a9dba4b1aa08c2e9310df73928dad84/tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/TaskImpl.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/TaskImpl.java?ref=a9bace052a9dba4b1aa08c2e9310df73928dad84",
                "deletions": 12,
                "filename": "tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/TaskImpl.java",
                "patch": "@@ -491,18 +491,6 @@ public float getProgress() {\n     }\n   }\n \n-  @Override\n-  public List<TezEvent> getAndClearTaskTezEvents() {\n-    readLock.lock();\n-    try {\n-      List<TezEvent> events = tezEventsForTaskAttempts;\n-      tezEventsForTaskAttempts = new ArrayList<TezEvent>();\n-      return events;\n-    } finally {\n-      readLock.unlock();\n-    }\n-  }\n-\n   @Override\n   public List<String> getDiagnostics() {\n     List<String> diagnostics = new ArrayList<String>(attempts.size());",
                "raw_url": "https://github.com/apache/incubator-tez/raw/a9bace052a9dba4b1aa08c2e9310df73928dad84/tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/TaskImpl.java",
                "sha": "793c12a44bc129f5a8fa62431003bde9cbcda14d",
                "status": "modified"
            },
            {
                "additions": 27,
                "blob_url": "https://github.com/apache/incubator-tez/blob/a9bace052a9dba4b1aa08c2e9310df73928dad84/tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/VertexImpl.java",
                "changes": 62,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/VertexImpl.java?ref=a9bace052a9dba4b1aa08c2e9310df73928dad84",
                "deletions": 35,
                "filename": "tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/VertexImpl.java",
                "patch": "@@ -462,7 +462,10 @@\n   private Set<String> inputsWithInitializers;\n   private int numInitializedInputs;\n   private boolean startSignalPending = false;\n-  List<TezEvent> pendingRouteEvents = null;\n+  private boolean tasksNotYetScheduled = true;\n+  // We may always store task events in the vertex for scalability\n+  List<TezEvent> pendingTaskEvents = Lists.newLinkedList();\n+  List<TezEvent> pendingRouteEventsWhileIniting = null;\n   List<TezTaskAttemptID> pendingReportedSrcCompletions = Lists.newLinkedList();\n \n   private RootInputInitializerRunner rootInputInitializer;\n@@ -803,6 +806,12 @@ public AppContext getAppContext() {\n   public void scheduleTasks(List<Integer> taskIDs) {\n     readLock.lock();\n     try {\n+      tasksNotYetScheduled = false;\n+      if (!pendingTaskEvents.isEmpty()) {\n+        VertexImpl.ROUTE_EVENT_TRANSITION.transition(this,\n+            new VertexEventRouteEvent(getVertexId(), pendingTaskEvents));\n+        pendingTaskEvents.clear();\n+      }\n       for (Integer taskID : taskIDs) {\n         if (tasks.size() <= taskID.intValue()) {\n           throw new TezUncheckedException(\n@@ -874,10 +883,6 @@ public boolean setParallelism(int parallelism, VertexLocationHint vertexLocation\n           edge.startEventBuffering();\n         }\n   \n-        // Use a set since the same event may have been sent to multiple tasks\n-        // and we want to avoid duplicates\n-        Set<TezEvent> pendingEvents = new HashSet<TezEvent>();\n-  \n         LOG.info(\"Vertex \" + getVertexId() + \n             \" parallelism set to \" + parallelism + \" from \" + numTasks);\n         // assign to local variable of LinkedHashMap to make sure that changing\n@@ -896,7 +901,6 @@ public boolean setParallelism(int parallelism, VertexLocationHint vertexLocation\n                     + \" for vertex: \" + getVertexId() + \" name: \" + getName());\n             return false;\n           }\n-          pendingEvents.addAll(task.getAndClearTaskTezEvents());\n           if (i <= parallelism) {\n             continue;\n           }\n@@ -913,7 +917,6 @@ public boolean setParallelism(int parallelism, VertexLocationHint vertexLocation\n                 + entry.getKey() + \" destination: \" + getVertexId());\n             Vertex sourceVertex = appContext.getCurrentDAG().getVertex(entry.getKey());\n             Edge edge = sourceVertices.get(sourceVertex);\n-            EdgeProperty edgeProperty = edge.getEdgeProperty();\n             try {\n               edge.setCustomEdgeManager(entry.getValue());\n             } catch (Exception e) {\n@@ -926,21 +929,6 @@ public boolean setParallelism(int parallelism, VertexLocationHint vertexLocation\n           }\n         }\n   \n-        // Re-route all existing TezEvents according to new routing table\n-        // At this point only events attributed to source task attempts can be\n-        // re-routed. e.g. DataMovement or InputFailed events.\n-        // This assumption is fine for now since these tasks haven't been started.\n-        // So they can only get events generated from source task attempts that\n-        // have already been started.\n-        DAG dag = getDAG();\n-        for(TezEvent event : pendingEvents) {\n-          TezVertexID sourceVertexId = event.getSourceInfo().getTaskAttemptID()\n-              .getTaskID().getVertexID();\n-          Vertex sourceVertex = dag.getVertex(sourceVertexId);\n-          Edge sourceEdge = sourceVertices.get(sourceVertex);\n-          sourceEdge.sendTezEventToDestinationTasks(event);\n-        }\n-  \n         // stop buffering events\n         for (Edge edge : sourceVertices.values()) {\n           edge.stopEventBuffering();\n@@ -1550,10 +1538,10 @@ private VertexState initializeVertexInInitializingState() {\n     }\n \n     // Vertex will be moving to INITED state, safe to process pending route events.\n-    if (pendingRouteEvents != null) {\n+    if (pendingRouteEventsWhileIniting != null) {\n       VertexImpl.ROUTE_EVENT_TRANSITION.transition(this,\n-          new VertexEventRouteEvent(getVertexId(), pendingRouteEvents));\n-      pendingRouteEvents = null;\n+          new VertexEventRouteEvent(getVertexId(), pendingRouteEventsWhileIniting));\n+      pendingRouteEventsWhileIniting = null;\n     }\n     return vertexState;\n   }\n@@ -2032,12 +2020,12 @@ private static void checkEventSourceMetadata(Vertex vertex,\n     @Override\n     public void transition(VertexImpl vertex, VertexEvent event) {\n       VertexEventRouteEvent re = (VertexEventRouteEvent) event;\n-      if (vertex.pendingRouteEvents == null) {\n-        vertex.pendingRouteEvents = Lists.newLinkedList();\n+      if (vertex.pendingRouteEventsWhileIniting == null) {\n+        vertex.pendingRouteEventsWhileIniting = Lists.newLinkedList();\n       }\n       // Store the events for post-init routing, since INIT state is when\n       // initial task parallelism will be set\n-      vertex.pendingRouteEvents.addAll(re.getEvents());\n+      vertex.pendingRouteEventsWhileIniting.addAll(re.getEvents());\n     }\n   }\n \n@@ -2103,14 +2091,18 @@ public void transition(VertexImpl vertex, VertexEvent event) {\n             } else {\n               // event not from this vertex. must have come from source vertex.\n               // send to tasks\n-              Edge srcEdge = vertex.sourceVertices.get(vertex.getDAG().getVertex(\n-                  sourceMeta.getTaskVertexName()));\n-              if (srcEdge == null) {\n-                throw new TezUncheckedException(\"Bad source vertex: \" +\n-                    sourceMeta.getTaskVertexName() + \" for destination vertex: \" +\n-                    vertex.getVertexId());\n+              if (vertex.tasksNotYetScheduled) {\n+                vertex.pendingTaskEvents.add(tezEvent);\n+              } else {\n+                Edge srcEdge = vertex.sourceVertices.get(vertex.getDAG().getVertex(\n+                    sourceMeta.getTaskVertexName()));\n+                if (srcEdge == null) {\n+                  throw new TezUncheckedException(\"Bad source vertex: \" +\n+                      sourceMeta.getTaskVertexName() + \" for destination vertex: \" +\n+                      vertex.getVertexId());\n+                }\n+                srcEdge.sendTezEventToDestinationTasks(tezEvent);\n               }\n-              srcEdge.sendTezEventToDestinationTasks(tezEvent);\n             }\n           }\n           break;",
                "raw_url": "https://github.com/apache/incubator-tez/raw/a9bace052a9dba4b1aa08c2e9310df73928dad84/tez-dag/src/main/java/org/apache/tez/dag/app/dag/impl/VertexImpl.java",
                "sha": "d3e07cb2d09783e606c5cb20de16c1530c0fe8b6",
                "status": "modified"
            },
            {
                "additions": 42,
                "blob_url": "https://github.com/apache/incubator-tez/blob/a9bace052a9dba4b1aa08c2e9310df73928dad84/tez-dag/src/test/java/org/apache/tez/dag/app/dag/impl/TestVertexImpl.java",
                "changes": 42,
                "contents_url": "https://api.github.com/repos/apache/incubator-tez/contents/tez-dag/src/test/java/org/apache/tez/dag/app/dag/impl/TestVertexImpl.java?ref=a9bace052a9dba4b1aa08c2e9310df73928dad84",
                "deletions": 0,
                "filename": "tez-dag/src/test/java/org/apache/tez/dag/app/dag/impl/TestVertexImpl.java",
                "patch": "@@ -98,6 +98,7 @@\n import org.apache.tez.dag.app.dag.event.VertexEvent;\n import org.apache.tez.dag.app.dag.event.VertexEventRootInputFailed;\n import org.apache.tez.dag.app.dag.event.VertexEventRootInputInitialized;\n+import org.apache.tez.dag.app.dag.event.VertexEventRouteEvent;\n import org.apache.tez.dag.app.dag.event.VertexEventTaskAttemptCompleted;\n import org.apache.tez.dag.app.dag.event.VertexEventTaskCompleted;\n import org.apache.tez.dag.app.dag.event.VertexEventTaskReschedule;\n@@ -114,12 +115,16 @@\n import org.apache.tez.runtime.api.Event;\n import org.apache.tez.runtime.api.OutputCommitter;\n import org.apache.tez.runtime.api.OutputCommitterContext;\n+import org.apache.tez.runtime.api.events.CompositeDataMovementEvent;\n import org.apache.tez.runtime.api.events.DataMovementEvent;\n import org.apache.tez.runtime.api.events.InputReadErrorEvent;\n import org.apache.tez.runtime.api.events.RootInputConfigureVertexTasksEvent;\n import org.apache.tez.runtime.api.events.RootInputDataInformationEvent;\n import org.apache.tez.test.EdgeManagerForTest;\n+import org.apache.tez.runtime.api.impl.EventMetaData;\n+import org.apache.tez.runtime.api.impl.EventMetaData.EventProducerConsumerType;\n import org.apache.tez.runtime.api.impl.GroupInputSpec;\n+import org.apache.tez.runtime.api.impl.TezEvent;\n import org.junit.After;\n import org.junit.Assert;\n import org.junit.Before;\n@@ -1419,6 +1424,43 @@ public void testVertexSetParallelism() {\n     Assert.assertTrue(tasks.keySet().iterator().next().equals(firstTask));\n \n   }\n+  \n+  @SuppressWarnings(\"unchecked\")\n+  @Test(timeout = 5000)\n+  public void testVertexPendingTaskEvents() {\n+    initAllVertices(VertexState.INITED);\n+    VertexImpl v3 = vertices.get(\"vertex3\");\n+    VertexImpl v2 = vertices.get(\"vertex2\");\n+    \n+    startVertex(v2);\n+    startVertex(v3);\n+    \n+    TezTaskID t0_v2 = TezTaskID.getInstance(v2.getVertexId(), 0);\n+    TezTaskAttemptID ta0_t0_v2 = TezTaskAttemptID.getInstance(t0_v2, 0);\n+\n+    List<TezEvent> taskEvents = Lists.newLinkedList();\n+    TezEvent tezEvent1 = new TezEvent(\n+        new CompositeDataMovementEvent(0, 1, new byte[0]), \n+        new EventMetaData(EventProducerConsumerType.OUTPUT, \"vertex2\", \"vertex3\", ta0_t0_v2));\n+    TezEvent tezEvent2 = new TezEvent(\n+        new DataMovementEvent(0, new byte[0]), \n+        new EventMetaData(EventProducerConsumerType.OUTPUT, \"vertex2\", \"vertex3\", ta0_t0_v2));\n+    taskEvents.add(tezEvent1);\n+    taskEvents.add(tezEvent2);\n+    // send events and test that they are buffered until some task is scheduled\n+    dispatcher.getEventHandler().handle(\n+        new VertexEventRouteEvent(v3.getVertexId(), taskEvents));\n+    dispatcher.await();\n+    Assert.assertEquals(2, v3.pendingTaskEvents.size());\n+    v3.scheduleTasks(Collections.singletonList(new Integer(0)));\n+    dispatcher.await();\n+    Assert.assertEquals(0, v3.pendingTaskEvents.size());\n+    // send events and test that they are not buffered anymore\n+    dispatcher.getEventHandler().handle(\n+        new VertexEventRouteEvent(v3.getVertexId(), taskEvents));\n+    dispatcher.await();\n+    Assert.assertEquals(0, v3.pendingTaskEvents.size());\n+  }\n \n   @Test(timeout = 5000)\n   public void testSetCustomEdgeManager() throws UnsupportedEncodingException {",
                "raw_url": "https://github.com/apache/incubator-tez/raw/a9bace052a9dba4b1aa08c2e9310df73928dad84/tez-dag/src/test/java/org/apache/tez/dag/app/dag/impl/TestVertexImpl.java",
                "sha": "1a14b15b613b02082e02aaea2d02bf6ce8cab09d",
                "status": "modified"
            }
        ],
        "message": "TEZ-715. Auto Reduce Parallelism can rarely trigger NPE in AM at DAGAppMaster.handle(DAGAppMaster.java:1268) (bikas)",
        "parent": "https://github.com/apache/incubator-tez/commit/f2f31e0eff3f654d51ca7001a3bf1784cf8d5e0b",
        "patched_files": [
            "Task.java",
            "VertexImpl.java",
            "TaskImpl.java"
        ],
        "repo": "incubator-tez",
        "unit_tests": [
            "TestTaskImpl.java",
            "TestVertexImpl.java"
        ]
    }
}