[
    {
        "repo": "attic-stratos",
        "message": "fixing NPE",
        "commit": "https://github.com/apache/attic-stratos/commit/2bb2101f4d00b77e3e40111fccdb0f01630463d7",
        "parent": "https://github.com/apache/attic-stratos/commit/78371873d62b112551dae1b798a3db268a957d65",
        "bug_id": "attic-stratos_1",
        "file": [
            {
                "sha": "3dd402762c84947dc7944857d3e33f48ffac82ac",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/ClusterMonitorFactory.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/2bb2101f4d00b77e3e40111fccdb0f01630463d7/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/ClusterMonitorFactory.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/2bb2101f4d00b77e3e40111fccdb0f01630463d7/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/ClusterMonitorFactory.java",
                "status": "modified",
                "changes": 121,
                "additions": 60,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/ClusterMonitorFactory.java?ref=2bb2101f4d00b77e3e40111fccdb0f01630463d7",
                "patch": "@@ -19,35 +19,31 @@\n \n package org.apache.stratos.autoscaler.monitor.cluster;\n \n-import java.util.Map;\n-import java.util.Random;\n-\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n-import org.apache.stratos.autoscaler.KubernetesClusterContext;\n-import org.apache.stratos.autoscaler.MemberStatsContext;\n-import org.apache.stratos.autoscaler.NetworkPartitionContext;\n-import org.apache.stratos.autoscaler.NetworkPartitionLbHolder;\n-import org.apache.stratos.autoscaler.PartitionContext;\n+import org.apache.stratos.autoscaler.*;\n import org.apache.stratos.autoscaler.client.cloud.controller.CloudControllerClient;\n-import org.apache.stratos.autoscaler.policy.model.DeploymentPolicy;\n import org.apache.stratos.autoscaler.exception.PartitionValidationException;\n import org.apache.stratos.autoscaler.exception.PolicyValidationException;\n import org.apache.stratos.autoscaler.partition.PartitionGroup;\n import org.apache.stratos.autoscaler.partition.PartitionManager;\n import org.apache.stratos.autoscaler.policy.PolicyManager;\n import org.apache.stratos.autoscaler.policy.model.AutoscalePolicy;\n+import org.apache.stratos.autoscaler.policy.model.DeploymentPolicy;\n import org.apache.stratos.cloud.controller.stub.deployment.partition.Partition;\n import org.apache.stratos.cloud.controller.stub.pojo.MemberContext;\n-import org.apache.stratos.common.constants.StratosConstants;\n import org.apache.stratos.cloud.controller.stub.pojo.Properties;\n import org.apache.stratos.cloud.controller.stub.pojo.Property;\n+import org.apache.stratos.common.constants.StratosConstants;\n import org.apache.stratos.messaging.domain.topology.Cluster;\n import org.apache.stratos.messaging.domain.topology.ClusterStatus;\n import org.apache.stratos.messaging.domain.topology.Member;\n import org.apache.stratos.messaging.domain.topology.MemberStatus;\n import org.apache.stratos.messaging.util.Constants;\n \n+import java.util.Map;\n+import java.util.Random;\n+\n /*\n  * Factory class for creating cluster monitors.\n  */\n@@ -109,7 +105,7 @@ private static VMServiceClusterMonitor getVMServiceClusterMonitor(Cluster cluste\n         if (allPartitions == null) {\n             String msg =\n                     \"Partitions are null in deployment policy: [policy-name]: \" +\n-                    deploymentPolicyName;\n+                            deploymentPolicyName;\n             log.error(msg);\n             throw new PolicyValidationException(msg);\n         }\n@@ -118,14 +114,14 @@ private static VMServiceClusterMonitor getVMServiceClusterMonitor(Cluster cluste\n \n         VMServiceClusterMonitor clusterMonitor =\n                 new VMServiceClusterMonitor(cluster.getClusterId(),\n-                                            cluster.getServiceName(),\n-                                            deploymentPolicy, policy);\n+                        cluster.getServiceName(),\n+                        deploymentPolicy, policy);\n \n         for (PartitionGroup partitionGroup : deploymentPolicy.getPartitionGroups()) {\n \n             NetworkPartitionContext networkPartitionContext = new NetworkPartitionContext(partitionGroup.getId(),\n-                                                                                          partitionGroup.getPartitionAlgo(),\n-                                                                                          partitionGroup.getPartitions());\n+                    partitionGroup.getPartitionAlgo(),\n+                    partitionGroup.getPartitions());\n \n             for (Partition partition : partitionGroup.getPartitions()) {\n                 PartitionContext partitionContext = new PartitionContext(partition);\n@@ -144,19 +140,19 @@ private static VMServiceClusterMonitor getVMServiceClusterMonitor(Cluster cluste\n                         memberContext.setProperties(convertMemberPropsToMemberContextProps(member.getProperties()));\n \n                         if (MemberStatus.Activated.equals(member.getStatus())) {\n-                        \tif (log.isDebugEnabled()) {\n-                        \t\tString msg = String.format(\"Active member loaded from topology and added to active member list, %s\", member.toString());\n-            \t\t\t\t\tlog.debug(msg);\n-            \t\t\t\t}\n+                            if (log.isDebugEnabled()) {\n+                                String msg = String.format(\"Active member loaded from topology and added to active member list, %s\", member.toString());\n+                                log.debug(msg);\n+                            }\n                             partitionContext.addActiveMember(memberContext);\n //                            networkPartitionContext.increaseMemberCountOfPartition(partition.getNetworkPartitionId(), 1);\n //                            partitionContext.incrementCurrentActiveMemberCount(1);\n \n                         } else if (MemberStatus.Created.equals(member.getStatus()) || MemberStatus.Starting.equals(member.getStatus())) {\n-                        \tif (log.isDebugEnabled()) {\n-                        \t\tString msg = String.format(\"Pending member loaded from topology and added to pending member list, %s\", member.toString());\n-            \t\t\t\t\tlog.debug(msg);\n-            \t\t\t\t}\n+                            if (log.isDebugEnabled()) {\n+                                String msg = String.format(\"Pending member loaded from topology and added to pending member list, %s\", member.toString());\n+                                log.debug(msg);\n+                            }\n                             partitionContext.addPendingMember(memberContext);\n \n //                            networkPartitionContext.increaseMemberCountOfPartition(partition.getNetworkPartitionId(), 1);\n@@ -173,32 +169,35 @@ private static VMServiceClusterMonitor getVMServiceClusterMonitor(Cluster cluste\n                 networkPartitionContext.addPartitionContext(partitionContext);\n                 if (log.isInfoEnabled()) {\n                     log.info(String.format(\"Partition context has been added: [partition] %s\",\n-                                           partitionContext.getPartitionId()));\n+                            partitionContext.getPartitionId()));\n                 }\n             }\n \n             clusterMonitor.addNetworkPartitionCtxt(networkPartitionContext);\n             if (log.isInfoEnabled()) {\n                 log.info(String.format(\"Network partition context has been added: [network partition] %s\",\n-                                       networkPartitionContext.getId()));\n+                        networkPartitionContext.getId()));\n             }\n         }\n \n \n         // find lb reference type\n         java.util.Properties props = cluster.getProperties();\n \n-        if (props != null && props.containsKey(Constants.LOAD_BALANCER_REF)) {\n-            String value = props.getProperty(Constants.LOAD_BALANCER_REF);\n-            clusterMonitor.setLbReferenceType(value);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Set the lb reference type: \" + value);\n+        if (props != null) {\n+            if (props.containsKey(Constants.LOAD_BALANCER_REF)) {\n+                String value = props.getProperty(Constants.LOAD_BALANCER_REF);\n+                clusterMonitor.setLbReferenceType(value);\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\"Set the lb reference type: \" + value);\n+                }\n             }\n+\n+            // set hasPrimary property\n+            // hasPrimary is true if there are primary members available in that cluster\n+            clusterMonitor.setHasPrimary(Boolean.parseBoolean(cluster.getProperties().getProperty(Constants.IS_PRIMARY)));\n         }\n \n-        // set hasPrimary property\n-        // hasPrimary is true if there are primary members available in that cluster\n-        clusterMonitor.setHasPrimary(Boolean.parseBoolean(cluster.getProperties().getProperty(Constants.IS_PRIMARY)));\n \n         log.info(\"VMServiceClusterMonitor created: \" + clusterMonitor.toString());\n         return clusterMonitor;\n@@ -249,8 +248,8 @@ private static VMLbClusterMonitor getVMLbClusterMonitor(Cluster cluster)\n         String clusterId = cluster.getClusterId();\n         VMLbClusterMonitor clusterMonitor =\n                 new VMLbClusterMonitor(clusterId,\n-                                       cluster.getServiceName(),\n-                                       deploymentPolicy, policy);\n+                        cluster.getServiceName(),\n+                        deploymentPolicy, policy);\n         clusterMonitor.setStatus(ClusterStatus.Created);\n         // partition group = network partition context\n         for (PartitionGroup partitionGroup : deploymentPolicy.getPartitionGroups()) {\n@@ -270,8 +269,8 @@ private static VMLbClusterMonitor getVMLbClusterMonitor(Cluster cluster)\n             partitionContext.setMinimumMemberCount(1);//Here it hard codes the minimum value as one for LB cartridge partitions\n \n             NetworkPartitionContext networkPartitionContext = new NetworkPartitionContext(partitionGroup.getId(),\n-                                                                                          partitionGroup.getPartitionAlgo(),\n-                                                                                          partitionGroup.getPartitions());\n+                    partitionGroup.getPartitionAlgo(),\n+                    partitionGroup.getPartitions());\n             for (Member member : cluster.getMembers()) {\n                 String memberId = member.getMemberId();\n                 if (member.getNetworkPartitionId().equalsIgnoreCase(networkPartitionContext.getId())) {\n@@ -282,19 +281,19 @@ private static VMLbClusterMonitor getVMLbClusterMonitor(Cluster cluster)\n                     memberContext.setInitTime(member.getInitTime());\n \n                     if (MemberStatus.Activated.equals(member.getStatus())) {\n-                    \tif (log.isDebugEnabled()) {\n-                    \t\tString msg = String.format(\"Active member loaded from topology and added to active member list, %s\", member.toString());\n-        \t\t\t\t\tlog.debug(msg);\n-        \t\t\t\t}\n+                        if (log.isDebugEnabled()) {\n+                            String msg = String.format(\"Active member loaded from topology and added to active member list, %s\", member.toString());\n+                            log.debug(msg);\n+                        }\n                         partitionContext.addActiveMember(memberContext);\n //                        networkPartitionContext.increaseMemberCountOfPartition(partition.getNetworkPartitionId(), 1);\n //                        partitionContext.incrementCurrentActiveMemberCount(1);\n                     } else if (MemberStatus.Created.equals(member.getStatus()) ||\n-                               MemberStatus.Starting.equals(member.getStatus())) {\n-                    \tif (log.isDebugEnabled()) {\n-                    \t\tString msg = String.format(\"Pending member loaded from topology and added to pending member list, %s\", member.toString());\n-        \t\t\t\t\tlog.debug(msg);\n-        \t\t\t\t}\n+                            MemberStatus.Starting.equals(member.getStatus())) {\n+                        if (log.isDebugEnabled()) {\n+                            String msg = String.format(\"Pending member loaded from topology and added to pending member list, %s\", member.toString());\n+                            log.debug(msg);\n+                        }\n                         partitionContext.addPendingMember(memberContext);\n //                        networkPartitionContext.increaseMemberCountOfPartition(partition.getNetworkPartitionId(), 1);\n                     } else if (MemberStatus.Suspended.equals(member.getStatus())) {\n@@ -360,17 +359,17 @@ private static KubernetesServiceClusterMonitor getDockerServiceClusterMonitor(Cl\n         }\n \n         AutoscalePolicy policy = PolicyManager.getInstance().getAutoscalePolicy(autoscalePolicyName);\n-        \n+\n         if (policy == null) {\n             String msg = \"Autoscale Policy is null. Policy name: \" + autoscalePolicyName;\n             log.error(msg);\n             throw new PolicyValidationException(msg);\n         }\n-        \n+\n         java.util.Properties props = cluster.getProperties();\n         String kubernetesHostClusterID = props.getProperty(StratosConstants.KUBERNETES_CLUSTER_ID);\n         KubernetesClusterContext kubernetesClusterCtxt = new KubernetesClusterContext(kubernetesHostClusterID,\n-                                                                                      cluster.getClusterId());\n+                cluster.getClusterId());\n \n         String minReplicasProperty = props.getProperty(StratosConstants.KUBERNETES_MIN_REPLICAS);\n         if (minReplicasProperty != null && !minReplicasProperty.isEmpty()) {\n@@ -400,26 +399,26 @@ private static KubernetesServiceClusterMonitor getDockerServiceClusterMonitor(Cl\n             memberContext.setMemberId(memberId);\n             memberContext.setClusterId(clusterId);\n             memberContext.setInitTime(member.getInitTime());\n-            \n+\n             // if there is at least one member in the topology, that means service has been created already\n             // this is to avoid calling startContainer() method again\n             kubernetesClusterCtxt.setServiceClusterCreated(true);\n-            \n+\n             if (MemberStatus.Activated.equals(member.getStatus())) {\n-            \tif (log.isDebugEnabled()) {\n-            \t\tString msg = String.format(\"Active member loaded from topology and added to active member list, %s\", member.toString());\n-\t\t\t\t\tlog.debug(msg);\n-\t\t\t\t}\n+                if (log.isDebugEnabled()) {\n+                    String msg = String.format(\"Active member loaded from topology and added to active member list, %s\", member.toString());\n+                    log.debug(msg);\n+                }\n                 dockerClusterMonitor.getKubernetesClusterCtxt().addActiveMember(memberContext);\n             } else if (MemberStatus.Created.equals(member.getStatus())\n-                       || MemberStatus.Starting.equals(member.getStatus())) {\n-            \tif (log.isDebugEnabled()) {\n-            \t\tString msg = String.format(\"Pending member loaded from topology and added to pending member list, %s\", member.toString());\n-\t\t\t\t\tlog.debug(msg);\n-\t\t\t\t}\n+                    || MemberStatus.Starting.equals(member.getStatus())) {\n+                if (log.isDebugEnabled()) {\n+                    String msg = String.format(\"Pending member loaded from topology and added to pending member list, %s\", member.toString());\n+                    log.debug(msg);\n+                }\n                 dockerClusterMonitor.getKubernetesClusterCtxt().addPendingMember(memberContext);\n             }\n-            \n+\n             kubernetesClusterCtxt.addMemberStatsContext(new MemberStatsContext(memberId));\n             if (log.isInfoEnabled()) {\n                 log.info(String.format(\"Member stat context has been added: [member] %s\", memberId));",
                "deletions": 61
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "eleminating NPE possibilities",
        "commit": "https://github.com/apache/attic-stratos/commit/9991ffbdba67308ba1ec62fe6cc9d5c0294e9913",
        "parent": "https://github.com/apache/attic-stratos/commit/0a5831989810c21bba4d2f44b3c459b681a0a8bc",
        "bug_id": "attic-stratos_2",
        "file": [
            {
                "sha": "170e8544e1816c9cc18485b499d6a18db42bffa8",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/util/converter/ObjectConverter.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/9991ffbdba67308ba1ec62fe6cc9d5c0294e9913/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/util/converter/ObjectConverter.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/9991ffbdba67308ba1ec62fe6cc9d5c0294e9913/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/util/converter/ObjectConverter.java",
                "status": "modified",
                "changes": 128,
                "additions": 114,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/util/converter/ObjectConverter.java?ref=9991ffbdba67308ba1ec62fe6cc9d5c0294e9913",
                "patch": "@@ -63,6 +63,10 @@\n \n     public static CartridgeConfig convertCartridgeBeanToStubCartridgeConfig(\n             CartridgeBean cartridgeBean) {\n+    \t\n+    \tif (cartridgeBean == null) {\n+\t\t\treturn null;\n+\t\t}\n \n         CartridgeConfig cartridgeConfig = new CartridgeConfig();\n \n@@ -110,6 +114,10 @@ public static CartridgeConfig convertCartridgeBeanToStubCartridgeConfig(\n     }\n \n     private static PortMapping[] convertPortMappingBeansToStubPortMappings(List<PortMappingBean> portMappingBeans) {\n+    \t\n+    \tif (portMappingBeans == null) {\n+\t\t\treturn null;\n+\t\t}\n \n         //convert to an array\n         PortMappingBean[] portMappingBeanArray = new PortMappingBean[portMappingBeans.size()];\n@@ -128,6 +136,10 @@ public static CartridgeConfig convertCartridgeBeanToStubCartridgeConfig(\n     }\n \n     private static IaasConfig[] convertIaasProviderBeansToStubIaasConfig(List<IaasProviderBean> iaasProviderBeans) {\n+    \t\n+    \tif (iaasProviderBeans == null) {\n+    \t\treturn null;\n+\t\t}\n \n         //convert to an array\n         IaasProviderBean[] iaasProviderBeansArray = new IaasProviderBean[iaasProviderBeans.size()];\n@@ -162,6 +174,11 @@ public static CartridgeConfig convertCartridgeBeanToStubCartridgeConfig(\n \n     public static Persistence convertPersistenceBeanToStubPersistence(\n             org.apache.stratos.common.beans.cartridge.PersistenceBean persistenceBean) {\n+    \t\n+    \tif (persistenceBean == null) {\n+\t\t\treturn null;\n+\t\t}\n+    \t\n         Persistence persistence = new Persistence();\n         persistence.setPersistenceRequired(true);\n         VolumeBean[] volumeBean = new VolumeBean[persistenceBean.getVolume().size()];\n@@ -189,6 +206,11 @@ public static Persistence convertPersistenceBeanToStubPersistence(\n \n     public static Properties convertPropertyBeansToProperties(\n             List<org.apache.stratos.common.beans.cartridge.PropertyBean> propertyBeans) {\n+    \t\n+    \tif (propertyBeans == null) {\n+\t\t\treturn null;\n+\t\t}\n+    \t\n         org.apache.stratos.common.beans.cartridge.PropertyBean[] propertyBeansArray\n                 = new org.apache.stratos.common.beans.cartridge.PropertyBean[propertyBeans.size()];\n         propertyBeans.toArray(propertyBeansArray);\n@@ -208,6 +230,7 @@ public static Properties convertPropertyBeansToProperties(\n \n     public static org.apache.stratos.cloud.controller.stub.Properties convertPropertyBeansToCCStubProperties(\n             List<org.apache.stratos.common.beans.cartridge.PropertyBean> propertyBeans) {\n+    \t\n         if (propertyBeans == null) {\n             return null;\n         }\n@@ -235,6 +258,7 @@ public static Properties convertPropertyBeansToProperties(\n \n     public static org.apache.stratos.cloud.controller.stub.Properties convertProperyBeansToStubProperties(\n             List<org.apache.stratos.common.beans.cartridge.PropertyBean> propertyBeans) {\n+    \t\n         if (propertyBeans == null || propertyBeans.isEmpty()) {\n             return null;\n         }\n@@ -260,6 +284,11 @@ public static Properties convertPropertyBeansToProperties(\n \n     private static NetworkInterfaces convertNetworkInterfaceBeansToNetworkInterfaces(\n             List<NetworkInterfaceBean> networkInterfaceBeans) {\n+    \t\n+    \tif (networkInterfaceBeans == null) {\n+\t\t\treturn null;\n+\t\t}\n+    \t\n         NetworkInterface[] networkInterfacesArray = new NetworkInterface[networkInterfaceBeans.size()];\n \n         int i = 0;\n@@ -283,6 +312,10 @@ private static NetworkInterfaces convertNetworkInterfaceBeansToNetworkInterfaces\n \n     private static FloatingNetworks convertFloatingNetworkBeansToFloatingNetworks(\n             List<FloatingNetworkBean> floatingNetworkBeans) {\n+    \t\n+    \tif (floatingNetworkBeans == null) {\n+\t\t\treturn null;\n+\t\t}\n \n         FloatingNetwork[] floatingNetworksArray = new FloatingNetwork[floatingNetworkBeans.size()];\n \n@@ -302,6 +335,10 @@ private static FloatingNetworks convertFloatingNetworkBeansToFloatingNetworks(\n \n     public static PartitionRef convertStubPartitionToPartitionRef\n             (PartitionRefBean partition) {\n+    \t\n+    \tif (partition == null) {\n+\t\t\treturn null;\n+\t\t}\n \n         org.apache.stratos.cloud.controller.stub.domain.PartitionRef stubPartition = new\n                 org.apache.stratos.cloud.controller.stub.domain.PartitionRef();\n@@ -314,6 +351,10 @@ private static FloatingNetworks convertFloatingNetworkBeansToFloatingNetworks(\n \n     public static org.apache.stratos.autoscaler.stub.autoscale.policy.AutoscalePolicy convertToCCAutoscalerPojo(\n             AutoscalePolicyBean autoscalePolicyBean) {\n+    \t\n+    \tif (autoscalePolicyBean == null) {\n+\t\t\treturn null;\n+\t\t}\n \n         org.apache.stratos.autoscaler.stub.autoscale.policy.AutoscalePolicy autoscalePolicy = new\n                 org.apache.stratos.autoscaler.stub.autoscale.policy.AutoscalePolicy();\n@@ -357,6 +398,10 @@ private static FloatingNetworks convertFloatingNetworkBeansToFloatingNetworks(\n \n     public static org.apache.stratos.cloud.controller.stub.domain.DeploymentPolicy convetToCCDeploymentPolicy(\n             DeploymentPolicyBean deploymentPolicyBean) {\n+    \t\n+    \tif (deploymentPolicyBean == null) {\n+\t\t\treturn null;\n+\t\t}\n \n         org.apache.stratos.cloud.controller.stub.domain.DeploymentPolicy deploymentPolicy =\n                 new org.apache.stratos.cloud.controller.stub.domain.DeploymentPolicy();\n@@ -437,6 +482,10 @@ public static ApplicationPolicyBean convertASStubApplicationPolicyToApplicationP\n     }\n \n     public static Partition convertPartitionToCCPartitionPojo(PartitionBean partitionBean) {\n+    \t\n+    \tif (partitionBean == null) {\n+\t\t\treturn null;\n+\t\t}\n \n         Partition partition = new Partition();\n         partition.setId(partitionBean.getId());\n@@ -452,6 +501,7 @@ public static Partition convertPartitionToCCPartitionPojo(PartitionBean partitio\n     }\n \n     public static org.apache.stratos.autoscaler.stub.Properties getASProperties(List<PropertyBean> propertyBeans) {\n+    \t\n         if (propertyBeans == null || propertyBeans.isEmpty()) {\n             return null;\n         }\n@@ -476,6 +526,7 @@ public static Partition convertPartitionToCCPartitionPojo(PartitionBean partitio\n \n     public static org.apache.stratos.autoscaler.stub.Properties getASPropertiesFromCommonProperties(\n             List<org.apache.stratos.common.beans.PropertyBean> propertyBeans) {\n+    \t\n         if (propertyBeans == null || propertyBeans.isEmpty()) {\n             return null;\n         }\n@@ -500,6 +551,7 @@ public static Partition convertPartitionToCCPartitionPojo(PartitionBean partitio\n     }\n \n     public static org.apache.stratos.cloud.controller.stub.Properties getCCProperties(List<PropertyBean> propertyBeans) {\n+    \t\n         if (propertyBeans == null || propertyBeans.isEmpty()) {\n             return null;\n         }\n@@ -524,6 +576,7 @@ public static Partition convertPartitionToCCPartitionPojo(PartitionBean partitio\n     }\n \n     private static PartitionBean convertCCStubPartitionToPartition(Partition stubPartition) {\n+    \t\n         if (stubPartition == null) {\n             return null;\n         }\n@@ -547,19 +600,6 @@ private static PartitionBean convertCCStubPartitionToPartition(Partition stubPar\n     }\n \n \n-    private static org.apache.stratos.common.beans.cartridge.PropertyBean convertStubPropertyToPropertyBean(\n-            org.apache.stratos.autoscaler.stub.Property stubProperty) {\n-        if ((stubProperty == null) || (!(stubProperty.getValue() instanceof String))) {\n-            return null;\n-        }\n-\n-        org.apache.stratos.common.beans.cartridge.PropertyBean propertyBean\n-                = new org.apache.stratos.common.beans.cartridge.PropertyBean();\n-        propertyBean.setName(stubProperty.getName());\n-        propertyBean.setValue(String.valueOf(stubProperty.getValue()));\n-        return propertyBean;\n-    }\n-\n     public static org.apache.stratos.cloud.controller.stub.domain.NetworkPartition convertNetworkPartitionToCCStubNetworkPartition(\n             NetworkPartitionBean networkPartitionBean) {\n \n@@ -1365,6 +1405,10 @@ private static SubscribableInfo convertStubSubscribableInfoContextToSubscribable\n \n     private static CartridgeContext[] convertCartridgeReferenceBeansToStubCartridgeContexts(\n             List<CartridgeReferenceBean> cartridges) {\n+    \t\n+    \tif (cartridges == null) {\n+\t\t\treturn null;\n+\t\t}\n \n         CartridgeContext[] cartridgeContextArray = new CartridgeContext[cartridges.size()];\n         int i = 0;\n@@ -1381,6 +1425,10 @@ private static SubscribableInfo convertStubSubscribableInfoContextToSubscribable\n     }\n \n     private static SubscribableInfoContext convertSubscribableInfo(SubscribableInfo subscribableInfo) {\n+    \t\n+    \tif (subscribableInfo == null) {\n+\t\t\treturn null;\n+\t\t}\n \n         SubscribableInfoContext infoContext = new SubscribableInfoContext();\n         infoContext.setAlias(subscribableInfo.getAlias());\n@@ -1416,6 +1464,10 @@ private static SubscribableInfoContext convertSubscribableInfo(SubscribableInfo\n     }\n \n     private static VolumeContext[] convertVolumeToStubVolume(List<VolumeBean> volumes) {\n+    \t\n+    \tif (volumes == null) {\n+\t\t\treturn null;\n+\t\t}\n \n         List<VolumeContext> volumeContexts = new ArrayList<VolumeContext>();\n         for(VolumeBean volumeBean: volumes){\n@@ -1450,6 +1502,11 @@ private static SubscribableInfoContext convertSubscribableInfo(SubscribableInfo\n \n \n     private static DependencyContext convertDependencyDefinitionsToDependencyContexts(DependencyBean dependencyDefinitions) {\n+    \t\n+    \tif (dependencyDefinitions == null) {\n+\t\t\treturn null;\n+\t\t}\n+    \t\n         DependencyContext dependencyContext = new DependencyContext();\n         dependencyContext.setTerminationBehaviour(dependencyDefinitions.getTerminationBehaviour());\n \n@@ -1470,6 +1527,10 @@ private static DependencyContext convertDependencyDefinitionsToDependencyContext\n \n     private static org.apache.stratos.autoscaler.stub.pojo.GroupContext[]\n     convertGroupDefinitionsToStubGroupContexts(List<GroupReferenceBean> groupDefinitions) {\n+    \t\n+    \tif (groupDefinitions == null) {\n+\t\t\treturn null;\n+\t\t}\n \n         GroupContext[] groupContexts = new GroupContext[groupDefinitions.size()];\n         int i = 0;\n@@ -1498,6 +1559,7 @@ private static DependencyContext convertDependencyDefinitionsToDependencyContext\n \n \n     public static ApplicationInfoBean convertApplicationToApplicationBean(Application application) {\n+    \t\n         if (application == null) {\n             return null;\n         }\n@@ -1513,6 +1575,7 @@ public static ApplicationInfoBean convertApplicationToApplicationBean(Applicatio\n     }\n \n     public static ApplicationInfoBean convertApplicationToApplicationInstanceBean(Application application) {\n+    \t\n         if (application == null) {\n             return null;\n         }\n@@ -1531,6 +1594,11 @@ public static ApplicationInfoBean convertApplicationToApplicationInstanceBean(Ap\n \n     private static List<ApplicationInstanceBean> convertApplicationInstancesToApplicationInstances(\n             Application application) {\n+    \t\n+    \tif (application == null) {\n+\t\t\treturn null;\n+\t\t}\n+    \t\n         List<ApplicationInstanceBean> applicationInstanceList = new ArrayList<ApplicationInstanceBean>();\n         Collection<ApplicationInstance> applicationInstancesInTopology =\n                 application.getInstanceIdToInstanceContextMap().values();\n@@ -1588,6 +1656,11 @@ public static ApplicationInfoBean convertApplicationToApplicationInstanceBean(Ap\n     }\n \n     private static List<InstanceBean> convertGroupInstancesToInstances(Group group) {\n+    \t\n+    \tif (group == null) {\n+\t\t\treturn null;\n+\t\t}\n+    \t\n         List<InstanceBean> instanceList = new ArrayList<InstanceBean>();\n         Collection<GroupInstance> instancesInTopology = group.getInstanceIdToInstanceContextMap().values();\n         if (instancesInTopology != null) {\n@@ -1648,8 +1721,12 @@ public static TenantInfoBean convertTenantInfoBeanToCarbonTenantInfoBean(\n \n     public static ServiceGroup convertServiceGroupDefinitionToASStubServiceGroup(GroupBean serviceGroupDefinition)\n             throws ServiceGroupDefinitionException {\n+    \t\n+    \tif (serviceGroupDefinition == null) {\n+\t\t\treturn null;\n+\t\t}\n+    \t\n         ServiceGroup servicegroup = new ServiceGroup();\n-\n         // implement conversion (mostly List -> Array)\n         servicegroup.setGroupscalingEnabled(serviceGroupDefinition.isGroupScalingEnabled());\n         List<GroupBean> groupsDef = serviceGroupDefinition.getGroups();\n@@ -1770,6 +1847,10 @@ private static void validateTerminationBehavior(String terminationBehavior) thro\n     }\n \n     public static ApplicationSignUp convertApplicationSignUpBeanToStubApplicationSignUp(ApplicationSignUpBean applicationSignUpBean) {\n+    \t\n+    \tif (applicationSignUpBean == null) {\n+\t\t\treturn null;\n+\t\t}\n         ApplicationSignUp applicationSignUp = new ApplicationSignUp();\n \n         if (applicationSignUpBean.getArtifactRepositories() != null) {\n@@ -1793,6 +1874,10 @@ public static ApplicationSignUp convertApplicationSignUpBeanToStubApplicationSig\n     }\n \n     public static ApplicationSignUpBean convertStubApplicationSignUpToApplicationSignUpBean(ApplicationSignUp applicationSignUp) {\n+    \t\n+    \tif (applicationSignUp == null) {\n+\t\t\treturn null;\n+\t\t}\n         ApplicationSignUpBean applicationSignUpBean = new ApplicationSignUpBean();\n \n         if (applicationSignUp.getArtifactRepositories() != null) {\n@@ -1816,20 +1901,35 @@ public static ApplicationSignUpBean convertStubApplicationSignUpToApplicationSig\n     }\n \n     public static DomainMapping convertDomainMappingBeanToStubDomainMapping(DomainMappingBean domainMappingBean) {\n+    \t\n+    \tif (domainMappingBean == null) {\n+\t\t\treturn null;\n+\t\t}\n+    \t\n         DomainMapping domainMapping = new DomainMapping();\n         domainMapping.setDomainName(domainMappingBean.getDomainName());\n         domainMapping.setContextPath(domainMappingBean.getContextPath());\n         return domainMapping;\n     }\n \n     public static DomainMappingBean convertStubDomainMappingToDomainMappingBean(DomainMapping domainMapping) {\n+    \t\n+    \tif (domainMapping == null) {\n+\t\t\treturn null;\n+\t\t}\n+    \t\n         DomainMappingBean domainMappingBean = new DomainMappingBean();\n         domainMappingBean.setDomainName(domainMapping.getDomainName());\n         domainMappingBean.setContextPath(domainMapping.getContextPath());\n         return domainMappingBean;\n     }\n \n     public static DeploymentPolicyBean convetCCStubDeploymentPolicytoDeploymentPolicy(DeploymentPolicy deploymentPolicy) {\n+    \t\n+    \tif (deploymentPolicy == null) {\n+\t\t\treturn null;\n+\t\t}\n+    \t\n         DeploymentPolicyBean deploymentPolicyBean = new DeploymentPolicyBean();\n         deploymentPolicyBean.setId(deploymentPolicy.getDeploymentPolicyID());\n         deploymentPolicyBean.setNetworkPartitions(convertCCStubNetwotkPartitionRefsToNetworkPartitionRefs(",
                "deletions": 14
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing an NPE",
        "commit": "https://github.com/apache/attic-stratos/commit/0a5831989810c21bba4d2f44b3c459b681a0a8bc",
        "parent": "https://github.com/apache/attic-stratos/commit/decd0a3a887115101f87806da27b56b86399d6f4",
        "bug_id": "attic-stratos_3",
        "file": [
            {
                "sha": "a3184ea06d4d0dcf04ba86c27c4beb564e2f17e8",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/util/converter/ObjectConverter.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/0a5831989810c21bba4d2f44b3c459b681a0a8bc/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/util/converter/ObjectConverter.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/0a5831989810c21bba4d2f44b3c459b681a0a8bc/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/util/converter/ObjectConverter.java",
                "status": "modified",
                "changes": 8,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/util/converter/ObjectConverter.java?ref=0a5831989810c21bba4d2f44b3c459b681a0a8bc",
                "patch": "@@ -1486,11 +1486,13 @@ private static DependencyContext convertDependencyDefinitionsToDependencyContext\n             if (groupDefinition.getGroups() != null) {\n                 groupContext.setGroupContexts(convertGroupDefinitionsToStubGroupContexts(groupDefinition.getGroups()));\n             }\n-\n-            groupContext.setCartridgeContexts(convertCartridgeReferenceBeansToStubCartridgeContexts(groupDefinition.getCartridges()));\n+            \n+            // Cartridges\n+            if (groupDefinition.getCartridges() != null) {\n+            \tgroupContext.setCartridgeContexts(convertCartridgeReferenceBeansToStubCartridgeContexts(groupDefinition.getCartridges()));\n+\t\t\t}\n             groupContexts[i++] = groupContext;\n         }\n-\n         return groupContexts;\n     }\n ",
                "deletions": 3
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing NPE in ComputeServiceBuilderUtil",
        "commit": "https://github.com/apache/attic-stratos/commit/4862a8b760b0d86a441e9a5621cada697e1ef3ea",
        "parent": "https://github.com/apache/attic-stratos/commit/fcc30c2178df05fb190a69c7af8c43831c534701",
        "bug_id": "attic-stratos_4",
        "file": [
            {
                "sha": "af985b2dddef00731ac0ae83d4a5acfb497d079f",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/util/ComputeServiceBuilderUtil.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/4862a8b760b0d86a441e9a5621cada697e1ef3ea/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/util/ComputeServiceBuilderUtil.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/4862a8b760b0d86a441e9a5621cada697e1ef3ea/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/util/ComputeServiceBuilderUtil.java",
                "status": "modified",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/util/ComputeServiceBuilderUtil.java?ref=4862a8b760b0d86a441e9a5621cada697e1ef3ea",
                "patch": "@@ -94,9 +94,9 @@ public static String extractRegion(IaasProvider iaas) {\n         if ((region = iaas.getProperty(CloudControllerConstants.REGION_PROPERTY)) == null) {\n             // if the property, isn't specified, try to obtain from the image id\n             // image id can be in following format - {region}/{UUID}\n-            region = iaas.getImage().contains(\"/\") ? iaas.getImage().split(\"/\")[0] : null;\n+            region = (iaas.getImage() != null) && (iaas.getImage().contains(\"/\"))\n+                    ? iaas.getImage().split(\"/\")[0] : null;\n         }\n-\n         return region;\n     }\n     ",
                "deletions": 2
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing NPE in PojoConverter",
        "commit": "https://github.com/apache/attic-stratos/commit/82326c1726577171caccc3743bc6d36f68dbae90",
        "parent": "https://github.com/apache/attic-stratos/commit/b1851f6ac9dc36442b53eefdd88ac310ae41bb72",
        "bug_id": "attic-stratos_5",
        "file": [
            {
                "sha": "15cb726712e1ceadfb4192a1bc6011f884678beb",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/ApplicationBean.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/82326c1726577171caccc3743bc6d36f68dbae90/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/ApplicationBean.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/82326c1726577171caccc3743bc6d36f68dbae90/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/ApplicationBean.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/ApplicationBean.java?ref=82326c1726577171caccc3743bc6d36f68dbae90",
                "patch": "@@ -15,7 +15,7 @@\n     private String tenantAdminUsername;\n     public List<GroupBean> groups = null;\n     public List<Cluster> clusters = null;\n-    public List<Instance> instances;\n+    private List<Instance> instances;\n \n \n     public ApplicationBean(){",
                "deletions": 1
            },
            {
                "sha": "7fcc1b26978da6f3a71c440b7eb0429c16c42e48",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/topology/Cluster.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/82326c1726577171caccc3743bc6d36f68dbae90/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/topology/Cluster.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/82326c1726577171caccc3743bc6d36f68dbae90/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/topology/Cluster.java",
                "status": "modified",
                "changes": 14,
                "additions": 11,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/topology/Cluster.java?ref=82326c1726577171caccc3743bc6d36f68dbae90",
                "patch": "@@ -40,11 +40,19 @@\n \n     public boolean isLbCluster;\n \n-    public List<Instance> instances;\n-    \n     public List<PropertyBean> property;\n \n-    @Override\n+    private List<Instance> instances;    \n+    \n+    public List<Instance> getInstances() {\n+\t\treturn instances;\n+\t}\n+\n+\tpublic void setInstances(List<Instance> instances) {\n+\t\tthis.instances = instances;\n+\t}\n+\n+\t@Override\n     public String toString() {\n         return \"Cluster [serviceName=\" + serviceName + \", clusterId=\" + clusterId + \", member=\" + member\n                 + \", tenantRange=\" + tenantRange + \", hostNames=\" + hostNames + \", isLbCluster=\" + isLbCluster",
                "deletions": 3
            },
            {
                "sha": "5064a0e56ca5b077aa12e3679147a23f3968e791",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/util/converter/PojoConverter.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/82326c1726577171caccc3743bc6d36f68dbae90/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/util/converter/PojoConverter.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/82326c1726577171caccc3743bc6d36f68dbae90/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/util/converter/PojoConverter.java",
                "status": "modified",
                "changes": 5,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/util/converter/PojoConverter.java?ref=82326c1726577171caccc3743bc6d36f68dbae90",
                "patch": "@@ -489,14 +489,17 @@ private static FloatingNetworks getFloatingNetworks(List<FloatingNetworkBean> fl\n         cluster1.member = new ArrayList<Member>();\n         cluster1.hostNames = new ArrayList<String>();\n         Collection<ClusterInstance> clusterInstances = cluster.getClusterInstances();\n+        List<org.apache.stratos.rest.endpoint.bean.topology.Instance> instancesList = \n+        \t\tnew ArrayList<org.apache.stratos.rest.endpoint.bean.topology.Instance>();\n \t\tif (clusterInstances != null) {\n \t\t\tfor (ClusterInstance clusterInstance : clusterInstances) {\n \t\t\t\torg.apache.stratos.rest.endpoint.bean.topology.Instance instance = \n \t\t\t\t\t\tnew org.apache.stratos.rest.endpoint.bean.topology.Instance();\n \t\t\t\tinstance.instanceId = clusterInstance.getInstanceId();\n \t\t\t\tinstance.status = clusterInstance.getStatus().toString();\n-\t\t\t\tcluster1.instances.add(instance);\n+\t\t\t\tinstancesList.add(instance);\n \t\t\t}\n+\t\t\tcluster1.setInstances(instancesList);\n \t\t}\n \n         for (org.apache.stratos.messaging.domain.topology.Member tmp : cluster.getMembers()) {",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing a NPE",
        "commit": "https://github.com/apache/attic-stratos/commit/fc76103b927f9ccfd56113fae55a08c72394a021",
        "parent": "https://github.com/apache/attic-stratos/commit/b1a745ce4e6ba18413eb39d4000656ecd54dd60e",
        "bug_id": "attic-stratos_6",
        "file": [
            {
                "sha": "64d1704a04326085bb1c6661ab11c0b146eea76f",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/domain/instance/context/ApplicationInstanceContext.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/fc76103b927f9ccfd56113fae55a08c72394a021/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/domain/instance/context/ApplicationInstanceContext.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/fc76103b927f9ccfd56113fae55a08c72394a021/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/domain/instance/context/ApplicationInstanceContext.java",
                "status": "modified",
                "changes": 2,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/domain/instance/context/ApplicationInstanceContext.java?ref=fc76103b927f9ccfd56113fae55a08c72394a021",
                "patch": "@@ -29,6 +29,8 @@\n \n     public ApplicationInstanceContext(String alias, String instanceId) {\n         super(alias, instanceId);\n+        this.lifeCycleStateManager = new LifeCycleStateManager<ApplicationStatus>(ApplicationStatus.Created,\n+                alias + \"_\" + instanceId);\n     }\n \n     @Override",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "handling a NPE",
        "commit": "https://github.com/apache/attic-stratos/commit/baa307d40f5f5e92193bd7e224d9572f52e156ae",
        "parent": "https://github.com/apache/attic-stratos/commit/d1897ebd563427610439bc0a5979449a45317f03",
        "bug_id": "attic-stratos_7",
        "file": [
            {
                "sha": "d14b8f142cbe213ba272118705281024f233a42e",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/baa307d40f5f5e92193bd7e224d9572f52e156ae/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/baa307d40f5f5e92193bd7e224d9572f52e156ae/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "status": "modified",
                "changes": 6,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java?ref=baa307d40f5f5e92193bd7e224d9572f52e156ae",
                "patch": "@@ -309,8 +309,10 @@ protected void onEvent(Event event) {\n                                                 + \"[cluster] %s\", clusterId));\n                     }\n                     // if the cluster monitor is null, assume that its termianted\n-                    AutoscalerContext.getInstance().getAppMonitor(clusterTerminatedEvent.getAppId()).\n-                            onChildEvent(new ClusterStatusEvent(ClusterStatus.Terminated, clusterId));\n+                    ApplicationMonitor appMonitor = AutoscalerContext.getInstance().getAppMonitor(clusterTerminatedEvent.getAppId());\n+                    if (appMonitor != null)  {\n+                        appMonitor.onChildEvent(new ClusterStatusEvent(ClusterStatus.Terminated, clusterId));\n+                    }\n                     return;\n                 }\n                 //changing the status in the monitor, will notify its parent monitor",
                "deletions": 2
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing an NPE in AS",
        "commit": "https://github.com/apache/attic-stratos/commit/01dd9e491ad3acf7cc4e0f2895aaba336b82539d",
        "parent": "https://github.com/apache/attic-stratos/commit/9991ffbdba67308ba1ec62fe6cc9d5c0294e9913",
        "bug_id": "attic-stratos_8",
        "file": [
            {
                "sha": "657725f2bd1daaf55362df3d95328372b6fb4c7b",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/services/impl/AutoscalerServiceImpl.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/01dd9e491ad3acf7cc4e0f2895aaba336b82539d/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/services/impl/AutoscalerServiceImpl.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/01dd9e491ad3acf7cc4e0f2895aaba336b82539d/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/services/impl/AutoscalerServiceImpl.java",
                "status": "modified",
                "changes": 5,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/services/impl/AutoscalerServiceImpl.java?ref=01dd9e491ad3acf7cc4e0f2895aaba336b82539d",
                "patch": "@@ -353,6 +353,11 @@ private void encryptRepositoryPasswords(ApplicationSignUp applicationSignUp, Str\n     }\n \n     private void updateArtifactRepositoryList(List<ArtifactRepository> artifactRepositoryList, CartridgeContext[] cartridgeContexts) {\n+    \t\n+    \tif (cartridgeContexts == null) {\n+\t\t\treturn;\n+\t\t}\n+    \t\n         for(CartridgeContext cartridgeContext : cartridgeContexts) {\n             SubscribableInfoContext subscribableInfoContext = cartridgeContext.getSubscribableInfoContext();\n             ArtifactRepositoryContext artifactRepositoryContext = subscribableInfoContext.getArtifactRepositoryContext();",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing NPE",
        "commit": "https://github.com/apache/attic-stratos/commit/1d3189f6035a4cf67e5a8bf2a58f244d5a07b096",
        "parent": "https://github.com/apache/attic-stratos/commit/a05094255e9e43cfcb534ebb8b591e25aca7ab57",
        "bug_id": "attic-stratos_9",
        "file": [
            {
                "sha": "5118185d8777d0ac182fb22f83f47e5a9c1a382b",
                "filename": "components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/manager/CartridgeSubscriptionManager.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/1d3189f6035a4cf67e5a8bf2a58f244d5a07b096/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/manager/CartridgeSubscriptionManager.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/1d3189f6035a4cf67e5a8bf2a58f244d5a07b096/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/manager/CartridgeSubscriptionManager.java",
                "status": "modified",
                "changes": 15,
                "additions": 10,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/manager/CartridgeSubscriptionManager.java?ref=1d3189f6035a4cf67e5a8bf2a58f244d5a07b096",
                "patch": "@@ -125,11 +125,16 @@ public CartridgeSubscription subscribeToCartridgeWithProperties(String cartridge\n             if (props != null) {\n                 // TODO: temp fix, need to do a proper fix\n                 Property[] cartridgeInfoProperties = cartridgeInfo.getProperties();\n-                int length = cartridgeInfoProperties.length + props.length;\n-                Property[] combined = new Property[length];\n-                System.arraycopy(cartridgeInfoProperties, 0, combined, 0, cartridgeInfoProperties.length);\n-                System.arraycopy(props, 0, combined, cartridgeInfoProperties.length, props.length);\n-                cartridgeInfo.setProperties(combined);\n+                if(cartridgeInfoProperties != null) {\n+                     int length = cartridgeInfoProperties.length + props.length;\n+                    Property[] combined = new Property[length];\n+                    System.arraycopy(cartridgeInfoProperties, 0, combined, 0, cartridgeInfoProperties.length);\n+                    System.arraycopy(props, 0, combined, cartridgeInfoProperties.length, props.length);\n+                    cartridgeInfo.setProperties(combined);\n+                } else {\n+                    cartridgeInfo.setProperties(props);\n+                }\n+\n             }\n \n         } catch (UnregisteredCartridgeException e) {",
                "deletions": 5
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "handling a NPE.",
        "commit": "https://github.com/apache/attic-stratos/commit/90b78364f8aedf4a6df75693191eb6b79989aedb",
        "parent": "https://github.com/apache/attic-stratos/commit/d6022955b22c9309507a114402c717d1b6d0a136",
        "bug_id": "attic-stratos_10",
        "file": [
            {
                "sha": "0976eb0b7357e26e34e37b468d35c859d9cfd698",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/pojo/KubernetesClusterContext.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/90b78364f8aedf4a6df75693191eb6b79989aedb/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/pojo/KubernetesClusterContext.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/90b78364f8aedf4a6df75693191eb6b79989aedb/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/pojo/KubernetesClusterContext.java",
                "status": "modified",
                "changes": 3,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/pojo/KubernetesClusterContext.java?ref=90b78364f8aedf4a6df75693191eb6b79989aedb",
                "patch": "@@ -132,6 +132,9 @@ public void setMasterIp(String masterIp) {\n \t}\n \n \tpublic KubernetesApiClient getKubApi() {\n+\t\tif (kubApi == null) {\n+\t\t\tkubApi = new KubernetesApiClient(getEndpoint(masterIp));\n+\t\t}\n \t\treturn kubApi;\n \t}\n ",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing a NPE",
        "commit": "https://github.com/apache/attic-stratos/commit/2472f2ab0f060a37239b205a7722907a14534205",
        "parent": "https://github.com/apache/attic-stratos/commit/448c13e31fedeadd9635a219ae2eeeafb125da1d",
        "bug_id": "attic-stratos_11",
        "file": [
            {
                "sha": "527dfab81c1472e5a9444e13280e60e20da8f671",
                "filename": "components/org.apache.stratos.metadata.client/src/main/java/org/apache/stratos/metadata/client/MetaDataServiceClientManager.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/2472f2ab0f060a37239b205a7722907a14534205/components/org.apache.stratos.metadata.client/src/main/java/org/apache/stratos/metadata/client/MetaDataServiceClientManager.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/2472f2ab0f060a37239b205a7722907a14534205/components/org.apache.stratos.metadata.client/src/main/java/org/apache/stratos/metadata/client/MetaDataServiceClientManager.java",
                "status": "modified",
                "changes": 3,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.metadata.client/src/main/java/org/apache/stratos/metadata/client/MetaDataServiceClientManager.java?ref=2472f2ab0f060a37239b205a7722907a14534205",
                "patch": "@@ -46,7 +46,6 @@ public MetaDataServiceClientManager () {\n \n         readConfigurations();\n         init();\n-        this.metaDataServiceClient = new DefaultMetaDataServiceClient(baseUrl);\n     }\n \n     private void readConfigurations () {\n@@ -55,10 +54,12 @@ private void readConfigurations () {\n \n     private void init () {\n \n+        metaDataServiceClient = new DefaultMetaDataServiceClient(baseUrl);\n         metaDataServiceClient.initialize();\n         //TODO:  load the relevant customized class\n         // currently only the default DataExtractor is used\n         dataExtractor = new DefaultDataExtractor();\n+        dataExtractor.initialize();\n     }\n \n     public void addExtractedData () {",
                "deletions": 1
            },
            {
                "sha": "a79237c038199ca9ba738626bbc6e9a8c6e79f0e",
                "filename": "components/org.apache.stratos.metadata.client/src/main/java/org/apache/stratos/metadata/client/data/extractor/DataExtractor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/2472f2ab0f060a37239b205a7722907a14534205/components/org.apache.stratos.metadata.client/src/main/java/org/apache/stratos/metadata/client/data/extractor/DataExtractor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/2472f2ab0f060a37239b205a7722907a14534205/components/org.apache.stratos.metadata.client/src/main/java/org/apache/stratos/metadata/client/data/extractor/DataExtractor.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.metadata.client/src/main/java/org/apache/stratos/metadata/client/data/extractor/DataExtractor.java?ref=2472f2ab0f060a37239b205a7722907a14534205",
                "patch": "@@ -26,7 +26,7 @@\n \n public interface DataExtractor {\n \n-    public void initialize () throws DataExtractorException;\n+    public void initialize ();\n \n     public Collection<DataContext> getData () throws DataExtractorException;\n ",
                "deletions": 1
            },
            {
                "sha": "b84c9c7670288ee3e797f9f14c8c9183f4ca7328",
                "filename": "components/org.apache.stratos.metadata.client/src/main/java/org/apache/stratos/metadata/client/data/extractor/DefaultDataExtractor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/2472f2ab0f060a37239b205a7722907a14534205/components/org.apache.stratos.metadata.client/src/main/java/org/apache/stratos/metadata/client/data/extractor/DefaultDataExtractor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/2472f2ab0f060a37239b205a7722907a14534205/components/org.apache.stratos.metadata.client/src/main/java/org/apache/stratos/metadata/client/data/extractor/DefaultDataExtractor.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.metadata.client/src/main/java/org/apache/stratos/metadata/client/data/extractor/DefaultDataExtractor.java?ref=2472f2ab0f060a37239b205a7722907a14534205",
                "patch": "@@ -26,7 +26,7 @@\n \n public class DefaultDataExtractor implements DataExtractor {\n \n-    public void initialize() throws DataExtractorException {\n+    public void initialize() {\n         //To change body of implemented methods use File | Settings | File Templates.\n     }\n ",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing a NPE",
        "commit": "https://github.com/apache/attic-stratos/commit/30eb2ac6e711bf553e67495940a29589b0fbed49",
        "parent": "https://github.com/apache/attic-stratos/commit/0f1062431bd7526dabf4dd49f27320b45b139ab5",
        "bug_id": "attic-stratos_12",
        "file": [
            {
                "sha": "2f8be044e64e400ab497d73182b5ff6b6ab8c33f",
                "filename": "components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/manager/CartridgeSubscriptionManager.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/30eb2ac6e711bf553e67495940a29589b0fbed49/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/manager/CartridgeSubscriptionManager.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/30eb2ac6e711bf553e67495940a29589b0fbed49/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/manager/CartridgeSubscriptionManager.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/manager/CartridgeSubscriptionManager.java?ref=30eb2ac6e711bf553e67495940a29589b0fbed49",
                "patch": "@@ -131,7 +131,7 @@ public static SubscriptionInfo subscribeToCartridgeWithProperties(SubscriptionDa\n         }\n \n         // add properties returned by filters\n-\t\tif (propertiesReturnedByFilters != null && propertiesReturnedByFilters.getProperties().length > 0) {\n+\t\tif (propertiesReturnedByFilters != null && propertiesReturnedByFilters.getProperties() != null && propertiesReturnedByFilters.getProperties().length > 0) {\n \t\t\tfor (Property prop : propertiesReturnedByFilters.getProperties()) {\n \n \t\t\t\tserviceCartridgeSubscriptionProperties.addProperties(prop);",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing a NPE",
        "commit": "https://github.com/apache/attic-stratos/commit/6971e1a504442d681eb7343e4793d8e11ce1347d",
        "parent": "https://github.com/apache/attic-stratos/commit/c2ee6827b898707c7bcbde6e8cdc77da8e064448",
        "bug_id": "attic-stratos_13",
        "file": [
            {
                "sha": "a49a1c0ee3771938d2e66345c2024268d006f99e",
                "filename": "components/org.apache.stratos.cartridge.agent/src/main/java/org/apache/stratos/cartridge/agent/config/CartridgeAgentConfiguration.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/6971e1a504442d681eb7343e4793d8e11ce1347d/components/org.apache.stratos.cartridge.agent/src/main/java/org/apache/stratos/cartridge/agent/config/CartridgeAgentConfiguration.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/6971e1a504442d681eb7343e4793d8e11ce1347d/components/org.apache.stratos.cartridge.agent/src/main/java/org/apache/stratos/cartridge/agent/config/CartridgeAgentConfiguration.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cartridge.agent/src/main/java/org/apache/stratos/cartridge/agent/config/CartridgeAgentConfiguration.java?ref=6971e1a504442d681eb7343e4793d8e11ce1347d",
                "patch": "@@ -233,7 +233,7 @@ private boolean readInternalRepo(String internalRepo) {\n             log.info(\" INTERNAL payload parameter is not found\");\n         }\n \n-        if(internalRepoStringValue.equals(CartridgeAgentConstants.INTERNAL)) {\n+        if(internalRepoStringValue != null && internalRepoStringValue.equals(CartridgeAgentConstants.INTERNAL)) {\n             return true;\n         } else{\n             return false;",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing NPE in application parser",
        "commit": "https://github.com/apache/attic-stratos/commit/719f0f040e97e0d7cc545d54294b17134c88728b",
        "parent": "https://github.com/apache/attic-stratos/commit/074316caa59ced4c139192e4d2e0c40d5ba34b26",
        "bug_id": "attic-stratos_14",
        "file": [
            {
                "sha": "90bbd3e65273ae9932b1e6b5b4b2cb7bb3db2739",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/719f0f040e97e0d7cc545d54294b17134c88728b/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/719f0f040e97e0d7cc545d54294b17134c88728b/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java",
                "status": "modified",
                "changes": 22,
                "additions": 12,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java?ref=719f0f040e97e0d7cc545d54294b17134c88728b",
                "patch": "@@ -340,16 +340,18 @@ private Application buildCompositeAppStructure (ApplicationContext appCtxt,\n \t\t     clusterDataMap.put(subscriptionAlias, clusterDataHolder);\n \n \t\t     //Get dependency cluster id\n-\t\t     for (StartupOrder startupOrder : dependencyOrder) {\n-\t\t\t     for (String startupOrderComponent : startupOrder.getStartupOrderComponentList()) {\n-\t\t\t\t     ClusterDataHolder dataHolder = clusterDataMap.get(startupOrderComponent.split(\"\\\\.\")[1]);\n-\t\t\t\t     dependencyClusterIDs.add(dataHolder.getClusterId());\n-\t\t\t\t     if (startupOrderComponent.equals(\"cartridge.\".concat(subscriptionAlias))) {\n-\t\t\t\t\t     break;\n-\t\t\t\t     }\n-\t\t\t     }\n-\n-\t\t     }\n+\t\t     if (dependencyOrder != null) {\n+\t\t    \t for (StartupOrder startupOrder : dependencyOrder) {\n+\t\t    \t\t for (String startupOrderComponent : startupOrder.getStartupOrderComponentList()) {\n+\t\t    \t\t\t ClusterDataHolder dataHolder = clusterDataMap.get(startupOrderComponent.split(\"\\\\.\")[1]);\n+\t\t    \t\t\t dependencyClusterIDs.add(dataHolder.getClusterId());\n+\t\t    \t\t\t if (startupOrderComponent.equals(\"cartridge.\".concat(subscriptionAlias))) {\n+\t\t    \t\t\t\t break;\n+\t\t    \t\t\t }\n+\t\t    \t\t }\n+\t\t    \t\t \n+\t\t    \t }\n+\t\t\t}\n \t\t     String[] arrDependencyClusterIDs = new String[dependencyClusterIDs.size()];\n \t\t     arrDependencyClusterIDs = dependencyClusterIDs.toArray(arrDependencyClusterIDs);\n ",
                "deletions": 10
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing NPE while undeploying application",
        "commit": "https://github.com/apache/attic-stratos/commit/e8df5e52229501f8f8722aec144f3d8b03f4aef2",
        "parent": "https://github.com/apache/attic-stratos/commit/c028eaa4c44cf2adc76c690b9fe0ba37508535a9",
        "bug_id": "attic-stratos_15",
        "file": [
            {
                "sha": "75e53f5756a8e61fb34c4017e0704563e14d82b0",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/api/AutoScalerServiceImpl.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/e8df5e52229501f8f8722aec144f3d8b03f4aef2/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/api/AutoScalerServiceImpl.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/e8df5e52229501f8f8722aec144f3d8b03f4aef2/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/api/AutoScalerServiceImpl.java",
                "status": "modified",
                "changes": 12,
                "additions": 12,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/api/AutoScalerServiceImpl.java?ref=e8df5e52229501f8f8722aec144f3d8b03f4aef2",
                "patch": "@@ -291,6 +291,18 @@ public void undeployApplication(String applicationId) {\n                 log.info(\"Starting to undeploy application: [application-id] \" + applicationId);\n             }\n \n+            ApplicationContext application = AutoscalerContext.getInstance().getApplicationContext(applicationId);\n+            if ( application == null){\n+                String msg = String.format(\"Application not found : [application-id] %s\", applicationId);\n+                throw new RuntimeException(msg);\n+            }\n+\n+            if (!application.getStatus().equals(ApplicationContext.STATUS_DEPLOYED)) {\n+                String message = String.format(\"Application is not deployed: [application-id] %s\", applicationId);\n+                log.error(message);\n+                throw new RuntimeException(message);\n+            }\n+\n             ApplicationBuilder.handleApplicationUndeployed(applicationId);\n \n             ApplicationContext applicationContext = AutoscalerContext.getInstance().getApplicationContext(applicationId);",
                "deletions": 0
            },
            {
                "sha": "10c146b3060ebcb1048c32d02a57461a6c15afe1",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/e8df5e52229501f8f8722aec144f3d8b03f4aef2/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/e8df5e52229501f8f8722aec144f3d8b03f4aef2/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java",
                "status": "modified",
                "changes": 12,
                "additions": 12,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java?ref=e8df5e52229501f8f8722aec144f3d8b03f4aef2",
                "patch": "@@ -959,6 +959,18 @@ public static void undeployApplication(String applicationId) throws RestAPIExcep\n         AutoscalerServiceClient autoscalerServiceClient = getAutoscalerServiceClient();\n         if (autoscalerServiceClient != null) {\n             try {\n+                ApplicationContext application = autoscalerServiceClient.getApplication(applicationId);\n+                if(application == null) {\n+                    String message = String.format(\"Application is not found: [application-id] %s\", applicationId);\n+                    log.error(message);\n+                    throw new RestAPIException(message);\n+                }\n+                if (!application.getStatus().equals(APPLICATION_STATUS_DEPLOYED)) {\n+                    String message = String.format(\"Application is not deployed: [application-id] %s\", applicationId);\n+                    log.error(message);\n+                    throw new RestAPIException(message);\n+                }\n+\n                 autoscalerServiceClient.undeployApplication(applicationId);\n             } catch (RemoteException e) {\n                 String message = \"Could not undeploy application: [application-id] \" + applicationId;",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing NPE at instance termination",
        "commit": "https://github.com/apache/attic-stratos/commit/24f7f122f2b392a98306151a62b73bd0685d5fb9",
        "parent": "https://github.com/apache/attic-stratos/commit/c6f2dc31b2ddb2cdf285370b2e023ee46f243fe7",
        "bug_id": "attic-stratos_16",
        "file": [
            {
                "sha": "f8870b62cc52daf7fc56c9878a5fd99ef3671a4c",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/IaasProvider.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/24f7f122f2b392a98306151a62b73bd0685d5fb9/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/IaasProvider.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/24f7f122f2b392a98306151a62b73bd0685d5fb9/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/IaasProvider.java",
                "status": "modified",
                "changes": 1,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/IaasProvider.java?ref=24f7f122f2b392a98306151a62b73bd0685d5fb9",
                "patch": "@@ -88,6 +88,7 @@ public IaasProvider(IaasProvider anIaasProvider){\n     \tthis.type = anIaasProvider.getType();\n     \tthis.name = anIaasProvider.getName();\n     \tthis.className = anIaasProvider.getClassName();\n+    \tthis.computeService = anIaasProvider.getComputeService();\n     \tthis.properties = new HashMap<String,String>(anIaasProvider.getProperties());\n     \tthis.networkInterfaces = anIaasProvider.getNetworkInterfaces();\n     \tthis.image = anIaasProvider.getImage();",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing NPE while instance creation",
        "commit": "https://github.com/apache/attic-stratos/commit/b59adf8f90f73cf69a016f11e1cd4e9c81c0572d",
        "parent": "https://github.com/apache/attic-stratos/commit/95dd15426542dfc114afc39c87f26542e6311808",
        "bug_id": "attic-stratos_17",
        "file": [
            {
                "sha": "773352014fd69b721394a86228ca433fabe51a1f",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/api/AutoScalerServiceImpl.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/b59adf8f90f73cf69a016f11e1cd4e9c81c0572d/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/api/AutoScalerServiceImpl.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/b59adf8f90f73cf69a016f11e1cd4e9c81c0572d/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/api/AutoScalerServiceImpl.java",
                "status": "modified",
                "changes": 21,
                "additions": 11,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/api/AutoScalerServiceImpl.java?ref=b59adf8f90f73cf69a016f11e1cd4e9c81c0572d",
                "patch": "@@ -22,28 +22,27 @@\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.stratos.autoscaler.applications.ApplicationHolder;\n-import org.apache.stratos.autoscaler.context.AutoscalerContext;\n-//import org.apache.stratos.autoscaler.NetworkPartitionLbHolder;\n import org.apache.stratos.autoscaler.applications.parser.ApplicationParser;\n import org.apache.stratos.autoscaler.applications.parser.DefaultApplicationParser;\n import org.apache.stratos.autoscaler.applications.pojo.ApplicationContext;\n import org.apache.stratos.autoscaler.applications.topic.ApplicationBuilder;\n import org.apache.stratos.autoscaler.client.CloudControllerClient;\n-import org.apache.stratos.autoscaler.exception.*;\n+import org.apache.stratos.autoscaler.context.AutoscalerContext;\n+import org.apache.stratos.autoscaler.exception.AutoScalerException;\n+import org.apache.stratos.autoscaler.exception.InvalidArgumentException;\n import org.apache.stratos.autoscaler.exception.application.ApplicationDefinitionException;\n import org.apache.stratos.autoscaler.exception.kubernetes.*;\n import org.apache.stratos.autoscaler.exception.partition.PartitionValidationException;\n import org.apache.stratos.autoscaler.exception.policy.InvalidPolicyException;\n import org.apache.stratos.autoscaler.interfaces.AutoScalerServiceInterface;\n import org.apache.stratos.autoscaler.kubernetes.KubernetesManager;\n import org.apache.stratos.autoscaler.monitor.cluster.AbstractClusterMonitor;\n-import org.apache.stratos.autoscaler.pojo.policy.deployment.partition.network.ApplicationLevelNetworkPartition;\n-//import org.apache.stratos.autoscaler.pojo.policy.deployment.partition.PartitionManager;\n import org.apache.stratos.autoscaler.pojo.Dependencies;\n import org.apache.stratos.autoscaler.pojo.ServiceGroup;\n import org.apache.stratos.autoscaler.pojo.policy.PolicyManager;\n import org.apache.stratos.autoscaler.pojo.policy.autoscale.AutoscalePolicy;\n import org.apache.stratos.autoscaler.pojo.policy.deployment.DeploymentPolicy;\n+import org.apache.stratos.autoscaler.pojo.policy.deployment.partition.network.ApplicationLevelNetworkPartition;\n import org.apache.stratos.autoscaler.pojo.policy.deployment.partition.network.Partition;\n import org.apache.stratos.autoscaler.registry.RegistryManager;\n import org.apache.stratos.autoscaler.util.AutoscalerUtil;\n@@ -53,7 +52,6 @@\n import org.apache.stratos.common.kubernetes.KubernetesHost;\n import org.apache.stratos.common.kubernetes.KubernetesMaster;\n import org.apache.stratos.messaging.domain.applications.Application;\n-import org.apache.stratos.messaging.message.receiver.topology.TopologyManager;\n import org.apache.stratos.metadata.client.defaults.DefaultMetaDataServiceClient;\n import org.apache.stratos.metadata.client.defaults.MetaDataServiceClient;\n import org.apache.stratos.metadata.client.exception.MetaDataServiceClientException;\n@@ -63,13 +61,16 @@\n import java.util.ArrayList;\n import java.util.Map;\n \n+//import org.apache.stratos.autoscaler.NetworkPartitionLbHolder;\n+//import org.apache.stratos.autoscaler.pojo.policy.deployment.partition.PartitionManager;\n+\n /**\n  * Auto Scaler Service API is responsible getting Partitions and Policies.\n  */\n public class AutoScalerServiceImpl implements AutoScalerServiceInterface {\n \n     private static final Log log = LogFactory.getLog(AutoScalerServiceImpl.class);\n-//    PartitionManager partitionManager = PartitionManager.getInstance();\n+    //    PartitionManager partitionManager = PartitionManager.getInstance();\n     KubernetesManager kubernetesManager = KubernetesManager.getInstance();\n //\n //    public Partition[] getAllAvailablePartitions() {\n@@ -122,15 +123,15 @@ public String addDeploymentPolicy(DeploymentPolicy deploymentPolicy) throws Inva\n         try {\n             Application application = ApplicationHolder.getApplications().\n                     getApplication(deploymentPolicy.getApplicationId());\n-            if(application != null) {\n+            if (application != null) {\n \n                 allClusterInitialized = AutoscalerUtil.allClustersInitialized(application);\n             }\n         } finally {\n             ApplicationHolder.releaseReadLock();\n         }\n \n-        if(allClusterInitialized && !AutoscalerContext.getInstance().containsPendingMonitor(appId)) {\n+        if (allClusterInitialized && !AutoscalerContext.getInstance().containsPendingMonitor(appId)) {\n             AutoscalerUtil.getInstance().\n                     startApplicationMonitor(appId);\n \n@@ -244,7 +245,7 @@ public boolean updateKubernetesHost(KubernetesHost kubernetesHost) throws\n         return kubernetesManager.updateKubernetesHost(kubernetesHost);\n     }\n \n-//    @Override\n+    //    @Override\n     public Partition[] getPartitionsOfGroup(String deploymentPolicyId, String groupId) {\n         DeploymentPolicy depPol = this.getDeploymentPolicy(deploymentPolicyId);\n         if (null == depPol) {",
                "deletions": 10
            },
            {
                "sha": "6251d1880212ea0e67bc1d4d2925d6eab8ff9eee",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/b59adf8f90f73cf69a016f11e1cd4e9c81c0572d/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/b59adf8f90f73cf69a016f11e1cd4e9c81c0572d/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "status": "modified",
                "changes": 10,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java?ref=b59adf8f90f73cf69a016f11e1cd4e9c81c0572d",
                "patch": "@@ -23,6 +23,7 @@\n import org.apache.commons.logging.LogFactory;\n import org.apache.stratos.autoscaler.applications.ApplicationHolder;\n import org.apache.stratos.autoscaler.context.AutoscalerContext;\n+import org.apache.stratos.autoscaler.context.cluster.AbstractClusterContext;\n import org.apache.stratos.autoscaler.context.cluster.ClusterContextFactory;\n import org.apache.stratos.autoscaler.context.cluster.VMClusterContext;\n import org.apache.stratos.autoscaler.event.publisher.ClusterStatusEventPublisher;\n@@ -441,10 +442,11 @@ protected void onEvent(Event event) {\n                                        VMClusterContext clusterContext =\n                                                (VMClusterContext) clusterMonitor.getClusterContext();\n                                        if (clusterContext == null) {\n-                                           clusterMonitor.setClusterContext(\n-                                                   ClusterContextFactory.\n-                                                           getVMClusterContext(instanceId,\n-                                                                   cluster));\n+                                           clusterContext = ClusterContextFactory.\n+                                                   getVMClusterContext(instanceId,\n+                                                           cluster);\n+                                           clusterMonitor.setClusterContext(clusterContext);\n+\n                                        }\n                                        clusterContext.addInstanceContext(instanceId, cluster);\n                                        if(clusterMonitor.getInstance(instanceId) == null) {",
                "deletions": 4
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing a NPE in AutoscalerRuleEvaluator",
        "commit": "https://github.com/apache/attic-stratos/commit/2bda499801cf41893e7a711e11d222ed5cec2817",
        "parent": "https://github.com/apache/attic-stratos/commit/ef6cefd30e8740ce51bd474278152b83b1970ea5",
        "bug_id": "attic-stratos_18",
        "file": [
            {
                "sha": "0cac9f25f5417e82678c2875e312eb4f4722cb93",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/AbstractClusterMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/2bda499801cf41893e7a711e11d222ed5cec2817/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/AbstractClusterMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/2bda499801cf41893e7a711e11d222ed5cec2817/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/AbstractClusterMonitor.java",
                "status": "modified",
                "changes": 1,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/AbstractClusterMonitor.java?ref=2bda499801cf41893e7a711e11d222ed5cec2817",
                "patch": "@@ -92,6 +92,7 @@ protected AbstractClusterMonitor(String clusterId, String serviceId,\n         this.clusterId = clusterId;\n         this.serviceId = serviceId;\n         this.autoscalerRuleEvaluator = autoscalerRuleEvaluator;\n+        this.obsoleteCheckKnowledgeSession = autoscalerRuleEvaluator.getObsoleteCheckStatefulSession();\n         this.scaleCheckKnowledgeSession = autoscalerRuleEvaluator.getScaleCheckStatefulSession();\n         this.minCheckKnowledgeSession = autoscalerRuleEvaluator.getMinCheckStatefulSession();\n         this.status = ClusterStatus.Created;",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing NPE and properties issue",
        "commit": "https://github.com/apache/attic-stratos/commit/38ea793fc598dc7c674537e823db39b1d7bf0518",
        "parent": "https://github.com/apache/attic-stratos/commit/736ab44e15947c485d9433f91f3741432f04d70d",
        "bug_id": "attic-stratos_19",
        "file": [
            {
                "sha": "9af36ff02914f6d039329ccf36b470e8e37571d2",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/38ea793fc598dc7c674537e823db39b1d7bf0518/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/38ea793fc598dc7c674537e823db39b1d7bf0518/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java",
                "status": "modified",
                "changes": 9,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java?ref=38ea793fc598dc7c674537e823db39b1d7bf0518",
                "patch": "@@ -331,9 +331,12 @@ private Application buildCompositeAppStructure (ApplicationContext appCtxt,\n                 //properties.addProperties(property);\n                 propertyList.add(property);\n             }\n-            Property[] properties1 = new Property[propertyList.size()];\n-            properties.setProperties(propertyList.toArray(properties1));\n-            this.addProperties(alias, properties);\n+            if(propertyList.size() > 0 ) {\n+                Property[] properties1 = new Property[propertyList.size()];\n+                properties.setProperties(propertyList.toArray(properties1));\n+                this.addProperties(alias, properties);\n+            }\n+\n         }\n \n ",
                "deletions": 3
            },
            {
                "sha": "461b449c8c6c8b74c02ece3f37aee1497ca248de",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/impl/CloudControllerServiceImpl.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/38ea793fc598dc7c674537e823db39b1d7bf0518/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/impl/CloudControllerServiceImpl.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/38ea793fc598dc7c674537e823db39b1d7bf0518/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/impl/CloudControllerServiceImpl.java",
                "status": "modified",
                "changes": 3,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/impl/CloudControllerServiceImpl.java?ref=38ea793fc598dc7c674537e823db39b1d7bf0518",
                "patch": "@@ -1931,7 +1931,8 @@ public void createApplicationClusters(String appId, ApplicationClusterContextDTO\n             newCluster.setStatus(ClusterStatus.Created);\n             newCluster.setHostNames(Arrays.asList(appClusterCtxt.getHostName()));\n             Cartridge cartridge = dataHolder.getCartridge(appClusterCtxt.getCartridgeType());\n-            if(cartridge.getDeployerType().equals(StratosConstants.KUBERNETES_DEPLOYER_TYPE)) {\n+            if(cartridge.getDeployerType() != null &&\n+                    cartridge.getDeployerType().equals(StratosConstants.KUBERNETES_DEPLOYER_TYPE)) {\n                 newCluster.setKubernetesCluster(true);\n             }\n             clusters.add(newCluster);",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing a NPE is ApplicationMonitor",
        "commit": "https://github.com/apache/attic-stratos/commit/caa6f1b155ba103664f889e17a5f56f5f8f916f5",
        "parent": "https://github.com/apache/attic-stratos/commit/6fbb9525bd5555a2589fb7475c1e99aa98af38a7",
        "bug_id": "attic-stratos_20",
        "file": [
            {
                "sha": "dc53403af4e6a81c3b96e9028b46d30f7435ab63",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/application/ApplicationMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/caa6f1b155ba103664f889e17a5f56f5f8f916f5/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/application/ApplicationMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/caa6f1b155ba103664f889e17a5f56f5f8f916f5/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/application/ApplicationMonitor.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/application/ApplicationMonitor.java?ref=caa6f1b155ba103664f889e17a5f56f5f8f916f5",
                "patch": "@@ -148,7 +148,7 @@ public void setStatus(ApplicationStatus status) {\n \n         this.status = status;\n         //notify the children about the state change\n-        MonitorStatusEventBuilder.notifyChildren(this.parent, new ApplicationStatusEvent(status, appId));\n+        MonitorStatusEventBuilder.notifyChildren(this, new ApplicationStatusEvent(status, appId));\n     }\n \n     @Override",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing NPE in Partition.getKubernetesClusterId() method",
        "commit": "https://github.com/apache/attic-stratos/commit/a42581036dc09db0dbd8550f9bb075f0d36130da",
        "parent": "https://github.com/apache/attic-stratos/commit/19542cca66f9e9deca6caa9b04ff349402dfa167",
        "bug_id": "attic-stratos_21",
        "file": [
            {
                "sha": "010453c093f6788a8371c8a0949fd0a29959b07b",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/Partition.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/a42581036dc09db0dbd8550f9bb075f0d36130da/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/Partition.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/a42581036dc09db0dbd8550f9bb075f0d36130da/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/Partition.java",
                "status": "modified",
                "changes": 8,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/Partition.java?ref=a42581036dc09db0dbd8550f9bb075f0d36130da",
                "patch": "@@ -115,9 +115,11 @@ public void setProvider(String provider) {\n     }\n \n     public String getKubernetesClusterId() {\n-        Property property = properties.getProperty(KUBERNETES_CLUSTER);\n-        if (property != null) {\n-            return property.getValue();\n+        if(properties != null) {\n+            Property property = properties.getProperty(KUBERNETES_CLUSTER);\n+            if (property != null) {\n+                return property.getValue();\n+            }\n         }\n         return null;\n     }",
                "deletions": 3
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "handling a possible NPE",
        "commit": "https://github.com/apache/attic-stratos/commit/e046af8af6d7de735faea27c116d2b0c3ac2654c",
        "parent": "https://github.com/apache/attic-stratos/commit/e89b1a6e32018b06a598aea8a15196c2bdf82cee",
        "bug_id": "attic-stratos_22",
        "file": [
            {
                "sha": "e7058f569d122b4f85bcb67c810ce7126b936317",
                "filename": "components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/manager/CartridgeSubscriptionManager.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/e046af8af6d7de735faea27c116d2b0c3ac2654c/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/manager/CartridgeSubscriptionManager.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/e046af8af6d7de735faea27c116d2b0c3ac2654c/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/manager/CartridgeSubscriptionManager.java",
                "status": "modified",
                "changes": 6,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/manager/CartridgeSubscriptionManager.java?ref=e046af8af6d7de735faea27c116d2b0c3ac2654c",
                "patch": "@@ -249,7 +249,9 @@ private CartridgeSubscription subscribeToLB (SubscriptionData subscriptionData,\n                 lbDataContext.getDeploymentPolicy(), repository);\n \n         // add LB category to the payload\n-        cartridgeSubscription.getPayloadData().add(CartridgeConstants.LB_CATEGORY, lbDataContext.getLbCategory());\n+        if (cartridgeSubscription.getPayloadData() != null) {\n+            cartridgeSubscription.getPayloadData().add(CartridgeConstants.LB_CATEGORY, lbDataContext.getLbCategory());\n+        }\n \n                 // publishing to bam\n              \tCartridgeSubscriptionDataPublisher.publish(subscriptionData.getTenantId(),\n@@ -331,7 +333,7 @@ private CartridgeSubscription subscribe (SubscriptionData subscriptionData, Cart\n         \n         // Add whether the subscription is enabled upstream git commits\n         if(cartridgeSubscription.getPayloadData() != null) {\n-        cartridgeSubscription.getPayloadData().add(CartridgeConstants.COMMIT_ENABLED, String.valueOf(subscriptionData.isCommitsEnabled()));\n+            cartridgeSubscription.getPayloadData().add(CartridgeConstants.COMMIT_ENABLED, String.valueOf(subscriptionData.isCommitsEnabled()));\n         }\n         \n ",
                "deletions": 2
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fix NPE when no port mappings exist",
        "commit": "https://github.com/apache/attic-stratos/commit/99c05656bd45ae41a9e1e1a40e138fcf9fc9361c",
        "parent": "https://github.com/apache/attic-stratos/commit/ec93188555810c3f689a5c2a48a714c2e694e851",
        "bug_id": "attic-stratos_23",
        "file": [
            {
                "sha": "11971eae83b3aef8fe4b9e8e724433c03b7635ef",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/ApplicationUtils.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/99c05656bd45ae41a9e1e1a40e138fcf9fc9361c/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/ApplicationUtils.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/99c05656bd45ae41a9e1e1a40e138fcf9fc9361c/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/ApplicationUtils.java",
                "status": "modified",
                "changes": 6,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/ApplicationUtils.java?ref=99c05656bd45ae41a9e1e1a40e138fcf9fc9361c",
                "patch": "@@ -81,6 +81,12 @@ private static String createPortMappingPayloadString(Cartridge cartridge) {\n         // port mappings\n         StringBuilder portMapBuilder = new StringBuilder();\n         PortMapping[] portMappings = cartridge.getPortMappings();\n+\n+        if(cartridge.getPortMappings()[0] == null){\n+            // first element is null, which means no port mappings.\n+            return  null;\n+        }\n+\n         for (PortMapping portMapping : portMappings) {\n             int port = portMapping.getPort();\n             portMapBuilder.append(port).append(\"|\");",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Handling NPE in docker case.",
        "commit": "https://github.com/apache/attic-stratos/commit/848f23c0d66f05f23699ddfb02c51434b5bbc29b",
        "parent": "https://github.com/apache/attic-stratos/commit/d7fc233fc58f1073e79f6af9255a5b86a46246e1",
        "bug_id": "attic-stratos_24",
        "file": [
            {
                "sha": "5acb86c2f73ca3211d6c6129a21d977f0d2a6ad4",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/impl/CloudControllerServiceImpl.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/848f23c0d66f05f23699ddfb02c51434b5bbc29b/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/impl/CloudControllerServiceImpl.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/848f23c0d66f05f23699ddfb02c51434b5bbc29b/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/impl/CloudControllerServiceImpl.java",
                "status": "modified",
                "changes": 10,
                "additions": 8,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/impl/CloudControllerServiceImpl.java?ref=848f23c0d66f05f23699ddfb02c51434b5bbc29b",
                "patch": "@@ -866,14 +866,20 @@ private void detachVolume(IaasProvider iaasProvider, MemberContext ctxt) {\n \n \tprivate void logTermination(MemberContext memberContext) {\n \n+\t    if (memberContext == null) {\n+\t        return;\n+\t    }\n+\t    \n+\t    String partitionId = memberContext.getPartition() == null ? null : memberContext.getPartition().getId();\n+\t    \n         //updating the topology\n         TopologyBuilder.handleMemberTerminated(memberContext.getCartridgeType(), \n         \t\tmemberContext.getClusterId(), memberContext.getNetworkPartitionId(), \n-        \t\tmemberContext.getPartition().getId(), memberContext.getMemberId());\n+        \t\tpartitionId, memberContext.getMemberId());\n \n         //publishing data\n         CartridgeInstanceDataPublisher.publish(memberContext.getMemberId(),\n-                                                        memberContext.getPartition().getId(),\n+                                                        partitionId,\n                                                         memberContext.getNetworkPartitionId(),\n                                                         memberContext.getClusterId(),\n                                                         memberContext.getCartridgeType(),",
                "deletions": 2
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing NPE in debug logs",
        "commit": "https://github.com/apache/attic-stratos/commit/4bd661edeafb06830d303b625c601051a286b794",
        "parent": "https://github.com/apache/attic-stratos/commit/3c8deacccbd6a76ba25fec51b218150bb83e7868",
        "bug_id": "attic-stratos_25",
        "file": [
            {
                "sha": "627b648f8af6390bc256db35b7894b9b577cbe1d",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/4bd661edeafb06830d303b625c601051a286b794/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/4bd661edeafb06830d303b625c601051a286b794/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "status": "modified",
                "changes": 8,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/topology/AutoscalerTopologyEventReceiver.java?ref=4bd661edeafb06830d303b625c601051a286b794",
                "patch": "@@ -26,7 +26,6 @@\n import org.apache.stratos.autoscaler.deployment.policy.DeploymentPolicy;\n import org.apache.stratos.autoscaler.exception.TerminationException;\n import org.apache.stratos.autoscaler.monitor.AbstractClusterMonitor;\n-import org.apache.stratos.autoscaler.monitor.Monitor;\n import org.apache.stratos.autoscaler.monitor.application.ApplicationMonitor;\n import org.apache.stratos.autoscaler.monitor.group.GroupMonitor;\n import org.apache.stratos.autoscaler.partition.PartitionManager;\n@@ -587,12 +586,9 @@ public void run() {\n                     success = true;\n                     //TODO exception handling\n                 } catch (Exception e) {\n-                    String msg = \"Application monitor creation failed for Application: \" +\n-                                    application.getId();\n-                    log.debug(msg, e);\n+                    String msg = \"Application monitor creation failed for Application: \";\n+                    log.warn(msg, e);\n                     retries--;\n-\n-\n                 }\n             } while (!success && retries != 0);\n ",
                "deletions": 6
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "handling possible NPEs",
        "commit": "https://github.com/apache/attic-stratos/commit/f83160e308c99c3ddd006b00cccbc77e4aa13e31",
        "parent": "https://github.com/apache/attic-stratos/commit/fbcb4a062e5e67ad263b4665092d6425a31b6bf5",
        "bug_id": "attic-stratos_26",
        "file": [
            {
                "sha": "a7a18fbf09fddf7368d05880fed11f7a83f0db01",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/topology/TopologyBuilder.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f83160e308c99c3ddd006b00cccbc77e4aa13e31/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/topology/TopologyBuilder.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f83160e308c99c3ddd006b00cccbc77e4aa13e31/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/topology/TopologyBuilder.java",
                "status": "modified",
                "changes": 9,
                "additions": 9,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/topology/TopologyBuilder.java?ref=f83160e308c99c3ddd006b00cccbc77e4aa13e31",
                "patch": "@@ -390,7 +390,16 @@ public static void handleMemberMaintenance(InstanceMaintenanceModeEvent instance\n     public static void handleMemberTerminated(String serviceName, String clusterId, String networkPartitionId, String partitionId, String memberId) {\n         Topology topology = TopologyManager.getTopology();\n         Service service = topology.getService(serviceName);\n+        if (service == null) {\n+            log.warn(String.format(\"Service %s does not exist\",\n+                                                     serviceName));\n+        }\n         Cluster cluster = service.getCluster(clusterId);\n+        if (cluster == null) {\n+            log.warn(String.format(\"Cluster %s does not exist\",\n+                                                     clusterId));\n+        }\n+        \n         Member member = cluster.getMember(memberId);\n \n \t\tif (member == null) {",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing NPE when unsubscribing",
        "commit": "https://github.com/apache/attic-stratos/commit/ece29e69cca78ab3f3c9f170d91a98a1eb6c436a",
        "parent": "https://github.com/apache/attic-stratos/commit/9ac4fe8bea469afe062d9f48bd3a6069df8fe15d",
        "bug_id": "attic-stratos_27",
        "file": [
            {
                "sha": "d8a04e7f7524b0f68a5088b9632bca1580d27fc3",
                "filename": "components/org.apache.stratos.cartridge.agent/src/main/java/org/apache/stratos/cartridge/agent/statistics/publisher/HealthStatisticsNotifier.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/ece29e69cca78ab3f3c9f170d91a98a1eb6c436a/components/org.apache.stratos.cartridge.agent/src/main/java/org/apache/stratos/cartridge/agent/statistics/publisher/HealthStatisticsNotifier.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/ece29e69cca78ab3f3c9f170d91a98a1eb6c436a/components/org.apache.stratos.cartridge.agent/src/main/java/org/apache/stratos/cartridge/agent/statistics/publisher/HealthStatisticsNotifier.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cartridge.agent/src/main/java/org/apache/stratos/cartridge/agent/statistics/publisher/HealthStatisticsNotifier.java?ref=ece29e69cca78ab3f3c9f170d91a98a1eb6c436a",
                "patch": "@@ -56,7 +56,7 @@ public void run() {\n \n                 if (statsPublisher.isEnabled()) {\n                     if(!CartridgeAgentUtils.checkPortsActive(\"localhost\", CartridgeAgentConfiguration.getInstance().getPorts())\n-                            && !CartridgeAgentEventPublisher.isMaintenance()) {\n+                            && ( !CartridgeAgentEventPublisher.isMaintenance() || !CartridgeAgentEventPublisher.isReadyToShutdown() ) ) {\n                         if(log.isInfoEnabled()) {\n                             log.info(\"Publishing ports not open event\");\n                         }",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing NPE in member activation",
        "commit": "https://github.com/apache/attic-stratos/commit/bd9197ded0006ac6ddae9645d42eb85d99027eba",
        "parent": "https://github.com/apache/attic-stratos/commit/c67af55c412c3200fdd76b31a4e1ab72789d503a",
        "bug_id": "attic-stratos_28",
        "file": [
            {
                "sha": "522039092c9e217172379db4c8d93b499c44a6ac",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/bd9197ded0006ac6ddae9645d42eb85d99027eba/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/bd9197ded0006ac6ddae9645d42eb85d99027eba/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "status": "modified",
                "changes": 20,
                "additions": 18,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/topology/AutoscalerTopologyEventReceiver.java?ref=bd9197ded0006ac6ddae9645d42eb85d99027eba",
                "patch": "@@ -94,7 +94,7 @@ protected void onEvent(Event event) {\n                 try {\n                     TopologyManager.acquireReadLock();\n                     if(!topologyInitialized) {\n-                        topologyInitialized = true;\n+                          topologyInitialized = true;\n                         for (Application application : TopologyManager.getTopology().getApplications()) {\n                             startApplicationMonitor(application);\n                         }\n@@ -446,9 +446,25 @@ protected void onEvent(Event event) {\n                     TopologyManager.acquireReadLock();\n \n                     MemberActivatedEvent e = (MemberActivatedEvent) event;\n+                    String networkPartitionId = e.getNetworkPartitionId();\n+                    String clusterId = e.getClusterId();\n+                    String partitionId = e.getPartitionId();\n                     String memberId = e.getMemberId();\n \n-                    PartitionContext partitionContext = null;\n+                    AbstractClusterMonitor monitor;\n+\n+                    if (AutoscalerContext.getInstance().monitorExist(clusterId)) {\n+                        monitor = AutoscalerContext.getInstance().getMonitor(clusterId);\n+                    } else {\n+                        //This is LB member\n+                        monitor = AutoscalerContext.getInstance().getLBMonitor(clusterId);\n+                    }\n+\n+                    NetworkPartitionContext networkPartitionContext = monitor.\n+                            getNetworkPartitionCtxt(networkPartitionId);\n+\n+                    PartitionContext partitionContext = networkPartitionContext.\n+                            getPartitionCtxt(partitionId);\n \n                     partitionContext.addMemberStatsContext(new MemberStatsContext(memberId));\n                     // TODO starting the pending clusters which are waiting for this member activation in a cluster",
                "deletions": 2
            },
            {
                "sha": "4db5017eb37d8d585bdea0730d2d6e122bd197c9",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/checker/StatusChecker.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/bd9197ded0006ac6ddae9645d42eb85d99027eba/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/checker/StatusChecker.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/bd9197ded0006ac6ddae9645d42eb85d99027eba/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/checker/StatusChecker.java",
                "status": "modified",
                "changes": 3,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/checker/StatusChecker.java?ref=bd9197ded0006ac6ddae9645d42eb85d99027eba",
                "patch": "@@ -66,8 +66,9 @@ public void run() {\n                         } else if (partitionContext.getActiveMemberCount() > partitionContext.getMinimumMemberCount()) {\n                             log.info(\"cluster already activated...\");\n                             clusterActive = true;\n+                        } else {\n+                            clusterActive = false;\n                         }\n-                        clusterActive = false;\n                     }\n                 }\n                 // if active then notify upper layer",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing possible bugs, NPE, lock issue",
        "commit": "https://github.com/apache/attic-stratos/commit/67d17ad3ad981e09193c4cd27fe682c929853895",
        "parent": "https://github.com/apache/attic-stratos/commit/9a08abde0a9f3720b0345ee53612d05f06845602",
        "bug_id": "attic-stratos_29",
        "file": [
            {
                "sha": "6998646bd902066e5aa2015a25b4adbe5d2e83b7",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/ClusterStatusEventPublisher.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/67d17ad3ad981e09193c4cd27fe682c929853895/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/ClusterStatusEventPublisher.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/67d17ad3ad981e09193c4cd27fe682c929853895/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/ClusterStatusEventPublisher.java",
                "status": "modified",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/ClusterStatusEventPublisher.java?ref=67d17ad3ad981e09193c4cd27fe682c929853895",
                "patch": "@@ -212,7 +212,7 @@ public static void sendClusterStatusClusterTerminatingEvent(String appId, String\n     public static void sendClusterTerminatedEvent(String appId, String serviceName,\n                                                   String clusterId, String instanceId) {\n         try {\n-            TopologyManager.acquireReadLockForCluster(serviceName, clusterId);\n+            //TopologyManager.acquireReadLockForCluster(serviceName, clusterId);\n             Service service = TopologyManager.getTopology().getService(serviceName);\n             if (service != null) {\n                 Cluster cluster = service.getCluster(clusterId);\n@@ -240,7 +240,7 @@ public static void sendClusterTerminatedEvent(String appId, String serviceName,\n                 }\n             }\n         } finally {\n-            TopologyManager.releaseReadLockForCluster(serviceName, clusterId);\n+            //TopologyManager.releaseReadLockForCluster(serviceName, clusterId);\n \n         }\n     }",
                "deletions": 2
            },
            {
                "sha": "b374a8485211ee1078da87a0c478004405c2f1a7",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/iaases/JcloudsIaas.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/67d17ad3ad981e09193c4cd27fe682c929853895/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/iaases/JcloudsIaas.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/67d17ad3ad981e09193c4cd27fe682c929853895/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/iaases/JcloudsIaas.java",
                "status": "modified",
                "changes": 5,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/iaases/JcloudsIaas.java?ref=67d17ad3ad981e09193c4cd27fe682c929853895",
                "patch": "@@ -349,6 +349,11 @@ private void destroyNode(String nodeId, MemberContext memberContext) {\n     private void detachVolume(MemberContext ctxt) {\n         String clusterId = ctxt.getClusterId();\n         ClusterContext clusterContext = CloudControllerContext.getInstance().getClusterContext(clusterId);\n+        if(clusterContext == null){\n+            log.error(String.format(\"Could not detach volume, Cluster context not found for the [member] %s [cluster-id]\", ctxt.getMemberId(), clusterId));\n+            return;\n+        }\n+\n         if (clusterContext.getVolumes() != null) {\n             for (Volume volume : clusterContext.getVolumes()) {\n                 try {",
                "deletions": 0
            },
            {
                "sha": "6c7f45aa38098d2fcfbd96e3b5b63a53e20195f8",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/topology/ApplicationClustersRemovedMessageProcessor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/67d17ad3ad981e09193c4cd27fe682c929853895/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/topology/ApplicationClustersRemovedMessageProcessor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/67d17ad3ad981e09193c4cd27fe682c929853895/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/topology/ApplicationClustersRemovedMessageProcessor.java",
                "status": "modified",
                "changes": 9,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/topology/ApplicationClustersRemovedMessageProcessor.java?ref=67d17ad3ad981e09193c4cd27fe682c929853895",
                "patch": "@@ -72,10 +72,11 @@ private boolean doProcess(ApplicationClustersRemovedEvent event, Topology topolo\n         Set<ClusterDataHolder> clusterData = event.getClusterData();\n         if (clusterData != null) {\n             for (ClusterDataHolder aClusterData : clusterData) {\n-                TopologyUpdater.acquireWriteLockForService(aClusterData.getServiceType());\n+                String serviceType = aClusterData.getServiceType();\n+                TopologyUpdater.acquireWriteLockForService(serviceType);\n \n                 try {\n-                    Service aService = topology.getService(aClusterData.getServiceType());\n+                    Service aService = topology.getService(serviceType);\n                     if (aService != null) {\n                         if (aService.clusterExists(aClusterData.getClusterId())) {\n                             aService.removeCluster(aClusterData.getClusterId());\n@@ -87,11 +88,11 @@ private boolean doProcess(ApplicationClustersRemovedEvent event, Topology topolo\n                             }\n                         }\n                     } else {\n-                        log.warn(\"Service \" + aClusterData.getServiceType() + \" not found, unable to remove Cluster \" + aClusterData.getClusterId());\n+                        log.warn(\"Service \" + serviceType + \" not found, unable to remove Cluster \" + aClusterData.getClusterId());\n                     }\n \n                 } finally {\n-                    TopologyUpdater.releaseWriteLockForService(aClusterData.getServiceType());\n+                    TopologyUpdater.releaseWriteLockForService(serviceType);\n                 }\n             }\n ",
                "deletions": 4
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "handling a NPE",
        "commit": "https://github.com/apache/attic-stratos/commit/11e4b33cac0d2e2b9cf494a07c010af16868456c",
        "parent": "https://github.com/apache/attic-stratos/commit/ff03b8fb5a4e827e7acb7884e6a11a096db87465",
        "bug_id": "attic-stratos_30",
        "file": [
            {
                "sha": "fa2a14300875b0af5f41db5ebd7157e2205d272e",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/util/CloudControllerUtil.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/11e4b33cac0d2e2b9cf494a07c010af16868456c/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/util/CloudControllerUtil.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/11e4b33cac0d2e2b9cf494a07c010af16868456c/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/util/CloudControllerUtil.java",
                "status": "modified",
                "changes": 5,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/util/CloudControllerUtil.java?ref=11e4b33cac0d2e2b9cf494a07c010af16868456c",
                "patch": "@@ -67,7 +67,10 @@ public static Cartridge toCartridge(CartridgeConfig config) {\n         cartridge.setProvider(config.getProvider());\n         cartridge.setVersion(config.getVersion());\n         cartridge.setBaseDir(config.getBaseDir());\n-        cartridge.setPortMappings(Arrays.asList(config.getPortMappings()));\n+        \n+        if (config.getPortMappings() != null) {\n+\t\t\tcartridge.setPortMappings(Arrays.asList(config.getPortMappings()));\n+\t\t}\n         \n         if(config.getPersistanceMappings() != null && config.getPersistanceMappings().length >0){\n         \tcartridge.setPeristanceMappings(Arrays.asList(config.getPersistanceMappings()));",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing a NPE",
        "commit": "https://github.com/apache/attic-stratos/commit/e03ac984403d2db2c871d6e17a54524ea1d95dd2",
        "parent": "https://github.com/apache/attic-stratos/commit/9a6dd171528c016e2a7cf437ed96e27c33f76be3",
        "bug_id": "attic-stratos_31",
        "file": [
            {
                "sha": "e3718547afee538045531a00d8aa3e637376df39",
                "filename": "components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/listener/InstanceStatusListener.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/e03ac984403d2db2c871d6e17a54524ea1d95dd2/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/listener/InstanceStatusListener.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/e03ac984403d2db2c871d6e17a54524ea1d95dd2/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/listener/InstanceStatusListener.java",
                "status": "modified",
                "changes": 7,
                "additions": 7,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/listener/InstanceStatusListener.java?ref=e03ac984403d2db2c871d6e17a54524ea1d95dd2",
                "patch": "@@ -72,6 +72,13 @@ public void onMessage(Message message) {\n                 }*/\n                 ////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                 Set<CartridgeSubscription> cartridgeSubscriptions = new DataInsertionAndRetrievalManager().getCartridgeSubscription(clusterId);\n+                if (cartridgeSubscriptions == null || cartridgeSubscriptions.isEmpty()) {\n+                    // No subscriptions, return\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"No subscription information found for cluster id \" + clusterId);\n+                    }\n+                    return;\n+                }\n \n                 for (CartridgeSubscription cartridgeSubscription : cartridgeSubscriptions) {\n                     // If only this is a non-multitenant Cartridge Subscription and repository is not null, need to",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "handling an NPE",
        "commit": "https://github.com/apache/attic-stratos/commit/b82dbc6045e78900be3cea303b18b6a8e34b2d21",
        "parent": "https://github.com/apache/attic-stratos/commit/dac753c2f8a30c3181e755f6938ab46e4167f366",
        "bug_id": "attic-stratos_32",
        "file": [
            {
                "sha": "af5cd5fa09b629c8b98eff65ea0befaa4aec0d49",
                "filename": "components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/publisher/TenantSynzhronizerTask.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/b82dbc6045e78900be3cea303b18b6a8e34b2d21/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/publisher/TenantSynzhronizerTask.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/b82dbc6045e78900be3cea303b18b6a8e34b2d21/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/publisher/TenantSynzhronizerTask.java",
                "status": "modified",
                "changes": 12,
                "additions": 7,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/publisher/TenantSynzhronizerTask.java?ref=b82dbc6045e78900be3cea303b18b6a8e34b2d21",
                "patch": "@@ -69,12 +69,14 @@ public void execute() {\n                 //List<CartridgeSubscriptionInfo> cartridgeSubscriptions = PersistenceManager.getSubscriptionsForTenant(tenant.getTenantId());\n                 /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                 Collection<CartridgeSubscription> cartridgeSubscriptions = new DataInsertionAndRetrievalManager().getCartridgeSubscriptions(tenant.getTenantId());\n-                for (CartridgeSubscription subscription : cartridgeSubscriptions) {\n-                    if(log.isDebugEnabled()) {\n-                        log.debug(String.format(\"Tenant subscription found: [tenant-id] %d [tenant-domain] %s [service] %s\",\n-                                   carbonTenant.getId(), carbonTenant.getDomain(), subscription.getType()));\n+                if (cartridgeSubscriptions != null && !cartridgeSubscriptions.isEmpty()) {\n+                    for (CartridgeSubscription subscription : cartridgeSubscriptions) {\n+                        if(log.isDebugEnabled()) {\n+                            log.debug(String.format(\"Tenant subscription found: [tenant-id] %d [tenant-domain] %s [service] %s\",\n+                                    carbonTenant.getId(), carbonTenant.getDomain(), subscription.getType()));\n+                        }\n+                        tenant.addServiceSubscription(subscription.getType());\n                     }\n-                    tenant.addServiceSubscription(subscription.getType());\n                 }\n                 tenants.add(tenant);\n             }",
                "deletions": 5
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Avoid possible NPE in ApplicationInstance* message processors",
        "commit": "https://github.com/apache/attic-stratos/commit/7bc01c1799a2f490d0b3292063f58374e7b08c61",
        "parent": "https://github.com/apache/attic-stratos/commit/0d7ee705af3c6886c6369ddbc0ede25a3f8ad88f",
        "bug_id": "attic-stratos_33",
        "file": [
            {
                "sha": "862ad8e0d5b643e062d23fd5cb7d09db2c534d48",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/application/ApplicationInstanceActivatedMessageProcessor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/7bc01c1799a2f490d0b3292063f58374e7b08c61/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/application/ApplicationInstanceActivatedMessageProcessor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/7bc01c1799a2f490d0b3292063f58374e7b08c61/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/application/ApplicationInstanceActivatedMessageProcessor.java",
                "status": "modified",
                "changes": 3,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/application/ApplicationInstanceActivatedMessageProcessor.java?ref=7bc01c1799a2f490d0b3292063f58374e7b08c61",
                "patch": "@@ -93,8 +93,9 @@ private boolean doProcess(ApplicationInstanceActivatedEvent event, Applications\n                 if (log.isWarnEnabled()) {\n                     log.warn(String.format(\"Application instance not exists in group: [AppId] %s\" +\n                             \"[instanceId] %s\", event.getAppId(), event.getInstanceId()));\n-                    return false;\n                 }\n+\n+                return false;\n             }\n             ApplicationStatus status = ApplicationStatus.Active;\n             if (!context.isStateTransitionValid(status)) {",
                "deletions": 1
            },
            {
                "sha": "3f1b56c8734691d6dcc08025878d26bac2badb56",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/application/ApplicationInstanceInactivatedMessageProcessor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/7bc01c1799a2f490d0b3292063f58374e7b08c61/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/application/ApplicationInstanceInactivatedMessageProcessor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/7bc01c1799a2f490d0b3292063f58374e7b08c61/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/application/ApplicationInstanceInactivatedMessageProcessor.java",
                "status": "modified",
                "changes": 3,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/application/ApplicationInstanceInactivatedMessageProcessor.java?ref=7bc01c1799a2f490d0b3292063f58374e7b08c61",
                "patch": "@@ -94,8 +94,9 @@ private boolean doProcess(ApplicationInstanceInactivatedEvent event, Application\n                 if (log.isWarnEnabled()) {\n                     log.warn(String.format(\"Application instance not exists in group: [application-id] %s\" +\n                             \"[instance-id] %s\", event.getAppId(), event.getInstanceId()));\n-                    return false;\n                 }\n+\n+                return false;\n             }\n             ApplicationStatus status = ApplicationStatus.Inactive;\n             if (!context.isStateTransitionValid(status)) {",
                "deletions": 1
            },
            {
                "sha": "bd184a11ca91e37a86b06af557956adffefabd57",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/application/ApplicationInstanceTerminatingMessageProcessor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/7bc01c1799a2f490d0b3292063f58374e7b08c61/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/application/ApplicationInstanceTerminatingMessageProcessor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/7bc01c1799a2f490d0b3292063f58374e7b08c61/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/application/ApplicationInstanceTerminatingMessageProcessor.java",
                "status": "modified",
                "changes": 3,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/application/ApplicationInstanceTerminatingMessageProcessor.java?ref=7bc01c1799a2f490d0b3292063f58374e7b08c61",
                "patch": "@@ -94,8 +94,9 @@ private boolean doProcess(ApplicationInstanceTerminatingEvent event, Application\n                 if (log.isWarnEnabled()) {\n                     log.warn(String.format(\"Application Instance not exists in Group: [AppId] %s\" +\n                             \"[instanceId] %s\", event.getAppId(), event.getInstanceId()));\n-                    return false;\n                 }\n+\n+                return false;\n             }\n             ApplicationStatus status = ApplicationStatus.Terminating;\n             if (!context.isStateTransitionValid(status)) {",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fix NPE in dependent scaling sample",
        "commit": "https://github.com/apache/attic-stratos/commit/511593feddfc7474380c7049c20cae94af3b240e",
        "parent": "https://github.com/apache/attic-stratos/commit/410ba42a842d1806db9b3e6f9a1818e7a873c589",
        "bug_id": "attic-stratos_34",
        "file": [
            {
                "sha": "388c18ba37aadcfc5d268042b442857f1d5e2c5c",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/511593feddfc7474380c7049c20cae94af3b240e/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/511593feddfc7474380c7049c20cae94af3b240e/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java",
                "status": "modified",
                "changes": 15,
                "additions": 8,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java?ref=511593feddfc7474380c7049c20cae94af3b240e",
                "patch": "@@ -409,13 +409,14 @@ private Application buildCompositeAppStructure(ApplicationContext applicationCon\n \t\t                    if (dataHolder != null) {\n \t\t\t                    if (!dataHolder.getClusterId().equals(clusterId)) {\n \t\t\t\t                    dependencyClusterIDs.add(dataHolder.getClusterId());\n-\t\t\t\t                    for (String str : dependencyCartridge.getMetadataKeys()) {\n-\t\t\t\t\t                    if (!StringUtils.isBlank(str)) {\n-\t\t\t\t\t\t                    importMetadataKeys.add(dataHolder.getClusterId().split(\"\\\\.\")[0] +\n-                                                    METADATA_APPENDER +\n-                                                    str);\n-\t\t\t\t\t                    }\n-\t\t\t\t                    }\n+                                    if(dependencyCartridge.getMetadataKeys() != null){\n+                                        for (String str : dependencyCartridge.getMetadataKeys()) {\n+                                            if (!StringUtils.isBlank(str)) {\n+                                                importMetadataKeys.add(dataHolder.getClusterId().split(\"\\\\.\")[0] +\n+                                                        METADATA_APPENDER + str);\n+                                            }\n+                                        }\n+                                    }\n \t\t\t\t                    if (!dataHolder.getClusterId().equals(clusterId)) {\n \t\t\t\t\t                    if (startupOrderComponent.equals(\"cartridge.\".concat(cartridgeType))) {\n \t\t\t\t\t\t                    break;",
                "deletions": 7
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing a NPE in rest API",
        "commit": "https://github.com/apache/attic-stratos/commit/bf8b3dc16c40edc5ecb0490c752da66c944edf39",
        "parent": "https://github.com/apache/attic-stratos/commit/9cc8e30ef331877a4f0df0ac943ab934fc2ae098",
        "bug_id": "attic-stratos_35",
        "file": [
            {
                "sha": "c8f6337778907db84264cf2180d0b661b86776d3",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/bf8b3dc16c40edc5ecb0490c752da66c944edf39/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/bf8b3dc16c40edc5ecb0490c752da66c944edf39/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java",
                "status": "modified",
                "changes": 6,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java?ref=bf8b3dc16c40edc5ecb0490c752da66c944edf39",
                "patch": "@@ -1008,6 +1008,12 @@ public static void deployApplication(String applicationId, ApplicationPolicyBean\n                 log.error(message);\n                 throw new RestAPIException(message);\n             }\n+            if (applicationPolicy == null) {\n+                String message = String.format(\"Application policy cannot be null : [application-id] %s. \"\n+                \t\t+ \"Are you passing application policy?\", applicationId);\n+                log.error(message);\n+                throw new RestAPIException(message);\n+\t\t\t}\n \n             ApplicationBean applicationBean = getApplication(applicationId);\n             int tenantId = CarbonContext.getThreadLocalCarbonContext().getTenantId();",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing a NPE in rest API",
        "commit": "https://github.com/apache/attic-stratos/commit/97286c9f02ec863150d3fde439ea7d7ccb0e9574",
        "parent": "https://github.com/apache/attic-stratos/commit/8a2de4562ff65425ebae5b71026b14e5be249e4e",
        "bug_id": "attic-stratos_36",
        "file": [
            {
                "sha": "c8f6337778907db84264cf2180d0b661b86776d3",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/97286c9f02ec863150d3fde439ea7d7ccb0e9574/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/97286c9f02ec863150d3fde439ea7d7ccb0e9574/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java",
                "status": "modified",
                "changes": 6,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java?ref=97286c9f02ec863150d3fde439ea7d7ccb0e9574",
                "patch": "@@ -1008,6 +1008,12 @@ public static void deployApplication(String applicationId, ApplicationPolicyBean\n                 log.error(message);\n                 throw new RestAPIException(message);\n             }\n+            if (applicationPolicy == null) {\n+                String message = String.format(\"Application policy cannot be null : [application-id] %s. \"\n+                \t\t+ \"Are you passing application policy?\", applicationId);\n+                log.error(message);\n+                throw new RestAPIException(message);\n+\t\t\t}\n \n             ApplicationBean applicationBean = getApplication(applicationId);\n             int tenantId = CarbonContext.getThreadLocalCarbonContext().getTenantId();",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing possible NPEs when application monitor is not there",
        "commit": "https://github.com/apache/attic-stratos/commit/912a24a6d4f12462260666382e812c1b24c34c6f",
        "parent": "https://github.com/apache/attic-stratos/commit/eacf5178cd1b9f5234373c5aa3407ff127ef51d9",
        "bug_id": "attic-stratos_37",
        "file": [
            {
                "sha": "1c99a1cdc29591b86da4f45a2ba7529934b7d358",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/topic/ApplicationBuilder.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/912a24a6d4f12462260666382e812c1b24c34c6f/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/topic/ApplicationBuilder.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/912a24a6d4f12462260666382e812c1b24c34c6f/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/topic/ApplicationBuilder.java",
                "status": "modified",
                "changes": 11,
                "additions": 7,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/topic/ApplicationBuilder.java?ref=912a24a6d4f12462260666382e812c1b24c34c6f",
                "patch": "@@ -419,16 +419,16 @@ public static void handleGroupInstanceTerminatedEvent(String appId, String group\n                         getAppMonitor(appId);\n \n                 if (monitor != null) {\n-                    if (monitor.hasMonitors() && applicationMonitor.isTerminating()) {\n+                    if (monitor.hasMonitors() && applicationMonitor != null &&\n+                            !applicationMonitor.isForce() && applicationMonitor.isTerminating()) {\n                         for (Monitor monitor1 : monitor.\n                                 getAliasToActiveChildMonitorsMap().values()) {\n                             //destroying the drools\n                             monitor1.destroy();\n                         }\n                     }\n                     org.apache.stratos.autoscaler.context.partition.network.NetworkPartitionContext networkPartitionContext =\n-                            (org.apache.stratos.autoscaler.context.partition.network.NetworkPartitionContext) monitor.\n-                                    getNetworkPartitionContext(groupInstance.getNetworkPartitionId());\n+                            monitor.getNetworkPartitionContext(groupInstance.getNetworkPartitionId());\n                     networkPartitionContext.removeInstanceContext(instanceId);\n                     if (groupInstance.getPartitionId() != null) {\n                         networkPartitionContext.getPartitionCtxt(groupInstance.getPartitionId()).\n@@ -438,7 +438,10 @@ public static void handleGroupInstanceTerminatedEvent(String appId, String group\n                     group.removeInstance(instanceId);\n                     ApplicationHolder.persistApplication(application);\n                     ApplicationsEventPublisher.sendGroupInstanceTerminatedEvent(appId, groupId, instanceId);\n-                    monitor.setStatus(status, instanceId, parentId);\n+                    if(applicationMonitor != null && !applicationMonitor.isForce()) {\n+                        //If force un-deployment, then no need to notify the parent\n+                        monitor.setStatus(status, instanceId, parentId);\n+                    }\n                 }\n             } else {\n                 log.warn(\"Group state transition is not valid: [group-id] \" + groupId +",
                "deletions": 4
            },
            {
                "sha": "ef31b97a1a17f9d3ca2b64764375718b2ea5becf",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/912a24a6d4f12462260666382e812c1b24c34c6f/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/912a24a6d4f12462260666382e812c1b24c34c6f/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java?ref=912a24a6d4f12462260666382e812c1b24c34c6f",
                "patch": "@@ -312,7 +312,7 @@ protected void onEvent(Event event) {\n                     // if the cluster monitor is null, assume that its termianted\n                     appMonitor = AutoscalerContext.getInstance().\n                             getAppMonitor(clusterTerminatedEvent.getAppId());\n-                    if (appMonitor != null) {\n+                    if (appMonitor != null && !appMonitor.isForce()) {\n                         appMonitor.onChildStatusEvent(\n                                 new ClusterStatusEvent(ClusterStatus.Terminated,\n                                         clusterId, instanceId));",
                "deletions": 1
            },
            {
                "sha": "341f264434f4fb40837a692f353acc49fa7e957a",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/GroupMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/912a24a6d4f12462260666382e812c1b24c34c6f/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/GroupMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/912a24a6d4f12462260666382e812c1b24c34c6f/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/GroupMonitor.java",
                "status": "modified",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/GroupMonitor.java?ref=912a24a6d4f12462260666382e812c1b24c34c6f",
                "patch": "@@ -160,7 +160,7 @@ public void run() {\n \n                     //When the application is getting un-deployed, need to avoid\n                     // checking the minimum count sanctification\n-                    if (!applicationMonitor.isTerminating()) {\n+                    if (applicationMonitor!= null && !applicationMonitor.isTerminating()) {\n                         Collection<Instance> parentInstances = parent.getInstances();\n \n                         for (Instance parentInstance : parentInstances) {\n@@ -510,7 +510,7 @@ private void onTerminationOfInstance(String childId, String instanceId) {\n         ApplicationMonitor applicationMonitor = AutoscalerContext.getInstance().\n                 getAppMonitor(appId);\n         //If application is forcefully un-deployed, no need to handle here.\n-        if(!applicationMonitor.isForce()) {\n+        if(applicationMonitor != null && !applicationMonitor.isForce()) {\n             GroupInstance instance = (GroupInstance) instanceIdToInstanceMap.get(instanceId);\n             if (instance != null) {\n ",
                "deletions": 2
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Handled NPE for remove Application SignUps",
        "commit": "https://github.com/apache/attic-stratos/commit/dddfc9b1b54bef5f348866f134afcd95f3772e5e",
        "parent": "https://github.com/apache/attic-stratos/commit/dd256fe72cf4f8cbefccb6299822eccff9d2b6df",
        "bug_id": "attic-stratos_38",
        "file": [
            {
                "sha": "98f48075f3765fecda55b9d0a247b8386499cf90",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/services/impl/AutoscalerServiceImpl.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/dddfc9b1b54bef5f348866f134afcd95f3772e5e/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/services/impl/AutoscalerServiceImpl.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/dddfc9b1b54bef5f348866f134afcd95f3772e5e/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/services/impl/AutoscalerServiceImpl.java",
                "status": "modified",
                "changes": 10,
                "additions": 7,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/services/impl/AutoscalerServiceImpl.java?ref=dddfc9b1b54bef5f348866f134afcd95f3772e5e",
                "patch": "@@ -347,9 +347,13 @@ private void removeApplicationSignUp(ApplicationContext applicationContext){\n             StratosManagerServiceClient serviceClient = StratosManagerServiceClient.getInstance();\n \n             ApplicationSignUp applicationSignUp[] = serviceClient.getApplicationSignUps(applicationContext.getApplicationId());\n-            for(ApplicationSignUp appSignUp : applicationSignUp)\n-            {\n-                serviceClient.removeApplicationSignUp(appSignUp.getApplicationId(), appSignUp.getTenantId());\n+            if ( applicationSignUp != null){\n+                for(ApplicationSignUp appSignUp : applicationSignUp)\n+                {\n+                    if ( appSignUp != null) {\n+                        serviceClient.removeApplicationSignUp(appSignUp.getApplicationId(), appSignUp.getTenantId());\n+                    }\n+                }\n             }\n \n         }catch(Exception e){",
                "deletions": 3
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing NPE issue in domain mapping handler",
        "commit": "https://github.com/apache/attic-stratos/commit/c1517c50402f23246cc37c9b9d78710116a35a49",
        "parent": "https://github.com/apache/attic-stratos/commit/2c4d8b96ba19bfc90c30b44c749abb4d1afe8e5e",
        "bug_id": "attic-stratos_39",
        "file": [
            {
                "sha": "75b31a87e5ad85ee8506a1e6ab5399b9293443e6",
                "filename": "components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/components/DomainMappingHandler.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/c1517c50402f23246cc37c9b9d78710116a35a49/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/components/DomainMappingHandler.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/c1517c50402f23246cc37c9b9d78710116a35a49/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/components/DomainMappingHandler.java",
                "status": "modified",
                "changes": 5,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/components/DomainMappingHandler.java?ref=c1517c50402f23246cc37c9b9d78710116a35a49",
                "patch": "@@ -123,7 +123,10 @@ public boolean domainNameExist(String domainName) throws DomainMappingException\n     public DomainMapping[] getDomainMappings(String applicationId, int tenantId) throws DomainMappingException {\n         try {\n             ApplicationSignUp applicationSignUp = applicationSignUpHandler.getApplicationSignUp(applicationId, tenantId);\n-            return applicationSignUp.getDomainMappings();\n+            if(applicationSignUp != null) {\n+                return applicationSignUp.getDomainMappings();\n+            }\n+            return null;\n         } catch (Exception e) {\n             String message = String.format(\"Could not get domain mappings: [application-id] %s [tenant-id] %d\",\n                     applicationId, tenantId);",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fix the NPE in load balancer",
        "commit": "https://github.com/apache/attic-stratos/commit/c25193f61acf09caf5e757fe9f228f9ce73ff6a2",
        "parent": "https://github.com/apache/attic-stratos/commit/7515b8bb22ff790d3e9f0c96fa1d8336cd4538cf",
        "bug_id": "attic-stratos_40",
        "file": [
            {
                "sha": "739383f7157981bf40d2d3db9d143d6d2dcaf7f6",
                "filename": "components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/internal/LoadBalancerServiceComponent.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/c25193f61acf09caf5e757fe9f228f9ce73ff6a2/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/internal/LoadBalancerServiceComponent.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/c25193f61acf09caf5e757fe9f228f9ce73ff6a2/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/internal/LoadBalancerServiceComponent.java",
                "status": "modified",
                "changes": 5,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/internal/LoadBalancerServiceComponent.java?ref=c25193f61acf09caf5e757fe9f228f9ce73ff6a2",
                "patch": "@@ -25,6 +25,7 @@\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.stratos.common.clustering.DistributedObjectProvider;\n+import org.apache.stratos.common.threading.StratosThreadPool;\n import org.apache.stratos.load.balancer.endpoint.EndpointDeployer;\n import org.apache.stratos.load.balancer.messaging.LoadBalancerTenantEventReceiver;\n import org.apache.stratos.load.balancer.messaging.LoadBalancerTopologyEventReceiver;\n@@ -89,7 +90,7 @@\n     private LoadBalancerTopologyEventReceiver topologyReceiver;\n     private LoadBalancerTenantEventReceiver tenantReceiver;\n     private LoadBalancerStatisticsNotifier statisticsNotifier;\n-\tprivate static final String STRATOS_MANAGER = \"Stratos_manager\";\n+\tprivate static final String LOAD_BALANCER_IDENTIFIER = \"Load-Balancer\";\n \tprivate static final int THREAD_POOL_SIZE = 20;\n \tprivate ExecutorService executorService;\n \n@@ -188,7 +189,9 @@ private void startTenantEventReceiver() {\n     }\n \n     private void startTopologyEventReceiver() {\n+\t    executorService= StratosThreadPool.getExecutorService(LOAD_BALANCER_IDENTIFIER,THREAD_POOL_SIZE);\n \t    topologyReceiver = new LoadBalancerTopologyEventReceiver();\n+\t    topologyReceiver.setExecutorService(executorService);\n \t    topologyReceiver.execute();\n         if (log.isInfoEnabled()) {\n             log.info(\"Topology receiver thread started\");",
                "deletions": 1
            },
            {
                "sha": "4c75bf2954f5d1729d25f731adb7ac8f4c05f4ba",
                "filename": "components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/messaging/LoadBalancerTopologyEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/c25193f61acf09caf5e757fe9f228f9ce73ff6a2/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/messaging/LoadBalancerTopologyEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/c25193f61acf09caf5e757fe9f228f9ce73ff6a2/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/messaging/LoadBalancerTopologyEventReceiver.java",
                "status": "modified",
                "changes": 14,
                "additions": 12,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/messaging/LoadBalancerTopologyEventReceiver.java?ref=c25193f61acf09caf5e757fe9f228f9ce73ff6a2",
                "patch": "@@ -35,14 +35,16 @@\n import org.apache.stratos.messaging.message.receiver.topology.TopologyEventReceiver;\n import org.apache.stratos.messaging.message.receiver.topology.TopologyManager;\n \n+import java.util.concurrent.ExecutorService;\n+\n /**\n  * Load balancer topology receiver updates load balancer context according to\n  * incoming topology events.\n  */\n public class LoadBalancerTopologyEventReceiver {\n \n     private static final Log log = LogFactory.getLog(LoadBalancerTopologyEventReceiver.class);\n-\n+\tprivate ExecutorService executorService;\n     private TopologyEventReceiver topologyEventReceiver;\n     private boolean terminated;\n \n@@ -52,7 +54,7 @@ public LoadBalancerTopologyEventReceiver() {\n     }\n \n     public void execute() {\n-\n+\t\ttopologyEventReceiver.setExecutorService(executorService);\n \t    topologyEventReceiver.execute();\n         if (log.isInfoEnabled()) {\n             log.info(\"Load balancer topology receiver thread started\");\n@@ -408,4 +410,12 @@ public void terminate() {\n         topologyEventReceiver.terminate();\n         terminated = true;\n     }\n+\n+\tpublic ExecutorService getExecutorService() {\n+\t\treturn executorService;\n+\t}\n+\n+\tpublic void setExecutorService(ExecutorService executorService) {\n+\t\tthis.executorService = executorService;\n+\t}\n }",
                "deletions": 2
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing NPE while listing policies",
        "commit": "https://github.com/apache/attic-stratos/commit/1f615a1b04813d2325868d4f6a32e8cd5b94b119",
        "parent": "https://github.com/apache/attic-stratos/commit/7fb24d00e214d6b77f4f58dbc3cacabc7f5eb3ad",
        "bug_id": "attic-stratos_41",
        "file": [
            {
                "sha": "1d0dc361cd0c594ca579762f01092aa876519bd4",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/services/ServiceUtils.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/1f615a1b04813d2325868d4f6a32e8cd5b94b119/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/services/ServiceUtils.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/1f615a1b04813d2325868d4f6a32e8cd5b94b119/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/services/ServiceUtils.java",
                "status": "modified",
                "changes": 26,
                "additions": 12,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/services/ServiceUtils.java?ref=1f615a1b04813d2325868d4f6a32e8cd5b94b119",
                "patch": "@@ -367,20 +367,18 @@ private static AutoscalerServiceClient getAutoscalerServiceClient () throws Rest\n         if (autoscalerServiceClient != null) {\n             try {\n                 autoscalePolicies = autoscalerServiceClient.getAutoScalePolicies();\n+                if(autoscalePolicies == null || autoscalePolicies.length == 0) {\n+                    String errorMsg = \"Cannot find any auto-scaling policy.\";\n+                    log.error(errorMsg);\n+                    throw new RestAPIException(errorMsg);\n+                }\n \n             } catch (RemoteException e) {\n                 String errorMsg = \"Error while getting available autoscaling policies. Cause : \" + e.getMessage();\n                 log.error(errorMsg, e);\n                 throw new RestAPIException(errorMsg, e);\n             }\n         }\n-        \n-        if(autoscalePolicies.length == 0) {\n-        \tString errorMsg = \"Cannot find any auto-scaling policy.\";\n-            log.error(errorMsg);\n-            throw new RestAPIException(errorMsg);\n-        }\n-\n         return PojoConverter.populateAutoscalePojos(autoscalePolicies);\n     }\n \n@@ -417,19 +415,19 @@ public static AutoscalePolicy getAutoScalePolicy (String autoscalePolicyId) thro\n         if (autoscalerServiceClient != null) {\n             try {\n                 deploymentPolicies = autoscalerServiceClient.getDeploymentPolicies();\n-\n+                if(deploymentPolicies == null || deploymentPolicies.length == 0) {\n+                    String errorMsg = \"Cannot find any deployment policy.\";\n+                    log.error(errorMsg);\n+                    throw new RestAPIException(errorMsg);\n+                }\n             } catch (RemoteException e) {\n                 String errorMsg = \"Error getting available deployment policies. Cause : \" + e.getMessage();\n                 log.error(errorMsg, e);\n                 throw new RestAPIException(errorMsg, e);\n             }\n         }\n         \n-        if(deploymentPolicies.length == 0) {\n-        \tString errorMsg = \"Cannot find any deployment policy.\";\n-            log.error(errorMsg);\n-            throw new RestAPIException(errorMsg);\n-        }\n+\n \n         return PojoConverter.populateDeploymentPolicyPojos(deploymentPolicies);\n     }\n@@ -535,7 +533,7 @@ static Cartridge getAvailableCartridgeInfo(String cartridgeType, Boolean multiTe\n \t\t\t}\n \t\t}\n \t\t\n-\t\tif(lbCartridges.isEmpty()) {\n+\t\tif(lbCartridges == null || lbCartridges.isEmpty()) {\n \t\t\tString msg = \"Load balancer Cartridges are not available.\";\n \t        log.error(msg);\n \t        throw new RestAPIException(msg) ;",
                "deletions": 14
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing NPE in object conversion logic",
        "commit": "https://github.com/apache/attic-stratos/commit/d5b4136cf008cd1de65ed55fb9516cd21e932d11",
        "parent": "https://github.com/apache/attic-stratos/commit/363dd6ebfe2c880b41bc918b9bacdbecc88cac0e",
        "bug_id": "attic-stratos_42",
        "file": [
            {
                "sha": "a4b19c78c622ec1492bb18fc4bd031d9c3aee56c",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/util/converter/PojoConverter.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/d5b4136cf008cd1de65ed55fb9516cd21e932d11/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/util/converter/PojoConverter.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/d5b4136cf008cd1de65ed55fb9516cd21e932d11/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/util/converter/PojoConverter.java",
                "status": "modified",
                "changes": 36,
                "additions": 20,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/util/converter/PojoConverter.java?ref=d5b4136cf008cd1de65ed55fb9516cd21e932d11",
                "patch": "@@ -1124,16 +1124,18 @@ public static ApplicationDefinition convertApplicationContextToApplicationDefini\n         List<GroupDefinition> groupDefinitions = new ArrayList<GroupDefinition>();\n         if(groupContexts != null) {\n             for (GroupContext groupContext : groupContexts) {\n-                GroupDefinition groupDefinition = new GroupDefinition();\n-                groupDefinition.setAlias(groupContext.getAlias());\n-                groupDefinition.setGroupMaxInstances(groupContext.getGroupMaxInstances());\n-                groupDefinition.setGroupMinInstances(groupContext.getGroupMinInstances());\n-                groupDefinition.setGroupScalingEnabled(groupContext.getGroupScalingEnabled());\n-                groupDefinition.setName(groupContext.getName());\n-                groupDefinition.setGroups(convertGroupContextsToGroupDefinitions(groupContext.getGroupContexts()));\n-                groupDefinition.setCartridges(convertCartridgeContextsToCartridgeDefinitions(\n-                        groupContext.getCartridgeContexts()));\n-                groupDefinitions.add(groupDefinition);\n+                if(groupContext != null) {\n+                    GroupDefinition groupDefinition = new GroupDefinition();\n+                    groupDefinition.setAlias(groupContext.getAlias());\n+                    groupDefinition.setGroupMaxInstances(groupContext.getGroupMaxInstances());\n+                    groupDefinition.setGroupMinInstances(groupContext.getGroupMinInstances());\n+                    groupDefinition.setGroupScalingEnabled(groupContext.getGroupScalingEnabled());\n+                    groupDefinition.setName(groupContext.getName());\n+                    groupDefinition.setGroups(convertGroupContextsToGroupDefinitions(groupContext.getGroupContexts()));\n+                    groupDefinition.setCartridges(convertCartridgeContextsToCartridgeDefinitions(\n+                            groupContext.getCartridgeContexts()));\n+                    groupDefinitions.add(groupDefinition);\n+                }\n             }\n         }\n         return groupDefinitions;\n@@ -1164,12 +1166,14 @@ private static DependencyDefinitions convertDependencyContextsToDependencyDefini\n         List<CartridgeDefinition> cartridgeDefinitions = new ArrayList<CartridgeDefinition>();\n         if(cartridgeContexts != null) {\n             for (CartridgeContext cartridgeContext : cartridgeContexts) {\n-                CartridgeDefinition cartridgeDefinition = new CartridgeDefinition();\n-                cartridgeDefinition.setType(cartridgeContext.getType());\n-                cartridgeDefinition.setCartridgeMin(cartridgeContext.getCartridgeMin());\n-                cartridgeDefinition.setCartridgeMax(cartridgeContext.getCartridgeMax());\n-                cartridgeDefinition.setSubscribableInfo(convertSubscribableInfoContextToSubscribableInfo(cartridgeContext.getSubscribableInfoContext()));\n-                cartridgeDefinitions.add(cartridgeDefinition);\n+                if(cartridgeContext != null) {\n+                    CartridgeDefinition cartridgeDefinition = new CartridgeDefinition();\n+                    cartridgeDefinition.setType(cartridgeContext.getType());\n+                    cartridgeDefinition.setCartridgeMin(cartridgeContext.getCartridgeMin());\n+                    cartridgeDefinition.setCartridgeMax(cartridgeContext.getCartridgeMax());\n+                    cartridgeDefinition.setSubscribableInfo(convertSubscribableInfoContextToSubscribableInfo(cartridgeContext.getSubscribableInfoContext()));\n+                    cartridgeDefinitions.add(cartridgeDefinition);\n+                }\n             }\n         }\n         return cartridgeDefinitions;",
                "deletions": 16
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing NPEs in rest api cartridge methods",
        "commit": "https://github.com/apache/attic-stratos/commit/f4b2895197294338a710a0a1dde419c67a117eae",
        "parent": "https://github.com/apache/attic-stratos/commit/9e4b95c55769797f97d59b84b431a1b585ce3c4f",
        "bug_id": "attic-stratos_43",
        "file": [
            {
                "sha": "2e28c946392eab99898387b041201f80f6fc4347",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f4b2895197294338a710a0a1dde419c67a117eae/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f4b2895197294338a710a0a1dde419c67a117eae/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41.java",
                "status": "modified",
                "changes": 17,
                "additions": 10,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41.java?ref=f4b2895197294338a710a0a1dde419c67a117eae",
                "patch": "@@ -188,10 +188,12 @@ public Response getCartridgesByFilter(@DefaultValue(\"\") @PathParam(\"filter\") Str\n                                           @QueryParam(\"criteria\") String criteria) throws RestAPIException {\n         List<CartridgeDefinitionBean> cartridges = StratosApiV41Utils.\n                 getCartridgesByFilter(filter, criteria, getConfigContext());\n-        ResponseBuilder rb = Response.ok();\n-        rb.entity(cartridges.isEmpty() ?\n-                new CartridgeDefinitionBean[0] : cartridges.toArray(new CartridgeDefinitionBean[cartridges.size()]));\n-        return rb.build();\n+        if(cartridges == null) {\n+            return Response.status(Response.Status.NOT_FOUND).build();\n+        }\n+        CartridgeDefinitionBean[] cartridgeArray = cartridges.isEmpty() ?\n+                new CartridgeDefinitionBean[0] : cartridges.toArray(new CartridgeDefinitionBean[cartridges.size()]);\n+        return Response.ok().entity(cartridgeArray).build();\n     }\n \n     /**\n@@ -209,9 +211,10 @@ public Response getCartridgesByFilter(@DefaultValue(\"\") @PathParam(\"filter\") Str\n     public Response getCartridgeByFilter(@DefaultValue(\"\") @PathParam(\"filter\") String filter,\n                                          @PathParam(\"cartridgeType\") String cartridgeType) throws RestAPIException {\n         CartridgeDefinitionBean cartridge = StratosApiV41Utils.getCartridgeByFilter(filter, cartridgeType, getConfigContext());\n-        ResponseBuilder rb = Response.ok();\n-        rb.entity(cartridge);\n-        return rb.build();\n+        if(cartridge == null) {\n+            return Response.status(Response.Status.NOT_FOUND).build();\n+        }\n+        return Response.ok().entity(cartridge).build();\n     }\n \n     /**",
                "deletions": 7
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing NPE in cloud controller topology builder",
        "commit": "https://github.com/apache/attic-stratos/commit/9e4b95c55769797f97d59b84b431a1b585ce3c4f",
        "parent": "https://github.com/apache/attic-stratos/commit/d3012c4c1e1f793e1de3a4a36688c88148d031ba",
        "bug_id": "attic-stratos_44",
        "file": [
            {
                "sha": "27bb2bab32d45887bf261c9068a909a933d221db",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/topology/TopologyBuilder.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/9e4b95c55769797f97d59b84b431a1b585ce3c4f/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/topology/TopologyBuilder.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/9e4b95c55769797f97d59b84b431a1b585ce3c4f/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/topology/TopologyBuilder.java",
                "status": "modified",
                "changes": 5,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/topology/TopologyBuilder.java?ref=9e4b95c55769797f97d59b84b431a1b585ce3c4f",
                "patch": "@@ -740,13 +740,12 @@ public static void handleMemberTerminated(String serviceName, String clusterId,\n         }\n         \n         Member member = cluster.getMember(memberId);\n-        String instanceId = member.getInstanceId();\n-\n \t\tif (member == null) {\n-\t\t\tlog.warn(String.format(\"Member with member id %s does not exist\",\n+\t\t\tlog.warn(String.format(\"Member %s does not exist\",\n \t\t\t\t\tmemberId));\n \t\t\treturn;\n \t\t}\n+        String instanceId = member.getInstanceId();\n \n         try {\n             TopologyManager.acquireWriteLock();",
                "deletions": 3
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing NPE while listing cartridges",
        "commit": "https://github.com/apache/attic-stratos/commit/932c89eb848b36c8cf18e4152107fd363f0613cf",
        "parent": "https://github.com/apache/attic-stratos/commit/3bea806589aaf87622d6f751d72c9b4af678196f",
        "bug_id": "attic-stratos_45",
        "file": [
            {
                "sha": "62e36f2a1ce2535fc5a5613905aaa7b40fbb3286",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/services/ServiceUtils.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/932c89eb848b36c8cf18e4152107fd363f0613cf/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/services/ServiceUtils.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/932c89eb848b36c8cf18e4152107fd363f0613cf/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/services/ServiceUtils.java",
                "status": "modified",
                "changes": 5,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/services/ServiceUtils.java?ref=932c89eb848b36c8cf18e4152107fd363f0613cf",
                "patch": "@@ -477,11 +477,12 @@ static Cartridge getAvailableSingleTenantCartridgeInfo(String cartridgeType, Boo\n                     cartridge.setDefaultDeploymentPolicy(cartridgeInfo.getDefaultDeploymentPolicy());\n                     //cartridge.setStatus(CartridgeConstants.NOT_SUBSCRIBED);\n                     cartridge.setCartridgeAlias(\"-\");\n-                    for(Property property: cartridgeInfo.getLbConfig().getProperties().getProperties()) {\n+                    if(cartridgeInfo.getLbConfig() != null && cartridgeInfo.getLbConfig().getProperties() != null) {\n+                        for(Property property: cartridgeInfo.getLbConfig().getProperties().getProperties()) {\n                         if(property.getName().equals(\"load.balancer\")) {\n                             cartridge.setLoadBalancer(true);\n                         }\n-\n+                        }\n                     }\n                     //cartridge.setActiveInstances(0);\n                     cartridges.add(cartridge);",
                "deletions": 2
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "avoiding an NPE risk in VMClusterContext",
        "commit": "https://github.com/apache/attic-stratos/commit/3405862ece56a3f2fdb8749a8094999f0a976f69",
        "parent": "https://github.com/apache/attic-stratos/commit/22315f65e8ca53b00ec2ae771fc7a1ffdf9d8dfe",
        "bug_id": "attic-stratos_46",
        "file": [
            {
                "sha": "2f831783f032e7962ec977761da0f9bbef4578fa",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/VMClusterContext.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/3405862ece56a3f2fdb8749a8094999f0a976f69/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/VMClusterContext.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/3405862ece56a3f2fdb8749a8094999f0a976f69/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/VMClusterContext.java",
                "status": "modified",
                "changes": 9,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/VMClusterContext.java?ref=3405862ece56a3f2fdb8749a8094999f0a976f69",
                "patch": "@@ -172,15 +172,16 @@ private ClusterLevelNetworkPartitionContext parseDeploymentPolicy(\n             ChildPolicy childPolicy,\n             ClusterLevelNetworkPartitionContext clusterLevelNetworkPartitionContext)\n             throws PolicyValidationException, PartitionValidationException {\n-        if (log.isDebugEnabled()) {\n-            log.debug(\"Deployment policy name: \" + childPolicy.getId());\n-        }\n \n         if (childPolicy == null) {\n-            String msg = \"Deployment policy is null: [policy-name] \" + childPolicy.getId();\n+            String msg = \"Deployment policy is null\";\n             log.error(msg);\n             throw new PolicyValidationException(msg);\n         }\n+        \n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Deployment policy name: \" + childPolicy.getId());\n+        }\n \n         ChildLevelPartition[] childLevelPartitions = childPolicy.\n                 getChildLevelNetworkPartition(",
                "deletions": 4
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing merge conflicts and NPE s",
        "commit": "https://github.com/apache/attic-stratos/commit/f58c585989a5b19df0e026d43bdd29660a56c118",
        "parent": "https://github.com/apache/attic-stratos/commit/00a3e63397840f1d21c768bd763d3e8ec795d3cb",
        "bug_id": "attic-stratos_47",
        "file": [
            {
                "sha": "fbcea86cf4882ac62922fd2f7cf2bafb4e6862ca",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/Constants.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/Constants.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/Constants.java",
                "status": "modified",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/Constants.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -41,10 +41,10 @@\n     public static final String AUTOSCALER_CONFIG_FILE_NAME = \"autoscaler.xml\";\n \n     public static final String CLOUD_CONTROLLER_SERVICE_SFX = \"services/CloudControllerService\";\n-    public static final int CLOUD_CONTROLLER_DEFAULT_PORT = 9444;\n+    public static final int CLOUD_CONTROLLER_DEFAULT_PORT = 9443;\n \n     public static final String STRATOS_MANAGER_SERVICE_SFX = \"services/InstanceCleanupNotificationService\";\n-    public static final int STRATOS_MANAGER_DEFAULT_PORT = 9445;\n+    public static final int STRATOS_MANAGER_DEFAULT_PORT = 9443;\n     public static final String STRATOS_MANAGER_HOSTNAME_ELEMENT = \"autoscaler.stratosManager.hostname\";\n     public static final String STRATOS_MANAGER_DEFAULT_PORT_ELEMENT = \"autoscaler.stratosManager.port\";\n     public static final String STRATOS_MANAGER_CLIENT_TIMEOUT_ELEMENT= \"autoscaler.stratosManager.clientTimeout\";",
                "deletions": 2
            },
            {
                "sha": "37059fe36b401bd2b69bd624a97239c561567e97",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/api/AutoScalerServiceImpl.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/api/AutoScalerServiceImpl.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/api/AutoScalerServiceImpl.java",
                "status": "modified",
                "changes": 51,
                "additions": 30,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/api/AutoScalerServiceImpl.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -22,28 +22,27 @@\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.stratos.autoscaler.applications.ApplicationHolder;\n-import org.apache.stratos.autoscaler.context.AutoscalerContext;\n-//import org.apache.stratos.autoscaler.NetworkPartitionLbHolder;\n import org.apache.stratos.autoscaler.applications.parser.ApplicationParser;\n import org.apache.stratos.autoscaler.applications.parser.DefaultApplicationParser;\n import org.apache.stratos.autoscaler.applications.pojo.ApplicationContext;\n import org.apache.stratos.autoscaler.applications.topic.ApplicationBuilder;\n import org.apache.stratos.autoscaler.client.CloudControllerClient;\n-import org.apache.stratos.autoscaler.exception.*;\n+import org.apache.stratos.autoscaler.context.AutoscalerContext;\n+import org.apache.stratos.autoscaler.exception.AutoScalerException;\n+import org.apache.stratos.autoscaler.exception.InvalidArgumentException;\n import org.apache.stratos.autoscaler.exception.application.ApplicationDefinitionException;\n import org.apache.stratos.autoscaler.exception.kubernetes.*;\n import org.apache.stratos.autoscaler.exception.partition.PartitionValidationException;\n import org.apache.stratos.autoscaler.exception.policy.InvalidPolicyException;\n import org.apache.stratos.autoscaler.interfaces.AutoScalerServiceInterface;\n import org.apache.stratos.autoscaler.kubernetes.KubernetesManager;\n import org.apache.stratos.autoscaler.monitor.cluster.AbstractClusterMonitor;\n-import org.apache.stratos.autoscaler.pojo.policy.deployment.partition.network.ApplicationLevelNetworkPartition;\n-//import org.apache.stratos.autoscaler.pojo.policy.deployment.partition.PartitionManager;\n import org.apache.stratos.autoscaler.pojo.Dependencies;\n import org.apache.stratos.autoscaler.pojo.ServiceGroup;\n import org.apache.stratos.autoscaler.pojo.policy.PolicyManager;\n import org.apache.stratos.autoscaler.pojo.policy.autoscale.AutoscalePolicy;\n import org.apache.stratos.autoscaler.pojo.policy.deployment.DeploymentPolicy;\n+import org.apache.stratos.autoscaler.pojo.policy.deployment.partition.network.ApplicationLevelNetworkPartition;\n import org.apache.stratos.autoscaler.pojo.policy.deployment.partition.network.Partition;\n import org.apache.stratos.autoscaler.registry.RegistryManager;\n import org.apache.stratos.autoscaler.util.AutoscalerUtil;\n@@ -53,7 +52,6 @@\n import org.apache.stratos.common.kubernetes.KubernetesHost;\n import org.apache.stratos.common.kubernetes.KubernetesMaster;\n import org.apache.stratos.messaging.domain.applications.Application;\n-import org.apache.stratos.messaging.message.receiver.topology.TopologyManager;\n import org.apache.stratos.metadata.client.defaults.DefaultMetaDataServiceClient;\n import org.apache.stratos.metadata.client.defaults.MetaDataServiceClient;\n import org.apache.stratos.metadata.client.exception.MetaDataServiceClientException;\n@@ -63,13 +61,16 @@\n import java.util.ArrayList;\n import java.util.Map;\n \n+//import org.apache.stratos.autoscaler.NetworkPartitionLbHolder;\n+//import org.apache.stratos.autoscaler.pojo.policy.deployment.partition.PartitionManager;\n+\n /**\n  * Auto Scaler Service API is responsible getting Partitions and Policies.\n  */\n public class AutoScalerServiceImpl implements AutoScalerServiceInterface {\n \n     private static final Log log = LogFactory.getLog(AutoScalerServiceImpl.class);\n-//    PartitionManager partitionManager = PartitionManager.getInstance();\n+    //    PartitionManager partitionManager = PartitionManager.getInstance();\n     KubernetesManager kubernetesManager = KubernetesManager.getInstance();\n //\n //    public Partition[] getAllAvailablePartitions() {\n@@ -111,35 +112,43 @@\n //    }\n \n     @Override\n-    public boolean addDeploymentPolicy(DeploymentPolicy deploymentPolicy) throws InvalidPolicyException {\n-        boolean hasDeployed = PolicyManager.getInstance().deployDeploymentPolicy(deploymentPolicy);\n+    public String addDeploymentPolicy(DeploymentPolicy deploymentPolicy) throws InvalidPolicyException {\n+        String policyId = PolicyManager.getInstance().deployDeploymentPolicy(deploymentPolicy);\n         //Need to start the application Monitor after validation of the deployment policies.\n-\n+        //FIXME add validation\n         //Check whether all the clusters are there\n         ApplicationHolder.acquireReadLock();\n         boolean allClusterInitialized = false;\n-\n+        String appId = deploymentPolicy.getApplicationId();\n         try {\n             Application application = ApplicationHolder.getApplications().\n                     getApplication(deploymentPolicy.getApplicationId());\n-            if(application != null) {\n+            if (application != null) {\n+\n                 allClusterInitialized = AutoscalerUtil.allClustersInitialized(application);\n             }\n-\n         } finally {\n             ApplicationHolder.releaseReadLock();\n         }\n \n-        if(allClusterInitialized) {\n-            AutoscalerUtil.getInstance().\n-                    startApplicationMonitor(deploymentPolicy.getApplicationId());\n-\n+        if (!AutoscalerContext.getInstance().containsPendingMonitor(appId)\n+                                    || !AutoscalerContext.getInstance().monitorExists(appId)) {\n+            if(allClusterInitialized) {\n+                AutoscalerUtil.getInstance().\n+                        startApplicationMonitor(appId);\n+            } else {\n+                log.info(\"The application clusters are not yet created. \" +\n+                        \"Waiting for them to be created\");\n+            }\n         } else {\n-            log.info(\"The application clusters are not yet created. \" +\n-                    \"Waiting for them to be created\");\n+            log.info(\"The application Monitor has already been created for [Application] \" + appId);\n         }\n+        return policyId;\n+    }\n \n-        return hasDeployed;\n+    @Override\n+    public boolean undeployDeploymentPolicy(String applicationId) {\n+        return ApplicationBuilder.handleApplicationPolicyUndeployed(applicationId);\n     }\n \n     @Override\n@@ -240,7 +249,7 @@ public boolean updateKubernetesHost(KubernetesHost kubernetesHost) throws\n         return kubernetesManager.updateKubernetesHost(kubernetesHost);\n     }\n \n-//    @Override\n+    //    @Override\n     public Partition[] getPartitionsOfGroup(String deploymentPolicyId, String groupId) {\n         DeploymentPolicy depPol = this.getDeploymentPolicy(deploymentPolicyId);\n         if (null == depPol) {",
                "deletions": 21
            },
            {
                "sha": "7c9f792424bd90afd88e3908652ba17c0fde4f00",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/dependency/DependencyBuilder.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/dependency/DependencyBuilder.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/dependency/DependencyBuilder.java",
                "status": "modified",
                "changes": 8,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/dependency/DependencyBuilder.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -132,15 +132,15 @@ public DependencyTree buildDependency(ParentComponent component) throws Dependen\n             }\n \n             //Parsing the scaling order\n-            Set<ScalingOrder> scalingOrders = dependencyOrder.getScalingOrders();\n+            Set<ScalingDependentList> scalingDependentLists = dependencyOrder.getScalingDependentLists();\n \n-            if (scalingOrders != null) {\n-                for (ScalingOrder scalingOrder : scalingOrders) {\n+            if (scalingDependentLists != null) {\n+                for (ScalingDependentList scalingDependentList : scalingDependentLists) {\n                     foundContext = null;\n                     parentContext = null;\n \n \n-                    for (String scalingOrderComponent : scalingOrder.getScalingOrderComponentsList()) {\n+                    for (String scalingOrderComponent : scalingDependentList.getScalingDependentListComponents()) {\n \n \n                         if (scalingOrderComponent != null){",
                "deletions": 4
            },
            {
                "sha": "b95c7659783bc4e5592f5802e8b6ba2c237c1a75",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java",
                "status": "modified",
                "changes": 5,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -58,6 +58,7 @@\n \n     private Set<ApplicationClusterContext> applicationClusterContexts;\n     private Map<String, Properties> aliasToProperties;\n+ \tprivate Map<String, SubscribableInfoContext> subscribableInformation = new HashMap<String, SubscribableInfoContext>();\n \n     public DefaultApplicationParser () {\n         this.applicationClusterContexts = new HashSet<ApplicationClusterContext>();\n@@ -176,8 +177,7 @@ public Application parse(Object obj) throws ApplicationDefinitionException {\n \n \tprivate Map<String, SubscribableInfoContext> getSubscribableInfo(GroupContext[] groupContexts) throws\n     \t\tApplicationDefinitionException {\n-\t\t// map [cartridge alias -> Subscribable Information]\n-\t\tMap<String, SubscribableInfoContext> subscribableInformation = new HashMap<String, SubscribableInfoContext>();\n+\t\tif(groupContexts != null) {\n \t\tfor (GroupContext groupContext : groupContexts) {\n \t\t\tif (groupContext.getGroupContexts() != null) {\n \t\t\t\tgetSubscribableInfo(groupContext.getGroupContexts());\n@@ -204,6 +204,7 @@ public Application parse(Object obj) throws ApplicationDefinitionException {\n \t                }\n                 }\n \t\t\t}\n+\t\t  }\n \t\t}\n \t\treturn subscribableInformation;\n \t}",
                "deletions": 2
            },
            {
                "sha": "6fb76df268af62013b944b87e1cea0a383b8ad1f",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/topic/ApplicationBuilder.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/topic/ApplicationBuilder.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/topic/ApplicationBuilder.java",
                "status": "modified",
                "changes": 65,
                "additions": 52,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/topic/ApplicationBuilder.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -24,10 +24,14 @@\n import org.apache.stratos.autoscaler.applications.ApplicationHolder;\n import org.apache.stratos.autoscaler.applications.pojo.ApplicationClusterContext;\n import org.apache.stratos.autoscaler.client.CloudControllerClient;\n+import org.apache.stratos.autoscaler.event.publisher.ClusterStatusEventPublisher;\n import org.apache.stratos.autoscaler.monitor.component.ApplicationMonitor;\n import org.apache.stratos.autoscaler.monitor.component.GroupMonitor;\n+import org.apache.stratos.autoscaler.pojo.policy.PolicyManager;\n+import org.apache.stratos.autoscaler.pojo.policy.deployment.*;\n import org.apache.stratos.messaging.domain.applications.*;\n import org.apache.stratos.messaging.domain.instance.ApplicationInstance;\n+import org.apache.stratos.messaging.domain.instance.ClusterInstance;\n import org.apache.stratos.messaging.domain.instance.GroupInstance;\n import org.apache.stratos.messaging.domain.topology.Cluster;\n import org.apache.stratos.messaging.domain.topology.Service;\n@@ -142,7 +146,7 @@ public static void handleApplicationActivatedEvent(String appId, String instance\n \n     public static void handleApplicationUndeployed(String appId) {\n         if (log.isDebugEnabled()) {\n-            log.debug(\"Handling application terminating event: [application-id] \" + appId);\n+            log.debug(\"Handling application unDeployment for [application-id] \" + appId);\n         }\n         Set<ClusterDataHolder> clusterData;\n         ApplicationHolder.acquireWriteLock();\n@@ -154,6 +158,38 @@ public static void handleApplicationUndeployed(String appId) {\n                 log.warn(String.format(\"Application does not exist: [application-id] %s\",\n                         appId));\n                 return;\n+            } else {\n+                org.apache.stratos.autoscaler.pojo.policy.deployment.DeploymentPolicy policy =\n+                        PolicyManager.getInstance().getDeploymentPolicyByApplication(appId);\n+                if(policy != null) {\n+                    log.warn(String.format(\"Application has been found in the ApplicationsTopology\" +\n+                                    \": [application-id] %s, Please unDeploy the Application Policy.\",\n+                            appId));\n+                }\n+            }\n+            ApplicationHolder.removeApplication(appId);\n+\n+        } finally {\n+            ApplicationHolder.releaseWriteLock();\n+        }\n+\n+        log.info(\"[Application] \" + appId + \" has been successfully undeployed\");\n+    }\n+\n+    public static boolean handleApplicationPolicyUndeployed(String appId) {\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Handling application terminating event: [application-id] \" + appId);\n+        }\n+        Set<ClusterDataHolder> clusterData;\n+        ApplicationHolder.acquireWriteLock();\n+        try {\n+            Applications applications = ApplicationHolder.getApplications();\n+            Application application = applications.getApplication(appId);\n+            //update the status of the Group\n+            if (application == null) {\n+                log.warn(String.format(\"Application does not exist: [application-id] %s\",\n+                        appId));\n+                return false;\n             }\n             clusterData = application.getClusterDataRecursively();\n             Collection<ApplicationInstance> context = application.\n@@ -167,12 +203,11 @@ public static void handleApplicationUndeployed(String appId) {\n                     ApplicationHolder.persistApplication(application);\n                     ApplicationsEventPublisher.sendApplicationTerminatingEvent(appId, context1.getInstanceId());\n                 } else {\n-                    log.warn(String.format(\"Application state transition is not valid: [application-id] %s \" +\n+                    log.warn(String.format(\"Application Instance state transition is not valid: [application-id] %s \" +\n                                     \" [instance-id] %s [current-status] %s [status-requested] %s\", appId,\n                             context1.getInstanceId() + context1.getStatus(), status));\n                 }\n             }\n-\n         } finally {\n             ApplicationHolder.releaseWriteLock();\n         }\n@@ -188,11 +223,12 @@ public static void handleApplicationUndeployed(String appId) {\n                     if (service != null) {\n                         Cluster cluster = service.getCluster(aClusterData.getClusterId());\n                         if (cluster != null) {\n-                            //TODO travese thr cluster context\n-                            /*for() {\n-                                ClusterStatusEventPublisher.sendClusterTerminatingEvent(appId, aClusterData.getServiceType(),\n-                                        aClusterData.getClusterId(), null);\n-                            }*/\n+                            for(ClusterInstance instance : cluster.getInstanceIdToInstanceContextMap().values()) {\n+                                ClusterStatusEventPublisher.sendClusterTerminatingEvent(appId,\n+                                                                    aClusterData.getServiceType(),\n+                                                                    aClusterData.getClusterId(),\n+                                                                    instance.getInstanceId());\n+                            }\n                         }\n                     }\n                 } finally {\n@@ -202,9 +238,10 @@ public static void handleApplicationUndeployed(String appId) {\n \n             }\n         }\n+        return true;\n     }\n \n-    public static void handleApplicationTerminatedEvent(String appId) {\n+    public static void handleApplicationTerminatedEvent(String appId, String instanceId) {\n         if (log.isDebugEnabled()) {\n             log.debug(\"Handling application terminated event: [application-id] \" + appId);\n         }\n@@ -218,10 +255,10 @@ public static void handleApplicationTerminatedEvent(String appId) {\n             Set<ClusterDataHolder> clusterData = application.getClusterDataRecursively();\n \n             ApplicationStatus status = ApplicationStatus.Terminated;\n-            if (application.isStateTransitionValid(status, null)) {\n+            if (application.isStateTransitionValid(status, instanceId)) {\n                 //setting the status, persist and publish\n-                application.setStatus(status, null);\n-                updateApplicationMonitor(appId, status, null);\n+                application.setStatus(status, instanceId);\n+                updateApplicationMonitor(appId, status, instanceId);\n                 //removing the monitor\n                 AutoscalerContext.getInstance().removeAppMonitor(appId);\n                 //Removing the application from memory and registry\n@@ -231,7 +268,9 @@ public static void handleApplicationTerminatedEvent(String appId) {\n                 ApplicationsEventPublisher.sendApplicationTerminatedEvent(appId, clusterData);\n             } else {\n                 log.warn(String.format(\"Application state transition is not valid: [application-id] %s \" +\n-                        \" [current-status] %s [status-requested] %s\", appId, application.getStatus(null), status));\n+                        \" [current-status] %s [status-requested] %s\", appId,\n+                        application.getInstanceContexts(instanceId).getStatus(),\n+                        status));\n             }\n         }\n     }",
                "deletions": 13
            },
            {
                "sha": "1f4f6ca675b1168ba89fd018ca252083954b1de7",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/topic/ApplicationsEventPublisher.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/topic/ApplicationsEventPublisher.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/topic/ApplicationsEventPublisher.java",
                "status": "modified",
                "changes": 12,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/topic/ApplicationsEventPublisher.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -96,8 +96,8 @@ public static void sendApplicationInactivatedEvent(String appId, String instance\n         if (log.isInfoEnabled()) {\n             log.info(\"Publishing Application In-activated event for [application]: \" + appId);\n         }\n-        ApplicationInactivatedEvent applicationInActivatedEvent =\n-                new ApplicationInactivatedEvent(appId, instanceId);\n+        ApplicationInstanceInactivatedEvent applicationInActivatedEvent =\n+                new ApplicationInstanceInactivatedEvent(appId, instanceId);\n         publishEvent(applicationInActivatedEvent);\n \n     }\n@@ -106,17 +106,17 @@ public static void sendApplicationTerminatingEvent(String appId, String instance\n         if (log.isInfoEnabled()) {\n             log.info(\"Publishing Application terminating event for [application]: \" + appId);\n         }\n-        ApplicationTerminatingEvent applicationTerminatingEvent =\n-                new ApplicationTerminatingEvent(appId, instanceId);\n+        ApplicationInstanceTerminatingEvent applicationTerminatingEvent =\n+                new ApplicationInstanceTerminatingEvent(appId, instanceId);\n         publishEvent(applicationTerminatingEvent);\n     }\n \n     public static void sendApplicationTerminatedEvent(String appId, Set<ClusterDataHolder> clusterData) {\n         if (log.isInfoEnabled()) {\n             log.info(\"Publishing Application terminated event for [application]: \" + appId);\n         }\n-        ApplicationTerminatedEvent applicationTerminatedEvent =\n-                new ApplicationTerminatedEvent(appId, clusterData);\n+        ApplicationInstanceTerminatedEvent applicationTerminatedEvent =\n+                new ApplicationInstanceTerminatedEvent(appId, clusterData);\n         publishEvent(applicationTerminatedEvent);\n     }\n ",
                "deletions": 6
            },
            {
                "sha": "a8e275a71bef97853134040cdade8e0d79034f57",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/client/CloudControllerClient.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/client/CloudControllerClient.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/client/CloudControllerClient.java",
                "status": "modified",
                "changes": 9,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/client/CloudControllerClient.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -169,7 +169,7 @@ public synchronized boolean validatePartition(Partition partition) throws Partit\n \n     public synchronized MemberContext spawnAnInstance(Partition partition,\n                                                       String clusterId,\n-                                                      String networkPartitionId, boolean isPrimary,\n+                                                      String networkPartitionId,String instanceID, boolean isPrimary,\n                                                       int minMemberCount) throws SpawningException {\n         try {\n             if (log.isInfoEnabled()) {\n@@ -186,6 +186,7 @@ public synchronized MemberContext spawnAnInstance(Partition partition,\n             MemberContext member = new MemberContext();\n             member.setClusterId(clusterId);\n             member.setPartition(partition);\n+\t        member.setInstanceId(instanceID);\n //            member.setLbClusterId(lbClusterId);\n             member.setObsoleteExpiryTime(expiryTime);\n             member.setInitTime(System.currentTimeMillis());\n@@ -284,9 +285,11 @@ public synchronized void createApplicationClusters(String appId,\n \n     }\n \n-    public void createClusterInstance (String serviceType, String clusterId, String alias, String instanceId){\n+    public void createClusterInstance (String serviceType, String clusterId, String alias,\n+                                       String instanceId, String partitionId, String networkPartitionId){\n         try {\n-            stub.createClusterInstance(serviceType, clusterId, alias, instanceId);\n+            stub.createClusterInstance(serviceType, clusterId, alias, instanceId,\n+                    partitionId, networkPartitionId);\n \n         } catch (RemoteException e) {\n             String msg = e.getMessage();",
                "deletions": 3
            },
            {
                "sha": "2452255ebd7c25930b880e4b312892e5f2b15577",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/AutoscalerContext.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/AutoscalerContext.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/AutoscalerContext.java",
                "status": "modified",
                "changes": 29,
                "additions": 29,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/AutoscalerContext.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -20,7 +20,9 @@\n  */\n package org.apache.stratos.autoscaler.context;\n \n+import java.util.ArrayList;\n import java.util.HashMap;\n+import java.util.List;\n import java.util.Map;\n \n import org.apache.stratos.autoscaler.monitor.component.ApplicationMonitor;\n@@ -37,10 +39,13 @@\n     private Map<String, AbstractClusterMonitor> clusterMonitors;\n     // Map<ApplicationId, ApplicationMonitor>\n     private Map<String, ApplicationMonitor> applicationMonitors;\n+    //pending application monitors\n+    private List<String> pendingApplicationMonitors;\n \n     private AutoscalerContext() {\n         setClusterMonitors(new HashMap<String, AbstractClusterMonitor>());\n         setApplicationMonitors(new HashMap<String, ApplicationMonitor>());\n+        pendingApplicationMonitors = new ArrayList<String>();\n     }\n \n     public static AutoscalerContext getInstance() {\n@@ -86,4 +91,28 @@ public void setClusterMonitors(Map<String, AbstractClusterMonitor> clusterMonito\n     public void setApplicationMonitors(Map<String, ApplicationMonitor> applicationMonitors) {\n         this.applicationMonitors = applicationMonitors;\n     }\n+\n+    public List<String> getPendingApplicationMonitors() {\n+        return pendingApplicationMonitors;\n+    }\n+\n+    public void setPendingApplicationMonitors(List<String> pendingApplicationMonitors) {\n+        this.pendingApplicationMonitors = pendingApplicationMonitors;\n+    }\n+\n+    public void addPendingMonitor(String appId) {\n+        this.pendingApplicationMonitors.add(appId);\n+    }\n+\n+    public void removeFromPendingMonitors(String appId) {\n+        this.pendingApplicationMonitors.remove(appId);\n+    }\n+\n+    public boolean containsPendingMonitor(String appId) {\n+        return this.pendingApplicationMonitors.contains(appId);\n+    }\n+\n+    public boolean monitorExists(String appId) {\n+        return this.applicationMonitors.containsKey(appId);\n+    }\n }",
                "deletions": 0
            },
            {
                "sha": "c92ee73f71373744486e90f40a87008c4eaf2ffd",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/ClusterContextFactory.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/ClusterContextFactory.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/ClusterContextFactory.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/ClusterContextFactory.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -65,7 +65,7 @@ public static VMClusterContext getVMClusterContext(String instanceId, Cluster cl\n         DeploymentPolicy deploymentPolicy;\n         ApplicationHolder.acquireReadLock();\n         try {\n-            deploymentPolicy = PolicyManager.getInstance().getDeploymentPolicy(cluster.getAppId());\n+            deploymentPolicy = PolicyManager.getInstance().getDeploymentPolicyByApplication(cluster.getAppId());\n         } finally {\n             ApplicationHolder.releaseReadLock();\n         }",
                "deletions": 1
            },
            {
                "sha": "bf6a05177c83a6af872f65fdfa2625d772014d90",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/ClusterInstanceContext.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/ClusterInstanceContext.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/ClusterInstanceContext.java",
                "status": "modified",
                "changes": 3,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/ClusterInstanceContext.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -70,7 +70,8 @@\n \n     private String networkPartitionId;\n \n-    public ClusterInstanceContext(String clusterInstanceId, String partitionAlgo, ChildLevelPartition[] partitions,\n+    public ClusterInstanceContext(String clusterInstanceId, String partitionAlgo,\n+                                  ChildLevelPartition[] partitions,\n                                   int min, String networkPartitionId) {\n \n         super(clusterInstanceId);",
                "deletions": 1
            },
            {
                "sha": "9944f941bdc63234808c809fd37f8b73c360595e",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/VMClusterContext.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/VMClusterContext.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/VMClusterContext.java",
                "status": "modified",
                "changes": 58,
                "additions": 43,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/VMClusterContext.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -124,28 +124,41 @@ public void addInstanceContext(String instanceId, Cluster cluster)\n             throws PolicyValidationException, PartitionValidationException {\n         ClusterLevelNetworkPartitionContext networkPartitionContext = null;\n         ClusterInstance clusterInstance = cluster.getInstanceContexts(instanceId);\n+        ChildPolicy policy = this.deploymentPolicy.\n+                getChildPolicy(\n+                        AutoscalerUtil.getAliasFromClusterId(clusterId));\n         if (networkPartitionCtxts.containsKey(clusterInstance.getNetworkPartitionId())) {\n             networkPartitionContext = this.networkPartitionCtxts.get(\n                     clusterInstance.getNetworkPartitionId());\n+        } else {\n+            if(policy != null) {\n+                ChildLevelNetworkPartition networkPartition = policy.\n+                        getChildLevelNetworkPartition(clusterInstance.getNetworkPartitionId());\n+                networkPartitionContext = new ClusterLevelNetworkPartitionContext(networkPartition.getId(),\n+                        networkPartition.getPartitionAlgo(), 0);\n+            } else {\n+                //Parent should have the partition specified\n+                networkPartitionContext = new ClusterLevelNetworkPartitionContext(clusterInstance.getNetworkPartitionId(),\n+                        null, 0);\n+            }\n+\n         }\n \n         if (clusterInstance.getPartitionId() != null) {\n             //Need to add partition Context based on the given one from the parent\n             networkPartitionContext = addPartition(clusterInstance, cluster, networkPartitionContext);\n \n         } else {\n-            ChildPolicy policy = this.deploymentPolicy.\n-                    getChildPolicy(\n-                            AutoscalerUtil.getAliasFromClusterId(clusterId));\n             networkPartitionContext = parseDeploymentPolicy(clusterInstance, cluster,\n                     policy, networkPartitionContext);\n         }\n         if (!networkPartitionCtxts.containsKey(clusterInstance.getNetworkPartitionId())) {\n             this.networkPartitionCtxts.put(clusterInstance.getNetworkPartitionId(),\n                     networkPartitionContext);\n             if (log.isInfoEnabled()) {\n-                log.info(String.format(\"Network partition context has been added: \" +\n-                        \"[network partition] %s\", clusterInstance.getNetworkPartitionId()));\n+                log.info(String.format(\"Cluster instance context has been added to network partition, [cluster instance]\" +\n+                        \" %s [network partition] %s\", clusterInstance.getInstanceId(),\n+                        clusterInstance.getNetworkPartitionId()));\n             }\n         }\n \n@@ -154,27 +167,27 @@ public void addInstanceContext(String instanceId, Cluster cluster)\n     private ClusterLevelNetworkPartitionContext parseDeploymentPolicy(\n             ClusterInstance instance,\n             Cluster cluster,\n-            ChildPolicy deploymentPolicy,\n+            ChildPolicy childPolicy,\n             ClusterLevelNetworkPartitionContext clusterLevelNetworkPartitionContext)\n             throws PolicyValidationException, PartitionValidationException {\n         if (log.isDebugEnabled()) {\n-            log.debug(\"Deployment policy name: \" + deploymentPolicy.getId());\n+            log.debug(\"Deployment policy name: \" + childPolicy.getId());\n         }\n \n-        if (deploymentPolicy == null) {\n-            String msg = \"Deployment policy is null: [policy-name] \" + deploymentPolicy.getId();\n+        if (childPolicy == null) {\n+            String msg = \"Deployment policy is null: [policy-name] \" + childPolicy.getId();\n             log.error(msg);\n             throw new PolicyValidationException(msg);\n         }\n \n-        ChildLevelPartition[] childLevelPartitions = deploymentPolicy.\n+        ChildLevelPartition[] childLevelPartitions = childPolicy.\n                 getChildLevelNetworkPartition(\n                         clusterLevelNetworkPartitionContext.getId()).\n                 getChildLevelPartitions();\n         if (childLevelPartitions == null) {\n             String msg =\n                     \"Partitions are null in deployment policy: [policy-name]: \" +\n-                            deploymentPolicy.getId();\n+                            childPolicy.getId();\n             log.error(msg);\n             throw new PolicyValidationException(msg);\n         }\n@@ -188,7 +201,7 @@ private ClusterLevelNetworkPartitionContext parseDeploymentPolicy(\n \n \n         ChildLevelNetworkPartition networkPartition;\n-        networkPartition = deploymentPolicy.getChildLevelNetworkPartition(instance.getNetworkPartitionId());\n+        networkPartition = childPolicy.getChildLevelNetworkPartition(instance.getNetworkPartitionId());\n         String networkPartitionId = networkPartition.getId();\n \n         if (clusterLevelNetworkPartitionContext == null) {\n@@ -200,7 +213,19 @@ private ClusterLevelNetworkPartitionContext parseDeploymentPolicy(\n         if (clusterInstanceContext == null) {\n             clusterInstanceContext = new ClusterInstanceContext(instance.getInstanceId(),\n                     networkPartition.getPartitionAlgo(),\n-                    networkPartition.getChildLevelPartitions(), networkPartition.getMin(), networkPartitionId);\n+                    networkPartition.getChildLevelPartitions(), 2,\n+                    networkPartitionId);\n+            ApplicationHolder.acquireReadLock();\n+            try {\n+                Application application = ApplicationHolder.getApplications().\n+                        getApplication(cluster.getAppId());\n+                ClusterDataHolder dataHolder = application.\n+                        getClusterData(AutoscalerUtil.getAliasFromClusterId(clusterId));\n+                clusterInstanceContext.setMinMembers(2); //dataHolder.getMinInstances());\n+                clusterInstanceContext.setMaxMembers(2); //dataHolder.getMaxInstances());\n+            } finally {\n+                ApplicationHolder.releaseReadLock();\n+            }\n         }\n \n         for (ChildLevelPartition partition : networkPartition.getChildLevelPartitions()) {\n@@ -224,6 +249,8 @@ private ClusterLevelNetworkPartitionContext parseDeploymentPolicy(\n             }\n         }\n \n+        clusterLevelNetworkPartitionContext.addClusterInstanceContext(clusterInstanceContext);\n+\n         if (log.isInfoEnabled()) {\n             log.info(String.format(\"Network partition context has been added: \" +\n                     \"[network partition] %s\", clusterLevelNetworkPartitionContext.getId()));\n@@ -280,8 +307,8 @@ private ClusterLevelNetworkPartitionContext addPartition(\n             Application application = ApplicationHolder.getApplications().\n                     getApplication(cluster.getAppId());\n             ClusterDataHolder dataHolder = application.getClusterData(AutoscalerUtil.getAliasFromClusterId(clusterId));\n-            clusterInstanceContext.setMinMembers(dataHolder.getMinInstances());\n-            clusterInstanceContext.setMaxMembers(dataHolder.getMaxInstances());\n+            clusterInstanceContext.setMinMembers(2); //dataHolder.getMinInstances());\n+            clusterInstanceContext.setMaxMembers(2); //dataHolder.getMaxInstances());\n         } finally {\n             ApplicationHolder.releaseReadLock();\n         }\n@@ -290,6 +317,7 @@ private ClusterLevelNetworkPartitionContext addPartition(\n                     networkPartition.getPartitionAlgo(),\n                     networkPartition.getChildLevelPartitions(), networkPartition.getMin(), networkPartition.getId());\n         }\n+\n         clusterInstanceContext.addPartitionCtxt(clusterLevelPartitionContext);\n         clusterLevelNetworkPartitionContext.addClusterInstanceContext(clusterInstanceContext);\n ",
                "deletions": 15
            },
            {
                "sha": "e9c3cff77465331d5fafa8cfcbd62e6d0bf3eb7c",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/partition/ClusterLevelPartitionContext.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/partition/ClusterLevelPartitionContext.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/partition/ClusterLevelPartitionContext.java",
                "status": "modified",
                "changes": 1,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/partition/ClusterLevelPartitionContext.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -84,6 +84,7 @@ public ClusterLevelPartitionContext(long memberExpiryTime) {\n         super(memberExpiryTime);\n         this.activeMembers = new ArrayList<MemberContext>();\n         this.terminationPendingMembers = new ArrayList<MemberContext>();\n+        this.pendingMembers = new ArrayList<MemberContext>();\n     }\n     \n     public ClusterLevelPartitionContext(ChildLevelPartition childLevelPartition, Partition partition, int max) {",
                "deletions": 0
            },
            {
                "sha": "036228de25703dd7621de847d7fd8f5364a820db",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/partition/network/ClusterLevelNetworkPartitionContext.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/partition/network/ClusterLevelNetworkPartitionContext.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/partition/network/ClusterLevelNetworkPartitionContext.java",
                "status": "modified",
                "changes": 7,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/partition/network/ClusterLevelNetworkPartitionContext.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -103,10 +103,15 @@ public void addClusterInstanceContext(ClusterInstanceContext clusterInstanceCont\n         return instanceIdToClusterInstanceContextMap;\n     }\n \n-    public void setInstanceIdToClusterInstanceContextMap(Map<String, ClusterInstanceContext> instanceIdToClusterInstanceContextMap) {\n+    public void setInstanceIdToClusterInstanceContextMap(\n+            Map<String, ClusterInstanceContext> instanceIdToClusterInstanceContextMap) {\n         this.instanceIdToClusterInstanceContextMap = instanceIdToClusterInstanceContextMap;\n     }\n \n+    public boolean containsClusterInstanceContext(String instanceId) {\n+        return this.instanceIdToClusterInstanceContextMap.containsKey(instanceId);\n+    }\n+\n     public int getMin() {\n         return min;\n     }",
                "deletions": 1
            },
            {
                "sha": "ea68f329a158c6f24c2986a008d9a1e8739393cb",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/InstanceNotificationPublisher.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/InstanceNotificationPublisher.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/InstanceNotificationPublisher.java",
                "status": "modified",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/InstanceNotificationPublisher.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -39,9 +39,9 @@ private static void publish(Event event) {\n         instanceNotifyingEvent.publish(event);\n     }\n \n-    public static void sendInstanceCleanupEventForCluster(String clusterId) {\n+    public static void sendInstanceCleanupEventForCluster(String clusterId, String instanceId) {\n         log.info(String.format(\"Publishing Instance Cleanup Event: [cluster] %s\", clusterId));\n-        publish(new InstanceCleanupClusterEvent(clusterId));\n+        publish(new InstanceCleanupClusterEvent(clusterId, instanceId));\n     }\n \n     /**",
                "deletions": 2
            },
            {
                "sha": "75f7a2daf2863c1ed4f0b55ee460a7382e93b48b",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/health/AutoscalerHealthStatEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/health/AutoscalerHealthStatEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/health/AutoscalerHealthStatEventReceiver.java",
                "status": "modified",
                "changes": 31,
                "additions": 16,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/health/AutoscalerHealthStatEventReceiver.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -63,45 +63,38 @@\n import org.apache.stratos.messaging.message.receiver.health.stat.HealthStatEventReceiver;\n import org.apache.stratos.messaging.message.receiver.topology.TopologyManager;\n \n+import java.util.concurrent.ExecutorService;\n \n /**\n  * A thread for processing topology messages and updating the topology data structure.\n  */\n-public class AutoscalerHealthStatEventReceiver implements Runnable {\n+public class AutoscalerHealthStatEventReceiver {\n \n     private static final Log log = LogFactory.getLog(AutoscalerHealthStatEventReceiver.class);\n     private boolean terminated = false;\n \n     private HealthStatEventReceiver healthStatEventReceiver;\n+\tprivate ExecutorService executorService;\n \n     public AutoscalerHealthStatEventReceiver() {\n \t\tthis.healthStatEventReceiver = new HealthStatEventReceiver();\n         addEventListeners();\n     }\n \n-    @Override\n-    public void run() {\n+    public void execute() {\n         //FIXME this activated before autoscaler deployer activated.\n         try {\n             Thread.sleep(15000);\n         } catch (InterruptedException ignore) {\n         }\n-        Thread thread = new Thread(healthStatEventReceiver);\n-        thread.start();\n+\t    healthStatEventReceiver.setExecutorService(executorService);\n+        healthStatEventReceiver.execute();\n+\n         if(log.isInfoEnabled()) {\n             log.info(\"Autoscaler health stat event receiver thread started\");\n         }\n \n-        // Keep the thread live until terminated\n-        while (!terminated){\n-        \ttry {\n-                Thread.sleep(1000);\n-            } catch (InterruptedException ignore) {\n-            }\n-        }\n-        if(log.isInfoEnabled()) {\n-            log.info(\"Autoscaler health stat event receiver thread terminated\");\n-        }\n+\n     }\n \n     private void addEventListeners() {\n@@ -526,4 +519,12 @@ private Member getMemberByMemberId(String memberId) {\n     public void terminate() {\n         this.terminated = true;\n     }\n+\n+\tpublic ExecutorService getExecutorService() {\n+\t\treturn executorService;\n+\t}\n+\n+\tpublic void setExecutorService(ExecutorService executorService) {\n+\t\tthis.executorService = executorService;\n+\t}\n }",
                "deletions": 15
            },
            {
                "sha": "6251d1880212ea0e67bc1d4d2925d6eab8ff9eee",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "status": "modified",
                "changes": 215,
                "additions": 129,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -23,12 +23,16 @@\n import org.apache.commons.logging.LogFactory;\n import org.apache.stratos.autoscaler.applications.ApplicationHolder;\n import org.apache.stratos.autoscaler.context.AutoscalerContext;\n+import org.apache.stratos.autoscaler.context.cluster.AbstractClusterContext;\n import org.apache.stratos.autoscaler.context.cluster.ClusterContextFactory;\n import org.apache.stratos.autoscaler.context.cluster.VMClusterContext;\n import org.apache.stratos.autoscaler.event.publisher.ClusterStatusEventPublisher;\n import org.apache.stratos.autoscaler.event.publisher.InstanceNotificationPublisher;\n+import org.apache.stratos.autoscaler.exception.application.DependencyBuilderException;\n+import org.apache.stratos.autoscaler.exception.application.TopologyInConsistentException;\n import org.apache.stratos.autoscaler.exception.partition.PartitionValidationException;\n import org.apache.stratos.autoscaler.exception.policy.PolicyValidationException;\n+import org.apache.stratos.autoscaler.monitor.MonitorFactory;\n import org.apache.stratos.autoscaler.monitor.cluster.AbstractClusterMonitor;\n import org.apache.stratos.autoscaler.monitor.component.ApplicationMonitor;\n import org.apache.stratos.autoscaler.monitor.events.ClusterStatusEvent;\n@@ -39,6 +43,7 @@\n import org.apache.stratos.messaging.domain.applications.Application;\n import org.apache.stratos.messaging.domain.applications.Applications;\n import org.apache.stratos.messaging.domain.applications.ClusterDataHolder;\n+import org.apache.stratos.messaging.domain.instance.ClusterInstance;\n import org.apache.stratos.messaging.domain.topology.Cluster;\n import org.apache.stratos.messaging.domain.topology.ClusterStatus;\n import org.apache.stratos.messaging.domain.topology.Service;\n@@ -49,86 +54,36 @@\n import org.apache.stratos.messaging.message.receiver.topology.TopologyEventReceiver;\n import org.apache.stratos.messaging.message.receiver.topology.TopologyManager;\n \n+import java.util.concurrent.ExecutorService;\n+\n /**\n  * Autoscaler topology receiver.\n  */\n-public class AutoscalerTopologyEventReceiver implements Runnable {\n+public class AutoscalerTopologyEventReceiver {\n \n-    private static final Log log = LogFactory.getLog(AutoscalerTopologyEventReceiver.class);\n+\tprivate static final Log log = LogFactory.getLog(AutoscalerTopologyEventReceiver.class);\n \n-    private TopologyEventReceiver topologyEventReceiver;\n-    private boolean terminated;\n-    private boolean topologyInitialized;\n+\tprivate TopologyEventReceiver topologyEventReceiver;\n+\tprivate boolean terminated;\n+\tprivate boolean topologyInitialized;\n+\tprivate ExecutorService executorService;\n \n-    public AutoscalerTopologyEventReceiver() {\n-        this.topologyEventReceiver = new TopologyEventReceiver();\n-        addEventListeners();\n-    }\n+\tpublic AutoscalerTopologyEventReceiver() {\n+\t\tthis.topologyEventReceiver = new TopologyEventReceiver();\n+\t\taddEventListeners();\n+\t}\n \n-    @Override\n-    public void run() {\n-        //FIXME this activated before autoscaler deployer activated.\n-        /*try {\n-            Thread.sleep(15000);\n-        } catch (InterruptedException ignore) {\n-        }*/\n-        Thread thread = new Thread(topologyEventReceiver);\n-        thread.start();\n-        if (log.isInfoEnabled()) {\n-            log.info(\"Autoscaler topology receiver thread started\");\n-        }\n-\n-        // Keep the thread live until terminated\n-        while (!terminated) {\n-            try {\n-                Thread.sleep(1000);\n-            } catch (InterruptedException ignore) {\n-            }\n-        }\n-        if (log.isInfoEnabled()) {\n-            log.info(\"Autoscaler topology receiver thread terminated\");\n-        }\n-    }\n+\tpublic void execute() {\n+\t\t//FIXME this activated before autoscaler deployer activated.\n \n-    private boolean allClustersInitialized(Application application) {\n-        boolean allClustersInitialized = false;\n-        for (ClusterDataHolder holder : application.getClusterDataRecursively()) {\n-            TopologyManager.acquireReadLockForCluster(holder.getServiceType(),\n-                    holder.getClusterId());\n-\n-            try {\n-                Topology topology = TopologyManager.getTopology();\n-                if (topology != null) {\n-                    Service service = topology.getService(holder.getServiceType());\n-                    if (service != null) {\n-                        if (service.clusterExists(holder.getClusterId())) {\n-                            allClustersInitialized = true;\n-                            return allClustersInitialized;\n-                        } else {\n-                            if (log.isDebugEnabled()) {\n-                                log.debug(\"[Cluster] \" + holder.getClusterId() + \" is not found in \" +\n-                                        \"the Topology\");\n-                            }\n-                            allClustersInitialized = false;\n-                        }\n-                    } else {\n-                        if (log.isDebugEnabled()) {\n-                            log.debug(\"Service is null in the CompleteTopologyEvent\");\n-                        }\n-                    }\n-                } else {\n-                    if (log.isDebugEnabled()) {\n-                        log.debug(\"Topology is null in the CompleteTopologyEvent\");\n-                    }\n-                }\n-            } finally {\n-                TopologyManager.releaseReadLockForCluster(holder.getServiceType(),\n-                        holder.getClusterId());\n-            }\n-        }\n-        return allClustersInitialized;\n-    }\n+\t\ttopologyEventReceiver.setExecutorService(getExecutorService());\n+\t\ttopologyEventReceiver.execute();\n \n+\t\tif (log.isInfoEnabled()) {\n+\t\t\tlog.info(\"Autoscaler topology receiver thread started\");\n+\t\t}\n+\n+\t}\n \n     private void addEventListeners() {\n         // Listen to topology events that affect clusters\n@@ -142,7 +97,7 @@ protected void onEvent(Event event) {\n                         Applications applications = ApplicationHolder.getApplications();\n                         if (applications != null) {\n                             for (Application application : applications.getApplications().values()) {\n-                                if (allClustersInitialized(application)) {\n+                                if (AutoscalerUtil.allClustersInitialized(application)) {\n                                     DeploymentPolicy policy = PolicyManager.getInstance().\n                                             getDeploymentPolicyByApplication(\n                                                     application.getUniqueIdentifier());\n@@ -184,8 +139,13 @@ protected void onEvent(Event event) {\n                     try {\n                         //acquire read lock\n                         ApplicationHolder.acquireReadLock();\n-                        //start the application monitor\n-                        //startApplicationMonitor(appId);\n+                        //start the application monitor if the policy exists\n+                        DeploymentPolicy policy = PolicyManager.getInstance().\n+                                getDeploymentPolicyByApplication(appId);\n+                        if(policy != null && !AutoscalerContext.getInstance().\n+                                                containsPendingMonitor(appId)) {\n+                            AutoscalerUtil.getInstance().startApplicationMonitor(appId);\n+                        }\n                     } catch (Exception e) {\n                         String msg = \"Error processing event \" + e.getLocalizedMessage();\n                         log.error(msg, e);\n@@ -300,7 +260,7 @@ protected void onEvent(Event event) {\n                 if (monitor.getStatus() == ClusterStatus.Active) {\n                     // terminated gracefully\n                     monitor.setStatus(ClusterStatus.Terminating, instanceId);\n-                    InstanceNotificationPublisher.sendInstanceCleanupEventForCluster(clusterId);\n+                    InstanceNotificationPublisher.sendInstanceCleanupEventForCluster(clusterId, instanceId);\n                 } else {\n                     monitor.setStatus(ClusterStatus.Terminating, instanceId);\n                     monitor.terminateAllMembers();\n@@ -319,24 +279,31 @@ protected void onEvent(Event event) {\n                 String instanceId = clusterTerminatedEvent.getInstanceId();\n                 AutoscalerContext asCtx = AutoscalerContext.getInstance();\n                 AbstractClusterMonitor monitor;\n+                ApplicationMonitor appMonitor = null;\n                 monitor = asCtx.getClusterMonitor(clusterId);\n                 if (null == monitor) {\n                     if (log.isDebugEnabled()) {\n                         log.debug(String.format(\"A cluster monitor is not found in autoscaler context \"\n                                 + \"[cluster] %s\", clusterId));\n                     }\n                     // if the cluster monitor is null, assume that its termianted\n-                    ApplicationMonitor appMonitor = AutoscalerContext.getInstance().getAppMonitor(clusterTerminatedEvent.getAppId());\n+                    appMonitor = AutoscalerContext.getInstance().getAppMonitor(clusterTerminatedEvent.getAppId());\n                     if (appMonitor != null) {\n-                        appMonitor.onChildStatusEvent(new ClusterStatusEvent(ClusterStatus.Terminated, clusterId, null));\n+                        appMonitor.onChildStatusEvent(\n+                                new ClusterStatusEvent(ClusterStatus.Terminated,\n+                                                        clusterId, instanceId));\n                     }\n                     return;\n                 }\n                 //changing the status in the monitor, will notify its parent monitor\n                 monitor.setStatus(ClusterStatus.Terminated, instanceId);\n-                //Destroying and Removing the Cluster monitor\n-                monitor.destroy();\n-                AutoscalerContext.getInstance().removeClusterMonitor(clusterId);\n+                monitor.removeInstance(instanceId);\n+                if(!monitor.hasInstance() && appMonitor.isTerminating()) {\n+                    //Destroying and Removing the Cluster monitor\n+                    monitor.destroy();\n+                    AutoscalerContext.getInstance().removeClusterMonitor(clusterId);\n+                }\n+\n             }\n         });\n \n@@ -475,12 +442,23 @@ protected void onEvent(Event event) {\n                                        VMClusterContext clusterContext =\n                                                (VMClusterContext) clusterMonitor.getClusterContext();\n                                        if (clusterContext == null) {\n-                                           clusterMonitor.setClusterContext(\n-                                                   ClusterContextFactory.\n-                                                           getVMClusterContext(instanceId,\n-                                                                   cluster));\n+                                           clusterContext = ClusterContextFactory.\n+                                                   getVMClusterContext(instanceId,\n+                                                           cluster);\n+                                           clusterMonitor.setClusterContext(clusterContext);\n+\n                                        }\n                                        clusterContext.addInstanceContext(instanceId, cluster);\n+                                       if(clusterMonitor.getInstance(instanceId) == null) {\n+                                           ClusterInstance clusterInstance = cluster.\n+                                                   getInstanceContexts(instanceId);\n+                                           ClusterInstance instance = new ClusterInstance(clusterInstance.getAlias(),\n+                                                   cluster.getClusterId(),\n+                                                   clusterInstance.getInstanceId());\n+                                           instance.setParentId(clusterInstance.getParentId());\n+                                           instance.setStatus(clusterInstance.getStatus());\n+                                           clusterMonitor.addInstance(instance);\n+                                       }\n \n \n                                    }\n@@ -496,7 +474,7 @@ protected void onEvent(Event event) {\n                                }\n                            }\n \n-                       } else {\n+                        } else {\n                            log.error(\"Service \" + clusterInstanceCreatedEvent.getServiceName() +\n                                    \" not found, no cluster instance added to ClusterMonitor \" +\n                                    clusterInstanceCreatedEvent.getClusterId());\n@@ -509,7 +487,7 @@ protected void onEvent(Event event) {\n \n                } else {\n                    log.error(\"No Cluster Monitor found for cluster id \" +\n-                           clusterInstanceCreatedEvent.getClusterId());\n+                             clusterInstanceCreatedEvent.getClusterId());\n                }\n            }\n        }\n@@ -526,5 +504,70 @@ public void terminate() {\n         terminated = true;\n     }\n \n+\tpublic ExecutorService getExecutorService() {\n+\t\treturn executorService;\n+\t}\n+\n+\tpublic void setExecutorService(ExecutorService executorService) {\n+\t\tthis.executorService = executorService;\n+\t}\n+\n+\tprivate class ApplicationMonitorAdder implements Runnable {\n+\t\tprivate String appId;\n+\n+\t\tpublic ApplicationMonitorAdder(String appId) {\n+\t\t\tthis.appId = appId;\n+\t\t}\n+\n+\t\tpublic void run() {\n+\t\t\tApplicationMonitor applicationMonitor = null;\n+\t\t\tint retries = 5;\n+\t\t\tboolean success = false;\n+\t\t\tdo {\n+\t\t\t\ttry {\n+\t\t\t\t\tThread.sleep(5000);\n+\t\t\t\t} catch (InterruptedException e1) {\n+\t\t\t\t}\n+\t\t\t\ttry {\n+\t\t\t\t\tlong start = System.currentTimeMillis();\n+\t\t\t\t\tif (log.isDebugEnabled()) {\n+\t\t\t\t\t\tlog.debug(\"application monitor is going to be started for [application] \" +\n+\t\t\t\t\t\t          appId);\n+\t\t\t\t\t}\n+\t\t\t\t\ttry {\n+\t\t\t\t\t\tapplicationMonitor = MonitorFactory.getApplicationMonitor(appId);\n+\t\t\t\t\t} catch (PolicyValidationException e) {\n+\t\t\t\t\t\tString msg = \"Application monitor creation failed for Application: \";\n+\t\t\t\t\t\tlog.warn(msg, e);\n+\t\t\t\t\t\tretries--;\n+\t\t\t\t\t}\n+\t\t\t\t\tlong end = System.currentTimeMillis();\n+\t\t\t\t\tlog.info(\"Time taken to start app monitor: \" + (end - start) / 1000);\n+\t\t\t\t\tsuccess = true;\n+\t\t\t\t} catch (DependencyBuilderException e) {\n+\t\t\t\t\tString msg = \"Application monitor creation failed for Application: \";\n+\t\t\t\t\tlog.warn(msg, e);\n+\t\t\t\t\tretries--;\n+\t\t\t\t} catch (TopologyInConsistentException e) {\n+\t\t\t\t\tString msg = \"Application monitor creation failed for Application: \";\n+\t\t\t\t\tlog.warn(msg, e);\n+\t\t\t\t\tretries--;\n+\t\t\t\t}\n+\t\t\t} while (!success && retries != 0);\n+\n+\t\t\tif (applicationMonitor == null) {\n+\t\t\t\tString msg = \"Application monitor creation failed, even after retrying for 5 times, \"\n+\t\t\t\t             + \"for Application: \" + appId;\n+\t\t\t\tlog.error(msg);\n+\t\t\t\tthrow new RuntimeException(msg);\n+\t\t\t}\n+\n+\t\t\tAutoscalerContext.getInstance().addAppMonitor(applicationMonitor);\n+\t\t\tif (log.isInfoEnabled()) {\n+\t\t\t\tlog.info(String.format(\"Application monitor has been added successfully: \" +\n+\t\t\t\t                       \"[application] %s\", applicationMonitor.getId()));\n+\t\t\t}\n+\t\t}\n+\t}\n \n }",
                "deletions": 86
            },
            {
                "sha": "3626929e95602594293a5da22d6358621a4746bd",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/interfaces/AutoScalerServiceInterface.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/interfaces/AutoScalerServiceInterface.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/interfaces/AutoScalerServiceInterface.java",
                "status": "modified",
                "changes": 4,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/interfaces/AutoScalerServiceInterface.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -42,7 +42,9 @@\n \n     public DeploymentPolicy[] getAllDeploymentPolicies();\n \n-    public boolean addDeploymentPolicy(DeploymentPolicy depPolicy) throws InvalidPolicyException;\n+    public String addDeploymentPolicy(DeploymentPolicy depPolicy) throws InvalidPolicyException;\n+\n+    public boolean undeployDeploymentPolicy(String deploymentPolicyName);\n \n     public boolean updateDeploymentPolicy(DeploymentPolicy depPolicy) throws InvalidPolicyException;\n ",
                "deletions": 1
            },
            {
                "sha": "91d52d331c7cac46f33ce45215840870ed2ec2fe",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/internal/AutoscalerServerComponent.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/internal/AutoscalerServerComponent.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/internal/AutoscalerServerComponent.java",
                "status": "modified",
                "changes": 139,
                "additions": 78,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/internal/AutoscalerServerComponent.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -18,6 +18,7 @@\n  */\n package org.apache.stratos.autoscaler.internal;\n \n+import org.apache.commons.configuration.XMLConfiguration;\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n //import org.apache.stratos.autoscaler.NetworkPartitionLbHolder;\n@@ -33,16 +34,20 @@\n import org.apache.stratos.autoscaler.registry.RegistryManager;\n import org.apache.stratos.autoscaler.status.processor.cluster.ClusterStatusProcessorChain;\n import org.apache.stratos.autoscaler.status.processor.group.GroupStatusProcessorChain;\n+import org.apache.stratos.autoscaler.util.ConfUtil;\n import org.apache.stratos.autoscaler.util.ServiceReferenceHolder;\n import org.apache.stratos.cloud.controller.stub.domain.Partition;\n import org.apache.stratos.common.kubernetes.KubernetesGroup;\n+import org.apache.stratos.common.threading.StratosThreadPool;\n+import org.drools.reteoo.PartitionManager;\n import org.osgi.service.component.ComponentContext;\n import org.wso2.carbon.ntask.core.service.TaskService;\n import org.wso2.carbon.registry.api.RegistryException;\n import org.wso2.carbon.registry.core.service.RegistryService;\n \n import java.util.Iterator;\n import java.util.List;\n+import java.util.concurrent.ExecutorService;\n \n /**\n  * @scr.component name=org.apache.stratos.autoscaler.internal.AutoscalerServerComponent\"\n@@ -59,28 +64,39 @@\n \n public class AutoscalerServerComponent {\n \n-    private static final Log log = LogFactory.getLog(AutoscalerServerComponent.class);\n-\n-    private AutoscalerTopologyEventReceiver asTopologyReceiver;\n-    private AutoscalerHealthStatEventReceiver autoscalerHealthStatEventReceiver;\n-\n-    protected void activate(ComponentContext componentContext) throws Exception {\n-        try {\n-            // Start topology receiver\n-            asTopologyReceiver = new AutoscalerTopologyEventReceiver();\n-            Thread topologyTopicSubscriberThread = new Thread(asTopologyReceiver);\n-            topologyTopicSubscriberThread.start();\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Topology receiver thread started\");\n-            }\n-\n-            // Start health stat receiver\n-            autoscalerHealthStatEventReceiver = new AutoscalerHealthStatEventReceiver();\n-            Thread healthDelegatorThread = new Thread(autoscalerHealthStatEventReceiver);\n-            healthDelegatorThread.start();\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Health statistics receiver thread started\");\n-            }\n+\tprivate static final String THREAD_IDENTIFIER_KEY = \"threadPool.autoscaler.identifier\";\n+\tprivate static final String DEFAULT_IDENTIFIER = \"Auto-Scaler\";\n+\tprivate static final String THREAD_POOL_SIZE_KEY = \"threadPool.autoscaler.threadPoolSize\";\n+\tprivate static final String COMPONENTS_CONFIG = \"stratos-config\";\n+\tprivate static final int THREAD_POOL_SIZE = 10;\n+\tprivate static final Log log = LogFactory.getLog(AutoscalerServerComponent.class);\n+\n+\tprivate AutoscalerTopologyEventReceiver asTopologyReceiver;\n+\tprivate AutoscalerHealthStatEventReceiver autoscalerHealthStatEventReceiver;\n+\n+\n+\tprotected void activate(ComponentContext componentContext) throws Exception {\n+\t\ttry {\n+\t\t\t// Start topology receiver\n+\t\t\tXMLConfiguration conf = ConfUtil.getInstance(COMPONENTS_CONFIG).getConfiguration();\n+\t\t\tint threadPoolSize = conf.getInt(THREAD_POOL_SIZE_KEY, THREAD_POOL_SIZE);\n+\t\t\tString threadIdentifier = conf.getString(THREAD_IDENTIFIER_KEY, DEFAULT_IDENTIFIER);\n+\t\t\tExecutorService executorService = StratosThreadPool.getExecutorService(threadIdentifier, threadPoolSize);\n+\t\t\tasTopologyReceiver = new AutoscalerTopologyEventReceiver();\n+\t\t\tasTopologyReceiver.setExecutorService(executorService);\n+\t\t\tasTopologyReceiver.execute();\n+\n+\t\t\tif (log.isDebugEnabled()) {\n+\t\t\t\tlog.debug(\"Topology receiver executor service started\");\n+\t\t\t}\n+\n+\t\t\t// Start health stat receiver\n+\t\t\tautoscalerHealthStatEventReceiver = new AutoscalerHealthStatEventReceiver();\n+\t\t\tautoscalerHealthStatEventReceiver.setExecutorService(executorService);\n+\t\t\tautoscalerHealthStatEventReceiver.execute();\n+\t\t\tif (log.isDebugEnabled()) {\n+\t\t\t\tlog.debug(\"Health statistics receiver thread started\");\n+\t\t\t}\n \n             // Adding the registry stored partitions to the information model\n             List<Partition> partitions = RegistryManager.getInstance().retrievePartitions();\n@@ -89,59 +105,59 @@ protected void activate(ComponentContext componentContext) throws Exception {\n                 Partition partition = partitionIterator.next();\n //                PartitionManager.getInstance().addPartitionToInformationModel(partition);\n             }\n-            \n+\n             // Adding the network partitions stored in registry to the information model\n //            List<NetworkPartitionLbHolder> nwPartitionHolders = RegistryManager.getInstance().retrieveNetworkPartitionLbHolders();\n //            Iterator<NetworkPartitionLbHolder> nwPartitionIterator = nwPartitionHolders.iterator();\n //            while (nwPartitionIterator.hasNext()) {\n //                NetworkPartitionLbHolder nwPartition = nwPartitionIterator.next();\n //                PartitionManager.getInstance().addNetworkPartitionLbHolder(nwPartition);\n //            }\n-            \n+\n             List<AutoscalePolicy> asPolicies = RegistryManager.getInstance().retrieveASPolicies();\n             Iterator<AutoscalePolicy> asPolicyIterator = asPolicies.iterator();\n             while (asPolicyIterator.hasNext()) {\n                 AutoscalePolicy asPolicy = asPolicyIterator.next();\n                 PolicyManager.getInstance().addASPolicyToInformationModel(asPolicy);\n             }\n \n-            List<DeploymentPolicy> depPolicies = RegistryManager.getInstance().retrieveDeploymentPolicies();\n-            Iterator<DeploymentPolicy> depPolicyIterator = depPolicies.iterator();\n-            while (depPolicyIterator.hasNext()) {\n-                DeploymentPolicy depPolicy = depPolicyIterator.next();\n-                PolicyManager.getInstance().addDeploymentPolicyToInformationModel(depPolicy);\n-            }\n-\n-            // Adding KubernetesGroups stored in registry to the information model\n-            List<KubernetesGroup> kubernetesGroupList = RegistryManager.getInstance().retrieveKubernetesGroups();\n-            Iterator<KubernetesGroup> kubernetesGroupIterator = kubernetesGroupList.iterator();\n-            while (kubernetesGroupIterator.hasNext()) {\n-                KubernetesGroup kubernetesGroup = kubernetesGroupIterator.next();\n-                KubernetesManager.getInstance().addNewKubernetesGroup(kubernetesGroup);\n-            }\n-\n-            //starting the processor chain\n-            ClusterStatusProcessorChain clusterStatusProcessorChain = new ClusterStatusProcessorChain();\n-            ServiceReferenceHolder.getInstance().setClusterStatusProcessorChain(clusterStatusProcessorChain);\n-\n-            GroupStatusProcessorChain groupStatusProcessorChain = new GroupStatusProcessorChain();\n-            ServiceReferenceHolder.getInstance().setGroupStatusProcessorChain(groupStatusProcessorChain);\n-\n-            if (log.isInfoEnabled()) {\n-                log.info(\"Scheduling tasks to publish applications\");\n-            }\n-\n-            ApplicationSynchronizerTaskScheduler\n-                    .schedule(ServiceReferenceHolder.getInstance()\n-                            .getTaskService());\n-\n-            if (log.isInfoEnabled()) {\n-                log.info(\"Autoscaler server Component activated\");\n-            }\n-        } catch (Throwable e) {\n-            log.error(\"Error in activating the autoscaler component \", e);\n-        }\n-    }\n+\t\t\tList<DeploymentPolicy> depPolicies = RegistryManager.getInstance().retrieveDeploymentPolicies();\n+\t\t\tIterator<DeploymentPolicy> depPolicyIterator = depPolicies.iterator();\n+\t\t\twhile (depPolicyIterator.hasNext()) {\n+\t\t\t\tDeploymentPolicy depPolicy = depPolicyIterator.next();\n+\t\t\t\tPolicyManager.getInstance().addDeploymentPolicyToInformationModel(depPolicy);\n+\t\t\t}\n+\n+\t\t\t// Adding KubernetesGroups stored in registry to the information model\n+\t\t\tList<KubernetesGroup> kubernetesGroupList = RegistryManager.getInstance().retrieveKubernetesGroups();\n+\t\t\tIterator<KubernetesGroup> kubernetesGroupIterator = kubernetesGroupList.iterator();\n+\t\t\twhile (kubernetesGroupIterator.hasNext()) {\n+\t\t\t\tKubernetesGroup kubernetesGroup = kubernetesGroupIterator.next();\n+\t\t\t\tKubernetesManager.getInstance().addNewKubernetesGroup(kubernetesGroup);\n+\t\t\t}\n+\n+\t\t\t//starting the processor chain\n+\t\t\tClusterStatusProcessorChain clusterStatusProcessorChain = new ClusterStatusProcessorChain();\n+\t\t\tServiceReferenceHolder.getInstance().setClusterStatusProcessorChain(clusterStatusProcessorChain);\n+\n+\t\t\tGroupStatusProcessorChain groupStatusProcessorChain = new GroupStatusProcessorChain();\n+\t\t\tServiceReferenceHolder.getInstance().setGroupStatusProcessorChain(groupStatusProcessorChain);\n+\n+\t\t\tif (log.isInfoEnabled()) {\n+\t\t\t\tlog.info(\"Scheduling tasks to publish applications\");\n+\t\t\t}\n+\n+\t\t\tApplicationSynchronizerTaskScheduler\n+\t\t\t\t\t.schedule(ServiceReferenceHolder.getInstance()\n+\t\t\t\t\t                                .getTaskService());\n+\n+\t\t\tif (log.isInfoEnabled()) {\n+\t\t\t\tlog.info(\"Autoscaler server Component activated\");\n+\t\t\t}\n+\t\t} catch (Throwable e) {\n+\t\t\tlog.error(\"Error in activating the autoscaler component \", e);\n+\t\t}\n+\t}\n \n     protected void deactivate(ComponentContext context) {\n         asTopologyReceiver.terminate();\n@@ -182,3 +198,4 @@ protected void unsetTaskService(TaskService taskService) {\n         ServiceReferenceHolder.getInstance().setTaskService(null);\n     }\n }\n+",
                "deletions": 61
            },
            {
                "sha": "7f17a0721121564bf48eaa44c6cb80a18e484de2",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/Monitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/Monitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/Monitor.java",
                "status": "modified",
                "changes": 70,
                "additions": 70,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/Monitor.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -19,6 +19,12 @@\n package org.apache.stratos.autoscaler.monitor;\n \n import org.apache.stratos.autoscaler.monitor.component.ParentComponentMonitor;\n+import org.apache.stratos.messaging.domain.instance.Instance;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n \n /**\n  * Abstract class for the monitoring functionality in autoscaler.\n@@ -34,6 +40,12 @@\n     protected boolean hasStartupDependents;\n     //has scaling dependents\n     protected boolean hasGroupScalingDependent;\n+    //monitors map, key=InstanceId and value=ClusterInstance/GroupInstance/ApplicationInstance\n+    protected Map<String, Instance> instanceIdToInstanceMap;\n+\n+    public Monitor() {\n+        this.instanceIdToInstanceMap = new HashMap<String, Instance>();\n+    }\n \n     /**\n      * Return the id of the monitor\n@@ -125,4 +137,62 @@ public void setHasStartupDependents(boolean hasDependent) {\n     public void setHasGroupScalingDependent(boolean hasDependent) {\n         this.hasGroupScalingDependent = hasDependent;\n     }\n+\n+    /**\n+     * This will add the instance\n+     *\n+     * @param instance instance to be added\n+     */\n+    public void addInstance(Instance instance) {\n+        this.instanceIdToInstanceMap.put(instance.getInstanceId(), instance);\n+\n+    }\n+\n+    /**\n+     * Using instanceId, instance can be retrieved\n+     *\n+     * @param instanceId instance id\n+     * @return the instance\n+     */\n+    public Instance getInstance(String instanceId) {\n+        return this.instanceIdToInstanceMap.get(instanceId);\n+    }\n+\n+    /**\n+     * This will remove the instance\n+     *\n+     * @param instanceId instance id\n+     */\n+    public void removeInstance(String instanceId) {\n+        this.instanceIdToInstanceMap.remove(instanceId);\n+    }\n+\n+    /**\n+     * This will return all the instances which has the same parent id as given\n+     *\n+     * @param parentInstanceId parent instance id\n+     * @return all the instances\n+     */\n+    public List<String> getInstancesByParentInstanceId(String parentInstanceId) {\n+        List<String> instances = new ArrayList<String>();\n+        for (Instance instance : this.instanceIdToInstanceMap.values()) {\n+            if (instance.getParentId().equals(parentInstanceId)) {\n+                instances.add(instance.getInstanceId());\n+            }\n+        }\n+        return instances;\n+    }\n+\n+    /**\n+     * This will check whether instances are there in the map\n+     *\n+     * @return true/false\n+     */\n+    public boolean hasInstance() {\n+        if (this.instanceIdToInstanceMap.isEmpty()) {\n+            return true;\n+        } else {\n+            return false;\n+        }\n+    }\n }",
                "deletions": 0
            },
            {
                "sha": "63e2b4a5c774565ecd2386255fac42126ef469a8",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/MonitorFactory.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/MonitorFactory.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/MonitorFactory.java",
                "status": "modified",
                "changes": 27,
                "additions": 22,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/MonitorFactory.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -18,6 +18,8 @@\n  */\n package org.apache.stratos.autoscaler.monitor;\n \n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n import org.apache.stratos.autoscaler.applications.ApplicationHolder;\n import org.apache.stratos.autoscaler.applications.dependency.context.ApplicationChildContext;\n import org.apache.stratos.autoscaler.applications.dependency.context.ClusterChildContext;\n@@ -38,6 +40,7 @@\n import org.apache.stratos.messaging.domain.applications.Group;\n import org.apache.stratos.messaging.domain.instance.ApplicationInstance;\n import org.apache.stratos.messaging.domain.instance.GroupInstance;\n+import org.apache.stratos.messaging.domain.instance.Instance;\n import org.apache.stratos.messaging.domain.topology.Cluster;\n import org.apache.stratos.messaging.domain.topology.Service;\n import org.apache.stratos.messaging.domain.topology.Topology;\n@@ -49,6 +52,8 @@\n  * Factory class to get the Monitors.\n  */\n public class MonitorFactory {\n+    private static final Log log = LogFactory.getLog(MonitorFactory.class);\n+\n \n     /**\n      * Factor method used to create relevant monitors based on the given context\n@@ -81,9 +86,20 @@ public static Monitor getMonitor(ParentComponentMonitor parentMonitor,\n                         addClusterMonitor((AbstractClusterMonitor) monitor);\n                 // FIXME: passing null as alias for cluster instance temporarily. should be removed.\n                 for(String parentInstanceId : parentInstanceIds) {\n-                    createClusterInstance(clusterChildCtxt.getServiceName(),\n-                            clusterMonitor.getClusterId(), null,\n-                            parentInstanceId);\n+                    Instance instance = parentMonitor.getInstance(parentInstanceId);\n+                    String partitionId = null;\n+                    if(instance instanceof GroupInstance) {\n+                        partitionId = ((GroupInstance)instance).getPartitionId();\n+                    }\n+                    if(instance != null) {\n+                        createClusterInstance(clusterChildCtxt.getServiceName(),\n+                                clusterMonitor.getClusterId(), null,\n+                                parentInstanceId, partitionId,\n+                                instance.getNetworkPartitionId());\n+                    } else {\n+\n+                    }\n+\n                 }\n \n             }\n@@ -94,8 +110,9 @@ public static Monitor getMonitor(ParentComponentMonitor parentMonitor,\n     }\n \n     private static void createClusterInstance(String serviceType, String clusterId, String alias,\n-                                              String instanceId) {\n-        CloudControllerClient.getInstance().createClusterInstance(serviceType, clusterId, alias, instanceId);\n+                                              String instanceId, String partitionId, String networkPartitionId) {\n+        CloudControllerClient.getInstance().createClusterInstance(serviceType, clusterId, alias,\n+                instanceId, partitionId, networkPartitionId);\n     }\n \n     /**",
                "deletions": 5
            },
            {
                "sha": "b094a12ac5a8430400be0c791e10dc8cdd1c7bc3",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/AbstractClusterMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/AbstractClusterMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/AbstractClusterMonitor.java",
                "status": "modified",
                "changes": 19,
                "additions": 9,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/AbstractClusterMonitor.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -30,6 +30,7 @@\n import org.apache.stratos.autoscaler.monitor.events.MonitorStatusEvent;\n import org.apache.stratos.autoscaler.rule.AutoscalerRuleEvaluator;\n import org.apache.stratos.common.Properties;\n+import org.apache.stratos.common.constants.StratosConstants;\n import org.apache.stratos.messaging.domain.applications.Application;\n import org.apache.stratos.messaging.domain.applications.ApplicationStatus;\n import org.apache.stratos.messaging.domain.applications.Group;\n@@ -63,18 +64,20 @@\n     protected boolean stop = false;\n     private AtomicBoolean monitoringStarted;\n     protected AbstractClusterContext clusterContext;\n+\n+    protected StatefulKnowledgeSession minCheckKnowledgeSession;\n+    protected StatefulKnowledgeSession obsoleteCheckKnowledgeSession;\n+    protected StatefulKnowledgeSession scaleCheckKnowledgeSession;\n+    protected StatefulKnowledgeSession dependentScaleCheckKnowledgeSession;\n+\n     private String clusterId;\n     private ClusterStatus status;\n     private int monitoringIntervalMilliseconds;\n-    private StatefulKnowledgeSession minCheckKnowledgeSession;\n-    private StatefulKnowledgeSession obsoleteCheckKnowledgeSession;\n-    private StatefulKnowledgeSession scaleCheckKnowledgeSession;\n-    private StatefulKnowledgeSession dependentScaleCheckKnowledgeSession;\n     private boolean isDestroyed;\n-    private AutoscalerRuleEvaluator autoscalerRuleEvaluator;\n+    protected AutoscalerRuleEvaluator autoscalerRuleEvaluator;\n     protected String serviceType;\n \n-    protected AbstractClusterMonitor(String serviceType, String clusterId, AutoscalerRuleEvaluator autoscalerRuleEvaluator) {\n+    protected AbstractClusterMonitor(String serviceType, String clusterId) {\n \n         super();\n         this.serviceType = serviceType;\n@@ -83,10 +86,6 @@ protected AbstractClusterMonitor(String serviceType, String clusterId, Autoscale\n         this.monitoringStarted = new AtomicBoolean(false);\n         //this.clusterContext = abstractClusterContext;\n         //this.instanceIdToClusterContextMap = new HashMap<String, AbstractClusterContext>();\n-        this.obsoleteCheckKnowledgeSession = autoscalerRuleEvaluator.getObsoleteCheckStatefulSession();\n-        this.scaleCheckKnowledgeSession = autoscalerRuleEvaluator.getScaleCheckStatefulSession();\n-        this.minCheckKnowledgeSession = autoscalerRuleEvaluator.getMinCheckStatefulSession();\n-        this.dependentScaleCheckKnowledgeSession = autoscalerRuleEvaluator.getMinCheckStatefulSession();\n         this.status = ClusterStatus.Created;\n     }\n ",
                "deletions": 10
            },
            {
                "sha": "8297e557c04bfdab7c03f1a518656d0596c239f8",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/KubernetesClusterMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/KubernetesClusterMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/KubernetesClusterMonitor.java",
                "status": "modified",
                "changes": 31,
                "additions": 22,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/KubernetesClusterMonitor.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -25,7 +25,9 @@\n import org.apache.stratos.autoscaler.client.CloudControllerClient;\n import org.apache.stratos.autoscaler.exception.cartridge.TerminationException;\n import org.apache.stratos.autoscaler.rule.AutoscalerRuleEvaluator;\n+import org.apache.stratos.common.constants.StratosConstants;\n import org.apache.stratos.messaging.domain.topology.Cluster;\n+import org.apache.stratos.messaging.domain.topology.ClusterStatus;\n import org.apache.stratos.messaging.domain.topology.Member;\n import org.apache.stratos.messaging.domain.topology.Service;\n import org.apache.stratos.messaging.event.health.stat.AverageLoadAverageEvent;\n@@ -51,6 +53,7 @@\n import org.apache.stratos.messaging.event.topology.MemberStartedEvent;\n import org.apache.stratos.messaging.event.topology.MemberTerminatedEvent;\n import org.apache.stratos.messaging.message.receiver.topology.TopologyManager;\n+import org.drools.runtime.StatefulKnowledgeSession;\n \n /*\n  * Every kubernetes cluster monitor should extend this class\n@@ -59,12 +62,28 @@\n \n     private static final Log log = LogFactory.getLog(KubernetesClusterMonitor.class);\n \n-    private KubernetesClusterContext kubernetesClusterCtxt;\n+    private StatefulKnowledgeSession dependentScaleCheckKnowledgeSession;\n \n     protected KubernetesClusterMonitor(String serviceType, String clusterId,\n                                        AutoscalerRuleEvaluator autoscalerRuleEvaluator) {\n \n-        super(serviceType, clusterId, autoscalerRuleEvaluator);\n+        super(serviceType, clusterId);\n+\n+        autoscalerRuleEvaluator = new AutoscalerRuleEvaluator();\n+        autoscalerRuleEvaluator.parseAndBuildKnowledgeBaseForDroolsFile(StratosConstants.CONTAINER_OBSOLETE_CHECK_DROOL_FILE);\n+        autoscalerRuleEvaluator.parseAndBuildKnowledgeBaseForDroolsFile(StratosConstants.CONTAINER_SCALE_CHECK_DROOL_FILE);\n+        autoscalerRuleEvaluator.parseAndBuildKnowledgeBaseForDroolsFile(StratosConstants.CONTAINER_MIN_CHECK_DROOL_FILE);\n+        autoscalerRuleEvaluator.parseAndBuildKnowledgeBaseForDroolsFile(StratosConstants.DEPENDENT_SCALE_CHECK_DROOL_FILE);\n+\n+        this.obsoleteCheckKnowledgeSession = autoscalerRuleEvaluator.getStatefulSession(\n+                StratosConstants.CONTAINER_OBSOLETE_CHECK_DROOL_FILE);\n+        this.scaleCheckKnowledgeSession = autoscalerRuleEvaluator.getStatefulSession(\n+                StratosConstants.CONTAINER_SCALE_CHECK_DROOL_FILE);\n+        this.minCheckKnowledgeSession = autoscalerRuleEvaluator.getStatefulSession(\n+                StratosConstants.CONTAINER_MIN_CHECK_DROOL_FILE);\n+        this.dependentScaleCheckKnowledgeSession = autoscalerRuleEvaluator.getStatefulSession(\n+                StratosConstants.DEPENDENT_SCALE_CHECK_DROOL_FILE);\n+\n         //this.kubernetesClusterCtxt = kubernetesClusterContext;\n     }\n \n@@ -467,15 +486,9 @@ public void handleClusterRemovedEvent(\n     }\n \n     public KubernetesClusterContext getKubernetesClusterCtxt() {\n-        return kubernetesClusterCtxt;\n+        return (KubernetesClusterContext) getClusterContext();\n     }\n \n-    public void setKubernetesClusterCtxt(\n-            KubernetesClusterContext kubernetesClusterCtxt) {\n-        this.kubernetesClusterCtxt = kubernetesClusterCtxt;\n-    }\n-\n-\n     private Member getMemberByMemberId(String memberId) {\n         try {\n             TopologyManager.acquireReadLock();",
                "deletions": 9
            },
            {
                "sha": "e744cb8d4abe3c2c4fd4a7d888b12a3a7799975d",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/KubernetesServiceClusterMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/KubernetesServiceClusterMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/KubernetesServiceClusterMonitor.java",
                "status": "modified",
                "changes": 17,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/KubernetesServiceClusterMonitor.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -47,10 +47,7 @@\n \n     public KubernetesServiceClusterMonitor(String serviceType, String clusterId) {\n         super(serviceType, clusterId,\n-                new AutoscalerRuleEvaluator(\n-                        StratosConstants.CONTAINER_MIN_CHECK_DROOL_FILE,\n-                        StratosConstants.CONTAINER_OBSOLETE_CHECK_DROOL_FILE,\n-                        StratosConstants.CONTAINER_SCALE_CHECK_DROOL_FILE));\n+                new AutoscalerRuleEvaluator());\n         readConfigurations();\n     }\n \n@@ -114,7 +111,7 @@ private void scaleCheck(String instanceId) {\n                 log.debug(String.format(\n                         \"Running scale check for [kub-cluster] : %s [cluster] : %s \", kubernetesClusterID, getClusterId()));\n             }\n-            scaleCheckFactHandle = AutoscalerRuleEvaluator.evaluateScaleCheck(\n+            scaleCheckFactHandle = AutoscalerRuleEvaluator.evaluate(\n                     getScaleCheckKnowledgeSession(), scaleCheckFactHandle, getKubernetesClusterCtxt());\n             getKubernetesClusterCtxt().setRifReset(false);\n             getKubernetesClusterCtxt().setMemoryConsumptionReset(false);\n@@ -137,19 +134,19 @@ private void minCheck() {\n             log.debug(String.format(\n                     \"Running min check for [kub-cluster] : %s [cluster] : %s \", kubernetesClusterID, getClusterId()));\n         }\n-        minCheckFactHandle = AutoscalerRuleEvaluator.evaluateMinCheck(\n+        minCheckFactHandle = AutoscalerRuleEvaluator.evaluate(\n                 getMinCheckKnowledgeSession(), minCheckFactHandle,\n                 getKubernetesClusterCtxt());\n     }\n \n     private void obsoleteCheck() {\n-        getMinCheckKnowledgeSession().setGlobal(\"clusterId\", getClusterId());\n+        getObsoleteCheckKnowledgeSession().setGlobal(\"clusterId\", getClusterId());\n         String kubernetesClusterID = getKubernetesClusterCtxt().getKubernetesClusterID();\n         if (log.isDebugEnabled()) {\n             log.debug(String.format(\n                     \"Running obsolete check for [kub-cluster] : %s [cluster] : %s \", kubernetesClusterID, getClusterId()));\n         }\n-        obsoleteCheckFactHandle = AutoscalerRuleEvaluator.evaluateMinCheck(\n+        obsoleteCheckFactHandle = AutoscalerRuleEvaluator.evaluate(\n                 getObsoleteCheckKnowledgeSession(), obsoleteCheckFactHandle,\n                 getKubernetesClusterCtxt());\n     }\n@@ -178,9 +175,7 @@ protected void readConfigurations() {\n \n     @Override\n     public String toString() {\n-        return \"KubernetesServiceClusterMonitor \"\n-                + \"[ kubernetesHostClusterId=\" + getKubernetesClusterCtxt().getKubernetesClusterID()\n-                + \", clusterId=\" + getClusterId() + \"]\";\n+        return \"KubernetesServiceClusterMonitor for \" + \"[ clusterId=\" + getClusterId() + \"]\";\n     }\n \n     public String getLbReferenceType() {",
                "deletions": 11
            },
            {
                "sha": "2744361163fa066f4e6158dec8b5d3174b18b03a",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/VMClusterMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/VMClusterMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/VMClusterMonitor.java",
                "status": "modified",
                "changes": 281,
                "additions": 147,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/VMClusterMonitor.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -18,45 +18,45 @@\n  */\n package org.apache.stratos.autoscaler.monitor.cluster;\n \n-import java.util.*;\n-\n import org.apache.commons.configuration.XMLConfiguration;\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.stratos.autoscaler.client.CloudControllerClient;\n import org.apache.stratos.autoscaler.context.cluster.ClusterInstanceContext;\n import org.apache.stratos.autoscaler.context.cluster.VMClusterContext;\n import org.apache.stratos.autoscaler.context.member.MemberStatsContext;\n-import org.apache.stratos.autoscaler.context.partition.network.ClusterLevelNetworkPartitionContext;\n import org.apache.stratos.autoscaler.context.partition.ClusterLevelPartitionContext;\n+import org.apache.stratos.autoscaler.context.partition.network.ClusterLevelNetworkPartitionContext;\n import org.apache.stratos.autoscaler.event.publisher.ClusterStatusEventPublisher;\n import org.apache.stratos.autoscaler.exception.InvalidArgumentException;\n import org.apache.stratos.autoscaler.exception.cartridge.TerminationException;\n import org.apache.stratos.autoscaler.monitor.events.MonitorScalingEvent;\n import org.apache.stratos.autoscaler.monitor.events.MonitorStatusEvent;\n import org.apache.stratos.autoscaler.monitor.events.builder.MonitorStatusEventBuilder;\n import org.apache.stratos.autoscaler.rule.AutoscalerRuleEvaluator;\n-import org.apache.stratos.autoscaler.status.processor.StatusChecker;\n+import org.apache.stratos.autoscaler.status.processor.cluster.ClusterStatusTerminatedProcessor;\n+import org.apache.stratos.autoscaler.status.processor.cluster.ClusterStatusActiveProcessor;\n+import org.apache.stratos.autoscaler.status.processor.cluster.ClusterStatusInActiveProcessor;\n import org.apache.stratos.autoscaler.util.AutoScalerConstants;\n import org.apache.stratos.autoscaler.util.AutoscalerUtil;\n import org.apache.stratos.autoscaler.util.ConfUtil;\n+import org.apache.stratos.autoscaler.util.ServiceReferenceHolder;\n import org.apache.stratos.cloud.controller.stub.domain.MemberContext;\n import org.apache.stratos.common.Properties;\n import org.apache.stratos.common.Property;\n import org.apache.stratos.common.constants.StratosConstants;\n import org.apache.stratos.messaging.domain.applications.ApplicationStatus;\n import org.apache.stratos.messaging.domain.applications.GroupStatus;\n import org.apache.stratos.messaging.domain.topology.Cluster;\n+import org.apache.stratos.messaging.domain.topology.ClusterStatus;\n import org.apache.stratos.messaging.domain.topology.Member;\n import org.apache.stratos.messaging.domain.topology.Service;\n import org.apache.stratos.messaging.event.health.stat.*;\n-import org.apache.stratos.messaging.event.topology.ClusterRemovedEvent;\n-import org.apache.stratos.messaging.event.topology.MemberActivatedEvent;\n-import org.apache.stratos.messaging.event.topology.MemberMaintenanceModeEvent;\n-import org.apache.stratos.messaging.event.topology.MemberReadyToShutdownEvent;\n-import org.apache.stratos.messaging.event.topology.MemberStartedEvent;\n-import org.apache.stratos.messaging.event.topology.MemberTerminatedEvent;\n+import org.apache.stratos.messaging.event.topology.*;\n import org.apache.stratos.messaging.message.receiver.topology.TopologyManager;\n+import org.drools.runtime.StatefulKnowledgeSession;\n+\n+import java.util.*;\n \n /**\n  * Is responsible for monitoring a service cluster. This runs periodically\n@@ -71,20 +71,40 @@\n     private float scalingFactorBasedOnDependencies = 1.0f;\n \n     protected VMClusterMonitor(String serviceType, String clusterId) {\n-        super(serviceType, clusterId, new AutoscalerRuleEvaluator(\n-                StratosConstants.VM_MIN_CHECK_DROOL_FILE,\n-                StratosConstants.VM_OBSOLETE_CHECK_DROOL_FILE,\n-                StratosConstants.VM_SCALE_CHECK_DROOL_FILE));\n+        super(serviceType, clusterId);\n         this.networkPartitionIdToClusterLevelNetworkPartitionCtxts = new HashMap<String, ClusterLevelNetworkPartitionContext>();\n \n         readConfigurations();\n+        autoscalerRuleEvaluator = new AutoscalerRuleEvaluator();\n+        autoscalerRuleEvaluator.parseAndBuildKnowledgeBaseForDroolsFile(StratosConstants.VM_OBSOLETE_CHECK_DROOL_FILE);\n+        autoscalerRuleEvaluator.parseAndBuildKnowledgeBaseForDroolsFile(StratosConstants.VM_SCALE_CHECK_DROOL_FILE);\n+        autoscalerRuleEvaluator.parseAndBuildKnowledgeBaseForDroolsFile(StratosConstants.VM_MIN_CHECK_DROOL_FILE);\n+        //autoscalerRuleEvaluator.parseAndBuildKnowledgeBaseForDroolsFile(StratosConstants.DEPENDENT_SCALE_CHECK_DROOL_FILE);\n+\n+        this.obsoleteCheckKnowledgeSession = autoscalerRuleEvaluator.getStatefulSession(\n+                StratosConstants.VM_OBSOLETE_CHECK_DROOL_FILE);\n+        this.scaleCheckKnowledgeSession = autoscalerRuleEvaluator.getStatefulSession(\n+                StratosConstants.VM_SCALE_CHECK_DROOL_FILE);\n+        this.minCheckKnowledgeSession = autoscalerRuleEvaluator.getStatefulSession(\n+                StratosConstants.VM_MIN_CHECK_DROOL_FILE);\n+        /*this.dependentScaleCheckKnowledgeSession = autoscalerRuleEvaluator.getStatefulSession(\n+                StratosConstants.DEPENDENT_SCALE_CHECK_DROOL_FILE);*/\n     }\n \n-    public void addClusterLevelNWPartitionContext (ClusterLevelNetworkPartitionContext clusterLevelNWPartitionCtxt) {\n+    private static void terminateMember(String memberId) {\n+        try {\n+            CloudControllerClient.getInstance().terminate(memberId);\n+\n+        } catch (TerminationException e) {\n+            log.error(\"Unable to terminate member [member id ] \" + memberId, e);\n+        }\n+    }\n+\n+    public void addClusterLevelNWPartitionContext(ClusterLevelNetworkPartitionContext clusterLevelNWPartitionCtxt) {\n         networkPartitionIdToClusterLevelNetworkPartitionCtxts.put(clusterLevelNWPartitionCtxt.getId(), clusterLevelNWPartitionCtxt);\n     }\n \n-    public ClusterLevelNetworkPartitionContext getClusterLevelNWPartitionContext (String nwPartitionId) {\n+    public ClusterLevelNetworkPartitionContext getClusterLevelNWPartitionContext(String nwPartitionId) {\n         return networkPartitionIdToClusterLevelNetworkPartitionCtxts.get(nwPartitionId);\n     }\n \n@@ -164,109 +184,110 @@ private boolean isPrimaryMember(MemberContext memberContext) {\n \n     public void monitor() {\n \n-        final Collection<ClusterLevelNetworkPartitionContext> clusterLevelNetworkPartitionContexts =\n-                ((VMClusterContext) this.clusterContext).getNetworkPartitionCtxts().values();\n+        for (ClusterLevelNetworkPartitionContext networkPartitionContext : getNetworkPartitionCtxts()) {\n \n-        Runnable monitoringRunnable = new Runnable() {\n-            @Override\n-            public void run() {\n+            final Collection<ClusterInstanceContext> clusterInstanceContexts = networkPartitionContext.\n+                    getClusterInstanceContextMap().values();\n \n-                for (ClusterLevelNetworkPartitionContext networkPartitionContext :\n-                        clusterLevelNetworkPartitionContexts) {\n+            for (final ClusterInstanceContext instanceContext : clusterInstanceContexts ) {\n \n-                    for (ClusterInstanceContext instanceContext : networkPartitionContext.\n-                            getClusterInstanceContextMap().values()) {\n+                Runnable monitoringRunnable = new Runnable() {\n+                    @Override\n+                    public void run() {\n \n-                        // store primary members in the cluster instance context\n-                        List<String> primaryMemberListInClusterInstance = new ArrayList<String>();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Monitor is running for [cluster] : \" + getClusterId());\n+                    }\n \n-                        //FIXME to check the status of the instance\n-                        if (true) {\n+                    // store primary members in the cluster instance context\n+                    List<String> primaryMemberListInClusterInstance = new ArrayList<String>();\n \n-                            for (ClusterLevelPartitionContext partitionContext : instanceContext.getPartitionCtxts()) {\n+                    //FIXME to check the status of the instance\n+                    if (true) {\n \n-                                // get active primary members in this cluster instance context\n-                                for (MemberContext memberContext : partitionContext.getActiveMembers()) {\n-                                    if (isPrimaryMember(memberContext)) {\n-                                        primaryMemberListInClusterInstance.add(memberContext.getMemberId());\n-                                    }\n-                                }\n+                        for (ClusterLevelPartitionContext partitionContext : instanceContext.getPartitionCtxts()) {\n \n-                                // get pending primary members in this cluster instance context\n-                                for (MemberContext memberContext : partitionContext.getPendingMembers()) {\n-                                    if (isPrimaryMember(memberContext)) {\n-                                        primaryMemberListInClusterInstance.add(memberContext.getMemberId());\n-                                    }\n+                            // get active primary members in this cluster instance context\n+                            for (MemberContext memberContext : partitionContext.getActiveMembers()) {\n+                                if (isPrimaryMember(memberContext)) {\n+                                    primaryMemberListInClusterInstance.add(memberContext.getMemberId());\n                                 }\n                             }\n \n-                            getMinCheckKnowledgeSession().setGlobal(\"clusterId\", getClusterId());\n-                            getMinCheckKnowledgeSession().setGlobal(\"isPrimary\", hasPrimary);\n-                            getMinCheckKnowledgeSession().setGlobal(\"algorithmName\",\n-                                    networkPartitionContext.getPartitionAlgorithm());\n-\n-                            if (log.isDebugEnabled()) {\n-                                log.debug(String.format(\"Running minimum check for cluster instance %s \",\n-                                        instanceContext.getId()));\n+                            // get pending primary members in this cluster instance context\n+                            for (MemberContext memberContext : partitionContext.getPendingMembers()) {\n+                                if (isPrimaryMember(memberContext)) {\n+                                    primaryMemberListInClusterInstance.add(memberContext.getMemberId());\n+                                }\n                             }\n+                        }\n \n-                            minCheckFactHandle = AutoscalerRuleEvaluator.evaluateMinCheck(getMinCheckKnowledgeSession(),\n-                                    minCheckFactHandle, instanceContext);\n+                        getMinCheckKnowledgeSession().setGlobal(\"clusterId\", getClusterId());\n+                        getMinCheckKnowledgeSession().setGlobal(\"isPrimary\", hasPrimary);\n+                        getMinCheckKnowledgeSession().setGlobal(\"algorithmName\",\n+                                instanceContext.getPartitionAlgorithm());\n \n-                            obsoleteCheckFactHandle = AutoscalerRuleEvaluator.evaluateObsoleteCheck(\n-                                    getObsoleteCheckKnowledgeSession(), obsoleteCheckFactHandle, instanceContext);\n+                        if (log.isDebugEnabled()) {\n+                            log.debug(String.format(\"Running minimum check for cluster instance %s \",\n+                                    instanceContext.getId()));\n+                        }\n \n-                            //checking the status of the cluster\n-                            boolean rifReset = instanceContext.isRifReset();\n-                            boolean memoryConsumptionReset = instanceContext.isMemoryConsumptionReset();\n-                            boolean loadAverageReset = instanceContext.isLoadAverageReset();\n+                        minCheckFactHandle = AutoscalerRuleEvaluator.evaluate(getMinCheckKnowledgeSession(),\n+                                minCheckFactHandle, instanceContext);\n \n-                            if (log.isDebugEnabled()) {\n-                                log.debug(\"Is rif Reset: \" + rifReset\n-                                        + \" Is memoryConsumption Reset: \" + memoryConsumptionReset\n-                                        + \" Is loadAverage Reset: \" + loadAverageReset);\n-                            }\n-                            if (rifReset || memoryConsumptionReset || loadAverageReset) {\n+                        obsoleteCheckFactHandle = AutoscalerRuleEvaluator.evaluate(\n+                                getObsoleteCheckKnowledgeSession(), obsoleteCheckFactHandle, instanceContext);\n \n+                        //checking the status of the cluster\n+                        boolean rifReset = instanceContext.isRifReset();\n+                        boolean memoryConsumptionReset = instanceContext.isMemoryConsumptionReset();\n+                        boolean loadAverageReset = instanceContext.isLoadAverageReset();\n \n-                                VMClusterContext vmClusterContext = (VMClusterContext) clusterContext;\n+                        if (log.isDebugEnabled()) {\n+                            log.debug(\"Execution point of scaling Rule, [Is rif Reset] : \" + rifReset\n+                                    + \" [Is memoryConsumption Reset] : \" + memoryConsumptionReset\n+                                    + \" [Is loadAverage Reset] : \" + loadAverageReset);\n+                        }\n+                        if (rifReset || memoryConsumptionReset || loadAverageReset) {\n \n-                                getScaleCheckKnowledgeSession().setGlobal(\"instance\", instanceContext);\n-                                getScaleCheckKnowledgeSession().setGlobal(\"clusterId\", getClusterId());\n-                                getScaleCheckKnowledgeSession().setGlobal(\"autoscalePolicy\",\n-                                        vmClusterContext.getAutoscalePolicy());\n-                                getScaleCheckKnowledgeSession().setGlobal(\"rifReset\", rifReset);\n-                                getScaleCheckKnowledgeSession().setGlobal(\"mcReset\", memoryConsumptionReset);\n-                                getScaleCheckKnowledgeSession().setGlobal(\"laReset\", loadAverageReset);\n-                                getScaleCheckKnowledgeSession().setGlobal(\"isPrimary\", false);\n-                                getScaleCheckKnowledgeSession().setGlobal(\"primaryMembers\", primaryMemberListInClusterInstance);\n \n-                                if (log.isDebugEnabled()) {\n-                                    log.debug(String.format(\"Running scale check for network partition %s \",\n-                                            networkPartitionContext.getId()));\n-                                    log.debug(\" Primary members : \" + primaryMemberListInClusterInstance);\n-                                }\n+                            VMClusterContext vmClusterContext = (VMClusterContext) clusterContext;\n \n-                                scaleCheckFactHandle = AutoscalerRuleEvaluator.evaluateScaleCheck(getScaleCheckKnowledgeSession()\n-                                        , scaleCheckFactHandle, networkPartitionContext);\n+                            getScaleCheckKnowledgeSession().setGlobal(\"instance\", instanceContext);\n+                            getScaleCheckKnowledgeSession().setGlobal(\"clusterId\", getClusterId());\n+                            getScaleCheckKnowledgeSession().setGlobal(\"autoscalePolicy\",\n+                                    vmClusterContext.getAutoscalePolicy());\n+                            getScaleCheckKnowledgeSession().setGlobal(\"rifReset\", rifReset);\n+                            getScaleCheckKnowledgeSession().setGlobal(\"mcReset\", memoryConsumptionReset);\n+                            getScaleCheckKnowledgeSession().setGlobal(\"laReset\", loadAverageReset);\n+                            getScaleCheckKnowledgeSession().setGlobal(\"isPrimary\", false);\n+                            getScaleCheckKnowledgeSession().setGlobal(\"primaryMembers\", primaryMemberListInClusterInstance);\n+                            getMinCheckKnowledgeSession().setGlobal(\"algorithmName\",\n+                                    instanceContext.getPartitionAlgorithm());\n \n-                                instanceContext.setRifReset(false);\n-                                instanceContext.setMemoryConsumptionReset(false);\n-                                instanceContext.setLoadAverageReset(false);\n-                            } else if (log.isDebugEnabled()) {\n-                                log.debug(String.format(\"Scale rule will not run since the LB statistics have not \" +\n-                                        \"received before this cycle for network partition %s\",\n-                                        networkPartitionContext.getId()));\n+                            if (log.isDebugEnabled()) {\n+                                log.debug(String.format(\"Running scale check for [cluster instance context] %s \",\n+                                        instanceContext.getId()));\n+                                log.debug(\" Primary members : \" + primaryMemberListInClusterInstance);\n                             }\n \n+                            scaleCheckFactHandle = AutoscalerRuleEvaluator.evaluate(getScaleCheckKnowledgeSession()\n+                                    , scaleCheckFactHandle, instanceContext);\n \n+                            instanceContext.setRifReset(false);\n+                            instanceContext.setMemoryConsumptionReset(false);\n+                            instanceContext.setLoadAverageReset(false);\n+                        } else if (log.isDebugEnabled()) {\n+                            log.debug(String.format(\"Scale rule will not run since the LB statistics have not \" +\n+                                            \"received before this cycle for [cluster instance context] %s \",\n+                                    instanceContext.getId()));\n                         }\n                     }\n-                }\n-\n+                    }\n+                };\n+                monitoringRunnable.run();\n             }\n-        };\n-        monitoringRunnable.run();\n+        }\n     }\n \n     @Override\n@@ -291,13 +312,6 @@ public void destroy() {\n         }\n     }\n \n-    @Override\n-    public String toString() {\n-        return \"VMClusterMonitor [clusterId=\" + getClusterId() +\n-//                \", lbReferenceType=\" + lbReferenceType +\n-                \", hasPrimary=\" + hasPrimary + \" ]\";\n-    }\n-\n //    public String getLbReferenceType() {\n //        return lbReferenceType;\n //    }\n@@ -306,6 +320,13 @@ public String toString() {\n //        this.lbReferenceType = lbReferenceType;\n //    }\n \n+    @Override\n+    public String toString() {\n+        return \"VMClusterMonitor [clusterId=\" + getClusterId() +\n+//                \", lbReferenceType=\" + lbReferenceType +\n+                \", hasPrimary=\" + hasPrimary + \" ]\";\n+    }\n+\n     public boolean isHasPrimary() {\n         return hasPrimary;\n     }\n@@ -351,30 +372,29 @@ public void onParentScalingEvent(MonitorScalingEvent scalingEvent) {\n         VMClusterContext vmClusterContext = (VMClusterContext) clusterContext;\n         String instanceId = scalingEvent.getInstanceId();\n \n-        ClusterInstanceContext clusterLevelNetworkPartitionContext =\n+        ClusterInstanceContext clusterInstanceContext =\n                 getClusterInstanceContext(scalingEvent.getNetworkPartitionId(), instanceId);\n \n \n         //TODO get min instance count from instance context\n-        float requiredInstanceCount = 0 ;/* = clusterLevelNetworkPartitionContext.getMinInstanceCount() * scalingFactorBasedOnDependencies;*/\n+        float requiredInstanceCount = clusterInstanceContext.getMinInstanceCount() * scalingFactorBasedOnDependencies;\n         int roundedRequiredInstanceCount = getRoundedInstanceCount(requiredInstanceCount,\n                 vmClusterContext.getAutoscalePolicy().getInstanceRoundingFactor());\n-        clusterLevelNetworkPartitionContext.setRequiredInstanceCountBasedOnDependencies(roundedRequiredInstanceCount);\n+        clusterInstanceContext.setRequiredInstanceCountBasedOnDependencies(roundedRequiredInstanceCount);\n \n         getDependentScaleCheckKnowledgeSession().setGlobal(\"clusterId\", getClusterId());\n-        getDependentScaleCheckKnowledgeSession().setGlobal(\"scalingFactor\", scalingFactorBasedOnDependencies);\n-        getDependentScaleCheckKnowledgeSession().setGlobal(\"instanceRoundingFactor\",\n-                vmClusterContext.getAutoscalePolicy().getInstanceRoundingFactor());\n+        getDependentScaleCheckKnowledgeSession().setGlobal(\"roundedRequiredInstanceCount\", roundedRequiredInstanceCount);\n \n-        dependentScaleCheckFactHandle = AutoscalerRuleEvaluator.evaluateScaleCheck(getScaleCheckKnowledgeSession()\n-                , scaleCheckFactHandle, clusterLevelNetworkPartitionContext);\n+        dependentScaleCheckFactHandle = AutoscalerRuleEvaluator.evaluate(getScaleCheckKnowledgeSession()\n+                , scaleCheckFactHandle, clusterInstanceContext);\n \n     }\n \n     public void sendClusterScalingEvent(String networkPartitionId, float factor) {\n \n         MonitorStatusEventBuilder.handleClusterScalingEvent(this.parent, networkPartitionId, factor, this.id);\n     }\n+\n     @Override\n     public void handleGradientOfLoadAverageEvent(\n             GradientOfLoadAverageEvent gradientOfLoadAverageEvent) {\n@@ -412,7 +432,7 @@ public void handleSecondDerivativeOfLoadAverageEvent(\n                     + \"[network-partition] %s [value] %s\", clusterId, networkPartitionId, value));\n         }\n         ClusterInstanceContext clusterLevelNetworkPartitionContext = getClusterInstanceContext(instanceId,\n-                                                                        networkPartitionId);\n+                networkPartitionId);\n         if (null != clusterLevelNetworkPartitionContext) {\n             clusterLevelNetworkPartitionContext.setLoadAverageSecondDerivative(value);\n         } else {\n@@ -511,7 +531,7 @@ public void handleAverageRequestsServingCapabilityEvent(\n \n         ClusterInstanceContext clusterLevelNetworkPartitionContext = getClusterInstanceContext(instanceId,\n                 networkPartitionId);\n-        if(null != clusterLevelNetworkPartitionContext){\n+        if (null != clusterLevelNetworkPartitionContext) {\n             clusterLevelNetworkPartitionContext.setAverageRequestsServedPerInstance(floatValue);\n \n         } else {\n@@ -612,7 +632,7 @@ public void handleMemberAverageMemoryConsumptionEvent(\n         ClusterInstanceContext networkPartitionCtxt = getClusterInstanceContext(instanceId,\n                 networkPartitionId);\n         ClusterLevelPartitionContext partitionCtxt = networkPartitionCtxt.getPartitionCtxt(\n-                                                                member.getPartitionId());\n+                member.getPartitionId());\n         MemberStatsContext memberStatsContext = partitionCtxt.getMemberStatsContext(memberId);\n         if (null == memberStatsContext) {\n             if (log.isDebugEnabled()) {\n@@ -635,7 +655,7 @@ public void handleMemberGradientOfMemoryConsumptionEvent(\n         ClusterInstanceContext networkPartitionCtxt = getClusterInstanceContext(instanceId,\n                 networkPartitionId);\n         ClusterLevelPartitionContext partitionCtxt = networkPartitionCtxt.getPartitionCtxt(\n-                                                                            member.getPartitionId());\n+                member.getPartitionId());\n         MemberStatsContext memberStatsContext = partitionCtxt.getMemberStatsContext(memberId);\n         if (null == memberStatsContext) {\n             if (log.isDebugEnabled()) {\n@@ -664,7 +684,7 @@ public void handleMemberAverageLoadAverageEvent(\n         ClusterInstanceContext networkPartitionCtxt = getClusterInstanceContext(instanceId,\n                 networkPartitionId);\n         ClusterLevelPartitionContext partitionCtxt = networkPartitionCtxt.getPartitionCtxt(\n-                                                                            member.getPartitionId());\n+                member.getPartitionId());\n         MemberStatsContext memberStatsContext = partitionCtxt.getMemberStatsContext(memberId);\n         if (null == memberStatsContext) {\n             if (log.isDebugEnabled()) {\n@@ -687,7 +707,7 @@ public void handleMemberGradientOfLoadAverageEvent(\n         ClusterInstanceContext networkPartitionCtxt = getClusterInstanceContext(instanceId,\n                 networkPartitionId);\n         ClusterLevelPartitionContext partitionCtxt = networkPartitionCtxt.getPartitionCtxt(\n-                                                                            member.getPartitionId());\n+                member.getPartitionId());\n         MemberStatsContext memberStatsContext = partitionCtxt.getMemberStatsContext(memberId);\n         if (null == memberStatsContext) {\n             if (log.isDebugEnabled()) {\n@@ -711,7 +731,7 @@ public void handleMemberSecondDerivativeOfLoadAverageEvent(\n         ClusterInstanceContext networkPartitionCtxt = getClusterInstanceContext(instanceId,\n                 networkPartitionId);\n         ClusterLevelPartitionContext partitionCtxt = networkPartitionCtxt.getPartitionCtxt(\n-                                                                            member.getPartitionId());\n+                member.getPartitionId());\n         MemberStatsContext memberStatsContext = partitionCtxt.getMemberStatsContext(memberId);\n         if (null == memberStatsContext) {\n             if (log.isDebugEnabled()) {\n@@ -727,6 +747,7 @@ public void handleMemberSecondDerivativeOfLoadAverageEvent(\n     public void handleMemberFaultEvent(MemberFaultEvent memberFaultEvent) {\n \n         String memberId = memberFaultEvent.getMemberId();\n+        String clusterId = memberFaultEvent.getClusterId();\n         Member member = getMemberByMemberId(memberId);\n         String instanceId = memberFaultEvent.getInstanceId();\n         String networkPartitionId = memberFaultEvent.getNetworkPartitionId();\n@@ -762,13 +783,12 @@ public void handleMemberFaultEvent(MemberFaultEvent memberFaultEvent) {\n             partitionCtxt.moveMemberToObsoleteList(memberId);\n         }\n         if (log.isInfoEnabled()) {\n-            String clusterId = memberFaultEvent.getClusterId();\n             log.info(String.format(\"Faulty member is added to obsolete list and removed from the active members list: \"\n                     + \"[member] %s [partition] %s [cluster] %s \", memberId, partitionId, clusterId));\n         }\n \n-        StatusChecker.getInstance().onMemberFaultEvent(memberFaultEvent.getClusterId(),\n-                partitionId, instanceId);\n+        ServiceReferenceHolder.getInstance().getClusterStatusProcessorChain().process(\n+                ClusterStatusInActiveProcessor.class.getName(), clusterId, instanceId);\n     }\n \n     @Override\n@@ -782,6 +802,7 @@ public void handleMemberActivatedEvent(\n             MemberActivatedEvent memberActivatedEvent) {\n \n         String instanceId = memberActivatedEvent.getInstanceId();\n+        String clusterId = memberActivatedEvent.getClusterId();\n         String networkPartitionId = memberActivatedEvent.getNetworkPartitionId();\n         String partitionId = memberActivatedEvent.getPartitionId();\n         String memberId = memberActivatedEvent.getMemberId();\n@@ -795,7 +816,8 @@ public void handleMemberActivatedEvent(\n                     + \"[member] %s\", memberId));\n         }\n         clusterLevelPartitionContext.movePendingMemberToActiveMembers(memberId);\n-        StatusChecker.getInstance().onMemberStatusChange(memberActivatedEvent.getClusterId());\n+        ServiceReferenceHolder.getInstance().getClusterStatusProcessorChain().process(\n+                ClusterStatusActiveProcessor.class.getName(), clusterId, instanceId);\n     }\n \n     @Override\n@@ -809,7 +831,7 @@ public void handleMemberMaintenanceModeEvent(\n         ClusterInstanceContext networkPartitionCtxt = getClusterInstanceContext(instanceId,\n                 networkPartitionId);\n         ClusterLevelPartitionContext clusterMonitorPartitionContext = networkPartitionCtxt.\n-                                        getPartitionCtxt(partitionId);\n+                getPartitionCtxt(partitionId);\n         clusterMonitorPartitionContext.addMemberStatsContext(new MemberStatsContext(memberId));\n         if (log.isDebugEnabled()) {\n             log.debug(String.format(\"Member has been moved as pending termination: \"\n@@ -855,15 +877,14 @@ public void handleMemberReadyToShutdownEvent(MemberReadyToShutdownEvent memberRe\n \n             if (log.isInfoEnabled()) {\n                 log.info(String.format(\"Member is terminated and removed from the active members list: [member] %s \" +\n-                                \"[partition] %s [cluster] %s \", memberId, partitionId, clusterId));\n+                        \"[partition] %s [cluster] %s \", memberId, partitionId, clusterId));\n             }\n         } catch (Exception e) {\n             String msg = \"Error processing event \" + e.getLocalizedMessage();\n             log.error(msg, e);\n         }\n     }\n \n-\n     @Override\n     public void handleMemberTerminatedEvent(\n             MemberTerminatedEvent memberTerminatedEvent) {\n@@ -905,7 +926,8 @@ public void handleMemberTerminatedEvent(\n                     + \"[member] %s\", memberId));\n         }\n         //Checking whether the cluster state can be changed either from in_active to created/terminating to terminated\n-        StatusChecker.getInstance().onMemberTermination(clusterId, instanceId);\n+        ServiceReferenceHolder.getInstance().getClusterStatusProcessorChain().process(\n+                ClusterStatusTerminatedProcessor.class.getName(), clusterId, instanceId);\n     }\n \n     @Override\n@@ -964,7 +986,7 @@ public void terminateAllMembers() {\n             public void run() {\n \n                 for (ClusterLevelNetworkPartitionContext networkPartitionContext : getAllNetworkPartitionCtxts().values()) {\n-                    for(ClusterInstanceContext instanceContext : networkPartitionContext.getClusterInstanceContextMap().values()) {\n+                    for (ClusterInstanceContext instanceContext : networkPartitionContext.getClusterInstanceContextMap().values()) {\n                         for (ClusterLevelPartitionContext partitionContext : instanceContext.getPartitionCtxts()) {\n                             //if (log.isDebugEnabled()) {\n                             log.info(\"Starting to terminate all members in cluster [\" + getClusterId() + \"] Network Partition [ \" +\n@@ -1004,28 +1026,19 @@ public void run() {\n     }\n \n     public Map<String, ClusterLevelNetworkPartitionContext> getAllNetworkPartitionCtxts() {\n-        return ((VMClusterContext)this.clusterContext).getNetworkPartitionCtxts();\n+        return ((VMClusterContext) this.clusterContext).getNetworkPartitionCtxts();\n     }\n \n     public ClusterInstanceContext getClusterInstanceContext(String networkPartitionId, String instanceId) {\n         Map<String, ClusterLevelNetworkPartitionContext> clusterLevelNetworkPartitionContextMap =\n-                ((VMClusterContext)this.clusterContext).getNetworkPartitionCtxts();\n+                ((VMClusterContext) this.clusterContext).getNetworkPartitionCtxts();\n         ClusterLevelNetworkPartitionContext networkPartitionContext =\n                 clusterLevelNetworkPartitionContextMap.get(networkPartitionId);\n         return networkPartitionContext.getClusterInstanceContextMap().get(instanceId);\n     }\n \n-    private static void terminateMember(String memberId) {\n-        try {\n-            CloudControllerClient.getInstance().terminate(memberId);\n-\n-        } catch (TerminationException e) {\n-            log.error(\"Unable to terminate member [member id ] \" + memberId, e);\n-        }\n-    }\n-\n     public Collection<ClusterLevelNetworkPartitionContext> getNetworkPartitionCtxts() {\n-        return ((VMClusterContext)this.clusterContext).getNetworkPartitionCtxts().values();\n+        return ((VMClusterContext) this.clusterContext).getNetworkPartitionCtxts().values();\n     }\n \n ",
                "deletions": 134
            },
            {
                "sha": "a69d3bdc1f246bd7cf3216efef9c4b8e3726dae9",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/VMLbClusterMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/VMLbClusterMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/VMLbClusterMonitor.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/VMLbClusterMonitor.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -105,7 +105,7 @@\n //                                }\n //\n //                                minCheckFactHandle =\n-//                                        AutoscalerRuleEvaluator.evaluateMinCheck(getMinCheckKnowledgeSession(),\n+//                                        AutoscalerRuleEvaluator.evaluate(getMinCheckKnowledgeSession(),\n //                                                minCheckFactHandle,\n //                                                partitionContext);\n //                                obsoleteCheckFactHandle =",
                "deletions": 1
            },
            {
                "sha": "4a8ae1972ae3620fa863ad277c38c49d137349f1",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/ApplicationMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/ApplicationMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/ApplicationMonitor.java",
                "status": "modified",
                "changes": 60,
                "additions": 24,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/ApplicationMonitor.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -36,10 +36,12 @@\n import org.apache.stratos.autoscaler.pojo.policy.PolicyManager;\n import org.apache.stratos.autoscaler.pojo.policy.deployment.DeploymentPolicy;\n import org.apache.stratos.autoscaler.pojo.policy.deployment.partition.network.ApplicationLevelNetworkPartition;\n+import org.apache.stratos.autoscaler.util.ServiceReferenceHolder;\n import org.apache.stratos.messaging.domain.applications.Application;\n import org.apache.stratos.messaging.domain.applications.ApplicationStatus;\n import org.apache.stratos.messaging.domain.applications.GroupStatus;\n import org.apache.stratos.messaging.domain.instance.ApplicationInstance;\n+import org.apache.stratos.messaging.domain.instance.GroupInstance;\n import org.apache.stratos.messaging.domain.topology.ClusterStatus;\n import org.apache.stratos.messaging.domain.topology.lifecycle.LifeCycleState;\n \n@@ -53,8 +55,8 @@\n \n     //network partition contexts\n     private Map<String, ApplicationLevelNetworkPartitionContext> networkPartitionCtxts;\n-    //application instance id map\n-    private Map<String, ApplicationInstance> applicationInstanceIdMap;\n+    //Flag to set whether application is terminating\n+    private boolean isTerminating;\n \n \n     public ApplicationMonitor(Application application) throws DependencyBuilderException,\n@@ -63,7 +65,6 @@ public ApplicationMonitor(Application application) throws DependencyBuilderExcep\n         //setting the appId for the application\n         this.appId = application.getUniqueIdentifier();\n         networkPartitionCtxts = new HashMap<String, ApplicationLevelNetworkPartitionContext>();\n-        setApplicationInstanceIdMap(new HashMap<String, ApplicationInstance>());\n     }\n \n     /**\n@@ -107,7 +108,7 @@ private Monitor findGroupMonitor(String id, Collection<Monitor> monitors) {\n      * @param status the status\n      */\n     public void setStatus(ApplicationStatus status, String instanceId) {\n-        this.applicationInstanceIdMap.get(instanceId).setStatus(status);\n+        ((ApplicationInstance)this.instanceIdToInstanceMap.get(instanceId)).setStatus(status);\n \n         //notify the children about the state change\n         try {\n@@ -135,18 +136,6 @@ public void onChildStatusEvent(MonitorStatusEvent statusEvent) {\n             //mark the child monitor as inActive in the map\n             this.markMonitorAsTerminating(id);\n \n-        } else if (status1 == ClusterStatus.Created || status1 == GroupStatus.Created) {\n-            if (this.terminatingMonitorsList.contains(id)) {\n-                this.terminatingMonitorsList.remove(id);\n-                this.aliasToActiveMonitorsMap.remove(id);\n-            }\n-            //TODO\n-            /*if (this.status == ApplicationStatus.Terminating) {\n-                StatusChecker.getInstance().onChildStatusChange(id, this.id, this.appId);\n-            } else {\n-                onChildTerminatedEvent(id);\n-            }*/\n-\n         } else if (status1 == ClusterStatus.Terminated || status1 == GroupStatus.Terminated) {\n             //Check whether all dependent goes Terminated and then start them in parallel.\n             if (this.terminatingMonitorsList.contains(id)) {\n@@ -155,11 +144,18 @@ public void onChildStatusEvent(MonitorStatusEvent statusEvent) {\n             } else {\n                 log.warn(\"[monitor] \" + id + \" cannot be found in the inActive monitors list\");\n             }\n-            //TODO\n-            /*if (this.status == ApplicationStatus.Terminating || this.status == ApplicationStatus.Terminated) {\n-                StatusChecker.getInstance().onChildStatusChange(id, this.id, this.appId);\n-                log.info(\"Executing the un-subscription request for the [monitor] \" + id);\n-            }*/\n+            ApplicationInstance instance = (ApplicationInstance)instanceIdToInstanceMap.get(instanceId);\n+            if (instance != null) {\n+                if(instance.getStatus() == ApplicationStatus.Terminating) {\n+                    ServiceReferenceHolder.getInstance().getGroupStatusProcessorChain().process(this.id,\n+                            appId, instanceId);\n+                } else {\n+                    onChildTerminatedEvent(id, instanceId);\n+                }\n+            } else {\n+                log.warn(\"The required instance cannot be found in the the [GroupMonitor] \" +\n+                        this.id);\n+            }\n         }\n     }\n \n@@ -220,7 +216,8 @@ private void createInstanceAndStartDependency(Application application)\n \n                     ApplicationInstance instance = new ApplicationInstance(appId, instanceId);\n                     instance.setStatus(ApplicationStatus.Created);\n-                    this.applicationInstanceIdMap.put(instanceId, instance);\n+                    instance.setNetworkPartitionId(networkPartition.getId());\n+                    this.instanceIdToInstanceMap.put(instanceId, instance);\n \n                     this.networkPartitionCtxts.put(context.getId(), context);\n \n@@ -266,7 +263,7 @@ public void createInstanceOnBurstingForApplication() throws TopologyInConsistent\n \n                         ApplicationInstance instance = new ApplicationInstance(appId, instanceId);\n                         instance.setStatus(ApplicationStatus.Created);\n-                        this.applicationInstanceIdMap.put(instanceId, instance);\n+                        this.instanceIdToInstanceMap.put(instanceId, instance);\n \n                         burstNPFound = true;\n                     }\n@@ -318,20 +315,11 @@ public void addApplicationLevelNetworkPartitionContext(ApplicationLevelNetworkPa\n         this.networkPartitionCtxts.put(applicationLevelNetworkPartitionContext.getId(), applicationLevelNetworkPartitionContext);\n     }\n \n-    public Map<String, ApplicationInstance> getApplicationInstanceIdMap() {\n-        return applicationInstanceIdMap;\n-    }\n-\n-    public void setApplicationInstanceIdMap(Map<String, ApplicationInstance> applicationInstanceIdMap) {\n-        this.applicationInstanceIdMap = applicationInstanceIdMap;\n-    }\n-\n-    public void addApplicationInstance(ApplicationInstance instance) {\n-        this.applicationInstanceIdMap.put(instance.getInstanceId(), instance);\n-\n+    public boolean isTerminating() {\n+        return isTerminating;\n     }\n \n-    public ApplicationInstance getApplicationInstance(String instanceId) {\n-        return this.applicationInstanceIdMap.get(instanceId);\n+    public void setTerminating(boolean isTerminating) {\n+        this.isTerminating = isTerminating;\n     }\n }",
                "deletions": 36
            },
            {
                "sha": "23349162bef3638a4ecb5ac9a79017a2d330d740",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/GroupMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/GroupMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/GroupMonitor.java",
                "status": "modified",
                "changes": 77,
                "additions": 28,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/GroupMonitor.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -65,16 +65,12 @@\n \n     //whether groupScaling enabled or not\n     private boolean groupScalingEnabled;\n-\n-    private int monitoringIntervalMilliseconds = 60000;\n-    //TODO get this from config file\n-\n     //network partition contexts\n     private Map<String, GroupLevelNetworkPartitionContext> networkPartitionCtxts;\n-\n-    private Map<String, GroupInstance> groupInstanceIdMap;\n-\n+    //Whether the monitor is destroyed or not\n     private boolean isDestroyed;\n+    //monitoring interval of the monitor\n+    private int monitoringIntervalMilliseconds = 60000;     //TODO get this from config file\n \n     /**\n      * Constructor of GroupMonitor\n@@ -88,7 +84,6 @@ public GroupMonitor(Group group, String appId, List<String> parentInstanceId) th\n         super(group);\n         this.appId = appId;\n         networkPartitionCtxts = new HashMap<String, GroupLevelNetworkPartitionContext>();\n-        setGroupInstanceIdMap(new HashMap<String, GroupInstance>());\n     }\n \n     @Override\n@@ -132,7 +127,7 @@ public void run() {\n      * @param status status of the group\n      */\n     public void setStatus(GroupStatus status, String instanceId) {\n-        this.groupInstanceIdMap.get(instanceId).setStatus(status);\n+        ((GroupInstance)this.instanceIdToInstanceMap.get(instanceId)).setStatus(status);\n \n         if (status == GroupStatus.Inactive && !this.hasStartupDependents) {\n             log.info(\"[Group] \" + this.id + \"is not notifying the parent, \" +\n@@ -186,14 +181,6 @@ public void onChildStatusEvent(MonitorStatusEvent statusEvent) {\n             this.markMonitorAsInactive(instanceId);\n             onChildInactiveEvent(id, instanceId);\n \n-        } else if (status1 == ClusterStatus.Created || status1 == GroupStatus.Created) {\n-            if (this.terminatingMonitorsList.contains(instanceId)) {\n-                this.terminatingMonitorsList.remove(instanceId);\n-                this.aliasToActiveMonitorsMap.remove(instanceId);\n-                if (AutoscalerContext.getInstance().getClusterMonitors().containsKey(id)) {\n-                    AutoscalerContext.getInstance().removeClusterMonitor(id);\n-                }\n-            }\n         } else if (status1 == ClusterStatus.Terminating || status1 == GroupStatus.Terminating) {\n             //mark the child monitor as inActive in the map\n             this.markMonitorAsTerminating(instanceId);\n@@ -206,23 +193,17 @@ public void onChildStatusEvent(MonitorStatusEvent statusEvent) {\n             } else {\n                 log.warn(\"[monitor] \" + id + \" cannot be found in the inActive monitors list\");\n             }\n-            //If cluster monitor, need to terminate the existing one\n-            ApplicationHolder.releaseReadLock();\n-            GroupStatus instanceStatus;\n-            try {\n-                Group group = ApplicationHolder.getApplications().\n-                        getApplication(appId).getGroupRecursively(this.id);\n-                instanceStatus = group.getInstanceContexts(instanceId).getStatus();\n-\n-            } finally {\n-                ApplicationHolder.releaseReadLock();\n-            }\n-\n-            if (instanceStatus == GroupStatus.Terminating) {\n-                ServiceReferenceHolder.getInstance().getGroupStatusProcessorChain().process(this.id,\n-                        appId, instanceId);\n+            GroupInstance instance = (GroupInstance)this.instanceIdToInstanceMap.get(instanceId);\n+            if (instance != null) {\n+                if(instance.getStatus() == GroupStatus.Terminating) {\n+                    ServiceReferenceHolder.getInstance().getGroupStatusProcessorChain().process(this.id,\n+                            appId, instanceId);\n+                } else {\n+                    onChildTerminatedEvent(id, instanceId);\n+                }\n             } else {\n-                onChildTerminatedEvent(id, instanceId);\n+                log.warn(\"The required instance cannot be found in the the [GroupMonitor] \" +\n+                    this.id);\n             }\n         }\n     }\n@@ -234,7 +215,20 @@ public void onParentStatusEvent(MonitorStatusEvent statusEvent)\n         // send the ClusterTerminating event\n         if (statusEvent.getStatus() == GroupStatus.Terminating ||\n                 statusEvent.getStatus() == ApplicationStatus.Terminating) {\n-            ApplicationBuilder.handleGroupTerminatingEvent(appId, id, instanceId);\n+            //Get all the instances which related to this instanceId\n+            GroupInstance instance = (GroupInstance) this.instanceIdToInstanceMap.get(instanceId);\n+            if(instance != null) {\n+                ApplicationBuilder.handleGroupTerminatingEvent(appId, id, instanceId);\n+            } else {\n+                //Using parentId need to get the children\n+                List<String> instanceIds = this.getInstancesByParentInstanceId(instanceId);\n+                if(!instanceIds.isEmpty()) {\n+                    for(String instanceId1 : instanceIds) {\n+                        ApplicationBuilder.handleGroupTerminatingEvent(appId, id, instanceId1);\n+                    }\n+                }\n+\n+            }\n         } else if (statusEvent.getStatus() == ClusterStatus.Created ||\n                 statusEvent.getStatus() == GroupStatus.Created) {\n             Application application = ApplicationHolder.getApplications().getApplication(this.appId);\n@@ -489,20 +483,5 @@ public void setDestroyed(boolean isDestroyed) {\n         this.isDestroyed = isDestroyed;\n     }\n \n-    public Map<String, GroupInstance> getGroupInstanceIdMap() {\n-        return groupInstanceIdMap;\n-    }\n-\n-    public void setGroupInstanceIdMap(Map<String, GroupInstance> groupInstanceIdMap) {\n-        this.groupInstanceIdMap = groupInstanceIdMap;\n-    }\n-\n-    public void addGroupInstance(GroupInstance instance) {\n-        this.groupInstanceIdMap.put(instance.getInstanceId(), instance);\n \n-    }\n-\n-    public GroupInstance getGroupInstance(String instanceId) {\n-        return this.groupInstanceIdMap.get(instanceId);\n-    }\n }",
                "deletions": 49
            },
            {
                "sha": "136cb9fd12c68576c5320c063d3769d396aeb5b0",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/ParentComponentMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/ParentComponentMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/ParentComponentMonitor.java",
                "status": "modified",
                "changes": 11,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/ParentComponentMonitor.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -41,7 +41,6 @@\n import org.apache.stratos.autoscaler.monitor.MonitorFactory;\n import org.apache.stratos.autoscaler.monitor.cluster.AbstractClusterMonitor;\n import org.apache.stratos.autoscaler.monitor.events.builder.MonitorStatusEventBuilder;\n-import org.apache.stratos.autoscaler.status.processor.StatusChecker;\n import org.apache.stratos.autoscaler.util.ServiceReferenceHolder;\n import org.apache.stratos.messaging.domain.applications.GroupStatus;\n import org.apache.stratos.messaging.domain.applications.ParentComponent;\n@@ -261,8 +260,8 @@ protected void onChildActivatedEvent(String eventId, String instanceId) {\n             }\n \n             boolean startDep;\n-            if(!aliasToActiveMonitorsMap.containsKey(eventId) || !pendingMonitorsList.contains(eventId)) {\n-               startDep = startDependency(eventId, instanceId);\n+            if (!aliasToActiveMonitorsMap.containsKey(eventId) || !pendingMonitorsList.contains(eventId)) {\n+                startDep = startDependency(eventId, instanceId);\n             } else {\n                 startDep = startDependencyByInstanceCreation(eventId, instanceId);\n             }\n@@ -289,7 +288,8 @@ protected void onChildInactiveEvent(String eventId, String instanceId) {\n         terminationList = this.startupDependencyTree.getTerminationDependencies(eventId);\n         //Need to notify the parent about the status  change from Active-->InActive\n         if (this.parent != null) {\n-            StatusChecker.getInstance().onChildStatusChange(eventId, this.id, this.appId, instanceId);\n+            ServiceReferenceHolder.getInstance().getGroupStatusProcessorChain().\n+                    process(this.id, this.appId, instanceId);\n         }\n         //TODO checking whether terminating them in reverse order,\n         // TODO if so can handle it in the parent event.\n@@ -387,7 +387,8 @@ protected void onChildTerminatedEvent(String eventId, String instanceId) {\n                 log.error(\"Error while starting the monitor upon termination\" + e);\n             }\n         } else {\n-            StatusChecker.getInstance().onChildStatusChange(eventId, this.id, this.appId, instanceId);\n+            ServiceReferenceHolder.getInstance().getGroupStatusProcessorChain().\n+                    process(this.id, this.appId, instanceId);\n             log.info(\"Checking the status of group/application as no dependent found...\");\n         }\n ",
                "deletions": 5
            },
            {
                "sha": "ac05b55e0e05a60b29d5aa69b01e1d621f868b70",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/pojo/policy/PolicyManager.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/pojo/policy/PolicyManager.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/pojo/policy/PolicyManager.java",
                "status": "modified",
                "changes": 33,
                "additions": 14,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/pojo/policy/PolicyManager.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -21,6 +21,8 @@\n \n import java.util.HashMap;\n import java.util.Map;\n+import java.util.Random;\n+import java.util.UUID;\n \n import org.apache.commons.lang3.StringUtils;\n import org.apache.commons.logging.Log;\n@@ -87,27 +89,14 @@ public boolean updateAutoscalePolicy(AutoscalePolicy policy) throws InvalidPolic\n     }\n \n     // Add the deployment policy to information model and persist.\n-    public boolean deployDeploymentPolicy(DeploymentPolicy policy) throws InvalidPolicyException {\n-        if(StringUtils.isEmpty(policy.getId())){\n-            throw new AutoScalerException(\"Deploying policy id cannot be empty\");\n-        }\n-        try {\n-            if(log.isInfoEnabled()) {\n-                log.info(String.format(\"Deploying deployment policy: [id] %s\", policy.getId()));\n-            }\n-            fillPartitions(policy);\n-        } catch (InvalidPartitionException e) {\n-        \tlog.error(e);\n-            throw new InvalidPolicyException(String.format(\"Deployment policy is invalid: [id] %s\", policy.getId()), e);\n-        }\n-\n-        addDeploymentPolicyToInformationModel(policy);\n+    public String deployDeploymentPolicy(DeploymentPolicy policy) throws InvalidPolicyException {\n+        String policyId = addDeploymentPolicyToInformationModel(policy);\n         RegistryManager.getInstance().persistDeploymentPolicy(policy);\n \n         if (log.isInfoEnabled()) {\n-            log.info(String.format(\"Deployment policy is deployed successfully: [id] %s\", policy.getId()));\n+            log.info(String.format(\"Deployment policy is deployed successfully: [id] %s\", policyId));\n         }\n-        return true;\n+        return policyId;\n     }\n \n     public boolean updateDeploymentPolicy(DeploymentPolicy policy) throws InvalidPolicyException {\n@@ -223,18 +212,24 @@ public AutoscalePolicy getAutoscalePolicy(String id) {\n     }\n \n     // Add the deployment policy to As in memmory information model. Does not persist.\n-    public void addDeploymentPolicyToInformationModel(DeploymentPolicy policy) throws InvalidPolicyException {\n+    public String addDeploymentPolicyToInformationModel(DeploymentPolicy policy) throws InvalidPolicyException {\n+        if (StringUtils.isEmpty(policy.getId())) {\n+            // id = application id + random string\n+            String id = policy.getApplicationId() + UUID.randomUUID().getLeastSignificantBits();\n+            policy.setId(id);\n+        }\n         if (!deploymentPolicyListMap.containsKey(policy.getId())) {\n             if (log.isDebugEnabled()) {\n                 log.debug(\"Adding deployment policy: \" + policy.getId());\n             }\n-//            PartitionManager.getInstance().deployNewNetworkPartitions(policy);\n             deploymentPolicyListMap.put(policy.getId(), policy);\n         } else {\n         \tString errMsg = \"Specified deployment policy [\" + policy.getId()+ \"] already exists\";\n         \tlog.error(errMsg);\n             throw new InvalidPolicyException(errMsg);\n         }\n+        \n+        return policy.getId();\n     }\n \n     public void updateDeploymentPolicyToInformationModel(DeploymentPolicy policy) throws InvalidPolicyException {",
                "deletions": 19
            },
            {
                "sha": "512ed415a2b710c7746c4e326932c263dc0b2c57",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/rule/AutoscalerRuleEvaluator.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/rule/AutoscalerRuleEvaluator.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/rule/AutoscalerRuleEvaluator.java",
                "status": "modified",
                "changes": 291,
                "additions": 150,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/rule/AutoscalerRuleEvaluator.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -35,6 +35,8 @@\n import org.wso2.carbon.utils.CarbonUtils;\n \n import java.io.File;\n+import java.util.HashMap;\n+import java.util.Map;\n import java.util.Properties;\n \n /**\n@@ -45,174 +47,181 @@\n \t\n \tprivate static final Log log = LogFactory.getLog(AutoscalerRuleEvaluator.class);\n \n-\t//vm drool files as default\n-\tprivate String minCheckDroolFileName = StratosConstants.CONTAINER_MIN_CHECK_DROOL_FILE;\n-\tprivate String obsoleteCheckDroolFileName = StratosConstants.CONTAINER_OBSOLETE_CHECK_DROOL_FILE;\n-\tprivate String scaleCheckDroolFileName = StratosConstants.CONTAINER_SCALE_CHECK_DROOL_FILE;\n-\tprivate String terminateAllDroolFileName = \"terminateall.drl\";\n-\n-\tprivate static KnowledgeBase minCheckKbase;\n-\tprivate static KnowledgeBase obsoleteCheckKbase;\n-\tprivate static KnowledgeBase scaleCheckKbase;\n-\t@SuppressWarnings(\"unused\")\n-\tprivate static KnowledgeBase terminateAllKbase;\n-\n-    public AutoscalerRuleEvaluator(String minCheckDroolFileName, String obsoleteCheckDroolFileName, String scaleCheckDroolFileName){\n-    \t\n-    \tif (minCheckDroolFileName != null && !minCheckDroolFileName.isEmpty()) {\n-    \t\tthis.minCheckDroolFileName = minCheckDroolFileName;\n-\t\t}\n-\n-    \tif (obsoleteCheckDroolFileName != null && !obsoleteCheckDroolFileName.isEmpty()) {\n-    \t\tthis.obsoleteCheckDroolFileName = obsoleteCheckDroolFileName;\n-\t\t}\n-    \t\n-    \tif (scaleCheckDroolFileName != null && !scaleCheckDroolFileName.isEmpty()) {\n-    \t\tthis.scaleCheckDroolFileName = scaleCheckDroolFileName;\n-\t\t}\n-\n-        minCheckKbase = readKnowledgeBase(this.minCheckDroolFileName);\n+//\t//vm drool files as default\n+//\tprivate String minCheckDroolFileName = StratosConstants.CONTAINER_MIN_CHECK_DROOL_FILE;\n+//\tprivate String obsoleteCheckDroolFileName = StratosConstants.CONTAINER_OBSOLETE_CHECK_DROOL_FILE;\n+//\tprivate String scaleCheckDroolFileName = StratosConstants.CONTAINER_SCALE_CHECK_DROOL_FILE;\n+//\n+//\tprivate static KnowledgeBase minCheckKbase;\n+//\tprivate static KnowledgeBase obsoleteCheckKbase;\n+//\tprivate static KnowledgeBase scaleCheckKbase;\n \n-        if (log.isDebugEnabled()) {\n-            log.debug(\"Minimum check rule is parsed successfully : \" + this.minCheckDroolFileName);\n-        }\n-        \n-        obsoleteCheckKbase = readKnowledgeBase(this.obsoleteCheckDroolFileName);\n+    private static Map<String, KnowledgeBase> knowledgeBases;\n \n-        if (log.isDebugEnabled()) {\n-            log.debug(\"Obsolete check rule is parsed successfully : \" + this.obsoleteCheckDroolFileName);\n-        }\n+    public AutoscalerRuleEvaluator(){\n+\n+        knowledgeBases = new HashMap<String, KnowledgeBase>();\n+//    \tif (minCheckDroolFileName != null && !minCheckDroolFileName.isEmpty()) {\n+//    \t\tthis.minCheckDroolFileName = minCheckDroolFileName;\n+//\t\t}\n+//\n+//    \tif (obsoleteCheckDroolFileName != null && !obsoleteCheckDroolFileName.isEmpty()) {\n+//    \t\tthis.obsoleteCheckDroolFileName = obsoleteCheckDroolFileName;\n+//\t\t}\n+//\n+//    \tif (scaleCheckDroolFileName != null && !scaleCheckDroolFileName.isEmpty()) {\n+//    \t\tthis.scaleCheckDroolFileName = scaleCheckDroolFileName;\n+//\t\t}\n+//\n+//        minCheckKbase = readKnowledgeBase(this.minCheckDroolFileName);\n+//\n+//        if (log.isDebugEnabled()) {\n+//            log.debug(\"Minimum check rule is parsed successfully : \" + this.minCheckDroolFileName);\n+//        }\n+//\n+//        obsoleteCheckKbase = readKnowledgeBase(this.obsoleteCheckDroolFileName);\n+//\n+//        if (log.isDebugEnabled()) {\n+//            log.debug(\"Obsolete check rule is parsed successfully : \" + this.obsoleteCheckDroolFileName);\n+//        }\n+//\n+//        scaleCheckKbase = readKnowledgeBase(this.scaleCheckDroolFileName);\n+//\n+//        if (log.isDebugEnabled()) {\n+//            log.debug(\"Scale check rule is parsed successfully : \" + this.scaleCheckDroolFileName);\n+//        }\n+//\n+    }\n \n-        scaleCheckKbase = readKnowledgeBase(this.scaleCheckDroolFileName);\n+    public void parseAndBuildKnowledgeBaseForDroolsFile(String drlFileName){\n \n-        if (log.isDebugEnabled()) {\n-            log.debug(\"Scale check rule is parsed successfully : \" + this.scaleCheckDroolFileName);\n-        }\n-        \n-        terminateAllKbase = readKnowledgeBase(this.terminateAllDroolFileName);\n+        knowledgeBases.put(drlFileName, readKnowledgeBase(drlFileName));\n \n         if (log.isDebugEnabled()) {\n-            log.debug(\"Terminate all rule is parsed successfully : \" + this.terminateAllDroolFileName);\n-        }\n-    }\n-    \n-    public static FactHandle evaluateMinCheck(StatefulKnowledgeSession ksession, FactHandle handle, Object obj) {\n-        if (handle == null) {\n-            ksession.setGlobal(\"$delegator\", new RuleTasksDelegator());\n-            handle = ksession.insert(obj);\n-        } else {\n-            ksession.update(handle, obj);\n-        }\n-        ksession.fireAllRules();\n-        if(log.isDebugEnabled()){\n-            log.debug(String.format(\"Minimum check executed for : %s \", obj));\n+            log.debug(\"Drools file is parsed successfully : \" + drlFileName);\n         }\n-        return handle;\n+\n     }\n     \n-    public static FactHandle evaluateObsoleteCheck(StatefulKnowledgeSession ksession, FactHandle handle, Object obj) {\n-        if (handle == null) {\n-            ksession.setGlobal(\"$delegator\", new RuleTasksDelegator());\n-            handle = ksession.insert(obj);\n-        } else {\n-            ksession.update(handle, obj);\n-        }\n-        ksession.fireAllRules();\n-        if(log.isDebugEnabled()){\n-            log.debug(String.format(\"Obsolete check executed for : %s \", obj));\n-        }\n-        return handle;\n-    }\n+    public static FactHandle evaluate(StatefulKnowledgeSession ksession, FactHandle handle, Object obj) {\n \n-    public static FactHandle evaluateScaleCheck(StatefulKnowledgeSession ksession, FactHandle handle, Object obj) {\n-        if (handle == null) {\n-            ksession.setGlobal(\"$delegator\", new RuleTasksDelegator());\n-            handle = ksession.insert(obj);\n-        } else {\n-            ksession.update(handle, obj);\n-        }\n-        ksession.fireAllRules();\n-        if(log.isDebugEnabled()){\n-            log.debug(String.format(\"Scale check executed for : %s \", obj));\n-        }\n-        return handle;\n-    }\n \n-    public static FactHandle evaluateDependentScaleCheck(StatefulKnowledgeSession ksession, FactHandle handle, Object obj) {\n         if (handle == null) {\n-            ksession.setGlobal(\"$delegator\", new RuleTasksDelegator());\n+            ksession.setGlobal(\"delegator\", new RuleTasksDelegator());\n             handle = ksession.insert(obj);\n         } else {\n             ksession.update(handle, obj);\n         }\n         ksession.fireAllRules();\n         if(log.isDebugEnabled()){\n-            log.debug(String.format(\"Dependent scale check executed for : %s \", obj));\n-        }\n-        return handle;\n-    }\n-\n-    public static FactHandle evaluateTerminateAll(StatefulKnowledgeSession ksession, FactHandle handle, Object obj) {\n-        if (handle == null) {\n-            ksession.setGlobal(\"$delegator\", new RuleTasksDelegator());\n-            handle = ksession.insert(obj);\n-        } else {\n-            ksession.update(handle, obj);\n-        }\n-        ksession.fireAllRules();\n-        if(log.isDebugEnabled()){\n-            log.debug(String.format(\"Terminate all check executed for : %s \", obj));\n-        }\n-        return handle;\n-    }\n-    \n-    public static FactHandle evaluateTerminateDependency(StatefulKnowledgeSession ksession, FactHandle handle, Object obj) {\n-    \tif(log.isDebugEnabled()){\n-            log.debug(String.format(\"Terminate dependency check executing for : %s \", obj));\n-        }\n-        if (handle == null) {\n-            ksession.setGlobal(\"$delegator\", new RuleTasksDelegator());\n-            handle = ksession.insert(obj);\n-        } else {\n-            ksession.update(handle, obj);\n-        }\n-        if(log.isDebugEnabled()){\n-            log.debug(String.format(\"Terminate dependency check firing rules for : %s \", ksession));\n-        }\n-        ksession.fireAllRules();\n-        if(log.isDebugEnabled()){\n-            log.debug(String.format(\"Terminate dependency check executed for : %s \", obj));\n+            log.debug(String.format(\"Rule executed for : %s \", obj));\n         }\n         return handle;\n     }\n+//\n+//    public static FactHandle evaluateObsoleteCheck(StatefulKnowledgeSession ksession, FactHandle handle, Object obj) {\n+//        if (handle == null) {\n+//            ksession.setGlobal(\"delegator\", new RuleTasksDelegator());\n+//            handle = ksession.insert(obj);\n+//        } else {\n+//            ksession.update(handle, obj);\n+//        }\n+//        ksession.fireAllRules();\n+//        if(log.isDebugEnabled()){\n+//            log.debug(String.format(\"Obsolete check executed for : %s \", obj));\n+//        }\n+//        return handle;\n+//    }\n+//\n+//    public static FactHandle evaluateScaleCheck(StatefulKnowledgeSession ksession, FactHandle handle, Object obj) {\n+//        if (handle == null) {\n+//            ksession.setGlobal(\"delegator\", new RuleTasksDelegator());\n+//            handle = ksession.insert(obj);\n+//        } else {\n+//            ksession.update(handle, obj);\n+//        }\n+//        ksession.fireAllRules();\n+//        if(log.isDebugEnabled()){\n+//            log.debug(String.format(\"Scale check executed for : %s \", obj));\n+//        }\n+//        return handle;\n+//    }\n+//\n+//    public static FactHandle evaluateDependentScaleCheck(StatefulKnowledgeSession ksession, FactHandle handle, Object obj) {\n+//        if (handle == null) {\n+//            ksession.setGlobal(\"delegator\", new RuleTasksDelegator());\n+//            handle = ksession.insert(obj);\n+//        } else {\n+//            ksession.update(handle, obj);\n+//        }\n+//        ksession.fireAllRules();\n+//        if(log.isDebugEnabled()){\n+//            log.debug(String.format(\"Dependent scale check executed for : %s \", obj));\n+//        }\n+//        return handle;\n+//    }\n+//\n+//    public static FactHandle evaluateTerminateAll(StatefulKnowledgeSession ksession, FactHandle handle, Object obj) {\n+//        if (handle == null) {\n+//            ksession.setGlobal(\"delegator\", new RuleTasksDelegator());\n+//            handle = ksession.insert(obj);\n+//        } else {\n+//            ksession.update(handle, obj);\n+//        }\n+//        ksession.fireAllRules();\n+//        if(log.isDebugEnabled()){\n+//            log.debug(String.format(\"Terminate all check executed for : %s \", obj));\n+//        }\n+//        return handle;\n+//    }\n+//\n+//    public static FactHandle evaluateTerminateDependency(StatefulKnowledgeSession ksession, FactHandle handle, Object obj) {\n+//    \tif(log.isDebugEnabled()){\n+//            log.debug(String.format(\"Terminate dependency check executing for : %s \", obj));\n+//        }\n+//        if (handle == null) {\n+//            ksession.setGlobal(\"delegator\", new RuleTasksDelegator());\n+//            handle = ksession.insert(obj);\n+//        } else {\n+//            ksession.update(handle, obj);\n+//        }\n+//        if(log.isDebugEnabled()){\n+//            log.debug(String.format(\"Terminate dependency check firing rules for : %s \", ksession));\n+//        }\n+//        ksession.fireAllRules();\n+//        if(log.isDebugEnabled()){\n+//            log.debug(String.format(\"Terminate dependency check executed for : %s \", obj));\n+//        }\n+//        return handle;\n+//    }\n \n-    public StatefulKnowledgeSession getMinCheckStatefulSession() {\n-        StatefulKnowledgeSession ksession;\n-        ksession = minCheckKbase.newStatefulKnowledgeSession();\n-        ksession.setGlobal(\"log\", RuleLog.getInstance());\n-        return ksession;\n-    }\n-    \n-    public StatefulKnowledgeSession getObsoleteCheckStatefulSession() {\n+    public StatefulKnowledgeSession getStatefulSession(String drlFileName) {\n         StatefulKnowledgeSession ksession;\n-        ksession = obsoleteCheckKbase.newStatefulKnowledgeSession();\n+        ksession = knowledgeBases.get(drlFileName).newStatefulKnowledgeSession();\n         ksession.setGlobal(\"log\", RuleLog.getInstance());\n         return ksession;\n     }\n     \n-    public StatefulKnowledgeSession getScaleCheckStatefulSession() {\n-        StatefulKnowledgeSession ksession;\n-        ksession = scaleCheckKbase.newStatefulKnowledgeSession();\n-        ksession.setGlobal(\"log\", RuleLog.getInstance());\n-        return ksession;\n-    }\n-    \n-    public StatefulKnowledgeSession getTerminateAllStatefulSession() {\n-        StatefulKnowledgeSession ksession;\n-        ksession = scaleCheckKbase.newStatefulKnowledgeSession();\n-        ksession.setGlobal(\"log\", RuleLog.getInstance());\n-        return ksession;\n-    }\n+//    public StatefulKnowledgeSession getObsoleteCheckStatefulSession() {\n+//        StatefulKnowledgeSession ksession;\n+//        ksession = obsoleteCheckKbase.newStatefulKnowledgeSession();\n+//        ksession.setGlobal(\"log\", RuleLog.getInstance());\n+//        return ksession;\n+//    }\n+//\n+//    public StatefulKnowledgeSession getScaleCheckStatefulSession() {\n+//        StatefulKnowledgeSession ksession;\n+//        ksession = scaleCheckKbase.newStatefulKnowledgeSession();\n+//        ksession.setGlobal(\"log\", RuleLog.getInstance());\n+//        return ksession;\n+//    }\n+//\n+//    public StatefulKnowledgeSession getTerminateAllStatefulSession() {\n+//        StatefulKnowledgeSession ksession;\n+//        ksession = scaleCheckKbase.newStatefulKnowledgeSession();\n+//        ksession.setGlobal(\"log\", RuleLog.getInstance());\n+//        return ksession;\n+//    }\n \n //    public static String getLbClusterId(ClusterLevelPartitionContext clusterMonitorPartitionContext, String nwpartitionId) {\n //        Properties props = clusterMonitorPartitionContext.getProperties();",
                "deletions": 141
            },
            {
                "sha": "6c582443ef957eec7dd3c4bdbefb652d00242ed8",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/rule/RuleTasksDelegator.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/rule/RuleTasksDelegator.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/rule/RuleTasksDelegator.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/rule/RuleTasksDelegator.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -194,7 +194,7 @@ public void delegateSpawn(ClusterLevelPartitionContext clusterMonitorPartitionCo\n                     CloudControllerClient.getInstance()\n                             .spawnAnInstance(clusterMonitorPartitionContext.getPartition(),\n                                     clusterId,\n-//                                    lbClusterId,\n+                                    instanceId,\n                                     clusterMonitorPartitionContext.getNetworkPartitionId(),\n                                     isPrimary,\n                                     minimumCountOfNetworkPartition);",
                "deletions": 1
            },
            {
                "sha": "52b5f3663dc853ac89e38f3c493b4e5676baa95c",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/processor/cluster/ClusterStatusTerminatedProcessor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/processor/cluster/ClusterStatusTerminatedProcessor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/processor/cluster/ClusterStatusTerminatedProcessor.java",
                "status": "modified",
                "changes": 19,
                "additions": 11,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/processor/cluster/ClusterStatusTerminatedProcessor.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -71,7 +71,7 @@ public boolean process(String type, String clusterId, String instanceId) {\n     private boolean doProcess(String clusterId, String instanceId) {\n         VMClusterMonitor monitor = (VMClusterMonitor) AutoscalerContext.getInstance().\n                 getClusterMonitor(clusterId);\n-        boolean clusterMonitorHasMembers = clusterMonitorHasMembers(monitor);\n+        boolean clusterMonitorHasMembers = clusterInstanceHasMembers(monitor, instanceId);\n         boolean clusterTerminated = false;\n         try {\n             TopologyManager.acquireReadLockForCluster(monitor.getServiceId(), monitor.getClusterId());\n@@ -83,10 +83,11 @@ private boolean doProcess(String clusterId, String instanceId) {\n                 if (cluster != null) {\n                     try {\n                         ApplicationHolder.acquireReadLock();\n-                        Application application = ApplicationHolder.getApplications().getApplication(appId);\n-                        //if all members removed from the cluster and cluster is in terminating,\n-                        // either it has to be terminated or Reset\n-                        if (!clusterMonitorHasMembers && cluster.getStatus(null) == ClusterStatus.Terminating) {\n+                        /**\n+                         * if all members removed from the cluster and cluster is in terminating,\n+                         * either it has to be terminated or Reset\n+                         */\n+                        if (!clusterMonitorHasMembers) {\n                             if (log.isInfoEnabled()) {\n                                 log.info(\"Publishing Cluster terminated event for [application]: \" + appId +\n                                         \" [cluster]: \" + clusterId);\n@@ -119,17 +120,19 @@ private boolean doProcess(String clusterId, String instanceId) {\n      * @param monitor the cluster monitor\n      * @return whether has members or not\n      */\n-    private boolean clusterMonitorHasMembers(VMClusterMonitor monitor) {\n+    private boolean clusterInstanceHasMembers(VMClusterMonitor monitor, String instanceId) {\n         boolean hasMember = false;\n         for (ClusterLevelNetworkPartitionContext clusterLevelNetworkPartitionContext :\n                                                 monitor.getAllNetworkPartitionCtxts().values()) {\n             //minimum check per partition\n-            for(ClusterInstanceContext clusterInstanceContext :\n-                    clusterLevelNetworkPartitionContext.getClusterInstanceContextMap().values()) {\n+            if(clusterLevelNetworkPartitionContext.containsClusterInstanceContext(instanceId)) {\n+            ClusterInstanceContext clusterInstanceContext = clusterLevelNetworkPartitionContext.\n+                                                            getClusterInstanceContext(instanceId);\n                 for (ClusterLevelPartitionContext partitionContext :\n                         clusterInstanceContext.getPartitionCtxts()) {\n                     if (partitionContext.getNonTerminatedMemberCount() > 0) {\n                         hasMember = true;\n+                        return hasMember;\n                     } else {\n                         hasMember = false;\n                     }",
                "deletions": 8
            },
            {
                "sha": "e2a63688d7f6f611b2ea9664068096c81a722cc4",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/processor/group/GroupStatusTerminatedProcessor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/processor/group/GroupStatusTerminatedProcessor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/processor/group/GroupStatusTerminatedProcessor.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/processor/group/GroupStatusTerminatedProcessor.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -93,7 +93,7 @@ private boolean doProcess(String idOfComponent, String appId, String instanceId)\n                     //send the terminated event\n                     if (component instanceof Application) {\n                         log.info(\"sending app terminated: \" + appId);\n-                        ApplicationBuilder.handleApplicationTerminatedEvent(appId);\n+                        ApplicationBuilder.handleApplicationTerminatedEvent(appId, instanceId);\n                         return true;\n                     } else if (component instanceof Group) {\n                         //send activation to the parent",
                "deletions": 1
            },
            {
                "sha": "37b2a2df43730c399747c2c9c59c339b180140cd",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/processor/group/GroupStatusTerminatingProcessor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/processor/group/GroupStatusTerminatingProcessor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/processor/group/GroupStatusTerminatingProcessor.java",
                "status": "modified",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/processor/group/GroupStatusTerminatingProcessor.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -94,13 +94,13 @@ private boolean doProcess(String idOfComponent, String appId, String instanceId)\n                     //send the terminated event\n                     if (component instanceof Application) {\n                         log.info(\"sending app terminated: \" + appId);\n-                        ApplicationBuilder.handleApplicationTerminatedEvent(appId);\n+                        ApplicationBuilder.handleApplicationTerminatedEvent(appId, instanceId);\n                         return true;\n                     } else if (component instanceof Group) {\n                         //send activation to the parent\n                         if (((Group) component).getStatus(null) != GroupStatus.Terminated) {\n                             log.info(\"sending group terminated : \" + component.getUniqueIdentifier());\n-                            ApplicationBuilder.handleGroupTerminatedEvent(appId,\n+                            ApplicationBuilder.handleGroupTerminatingEvent(appId,\n                                     component.getUniqueIdentifier(), instanceId);\n                             return true;\n                         }",
                "deletions": 2
            },
            {
                "sha": "2ed1074647722336dbb236bc9e921b6dc96b191a",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/util/AutoscalerUtil.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/util/AutoscalerUtil.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/util/AutoscalerUtil.java",
                "status": "modified",
                "changes": 12,
                "additions": 7,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/util/AutoscalerUtil.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -351,7 +351,9 @@ public static Properties getProperties(final OMElement elt) {\n \n     public synchronized void startApplicationMonitor(String applicationId) {\n         Thread th = null;\n-        if (AutoscalerContext.getInstance().getAppMonitor(applicationId) == null) {\n+        AutoscalerContext autoscalerContext = AutoscalerContext.getInstance();\n+        if (autoscalerContext.getAppMonitor(applicationId) == null) {\n+            autoscalerContext.addPendingMonitor(applicationId);\n             th = new Thread(new ApplicationMonitorAdder(applicationId));\n         }\n         if (th != null) {\n@@ -383,10 +385,8 @@ public void run() {\n                 }\n                 try {\n                     long start = System.currentTimeMillis();\n-                    if (log.isDebugEnabled()) {\n-                        log.debug(\"application monitor is going to be started for [application] \" +\n+                    log.info(\"application monitor is going to be started for [application] \" +\n                                 appId);\n-                    }\n                     try {\n                         applicationMonitor = MonitorFactory.getApplicationMonitor(appId);\n                     } catch (PolicyValidationException e) {\n@@ -414,8 +414,10 @@ public void run() {\n                 log.error(msg);\n                 throw new RuntimeException(msg);\n             }\n+            AutoscalerContext autoscalerContext = AutoscalerContext.getInstance();\n \n-            AutoscalerContext.getInstance().addAppMonitor(applicationMonitor);\n+            autoscalerContext.removeAppMonitor(appId);\n+            autoscalerContext.addAppMonitor(applicationMonitor);\n             if (log.isInfoEnabled()) {\n                 log.info(String.format(\"Application monitor has been added successfully: \" +\n                         \"[application] %s\", applicationMonitor.getId()));",
                "deletions": 5
            },
            {
                "sha": "d0a993e7f921e82c5a349493f470ec2c618f6d97",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/util/StatusChecker.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/util/StatusChecker.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/util/StatusChecker.java",
                "status": "renamed",
                "changes": 5,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/util/StatusChecker.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -16,12 +16,11 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-package org.apache.stratos.autoscaler.status.processor;\n+package org.apache.stratos.autoscaler.util;\n \n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.stratos.autoscaler.context.AutoscalerContext;\n-import org.apache.stratos.autoscaler.context.partition.ClusterLevelPartitionContext;\n import org.apache.stratos.autoscaler.context.partition.network.ClusterLevelNetworkPartitionContext;\n import org.apache.stratos.autoscaler.applications.ApplicationHolder;\n import org.apache.stratos.autoscaler.applications.topic.ApplicationBuilder;\n@@ -350,7 +349,7 @@ private void handleStateChangeGroupScalingDisabled(ParentComponent component, St\n             //send the terminated event\n             if (component instanceof Application) {\n                 log.info(\"sending app terminated: \" + appId);\n-                ApplicationBuilder.handleApplicationTerminatedEvent(appId);\n+                ApplicationBuilder.handleApplicationTerminatedEvent(appId, null);\n             } else if (component instanceof Group) {\n                 //send activation to the parent\n                 if (((Group) component).getStatus(null) != GroupStatus.Terminated) {",
                "deletions": 3,
                "previous_filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/processor/StatusChecker.java"
            },
            {
                "sha": "48c349e6a94407b24a436bfbc515f0f2cb55da07",
                "filename": "components/org.apache.stratos.autoscaler/src/test/java/org/apache/stratos/autoscaler/TestRulesPackaged.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/test/java/org/apache/stratos/autoscaler/TestRulesPackaged.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/test/java/org/apache/stratos/autoscaler/TestRulesPackaged.java",
                "status": "modified",
                "changes": 8,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/test/java/org/apache/stratos/autoscaler/TestRulesPackaged.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -45,10 +45,10 @@ public void testMinCheckDroolsFile() {\n     }\n \n //FIXME add this when dependent scaling file is completed\n-//    @Test\n-//    public void testDependentScalingDroolsFile() {\n-//        parseDroolsFile(dependentScalingDrlFilePath);\n-//    }\n+    @Test\n+    public void testDependentScalingDroolsFile() {\n+        parseDroolsFile(dependentScalingDrlFilePath);\n+    }\n \n     @Test\n     public void testScalingDroolsFile() {",
                "deletions": 4
            },
            {
                "sha": "c0b684cbcea765e78b97551a366bac7605879f72",
                "filename": "components/org.apache.stratos.autoscaler/src/test/resources/autoscaler.xml",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/test/resources/autoscaler.xml",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.autoscaler/src/test/resources/autoscaler.xml",
                "status": "modified",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/test/resources/autoscaler.xml?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -28,12 +28,12 @@\n         </rulesEvaluator>\n         <cloudController>\n             <hostname>localhost</hostname>\n-            <port>9444</port>\n+            <port>9443</port>\n             <clientTimeout>300000</clientTimeout>\n         </cloudController>\n         <stratosManager>\n             <hostname>localhost</hostname>\n-            <port>9445</port>\n+            <port>9443</port>\n             <clientTimeout>300000</clientTimeout>\n         </stratosManager>\n         <member>",
                "deletions": 2
            },
            {
                "sha": "53fd658e56082134d9ac448c7bf861b1f4784f54",
                "filename": "components/org.apache.stratos.cartridge.agent/src/main/java/org/apache/stratos/cartridge/agent/CartridgeAgent.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cartridge.agent/src/main/java/org/apache/stratos/cartridge/agent/CartridgeAgent.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cartridge.agent/src/main/java/org/apache/stratos/cartridge/agent/CartridgeAgent.java",
                "status": "modified",
                "changes": 12,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cartridge.agent/src/main/java/org/apache/stratos/cartridge/agent/CartridgeAgent.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -247,8 +247,9 @@ protected void onEvent(Event event) {\n                 }\n             }\n         });\n-        Thread eventReceiverThread = new Thread(instanceNotifierEventReceiver);\n-        eventReceiverThread.start();\n+\n+\t    instanceNotifierEventReceiver.execute();\n+\n         if(log.isInfoEnabled()) {\n             log.info(\"Instance notifier event message receiver thread started\");\n         }\n@@ -414,8 +415,8 @@ protected void onEvent(Event event) {\n             }\n         });\n \n-        Thread thread = new Thread(topologyEventReceiver);\n-        thread.start();\n+\t    topologyEventReceiver.execute();\n+\n         if (log.isDebugEnabled()) {\n             log.info(\"Cartridge Agent topology receiver thread started\");\n         }\n@@ -537,8 +538,7 @@ protected void onEvent(Event event) {\n             }\n         });\n \n-        Thread tenantEventReceiverThread = new Thread(tenantEventReceiver);\n-        tenantEventReceiverThread.start();\n+\t    tenantEventReceiver.execute();\n         if (log.isInfoEnabled()) {\n             log.info(\"Tenant event message receiver thread started\");\n         }",
                "deletions": 6
            },
            {
                "sha": "2d19286ebbfb9ec64ec25bc91c7a796e7d8a1faf",
                "filename": "components/org.apache.stratos.cloud.controller/pom.xml",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/pom.xml",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/pom.xml",
                "status": "modified",
                "changes": 19,
                "additions": 12,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/pom.xml?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -216,19 +216,24 @@\n             <version>${jclouds.version}</version>\n         </dependency>\n         <dependency>\n-            <groupId>org.apache.stratos</groupId>\n+            <groupId>org.apache.jclouds.api</groupId>\n             <artifactId>ec2</artifactId>\n-            <version>1.8.0-stratos</version>\n+            <version>${jclouds.version}</version>\n         </dependency>\n         <dependency>\n             <groupId>org.apache.stratos</groupId>\n             <artifactId>aws-ec2</artifactId>\n-            <version>1.8.0-stratos</version>\n+            <version>${jclouds.stratos.version}</version>\n         </dependency>\n         <dependency>\n-            <groupId>org.apache.stratos</groupId>\n+            <groupId>org.apache.jclouds.api</groupId>\n             <artifactId>openstack-nova</artifactId>\n-            <version>1.8.0-stratos</version>\n+            <version>${jclouds.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.apache.stratos</groupId>\n+            <artifactId>openstack-neutron</artifactId>\n+            <version>${jclouds.stratos.version}</version>\n         </dependency>\n         <dependency>\n             <groupId>org.apache.jclouds.api</groupId>\n@@ -243,12 +248,12 @@\n         <dependency>\n             <groupId>org.apache.stratos</groupId>\n             <artifactId>vcloud</artifactId>\n-            <version>1.8.0-stratos</version>\n+            <version>${jclouds.stratos.version}</version>\n         </dependency>\n         <dependency>\n           <groupId>org.apache.stratos</groupId>\n           <artifactId>gce</artifactId>\n-          <version>1.8.0-stratos</version>\n+          <version>${jclouds.stratos.version}</version>\n         </dependency>\n \n         <dependency>",
                "deletions": 7
            },
            {
                "sha": "d3a61bd399461002dd7cf486a6292437d5784ae8",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/context/CloudControllerContext.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/context/CloudControllerContext.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/context/CloudControllerContext.java",
                "status": "modified",
                "changes": 226,
                "additions": 141,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/context/CloudControllerContext.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -36,19 +36,13 @@\n import org.wso2.carbon.databridge.agent.thrift.AsyncDataPublisher;\n import org.wso2.carbon.registry.core.exceptions.RegistryException;\n \n-import com.google.common.net.InetAddresses;\n-\n import java.io.Serializable;\n-import java.util.ArrayList;\n-import java.util.Arrays;\n-import java.util.HashMap;\n-import java.util.Iterator;\n-import java.util.List;\n-import java.util.Map;\n+import java.util.*;\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ExecutorService;\n import java.util.concurrent.Executors;\n import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.locks.Lock;\n \n /**\n  * This object holds all runtime data and provides faster access. This is a Singleton class.\n@@ -58,19 +52,27 @@\n     private static final long serialVersionUID = -2662307358852779897L;\n     private static final Log log = LogFactory.getLog(CloudControllerContext.class);\n \n-    public static final String KUB_GROUP_ID_TO_GROUP_MAP = \"KUB_GROUP_ID_TO_GROUP_MAP\";\n-    public static final String CC_CLUSTER_ID_TO_MEMBER_CTX = \"CC_CLUSTER_ID_TO_MEMBER_CTX\";\n-    public static final String CC_MEMBER_ID_TO_MEMBER_CTX = \"CC_MEMBER_ID_TO_MEMBER_CTX\";\n-    public static final String CC_MEMBER_ID_TO_SCH_TASK = \"CC_MEMBER_ID_TO_SCH_TASK\";\n-    public static final String CC_KUB_CLUSTER_ID_TO_KUB_CLUSTER_CTX = \"CC_KUB_CLUSTER_ID_TO_KUB_CLUSTER_CTX\";\n-    public static final String CC_CLUSTER_ID_TO_CLUSTER_CTX = \"CC_CLUSTER_ID_TO_CLUSTER_CTX\";\n-    public static final String CC_CARTRIDGE_TYPE_TO_PARTITION_IDS = \"CC_CARTRIDGE_TYPE_TO_PARTITION_IDS\";\n-    public static final String CC_CARTRIDGES = \"CC_CARTRIDGES\";\n-    public static final String CC_SERVICE_GROUPS = \"CC_SERVICE_GROUPS\";\n+    private static final String CC_CLUSTER_ID_TO_MEMBER_CTX_MAP = \"CC_CLUSTER_ID_TO_MEMBER_CTX_MAP\";\n+    private static final String CC_CLUSTER_ID_TO_CLUSTER_CTX = \"CC_CLUSTER_ID_TO_CLUSTER_CTX\";\n+    private static final String CC_MEMBER_ID_TO_MEMBER_CTX_MAP = \"CC_MEMBER_ID_TO_MEMBER_CTX_MAP\";\n+    private static final String CC_MEMBER_ID_TO_SCH_TASK_MAP = \"CC_MEMBER_ID_TO_SCH_TASK_MAP\";\n+    private static final String CC_KUB_GROUP_ID_TO_GROUP_MAP = \"CC_KUB_GROUP_ID_TO_GROUP_MAP\";\n+    private static final String CC_KUB_CLUSTER_ID_TO_KUB_CLUSTER_CTX_MAP = \"CC_KUB_CLUSTER_ID_TO_KUB_CLUSTER_CTX_MAP\";\n+    private static final String CC_CARTRIDGE_TYPE_TO_PARTITION_IDS_MAP = \"CC_CARTRIDGE_TYPE_TO_PARTITION_IDS_MAP\";\n+    private static final String CC_CARTRIDGE_TYPE_TO_CARTRIDGES_MAP = \"CC_CARTRIDGE_TYPE_TO_CARTRIDGES_MAP\";\n+    private static final String CC_SERVICE_GROUP_NAME_TO_SERVICE_GROUP_MAP = \"CC_SERVICE_GROUP_NAME_TO_SERVICE_GROUP_MAP\";\n+\n+    private static final String CC_CLUSTER_CTX_WRITE_LOCK = \"CC_CLUSTER_CTX_WRITE_LOCK\";\n+    private static final String CC_MEMBER_CTX_WRITE_LOCK = \"CC_MEMBER_CTX_WRITE_LOCK\";\n+    private static final String CC_SCH_TASK_WRITE_LOCK = \"CC_SCH_TASK_WRITE_LOCK\";\n+    private static final String CC_KUB_GROUP_WRITE_LOCK = \"CC_KUB_GROUP_WRITE_LOCK\";\n+    private static final String CC_KUB_CLUSTER_CTX_WRITE_LOCK = \"CC_KUB_CLUSTER_CTX_WRITE_LOCK\";\n+    private static final String CC_CARTRIDGES_WRITE_LOCK = \"CC_CARTRIDGES_WRITE_LOCK\";\n+    private static final String CC_SERVICE_GROUPS_WRITE_LOCK = \"CC_SERVICE_GROUPS_WRITE_LOCK\";\n \n     private static volatile CloudControllerContext instance;\n \n-    private final DistributedObjectProvider distributedObjectProvider;\n+    private final transient DistributedObjectProvider distributedObjectProvider;\n \n \t/* We keep following maps in order to make the look up time, small. */\n     \n@@ -124,21 +126,26 @@\n     private transient ExecutorService executorService = Executors.newFixedThreadPool(20);\n \n     /**\n-     * List of registered {@link org.apache.stratos.cloud.controller.domain.Cartridge}s\n+     * Map of registered {@link org.apache.stratos.cloud.controller.domain.Cartridge}s\n+     * Key - cartridge type\n+     * Value - cartridge\n      */\n-    private List<Cartridge> cartridges;\n+    private Map<String, Cartridge> cartridgeTypeToCartridgeMap;\n \n     /**\n-     * List of deployed service groups\n+     * Map of deployed service groups\n+     * Key - service group name\n+     * Value service group\n      */\n-    private List<ServiceGroup> serviceGroups;\n+    private Map<String, ServiceGroup> serviceGroupNameToServiceGroupMap;\n \n     private String streamId;\n     private boolean isPublisherRunning;\n     private boolean isTopologySyncRunning;\n     private boolean clustered;\n \n     private transient AsyncDataPublisher dataPublisher;\n+    private boolean coordinator;\n \n     private CloudControllerContext() {\n         // Check clustering status\n@@ -151,15 +158,15 @@ private CloudControllerContext() {\n         distributedObjectProvider = ServiceReferenceHolder.getInstance().getDistributedObjectProvider();\n \n         // Initialize objects\n-        kubernetesGroupsMap = distributedObjectProvider.getMap(KUB_GROUP_ID_TO_GROUP_MAP);\n-        clusterIdToMemberContextListMap = distributedObjectProvider.getMap(CC_CLUSTER_ID_TO_MEMBER_CTX);\n-        memberIdToMemberContextMap = distributedObjectProvider.getMap(CC_MEMBER_ID_TO_MEMBER_CTX);\n-        memberIdToScheduledTaskMap = distributedObjectProvider.getMap(CC_MEMBER_ID_TO_SCH_TASK);\n-        kubClusterIdToKubClusterContextMap = distributedObjectProvider.getMap(CC_KUB_CLUSTER_ID_TO_KUB_CLUSTER_CTX);\n+        kubernetesGroupsMap = distributedObjectProvider.getMap(CC_KUB_GROUP_ID_TO_GROUP_MAP);\n+        clusterIdToMemberContextListMap = distributedObjectProvider.getMap(CC_CLUSTER_ID_TO_MEMBER_CTX_MAP);\n+        memberIdToMemberContextMap = distributedObjectProvider.getMap(CC_MEMBER_ID_TO_MEMBER_CTX_MAP);\n+        memberIdToScheduledTaskMap = distributedObjectProvider.getMap(CC_MEMBER_ID_TO_SCH_TASK_MAP);\n+        kubClusterIdToKubClusterContextMap = distributedObjectProvider.getMap(CC_KUB_CLUSTER_ID_TO_KUB_CLUSTER_CTX_MAP);\n         clusterIdToContextMap = distributedObjectProvider.getMap(CC_CLUSTER_ID_TO_CLUSTER_CTX);\n-        cartridgeTypeToPartitionIdsMap = distributedObjectProvider.getMap(CC_CARTRIDGE_TYPE_TO_PARTITION_IDS);\n-        cartridges = distributedObjectProvider.getList(CC_CARTRIDGES);\n-        serviceGroups = distributedObjectProvider.getList(CC_SERVICE_GROUPS);\n+        cartridgeTypeToPartitionIdsMap = distributedObjectProvider.getMap(CC_CARTRIDGE_TYPE_TO_PARTITION_IDS_MAP);\n+        cartridgeTypeToCartridgeMap = distributedObjectProvider.getMap(CC_CARTRIDGE_TYPE_TO_CARTRIDGES_MAP);\n+        serviceGroupNameToServiceGroupMap = distributedObjectProvider.getMap(CC_SERVICE_GROUP_NAME_TO_SERVICE_GROUP_MAP);\n \n         // Update context from the registry\n         updateContextFromRegistry();\n@@ -176,51 +183,97 @@ public static CloudControllerContext getInstance() {\n         return instance;\n     }\n \n-    public List<Cartridge> getCartridges() {\n-        return cartridges;\n+    public java.util.Collection<Cartridge> getCartridges() {\n+        return cartridgeTypeToCartridgeMap.values();\n     }\n \n-    public void setCartridges(List<Cartridge> cartridges) {\n-        this.cartridges = cartridges;\n+    public void addCartridges(List<Cartridge> cartridges) {\n+        for(Cartridge cartridge : cartridges) {\n+            addCartridge(cartridge);\n+        }\n     }\n \n-    public void setServiceGroups(List<ServiceGroup> serviceGroups) {\n-        this.serviceGroups = serviceGroups;\n+    public void addServiceGroups(List<ServiceGroup> serviceGroups) {\n+        for(ServiceGroup serviceGroup : serviceGroups) {\n+            addServiceGroup(serviceGroup);\n+        }\n     }\n \n-    public List<ServiceGroup> getServiceGroups() {\n-        return this.serviceGroups;\n+    public Collection<ServiceGroup> getServiceGroups() {\n+        return serviceGroupNameToServiceGroupMap.values();\n     }\n \n     public Cartridge getCartridge(String cartridgeType) {\n-        for (Cartridge cartridge : cartridges) {\n-            if (cartridge.getType().equals(cartridgeType)) {\n-                return cartridge;\n-            }\n+        return cartridgeTypeToCartridgeMap.get(cartridgeType);\n+    }\n+\n+    private Lock acquireWriteLock(String object) {\n+        return distributedObjectProvider.acquireLock(object);\n+    }\n+\n+    public void releaseWriteLock(Lock lock) {\n+        distributedObjectProvider.releaseLock(lock);\n+    }\n+\n+    public Lock acquireClusterContextWriteLock() {\n+        return acquireWriteLock(CC_CLUSTER_CTX_WRITE_LOCK);\n+    }\n+\n+    public Lock acquireMemberContextWriteLock() {\n+        return acquireWriteLock(CC_MEMBER_CTX_WRITE_LOCK);\n+    }\n+\n+    public Lock acquireScheduleTaskWriteLock() {\n+        return acquireWriteLock(CC_SCH_TASK_WRITE_LOCK);\n+    }\n+\n+    public Lock acquireKubernetesGroupWriteLock() {\n+        return acquireWriteLock(CC_KUB_GROUP_WRITE_LOCK);\n+    }\n+\n+    public Lock acquireKubernetesClusterContextWriteLock() {\n+        return acquireWriteLock(CC_KUB_CLUSTER_CTX_WRITE_LOCK);\n+    }\n+\n+    public Lock acquireCartridgesWriteLock() {\n+        return acquireWriteLock(CC_CARTRIDGES_WRITE_LOCK);\n+    }\n+\n+    public Lock acquireServiceGroupsWriteLock() {\n+        return acquireWriteLock(CC_SERVICE_GROUPS_WRITE_LOCK);\n+    }\n+\n+    public void addCartridge(Cartridge cartridge) {\n+        cartridgeTypeToCartridgeMap.put(cartridge.getType(), cartridge);\n+    }\n+\n+    public void removeCartridge(Cartridge cartridge) {\n+        if(cartridgeTypeToCartridgeMap.containsKey(cartridge.getType())) {\n+            cartridgeTypeToCartridgeMap.remove(cartridge.getType());\n         }\n-        return null;\n     }\n \n-    public void addCartridge(Cartridge newCartridges) {\n-        distributedObjectProvider.addToList(cartridges, newCartridges);\n+    public void updateCartridge(Cartridge cartridge) {\n+        cartridgeTypeToCartridgeMap.put(cartridge.getType(), cartridge);\n     }\n \n     public ServiceGroup getServiceGroup(String name) {\n-        for (ServiceGroup serviceGroup : serviceGroups) {\n-            if (serviceGroup.getName().equals(name)) {\n-                return serviceGroup;\n-            }\n-        }\n-        return null;\n+        return serviceGroupNameToServiceGroupMap.get(name);\n     }\n \n-    public void addServiceGroup(ServiceGroup newServiceGroup) {\n-        distributedObjectProvider.addToList(serviceGroups, newServiceGroup);\n+    public void addServiceGroup(ServiceGroup serviceGroup) {\n+        serviceGroupNameToServiceGroupMap.put(serviceGroup.getName(), serviceGroup);\n     }\n \n-    public void removeServiceGroup(List<ServiceGroup> serviceGroup) {\n-        if (this.serviceGroups != null) {\n-            this.serviceGroups.removeAll(serviceGroup);\n+    public void removeServiceGroups(List<ServiceGroup> serviceGroups) {\n+        for(ServiceGroup serviceGroup : serviceGroups) {\n+            removeServiceGroup(serviceGroup);\n+        }\n+    }\n+\n+    private void removeServiceGroup(ServiceGroup serviceGroup) {\n+        if(serviceGroupNameToServiceGroupMap.containsKey(serviceGroup.getName())) {\n+            serviceGroupNameToServiceGroupMap.remove(serviceGroup.getName());\n         }\n     }\n \n@@ -257,38 +310,37 @@ public void setTopologySyncRunning(boolean isTopologySyncRunning) {\n     }\n \n     public void addMemberContext(MemberContext memberContext) {\n-        distributedObjectProvider.putToMap(memberIdToMemberContextMap, memberContext.getMemberId(), memberContext);\n+        memberIdToMemberContextMap.put(memberContext.getMemberId(), memberContext);\n \n         List<MemberContext> memberContextList;\n         if ((memberContextList = clusterIdToMemberContextListMap.get(memberContext.getClusterId())) == null) {\n             memberContextList = new ArrayList<MemberContext>();\n         }\n         if (memberContextList.contains(memberContext)) {\n-            distributedObjectProvider.removeFromList(memberContextList,memberContext);\n+            memberContextList.remove(memberContext);\n         }\n-        distributedObjectProvider.addToList(memberContextList, memberContext);\n-        distributedObjectProvider.putToMap(clusterIdToMemberContextListMap, memberContext.getClusterId(),\n-                memberContextList);\n+        memberContextList.add(memberContext);\n+        clusterIdToMemberContextListMap.put(memberContext.getClusterId(), memberContextList);\n         if (log.isDebugEnabled()) {\n             log.debug(\"Added member context to the cloud controller context: \" + memberContext);\n         }\n     }\n \n     public void addScheduledFutureJob(String memberId, ScheduledFuture<?> job) {\n-        distributedObjectProvider.putToMap(memberIdToScheduledTaskMap, memberId, job);\n+        memberIdToScheduledTaskMap.put(memberId, job);\n     }\n \n     public List<MemberContext> removeMemberContextsOfCluster(String clusterId) {\n         List<MemberContext> memberContextList = clusterIdToMemberContextListMap.get(clusterId);\n-        distributedObjectProvider.removeFromMap(clusterIdToMemberContextListMap, clusterId);\n+        clusterIdToMemberContextListMap.remove(clusterId);\n         if (memberContextList == null) {\n             return new ArrayList<MemberContext>();\n         }\n         for (MemberContext memberContext : memberContextList) {\n             String memberId = memberContext.getMemberId();\n-            distributedObjectProvider.removeFromMap(memberIdToMemberContextMap, memberId);\n+            memberIdToMemberContextMap.remove(memberId);\n             ScheduledFuture<?> task = memberIdToScheduledTaskMap.get(memberId);\n-            distributedObjectProvider.removeFromMap(memberIdToScheduledTaskMap, memberId);\n+            memberIdToScheduledTaskMap.remove(memberId);\n             stopTask(task);\n \n             if (log.isDebugEnabled()) {\n@@ -301,7 +353,7 @@ public void addScheduledFutureJob(String memberId, ScheduledFuture<?> job) {\n \n     public MemberContext removeMemberContext(String memberId, String clusterId) {\n         MemberContext removedMemberContext = memberIdToMemberContextMap.get(memberId);\n-        distributedObjectProvider.removeFromMap(memberIdToMemberContextMap, memberId);\n+        memberIdToMemberContextMap.remove(memberId);\n \n         List<MemberContext> memberContextList = clusterIdToMemberContextListMap.get(clusterId);\n         if (memberContextList != null) {\n@@ -315,10 +367,10 @@ public MemberContext removeMemberContext(String memberId, String clusterId) {\n                     iterator.remove();\n                 }\n             }\n-            distributedObjectProvider.putToMap(clusterIdToMemberContextListMap, clusterId, newCtxts);\n+            clusterIdToMemberContextListMap.put(clusterId, newCtxts);\n         }\n         ScheduledFuture<?> task = memberIdToScheduledTaskMap.get(memberId);\n-        distributedObjectProvider.removeFromMap(memberIdToScheduledTaskMap, memberId);\n+        memberIdToScheduledTaskMap.remove(memberId);\n         stopTask(task);\n         return removedMemberContext;\n     }\n@@ -339,7 +391,7 @@ public MemberContext getMemberContextOfMemberId(String memberId) {\n     }\n \n     public void addClusterContext(ClusterContext ctxt) {\n-        distributedObjectProvider.putToMap(clusterIdToContextMap, ctxt.getClusterId(), ctxt);\n+        clusterIdToContextMap.put(ctxt.getClusterId(), ctxt);\n     }\n \n     public ClusterContext getClusterContext(String clusterId) {\n@@ -348,7 +400,7 @@ public ClusterContext getClusterContext(String clusterId) {\n \n     public ClusterContext removeClusterContext(String clusterId) {\n         ClusterContext removed = clusterIdToContextMap.get(clusterId);\n-        distributedObjectProvider.removeFromMap(clusterIdToContextMap, clusterId);\n+        clusterIdToContextMap.remove(clusterId);\n         return removed;\n     }\n \n@@ -366,19 +418,19 @@ public void addToCartridgeTypeToPartitionIdMap(String cartridgeType, String part\n             list = new ArrayList<String>();\n         }\n         list.add(partitionId);\n-        distributedObjectProvider.putToMap(cartridgeTypeToPartitionIdsMap, cartridgeType, list);\n+        cartridgeTypeToPartitionIdsMap.put(cartridgeType, list);\n     }\n \n     public void removeFromCartridgeTypeToPartitionIds(String cartridgeType) {\n-        distributedObjectProvider.removeFromMap(cartridgeTypeToPartitionIdsMap, cartridgeType);\n+        cartridgeTypeToPartitionIdsMap.remove(cartridgeType);\n     }\n \n     public KubernetesClusterContext getKubernetesClusterContext(String kubClusterId) {\n         return kubClusterIdToKubClusterContextMap.get(kubClusterId);\n     }\n \n     public void addKubernetesClusterContext(KubernetesClusterContext kubernetesClusterContext) {\n-        distributedObjectProvider.putToMap(kubClusterIdToKubClusterContextMap,\n+        kubClusterIdToKubClusterContextMap.put(\n                 kubernetesClusterContext.getKubernetesClusterId(),\n                 kubernetesClusterContext);\n     }\n@@ -388,7 +440,7 @@ public void addKubernetesClusterContext(KubernetesClusterContext kubernetesClust\n      */\n     public synchronized void removeKubernetesGroup(String kubernetesGroupId) {\n         // Remove entry from information model\n-        distributedObjectProvider.removeFromMap(kubernetesGroupsMap, kubernetesGroupId);\n+        kubernetesGroupsMap.remove(kubernetesGroupId);\n     }\n \n     /**\n@@ -435,8 +487,12 @@ public synchronized boolean removeKubernetesHost(String kubernetesHostId) throws\n         }\n     }\n \n-    public void addKubernetesGroupToInformationModel(KubernetesGroup kubernetesGroup) {\n-        distributedObjectProvider.putToMap(kubernetesGroupsMap, kubernetesGroup.getGroupId(), kubernetesGroup);\n+    public void addKubernetesGroup(KubernetesGroup kubernetesGroup) {\n+        kubernetesGroupsMap.put(kubernetesGroup.getGroupId(), kubernetesGroup);\n+    }\n+\n+    public void updateKubernetesGroup(KubernetesGroup kubernetesGroup) {\n+        kubernetesGroupsMap.put(kubernetesGroup.getGroupId(), kubernetesGroup);\n     }\n     \n     public boolean kubernetesGroupExists(KubernetesGroup kubernetesGroup) {\n@@ -525,9 +581,11 @@ public boolean isClustered() {\n     }\n \n     public boolean isCoordinator() {\n-        AxisConfiguration axisConfiguration = ServiceReferenceHolder.getInstance().getAxisConfiguration();\n-        ClusteringAgent clusteringAgent = axisConfiguration.getClusteringAgent();\n-        return ((axisConfiguration != null) && (clusteringAgent != null) && (clusteringAgent.isCoordinator()));\n+        return coordinator;\n+    }\n+\n+    public void setCoordinator(boolean coordinator) {\n+        this.coordinator = coordinator;\n     }\n \n     public void persist() throws RegistryException {\n@@ -548,13 +606,11 @@ private void updateContextFromRegistry() {\n                         copyMap(serializedObj.kubernetesGroupsMap, kubernetesGroupsMap);\n                         copyMap(serializedObj.clusterIdToMemberContextListMap, clusterIdToMemberContextListMap);\n                         copyMap(serializedObj.memberIdToMemberContextMap, memberIdToMemberContextMap);\n-                        copyMap(serializedObj.memberIdToScheduledTaskMap, memberIdToScheduledTaskMap);\n                         copyMap(serializedObj.kubClusterIdToKubClusterContextMap, kubClusterIdToKubClusterContextMap);\n                         copyMap(serializedObj.clusterIdToContextMap, clusterIdToContextMap);\n                         copyMap(serializedObj.cartridgeTypeToPartitionIdsMap, cartridgeTypeToPartitionIdsMap);\n-\n-                        copyList(serializedObj.getCartridges(), cartridges);\n-                        copyList(serializedObj.getServiceGroups(), serviceGroups);\n+                        copyMap(serializedObj.cartridgeTypeToCartridgeMap, cartridgeTypeToCartridgeMap);\n+                        copyMap(serializedObj.serviceGroupNameToServiceGroupMap, serviceGroupNameToServiceGroupMap);\n \n                         if (log.isDebugEnabled()) {\n                             log.debug(\"Cloud controller context is read from the registry\");\n@@ -575,13 +631,13 @@ private void updateContextFromRegistry() {\n \n     private void copyMap(Map sourceMap, Map destinationMap) {\n         for(Object key : sourceMap.keySet()) {\n-            distributedObjectProvider.putToMap(destinationMap, key, sourceMap.get(key));\n+            destinationMap.put(key, sourceMap.get(key));\n         }\n     }\n \n     private void copyList(List sourceList, List destinationList) {\n         for(Object item : sourceList) {\n-            distributedObjectProvider.addToList(destinationList, item);\n+            destinationList.add(item);\n         }\n     }\n }\n\\ No newline at end of file",
                "deletions": 85
            },
            {
                "sha": "8a83733e63aad04a6a208b21d8ea082f6af4773b",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/FloatingNetwork.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/FloatingNetwork.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/FloatingNetwork.java",
                "status": "added",
                "changes": 87,
                "additions": 87,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/FloatingNetwork.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -0,0 +1,87 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one \n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * \n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY \n+ * KIND, either express or implied.  See the License for the \n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.stratos.cloud.controller.domain;\n+\n+import java.io.Serializable;\n+\n+/**\n+ * Every {@link NetworkInterface} can have \n+ * an array of {@link FloatingNetwork} \n+ * to which the network interface is associated\n+ * @author rajkumar\n+ */\n+public class FloatingNetwork implements Serializable{\n+\n+\tprivate static final long serialVersionUID = -432127317992004321L;\n+\tprivate String name;\n+\tprivate String networkUuid;\n+\tprivate String floatingIP;\n+\t\n+\tpublic FloatingNetwork() {\n+\t}\n+\t\n+\tpublic FloatingNetwork(String name, String networkUuid, String flotingIP) {\n+\t\tthis.name = name;\n+\t\tthis.networkUuid = networkUuid;\n+\t\tthis.floatingIP = flotingIP;\n+\t}\n+\t\n+\tpublic String getName() {\n+\t\treturn name;\n+\t}\n+\n+\tpublic void setName(String name) {\n+\t\tthis.name = name;\n+\t}\n+\n+\tpublic String getNetworkUuid() {\n+\t\treturn networkUuid;\n+\t}\n+\n+\tpublic void setNetworkUuid(String networkUuid) {\n+\t\tthis.networkUuid = networkUuid;\n+\t}\n+\t\n+\tpublic String getFloatingIP() {\n+\t\treturn floatingIP;\n+\t}\n+\n+\tpublic void setFloatingIP(String floatingIP) {\n+\t\tthis.floatingIP = floatingIP;\n+\t}\n+\n+\tpublic String toString() {\n+    \tStringBuilder sb = new StringBuilder('{');\n+    \tString delimeter = \"\";\n+    \tif (name != null) {\n+    \t\tsb.append(delimeter).append(\"name : \").append(name);\n+    \t\tdelimeter = \", \";\n+    \t}\n+    \tif (networkUuid != null) {\n+    \t\tsb.append(delimeter).append(\"networkUuid : \").append(networkUuid);\n+    \t\tdelimeter = \", \";\n+    \t}\n+    \tif (floatingIP != null) {\n+    \t\tsb.append(delimeter).append(\"floatingIP : \").append(floatingIP);\n+    \t\tdelimeter = \", \";\n+    \t}\n+    \tsb.append('}');\n+        return sb.toString();\n+\t}\n+}\n\\ No newline at end of file",
                "deletions": 0
            },
            {
                "sha": "01ecda1d4317f1d927a44ee04acc1389723fb5b8",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/FloatingNetworks.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/FloatingNetworks.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/FloatingNetworks.java",
                "status": "added",
                "changes": 44,
                "additions": 44,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/FloatingNetworks.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -0,0 +1,44 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one \n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ * \n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY \n+ * KIND, either express or implied.  See the License for the \n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.stratos.cloud.controller.domain;\n+\n+import java.io.Serializable;\n+import java.util.Arrays;\n+\n+/**\n+ * Wrapping {@link FloatingNetwork} array\n+ * @author rajkumar\n+ */\n+public class FloatingNetworks implements Serializable{\n+\t\n+\tprivate static final long serialVersionUID = -6754884581236402662L;\n+\tprivate FloatingNetwork[] floatingNetworks;\n+\t\n+\tpublic FloatingNetwork[] getFloatingNetworks() {\n+\t\treturn floatingNetworks;\n+\t}\n+\tpublic void setFloatingNetworks(FloatingNetwork[] floatingNetworks) {\n+\t\tthis.floatingNetworks = floatingNetworks;\n+\t}\n+\t\n+\t@Override\n+    public String toString() {\n+        return \"FloatingNetworks [FloatingNetworks =\" + Arrays.toString(floatingNetworks) + \"]\";\n+    }\n+}\n\\ No newline at end of file",
                "deletions": 0
            },
            {
                "sha": "7c1fea11f8613867b231277ff412e09724b1a0c8",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/NetworkInterface.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/NetworkInterface.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/NetworkInterface.java",
                "status": "modified",
                "changes": 15,
                "additions": 15,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/domain/NetworkInterface.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -29,6 +29,7 @@\n \tprivate String networkUuid;\n \tprivate String fixedIp;\n \tprivate String portUuid;\n+\tprivate FloatingNetworks floatingNetworks;\n \t\n \tpublic NetworkInterface() {\n \t}\n@@ -76,6 +77,20 @@ public void setPortUuid(String portUuid) {\n \t\tthis.portUuid = portUuid;\n \t}\n \t\n+\t/**\n+\t* @return {@link FloatingNetworks}\n+\t*/\n+\tpublic FloatingNetworks getFloatingNetworks() {\n+\t\treturn floatingNetworks;\n+\t}\n+\t\n+\t/**\n+\t* @param floatingNetworks the {@link FloatingNetworks} to be set\n+\t*/\n+\tpublic void setFloatingNetworks(FloatingNetworks floatingNetworks) {\n+\t\tthis.floatingNetworks = floatingNetworks;\n+\t}\n+\t\n \tpublic String toString() {\n     \tStringBuilder sb = new StringBuilder('{');\n     \tString delimeter = \"\";",
                "deletions": 0
            },
            {
                "sha": "ed1b0f54faba025582f25194237a7f40b18dca56",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/internal/CloudControllerServiceComponent.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/internal/CloudControllerServiceComponent.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/internal/CloudControllerServiceComponent.java",
                "status": "modified",
                "changes": 136,
                "additions": 87,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/internal/CloudControllerServiceComponent.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -20,7 +20,6 @@\n  *\n */\n \n-\n import com.hazelcast.core.HazelcastInstance;\n \n import org.apache.commons.logging.Log;\n@@ -34,21 +33,25 @@\n import org.apache.stratos.cloud.controller.messaging.publisher.TopologySynchronizerTaskScheduler;\n import org.apache.stratos.cloud.controller.messaging.receiver.instance.status.InstanceStatusTopicReceiver;\n import org.apache.stratos.common.clustering.DistributedObjectProvider;\n+import org.apache.stratos.common.threading.StratosThreadPool;\n import org.apache.stratos.messaging.broker.publish.EventPublisherPool;\n import org.apache.stratos.messaging.util.Util;\n import org.osgi.framework.BundleContext;\n import org.osgi.service.component.ComponentContext;\n-import org.wso2.carbon.caching.impl.DistributedMapProvider;\n import org.wso2.carbon.ntask.core.service.TaskService;\n import org.wso2.carbon.registry.core.exceptions.RegistryException;\n import org.wso2.carbon.registry.core.service.RegistryService;\n import org.wso2.carbon.registry.core.session.UserRegistry;\n import org.wso2.carbon.utils.ConfigurationContextService;\n \n+import java.util.concurrent.ExecutorService;\n+\n /**\n  * Registering Cloud Controller Service.\n  *\n  * @scr.component name=\"org.apache.stratos.cloud.controller\" immediate=\"true\"\n+ * @scr.reference name=\"hazelcast.instance.service\" interface=\"com.hazelcast.core.HazelcastInstance\"\n+ *                cardinality=\"0..1\"policy=\"dynamic\" bind=\"setHazelcastInstance\" unbind=\"unsetHazelcastInstance\"\n  * @scr.reference name=\"distributedObjectProvider\" interface=\"org.apache.stratos.common.clustering.DistributedObjectProvider\"\n  *                cardinality=\"1..1\" policy=\"dynamic\" bind=\"setDistributedObjectProvider\" unbind=\"unsetDistributedObjectProvider\"\n  * @scr.reference name=\"ntask.component\" interface=\"org.wso2.carbon.ntask.core.service.TaskService\"\n@@ -60,57 +63,84 @@\n  */\n public class CloudControllerServiceComponent {\n \n-    private static final Log log = LogFactory.getLog(CloudControllerServiceComponent.class);\n-    private ClusterStatusTopicReceiver clusterStatusTopicReceiver;\n-    private InstanceStatusTopicReceiver instanceStatusTopicReceiver;\n-    private ApplicationTopicReceiver applicationTopicReceiver;\n+\tprivate static final Log log = LogFactory.getLog(CloudControllerServiceComponent.class);\n+\tprivate ClusterStatusTopicReceiver clusterStatusTopicReceiver;\n+\tprivate InstanceStatusTopicReceiver instanceStatusTopicReceiver;\n+\tprivate ApplicationTopicReceiver applicationTopicReceiver;\n+    private ExecutorService executorService;\n \n-    protected void activate(ComponentContext context) {\n-        try {\n-            applicationTopicReceiver = new ApplicationTopicReceiver();\n-            Thread tApplicationTopicReceiver = new Thread(applicationTopicReceiver);\n-            tApplicationTopicReceiver.start();\n+    private static final String THREAD_IDENTIFIER_KEY = \"threadPool.autoscaler.identifier\";\n+\tprivate static final String DEFAULT_IDENTIFIER = \"Cloud-Controller\";\n+\tprivate static final String THREAD_POOL_SIZE_KEY = \"threadPool.cloudcontroller.threadPoolSize\";\n+\tprivate static final String COMPONENTS_CONFIG = \"stratos-config\";\n+\tprivate static final int THREAD_POOL_SIZE = 10;\n+    private static final String CLOUD_CONTROLLER_COORDINATOR_LOCK = \"CLOUD_CONTROLLER_COORDINATOR_LOCK\";\n \n-            if (log.isInfoEnabled()) {\n-                log.info(\"Application event receiver thread started\");\n+    protected void activate(ComponentContext context) {\n+\t\ttry {\n+\t\t\texecutorService = StratosThreadPool.getExecutorService(DEFAULT_IDENTIFIER, THREAD_POOL_SIZE);\n+\n+\t\t\t// Register cloud controller service\n+\t\t\tBundleContext bundleContext = context.getBundleContext();\n+\t\t\tbundleContext.registerService(CloudControllerService.class.getName(),\n+\t\t\t                              new CloudControllerServiceImpl(), null);\n+\n+            if(CloudControllerContext.getInstance().isClustered()) {\n+                Thread coordinatorElectorThread = new Thread() {\n+                    @Override\n+                    public void run() {\n+                        ServiceReferenceHolder.getInstance().getHazelcastInstance()\n+                                .getLock(CLOUD_CONTROLLER_COORDINATOR_LOCK).lock();\n+\n+                        log.info(\"Elected this member [\" + ServiceReferenceHolder.getInstance().getHazelcastInstance()\n+                                .getCluster().getLocalMember().getUuid() + \"] \" +\n+                                \"as the cloud controller coordinator for the cluster\");\n+\n+                        CloudControllerContext.getInstance().setCoordinator(true);\n+                        executeCoordinatorTasks();\n+                    }\n+                };\n+                coordinatorElectorThread.setName(\"Cloud controller coordinator elector thread\");\n+                executorService.submit(coordinatorElectorThread);\n+            } else {\n+                executeCoordinatorTasks();\n             }\n+\t\t} catch (Throwable e) {\n+\t\t\tlog.error(\"******* Cloud Controller Service bundle is failed to activate ****\", e);\n+        }\n+    }\n \n-            clusterStatusTopicReceiver = new ClusterStatusTopicReceiver();\n-            Thread tClusterStatusTopicReceiver = new Thread(clusterStatusTopicReceiver);\n-            tClusterStatusTopicReceiver.start();\n+    private void executeCoordinatorTasks() {\n+        applicationTopicReceiver = new ApplicationTopicReceiver();\n+        applicationTopicReceiver.setExecutorService(executorService);\n+        applicationTopicReceiver.execute();\n \n-            if (log.isInfoEnabled()) {\n-                log.info(\"Cluster status receiver thread started\");\n-            }\n+        if (log.isInfoEnabled()) {\n+            log.info(\"Application Receiver thread started\");\n+        }\n \n-            instanceStatusTopicReceiver = new InstanceStatusTopicReceiver();\n-            Thread tInstanceStatusTopicReceiver = new Thread(instanceStatusTopicReceiver);\n-            tInstanceStatusTopicReceiver.start();\n-            if(log.isInfoEnabled()) {\n-                log.info(\"Instance status message receiver thread started\");\n-            }\n+        clusterStatusTopicReceiver = new ClusterStatusTopicReceiver();\n+        clusterStatusTopicReceiver.setExecutorService(executorService);\n+        clusterStatusTopicReceiver.execute();\n \n-        \t// Register cloud controller service\n-            BundleContext bundleContext = context.getBundleContext();\n-            bundleContext.registerService(CloudControllerService.class.getName(),\n-                    new CloudControllerServiceImpl(), null);\n+        if (log.isInfoEnabled()) {\n+            log.info(\"Cluster status Receiver thread started\");\n+        }\n \n-            if(log.isInfoEnabled()) {\n-                log.info(\"Scheduling tasks\");\n-            }\n+        instanceStatusTopicReceiver = new InstanceStatusTopicReceiver();\n+        instanceStatusTopicReceiver.setExecutorService(executorService);\n+        instanceStatusTopicReceiver.execute();\n \n-            if ((!CloudControllerContext.getInstance().isClustered()) ||\n-                    (CloudControllerContext.getInstance().isCoordinator())) {\n-                TopologySynchronizerTaskScheduler.schedule(ServiceReferenceHolder.getInstance().getTaskService());\n-                if(log.isInfoEnabled()) {\n-                    log.info(\"Topology synchronizer task scheduled\");\n-                }\n-            }\n-        } catch (Throwable e) {\n-            log.error(\"**** Cloud controller service bundle is failed to activate ****\", e);\n+        if (log.isInfoEnabled()) {\n+            log.info(\"Instance status message receiver thread started\");\n         }\n+\n+        if (log.isInfoEnabled()) {\n+            log.info(\"Scheduling topology synchronizer task\");\n+        }\n+        TopologySynchronizerTaskScheduler.schedule(ServiceReferenceHolder.getInstance().getTaskService());\n     }\n-    \n+\n     protected void setTaskService(TaskService taskService) {\n         if (log.isDebugEnabled()) {\n             log.debug(\"Setting the Task Service\");\n@@ -124,20 +154,20 @@ protected void unsetTaskService(TaskService taskService) {\n         }\n         ServiceReferenceHolder.getInstance().setTaskService(null);\n     }\n-    \n+\n \tprotected void setRegistryService(RegistryService registryService) {\n \t\tif (log.isDebugEnabled()) {\n \t\t\tlog.debug(\"Setting the Registry Service\");\n \t\t}\n-\t\t\n-\t\ttry {\t\t\t\n+\n+\t\ttry {\n \t\t\tUserRegistry registry = registryService.getGovernanceSystemRegistry();\n \t        ServiceReferenceHolder.getInstance().setRegistry(registry);\n         } catch (RegistryException e) {\n         \tString msg = \"Failed when retrieving Governance System Registry.\";\n         \tlog.error(msg, e);\n         \tthrow new CloudControllerException(msg, e);\n-        } \n+        }\n \t}\n \n \tprotected void unsetRegistryService(RegistryService registryService) {\n@@ -146,7 +176,7 @@ protected void unsetRegistryService(RegistryService registryService) {\n         }\n         ServiceReferenceHolder.getInstance().setRegistry(null);\n \t}\n-\t\n+\n \tprotected void setConfigurationContextService(ConfigurationContextService cfgCtxService) {\n         ServiceReferenceHolder.getInstance().setAxisConfiguration(\n                 cfgCtxService.getServerConfigContext().getAxisConfiguration());\n@@ -156,16 +186,24 @@ protected void unsetConfigurationContextService(ConfigurationContextService cfgC\n         ServiceReferenceHolder.getInstance().setAxisConfiguration(null);\n     }\n \n+    public void setHazelcastInstance(HazelcastInstance hazelcastInstance) {\n+        ServiceReferenceHolder.getInstance().setHazelcastInstance(hazelcastInstance);\n+    }\n+\n+    public void unsetHazelcastInstance(HazelcastInstance hazelcastInstance) {\n+        ServiceReferenceHolder.getInstance().setHazelcastInstance(null);\n+    }\n+\n     protected void setDistributedObjectProvider(DistributedObjectProvider distributedObjectProvider) {\n         ServiceReferenceHolder.getInstance().setDistributedObjectProvider(distributedObjectProvider);\n     }\n \n     protected void unsetDistributedObjectProvider(DistributedObjectProvider distributedObjectProvider) {\n         ServiceReferenceHolder.getInstance().setDistributedObjectProvider(null);\n     }\n-\t\n+\n \tprotected void deactivate(ComponentContext ctx) {\n         // Close event publisher connections to message broker\n         EventPublisherPool.close(Util.Topics.TOPOLOGY_TOPIC.getTopicName());\n \t}\n-}\n+}\n\\ No newline at end of file",
                "deletions": 49
            },
            {
                "sha": "bbee450444aff2b4debfc355c92b9ab398c2d30d",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/internal/ServiceReferenceHolder.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/internal/ServiceReferenceHolder.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/internal/ServiceReferenceHolder.java",
                "status": "modified",
                "changes": 10,
                "additions": 10,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/internal/ServiceReferenceHolder.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -18,6 +18,7 @@\n  */\n package org.apache.stratos.cloud.controller.internal;\n \n+import com.hazelcast.core.HazelcastInstance;\n import org.apache.axis2.engine.AxisConfiguration;\n import org.apache.stratos.common.clustering.DistributedObjectProvider;\n import org.wso2.carbon.ntask.core.service.TaskService;\n@@ -34,6 +35,7 @@\n     private Registry registry;\n     private AxisConfiguration axisConfiguration;\n     private DistributedObjectProvider distributedObjectProvider;\n+    private HazelcastInstance hazelcastInstance;\n \n     private ServiceReferenceHolder() {\n     }\n@@ -76,4 +78,12 @@ public void setDistributedObjectProvider(DistributedObjectProvider distributedOb\n     public DistributedObjectProvider getDistributedObjectProvider() {\n         return distributedObjectProvider;\n     }\n+\n+    public void setHazelcastInstance(HazelcastInstance hazelcastInstance) {\n+        this.hazelcastInstance = hazelcastInstance;\n+    }\n+\n+    public HazelcastInstance getHazelcastInstance() {\n+        return hazelcastInstance;\n+    }\n }",
                "deletions": 0
            },
            {
                "sha": "e8d3674045cb46966d9f553e25fca9875ae0a31f",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/receiver/application/ApplicationTopicReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/receiver/application/ApplicationTopicReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/receiver/application/ApplicationTopicReceiver.java",
                "status": "modified",
                "changes": 68,
                "additions": 36,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/receiver/application/ApplicationTopicReceiver.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -22,60 +22,64 @@\n import org.apache.commons.logging.LogFactory;\n import org.apache.stratos.cloud.controller.messaging.topology.TopologyBuilder;\n import org.apache.stratos.messaging.event.Event;\n-import org.apache.stratos.messaging.event.applications.ApplicationTerminatedEvent;\n+import org.apache.stratos.messaging.event.applications.ApplicationInstanceTerminatedEvent;\n import org.apache.stratos.messaging.listener.applications.ApplicationTerminatedEventListener;\n import org.apache.stratos.messaging.message.receiver.applications.ApplicationsEventReceiver;\n \n+import java.util.concurrent.ExecutorService;\n+\n /**\n  * This is to receive the application topic messages.\n  */\n-public class ApplicationTopicReceiver implements Runnable{\n-    private static final Log log = LogFactory.getLog(ApplicationTopicReceiver.class);\n-    private ApplicationsEventReceiver applicationsEventReceiver;\n-    private boolean terminated;\n+public class ApplicationTopicReceiver {\n+\tprivate static final Log log = LogFactory.getLog(ApplicationTopicReceiver.class);\n+\tprivate ApplicationsEventReceiver applicationsEventReceiver;\n+\tprivate boolean terminated;\n+\tprivate ExecutorService executorService;\n \n-    public ApplicationTopicReceiver() {\n-        this.applicationsEventReceiver = new ApplicationsEventReceiver();\n-        addEventListeners();\n+\tpublic ApplicationTopicReceiver() {\n+\t\tthis.applicationsEventReceiver = new ApplicationsEventReceiver();\n+\t\taddEventListeners();\n \n-    }\n+\t}\n \n-    \n-    @Override\n-    public void run() {\n+\tpublic void execute() {\n \n-        if (log.isInfoEnabled()) {\n-            log.info(\"Cloud controller application status thread started\");\n-        }\n-        Thread thread = new Thread(applicationsEventReceiver);\n-        thread.start();\n+\t\tif (log.isInfoEnabled()) {\n+\t\t\tlog.info(\"Cloud controller application status thread started\");\n+\t\t}\n+\t\tapplicationsEventReceiver.setExecutorService(executorService);\n+\t\tapplicationsEventReceiver.execute();\n \n-        // Keep the thread live until terminated\n-        while (!terminated) {\n-            try {\n-                Thread.sleep(1000);\n-            } catch (InterruptedException ignore) {\n-            }\n-        }\n-        if (log.isInfoEnabled()) {\n-            log.info(\"Cloud controller application status thread terminated\");\n-        }\n \n-    }\n+\t\tif (log.isInfoEnabled()) {\n+\t\t\tlog.info(\"Cloud controller application status thread terminated\");\n+\t\t}\n+\n+\t}\n+\n+\tpublic void setTerminated(boolean terminated) {\n+\t\tthis.terminated = terminated;\n+\t}\n+\n+\tpublic ExecutorService getExecutorService() {\n+\t\treturn executorService;\n+\t}\n+\n     private void addEventListeners() {\n         applicationsEventReceiver.addEventListener(new ApplicationTerminatedEventListener() {\n             @Override\n             protected void onEvent(Event event) {\n                 //Remove the application related data\n-                ApplicationTerminatedEvent terminatedEvent = (ApplicationTerminatedEvent)event;\n+                ApplicationInstanceTerminatedEvent terminatedEvent = (ApplicationInstanceTerminatedEvent)event;\n                 log.info(\"ApplicationTerminatedEvent received for [application] \" + terminatedEvent.getAppId());\n                 String appId = terminatedEvent.getAppId();\n                 TopologyBuilder.handleApplicationClustersRemoved(appId, terminatedEvent.getClusterData());\n             }\n         });\n     }\n \n-    public void setTerminated(boolean terminated) {\n-        this.terminated = terminated;\n-    }\n+\tpublic void setExecutorService(ExecutorService executorService) {\n+\t\tthis.executorService = executorService;\n+\t}\n }",
                "deletions": 32
            },
            {
                "sha": "6a5fd5a55185860d12915b113d2fad77977e5304",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/receiver/cluster/status/ClusterStatusTopicReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/receiver/cluster/status/ClusterStatusTopicReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/receiver/cluster/status/ClusterStatusTopicReceiver.java",
                "status": "modified",
                "changes": 172,
                "additions": 87,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/receiver/cluster/status/ClusterStatusTopicReceiver.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -26,89 +26,91 @@\n import org.apache.stratos.messaging.listener.cluster.status.*;\n import org.apache.stratos.messaging.message.receiver.cluster.status.ClusterStatusEventReceiver;\n \n-public class ClusterStatusTopicReceiver implements Runnable{\n-    private static final Log log = LogFactory.getLog(ClusterStatusTopicReceiver.class);\n-\n-    private ClusterStatusEventReceiver statusEventReceiver;\n-    private boolean terminated;\n-\n-    public ClusterStatusTopicReceiver() {\n-        this.statusEventReceiver = new ClusterStatusEventReceiver();\n-        addEventListeners();\n-    }\n-\n-    public void run() {\n-        Thread thread = new Thread(statusEventReceiver);\n-        thread.start();\n-        if (log.isInfoEnabled()) {\n-            log.info(\"Cloud controller Cluster status thread started\");\n-        }\n-\n-        // Keep the thread live until terminated\n-        while (!terminated) {\n-            try {\n-                Thread.sleep(1000);\n-            } catch (InterruptedException ignore) {\n-            }\n-        }\n-        if (log.isInfoEnabled()) {\n-            log.info(\"Cloud controller application status thread terminated\");\n-        }\n-\n-    }\n-    private void addEventListeners() {\n-        // Listen to topology events that affect clusters\n-        statusEventReceiver.addEventListener(new ClusterStatusClusterResetEventListener() {\n-            @Override\n-            protected void onEvent(Event event) {\n-                TopologyBuilder.handleClusterReset((ClusterStatusClusterResetEvent) event);\n-            }\n-        });\n-\n-        statusEventReceiver.addEventListener(new ClusterStatusClusterInstanceCreatedEventListener() {\n-            @Override\n-            protected void onEvent(Event event) {\n-                //TopologyBuilder.handleClusterInstanceCreated((ClusterStatusClusterInstanceCreatedEvent) event);\n-            }\n-        });\n-\n-        statusEventReceiver.addEventListener(new ClusterStatusClusterCreatedEventListener() {\n-            @Override\n-            protected void onEvent(Event event) {\n-                TopologyBuilder.handleClusterCreated((ClusterStatusClusterCreatedEvent) event);\n-            }\n-        });\n-\n-        statusEventReceiver.addEventListener(new ClusterStatusClusterActivatedEventListener() {\n-            @Override\n-            protected void onEvent(Event event) {\n-                TopologyBuilder.handleClusterActivatedEvent((ClusterStatusClusterActivatedEvent) event);\n-            }\n-        });\n-\n-        statusEventReceiver.addEventListener(new ClusterStatusClusterTerminatedEventListener() {\n-            @Override\n-            protected void onEvent(Event event) {\n-                TopologyBuilder.handleClusterTerminatedEvent((ClusterStatusClusterTerminatedEvent) event);\n-            }\n-        });\n-\n-        statusEventReceiver.addEventListener(new ClusterStatusClusterTerminatingEventListener() {\n-            @Override\n-            protected void onEvent(Event event) {\n-                TopologyBuilder.handleClusterTerminatingEvent((ClusterStatusClusterTerminatingEvent) event);\n-            }\n-        });\n-\n-        statusEventReceiver.addEventListener(new ClusterStatusClusterInactivateEventListener() {\n-            @Override\n-            protected void onEvent(Event event) {\n-                TopologyBuilder.handleClusterInActivateEvent((ClusterStatusClusterInactivateEvent) event);\n-            }\n-        });\n-    }\n-\n-    public void setTerminated(boolean terminated) {\n-        this.terminated = terminated;\n-    }\n+import java.util.concurrent.ExecutorService;\n+\n+public class ClusterStatusTopicReceiver {\n+\tprivate static final Log log = LogFactory.getLog(ClusterStatusTopicReceiver.class);\n+\n+\tprivate ClusterStatusEventReceiver statusEventReceiver;\n+\tprivate boolean terminated;\n+\tprivate ExecutorService executorService;\n+\n+\tpublic ClusterStatusTopicReceiver() {\n+\t\tthis.statusEventReceiver = new ClusterStatusEventReceiver();\n+\n+\t\taddEventListeners();\n+\t}\n+\n+\tpublic void execute() {\n+\t\tstatusEventReceiver.setExecutorService(executorService);\n+\t\tstatusEventReceiver.execute();\n+\t\tif (log.isInfoEnabled()) {\n+\t\t\tlog.info(\"Cloud controller Cluster status thread started\");\n+\t\t}\n+\n+\t}\n+\n+\tprivate void addEventListeners() {\n+\t\t// Listen to topology events that affect clusters\n+\t\tstatusEventReceiver.addEventListener(new ClusterStatusClusterResetEventListener() {\n+\t\t\t@Override\n+\t\t\tprotected void onEvent(Event event) {\n+\t\t\t\tTopologyBuilder.handleClusterReset((ClusterStatusClusterResetEvent) event);\n+\t\t\t}\n+\t\t});\n+\n+\t\tstatusEventReceiver.addEventListener(new ClusterStatusClusterInstanceCreatedEventListener() {\n+\t\t\t@Override\n+\t\t\tprotected void onEvent(Event event) {\n+\t\t\t\t//TopologyBuilder.handleClusterInstanceCreated((ClusterStatusClusterInstanceCreatedEvent) event);\n+\t\t\t}\n+\t\t});\n+\n+\t\tstatusEventReceiver.addEventListener(new ClusterStatusClusterCreatedEventListener() {\n+\t\t\t@Override\n+\t\t\tprotected void onEvent(Event event) {\n+\t\t\t\tTopologyBuilder.handleClusterCreated((ClusterStatusClusterCreatedEvent) event);\n+\t\t\t}\n+\t\t});\n+\n+\t\tstatusEventReceiver.addEventListener(new ClusterStatusClusterActivatedEventListener() {\n+\t\t\t@Override\n+\t\t\tprotected void onEvent(Event event) {\n+\t\t\t\tTopologyBuilder.handleClusterActivatedEvent((ClusterStatusClusterActivatedEvent) event);\n+\t\t\t}\n+\t\t});\n+\n+\t\tstatusEventReceiver.addEventListener(new ClusterStatusClusterTerminatedEventListener() {\n+\t\t\t@Override\n+\t\t\tprotected void onEvent(Event event) {\n+\t\t\t\tTopologyBuilder.handleClusterTerminatedEvent((ClusterStatusClusterTerminatedEvent) event);\n+\t\t\t}\n+\t\t});\n+\n+\t\tstatusEventReceiver.addEventListener(new ClusterStatusClusterTerminatingEventListener() {\n+\t\t\t@Override\n+\t\t\tprotected void onEvent(Event event) {\n+\t\t\t\tTopologyBuilder.handleClusterTerminatingEvent((ClusterStatusClusterTerminatingEvent) event);\n+\t\t\t}\n+\t\t});\n+\n+\t\tstatusEventReceiver.addEventListener(new ClusterStatusClusterInactivateEventListener() {\n+\t\t\t@Override\n+\t\t\tprotected void onEvent(Event event) {\n+\t\t\t\tTopologyBuilder.handleClusterInActivateEvent((ClusterStatusClusterInactivateEvent) event);\n+\t\t\t}\n+\t\t});\n+\t}\n+\n+\tpublic void setTerminated(boolean terminated) {\n+\t\tthis.terminated = terminated;\n+\t}\n+\n+\tpublic ExecutorService getExecutorService() {\n+\t\treturn executorService;\n+\t}\n+\n+\tpublic void setExecutorService(ExecutorService executorService) {\n+\t\tthis.executorService = executorService;\n+\t}\n }",
                "deletions": 85
            },
            {
                "sha": "fde7bea00844c4f8d74fff9c4edc8065c40bce4e",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/receiver/instance/status/InstanceStatusTopicReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/receiver/instance/status/InstanceStatusTopicReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/receiver/instance/status/InstanceStatusTopicReceiver.java",
                "status": "modified",
                "changes": 125,
                "additions": 63,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/receiver/instance/status/InstanceStatusTopicReceiver.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -32,80 +32,81 @@\n import org.apache.stratos.messaging.listener.instance.status.InstanceStartedEventListener;\n import org.apache.stratos.messaging.message.receiver.instance.status.InstanceStatusEventReceiver;\n \n+import java.util.concurrent.ExecutorService;\n+\n /**\n  * This will handle the instance status events\n  */\n-public class InstanceStatusTopicReceiver implements Runnable {\n-    private static final Log log = LogFactory.getLog(InstanceStatusTopicReceiver.class);\n+public class InstanceStatusTopicReceiver {\n+\tprivate static final Log log = LogFactory.getLog(InstanceStatusTopicReceiver.class);\n \n-    private InstanceStatusEventReceiver statusEventReceiver;\n-    private boolean terminated;\n+\tprivate InstanceStatusEventReceiver statusEventReceiver;\n+\tprivate boolean terminated;\n+\tprivate ExecutorService executorService;\n \n-    public InstanceStatusTopicReceiver() {\n-        this.statusEventReceiver = new InstanceStatusEventReceiver();\n-        addEventListeners();\n-    }\n+\tpublic InstanceStatusTopicReceiver() {\n+\t\tthis.statusEventReceiver = new InstanceStatusEventReceiver();\n+\t\taddEventListeners();\n+\t}\n \n+\tpublic void execute() {\n+\t\tstatusEventReceiver.setExecutorService(executorService);\n+\t\tstatusEventReceiver.execute();\n+\t\tif (log.isInfoEnabled()) {\n+\t\t\tlog.info(\"Cloud controller application status thread started\");\n+\t\t}\n \n-    @Override\n-    public void run() {\n-        Thread thread = new Thread(statusEventReceiver);\n-        thread.start();\n-        if (log.isInfoEnabled()) {\n-            log.info(\"Cloud controller application status thread started\");\n-        }\n-        ///* Keep the thread live until terminated\n-        while (!terminated) {\n-            try {\n-                Thread.sleep(1000);\n-            } catch (InterruptedException ignore) {\n-            }\n-        }\n-        if (log.isInfoEnabled()) {\n-            log.info(\"Cloud controller application status thread terminated\");\n-        }\n-    }\n+\t\tif (log.isInfoEnabled()) {\n+\t\t\tlog.info(\"Cloud controller application status thread terminated\");\n+\t\t}\n+\t}\n \n-    private void addEventListeners() {\n-        statusEventReceiver.addEventListener(new InstanceActivatedEventListener() {\n-            @Override\n-            protected void onEvent(Event event) {\n-                TopologyBuilder.handleMemberActivated((InstanceActivatedEvent) event);\n-            }\n-        });\n+\tprivate void addEventListeners() {\n+\t\tstatusEventReceiver.addEventListener(new InstanceActivatedEventListener() {\n+\t\t\t@Override\n+\t\t\tprotected void onEvent(Event event) {\n+\t\t\t\tTopologyBuilder.handleMemberActivated((InstanceActivatedEvent) event);\n+\t\t\t}\n+\t\t});\n \n-        statusEventReceiver.addEventListener(new InstanceStartedEventListener() {\n-            @Override\n-            protected void onEvent(Event event) {\n-                TopologyBuilder.handleMemberStarted((InstanceStartedEvent) event);\n-            }\n-        });\n+\t\tstatusEventReceiver.addEventListener(new InstanceStartedEventListener() {\n+\t\t\t@Override\n+\t\t\tprotected void onEvent(Event event) {\n+\t\t\t\tTopologyBuilder.handleMemberStarted((InstanceStartedEvent) event);\n+\t\t\t}\n+\t\t});\n \n-        statusEventReceiver.addEventListener(new InstanceReadyToShutdownEventListener() {\n-            @Override\n-            protected void onEvent(Event event) {\n-                try {\n-                    TopologyBuilder.handleMemberReadyToShutdown((InstanceReadyToShutdownEvent) event);\n-                } catch (Exception e) {\n-                    String error = \"Failed to retrieve the instance status event message\";\n-                    log.error(error, e);\n-                }\n-            }\n-        });\n+\t\tstatusEventReceiver.addEventListener(new InstanceReadyToShutdownEventListener() {\n+\t\t\t@Override\n+\t\t\tprotected void onEvent(Event event) {\n+\t\t\t\ttry {\n+\t\t\t\t\tTopologyBuilder.handleMemberReadyToShutdown((InstanceReadyToShutdownEvent) event);\n+\t\t\t\t} catch (Exception e) {\n+\t\t\t\t\tString error = \"Failed to retrieve the instance status event message\";\n+\t\t\t\t\tlog.error(error, e);\n+\t\t\t\t}\n+\t\t\t}\n+\t\t});\n \n-        statusEventReceiver.addEventListener(new InstanceMaintenanceListener() {\n-            @Override\n-            protected void onEvent(Event event) {\n-                try {\n-                    TopologyBuilder.handleMemberMaintenance((InstanceMaintenanceModeEvent) event);\n-                } catch (Exception e) {\n-                String error = \"Failed to retrieve the instance status event message\";\n-                log.error(error, e);\n-                }\n-            }\n-        });\n+\t\tstatusEventReceiver.addEventListener(new InstanceMaintenanceListener() {\n+\t\t\t@Override\n+\t\t\tprotected void onEvent(Event event) {\n+\t\t\t\ttry {\n+\t\t\t\t\tTopologyBuilder.handleMemberMaintenance((InstanceMaintenanceModeEvent) event);\n+\t\t\t\t} catch (Exception e) {\n+\t\t\t\t\tString error = \"Failed to retrieve the instance status event message\";\n+\t\t\t\t\tlog.error(error, e);\n+\t\t\t\t}\n+\t\t\t}\n+\t\t});\n \n+\t}\n \n-    }\n+\tpublic ExecutorService getExecutorService() {\n+\t\treturn executorService;\n+\t}\n \n+\tpublic void setExecutorService(ExecutorService executorService) {\n+\t\tthis.executorService = executorService;\n+\t}\n }",
                "deletions": 62
            },
            {
                "sha": "a70a5ab864f5d29a246270ae1054e9fb89620e1c",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/topology/TopologyBuilder.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/topology/TopologyBuilder.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/topology/TopologyBuilder.java",
                "status": "modified",
                "changes": 13,
                "additions": 8,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/topology/TopologyBuilder.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -28,13 +28,12 @@\n import org.apache.stratos.cloud.controller.exception.InvalidCartridgeTypeException;\n import org.apache.stratos.cloud.controller.exception.InvalidMemberException;\n import org.apache.stratos.cloud.controller.messaging.publisher.CartridgeInstanceDataPublisher;\n-import org.apache.stratos.cloud.controller.registry.RegistryManager;\n import org.apache.stratos.cloud.controller.util.CloudControllerUtil;\n import org.apache.stratos.common.constants.StratosConstants;\n import org.apache.stratos.messaging.domain.applications.ClusterDataHolder;\n import org.apache.stratos.messaging.domain.instance.ClusterInstance;\n import org.apache.stratos.messaging.domain.topology.*;\n-import org.apache.stratos.messaging.event.applications.ApplicationTerminatedEvent;\n+import org.apache.stratos.messaging.event.applications.ApplicationInstanceTerminatedEvent;\n import org.apache.stratos.messaging.event.cluster.status.*;\n import org.apache.stratos.messaging.event.instance.status.InstanceActivatedEvent;\n import org.apache.stratos.messaging.event.instance.status.InstanceMaintenanceModeEvent;\n@@ -278,7 +277,9 @@ public static void handleClusterReset(ClusterStatusClusterResetEvent event) {\n \n     }\n \n-    public static void handleClusterInstanceCreated(String serviceType, String clusterId, String alias, String instanceId) {\n+    public static void handleClusterInstanceCreated(String serviceType, String clusterId,\n+                                                    String alias, String instanceId, String partitionId,\n+                                                    String networkPartitionId) {\n \n         TopologyManager.acquireWriteLock();\n \n@@ -309,7 +310,9 @@ public static void handleClusterInstanceCreated(String serviceType, String clust\n             TopologyManager.updateTopology(topology);\n \n             ClusterInstanceCreatedEvent clusterInstanceCreatedEvent =\n-                    new ClusterInstanceCreatedEvent(alias, serviceType, clusterId, instanceId);\n+                    new ClusterInstanceCreatedEvent(alias, serviceType, clusterId,\n+                            instanceId, networkPartitionId);\n+            clusterInstanceCreatedEvent.setPartitionId(partitionId);\n             TopologyEventPublisher.sendClusterInstanceCreatedEvent(clusterInstanceCreatedEvent);\n \n         } finally {\n@@ -864,7 +867,7 @@ public static void handleClusterInActivateEvent(\n     }\n \n \n-    private static void deleteAppResourcesFromMetadataService(ApplicationTerminatedEvent event) {\n+    private static void deleteAppResourcesFromMetadataService(ApplicationInstanceTerminatedEvent event) {\n         try {\n             MetaDataServiceClient metadataClient = new DefaultMetaDataServiceClient();\n             metadataClient.deleteApplicationProperties(event.getAppId());",
                "deletions": 5
            },
            {
                "sha": "eea941cc0341ba04074054000aced84b0d62b352",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/topology/TopologyEventPublisher.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/topology/TopologyEventPublisher.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/topology/TopologyEventPublisher.java",
                "status": "modified",
                "changes": 3,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/topology/TopologyEventPublisher.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -253,8 +253,9 @@ public static void sendClusterInactivateEvent(ClusterInactivateEvent clusterInac\n     public static void sendClusterInstanceCreatedEvent(ClusterInstanceCreatedEvent clusterInstanceCreatedEvent) {\n         if (log.isInfoEnabled()) {\n             log.info(String.format(\"Publishing cluster Instance Created event: [service] %s [cluster] %s \" +\n-                            \"[instance-id] %s\",\n+                            \" in [network partition] %s [instance-id] %s\",\n                     clusterInstanceCreatedEvent.getServiceName(), clusterInstanceCreatedEvent.getClusterId(),\n+                    clusterInstanceCreatedEvent.getNetworkPartitionId(),\n                     clusterInstanceCreatedEvent.getInstanceId()));\n         }\n         publishEvent(clusterInstanceCreatedEvent);",
                "deletions": 1
            },
            {
                "sha": "d0dd73084442a82703acae2e67fdade318c34e04",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/services/CloudControllerService.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/services/CloudControllerService.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/services/CloudControllerService.java",
                "status": "modified",
                "changes": 4,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/services/CloudControllerService.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -228,7 +228,9 @@ public void createApplicationClusters(String appId, ApplicationClusterContext[]\n      * @param instanceId instance id\n      * @throws ClusterInstanceCreationException if an y error occurs in cluster instance creation\n      */\n-    public void createClusterInstance (String serviceType, String clusterId, String alias, String instanceId) throws\n+    public void createClusterInstance (String serviceType, String clusterId, String alias,\n+                                       String instanceId, String partitionId,\n+                                       String networkPartitionId) throws\n             ClusterInstanceCreationException;\n     \n     /**",
                "deletions": 1
            },
            {
                "sha": "f9c55a0d279c22f55a16cc09df1330e355857c07",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/services/impl/CloudControllerServiceImpl.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/services/impl/CloudControllerServiceImpl.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/services/impl/CloudControllerServiceImpl.java",
                "status": "modified",
                "changes": 1655,
                "additions": 882,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/services/impl/CloudControllerServiceImpl.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "deletions": 773
            },
            {
                "sha": "6ed9228227895ff649b7e5c5518002a2b512ea6e",
                "filename": "components/org.apache.stratos.common/pom.xml",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/pom.xml",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/pom.xml",
                "status": "modified",
                "changes": 5,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.common/pom.xml?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -96,6 +96,11 @@\n             <artifactId>commons-lang3</artifactId>\n             <version>3.1</version>\n         </dependency>\n+        <dependency>\n+            <groupId>commons-configuration</groupId>\n+            <artifactId>commons-configuration</artifactId>\n+            <version>1.9</version>\n+        </dependency>\n         <dependency>\n             <groupId>org.wso2.carbon</groupId>\n             <artifactId>org.wso2.carbon.databridge.agent.thrift</artifactId>",
                "deletions": 0
            },
            {
                "sha": "6caa3a1e3eb729da02d1d5d808de10eb9d5e0af8",
                "filename": "components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/clustering/DistributedObjectProvider.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/clustering/DistributedObjectProvider.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/clustering/DistributedObjectProvider.java",
                "status": "modified",
                "changes": 44,
                "additions": 38,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/clustering/DistributedObjectProvider.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -22,20 +22,52 @@\n import java.io.Serializable;\n import java.util.List;\n import java.util.Map;\n+import java.util.concurrent.locks.Lock;\n \n /**\n  * Distributed object provider service interface.\n+ * Caution! When using distributed maps and lists, please note that changes done to an item in a map/list\n+ * after adding them to the map/list will not be replicated in the cluster. If a modification of an item\n+ * needs to be replicated, that item needs to be put() to the map or set() back in the list.\n  */\n public interface DistributedObjectProvider extends Serializable {\n-    Map getMap(String key);\n+    /**\n+     * Returns a distributed map if clustering is enabled, else returns a local hash map.\n+     * @param name\n+     * @return\n+     */\n+    Map getMap(String name);\n \n-    List getList(String name);\n+    /**\n+     * Removes a map from the object provider.\n+     * @param name\n+     */\n+    void removeMap(String name);\n \n-    void putToMap(Map map, Object key, Object value);\n+    /**\n+     * Returns a distributed list if clustering is enabled, else returns a local array list.\n+     * @param name\n+     * @return\n+     */\n+    List getList(String name);\n \n-    void removeFromMap(Map map, Object key);\n+    /**\n+     * Remove a list from the object provider.\n+     * @param name\n+     */\n+    void removeList(String name);\n \n-    void addToList(List list, Object value);\n+    /**\n+     * Acquires a distributed lock if clustering is enabled, else acquires a local reentrant lock and\n+     * returns the lock object.\n+     * @param object\n+     * @return\n+     */\n+    Lock acquireLock(Object object);\n \n-    void removeFromList(List list, Object value);\n+    /**\n+     * Releases a given distributed/local lock.\n+     * @param lock\n+     */\n+    void releaseLock(Lock lock);\n }",
                "deletions": 6
            },
            {
                "sha": "fcd9f70c025b2d0b48577de354e702e789c5a7f3",
                "filename": "components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/clustering/impl/HazelcastDistributedListProvider.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/clustering/impl/HazelcastDistributedListProvider.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/clustering/impl/HazelcastDistributedListProvider.java",
                "status": "added",
                "changes": 269,
                "additions": 269,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/clustering/impl/HazelcastDistributedListProvider.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -0,0 +1,269 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.stratos.common.clustering.impl;\n+\n+import com.hazelcast.core.HazelcastInstance;\n+import com.hazelcast.core.IList;\n+import com.hazelcast.core.ItemEvent;\n+import com.hazelcast.core.ItemListener;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+\n+import java.io.Serializable;\n+import java.util.*;\n+\n+/**\n+ * Hazelcast distributed list provider.\n+ */\n+public class HazelcastDistributedListProvider implements Serializable {\n+    private static final Log log = LogFactory.getLog(HazelcastDistributedListProvider.class);\n+\n+    private HazelcastInstance hazelcastInstance;\n+    private Map<String, DistList> listMap;\n+\n+    public HazelcastDistributedListProvider(HazelcastInstance hazelcastInstance) {\n+        this.hazelcastInstance = hazelcastInstance;\n+    }\n+\n+    public List getList(String name, ListEntryListener listEntryListener) {\n+        List list = listMap.get(name);\n+        if(list == null) {\n+            synchronized (HazelcastDistributedListProvider.class) {\n+                if(list == null) {\n+                    list = new DistList(name, listEntryListener);\n+                }\n+            }\n+        }\n+        return list;\n+    }\n+\n+    public void removeList(String name) {\n+        DistList list = listMap.get(name);\n+        if(list != null) {\n+            IList ilist = (IList) list;\n+            ilist.removeItemListener(list.getListenerId());\n+            listMap.remove(list);\n+            ilist.destroy();\n+        }\n+    }\n+\n+    private class DistList implements List {\n+        private IList list;\n+        private String listenerId;\n+\n+        public DistList(String name, final ListEntryListener listEntryListener) {\n+            this.list = hazelcastInstance.getList(name);\n+            listenerId = list.addItemListener(new ItemListener() {\n+                @Override\n+                public void itemAdded(ItemEvent itemEvent) {\n+                    listEntryListener.itemAdded(itemEvent.getItem());\n+                }\n+\n+                @Override\n+                public void itemRemoved(ItemEvent itemEvent) {\n+                    listEntryListener.itemRemoved(itemEvent.getItem());\n+                }\n+            }, false);\n+        }\n+\n+        @Override\n+        public int size() {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.size();\n+            }\n+            return 0;\n+        }\n+\n+        @Override\n+        public boolean isEmpty() {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.isEmpty();\n+            }\n+            return true;\n+        }\n+\n+        @Override\n+        public boolean contains(Object object) {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.contains(object);\n+            }\n+            return false;\n+        }\n+\n+        @Override\n+        public Iterator iterator() {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.iterator();\n+            }\n+            return null;\n+        }\n+\n+        @Override\n+        public Object[] toArray() {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.toArray();\n+            }\n+            return new Object[0];\n+        }\n+\n+        @Override\n+        public boolean add(Object object) {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.add(object);\n+            }\n+            return false;\n+        }\n+\n+        @Override\n+        public boolean remove(Object object) {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.remove(object);\n+            }\n+            return false;\n+        }\n+\n+        @Override\n+        public boolean addAll(Collection collection) {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.addAll(collection);\n+            }\n+            return false;\n+        }\n+\n+        @Override\n+        public boolean addAll(int i, Collection collection) {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.addAll(i, collection);\n+            }\n+            return false;\n+        }\n+\n+        @Override\n+        public void clear() {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                list.clear();\n+            }\n+        }\n+\n+        @Override\n+        public Object get(int i) {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.get(i);\n+            }\n+            return null;\n+        }\n+\n+        @Override\n+        public Object set(int i, Object o) {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.set(i, o);\n+            }\n+            return null;\n+        }\n+\n+        @Override\n+        public void add(int i, Object o) {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                list.add(i, o);\n+            }\n+        }\n+\n+        @Override\n+        public Object remove(int i) {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.remove(i);\n+            }\n+            return null;\n+        }\n+\n+        @Override\n+        public int indexOf(Object o) {\n+            return list.indexOf(o);\n+        }\n+\n+        @Override\n+        public int lastIndexOf(Object o) {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.lastIndexOf(o);\n+            }\n+            return -1;\n+        }\n+\n+        @Override\n+        public ListIterator listIterator() {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.listIterator();\n+            }\n+            return null;\n+        }\n+\n+        @Override\n+        public ListIterator listIterator(int i) {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.listIterator(i);\n+            }\n+            return null;\n+        }\n+\n+        @Override\n+        public List subList(int i, int i2) {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.subList(i, i2);\n+            }\n+            return null;\n+        }\n+\n+        @Override\n+        public boolean retainAll(Collection collection) {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.retainAll(collection);\n+            }\n+            return false;\n+        }\n+\n+        @Override\n+        public boolean removeAll(Collection collection) {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.removeAll(collection);\n+            }\n+            return false;\n+        }\n+\n+        @Override\n+        public boolean containsAll(Collection collection) {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.containsAll(collection);\n+            }\n+            return false;\n+        }\n+\n+        @Override\n+        public Object[] toArray(Object[] objects) {\n+            if (hazelcastInstance.getLifecycleService().isRunning()) {\n+                return list.toArray(objects);\n+            }\n+            return null;\n+        }\n+\n+        public String getListenerId() {\n+            return listenerId;\n+        }\n+    }\n+}",
                "deletions": 0
            },
            {
                "sha": "f7ff50ea5a3b2d9e081552253870037bd0e161bb",
                "filename": "components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/clustering/impl/HazelcastDistributedObjectProvider.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/clustering/impl/HazelcastDistributedObjectProvider.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/clustering/impl/HazelcastDistributedObjectProvider.java",
                "status": "modified",
                "changes": 276,
                "additions": 168,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/clustering/impl/HazelcastDistributedObjectProvider.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -28,172 +28,232 @@\n import org.apache.commons.logging.LogFactory;\n import org.apache.stratos.common.clustering.DistributedObjectProvider;\n import org.apache.stratos.common.internal.ServiceReferenceHolder;\n+import org.wso2.carbon.caching.impl.MapEntryListener;\n+import org.wso2.carbon.core.clustering.hazelcast.HazelcastDistributedMapProvider;\n \n import java.util.ArrayList;\n+import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n-import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.locks.Lock;\n+import java.util.concurrent.locks.ReentrantLock;\n \n /**\n  * Provides objects to be managed in distributed and non-distributed environments.\n  */\n public class HazelcastDistributedObjectProvider implements DistributedObjectProvider {\n     private static final Log log = LogFactory.getLog(HazelcastDistributedObjectProvider.class);\n \n-    public HazelcastDistributedObjectProvider() {\n-    }\n+    private HazelcastDistributedMapProvider mapProvider;\n+    private HazelcastDistributedListProvider listProvider;\n+    private Map<String, Map> mapsMap;\n+    private Map<String, List> listsMap;\n+    private Map<Object, Lock> locksMap;\n \n-    private boolean isClustered() {\n-        AxisConfiguration axisConfiguration = ServiceReferenceHolder.getInstance().getAxisConfiguration();\n-        return ((axisConfiguration != null) && (axisConfiguration.getClusteringAgent() != null)\n-                && (getHazelcastInstance() != null));\n-    }\n-\n-    private HazelcastInstance getHazelcastInstance() {\n-        return ServiceReferenceHolder.getInstance().getHazelcastInstance();\n+    public HazelcastDistributedObjectProvider() {\n+        HazelcastInstance hazelcastInstance = ServiceReferenceHolder.getInstance().getHazelcastInstance();\n+        mapProvider = new HazelcastDistributedMapProvider(hazelcastInstance);\n+        listProvider = new HazelcastDistributedListProvider(hazelcastInstance);\n+        mapsMap = new HashMap<String, Map>();\n+        listsMap = new HashMap<String, List>();\n+        locksMap = new HashMap<Object, Lock>();\n     }\n \n-    private com.hazelcast.core.ILock acquireDistributedLock(Object object) {\n-        if((!isClustered()) || (object == null)) {\n-            return null;\n+    /**\n+     * Returns a distributed map if clustering is enabled, else returns a local hash map.\n+     * @param name\n+     * @return\n+     */\n+    @Override\n+    public Map getMap(final String name) {\n+        if(mapsMap.containsKey(name)) {\n+            return mapsMap.get(name);\n         }\n \n-        if (log.isDebugEnabled()) {\n-            log.debug(String.format(\"Acquiring distributed lock for %s...\", object.getClass().getSimpleName()));\n-        }\n-        ILock lock = getHazelcastInstance().getLock(object);\n-        if (log.isDebugEnabled()) {\n-            log.debug(String.format(\"Distributed lock acquired for %s\", object.getClass().getSimpleName()));\n-        }\n-        return lock;\n-    }\n+        Map map = null;\n+        if(isClustered()) {\n+            map = mapProvider.getMap(name, new MapEntryListener() {\n+                @Override\n+                public <X> void entryAdded(X key) {\n+                    if(log.isDebugEnabled()) {\n+                        log.debug(String.format(\"Entry added to distributed map: [name] %s [key] %s\",\n+                                name, key));\n+                    }\n+                }\n \n-    private void releaseDistributedLock(ILock lock) {\n-        if(lock == null) {\n-            return;\n-        }\n+                @Override\n+                public <X> void entryRemoved(X key) {\n+                    if(log.isDebugEnabled()) {\n+                        log.debug(String.format(\"Entry removed from distributed map: [name] %s [key] %s\",\n+                                name, key));\n+                    }\n+                }\n \n-        if (log.isDebugEnabled()) {\n-            log.debug(String.format(\"Releasing distributed lock for %s...\", lock.getKey()));\n+                @Override\n+                public <X> void entryUpdated(X key) {\n+                    if(log.isDebugEnabled()) {\n+                        log.debug(String.format(\"Entry updated in distributed map: [name] %s [key] %s\",\n+                                name, key));\n+                    }\n+                }\n+            });\n+        } else {\n+            map = new HashMap<Object, Object>();\n         }\n-        lock.forceUnlock();\n-        if (log.isDebugEnabled()) {\n-            log.debug(String.format(\"Distributed lock released for %s\", lock.getKey()));\n+        if(map != null) {\n+            mapsMap.put(name, map);\n         }\n+        return map;\n     }\n \n     /**\n-     * If clustering is enabled returns a distributed map object, otherwise returns a\n-     * concurrent local map object.\n-     * @param key\n-     * @return\n+     * Remove map from provider\n+     * @param name\n      */\n-    @Override\n-    public Map getMap(String key) {\n-        if(isClustered()) {\n-            return getHazelcastInstance().getMap(key);\n-        } else {\n-            return new ConcurrentHashMap<Object, Object>();\n+    public void removeMap(String name) {\n+        if(mapsMap.containsKey(name)) {\n+            if(isClustered()) {\n+                IMap map = (IMap) mapsMap.get(name);\n+                mapProvider.removeMap(name);\n+                map.destroy();\n+            }\n+            mapsMap.remove(name);\n         }\n     }\n \n     /**\n-     * If clustering is enabled returns a distributed list, otherwise returns\n-     * a local array list.\n+     * Returns a distributed list if clustering is enabled, else returns a local array list.\n      * @param name\n      * @return\n      */\n     @Override\n-    public List getList(String name) {\n+    public List getList(final String name) {\n+        if(listsMap.containsKey(name)) {\n+            return listsMap.get(name);\n+        }\n+\n+        List list = null;\n         if(isClustered()) {\n-            return getHazelcastInstance().getList(name);\n+            list = listProvider.getList(name, new ListEntryListener() {\n+                @Override\n+                public void itemAdded(Object item) {\n+                    if(log.isDebugEnabled()) {\n+                        log.debug(String.format(\"Item added to distributed list: [list] %s [item] %s\", name, item));\n+                    }\n+                }\n+\n+                @Override\n+                public void itemRemoved(Object item) {\n+                    if(log.isDebugEnabled()) {\n+                        log.debug(String.format(\"Item removed from distributed list: [list] %s [item] %s\", name, item));\n+                    }\n+                }\n+            });\n         } else {\n-            return new ArrayList();\n+            list = new ArrayList();\n+        }\n+        if(list != null) {\n+            listsMap.put(name, list);\n         }\n+        return list;\n     }\n \n     /**\n-     * Put a key value pair to a map, if clustered use a distributed lock.\n-     * @param map\n-     * @param key\n-     * @param value\n+     * Remove a list from the object provider.\n+     * @param name\n      */\n     @Override\n-    public void putToMap(Map map, Object key, Object value) {\n-         if(isClustered()) {\n-             ILock lock = null;\n-             try {\n-                 IMap imap = (IMap) map;\n-                 lock = acquireDistributedLock(imap.getName());\n-                 imap.set(key, value);\n-             } finally {\n-                 releaseDistributedLock(lock);\n-             }\n-         } else {\n-            map.put(key, value);\n-         }\n+    public void removeList(String name) {\n+        if(listsMap.containsKey(name)) {\n+            if(isClustered()) {\n+                IList list = (IList)listsMap.get(name);\n+                listProvider.removeList(name);\n+                list.destroy();\n+            }\n+            listsMap.remove(name);\n+        }\n     }\n \n     /**\n-     * Remove an object from a map, if clustered use a distributed lock.\n-     * @param map\n-     * @param key\n+     * Acquires a distributed lock if clustering is enabled, else acquires a local reentrant lock and\n+     * returns the lock object.\n+     * @param object\n+     * @return\n      */\n     @Override\n-    public void removeFromMap(Map map, Object key) {\n+    public Lock acquireLock(Object object) {\n         if(isClustered()) {\n-            ILock lock = null;\n-            try {\n-                IMap imap = (IMap) map;\n-                lock = acquireDistributedLock(imap.getName());\n-                imap.delete(key);\n-            } finally {\n-                releaseDistributedLock(lock);\n-            }\n+            return acquireDistributedLock(object);\n         } else {\n-            map.remove(key);\n+            Lock lock = locksMap.get(object);\n+            if(lock == null) {\n+                synchronized (object) {\n+                    if(lock == null) {\n+                        lock = new ReentrantLock();\n+                        locksMap.put(object, lock);\n+                    }\n+                }\n+            }\n+            lock.lock();\n+            return lock;\n         }\n     }\n \n     /**\n-     * Add an object to a list, if clustered use a distributed lock.\n-     * @param list\n-     * @param value\n+     * Releases a given distributed/local lock.\n+     * @param lock\n      */\n     @Override\n-    public void addToList(List list, Object value) {\n-        if(isClustered()) {\n-            ILock lock = null;\n-            try {\n-                IList ilist = (IList) list;\n-                lock = acquireDistributedLock(ilist.getName());\n-                ilist.add(value);\n-            } finally {\n-                releaseDistributedLock(lock);\n+    public void releaseLock(Lock lock) {\n+         if(isClustered()) {\n+             releaseDistributedLock((ILock)lock);\n+         } else {\n+             lock.unlock();\n+         }\n+    }\n+\n+    private boolean isClustered() {\n+        AxisConfiguration axisConfiguration = ServiceReferenceHolder.getInstance().getAxisConfiguration();\n+        return ((axisConfiguration != null) && (axisConfiguration.getClusteringAgent() != null)\n+                && (getHazelcastInstance() != null));\n+    }\n+\n+    private HazelcastInstance getHazelcastInstance() {\n+        return ServiceReferenceHolder.getInstance().getHazelcastInstance();\n+    }\n+\n+    protected com.hazelcast.core.ILock acquireDistributedLock(Object object) {\n+        if(object == null) {\n+            if(log.isWarnEnabled()) {\n+                log.warn(\"Could not acquire distributed lock, object is null\");\n             }\n-        } else {\n-            list.add(value);\n+            return null;\n         }\n+\n+        if (log.isDebugEnabled()) {\n+            log.debug(String.format(\"Acquiring distributed lock for %s...\", object.getClass().getSimpleName()));\n+        }\n+        ILock lock = getHazelcastInstance().getLock(object);\n+        if (log.isDebugEnabled()) {\n+            log.debug(String.format(\"Distributed lock acquired for %s\", object.getClass().getSimpleName()));\n+        }\n+        return lock;\n     }\n \n-    /**\n-     * Remove an object from a list, if clustered use a distributed lock.\n-     * @param list\n-     * @param value\n-     */\n-    @Override\n-    public void removeFromList(List list, Object value) {\n-        if(isClustered()) {\n-            ILock lock = null;\n-            try {\n-                IList ilist = (IList) list;\n-                lock = acquireDistributedLock(ilist.getName());\n-                ilist.remove(value);\n-            } finally {\n-                releaseDistributedLock(lock);\n+    protected void releaseDistributedLock(ILock lock) {\n+        if(lock == null) {\n+            if(log.isWarnEnabled()) {\n+                log.warn(\"Could not release distributed lock, lock is null\");\n             }\n-        } else {\n-            list.remove(value);\n+            return;\n+        }\n+\n+        if (log.isDebugEnabled()) {\n+            log.debug(String.format(\"Releasing distributed lock for %s...\", lock.getKey()));\n+        }\n+        lock.forceUnlock();\n+        if (log.isDebugEnabled()) {\n+            log.debug(String.format(\"Distributed lock released for %s\", lock.getKey()));\n         }\n     }\n }",
                "deletions": 108
            },
            {
                "sha": "96f72dc30eabea2ac437d02ed74dde645845e6d3",
                "filename": "components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/clustering/impl/ListEntryListener.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/clustering/impl/ListEntryListener.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/clustering/impl/ListEntryListener.java",
                "status": "added",
                "changes": 37,
                "additions": 37,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/clustering/impl/ListEntryListener.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -0,0 +1,37 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.stratos.common.clustering.impl;\n+\n+/**\n+ * List entry listener interface.\n+ */\n+public interface ListEntryListener {\n+    /**\n+     * Invoked when an item is added to the distributed list.\n+     * @param item\n+     */\n+    void itemAdded(Object item);\n+\n+    /**\n+     * Invoked when an item is removed from the distributed list.\n+     * @param item\n+     */\n+    void itemRemoved(Object item);\n+}",
                "deletions": 0
            },
            {
                "sha": "fd44b9f5232188ca6b48bb52f97bf18dadbd4ad9",
                "filename": "components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/constants/StratosConstants.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/constants/StratosConstants.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/constants/StratosConstants.java",
                "status": "modified",
                "changes": 3,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/constants/StratosConstants.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -158,6 +158,7 @@\n     public static final String DROOLS_DIR_NAME = \"drools\";\n     public static final String CONTAINER_SCALE_CHECK_DROOL_FILE = \"container-scaling.drl\";\n     public static final String VM_SCALE_CHECK_DROOL_FILE = \"scaling.drl\";\n+    public static final String DEPENDENT_SCALE_CHECK_DROOL_FILE = \"dependent-scaling.drl\";\n     public static final String CONTAINER_MIN_CHECK_DROOL_FILE = \"container-mincheck.drl\";\n     public static final String VM_MIN_CHECK_DROOL_FILE = \"mincheck.drl\";\n     public static final String CONTAINER_OBSOLETE_CHECK_DROOL_FILE = \"container-obsoletecheck.drl\";\n@@ -184,5 +185,7 @@\n \tpublic static final String NO_LOAD_BALANCER = \"no.load.balancer\";\n \tpublic static final String EXISTING_LOAD_BALANCERS = \"existing.load.balancers\";\n \tpublic static final String LOAD_BALANCED_SERVICE_TYPE = \"load.balanced.service.type\";\n+\n+    public static final long HAZELCAST_INSTANCE_INIT_TIMEOUT = 300000; // 5 min\n }\n ",
                "deletions": 0
            },
            {
                "sha": "e4f0514edf89300499ee7a44fb5a13c9880506bd",
                "filename": "components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/internal/StratosCommonServiceComponent.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/internal/StratosCommonServiceComponent.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/internal/StratosCommonServiceComponent.java",
                "status": "modified",
                "changes": 42,
                "additions": 37,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/internal/StratosCommonServiceComponent.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -19,10 +19,12 @@\n package org.apache.stratos.common.internal;\n \n import com.hazelcast.core.HazelcastInstance;\n+import org.apache.axis2.engine.AxisConfiguration;\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.stratos.common.clustering.DistributedObjectProvider;\n import org.apache.stratos.common.clustering.impl.HazelcastDistributedObjectProvider;\n+import org.apache.stratos.common.constants.StratosConstants;\n import org.apache.stratos.common.util.CommonUtil;\n import org.apache.stratos.common.util.StratosConfiguration;\n import org.osgi.framework.BundleContext;\n@@ -56,7 +58,7 @@\n \n     protected void activate(ComponentContext context) {\n         try {\n-            BundleContext bundleContext = context.getBundleContext();\n+            final BundleContext bundleContext = context.getBundleContext();\n             if (CommonUtil.getStratosConfig() == null) {\n                 StratosConfiguration stratosConfig = CommonUtil.loadStratosConfiguration();\n                 CommonUtil.setStratosConfig(stratosConfig);\n@@ -68,9 +70,34 @@ protected void activate(ComponentContext context) {\n                 CommonUtil.setEula(eula);\n             }\n \n-            // Register distributed object provider service\n-            DistributedObjectProvider distributedObjectProvider = new HazelcastDistributedObjectProvider();\n-            bundleContext.registerService(DistributedObjectProvider.class, distributedObjectProvider, null);\n+            AxisConfiguration axisConfig = ServiceReferenceHolder.getInstance().getAxisConfiguration();\n+            if((axisConfig != null) && (axisConfig.getClusteringAgent() != null)) {\n+                Thread thread = new Thread() {\n+                    @Override\n+                    public void run() {\n+                        try {\n+                            // Wait for the hazelcast instance to be available\n+                            long startTime = System.currentTimeMillis();\n+                            log.info(\"Waiting for the hazelcast instance to be initialized...\");\n+                            while (ServiceReferenceHolder.getInstance().getHazelcastInstance() == null) {\n+                                Thread.sleep(1000);\n+                                if ((System.currentTimeMillis() - startTime) >= StratosConstants.HAZELCAST_INSTANCE_INIT_TIMEOUT) {\n+                                    throw new RuntimeException(\"Hazelcast instance was not initialized within \"\n+                                            + StratosConstants.HAZELCAST_INSTANCE_INIT_TIMEOUT / 1000 + \" seconds\");\n+                                }\n+                            }\n+                            registerDistributedObjectProviderService(bundleContext);\n+                        } catch (Exception e) {\n+                            log.error(e);\n+                        }\n+                    }\n+                };\n+                thread.setName(\"Distributed object provider registration thread\");\n+                thread.start();\n+            } else {\n+                // Register distributed object provider service\n+                registerDistributedObjectProviderService(bundleContext);\n+            }\n \n             // Register manager configuration OSGI service\n             try {\n@@ -85,10 +112,15 @@ protected void activate(ComponentContext context) {\n                 log.info(\"Stratos common service bundle is activated\");\n             }\n         } catch (Throwable e) {\n-            log.error(\"Error in activating stratos common service component\" + e.toString());\n+            log.error(\"Error in activating stratos common service component\", e);\n         }\n     }\n \n+    private void registerDistributedObjectProviderService(BundleContext bundleContext) {\n+        DistributedObjectProvider distributedObjectProvider = new HazelcastDistributedObjectProvider();\n+        bundleContext.registerService(DistributedObjectProvider.class, distributedObjectProvider, null);\n+    }\n+\n     protected void deactivate(ComponentContext context) {\n         log.debug(\"Stratos common service is deactivated\");\n     }",
                "deletions": 5
            },
            {
                "sha": "3e1ebbe37663765467c314c9c03bb8c33e9bbcd7",
                "filename": "components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/threading/StratosThreadPool.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/threading/StratosThreadPool.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/threading/StratosThreadPool.java",
                "status": "added",
                "changes": 57,
                "additions": 57,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/threading/StratosThreadPool.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -0,0 +1,57 @@\n+/*\n+ *\n+ *  * Licensed to the Apache Software Foundation (ASF) under one\n+ *  * or more contributor license agreements. See the NOTICE file\n+ *  * distributed with this work for additional information\n+ *  * regarding copyright ownership. The ASF licenses this file\n+ *  * to you under the Apache License, Version 2.0 (the\n+ *  * \"License\"); you may not use this file except in compliance\n+ *  * with the License. You may obtain a copy of the License at\n+ *  *\n+ *  * http://www.apache.org/licenses/LICENSE-2.0\n+ *  *\n+ *  * Unless required by applicable law or agreed to in writing,\n+ *  * software distributed under the License is distributed on an\n+ *  * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  * KIND, either express or implied. See the License for the\n+ *  * specific language governing permissions and limitations\n+ *  * under the License.\n+ *\n+ */\n+package org.apache.stratos.common.threading;\n+\n+import java.util.HashMap;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+\n+/**\n+ * Utility class for Stratos thread pool\n+ */\n+public class StratosThreadPool {\n+\n+\tprivate static HashMap<String, ExecutorService> mapExecutorService = new HashMap<String, ExecutorService>();\n+\tprivate static Object mutex = new Object();\n+\n+\t/**\n+\t * Return the executor service based on the identifier and thread pool size\n+\t *\n+\t * @param identifier     Component identifier name\n+\t * @param threadPoolSize Thread pool size\n+\t * @return ExecutorService\n+\t */\n+\tpublic static ExecutorService getExecutorService(String identifier, int threadPoolSize) {\n+\t\tExecutorService executorService = mapExecutorService.get(identifier);\n+\t\tif (executorService == null) {\n+\t\t\tsynchronized (mutex) {\n+\t\t\t\tif (executorService == null) {\n+\t\t\t\t\texecutorService = Executors.newFixedThreadPool(threadPoolSize);\n+\t\t\t\t\tmapExecutorService.put(identifier, executorService);\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t}\n+\t\treturn executorService;\n+\n+\t}\n+\n+}",
                "deletions": 0
            },
            {
                "sha": "7f9d665dcc068ed63392c136f0db6a811ef72e7a",
                "filename": "components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/util/ConfUtil.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/util/ConfUtil.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/util/ConfUtil.java",
                "status": "added",
                "changes": 73,
                "additions": 73,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/util/ConfUtil.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -0,0 +1,73 @@\n+/*\n+ *\n+ *  * Licensed to the Apache Software Foundation (ASF) under one\n+ *  * or more contributor license agreements. See the NOTICE file\n+ *  * distributed with this work for additional information\n+ *  * regarding copyright ownership. The ASF licenses this file\n+ *  * to you under the Apache License, Version 2.0 (the\n+ *  * \"License\"); you may not use this file except in compliance\n+ *  * with the License. You may obtain a copy of the License at\n+ *  *\n+ *  * http://www.apache.org/licenses/LICENSE-2.0\n+ *  *\n+ *  * Unless required by applicable law or agreed to in writing,\n+ *  * software distributed under the License is distributed on an\n+ *  * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  * KIND, either express or implied. See the License for the\n+ *  * specific language governing permissions and limitations\n+ *  * under the License.\n+ *\n+ */\n+package org.apache.stratos.common.util;\n+\n+import org.apache.commons.configuration.ConfigurationException;\n+import org.apache.commons.configuration.XMLConfiguration;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.utils.CarbonUtils;\n+\n+import java.io.File;\n+\n+/**\n+ * This class contains utility methods for read Autoscaler configuration file.\n+ */\n+public class ConfUtil {\n+\n+\tprivate static final String CONFIG_FILE_NAME =\"stratos-config\" ;\n+\tprivate static Log log = LogFactory.getLog(ConfUtil.class);\n+\n+    private XMLConfiguration config;\n+\n+    private static ConfUtil instance = null;\n+\n+    private ConfUtil(String configFilePath) {\n+        log.info(\"Loading configuration.....\");\n+        try {\n+\n+            File confFile;\n+            if (configFilePath != null && !configFilePath.isEmpty()) {\n+                confFile = new File(configFilePath);\n+\n+            } else {\n+                confFile = new File(CarbonUtils.getCarbonConfigDirPath(),CONFIG_FILE_NAME);\n+            }\n+\n+            config = new XMLConfiguration(confFile);\n+        } catch (ConfigurationException e) {\n+            log.error(\"Unable to load autoscaler configuration file\",e);\n+            config = new XMLConfiguration();  // continue with default values\n+        }\n+    }\n+\n+    public static ConfUtil getInstance(String configFilePath) {\n+        if (instance == null) {\n+            instance = new ConfUtil (configFilePath);\n+        }\n+        return instance;\n+    }\n+\n+    public XMLConfiguration getConfiguration(){\n+        return config;\n+    }\n+    \n+}",
                "deletions": 0
            },
            {
                "sha": "eaaab7c1bd31985cc22883a0e6ae713dd3335a27",
                "filename": "components/org.apache.stratos.common/src/test/java/org/apache/stratos/common/test/CommonTest.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/test/java/org/apache/stratos/common/test/CommonTest.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/test/java/org/apache/stratos/common/test/CommonTest.java",
                "status": "modified",
                "changes": 1,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.common/src/test/java/org/apache/stratos/common/test/CommonTest.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -46,4 +46,5 @@ public void testEmailValidation() throws Exception {\n             assertEquals(\"Invalid email address is provided.\", e.getMessage());\n         }\n     }\n+\n }",
                "deletions": 0
            },
            {
                "sha": "846d493bbab065198a1feb093c8d06aaf2d7b6d4",
                "filename": "components/org.apache.stratos.common/src/test/java/org/apache/stratos/common/test/DistributedObjectProviderTest.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/test/java/org/apache/stratos/common/test/DistributedObjectProviderTest.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.common/src/test/java/org/apache/stratos/common/test/DistributedObjectProviderTest.java",
                "status": "modified",
                "changes": 88,
                "additions": 32,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.common/src/test/java/org/apache/stratos/common/test/DistributedObjectProviderTest.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -28,17 +28,20 @@\n \n import java.util.List;\n import java.util.Map;\n+import java.util.concurrent.locks.Lock;\n \n-import static junit.framework.TestCase.assertFalse;\n import static org.junit.Assert.assertEquals;\n-import static org.junit.Assert.assertNull;\n import static org.junit.Assert.assertTrue;\n \n /**\n  * Distributed object provider unit tests.\n  */\n public class DistributedObjectProviderTest {\n \n+    public static final String MAP_1 = \"MAP1\";\n+    public static final String MAP_1_WRITE_LOCK = \"MAP1_WRITE_LOCK\";\n+    public static final String LIST_1 = \"LIST1\";\n+    public static final String LIST_1_WRITE_LOCK = \"LIST1_WRITE_LOCK\";\n     private static HazelcastInstance hazelcastInstance;\n \n     @BeforeClass\n@@ -51,84 +54,57 @@ public void testPutToMapLocal() {\n         ServiceReferenceHolder.getInstance().setHazelcastInstance(null);\n         HazelcastDistributedObjectProvider provider = new HazelcastDistributedObjectProvider();\n         testPutToMap(provider);\n+        testPutToMap(provider);\n     }\n \n     @Test\n     public void testPutToMapDistributed() {\n         ServiceReferenceHolder.getInstance().setHazelcastInstance(hazelcastInstance);\n         HazelcastDistributedObjectProvider provider = new HazelcastDistributedObjectProvider();\n         testPutToMap(provider);\n+        testPutToMap(provider);\n     }\n \n     private void testPutToMap(HazelcastDistributedObjectProvider provider) {\n-        Map<String, String> map = provider.getMap(\"MAP1\");\n-        provider.putToMap(map, \"key1\", \"value1\");\n-        assertEquals(map.get(\"key1\"), \"value1\");\n-    }\n-\n-    @Test\n-    public void testRemoveFromMapLocal() {\n-        ServiceReferenceHolder.getInstance().setHazelcastInstance(null);\n-        HazelcastDistributedObjectProvider provider = new HazelcastDistributedObjectProvider();\n-        testRemoveFromMap(provider);\n-    }\n-\n-    @Test\n-    public void testRemoveFromMapDistributed() {\n-        ServiceReferenceHolder.getInstance().setHazelcastInstance(hazelcastInstance);\n-        HazelcastDistributedObjectProvider provider = new HazelcastDistributedObjectProvider();\n-        testRemoveFromMap(provider);\n-    }\n-\n-    private void testRemoveFromMap(HazelcastDistributedObjectProvider provider) {\n-        Map<String, String> map = provider.getMap(\"MAP1\");\n-        provider.putToMap(map, \"key1\", \"value1\");\n-        assertEquals(map.get(\"key1\"), \"value1\");\n-        provider.removeFromMap(map, \"key1\");\n-        assertNull(map.get(\"key1\"));\n+        Map<String, String> map = provider.getMap(MAP_1);\n+        Lock lock = null;\n+        try {\n+            lock = provider.acquireLock(MAP_1_WRITE_LOCK);\n+            map.put(\"key1\", \"value1\");\n+            assertEquals(map.get(\"key1\"), \"value1\");\n+        } finally {\n+            provider.releaseLock(lock);\n+            provider.removeMap(MAP_1);\n+        }\n     }\n \n     @Test\n-    public void testAddToListLocal() {\n+    public void testGetListLocal() {\n         ServiceReferenceHolder.getInstance().setHazelcastInstance(null);\n         HazelcastDistributedObjectProvider provider = new HazelcastDistributedObjectProvider();\n         testAddToList(provider);\n+        testAddToList(provider);\n     }\n \n     @Test\n-    public void testAddToListDistributed() {\n+    public void testGetListDistributed() {\n         ServiceReferenceHolder.getInstance().setHazelcastInstance(hazelcastInstance);\n         HazelcastDistributedObjectProvider provider = new HazelcastDistributedObjectProvider();\n         testAddToList(provider);\n+        testAddToList(provider);\n     }\n \n     private void testAddToList(HazelcastDistributedObjectProvider provider) {\n-        List list = provider.getList(\"LIST1\");\n-        String value1 = \"value1\";\n-        provider.addToList(list, value1);\n-        assertTrue(list.contains(value1));\n-    }\n-\n-    @Test\n-    public void testRemoveFromListLocal() {\n-        ServiceReferenceHolder.getInstance().setHazelcastInstance(null);\n-        HazelcastDistributedObjectProvider provider = new HazelcastDistributedObjectProvider();\n-        testRemovalFromList(provider);\n-    }\n-\n-    @Test\n-    public void testRemoveFromListDistributed() {\n-        ServiceReferenceHolder.getInstance().setHazelcastInstance(hazelcastInstance);\n-        HazelcastDistributedObjectProvider provider = new HazelcastDistributedObjectProvider();\n-        testRemovalFromList(provider);\n-    }\n-\n-    private void testRemovalFromList(HazelcastDistributedObjectProvider provider) {\n-        List list = provider.getList(\"LIST1\");\n-        String value1 = \"value1\";\n-        provider.addToList(list, value1);\n-        assertTrue(list.contains(value1));\n-        provider.removeFromList(list, value1);\n-        assertFalse(list.contains(value1));\n+        List list = provider.getList(LIST_1);\n+        Lock lock = null;\n+        try {\n+            lock = provider.acquireLock(LIST_1_WRITE_LOCK);\n+            String value1 = \"value1\";\n+            list.add(value1);\n+            assertTrue(list.contains(value1));\n+        } finally {\n+            provider.releaseLock(lock);\n+            provider.removeList(LIST_1);\n+        }\n     }\n }",
                "deletions": 56
            },
            {
                "sha": "188b2ac14b54bd566620a064b23f73b8bc7a3bc8",
                "filename": "components/org.apache.stratos.load.balancer.extension.api/src/main/java/org/apache/stratos/load/balancer/extension/api/LoadBalancerExtension.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.load.balancer.extension.api/src/main/java/org/apache/stratos/load/balancer/extension/api/LoadBalancerExtension.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.load.balancer.extension.api/src/main/java/org/apache/stratos/load/balancer/extension/api/LoadBalancerExtension.java",
                "status": "modified",
                "changes": 267,
                "additions": 138,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.load.balancer.extension.api/src/main/java/org/apache/stratos/load/balancer/extension/api/LoadBalancerExtension.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -28,138 +28,147 @@\n import org.apache.stratos.messaging.message.receiver.topology.TopologyEventReceiver;\n import org.apache.stratos.messaging.message.receiver.topology.TopologyManager;\n \n+import java.util.concurrent.ExecutorService;\n+\n /**\n  * Load balancer extension thread for executing load balancer life-cycle according to the topology updates\n  * received from the message broker.\n  */\n public class LoadBalancerExtension implements Runnable {\n-    private static final Log log = LogFactory.getLog(LoadBalancerExtension.class);\n-\n-    private LoadBalancer loadBalancer;\n-    private LoadBalancerStatisticsReader statsReader;\n-    private boolean loadBalancerStarted;\n-    private TopologyEventReceiver topologyEventReceiver;\n-    private LoadBalancerStatisticsNotifier statisticsNotifier;\n-    private boolean terminated;\n-\n-    /**\n-     * Load balancer extension constructor.\n-     * @param loadBalancer Load balancer instance: Mandatory.\n-     * @param statsReader Statistics reader: If null statistics notifier thread will not be started.\n-     */\n-    public LoadBalancerExtension(LoadBalancer loadBalancer, LoadBalancerStatisticsReader statsReader) {\n-        this.loadBalancer = loadBalancer;\n-        this.statsReader = statsReader;\n-    }\n-\n-    @Override\n-    public void run() {\n-        try {\n-            if(log.isInfoEnabled()) {\n-                log.info(\"Load balancer extension started\");\n-            }\n-\n-            // Start topology receiver thread\n-            topologyEventReceiver = new TopologyEventReceiver();\n-            addEventListeners();\n-            Thread topologyReceiverThread = new Thread(topologyEventReceiver);\n-            topologyReceiverThread.start();\n-\n-            if(statsReader != null) {\n-                // Start stats notifier thread\n-                statisticsNotifier = new LoadBalancerStatisticsNotifier(statsReader);\n-                Thread statsNotifierThread = new Thread(statisticsNotifier);\n-                statsNotifierThread.start();\n-            }\n-            else {\n-                if(log.isWarnEnabled()) {\n-                    log.warn(\"Load balancer statistics reader not found\");\n-                }\n-            }\n-\n-            // Keep the thread live until terminated\n-            while (!terminated);\n-        } catch (Exception e) {\n-            if (log.isErrorEnabled()) {\n-                log.error(\"Could not start load balancer extension\", e);\n-            }\n-        }\n-    }\n-\n-    private void addEventListeners() {\n-        topologyEventReceiver.addEventListener(new CompleteTopologyEventListener() {\n-\n-            @Override\n-            protected void onEvent(Event event) {\n-                try {\n-\n-                    if (!loadBalancerStarted) {\n-                        // Configure load balancer\n-                        loadBalancer.configure(TopologyManager.getTopology());\n-\n-                        // Start load balancer\n-                        loadBalancer.start();\n-                        loadBalancerStarted = true;\n-                    }\n-                } catch (Exception e) {\n-                    if (log.isErrorEnabled()) {\n-                        log.error(\"Could not start load balancer\", e);\n-                    }\n-                    terminate();\n-                }\n-            }\n-        });\n-        topologyEventReceiver.addEventListener(new MemberActivatedEventListener() {\n-            @Override\n-            protected void onEvent(Event event) {\n-                reloadConfiguration();\n-            }\n-        });\n-        topologyEventReceiver.addEventListener(new MemberSuspendedEventListener() {\n-            @Override\n-            protected void onEvent(Event event) {\n-                reloadConfiguration();\n-            }\n-        });\n-        topologyEventReceiver.addEventListener(new MemberTerminatedEventListener() {\n-            @Override\n-            protected void onEvent(Event event) {\n-                reloadConfiguration();\n-            }\n-        });\n-        topologyEventReceiver.addEventListener(new ClusterRemovedEventListener() {\n-            @Override\n-            protected void onEvent(Event event) {\n-                reloadConfiguration();\n-            }\n-        });\n-        topologyEventReceiver.addEventListener(new ServiceRemovedEventListener() {\n-            @Override\n-            protected void onEvent(Event event) {\n-                reloadConfiguration();\n-            }\n-        });\n-    }\n-\n-    private void reloadConfiguration() {\n-        try {\n-            if (loadBalancerStarted) {\n-                loadBalancer.reload(TopologyManager.getTopology());\n-            }\n-        } catch (Exception e) {\n-            if (log.isErrorEnabled()) {\n-                log.error(\"Could not reload load balancer configuration\", e);\n-            }\n-        }\n-    }\n-\n-    public void terminate() {\n-        if(topologyEventReceiver != null) {\n-            topologyEventReceiver.terminate();\n-        }\n-        if(statisticsNotifier != null) {\n-            statisticsNotifier.terminate();\n-        }\n-        terminated = true;\n-    }\n+\tprivate static final Log log = LogFactory.getLog(LoadBalancerExtension.class);\n+\n+\tprivate LoadBalancer loadBalancer;\n+\tprivate LoadBalancerStatisticsReader statsReader;\n+\tprivate boolean loadBalancerStarted;\n+\tprivate TopologyEventReceiver topologyEventReceiver;\n+\tprivate LoadBalancerStatisticsNotifier statisticsNotifier;\n+\tprivate boolean terminated;\n+\tprivate ExecutorService executorService;\n+\n+\t/**\n+\t * Load balancer extension constructor.\n+\t *\n+\t * @param loadBalancer Load balancer instance: Mandatory.\n+\t * @param statsReader  Statistics reader: If null statistics notifier thread will not be started.\n+\t */\n+\tpublic LoadBalancerExtension(LoadBalancer loadBalancer, LoadBalancerStatisticsReader statsReader) {\n+\t\tthis.loadBalancer = loadBalancer;\n+\t\tthis.statsReader = statsReader;\n+\t}\n+\n+\t@Override\n+\tpublic void run() {\n+\t\ttry {\n+\t\t\tif (log.isInfoEnabled()) {\n+\t\t\t\tlog.info(\"Load balancer extension started\");\n+\t\t\t}\n+\n+\t\t\t// Start topology receiver thread\n+\t\t\ttopologyEventReceiver = new TopologyEventReceiver();\n+\t\t\taddEventListeners();\n+\t\t\ttopologyEventReceiver.setExecutorService(executorService);\n+\t\t\ttopologyEventReceiver.execute();\n+\n+\t\t\tif (statsReader != null) {\n+\t\t\t\t// Start stats notifier thread\n+\t\t\t\tstatisticsNotifier = new LoadBalancerStatisticsNotifier(statsReader);\n+\t\t\t\tThread statsNotifierThread = new Thread(statisticsNotifier);\n+\t\t\t\tstatsNotifierThread.start();\n+\t\t\t} else {\n+\t\t\t\tif (log.isWarnEnabled()) {\n+\t\t\t\t\tlog.warn(\"Load balancer statistics reader not found\");\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t} catch (Exception e) {\n+\t\t\tif (log.isErrorEnabled()) {\n+\t\t\t\tlog.error(\"Could not start load balancer extension\", e);\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tprivate void addEventListeners() {\n+\t\ttopologyEventReceiver.addEventListener(new CompleteTopologyEventListener() {\n+\n+\t\t\t@Override\n+\t\t\tprotected void onEvent(Event event) {\n+\t\t\t\ttry {\n+\n+\t\t\t\t\tif (!loadBalancerStarted) {\n+\t\t\t\t\t\t// Configure load balancer\n+\t\t\t\t\t\tloadBalancer.configure(TopologyManager.getTopology());\n+\n+\t\t\t\t\t\t// Start load balancer\n+\t\t\t\t\t\tloadBalancer.start();\n+\t\t\t\t\t\tloadBalancerStarted = true;\n+\t\t\t\t\t}\n+\t\t\t\t} catch (Exception e) {\n+\t\t\t\t\tif (log.isErrorEnabled()) {\n+\t\t\t\t\t\tlog.error(\"Could not start load balancer\", e);\n+\t\t\t\t\t}\n+\t\t\t\t\tterminate();\n+\t\t\t\t}\n+\t\t\t}\n+\t\t});\n+\t\ttopologyEventReceiver.addEventListener(new MemberActivatedEventListener() {\n+\t\t\t@Override\n+\t\t\tprotected void onEvent(Event event) {\n+\t\t\t\treloadConfiguration();\n+\t\t\t}\n+\t\t});\n+\t\ttopologyEventReceiver.addEventListener(new MemberSuspendedEventListener() {\n+\t\t\t@Override\n+\t\t\tprotected void onEvent(Event event) {\n+\t\t\t\treloadConfiguration();\n+\t\t\t}\n+\t\t});\n+\t\ttopologyEventReceiver.addEventListener(new MemberTerminatedEventListener() {\n+\t\t\t@Override\n+\t\t\tprotected void onEvent(Event event) {\n+\t\t\t\treloadConfiguration();\n+\t\t\t}\n+\t\t});\n+\t\ttopologyEventReceiver.addEventListener(new ClusterRemovedEventListener() {\n+\t\t\t@Override\n+\t\t\tprotected void onEvent(Event event) {\n+\t\t\t\treloadConfiguration();\n+\t\t\t}\n+\t\t});\n+\t\ttopologyEventReceiver.addEventListener(new ServiceRemovedEventListener() {\n+\t\t\t@Override\n+\t\t\tprotected void onEvent(Event event) {\n+\t\t\t\treloadConfiguration();\n+\t\t\t}\n+\t\t});\n+\t}\n+\n+\tprivate void reloadConfiguration() {\n+\t\ttry {\n+\t\t\tif (loadBalancerStarted) {\n+\t\t\t\tloadBalancer.reload(TopologyManager.getTopology());\n+\t\t\t}\n+\t\t} catch (Exception e) {\n+\t\t\tif (log.isErrorEnabled()) {\n+\t\t\t\tlog.error(\"Could not reload load balancer configuration\", e);\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tpublic void terminate() {\n+\t\tif (topologyEventReceiver != null) {\n+\t\t\ttopologyEventReceiver.terminate();\n+\t\t}\n+\t\tif (statisticsNotifier != null) {\n+\t\t\tstatisticsNotifier.terminate();\n+\t\t}\n+\t\tterminated = true;\n+\t}\n+\n+\tpublic ExecutorService getExecutorService() {\n+\t\treturn executorService;\n+\t}\n+\n+\tpublic void setExecutorService(ExecutorService executorService) {\n+\t\tthis.executorService = executorService;\n+\t}\n }",
                "deletions": 129
            },
            {
                "sha": "240ebbaa6878de43529c348cd4b078d24332407a",
                "filename": "components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/context/AlgorithmContext.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/context/AlgorithmContext.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/context/AlgorithmContext.java",
                "status": "modified",
                "changes": 22,
                "additions": 20,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/context/AlgorithmContext.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -21,6 +21,8 @@\n \n import org.apache.stratos.load.balancer.context.map.AlgorithmContextMap;\n \n+import java.util.concurrent.locks.Lock;\n+\n /**\n  * Algorithm context is used for identifying the cluster and its current member for executing load balancing algorithms.\n  * Key: service name, cluster id\n@@ -32,7 +34,15 @@\n     public AlgorithmContext(String serviceName, String clusterId) {\n         this.serviceName = serviceName;\n         this.clusterId = clusterId;\n-        AlgorithmContextMap.getInstance().putCurrentMemberIndex(serviceName, clusterId, 0);\n+        Lock lock = null;\n+        try {\n+            lock = AlgorithmContextMap.getInstance().acquireCurrentMemberIndexLock();\n+            AlgorithmContextMap.getInstance().putCurrentMemberIndex(serviceName, clusterId, 0);\n+        } finally {\n+            if(lock != null) {\n+                AlgorithmContextMap.getInstance().releaseCurrentMemberIndexLock(lock);\n+            }\n+        }\n     }\n \n     public String getServiceName() {\n@@ -48,6 +58,14 @@ public int getCurrentMemberIndex() {\n     }\n \n     public void setCurrentMemberIndex(int currentMemberIndex) {\n-        AlgorithmContextMap.getInstance().putCurrentMemberIndex(getServiceName(), getClusterId(), currentMemberIndex);\n+        Lock lock = null;\n+        try {\n+            lock = AlgorithmContextMap.getInstance().acquireCurrentMemberIndexLock();\n+            AlgorithmContextMap.getInstance().putCurrentMemberIndex(getServiceName(), getClusterId(), currentMemberIndex);\n+        } finally {\n+            if(lock != null) {\n+                AlgorithmContextMap.getInstance().releaseCurrentMemberIndexLock(lock);\n+            }\n+        }\n     }\n }",
                "deletions": 2
            },
            {
                "sha": "35acdb0a2511f9f26e4f3cb8e8cb2bc3f3740913",
                "filename": "components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/context/map/AlgorithmContextMap.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/context/map/AlgorithmContextMap.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/context/map/AlgorithmContextMap.java",
                "status": "modified",
                "changes": 16,
                "additions": 14,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/context/map/AlgorithmContextMap.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -25,6 +25,7 @@\n import org.apache.stratos.load.balancer.internal.ServiceReferenceHolder;\n \n import java.util.Map;\n+import java.util.concurrent.locks.Lock;\n \n /**\n  * Algorithm context map is a singleton class for managing load balancing algorithm context\n@@ -34,6 +35,7 @@\n     @SuppressWarnings(\"unused\")\n     private static final Log log = LogFactory.getLog(AlgorithmContextMap.class);\n     private static final String LOAD_BALANCER_ALGORITHM_CONTEXT_MAP = \"LOAD_BALANCER_ALGORITHM_CONTEXT_MAP\";\n+    private static final String CURRENT_MEMBER_INDEX_MAP_LOCK = \"CURRENT_MEMBER_INDEX_MAP_LOCK\";\n     private static AlgorithmContextMap instance;\n \n     private final Map<String, Integer> clusterMemberIndexMap;\n@@ -61,14 +63,24 @@ private String constructKey(String serviceName, String clusterId) {\n         return String.format(\"%s-%s\", serviceName, clusterId);\n     }\n \n+    public Lock acquireCurrentMemberIndexLock() {\n+        return distributedObjectProvider.acquireLock(CURRENT_MEMBER_INDEX_MAP_LOCK);\n+    }\n+\n+    public void releaseCurrentMemberIndexLock(Lock lock) {\n+        if(lock != null) {\n+            distributedObjectProvider.releaseLock(lock);\n+        }\n+    }\n+\n     public void putCurrentMemberIndex(String serviceName, String clusterId, int currentMemberIndex) {\n         String key = constructKey(serviceName, clusterId);\n-        distributedObjectProvider.putToMap(clusterMemberIndexMap, key, currentMemberIndex);\n+        clusterMemberIndexMap.put(key, currentMemberIndex);\n     }\n \n     public void removeCluster(String serviceName, String clusterId) {\n         String key = constructKey(serviceName, clusterId);\n-        distributedObjectProvider.removeFromMap(clusterMemberIndexMap, key);\n+        clusterMemberIndexMap.remove(key);\n     }\n \n     public int getCurrentMemberIndex(String serviceName, String clusterId) {",
                "deletions": 2
            },
            {
                "sha": "509bc74344c18b31f1d8b65a5dcfd5435ad37f03",
                "filename": "components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/internal/LoadBalancerServiceComponent.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/internal/LoadBalancerServiceComponent.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/internal/LoadBalancerServiceComponent.java",
                "status": "modified",
                "changes": 50,
                "additions": 44,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/internal/LoadBalancerServiceComponent.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -60,6 +60,7 @@\n import java.io.File;\n import java.util.Map;\n import java.util.Set;\n+import java.util.concurrent.ExecutorService;\n \n /**\n  * @scr.component name=\"org.apache.stratos.load.balancer.internal.LoadBalancerServiceComponent\" immediate=\"true\"\n@@ -88,6 +89,9 @@\n     private LoadBalancerTopologyEventReceiver topologyReceiver;\n     private LoadBalancerTenantEventReceiver tenantReceiver;\n     private LoadBalancerStatisticsNotifier statisticsNotifier;\n+\tprivate static final String STRATOS_MANAGER = \"Stratos_manager\";\n+\tprivate static final int THREAD_POOL_SIZE = 20;\n+\tprivate ExecutorService executorService;\n \n     protected void activate(ComponentContext ctxt) {\n         try {\n@@ -123,6 +127,40 @@ protected void activate(ComponentContext ctxt) {\n             if (configuration.isTopologyEventListenerEnabled()) {\n                 // Start topology receiver\n                 startTopologyEventReceiver();\n+\n+                if (log.isInfoEnabled()) {\n+                    if (TopologyServiceFilter.getInstance().isActive()) {\n+                        StringBuilder sb = new StringBuilder();\n+                        for (String serviceName : TopologyServiceFilter.getInstance().getIncludedServiceNames()) {\n+                            if (sb.length() > 0) {\n+                                sb.append(\", \");\n+                            }\n+                            sb.append(serviceName);\n+                        }\n+                        log.info(String.format(\"Service filter activated: [services] %s\", sb.toString()));\n+                    }\n+                    if (TopologyClusterFilter.getInstance().isActive()) {\n+                        StringBuilder sb = new StringBuilder();\n+                        for (String clusterId : TopologyClusterFilter.getInstance().getIncludedClusterIds()) {\n+                            if (sb.length() > 0) {\n+                                sb.append(\", \");\n+                            }\n+                            sb.append(clusterId);\n+                        }\n+                        log.info(String.format(\"Cluster filter activated: [clusters] %s\", sb.toString()));\n+                    }\n+                    if (TopologyMemberFilter.getInstance().isActive()) {\n+                        StringBuilder sb = new StringBuilder();\n+                        for (String clusterId : TopologyMemberFilter.getInstance().getIncludedLbClusterIds()) {\n+                            if (sb.length() > 0) {\n+                                sb.append(\", \");\n+                            }\n+                            sb.append(clusterId);\n+                        }\n+                        log.info(String.format(\"Member filter activated: [lb-cluster-ids] %s\", sb.toString()));\n+                    }\n+                }\n+\n             }\n \n             if(configuration.isCepStatsPublisherEnabled()) {\n@@ -142,18 +180,16 @@ protected void activate(ComponentContext ctxt) {\n     }\n \n     private void startTenantEventReceiver() {\n-        tenantReceiver = new LoadBalancerTenantEventReceiver();\n-        Thread tenantReceiverThread = new Thread(tenantReceiver);\n-        tenantReceiverThread.start();\n+\t    tenantReceiver = new LoadBalancerTenantEventReceiver();\n+\t    tenantReceiver.execute();\n         if (log.isInfoEnabled()) {\n             log.info(\"Tenant receiver thread started\");\n         }\n     }\n \n     private void startTopologyEventReceiver() {\n-        topologyReceiver = new LoadBalancerTopologyEventReceiver();\n-        Thread topologyReceiverThread = new Thread(topologyReceiver);\n-        topologyReceiverThread.start();\n+\t    topologyReceiver = new LoadBalancerTopologyEventReceiver();\n+\t    topologyReceiver.execute();\n         if (log.isInfoEnabled()) {\n             log.info(\"Topology receiver thread started\");\n         }\n@@ -220,6 +256,8 @@ protected void deactivate(ComponentContext context) {\n         topologyReceiver.terminate();\n         // Terminate statistics notifier\n         statisticsNotifier.terminate();\n+\n+\n     }\n \n     /**",
                "deletions": 6
            },
            {
                "sha": "e729dd535d0cdbc9e77d25f90cb8ee29e20aba3d",
                "filename": "components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/messaging/LoadBalancerTenantEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/messaging/LoadBalancerTenantEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/messaging/LoadBalancerTenantEventReceiver.java",
                "status": "modified",
                "changes": 16,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/messaging/LoadBalancerTenantEventReceiver.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -37,7 +37,7 @@\n  * Load balancer tenant receiver updates load balancer context according to\n  * incoming tenant events.\n  */\n-public class LoadBalancerTenantEventReceiver implements Runnable {\n+public class LoadBalancerTenantEventReceiver{\n \n     private static final Log log = LogFactory.getLog(LoadBalancerTenantEventReceiver.class);\n \n@@ -192,18 +192,10 @@ private boolean isMultiTenantService(String serviceName) {\n         }\n     }\n \n-    @Override\n-    public void run() {\n-        Thread tenantReceiverThread = new Thread(tenantEventReceiver);\n-        tenantReceiverThread.start();\n \n-        // Keep the thread live until terminated\n-        while (!terminated) {\n-            try {\n-                Thread.sleep(1000);\n-            } catch (InterruptedException ignore) {\n-            }\n-        }\n+    public void execute() {\n+        tenantEventReceiver.execute();\n+\n         if (log.isInfoEnabled()) {\n             log.info(\"Load balancer tenant receiver thread terminated\");\n         }",
                "deletions": 12
            },
            {
                "sha": "657d18e9338544c6ac418338286b4db1fafa8d91",
                "filename": "components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/messaging/LoadBalancerTopologyEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/messaging/LoadBalancerTopologyEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/messaging/LoadBalancerTopologyEventReceiver.java",
                "status": "modified",
                "changes": 20,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/messaging/LoadBalancerTopologyEventReceiver.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -39,7 +39,7 @@\n  * Load balancer topology receiver updates load balancer context according to\n  * incoming topology events.\n  */\n-public class LoadBalancerTopologyEventReceiver implements Runnable {\n+public class LoadBalancerTopologyEventReceiver {\n \n     private static final Log log = LogFactory.getLog(LoadBalancerTopologyEventReceiver.class);\n \n@@ -51,24 +51,14 @@ public LoadBalancerTopologyEventReceiver() {\n         addEventListeners();\n     }\n \n-    @Override\n-    public void run() {\n-        Thread thread = new Thread(topologyEventReceiver);\n-        thread.start();\n+    public void execute() {\n+\n+\t    topologyEventReceiver.execute();\n         if (log.isInfoEnabled()) {\n             log.info(\"Load balancer topology receiver thread started\");\n         }\n \n-        // Keep the thread live until terminated\n-        while (!terminated) {\n-            try {\n-                Thread.sleep(1000);\n-            } catch (InterruptedException ignore) {\n-            }\n-        }\n-        if (log.isInfoEnabled()) {\n-            log.info(\"Load balancer topology receiver thread terminated\");\n-        }\n+\n     }\n \n     private void addEventListeners() {",
                "deletions": 15
            },
            {
                "sha": "8687a4b04562cb21ad451f9b361d3a5a8559692b",
                "filename": "components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/client/AutoscalerServiceClient.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/client/AutoscalerServiceClient.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/client/AutoscalerServiceClient.java",
                "status": "modified",
                "changes": 6,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/client/AutoscalerServiceClient.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -170,6 +170,10 @@ public void undeployServiceGroupDefinition(String serviceGroupName)\n         return deploymentPolicies;\n     }\n \n+    public void unDeployDeploymentPolicy(String applicationId) throws RemoteException {\n+        stub.undeployDeploymentPolicy(applicationId);\n+    }\n+\n //    public void checkLBExistenceAgainstPolicy(String clusterId, String deploymentPolicyId) throws RemoteException,\n //            AutoScalerServiceNonExistingLBExceptionException {\n //        stub.checkLBExistenceAgainstPolicy(clusterId, deploymentPolicyId);\n@@ -192,7 +196,7 @@ public void undeployServiceGroupDefinition(String serviceGroupName)\n         return deploymentPolicy;\n     }\n \n-    public boolean deployDeploymentPolicy(DeploymentPolicy deploymentPolicy) throws RemoteException,\n+    public String deployDeploymentPolicy(DeploymentPolicy deploymentPolicy) throws RemoteException,\n             AutoScalerServiceInvalidPolicyExceptionException {\n \n         return stub.addDeploymentPolicy(deploymentPolicy);",
                "deletions": 1
            },
            {
                "sha": "5482e564474fb3ed55e3c1ab6c5f2773d982024c",
                "filename": "components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/client/CloudControllerServiceClient.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/client/CloudControllerServiceClient.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/client/CloudControllerServiceClient.java",
                "status": "modified",
                "changes": 4,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/client/CloudControllerServiceClient.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -99,6 +99,10 @@ public void unDeployCartridgeDefinition (String cartridgeType) throws RemoteExce\n     public void deployServiceGroup (ServiceGroup serviceGroup) throws RemoteException, CloudControllerServiceInvalidServiceGroupExceptionException {\n     \tstub.deployServiceGroup(serviceGroup);\n     }\n+\n+    public void undeployDeploymentPOlicy (String applicationId) throws RemoteException, CloudControllerServiceInvalidServiceGroupExceptionException {\n+        //stub.deployServiceGroup(serviceGroup);\n+    }\n     \n     public void undeployServiceGroup (String name)throws RemoteException, CloudControllerServiceInvalidServiceGroupExceptionException {\n     \tstub.undeployServiceGroup(name);",
                "deletions": 0
            },
            {
                "sha": "e4ffccc4a3a0b207ab508bd3cf7fba83c428f43e",
                "filename": "components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/internal/ADCManagementServerComponent.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/internal/ADCManagementServerComponent.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/internal/ADCManagementServerComponent.java",
                "status": "modified",
                "changes": 25,
                "additions": 18,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/internal/ADCManagementServerComponent.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -18,8 +18,10 @@\n  */\n package org.apache.stratos.manager.internal;\n \n+import org.apache.axis2.util.threadpool.ThreadPool;\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n+import org.apache.stratos.common.threading.StratosThreadPool;\n import org.apache.stratos.manager.listener.InstanceStatusListener;\n import org.apache.stratos.manager.listener.TenantUserRoleCreator;\n import org.apache.stratos.manager.publisher.TenantEventPublisher;\n@@ -39,6 +41,8 @@\n import org.wso2.carbon.user.core.service.RealmService;\n import org.wso2.carbon.utils.ConfigurationContextService;\n \n+import java.util.concurrent.ExecutorService;\n+\n /**\n  * @scr.component name=\"org.wso2.carbon.hosting.mgt.internal.ADCManagementServerComponent\"\n  *                immediate=\"true\"\n@@ -63,13 +67,17 @@\n \n public class ADCManagementServerComponent {\n \n-    private static final Log log = LogFactory.getLog(ADCManagementServerComponent.class);\n-    private StratosManagerTopologyEventReceiver stratosManagerTopologyEventReceiver;\n+\tprivate static final Log log = LogFactory.getLog(ADCManagementServerComponent.class);\n+\tprivate static final String IDENTIFIER = \"Stratos_manager\";\n+\tprivate static final int THREAD_POOL_SIZE = 20;\n+\tprivate StratosManagerTopologyEventReceiver stratosManagerTopologyEventReceiver;\n+\tprivate ExecutorService executorService;\n \n     protected void activate(ComponentContext componentContext) throws Exception {\n \t\ttry {\n \t\t\tCartridgeConfigFileReader.readProperties();\n-\n+\t\t\texecutorService=StratosThreadPool.getExecutorService(IDENTIFIER, THREAD_POOL_SIZE);\n+\t\t\t\n             // Schedule complete tenant event synchronizer\n             if(log.isDebugEnabled()) {\n                 log.debug(\"Scheduling tenant synchronizer task...\");\n@@ -90,8 +98,8 @@ protected void activate(ComponentContext componentContext) throws Exception {\n                 log.debug(\"Starting instance status topic subscriber...\");\n             }\n             Subscriber subscriber = new Subscriber(Util.Topics.INSTANCE_STATUS_TOPIC.getTopicName(), new InstanceStatusListener());\n-            Thread tsubscriber = new Thread(subscriber);\n-\t\t\ttsubscriber.start();\n+       \t\texecutorService.execute(subscriber);\n+\n \n             RealmService realmService = DataHolder.getRealmService();\n             UserRealm realm = realmService.getBootstrapRealm();\n@@ -115,9 +123,11 @@ protected void activate(ComponentContext componentContext) throws Exception {\n             Thread topologyReceiverThread = new Thread(topologyReceiver);\n             topologyReceiverThread.start();*/\n \n+\n             stratosManagerTopologyEventReceiver = new StratosManagerTopologyEventReceiver();\n-            Thread topologyReceiverThread = new Thread(stratosManagerTopologyEventReceiver);\n-            topologyReceiverThread.start();\n+\t\t\tstratosManagerTopologyEventReceiver.setExecutorService(executorService);\n+\t\t\texecutorService.execute(stratosManagerTopologyEventReceiver);\n+\n             log.info(\"Topology receiver thread started\");\n \n             // retrieve persisted CartridgeSubscriptions\n@@ -201,6 +211,7 @@ protected void deactivate(ComponentContext context) {\n         EventPublisherPool.close(Util.Topics.INSTANCE_NOTIFIER_TOPIC.getTopicName());\n         EventPublisherPool.close(Util.Topics.TENANT_TOPIC.getTopicName());\n \n+\t    executorService.shutdownNow();\n         //terminate Stratos Manager Topology Receiver\n         stratosManagerTopologyEventReceiver.terminate();\n     }",
                "deletions": 7
            },
            {
                "sha": "4001f5cd8f48d8f745f996bd24ea4abb38bcb160",
                "filename": "components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/publisher/InstanceNotificationPublisher.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/publisher/InstanceNotificationPublisher.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/publisher/InstanceNotificationPublisher.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/publisher/InstanceNotificationPublisher.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -80,6 +80,6 @@ public void sendInstanceCleanupEventForMember(String memberId) {\n \n \tpublic void sendInstanceCleanupEventForCluster(String clusterId) {\n \t\tlog.info(String.format(\"Publishing Instance Cleanup Event: [cluster] %s\", clusterId));\n-\t\tpublish(new InstanceCleanupClusterEvent(clusterId));\n+\t\tpublish(new InstanceCleanupClusterEvent(clusterId, null));\n \t}\n }",
                "deletions": 1
            },
            {
                "sha": "9ebac570458b8785fd7387f3e8342230fa1e2732",
                "filename": "components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/topology/receiver/StratosManagerTopologyEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/topology/receiver/StratosManagerTopologyEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/topology/receiver/StratosManagerTopologyEventReceiver.java",
                "status": "modified",
                "changes": 17,
                "additions": 15,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/topology/receiver/StratosManagerTopologyEventReceiver.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -37,13 +37,15 @@\n import org.wso2.carbon.context.PrivilegedCarbonContext;\n \n import java.util.List;\n+import java.util.concurrent.ExecutorService;\n \n public class StratosManagerTopologyEventReceiver implements Runnable {\n \n     private static final Log log = LogFactory.getLog(StratosManagerTopologyEventReceiver.class);\n \n     private TopologyEventReceiver topologyEventReceiver;\n     private boolean terminated;\n+\tprivate ExecutorService executorService;\n \n     public StratosManagerTopologyEventReceiver() {\n         this.terminated = false;\n@@ -448,8 +450,11 @@ protected void onEvent(Event event) {\n \n     @Override\n     public void run() {\n-        Thread thread = new Thread(topologyEventReceiver);\n-        thread.start();\n+\n+\t    topologyEventReceiver.setExecutorService(executorService);\n+\t    topologyEventReceiver.execute();\n+\t   // executorService.execute(topologyEventReceiver);\n+\n         log.info(\"Stratos Manager topology receiver thread started\");\n \n         //Keep running till terminate is set from deactivate method of the component\n@@ -468,4 +473,12 @@ public void terminate () {\n         topologyEventReceiver.terminate();\n         terminated = true;\n     }\n+\n+\tpublic ExecutorService getExecutorService() {\n+\t\treturn executorService;\n+\t}\n+\n+\tpublic void setExecutorService(ExecutorService executorService) {\n+\t\tthis.executorService = executorService;\n+\t}\n }",
                "deletions": 2
            },
            {
                "sha": "127cd4fcd8304e160979a3fe13c5b9979a5a83fa",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/domain/applications/DependencyOrder.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/domain/applications/DependencyOrder.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/domain/applications/DependencyOrder.java",
                "status": "modified",
                "changes": 10,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/domain/applications/DependencyOrder.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -28,7 +28,7 @@\n \n \tprivate Set<StartupOrder> startupOrders;\n \n-\tprivate Set<ScalingOrder> scalingOrders;\n+\tprivate Set<ScalingDependentList> scalingDependentLists;\n \n     private String terminationBehaviour;\n \n@@ -52,11 +52,11 @@ public void setStartupOrders(Set<StartupOrder> startupOrders) {\n \t\tthis.startupOrders = startupOrders;\n \t}\n \n-    public Set<ScalingOrder> getScalingOrders() {\n-        return scalingOrders;\n+    public Set<ScalingDependentList> getScalingDependentLists() {\n+        return scalingDependentLists;\n     }\n \n-    public void setScalingOrders(Set<ScalingOrder> scalingOrders) {\n-        this.scalingOrders = scalingOrders;\n+    public void setScalingDependentLists(Set<ScalingDependentList> scalingDependentLists) {\n+        this.scalingDependentLists = scalingDependentLists;\n     }\n }",
                "deletions": 5
            },
            {
                "sha": "456a14a82cecd244288d1e340b230741b3415f36",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/domain/applications/ScalingDependentList.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/domain/applications/ScalingDependentList.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/domain/applications/ScalingDependentList.java",
                "status": "renamed",
                "changes": 16,
                "additions": 8,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/domain/applications/ScalingDependentList.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -22,19 +22,19 @@\n import java.io.Serializable;\n import java.util.List;\n \n-public class ScalingOrder implements Serializable {\n+public class ScalingDependentList implements Serializable {\n \n-    private List<String> scalingOrderComponentsList;\n+    private List<String> scalingDependentListComponents;\n \n-    public ScalingOrder(List<String> scalingOrderList) {\n-        this.scalingOrderComponentsList = scalingOrderList;\n+    public ScalingDependentList(List<String> scalingOrderList) {\n+        this.scalingDependentListComponents = scalingOrderList;\n     }\n \n-    public List<String> getScalingOrderComponentsList() {\n-        return scalingOrderComponentsList;\n+    public List<String> getScalingDependentListComponents() {\n+        return scalingDependentListComponents;\n     }\n \n-    public void setScalingOrderComponentsList(List<String> scalingOrderComponentsList) {\n-        this.scalingOrderComponentsList = scalingOrderComponentsList;\n+    public void setScalingDependentListComponents(List<String> scalingDependentListComponents) {\n+        this.scalingDependentListComponents = scalingDependentListComponents;\n     }\n }",
                "deletions": 8,
                "previous_filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/domain/applications/ScalingOrder.java"
            },
            {
                "sha": "2e345d4901d20bb0843df84e5123be1d25e72205",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/domain/topology/Cluster.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/domain/topology/Cluster.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/domain/topology/Cluster.java",
                "status": "modified",
                "changes": 7,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/domain/topology/Cluster.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -223,8 +223,11 @@ public boolean isStateTransitionValid(ClusterStatus newState, String clusterInst\n     }\n \n     public ClusterStatus getStatus(String applicationInstanceId) {\n-        //return status;\n-        return getInstanceIdToInstanceContextMap().get(applicationInstanceId).getStatus();\n+    \tClusterInstance clusterInstance = getInstanceIdToInstanceContextMap().get(applicationInstanceId);\n+    \tif(clusterInstance != null) {\n+    \t\treturn clusterInstance.getStatus();\n+    \t}\n+    \treturn null;\n     }\n \n     public boolean setStatus(ClusterStatus newStatus, String applicationInstanceId) {",
                "deletions": 2
            },
            {
                "sha": "c8254ed0f91604ce6794b5827b1726b411acf7d8",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/applications/ApplicationInstanceInactivatedEvent.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/applications/ApplicationInstanceInactivatedEvent.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/applications/ApplicationInstanceInactivatedEvent.java",
                "status": "renamed",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/applications/ApplicationInstanceInactivatedEvent.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -25,13 +25,13 @@\n /**\n  * This event will be fired upon the application inactivated is detected.\n  */\n-public class ApplicationInactivatedEvent extends Event implements Serializable {\n+public class ApplicationInstanceInactivatedEvent extends Event implements Serializable {\n     private static final long serialVersionUID = 2625412714611885089L;\n \n     private String appId;\n     private String instanceId;\n \n-    public ApplicationInactivatedEvent(String appId, String instanceId) {\n+    public ApplicationInstanceInactivatedEvent(String appId, String instanceId) {\n         this.appId = appId;\n         this.instanceId = instanceId;\n     }",
                "deletions": 2,
                "previous_filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/applications/ApplicationInactivatedEvent.java"
            },
            {
                "sha": "1d05ba3e09d7eb7db12763b0ac80844028d44fef",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/applications/ApplicationInstanceTerminatedEvent.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/applications/ApplicationInstanceTerminatedEvent.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/applications/ApplicationInstanceTerminatedEvent.java",
                "status": "renamed",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/applications/ApplicationInstanceTerminatedEvent.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -27,13 +27,13 @@\n /**\n  * This event will be fired upon the application terminated is detected.\n  */\n-public class ApplicationTerminatedEvent extends Event implements Serializable {\n+public class ApplicationInstanceTerminatedEvent extends Event implements Serializable {\n     private static final long serialVersionUID = 2625412714611885089L;\n \n     private String appId;\n     private Set<ClusterDataHolder> clusterData;\n \n-    public ApplicationTerminatedEvent(String appId, Set<ClusterDataHolder> clusterData) {\n+    public ApplicationInstanceTerminatedEvent(String appId, Set<ClusterDataHolder> clusterData) {\n         this.appId = appId;\n         this.clusterData = clusterData;\n     }",
                "deletions": 2,
                "previous_filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/applications/ApplicationTerminatedEvent.java"
            },
            {
                "sha": "23510dd08436e0428b795eebfc02d7051cb774e3",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/applications/ApplicationInstanceTerminatingEvent.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/applications/ApplicationInstanceTerminatingEvent.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/applications/ApplicationInstanceTerminatingEvent.java",
                "status": "renamed",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/applications/ApplicationInstanceTerminatingEvent.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -25,14 +25,14 @@\n /**\n  * This event will be fired upon the application terminating is detected.\n  */\n-public class ApplicationTerminatingEvent extends Event implements Serializable {\n+public class ApplicationInstanceTerminatingEvent extends Event implements Serializable {\n     private static final long serialVersionUID = 2625412714611885089L;\n \n     private String appId;\n     private String instanceId;\n \n \n-    public ApplicationTerminatingEvent(String appId, String instanceId) {\n+    public ApplicationInstanceTerminatingEvent(String appId, String instanceId) {\n         this.appId = appId;\n         this.instanceId = instanceId;\n ",
                "deletions": 2,
                "previous_filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/applications/ApplicationTerminatingEvent.java"
            },
            {
                "sha": "96f42ce18cec59346c7e9499c0d4d662dc89fa22",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/instance/notifier/InstanceCleanupClusterEvent.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/instance/notifier/InstanceCleanupClusterEvent.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/instance/notifier/InstanceCleanupClusterEvent.java",
                "status": "modified",
                "changes": 8,
                "additions": 7,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/instance/notifier/InstanceCleanupClusterEvent.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -27,12 +27,18 @@\n  */\n public class InstanceCleanupClusterEvent extends InstanceNotifierEvent implements Serializable {\n     private String clusterId;\n+    private String instanceId;\n \n-    public InstanceCleanupClusterEvent(String clusterId) {\n+    public InstanceCleanupClusterEvent(String clusterId, String instanceId) {\n         this.clusterId = clusterId;\n+        this.instanceId = instanceId;\n     }\n \n     public String getClusterId() {\n         return clusterId;\n     }\n+\n+    public String getInstanceId() {\n+        return instanceId;\n+    }\n }",
                "deletions": 1
            },
            {
                "sha": "58055e0f6c23cc6ac4efcf4e29e4ecbf8a90c0bd",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/topology/ClusterInstanceCreatedEvent.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/topology/ClusterInstanceCreatedEvent.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/topology/ClusterInstanceCreatedEvent.java",
                "status": "modified",
                "changes": 21,
                "additions": 20,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/event/topology/ClusterInstanceCreatedEvent.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -29,13 +29,17 @@\n     private final String clusterId;\n     private String instanceId;\n     private String alias;\n+    private String partitionId;\n+    private String networkPartitionId;\n \n \n-    public ClusterInstanceCreatedEvent(String alias, String serviceName, String clusterId, String instanceId) {\n+    public ClusterInstanceCreatedEvent(String alias, String serviceName, String clusterId,\n+                                       String instanceId, String networkPartitionId) {\n         this.serviceName = serviceName;\n         this.clusterId = clusterId;\n         this.instanceId = instanceId;\n         this.alias = alias;\n+        this.setNetworkPartitionId(networkPartitionId);\n \n     }\n \n@@ -61,4 +65,19 @@ public String getAlias() {\n         return alias;\n     }\n \n+    public String getPartitionId() {\n+        return partitionId;\n+    }\n+\n+    public void setPartitionId(String partitionId) {\n+        this.partitionId = partitionId;\n+    }\n+\n+    public String getNetworkPartitionId() {\n+        return networkPartitionId;\n+    }\n+\n+    public void setNetworkPartitionId(String networkPartitionId) {\n+        this.networkPartitionId = networkPartitionId;\n+    }\n }",
                "deletions": 1
            },
            {
                "sha": "5a3ef91f725db6602ddb3e2ba5d28fc9c797faa3",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/applications/ApplicationInactivatedMessageProcessor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/applications/ApplicationInactivatedMessageProcessor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/applications/ApplicationInactivatedMessageProcessor.java",
                "status": "modified",
                "changes": 10,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/applications/ApplicationInactivatedMessageProcessor.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -24,7 +24,7 @@\n import org.apache.stratos.messaging.domain.applications.ApplicationStatus;\n import org.apache.stratos.messaging.domain.applications.Applications;\n import org.apache.stratos.messaging.domain.instance.ApplicationInstance;\n-import org.apache.stratos.messaging.event.applications.ApplicationInactivatedEvent;\n+import org.apache.stratos.messaging.event.applications.ApplicationInstanceInactivatedEvent;\n import org.apache.stratos.messaging.message.processor.MessageProcessor;\n import org.apache.stratos.messaging.message.processor.applications.updater.ApplicationsUpdater;\n import org.apache.stratos.messaging.util.Util;\n@@ -49,14 +49,14 @@ public void setNext(MessageProcessor nextProcessor) {\n     public boolean process(String type, String message, Object object) {\n         Applications applications = (Applications) object;\n \n-        if (ApplicationInactivatedEvent.class.getName().equals(type)) {\n+        if (ApplicationInstanceInactivatedEvent.class.getName().equals(type)) {\n             // Return if applications has not been initialized\n             if (!applications.isInitialized())\n                 return false;\n \n             // Parse complete message and build event\n-            ApplicationInactivatedEvent event = (ApplicationInactivatedEvent) Util.\n-                    jsonToObject(message, ApplicationInactivatedEvent.class);\n+            ApplicationInstanceInactivatedEvent event = (ApplicationInstanceInactivatedEvent) Util.\n+                    jsonToObject(message, ApplicationInstanceInactivatedEvent.class);\n \n             ApplicationsUpdater.acquireWriteLockForApplication(event.getAppId());\n \n@@ -77,7 +77,7 @@ public boolean process(String type, String message, Object object) {\n         }\n     }\n \n-    private boolean doProcess(ApplicationInactivatedEvent event, Applications applications) {\n+    private boolean doProcess(ApplicationInstanceInactivatedEvent event, Applications applications) {\n \n         // Validate event against the existing applications\n         Application application = applications.getApplication(event.getAppId());",
                "deletions": 5
            },
            {
                "sha": "a6d2cd54517a80e8d51129bad9c7eb5891a5731c",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/applications/ApplicationTerminatedMessageProcessor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/applications/ApplicationTerminatedMessageProcessor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/applications/ApplicationTerminatedMessageProcessor.java",
                "status": "modified",
                "changes": 14,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/applications/ApplicationTerminatedMessageProcessor.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -21,15 +21,11 @@\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.stratos.messaging.domain.applications.Applications;\n-import org.apache.stratos.messaging.domain.applications.ClusterDataHolder;\n-import org.apache.stratos.messaging.event.applications.ApplicationTerminatedEvent;\n+import org.apache.stratos.messaging.event.applications.ApplicationInstanceTerminatedEvent;\n import org.apache.stratos.messaging.message.processor.MessageProcessor;\n import org.apache.stratos.messaging.message.processor.applications.updater.ApplicationsUpdater;\n-import org.apache.stratos.messaging.message.processor.topology.updater.TopologyUpdater;\n import org.apache.stratos.messaging.util.Util;\n \n-import java.util.Set;\n-\n /**\n  * This processor responsible to process the application Inactivation even and update the Topology.\n  */\n@@ -50,14 +46,14 @@ public void setNext(MessageProcessor nextProcessor) {\n     public boolean process(String type, String message, Object object) {\n         Applications applications = (Applications) object;\n \n-        if (ApplicationTerminatedEvent.class.getName().equals(type)) {\n+        if (ApplicationInstanceTerminatedEvent.class.getName().equals(type)) {\n             // Return if applications has not been initialized\n             if (!applications.isInitialized())\n                 return false;\n \n             // Parse complete message and build event\n-            ApplicationTerminatedEvent event = (ApplicationTerminatedEvent) Util.\n-                    jsonToObject(message, ApplicationTerminatedEvent.class);\n+            ApplicationInstanceTerminatedEvent event = (ApplicationInstanceTerminatedEvent) Util.\n+                    jsonToObject(message, ApplicationInstanceTerminatedEvent.class);\n \n             ApplicationsUpdater.acquireWriteLockForApplications();\n \n@@ -78,7 +74,7 @@ public boolean process(String type, String message, Object object) {\n         }\n     }\n \n-    private boolean doProcess(ApplicationTerminatedEvent event, Applications applications) {\n+    private boolean doProcess(ApplicationInstanceTerminatedEvent event, Applications applications) {\n \n         // check if required properties are available\n         if (event.getAppId() == null) {",
                "deletions": 9
            },
            {
                "sha": "33ad474b25da6c5cd98cf506387df7075f175460",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/applications/ApplicationTerminatingMessageProcessor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/applications/ApplicationTerminatingMessageProcessor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/applications/ApplicationTerminatingMessageProcessor.java",
                "status": "modified",
                "changes": 10,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/applications/ApplicationTerminatingMessageProcessor.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -24,7 +24,7 @@\n import org.apache.stratos.messaging.domain.applications.ApplicationStatus;\n import org.apache.stratos.messaging.domain.applications.Applications;\n import org.apache.stratos.messaging.domain.instance.ApplicationInstance;\n-import org.apache.stratos.messaging.event.applications.ApplicationTerminatingEvent;\n+import org.apache.stratos.messaging.event.applications.ApplicationInstanceTerminatingEvent;\n import org.apache.stratos.messaging.message.processor.MessageProcessor;\n import org.apache.stratos.messaging.message.processor.applications.updater.ApplicationsUpdater;\n import org.apache.stratos.messaging.util.Util;\n@@ -49,14 +49,14 @@ public void setNext(MessageProcessor nextProcessor) {\n     public boolean process(String type, String message, Object object) {\n         Applications applications = (Applications) object;\n \n-        if (ApplicationTerminatingEvent.class.getName().equals(type)) {\n+        if (ApplicationInstanceTerminatingEvent.class.getName().equals(type)) {\n             // Return if applications has not been initialized\n             if (!applications.isInitialized())\n                 return false;\n \n             // Parse complete message and build event\n-            ApplicationTerminatingEvent event = (ApplicationTerminatingEvent) Util.\n-                    jsonToObject(message, ApplicationTerminatingEvent.class);\n+            ApplicationInstanceTerminatingEvent event = (ApplicationInstanceTerminatingEvent) Util.\n+                    jsonToObject(message, ApplicationInstanceTerminatingEvent.class);\n \n             ApplicationsUpdater.acquireWriteLockForApplication(event.getAppId());\n \n@@ -77,7 +77,7 @@ public boolean process(String type, String message, Object object) {\n         }\n     }\n \n-    private boolean doProcess(ApplicationTerminatingEvent event, Applications applications) {\n+    private boolean doProcess(ApplicationInstanceTerminatingEvent event, Applications applications) {\n \n         // Validate event against the existing applications\n         Application application = applications.getApplication(event.getAppId());",
                "deletions": 5
            },
            {
                "sha": "a0bf735aaea48ab3d939f5c78c6b68a99a264a16",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/topology/ClusterInstanceCreatedMessageProcessor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/topology/ClusterInstanceCreatedMessageProcessor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/topology/ClusterInstanceCreatedMessageProcessor.java",
                "status": "modified",
                "changes": 3,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/processor/topology/ClusterInstanceCreatedMessageProcessor.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -118,7 +118,8 @@ private boolean doProcess (ClusterInstanceCreatedEvent event,Topology topology)\n             ClusterInstance context = new ClusterInstance(event.getAlias(),\n                                                                         event.getClusterId(),\n                                                                         event.getInstanceId());\n-            //context.setStatus(ClusterStatus.Created);\n+            context.setNetworkPartitionId(event.getNetworkPartitionId());\n+            context.setPartitionId(event.getPartitionId());\n             cluster.addInstanceContext(event.getInstanceId(), context);\n         }\n         // Notify event listeners",
                "deletions": 1
            },
            {
                "sha": "82d8c8335935917071b4087a650a17eaf588fd54",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/applications/ApplicationsEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/applications/ApplicationsEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/applications/ApplicationsEventReceiver.java",
                "status": "modified",
                "changes": 34,
                "additions": 19,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/applications/ApplicationsEventReceiver.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -24,13 +24,16 @@\n import org.apache.stratos.messaging.listener.EventListener;\n import org.apache.stratos.messaging.util.Util;\n \n-public class ApplicationsEventReceiver implements Runnable {\n+import java.util.concurrent.ExecutorService;\n+\n+public class ApplicationsEventReceiver {\n     private static final Log log = LogFactory.getLog(ApplicationsEventReceiver.class);\n \n     private ApplicationsEventMessageDelegator messageDelegator;\n     private ApplicationsEventMessageListener messageListener;\n     private Subscriber subscriber;\n     private boolean terminated;\n+\tprivate ExecutorService executorService;\n \n     public ApplicationsEventReceiver() {\n         ApplicationsEventMessageQueue messageQueue = new ApplicationsEventMessageQueue();\n@@ -42,32 +45,25 @@ public void addEventListener(EventListener eventListener) {\n         messageDelegator.addEventListener(eventListener);\n     }\n \n-    @Override\n-    public void run() {\n+\n+    public void execute() {\n         try {\n             // Start topic subscriber thread\n             subscriber = new Subscriber(Util.Topics.APPLICATIONS_TOPIC.getTopicName(), messageListener);\n-//            subscriber.setMessageListener(messageListener);\n-            Thread subscriberThread = new Thread(subscriber);\n-            subscriberThread.start();\n+\t\t\texecutorService.execute(subscriber);\n+\n             if (log.isDebugEnabled()) {\n                 log.debug(\"Application status event message receiver thread started\");\n             }\n \n             // Start Application status event message delegator thread\n-            Thread receiverThread = new Thread(messageDelegator);\n-            receiverThread.start();\n+\t        executorService.execute(messageDelegator);\n+\n             if (log.isDebugEnabled()) {\n                 log.debug(\"Application status event message delegator thread started\");\n             }\n \n-            // Keep the thread live until terminated\n-            while (!terminated) {\n-                try {\n-                    Thread.sleep(1000);\n-                } catch (InterruptedException ignore) {\n-                }\n-            }\n+\n         } catch (Exception e) {\n             if (log.isErrorEnabled()) {\n                 log.error(\"Application status failed\", e);\n@@ -80,4 +76,12 @@ public void terminate() {\n         messageDelegator.terminate();\n         terminated = true;\n     }\n+\n+\tpublic ExecutorService getExecutorService() {\n+\t\treturn executorService;\n+\t}\n+\n+\tpublic void setExecutorService(ExecutorService executorService) {\n+\t\tthis.executorService = executorService;\n+\t}\n }",
                "deletions": 15
            },
            {
                "sha": "a6de43065edadd7bb991801f67b8fa2e9326ad63",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/cluster/status/ClusterStatusEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/cluster/status/ClusterStatusEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/cluster/status/ClusterStatusEventReceiver.java",
                "status": "modified",
                "changes": 34,
                "additions": 19,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/cluster/status/ClusterStatusEventReceiver.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -25,15 +25,19 @@\n import org.apache.stratos.messaging.listener.EventListener;\n import org.apache.stratos.messaging.util.Util;\n \n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Future;\n+\n /**\n  * A thread for receiving instance notifier information from message broker.\n  */\n-public class ClusterStatusEventReceiver implements Runnable {\n+public class ClusterStatusEventReceiver{\n     private static final Log log = LogFactory.getLog(ClusterStatusEventReceiver.class);\n     private final ClusterStatusEventMessageDelegator messageDelegator;\n     private final ClusterStatusEventMessageListener messageListener;\n     private Subscriber subscriber;\n     private boolean terminated;\n+\tprivate ExecutorService executorService;\n \n     public ClusterStatusEventReceiver() {\n         ClusterStatusEventMessageQueue messageQueue = new ClusterStatusEventMessageQueue();\n@@ -45,32 +49,24 @@ public void addEventListener(EventListener eventListener) {\n         messageDelegator.addEventListener(eventListener);\n     }\n \n-    @Override\n-    public void run() {\n+\n+    public void execute() {\n         try {\n             // Start topic subscriber thread\n             subscriber = new Subscriber(Util.Topics.CLUSTER_STATUS_TOPIC.getTopicName(), messageListener);\n-//            subscriber.setMessageListener(messageListener);\n-            Thread subscriberThread = new Thread(subscriber);\n-            subscriberThread.start();\n+            executorService.execute(subscriber);\n+\n             if (log.isDebugEnabled()) {\n                 log.debug(\"InstanceNotifier event message receiver thread started\");\n             }\n \n             // Start instance notifier event message delegator thread\n-            Thread receiverThread = new Thread(messageDelegator);\n-            receiverThread.start();\n+\t        executorService.execute(messageDelegator);\n             if (log.isDebugEnabled()) {\n                 log.debug(\"InstanceNotifier event message delegator thread started\");\n             }\n \n-            // Keep the thread live until terminated\n-            while (!terminated) {\n-                try {\n-                    Thread.sleep(1000);\n-                } catch (InterruptedException ignore) {\n-                }\n-            }\n+\n         } catch (Exception e) {\n             if (log.isErrorEnabled()) {\n                 log.error(\"InstanceNotifier receiver failed\", e);\n@@ -87,4 +83,12 @@ public void terminate() {\n         messageDelegator.terminate();\n         terminated = true;\n     }\n+\n+\tpublic ExecutorService getExecutorService() {\n+\t\treturn executorService;\n+\t}\n+\n+\tpublic void setExecutorService(ExecutorService executorService) {\n+\t\tthis.executorService = executorService;\n+\t}\n }",
                "deletions": 15
            },
            {
                "sha": "07e7473974c5bc5f1f35cfbb4f9737145136b590",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/health/stat/HealthStatEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/health/stat/HealthStatEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/health/stat/HealthStatEventReceiver.java",
                "status": "modified",
                "changes": 40,
                "additions": 19,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/health/stat/HealthStatEventReceiver.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -25,16 +25,19 @@\n import org.apache.stratos.messaging.listener.EventListener;\n import org.apache.stratos.messaging.util.Util;\n \n+import java.util.concurrent.ExecutorService;\n+\n /**\n  * A thread for receiving health stat information from message broker\n  */\n-public class HealthStatEventReceiver implements Runnable {\n+public class HealthStatEventReceiver {\n \tprivate static final Log log = LogFactory.getLog(HealthStatEventReceiver.class);\n \n \tprivate final HealthStatEventMessageDelegator messageDelegator;\n \tprivate final HealthStatEventMessageListener messageListener;\n \tprivate Subscriber subscriber;\n \tprivate boolean terminated;\n+\tprivate ExecutorService executorService;\n \n \tpublic HealthStatEventReceiver() {\n \t\tHealthStatEventMessageQueue messageQueue = new HealthStatEventMessageQueue();\n@@ -46,32 +49,19 @@ public void addEventListener(EventListener eventListener) {\n \t\tmessageDelegator.addEventListener(eventListener);\n \t}\n \n-\t@Override\n-\tpublic void run() {\n+\n+\tpublic void execute() {\n \t\ttry {\n \t\t\t// Start topic subscriber thread\n \t\t\tsubscriber = new Subscriber(Util.Topics.HEALTH_STAT_TOPIC.getTopicName(), messageListener);\n-//\t\t\tsubscriber.setMessageListener(messageListener);\n-\t\t\tThread subscriberThread = new Thread(subscriber);\n-\t\t\tsubscriberThread.start();\n-\t\t\tif (log.isDebugEnabled()) {\n-\t\t\t\tlog.debug(\"Health stats event message receiver thread started\");\n-\t\t\t}\n \n-\t\t\t// Start health stat event message delegator thread\n-\t\t\tThread receiverThread = new Thread(messageDelegator);\n-\t\t\treceiverThread.start();\n-\t\t\tif (log.isDebugEnabled()) {\n-\t\t\t\tlog.debug(\"Health stats event message delegator thread started\");\n-\t\t\t}\n+            executorService.execute(subscriber);\n \n-\t\t\t// Keep the thread live until terminated\n-\t\t\twhile (!terminated) {\n-\t\t\t\ttry {\n-\t\t\t\t\tThread.sleep(1000);\n-\t\t\t\t} catch (InterruptedException ignore) {\n-\t\t\t\t}\n+            if (log.isDebugEnabled()) {\n+\t\t\t\tlog.debug(\"Health stats event message delegator thread started\");\n \t\t\t}\n+            // Start topology event message delegator thread\n+            executorService.execute(messageDelegator);\n \t\t} catch (Exception e) {\n \t\t\tif (log.isErrorEnabled()) {\n \t\t\t\tlog.error(\"Topology receiver failed\", e);\n@@ -84,4 +74,12 @@ public void terminate() {\n \t\tmessageDelegator.terminate();\n \t\tterminated = true;\n \t}\n+\n+\tpublic ExecutorService getExecutorService() {\n+\t\treturn executorService;\n+\t}\n+\n+\tpublic void setExecutorService(ExecutorService executorService) {\n+\t\tthis.executorService = executorService;\n+\t}\n }",
                "deletions": 21
            },
            {
                "sha": "5e09672a8dea52396bd3288978db923dea22f96c",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/instance/notifier/InstanceNotifierEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/instance/notifier/InstanceNotifierEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/instance/notifier/InstanceNotifierEventReceiver.java",
                "status": "modified",
                "changes": 6,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/instance/notifier/InstanceNotifierEventReceiver.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -29,7 +29,7 @@\n /**\n  * A thread for receiving instance notifier information from message broker.\n  */\n-public class InstanceNotifierEventReceiver implements Runnable {\n+public class InstanceNotifierEventReceiver {\n \tprivate static final Log log = LogFactory.getLog(InstanceNotifierEventReceiver.class);\n \tprivate final InstanceNotifierEventMessageDelegator messageDelegator;\n \tprivate final InstanceNotifierEventMessageListener messageListener;\n@@ -46,8 +46,8 @@ public void addEventListener(EventListener eventListener) {\n \t\tmessageDelegator.addEventListener(eventListener);\n \t}\n \n-\t@Override\n-\tpublic void run() {\n+\n+\tpublic void execute() {\n \t\ttry {\n \t\t\t// Start topic subscriber thread\n \t\t\tsubscriber = new Subscriber(Util.Topics.INSTANCE_NOTIFIER_TOPIC.getTopicName(), messageListener);",
                "deletions": 3
            },
            {
                "sha": "af9319f88d5e156b1a1f0e9050bd0d52ae8ec17a",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/instance/status/InstanceStatusEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/instance/status/InstanceStatusEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/instance/status/InstanceStatusEventReceiver.java",
                "status": "modified",
                "changes": 33,
                "additions": 18,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/instance/status/InstanceStatusEventReceiver.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -25,15 +25,18 @@\n import org.apache.stratos.messaging.listener.EventListener;\n import org.apache.stratos.messaging.util.Util;\n \n+import java.util.concurrent.ExecutorService;\n+\n /**\n  * A thread for receiving instance notifier information from message broker.\n  */\n-public class InstanceStatusEventReceiver implements Runnable {\n+public class InstanceStatusEventReceiver {\n     private static final Log log = LogFactory.getLog(InstanceStatusEventReceiver.class);\n     private final InstanceStatusEventMessageDelegator messageDelegator;\n     private final InstanceStatusEventMessageListener messageListener;\n     private Subscriber subscriber;\n     private boolean terminated;\n+\tprivate ExecutorService executorService;\n \n     public InstanceStatusEventReceiver() {\n         InstanceStatusEventMessageQueue messageQueue = new InstanceStatusEventMessageQueue();\n@@ -45,32 +48,24 @@ public void addEventListener(EventListener eventListener) {\n         messageDelegator.addEventListener(eventListener);\n     }\n \n-    @Override\n-    public void run() {\n+\n+    public void execute() {\n         try {\n             // Start topic subscriber thread\n             subscriber = new Subscriber(Util.Topics.INSTANCE_STATUS_TOPIC.getTopicName(), messageListener);\n //            subscriber.setMessageListener(messageListener);\n-            Thread subscriberThread = new Thread(subscriber);\n-            subscriberThread.start();\n+            executorService.submit(subscriber);\n             if (log.isDebugEnabled()) {\n                 log.debug(\"InstanceNotifier event message receiver thread started\");\n             }\n \n-            // Start instance notifier event message delegator thread\n-            Thread receiverThread = new Thread(messageDelegator);\n-            receiverThread.start();\n+            // Start instance notifier event message delegate thread\n+            executorService.submit(messageDelegator);\n             if (log.isDebugEnabled()) {\n                 log.debug(\"InstanceNotifier event message delegator thread started\");\n             }\n \n-            // Keep the thread live until terminated\n-            while (!terminated) {\n-                try {\n-                    Thread.sleep(1000);\n-                } catch (InterruptedException ignore) {\n-                }\n-            }\n+\n         } catch (Exception e) {\n             if (log.isErrorEnabled()) {\n                 log.error(\"InstanceNotifier receiver failed\", e);\n@@ -87,4 +82,12 @@ public void terminate() {\n         messageDelegator.terminate();\n         terminated = true;\n     }\n+\n+\tpublic ExecutorService getExecutorService() {\n+\t\treturn executorService;\n+\t}\n+\n+\tpublic void setExecutorService(ExecutorService executorService) {\n+\t\tthis.executorService = executorService;\n+\t}\n }",
                "deletions": 15
            },
            {
                "sha": "4eabc96473be391497ee62932d0c14bd06978e5f",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/tenant/TenantEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/tenant/TenantEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/tenant/TenantEventReceiver.java",
                "status": "modified",
                "changes": 14,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/tenant/TenantEventReceiver.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -29,7 +29,7 @@\n  * A thread for receiving tenant information from message broker and\n  * build tenant information in tenant manager.\n  */\n-public class TenantEventReceiver implements Runnable {\n+public class TenantEventReceiver{\n     private static final Log log = LogFactory.getLog(TenantEventReceiver.class);\n     private TenantEventMessageDelegator messageDelegator;\n     private TenantEventMessageListener messageListener;\n@@ -46,8 +46,8 @@ public void addEventListener(EventListener eventListener) {\n         messageDelegator.addEventListener(eventListener);\n     }\n \n-    @Override\n-    public void run() {\n+\n+    public void execute() {\n         try {\n             // Start topic subscriber thread\n             subscriber = new Subscriber(Util.Topics.TENANT_TOPIC.getTopicName(), messageListener);\n@@ -65,13 +65,7 @@ public void run() {\n                 log.debug(\"Tenant event message delegator thread started\");\n             }\n \n-            // Keep the thread live until terminated\n-            while (!terminated) {\n-            \ttry {\n-                    Thread.sleep(1000);\n-                } catch (InterruptedException ignore) {\n-                }\n-            }\n+\n         } catch (Exception e) {\n             if (log.isErrorEnabled()) {\n                 log.error(\"Tenant receiver failed\", e);",
                "deletions": 10
            },
            {
                "sha": "a1da2a8b6623a604f74030dc32fc25fdd3597894",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/topology/TopologyEventMessageDelegator.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/topology/TopologyEventMessageDelegator.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/topology/TopologyEventMessageDelegator.java",
                "status": "modified",
                "changes": 20,
                "additions": 9,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/topology/TopologyEventMessageDelegator.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -62,19 +62,17 @@ public void run() {\n                     String json = message.getText();\n \n                     if (log.isDebugEnabled()) {\n-                        log.debug(String.format(\"Topology event message [%s] received from queue: %s\", type, messageQueue.getClass()));\n+                        log.debug(String.format(\"Topology event message [%s] received from queue: %s\", type,\n+                                messageQueue.getClass()));\n                     }\n \n-//                    try {\n-//                        TopologyManager.acquireWriteLock();\n-                        if (log.isDebugEnabled()) {\n-                            log.debug(String.format(\"Delegating topology event message: %s\", type));\n-                        }\n-                        processorChain.process(type, json, TopologyManager.getTopology());\n-//                    } finally {\n-//                        TopologyManager.releaseWriteLock();\n-//                    }\n-\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(String.format(\"Delegating topology event message: %s\", type));\n+                    }\n+                    processorChain.process(type, json, TopologyManager.getTopology());\n+                } catch (InterruptedException e) {\n+                    log.info(\"TopologyEventMessageDelegator is shutting down ..\");\n+                    return;\n                 } catch (Exception e) {\n                     log.error(\"Failed to retrieve topology event message\", e);\n                 }",
                "deletions": 11
            },
            {
                "sha": "b4beea5f2eb99df9edcb184f0a5fee9272086737",
                "filename": "components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/topology/TopologyEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/topology/TopologyEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/topology/TopologyEventReceiver.java",
                "status": "modified",
                "changes": 31,
                "additions": 16,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.messaging/src/main/java/org/apache/stratos/messaging/message/receiver/topology/TopologyEventReceiver.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -25,17 +25,18 @@\n import org.apache.stratos.messaging.listener.EventListener;\n import org.apache.stratos.messaging.util.Util;\n \n-\n+import java.util.concurrent.ExecutorService;\n \n /**\n  * A thread for receiving topology information from message broker and\n  * build topology in topology manager.\n  */\n-public class TopologyEventReceiver implements Runnable {\n+public class TopologyEventReceiver {\n     private static final Log log = LogFactory.getLog(TopologyEventReceiver.class);\n     private TopologyEventMessageDelegator messageDelegator;\n     private TopologyEventMessageListener messageListener;\n     private Subscriber subscriber;\n+\tprivate ExecutorService executorService;\n     private boolean terminated;\n \n     public TopologyEventReceiver() {\n@@ -48,34 +49,26 @@ public void addEventListener(EventListener eventListener) {\n         messageDelegator.addEventListener(eventListener);\n     }\n \n-\t@Override\n-\tpublic void run() {\n+\n+\tpublic void execute() {\n \t\ttry {\n \t\t\t// Start topic subscriber thread\n \t\t\tsubscriber = new Subscriber(Util.Topics.TOPOLOGY_TOPIC.getTopicName(), messageListener);\n \t\t\t// subscriber.setMessageListener(messageListener);\n+\t\t\texecutorService.execute(subscriber);\n \n-\t\t\tThread subscriberThread = new Thread(subscriber);\n-\t\t\tsubscriberThread.start();\n \n             if (log.isDebugEnabled()) {\n                 log.debug(\"Topology event message receiver thread started\");\n             }\n \n             // Start topology event message delegator thread\n-            Thread receiverThread = new Thread(messageDelegator);\n-            receiverThread.start();\n+            executorService.execute(messageDelegator);\n             if (log.isDebugEnabled()) {\n                 log.debug(\"Topology event message delegator thread started\");\n             }\n \n-            // Keep the thread live until terminated\n-            while (!terminated) {\n-            \ttry {\n-                    Thread.sleep(1000);\n-                } catch (InterruptedException ignore) {\n-                }\n-            }\n+\n         } catch (Exception e) {\n             if (log.isErrorEnabled()) {\n                 log.error(\"Topology receiver failed\", e);\n@@ -88,4 +81,12 @@ public void terminate() {\n         messageDelegator.terminate();\n         terminated = true;\n     }\n+\n+\tpublic ExecutorService getExecutorService() {\n+\t\treturn executorService;\n+\t}\n+\n+\tpublic void setExecutorService(ExecutorService executorService) {\n+\t\tthis.executorService = executorService;\n+\t}\n }",
                "deletions": 15
            },
            {
                "sha": "dbdf92ae72f8c0bbfd34c8b7fd6082ab4e3ec280",
                "filename": "components/org.apache.stratos.python.cartridge.agent/cartridgeagent/cartridgeagent/modules/config/cartridgeagentconfiguration.py",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.python.cartridge.agent/cartridgeagent/cartridgeagent/modules/config/cartridgeagentconfiguration.py",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.python.cartridge.agent/cartridgeagent/cartridgeagent/modules/config/cartridgeagentconfiguration.py",
                "status": "modified",
                "changes": 3,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.python.cartridge.agent/cartridgeagent/cartridgeagent/modules/config/cartridgeagentconfiguration.py?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -93,6 +93,8 @@ def __init__(self):\n             \"\"\" :type : str  \"\"\"\n             self.is_primary = False\n             \"\"\" :type : bool  \"\"\"\n+            self.instance_id = None\n+            \"\"\" :type : str  \"\"\"\n \n             self.payload_params = {}\n             self.__read_conf_file()\n@@ -123,6 +125,7 @@ def __init__(self):\n                 self.app_path = self.read_property(cartridgeagentconstants.APP_PATH, False)\n                 self.repo_url = self.read_property(cartridgeagentconstants.REPO_URL, False)\n                 self.ports = str(self.read_property(cartridgeagentconstants.PORTS)).split(\"|\")\n+                self.instance_id= self.read_property(cartridgeagentconstants.INSTANCE_ID)\n \n                 try:\n                     self.log_file_paths = str(",
                "deletions": 0
            },
            {
                "sha": "f06da8bc53356f9905fec45457d08ef21023e8f1",
                "filename": "components/org.apache.stratos.python.cartridge.agent/cartridgeagent/cartridgeagent/modules/healthstatspublisher/healthstats.py",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.python.cartridge.agent/cartridgeagent/cartridgeagent/modules/healthstatspublisher/healthstats.py",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.python.cartridge.agent/cartridgeagent/cartridgeagent/modules/healthstatspublisher/healthstats.py",
                "status": "modified",
                "changes": 3,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.python.cartridge.agent/cartridgeagent/cartridgeagent/modules/healthstatspublisher/healthstats.py?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -123,6 +123,8 @@ def create_stream_definition():\n         stream_def.nickname = HealthStatisticsPublisherManager.STREAM_NICKNAME\n         stream_def.description = HealthStatisticsPublisherManager.STREAM_DESCRIPTION\n \n+\n+        stream_def.add_payloaddata_attribute(\"instance_id\", StreamDefinition.STRING)\n         stream_def.add_payloaddata_attribute(\"cluster_id\", StreamDefinition.STRING)\n         stream_def.add_payloaddata_attribute(\"network_partition_id\", StreamDefinition.STRING)\n         stream_def.add_payloaddata_attribute(\"member_id\", StreamDefinition.STRING)\n@@ -139,6 +141,7 @@ def publish_memory_usage(self, memory_usage):\n         \"\"\"\n \n         event = ThriftEvent()\n+        event.payloadData.append(self.cartridge_agent_config.instance_id)\n         event.payloadData.append(self.cartridge_agent_config.cluster_id)\n         event.payloadData.append(self.cartridge_agent_config.network_partition_id)\n         event.payloadData.append(self.cartridge_agent_config.member_id)",
                "deletions": 0
            },
            {
                "sha": "1e59b8b1254bd601447742eb33e79c6fced0888c",
                "filename": "components/org.apache.stratos.python.cartridge.agent/cartridgeagent/cartridgeagent/modules/util/cartridgeagentconstants.py",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.python.cartridge.agent/cartridgeagent/cartridgeagent/modules/util/cartridgeagentconstants.py",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.python.cartridge.agent/cartridgeagent/cartridgeagent/modules/util/cartridgeagentconstants.py",
                "status": "modified",
                "changes": 1,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.python.cartridge.agent/cartridgeagent/cartridgeagent/modules/util/cartridgeagentconstants.py?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -26,6 +26,7 @@\n SERVICE_GROUP = \"SERIVCE_GROUP\"\n SERVICE_NAME = \"SERVICE_NAME\"\n CLUSTER_ID = \"CLUSTER_ID\"\n+INSTANCE_ID= \"INSTANCE_ID\"\n LB_CLUSTER_ID = \"LB_CLUSTER_ID\"\n NETWORK_PARTITION_ID = \"NETWORK_PARTITION_ID\"\n PARTITION_ID = \"PARTITION_ID\"",
                "deletions": 0
            },
            {
                "sha": "fb28910451c0066f4118888e5dbb74108138aa28",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV40Utils.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV40Utils.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV40Utils.java",
                "status": "modified",
                "changes": 11,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV40Utils.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -230,17 +230,15 @@ public static StratosApiResponse deployDeploymentPolicy(\n             org.apache.stratos.rest.endpoint.bean.autoscaler.policy.deployment.DeploymentPolicy deploymentPolicyBean)\n             throws RestAPIException {\n \n-        //log.info(\"***** \" + cartridgeDefinitionBean.toString() + \" *****\");\n+        String policyId = null;\n \n         AutoscalerServiceClient autoscalerServiceClient = getAutoscalerServiceClient();\n         if (autoscalerServiceClient != null) {\n \n-            DeploymentPolicy deploymentPolicy =\n-                    PojoConverter.convetToASDeploymentPolicyPojo(deploymentPolicyBean);\n+            DeploymentPolicy deploymentPolicy = PojoConverter.convetToASDeploymentPolicyPojo(deploymentPolicyBean);\n \n             try {\n-                autoscalerServiceClient\n-                        .deployDeploymentPolicy(deploymentPolicy);\n+                policyId = autoscalerServiceClient.deployDeploymentPolicy(deploymentPolicy);\n             } catch (RemoteException e) {\n                 log.error(e.getMessage(), e);\n                 throw new RestAPIException(e.getMessage(), e);\n@@ -253,8 +251,7 @@ public static StratosApiResponse deployDeploymentPolicy(\n         }\n \n         StratosApiResponse stratosApiResponse = new StratosApiResponse();\n-        stratosApiResponse.setMessage(\"Successfully deployed deployment policy definition with type \"\n-                + deploymentPolicyBean.id);\n+        stratosApiResponse.setMessage(\"Successfully deployed deployment policy definition with type \" + policyId);\n         return stratosApiResponse;\n     }\n ",
                "deletions": 7
            },
            {
                "sha": "a8eab467fd487171bd62bb7ddec3c6b4ea69187f",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41.java",
                "status": "modified",
                "changes": 19,
                "additions": 14,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -42,7 +42,6 @@\n import org.apache.stratos.rest.endpoint.bean.CartridgeInfoBean;\n import org.apache.stratos.rest.endpoint.bean.StratosApiResponse;\n import org.apache.stratos.rest.endpoint.bean.SubscriptionDomainRequest;\n-import org.apache.stratos.rest.endpoint.bean.autoscaler.partition.Partition;\n import org.apache.stratos.rest.endpoint.bean.autoscaler.policy.autoscale.AutoscalePolicy;\n import org.apache.stratos.rest.endpoint.bean.autoscaler.policy.deployment.DeploymentPolicy;\n import org.apache.stratos.rest.endpoint.bean.cartridge.definition.CartridgeDefinitionBean;\n@@ -320,11 +319,21 @@ public Response undeployServiceGroupDefinition(@PathParam(\"groupDefinitionName\")\n     public Response deployDeploymentPolicyDefinition(DeploymentPolicy deploymentPolicy)\n             throws RestAPIException {\n \n-        StratosApiV41Utils.deployDeploymentPolicy(deploymentPolicy);\n-        URI url = uriInfo.getAbsolutePathBuilder().path(deploymentPolicy.id).build();\n+        String policyId = StratosApiV41Utils.deployDeploymentPolicy(deploymentPolicy);\n+        URI url = uriInfo.getAbsolutePathBuilder().path(policyId).build();\n         return Response.created(url).build();\n     }\n \n+    @DELETE\n+    @Path(\"/deploymentPolicies/{applicationId}\")\n+    @Produces(\"application/json\")\n+    @Consumes(\"application/json\")\n+    @AuthorizationAction(\"/permission/admin/manage/add/cartridgeDefinition\")\n+    public Response unDeployApplication(@PathParam(\"applicationId\") String applicationId) throws RestAPIException {\n+        StratosApiV41Utils.undeployApplication(applicationId);\n+        return Response.noContent().build();\n+    }\n+\n     @PUT\n     @Path(\"/deploymentPolicies\")\n     @Produces(\"application/json\")\n@@ -500,9 +509,9 @@ public Response deployApplicationDefinition(ApplicationDefinition applicationDef\n     @Consumes(\"application/json\")\n     @AuthorizationAction(\"/permission/protected/manage/monitor/tenants\")\n     @SuperTenantService(true)\n-    public Response unDeployApplicationDefinition(@PathParam(\"applicationId\") String applicationId)\n+    public Response removeApplicationDefinition(@PathParam(\"applicationId\") String applicationId)\n             throws RestAPIException {\n-        StratosApiV41Utils.unDeployApplication(applicationId, getConfigContext(), getUsername(),\n+        StratosApiV41Utils.removeApplication(applicationId, getConfigContext(), getUsername(),\n                 getTenantDomain());\n         return Response.noContent().build();\n     }",
                "deletions": 5
            },
            {
                "sha": "08ef896bd1ecf8790d789a763a1fe675680ce897",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java",
                "status": "modified",
                "changes": 83,
                "additions": 50,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -23,20 +23,14 @@\n import org.apache.commons.lang.StringUtils;\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n+import org.apache.stratos.autoscaler.stub.Properties;\n import org.apache.stratos.autoscaler.stub.pojo.ApplicationContext;\n import org.apache.stratos.autoscaler.stub.*;\n import org.apache.stratos.autoscaler.stub.deployment.policy.DeploymentPolicy;\n import org.apache.stratos.autoscaler.stub.exception.InvalidKubernetesGroupException;\n+import org.apache.stratos.cloud.controller.stub.*;\n import org.apache.stratos.cloud.controller.stub.domain.CartridgeConfig;\n import org.apache.stratos.cloud.controller.stub.domain.CartridgeInfo;\n-import org.apache.stratos.cloud.controller.stub.CloudControllerServiceInvalidCartridgeTypeExceptionException;\n-import org.apache.stratos.cloud.controller.stub.CloudControllerServiceInvalidKubernetesGroupExceptionException;\n-import org.apache.stratos.cloud.controller.stub.CloudControllerServiceInvalidKubernetesHostExceptionException;\n-import org.apache.stratos.cloud.controller.stub.CloudControllerServiceInvalidKubernetesMasterExceptionException;\n-import org.apache.stratos.cloud.controller.stub.CloudControllerServiceNonExistingKubernetesGroupExceptionException;\n-import org.apache.stratos.cloud.controller.stub.CloudControllerServiceNonExistingKubernetesHostExceptionException;\n-import org.apache.stratos.cloud.controller.stub.CloudControllerServiceNonExistingKubernetesMasterExceptionException;\n-import org.apache.stratos.cloud.controller.stub.CloudControllerServiceUnregisteredCartridgeExceptionException;\n import org.apache.stratos.common.Property;\n import org.apache.stratos.manager.client.AutoscalerServiceClient;\n import org.apache.stratos.manager.client.CloudControllerServiceClient;\n@@ -207,8 +201,8 @@ static ApplicationSubscription getApplicationSubscriptions(String appId, Configu\n         }\n     }\n \n-    public static void unDeployApplication(String appId, ConfigurationContext ctxt,\n-                                           String userName, String tenantDomain) throws RestAPIException {\n+    public static void removeApplication(String appId, ConfigurationContext ctxt,\n+                                         String userName, String tenantDomain) throws RestAPIException {\n \n         try {\n             int tenantId = ApplicationManagementUtil.getTenantId(ctxt);\n@@ -243,6 +237,20 @@ public static void unDeployApplication(String appId, ConfigurationContext ctxt,\n         return commonPolicies.toArray(new DeploymentPolicy[0]);\n     }\n \n+    public static void undeployApplication(String applicationId) throws RestAPIException {\n+        AutoscalerServiceClient autoscalerServiceClient = getAutoscalerServiceClient();\n+        if (autoscalerServiceClient != null) {\n+            try {\n+                autoscalerServiceClient.unDeployDeploymentPolicy(applicationId);\n+            } catch (RemoteException e) {\n+                log.error(\"Error while unDeploying the Deployment Policy for  \" + applicationId);\n+                throw new RestAPIException(e);\n+            }\n+        }\n+\n+\n+    }\n+\n     public static void undeployCartridge(String cartridgeType) throws RestAPIException {\n \n         CloudControllerServiceClient cloudControllerServiceClient = getCloudControllerServiceClient();\n@@ -394,11 +402,16 @@ public static void updateAutoscalingPolicy(AutoscalePolicy autoscalePolicyBean)\n         }\n     }\n \n-    public static void deployDeploymentPolicy(\n+    public static String deployDeploymentPolicy(\n             org.apache.stratos.rest.endpoint.bean.autoscaler.policy.deployment.DeploymentPolicy deploymentPolicyBean)\n             throws RestAPIException {\n \n-        log.info(String.format(\"Deploying deployment policy: [id] %s\", deploymentPolicyBean.id));\n+        String policyId = null;\n+\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Starting to deploy a deployment policy of application: \"\n+                    + deploymentPolicyBean.applicationPolicy.applicationId);\n+        }\n \n         AutoscalerServiceClient autoscalerServiceClient = getAutoscalerServiceClient();\n         if (autoscalerServiceClient != null) {\n@@ -407,7 +420,7 @@ public static void deployDeploymentPolicy(\n                     PojoConverter.convetToASDeploymentPolicyPojo(deploymentPolicyBean);\n \n             try {\n-                autoscalerServiceClient.deployDeploymentPolicy(deploymentPolicy);\n+                policyId = autoscalerServiceClient.deployDeploymentPolicy(deploymentPolicy);\n             } catch (RemoteException e) {\n                 log.error(e.getMessage(), e);\n                 throw new RestAPIException(e.getMessage(), e);\n@@ -417,33 +430,37 @@ public static void deployDeploymentPolicy(\n                 throw new RestAPIException(message, e);\n             }\n \n+            log.info(String.format(\"Deployed deployment policy: [id] %s\", policyId));\n         }\n+        \n+        return policyId;\n     }\n \n     public static void updateDeploymentPolicy(\n             org.apache.stratos.rest.endpoint.bean.autoscaler.policy.deployment.DeploymentPolicy deploymentPolicyBean)\n             throws RestAPIException {\n \n-        log.info(String.format(\"Updating deployment policy: [id] %s\", deploymentPolicyBean.id));\n-\n-        AutoscalerServiceClient autoscalerServiceClient = getAutoscalerServiceClient();\n-        if (autoscalerServiceClient != null) {\n-\n-            org.apache.stratos.autoscaler.stub.deployment.policy.DeploymentPolicy deploymentPolicy =\n-                    PojoConverter.convetToASDeploymentPolicyPojo(deploymentPolicyBean);\n-\n-\n-            try {\n-                autoscalerServiceClient.updateDeploymentPolicy(deploymentPolicy);\n-            } catch (RemoteException e) {\n-                log.error(e.getMessage(), e);\n-                throw new RestAPIException(e.getMessage(), e);\n-            } catch (AutoScalerServiceInvalidPolicyExceptionException e) {\n-                String message = e.getFaultMessage().getInvalidPolicyException().getMessage();\n-                log.error(message, e);\n-                throw new RestAPIException(message, e);\n-            }\n-        }\n+        //FIXME we do not have any use-case now?? - Nirmal\n+//        log.info(String.format(\"Updating deployment policy: [id] %s\", deploymentPolicyBean.id));\n+//\n+//        AutoscalerServiceClient autoscalerServiceClient = getAutoscalerServiceClient();\n+//        if (autoscalerServiceClient != null) {\n+//\n+//            org.apache.stratos.autoscaler.stub.deployment.policy.DeploymentPolicy deploymentPolicy =\n+//                    PojoConverter.convetToASDeploymentPolicyPojo(deploymentPolicyBean);\n+//\n+//\n+//            try {\n+//                autoscalerServiceClient.updateDeploymentPolicy(deploymentPolicy);\n+//            } catch (RemoteException e) {\n+//                log.error(e.getMessage(), e);\n+//                throw new RestAPIException(e.getMessage(), e);\n+//            } catch (AutoScalerServiceInvalidPolicyExceptionException e) {\n+//                String message = e.getFaultMessage().getInvalidPolicyException().getMessage();\n+//                log.error(message, e);\n+//                throw new RestAPIException(message, e);\n+//            }\n+//        }\n     }\n \n     private static CloudControllerServiceClient getCloudControllerServiceClient() throws RestAPIException {",
                "deletions": 33
            },
            {
                "sha": "9b5c70f61a0fb13c1c18dba3abeeae7022176530",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/autoscaler/policy/deployment/DeploymentPolicy.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/autoscaler/policy/deployment/DeploymentPolicy.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/autoscaler/policy/deployment/DeploymentPolicy.java",
                "status": "modified",
                "changes": 2,
                "additions": 0,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/autoscaler/policy/deployment/DeploymentPolicy.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -29,8 +29,6 @@\n @XmlRootElement\n public class DeploymentPolicy {\n \n-    public String id;\n-    \n     public String description;\n     \n     public boolean isPublic;",
                "deletions": 2
            },
            {
                "sha": "e6df7e1d810a25c2dcab12a121071ea8ea4fba30",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/cartridge/definition/FloatingNetworkBean.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/cartridge/definition/FloatingNetworkBean.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/cartridge/definition/FloatingNetworkBean.java",
                "status": "added",
                "changes": 51,
                "additions": 51,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/cartridge/definition/FloatingNetworkBean.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -0,0 +1,51 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.stratos.rest.endpoint.bean.cartridge.definition;\n+\n+import javax.xml.bind.annotation.XmlRootElement;\n+\n+/**\n+ * @author rajkumar\n+ */\n+@XmlRootElement (name = \"floatingNetworks\")\n+public class FloatingNetworkBean {\n+\tpublic String name;\n+\tpublic String networkUuid;\n+\tpublic String floatingIP;\n+\t\n+    public String toString () {\n+    \tStringBuilder sb = new StringBuilder('{');\n+    \tString delimeter = \"\";\n+    \tif (name != null) {\n+    \t\tsb.append(delimeter).append(\"name : \").append(name);\n+    \t\tdelimeter = \", \";\n+    \t}\n+    \tif (networkUuid != null) {\n+    \t\tsb.append(delimeter).append(\"networkUuid : \").append(networkUuid);\n+    \t\tdelimeter = \", \";\n+    \t}\n+    \tif (floatingIP != null) {\n+    \t\tsb.append(delimeter).append(\"floatingIP : \").append(floatingIP);\n+    \t\tdelimeter = \", \";\n+    \t}\n+    \tsb.append('}');\n+        return sb.toString();\n+    }\n+}\n\\ No newline at end of file",
                "deletions": 0
            },
            {
                "sha": "707e7fe5a178d4b9b050c9ab239dc9d86eb98540",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/cartridge/definition/NetworkInterfaceBean.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/cartridge/definition/NetworkInterfaceBean.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/cartridge/definition/NetworkInterfaceBean.java",
                "status": "modified",
                "changes": 21,
                "additions": 21,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/cartridge/definition/NetworkInterfaceBean.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -19,13 +19,16 @@\n \n package org.apache.stratos.rest.endpoint.bean.cartridge.definition;\n \n+import java.util.List;\n+\n import javax.xml.bind.annotation.XmlRootElement;\n \n @XmlRootElement (name = \"networkInterfaces\")\n public class NetworkInterfaceBean {\n \tpublic String networkUuid;\n \tpublic String fixedIp;\n \tpublic String portUuid;\n+\tpublic List<FloatingNetworkBean> floatingNetworks;\n     public String toString () {\n     \tStringBuilder sb = new StringBuilder('{');\n     \tString delimeter = \"\";\n@@ -41,7 +44,25 @@ public String toString () {\n     \t\tsb.append(delimeter).append(\"portUuid : \").append(portUuid);\n     \t\tdelimeter = \", \";\n     \t}\n+    \tif (floatingNetworks != null) {\n+    \tsb.append(delimeter).append(\"floatingNetworks : \").append(getFloatingNetworks());\n+    \tdelimeter = \", \";\n+    \t}\n     \tsb.append('}');\n         return sb.toString();\n     }\n+    \n+    private String getFloatingNetworks() {\n+    \tStringBuilder sb = new StringBuilder();\n+    \tif (floatingNetworks != null) {\n+    \t\tsb.append('[');\n+    \t\tString delimeter = \"\";\n+    \t\tfor (FloatingNetworkBean floatingNetworkBean:floatingNetworks) {\n+    \t\t\tsb.append(delimeter).append(floatingNetworkBean);\n+    \t\t\tdelimeter = \", \";\n+    \t\t}\n+    \t\tsb.append(']');\n+    \t}\n+    \treturn sb.toString();\n+    }\n }\n\\ No newline at end of file",
                "deletions": 0
            },
            {
                "sha": "128a33ecffa80cd310cc22d5439c021da3773d80",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/util/converter/PojoConverter.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/util/converter/PojoConverter.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/util/converter/PojoConverter.java",
                "status": "modified",
                "changes": 28,
                "additions": 24,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/util/converter/PojoConverter.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -293,13 +293,35 @@ private static NetworkInterfaces getNetworkInterfaces(List<NetworkInterfaceBean>\n             networkInterface.setNetworkUuid(nib.networkUuid);\n             networkInterface.setFixedIp(nib.fixedIp);\n             networkInterface.setPortUuid(nib.portUuid);\n+            if (nib.floatingNetworks != null && !nib.floatingNetworks.isEmpty()) {\n+            \tnetworkInterface.setFloatingNetworks(PojoConverter.getFloatingNetworks(nib.floatingNetworks));\n+            }\n+\n             networkInterfacesArray[i++] = networkInterface;\n         }\n \n         NetworkInterfaces networkInterfaces = new NetworkInterfaces();\n         networkInterfaces.setNetworkInterfaces(networkInterfacesArray);\n         return networkInterfaces;\n     }\n+    \n+    private static FloatingNetworks getFloatingNetworks(List<FloatingNetworkBean> floatingNetworkBeans) {\n+    \t\n+    \tFloatingNetwork[] floatingNetworksArray = new FloatingNetwork[floatingNetworkBeans.size()];\n+    \t\n+    \tint i =0;\n+    \tfor (FloatingNetworkBean floatingNetworkBean : floatingNetworkBeans) {\n+    \tFloatingNetwork floatingNetwork = new FloatingNetwork();\n+    \tfloatingNetwork.setName(floatingNetworkBean.name);\n+    \tfloatingNetwork.setNetworkUuid(floatingNetworkBean.networkUuid);\n+    \tfloatingNetwork.setFloatingIP(floatingNetworkBean.floatingIP);\n+    \tfloatingNetworksArray[i++] = floatingNetwork;\n+    \t}\n+    \t\n+    \tFloatingNetworks floatingNetworks = new FloatingNetworks();\n+    \tfloatingNetworks.setFloatingNetworks(floatingNetworksArray);\n+    \treturn floatingNetworks;\n+    \t}\n \n     public static org.apache.stratos.autoscaler.stub.deployment.partition.Partition convertToCCPartitionPojo\n             (Partition partitionBean) {\n@@ -380,7 +402,6 @@ private static NetworkInterfaces getNetworkInterfaces(List<NetworkInterfaceBean>\n         org.apache.stratos.autoscaler.stub.deployment.policy.DeploymentPolicy deploymentPolicy =\n                 new org.apache.stratos.autoscaler.stub.deployment.policy.DeploymentPolicy();\n \n-        deploymentPolicy.setId(deploymentPolicyBean.id);\n         deploymentPolicy.setDescription(deploymentPolicyBean.description);\n         deploymentPolicy.setIsPublic(deploymentPolicyBean.isPublic);\n         if (deploymentPolicyBean.applicationPolicy != null\n@@ -463,7 +484,7 @@ private static NetworkInterfaces getNetworkInterfaces(List<NetworkInterfaceBean>\n         cluster1.property = getPropertyBeans(cluster.getProperties());\n         cluster1.member = new ArrayList<Member>();\n         cluster1.hostNames = new ArrayList<String>();\n-        cluster1.status = cluster.getStatus(null).toString();\n+        cluster1.status = cluster.getStatus(null).toString(); //TODO why null is passed?\n \n         for (org.apache.stratos.messaging.domain.topology.Member tmp : cluster.getMembers()) {\n             Member member = new Member();\n@@ -726,7 +747,6 @@ public static DeploymentPolicy populateDeploymentPolicyPojo(org.apache.stratos.a\n             return deploymentPolicyBean;\n         }\n \n-        deploymentPolicyBean.id = deploymentPolicy.getId();\n         deploymentPolicyBean.description = deploymentPolicy.getDescription();\n         deploymentPolicyBean.isPublic = deploymentPolicy.getIsPublic();\n //TODO populate the Network partition based on new policy structure\n@@ -1199,7 +1219,7 @@ public static GroupBean toGroupBean(Group group) {\n         }\n \n         GroupBean groupBean = new GroupBean();\n-        groupBean.setStatus(group.getStatus(null).toString());\n+        groupBean.setStatus(group.getStatus(null).toString()); // TODO -- why null is passed?\n         groupBean.setAlias(group.getUniqueIdentifier());\n         //TODO*******groupBean.setDeploymentPolicy(group.getDeploymentPolicy());\n         groupBean.setAutoScalingPolicy(group.getAutoscalingPolicy());",
                "deletions": 4
            },
            {
                "sha": "727037130bbaa150f9bc08e67a310b71534405e7",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/mock/MockContext.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/mock/MockContext.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/mock/MockContext.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/mock/MockContext.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -570,7 +570,7 @@ public StratosApiResponse addDeploymentPolicyDefinition(DeploymentPolicy deploym\n     \t\t}\n     \t}\n     \t\n-    \tpolicies.put(deploymentPolicy.id,deploymentPolicy);\n+    \tpolicies.put(deploymentPolicy.applicationPolicy.applicationId+UUID.randomUUID().getLeastSignificantBits(),deploymentPolicy);\n         StratosApiResponse stratosApiResponse = new StratosApiResponse();\n         stratosApiResponse.setMessage(\"Successfully deployed deployment policy definition\");\n         return stratosApiResponse;",
                "deletions": 1
            },
            {
                "sha": "46bed0893845a4cd1976dfde3f357e527b0e83ec",
                "filename": "dependencies/pom.xml",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/dependencies/pom.xml",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/dependencies/pom.xml",
                "status": "modified",
                "changes": 9,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/dependencies/pom.xml?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -33,11 +33,10 @@\n     <url>http://apache.org</url>\n \n     <modules>\n-        <module>jclouds/apis/vcloud/1.8.0-stratos</module>\n-        <module>jclouds/apis/ec2/1.8.0-stratos</module>\n-        <module>jclouds/apis/openstack-nova/1.8.0-stratos</module>\n-        <module>jclouds/apis/gce/1.8.0-stratos</module>\n-        <module>jclouds/provider/aws-ec2/1.8.0-stratos</module>\n+        <module>jclouds/apis/vcloud/1.8.1-stratos</module>\n+\t<module>jclouds/apis/openstack-neutron/1.8.1-stratos</module>\n+        <module>jclouds/apis/gce/1.8.1-stratos</module>\n+        <module>jclouds/provider/aws-ec2/1.8.1-stratos</module>\n         <module>org.wso2.carbon.ui</module>\n     </modules>\n </project>",
                "deletions": 5
            },
            {
                "sha": "e8cd8f63fc21de28eaf47018f974c2b96763d9c1",
                "filename": "extensions/cep/artifacts/executionplans/AverageInFlightRequestsFinder.xml",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/extensions/cep/artifacts/executionplans/AverageInFlightRequestsFinder.xml",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/extensions/cep/artifacts/executionplans/AverageInFlightRequestsFinder.xml",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/extensions/cep/artifacts/executionplans/AverageInFlightRequestsFinder.xml?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -45,7 +45,7 @@\n         \tstratos:divider(served_count , instances_count) as requests_per_instance\n         \tinsert into served_requests_per_instance;\n         from served_requests_per_instance[requests_per_instance>0]#window.timeBatch(10 min)\n-\t\tselect cluster_id,network_partition_id, avg(requests_per_instance) as average_served_count\n+\t\tselect cluster_id, instance_id, network_partition_id, avg(requests_per_instance) as average_served_count\n \t\tinsert into average_served_request_count;]]></queryExpressions>\n   <exportedStreams>\n     <stream name=\"average_in_flight_requests\"",
                "deletions": 1
            },
            {
                "sha": "e384d9564a59086bb1e1f3fae0e0191bb387f0ce",
                "filename": "extensions/cep/stratos-cep-extension/src/main/java/org/apache/stratos/cep/extension/CEPTopologyEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/extensions/cep/stratos-cep-extension/src/main/java/org/apache/stratos/cep/extension/CEPTopologyEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/extensions/cep/stratos-cep-extension/src/main/java/org/apache/stratos/cep/extension/CEPTopologyEventReceiver.java",
                "status": "modified",
                "changes": 16,
                "additions": 14,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/extensions/cep/stratos-cep-extension/src/main/java/org/apache/stratos/cep/extension/CEPTopologyEventReceiver.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -31,6 +31,8 @@\n import org.apache.stratos.messaging.message.receiver.topology.TopologyEventReceiver;\n import org.apache.stratos.messaging.message.receiver.topology.TopologyManager;\n \n+import java.util.concurrent.ExecutorService;\n+\n /**\n  * CEP Topology Receiver for Fault Handling Window Processor.\n  */\n@@ -41,6 +43,7 @@\n     private TopologyEventReceiver topologyEventReceiver;\n     private boolean terminated;\n     private FaultHandlingWindowProcessor faultHandler;\n+\tprivate ExecutorService executorService;\n \n     public CEPTopologyEventReceiver(FaultHandlingWindowProcessor faultHandler) {\n         this.topologyEventReceiver = new TopologyEventReceiver();\n@@ -101,8 +104,9 @@ public void run() {\n             Thread.sleep(15000);\n         } catch (InterruptedException ignore) {\n         }\n-        Thread thread = new Thread(topologyEventReceiver);\n-        thread.start();\n+        topologyEventReceiver.setExecutorService(executorService);\n+\t    topologyEventReceiver.execute();\n+\t //   executorService.execute(topologyEventReceiver);\n         log.info(\"CEP topology receiver thread started\");\n \n         // Keep the thread live until terminated\n@@ -122,4 +126,12 @@ public void terminate() {\n         topologyEventReceiver.terminate();\n         terminated = true;\n     }\n+\n+\tpublic ExecutorService getExecutorService() {\n+\t\treturn executorService;\n+\t}\n+\n+\tpublic void setExecutorService(ExecutorService executorService) {\n+\t\tthis.executorService = executorService;\n+\t}\n }",
                "deletions": 2
            },
            {
                "sha": "8bfcb2c094e171274469f36921053605e6b263da",
                "filename": "extensions/cep/stratos-cep-extension/src/main/java/org/apache/stratos/cep/extension/FaultHandlingWindowProcessor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/extensions/cep/stratos-cep-extension/src/main/java/org/apache/stratos/cep/extension/FaultHandlingWindowProcessor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/extensions/cep/stratos-cep-extension/src/main/java/org/apache/stratos/cep/extension/FaultHandlingWindowProcessor.java",
                "status": "modified",
                "changes": 98,
                "additions": 52,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/extensions/cep/stratos-cep-extension/src/main/java/org/apache/stratos/cep/extension/FaultHandlingWindowProcessor.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -20,6 +20,7 @@\n \n import org.apache.commons.lang3.StringUtils;\n import org.apache.log4j.Logger;\n+import org.apache.stratos.common.threading.StratosThreadPool;\n import org.apache.stratos.messaging.broker.publish.EventPublisher;\n import org.apache.stratos.messaging.broker.publish.EventPublisherPool;\n import org.apache.stratos.messaging.domain.topology.*;\n@@ -46,6 +47,7 @@\n \n import java.util.*;\n import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ExecutorService;\n import java.util.concurrent.ScheduledExecutorService;\n import java.util.concurrent.TimeUnit;\n \n@@ -56,50 +58,52 @@\n @SiddhiExtension(namespace = \"stratos\", function = \"faultHandling\")\n public class FaultHandlingWindowProcessor extends WindowProcessor implements RunnableWindowProcessor {\n \n-    private static final int TIME_OUT = 60 * 1000;\n-    static final Logger log = Logger.getLogger(FaultHandlingWindowProcessor.class);\n-    private ScheduledExecutorService faultHandleScheduler;\n-    private ThreadBarrier threadBarrier;\n-    private long timeToKeep;\n-    private ISchedulerSiddhiQueue<StreamEvent> window;\n-    private EventPublisher healthStatPublisher = EventPublisherPool.getPublisher(Util.Topics.HEALTH_STAT_TOPIC.getTopicName());\n-    private Map<String, Object> MemberFaultEventMap = new HashMap<String, Object>();\n-    private Map<String, Object> memberFaultEventMessageMap = new HashMap<String, Object>();\n-\n-    // Map of member id's to their last received health event time stamp\n-    private ConcurrentHashMap<String, Long> memberTimeStampMap = new ConcurrentHashMap<String, Long>();\n-\n-    // Event receiver to receive topology events published by cloud-controller\n-    private CEPTopologyEventReceiver cepTopologyEventReceiver = new CEPTopologyEventReceiver(this);\n-\n-    // Stratos member id attribute index in stream execution plan\n-    private int memberIdAttrIndex;\n-\n-    @Override\n-    protected void processEvent(InEvent event) {\n-        addDataToMap(event);\n-    }\n-\n-    @Override\n-    protected void processEvent(InListEvent listEvent) {\n-        for (int i = 0, size = listEvent.getActiveEvents(); i < size; i++) {\n-            addDataToMap((InEvent) listEvent.getEvent(i));\n-        }\n-    }\n-\n-    /**\n-     * Add new entry to time stamp map from the received event.\n-     *\n-     * @param event Event received by Siddhi.\n-     */\n-    protected void addDataToMap(InEvent event) {\n-        String id = (String) event.getData()[memberIdAttrIndex];\n-        //checking whether this member is the topology.\n-        //sometimes there can be a delay between publishing member terminated events\n-        //and actually terminating instances. Hence CEP might get events for already terminated members\n-        //so we are checking the topology for the member existence\n-        Member member = getMemberFromId(id);\n-        if (null == member) {\n+\tprivate static final int TIME_OUT = 60 * 1000;\n+\tstatic final Logger log = Logger.getLogger(FaultHandlingWindowProcessor.class);\n+\tpublic static final String IDENTIFIER = \"AutoScaler\";\n+\tprivate ScheduledExecutorService faultHandleScheduler;\n+\tprivate ThreadBarrier threadBarrier;\n+\tprivate long timeToKeep;\n+\tprivate ISchedulerSiddhiQueue<StreamEvent> window;\n+\tprivate EventPublisher healthStatPublisher =\n+\t\t\tEventPublisherPool.getPublisher(Util.Topics.HEALTH_STAT_TOPIC.getTopicName());\n+\tprivate Map<String, Object> MemberFaultEventMap = new HashMap<String, Object>();\n+\tprivate Map<String, Object> memberFaultEventMessageMap = new HashMap<String, Object>();\n+\n+\t// Map of member id's to their last received health event time stamp\n+\tprivate ConcurrentHashMap<String, Long> memberTimeStampMap = new ConcurrentHashMap<String, Long>();\n+\n+\t// Event receiver to receive topology events published by cloud-controller\n+\tprivate CEPTopologyEventReceiver cepTopologyEventReceiver = new CEPTopologyEventReceiver(this);\n+\n+\t// Stratos member id attribute index in stream execution plan\n+\tprivate int memberIdAttrIndex;\n+\n+\t@Override\n+\tprotected void processEvent(InEvent event) {\n+\t\taddDataToMap(event);\n+\t}\n+\n+\t@Override\n+\tprotected void processEvent(InListEvent listEvent) {\n+\t\tfor (int i = 0, size = listEvent.getActiveEvents(); i < size; i++) {\n+\t\t\taddDataToMap((InEvent) listEvent.getEvent(i));\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Add new entry to time stamp map from the received event.\n+\t *\n+\t * @param event Event received by Siddhi.\n+\t */\n+\tprotected void addDataToMap(InEvent event) {\n+\t\tString id = (String) event.getData()[memberIdAttrIndex];\n+\t\t//checking whether this member is the topology.\n+\t\t//sometimes there can be a delay between publishing member terminated events\n+\t\t//and actually terminating instances. Hence CEP might get events for already terminated members\n+\t\t//so we are checking the topology for the member existence\n+\t\tMember member = getMemberFromId(id);\n+\t\tif (null == member) {\n \t\t\tlog.debug(\"Member not found in the toplogy. Event rejected\");\n \t\t\treturn;\n \t\t}\n@@ -255,6 +259,7 @@ protected void restoreState(Object[] data) {\n     @Override\n     protected void init(Expression[] parameters, QueryPostProcessingElement nextProcessor,\n                         AbstractDefinition streamDefinition, String elementId, boolean async, SiddhiContext siddhiContext) {\n+\n         if (parameters[0] instanceof IntConstant) {\n             timeToKeep = ((IntConstant) parameters[0]).getValue();\n         } else {\n@@ -271,8 +276,9 @@ protected void init(Expression[] parameters, QueryPostProcessingElement nextProc\n         }\n         MemberFaultEventMap.put(\"org.apache.stratos.messaging.event.health.stat.MemberFaultEvent\", memberFaultEventMessageMap);\n \n-        Thread topologyTopicSubscriberThread = new Thread(cepTopologyEventReceiver);\n-        topologyTopicSubscriberThread.start();\n+\t    ExecutorService executorService= StratosThreadPool.getExecutorService(\"AutoScaler\",10);\n+\t    cepTopologyEventReceiver.setExecutorService(executorService);\n+\t    executorService.execute(cepTopologyEventReceiver);\n \n         //Ordinary scheduling\n         window.schedule();",
                "deletions": 46
            },
            {
                "sha": "7996672031549268e84d6700a0dcb015330fdbf2",
                "filename": "extensions/load-balancer/haproxy-extension/src/main/java/org/apache/stratos/haproxy/extension/Main.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/extensions/load-balancer/haproxy-extension/src/main/java/org/apache/stratos/haproxy/extension/Main.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/extensions/load-balancer/haproxy-extension/src/main/java/org/apache/stratos/haproxy/extension/Main.java",
                "status": "modified",
                "changes": 54,
                "additions": 30,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/extensions/load-balancer/haproxy-extension/src/main/java/org/apache/stratos/haproxy/extension/Main.java?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -22,37 +22,43 @@\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.log4j.PropertyConfigurator;\n+import org.apache.stratos.common.threading.StratosThreadPool;\n import org.apache.stratos.load.balancer.extension.api.LoadBalancerExtension;\n \n+import java.util.concurrent.ExecutorService;\n+\n /**\n  * HAProxy extension main class.\n  */\n public class Main {\n-    private static final Log log = LogFactory.getLog(Main.class);\n-\n-    public static void main(String[] args) {\n+\tprivate static final Log log = LogFactory.getLog(Main.class);\n+\tprivate static ExecutorService executorService;\n \n-        LoadBalancerExtension extension = null;\n-        try {\n-            // Configure log4j properties\n-            PropertyConfigurator.configure(System.getProperty(\"log4j.properties.file.path\"));\n+\tpublic static void main(String[] args) {\n \n-            if (log.isInfoEnabled()) {\n-                log.info(\"HAProxy extension started\");\n-            }\n+\t\tLoadBalancerExtension extension = null;\n+\t\ttry {\n+\t\t\t// Configure log4j properties\n+\t\t\tPropertyConfigurator.configure(System.getProperty(\"log4j.properties.file.path\"));\n \n-            // Validate runtime parameters\n-            HAProxyContext.getInstance().validate();\n-            extension = new LoadBalancerExtension(new HAProxy(), (HAProxyContext.getInstance().isCEPStatsPublisherEnabled() ? new HAProxyStatisticsReader() : null));\n-            Thread thread = new Thread(extension);\n-            thread.start();\n-        } catch (Exception e) {\n-            if (log.isErrorEnabled()) {\n-                log.error(e);\n-            }\n-            if (extension != null) {\n-                extension.terminate();\n-            }\n-        }\n-    }\n+\t\t\tif (log.isInfoEnabled()) {\n+\t\t\t\tlog.info(\"HAProxy extension started\");\n+\t\t\t}\n+\t\t\texecutorService = StratosThreadPool.getExecutorService(\"Load_Balance_Extension\", 10);\n+\t\t\t// Validate runtime parameters\n+\t\t\tHAProxyContext.getInstance().validate();\n+\t\t\textension = new LoadBalancerExtension(new HAProxy(),\n+\t\t\t                                      (HAProxyContext.getInstance().isCEPStatsPublisherEnabled() ?\n+\t\t\t                                       new HAProxyStatisticsReader() : null));\n+\t\t\tThread thread = new Thread(extension);\n+\t\t\tthread.start();\n+\t\t} catch (Exception e) {\n+\t\t\tif (log.isErrorEnabled()) {\n+\t\t\t\tlog.error(e);\n+\t\t\t}\n+\t\t\tif (extension != null) {\n+\t\t\t\textension.terminate();\n+\t\t\t}\n+\t\t}\n+\t}\n }",
                "deletions": 24
            },
            {
                "sha": "c12fcfa5b2dd08d2f71c84ac6465258adb44c26b",
                "filename": "features/cloud-controller/org.apache.stratos.cloud.controller.feature/pom.xml",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/features/cloud-controller/org.apache.stratos.cloud.controller.feature/pom.xml",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/features/cloud-controller/org.apache.stratos.cloud.controller.feature/pom.xml",
                "status": "modified",
                "changes": 23,
                "additions": 12,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/features/cloud-controller/org.apache.stratos.cloud.controller.feature/pom.xml?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -120,19 +120,19 @@\n             <version>${jclouds.version}</version>\n         </dependency>\n         <dependency>\n-            <groupId>org.apache.stratos</groupId>\n+            <groupId>org.apache.jclouds.api</groupId>\n             <artifactId>ec2</artifactId>\n-            <version>1.8.0-stratos</version>\n+            <version>${jclouds.version}</version>\n         </dependency>\n         <dependency>\n             <groupId>org.apache.stratos</groupId>\n             <artifactId>aws-ec2</artifactId>\n-            <version>1.8.0-stratos</version>\n+            <version>${jclouds.stratos.version}</version>\n         </dependency>\n         <dependency>\n-            <groupId>org.apache.stratos</groupId>\n+            <groupId>org.apache.jclouds.api</groupId>\n             <artifactId>openstack-nova</artifactId>\n-            <version>1.8.0-stratos</version>\n+            <version>${jclouds.version}</version>\n         </dependency>\n         <dependency>\n             <groupId>org.apache.commons</groupId>\n@@ -163,7 +163,7 @@\n         <dependency>\n             <groupId>org.apache.stratos</groupId>\n             <artifactId>vcloud</artifactId>\n-            <version>1.8.0-stratos</version>\n+            <version>${jclouds.stratos.version}</version>\n         </dependency>\n         <dependency>\n             <groupId>org.apache.stratos</groupId>\n@@ -301,15 +301,16 @@\n                                 <bundleDef>org.apache.jclouds.driver:jclouds-enterprise:${jclouds.version}</bundleDef>\n                                 <bundleDef>org.apache.jclouds:jclouds-core:${jclouds.version}</bundleDef>\n                                 <bundleDef>org.apache.jclouds:jclouds-compute:${jclouds.version}</bundleDef>\n-                                <bundleDef>org.apache.stratos:ec2:1.8.0-stratos</bundleDef>\n-                                <bundleDef>org.apache.stratos:openstack-nova:1.8.0-stratos</bundleDef>\n-                                <bundleDef>org.apache.stratos:vcloud:1.8.0-stratos</bundleDef>\n-                                <bundleDef>org.apache.stratos:gce:1.8.0-stratos</bundleDef>\n+\t\t\t\t<bundleDef>org.apache.jclouds.api:ec2:${jclouds.version}</bundleDef>\n+                                <bundleDef>org.apache.jclouds.api:openstack-nova:${jclouds.version}</bundleDef>\n+                                <bundleDef>org.apache.stratos:openstack-neutron:${jclouds.stratos.version}</bundleDef>\n+                                <bundleDef>org.apache.stratos:vcloud:${jclouds.stratos.version}</bundleDef>\n+                                <bundleDef>org.apache.stratos:gce:${jclouds.stratos.version}</bundleDef>\n+\t\t\t\t<bundleDef>org.apache.stratos:aws-ec2:${jclouds.stratos.version}</bundleDef>\n                                 <bundleDef>org.apache.commons:commons-compress:1.5</bundleDef>\n                                 <bundleDef>com.jamesmurty.utils.wso2:java-xmlbuilder:0.4.wso2v1</bundleDef>\n                                 <bundleDef>org.apache.jclouds.common:openstack-common:${jclouds.version}</bundleDef>\n                                 <bundleDef>org.apache.jclouds.api:openstack-keystone:${jclouds.version}</bundleDef>\n-                                <bundleDef>org.apache.stratos:aws-ec2:1.8.0-stratos</bundleDef>\n                                 <bundleDef>com.google.guava:guava:17.0</bundleDef>\n \t\t\t\t<bundleDef>org.apache.jclouds.api:cloudstack:${jclouds.version}</bundleDef>\n ",
                "deletions": 11
            },
            {
                "sha": "8817d9a2e4726caeac7ce70cd114922ea633dac1",
                "filename": "features/cloud-controller/org.apache.stratos.cloud.controller.feature/src/main/resources/conf/cloud-controller.xml",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/features/cloud-controller/org.apache.stratos.cloud.controller.feature/src/main/resources/conf/cloud-controller.xml",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/features/cloud-controller/org.apache.stratos.cloud.controller.feature/src/main/resources/conf/cloud-controller.xml",
                "status": "modified",
                "changes": 1,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/features/cloud-controller/org.apache.stratos.cloud.controller.feature/src/main/resources/conf/cloud-controller.xml?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -57,6 +57,7 @@\n \t\t\t<property name=\"jclouds.endpoint\" value=\"http://192.168.16.20:5000/\" />\n            \t\t<property name=\"jclouds.openstack-nova.auto-create-floating-ips\" value=\"false\"/>\n \t\t\t<property name=\"jclouds.api-version\" value=\"2.0/\" />\n+\t\t\t<property name=\"openstack.networking.provider\" value=\"nova\" />\n \t\t\t<property name=\"X\" value=\"x\" />\n \t\t\t<property name=\"Y\" value=\"y\" />\n \t\t</iaasProvider -->",
                "deletions": 0
            },
            {
                "sha": "5375adaadd54f07b7e373493331805bd4ff35968",
                "filename": "pom.xml",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/pom.xml",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/pom.xml",
                "status": "modified",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/pom.xml?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -546,7 +546,7 @@\n         <carbon.platform.package.import.version.range>[4.2.0, 5.0.0)</carbon.platform.package.import.version.range>\n         <carbon.platform.package.export.version>4.2.0</carbon.platform.package.export.version>\n         <axis2.osgi.version>1.6.1.wso2v10</axis2.osgi.version>\n-        <jclouds.version>1.8.0</jclouds.version>\n-        <jclouds.stratos.version>1.8.0-stratos</jclouds.stratos.version>\n+        <jclouds.version>1.8.1</jclouds.version>\n+        <jclouds.stratos.version>1.8.1-stratos</jclouds.stratos.version>\n     </properties>\n </project>",
                "deletions": 2
            },
            {
                "sha": "47b84ce54e3b1e4183d40eaf0fefb467ff9ecd28",
                "filename": "products/stratos/conf/stratos-config.xml",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/conf/stratos-config.xml",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/conf/stratos-config.xml",
                "status": "added",
                "changes": 30,
                "additions": 30,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/products/stratos/conf/stratos-config.xml?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -0,0 +1,30 @@\n+<!--\n+  ~ /*\n+  ~  * Licensed to the Apache Software Foundation (ASF) under one\n+  ~  * or more contributor license agreements. See the NOTICE file\n+  ~  * distributed with this work for additional information\n+  ~  * regarding copyright ownership. The ASF licenses this file\n+  ~  * to you under the Apache License, Version 2.0 (the\n+  ~  * \"License\"); you may not use this file except in compliance\n+  ~  * with the License. You may obtain a copy of the License at\n+  ~  *\n+  ~  * http://www.apache.org/licenses/LICENSE-2.0\n+  ~  *\n+  ~  * Unless required by applicable law or agreed to in writing,\n+  ~  * software distributed under the License is distributed on an\n+  ~  * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+  ~  * KIND, either express or implied. See the License for the\n+  ~  * specific language governing permissions and limitations\n+  ~  * under the License.\n+  ~  */\n+  -->\n+<configuration>\n+    <threadPool>\n+        <autoscaler>\n+            <identifier>Autoscaler</identifier>\n+            <threadPoolSize>10</threadPoolSize>\n+        </autoscaler>\n+    </threadPool>\n+</configuration>\n+\n+",
                "deletions": 0
            },
            {
                "sha": "26bc3dc0bfcefe3e5ae7210c52a8b54ba9ef2f02",
                "filename": "products/stratos/modules/distribution/src/assembly/bin.xml",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/assembly/bin.xml",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/assembly/bin.xml",
                "status": "modified",
                "changes": 6,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/products/stratos/modules/distribution/src/assembly/bin.xml?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -687,6 +687,12 @@\n             <filtered>true</filtered>\r\n             <fileMode>755</fileMode>\r\n         </file>\r\n+        <file>\r\n+            <source>src/main/conf/drools/dependent-scaling.drl</source>\r\n+            <outputDirectory>${pom.artifactId}-${pom.version}/repository/conf/drools</outputDirectory>\r\n+            <filtered>true</filtered>\r\n+            <fileMode>755</fileMode>\r\n+        </file>\r\n         <file>\r\n             <source>src/main/conf/drools/terminateall.drl</source>\r\n             <outputDirectory>${pom.artifactId}-${pom.version}/repository/conf/drools</outputDirectory>\r",
                "deletions": 0
            },
            {
                "sha": "d298ead43798c317045e6bdb3a1f161b6ef5e381",
                "filename": "products/stratos/modules/distribution/src/main/conf/autoscaler.xml",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/autoscaler.xml",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/autoscaler.xml",
                "status": "modified",
                "changes": 4,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/products/stratos/modules/distribution/src/main/conf/autoscaler.xml?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -64,5 +64,9 @@\n \t\t     <service>60000</service>\n \t\t</kubernetes>\n  \t    </monitorInterval>\n+        <threadpool>\n+            <identifier>Autoscaler</identifier>\n+            <threadPoolSize>10</threadPoolSize>\n+        </threadpool>\n \t</autoscaler>\n </configuration>",
                "deletions": 0
            },
            {
                "sha": "4d0aa5e7376c701936fd631ce385fb18a13342a8",
                "filename": "products/stratos/modules/distribution/src/main/conf/drools/container-mincheck.drl",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/container-mincheck.drl",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/container-mincheck.drl",
                "status": "modified",
                "changes": 16,
                "additions": 8,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/products/stratos/modules/distribution/src/main/conf/drools/container-mincheck.drl?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -23,17 +23,17 @@ import org.apache.commons.logging.Log;\n import org.apache.stratos.autoscaler.context.cluster.KubernetesClusterContext;\n \n global org.apache.stratos.autoscaler.rule.RuleLog log;\n-global org.apache.stratos.autoscaler.rule.RuleTasksDelegator $delegator;\n+global org.apache.stratos.autoscaler.rule.RuleTasksDelegator delegator;\n global java.lang.String clusterId;\n  \n rule \"Container Minimum Rule\"\n dialect \"mvel\"\n \twhen\n-           $kubernetesClusterContext : KubernetesClusterContext ()\n-\t   kubernetesClusterId : String() from $kubernetesClusterContext.getKubernetesClusterID()\n-           minReplicas : Integer() from $kubernetesClusterContext.getMinReplicas()\n-           nonTerminatedReplicas : Integer() from $kubernetesClusterContext.getNonTerminatedMemberCount()\n-           isServiceClusterCreated : Boolean() from $kubernetesClusterContext.isServiceClusterCreated()\n+           kubernetesClusterContext : KubernetesClusterContext ()\n+\t   kubernetesClusterId : String() from kubernetesClusterContext.getKubernetesClusterID()\n+           minReplicas : Integer() from kubernetesClusterContext.getMinReplicas()\n+           nonTerminatedReplicas : Integer() from kubernetesClusterContext.getNonTerminatedMemberCount()\n+           isServiceClusterCreated : Boolean() from kubernetesClusterContext.isServiceClusterCreated()\n \t   \n            eval(log.info(\"Running minimum rule: [kub-cluster] \" + kubernetesClusterId + \" [cluster] \" + clusterId))\n            eval(log.info(\"[min-check] \" + \" [cluster] : \" + clusterId + \" [Replicas] nonTerminated : \" + nonTerminatedReplicas))\n@@ -44,11 +44,11 @@ dialect \"mvel\"\n              // we suceeded calling startContainer() once, can't call it again\n               log.info(\"[min-check] Decided to scale-up : [cluster] : \" + clusterId);\n  \t      log.info(\"[min-check] \" + \" [cluster] : \" + clusterId + \" ; min-rule not satisfied, scaling up to minReplicas : \" + minReplicas);\n-              $delegator.delegateScaleUpContainers($kubernetesClusterContext, minReplicas);\n+              delegator.delegateScaleUpContainers(kubernetesClusterContext, minReplicas);\n \t   } else {\n              // we should call startContainer\n               log.info(\"[min-check] Decided to create the cluster : [cluster] : \" + clusterId);\n  \t      log.info(\"[min-check] \" + \" [cluster] : \" + clusterId + \" ; min-rule not satisfied, no containers created yet, creating minReplicas : \" + minReplicas);\n-              $delegator.delegateStartContainers($kubernetesClusterContext);\n+              delegator.delegateStartContainers(kubernetesClusterContext);\n            }\n end",
                "deletions": 8
            },
            {
                "sha": "f6dd3e75abf9c5a682d37a53c688bc1f70e1bb5c",
                "filename": "products/stratos/modules/distribution/src/main/conf/drools/container-obsoletecheck.drl",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/container-obsoletecheck.drl",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/container-obsoletecheck.drl",
                "status": "modified",
                "changes": 14,
                "additions": 7,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/products/stratos/modules/distribution/src/main/conf/drools/container-obsoletecheck.drl?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -23,24 +23,24 @@ import org.apache.commons.logging.Log;\n import org.apache.stratos.autoscaler.context.cluster.KubernetesClusterContext;\n \n global org.apache.stratos.autoscaler.rule.RuleLog log;\n-global org.apache.stratos.autoscaler.rule.RuleTasksDelegator $delegator;\n+global org.apache.stratos.autoscaler.rule.RuleTasksDelegator delegator;\n global java.lang.String clusterId;\n  \n rule \"Terminate Obsoleted Containers\"\n dialect \"mvel\"\n         when\n-           $kubernetesClusterContext : KubernetesClusterContext ()\n-           kubernetesClusterId : String() from $kubernetesClusterContext.getKubernetesClusterID()\n-           obsoleteReplicas : Integer() from $kubernetesClusterContext.getObsoletedMembers().size()\n+           kubernetesClusterContext : KubernetesClusterContext ()\n+           kubernetesClusterId : String() from kubernetesClusterContext.getKubernetesClusterID()\n+           obsoleteReplicas : Integer() from kubernetesClusterContext.getObsoletedMembers().size()\n \n            eval(log.info(\"Running obsolete containers rule [kub-cluster] : \" + kubernetesClusterId + \" [cluster] : \" + clusterId))\n            eval(log.info(\"[obsolete-check] \" + \"[cluster] : \" + clusterId + \" [Replicas] obsoleteReplicas : \" + obsoleteReplicas))\n-           eval($kubernetesClusterContext.getObsoletedMembers().keySet().size() > 0)\n-           memberId : String() from $kubernetesClusterContext.getObsoletedMembers().keySet()\n+           eval(kubernetesClusterContext.getObsoletedMembers().keySet().size() > 0)\n+           memberId : String() from kubernetesClusterContext.getObsoletedMembers().keySet()\n            eval(log.debug(\"[obsolete-check] [kub-cluster] : \" + kubernetesClusterId + \" [cluster] : \" + clusterId + \" Member id : \" + memberId))\n         then\n            log.info(\"[obsolete-check] Terminating the obsolete member with id : \" + memberId + \" in the cluster : \" + clusterId);\n-           $delegator.delegateTerminateContainer($kubernetesClusterContext, memberId);\n+           delegator.delegateTerminateContainer(kubernetesClusterContext, memberId);\n end\n \n ",
                "deletions": 7
            },
            {
                "sha": "56a2fae69aa056454321ae9fee40e7c61d57770d",
                "filename": "products/stratos/modules/distribution/src/main/conf/drools/container-scaling.drl",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/container-scaling.drl",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/container-scaling.drl",
                "status": "modified",
                "changes": 64,
                "additions": 32,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/products/stratos/modules/distribution/src/main/conf/drools/container-scaling.drl?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -24,7 +24,7 @@ import org.apache.stratos.autoscaler.pojo.policy.autoscale.LoadThresholds;\n import org.apache.stratos.autoscaler.context.cluster.KubernetesClusterContext;\n \n global org.apache.stratos.autoscaler.rule.RuleLog log;\n-global org.apache.stratos.autoscaler.rule.RuleTasksDelegator $delegator;\n+global org.apache.stratos.autoscaler.rule.RuleTasksDelegator delegator;\n global org.apache.stratos.autoscaler.pojo.policy.autoscale.AutoscalePolicy autoscalePolicy;\n global java.lang.String clusterId;\n global java.lang.Boolean rifReset;\n@@ -34,40 +34,40 @@ global java.lang.Boolean laReset;\n rule \"Containers Scaling Rule\"\n dialect \"mvel\"\n \twhen\n-        $kubernetesClusterContext : KubernetesClusterContext ()\n-\tkubernetesClusterId : String() from $kubernetesClusterContext.getKubernetesClusterID()\n-\tminReplicas : Integer() from $kubernetesClusterContext.getMinReplicas()\n-        maxReplicas : Integer() from $kubernetesClusterContext.getMaxReplicas()\n-        nonTerminatedReplicas : Integer() from $kubernetesClusterContext.getNonTerminatedMemberCount()\n-        activeReplicas : Integer() from $kubernetesClusterContext.getActiveMemberCount()\n+        kubernetesClusterContext : KubernetesClusterContext ()\n+\tkubernetesClusterId : String() from kubernetesClusterContext.getKubernetesClusterID()\n+\tminReplicas : Integer() from kubernetesClusterContext.getMinReplicas()\n+        maxReplicas : Integer() from kubernetesClusterContext.getMaxReplicas()\n+        nonTerminatedReplicas : Integer() from kubernetesClusterContext.getNonTerminatedMemberCount()\n+        activeReplicas : Integer() from kubernetesClusterContext.getActiveMemberCount()\n \n         eval(log.info(\"Running scaling rule [kub-cluster] : \" + kubernetesClusterId + \" [cluster] : \" + clusterId))\n \t\n-\t$loadThresholds : LoadThresholds() from  autoscalePolicy.getLoadThresholds()\n+\tloadThresholds : LoadThresholds() from  autoscalePolicy.getLoadThresholds()\n \n-        rifUpperLimit : Float() from  $loadThresholds.getRequestsInFlight().getUpperLimit()\n-        rifLowerLimit : Float() from  $loadThresholds.getRequestsInFlight().getLowerLimit()\n+        rifUpperLimit : Float() from  loadThresholds.getRequestsInFlight().getUpperLimit()\n+        rifLowerLimit : Float() from  loadThresholds.getRequestsInFlight().getLowerLimit()\n \n-        rifAverage : Float() from  $kubernetesClusterContext.getAverageRequestsInFlight()\n-        rifGradient : Float() from  $kubernetesClusterContext.getRequestsInFlightGradient()\n-        rifSecondDerivative : Float() from  $kubernetesClusterContext.getRequestsInFlightSecondDerivative()\n-\trifPredictedValue : Double() from $delegator.getPredictedValueForNextMinute(rifAverage, rifGradient, rifSecondDerivative, 1)\n+        rifAverage : Float() from  kubernetesClusterContext.getAverageRequestsInFlight()\n+        rifGradient : Float() from  kubernetesClusterContext.getRequestsInFlightGradient()\n+        rifSecondDerivative : Float() from  kubernetesClusterContext.getRequestsInFlightSecondDerivative()\n+\trifPredictedValue : Double() from delegator.getPredictedValueForNextMinute(rifAverage, rifGradient, rifSecondDerivative, 1)\n \n-        mcUpperLimit : Float() from  $loadThresholds.getMemoryConsumption().getUpperLimit()\n-        mcLowerLimit : Float() from  $loadThresholds.getMemoryConsumption().getLowerLimit()\n+        mcUpperLimit : Float() from  loadThresholds.getMemoryConsumption().getUpperLimit()\n+        mcLowerLimit : Float() from  loadThresholds.getMemoryConsumption().getLowerLimit()\n \n-        memoryConsumptionAverage : Float() from  $kubernetesClusterContext.getAverageMemoryConsumption()\n-        memoryConsumptionGradient : Float() from  $kubernetesClusterContext.getMemoryConsumptionGradient()\n-        memoryConsumptionSecondDerivative : Float() from  $kubernetesClusterContext.getMemoryConsumptionSecondDerivative()\n-\tmcPredictedValue : Double() from $delegator.getPredictedValueForNextMinute(memoryConsumptionAverage, memoryConsumptionGradient, memoryConsumptionSecondDerivative, 1)\n+        memoryConsumptionAverage : Float() from  kubernetesClusterContext.getAverageMemoryConsumption()\n+        memoryConsumptionGradient : Float() from  kubernetesClusterContext.getMemoryConsumptionGradient()\n+        memoryConsumptionSecondDerivative : Float() from  kubernetesClusterContext.getMemoryConsumptionSecondDerivative()\n+\tmcPredictedValue : Double() from delegator.getPredictedValueForNextMinute(memoryConsumptionAverage, memoryConsumptionGradient, memoryConsumptionSecondDerivative, 1)\n \n-        laUpperLimit : Float() from  $loadThresholds.getLoadAverage().getUpperLimit()\n-        laLowerLimit : Float() from  $loadThresholds.getLoadAverage().getLowerLimit()\n+        laUpperLimit : Float() from  loadThresholds.getLoadAverage().getUpperLimit()\n+        laLowerLimit : Float() from  loadThresholds.getLoadAverage().getLowerLimit()\n \n-        loadAverageAverage : Float() from  $kubernetesClusterContext.getAverageLoadAverage()\n-        loadAverageGradient : Float() from  $kubernetesClusterContext.getLoadAverageGradient()\n-        loadAverageSecondDerivative : Float() from  $kubernetesClusterContext.getLoadAverageSecondDerivative()\n-\tlaPredictedValue : Double() from $delegator.getPredictedValueForNextMinute(loadAverageAverage, loadAverageGradient, loadAverageSecondDerivative, 1)\n+        loadAverageAverage : Float() from  kubernetesClusterContext.getAverageLoadAverage()\n+        loadAverageGradient : Float() from  kubernetesClusterContext.getLoadAverageGradient()\n+        loadAverageSecondDerivative : Float() from  kubernetesClusterContext.getLoadAverageSecondDerivative()\n+\tlaPredictedValue : Double() from delegator.getPredictedValueForNextMinute(loadAverageAverage, loadAverageGradient, loadAverageSecondDerivative, 1)\n \n         scaleUpForRif : Boolean() from (rifReset && (rifPredictedValue > rifUpperLimit))\n         scaleUpForMc : Boolean() from (mcReset && (mcPredictedValue > mcUpperLimit))\n@@ -107,21 +107,21 @@ dialect \"mvel\"\n         if (scaleUp) {\n \t    int requiredReplicas = 0;\n \t    if (scaleUpForRif) {\n-              int predictedReplicasForRif = $delegator.getPredictedReplicasForStat(minReplicas, rifUpperLimit, rifPredictedValue);\n+              int predictedReplicasForRif = delegator.getPredictedReplicasForStat(minReplicas, rifUpperLimit, rifPredictedValue);\n \t      log.info(\"[scaling] \" + \" [cluster] : \" + clusterId + \" [RequestInFlight] predicted replicas : \" + predictedReplicasForRif);\n               if (predictedReplicasForRif > requiredReplicas ) {\n                 requiredReplicas = predictedReplicasForRif;\n               }\n \t    } \n \t    if (scaleUpForMc) {\n-              int predictedReplicasForMc = $delegator.getPredictedReplicasForStat(minReplicas, mcUpperLimit, mcPredictedValue);\n+              int predictedReplicasForMc = delegator.getPredictedReplicasForStat(minReplicas, mcUpperLimit, mcPredictedValue);\n               log.info(\"[scaling] \" + \" [cluster] : \" + clusterId + \" [MemoryConsumption] predicted replicas : \" + predictedReplicasForMc);\n               if (predictedReplicasForMc > requiredReplicas ) {\n                 requiredReplicas = predictedReplicasForMc;\n               }\n             }\n             if (scaleUpForLa) {\n-              int predictedReplicasForLa = $delegator.getPredictedReplicasForStat(minReplicas, laUpperLimit, laPredictedValue);\n+              int predictedReplicasForLa = delegator.getPredictedReplicasForStat(minReplicas, laUpperLimit, laPredictedValue);\n               log.info(\"[scaling] \" + \" [cluster] : \" + clusterId + \" [LoadAverage] predicted replicas : \" + predictedReplicasForLa);\n               if (predictedReplicasForLa > requiredReplicas ) {\n                 requiredReplicas = predictedReplicasForLa;\n@@ -141,14 +141,14 @@ dialect \"mvel\"\n             if (requiredReplicas > nonTerminatedReplicas) {\n               log.info(\"[scaling] Decided to scale-up : [cluster] : \" + clusterId);\n  \t      log.info(\"[scaling-up] \" + \" [cluster] : \" + clusterId + \" valid number of replicas to expand : \" + requiredReplicas);\n-\t      $delegator.delegateScaleUpContainers($kubernetesClusterContext, requiredReplicas);\n+\t      delegator.delegateScaleUpContainers(kubernetesClusterContext, requiredReplicas);\n             }\n             //shrink the cluster\n             if (requiredReplicas < nonTerminatedReplicas) {\n               if (requiredReplicas < activeReplicas) {\n                 log.info(\"[scaling] Decided to scale-down : [cluster] : \" + clusterId);\n  \t        log.info(\"[scaling-down] \" + \" [cluster] : \" + clusterId + \" valid number of replicas to shrink : \" + requiredReplicas);\n-\t        $delegator.delegateScaleDownContainers($kubernetesClusterContext, requiredReplicas);\n+\t        delegator.delegateScaleDownContainers(kubernetesClusterContext, requiredReplicas);\n               } else {\n \t        log.info(\"[scaling] \" + \" [cluster] : \" + clusterId + \" Even if requiredReplicas < nonTerminatedReplicas, still requiredReplicas >= activeReplicas ; hence not scaling down \");\n               }\n@@ -162,7 +162,7 @@ dialect \"mvel\"\n               log.info(\"[scaling] Decided to scale-down [cluster] : \" + clusterId);\n               log.info(\"[scaling-down] \" + \" [cluster] : \" + clusterId + \" shrink the cluster to minReplicas : \" + minReplicas);\n               //shrink the cluster to minReplicas\n-              $delegator.delegateScaleDownContainers($kubernetesClusterContext, minReplicas);\n+              delegator.delegateScaleDownContainers(kubernetesClusterContext, minReplicas);\n             } else {\n \t      log.info(\"[scaling] \" + \" [cluster] : \" + clusterId + \" Even if all predicted stats < upperLimit, still activeReplicas <= minReplicas ; hence not scaling down \");\n             }",
                "deletions": 32
            },
            {
                "sha": "791a23879074801e5027cb7cf037ab9492e1c199",
                "filename": "products/stratos/modules/distribution/src/main/conf/drools/dependent-scaling.drl",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/dependent-scaling.drl",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/dependent-scaling.drl",
                "status": "modified",
                "changes": 119,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/products/stratos/modules/distribution/src/main/conf/drools/dependent-scaling.drl?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -19,132 +19,21 @@\n \n package org.apache.stratos.autoscaler.rule;\n \n-import org.apache.stratos.messaging.domain.topology.Service;\n-import org.apache.stratos.messaging.domain.topology.Cluster;\n-import org.apache.stratos.autoscaler.context.AutoscalerContext;\n-import org.apache.stratos.autoscaler.context.member.MemberStatsContext;\n-import org.apache.stratos.autoscaler.Constants;\n-import org.apache.stratos.autoscaler.context.partition.network.ClusterLevelNetworkPartitionContext;\n-import org.apache.stratos.autoscaler.pojo.policy.PolicyManager;\n-import org.apache.stratos.autoscaler.pojo.policy.autoscale.AutoscalePolicy;\n-import org.apache.stratos.autoscaler.client.CloudControllerClient;\n-import org.apache.stratos.autoscaler.algorithm.AutoscaleAlgorithm;\n-import org.apache.stratos.autoscaler.algorithm.OneAfterAnother;\n-import org.apache.stratos.autoscaler.algorithm.RoundRobin;\n-import org.apache.stratos.autoscaler.context.partition.ClusterLevelPartitionContext;\n-import org.apache.stratos.autoscaler.rule.AutoscalerRuleEvaluator;\n-import org.apache.stratos.autoscaler.pojo.policy.deployment.partition.network.NetworkPartition;\n-import org.apache.stratos.cloud.controller.domain.xsd.Partition;\n-import org.apache.stratos.cloud.controller.domain.xsd.MemberContext;\n-\n-import org.apache.stratos.autoscaler.pojo.policy.autoscale.LoadAverage\n-import org.apache.stratos.autoscaler.pojo.policy.autoscale.MemoryConsumption\n+import org.apache.stratos.autoscaler.context.cluster.ClusterInstanceContext;\n \n global org.apache.stratos.autoscaler.rule.RuleLog log;\n-global org.apache.stratos.autoscaler.rule.RuleTasksDelegator $delegator;\n-global org.apache.stratos.autoscaler.pojo.policy.autoscale.AutoscalePolicy autoscalePolicy;\n global java.lang.String clusterId;\n-global java.lang.String instanceId;\n-global java.lang.Float laReset;\n-global java.lang.Float numberOfRequiredInstances;\n-global java.lang.Boolean isPrimary;\n-global java.lang.String lbRef;\n-global java.util.List primaryMembers;\n+global Integer roundedRequiredInstanceCount;\n+global org.apache.stratos.autoscaler.rule.RuleTasksDelegator delegator;\n \n rule \"Dependent Scaling Rule\"\n dialect \"mvel\"\n \twhen\n \n-        networkPartitionContext : ClusterLevelNetworkPartitionContext ()\n-\t    algorithmName : String() from networkPartitionContext.getPartitionAlgorithm();\n-        autoscaleAlgorithm : AutoscaleAlgorithm() from  $delegator.getAutoscaleAlgorithm(algorithmName)\n-\n-        roundedRequiredInstanceCount : Integer() from networkPartitionContext.getRequiredInstanceCountBasedOnDependencies();\n-        activeInstancesCount : Integer() from $delegator.getMemberCount(clusterId , 0);\n-\n-        scaleUp : Boolean() from (activeInstancesCount < roundedRequiredInstanceCount )\n-        scaleDown : Boolean() from (activeInstancesCount > roundedRequiredInstanceCount )\n-\n-        eval(log.debug(\"[dependent-scaling] \" + \" [cluster] \" + clusterId + \" Scale-up action: \" + scaleUp))\n-        eval(log.debug(\"[dependent-scaling] \" + \" [cluster] \" + clusterId + \" Scale-down action: \" + scaleDown))\n+       clusterInstanceContext : ClusterInstanceContext ()\n \n \tthen\n \n-        if(scaleUp){\n-\n-            int additionalInstances = roundedRequiredInstanceCount - activeInstancesCount ;\n-            int count = 0;\n-            while(count != additionalInstances){\n-                Partition partition =  autoscaleAlgorithm.getNextScaleUpPartition(networkPartitionContext, clusterId);\n-                if(partition != null){\n-                    log.info(\"[scale-up] Partition available, hence trying to spawn an instance to scale up!\" );\n-                    log.debug(\"[scale-up] \" + \" [partition] \" + partition.getId() + \" [cluster] \" + clusterId );\n-                    $delegator.delegateSpawn(networkPartitionContext.getPartitionCtxt(partition.getId()), clusterId, instanceId, lbRef, isPrimary);\n-                    count++;\n-                }\n-            }\n-        } else if(scaleDown){\n-\n-            log.debug(\"[scale-down] Decided to Scale down [cluster] \" + clusterId);\n-\n-            MemberStatsContext selectedMemberStatsContext = null;\n-            double lowestOverallLoad = 0.0;\n-            boolean foundAValue = false;\n-            Partition partition =  autoscaleAlgorithm.getNextScaleDownPartition(networkPartitionContext, clusterId);\n-            if(partition != null){\n-                log.info(\"[scale-down] Partition available to scale down \");\n-                log.debug(\"[scale-down] \" + \" [partition] \" + partition.getId() + \" [cluster] \" + clusterId);\n-                partitionContext = networkPartitionContext.getPartitionCtxt(partition.getId());\n-\n-\n-                // In partition context member stat context, all the primary members need to be\n-                // avoided being selected as the member to terminated\n-\n-                for(MemberStatsContext memberStatsContext: partitionContext.getMemberStatsContexts().values()){\n-\n-                    if( !primaryMembers.contains(memberStatsContext.getMemberId()) ) {\n-\n-                        LoadAverage loadAverage = memberStatsContext.getLoadAverage();\n-                        log.debug(\"[scale-down] \" + \" [cluster] \"\n-                            + clusterId + \" [member] \" + memberStatsContext.getMemberId() + \" Load average: \" + loadAverage);\n-\n-                        MemoryConsumption memoryConsumption = memberStatsContext.getMemoryConsumption();\n-                        log.debug(\"[scale-down] \" + \" [partition] \" + partition.getId() + \" [cluster] \"\n-                            + clusterId + \" [member] \" + memberStatsContext.getMemberId() + \" Memory consumption: \" + memoryConsumption);\n-\n-                        double predictedCpu = $delegator.getPredictedValueForNextMinute(loadAverage.getAverage(),loadAverage.getGradient(),loadAverage.getSecondDerivative(), 1);\n-                        log.debug(\"[scale-down] \" + \" [partition] \" + partition.getId() + \" [cluster] \"\n-                            + clusterId + \" [member] \" + memberStatsContext.getMemberId() + \" Predicted CPU: \" + predictedCpu);\n-\n-                        double predictedMemoryConsumption = $delegator.getPredictedValueForNextMinute(memoryConsumption.getAverage(),memoryConsumption.getGradient(),memoryConsumption.getSecondDerivative(), 1);\n-                        log.debug(\"[scale-down] \" + \" [partition] \" + partition.getId() + \" [cluster] \"\n-                            + clusterId + \" [member] \" + memberStatsContext.getMemberId() + \" Predicted memory consumption: \" + predictedMemoryConsumption);\n-\n-                        double overallLoad = (predictedCpu + predictedMemoryConsumption) / 2;\n-                        log.debug(\"[scale-down] \" + \" [partition] \" + partition.getId() + \" [cluster] \"\n-                            + clusterId + \" [member] \" + memberStatsContext.getMemberId() + \" Overall load: \" + overallLoad);\n-\n-                        if(!foundAValue){\n-                            foundAValue = true;\n-                            selectedMemberStatsContext = memberStatsContext;\n-                            lowestOverallLoad = overallLoad;\n-                        } else if(overallLoad < lowestOverallLoad){\n-                            selectedMemberStatsContext = memberStatsContext;\n-                            lowestOverallLoad = overallLoad;\n-                        }\n-                    }\n-                }\n-                if(selectedMemberStatsContext != null) {\n-                    log.info(\"[scale-down] Trying to terminating an instance to scale down!\" );\n-                    log.debug(\"[scale-down] \" + \" [partition] \" + partition.getId() + \" [cluster] \"\n-                        + clusterId + \" Member with lowest overall load: \" + selectedMemberStatsContext.getMemberId());\n-\n-                    $delegator.delegateTerminate(partitionContext, selectedMemberStatsContext.getMemberId());\n-                }\n-            }\n-        }  else{\n-\n-        }\n \n end\n ",
                "deletions": 115
            },
            {
                "sha": "c8a5df89578590a0280a37e303095a526836b5bf",
                "filename": "products/stratos/modules/distribution/src/main/conf/drools/mincheck.drl",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/mincheck.drl",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/mincheck.drl",
                "status": "modified",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/products/stratos/modules/distribution/src/main/conf/drools/mincheck.drl?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -42,8 +42,8 @@ import org.apache.stratos.cloud.controller.stub.domain.MemberContext;\n import org.apache.stratos.autoscaler.context.cluster.ClusterInstanceContext;\n \n global org.apache.stratos.autoscaler.rule.RuleLog log;\n-global org.apache.stratos.autoscaler.pojo.policy.PolicyManager $manager;\n-global org.apache.stratos.autoscaler.context.AutoscalerContext $context;\n+global org.apache.stratos.autoscaler.pojo.policy.PolicyManager manager;\n+global org.apache.stratos.autoscaler.context.AutoscalerContext context;\n global org.apache.stratos.autoscaler.rule.RuleTasksDelegator delegator;\n global java.util.Map partitionCtxts;\n global java.lang.String clusterId;",
                "deletions": 2
            },
            {
                "sha": "894cf2acd25a586bfe13d7ff58baa3ef8c70c85e",
                "filename": "products/stratos/modules/distribution/src/main/conf/drools/obsoletecheck.drl",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/obsoletecheck.drl",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/obsoletecheck.drl",
                "status": "modified",
                "changes": 36,
                "additions": 18,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/products/stratos/modules/distribution/src/main/conf/drools/obsoletecheck.drl?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -41,10 +41,10 @@ import org.apache.stratos.cloud.controller.stub.domain.Partition;\n import org.apache.stratos.cloud.controller.stub.domain.MemberContext;\n \n global org.apache.stratos.autoscaler.rule.RuleLog log;\n-global org.apache.stratos.autoscaler.pojo.policy.PolicyManager $manager;\n-global org.apache.stratos.autoscaler.context.AutoscalerContext $context;\n-global org.apache.stratos.autoscaler.rule.RuleTasksDelegator $delegator;\n-global org.apache.stratos.messaging.domain.topology.Topology $topology;\n+global org.apache.stratos.autoscaler.pojo.policy.PolicyManager manager;\n+global org.apache.stratos.autoscaler.context.AutoscalerContext context;\n+global org.apache.stratos.autoscaler.rule.RuleTasksDelegator delegator;\n+global org.apache.stratos.messaging.domain.topology.Topology topology;\n global java.util.Map partitionCtxts;\n global java.lang.String clusterId;\n global java.lang.String lbRef;\n@@ -54,26 +54,26 @@ global Integer primaryMemberCount;\n rule \"Terminate Obsoleted Instances\"\n dialect \"mvel\"\n         when\n-            $ctxt : ClusterLevelPartitionContext ()\n-            eval(log.debug(\"Running obsolete instances rule: [partition] \" + $ctxt.getPartitionId() + \" [network-partition] \" + $ctxt.getNetworkPartitionId()))\n-            eval(log.debug(\"[obsolete-check] [network-partition] \" + $ctxt.getNetworkPartitionId() + \" [partition] \" + $ctxt.getPartitionId() +\" Obsolete member count: \" + $ctxt.getObsoletedMembers().size()))\n-            eval($ctxt.getObsoletedMembers().keySet().size() > 0)\n-            memberId : String() from $ctxt.getObsoletedMembers().keySet()\n-            eval(log.debug(\"[obsolete-check] [network-partition] \" + $ctxt.getNetworkPartitionId() + \" [partition] \" + $ctxt.getPartitionId() + \" Member id: \" + memberId))\n+            ctxt : ClusterLevelPartitionContext ()\n+            eval(log.debug(\"Running obsolete instances rule: [partition] \" + ctxt.getPartitionId() + \" [network-partition] \" + ctxt.getNetworkPartitionId()))\n+            eval(log.debug(\"[obsolete-check] [network-partition] \" + ctxt.getNetworkPartitionId() + \" [partition] \" + ctxt.getPartitionId() +\" Obsolete member count: \" + ctxt.getObsoletedMembers().size()))\n+            eval(ctxt.getObsoletedMembers().keySet().size() > 0)\n+            memberId : String() from ctxt.getObsoletedMembers().keySet()\n+            eval(log.debug(\"[obsolete-check] [network-partition] \" + ctxt.getNetworkPartitionId() + \" [partition] \" + ctxt.getPartitionId() + \" Member id: \" + memberId))\n         then\n-           $delegator.terminateObsoleteInstance(memberId);\n+           delegator.terminateObsoleteInstance(memberId);\n end\n \n rule \"Cleanup Instances which are pending termination\"\n dialect \"mvel\"\n         when\n-            $ctxt : ClusterLevelPartitionContext ()\n-            eval(log.debug(\"Running instances cleanup event sender rule: [partition] \" + $ctxt.getPartitionId() + \" [network-partition] \" + $ctxt.getNetworkPartitionId()))\n-            eval(log.debug(\"[instance-cleanup-check] [network-partition] \" + $ctxt.getNetworkPartitionId() + \" [partition] \" + $ctxt.getPartitionId() +\" Pending termination member count: \" + $ctxt.getTerminationPendingMembers().size()))\n-            eval($ctxt.getTerminationPendingMembers().size() > 0)\n-            memberId : String() from $ctxt.getTerminationPendingMembers()\n-            eval(log.debug(\"[instance-cleanup-check ] [network-partition] \" + $ctxt.getNetworkPartitionId() + \" [partition] \" + $ctxt.getPartitionId() + \" Member id: \" + memberId))\n+            ctxt : ClusterLevelPartitionContext ()\n+            eval(log.debug(\"Running instances cleanup event sender rule: [partition] \" + ctxt.getPartitionId() + \" [network-partition] \" + ctxt.getNetworkPartitionId()))\n+            eval(log.debug(\"[instance-cleanup-check] [network-partition] \" + ctxt.getNetworkPartitionId() + \" [partition] \" + ctxt.getPartitionId() +\" Pending termination member count: \" + ctxt.getTerminationPendingMembers().size()))\n+            eval(ctxt.getTerminationPendingMembers().size() > 0)\n+            memberId : String() from ctxt.getTerminationPendingMembers()\n+            eval(log.debug(\"[instance-cleanup-check ] [network-partition] \" + ctxt.getNetworkPartitionId() + \" [partition] \" + ctxt.getPartitionId() + \" Member id: \" + memberId))\n         then\n-           $delegator.delegateInstanceCleanup(memberId);\n+           delegator.delegateInstanceCleanup(memberId);\n end\n ",
                "deletions": 18
            },
            {
                "sha": "85230889b155b3bb4f2df087276d072b258b8ef5",
                "filename": "products/stratos/modules/distribution/src/main/conf/drools/scaling.drl",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/scaling.drl",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/scaling.drl",
                "status": "modified",
                "changes": 18,
                "additions": 9,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/products/stratos/modules/distribution/src/main/conf/drools/scaling.drl?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -42,14 +42,14 @@ import org.apache.stratos.autoscaler.rule.AutoscalerRuleEvaluator;\n import org.apache.stratos.autoscaler.pojo.policy.deployment.partition.network.NetworkPartition;\n import org.apache.stratos.cloud.controller.stub.domain.Partition;\n import org.apache.stratos.cloud.controller.stub.domain.MemberContext;\n+import org.apache.stratos.autoscaler.context.cluster.ClusterInstanceContext;\n \n import org.apache.stratos.autoscaler.pojo.policy.autoscale.LoadAverage\n import org.apache.stratos.autoscaler.pojo.policy.autoscale.MemoryConsumption\n \n global org.apache.stratos.autoscaler.rule.RuleLog log;\n global org.apache.stratos.autoscaler.rule.RuleTasksDelegator delegator;\n global org.apache.stratos.autoscaler.pojo.policy.autoscale.AutoscalePolicy autoscalePolicy;\n-global org.apache.stratos.autoscaler.context.cluster.ClusterInstanceContext clusterInstanceContext;\n global java.lang.String clusterId;\n global java.lang.String instanceId;\n global java.lang.Boolean rifReset;\n@@ -58,19 +58,19 @@ global java.lang.Boolean laReset;\n global java.lang.Boolean isPrimary;\n global java.util.List primaryMembers;\n global java.lang.Boolean arspiReset;\n+global java.lang.String algorithmName;\n \n rule \"Scaling Rule\"\n dialect \"mvel\"\n \twhen\n-        networkPartitionContext : ClusterLevelNetworkPartitionContext ()\n+       clusterInstanceContext : ClusterInstanceContext ()\n \n         loadThresholds : LoadThresholds() from  autoscalePolicy.getLoadThresholds()\n-\t    algorithmName : String() from networkPartitionContext.getPartitionAlgorithm();\n         autoscaleAlgorithm : AutoscaleAlgorithm() from  delegator.getAutoscaleAlgorithm(algorithmName)\n \n-        eval(log.debug(\"Running scale up rule: [network-partition] \" + networkPartitionContext.getId() + \" [cluster] \" + clusterId))\n-        eval(log.debug(\"[scaling] [network-partition] \" + networkPartitionContext.getId() + \" [cluster] \" + clusterId + \" Algorithm name: \" + algorithmName))\n-        eval(log.debug(\"[scaling] [network-partition] \" + networkPartitionContext.getId() + \" [cluster] \" + clusterId + \" Algorithm: \" + autoscaleAlgorithm))\n+        eval(log.debug(\"Running scale up rule: [network-partition] \" + clusterInstanceContext.getNetworkPartitionId() + \" [cluster] \" + clusterId))\n+        eval(log.debug(\"[scaling] [network-partition] \" + clusterInstanceContext.getNetworkPartitionId() + \" [cluster] \" + clusterId + \" Algorithm name: \" + algorithmName))\n+        eval(log.debug(\"[scaling] [network-partition] \" + clusterInstanceContext.getNetworkPartitionId() + \" [cluster] \" + clusterId + \" Algorithm: \" + autoscaleAlgorithm))\n \n \t\n         rifUpperLimit : Float() from  loadThresholds.getRequestsInFlight().getUpperLimit()\n@@ -133,7 +133,7 @@ dialect \"mvel\"\n \n             //Calculating the factor scaling\n             float factor = numberOfRequiredInstances / clusterInstanceContext.getMinMembers();\n-            delegator.delegateScalingDependencyNotification(clusterId, networkPartitionContext.getId(), factor);\n+            delegator.delegateScalingDependencyNotification(clusterId, clusterInstanceContext.getId(), factor);\n \n             while(count != additionalInstances){\n             ClusterLevelPartitionContext partitionContext =  (ClusterLevelPartitionContext)autoscaleAlgorithm.getNextScaleUpPartitionContext(clusterInstanceContext.getPartitionCtxtsAsAnArray());\n@@ -147,7 +147,7 @@ dialect \"mvel\"\n         } else if(scaleDown){\n \n             float factor = numberOfRequiredInstances / clusterInstanceContext.getMinMembers();\n-            delegator.delegateScalingDependencyNotification(clusterId, networkPartitionContext.getId(), factor);\n+            delegator.delegateScalingDependencyNotification(clusterId, clusterInstanceContext.getNetworkPartitionId(), factor);\n \n             log.debug(\"[scale-down] Decided to Scale down [cluster] \" + clusterId);\n             if(clusterInstanceContext.getScaleDownRequestsCount() > 5 ){\n@@ -159,7 +159,7 @@ dialect \"mvel\"\n                 if(partitionContext != null){\n                     log.info(\"[scale-down] Partition available to scale down \");\n //                    log.debug(\"[scale-down] \" + \" [partition] \" + partition.getId() + \" [cluster] \" + clusterId);\n-//                    partitionContext = networkPartitionContext.getPartitionCtxt(partition.getId());\n+//                    partitionContext = clusterInstanceContext.getPartitionCtxt(partition.getId());\n //\n \n \t\t\t\t\t// In partition context member stat context, all the primary members need to be",
                "deletions": 9
            },
            {
                "sha": "512bebd0d40d11deff9f835e225c436f1458bf3d",
                "filename": "products/stratos/modules/distribution/src/main/conf/drools/terminateall.drl",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/terminateall.drl",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/terminateall.drl",
                "status": "modified",
                "changes": 16,
                "additions": 8,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/products/stratos/modules/distribution/src/main/conf/drools/terminateall.drl?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -23,21 +23,21 @@ import org.apache.stratos.messaging.domain.topology.Cluster;\n import org.apache.stratos.autoscaler.context.partition.ClusterLevelPartitionContext;\n \n global org.apache.stratos.autoscaler.rule.RuleLog log;\n-global org.apache.stratos.autoscaler.rule.RuleTasksDelegator $delegator;\n+global org.apache.stratos.autoscaler.rule.RuleTasksDelegator delegator;\n \n rule \"Terminate all Rule\"\n \n dialect \"mvel\"\n         when\n-            $ctxt : ClusterLevelPartitionContext ()\n-            eval(log.debug(\"Running terminate all rule: [partition] \" + $ctxt.getPartitionId() + \" [network-partition] \" + $ctxt.getNetworkPartitionId()))\n-            eval(log.debug(\"[terminate all] [network-partition] \" + $ctxt.getNetworkPartitionId() + \" [partition] \" + $ctxt.getPartitionId() +\" Member count: \" + $ctxt.getMemberStatsContexts().size()))\n-            eval($ctxt.getMemberStatsContexts().size() > 0)\n-            memberId : String() from $ctxt.getMemberStatsContexts().keySet()\n-            eval(log.debug(\"[terminate all] [network-partition] \" + $ctxt.getNetworkPartitionId() + \" [partition] \" + $ctxt.getPartitionId() + \" Member id: \" + memberId))\n+            ctxt : ClusterLevelPartitionContext ()\n+            eval(log.debug(\"Running terminate all rule: [partition] \" + ctxt.getPartitionId() + \" [network-partition] \" + ctxt.getNetworkPartitionId()))\n+            eval(log.debug(\"[terminate all] [network-partition] \" + ctxt.getNetworkPartitionId() + \" [partition] \" + ctxt.getPartitionId() +\" Member count: \" + ctxt.getMemberStatsContexts().size()))\n+            eval(ctxt.getMemberStatsContexts().size() > 0)\n+            memberId : String() from ctxt.getMemberStatsContexts().keySet()\n+            eval(log.debug(\"[terminate all] [network-partition] \" + ctxt.getNetworkPartitionId() + \" [partition] \" + ctxt.getPartitionId() + \" Member id: \" + memberId))\n \n         then\n-           $delegator.delegateTerminate($ctxt, memberId);\n+           delegator.delegateTerminate(ctxt, memberId);\n end\n \n ",
                "deletions": 8
            },
            {
                "sha": "c7f313c4ee353176fd14c08acb4b40ffad28e92f",
                "filename": "products/stratos/modules/distribution/src/main/conf/drools/terminatedependency.drl",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/terminatedependency.drl",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/products/stratos/modules/distribution/src/main/conf/drools/terminatedependency.drl",
                "status": "modified",
                "changes": 16,
                "additions": 8,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/products/stratos/modules/distribution/src/main/conf/drools/terminatedependency.drl?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -23,7 +23,7 @@ import org.apache.stratos.messaging.domain.topology.Cluster;\n import org.apache.stratos.autoscaler.context.partition.ClusterLevelPartitionContext;\n \n global org.apache.stratos.autoscaler.rule.RuleLog log;\n-global org.apache.stratos.autoscaler.rule.RuleTasksDelegator $delegator;\n+global org.apache.stratos.autoscaler.rule.RuleTasksDelegator delegator;\n global java.util.Map partitionCtxts;\n global java.lang.String clusterId;\n global java.lang.String lbRef;\n@@ -35,17 +35,17 @@ rule \"Terminate Dependency Rule\"\n \n dialect \"mvel\"\n         when\n-            $ctxt : ClusterLevelPartitionContext ()\n-            eval(log.debug(\"Running terminate dependency rule: [partition] \" + $ctxt.getPartitionId() + \" [network-partition] \" + $ctxt.getNetworkPartitionId()))\n-            eval(log.debug(\"[terminate dependency] [network-partition] \" + $ctxt.getNetworkPartitionId() + \" [partition] \" + $ctxt.getPartitionId() +\" Member count: \" + $ctxt.getMemberStatsContexts().size()))\n-            eval(log.debug(\"Grouping ... in terminatedependency rule terminating all members \" + $ctxt.getAllMemberForTerminationCount()))\n-            eval(!$ctxt.checkKillDependencies(serviceId, clusterId))\n-            eval(log.debug(\"[terminate dependency] [network-partition] \" + $ctxt.getNetworkPartitionId() + \" [partition] \" + $ctxt.getPartitionId() + \" successfully terminated members\"))\n+            ctxt : ClusterLevelPartitionContext ()\n+            eval(log.debug(\"Running terminate dependency rule: [partition] \" + ctxt.getPartitionId() + \" [network-partition] \" + ctxt.getNetworkPartitionId()))\n+            eval(log.debug(\"[terminate dependency] [network-partition] \" + ctxt.getNetworkPartitionId() + \" [partition] \" + ctxt.getPartitionId() +\" Member count: \" + ctxt.getMemberStatsContexts().size()))\n+            eval(log.debug(\"Grouping ... in terminatedependency rule terminating all members \" + ctxt.getAllMemberForTerminationCount()))\n+            eval(!ctxt.checkKillDependencies(serviceId, clusterId))\n+            eval(log.debug(\"[terminate dependency] [network-partition] \" + ctxt.getNetworkPartitionId() + \" [partition] \" + ctxt.getPartitionId() + \" successfully terminated members\"))\n  \n             eval(log.debug(\"Grouping:terminatedependency:terminating all\"))\n \n         then\n-           $delegator.delegateTerminateAll(clusterId);\n+           delegator.delegateTerminateAll(clusterId);\n end\n \n ",
                "deletions": 8
            },
            {
                "sha": "36b0e1facc3d768b71d811d8d65d59a1d11a091c",
                "filename": "service-stubs/org.apache.stratos.autoscaler.service.stub/src/main/resources/AutoScalerService.wsdl",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/service-stubs/org.apache.stratos.autoscaler.service.stub/src/main/resources/AutoScalerService.wsdl",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/service-stubs/org.apache.stratos.autoscaler.service.stub/src/main/resources/AutoScalerService.wsdl",
                "status": "modified",
                "changes": 429,
                "additions": 240,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/service-stubs/org.apache.stratos.autoscaler.service.stub/src/main/resources/AutoScalerService.wsdl?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -1,4 +1,4 @@\n-<wsdl:definitions xmlns:wsdl=\"http://schemas.xmlsoap.org/wsdl/\" xmlns:ax29=\"http://policy.exception.autoscaler.stratos.apache.org/xsd\" xmlns:ns=\"http://api.autoscaler.stratos.apache.org\" xmlns:ax25=\"http://common.stratos.apache.org/xsd\" xmlns:ax23=\"http://deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\" xmlns:ax24=\"http://network.partition.deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\" xmlns:ax217=\"http://kubernetes.exception.autoscaler.stratos.apache.org/xsd\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:ax219=\"http://application.exception.autoscaler.stratos.apache.org/xsd\" xmlns:ax227=\"http://pojo.autoscaler.stratos.apache.org/xsd\" xmlns:ax214=\"http://kubernetes.common.stratos.apache.org/xsd\" xmlns:ns1=\"http://org.apache.axis2/xsd\" xmlns:ax221=\"http://pojo.applications.autoscaler.stratos.apache.org/xsd\" xmlns:wsaw=\"http://www.w3.org/2006/05/addressing/wsdl\" xmlns:ax224=\"http://exception.autoscaler.stratos.apache.org/xsd\" xmlns:ax211=\"http://autoscale.policy.pojo.autoscaler.stratos.apache.org/xsd\" xmlns:http=\"http://schemas.xmlsoap.org/wsdl/http/\" xmlns:soap=\"http://schemas.xmlsoap.org/wsdl/soap/\" xmlns:mime=\"http://schemas.xmlsoap.org/wsdl/mime/\" xmlns:soap12=\"http://schemas.xmlsoap.org/wsdl/soap12/\" targetNamespace=\"http://api.autoscaler.stratos.apache.org\">\n+<wsdl:definitions xmlns:wsdl=\"http://schemas.xmlsoap.org/wsdl/\" xmlns:ax27=\"http://common.stratos.apache.org/xsd\" xmlns:ns=\"http://api.autoscaler.stratos.apache.org\" xmlns:ax25=\"http://deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\" xmlns:ax26=\"http://network.partition.deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\" xmlns:ax23=\"http://policy.exception.autoscaler.stratos.apache.org/xsd\" xmlns:ax217=\"http://autoscale.policy.pojo.autoscaler.stratos.apache.org/xsd\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:ax219=\"http://application.exception.autoscaler.stratos.apache.org/xsd\" xmlns:ax227=\"http://pojo.autoscaler.stratos.apache.org/xsd\" xmlns:ns1=\"http://org.apache.axis2/xsd\" xmlns:ax221=\"http://pojo.applications.autoscaler.stratos.apache.org/xsd\" xmlns:ax213=\"http://kubernetes.common.stratos.apache.org/xsd\" xmlns:wsaw=\"http://www.w3.org/2006/05/addressing/wsdl\" xmlns:ax224=\"http://exception.autoscaler.stratos.apache.org/xsd\" xmlns:ax211=\"http://kubernetes.exception.autoscaler.stratos.apache.org/xsd\" xmlns:http=\"http://schemas.xmlsoap.org/wsdl/http/\" xmlns:soap=\"http://schemas.xmlsoap.org/wsdl/soap/\" xmlns:mime=\"http://schemas.xmlsoap.org/wsdl/mime/\" xmlns:soap12=\"http://schemas.xmlsoap.org/wsdl/soap12/\" targetNamespace=\"http://api.autoscaler.stratos.apache.org\">\n     <wsdl:documentation>AutoScalerService</wsdl:documentation>\n     <wsdl:types>\n         <xs:schema attributeFormDefault=\"qualified\" elementFormDefault=\"qualified\" targetNamespace=\"http://autoscale.policy.pojo.autoscaler.stratos.apache.org/xsd\">\n@@ -9,15 +9,15 @@\n                     <xs:element minOccurs=\"0\" name=\"id\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"instanceRoundingFactor\" type=\"xs:float\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"isPublic\" type=\"xs:boolean\"></xs:element>\n-                    <xs:element minOccurs=\"0\" name=\"loadThresholds\" nillable=\"true\" type=\"ax211:LoadThresholds\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"loadThresholds\" nillable=\"true\" type=\"ax217:LoadThresholds\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"tenantId\" type=\"xs:int\"></xs:element>\n                 </xs:sequence>\n             </xs:complexType>\n             <xs:complexType name=\"LoadThresholds\">\n                 <xs:sequence>\n-                    <xs:element minOccurs=\"0\" name=\"loadAverage\" nillable=\"true\" type=\"ax211:LoadAverageThresholds\"></xs:element>\n-                    <xs:element minOccurs=\"0\" name=\"memoryConsumption\" nillable=\"true\" type=\"ax211:MemoryConsumptionThresholds\"></xs:element>\n-                    <xs:element minOccurs=\"0\" name=\"requestsInFlight\" nillable=\"true\" type=\"ax211:RequestsInFlightThresholds\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"loadAverage\" nillable=\"true\" type=\"ax217:LoadAverageThresholds\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"memoryConsumption\" nillable=\"true\" type=\"ax217:MemoryConsumptionThresholds\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"requestsInFlight\" nillable=\"true\" type=\"ax217:RequestsInFlightThresholds\"></xs:element>\n                 </xs:sequence>\n             </xs:complexType>\n             <xs:complexType name=\"LoadAverageThresholds\">\n@@ -46,7 +46,7 @@\n                     <xs:element minOccurs=\"0\" name=\"alias\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"applicationId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"components\" nillable=\"true\" type=\"ax221:ComponentContext\"></xs:element>\n-                    <xs:element minOccurs=\"0\" name=\"properties\" nillable=\"true\" type=\"ax25:Properties\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"properties\" nillable=\"true\" type=\"ax27:Properties\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"teantAdminUsername\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"tenantDomain\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"tenantId\" type=\"xs:int\"></xs:element>\n@@ -76,7 +76,7 @@\n                     <xs:element minOccurs=\"0\" name=\"maxMembers\" type=\"xs:int\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"minMembers\" type=\"xs:int\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"privateRepo\" type=\"xs:boolean\"></xs:element>\n-                    <xs:element minOccurs=\"0\" name=\"properties\" nillable=\"true\" type=\"ax25:Properties\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"properties\" nillable=\"true\" type=\"ax27:Properties\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"repoPassword\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"repoUrl\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"repoUsername\" nillable=\"true\" type=\"xs:string\"></xs:element>\n@@ -118,16 +118,16 @@\n                 </xs:sequence>\n             </xs:complexType>\n         </xs:schema>\n-        <xs:schema xmlns:ax27=\"http://network.partition.deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\" attributeFormDefault=\"qualified\" elementFormDefault=\"qualified\" targetNamespace=\"http://deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\">\n+        <xs:schema xmlns:ax29=\"http://network.partition.deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\" attributeFormDefault=\"qualified\" elementFormDefault=\"qualified\" targetNamespace=\"http://deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\">\n             <xs:import namespace=\"http://network.partition.deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\"></xs:import>\n             <xs:complexType name=\"DeploymentPolicy\">\n                 <xs:sequence>\n-                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"allPartitions\" nillable=\"true\" type=\"ax27:Partition\"></xs:element>\n+                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"allPartitions\" nillable=\"true\" type=\"ax29:Partition\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"applicationId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n-                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"applicationLevelNetworkPartitions\" nillable=\"true\" type=\"ax27:ApplicationLevelNetworkPartition\"></xs:element>\n-                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"childLevelNetworkPartitions\" nillable=\"true\" type=\"ax27:ChildLevelNetworkPartition\"></xs:element>\n-                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"childPolicies\" nillable=\"true\" type=\"ax23:ChildPolicy\"></xs:element>\n-                    <xs:element minOccurs=\"0\" name=\"childPolicyHolder\" nillable=\"true\" type=\"ax27:ChildPolicyHolder\"></xs:element>\n+                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"applicationLevelNetworkPartitions\" nillable=\"true\" type=\"ax29:ApplicationLevelNetworkPartition\"></xs:element>\n+                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"childLevelNetworkPartitions\" nillable=\"true\" type=\"ax29:ChildLevelNetworkPartition\"></xs:element>\n+                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"childPolicies\" nillable=\"true\" type=\"ax25:ChildPolicy\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"childPolicyHolder\" nillable=\"true\" type=\"ax29:ChildPolicyHolder\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"description\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"id\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"isPublic\" type=\"xs:boolean\"></xs:element>\n@@ -136,7 +136,7 @@\n             </xs:complexType>\n             <xs:complexType name=\"ChildPolicy\">\n                 <xs:sequence>\n-                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"childLevelNetworkPartitions\" nillable=\"true\" type=\"ax27:ChildLevelNetworkPartition\"></xs:element>\n+                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"childLevelNetworkPartitions\" nillable=\"true\" type=\"ax29:ChildLevelNetworkPartition\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"id\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                 </xs:sequence>\n             </xs:complexType>\n@@ -148,27 +148,27 @@\n                 </xs:sequence>\n             </xs:complexType>\n         </xs:schema>\n-        <xs:schema xmlns:ax26=\"http://common.stratos.apache.org/xsd\" attributeFormDefault=\"qualified\" elementFormDefault=\"qualified\" targetNamespace=\"http://network.partition.deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\">\n+        <xs:schema xmlns:ax28=\"http://common.stratos.apache.org/xsd\" attributeFormDefault=\"qualified\" elementFormDefault=\"qualified\" targetNamespace=\"http://network.partition.deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\">\n             <xs:import namespace=\"http://common.stratos.apache.org/xsd\"></xs:import>\n             <xs:complexType name=\"Partition\">\n                 <xs:sequence>\n                     <xs:element minOccurs=\"0\" name=\"description\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"id\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"isPublic\" type=\"xs:boolean\"></xs:element>\n-                    <xs:element minOccurs=\"0\" name=\"properties\" nillable=\"true\" type=\"ax25:Properties\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"properties\" nillable=\"true\" type=\"ax27:Properties\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"provider\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                 </xs:sequence>\n             </xs:complexType>\n             <xs:complexType name=\"ApplicationLevelNetworkPartition\">\n                 <xs:sequence>\n                     <xs:element minOccurs=\"0\" name=\"activeByDefault\" type=\"xs:boolean\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"id\" nillable=\"true\" type=\"xs:string\"></xs:element>\n-                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"partitions\" nillable=\"true\" type=\"ax24:Partition\"></xs:element>\n+                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"partitions\" nillable=\"true\" type=\"ax26:Partition\"></xs:element>\n                 </xs:sequence>\n             </xs:complexType>\n             <xs:complexType name=\"ChildLevelNetworkPartition\">\n                 <xs:sequence>\n-                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"childLevelPartitions\" nillable=\"true\" type=\"ax24:ChildLevelPartition\"></xs:element>\n+                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"childLevelPartitions\" nillable=\"true\" type=\"ax26:ChildLevelPartition\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"id\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"min\" type=\"xs:int\"></xs:element>\n                     <xs:element minOccurs=\"0\" name=\"partitionAlgo\" nillable=\"true\" type=\"xs:string\"></xs:element>\n@@ -191,7 +191,7 @@\n         <xs:schema attributeFormDefault=\"qualified\" elementFormDefault=\"qualified\" targetNamespace=\"http://common.stratos.apache.org/xsd\">\n             <xs:complexType name=\"Properties\">\n                 <xs:sequence>\n-                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"properties\" nillable=\"true\" type=\"ax25:Property\"></xs:element>\n+                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"properties\" nillable=\"true\" type=\"ax27:Property\"></xs:element>\n                 </xs:sequence>\n             </xs:complexType>\n             <xs:complexType name=\"Property\">\n@@ -201,420 +201,434 @@\n                 </xs:sequence>\n             </xs:complexType>\n         </xs:schema>\n-        <xs:schema xmlns:ax220=\"http://application.exception.autoscaler.stratos.apache.org/xsd\" xmlns:ax212=\"http://autoscale.policy.pojo.autoscaler.stratos.apache.org/xsd\" xmlns:ax213=\"http://network.partition.deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\" xmlns:ax28=\"http://deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\" xmlns:ax210=\"http://policy.exception.autoscaler.stratos.apache.org/xsd\" xmlns:ax223=\"http://pojo.applications.autoscaler.stratos.apache.org/xsd\" xmlns:ax225=\"http://exception.autoscaler.stratos.apache.org/xsd\" xmlns:ax226=\"http://common.stratos.apache.org/xsd\" xmlns:ax216=\"http://kubernetes.common.stratos.apache.org/xsd\" xmlns:ax228=\"http://pojo.autoscaler.stratos.apache.org/xsd\" xmlns:ax218=\"http://kubernetes.exception.autoscaler.stratos.apache.org/xsd\" attributeFormDefault=\"qualified\" elementFormDefault=\"qualified\" targetNamespace=\"http://api.autoscaler.stratos.apache.org\">\n-            <xs:import namespace=\"http://deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\"></xs:import>\n+        <xs:schema xmlns:ax215=\"http://kubernetes.common.stratos.apache.org/xsd\" xmlns:ax220=\"http://application.exception.autoscaler.stratos.apache.org/xsd\" xmlns:ax212=\"http://kubernetes.exception.autoscaler.stratos.apache.org/xsd\" xmlns:ax210=\"http://deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\" xmlns:ax223=\"http://pojo.applications.autoscaler.stratos.apache.org/xsd\" xmlns:ax225=\"http://exception.autoscaler.stratos.apache.org/xsd\" xmlns:ax226=\"http://common.stratos.apache.org/xsd\" xmlns:ax24=\"http://policy.exception.autoscaler.stratos.apache.org/xsd\" xmlns:ax216=\"http://network.partition.deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\" xmlns:ax228=\"http://pojo.autoscaler.stratos.apache.org/xsd\" xmlns:ax218=\"http://autoscale.policy.pojo.autoscaler.stratos.apache.org/xsd\" attributeFormDefault=\"qualified\" elementFormDefault=\"qualified\" targetNamespace=\"http://api.autoscaler.stratos.apache.org\">\n             <xs:import namespace=\"http://policy.exception.autoscaler.stratos.apache.org/xsd\"></xs:import>\n-            <xs:import namespace=\"http://autoscale.policy.pojo.autoscaler.stratos.apache.org/xsd\"></xs:import>\n-            <xs:import namespace=\"http://network.partition.deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\"></xs:import>\n-            <xs:import namespace=\"http://kubernetes.common.stratos.apache.org/xsd\"></xs:import>\n+            <xs:import namespace=\"http://deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\"></xs:import>\n             <xs:import namespace=\"http://kubernetes.exception.autoscaler.stratos.apache.org/xsd\"></xs:import>\n+            <xs:import namespace=\"http://kubernetes.common.stratos.apache.org/xsd\"></xs:import>\n+            <xs:import namespace=\"http://network.partition.deployment.policy.pojo.autoscaler.stratos.apache.org/xsd\"></xs:import>\n+            <xs:import namespace=\"http://autoscale.policy.pojo.autoscaler.stratos.apache.org/xsd\"></xs:import>\n             <xs:import namespace=\"http://application.exception.autoscaler.stratos.apache.org/xsd\"></xs:import>\n             <xs:import namespace=\"http://pojo.applications.autoscaler.stratos.apache.org/xsd\"></xs:import>\n             <xs:import namespace=\"http://exception.autoscaler.stratos.apache.org/xsd\"></xs:import>\n             <xs:import namespace=\"http://common.stratos.apache.org/xsd\"></xs:import>\n             <xs:import namespace=\"http://pojo.autoscaler.stratos.apache.org/xsd\"></xs:import>\n-            <xs:element name=\"getValidDeploymentPoliciesforCartridge\">\n+            <xs:element name=\"AutoScalerServiceInvalidPolicyException\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"cartridgeType\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"InvalidPolicyException\" nillable=\"true\" type=\"ax23:InvalidPolicyException\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getValidDeploymentPoliciesforCartridgeResponse\">\n+            <xs:element name=\"updateDeploymentPolicy\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax28:DeploymentPolicy\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"deploymentPolicy\" nillable=\"true\" type=\"ax25:DeploymentPolicy\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"AutoScalerServiceInvalidPolicyException\">\n+            <xs:element name=\"updateDeploymentPolicyResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"InvalidPolicyException\" nillable=\"true\" type=\"ax29:InvalidPolicyException\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"addDeploymentPolicy\">\n+            <xs:element name=\"AutoScalerServiceNonExistingKubernetesGroupException\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"deploymentPolicy\" nillable=\"true\" type=\"ax28:DeploymentPolicy\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"NonExistingKubernetesGroupException\" nillable=\"true\" type=\"ax212:NonExistingKubernetesGroupException\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"addDeploymentPolicyResponse\">\n+            <xs:element name=\"getKubernetesGroup\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"kubernetesGroupId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"updateDeploymentPolicy\">\n+            <xs:element name=\"getKubernetesGroupResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"deploymentPolicy\" nillable=\"true\" type=\"ax28:DeploymentPolicy\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax215:KubernetesGroup\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"updateDeploymentPolicyResponse\">\n+            <xs:element name=\"getPartitionsOfGroup\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"deploymentPolicyId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"groupId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"addAutoScalingPolicy\">\n+            <xs:element name=\"getPartitionsOfGroupResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"autoscalePolicy\" nillable=\"true\" type=\"ax212:AutoscalePolicy\"></xs:element>\n+                        <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax26:Partition\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"addAutoScalingPolicyResponse\">\n+            <xs:element name=\"getAutoscalingPolicy\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"autoscalingPolicyId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"updateAutoScalingPolicy\">\n+            <xs:element name=\"getAutoscalingPolicyResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"autoscalePolicy\" nillable=\"true\" type=\"ax212:AutoscalePolicy\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax217:AutoscalePolicy\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"updateAutoScalingPolicyResponse\">\n+            <xs:element name=\"AutoScalerServiceApplicationDefinitionException\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"ApplicationDefinitionException\" nillable=\"true\" type=\"ax219:ApplicationDefinitionException\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getAutoscalingPolicy\">\n+            <xs:element name=\"deployApplicationDefinition\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"autoscalingPolicyId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"applicationContext\" nillable=\"true\" type=\"ax221:ApplicationContext\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getAutoscalingPolicyResponse\">\n+            <xs:element name=\"unDeployApplicationDefinition\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax212:AutoscalePolicy\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"applicationId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"tenantId\" type=\"xs:int\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"tenantDomain\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getNetworkPartitions\">\n+            <xs:element name=\"AutoScalerServiceInvalidKubernetesMasterException\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"deploymentPolicyId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"InvalidKubernetesMasterException\" nillable=\"true\" type=\"ax212:InvalidKubernetesMasterException\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getNetworkPartitionsResponse\">\n+            <xs:element name=\"AutoScalerServiceNonExistingKubernetesMasterException\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax24:ApplicationLevelNetworkPartition\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"NonExistingKubernetesMasterException\" nillable=\"true\" type=\"ax212:NonExistingKubernetesMasterException\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getAllKubernetesGroups\">\n+            <xs:element name=\"updateKubernetesMaster\">\n                 <xs:complexType>\n-                    <xs:sequence></xs:sequence>\n+                    <xs:sequence>\n+                        <xs:element minOccurs=\"0\" name=\"kubernetesMaster\" nillable=\"true\" type=\"ax215:KubernetesMaster\"></xs:element>\n+                    </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getAllKubernetesGroupsResponse\">\n+            <xs:element name=\"updateKubernetesMasterResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax216:KubernetesGroup\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"AutoScalerServiceNonExistingKubernetesGroupException\">\n+            <xs:element name=\"AutoScalerServiceInvalidKubernetesHostException\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"NonExistingKubernetesGroupException\" nillable=\"true\" type=\"ax217:NonExistingKubernetesGroupException\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"InvalidKubernetesHostException\" nillable=\"true\" type=\"ax212:InvalidKubernetesHostException\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getMasterForKubernetesGroup\">\n+            <xs:element name=\"AutoScalerServiceNonExistingKubernetesHostException\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"kubernetesGroupId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"NonExistingKubernetesHostException\" nillable=\"true\" type=\"ax212:NonExistingKubernetesHostException\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getMasterForKubernetesGroupResponse\">\n+            <xs:element name=\"updateKubernetesHost\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax216:KubernetesMaster\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"kubernetesHost\" nillable=\"true\" type=\"ax215:KubernetesHost\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getHostsForKubernetesGroup\">\n+            <xs:element name=\"updateKubernetesHostResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"kubernetesGroupId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getHostsForKubernetesGroupResponse\">\n+            <xs:element name=\"getAllDeploymentPolicies\">\n                 <xs:complexType>\n-                    <xs:sequence>\n-                        <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax216:KubernetesHost\"></xs:element>\n-                    </xs:sequence>\n+                    <xs:sequence></xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"AutoScalerServiceInvalidKubernetesGroupException\">\n+            <xs:element name=\"getAllDeploymentPoliciesResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"InvalidKubernetesGroupException\" nillable=\"true\" type=\"ax217:InvalidKubernetesGroupException\"></xs:element>\n+                        <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax25:DeploymentPolicy\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"addKubernetesGroup\">\n+            <xs:element name=\"getAllAutoScalingPolicy\">\n+                <xs:complexType>\n+                    <xs:sequence></xs:sequence>\n+                </xs:complexType>\n+            </xs:element>\n+            <xs:element name=\"getAllAutoScalingPolicyResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"kubernetesGroup\" nillable=\"true\" type=\"ax216:KubernetesGroup\"></xs:element>\n+                        <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax217:AutoscalePolicy\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"addKubernetesGroupResponse\">\n+            <xs:element name=\"getValidDeploymentPoliciesforCartridge\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"cartridgeType\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"AutoScalerServiceInvalidKubernetesHostException\">\n+            <xs:element name=\"getValidDeploymentPoliciesforCartridgeResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"InvalidKubernetesHostException\" nillable=\"true\" type=\"ax217:InvalidKubernetesHostException\"></xs:element>\n+                        <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax25:DeploymentPolicy\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"addKubernetesHost\">\n+            <xs:element name=\"addDeploymentPolicy\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"groupId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n-                        <xs:element minOccurs=\"0\" name=\"kubernetesHost\" nillable=\"true\" type=\"ax216:KubernetesHost\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"deploymentPolicy\" nillable=\"true\" type=\"ax25:DeploymentPolicy\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"addKubernetesHostResponse\">\n+            <xs:element name=\"addDeploymentPolicyResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"removeKubernetesGroup\">\n+            <xs:element name=\"undeployDeploymentPolicy\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"groupId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"applicationId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"removeKubernetesGroupResponse\">\n+            <xs:element name=\"undeployDeploymentPolicyResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n                         <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"AutoScalerServiceNonExistingKubernetesHostException\">\n+            <xs:element name=\"addAutoScalingPolicy\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"NonExistingKubernetesHostException\" nillable=\"true\" type=\"ax217:NonExistingKubernetesHostException\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"autoscalePolicy\" nillable=\"true\" type=\"ax217:AutoscalePolicy\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"removeKubernetesHost\">\n+            <xs:element name=\"addAutoScalingPolicyResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"hostId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"removeKubernetesHostResponse\">\n+            <xs:element name=\"updateAutoScalingPolicy\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"autoscalePolicy\" nillable=\"true\" type=\"ax217:AutoscalePolicy\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"AutoScalerServiceApplicationDefinitionException\">\n+            <xs:element name=\"updateAutoScalingPolicyResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"ApplicationDefinitionException\" nillable=\"true\" type=\"ax219:ApplicationDefinitionException\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"deployApplicationDefinition\">\n+            <xs:element name=\"getNetworkPartitions\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"applicationContext\" nillable=\"true\" type=\"ax221:ApplicationContext\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"deploymentPolicyId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"unDeployApplicationDefinition\">\n+            <xs:element name=\"getNetworkPartitionsResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"applicationId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n-                        <xs:element minOccurs=\"0\" name=\"tenantId\" type=\"xs:int\"></xs:element>\n-                        <xs:element minOccurs=\"0\" name=\"tenantDomain\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                        <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax26:ApplicationLevelNetworkPartition\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"AutoScalerServiceInvalidArgumentException\">\n+            <xs:element name=\"getAllKubernetesGroups\">\n+                <xs:complexType>\n+                    <xs:sequence></xs:sequence>\n+                </xs:complexType>\n+            </xs:element>\n+            <xs:element name=\"getAllKubernetesGroupsResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"InvalidArgumentException\" nillable=\"true\" type=\"ax224:InvalidArgumentException\"></xs:element>\n+                        <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax215:KubernetesGroup\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"updateClusterMonitor\">\n+            <xs:element name=\"getMasterForKubernetesGroup\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"clusterId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n-                        <xs:element minOccurs=\"0\" name=\"properties\" nillable=\"true\" type=\"ax25:Properties\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"kubernetesGroupId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"AutoScalerServiceInvalidServiceGroupException\">\n+            <xs:element name=\"getMasterForKubernetesGroupResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"InvalidServiceGroupException\" nillable=\"true\" type=\"ax217:InvalidServiceGroupException\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax215:KubernetesMaster\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"deployServiceGroup\">\n+            <xs:element name=\"getHostsForKubernetesGroup\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"servicegroup\" nillable=\"true\" type=\"ax228:ServiceGroup\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"kubernetesGroupId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"serviceGroupExist\">\n+            <xs:element name=\"getHostsForKubernetesGroupResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"serviceName\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                        <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax215:KubernetesHost\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"serviceGroupExistResponse\">\n+            <xs:element name=\"AutoScalerServiceInvalidKubernetesGroupException\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"InvalidKubernetesGroupException\" nillable=\"true\" type=\"ax212:InvalidKubernetesGroupException\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"AutoScalerServiceAutoScalerException\">\n+            <xs:element name=\"addKubernetesGroup\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"AutoScalerException\" nillable=\"true\" type=\"ax224:AutoScalerException\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"kubernetesGroup\" nillable=\"true\" type=\"ax215:KubernetesGroup\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"undeployServiceGroup\">\n+            <xs:element name=\"addKubernetesGroupResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"name\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"AutoScalerServiceInvalidKubernetesMasterException\">\n+            <xs:element name=\"addKubernetesHost\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"InvalidKubernetesMasterException\" nillable=\"true\" type=\"ax217:InvalidKubernetesMasterException\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"groupId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"kubernetesHost\" nillable=\"true\" type=\"ax215:KubernetesHost\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"AutoScalerServiceNonExistingKubernetesMasterException\">\n+            <xs:element name=\"addKubernetesHostResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"NonExistingKubernetesMasterException\" nillable=\"true\" type=\"ax217:NonExistingKubernetesMasterException\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"updateKubernetesMaster\">\n+            <xs:element name=\"removeKubernetesGroup\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"kubernetesMaster\" nillable=\"true\" type=\"ax216:KubernetesMaster\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"groupId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"updateKubernetesMasterResponse\">\n+            <xs:element name=\"removeKubernetesGroupResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n                         <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"updateKubernetesHost\">\n+            <xs:element name=\"removeKubernetesHost\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"kubernetesHost\" nillable=\"true\" type=\"ax216:KubernetesHost\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"hostId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"updateKubernetesHostResponse\">\n+            <xs:element name=\"removeKubernetesHostResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n                         <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getKubernetesGroup\">\n+            <xs:element name=\"AutoScalerServiceInvalidArgumentException\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"kubernetesGroupId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"InvalidArgumentException\" nillable=\"true\" type=\"ax224:InvalidArgumentException\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getKubernetesGroupResponse\">\n+            <xs:element name=\"updateClusterMonitor\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax216:KubernetesGroup\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"clusterId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"properties\" nillable=\"true\" type=\"ax27:Properties\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getPartitionsOfGroup\">\n+            <xs:element name=\"AutoScalerServiceInvalidServiceGroupException\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"deploymentPolicyId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n-                        <xs:element minOccurs=\"0\" name=\"groupId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"InvalidServiceGroupException\" nillable=\"true\" type=\"ax212:InvalidServiceGroupException\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getPartitionsOfGroupResponse\">\n+            <xs:element name=\"deployServiceGroup\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax24:Partition\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"servicegroup\" nillable=\"true\" type=\"ax228:ServiceGroup\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getAllDeploymentPolicies\">\n+            <xs:element name=\"serviceGroupExist\">\n                 <xs:complexType>\n-                    <xs:sequence></xs:sequence>\n+                    <xs:sequence>\n+                        <xs:element minOccurs=\"0\" name=\"serviceName\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                    </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getAllDeploymentPoliciesResponse\">\n+            <xs:element name=\"serviceGroupExistResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax28:DeploymentPolicy\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"return\" type=\"xs:boolean\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getAllAutoScalingPolicy\">\n+            <xs:element name=\"AutoScalerServiceAutoScalerException\">\n                 <xs:complexType>\n-                    <xs:sequence></xs:sequence>\n+                    <xs:sequence>\n+                        <xs:element minOccurs=\"0\" name=\"AutoScalerException\" nillable=\"true\" type=\"ax224:AutoScalerException\"></xs:element>\n+                    </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n-            <xs:element name=\"getAllAutoScalingPolicyResponse\">\n+            <xs:element name=\"undeployServiceGroup\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax212:AutoscalePolicy\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"name\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n@@ -628,7 +642,7 @@\n             <xs:element name=\"getDeploymentPolicyResponse\">\n                 <xs:complexType>\n                     <xs:sequence>\n-                        <xs:element minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax28:DeploymentPolicy\"></xs:element>\n+                        <xs:element minOccurs=\"0\" name=\"return\" nillable=\"true\" type=\"ax25:DeploymentPolicy\"></xs:element>\n                     </xs:sequence>\n                 </xs:complexType>\n             </xs:element>\n@@ -659,76 +673,76 @@\n                 </xs:complexType>\n             </xs:element>\n         </xs:schema>\n-        <xs:schema xmlns:ax215=\"http://common.stratos.apache.org/xsd\" attributeFormDefault=\"qualified\" elementFormDefault=\"qualified\" targetNamespace=\"http://kubernetes.common.stratos.apache.org/xsd\">\n-            <xs:import namespace=\"http://common.stratos.apache.org/xsd\"></xs:import>\n-            <xs:complexType name=\"KubernetesGroup\">\n+        <xs:schema attributeFormDefault=\"qualified\" elementFormDefault=\"qualified\" targetNamespace=\"http://kubernetes.exception.autoscaler.stratos.apache.org/xsd\">\n+            <xs:complexType name=\"NonExistingKubernetesGroupException\">\n                 <xs:sequence>\n-                    <xs:element minOccurs=\"0\" name=\"description\" nillable=\"true\" type=\"xs:string\"></xs:element>\n-                    <xs:element minOccurs=\"0\" name=\"groupId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n-                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"kubernetesHosts\" nillable=\"true\" type=\"ax214:KubernetesHost\"></xs:element>\n-                    <xs:element minOccurs=\"0\" name=\"kubernetesMaster\" nillable=\"true\" type=\"ax214:KubernetesMaster\"></xs:element>\n-                    <xs:element minOccurs=\"0\" name=\"portRange\" nillable=\"true\" type=\"ax214:PortRange\"></xs:element>\n-                    <xs:element minOccurs=\"0\" name=\"properties\" nillable=\"true\" type=\"ax25:Properties\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"message\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                 </xs:sequence>\n             </xs:complexType>\n-            <xs:complexType name=\"KubernetesHost\">\n+            <xs:complexType name=\"InvalidKubernetesMasterException\">\n                 <xs:sequence>\n-                    <xs:element minOccurs=\"0\" name=\"hostId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n-                    <xs:element minOccurs=\"0\" name=\"hostIpAddress\" nillable=\"true\" type=\"xs:string\"></xs:element>\n-                    <xs:element minOccurs=\"0\" name=\"hostname\" nillable=\"true\" type=\"xs:string\"></xs:element>\n-                    <xs:element minOccurs=\"0\" name=\"properties\" nillable=\"true\" type=\"ax25:Properties\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"message\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                 </xs:sequence>\n             </xs:complexType>\n-            <xs:complexType name=\"KubernetesMaster\">\n-                <xs:complexContent>\n-                    <xs:extension base=\"ax214:KubernetesHost\">\n-                        <xs:sequence>\n-                            <xs:element minOccurs=\"0\" name=\"endpoint\" nillable=\"true\" type=\"xs:string\"></xs:element>\n-                        </xs:sequence>\n-                    </xs:extension>\n-                </xs:complexContent>\n-            </xs:complexType>\n-            <xs:complexType name=\"PortRange\">\n+            <xs:complexType name=\"NonExistingKubernetesMasterException\">\n                 <xs:sequence>\n-                    <xs:element minOccurs=\"0\" name=\"lower\" type=\"xs:int\"></xs:element>\n-                    <xs:element minOccurs=\"0\" name=\"upper\" type=\"xs:int\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"message\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                 </xs:sequence>\n             </xs:complexType>\n-        </xs:schema>\n-        <xs:schema attributeFormDefault=\"qualified\" elementFormDefault=\"qualified\" targetNamespace=\"http://kubernetes.exception.autoscaler.stratos.apache.org/xsd\">\n-            <xs:complexType name=\"NonExistingKubernetesGroupException\">\n+            <xs:complexType name=\"InvalidKubernetesHostException\">\n                 <xs:sequence>\n                     <xs:element minOccurs=\"0\" name=\"message\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                 </xs:sequence>\n             </xs:complexType>\n-            <xs:complexType name=\"InvalidKubernetesGroupException\">\n+            <xs:complexType name=\"NonExistingKubernetesHostException\">\n                 <xs:sequence>\n                     <xs:element minOccurs=\"0\" name=\"message\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                 </xs:sequence>\n             </xs:complexType>\n-            <xs:complexType name=\"InvalidKubernetesHostException\">\n+            <xs:complexType name=\"InvalidKubernetesGroupException\">\n                 <xs:sequence>\n                     <xs:element minOccurs=\"0\" name=\"message\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                 </xs:sequence>\n             </xs:complexType>\n-            <xs:complexType name=\"NonExistingKubernetesHostException\">\n+            <xs:complexType name=\"InvalidServiceGroupException\">\n                 <xs:sequence>\n                     <xs:element minOccurs=\"0\" name=\"message\" nillable=\"true\" type=\"xs:string\"></xs:element>\n                 </xs:sequence>\n             </xs:complexType>\n-            <xs:complexType name=\"InvalidServiceGroupException\">\n+        </xs:schema>\n+        <xs:schema xmlns:ax214=\"http://common.stratos.apache.org/xsd\" attributeFormDefault=\"qualified\" elementFormDefault=\"qualified\" targetNamespace=\"http://kubernetes.common.stratos.apache.org/xsd\">\n+            <xs:import namespace=\"http://common.stratos.apache.org/xsd\"></xs:import>\n+            <xs:complexType name=\"KubernetesGroup\">\n                 <xs:sequence>\n-                    <xs:element minOccurs=\"0\" name=\"message\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"description\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"groupId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                    <xs:element maxOccurs=\"unbounded\" minOccurs=\"0\" name=\"kubernetesHosts\" nillable=\"true\" type=\"ax213:KubernetesHost\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"kubernetesMaster\" nillable=\"true\" type=\"ax213:KubernetesMaster\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"portRange\" nillable=\"true\" type=\"ax213:PortRange\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"properties\" nillable=\"true\" type=\"ax27:Properties\"></xs:element>\n                 </xs:sequence>\n             </xs:complexType>\n-            <xs:complexType name=\"InvalidKubernetesMasterException\">\n+            <xs:complexType name=\"KubernetesHost\">\n                 <xs:sequence>\n-                    <xs:element minOccurs=\"0\" name=\"message\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"hostId\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"hostIpAddress\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"hostname\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"properties\" nillable=\"true\" type=\"ax27:Properties\"></xs:element>\n                 </xs:sequence>\n             </xs:complexType>\n-            <xs:complexType name=\"NonExistingKubernetesMasterException\">\n+            <xs:complexType name=\"KubernetesMaster\">\n+                <xs:complexContent>\n+                    <xs:extension base=\"ax213:KubernetesHost\">\n+                        <xs:sequence>\n+                            <xs:element minOccurs=\"0\" name=\"endpoint\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                        </xs:sequence>\n+                    </xs:extension>\n+                </xs:complexContent>\n+            </xs:complexType>\n+            <xs:complexType name=\"PortRange\">\n                 <xs:sequence>\n-                    <xs:element minOccurs=\"0\" name=\"message\" nillable=\"true\" type=\"xs:string\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"lower\" type=\"xs:int\"></xs:element>\n+                    <xs:element minOccurs=\"0\" name=\"upper\" type=\"xs:int\"></xs:element>\n                 </xs:sequence>\n             </xs:complexType>\n         </xs:schema>\n@@ -950,6 +964,12 @@\n     <wsdl:message name=\"getNetworkPartitionsResponse\">\n         <wsdl:part name=\"parameters\" element=\"ns:getNetworkPartitionsResponse\"></wsdl:part>\n     </wsdl:message>\n+    <wsdl:message name=\"undeployDeploymentPolicyRequest\">\n+        <wsdl:part name=\"parameters\" element=\"ns:undeployDeploymentPolicy\"></wsdl:part>\n+    </wsdl:message>\n+    <wsdl:message name=\"undeployDeploymentPolicyResponse\">\n+        <wsdl:part name=\"parameters\" element=\"ns:undeployDeploymentPolicyResponse\"></wsdl:part>\n+    </wsdl:message>\n     <wsdl:portType name=\"AutoScalerServicePortType\">\n         <wsdl:operation name=\"updateKubernetesMaster\">\n             <wsdl:input message=\"ns:updateKubernetesMasterRequest\" wsaw:Action=\"urn:updateKubernetesMaster\"></wsdl:input>\n@@ -1092,6 +1112,10 @@\n             <wsdl:input message=\"ns:getNetworkPartitionsRequest\" wsaw:Action=\"urn:getNetworkPartitions\"></wsdl:input>\n             <wsdl:output message=\"ns:getNetworkPartitionsResponse\" wsaw:Action=\"urn:getNetworkPartitionsResponse\"></wsdl:output>\n         </wsdl:operation>\n+        <wsdl:operation name=\"undeployDeploymentPolicy\">\n+            <wsdl:input message=\"ns:undeployDeploymentPolicyRequest\" wsaw:Action=\"urn:undeployDeploymentPolicy\"></wsdl:input>\n+            <wsdl:output message=\"ns:undeployDeploymentPolicyResponse\" wsaw:Action=\"urn:undeployDeploymentPolicyResponse\"></wsdl:output>\n+        </wsdl:operation>\n     </wsdl:portType>\n     <wsdl:binding name=\"AutoScalerServiceSoap11Binding\" type=\"ns:AutoScalerServicePortType\">\n         <soap:binding transport=\"http://schemas.xmlsoap.org/soap/http\" style=\"document\"></soap:binding>\n@@ -1416,6 +1440,15 @@\n                 <soap:fault use=\"literal\" name=\"AutoScalerServiceNonExistingKubernetesGroupException\"></soap:fault>\n             </wsdl:fault>\n         </wsdl:operation>\n+        <wsdl:operation name=\"undeployDeploymentPolicy\">\n+            <soap:operation soapAction=\"urn:undeployDeploymentPolicy\" style=\"document\"></soap:operation>\n+            <wsdl:input>\n+                <soap:body use=\"literal\"></soap:body>\n+            </wsdl:input>\n+            <wsdl:output>\n+                <soap:body use=\"literal\"></soap:body>\n+            </wsdl:output>\n+        </wsdl:operation>\n         <wsdl:operation name=\"getNetworkPartitions\">\n             <soap:operation soapAction=\"urn:getNetworkPartitions\" style=\"document\"></soap:operation>\n             <wsdl:input>\n@@ -1749,6 +1782,15 @@\n                 <soap12:fault use=\"literal\" name=\"AutoScalerServiceNonExistingKubernetesGroupException\"></soap12:fault>\n             </wsdl:fault>\n         </wsdl:operation>\n+        <wsdl:operation name=\"undeployDeploymentPolicy\">\n+            <soap12:operation soapAction=\"urn:undeployDeploymentPolicy\" style=\"document\"></soap12:operation>\n+            <wsdl:input>\n+                <soap12:body use=\"literal\"></soap12:body>\n+            </wsdl:input>\n+            <wsdl:output>\n+                <soap12:body use=\"literal\"></soap12:body>\n+            </wsdl:output>\n+        </wsdl:operation>\n         <wsdl:operation name=\"getNetworkPartitions\">\n             <soap12:operation soapAction=\"urn:getNetworkPartitions\" style=\"document\"></soap12:operation>\n             <wsdl:input>\n@@ -2016,6 +2058,15 @@\n                 <mime:content type=\"text/xml\" part=\"parameters\"></mime:content>\n             </wsdl:output>\n         </wsdl:operation>\n+        <wsdl:operation name=\"undeployDeploymentPolicy\">\n+            <http:operation location=\"undeployDeploymentPolicy\"></http:operation>\n+            <wsdl:input>\n+                <mime:content type=\"text/xml\" part=\"parameters\"></mime:content>\n+            </wsdl:input>\n+            <wsdl:output>\n+                <mime:content type=\"text/xml\" part=\"parameters\"></mime:content>\n+            </wsdl:output>\n+        </wsdl:operation>\n         <wsdl:operation name=\"getNetworkPartitions\">\n             <http:operation location=\"getNetworkPartitions\"></http:operation>\n             <wsdl:input>\n@@ -2028,22 +2079,22 @@\n     </wsdl:binding>\n     <wsdl:service name=\"AutoScalerService\">\n         <wsdl:port name=\"AutoScalerServiceHttpSoap11Endpoint\" binding=\"ns:AutoScalerServiceSoap11Binding\">\n-            <soap:address location=\"http://172.17.42.1:9763/services/AutoScalerService.AutoScalerServiceHttpSoap11Endpoint/\"></soap:address>\n+            <soap:address location=\"http://192.168.30.23:9763/services/AutoScalerService.AutoScalerServiceHttpSoap11Endpoint/\"></soap:address>\n         </wsdl:port>\n         <wsdl:port name=\"AutoScalerServiceHttpsSoap11Endpoint\" binding=\"ns:AutoScalerServiceSoap11Binding\">\n-            <soap:address location=\"https://172.17.42.1:9443/services/AutoScalerService.AutoScalerServiceHttpsSoap11Endpoint/\"></soap:address>\n+            <soap:address location=\"https://192.168.30.23:9443/services/AutoScalerService.AutoScalerServiceHttpsSoap11Endpoint/\"></soap:address>\n         </wsdl:port>\n         <wsdl:port name=\"AutoScalerServiceHttpsSoap12Endpoint\" binding=\"ns:AutoScalerServiceSoap12Binding\">\n-            <soap12:address location=\"https://172.17.42.1:9443/services/AutoScalerService.AutoScalerServiceHttpsSoap12Endpoint/\"></soap12:address>\n+            <soap12:address location=\"https://192.168.30.23:9443/services/AutoScalerService.AutoScalerServiceHttpsSoap12Endpoint/\"></soap12:address>\n         </wsdl:port>\n         <wsdl:port name=\"AutoScalerServiceHttpSoap12Endpoint\" binding=\"ns:AutoScalerServiceSoap12Binding\">\n-            <soap12:address location=\"http://172.17.42.1:9763/services/AutoScalerService.AutoScalerServiceHttpSoap12Endpoint/\"></soap12:address>\n+            <soap12:address location=\"http://192.168.30.23:9763/services/AutoScalerService.AutoScalerServiceHttpSoap12Endpoint/\"></soap12:address>\n         </wsdl:port>\n         <wsdl:port name=\"AutoScalerServiceHttpEndpoint\" binding=\"ns:AutoScalerServiceHttpBinding\">\n-            <http:address location=\"http://172.17.42.1:9763/services/AutoScalerService.AutoScalerServiceHttpEndpoint/\"></http:address>\n+            <http:address location=\"http://192.168.30.23:9763/services/AutoScalerService.AutoScalerServiceHttpEndpoint/\"></http:address>\n         </wsdl:port>\n         <wsdl:port name=\"AutoScalerServiceHttpsEndpoint\" binding=\"ns:AutoScalerServiceHttpBinding\">\n-            <http:address location=\"https://172.17.42.1:9443/services/AutoScalerService.AutoScalerServiceHttpsEndpoint/\"></http:address>\n+            <http:address location=\"https://192.168.30.23:9443/services/AutoScalerService.AutoScalerServiceHttpsEndpoint/\"></http:address>\n         </wsdl:port>\n     </wsdl:service>\n </wsdl:definitions>\n\\ No newline at end of file",
                "deletions": 189
            },
            {
                "sha": "4213cbecd5f64572806490a3f378abf12c98cc1b",
                "filename": "service-stubs/org.apache.stratos.cloud.controller.service.stub/src/main/resources/CloudControllerService.wsdl",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/service-stubs/org.apache.stratos.cloud.controller.service.stub/src/main/resources/CloudControllerService.wsdl",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/service-stubs/org.apache.stratos.cloud.controller.service.stub/src/main/resources/CloudControllerService.wsdl",
                "status": "modified",
                "changes": 1805,
                "additions": 931,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/service-stubs/org.apache.stratos.cloud.controller.service.stub/src/main/resources/CloudControllerService.wsdl?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "deletions": 874
            },
            {
                "sha": "acdc39bf1db8c635cf80252a8a86db0165f2e6f3",
                "filename": "tools/stratos-installer/conf/setup.conf",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/tools/stratos-installer/conf/setup.conf",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/tools/stratos-installer/conf/setup.conf",
                "status": "modified",
                "changes": 2,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/tools/stratos-installer/conf/setup.conf?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -87,6 +87,8 @@ export openstack_credential=\"password\" # Openstack login password\n export openstack_jclouds_endpoint=\"http://hostname:5000/v2.0\"\n export openstack_keypair_name=\"\"\n export openstack_security_groups=\"\"\n+# default to nova. If you have neutron networking environment, set it to neutron\n+export openstack_networking_provider=\"nova\"\n \n # vCloud\n export vcloud_provider_enabled=false",
                "deletions": 0
            },
            {
                "sha": "ee8ffe8f08ea2a59a1a7cbff1d1fd175089d971f",
                "filename": "tools/stratos-installer/config/all/repository/conf/cloud-controller.xml",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/tools/stratos-installer/config/all/repository/conf/cloud-controller.xml",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/tools/stratos-installer/config/all/repository/conf/cloud-controller.xml",
                "status": "modified",
                "changes": 1,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/tools/stratos-installer/config/all/repository/conf/cloud-controller.xml?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -68,6 +68,7 @@\n                         <property name=\"jclouds.endpoint\" value=\"OPENSTACK_ENDPOINT\" />\n             \t\t<property name=\"jclouds.openstack-nova.auto-create-floating-ips\" value=\"false\"/>\n                         <property name=\"jclouds.api-version\" value=\"2.0/\" />\n+\t\t\t<property name=\"openstack.networking.provider\" value=\"OPENSTACK_NETWORKING_PROVIDER\" />\n                         <property name=\"X\" value=\"x\" />\n                         <property name=\"Y\" value=\"y\" />\n                         <property name=\"securityGroups\" value=\"OPENSTACK_SECURITY_GROUPS\"/>",
                "deletions": 0
            },
            {
                "sha": "73369f1268666ef26320254179bc233d6d76d66c",
                "filename": "tools/stratos-installer/config/cc/repository/conf/cloud-controller.xml",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/tools/stratos-installer/config/cc/repository/conf/cloud-controller.xml",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/tools/stratos-installer/config/cc/repository/conf/cloud-controller.xml",
                "status": "modified",
                "changes": 1,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/tools/stratos-installer/config/cc/repository/conf/cloud-controller.xml?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -69,6 +69,7 @@\n                         <property name=\"jclouds.endpoint\" value=\"OPENSTACK_ENDPOINT\" />\n             \t\t<property name=\"jclouds.openstack-nova.auto-create-floating-ips\" value=\"false\"/>\n                         <property name=\"jclouds.api-version\" value=\"2.0/\" />\n+\t\t\t<property name=\"openstack.networking.provider\" value=\"OPENSTACK_NETWORKING_PROVIDER\" />\n                         <property name=\"X\" value=\"x\" />\n                         <property name=\"Y\" value=\"y\" />\n                         <property name=\"securityGroups\" value=\"OPENSTACK_SECURITY_GROUPS\"/>",
                "deletions": 0
            },
            {
                "sha": "5ac36c18ccd43cd956a39187053fc2e6cc7bd65b",
                "filename": "tools/stratos-installer/openstack.sh",
                "blob_url": "https://github.com/apache/attic-stratos/blob/f58c585989a5b19df0e026d43bdd29660a56c118/tools/stratos-installer/openstack.sh",
                "raw_url": "https://github.com/apache/attic-stratos/raw/f58c585989a5b19df0e026d43bdd29660a56c118/tools/stratos-installer/openstack.sh",
                "status": "modified",
                "changes": 1,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/tools/stratos-installer/openstack.sh?ref=f58c585989a5b19df0e026d43bdd29660a56c118",
                "patch": "@@ -54,6 +54,7 @@ ${SED} -i \"s@OPENSTACK_PROVIDER_START@@g\" repository/conf/cloud-controller.xml\n ${SED} -i \"s@OPENSTACK_IDENTITY@$openstack_identity@g\"  repository/conf/cloud-controller.xml\n ${SED} -i \"s@OPENSTACK_CREDENTIAL@$openstack_credential@g\"  repository/conf/cloud-controller.xml\n ${SED} -i \"s@OPENSTACK_ENDPOINT@$openstack_jclouds_endpoint@g\"  repository/conf/cloud-controller.xml\n+${SED} -i \"s@OPENSTACK_NETWORKING_PROVIDER@$openstack_networking_provider@g\"  repository/conf/cloud-controller.xml\n ${SED} -i \"s@OPENSTACK_PROVIDER_END@@g\"  repository/conf/cloud-controller.xml\n ${SED} -i \"s@OPENSTACK_SECURITY_GROUPS@$openstack_security_groups@g\" repository/conf/cloud-controller.xml\n ${SED} -i \"s@OPENSTACK_KEYPAIR@$openstack_keypair_name@g\" repository/conf/cloud-controller.xml",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fix NPE when loading persisted applications from registry",
        "commit": "https://github.com/apache/attic-stratos/commit/b9591a4003faa36ff6c470b81d6bab185611eeff",
        "parent": "https://github.com/apache/attic-stratos/commit/1c45330227a76946bf16a9f936a5dbd0df84130e",
        "bug_id": "attic-stratos_48",
        "file": [
            {
                "sha": "18a6956d71587865535ef8de6696dc95a202e8ab",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/util/AutoscalerUtil.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/b9591a4003faa36ff6c470b81d6bab185611eeff/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/util/AutoscalerUtil.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/b9591a4003faa36ff6c470b81d6bab185611eeff/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/util/AutoscalerUtil.java",
                "status": "modified",
                "changes": 3,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/util/AutoscalerUtil.java?ref=b9591a4003faa36ff6c470b81d6bab185611eeff",
                "patch": "@@ -89,9 +89,8 @@ public static Applications loadApplicationsFromRegistry(Applications application\n             for (String appResourcePath : appResourcePaths) {\n                 applications.addApplication(getApplicationFromPath(appResourcePath));\n             }\n-            return applications;\n         }\n-        return null;\n+        return applications;\n     }\n \n     public static Application getApplication(String appId) {",
                "deletions": 2
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing NPE when GET non existing group",
        "commit": "https://github.com/apache/attic-stratos/commit/a249362d8d1a09caf40f5278091ea1baecc38a6a",
        "parent": "https://github.com/apache/attic-stratos/commit/fa667ff19e4055d5d2871b1f99aa0f47cf4222be",
        "bug_id": "attic-stratos_49",
        "file": [
            {
                "sha": "b7d15726228ac707048a11cb0c9e807fc2b9ac3b",
                "filename": "components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/grouping/deployer/DefaultServiceGroupDeployer.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/a249362d8d1a09caf40f5278091ea1baecc38a6a/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/grouping/deployer/DefaultServiceGroupDeployer.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/a249362d8d1a09caf40f5278091ea1baecc38a6a/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/grouping/deployer/DefaultServiceGroupDeployer.java",
                "status": "modified",
                "changes": 7,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/grouping/deployer/DefaultServiceGroupDeployer.java?ref=a249362d8d1a09caf40f5278091ea1baecc38a6a",
                "patch": "@@ -185,12 +185,15 @@ public ServiceGroupDefinition getServiceGroupDefinition(String serviceGroupDefin\n             asServiceClient = AutoscalerServiceClient.getServiceClient();\n \n             if (log.isDebugEnabled()) {\n-                log.debug(\"deploying to cloud controller service group \" + serviceGroupDefinitionName);\n+                log.debug(String.format(\"Calling AS to get service group %s\", serviceGroupDefinitionName));\n             }\n \n             ServiceGroup serviceGroup = asServiceClient.getServiceGroup(serviceGroupDefinitionName);\n-            ServiceGroupDefinition serviceGroupDef = populateServiceGroupDefinitionPojo(serviceGroup);\n+            if (serviceGroup == null) {\n+                return null;\n+            }\n \n+            ServiceGroupDefinition serviceGroupDef = populateServiceGroupDefinitionPojo(serviceGroup);\n             return serviceGroupDef;\n \n         } catch (AxisFault axisFault) {",
                "deletions": 2
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing a NPE in InstanceStatusListener",
        "commit": "https://github.com/apache/attic-stratos/commit/cc79d97a3a1a07d0fa1408a5158675d04b7c5e79",
        "parent": "https://github.com/apache/attic-stratos/commit/94a940d3c37f397253fb804d63fa03eee5382b81",
        "bug_id": "attic-stratos_50",
        "file": [
            {
                "sha": "37d08c140397169d7e2f4d1ed2d1f049afca736c",
                "filename": "components/org.apache.stratos.adc.mgt/src/main/java/org/apache/stratos/adc/mgt/listener/InstanceStatusListener.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/cc79d97a3a1a07d0fa1408a5158675d04b7c5e79/components/org.apache.stratos.adc.mgt/src/main/java/org/apache/stratos/adc/mgt/listener/InstanceStatusListener.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/cc79d97a3a1a07d0fa1408a5158675d04b7c5e79/components/org.apache.stratos.adc.mgt/src/main/java/org/apache/stratos/adc/mgt/listener/InstanceStatusListener.java",
                "status": "modified",
                "changes": 19,
                "additions": 13,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.adc.mgt/src/main/java/org/apache/stratos/adc/mgt/listener/InstanceStatusListener.java?ref=cc79d97a3a1a07d0fa1408a5158675d04b7c5e79",
                "patch": "@@ -18,10 +18,6 @@\n  */\n package org.apache.stratos.adc.mgt.listener;\n \n-import javax.jms.Message;\n-import javax.jms.MessageListener;\n-import javax.jms.TextMessage;\n-\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.stratos.adc.mgt.dao.CartridgeSubscriptionInfo;\n@@ -31,6 +27,10 @@\n import org.apache.stratos.messaging.util.Constants;\n import org.apache.stratos.messaging.util.Util;\n \n+import javax.jms.Message;\n+import javax.jms.MessageListener;\n+import javax.jms.TextMessage;\n+\n public class InstanceStatusListener implements MessageListener {\n \n     private static final Log log = LogFactory\n@@ -59,8 +59,15 @@ public void onMessage(Message message) {\n                 }\n \n                 CartridgeSubscriptionInfo subscription = PersistenceManager.getSubscriptionFromClusterId(clusterId);\n-                ArtifactUpdatePublisher publisher = new ArtifactUpdatePublisher(subscription.getRepository(), clusterId, String.valueOf(subscription.getTenantId()));\n-                publisher.publish();\n+                if (subscription.getRepository() != null) {\n+                    ArtifactUpdatePublisher publisher = new ArtifactUpdatePublisher(subscription.getRepository(), clusterId, String.valueOf(subscription.getTenantId()));\n+                    publisher.publish();\n+                }\n+                else {\n+                    //TODO: make this log debug\n+                    log.info(\"No repository found for subscription with alias: \" + subscription.getAlias() + \", type: \" + subscription.getCartridge() +\n+                        \". Not sending the Depsync event\");\n+                }\n             }\n         } catch (Exception e) {\n             if(log.isErrorEnabled()) {",
                "deletions": 6
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing NPE while deploying applications without properties",
        "commit": "https://github.com/apache/attic-stratos/commit/a61fc9d0b484826f87426132a1a2a5bc18ad60f3",
        "parent": "https://github.com/apache/attic-stratos/commit/44fd12546831fa5f16fbf0bfead35548f1511d71",
        "bug_id": "attic-stratos_51",
        "file": [
            {
                "sha": "97eda8984a225886cf2a52f57768e5be1fb7f109",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/services/ServiceUtils.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/a61fc9d0b484826f87426132a1a2a5bc18ad60f3/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/services/ServiceUtils.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/a61fc9d0b484826f87426132a1a2a5bc18ad60f3/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/services/ServiceUtils.java",
                "status": "modified",
                "changes": 14,
                "additions": 8,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/services/ServiceUtils.java?ref=a61fc9d0b484826f87426132a1a2a5bc18ad60f3",
                "patch": "@@ -136,13 +136,15 @@ static void deployApplicationDefinition (ApplicationDefinition appDefinition, Co\n         applicationContext.setTeantAdminUsername(userName);\n \n         Properties properties = new Properties();\n-        for(org.apache.stratos.manager.composite.application.beans.PropertyBean propertyBean : appDefinition.getProperty()) {\n-            Property property = new Property();\n-            property.setName(propertyBean.getName());\n-            property.setValue(propertyBean.getValue());\n-            properties.addProperties(property);\n+        if(appDefinition.getProperty() != null) {\n+            for (org.apache.stratos.manager.composite.application.beans.PropertyBean propertyBean : appDefinition.getProperty()) {\n+                Property property = new Property();\n+                property.setName(propertyBean.getName());\n+                property.setValue(propertyBean.getValue());\n+                properties.addProperties(property);\n+            }\n+            applicationContext.setProperties(properties);\n         }\n-        applicationContext.setProperties(properties);\n \n         try {\n             CloudControllerServiceClient.getServiceClient().deployApplicationDefinition(applicationContext);",
                "deletions": 6
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixig an NPE while adding cluster monitor",
        "commit": "https://github.com/apache/attic-stratos/commit/473f25b2c3e8c4c9a621db69e96b987dddd3aabb",
        "parent": "https://github.com/apache/attic-stratos/commit/4b0ef9864f394919a902ad60ab93e685a1cab1f8",
        "bug_id": "attic-stratos_52",
        "file": [
            {
                "sha": "1366bf85728d6108beadd13cdcd5c4ac2cce37bc",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/checker/StatusChecker.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/473f25b2c3e8c4c9a621db69e96b987dddd3aabb/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/checker/StatusChecker.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/473f25b2c3e8c4c9a621db69e96b987dddd3aabb/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/checker/StatusChecker.java",
                "status": "modified",
                "changes": 6,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/checker/StatusChecker.java?ref=473f25b2c3e8c4c9a621db69e96b987dddd3aabb",
                "patch": "@@ -56,7 +56,11 @@ public static StatusChecker getInstance() {\n      */\n     public void onMemberStatusChange(String clusterId) {\n         ClusterMonitor monitor = (ClusterMonitor) AutoscalerContext.getInstance().getMonitor(clusterId);\n-        boolean clusterActive = clusterActive(monitor);\n+        boolean clusterActive = false;\n+        if(monitor != null) {\n+            clusterActive = clusterActive(monitor);\n+\n+        }\n         log.info(\"Status checker running for [cluster] \" + clusterId +\n                 \" the status [clusterActive] \" + clusterActive);\n         // if active then notify upper layer",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing NPE when deploying group without dependencies",
        "commit": "https://github.com/apache/attic-stratos/commit/26a093993e57fa21e488ed4a72e6a6f5b205ee68",
        "parent": "https://github.com/apache/attic-stratos/commit/fade19d7916109a06b66656168aacc0f81572d30",
        "bug_id": "attic-stratos_53",
        "file": [
            {
                "sha": "68ccc5e64fd97177361c5312d0a16c8dd7eed785",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/impl/CloudControllerServiceImpl.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/26a093993e57fa21e488ed4a72e6a6f5b205ee68/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/impl/CloudControllerServiceImpl.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/26a093993e57fa21e488ed4a72e6a6f5b205ee68/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/impl/CloudControllerServiceImpl.java",
                "status": "modified",
                "changes": 24,
                "additions": 13,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/impl/CloudControllerServiceImpl.java?ref=26a093993e57fa21e488ed4a72e6a6f5b205ee68",
                "patch": "@@ -308,17 +308,19 @@ public void deployServiceGroup(ServiceGroup servicegroup) throws InvalidServiceG\n             log.debug(\"CloudControllerServiceImpl:deployServiceGroup:dependencies\" + dependencies);\n         }\n     \t\n-    \tString [] startupOrders = dependencies.getStartupOrders();\n-    \t\n-    \tif(log.isDebugEnabled()) {\n-            log.debug(\"CloudControllerServiceImpl:deployServiceGroup:startupOrders\" + startupOrders);\n-            \n-            if (startupOrders != null) {\n-            \tlog.debug(\"CloudControllerServiceImpl:deployServiceGroup:startupOrder:size\" + startupOrders.length);\n-            } else {\n-            \tlog.debug(\"CloudControllerServiceImpl:deployServiceGroup:startupOrder: is null\");\n-            }\n-        }\n+    \tif (dependencies != null) {\n+\t    \tString [] startupOrders = dependencies.getStartupOrders();\n+\t    \t\n+\t    \tif(log.isDebugEnabled()) {\n+\t            log.debug(\"CloudControllerServiceImpl:deployServiceGroup:startupOrders\" + startupOrders);\n+\t            \n+\t            if (startupOrders != null) {\n+\t            \tlog.debug(\"CloudControllerServiceImpl:deployServiceGroup:startupOrder:size\" + startupOrders.length);\n+\t            } else {\n+\t            \tlog.debug(\"CloudControllerServiceImpl:deployServiceGroup:startupOrder: is null\");\n+\t            }\n+\t        }\n+    \t}\n     \t\n     \tdataHolder.addServiceGroup(servicegroup);\n     \t",
                "deletions": 11
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing a compilation failure and a NPE",
        "commit": "https://github.com/apache/attic-stratos/commit/5fa84a08fd7051be17652b8377b155aed53e9cc5",
        "parent": "https://github.com/apache/attic-stratos/commit/13ef15c86080a22d65ac9830ba0ca147245a7bde",
        "bug_id": "attic-stratos_54",
        "file": [
            {
                "sha": "c269419f770093e1bd828530a22ed121ccfd43f2",
                "filename": "components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/conf/LoadBalancerConfiguration.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/5fa84a08fd7051be17652b8377b155aed53e9cc5/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/conf/LoadBalancerConfiguration.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/5fa84a08fd7051be17652b8377b155aed53e9cc5/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/conf/LoadBalancerConfiguration.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.load.balancer/src/main/java/org/apache/stratos/load/balancer/conf/LoadBalancerConfiguration.java?ref=5fa84a08fd7051be17652b8377b155aed53e9cc5",
                "patch": "@@ -441,7 +441,7 @@ private LoadBalancerConfiguration transform(Node loadBalancerNode) {\n \n                     for (Node clusterNode : clustersNode.getChildNodes()) {\n                         String clusterId = clusterNode.getName();\n-                        Cluster cluster = new Cluster(service.getServiceName(), clusterId, null, null);\n+                        Cluster cluster = new Cluster(service.getServiceName(), clusterId, null, null, null);\n \n                         String tenantRange = clusterNode.getProperty(Constants.CONF_PROPERTY_TENANT_RANGE);\n                         if (StringUtils.isNotBlank(tenantRange)) {",
                "deletions": 1
            },
            {
                "sha": "98377c42f353843020fc3b4208a70504d9984abb",
                "filename": "components/org.apache.stratos.metadataservice/src/main/java/org/apache/stratos/metadataservice/registry/CarbonRegistry.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/5fa84a08fd7051be17652b8377b155aed53e9cc5/components/org.apache.stratos.metadataservice/src/main/java/org/apache/stratos/metadataservice/registry/CarbonRegistry.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/5fa84a08fd7051be17652b8377b155aed53e9cc5/components/org.apache.stratos.metadataservice/src/main/java/org/apache/stratos/metadataservice/registry/CarbonRegistry.java",
                "status": "modified",
                "changes": 11,
                "additions": 9,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.metadataservice/src/main/java/org/apache/stratos/metadataservice/registry/CarbonRegistry.java?ref=5fa84a08fd7051be17652b8377b155aed53e9cc5",
                "patch": "@@ -176,8 +176,15 @@ public boolean removeCartridgeMetaDataDetails(String applicationName, String car\n \t                                                                                           throws Exception {\n \t\tRegistry registry = getGovernanceUserRegistry();\n \t\tString resourcePath = mainResource + applicationName + \"/\" + cartridgeType;\n-\t\tregistry.delete(resourcePath);\n-\t\treturn false;\n+        if (registry != null) {\n+\t\t    registry.delete(resourcePath);\n+            return true;\n+        } else {\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"Unable to delete the meta data since the Registry is NULL\");\n+            }\n+            return false;\n+        }\n \t}\n \n ",
                "deletions": 2
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing NPE when updating Kubernetes hosts",
        "commit": "https://github.com/apache/attic-stratos/commit/9ae2b3737da8222e5da6b2cf6cdf2a4ebca6d65c",
        "parent": "https://github.com/apache/attic-stratos/commit/9616b45042b70df80b85a8828a51592eca6c2aa8",
        "bug_id": "attic-stratos_55",
        "file": [
            {
                "sha": "1c45da6a3d0bd5eec1a03e133de966fdfda7ec5b",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/kubernetes/KubernetesManager.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/9ae2b3737da8222e5da6b2cf6cdf2a4ebca6d65c/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/kubernetes/KubernetesManager.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/9ae2b3737da8222e5da6b2cf6cdf2a4ebca6d65c/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/kubernetes/KubernetesManager.java",
                "status": "modified",
                "changes": 37,
                "additions": 23,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/kubernetes/KubernetesManager.java?ref=9ae2b3737da8222e5da6b2cf6cdf2a4ebca6d65c",
                "patch": "@@ -143,7 +143,7 @@ private void validateKubernetesHost(KubernetesHost kubernetesHost) throws Invali\n             throw new InvalidKubernetesHostException(\"Mandatory field Kubernetes host IP address has not been set \" +\n                     \"for [hostId] \" + kubernetesHost.getHostId());\n         }\n-        if (!InetAddresses.isInetAddress(kubernetesHost.getHostIpAddress())){\n+        if (!InetAddresses.isInetAddress(kubernetesHost.getHostIpAddress())) {\n             throw new InvalidKubernetesHostException(\"Kubernetes host ip address is invalid: \" + kubernetesHost.getHostIpAddress());\n         }\n     }\n@@ -207,12 +207,17 @@ public synchronized boolean addNewKubernetesHost(String kubernetesGroupId, Kuber\n         validateKubernetesHost(kubernetesHost);\n         try {\n             KubernetesGroup kubernetesGroupStored = getKubernetesGroup(kubernetesGroupId);\n+            ArrayList<KubernetesHost> kubernetesHostArrayList;\n \n-            if (kubernetesHostExists(kubernetesHost.getHostId())) {\n-                throw new InvalidKubernetesHostException(\"Kubernetes host already exists: [id] \" + kubernetesHost.getHostId());\n+            if (kubernetesGroupStored.getKubernetesHosts() == null) {\n+                kubernetesHostArrayList = new ArrayList<KubernetesHost>();\n+            } else {\n+                if (kubernetesHostExists(kubernetesHost.getHostId())) {\n+                    throw new InvalidKubernetesHostException(\"Kubernetes host already exists: [id] \" + kubernetesHost.getHostId());\n+                }\n+                kubernetesHostArrayList = new\n+                        ArrayList<KubernetesHost>(Arrays.asList(kubernetesGroupStored.getKubernetesHosts()));\n             }\n-            ArrayList<KubernetesHost> kubernetesHostArrayList = new\n-                    ArrayList<KubernetesHost>(Arrays.asList(kubernetesGroupStored.getKubernetesHosts()));\n             kubernetesHostArrayList.add(kubernetesHost);\n \n             // Update information model\n@@ -336,7 +341,7 @@ public synchronized boolean removeKubernetesHost(String kubernetesHostId) throws\n             KubernetesGroup kubernetesGroupStored = getKubernetesGroupContainingHost(kubernetesHostId);\n \n             // Kubernetes master can not be removed\n-            if (kubernetesGroupStored.getKubernetesMaster().getHostId().equals(kubernetesHostId)){\n+            if (kubernetesGroupStored.getKubernetesMaster().getHostId().equals(kubernetesHostId)) {\n                 throw new NonExistingKubernetesHostException(\"Kubernetes master is not allowed to be removed [id] \" + kubernetesHostId);\n             }\n \n@@ -387,12 +392,14 @@ public boolean kubernetesHostExists(String hostId) {\n             return false;\n         }\n         for (KubernetesGroup kubernetesGroup : kubernetesGroupsMap.values()) {\n-            for (KubernetesHost kubernetesHost : kubernetesGroup.getKubernetesHosts()) {\n-                if (kubernetesHost.getHostId().equals(hostId)) {\n-                    return true;\n+            if (kubernetesGroup.getKubernetesHosts() != null) {\n+                for (KubernetesHost kubernetesHost : kubernetesGroup.getKubernetesHosts()) {\n+                    if (kubernetesHost.getHostId().equals(hostId)) {\n+                        return true;\n+                    }\n                 }\n             }\n-            if (kubernetesGroup.getKubernetesMaster().getHostId().equals(hostId)) {\n+            if (hostId.equals(kubernetesGroup.getKubernetesMaster().getHostId())) {\n                 return true;\n             }\n         }\n@@ -438,12 +445,14 @@ public KubernetesGroup getKubernetesGroupContainingHost(String hostId) throws No\n             return null;\n         }\n         for (KubernetesGroup kubernetesGroup : kubernetesGroupsMap.values()) {\n-            if (kubernetesGroup.getKubernetesMaster().getHostId().equals(hostId)) {\n+            if (hostId.equals(kubernetesGroup.getKubernetesMaster().getHostId())) {\n                 return kubernetesGroup;\n             }\n-            for (KubernetesHost kubernetesHost : kubernetesGroup.getKubernetesHosts()) {\n-                if (kubernetesHost.getHostId().equals(hostId)) {\n-                    return kubernetesGroup;\n+            if (kubernetesGroup.getKubernetesHosts() != null) {\n+                for (KubernetesHost kubernetesHost : kubernetesGroup.getKubernetesHosts()) {\n+                    if (kubernetesHost.getHostId().equals(hostId)) {\n+                        return kubernetesGroup;\n+                    }\n                 }\n             }\n         }",
                "deletions": 14
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing a NPE when properties are null.",
        "commit": "https://github.com/apache/attic-stratos/commit/491fdb7e2873b9b8df587a1092792762352116d5",
        "parent": "https://github.com/apache/attic-stratos/commit/4979859567bee7cff655f98ea962178a654cc0b1",
        "bug_id": "attic-stratos_56",
        "file": [
            {
                "sha": "fb11847d7c45128ca3ad2792092b23c243fafeca",
                "filename": "components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/manager/CartridgeSubscriptionManager.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/491fdb7e2873b9b8df587a1092792762352116d5/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/manager/CartridgeSubscriptionManager.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/491fdb7e2873b9b8df587a1092792762352116d5/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/manager/CartridgeSubscriptionManager.java",
                "status": "modified",
                "changes": 20,
                "additions": 16,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/manager/CartridgeSubscriptionManager.java?ref=491fdb7e2873b9b8df587a1092792762352116d5",
                "patch": "@@ -140,9 +140,15 @@ public static SubscriptionInfo subscribeToCartridgeWithProperties(SubscriptionDa\n     }\n \n     private static String getLBClusterId(Properties propertiesReturnedByFilters) {\n-    \tfor (Property prop : propertiesReturnedByFilters.getProperties()) {\n-\t\t\tif(prop.getName().equals(CartridgeConstants.LB_CLUSTER_ID)) {\n-\t\t\t\treturn prop.getValue();\n+\t\tif (propertiesReturnedByFilters != null\n+\t\t\t\t&& propertiesReturnedByFilters.getProperties() != null) {\n+\t\t\tfor (Property prop : propertiesReturnedByFilters.getProperties()) {\n+\t\t\t\tif (prop == null) {\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\t\t\t\tif (prop.getName().equals(CartridgeConstants.LB_CLUSTER_ID)) {\n+\t\t\t\t\treturn prop.getValue();\n+\t\t\t\t}\n \t\t\t}\n \t\t}\n \t\treturn null;\n@@ -151,8 +157,14 @@ private static String getLBClusterId(Properties propertiesReturnedByFilters) {\n \tprivate static void appendProperties(\n \t\t\tProperties propertiesReturnedByFilters, Properties newProperties) {\n \n+\t\tif (newProperties.getProperties() == null) {\n+\t\t\treturn;\n+\t\t}\n     \tfor (Property property : newProperties.getProperties()) {\n-\t\t\tpropertiesReturnedByFilters.addProperties(property);\n+    \t\tif (property != null) {\n+    \t\t\t\n+    \t\t\tpropertiesReturnedByFilters.addProperties(property);\n+    \t\t}\n \t\t}\n     \t\n \t}",
                "deletions": 4
            },
            {
                "sha": "e1be62983a6c452bee6c03ef8fdf854c12700452",
                "filename": "components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/subscription/filter/LBCreationSubscriptionFilter.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/491fdb7e2873b9b8df587a1092792762352116d5/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/subscription/filter/LBCreationSubscriptionFilter.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/491fdb7e2873b9b8df587a1092792762352116d5/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/subscription/filter/LBCreationSubscriptionFilter.java",
                "status": "modified",
                "changes": 3,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.manager/src/main/java/org/apache/stratos/manager/subscription/filter/LBCreationSubscriptionFilter.java?ref=491fdb7e2873b9b8df587a1092792762352116d5",
                "patch": "@@ -65,7 +65,7 @@ public Properties execute(CartridgeInfo cartridgeInfo, SubscriptionData subscrip\n \t\t\n \t\tLBDataContext lbDataCtxt = null;\n         CartridgeSubscription lbCartridgeSubscription = null;\n-        Properties lbCartridgeSubscriptionProperties = null;\n+        Properties lbCartridgeSubscriptionProperties  = new Properties();\n \n \t\ttry {\n \t\t\t// get lb config reference\n@@ -92,7 +92,6 @@ public Properties execute(CartridgeInfo cartridgeInfo, SubscriptionData subscrip\n \t\t\t\tlbCartridgeSubscription = subscribeToLB(subscriptionData,\n \t\t\t\t\t\tlbDataCtxt, cartridgeInfo);\n \n-\t\t\t\tlbCartridgeSubscriptionProperties = new Properties();\n \t\t\t\tif (lbDataCtxt.getLbProperperties() != null\n \t\t\t\t\t\t&& !lbDataCtxt.getLbProperperties().isEmpty()) {\n \t\t\t\t\tlbCartridgeSubscriptionProperties.setProperties(lbDataCtxt",
                "deletions": 2
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing an NPE in the PendingMemeberWatcher due to no instances",
        "commit": "https://github.com/apache/attic-stratos/commit/fce3db71a691addf52f84ed60327cdb41af79e7f",
        "parent": "https://github.com/apache/attic-stratos/commit/6c8c0adb0f3f64a0afe102130bb790b28a35e328",
        "bug_id": "attic-stratos_57",
        "file": [
            {
                "sha": "4bbd73af59c08f5f1dbeae4a0097ae0228ae4051",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/partition/ClusterLevelPartitionContext.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/fce3db71a691addf52f84ed60327cdb41af79e7f/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/partition/ClusterLevelPartitionContext.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/fce3db71a691addf52f84ed60327cdb41af79e7f/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/partition/ClusterLevelPartitionContext.java",
                "status": "modified",
                "changes": 4,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/partition/ClusterLevelPartitionContext.java?ref=fce3db71a691addf52f84ed60327cdb41af79e7f",
                "patch": "@@ -671,7 +671,9 @@ public void run() {\n                             if(cluster != null) {\n                                 ClusterInstance instance = cluster.\n                                         getInstanceContexts(clusterInstanceId);\n-                                status = instance.getStatus();\n+                                if(instance!= null) {\n+                                    status = instance.getStatus();\n+                                }\n                             }\n                         }\n ",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing an NPE in the PendingMemeberWatcher due to no instances",
        "commit": "https://github.com/apache/attic-stratos/commit/a041c8b4c60eac5e0d4b475805446385155359f6",
        "parent": "https://github.com/apache/attic-stratos/commit/15d8ab99c2452d2dce1ffac34ac11da6d61d8001",
        "bug_id": "attic-stratos_58",
        "file": [
            {
                "sha": "9f3d7ce77e17b0d500975fccfbee2bda5cfae564",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/partition/ClusterLevelPartitionContext.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/a041c8b4c60eac5e0d4b475805446385155359f6/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/partition/ClusterLevelPartitionContext.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/a041c8b4c60eac5e0d4b475805446385155359f6/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/partition/ClusterLevelPartitionContext.java",
                "status": "modified",
                "changes": 5,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/partition/ClusterLevelPartitionContext.java?ref=a041c8b4c60eac5e0d4b475805446385155359f6",
                "patch": "@@ -29,6 +29,7 @@\n import org.apache.stratos.common.client.CloudControllerServiceClient;\n import org.apache.stratos.common.constants.StratosConstants;\n import org.apache.stratos.common.partition.PartitionRef;\n+import org.apache.stratos.messaging.domain.instance.ClusterInstance;\n import org.apache.stratos.messaging.domain.topology.Cluster;\n import org.apache.stratos.messaging.domain.topology.ClusterStatus;\n import org.apache.stratos.messaging.domain.topology.Service;\n@@ -668,7 +669,9 @@ public void run() {\n                         if(service != null) {\n                             Cluster cluster = service.getCluster(clusterId);\n                             if(cluster != null) {\n-                                status = cluster. getInstanceContexts(clusterInstanceId).getStatus();\n+                                ClusterInstance instance = cluster.\n+                                        getInstanceContexts(clusterInstanceId);\n+                                status = instance.getStatus();\n                             }\n                         }\n ",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing NPE when an application is not there",
        "commit": "https://github.com/apache/attic-stratos/commit/33aac2e64409e58d19f0ce5e35a17fa083ff198b",
        "parent": "https://github.com/apache/attic-stratos/commit/729ef7abb623752137c05a4f5a0e38e57f6d55ca",
        "bug_id": "attic-stratos_59",
        "file": [
            {
                "sha": "3ce9554578a8ab041caa55d0ce78c9f36776d317",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/33aac2e64409e58d19f0ce5e35a17fa083ff198b/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/33aac2e64409e58d19f0ce5e35a17fa083ff198b/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java",
                "status": "modified",
                "changes": 25,
                "additions": 14,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/api/StratosApiV41Utils.java?ref=33aac2e64409e58d19f0ce5e35a17fa083ff198b",
                "patch": "@@ -1910,18 +1910,21 @@ public static ApplicationInfoBean getApplicationRuntime(String applicationId)\n \n         try {\n             ApplicationManager.acquireReadLockForApplication(applicationId);\n-            Application application = ApplicationManager.getApplications().getApplication(applicationId);\n-            if (application.getInstanceContextCount() > 0\n-                    || (applicationContext != null &&\n-                    applicationContext.getStatus().equals(\"Deployed\"))) {\n+            Application application = ApplicationManager.getApplications().\n+                    getApplication(applicationId);\n+            if(application != null) {\n+                if (application.getInstanceContextCount() > 0\n+                        || (applicationContext != null &&\n+                        applicationContext.getStatus().equals(\"Deployed\"))) {\n \n-                if (application == null) {\n-                    return null;\n-                }\n-                applicationBean = ObjectConverter.convertApplicationToApplicationInstanceBean(application);\n-                for (ApplicationInstanceBean instanceBean : applicationBean.getApplicationInstances()) {\n-                    addClustersInstancesToApplicationInstanceBean(instanceBean, application);\n-                    addGroupsInstancesToApplicationInstanceBean(instanceBean, application);\n+                    if (application == null) {\n+                        return null;\n+                    }\n+                    applicationBean = ObjectConverter.convertApplicationToApplicationInstanceBean(application);\n+                    for (ApplicationInstanceBean instanceBean : applicationBean.getApplicationInstances()) {\n+                        addClustersInstancesToApplicationInstanceBean(instanceBean, application);\n+                        addGroupsInstancesToApplicationInstanceBean(instanceBean, application);\n+                    }\n                 }\n             }\n         } finally {",
                "deletions": 11
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing NPE when no partitions is there in network partition",
        "commit": "https://github.com/apache/attic-stratos/commit/5ca86e91868947e6b2df790c7392ee99ce79cc94",
        "parent": "https://github.com/apache/attic-stratos/commit/26509b49ffa8b0bedbe5655bab65f13f5ed1f4c3",
        "bug_id": "attic-stratos_60",
        "file": [
            {
                "sha": "7db6ccbfb7d90a6ecf70b4d1cadf549c538ffc96",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/util/converter/ObjectConverter.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/5ca86e91868947e6b2df790c7392ee99ce79cc94/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/util/converter/ObjectConverter.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/5ca86e91868947e6b2df790c7392ee99ce79cc94/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/util/converter/ObjectConverter.java",
                "status": "modified",
                "changes": 6,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/util/converter/ObjectConverter.java?ref=5ca86e91868947e6b2df790c7392ee99ce79cc94",
                "patch": "@@ -2110,8 +2110,10 @@ private static PartitionRef convertPartitionToASStubPartition(\n             NetworkPartitionRef networkPartitionRef = new NetworkPartitionRef();\n             networkPartitionRef.setId(networkPartitionReferenceBean.getId());\n             networkPartitionRef.setPartitionAlgo(networkPartitionReferenceBean.getPartitionAlgo());\n-            networkPartitionRef.setPartitionRefs(convertToASStubPartitions(\n-                    networkPartitionReferenceBean.getPartitions()));\n+            if(networkPartitionReferenceBean.getPartitions() != null) {\n+                networkPartitionRef.setPartitionRefs(convertToASStubPartitions(\n+                        networkPartitionReferenceBean.getPartitions()));\n+            }\n             networkPartitionRefList.add(networkPartitionRef);\n         }\n         return networkPartitionRefList.toArray(new NetworkPartitionRef[networkPartitionRefList.size()]);",
                "deletions": 2
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing NPE when lookup using parent instance iD",
        "commit": "https://github.com/apache/attic-stratos/commit/ac1711b94e24f2307f5b74171cb928f0f446e538",
        "parent": "https://github.com/apache/attic-stratos/commit/df5105466e3b240e94a337b8b0b4774de356b4e8",
        "bug_id": "attic-stratos_61",
        "file": [
            {
                "sha": "07d791fd488401365f0b2a46bbf95543fa0ddce5",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/Monitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/ac1711b94e24f2307f5b74171cb928f0f446e538/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/Monitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/ac1711b94e24f2307f5b74171cb928f0f446e538/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/Monitor.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/Monitor.java?ref=ac1711b94e24f2307f5b74171cb928f0f446e538",
                "patch": "@@ -187,7 +187,7 @@ public void removeInstance(String instanceId) {\n     public List<String> getInstancesByParentInstanceId(String parentInstanceId) {\n         List<String> instances = new ArrayList<String>();\n         for (Instance instance : instanceIdToInstanceMap.values()) {\n-            if (instance.getParentId().equals(parentInstanceId)) {\n+            if (instance.getParentId() != null && instance.getParentId().equals(parentInstanceId)) {\n                 instances.add(instance.getInstanceId());\n             }\n         }",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing a NPE in getSubscription(alias, configContext)",
        "commit": "https://github.com/apache/attic-stratos/commit/4b2d7343e3ee2c6402c3b4e4ff15f097aaaf4448",
        "parent": "https://github.com/apache/attic-stratos/commit/a311fc1c8e3289d33f07fac9d1aa2ccbbf817e3c",
        "bug_id": "attic-stratos_62",
        "file": [
            {
                "sha": "0f1df471382d021d24391dd4bd7ce9790ece2007",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/services/ServiceUtils.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/4b2d7343e3ee2c6402c3b4e4ff15f097aaaf4448/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/services/ServiceUtils.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/4b2d7343e3ee2c6402c3b4e4ff15f097aaaf4448/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/services/ServiceUtils.java",
                "status": "modified",
                "changes": 19,
                "additions": 12,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/services/ServiceUtils.java?ref=4b2d7343e3ee2c6402c3b4e4ff15f097aaaf4448",
                "patch": "@@ -805,13 +805,18 @@ static Cartridge getSubscription(String cartridgeAlias, ConfigurationContext con\n                 ,cartridge.getCartridgeType(), cartridge.getCartridgeAlias());\n         String cartridgeStatus = \"Inactive\";\n         int activeMemberCount = 0;\n-        Collection<Member> members = cluster.getMembers();\n-        for (Member member : members) {\n-\t\t\tif(member.isActive()) {\n-\t\t\t\tcartridgeStatus = \"Active\";\n-\t\t\t\tactiveMemberCount++;\n-\t\t\t}\n-\t\t}        \n+\n+        // cluster might not be created yet, so need to check\n+        if (cluster != null) {\n+            Collection<Member> members = cluster.getMembers();\n+            for (Member member : members) {\n+                if(member.isActive()) {\n+                    cartridgeStatus = \"Active\";\n+                    activeMemberCount++;\n+                }\n+            }\n+        }\n+\n         cartridge.setActiveInstances(activeMemberCount);\n \t\tcartridge.setStatus(cartridgeStatus);\n \t\treturn cartridge;",
                "deletions": 7
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Use logical AND to avoid NPE",
        "commit": "https://github.com/apache/attic-stratos/commit/ff227d7369eed26199cea9c111f026e9366c0188",
        "parent": "https://github.com/apache/attic-stratos/commit/3d7961ed41afbcce9af108b609b632aa17fe2128",
        "bug_id": "attic-stratos_63",
        "file": [
            {
                "sha": "dcaae0c821485c85cdca2ee71ebeab75c8f362c7",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/util/converter/PojoConverter.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/ff227d7369eed26199cea9c111f026e9366c0188/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/util/converter/PojoConverter.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/ff227d7369eed26199cea9c111f026e9366c0188/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/util/converter/PojoConverter.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/util/converter/PojoConverter.java?ref=ff227d7369eed26199cea9c111f026e9366c0188",
                "patch": "@@ -71,7 +71,7 @@ public static CartridgeConfig populateCartridgeConfigPojo (CartridgeDefinitionBe\n         }\n         \n         //IaaS\n-        if(cartridgeDefinitionBean.iaasProvider != null & !cartridgeDefinitionBean.iaasProvider.isEmpty()) {\n+        if(cartridgeDefinitionBean.iaasProvider != null && !cartridgeDefinitionBean.iaasProvider.isEmpty()) {\n             cartridgeConfig.setIaasConfigs(getIaasConfigsAsArray(cartridgeDefinitionBean.iaasProvider));\n         }\n         //LB",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fix NPE occurs due to passing wrong partition object",
        "commit": "https://github.com/apache/attic-stratos/commit/53ad7f4b5afdef4cbb4d2a49983c40c8b4450c28",
        "parent": "https://github.com/apache/attic-stratos/commit/ea98c489d9e119d43e890350fcec6a6d4985a5c6",
        "bug_id": "attic-stratos_64",
        "file": [
            {
                "sha": "296e43f2d860330d1b23c8391cd5b5015b168ddf",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/ClusterContext.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/53ad7f4b5afdef4cbb4d2a49983c40c8b4450c28/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/ClusterContext.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/53ad7f4b5afdef4cbb4d2a49983c40c8b4450c28/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/ClusterContext.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/context/cluster/ClusterContext.java?ref=53ad7f4b5afdef4cbb4d2a49983c40c8b4450c28",
                "patch": "@@ -297,7 +297,7 @@ private ClusterLevelNetworkPartitionContext addPartition(\n         //Creating cluster level partition context\n         ClusterLevelPartitionContext clusterLevelPartitionContext = new ClusterLevelPartitionContext(\n                 maxInstances,\n-                partition,\n+                partition3,\n                 clusterInstance.getNetworkPartitionId());\n         clusterLevelPartitionContext.setServiceName(cluster.getServiceName());\n         clusterLevelPartitionContext.setProperties(cluster.getProperties());",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fix NPE when single cartridge app is deployed",
        "commit": "https://github.com/apache/attic-stratos/commit/9e94e7bcba83c246209c206f880434d1cff03c9d",
        "parent": "https://github.com/apache/attic-stratos/commit/6de22b17678b90c27ae40f6662217ce999b235ca",
        "bug_id": "attic-stratos_65",
        "file": [
            {
                "sha": "5dee5ca013d185947df721f93eaf71a7e849cc2e",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/services/impl/AutoscalerServiceImpl.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/9e94e7bcba83c246209c206f880434d1cff03c9d/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/services/impl/AutoscalerServiceImpl.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/9e94e7bcba83c246209c206f880434d1cff03c9d/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/services/impl/AutoscalerServiceImpl.java",
                "status": "modified",
                "changes": 10,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/services/impl/AutoscalerServiceImpl.java?ref=9e94e7bcba83c246209c206f880434d1cff03c9d",
                "patch": "@@ -252,10 +252,12 @@ private void addApplicationSignUp(ApplicationContext applicationContext, String\n                     updateArtifactRepositoryList(artifactRepositoryList, cartridgeContexts);\n                 }\n \n-                CartridgeContext[] cartridgeContextsOfGroups = getCartridgeContextsOfGroupsRecursively(\n-                        components.getGroupContexts());\n-                if (cartridgeContextsOfGroups != null) {\n-                    updateArtifactRepositoryList(artifactRepositoryList, cartridgeContextsOfGroups);\n+                if(components.getGroupContexts() != null){\n+                    CartridgeContext[] cartridgeContextsOfGroups = getCartridgeContextsOfGroupsRecursively(\n+                            components.getGroupContexts());\n+                    if (cartridgeContextsOfGroups != null) {\n+                        updateArtifactRepositoryList(artifactRepositoryList, cartridgeContextsOfGroups);\n+                    }\n                 }\n \n                 ArtifactRepository[] artifactRepositoryArray = artifactRepositoryList.toArray(",
                "deletions": 4
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing NPE when a cartridge is removed twice",
        "commit": "https://github.com/apache/attic-stratos/commit/9c9b3b46fc35ecc6b44ed58f3f935f3b70985130",
        "parent": "https://github.com/apache/attic-stratos/commit/44d7e938dc073f58e7f2674b690e1da44f2c01af",
        "bug_id": "attic-stratos_66",
        "file": [
            {
                "sha": "a6347c1e61dfea085e0a33bf6e78cb4ecd5715b2",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/topology/TopologyBuilder.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/9c9b3b46fc35ecc6b44ed58f3f935f3b70985130/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/topology/TopologyBuilder.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/9c9b3b46fc35ecc6b44ed58f3f935f3b70985130/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/topology/TopologyBuilder.java",
                "status": "modified",
                "changes": 7,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/messaging/topology/TopologyBuilder.java?ref=9c9b3b46fc35ecc6b44ed58f3f935f3b70985130",
                "patch": "@@ -92,7 +92,12 @@ public static void handleServiceRemoved(List<Cartridge> cartridgeList) {\n         Topology topology = TopologyManager.getTopology();\n \n         for (Cartridge cartridge : cartridgeList) {\n-            if (topology.getService(cartridge.getType()).getClusters().size() == 0) {\n+            Service service = topology.getService(cartridge.getType());\n+            if(service == null){\n+                log.warn(\"Cartridge does not exist [cartidge] \" + cartridge);\n+                return;\n+            }\n+            if (service.getClusters().size() == 0) {\n                 if (topology.serviceExists(cartridge.getType())) {\n                     try {\n                         TopologyManager.acquireWriteLock();",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing NPE while instance id is null at group termination",
        "commit": "https://github.com/apache/attic-stratos/commit/e58874938c5279bef75508c75388e8b98cd62ea0",
        "parent": "https://github.com/apache/attic-stratos/commit/3bd2239709b2c97b55d7cdfef3d586889a37a1ee",
        "bug_id": "attic-stratos_67",
        "file": [
            {
                "sha": "c2901f25bc6a7f4c5adcbb5cf51d3420f0e3e185",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/ClusterStatusEventPublisher.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/e58874938c5279bef75508c75388e8b98cd62ea0/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/ClusterStatusEventPublisher.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/e58874938c5279bef75508c75388e8b98cd62ea0/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/ClusterStatusEventPublisher.java",
                "status": "modified",
                "changes": 19,
                "additions": 11,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/ClusterStatusEventPublisher.java?ref=e58874938c5279bef75508c75388e8b98cd62ea0",
                "patch": "@@ -184,15 +184,18 @@ public static void sendClusterTerminatingEvent(String appId, String serviceName,\n             if (service != null) {\n                 Cluster cluster = service.getCluster(clusterId);\n                 ClusterInstance clusterInstance = cluster.getInstanceContexts(instanceId);\n-                if (clusterInstance.isStateTransitionValid(ClusterStatus.Terminating)){\n-                    if (clusterInstance.getStatus() != ClusterStatus.Terminating) {\n-                        ClusterStatusClusterTerminatingEvent appStatusClusterTerminatingEvent =\n-                                new ClusterStatusClusterTerminatingEvent(appId, serviceName, clusterId, instanceId);\n \n-                        publishEvent(appStatusClusterTerminatingEvent);\n-                    } else {\n-                        if (log.isDebugEnabled()) {\n-                            log.warn(\"Cluster is already terminating, [cluster] \" + clusterId);\n+                if(clusterInstance != null){\n+                    if (clusterInstance.isStateTransitionValid(ClusterStatus.Terminating)){\n+                        if (clusterInstance.getStatus() != ClusterStatus.Terminating) {\n+                            ClusterStatusClusterTerminatingEvent appStatusClusterTerminatingEvent =\n+                                    new ClusterStatusClusterTerminatingEvent(appId, serviceName, clusterId, instanceId);\n+\n+                            publishEvent(appStatusClusterTerminatingEvent);\n+                        } else {\n+                            if (log.isDebugEnabled()) {\n+                                log.warn(\"Cluster is already terminating, [cluster] \" + clusterId);\n+                            }\n                         }\n                     }\n                 }",
                "deletions": 8
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "handling NPE when metadata keys are null in cartride info",
        "commit": "https://github.com/apache/attic-stratos/commit/210a84bcb1ecce9eeb8c25ed88cfdddd08162a37",
        "parent": "https://github.com/apache/attic-stratos/commit/55cd917f1268a874be10d887d5f13f58f4d854ee",
        "bug_id": "attic-stratos_68",
        "file": [
            {
                "sha": "5c11738f6c1694490f524f804a8ecc3a56005927",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/210a84bcb1ecce9eeb8c25ed88cfdddd08162a37/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/210a84bcb1ecce9eeb8c25ed88cfdddd08162a37/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java",
                "status": "modified",
                "changes": 15,
                "additions": 9,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/applications/parser/DefaultApplicationParser.java?ref=210a84bcb1ecce9eeb8c25ed88cfdddd08162a37",
                "patch": "@@ -365,12 +365,15 @@ private Application buildCompositeAppStructure(ApplicationContext applicationCon\n             }\n \n             // Add metadata keys defined in cartridges as export metadata keys\n-\t\t    for (String str : cartridgeInfo.getMetadataKeys()) {\n-\t\t\t    if(!StringUtils.isBlank(str)) {\n-\t\t\t\t    exportMetadataKeys.add(cartridgeContext.getSubscribableInfoContext()\n-\t\t\t\t                                           .getAlias() + METADATA_APPENDER + str);\n-\t\t\t    }\n-\t\t    }\n+\t\t    String[] metadataKeys = cartridgeInfo.getMetadataKeys();\n+\t\t    if (metadataKeys != null) {\n+\t\t    \tfor (String str : metadataKeys) {\n+\t\t    \t\tif(!StringUtils.isBlank(str)) {\n+\t\t    \t\t\texportMetadataKeys.add(cartridgeContext.getSubscribableInfoContext()\n+\t\t    \t\t\t\t\t.getAlias() + METADATA_APPENDER + str);\n+\t\t    \t\t}\n+\t\t    \t}\n+\t\t\t}\n \n             // get hostname and cluster id\n             ClusterInformation clusterInfo;",
                "deletions": 6
            },
            {
                "sha": "60b95eba6add46741b20339411078f6628494023",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/util/CloudControllerUtil.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/210a84bcb1ecce9eeb8c25ed88cfdddd08162a37/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/util/CloudControllerUtil.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/210a84bcb1ecce9eeb8c25ed88cfdddd08162a37/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/util/CloudControllerUtil.java",
                "status": "modified",
                "changes": 7,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/util/CloudControllerUtil.java?ref=210a84bcb1ecce9eeb8c25ed88cfdddd08162a37",
                "patch": "@@ -112,8 +112,13 @@ public static Cartridge toCartridge(CartridgeConfig config) {\n                 cartridge.setLoadBalancingIPType(LoadBalancingIPType.Public);\n             }\n         }\n-\t    cartridge.setMetadataKeys(config.getMetadataKeys());\n \n+        if (config.getMetadataKeys() == null) {\n+\t\t\tcartridge.setMetadataKeys(new String[0]);\n+\t\t} else {\n+\t\t\tcartridge.setMetadataKeys(config.getMetadataKeys());\n+\t\t}\n+        \n         org.apache.stratos.common.Properties props = config.getProperties();\n         if (props != null) {\n             for (Property prop : props.getProperties()) {",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Adding null check to avoid NPE in cluster monitor",
        "commit": "https://github.com/apache/attic-stratos/commit/9cd4e89b14fcc528ee117c1a037ee2a281ca67bf",
        "parent": "https://github.com/apache/attic-stratos/commit/d41193cb7a52e11a7353bd2c036c68257170c6d6",
        "bug_id": "attic-stratos_69",
        "file": [
            {
                "sha": "251ac46f4e9324f26a0b6929df512b81961a80f0",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/ClusterMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/9cd4e89b14fcc528ee117c1a037ee2a281ca67bf/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/ClusterMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/9cd4e89b14fcc528ee117c1a037ee2a281ca67bf/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/ClusterMonitor.java",
                "status": "modified",
                "changes": 11,
                "additions": 9,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/ClusterMonitor.java?ref=9cd4e89b14fcc528ee117c1a037ee2a281ca67bf",
                "patch": "@@ -19,6 +19,7 @@\n package org.apache.stratos.autoscaler.monitor.cluster;\n \n import org.apache.commons.configuration.XMLConfiguration;\n+import org.apache.commons.lang.StringUtils;\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.stratos.autoscaler.client.CloudControllerClient;\n@@ -1108,11 +1109,17 @@ public void run() {\n         return ((ClusterContext) this.clusterContext).getNetworkPartitionCtxts();\n     }\n \n-    public ClusterInstanceContext getClusterInstanceContext(String networkPartitionId, String instanceId) {\n-        Map<String, ClusterLevelNetworkPartitionContext> clusterLevelNetworkPartitionContextMap =\n+    public ClusterInstanceContext getClusterInstanceContext(String networkPartitionId, String instanceId) {Map<String, ClusterLevelNetworkPartitionContext> clusterLevelNetworkPartitionContextMap =\n                 ((ClusterContext) this.clusterContext).getNetworkPartitionCtxts();\n+        if(StringUtils.isBlank(networkPartitionId)) {\n+            throw new RuntimeException(\"Network partition id is null\");\n+        }\n         ClusterLevelNetworkPartitionContext networkPartitionContext =\n                 clusterLevelNetworkPartitionContextMap.get(networkPartitionId);\n+        if(networkPartitionContext == null) {\n+            throw new RuntimeException(\"Network partition context not found: [network-partition-id] \" +\n+            networkPartitionId);\n+        }\n         ClusterInstanceContext instanceContext = (ClusterInstanceContext) networkPartitionContext.\n                                                         getInstanceContext(instanceId);\n         return instanceContext;",
                "deletions": 2
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing NPE while accessing cluster lock and fixing ClusterResetEvent",
        "commit": "https://github.com/apache/attic-stratos/commit/22ae287527a4842fd63521f615aa38577127c056",
        "parent": "https://github.com/apache/attic-stratos/commit/48797b78636b2c7add8b0c7e8befe82ec9202057",
        "bug_id": "attic-stratos_70",
        "file": [
            {
                "sha": "368d7b47dc525e56b2ae7d055af7533686e71330",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/ClusterStatusEventPublisher.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/22ae287527a4842fd63521f615aa38577127c056/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/ClusterStatusEventPublisher.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/22ae287527a4842fd63521f615aa38577127c056/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/ClusterStatusEventPublisher.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/ClusterStatusEventPublisher.java?ref=22ae287527a4842fd63521f615aa38577127c056",
                "patch": "@@ -87,8 +87,8 @@ public static void sendClusterResetEvent(String appId, String serviceName, Strin\n     }\n \n     public static void sendClusterActivatedEvent(String appId, String serviceName, String clusterId) {\n+        TopologyManager.acquireReadLockForCluster(serviceName, clusterId);\n         try {\n-            TopologyManager.acquireReadLockForCluster(serviceName, clusterId);\n             Service service = TopologyManager.getTopology().getService(serviceName);\n             if (service != null) {\n                 Cluster cluster = service.getCluster(clusterId);",
                "deletions": 1
            },
            {
                "sha": "d446e88a88dcd29f5936bc99603b7d0fc5e10a4c",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/22ae287527a4842fd63521f615aa38577127c056/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/22ae287527a4842fd63521f615aa38577127c056/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "status": "modified",
                "changes": 7,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java?ref=22ae287527a4842fd63521f615aa38577127c056",
                "patch": "@@ -209,8 +209,8 @@ protected void onEvent(Event event) {\n             @Override\n             protected void onEvent(Event event) {\n                 log.info(\"[ClusterCreatedEvent] Received: \" + event.getClass());\n-                ClusterCreatedEvent clusterCreatedEvent = (ClusterCreatedEvent) event;\n-                String clusterId = clusterCreatedEvent.getCluster().getClusterId();\n+                ClusterResetEvent clusterResetEvent = (ClusterResetEvent) event;\n+                String clusterId = clusterResetEvent.getClusterId();\n                 AutoscalerContext asCtx = AutoscalerContext.getInstance();\n                 AbstractClusterMonitor monitor;\n                 monitor = asCtx.getClusterMonitor(clusterId);\n@@ -222,8 +222,9 @@ protected void onEvent(Event event) {\n                     return;\n                 }\n                 //changing the status in the monitor, will notify its parent monitor\n-                monitor.setStop(true);\n+                monitor.destroy();\n                 monitor.setStatus(ClusterStatus.Created);\n+\n             }\n         });\n ",
                "deletions": 3
            },
            {
                "sha": "48db3219cee47e5470abd6157d4c51d352ea8808",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/AbstractClusterMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/22ae287527a4842fd63521f615aa38577127c056/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/AbstractClusterMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/22ae287527a4842fd63521f615aa38577127c056/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/AbstractClusterMonitor.java",
                "status": "modified",
                "changes": 1,
                "additions": 0,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/AbstractClusterMonitor.java?ref=22ae287527a4842fd63521f615aa38577127c056",
                "patch": "@@ -67,7 +67,6 @@\n \tprivate static final Log log = LogFactory.getLog(AbstractClusterMonitor.class);\n \n     private String clusterId;\n-    private String serviceId;\n     private ClusterStatus status;\n     private int monitoringIntervalMilliseconds;\n ",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing an NPE while readin properties in cluster monitor",
        "commit": "https://github.com/apache/attic-stratos/commit/a2ba3e0559b1a006157f959384cab0aedb7933a6",
        "parent": "https://github.com/apache/attic-stratos/commit/87908a4412096c5e202e438924003af6d86a6626",
        "bug_id": "attic-stratos_71",
        "file": [
            {
                "sha": "57f8e36d1c35d5507f40f90a1b711d748e21dd7b",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/ClusterMonitorFactory.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/a2ba3e0559b1a006157f959384cab0aedb7933a6/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/ClusterMonitorFactory.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/a2ba3e0559b1a006157f959384cab0aedb7933a6/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/ClusterMonitorFactory.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/ClusterMonitorFactory.java?ref=a2ba3e0559b1a006157f959384cab0aedb7933a6",
                "patch": "@@ -188,7 +188,7 @@ private static VMServiceClusterMonitor getVMServiceClusterMonitor(Cluster cluste\n         // find lb reference type\n         java.util.Properties props = cluster.getProperties();\n \n-        if (props.containsKey(Constants.LOAD_BALANCER_REF)) {\n+        if (props != null && props.containsKey(Constants.LOAD_BALANCER_REF)) {\n             String value = props.getProperty(Constants.LOAD_BALANCER_REF);\n             clusterMonitor.setLbReferenceType(value);\n             if (log.isDebugEnabled()) {",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing a NPE in a debug log :D",
        "commit": "https://github.com/apache/attic-stratos/commit/5aac10ea462943c4d0eb68ab6564046528d81b18",
        "parent": "https://github.com/apache/attic-stratos/commit/6a29d398e5545eac4864f25539cf40f2e6b2c77e",
        "bug_id": "attic-stratos_72",
        "file": [
            {
                "sha": "16c66a5bfbdf92fbc53af35aee733851c3989a78",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/application/parser/DefaultApplicationParser.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/5aac10ea462943c4d0eb68ab6564046528d81b18/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/application/parser/DefaultApplicationParser.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/5aac10ea462943c4d0eb68ab6564046528d81b18/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/application/parser/DefaultApplicationParser.java",
                "status": "modified",
                "changes": 14,
                "additions": 9,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/application/parser/DefaultApplicationParser.java?ref=5aac10ea462943c4d0eb68ab6564046528d81b18",
                "patch": "@@ -78,12 +78,16 @@ public Application parse(Object obj) throws ApplicationDefinitionException {\n         // get the defined groups\n         Map<String, GroupContext> definedGroups = getDefinedGroups(applicationCtxt);\n         if (log.isDebugEnabled()) {\n-            Set<Map.Entry<String, GroupContext>> groupEntries = definedGroups.entrySet();\n-            log.debug(\"Defined Groups: [ \");\n-            for (Map.Entry<String, GroupContext> groupEntry : groupEntries) {\n-                log.debug(\"Group alias: \" + groupEntry.getKey());\n+            if (definedGroups != null) {\n+                Set<Map.Entry<String, GroupContext>> groupEntries = definedGroups.entrySet();\n+                log.debug(\"Defined Groups: [ \");\n+                for (Map.Entry<String, GroupContext> groupEntry : groupEntries) {\n+                    log.debug(\"Group alias: \" + groupEntry.getKey());\n+                }\n+                log.debug(\" ]\");\n+            } else {\n+                log.debug(\"No Group definitions found in app id \" + applicationCtxt.getApplicationId());\n             }\n-            log.debug(\" ]\");\n         }\n \n         // get the Subscribables Information",
                "deletions": 5
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing monitors start up time issue and NPE",
        "commit": "https://github.com/apache/attic-stratos/commit/aab7f1895e98987943ce23d859a4e7667942f56e",
        "parent": "https://github.com/apache/attic-stratos/commit/718445a8a7ea0449c7ae03b0704649f1aab02a3b",
        "bug_id": "attic-stratos_73",
        "file": [
            {
                "sha": "54b4cf82d818ecfb48e80b12258232d4163027da",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/grouping/DependencyBuilder.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/aab7f1895e98987943ce23d859a4e7667942f56e/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/grouping/DependencyBuilder.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/aab7f1895e98987943ce23d859a4e7667942f56e/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/grouping/DependencyBuilder.java",
                "status": "modified",
                "changes": 10,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/grouping/DependencyBuilder.java?ref=aab7f1895e98987943ce23d859a4e7667942f56e",
                "patch": "@@ -59,16 +59,16 @@\n             }\n         }\n         //TODO adding all the missed groups or clusters as the top child to the list\n-        for(Group group: component.getAliasToGroupMap().values()) {\n-            if(!startup.contains(group.getAlias())) {\n-                startup.add(group.getAlias());\n+        for(String grpAlias: component.getAliasToGroupMap().keySet()) {\n+            if(!startup.contains(\"group.\" + grpAlias)) {\n+                startup.add(\"group.\" + grpAlias);\n             }\n         }\n \n         for(Set<String> clusterIds: component.getServiceNameToClusterIdsMap().values()) {\n             for (String clusterId : clusterIds) {\n-                if(!startup.contains(clusterId)) {\n-                    startup.add(clusterId);\n+                if(!startup.contains(\"cartridge.\" + clusterId)) {\n+                    startup.add(\"cartridge.\" + clusterId);\n                 }\n             }\n         }",
                "deletions": 5
            },
            {
                "sha": "f056de200ab62bd7cdd798c73be735216893a0f6",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/aab7f1895e98987943ce23d859a4e7667942f56e/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/aab7f1895e98987943ce23d859a4e7667942f56e/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "status": "modified",
                "changes": 26,
                "additions": 15,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/topology/AutoscalerTopologyEventReceiver.java?ref=aab7f1895e98987943ce23d859a4e7667942f56e",
                "patch": "@@ -52,6 +52,7 @@\n \n     private TopologyEventReceiver topologyEventReceiver;\n     private boolean terminated;\n+    private boolean topologyInitialized;\n \n     public AutoscalerTopologyEventReceiver() {\n         this.topologyEventReceiver = new TopologyEventReceiver();\n@@ -89,10 +90,14 @@ private void addEventListeners() {\n             @Override\n             protected void onEvent(Event event) {\n                 try {\n-                    TopologyManager.acquireReadLock();\n-                   // for (Application application : TopologyManager.getTopology().getApplications()) {\n-                   //     startApplicationMonitor(application);\n-                   // }\n+                    if(!topologyInitialized) {\n+                        topologyInitialized = true;\n+                        TopologyManager.acquireReadLock();\n+                        for (Application application : TopologyManager.getTopology().getApplications()) {\n+                            startApplicationMonitor(application);\n+                        }\n+                    }\n+\n                 } catch (Exception e) {\n                     log.error(\"Error processing event\", e);\n                 } finally {\n@@ -495,12 +500,7 @@ public void run() {\n             ApplicationMonitor applicationMonitor = null;\n             int retries = 5;\n             boolean success = false;\n-            do {\n-                try {\n-                    Thread.sleep(5000);\n-                } catch (InterruptedException e1) {\n-                }\n-\n+            while (!success && retries != 0) {\n                 try {\n                     applicationMonitor = AutoscalerUtil.getApplicationMonitor(application);\n                     success = true;\n@@ -510,9 +510,13 @@ public void run() {\n                                     application.getId();\n                     log.debug(msg, e);\n                     retries--;\n+                    try {\n+                        Thread.sleep(5000);\n+                    } catch (InterruptedException e1) {\n+                    }\n \n                 }\n-            } while (!success && retries != 0);\n+            }\n \n             if (applicationMonitor == null) {\n                 String msg = \"Application monitor creation failed, even after retrying for 5 times, \"",
                "deletions": 11
            },
            {
                "sha": "dfaf720b5c22f27b87fd44fb2e8767d6b87c2b4f",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/Monitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/aab7f1895e98987943ce23d859a4e7667942f56e/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/Monitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/aab7f1895e98987943ce23d859a4e7667942f56e/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/Monitor.java",
                "status": "modified",
                "changes": 43,
                "additions": 23,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/Monitor.java?ref=aab7f1895e98987943ce23d859a4e7667942f56e",
                "patch": "@@ -53,6 +53,8 @@\n     protected ParentBehavior component;\n \n     public Monitor(ParentBehavior component) {\n+        groupMonitors = new HashMap<String, GroupMonitor>();\n+        abstractClusterMonitors = new HashMap<String, AbstractClusterMonitor>();\n         this.component = component;\n         startDependency();\n     }\n@@ -120,21 +122,19 @@ public void startDependency() {\n         if(!preOrderTraverse.isEmpty()) {\n             String dependency = preOrderTraverse.poll();\n             if (dependency.contains(\"group\")) {\n-                startGroupMonitor(this, dependency, component);\n+                startGroupMonitor(this, dependency.substring(6), component);\n             } else if (dependency.contains(\"cartridge\")) {\n-\n-                Set<String> clusterIds = component.getClusterIds(dependency);\n-                for (String clusterId : clusterIds) {\n+                /*String clusterId = component.findClusterId(dependency.substring(10));\n                     Cluster cluster = null;\n                     TopologyManager.acquireReadLock();\n+\n                     cluster = TopologyManager.getTopology().getService(dependency).getCluster(clusterId);\n                     TopologyManager.releaseReadLock();\n                     if (cluster != null) {\n                         startClusterMonitor(cluster);\n                     } else {\n                         //TODO throw exception since Topology is inconsistent\n-                    }\n-                }\n+                    }*/\n             }\n         } else {\n             //all the groups/clusters have been started and waiting for activation\n@@ -200,12 +200,7 @@ public void run() {\n             ClusterMonitor monitor = null;\n             int retries = 5;\n             boolean success = false;\n-            do {\n-                try {\n-                    Thread.sleep(5000);\n-                } catch (InterruptedException e1) {\n-                }\n-\n+            while (!success && retries != 0) {\n                 try {\n                     monitor = AutoscalerUtil.getClusterMonitor(cluster);\n                     success = true;\n@@ -214,13 +209,22 @@ public void run() {\n                     String msg = \"Cluster monitor creation failed for cluster: \" + cluster.getClusterId();\n                     log.debug(msg, e);\n                     retries--;\n+                    try {\n+                        Thread.sleep(5000);\n+                    } catch (InterruptedException e1) {\n+                    }\n \n                 } catch (PartitionValidationException e) {\n                     String msg = \"Cluster monitor creation failed for cluster: \" + cluster.getClusterId();\n                     log.debug(msg, e);\n                     retries--;\n+                    try {\n+                        Thread.sleep(5000);\n+                    } catch (InterruptedException e1) {\n+                    }\n                 }\n-            } while (!success && retries != 0);\n+\n+            }\n \n             if (monitor == null) {\n                 String msg = \"Cluster monitor creation failed, even after retrying for 5 times, \"\n@@ -256,12 +260,7 @@ public void run() {\n             GroupMonitor monitor = null;\n             int retries = 5;\n             boolean success = false;\n-            do {\n-                try {\n-                    Thread.sleep(5000);\n-                } catch (InterruptedException e1) {\n-                }\n-\n+            while (!success && retries != 0) {\n                 try {\n                     monitor = AutoscalerUtil.getGroupMonitor(group.getGroup(dependency));\n                     monitor.addObserver(parent);\n@@ -271,9 +270,13 @@ public void run() {\n                     String msg = \"Group monitor creation failed for group: \" + dependency;\n                     log.debug(msg, e);\n                     retries--;\n+                    try {\n+                        Thread.sleep(5000);\n+                    } catch (InterruptedException e1) {\n+                    }\n \n                 }\n-            } while (!success && retries != 0);\n+            }\n \n             if (monitor == null) {\n                 String msg = \"Group monitor creation failed, even after retrying for 5 times, \"",
                "deletions": 20
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing NPE bug in KubernetesManager, adding info logs",
        "commit": "https://github.com/apache/attic-stratos/commit/a3c4a5e851bf360e27a2b7b776a5a0e052262801",
        "parent": "https://github.com/apache/attic-stratos/commit/87a6a03216030fea137a17fd9ad465c634b2bf5e",
        "bug_id": "attic-stratos_74",
        "file": [
            {
                "sha": "4d5b7a6523f51ec16d4c85ae2efb358df14d9bac",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/kubernetes/KubernetesManager.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/a3c4a5e851bf360e27a2b7b776a5a0e052262801/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/kubernetes/KubernetesManager.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/a3c4a5e851bf360e27a2b7b776a5a0e052262801/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/kubernetes/KubernetesManager.java",
                "status": "modified",
                "changes": 61,
                "additions": 44,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/kubernetes/KubernetesManager.java?ref=a3c4a5e851bf360e27a2b7b776a5a0e052262801",
                "patch": "@@ -96,22 +96,26 @@ private void validateKubernetesGroup(KubernetesGroup kubernetesGroup) throws Inv\n             }\n \n             // Check for duplicate hostIds\n-            List<String> hostIds = new ArrayList<String>();\n-            hostIds.add(kubernetesGroup.getKubernetesMaster().getHostId());\n-            for (KubernetesHost kubernetesHost : kubernetesGroup.getKubernetesHosts()) {\n-                if (hostIds.contains(kubernetesHost.getHostId())) {\n-                    throw new InvalidKubernetesGroupException(\n-                            String.format(\"Kubernetes host [id] %s already defined in the request\", kubernetesHost.getHostId()));\n-                }\n+            if (kubernetesGroup.getKubernetesHosts() != null) {\n+                List<String> hostIds = new ArrayList<String>();\n+                hostIds.add(kubernetesGroup.getKubernetesMaster().getHostId());\n+\n+                for (KubernetesHost kubernetesHost : kubernetesGroup.getKubernetesHosts()) {\n+                    if (hostIds.contains(kubernetesHost.getHostId())) {\n+                        throw new InvalidKubernetesGroupException(\n+                                String.format(\"Kubernetes host [id] %s already defined in the request\", kubernetesHost.getHostId()));\n+                    }\n \n-                // check whether host already exists\n-                if (kubernetesHostExists(kubernetesHost.getHostId())) {\n-                    throw new InvalidKubernetesGroupException(\"Kubernetes host already exists [id] \" +\n-                            kubernetesHost.getHostId());\n-                }\n+                    // check whether host already exists\n+                    if (kubernetesHostExists(kubernetesHost.getHostId())) {\n+                        throw new InvalidKubernetesGroupException(\"Kubernetes host already exists [id] \" +\n+                                kubernetesHost.getHostId());\n+                    }\n \n-                hostIds.add(kubernetesHost.getHostId());\n+                    hostIds.add(kubernetesHost.getHostId());\n+                }\n             }\n+\n         } catch (InvalidKubernetesHostException e) {\n             throw new InvalidKubernetesGroupException(e.getMessage());\n         } catch (InvalidKubernetesMasterException e) {\n@@ -156,15 +160,22 @@ private void validateKubernetesMaster(KubernetesMaster kubernetesMaster) throws\n     public synchronized boolean addNewKubernetesGroup(KubernetesGroup kubernetesGroup)\n             throws InvalidKubernetesGroupException {\n \n+        if (kubernetesGroup == null){\n+            throw new InvalidKubernetesGroupException(\"Kubernetes Group can not be null\");\n+        }\n+        if (log.isInfoEnabled()){\n+            log.info(\"Deploying new Kubernetes group: \" + kubernetesGroup);\n+        }\n         validateKubernetesGroup(kubernetesGroup);\n         try {\n             validateKubernetesEndPointViaCloudController(kubernetesGroup.getKubernetesMaster());\n \n+            // Add to information model\n+            addKubernetesGroupToInformationModel(kubernetesGroup);\n+\n             // Persist the KubernetesGroup object in registry space\n             RegistryManager.getInstance().persistKubernetesGroup(kubernetesGroup);\n \n-            // Add to information model\n-            addKubernetesGroupToInformationModel(kubernetesGroup);\n             if (log.isInfoEnabled()) {\n                 log.info(String.format(\"Kubernetes group deployed successfully: [id] %s, [description] %s\",\n                         kubernetesGroup.getGroupId(), kubernetesGroup.getDescription()));\n@@ -182,9 +193,11 @@ public synchronized boolean addNewKubernetesHost(String kubernetesGroupId, Kuber\n             throws InvalidKubernetesHostException, NonExistingKubernetesGroupException {\n \n         if (StringUtils.isEmpty(kubernetesGroupId) || kubernetesHost == null) {\n-            return false;\n+            throw new InvalidKubernetesHostException(\"Kubernetes host can not be null\");\n+        }\n+        if (log.isInfoEnabled()){\n+            log.info(\"Deploying new Kubernetes Host: \" + kubernetesHost + \" for Kubernetes group id: \" + kubernetesGroupId);\n         }\n-\n         validateKubernetesHost(kubernetesHost);\n         try {\n             KubernetesGroup kubernetesGroupStored = getKubernetesGroup(kubernetesGroupId);\n@@ -223,6 +236,9 @@ public synchronized boolean updateKubernetesMaster(KubernetesMaster kubernetesMa\n             throws InvalidKubernetesMasterException, NonExistingKubernetesMasterException {\n \n         validateKubernetesMaster(kubernetesMaster);\n+        if (log.isInfoEnabled()){\n+            log.info(\"Updating Kubernetes master: \" + kubernetesMaster);\n+        }\n         try {\n             KubernetesGroup kubernetesGroupStored = getKubernetesGroupContainingHost(kubernetesMaster.getHostId());\n \n@@ -249,7 +265,12 @@ public synchronized boolean updateKubernetesMaster(KubernetesMaster kubernetesMa\n      */\n     public synchronized boolean updateKubernetesHost(KubernetesHost kubernetesHost)\n             throws InvalidKubernetesHostException, NonExistingKubernetesHostException {\n+\n         validateKubernetesHost(kubernetesHost);\n+        if (log.isInfoEnabled()){\n+            log.info(\"Updating Kubernetes Host: \" + kubernetesHost);\n+        }\n+\n         try {\n             KubernetesGroup kubernetesGroupStored = getKubernetesGroupContainingHost(kubernetesHost.getHostId());\n \n@@ -283,6 +304,9 @@ public synchronized boolean updateKubernetesHost(KubernetesHost kubernetesHost)\n      * Remove a registered Kubernetes group from registry\n      */\n     public synchronized boolean removeKubernetesGroup(String kubernetesGroupId) throws NonExistingKubernetesGroupException {\n+        if (log.isInfoEnabled()){\n+            log.info(\"Removing Kubernetes group: \" + kubernetesGroupId);\n+        }\n         try {\n             KubernetesGroup kubernetesGroupStored = getKubernetesGroup(kubernetesGroupId);\n \n@@ -305,6 +329,9 @@ public synchronized boolean removeKubernetesGroup(String kubernetesGroupId) thro\n      * Remove a registered Kubernetes host from registry\n      */\n     public synchronized boolean removeKubernetesHost(String kubernetesHostId) throws NonExistingKubernetesHostException {\n+        if (log.isInfoEnabled()){\n+            log.info(\"Removing Kubernetes Host: \" + kubernetesHostId);\n+        }\n         try {\n             KubernetesGroup kubernetesGroupStored = getKubernetesGroupContainingHost(kubernetesHostId);\n ",
                "deletions": 17
            },
            {
                "sha": "d3cbcb19694816328b69c819622cb9c1bbcf478d",
                "filename": "components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/kubernetes/KubernetesGroup.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/a3c4a5e851bf360e27a2b7b776a5a0e052262801/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/kubernetes/KubernetesGroup.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/a3c4a5e851bf360e27a2b7b776a5a0e052262801/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/kubernetes/KubernetesGroup.java",
                "status": "modified",
                "changes": 10,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/kubernetes/KubernetesGroup.java?ref=a3c4a5e851bf360e27a2b7b776a5a0e052262801",
                "patch": "@@ -84,11 +84,11 @@ public void setProperties(Properties properties) {\n \n     public String toString() {\n         return \"KubernetesGroup [groupId=\" + groupId +\n-                \" kubernetesHosts=\" + Arrays.toString(kubernetesHosts) +\n-                \"kubernetesMaster=\" + kubernetesMaster +\n-                \"portRange=\" + portRange +\n-                \"description=\" + description +\n-                \"properties=\" + properties + \"]\";\n+                \" , kubernetesHosts=\" + Arrays.toString(kubernetesHosts) +\n+                \" , kubernetesMaster=\" + kubernetesMaster +\n+                \" , portRange=\" + portRange +\n+                \" , description=\" + description +\n+                \" , properties=\" + properties + \"]\";\n     }\n \n     @Override",
                "deletions": 5
            },
            {
                "sha": "dee52030802acb8a38646b975b4e24c1dc0bd4a8",
                "filename": "components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/kubernetes/PortRange.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/a3c4a5e851bf360e27a2b7b776a5a0e052262801/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/kubernetes/PortRange.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/a3c4a5e851bf360e27a2b7b776a5a0e052262801/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/kubernetes/PortRange.java",
                "status": "modified",
                "changes": 4,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.common/src/main/java/org/apache/stratos/common/kubernetes/PortRange.java?ref=a3c4a5e851bf360e27a2b7b776a5a0e052262801",
                "patch": "@@ -41,4 +41,8 @@ public int getLower() {\n     public void setLower(int lower) {\n         this.lower = lower;\n     }\n+\n+    public String toString() {\n+        return \"[ upper=\" + upper + \" , lower=\" + lower + \" ]\";\n+    }\n }",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing a possible NPE, when the class name is null",
        "commit": "https://github.com/apache/attic-stratos/commit/3d32585c302c3c931815c013fb223a788b86963a",
        "parent": "https://github.com/apache/attic-stratos/commit/78c7dd22de074899904113720250b5b573da8509",
        "bug_id": "attic-stratos_75",
        "file": [
            {
                "sha": "a213adf2ad2c4e0cfd362d93e5a626d7596c59a4",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/util/CloudControllerUtil.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/3d32585c302c3c931815c013fb223a788b86963a/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/util/CloudControllerUtil.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/3d32585c302c3c931815c013fb223a788b86963a/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/util/CloudControllerUtil.java",
                "status": "modified",
                "changes": 8,
                "additions": 8,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/util/CloudControllerUtil.java?ref=3d32585c302c3c931815c013fb223a788b86963a",
                "patch": "@@ -246,6 +246,14 @@ public static Iaas setDefaultIaas(IaasProvider iaasProvider) throws InvalidIaasP\n \tprivate static Iaas loadIaas(IaasProvider iaasProvider)\n \t\t\tthrows InvalidIaasProviderException {\n \t\ttry {\n+\t\t\t\n+\t\t\tif(iaasProvider.getClassName() == null) {\n+\t\t\t\tString msg = \"You have not specified a class which represents the iaas of type: [\"\n+\t\t\t\t\t\t+ iaasProvider.getType() + \"].\";\n+\t\t\t\tlog.error(msg);\n+\t\t\t\tthrow new InvalidIaasProviderException(msg);\n+\t\t\t}\n+\t\t\t\n \t\t\tConstructor<?> c = Class.forName(iaasProvider.getClassName())\n \t\t\t\t\t.getConstructor(IaasProvider.class);\n \t\t\tIaas iaas = (Iaas) c.newInstance(iaasProvider);",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing possible NPEs when health stat come before member activated",
        "commit": "https://github.com/apache/attic-stratos/commit/58b06ce9193aa1bb2551db9097b6063cf1ac98a1",
        "parent": "https://github.com/apache/attic-stratos/commit/375bd1699d8c537b21dade88191d696ef4cd14c0",
        "bug_id": "attic-stratos_76",
        "file": [
            {
                "sha": "cab71e6ff3ea34d999d905b54b40cb5dacdb62b4",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/health/HealthEventMessageDelegator.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/58b06ce9193aa1bb2551db9097b6063cf1ac98a1/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/health/HealthEventMessageDelegator.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/58b06ce9193aa1bb2551db9097b6063cf1ac98a1/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/health/HealthEventMessageDelegator.java",
                "status": "modified",
                "changes": 31,
                "additions": 26,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/health/HealthEventMessageDelegator.java?ref=58b06ce9193aa1bb2551db9097b6063cf1ac98a1",
                "patch": "@@ -22,10 +22,7 @@\n \n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n-import org.apache.stratos.autoscaler.AutoscalerContext;\n-import org.apache.stratos.autoscaler.Constants;\n-import org.apache.stratos.autoscaler.NetworkPartitionContext;\n-import org.apache.stratos.autoscaler.PartitionContext;\n+import org.apache.stratos.autoscaler.*;\n import org.apache.stratos.autoscaler.client.cloud.controller.CloudControllerClient;\n import org.apache.stratos.autoscaler.exception.SpawningException;\n import org.apache.stratos.autoscaler.exception.TerminationException;\n@@ -213,6 +210,14 @@ public void run() {\n     private LoadAverage findLoadAverage(Event event) {\n         String memberId = event.getProperties().get(\"member_id\");\n         Member member = findMember(memberId);\n+\n+        if(member.isActive()){\n+            if(log.isDebugEnabled()){\n+                log.debug(String.format(\"Member activated event has not received for the member %s. Therefore ignoring\" +\n+                        \" the load average health stat\", memberId));\n+            }\n+            return null;\n+        }\n         if(member != null) {\n             String networkPartitionId = findNetworkPartitionId(memberId);\n             LoadAverage loadAverage = AutoscalerContext.getInstance().getMonitor(member.getClusterId())\n@@ -240,6 +245,15 @@ private LoadAverage findLoadAverage(Event event) {\n     private MemoryConsumption findMemoryConsumption(Event event) {\n         String memberId = event.getProperties().get(\"member_id\");\n         Member member = findMember(memberId);\n+\n+        if(member.isActive()){\n+            if(log.isDebugEnabled()){\n+                log.debug(String.format(\"Member activated event has not received for the member %s. Therefore ignoring\" +\n+                        \" the health stat\", memberId));\n+            }\n+            return null;\n+        }\n+\n         if(member != null) {\n             String networkPartitionId = findNetworkPartitionId(memberId);\n             MemoryConsumption memoryConsumption = AutoscalerContext.getInstance().getMonitor(member.getClusterId())\n@@ -333,7 +347,14 @@ private void handleMemberFaultEvent(String clusterId, String memberId) {\n         \tNetworkPartitionContext nwPartitionCtxt;\n             try{\n             \tTopologyManager.acquireReadLock();\n-            \tMember member = monitor.getMember(memberId);\n+            \tMember member = findMember(memberId);\n+                if(!member.isActive()){\n+                    if(log.isDebugEnabled()){\n+                        log.debug(String.format(\"Member activated event has not received for the member %s. Therefore ignoring\" +\n+                                \" the member fault health stat\", memberId));\n+                    }\n+                    return;\n+                }\n \t            if (null == member) {\n \t                // member has already terminated. So no action required\n \t                return;",
                "deletions": 5
            },
            {
                "sha": "30ed61a21049f2881733d5ac46a2fbd5aa400b95",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/AbstractMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/58b06ce9193aa1bb2551db9097b6063cf1ac98a1/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/AbstractMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/58b06ce9193aa1bb2551db9097b6063cf1ac98a1/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/AbstractMonitor.java",
                "status": "modified",
                "changes": 12,
                "additions": 0,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/AbstractMonitor.java?ref=58b06ce9193aa1bb2551db9097b6063cf1ac98a1",
                "patch": "@@ -88,18 +88,6 @@ public String getPartitionOfMember(String memberId){\n         }\n         return null;\n    \t}\n-        \n-    public Member getMember(String memberId){\n-    \t\n-        for(Service service: TopologyManager.getTopology().getServices()){\n-            for(Cluster cluster: service.getClusters()){\n-                if(cluster.memberExists(memberId)){\n-                    return cluster.getMember(memberId);\n-                }\n-            }\n-        }\n-        return null;\n-   \t}\n     \n     public void destroy() {\n         minCheckKnowledgeSession.dispose();",
                "deletions": 12
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "AS npe exception when getting partition context for a member",
        "commit": "https://github.com/apache/attic-stratos/commit/6aac43bc405dd50887d2935f0c0bc6958b03ec61",
        "parent": "https://github.com/apache/attic-stratos/commit/ede69d5cdedd8acd7ce4e1f1ad2b3cbcf2f61e19",
        "bug_id": "attic-stratos_77",
        "file": [
            {
                "sha": "e809db95ab7c7cd1287f94752d3e2ac248241521",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/AutoscalerContext.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/6aac43bc405dd50887d2935f0c0bc6958b03ec61/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/AutoscalerContext.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/6aac43bc405dd50887d2935f0c0bc6958b03ec61/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/AutoscalerContext.java",
                "status": "modified",
                "changes": 3,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/AutoscalerContext.java?ref=6aac43bc405dd50887d2935f0c0bc6958b03ec61",
                "patch": "@@ -24,7 +24,10 @@ private AutoscalerContext() {\n             log.error(\"Rule evaluateMinCheck error\", e);\n         }\n     }\n+    \n+    // Map<ClusterId, ClusterMonitor>\n     private Map<String, ClusterMonitor> monitors;\n+    // Map<LBClusterId, LBClusterMonitor>\n     private Map<String, LbClusterMonitor> lbMonitors;\n \n     public static AutoscalerContext getInstance() {",
                "deletions": 0
            },
            {
                "sha": "d8171e735b4faf36a19bb888951766aee25fa949",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/health/HealthEventMessageDelegator.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/6aac43bc405dd50887d2935f0c0bc6958b03ec61/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/health/HealthEventMessageDelegator.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/6aac43bc405dd50887d2935f0c0bc6958b03ec61/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/health/HealthEventMessageDelegator.java",
                "status": "modified",
                "changes": 30,
                "additions": 19,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/health/HealthEventMessageDelegator.java?ref=6aac43bc405dd50887d2935f0c0bc6958b03ec61",
                "patch": "@@ -37,6 +37,7 @@\n import org.apache.stratos.messaging.domain.topology.Cluster;\n import org.apache.stratos.messaging.domain.topology.Member;\n import org.apache.stratos.messaging.domain.topology.Service;\n+import org.apache.stratos.messaging.domain.topology.Topology;\n import org.apache.stratos.messaging.message.receiver.topology.TopologyManager;\n \n import javax.jms.TextMessage;\n@@ -319,29 +320,36 @@ private void handleMemberFaultEvent(String clusterId, String memberId) {\n         \tAutoscalerContext asCtx = AutoscalerContext.getInstance();\n         \tAbstractMonitor monitor = null;\n         \t\n-        \tif(asCtx.moniterExist(clusterId)){        \t\t\n-        \t\tmonitor = asCtx.getMonitor(clusterId);        \t\t\n-        \t}else if(asCtx.lbMoniterExist(clusterId)){        \t\t\n-        \t\tmonitor = asCtx.getLBMonitor(clusterId);        \t\t\n+        \tif(asCtx.moniterExist(clusterId)){\n+        \t\tmonitor = asCtx.getMonitor(clusterId);\n+        \t}else if(asCtx.lbMoniterExist(clusterId)){\n+        \t\tmonitor = asCtx.getLBMonitor(clusterId);\n         \t}else{\n         \t\tString errMsg = \"A monitor is not found for this custer\";\n         \t\tlog.error(errMsg);\n         \t\tthrow new RuntimeException(errMsg);\n-        \t}        \n-            \n-            if (!monitor.memberExist(memberId)) {\n-                // member has already terminated. So no action required\n-                return;\n+        \t}\n+        \t\n+        \tNetworkPartitionContext nwPartitionCtxt;\n+            try{\n+            \tTopologyManager.acquireReadLock();\n+            \tMember member = monitor.getMember(memberId);\n+\t            if (null == member) {\n+\t                // member has already terminated. So no action required\n+\t                return;\n+\t            } else{\n+\t            \tnwPartitionCtxt = monitor.getNetworkPartitionCtxt(member);\n+\t            }\n+            }finally{\n+            \tTopologyManager.releaseReadLock();\n             }\n-\n             // terminate the faulty member\n             CloudControllerClient ccClient = CloudControllerClient.getInstance();\n             ccClient.terminate(memberId);\n \n             // start a new member in the same Partition\n             String partitionId = monitor.getPartitionOfMember(memberId);\n             Partition partition = monitor.getDeploymentPolicy().getPartitionById(partitionId);\n-            NetworkPartitionContext nwPartitionCtxt = monitor.findNetworkPartition(memberId);\n             PartitionContext partitionCtxt = nwPartitionCtxt.getPartitionCtxt(partitionId);\n             \n             String lbClusterId = AutoscalerRuleEvaluator.getLbClusterId(partitionCtxt, nwPartitionCtxt);",
                "deletions": 11
            },
            {
                "sha": "aa2bb8c492a99b3fc3cdc9ea5c9ac2d1a37e562c",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/AbstractMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/6aac43bc405dd50887d2935f0c0bc6958b03ec61/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/AbstractMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/6aac43bc405dd50887d2935f0c0bc6958b03ec61/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/AbstractMonitor.java",
                "status": "modified",
                "changes": 157,
                "additions": 151,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/AbstractMonitor.java?ref=6aac43bc405dd50887d2935f0c0bc6958b03ec61",
                "patch": "@@ -18,8 +18,20 @@\n  */\n package org.apache.stratos.autoscaler.monitor;\n \n+import java.util.Map;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n import org.apache.stratos.autoscaler.NetworkPartitionContext;\n import org.apache.stratos.autoscaler.deployment.policy.DeploymentPolicy;\n+import org.apache.stratos.autoscaler.policy.model.AutoscalePolicy;\n+import org.apache.stratos.autoscaler.rule.AutoscalerRuleEvaluator;\n+import org.apache.stratos.messaging.domain.topology.Cluster;\n+import org.apache.stratos.messaging.domain.topology.Member;\n+import org.apache.stratos.messaging.domain.topology.Service;\n+import org.apache.stratos.messaging.message.receiver.topology.TopologyManager;\n+import org.drools.runtime.StatefulKnowledgeSession;\n+import org.drools.runtime.rule.FactHandle;\n \n /**\n  * Is responsible for monitoring a service cluster. This runs periodically\n@@ -29,19 +41,152 @@\n  */\n    abstract public class AbstractMonitor implements Runnable{\n \n+\tprivate static final Log log = LogFactory.getLog(AbstractMonitor.class);\n+\t// Map<NetworkpartitionId, Network Partition Context>\n+\tprotected Map<String, NetworkPartitionContext> networkPartitionCtxts;\n+\tprotected DeploymentPolicy deploymentPolicy;\n+\tprotected AutoscalePolicy autoscalePolicy;\n+\t\n+\n+\tprotected FactHandle minCheckFactHandle;\n+\tprotected FactHandle scaleCheckFactHandle;\n+\t\n+\tprotected StatefulKnowledgeSession minCheckKnowledgeSession;\n+\tprotected StatefulKnowledgeSession scaleCheckKnowledgeSession;\n+\tprotected boolean isDestroyed;\n+\t\n+\tprotected String clusterId;\n+\tprotected String serviceId;\n+\t\n+\tprotected AutoscalerRuleEvaluator autoscalerRuleEvaluator;\n+\t\n \t@Override\n \tpublic void run() {\n \t\t// TODO Auto-generated method stub\n \t\t\n \t}\n \t\n-\tpublic abstract String getPartitionOfMember(String memberId);\n-\tpublic abstract DeploymentPolicy getDeploymentPolicy();\n-\tpublic abstract boolean memberExist(String memberId);\n-\tpublic abstract NetworkPartitionContext findNetworkPartition(String memberId);\n+\t    \n+   \tpublic NetworkPartitionContext getNetworkPartitionCtxt(Member member) {\n+   \t\tlog.info(\"***** getNetworkPartitionCtxt \" + member.getNetworkPartitionId());\n+\t\tString networkPartitionId = member.getNetworkPartitionId();\n+    \tif(networkPartitionCtxts.containsKey(networkPartitionId)) {\n+    \t\tlog.info(\"returnnig network partition context \" + networkPartitionCtxts.get(networkPartitionId));\n+    \t\treturn networkPartitionCtxts.get(networkPartitionId);\n+    \t}\n+    \tlog.info(\"returning null getNetworkPartitionCtxt\");\n+   \t    return null;\n+   \t}\n+   \t\n+    public String getPartitionOfMember(String memberId){\n+        for(Service service: TopologyManager.getTopology().getServices()){\n+            for(Cluster cluster: service.getClusters()){\n+                if(cluster.memberExists(memberId)){\n+                    return cluster.getMember(memberId).getPartitionId();\n+                }\n+            }\n+        }\n+        return null;\n+   \t}\n+        \n+    public Member getMember(String memberId){\n+    \t\n+        for(Service service: TopologyManager.getTopology().getServices()){\n+            for(Cluster cluster: service.getClusters()){\n+                if(cluster.memberExists(memberId)){\n+                    return cluster.getMember(memberId);\n+                }\n+            }\n+        }\n+        return null;\n+   \t}\n+    \n+    public void destroy() {\n+        minCheckKnowledgeSession.dispose();\n+        scaleCheckKnowledgeSession.dispose();\n+        setDestroyed(true);\n+        if(log.isDebugEnabled()) {\n+            log.debug(\"Cluster Monitor Drools session has been disposed. \"+this.toString());\n+        }\n+    }\n+    \n+    public boolean isDestroyed() {\n+        return isDestroyed;\n+    }\n+\n+    public void setDestroyed(boolean isDestroyed) {\n+        this.isDestroyed = isDestroyed;\n+    }\n+\n+    public String getServiceId() {\n+        return serviceId;\n+    }\n+\n+    public void setServiceId(String serviceId) {\n+        this.serviceId = serviceId;\n+    }\n+\n+    public DeploymentPolicy getDeploymentPolicy() {\n+        return deploymentPolicy;\n+    }\n+\n+    public void setDeploymentPolicy(DeploymentPolicy deploymentPolicy) {\n+        this.deploymentPolicy = deploymentPolicy;\n+    }\n+\n+    public AutoscalePolicy getAutoscalePolicy() {\n+        return autoscalePolicy;\n+    }\n+\n+    public void setAutoscalePolicy(AutoscalePolicy autoscalePolicy) {\n+        this.autoscalePolicy = autoscalePolicy;\n+    }    \n+    \n+    public String getClusterId() {\n+        return clusterId;\n+    }\n+\n+    public void setClusterId(String clusterId) {\n+        this.clusterId = clusterId;\n+    }\n+\n+    public Map<String, NetworkPartitionContext> getNetworkPartitionCtxts() {\n+        return networkPartitionCtxts;\n+    }\n+\n+    public NetworkPartitionContext getNetworkPartitionCtxt(String networkPartitionId) {\n+        return networkPartitionCtxts.get(networkPartitionId);\n+    }\n+\n+    public void setPartitionCtxt(Map<String, NetworkPartitionContext> partitionCtxt) {\n+        this.networkPartitionCtxts = partitionCtxt;\n+    }\n+\n+    public boolean partitionCtxtAvailable(String partitionId) {\n+        return networkPartitionCtxts.containsKey(partitionId);\n+    }\n+\n+    public void addNetworkPartitionCtxt(NetworkPartitionContext ctxt) {\n+        this.networkPartitionCtxts.put(ctxt.getId(), ctxt);\n+    }\n+    \n+    public NetworkPartitionContext getPartitionCtxt(String id) {\n+        return this.networkPartitionCtxts.get(id);\n+    }\n+\n+    public StatefulKnowledgeSession getMinCheckKnowledgeSession() {\n+        return minCheckKnowledgeSession;\n+    }\n \n+    public void setMinCheckKnowledgeSession(StatefulKnowledgeSession minCheckKnowledgeSession) {\n+        this.minCheckKnowledgeSession = minCheckKnowledgeSession;\n+    }\n \n-    public abstract NetworkPartitionContext getNetworkPartitionCtxt(String networkPartitionId);\n+    public FactHandle getMinCheckFactHandle() {\n+        return minCheckFactHandle;\n+    }\n \n-    public abstract void destroy();\n+    public void setMinCheckFactHandle(FactHandle minCheckFactHandle) {\n+        this.minCheckFactHandle = minCheckFactHandle;\n+    }\n }\n\\ No newline at end of file",
                "deletions": 6
            },
            {
                "sha": "1d0bad4236003fbc2e08e8c6a2cd77512c419b98",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/ClusterMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/6aac43bc405dd50887d2935f0c0bc6958b03ec61/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/ClusterMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/6aac43bc405dd50887d2935f0c0bc6958b03ec61/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/ClusterMonitor.java",
                "status": "modified",
                "changes": 160,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/ClusterMonitor.java?ref=6aac43bc405dd50887d2935f0c0bc6958b03ec61",
                "patch": "@@ -18,21 +18,15 @@\n  */\n package org.apache.stratos.autoscaler.monitor;\n \n+import java.util.concurrent.ConcurrentHashMap;\n+\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.stratos.autoscaler.NetworkPartitionContext;\n import org.apache.stratos.autoscaler.PartitionContext;\n import org.apache.stratos.autoscaler.deployment.policy.DeploymentPolicy;\n import org.apache.stratos.autoscaler.policy.model.AutoscalePolicy;\n import org.apache.stratos.autoscaler.rule.AutoscalerRuleEvaluator;\n-import org.apache.stratos.messaging.domain.topology.Cluster;\n-import org.apache.stratos.messaging.domain.topology.Service;\n-import org.apache.stratos.messaging.message.receiver.topology.TopologyManager;\n-import org.drools.runtime.StatefulKnowledgeSession;\n-import org.drools.runtime.rule.FactHandle;\n-\n-import java.util.Map;\n-import java.util.concurrent.ConcurrentHashMap;\n \n /**\n  * Is responsible for monitoring a service cluster. This runs periodically\n@@ -42,30 +36,7 @@\n  */\n public class ClusterMonitor extends AbstractMonitor{\n \n-    private static final Log log = LogFactory.getLog(ClusterMonitor.class);\n-    private String clusterId;\n-\n-    private String serviceId;\n-\n-    //key: network partition id, value: Network partition context\n-    private Map<String, NetworkPartitionContext> networkPartitionCtxts;\n-\n-\n-    private StatefulKnowledgeSession minCheckKnowledgeSession;\n-    private StatefulKnowledgeSession scaleCheckKnowledgeSession;\n-    private boolean isDestroyed;\n-\n-    private DeploymentPolicy deploymentPolicy;\n-    private AutoscalePolicy autoscalePolicy;\n-\n-        // Key- MemberId Value- partitionId\n-//    private Map<String, String> memberPartitionMap;\n-\n-    private FactHandle minCheckFactHandle;\n-    private FactHandle scaleCheckFactHandle;\n-\n-    private AutoscalerRuleEvaluator autoscalerRuleEvaluator;\n-    \n+    private static final Log log = LogFactory.getLog(ClusterMonitor.class);    \n     private String lbReferenceType;\n \n     public ClusterMonitor(String clusterId, String serviceId, DeploymentPolicy deploymentPolicy,\n@@ -82,53 +53,7 @@ public ClusterMonitor(String clusterId, String serviceId, DeploymentPolicy deplo\n         networkPartitionCtxts = new ConcurrentHashMap<String, NetworkPartitionContext>();\n     }\n \n-    public String getClusterId() {\n-        return clusterId;\n-    }\n \n-    public void setClusterId(String clusterId) {\n-        this.clusterId = clusterId;\n-    }\n-\n-    public Map<String, NetworkPartitionContext> getNetworkPartitionCtxts() {\n-        return networkPartitionCtxts;\n-    }\n-\n-    public NetworkPartitionContext getNetworkPartitionCtxt(String networkPartitionId) {\n-        return networkPartitionCtxts.get(networkPartitionId);\n-    }\n-\n-    public void setPartitionCtxt(Map<String, NetworkPartitionContext> partitionCtxt) {\n-        this.networkPartitionCtxts = partitionCtxt;\n-    }\n-\n-    public boolean partitionCtxtAvailable(String partitionId) {\n-        return networkPartitionCtxts.containsKey(partitionId);\n-    }\n-\n-    public void addNetworkPartitionCtxt(NetworkPartitionContext ctxt) {\n-        this.networkPartitionCtxts.put(ctxt.getId(), ctxt);\n-    }\n-    \n-    public NetworkPartitionContext getPartitionCtxt(String id) {\n-        return this.networkPartitionCtxts.get(id);\n-    }\n-\n-    public StatefulKnowledgeSession getMinCheckKnowledgeSession() {\n-        return minCheckKnowledgeSession;\n-    }\n-\n-    public void setMinCheckKnowledgeSession(StatefulKnowledgeSession minCheckKnowledgeSession) {\n-        this.minCheckKnowledgeSession = minCheckKnowledgeSession;\n-    }\n-\n-    public FactHandle getMinCheckFactHandle() {\n-        return minCheckFactHandle;\n-    }\n-\n-    public void setMinCheckFactHandle(FactHandle minCheckFactHandle) {\n-        this.minCheckFactHandle = minCheckFactHandle;\n-    }\n \n     @Override\n     public void run() {\n@@ -189,97 +114,18 @@ private void monitor() {\n         }\n     }\n \n-    \n-    public void destroy() {\n-        minCheckKnowledgeSession.dispose();\n-        scaleCheckKnowledgeSession.dispose();\n-        setDestroyed(true);\n-        if(log.isDebugEnabled()) {\n-            log.debug(\"Cluster Monitor Drools session has been disposed. \"+this.toString());\n-        }\n-    }\n-\n-    public boolean isDestroyed() {\n-        return isDestroyed;\n-    }\n-\n-    public void setDestroyed(boolean isDestroyed) {\n-        this.isDestroyed = isDestroyed;\n-    }\n-\n-    public String getServiceId() {\n-        return serviceId;\n-    }\n-\n-    public void setServiceId(String serviceId) {\n-        this.serviceId = serviceId;\n-    }\n-\n-    public DeploymentPolicy getDeploymentPolicy() {\n-        return deploymentPolicy;\n-    }\n-\n-    public void setDeploymentPolicy(DeploymentPolicy deploymentPolicy) {\n-        this.deploymentPolicy = deploymentPolicy;\n-    }\n-\n-    public AutoscalePolicy getAutoscalePolicy() {\n-        return autoscalePolicy;\n-    }\n-\n     @Override\n     public String toString() {\n         return \"ClusterMonitor [clusterId=\" + clusterId + \", serviceId=\" + serviceId +\n                \", deploymentPolicy=\" + deploymentPolicy + \", autoscalePolicy=\" + autoscalePolicy +\n                \", lbReferenceType=\" + lbReferenceType + \"]\";\n     }\n \n-    public void setAutoscalePolicy(AutoscalePolicy autoscalePolicy) {\n-        this.autoscalePolicy = autoscalePolicy;\n-    }\n-\n-    public String getPartitionOfMember(String memberId){\n-        for(Service service: TopologyManager.getTopology().getServices()){\n-            for(Cluster cluster: service.getClusters()){\n-                if(cluster.memberExists(memberId)){\n-                    cluster.getMember(memberId).getPartitionId();\n-                }\n-            }\n-        }\n-        return null;\n-   \t}\n-\n-   \t@Override\n-    public boolean memberExist(String memberId){\n-        for(Service service: TopologyManager.getTopology().getServices()){\n-            for(Cluster cluster: service.getClusters()){\n-                if(cluster.memberExists(memberId)){\n-                    return true;\n-                }\n-            }\n-        }\n-        return false;\n-   \t}\n-\n     public String getLbReferenceType() {\n         return lbReferenceType;\n     }\n \n     public void setLbReferenceType(String lbReferenceType) {\n         this.lbReferenceType = lbReferenceType;\n     }\n-\n-\t@Override\n-\tpublic NetworkPartitionContext findNetworkPartition(String memberId) {\n-\t\t for(Service service: TopologyManager.getTopology().getServices()){\n-\t            for(Cluster cluster: service.getClusters()){\n-\n-                    String networkPartitionId = cluster.getMember(memberId).getNetworkPartitionId();\n-\t                if(networkPartitionCtxts.containsKey(networkPartitionId)) {\n-                        networkPartitionCtxts.get(networkPartitionId);\n-                    }\n-\t            }\n-\t      }\n-\t      return null;\n-\t}\n }",
                "deletions": 157
            },
            {
                "sha": "d5c1c92bc912b6d3e232335997f4912852b200a8",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/LbClusterMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/6aac43bc405dd50887d2935f0c0bc6958b03ec61/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/LbClusterMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/6aac43bc405dd50887d2935f0c0bc6958b03ec61/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/LbClusterMonitor.java",
                "status": "modified",
                "changes": 156,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/LbClusterMonitor.java?ref=6aac43bc405dd50887d2935f0c0bc6958b03ec61",
                "patch": "@@ -18,21 +18,15 @@\n  */\n package org.apache.stratos.autoscaler.monitor;\n \n+import java.util.concurrent.ConcurrentHashMap;\n+\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.stratos.autoscaler.NetworkPartitionContext;\n import org.apache.stratos.autoscaler.PartitionContext;\n import org.apache.stratos.autoscaler.deployment.policy.DeploymentPolicy;\n import org.apache.stratos.autoscaler.policy.model.AutoscalePolicy;\n import org.apache.stratos.autoscaler.rule.AutoscalerRuleEvaluator;\n-import org.apache.stratos.messaging.domain.topology.Cluster;\n-import org.apache.stratos.messaging.domain.topology.Service;\n-import org.apache.stratos.messaging.message.receiver.topology.TopologyManager;\n-import org.drools.runtime.StatefulKnowledgeSession;\n-import org.drools.runtime.rule.FactHandle;\n-\n-import java.util.Map;\n-import java.util.concurrent.ConcurrentHashMap;\n \n /**\n  * Is responsible for monitoring a service cluster. This runs periodically\n@@ -43,25 +37,6 @@\n public class LbClusterMonitor extends AbstractMonitor{\n \n     private static final Log log = LogFactory.getLog(LbClusterMonitor.class);\n-    private String clusterId;\n-    private String serviceId;\n-\n-    private Map<String, NetworkPartitionContext> networkPartitionCtxts;\n-\n-    private StatefulKnowledgeSession minCheckKnowledgeSession;\n-    private StatefulKnowledgeSession scaleCheckKnowledgeSession;\n-    private boolean isDestroyed;\n-\n-    private DeploymentPolicy deploymentPolicy;\n-    private AutoscalePolicy autoscalePolicy;\n-\n-        // Key- MemberId Value- partitionId\n-//    private Map<String, String> memberPartitionMap;\n-\n-    private FactHandle minCheckFactHandle;\n-    private FactHandle scaleCheckFactHandle;\n-\n-    private AutoscalerRuleEvaluator autoscalerRuleEvaluator;\n \n     public LbClusterMonitor(String clusterId, String serviceId, DeploymentPolicy deploymentPolicy,\n                             AutoscalePolicy autoscalePolicy) {\n@@ -77,54 +52,6 @@ public LbClusterMonitor(String clusterId, String serviceId, DeploymentPolicy dep\n         networkPartitionCtxts = new ConcurrentHashMap<String, NetworkPartitionContext>();\n     }\n \n-    public String getClusterId() {\n-        return clusterId;\n-    }\n-\n-    public void setClusterId(String clusterId) {\n-        this.clusterId = clusterId;\n-    }\n-\n-    public Map<String, NetworkPartitionContext> getNetworkPartitionCtxts() {\n-        return networkPartitionCtxts;\n-    }\n-\n-    public NetworkPartitionContext getNetworkPartitionCtxt(String networkPartitionId) {\n-        return networkPartitionCtxts.get(networkPartitionId);\n-    }\n-\n-    public void setPartitionCtxt(Map<String, NetworkPartitionContext> partitionCtxt) {\n-        this.networkPartitionCtxts = partitionCtxt;\n-    }\n-\n-    public boolean partitionCtxtAvailable(String partitionId) {\n-        return networkPartitionCtxts.containsKey(partitionId);\n-    }\n-\n-    public void addNetworkPartitionCtxt(NetworkPartitionContext ctxt) {\n-        this.networkPartitionCtxts.put(ctxt.getId(), ctxt);\n-    }\n-    \n-    public NetworkPartitionContext getPartitionCtxt(String id) {\n-        return this.networkPartitionCtxts.get(id);\n-    }\n-\n-    public StatefulKnowledgeSession getMinCheckKnowledgeSession() {\n-        return minCheckKnowledgeSession;\n-    }\n-\n-    public void setMinCheckKnowledgeSession(StatefulKnowledgeSession minCheckKnowledgeSession) {\n-        this.minCheckKnowledgeSession = minCheckKnowledgeSession;\n-    }\n-\n-    public FactHandle getMinCheckFactHandle() {\n-        return minCheckFactHandle;\n-    }\n-\n-    public void setMinCheckFactHandle(FactHandle minCheckFactHandle) {\n-        this.minCheckFactHandle = minCheckFactHandle;\n-    }\n-\n     @Override\n     public void run() {\n \n@@ -172,89 +99,12 @@ private void monitor() {\n             }\n \n         }\n-    }\n-\n-    \n-    public void destroy() {\n-        minCheckKnowledgeSession.dispose();\n-        scaleCheckKnowledgeSession.dispose();\n-        setDestroyed(true);\n-        if(log.isDebugEnabled()) {\n-            log.debug(\"Cluster Monitor Drools session has been disposed. \"+this.toString());\n-        }\n-    }\n-\n-    public boolean isDestroyed() {\n-        return isDestroyed;\n-    }\n-\n-    public void setDestroyed(boolean isDestroyed) {\n-        this.isDestroyed = isDestroyed;\n-    }\n-\n-    public String getServiceId() {\n-        return serviceId;\n-    }\n-\n-    public void setServiceId(String serviceId) {\n-        this.serviceId = serviceId;\n-    }\n-\n-    public DeploymentPolicy getDeploymentPolicy() {\n-        return deploymentPolicy;\n-    }\n-\n-    public void setDeploymentPolicy(DeploymentPolicy deploymentPolicy) {\n-        this.deploymentPolicy = deploymentPolicy;\n-    }\n-\n-    public AutoscalePolicy getAutoscalePolicy() {\n-        return autoscalePolicy;\n-    }\n-\n-    public void setAutoscalePolicy(AutoscalePolicy autoscalePolicy) {\n-        this.autoscalePolicy = autoscalePolicy;\n-    }\n-\n-    public String getPartitionOfMember(String memberId){\n-        for(Service service: TopologyManager.getTopology().getServices()){\n-            for(Cluster cluster: service.getClusters()){\n-                if(cluster.memberExists(memberId)){\n-                    return cluster.getMember(memberId).getPartitionId();\n-                }\n-            }\n-        }\n-        return null;\n-   \t}\n-\n-    @Override\n-    public boolean memberExist(String memberId){\n-        for(Service service: TopologyManager.getTopology().getServices()){\n-            for(Cluster cluster: service.getClusters()){\n-                if(cluster.memberExists(memberId)){\n-                    return true;\n-                }\n-            }\n-        }\n-        return false;\n-   \t}\n+    }       \n \n     @Override\n     public String toString() {\n         return \"LbClusterMonitor [clusterId=\" + clusterId + \", serviceId=\" + serviceId + \"]\";\n     }\n \n-    @Override\n-   \tpublic NetworkPartitionContext findNetworkPartition(String memberId) {\n-   \t\t for(Service service: TopologyManager.getTopology().getServices()){\n-   \t            for(Cluster cluster: service.getClusters()){\n \n-                       String networkPartitionId = cluster.getMember(memberId).getNetworkPartitionId();\n-   \t                if(networkPartitionCtxts.containsKey(networkPartitionId)) {\n-                           return networkPartitionCtxts.get(networkPartitionId);\n-                       }\n-   \t            }\n-   \t      }\n-   \t      return null;\n-   \t}\n }",
                "deletions": 153
            },
            {
                "sha": "5ecfad96c7208b62f5b232099e1095d3f47ebd3b",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/topology/AutoscalerTopologyReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/6aac43bc405dd50887d2935f0c0bc6958b03ec61/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/topology/AutoscalerTopologyReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/6aac43bc405dd50887d2935f0c0bc6958b03ec61/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/topology/AutoscalerTopologyReceiver.java",
                "status": "modified",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/topology/AutoscalerTopologyReceiver.java?ref=6aac43bc405dd50887d2935f0c0bc6958b03ec61",
                "patch": "@@ -231,15 +231,15 @@ protected void onEvent(Event event) {\n                     \n \t\t\t\t\tif(AutoscalerContext.getInstance().moniterExist(clusterId)) {\n                         monitor = AutoscalerContext.getInstance().getMonitor(clusterId);\n-\t\t\t\t\t    partitionContext = monitor.getNetworkPartitionCtxt(networkPartitionId).getPartitionCtxt(partitionId);\n+\t\t\t\t\t    partitionContext = monitor.getNetworkPartitionCtxt(networkPartitionId).getPartitionCtxt(partitionId);\t\t\t\t\t    \n \t\t\t\t\t} else {\n \t\t\t\t\t    monitor = AutoscalerContext.getInstance().getLBMonitor(clusterId);\n \t\t\t\t\t    partitionContext = monitor.getNetworkPartitionCtxt(networkPartitionId).getPartitionCtxt(partitionId);\n \t\t\t\t\t}\n //\t\t\t\t\tClusterContext clusCtx = monitor.getClusterCtxt();\n //                    monitor.getNetworkPartitionCtxt(e.getId()).getPartitionCtxt(partitionId);\n //                            .addMemberStatsContext(new MemberStatsContext(e.getMemberId()));\n-                    partitionContext.addMemberStatsContext(new MemberStatsContext(e.getMemberId()));\n+                    partitionContext.addMemberStatsContext(new MemberStatsContext(memberId));\n //\t\t\t\t\tPartitionContext partCtxt = monitor.getNetworkPartitionCtxt(e.getId())\n //                            .getPartitionCtxt(partitionId);\n \t\t\t\t\tpartitionContext.incrementCurrentMemberCount(1);",
                "deletions": 2
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": " fixing npe in autoscaler in member fault handler",
        "commit": "https://github.com/apache/attic-stratos/commit/08b6427d7de9e05614429dcd3eca9610e010d23a",
        "parent": "https://github.com/apache/attic-stratos/commit/70c184f87f6789f557175ef5d2940ab816272103",
        "bug_id": "attic-stratos_78",
        "file": [
            {
                "sha": "f18099954d4657dda6ad596bb8bf0fa7bbcd6af5",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/LbClusterMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/08b6427d7de9e05614429dcd3eca9610e010d23a/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/LbClusterMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/08b6427d7de9e05614429dcd3eca9610e010d23a/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/LbClusterMonitor.java",
                "status": "modified",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/LbClusterMonitor.java?ref=08b6427d7de9e05614429dcd3eca9610e010d23a",
                "patch": "@@ -220,7 +220,7 @@ public String getPartitionOfMember(String memberId){\n         for(Service service: TopologyManager.getTopology().getServices()){\n             for(Cluster cluster: service.getClusters()){\n                 if(cluster.memberExists(memberId)){\n-                    cluster.getMember(memberId).getPartitionId();\n+                    return cluster.getMember(memberId).getPartitionId();\n                 }\n             }\n         }\n@@ -251,7 +251,7 @@ public NetworkPartitionContext findNetworkPartition(String memberId) {\n \n                        String networkPartitionId = cluster.getMember(memberId).getNetworkPartitionId();\n    \t                if(networkPartitionCtxts.containsKey(networkPartitionId)) {\n-                           networkPartitionCtxts.get(networkPartitionId);\n+                           return networkPartitionCtxts.get(networkPartitionId);\n                        }\n    \t            }\n    \t      }",
                "deletions": 2
            },
            {
                "sha": "cdf6dd5f21e6a0c320727f280b57eac7d40bca45",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/topology/AutoscalerTopologyReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/08b6427d7de9e05614429dcd3eca9610e010d23a/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/topology/AutoscalerTopologyReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/08b6427d7de9e05614429dcd3eca9610e010d23a/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/topology/AutoscalerTopologyReceiver.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/topology/AutoscalerTopologyReceiver.java?ref=08b6427d7de9e05614429dcd3eca9610e010d23a",
                "patch": "@@ -92,7 +92,7 @@ protected void onEvent(Event event) {\n                         for(Cluster cluster : service.getClusters()) {\n                         \t    Thread th; \n                         \t\tif(cluster.isLbCluster()){\n-                        \t\t\tth= new Thread(new LBClusterMonitorAdder(cluster));\n+                        \t\t\tth = new Thread(new LBClusterMonitorAdder(cluster));\n                         \t\t}else{\n                         \t\t\tth = new Thread(new ClusterMonitorAdder(cluster));\n                         \t\t}",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing NPE due to LB cluster monitor setter",
        "commit": "https://github.com/apache/attic-stratos/commit/314a58993fa38c601fc358b255320c70bd00ca33",
        "parent": "https://github.com/apache/attic-stratos/commit/0c012936e1f548128863aa7d6f1f67c8b99eb4b6",
        "bug_id": "attic-stratos_79",
        "file": [
            {
                "sha": "5f59dcc43adb83ca78c3e122919fd874871c5150",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/AutoscalerContext.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/314a58993fa38c601fc358b255320c70bd00ca33/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/AutoscalerContext.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/314a58993fa38c601fc358b255320c70bd00ca33/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/AutoscalerContext.java",
                "status": "modified",
                "changes": 4,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/AutoscalerContext.java?ref=314a58993fa38c601fc358b255320c70bd00ca33",
                "patch": "@@ -63,6 +63,10 @@ public ClusterMonitor removeMonitor(String clusterId) {\n     \tlog.info(\"Remove moniter clusterid\" + clusterId);\n         return monitors.remove(clusterId);\n     }\n+    public LbClusterMonitor removeLbMonitor(String clusterId) {\n+    \tlog.info(\"Remove moniter clusterid\" + clusterId);\n+        return lbMonitors.remove(clusterId);\n+    }\n \n     public Map<String, ClusterMonitor> getMonitors() {\n         return monitors;",
                "deletions": 0
            },
            {
                "sha": "740db074c239b2bad840fa6239629b28ae103223",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/AbstractMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/314a58993fa38c601fc358b255320c70bd00ca33/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/AbstractMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/314a58993fa38c601fc358b255320c70bd00ca33/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/AbstractMonitor.java",
                "status": "modified",
                "changes": 5,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/AbstractMonitor.java?ref=314a58993fa38c601fc358b255320c70bd00ca33",
                "patch": "@@ -40,5 +40,8 @@ public void run() {\n \tpublic abstract boolean memberExist(String memberId);\n \tpublic abstract NetworkPartitionContext findNetworkPartition(String memberId);\n \n-\t\n+\n+    public abstract NetworkPartitionContext getNetworkPartitionCtxt(String networkPartitionId);\n+\n+    public abstract void destroy();\n }\n\\ No newline at end of file",
                "deletions": 1
            },
            {
                "sha": "b81a2094a524e2b7f989130496d09efb7c39c6a0",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/topology/AutoscalerTopologyReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/314a58993fa38c601fc358b255320c70bd00ca33/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/topology/AutoscalerTopologyReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/314a58993fa38c601fc358b255320c70bd00ca33/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/topology/AutoscalerTopologyReceiver.java",
                "status": "modified",
                "changes": 53,
                "additions": 42,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/topology/AutoscalerTopologyReceiver.java?ref=314a58993fa38c601fc358b255320c70bd00ca33",
                "patch": "@@ -21,9 +21,13 @@\n \n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n-import org.apache.stratos.autoscaler.*;\n+import org.apache.stratos.autoscaler.AutoscalerContext;\n+import org.apache.stratos.autoscaler.MemberStatsContext;\n+import org.apache.stratos.autoscaler.NetworkPartitionContext;\n+import org.apache.stratos.autoscaler.PartitionContext;\n import org.apache.stratos.autoscaler.exception.PartitionValidationException;\n import org.apache.stratos.autoscaler.exception.PolicyValidationException;\n+import org.apache.stratos.autoscaler.monitor.AbstractMonitor;\n import org.apache.stratos.autoscaler.monitor.ClusterMonitor;\n import org.apache.stratos.autoscaler.monitor.LbClusterMonitor;\n import org.apache.stratos.autoscaler.util.AutoscalerUtil;\n@@ -132,8 +136,22 @@ protected void onEvent(Event event) {\n                 try {\n                     ClusterRemovedEvent e = (ClusterRemovedEvent) event;\n                     TopologyManager.acquireReadLock();\n-                    \n-                    removeClusterFromContext(e.getClusterId());\n+                    String serviceName = e.getServiceName();\n+                    String clusterId = e.getClusterId();\n+\n+                    AbstractMonitor monitor;\n+\n+                    if(TopologyManager.getTopology().getService(serviceName).getCluster(clusterId).isLbCluster()){\n+                        monitor = AutoscalerContext.getInstance().removeLbMonitor(clusterId);\n+\n+                    } else {\n+                        monitor = AutoscalerContext.getInstance().removeMonitor(clusterId);\n+                    }\n+\n+                    monitor.destroy();\n+                    if(log.isDebugEnabled()) {\n+                        log.debug(String.format(\"Cluster monitor has been removed: [cluster] %s \", clusterId));\n+                    }\n                 }\n                 finally {\n                     TopologyManager.releaseReadLock();\n@@ -158,8 +176,19 @@ protected void onEvent(Event event) {\n             \t\tTopologyManager.acquireReadLock();\n \t\t\t\t\tMemberTerminatedEvent e = (MemberTerminatedEvent) event;\n                     String networkPartitionId = e.getNetworkPartitionId();\n-\t\t\t\t\tNetworkPartitionContext networkPartitionContext = AutoscalerContext.getInstance().getMonitor(e.getClusterId())\n-                            .getNetworkPartitionCtxt(networkPartitionId);\n+                    String clusterId = e.getClusterId();\n+                    AbstractMonitor monitor;\n+\n+                    if(AutoscalerContext.getInstance().moniterExist(clusterId)){\n+\n+                        monitor = AutoscalerContext.getInstance().getMonitor(clusterId);\n+                    } else {\n+\n+                        //This is LB member\n+                        monitor = AutoscalerContext.getInstance().getLBMonitor(clusterId);\n+                    }\n+\n+\t\t\t\t\tNetworkPartitionContext networkPartitionContext = monitor.getNetworkPartitionCtxt(networkPartitionId);\n \n                     networkPartitionContext.getPartitionCtxt(e.getPartitionId())\n                             .removeMemberStatsContext(e.getMemberId());\n@@ -190,15 +219,17 @@ protected void onEvent(Event event) {\n                     String partitionId = e.getPartitionId();\n                     String networkPartitionId = e.getNetworkPartitionId();\n \n+                    String serviceName = e.getServiceName();\n                     PartitionContext partitionContext;\n \t\t\t\t\tString clusterId = e.getClusterId();\n-                    ClusterMonitor monitor = AutoscalerContext.getInstance().getMonitor(clusterId);\n+                    AbstractMonitor monitor;\n                     \n-\t\t\t\t\tif(monitor != null) {\n+\t\t\t\t\tif(AutoscalerContext.getInstance().moniterExist(clusterId)) {\n+                        monitor = AutoscalerContext.getInstance().getMonitor(clusterId);\n \t\t\t\t\t    partitionContext = monitor.getNetworkPartitionCtxt(networkPartitionId).getPartitionCtxt(partitionId);\n \t\t\t\t\t} else {\n-\t\t\t\t\t    LbClusterMonitor lbMonitor = AutoscalerContext.getInstance().getLBMonitor(clusterId);\n-\t\t\t\t\t    partitionContext = lbMonitor.getNetworkPartitionCtxt(networkPartitionId).getPartitionCtxt(partitionId);\n+\t\t\t\t\t    monitor = AutoscalerContext.getInstance().getLBMonitor(clusterId);\n+\t\t\t\t\t    partitionContext = monitor.getNetworkPartitionCtxt(networkPartitionId).getPartitionCtxt(partitionId);\n \t\t\t\t\t}\n //\t\t\t\t\tClusterContext clusCtx = monitor.getClusterCtxt();\n //                    monitor.getNetworkPartitionCtxt(e.getId()).getPartitionCtxt(partitionId);\n@@ -226,7 +257,7 @@ protected void onEvent(Event event) {\n //                    ServiceRemovedEvent serviceRemovedEvent = (ServiceRemovedEvent)event;\n //                    for(Service service : TopologyManager.getTopology().getServices()) {\n //                        for(Cluster cluster : service.getClusters()) {\n-//                            removeClusterFromContext(cluster.getHostName());\n+//                            removeMonitor(cluster.getHostName());\n //                        }\n //                    }\n //                }\n@@ -330,7 +361,7 @@ public void run() {\n //        }\n //    }\n \n-    private void removeClusterFromContext(String clusterId) {\n+    private void removeMonitor(String clusterId) {\n         ClusterMonitor monitor = AutoscalerContext.getInstance().removeMonitor(clusterId);\n //        monitor.unsubscribe();\n         monitor.destroy();",
                "deletions": 11
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing a NPE when there're no properties in LB",
        "commit": "https://github.com/apache/attic-stratos/commit/cebf4a23a9818af8789c6457b7167ab8ea5cee4d",
        "parent": "https://github.com/apache/attic-stratos/commit/bc375af1377ced337d6f4149f33b0657bb342f7b",
        "bug_id": "attic-stratos_80",
        "file": [
            {
                "sha": "80351047184d2427550a13b901d9b3daea22f7a3",
                "filename": "components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/util/converter/PojoConverter.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/cebf4a23a9818af8789c6457b7167ab8ea5cee4d/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/util/converter/PojoConverter.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/cebf4a23a9818af8789c6457b7167ab8ea5cee4d/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/util/converter/PojoConverter.java",
                "status": "modified",
                "changes": 4,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.rest.endpoint/src/main/java/org/apache/stratos/rest/endpoint/bean/util/converter/PojoConverter.java?ref=cebf4a23a9818af8789c6457b7167ab8ea5cee4d",
                "patch": "@@ -79,7 +79,9 @@ public static CartridgeConfig populateCartridgeConfigPojo (CartridgeDefinitionBe\n     private static LoadbalancerConfig getLBConfig(LoadBalancerBean loadBalancer) {\n         LoadbalancerConfig lbConfig = new LoadbalancerConfig();\n         lbConfig.setType(loadBalancer.type);\n-        lbConfig.setProperties(getProperties(loadBalancer.property));\n+        if (loadBalancer.property != null && !loadBalancer.property.isEmpty()) {\n+            lbConfig.setProperties(getProperties(loadBalancer.property));\n+        }\n         return lbConfig;\n     }\n ",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing NPE in group monitor and Application monitor when application bursting happen with undeployment",
        "commit": "https://github.com/apache/attic-stratos/commit/8edde2bce53045400e6ba19db88f5a6c11e2f2b4",
        "parent": "https://github.com/apache/attic-stratos/commit/4fa2e5e31c147927e7d3265cb46e5040f8e3ce2b",
        "bug_id": "attic-stratos_81",
        "file": [
            {
                "sha": "a33329a9ce786d8f8d57631e3ec67eaf14207f76",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/InstanceNotificationPublisher.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/8edde2bce53045400e6ba19db88f5a6c11e2f2b4/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/InstanceNotificationPublisher.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/8edde2bce53045400e6ba19db88f5a6c11e2f2b4/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/InstanceNotificationPublisher.java",
                "status": "modified",
                "changes": 3,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/publisher/InstanceNotificationPublisher.java?ref=8edde2bce53045400e6ba19db88f5a6c11e2f2b4",
                "patch": "@@ -52,7 +52,8 @@ private static void publish(Event event) {\n     }\n \n     public synchronized void sendInstanceCleanupEventForCluster(String clusterId, String instanceId) {\n-        log.info(String.format(\"Publishing Instance Cleanup Event: [cluster] %s\", clusterId));\n+        log.info(String.format(\"Publishing Instance Cleanup Event: [cluster] %s \" +\n+                \"[cluster-instance] %s\", clusterId, instanceId));\n         publish(new InstanceCleanupClusterEvent(clusterId, instanceId));\n     }\n ",
                "deletions": 1
            },
            {
                "sha": "34098eec182eaa631f2c33d2d0a91c9688832645",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/8edde2bce53045400e6ba19db88f5a6c11e2f2b4/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/8edde2bce53045400e6ba19db88f5a6c11e2f2b4/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java",
                "status": "modified",
                "changes": 5,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/event/receiver/topology/AutoscalerTopologyEventReceiver.java?ref=8edde2bce53045400e6ba19db88f5a6c11e2f2b4",
                "patch": "@@ -281,10 +281,13 @@ protected void onEvent(Event event) {\n                 //changing the status in the monitor, will notify its parent monitor\n                 ClusterInstance clusterInstance = (ClusterInstance) monitor.getInstance(clusterInstanceId);\n                 if (clusterInstance.getPreviousState() == ClusterStatus.Active) {\n-                    // terminated gracefully\n+                    // terminating all the active members gracefully\n                     monitor.notifyParentMonitor(ClusterStatus.Terminating, clusterInstanceId);\n                     InstanceNotificationPublisher.getInstance().\n                             sendInstanceCleanupEventForCluster(clusterId, clusterInstanceId);\n+                    //Terminating the pending members\n+                    monitor.terminatePendingMembers(clusterInstanceId,\n+                            clusterInstance.getNetworkPartitionId());\n                 } else {\n                     monitor.notifyParentMonitor(ClusterStatus.Terminating, clusterInstanceId);\n                     monitor.terminateAllMembers(clusterInstanceId, clusterInstance.getNetworkPartitionId());",
                "deletions": 1
            },
            {
                "sha": "2f0c4ac0bb005dd10c6289739263fc30d5cb06a4",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/ClusterMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/8edde2bce53045400e6ba19db88f5a6c11e2f2b4/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/ClusterMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/8edde2bce53045400e6ba19db88f5a6c11e2f2b4/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/ClusterMonitor.java",
                "status": "modified",
                "changes": 56,
                "additions": 56,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/ClusterMonitor.java?ref=8edde2bce53045400e6ba19db88f5a6c11e2f2b4",
                "patch": "@@ -1345,6 +1345,62 @@ public void run() {\n         memberTerminator.start();\n     }\n \n+    public void terminatePendingMembers(final String instanceId, final String networkPartitionId) {\n+        final ClusterMonitor monitor = this;\n+        Thread memberTerminator = new Thread(new Runnable() {\n+            public void run() {\n+\n+                ClusterInstanceContext instanceContext =\n+                        (ClusterInstanceContext) getAllNetworkPartitionCtxts().get(networkPartitionId)\n+                                .getInstanceContext(instanceId);\n+                boolean allMovedToObsolete = true;\n+                for (ClusterLevelPartitionContext partitionContext : instanceContext.getPartitionCtxts()) {\n+                    if (log.isInfoEnabled()) {\n+                        log.info(\"Starting to terminate all members in cluster [\" + getClusterId() + \"] \" +\n+                                \"Network Partition [\" + instanceContext.getNetworkPartitionId() + \"], Partition [\" +\n+                                partitionContext.getPartitionId() + \"]\");\n+                    }\n+\n+                    if (AutoscalerContext.getInstance().getAppMonitor(getAppId()).isForce()) {\n+                        log.info(String.format(\"Terminating all remaining members of partition [partition-id] %s [application-id] %s\", partitionContext.getPartitionId(), getAppId()));\n+                        partitionContext.terminateAllRemainingInstances();\n+                    }\n+                    //Need to terminate pending members\n+                    Iterator<MemberContext> pendingIterator = partitionContext.getPendingMembers().listIterator();\n+                    List<String> pendingMemberIdList = new ArrayList<String>();\n+                    while (pendingIterator.hasNext()) {\n+                        MemberContext pendingMemberContext = pendingIterator.next();\n+                        pendingMemberIdList.add(pendingMemberContext.getMemberId());\n+\n+                    }\n+                    for (String memberId : pendingMemberIdList) {\n+                        // pending members\n+                        if (log.isDebugEnabled()) {\n+                            log.debug(\"Moving pending member [member id] \" + memberId + \" to obsolete list\");\n+                        }\n+                        partitionContext.movePendingMemberToObsoleteMembers(memberId);\n+                    }\n+\n+                    /*\n+                    if (partitionContext.getTotalMemberCount() == 0) {\n+                        allMovedToObsolete = allMovedToObsolete && true;\n+                    } else {\n+                        allMovedToObsolete = false;\n+                    }\n+                    */\n+                    allMovedToObsolete = partitionContext.getTotalMemberCount() == 0;\n+                }\n+\n+                if (allMovedToObsolete) {\n+                    monitor.monitor();\n+                }\n+            }\n+        }, \"Member Terminator - [cluster id] \" + getClusterId());\n+\n+        memberTerminator.start();\n+    }\n+\n+\n     public Map<String, ClusterLevelNetworkPartitionContext> getAllNetworkPartitionCtxts() {\n         return (this.clusterContext).getNetworkPartitionCtxts();\n     }",
                "deletions": 0
            },
            {
                "sha": "89b9d1780aba8482677fa57e1766a4f1fa336f69",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/ApplicationMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/8edde2bce53045400e6ba19db88f5a6c11e2f2b4/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/ApplicationMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/8edde2bce53045400e6ba19db88f5a6c11e2f2b4/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/ApplicationMonitor.java",
                "status": "modified",
                "changes": 6,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/ApplicationMonitor.java?ref=8edde2bce53045400e6ba19db88f5a6c11e2f2b4",
                "patch": "@@ -151,7 +151,9 @@ public void run() {\n                 if (application != null) {\n                     List<String> defaultNetworkPartitions = getDefaultNetworkPartitions(application);\n                     //Checking for whether minimum application instances are there.\n-                    checkForMinimumApplicationInstances(application, defaultNetworkPartitions);\n+                    if(defaultNetworkPartitions != null) {\n+                        checkForMinimumApplicationInstances(application, defaultNetworkPartitions);\n+                    }\n \n                     /*//Checking for whether any application instances need to be terminated.\n                     checkForApplicationInstanceTermination(application, defaultNetworkPartitions);*/\n@@ -268,7 +270,7 @@ private void handleScalingDownBeyondMin(InstanceContext instanceContext,\n                 getNetworkPartitionAlgorithmContext(appId);\n         ApplicationPolicy applicationPolicy = PolicyManager.getInstance().\n                 getApplicationPolicy(application.getApplicationPolicyId());\n-        List<String> defaultNetworkPartitions = new ArrayList<String>();\n+        List<String> defaultNetworkPartitions = null;\n \n         if (applicationPolicy != null) {\n             String networkPartitionAlgorithmName = applicationPolicy.getAlgorithm();",
                "deletions": 2
            },
            {
                "sha": "72a8dcf1f7b422ae998f3976a5ff8add6651771a",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/GroupMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/8edde2bce53045400e6ba19db88f5a6c11e2f2b4/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/GroupMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/8edde2bce53045400e6ba19db88f5a6c11e2f2b4/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/GroupMonitor.java",
                "status": "modified",
                "changes": 104,
                "additions": 52,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/component/GroupMonitor.java?ref=8edde2bce53045400e6ba19db88f5a6c11e2f2b4",
                "patch": "@@ -156,71 +156,71 @@ public void run() {\n                         }\n                     }\n \n-                    ParentLevelNetworkPartitionContext parentLevelNetworkPartitionContext\n+                    ParentLevelNetworkPartitionContext parentNetworkPartitionContext\n                             = (ParentLevelNetworkPartitionContext) networkPartitionContext;\n                     Collection<Instance> parentInstances = parent.getInstances();\n \n                     for (Instance parentInstance : parentInstances) {\n-                        int nonTerminatedInstancesCount = parentLevelNetworkPartitionContext.\n-                                getNonTerminatedInstancesCount(parentInstance.getInstanceId());\n-                        int minInstances = parentLevelNetworkPartitionContext.\n-                                getMinInstanceCount();\n-                        int maxInstances = parentLevelNetworkPartitionContext.\n-                                getMaxInstanceCount();\n-                        int activeInstances = parentLevelNetworkPartitionContext.\n-                                getActiveInstancesCount(parentInstance.getInstanceId());\n-\n-                        if (nonTerminatedInstancesCount < minInstances) {\n-                            int instancesToBeCreated = minInstances - nonTerminatedInstancesCount;\n-                            for (int i = 0; i < instancesToBeCreated; i++) {\n-                                for (InstanceContext parentInstanceContext : parent.\n-                                        getNetworkPartitionContext(parentLevelNetworkPartitionContext.getId()).\n-                                        getInstanceIdToInstanceContextMap().values()) {\n-                                    //keep on scale-up/scale-down only if the application is active\n-                                    ApplicationMonitor appMonitor = AutoscalerContext.getInstance().\n-                                            getAppMonitor(appId);\n-                                    int activeAppInstances = ((ParentLevelNetworkPartitionContext) appMonitor.\n-                                            getNetworkPartitionContext(parentLevelNetworkPartitionContext.getId())).\n-                                            getActiveInstancesCount();\n-                                    if (activeAppInstances > 0) {\n-                                        //Creating new group instance based on the existing parent instances\n-                                        if (log.isDebugEnabled()) {\n-                                            log.debug(\"Creating a group instance of [application] \"\n-                                                    + appId + \" [group] \" + id +\n-                                                    \" as the the minimum required instances are not met\");\n-\n+                        if(parentInstance.getNetworkPartitionId().equals(parentNetworkPartitionContext.getId())) {\n+                            int nonTerminatedInstancesCount = parentNetworkPartitionContext.\n+                                    getNonTerminatedInstancesCount(parentInstance.getInstanceId());\n+                            int minInstances = parentNetworkPartitionContext.\n+                                    getMinInstanceCount();\n+                            int maxInstances = parentNetworkPartitionContext.\n+                                    getMaxInstanceCount();\n+                            int activeInstances = parentNetworkPartitionContext.\n+                                    getActiveInstancesCount(parentInstance.getInstanceId());\n+\n+                            if (nonTerminatedInstancesCount < minInstances) {\n+                                int instancesToBeCreated = minInstances - nonTerminatedInstancesCount;\n+                                for (int i = 0; i < instancesToBeCreated; i++) {\n+                                    for (InstanceContext parentInstanceContext : parent.\n+                                            getNetworkPartitionContext(parentNetworkPartitionContext.getId()).\n+                                            getInstanceIdToInstanceContextMap().values()) {\n+                                        //keep on scale-up/scale-down only if the application is active\n+                                        ApplicationMonitor appMonitor = AutoscalerContext.getInstance().\n+                                                getAppMonitor(appId);\n+                                        int activeAppInstances = ((ParentLevelNetworkPartitionContext) appMonitor.\n+                                                getNetworkPartitionContext(parentNetworkPartitionContext.getId())).\n+                                                getActiveInstancesCount();\n+                                        if (activeAppInstances > 0) {\n+                                            //Creating new group instance based on the existing parent instances\n+                                            if (log.isDebugEnabled()) {\n+                                                log.debug(\"Creating a group instance of [application] \"\n+                                                        + appId + \" [group] \" + id +\n+                                                        \" as the the minimum required instances are not met\");\n+\n+                                            }\n+                                            createInstanceOnDemand(parentInstanceContext.getId());\n                                         }\n-                                        createInstanceOnDemand(parentInstanceContext.getId());\n                                     }\n-                                }\n \n+                                }\n                             }\n-                        }\n-                        //If the active instances are higher than the max instances,\n-                        // the group instance has to get terminated\n-                        if (activeInstances > maxInstances) {\n-                            int instancesToBeTerminated = activeInstances - maxInstances;\n-                            List<InstanceContext> contexts =\n-                                    ((ParentLevelNetworkPartitionContext) networkPartitionContext).\n-                                            getInstanceIdToInstanceContextMap(parentInstance.getInstanceId());\n-                            List<InstanceContext> contextList = new ArrayList<InstanceContext>(contexts);\n-                            for (int i = 0; i < instancesToBeTerminated; i++) {\n-                                InstanceContext instanceContext = contextList.get(i);\n-                                //scale down only when extra instances found\n-                                if (log.isDebugEnabled()) {\n-                                    log.debug(\"Terminating a group instance of [application] \"\n-                                            + appId + \" [group] \" + id + \" as it exceeded the \" +\n-                                            \"maximum no of instances by \" + instancesToBeTerminated);\n+                            //If the active instances are higher than the max instances,\n+                            // the group instance has to get terminated\n+                            if (activeInstances > maxInstances) {\n+                                int instancesToBeTerminated = activeInstances - maxInstances;\n+                                List<InstanceContext> contexts =\n+                                        ((ParentLevelNetworkPartitionContext) networkPartitionContext).\n+                                                getInstanceIdToInstanceContextMap(parentInstance.getInstanceId());\n+                                List<InstanceContext> contextList = new ArrayList<InstanceContext>(contexts);\n+                                for (int i = 0; i < instancesToBeTerminated; i++) {\n+                                    InstanceContext instanceContext = contextList.get(i);\n+                                    //scale down only when extra instances found\n+                                    if (log.isDebugEnabled()) {\n+                                        log.debug(\"Terminating a group instance of [application] \"\n+                                                + appId + \" [group] \" + id + \" as it exceeded the \" +\n+                                                \"maximum no of instances by \" + instancesToBeTerminated);\n \n-                                }\n-                                handleScalingDownBeyondMin(instanceContext,\n-                                        networkPartitionContext, true);\n+                                    }\n+                                    handleScalingDownBeyondMin(instanceContext,\n+                                            networkPartitionContext, true);\n \n+                                }\n                             }\n                         }\n                     }\n-\n-\n                 }\n             }\n         };",
                "deletions": 52
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing NPE while caculating group status and fixing scaling drool issus",
        "commit": "https://github.com/apache/attic-stratos/commit/9673d5a30b9dcf586027032a7591a4df256cf31c",
        "parent": "https://github.com/apache/attic-stratos/commit/48c36407339cc81a835c7cf3d79a9109f2055304",
        "bug_id": "attic-stratos_82",
        "file": [
            {
                "sha": "229dd7ff4d3654f68983899619d90b41073cb178",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/VMClusterMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/9673d5a30b9dcf586027032a7591a4df256cf31c/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/VMClusterMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/9673d5a30b9dcf586027032a7591a4df256cf31c/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/VMClusterMonitor.java",
                "status": "modified",
                "changes": 9,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/VMClusterMonitor.java?ref=9673d5a30b9dcf586027032a7591a4df256cf31c",
                "patch": "@@ -222,9 +222,7 @@ public void run() {\n                             getMinCheckKnowledgeSession().setGlobal(\"isPrimary\", hasPrimary);\n                             //FIXME when parent chosen the partition\n                             String paritionAlgo = instanceContext.getPartitionAlgorithm();\n-                            if(paritionAlgo == null) {\n-                                paritionAlgo = \"one-after-another\";\n-                            }\n+\n                             getMinCheckKnowledgeSession().setGlobal(\"algorithmName\",\n                                     paritionAlgo);\n \n@@ -241,7 +239,6 @@ public void run() {\n                             boolean rifReset = instanceContext.isRifReset();\n                             boolean memoryConsumptionReset = instanceContext.isMemoryConsumptionReset();\n                             boolean loadAverageReset = instanceContext.isLoadAverageReset();\n-\n                             if (log.isDebugEnabled()) {\n                                 log.debug(\"Execution point of scaling Rule, [Is rif Reset] : \" + rifReset\n                                         + \" [Is memoryConsumption Reset] : \" + memoryConsumptionReset\n@@ -256,12 +253,14 @@ public void run() {\n                                 getScaleCheckKnowledgeSession().setGlobal(\"autoscalePolicy\",\n                                         vmClusterContext.getAutoscalePolicy());\n                                 getScaleCheckKnowledgeSession().setGlobal(\"rifReset\", rifReset);\n+                                //TODO to parse actual value\n+                                getScaleCheckKnowledgeSession().setGlobal(\"arspiReset\", true);\n                                 getScaleCheckKnowledgeSession().setGlobal(\"mcReset\", memoryConsumptionReset);\n                                 getScaleCheckKnowledgeSession().setGlobal(\"laReset\", loadAverageReset);\n                                 getScaleCheckKnowledgeSession().setGlobal(\"isPrimary\", hasPrimary);\n                                 getScaleCheckKnowledgeSession().setGlobal(\"primaryMembers\", primaryMemberListInClusterInstance);\n                                 getMinCheckKnowledgeSession().setGlobal(\"algorithmName\",\n-                                        instanceContext.getPartitionAlgorithm());\n+                                        paritionAlgo);\n \n                                 if (log.isDebugEnabled()) {\n                                     log.debug(String.format(\"Running scale check for [cluster instance context] %s \",",
                "deletions": 5
            },
            {
                "sha": "5c7ba3072758bd68e2f91a8ea07f7c9e783627ca",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/rule/RuleTasksDelegator.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/9673d5a30b9dcf586027032a7591a4df256cf31c/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/rule/RuleTasksDelegator.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/9673d5a30b9dcf586027032a7591a4df256cf31c/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/rule/RuleTasksDelegator.java",
                "status": "modified",
                "changes": 4,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/rule/RuleTasksDelegator.java?ref=9673d5a30b9dcf586027032a7591a4df256cf31c",
                "patch": "@@ -145,6 +145,10 @@ public int getMemberCount(String clusterId, int scalingPara) {\n \n     public AutoscaleAlgorithm getAutoscaleAlgorithm(String partitionAlgorithm) {\n         AutoscaleAlgorithm autoscaleAlgorithm = null;\n+        //FIXME to not parse for algo when partition is chosen by the parent\n+        if(partitionAlgorithm == null) {\n+            partitionAlgorithm = Constants.ONE_AFTER_ANOTHER_ALGORITHM_ID;\n+        }\n         if (log.isDebugEnabled()) {\n             log.debug(String.format(\"Partition algorithm is \", partitionAlgorithm));\n         }",
                "deletions": 0
            },
            {
                "sha": "2bf761cc13e85668463b2370c6016275217a60e3",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/processor/group/GroupStatusInActiveProcessor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/9673d5a30b9dcf586027032a7591a4df256cf31c/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/processor/group/GroupStatusInActiveProcessor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/9673d5a30b9dcf586027032a7591a4df256cf31c/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/processor/group/GroupStatusInActiveProcessor.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/status/processor/group/GroupStatusInActiveProcessor.java?ref=9673d5a30b9dcf586027032a7591a4df256cf31c",
                "patch": "@@ -104,7 +104,7 @@ private boolean doProcess(String idOfComponent, String appId, String instanceId)\n                     //ApplicationBuilder.handleApp(appId);\n                 } else if (component instanceof Group) {\n                     //send activation to the parent\n-                    if (((Group) component).getStatus(null) != GroupStatus.Inactive) {\n+                    if (((Group) component).getStatus(instanceId) != GroupStatus.Inactive) {\n                         log.info(\"sending group in-active: \" + component.getUniqueIdentifier());\n                         ApplicationBuilder.handleGroupInActivateEvent(appId, component.getUniqueIdentifier(), instanceId);\n                         return true;",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing NPE which caused by policy validation and fixing the policy validation to validate against whole applicaiton",
        "commit": "https://github.com/apache/attic-stratos/commit/2ee26c15c1d64ed67175c1a6dbadc7dba452949e",
        "parent": "https://github.com/apache/attic-stratos/commit/1089dedc6c9da007849ae206de20c5b31cd38cf8",
        "bug_id": "attic-stratos_83",
        "file": [
            {
                "sha": "54ff1b3a015bd8e9fee8aa3c9497692ef39a7eb6",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/services/impl/AutoscalerServiceImpl.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/2ee26c15c1d64ed67175c1a6dbadc7dba452949e/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/services/impl/AutoscalerServiceImpl.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/2ee26c15c1d64ed67175c1a6dbadc7dba452949e/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/services/impl/AutoscalerServiceImpl.java",
                "status": "modified",
                "changes": 18,
                "additions": 9,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/services/impl/AutoscalerServiceImpl.java?ref=2ee26c15c1d64ed67175c1a6dbadc7dba452949e",
                "patch": "@@ -101,12 +101,12 @@ public boolean updateAutoScalingPolicy(AutoscalePolicy autoscalePolicy) throws I\n     @Override\n     public boolean removeAutoScalingPolicy(String autoscalePolicyId) throws UnremovablePolicyException,\n             PolicyDoesNotExistException {\n-        if (removableAutoScalerPolicy(autoscalePolicyId)) {\n+        //if (removableAutoScalerPolicy(autoscalePolicyId)) {\n             return PolicyManager.getInstance().removeAutoscalePolicy(autoscalePolicyId);\n-        } else {\n+       /* } else {\n             throw new UnremovablePolicyException(\"This autoscaler policy cannot be removed, since it is used in \" +\n                     \"applications.\");\n-        }\n+        }*/\n     }\n \n     /**\n@@ -138,12 +138,12 @@ private boolean removableAutoScalerPolicy(String autoscalePolicyId) {\n      */\n     private boolean removableDeploymentPolicy(String deploymentPolicyId) {\n         boolean canRemove = true;\n-        Collection<ApplicationContext> appContexts = AutoscalerContext.getInstance().getApplicationContexts();\n-        for (ApplicationContext app : appContexts) {\n-            CartridgeContext[] cartridgeContexts = app.getComponents().getCartridgeContexts();\n-            for (CartridgeContext cartridgeContext : cartridgeContexts) {\n-                SubscribableInfoContext subscribableInfoContexts = cartridgeContext.getSubscribableInfoContext();\n-                if (subscribableInfoContexts.getDeploymentPolicy().equals(deploymentPolicyId)) {\n+        Map<String, Application> applications = ApplicationHolder.getApplications().getApplications();\n+        for (Application application : applications.values()) {\n+            List<String> deploymentPolicyIdsReferredInApplication = AutoscalerUtil.\n+                    getDeploymentPolicyIdsReferredInApplication(application.getUniqueIdentifier());\n+            for (String deploymentPolicyIdInApp : deploymentPolicyIdsReferredInApplication) {\n+                if (deploymentPolicyId.equals(deploymentPolicyIdInApp)) {\n                     canRemove = false;\n                 }\n             }",
                "deletions": 9
            },
            {
                "sha": "2f78fe7631f259282485efc362a431d62d3430c9",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/util/AutoscalerUtil.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/2ee26c15c1d64ed67175c1a6dbadc7dba452949e/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/util/AutoscalerUtil.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/2ee26c15c1d64ed67175c1a6dbadc7dba452949e/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/util/AutoscalerUtil.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/util/AutoscalerUtil.java?ref=2ee26c15c1d64ed67175c1a6dbadc7dba452949e",
                "patch": "@@ -422,7 +422,7 @@ public static String findTenantRange(int tenantId, String tenantPartitions) {\n      * @param applicationId the application id\n      * @return list of deployment policy ids\n      */\n-    private static List<String> getDeploymentPolicyIdsReferredInApplication(String applicationId) {\n+    public static List<String> getDeploymentPolicyIdsReferredInApplication(String applicationId) {\n \n         if (applicationId == null || StringUtils.isBlank(applicationId)) {\n             return null;",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing a possible NPE and adding a debug log in deployCartridgeDefinition(CartridgeConfig) method",
        "commit": "https://github.com/apache/attic-stratos/commit/419a460dc433deea78a4b25d52a7aae2ca54e964",
        "parent": "https://github.com/apache/attic-stratos/commit/e65e0a0316c2ecb4b3e803a3ad485be540ef03a2",
        "bug_id": "attic-stratos_84",
        "file": [
            {
                "sha": "a2999c671b287f22437c0342616fee4fc08302dc",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/impl/CloudControllerServiceImpl.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/419a460dc433deea78a4b25d52a7aae2ca54e964/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/impl/CloudControllerServiceImpl.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/419a460dc433deea78a4b25d52a7aae2ca54e964/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/impl/CloudControllerServiceImpl.java",
                "status": "modified",
                "changes": 4,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/impl/CloudControllerServiceImpl.java?ref=419a460dc433deea78a4b25d52a7aae2ca54e964",
                "patch": "@@ -288,6 +288,10 @@ public void deployCartridgeDefinition(CartridgeConfig cartridgeConfig) throws In\n \n         }\n \n+        if(log.isDebugEnabled()){\n+            log.debug(\"Cartridge definition: \" + cartridgeConfig.toString());\n+        }\n+\n         Cartridge cartridge = null;\n         try {\n             cartridge = CloudControllerUtil.toCartridge(cartridgeConfig);",
                "deletions": 0
            },
            {
                "sha": "6435134a3a60a49b979074694967483f29e20664",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/pojo/CartridgeConfig.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/419a460dc433deea78a4b25d52a7aae2ca54e964/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/pojo/CartridgeConfig.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/419a460dc433deea78a4b25d52a7aae2ca54e964/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/pojo/CartridgeConfig.java",
                "status": "modified",
                "changes": 26,
                "additions": 16,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/pojo/CartridgeConfig.java?ref=419a460dc433deea78a4b25d52a7aae2ca54e964",
                "patch": "@@ -162,10 +162,12 @@ private String getDeploymentDetails () {\n \n         StringBuilder deploymentDetailBuilder = new StringBuilder();\n         deploymentDetailBuilder.append(\"Base direcotry: \" + baseDir);\n-        if(deploymentDirs.length > 0) {\n-            deploymentDetailBuilder.append(\" Direcotries: \");\n-            for (String directory : deploymentDirs) {\n-                deploymentDetailBuilder.append(directory + \" | \");\n+        if(deploymentDirs != null) {\n+            if(deploymentDirs.length > 0) {\n+                deploymentDetailBuilder.append(\" Direcotries: \");\n+                for (String directory : deploymentDirs) {\n+                    deploymentDetailBuilder.append(directory + \" | \");\n+                }\n             }\n         }\n \n@@ -175,9 +177,11 @@ private String getDeploymentDetails () {\n     private String getPortMappingDetails () {\n \n         StringBuilder portMappingDetailBuilder = new StringBuilder();\n-        if(portMappings.length > 0) {\n-            for (PortMapping portMapping : portMappings) {\n-                portMappingDetailBuilder.append(portMapping.toString() + \" | \");\n+        if(portMappings != null) {\n+            if(portMappings.length > 0) {\n+                for (PortMapping portMapping : portMappings) {\n+                    portMappingDetailBuilder.append(portMapping.toString() + \" | \");\n+                }\n             }\n         }\n         return portMappingDetailBuilder.toString();\n@@ -186,9 +190,11 @@ private String getPortMappingDetails () {\n     private String getIaasConfigDetails () {\n \n         StringBuilder iaasConfigDetailBuilder = new StringBuilder();\n-        if(iaasConfigs.length > 0) {\n-            for (IaasConfig iaasConfig : iaasConfigs) {\n-                iaasConfigDetailBuilder.append(iaasConfig.toString() + \" | \");\n+        if(iaasConfigs != null) {\n+            if(iaasConfigs.length > 0) {\n+                for (IaasConfig iaasConfig : iaasConfigs) {\n+                    iaasConfigDetailBuilder.append(iaasConfig.toString() + \" | \");\n+                }\n             }\n         }\n         return iaasConfigDetailBuilder.toString();",
                "deletions": 10
            },
            {
                "sha": "077deb9ee94c6b56c0c419fbee737136340e7b90",
                "filename": "components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/pojo/IaasConfig.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/419a460dc433deea78a4b25d52a7aae2ca54e964/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/pojo/IaasConfig.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/419a460dc433deea78a4b25d52a7aae2ca54e964/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/pojo/IaasConfig.java",
                "status": "modified",
                "changes": 5,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.cloud.controller/src/main/java/org/apache/stratos/cloud/controller/pojo/IaasConfig.java?ref=419a460dc433deea78a4b25d52a7aae2ca54e964",
                "patch": "@@ -132,8 +132,9 @@ public void setProperties(Properties properties) {\n \n     public String toString () {\n \n-        return \" [ Type: \" + type + \", Image Id: \" + imageId + \", Max Instance Limit: \" + maxInstanceLimit +\n-                \" Properties: \" + getIaasProperties() + \" ] \";\n+        return \" [ Type: \" + type + \", Name: \" + name + \", Class Name: \" + className + \", Image Id: \" + imageId +\n+                \", Max Instance Limit: \" + maxInstanceLimit + \", Provider: \" + provider + \", Identity: \" + identity +\n+                \", Credentials: \" + credential + \", Properties: \" + getIaasProperties() + \" ] \";\n     }\n \n     private String getIaasProperties () {",
                "deletions": 2
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "fixing an NPE while reading id in Cluster monitor and using ApplicationBuilder to update the status of the monitors",
        "commit": "https://github.com/apache/attic-stratos/commit/728ffe9586cfdea970dcb43ab9c8dd3c20a43f21",
        "parent": "https://github.com/apache/attic-stratos/commit/b9a289453671a6e13cfc06a126a93c630758d33b",
        "bug_id": "attic-stratos_85",
        "file": [
            {
                "sha": "7d0ac8fbebf0746edd0fae73143b85a79c3ce085",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/ParentComponentMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/728ffe9586cfdea970dcb43ab9c8dd3c20a43f21/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/ParentComponentMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/728ffe9586cfdea970dcb43ab9c8dd3c20a43f21/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/ParentComponentMonitor.java",
                "status": "modified",
                "changes": 25,
                "additions": 12,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/ParentComponentMonitor.java?ref=728ffe9586cfdea970dcb43ab9c8dd3c20a43f21",
                "patch": "@@ -20,19 +20,19 @@\n \n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n-import org.apache.stratos.autoscaler.exception.DependencyBuilderException;\n-import org.apache.stratos.autoscaler.exception.PartitionValidationException;\n-import org.apache.stratos.autoscaler.exception.PolicyValidationException;\n-import org.apache.stratos.autoscaler.exception.TopologyInConsistentException;\n import org.apache.stratos.autoscaler.applications.dependency.DependencyBuilder;\n import org.apache.stratos.autoscaler.applications.dependency.DependencyTree;\n import org.apache.stratos.autoscaler.applications.dependency.context.ApplicationContext;\n-import org.apache.stratos.autoscaler.applications.topic.ApplicationsEventPublisher;\n+import org.apache.stratos.autoscaler.applications.topic.ApplicationBuilder;\n import org.apache.stratos.autoscaler.event.publisher.ClusterStatusEventPublisher;\n-import org.apache.stratos.autoscaler.status.checker.StatusChecker;\n-import org.apache.stratos.messaging.domain.applications.ParentComponent;\n+import org.apache.stratos.autoscaler.exception.DependencyBuilderException;\n+import org.apache.stratos.autoscaler.exception.PartitionValidationException;\n+import org.apache.stratos.autoscaler.exception.PolicyValidationException;\n+import org.apache.stratos.autoscaler.exception.TopologyInConsistentException;\n import org.apache.stratos.autoscaler.monitor.application.ApplicationMonitorFactory;\n import org.apache.stratos.autoscaler.monitor.cluster.AbstractClusterMonitor;\n+import org.apache.stratos.autoscaler.status.checker.StatusChecker;\n+import org.apache.stratos.messaging.domain.applications.ParentComponent;\n \n import java.util.HashMap;\n import java.util.List;\n@@ -55,7 +55,7 @@ public ParentComponentMonitor(ParentComponent component) throws DependencyBuilde\n         //Building the dependency for this monitor within the immediate children\n         dependencyTree = DependencyBuilder.getInstance().buildDependency(component);\n     }\n-    \n+\n     /**\n      * This will start the child monitors based on the active of siblings according to start up order\n      *\n@@ -107,7 +107,7 @@ protected void onChildActivatedEvent(String idOfEvent) {\n     }*/\n \n     // move to inactive monitors list to use in the Terminated event\n-    protected synchronized void markMonitorAsInactive (String monitorKey) {\n+    protected synchronized void markMonitorAsInactive(String monitorKey) {\n \n         if (!this.aliasToInActiveMonitorsMap.containsKey(monitorKey)) {\n             this.aliasToInActiveMonitorsMap.put(monitorKey,\n@@ -116,7 +116,6 @@ protected synchronized void markMonitorAsInactive (String monitorKey) {\n     }\n \n     /**\n-     *\n      * @param idOfEvent\n      */\n     protected void onChildInActiveEvent(String idOfEvent) {\n@@ -132,12 +131,12 @@ protected void onChildInActiveEvent(String idOfEvent) {\n             if (terminationList.size() ==\n                     (this.aliasToActiveMonitorsMap.size() + this.aliasToInActiveMonitorsMap.size())) {\n                 if (this.parent != null) {\n-                    ApplicationsEventPublisher.sendGroupTerminatingEvent(this.appId, this.id);\n+                    ApplicationBuilder.handleGroupTerminatingEvent(this.appId, this.id);\n                 }\n             } else {\n                 //TODO application InActive\n                 if (this.parent != null) {\n-                    ApplicationsEventPublisher.sendGroupInActivateEvent(this.appId, this.id);\n+                    ApplicationBuilder.handleGroupInActivateEvent(this.appId, this.id);\n                 }\n                 //Since it is reached the most independent unit and has few independent monitors,\n                 // has to put the children down to terminating\n@@ -152,7 +151,7 @@ protected void onChildInActiveEvent(String idOfEvent) {\n                         if (monitor != null) {\n                             if (monitor.hasActiveMonitors()) {\n                                 //it is a group\n-                                ApplicationsEventPublisher.sendGroupTerminatingEvent(this.appId,\n+                                ApplicationBuilder.handleGroupTerminatingEvent(this.appId,\n                                         terminationContext.getId());\n                             } else {\n                                 ClusterStatusEventPublisher.sendClusterTerminatingEvent(this.appId,",
                "deletions": 13
            },
            {
                "sha": "a90660f2285a8c9289e0006084dea163a8275353",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/application/ApplicationMonitorFactory.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/728ffe9586cfdea970dcb43ab9c8dd3c20a43f21/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/application/ApplicationMonitorFactory.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/728ffe9586cfdea970dcb43ab9c8dd3c20a43f21/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/application/ApplicationMonitorFactory.java",
                "status": "modified",
                "changes": 1,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/application/ApplicationMonitorFactory.java?ref=728ffe9586cfdea970dcb43ab9c8dd3c20a43f21",
                "patch": "@@ -194,6 +194,7 @@ public static AbstractClusterMonitor getClusterMonitor(ParentComponentMonitor pa\n             AbstractClusterMonitor clusterMonitor = ClusterMonitorFactory.getMonitor(cluster);\n             //Setting the parent of the cluster monitor\n             clusterMonitor.setParent(parentMonitor);\n+            clusterMonitor.setId(clusterId);\n             //setting the dependent behaviour of the cluster monitor\n             if(parentMonitor.isDependent() || (context.isDependent() && context.hasChild())) {\n                 clusterMonitor.setHasDependent(true);",
                "deletions": 0
            },
            {
                "sha": "97f3da65334b83a79382e53be94f30e5e60de36d",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/VMClusterMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/728ffe9586cfdea970dcb43ab9c8dd3c20a43f21/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/VMClusterMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/728ffe9586cfdea970dcb43ab9c8dd3c20a43f21/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/VMClusterMonitor.java",
                "status": "modified",
                "changes": 2,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/cluster/VMClusterMonitor.java?ref=728ffe9586cfdea970dcb43ab9c8dd3c20a43f21",
                "patch": "@@ -453,6 +453,8 @@ public void handleMemberFaultEvent(MemberFaultEvent memberFaultEvent) {\n             log.info(String.format(\"Faulty member is terminated and removed from the active members list: \"\n                                    + \"[member] %s [partition] %s [cluster] %s \", memberId, partitionId, clusterId));\n         }\n+\n+        StatusChecker.getInstance().onMemberFaultEvent(memberFaultEvent.getClusterId(), partitionId);\n     }\n \n     @Override",
                "deletions": 0
            },
            {
                "sha": "e3324a8ba1ee2e11b3872606dbd1a6a382779358",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/group/GroupMonitor.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/728ffe9586cfdea970dcb43ab9c8dd3c20a43f21/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/group/GroupMonitor.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/728ffe9586cfdea970dcb43ab9c8dd3c20a43f21/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/group/GroupMonitor.java",
                "status": "modified",
                "changes": 7,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/monitor/group/GroupMonitor.java?ref=728ffe9586cfdea970dcb43ab9c8dd3c20a43f21",
                "patch": "@@ -23,7 +23,6 @@\n import org.apache.stratos.autoscaler.applications.topic.ApplicationBuilder;\n import org.apache.stratos.autoscaler.exception.DependencyBuilderException;\n import org.apache.stratos.autoscaler.exception.TopologyInConsistentException;\n-import org.apache.stratos.autoscaler.applications.topic.ApplicationsEventPublisher;\n import org.apache.stratos.autoscaler.monitor.EventHandler;\n import org.apache.stratos.autoscaler.monitor.MonitorStatusEventBuilder;\n import org.apache.stratos.autoscaler.monitor.ParentComponentMonitor;\n@@ -33,9 +32,9 @@\n import org.apache.stratos.autoscaler.monitor.events.MonitorTerminateAllEvent;\n import org.apache.stratos.autoscaler.status.checker.StatusChecker;\n import org.apache.stratos.messaging.domain.applications.ApplicationStatus;\n-import org.apache.stratos.messaging.domain.topology.ClusterStatus;\n import org.apache.stratos.messaging.domain.applications.Group;\n import org.apache.stratos.messaging.domain.applications.GroupStatus;\n+import org.apache.stratos.messaging.domain.topology.ClusterStatus;\n import org.apache.stratos.messaging.domain.topology.lifecycle.LifeCycleState;\n \n /**\n@@ -74,7 +73,7 @@ public void onChildEvent(MonitorStatusEvent statusEvent) {\n             onChildInActiveEvent(id);\n \n         } else if (status1 == ClusterStatus.Created || status1 == GroupStatus.Created) {\n-            if(this.aliasToInActiveMonitorsMap.containsKey(id)) {\n+            if (this.aliasToInActiveMonitorsMap.containsKey(id)) {\n                 this.aliasToInActiveMonitorsMap.remove(id);\n             }\n             if (this.status == GroupStatus.Terminating) {\n@@ -88,7 +87,7 @@ public void onChildEvent(MonitorStatusEvent statusEvent) {\n \n         } else if (status1 == ClusterStatus.Terminated || status1 == GroupStatus.Terminated) {\n             //Check whether all dependent goes Terminated and then start them in parallel.\n-            if(this.aliasToInActiveMonitorsMap.containsKey(id)) {\n+            if (this.aliasToInActiveMonitorsMap.containsKey(id)) {\n                 this.aliasToInActiveMonitorsMap.remove(id);\n             } else {\n                 log.warn(\"[monitor] \" + id + \" cannot be found in the inActive monitors list\");",
                "deletions": 4
            }
        ]
    },
    {
        "repo": "attic-stratos",
        "message": "Fixing possible NPE if the cluster monitor/ memeber stat objects are not in the in memory model",
        "commit": "https://github.com/apache/attic-stratos/commit/61e1f8c0465edb74d9053854157b0e9db36fdd78",
        "parent": "https://github.com/apache/attic-stratos/commit/43a6f85f8fe452a31050bb1214b8b65cb7bf9ea2",
        "bug_id": "attic-stratos_86",
        "file": [
            {
                "sha": "6f6286a38a72803dce0e5fcedf449e851d66eaca",
                "filename": "components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/health/HealthEventMessageDelegator.java",
                "blob_url": "https://github.com/apache/attic-stratos/blob/61e1f8c0465edb74d9053854157b0e9db36fdd78/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/health/HealthEventMessageDelegator.java",
                "raw_url": "https://github.com/apache/attic-stratos/raw/61e1f8c0465edb74d9053854157b0e9db36fdd78/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/health/HealthEventMessageDelegator.java",
                "status": "modified",
                "changes": 77,
                "additions": 44,
                "contents_url": "https://api.github.com/repos/apache/attic-stratos/contents/components/org.apache.stratos.autoscaler/src/main/java/org/apache/stratos/autoscaler/message/receiver/health/HealthEventMessageDelegator.java?ref=61e1f8c0465edb74d9053854157b0e9db36fdd78",
                "patch": "@@ -28,10 +28,7 @@\n \n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n-import org.apache.stratos.autoscaler.AutoscalerContext;\n-import org.apache.stratos.autoscaler.Constants;\n-import org.apache.stratos.autoscaler.NetworkPartitionContext;\n-import org.apache.stratos.autoscaler.PartitionContext;\n+import org.apache.stratos.autoscaler.*;\n import org.apache.stratos.autoscaler.client.cloud.controller.CloudControllerClient;\n import org.apache.stratos.autoscaler.exception.SpawningException;\n import org.apache.stratos.autoscaler.exception.TerminationException;\n@@ -214,66 +211,80 @@ public void run() {\n     private LoadAverage findLoadAverage(Event event) {\n         String memberId = event.getProperties().get(\"member_id\");\n         Member member = findMember(memberId);\n-        \n-        if(null == member){\n+        AbstractMonitor monitor = AutoscalerContext.getInstance().getMonitor(member.getClusterId());\n+        if(null == monitor){\n+            if(log.isErrorEnabled()) {\n+               log.error(String.format(\"Cluster monitor is not available for : [member] %s\", memberId));\n+            }\n+            return null;\n+        }\n+        String networkPartitionId = findNetworkPartitionId(memberId);\n+        MemberStatsContext memberStatsContext = monitor.getNetworkPartitionCtxt(networkPartitionId)\n+                        .getPartitionCtxt(member.getPartitionId())\n+                        .getMemberStatsContext(memberId);\n+        if(null == memberStatsContext){\n+            if(log.isErrorEnabled()) {\n+               log.error(String.format(\"Member context is not available for : [member] %s\", memberId));\n+            }\n+            return null;\n+        } else if(null == member){\n         \tif(log.isErrorEnabled()) {\n                 log.error(String.format(\"Member not found: [member] %s\", memberId));\n             }\n             return null;\n-        }\n-        if(!member.isActive()){\n+        } else if(!member.isActive()){\n             if(log.isDebugEnabled()){\n                 log.debug(String.format(\"Member activated event has not received for the member %s. Therefore ignoring\" +\n-                        \" the load average health stat\", memberId));\n+                        \" the health stat\", memberId));\n             }\n             return null;\n         }\n-        \n-        String networkPartitionId = findNetworkPartitionId(memberId);\n-        LoadAverage loadAverage = AutoscalerContext.getInstance().getMonitor(member.getClusterId())\n-                .getNetworkPartitionCtxt(networkPartitionId)\n-                .getPartitionCtxt(member.getPartitionId())\n-                .getMemberStatsContext(memberId).getLoadAverage();\n+\n+        LoadAverage loadAverage = memberStatsContext.getLoadAverage();\n \n         if(loadAverage == null) {\n             loadAverage = new LoadAverage();\n-            AutoscalerContext.getInstance().getMonitor(member.getClusterId())\n-                    .getNetworkPartitionCtxt(networkPartitionId)\n-                    .getPartitionCtxt(member.getPartitionId())\n-                    .getMemberStatsContext(memberId).setLoadAverage(loadAverage);\n+            memberStatsContext.setLoadAverage(loadAverage);\n         }\n         return loadAverage;\n     }\n \n     private MemoryConsumption findMemoryConsumption(Event event) {\n         String memberId = event.getProperties().get(\"member_id\");\n         Member member = findMember(memberId);\n-        \n-        if(null == member){\n+        AbstractMonitor monitor = AutoscalerContext.getInstance().getMonitor(member.getClusterId());\n+        if(null == monitor){\n+            if(log.isErrorEnabled()) {\n+               log.error(String.format(\"Cluster monitor is not available for : [member] %s\", memberId));\n+            }\n+            return null;\n+        }\n+        String networkPartitionId = findNetworkPartitionId(memberId);\n+        MemberStatsContext memberStatsContext = monitor.getNetworkPartitionCtxt(networkPartitionId)\n+                        .getPartitionCtxt(member.getPartitionId())\n+                        .getMemberStatsContext(memberId);\n+        if(null == memberStatsContext){\n+            if(log.isErrorEnabled()) {\n+               log.error(String.format(\"Member context is not available for : [member] %s\", memberId));\n+            }\n+            return null;\n+        } else if(null == member){\n         \tif(log.isErrorEnabled()) {\n                 log.error(String.format(\"Member not found: [member] %s\", memberId));\n             }\n             return null;\n-        }\n-        if(!member.isActive()){\n+        } else if(!member.isActive()){\n             if(log.isDebugEnabled()){\n                 log.debug(String.format(\"Member activated event has not received for the member %s. Therefore ignoring\" +\n                         \" the health stat\", memberId));\n             }\n             return null;\n-        }        \n-        String networkPartitionId = findNetworkPartitionId(memberId);\n-        MemoryConsumption memoryConsumption = AutoscalerContext.getInstance().getMonitor(member.getClusterId())\n-                .getNetworkPartitionCtxt(networkPartitionId)\n-                .getPartitionCtxt(member.getPartitionId())\n-                .getMemberStatsContext(memberId).getMemoryConsumption();\n+        }\n+        MemoryConsumption memoryConsumption = memberStatsContext.getMemoryConsumption();\n \n         if(memoryConsumption == null) {\n             memoryConsumption = new MemoryConsumption();\n-            AutoscalerContext.getInstance().getMonitor(member.getClusterId())\n-                    .getNetworkPartitionCtxt(networkPartitionId)\n-                    .getPartitionCtxt(member.getPartitionId())\n-                    .getMemberStatsContext(memberId).setMemoryConsumption(memoryConsumption);\n+            memberStatsContext.setMemoryConsumption(memoryConsumption);\n         }\n         return memoryConsumption;\n     }",
                "deletions": 33
            }
        ]
    }
]