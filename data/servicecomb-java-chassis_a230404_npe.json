[
    {
        "repo": "servicecomb-java-chassis",
        "commit": "https://github.com/apache/servicecomb-java-chassis/commit/a2304046f39f0fa14174550a16b6fb377d580e90",
        "bug_id": "servicecomb-java-chassis_a230404",
        "message": "[SCB-753]NPE when query not exists service",
        "parent": "https://github.com/apache/servicecomb-java-chassis/commit/f2216535be3271a5a06472310c5a5224e1fe2cae",
        "patched_files": [
            "LocalServiceRegistryClientImpl.java",
            "AbstractServiceRegistry.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 4,
                "raw_url": "https://github.com/apache/servicecomb-java-chassis/raw/a2304046f39f0fa14174550a16b6fb377d580e90/service-registry/src/main/java/org/apache/servicecomb/serviceregistry/client/LocalServiceRegistryClientImpl.java",
                "contents_url": "https://api.github.com/repos/apache/servicecomb-java-chassis/contents/service-registry/src/main/java/org/apache/servicecomb/serviceregistry/client/LocalServiceRegistryClientImpl.java?ref=a2304046f39f0fa14174550a16b6fb377d580e90",
                "filename": "service-registry/src/main/java/org/apache/servicecomb/serviceregistry/client/LocalServiceRegistryClientImpl.java",
                "deletions": 2,
                "sha": "877b886f8c7fdccbac713349e5fe730ad55c0634",
                "blob_url": "https://github.com/apache/servicecomb-java-chassis/blob/a2304046f39f0fa14174550a16b6fb377d580e90/service-registry/src/main/java/org/apache/servicecomb/serviceregistry/client/LocalServiceRegistryClientImpl.java",
                "patch": "@@ -272,6 +272,9 @@ protected Microservice findLatest(String appId, String serviceName, VersionRule\n       String strVersionRule) {\n     MicroserviceInstances instances =\n         findServiceInstances(selfMicroserviceId, appId, serviceName, strVersionRule, null);\n+    if(instances.isMicroserviceNotExist()) {\n+      return null;\n+    }\n     return instances.getInstancesResponse().getInstances();\n   }\n \n@@ -291,8 +294,7 @@ public MicroserviceInstances findServiceInstances(String selfMicroserviceId, Str\n     VersionRule versionRule = VersionRuleUtils.getOrCreate(strVersionRule);\n     Microservice latestMicroservice = findLatest(appId, serviceName, versionRule);\n     if (latestMicroservice == null) {\n-      response.setInstances(allInstances);\n-      microserviceInstances.setInstancesResponse(response);\n+      microserviceInstances.setMicroserviceNotExist(true);\n       return microserviceInstances;\n     }\n ",
                "changes": 6
            },
            {
                "status": "modified",
                "additions": 1,
                "raw_url": "https://github.com/apache/servicecomb-java-chassis/raw/a2304046f39f0fa14174550a16b6fb377d580e90/service-registry/src/main/java/org/apache/servicecomb/serviceregistry/registry/AbstractServiceRegistry.java",
                "contents_url": "https://api.github.com/repos/apache/servicecomb-java-chassis/contents/service-registry/src/main/java/org/apache/servicecomb/serviceregistry/registry/AbstractServiceRegistry.java?ref=a2304046f39f0fa14174550a16b6fb377d580e90",
                "filename": "service-registry/src/main/java/org/apache/servicecomb/serviceregistry/registry/AbstractServiceRegistry.java",
                "deletions": 1,
                "sha": "e6aba3b5239dd1fb41b7ecbe617342f113aa218e",
                "blob_url": "https://github.com/apache/servicecomb-java-chassis/blob/a2304046f39f0fa14174550a16b6fb377d580e90/service-registry/src/main/java/org/apache/servicecomb/serviceregistry/registry/AbstractServiceRegistry.java",
                "patch": "@@ -223,7 +223,7 @@ public boolean unregisterInstance() {\n   public List<MicroserviceInstance> findServiceInstance(String appId, String serviceName,\n       String versionRule) {\n     MicroserviceInstances instances = findServiceInstances(appId, serviceName, versionRule, null);\n-    if (instances == null) {\n+    if (instances == null || instances.isMicroserviceNotExist()) {\n       return null;\n     }\n     return instances.getInstancesResponse().getInstances();",
                "changes": 2
            },
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/servicecomb-java-chassis/raw/a2304046f39f0fa14174550a16b6fb377d580e90/service-registry/src/test/java/org/apache/servicecomb/serviceregistry/TestRegistry.java",
                "contents_url": "https://api.github.com/repos/apache/servicecomb-java-chassis/contents/service-registry/src/test/java/org/apache/servicecomb/serviceregistry/TestRegistry.java?ref=a2304046f39f0fa14174550a16b6fb377d580e90",
                "filename": "service-registry/src/test/java/org/apache/servicecomb/serviceregistry/TestRegistry.java",
                "deletions": 0,
                "sha": "548f21e233116ed08e368a0f168c2d77ae13aba9",
                "blob_url": "https://github.com/apache/servicecomb-java-chassis/blob/a2304046f39f0fa14174550a16b6fb377d580e90/service-registry/src/test/java/org/apache/servicecomb/serviceregistry/TestRegistry.java",
                "patch": "@@ -99,6 +99,9 @@ public void testDelegate() {\n     Assert.assertEquals(1, instanceList.size());\n     Assert.assertEquals(RegistryUtils.getMicroservice().getServiceId(), instanceList.get(0).getServiceId());\n \n+    instanceList = RegistryUtils.findServiceInstance(\"default\", \"notExists\", \"0.0.1\");\n+    Assert.assertEquals(null, instanceList);\n+\n     MicroserviceInstances microserviceInstances =\n         RegistryUtils.findServiceInstances(\"default\", \"default\", \"0.0.1\", \"0\");\n     List<MicroserviceInstance> instanceLists = microserviceInstances.getInstancesResponse().getInstances();",
                "changes": 3
            },
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/servicecomb-java-chassis/raw/a2304046f39f0fa14174550a16b6fb377d580e90/service-registry/src/test/java/org/apache/servicecomb/serviceregistry/client/LocalServiceRegistryClientImplTest.java",
                "contents_url": "https://api.github.com/repos/apache/servicecomb-java-chassis/contents/service-registry/src/test/java/org/apache/servicecomb/serviceregistry/client/LocalServiceRegistryClientImplTest.java?ref=a2304046f39f0fa14174550a16b6fb377d580e90",
                "filename": "service-registry/src/test/java/org/apache/servicecomb/serviceregistry/client/LocalServiceRegistryClientImplTest.java",
                "deletions": 4,
                "sha": "e4fdc7dcfa54d6efa229e8501be96a14cca1d252",
                "blob_url": "https://github.com/apache/servicecomb-java-chassis/blob/a2304046f39f0fa14174550a16b6fb377d580e90/service-registry/src/test/java/org/apache/servicecomb/serviceregistry/client/LocalServiceRegistryClientImplTest.java",
                "patch": "@@ -121,13 +121,12 @@ public void findServiceInstance_noInstances() {\n     List<MicroserviceInstance> result =\n         registryClient.findServiceInstance(\"self\", appId, microserviceName, DefinitionConst.VERSION_RULE_ALL);\n \n-    Assert.assertThat(result, Matchers.empty());\n+    Assert.assertThat(result, Matchers.nullValue());\n \n     MicroserviceInstances microserviceInstances =\n         registryClient.findServiceInstances(\"self\", appId, microserviceName, DefinitionConst.VERSION_RULE_ALL, null);\n-    List<MicroserviceInstance> results = microserviceInstances.getInstancesResponse().getInstances();\n-\n-    Assert.assertThat(results, Matchers.empty());\n+    Assert.assertThat(microserviceInstances.isMicroserviceNotExist(), Matchers.is(true));\n+    Assert.assertThat(microserviceInstances.getInstancesResponse(), Matchers.nullValue());\n   }\n \n   @Test",
                "changes": 7
            }
        ],
        "unit_tests": [
            "LocalServiceRegistryClientImplTest.java",
            "TestRegistry.java",
            "TestAbstractServiceRegistry.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "service-registry/src/test/java/org/apache/servicecomb/serviceregistry/client/LocalServiceRegistryClientImplTest.java",
        "buggy_files": [
            "service-registry/src/main/java/org/apache/servicecomb/serviceregistry/client/LocalServiceRegistryClientImpl.java",
            "service-registry/src/main/java/org/apache/servicecomb/serviceregistry/registry/AbstractServiceRegistry.java"
        ],
        "fixed": true
    }
]