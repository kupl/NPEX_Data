[
    {
        "repo": "commons-collections",
        "commit": "https://github.com/apache/commons-collections/commit/c46666c5ddbc14bfdb910949de49ac353676f03f",
        "bug_id": "commons-collections_c46666c",
        "message": "[COLLECTIONS-710] NullPointerExceptions in CompositeCollection,\nCompositeSet, and CompositeMap.",
        "parent": "https://github.com/apache/commons-collections/commit/036bbf34d2742af78ff2c44f4223e1b268e1c12c",
        "patched_files": [
            "changes.xml",
            "CompositeMap.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 5,
                "raw_url": "https://github.com/apache/commons-collections/raw/c46666c5ddbc14bfdb910949de49ac353676f03f/src/changes/changes.xml",
                "contents_url": "https://api.github.com/repos/apache/commons-collections/contents/src/changes/changes.xml?ref=c46666c5ddbc14bfdb910949de49ac353676f03f",
                "filename": "src/changes/changes.xml",
                "deletions": 0,
                "sha": "422e25c8da9d21add189b49cb4565b64c1493471",
                "blob_url": "https://github.com/apache/commons-collections/blob/c46666c5ddbc14bfdb910949de49ac353676f03f/src/changes/changes.xml",
                "patch": "@@ -20,6 +20,11 @@\n     <title>Commons Collections Changes</title>\n   </properties>\n   <body>\n+  <release version=\"4.3.1\" date=\"2019-MM-DD\" description=\"Maintenance release.\">\n+    <action issue=\"COLLECTIONS-710\" dev=\"ggregory\" type=\"fix\" due-to=\"Yu Shi, Gary Gregory\">\n+      NullPointerExceptions in CompositeCollection, CompositeSet, and CompositeMap.\n+    </action>\n+  </release>\n   <release version=\"4.3\" date=\"2018-12-21\" description=\"Update from Java 7 to Java 8, bug fixes, and small changes.\">\n     <action issue=\"COLLECTIONS-691\" dev=\"kinow\" type=\"fix\" due-to=\"Eitan Adler\">\n       Use boolean operator for boolean result.",
                "changes": 5
            },
            {
                "status": "modified",
                "additions": 12,
                "raw_url": "https://github.com/apache/commons-collections/raw/c46666c5ddbc14bfdb910949de49ac353676f03f/src/main/java/org/apache/commons/collections4/map/CompositeMap.java",
                "contents_url": "https://api.github.com/repos/apache/commons-collections/contents/src/main/java/org/apache/commons/collections4/map/CompositeMap.java?ref=c46666c5ddbc14bfdb910949de49ac353676f03f",
                "filename": "src/main/java/org/apache/commons/collections4/map/CompositeMap.java",
                "deletions": 10,
                "sha": "8504b36a22b5eac5bf93bd105a79f4c1e6ef6a6d",
                "blob_url": "https://github.com/apache/commons-collections/blob/c46666c5ddbc14bfdb910949de49ac353676f03f/src/main/java/org/apache/commons/collections4/map/CompositeMap.java",
                "patch": "@@ -132,19 +132,21 @@ public void setMutator(final MapMutator<K, V> mutator) {\n      */\n     @SuppressWarnings(\"unchecked\")\n     public synchronized void addComposited(final Map<K, V> map) throws IllegalArgumentException {\n-        for (int i = composite.length - 1; i >= 0; --i) {\n-            final Collection<K> intersect = CollectionUtils.intersection(this.composite[i].keySet(), map.keySet());\n-            if (intersect.size() != 0) {\n-                if (this.mutator == null) {\n-                    throw new IllegalArgumentException(\"Key collision adding Map to CompositeMap\");\n+        if (map != null) {\n+            for (int i = composite.length - 1; i >= 0; --i) {\n+                final Collection<K> intersect = CollectionUtils.intersection(this.composite[i].keySet(), map.keySet());\n+                if (intersect.size() != 0) {\n+                    if (this.mutator == null) {\n+                        throw new IllegalArgumentException(\"Key collision adding Map to CompositeMap\");\n+                    }\n+                    this.mutator.resolveCollision(this, this.composite[i], map, intersect);\n                 }\n-                this.mutator.resolveCollision(this, this.composite[i], map, intersect);\n             }\n+            final Map<K, V>[] temp = new Map[this.composite.length + 1];\n+            System.arraycopy(this.composite, 0, temp, 0, this.composite.length);\n+            temp[temp.length - 1] = map;\n+            this.composite = temp;\n         }\n-        final Map<K, V>[] temp = new Map[this.composite.length + 1];\n-        System.arraycopy(this.composite, 0, temp, 0, this.composite.length);\n-        temp[temp.length - 1] = map;\n-        this.composite = temp;\n     }\n \n     /**",
                "changes": 22
            },
            {
                "status": "modified",
                "additions": 4,
                "raw_url": "https://github.com/apache/commons-collections/raw/c46666c5ddbc14bfdb910949de49ac353676f03f/src/test/java/org/apache/commons/collections4/map/CompositeMapTest.java",
                "contents_url": "https://api.github.com/repos/apache/commons-collections/contents/src/test/java/org/apache/commons/collections4/map/CompositeMapTest.java?ref=c46666c5ddbc14bfdb910949de49ac353676f03f",
                "filename": "src/test/java/org/apache/commons/collections4/map/CompositeMapTest.java",
                "deletions": 0,
                "sha": "4499eb211e2081cae49d8114fa8b4b355bef4b2f",
                "blob_url": "https://github.com/apache/commons-collections/blob/c46666c5ddbc14bfdb910949de49ac353676f03f/src/test/java/org/apache/commons/collections4/map/CompositeMapTest.java",
                "patch": "@@ -75,6 +75,7 @@ public void testAddComposited() {\n         final CompositeMap<K, V> map = new CompositeMap<>(buildOne(), buildTwo());\n         final HashMap<K, V> three = new HashMap<>();\n         three.put((K) \"5\", (V) \"five\");\n+        map.addComposited(null);\n         map.addComposited(three);\n         assertTrue(map.containsKey(\"5\"));\n         try {\n@@ -90,6 +91,7 @@ public void testRemoveComposited() {\n         final CompositeMap<K, V> map = new CompositeMap<>(buildOne(), buildTwo());\n         final HashMap<K, V> three = new HashMap<>();\n         three.put((K) \"5\", (V) \"five\");\n+        map.addComposited(null);\n         map.addComposited(three);\n         assertTrue(map.containsKey(\"5\"));\n \n@@ -106,6 +108,7 @@ public void testRemoveFromUnderlying() {\n         final CompositeMap<K, V> map = new CompositeMap<>(buildOne(), buildTwo());\n         final HashMap<K, V> three = new HashMap<>();\n         three.put((K) \"5\", (V) \"five\");\n+        map.addComposited(null);\n         map.addComposited(three);\n         assertTrue(map.containsKey(\"5\"));\n \n@@ -119,6 +122,7 @@ public void testRemoveFromComposited() {\n         final CompositeMap<K, V> map = new CompositeMap<>(buildOne(), buildTwo());\n         final HashMap<K, V> three = new HashMap<>();\n         three.put((K) \"5\", (V) \"five\");\n+        map.addComposited(null);\n         map.addComposited(three);\n         assertTrue(map.containsKey(\"5\"));\n ",
                "changes": 4
            }
        ],
        "unit_tests": [
            "CompositeMapTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "src/test/java/org/apache/commons/collections4/map/CompositeMapTest.java",
        "buggy_files": [
            "src/changes/changes.xml",
            "src/main/java/org/apache/commons/collections4/map/CompositeMap.java"
        ],
        "fixed": true
    }
]