[
    {
        "repo": "maven-docck-plugin",
        "message": "PR: MNG-2458: maven-docck-plugin proxy support\nSubmitted by: Denis Cabasson\nReviewed by: Vincent Siveton\n\nApplied with some changes:\no using maven-settings 2.0.4\no prevented NPE in the constructor with a new method: setupProxy()\no proxyPassword could be null\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/maven/plugins/trunk@429448 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/maven-docck-plugin/commit/16147a69bfc998cd11eefc34ebc19e2ddbbfbcce",
        "parent": "https://github.com/apache/maven-docck-plugin/commit/3c309b647adb0474976c32129cd4da7de51a3395",
        "bug_id": "maven-docck-plugin_1",
        "file": [
            {
                "sha": "27e27dd059907c4a5c7207471e52ba3f993670a7",
                "filename": "pom.xml",
                "blob_url": "https://github.com/apache/maven-docck-plugin/blob/16147a69bfc998cd11eefc34ebc19e2ddbbfbcce/pom.xml",
                "raw_url": "https://github.com/apache/maven-docck-plugin/raw/16147a69bfc998cd11eefc34ebc19e2ddbbfbcce/pom.xml",
                "status": "modified",
                "changes": 5,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/maven-docck-plugin/contents/pom.xml?ref=16147a69bfc998cd11eefc34ebc19e2ddbbfbcce",
                "patch": "@@ -71,6 +71,11 @@\n       <artifactId>maven-project</artifactId>\n       <version>2.0</version>\n     </dependency>\n+    <dependency>\n+      <groupId>org.apache.maven</groupId>\n+      <artifactId>maven-settings</artifactId>\n+      <version>2.0.4</version>\n+    </dependency>\n     <dependency>\n       <groupId>org.apache.maven</groupId>\n       <artifactId>maven-plugin-api</artifactId>",
                "deletions": 0
            },
            {
                "sha": "9da8e2671ccdf0657eed29fba8a585f858fc3989",
                "filename": "src/main/java/org/apache/maven/plugin/docck/AbstractCheckDocumentationMojo.java",
                "blob_url": "https://github.com/apache/maven-docck-plugin/blob/16147a69bfc998cd11eefc34ebc19e2ddbbfbcce/src/main/java/org/apache/maven/plugin/docck/AbstractCheckDocumentationMojo.java",
                "raw_url": "https://github.com/apache/maven-docck-plugin/raw/16147a69bfc998cd11eefc34ebc19e2ddbbfbcce/src/main/java/org/apache/maven/plugin/docck/AbstractCheckDocumentationMojo.java",
                "status": "modified",
                "changes": 82,
                "additions": 67,
                "contents_url": "https://api.github.com/repos/apache/maven-docck-plugin/contents/src/main/java/org/apache/maven/plugin/docck/AbstractCheckDocumentationMojo.java?ref=16147a69bfc998cd11eefc34ebc19e2ddbbfbcce",
                "patch": "@@ -16,8 +16,11 @@\n  * limitations under the License.\n  */\n \n+import org.apache.commons.httpclient.Credentials;\n import org.apache.commons.httpclient.HttpClient;\n import org.apache.commons.httpclient.HttpException;\n+import org.apache.commons.httpclient.UsernamePasswordCredentials;\n+import org.apache.commons.httpclient.auth.AuthScope;\n import org.apache.commons.httpclient.methods.HeadMethod;\n import org.apache.maven.model.IssueManagement;\n import org.apache.maven.model.License;\n@@ -30,6 +33,8 @@\n import org.apache.maven.plugin.docck.reports.DocumentationReport;\n import org.apache.maven.plugin.docck.reports.DocumentationReporter;\n import org.apache.maven.project.MavenProject;\n+import org.apache.maven.settings.Proxy;\n+import org.apache.maven.settings.Settings;\n import org.apache.maven.shared.model.fileset.FileSet;\n import org.apache.maven.shared.model.fileset.util.FileSetManager;\n import org.codehaus.plexus.util.IOUtil;\n@@ -79,13 +84,22 @@\n     protected String siteDirectory;\n \n     /**\n-     * Sets whether this plugin is running in offline or online mode. Also useful when you don't want\n-     * to verify http URLs.\n+     * Sets whether this plugin is running in offline or online mode. Also\n+     * useful when you don't want to verify http URLs.\n      *\n      * @parameter expression=\"${settings.offline}\"\n      */\n     private boolean offline;\n \n+    /**\n+     * The current user system settings for use in Maven.\n+     *\n+     * @parameter expression=\"${settings}\"\n+     * @required\n+     * @readonly\n+     */\n+    private Settings settings;\n+\n     private HttpClient httpClient;\n \n     private FileSetManager fileSetManager = new FileSetManager();\n@@ -95,6 +109,7 @@\n     protected AbstractCheckDocumentationMojo()\n     {\n         httpClient = new HttpClient();\n+\n         httpClient.getHttpConnectionManager().getParams().setConnectionTimeout( 5000 );\n     }\n \n@@ -106,6 +121,8 @@ protected List getReactorProjects()\n     public void execute()\n         throws MojoExecutionException, MojoFailureException\n     {\n+        setupProxy();\n+\n         if ( output != null )\n         {\n             getLog().info( \"Writing documentation survey results to: \" + output );\n@@ -173,6 +190,42 @@ public void execute()\n         }\n     }\n \n+    /**\n+     * Setup proxy access if needed.\n+     */\n+    private void setupProxy()\n+    {\n+        Proxy settingsProxy = settings.getActiveProxy();\n+\n+        if ( settingsProxy != null )\n+        {\n+            String proxyUsername = settingsProxy.getUsername();\n+\n+            String proxyPassword = settingsProxy.getPassword();\n+\n+            String proxyHost = settingsProxy.getHost();\n+\n+            int proxyPort = settingsProxy.getPort();\n+\n+            if ( StringUtils.isNotEmpty( proxyHost ) )\n+            {\n+                httpClient.getHostConfiguration().setProxy( proxyHost, proxyPort );\n+\n+                getLog().info( \"Using proxy[\" + proxyHost + \"] at port [\" + proxyPort + \"].\" );\n+\n+                if ( StringUtils.isNotEmpty( proxyUsername ) )\n+                {\n+                    getLog().info( \"Using proxy user[\" + proxyUsername + \"].\" );\n+\n+                    Credentials creds = new UsernamePasswordCredentials( proxyUsername, proxyPassword );\n+\n+                    httpClient.getState().setProxyCredentials( new AuthScope( proxyHost, proxyPort ), creds );\n+                    httpClient.getParams().setAuthenticationPreemptive( true );\n+                }\n+            }\n+        }\n+    }\n+\n     private String buildErrorMessages( Map reporters )\n     {\n         String messages = \"\";\n@@ -189,9 +242,9 @@ private String buildErrorMessages( Map reporters )\n             {\n                 buffer.append( \"\\no \" ).append( project.getName() );\n                 buffer.append( \" (\" ).append( reporter.getMessagesByType( DocumentationReport.TYPE_ERROR ).size() )\n-                      .append( \" errors,\" );\n+                    .append( \" errors,\" );\n                 buffer.append( \" \" ).append( reporter.getMessagesByType( DocumentationReport.TYPE_WARN ).size() )\n-                      .append( \" warnings)\" );\n+                    .append( \" warnings)\" );\n                 for ( Iterator errorIterator = reporter.getMessages().iterator(); errorIterator.hasNext(); )\n                 {\n                     String error = (String) errorIterator.next();\n@@ -264,7 +317,7 @@ private void checkPomRequirements( MavenProject project, DocumentationReporter r\n         }\n         else\n         {\n-            checkURL( project.getUrl(), \"project site\", reporter);\n+            checkURL( project.getUrl(), \"project site\", reporter );\n         }\n \n         if ( project.getIssueManagement() == null )\n@@ -293,7 +346,7 @@ private void checkPomRequirements( MavenProject project, DocumentationReporter r\n             Prerequisites prereq = project.getPrerequisites();\n             if ( StringUtils.isEmpty( prereq.getMaven() ) )\n             {\n-                reporter.error( \"Missing <maven> tag in <prerequisites>\");\n+                reporter.error( \"Missing <maven> tag in <prerequisites>\" );\n             }\n         }\n \n@@ -314,9 +367,8 @@ private void checkPomRequirements( MavenProject project, DocumentationReporter r\n         else\n         {\n             Scm scm = project.getScm();\n-            if ( StringUtils.isEmpty( scm.getConnection() ) &&\n-                 StringUtils.isEmpty( scm.getDeveloperConnection() ) &&\n-                 StringUtils.isEmpty( scm.getUrl() ) )\n+            if ( StringUtils.isEmpty( scm.getConnection() ) && StringUtils.isEmpty( scm.getDeveloperConnection() )\n+                && StringUtils.isEmpty( scm.getUrl() ) )\n             {\n                 reporter.warn( \"Missing children under the <scm> tag \" );\n             }\n@@ -426,13 +478,13 @@ else if ( !validUrls.contains( url ) )\n                     }\n                     catch ( HttpException e )\n                     {\n-                        reporter.error( \"Cannot reach \" + description + \" with URL: \\'\" + url +\n-                            \"\\'.\\nError: \" + e.getMessage() );\n+                        reporter.error( \"Cannot reach \" + description + \" with URL: \\'\" + url + \"\\'.\\nError: \"\n+                            + e.getMessage() );\n                     }\n                     catch ( IOException e )\n                     {\n-                        reporter.error( \"Cannot reach \" + description + \" with URL: \\'\" + url +\n-                            \"\\'.\\nError: \" + e.getMessage() );\n+                        reporter.error( \"Cannot reach \" + description + \" with URL: \\'\" + url + \"\\'.\\nError: \"\n+                            + e.getMessage() );\n                     }\n                     finally\n                     {\n@@ -447,8 +499,8 @@ else if ( !validUrls.contains( url ) )\n         }\n         catch ( MalformedURLException e )\n         {\n-            reporter.warn( description + \" appears to have an invalid URL: \\'\" + url +\n-                \"\\'.\\nError: \" + e.getMessage() + \"\\n\\nTrying to access it as a file instead.\" );\n+            reporter.warn( description + \" appears to have an invalid URL: \\'\" + url + \"\\'.\\nError: \" + e.getMessage()\n+                + \"\\n\\nTrying to access it as a file instead.\" );\n \n             checkFile( url, description, reporter );\n         }",
                "deletions": 15
            }
        ]
    }
]