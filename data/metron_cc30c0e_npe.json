[
    {
        "repo": "metron",
        "commit": "https://github.com/apache/metron/commit/cc30c0e21656fa95b488adb47a3c9fcec94af67a",
        "bug_id": "metron_cc30c0e",
        "message": "METRON-1996 Solr search throws NPE for group search if the group parameter is null or empty (MohanDV via nickwallen) closes apache/metron#1333",
        "parent": "https://github.com/apache/metron/commit/792e7962f32b8154cd501edb65fa3fb5819758dc",
        "patched_files": [
            "SolrSearchDao.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/metron/raw/cc30c0e21656fa95b488adb47a3c9fcec94af67a/metron-platform/metron-solr/src/main/java/org/apache/metron/solr/dao/SolrSearchDao.java",
                "contents_url": "https://api.github.com/repos/apache/metron/contents/metron-platform/metron-solr/src/main/java/org/apache/metron/solr/dao/SolrSearchDao.java?ref=cc30c0e21656fa95b488adb47a3c9fcec94af67a",
                "filename": "metron-platform/metron-solr/src/main/java/org/apache/metron/solr/dao/SolrSearchDao.java",
                "deletions": 0,
                "sha": "134d28c3c76b67614866d687e97fae49a8407187",
                "blob_url": "https://github.com/apache/metron/blob/cc30c0e21656fa95b488adb47a3c9fcec94af67a/metron-platform/metron-solr/src/main/java/org/apache/metron/solr/dao/SolrSearchDao.java",
                "patch": "@@ -105,6 +105,9 @@ public SearchResponse search(SearchRequest searchRequest, String fieldList)\n   @Override\n   public GroupResponse group(GroupRequest groupRequest) throws InvalidSearchException {\n     try {\n+      if (groupRequest.getGroups() == null || groupRequest.getGroups().size() == 0) {\n+        throw new InvalidSearchException(\"At least 1 group must be provided.\");\n+      }\n       String groupNames = groupRequest.getGroups().stream().map(Group::getField).collect(\n           Collectors.joining(\",\"));\n       SolrQuery query = new SolrQuery()",
                "changes": 3
            },
            {
                "status": "modified",
                "additions": 36,
                "raw_url": "https://github.com/apache/metron/raw/cc30c0e21656fa95b488adb47a3c9fcec94af67a/metron-platform/metron-solr/src/test/java/org/apache/metron/solr/dao/SolrSearchDaoTest.java",
                "contents_url": "https://api.github.com/repos/apache/metron/contents/metron-platform/metron-solr/src/test/java/org/apache/metron/solr/dao/SolrSearchDaoTest.java?ref=cc30c0e21656fa95b488adb47a3c9fcec94af67a",
                "filename": "metron-platform/metron-solr/src/test/java/org/apache/metron/solr/dao/SolrSearchDaoTest.java",
                "deletions": 0,
                "sha": "bf9458f09d7def4a021759cc373d5ecace280858",
                "blob_url": "https://github.com/apache/metron/blob/cc30c0e21656fa95b488adb47a3c9fcec94af67a/metron-platform/metron-solr/src/test/java/org/apache/metron/solr/dao/SolrSearchDaoTest.java",
                "patch": "@@ -135,6 +135,42 @@ public void searchShouldThrowInvalidSearchExceptionOnEmptyClient() throws Except\n     new SolrSearchDao(null, accessConfig).search(searchRequest);\n   }\n \n+  @Test\n+  public void searchShouldThrowInvalidSearchExceptionOnNullGroup() throws Exception {\n+    exception.expect(InvalidSearchException.class);\n+    exception.expectMessage(\"At least 1 group must be provided.\");\n+\n+    GroupRequest groupRequest = mock(GroupRequest.class);\n+    GroupResponse groupResponse = mock(GroupResponse.class);\n+\n+    solrSearchDao = spy(new SolrSearchDao(client, accessConfig));\n+    when(groupRequest.getQuery()).thenReturn(\"query\");\n+    when(groupRequest.getGroups()).thenReturn(null);\n+    when(groupRequest.getScoreField()).thenReturn(Optional.of(\"scoreField\"));\n+    when(groupRequest.getIndices()).thenReturn(Arrays.asList(\"bro\", \"snort\"));\n+\n+    assertEquals(groupResponse, solrSearchDao.group(groupRequest));\n+    verifyNoMoreInteractions(client);\n+  }\n+\n+  @Test\n+  public void searchShouldThrowInvalidSearchExceptionOnEmptyGroup() throws Exception {\n+    exception.expect(InvalidSearchException.class);\n+    exception.expectMessage(\"At least 1 group must be provided.\");\n+\n+    GroupRequest groupRequest = mock(GroupRequest.class);\n+    GroupResponse groupResponse = mock(GroupResponse.class);\n+\n+    solrSearchDao = spy(new SolrSearchDao(client, accessConfig));\n+    when(groupRequest.getQuery()).thenReturn(\"query\");\n+    when(groupRequest.getGroups()).thenReturn(Collections.EMPTY_LIST);\n+    when(groupRequest.getScoreField()).thenReturn(Optional.of(\"scoreField\"));\n+    when(groupRequest.getIndices()).thenReturn(Arrays.asList(\"bro\", \"snort\"));\n+\n+    assertEquals(groupResponse, solrSearchDao.group(groupRequest));\n+    verifyNoMoreInteractions(client);\n+  }\n+\n   @Test\n   public void searchShouldThrowSearchResultSizeException() throws Exception {\n     exception.expect(InvalidSearchException.class);",
                "changes": 36
            }
        ],
        "unit_tests": [
            "SolrSearchDaoTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "metron-platform/metron-solr/src/test/java/org/apache/metron/solr/dao/SolrSearchDaoTest.java",
        "buggy_files": [
            "metron-platform/metron-solr/src/main/java/org/apache/metron/solr/dao/SolrSearchDao.java"
        ],
        "fixed": true
    }
]