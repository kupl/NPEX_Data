[{"commit": "https://github.com/apache/incubator-iceberg/commit/ce7aeae0e19771a722662a634c4cb82c39e86209", "parent": "https://github.com/apache/incubator-iceberg/commit/a0ee2975adcb181dfbff8e8ae1463a340e3bf0ff", "message": "Fix NPE in ScanSummary.", "bug_id": "incubator-iceberg_1", "file": [{"additions": 3, "raw_url": "https://github.com/apache/incubator-iceberg/raw/ce7aeae0e19771a722662a634c4cb82c39e86209/core/src/main/java/com/netflix/iceberg/ScanSummary.java", "blob_url": "https://github.com/apache/incubator-iceberg/blob/ce7aeae0e19771a722662a634c4cb82c39e86209/core/src/main/java/com/netflix/iceberg/ScanSummary.java", "sha": "66f28ddfac1eadbbe0f5bf88f7473d59718b6b2e", "changes": 4, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/incubator-iceberg/contents/core/src/main/java/com/netflix/iceberg/ScanSummary.java?ref=ce7aeae0e19771a722662a634c4cb82c39e86209", "patch": "@@ -138,10 +138,12 @@ private PartitionMetrics updateFromFile(DataFile file, Long timestampMillis) {\n \n     @Override\n     public String toString() {\n+      String lastUpdated = lastUpdatedMillis != null ?\n+          new Date(lastUpdatedMillis).toString() : null;\n       return \"PartitionMetrics(fileCount=\" + fileCount +\n           \", recordCount=\" + recordCount +\n           \", totalSize=\" + totalSize +\n-          \", lastUpdatedMillis=\" + new Date(lastUpdatedMillis).toString() + \")\";\n+          \", lastUpdated=\" + lastUpdated + \")\";\n     }\n   }\n ", "filename": "core/src/main/java/com/netflix/iceberg/ScanSummary.java"}], "repo": "incubator-iceberg"}, {"commit": "https://github.com/apache/incubator-iceberg/commit/c1f6603a4e3d73270034a9f92e135d482983e219", "parent": "https://github.com/apache/incubator-iceberg/commit/f94d687755de0bdee40eaaee07b101e5d150c669", "message": "Spark: Fix NPE in PartitionKey accessors. (#73)", "bug_id": "incubator-iceberg_2", "file": [{"additions": 13, "raw_url": "https://github.com/apache/incubator-iceberg/raw/c1f6603a4e3d73270034a9f92e135d482983e219/spark/src/main/java/com/netflix/iceberg/spark/source/PartitionKey.java", "blob_url": "https://github.com/apache/incubator-iceberg/blob/c1f6603a4e3d73270034a9f92e135d482983e219/spark/src/main/java/com/netflix/iceberg/spark/source/PartitionKey.java", "sha": "7e5abd431d5f1d8071f054cbe3ebd4803ba8bdde", "changes": 17, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/incubator-iceberg/contents/spark/src/main/java/com/netflix/iceberg/spark/source/PartitionKey.java?ref=c1f6603a4e3d73270034a9f92e135d482983e219", "patch": "@@ -228,8 +228,8 @@ public int hashCode() {\n   }\n \n   private static class PositionAccessor implements Accessor<InternalRow> {\n-    private final DataType type;\n-    private int p;\n+    protected final DataType type;\n+    protected int p;\n \n     private PositionAccessor(int p, DataType type) {\n       this.p = p;\n@@ -238,6 +238,9 @@ private PositionAccessor(int p, DataType type) {\n \n     @Override\n     public Object get(InternalRow row) {\n+      if (row.isNullAt(p)) {\n+        return null;\n+      }\n       return row.get(p, type);\n     }\n   }\n@@ -249,7 +252,10 @@ private StringAccessor(int p, DataType type) {\n \n     @Override\n     public Object get(InternalRow row) {\n-      return super.get(row).toString();\n+      if (row.isNullAt(p)) {\n+        return null;\n+      }\n+      return row.get(p, type).toString();\n     }\n   }\n \n@@ -260,7 +266,10 @@ private DecimalAccessor(int p, DataType type) {\n \n     @Override\n     public Object get(InternalRow row) {\n-      return ((Decimal) super.get(row)).toJavaBigDecimal();\n+      if (row.isNullAt(p)) {\n+        return null;\n+      }\n+      return ((Decimal) row.get(p, type)).toJavaBigDecimal();\n     }\n   }\n ", "filename": "spark/src/main/java/com/netflix/iceberg/spark/source/PartitionKey.java"}], "repo": "incubator-iceberg"}, {"commit": "https://github.com/apache/incubator-iceberg/commit/77a9ad7a07a6ec8938abdfaeda1b72d232352a9c", "parent": "https://github.com/apache/incubator-iceberg/commit/f6ed7ab0ba5541c3b119985af6cfab222941178c", "message": "Fix NPE in Spark Reader stats method.", "bug_id": "incubator-iceberg_3", "file": [{"additions": 1, "raw_url": "https://github.com/apache/incubator-iceberg/raw/77a9ad7a07a6ec8938abdfaeda1b72d232352a9c/spark/src/main/java/com/netflix/iceberg/spark/source/Reader.java", "blob_url": "https://github.com/apache/incubator-iceberg/blob/77a9ad7a07a6ec8938abdfaeda1b72d232352a9c/spark/src/main/java/com/netflix/iceberg/spark/source/Reader.java", "sha": "3cb7fa052e15c6f026d4d0c28ba5410fc18e973f", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/incubator-iceberg/contents/spark/src/main/java/com/netflix/iceberg/spark/source/Reader.java?ref=77a9ad7a07a6ec8938abdfaeda1b72d232352a9c", "patch": "@@ -198,7 +198,7 @@ public Statistics getStatistics() {\n     long sizeInBytes = 0L;\n     long numRows = 0L;\n \n-    for (CombinedScanTask task : tasks) {\n+    for (CombinedScanTask task : tasks()) {\n       for (FileScanTask file : task.files()) {\n         sizeInBytes += file.length();\n         numRows += file.file().recordCount();", "filename": "spark/src/main/java/com/netflix/iceberg/spark/source/Reader.java"}], "repo": "incubator-iceberg"}, {"commit": "https://github.com/apache/incubator-iceberg/commit/f258bfa1fa89239f0dae18ed49f911602954de1b", "parent": "https://github.com/apache/incubator-iceberg/commit/c5c51e52eda6cdcd794e7817435687423c23d62a", "message": "Fix SparkExpressions.convert recursion with nulls.\n\nConversion returns null to signal that the expression is not supported,\nbut in recursive calls it wasn't checking that the wrapped expression\nwas converted to null. This caused some expressions like not(isnan(d))\nto be converted and pushed to Iceberg even though they are not\nsupported. Iceberg later hit a NPE because an expression was null.\n\nThis also checks for null expressions in the Expressions factory\nmethods.", "bug_id": "incubator-iceberg_4", "file": [{"additions": 5, "raw_url": "https://github.com/apache/incubator-iceberg/raw/f258bfa1fa89239f0dae18ed49f911602954de1b/api/src/main/java/com/netflix/iceberg/expressions/Expressions.java", "blob_url": "https://github.com/apache/incubator-iceberg/blob/f258bfa1fa89239f0dae18ed49f911602954de1b/api/src/main/java/com/netflix/iceberg/expressions/Expressions.java", "sha": "af28b52b7406aee3c64b321046ed9d935ca354bb", "changes": 5, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/incubator-iceberg/contents/api/src/main/java/com/netflix/iceberg/expressions/Expressions.java?ref=f258bfa1fa89239f0dae18ed49f911602954de1b", "patch": "@@ -24,6 +24,8 @@\n  */\n public class Expressions {\n   public static Expression and(Expression left, Expression right) {\n+    Preconditions.checkNotNull(left, \"Left expression cannot be null.\");\n+    Preconditions.checkNotNull(right, \"Right expression cannot be null.\");\n     if (left == alwaysFalse() || right == alwaysFalse()) {\n       return alwaysFalse();\n     } else if (left == alwaysTrue()) {\n@@ -35,6 +37,8 @@ public static Expression and(Expression left, Expression right) {\n   }\n \n   public static Expression or(Expression left, Expression right) {\n+    Preconditions.checkNotNull(left, \"Left expression cannot be null.\");\n+    Preconditions.checkNotNull(right, \"Right expression cannot be null.\");\n     if (left == alwaysTrue() || right == alwaysTrue()) {\n       return alwaysTrue();\n     } else if (left == alwaysFalse()) {\n@@ -46,6 +50,7 @@ public static Expression or(Expression left, Expression right) {\n   }\n \n   public static Expression not(Expression child) {\n+    Preconditions.checkNotNull(child, \"Child expression cannot be null.\");\n     if (child == alwaysTrue()) {\n       return alwaysFalse();\n     } else if (child == alwaysFalse()) {", "filename": "api/src/main/java/com/netflix/iceberg/expressions/Expressions.java"}, {"additions": 17, "raw_url": "https://github.com/apache/incubator-iceberg/raw/f258bfa1fa89239f0dae18ed49f911602954de1b/spark/src/main/java/com/netflix/iceberg/spark/SparkExpressions.java", "blob_url": "https://github.com/apache/incubator-iceberg/blob/f258bfa1fa89239f0dae18ed49f911602954de1b/spark/src/main/java/com/netflix/iceberg/spark/SparkExpressions.java", "sha": "9bd8b209a2dfd2b18b82f95276f3c4bdb04eff87", "changes": 21, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/incubator-iceberg/contents/spark/src/main/java/com/netflix/iceberg/spark/SparkExpressions.java?ref=f258bfa1fa89239f0dae18ed49f911602954de1b", "patch": "@@ -23,7 +23,6 @@\n import com.netflix.iceberg.expressions.BoundReference;\n import com.netflix.iceberg.expressions.Expression.Operation;\n import com.netflix.iceberg.expressions.ExpressionVisitors;\n-import com.netflix.iceberg.expressions.Expressions;\n import com.netflix.iceberg.types.Types.TimestampType;\n import com.netflix.iceberg.util.Pair;\n import org.apache.spark.sql.Column;\n@@ -123,13 +122,27 @@ private SparkExpressions() {\n           BinaryExpression binary = (BinaryExpression) expr;\n           return convert(op, binary.left(), binary.right());\n         case NOT:\n-          return not(convert(((Not) expr).child()));\n+          com.netflix.iceberg.expressions.Expression child = convert(((Not) expr).child());\n+          if (child != null) {\n+            return not(child);\n+          }\n+          return null;\n         case AND:\n           And andExpr = (And) expr;\n-          return and(convert(andExpr.left()), convert(andExpr.right()));\n+          com.netflix.iceberg.expressions.Expression andLeft = convert(andExpr.left());\n+          com.netflix.iceberg.expressions.Expression andRight = convert(andExpr.right());\n+          if (andLeft != null && andRight != null) {\n+            return and(convert(andExpr.left()), convert(andExpr.right()));\n+          }\n+          return null;\n         case OR:\n           Or orExpr = (Or) expr;\n-          return or(convert(orExpr.left()), convert(orExpr.right()));\n+          com.netflix.iceberg.expressions.Expression orLeft = convert(orExpr.left());\n+          com.netflix.iceberg.expressions.Expression orRight = convert(orExpr.right());\n+          if (orLeft != null && orRight != null) {\n+            return or(orLeft, orRight);\n+          }\n+          return null;\n         case IN:\n           if (expr instanceof In) {\n             In inExpr = (In) expr;", "filename": "spark/src/main/java/com/netflix/iceberg/spark/SparkExpressions.java"}], "repo": "incubator-iceberg"}]
