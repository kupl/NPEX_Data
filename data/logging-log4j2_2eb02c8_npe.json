[
    {
        "repo": "logging-log4j2",
        "commit": "https://github.com/apache/logging-log4j2/commit/2eb02c8276ea774e669dc1bc732be690a10f3c85",
        "bug_id": "logging-log4j2_2eb02c8",
        "message": "[LOG4J2-1687] NPE in ThrowableProxy when resolving stack in Java EE/OSGi\nenvironment.",
        "parent": "https://github.com/apache/logging-log4j2/commit/18889185619b8fa634a67e1450c6ee6348e9d599",
        "patched_files": [
            "changes.xml",
            "ThrowableProxy.java",
            "Loader.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 2,
                "raw_url": "https://github.com/apache/logging-log4j2/raw/2eb02c8276ea774e669dc1bc732be690a10f3c85/log4j-core/src/main/java/org/apache/logging/log4j/core/impl/ThrowableProxy.java",
                "contents_url": "https://api.github.com/repos/apache/logging-log4j2/contents/log4j-core/src/main/java/org/apache/logging/log4j/core/impl/ThrowableProxy.java?ref=2eb02c8276ea774e669dc1bc732be690a10f3c85",
                "filename": "log4j-core/src/main/java/org/apache/logging/log4j/core/impl/ThrowableProxy.java",
                "deletions": 1,
                "sha": "4dd19682cc0106b8850b3521eb516bfe52ea7072",
                "blob_url": "https://github.com/apache/logging-log4j2/blob/2eb02c8276ea774e669dc1bc732be690a10f3c85/log4j-core/src/main/java/org/apache/logging/log4j/core/impl/ThrowableProxy.java",
                "patch": "@@ -30,6 +30,7 @@\n \n import org.apache.logging.log4j.core.pattern.PlainTextRenderer;\n import org.apache.logging.log4j.core.pattern.TextRenderer;\n+import org.apache.logging.log4j.core.util.Loader;\n import org.apache.logging.log4j.status.StatusLogger;\n import org.apache.logging.log4j.util.LoaderUtil;\n import org.apache.logging.log4j.util.ReflectionUtil;\n@@ -556,7 +557,7 @@ private boolean ignoreElement(final StackTraceElement element, final List<String\n \n     private Class<?> loadClass(final String className) {\n         try {\n-            return this.getClass().getClassLoader().loadClass(className);\n+            return Loader.loadClass(className,this.getClass().getClassLoader());\n         } catch (final ClassNotFoundException | NoClassDefFoundError | SecurityException e) {\n             return null;\n         }",
                "changes": 3
            },
            {
                "status": "modified",
                "additions": 13,
                "raw_url": "https://github.com/apache/logging-log4j2/raw/2eb02c8276ea774e669dc1bc732be690a10f3c85/log4j-core/src/main/java/org/apache/logging/log4j/core/util/Loader.java",
                "contents_url": "https://api.github.com/repos/apache/logging-log4j2/contents/log4j-core/src/main/java/org/apache/logging/log4j/core/util/Loader.java?ref=2eb02c8276ea774e669dc1bc732be690a10f3c85",
                "filename": "log4j-core/src/main/java/org/apache/logging/log4j/core/util/Loader.java",
                "deletions": 0,
                "sha": "d1013f72952bcf902b816e1ac0ff1f250b68dedd",
                "blob_url": "https://github.com/apache/logging-log4j2/blob/2eb02c8276ea774e669dc1bc732be690a10f3c85/log4j-core/src/main/java/org/apache/logging/log4j/core/util/Loader.java",
                "patch": "@@ -227,6 +227,19 @@ private static boolean isChild(final ClassLoader loader1, final ClassLoader load\n         return Class.forName(className, true, loader);\n     }\n \n+    /**\n+     * Loads a named Class using a given ClassLoader.\n+     *\n+     * @param className The class name.\n+     * @param loader The class loader.\n+     * @return The class, or null if loader is null.\n+     * @throws ClassNotFoundException if the class could not be found.\n+     */\n+    public static Class<?> loadClass(final String className, final ClassLoader loader)\n+            throws ClassNotFoundException {\n+        return loader != null ? loader.loadClass(className) : null;\n+    }    \n+    \n     /**\n      * Load a Class in the {@code java.*} namespace by name. Useful for peculiar scenarios typically involving\n      * Google App Engine.",
                "changes": 13
            },
            {
                "status": "added",
                "additions": 40,
                "raw_url": "https://github.com/apache/logging-log4j2/raw/2eb02c8276ea774e669dc1bc732be690a10f3c85/log4j-core/src/test/java/org/apache/logging/log4j/core/util/LoaderTest.java",
                "contents_url": "https://api.github.com/repos/apache/logging-log4j2/contents/log4j-core/src/test/java/org/apache/logging/log4j/core/util/LoaderTest.java?ref=2eb02c8276ea774e669dc1bc732be690a10f3c85",
                "filename": "log4j-core/src/test/java/org/apache/logging/log4j/core/util/LoaderTest.java",
                "deletions": 0,
                "sha": "c97d3b6cb42da97de3250d1c2b6abda123c0d37c",
                "blob_url": "https://github.com/apache/logging-log4j2/blob/2eb02c8276ea774e669dc1bc732be690a10f3c85/log4j-core/src/test/java/org/apache/logging/log4j/core/util/LoaderTest.java",
                "patch": "@@ -0,0 +1,40 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache license, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the license for the specific language governing permissions and\n+ * limitations under the license.\n+ */\n+\n+package org.apache.logging.log4j.core.util;\n+\n+import org.junit.Test;\n+\n+import static org.junit.Assert.*;\n+\n+/**\n+ * Tests the Loader class.\n+ */\n+public class LoaderTest {\n+\n+    @Test\n+    public void testLoadClassWithNullClassloaderReturnNull() throws Exception {\n+        assertNull(\"Expect null return value for null ClassLoader.\",\n+                Loader.loadClass(Loader.class.getCanonicalName(), null));\n+    }\n+\n+    @Test\n+    public void testLoadClassReturnClassForExistingClass() throws Exception {\n+        assertEquals(\"Expect Class return value for null ClassLoader.\", Loader.class,\n+                Loader.loadClass(Loader.class.getCanonicalName(), Loader.getClassLoader()));\n+    }\n+}\n\\ No newline at end of file",
                "changes": 40
            },
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/logging-log4j2/raw/2eb02c8276ea774e669dc1bc732be690a10f3c85/src/changes/changes.xml",
                "contents_url": "https://api.github.com/repos/apache/logging-log4j2/contents/src/changes/changes.xml?ref=2eb02c8276ea774e669dc1bc732be690a10f3c85",
                "filename": "src/changes/changes.xml",
                "deletions": 0,
                "sha": "a6279b26c79ebca1841058cce7a7ee470e676c3e",
                "blob_url": "https://github.com/apache/logging-log4j2/blob/2eb02c8276ea774e669dc1bc732be690a10f3c85/src/changes/changes.xml",
                "patch": "@@ -144,6 +144,9 @@\n       <action issue=\"LOG4J2-1664\" dev=\"ggregory\" type=\"fix\" due-to=\"Ludovic HOCHET\">\n         Improve OSGi unit tests.\n       </action>\n+      <action issue=\"LOG4J2-1687\" dev=\"ggregory\" type=\"fix\" due-to=\"Robert Christiansen\">\n+        NPE in ThrowableProxy when resolving stack in Java EE/OSGi environment.\n+      </action>\n       <action issue=\"LOG4J2-1644\" dev=\"ggregory\" type=\"update\" due-to=\"Tim Gokcen, Pavel Sivolobtchik\">\n         Inefficient locking in AbstractLoggerAdapter.\n       </action>",
                "changes": 3
            }
        ],
        "unit_tests": [
            "ThrowableProxyTest.java",
            "LoaderTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "log4j-core/src/test/java/org/apache/logging/log4j/core/impl/ThrowableProxyTest.java",
        "buggy_files": [
            "src/changes/changes.xml",
            "log4j-core/src/main/java/org/apache/logging/log4j/core/impl/ThrowableProxy.java",
            "log4j-core/src/main/java/org/apache/logging/log4j/core/util/Loader.java"
        ],
        "fixed": true
    }
]