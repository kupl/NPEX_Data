{
    "jspwiki_ab8c7fb": {
        "repo": "jspwiki",
        "message": "added some log messages and firing a FileNotFoundException if the policy file isn't found, in order to get a  meaningful exception on the log file instead of a NullPointerException on startup\n\ngit-svn-id: https://svn.apache.org/repos/asf/jspwiki/trunk@1592420 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/jspwiki/commit/ab8c7fb529af8cb4e6f9e65094a1dbec6dbf7db7",
        "parent": "https://github.com/apache/jspwiki/commit/d8b8f4b8ce9828afb9a418ed69da498f4596eca8",
        "bug_id": "jspwiki_ab8c7fb",
        "file": [
            {
                "sha": "de726806dda36a7db101d1826dd01a42b2c06f2a",
                "filename": "jspwiki-war/src/main/java/org/apache/wiki/auth/AuthenticationManager.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/ab8c7fb529af8cb4e6f9e65094a1dbec6dbf7db7/jspwiki-war/src/main/java/org/apache/wiki/auth/AuthenticationManager.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/ab8c7fb529af8cb4e6f9e65094a1dbec6dbf7db7/jspwiki-war/src/main/java/org/apache/wiki/auth/AuthenticationManager.java",
                "status": "modified",
                "changes": 6,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-war/src/main/java/org/apache/wiki/auth/AuthenticationManager.java?ref=ab8c7fb529af8cb4e6f9e65094a1dbec6dbf7db7",
                "patch": "@@ -19,6 +19,7 @@ Licensed to the Apache Software Foundation (ASF) under one\n package org.apache.wiki.auth;\n \n import java.io.File;\n+import java.io.FileNotFoundException;\n import java.io.FileOutputStream;\n import java.io.IOException;\n import java.io.InputStream;\n@@ -606,6 +607,7 @@ public static boolean isUserPrincipal( Principal principal )\n      */\n     protected static URL findConfigFile( WikiEngine engine, String name )\n     {\n+        log.info( \"looking for \" + name + \" inside WEB-INF \" );\n         // Try creating an absolute path first\n         File defaultFile = null;\n         if( engine.getRootPath() != null )\n@@ -636,9 +638,13 @@ protected static URL findConfigFile( WikiEngine engine, String name )\n         \tInputStream is = null;\n             try\n             {\n+                log.info( \"looking for /\" + name + \" on classpath\" );\n                 //  create a tmp file of the policy loaded as an InputStream and return the URL to it\n                 //  \n                 is = AuthenticationManager.class.getResourceAsStream( \"/\" + name );\n+                if( is == null ) {\n+                    throw new FileNotFoundException( name + \" not found\" );\n+                }\n                 File tmpFile = File.createTempFile( \"temp.\" + name, \"\" );\n                 tmpFile.deleteOnExit();\n ",
                "deletions": 0
            }
        ],
        "patched_files": [
            "AuthenticationManager.java"
        ],
        "unit_tests": [
            "AuthenticationManagerTest.java"
        ]
    },
    "jspwiki_c53d53c": {
        "repo": "jspwiki",
        "message": "* 2.10.0-svn-3\n\n* JSPWIKI-771: inherit ASF parent pom. Deleted release profile in favour of\n  apache-release and gpg configuration (both present on parent pom);\n  added <ciManagement/>, <issueManagement/> and <mailingLists/> sections.\n       \n* fixed runtime NPE on WikiJSPFilter (m_engine used before having been initialized)\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jspwiki/trunk@1488662 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/jspwiki/commit/c53d53c5005835b3330aa23fcf34af1e1cf3c50f",
        "parent": "https://github.com/apache/jspwiki/commit/33f7b18db041a0731e07ab165855875665954c0d",
        "bug_id": "jspwiki_c53d53c",
        "file": [
            {
                "sha": "89bc6031fb2d5df0c790e609057cd732fd099a7e",
                "filename": "ChangeLog",
                "blob_url": "https://github.com/apache/jspwiki/blob/c53d53c5005835b3330aa23fcf34af1e1cf3c50f/ChangeLog",
                "raw_url": "https://github.com/apache/jspwiki/raw/c53d53c5005835b3330aa23fcf34af1e1cf3c50f/ChangeLog",
                "status": "modified",
                "changes": 10,
                "additions": 10,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/ChangeLog?ref=c53d53c5005835b3330aa23fcf34af1e1cf3c50f",
                "patch": "@@ -1,3 +1,13 @@\n+2013-06-02  Juan Pablo Santos (juanpablo AT apache DOT org)\n+\n+       * 2.10.0-svn-3\n+\n+       * JSPWIKI-771: inherit ASF parent pom. Deleted release profile in favour of\n+         apache-release and gpg configuration (both present on parent pom);\n+         added <ciManagement/>, <issueManagement/> and <mailingLists/> sections.\n+       \n+       * fixed runtime NPE on WikiJSPFilter (m_engine used before having been initialized)\n+\n 2013-06-01  Harry Metske (metskem@apache.org)\n \n        * 2.10.0-svn-2",
                "deletions": 0
            },
            {
                "sha": "83428cfee833972b5c6b48b90960264aaf0e57e6",
                "filename": "jspwiki-war/src/main/java/org/apache/wiki/Release.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/c53d53c5005835b3330aa23fcf34af1e1cf3c50f/jspwiki-war/src/main/java/org/apache/wiki/Release.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/c53d53c5005835b3330aa23fcf34af1e1cf3c50f/jspwiki-war/src/main/java/org/apache/wiki/Release.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-war/src/main/java/org/apache/wiki/Release.java?ref=c53d53c5005835b3330aa23fcf34af1e1cf3c50f",
                "patch": "@@ -75,7 +75,7 @@ Licensed to the Apache Software Foundation (ASF) under one\n      *  <p>\n      *  If the build identifier is empty, it is not added.\n      */\n-    public static final String     BUILD         = \"2\";\n+    public static final String     BUILD         = \"3\";\n     \n     /**\n      *  This is the generic version string you should use",
                "deletions": 1
            }
        ],
        "patched_files": [
            "Release.java"
        ],
        "unit_tests": [
            "ReleaseTest.java"
        ]
    },
    "jspwiki_1b5a0c3": {
        "repo": "jspwiki",
        "message": " * 2.10.1-svn-15\n       \n * Fixed JSPWIKI-822 - NPE thrown by PluginContext#getText()\n       \n * JSPWIKI-814 - VersioningFileProvider does migrate original page properties (thanks to Brian Burch)\n\ngit-svn-id: https://svn.apache.org/repos/asf/jspwiki/trunk@1589240 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/jspwiki/commit/1b5a0c3c11dd7aea448f966e96aea6fc27ea63d1",
        "parent": "https://github.com/apache/jspwiki/commit/539c6495cb2d40eb38b815deb82ed8868d85396b",
        "bug_id": "jspwiki_1b5a0c3",
        "file": [
            {
                "sha": "75d694b5d7cf6acae9186a39fb987646d18cbb59",
                "filename": "ChangeLog",
                "blob_url": "https://github.com/apache/jspwiki/blob/1b5a0c3c11dd7aea448f966e96aea6fc27ea63d1/ChangeLog",
                "raw_url": "https://github.com/apache/jspwiki/raw/1b5a0c3c11dd7aea448f966e96aea6fc27ea63d1/ChangeLog",
                "status": "modified",
                "changes": 8,
                "additions": 8,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/ChangeLog?ref=1b5a0c3c11dd7aea448f966e96aea6fc27ea63d1",
                "patch": "@@ -1,3 +1,11 @@\n+2014-04-20  Juan Pablo Santos (juanpablo AT apache DOT org)\n+\n+       * 2.10.1-svn-15\n+       \n+       * Fixed JSPWIKI-822 - NPE thrown by PluginContext#getText()\n+       \n+       * JSPWIKI-814 - VersioningFileProvider does migrate original page properties (thanks to Brian Burch)\n+\n 2014-04-20  Juan Pablo Santos (juanpablo AT apache DOT org)\n \n        * 2.10.1-svn-14",
                "deletions": 0
            },
            {
                "sha": "c7618450c001d2f5522618b68ed6971c1fb5a83b",
                "filename": "jspwiki-war/src/main/java/org/apache/wiki/Release.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1b5a0c3c11dd7aea448f966e96aea6fc27ea63d1/jspwiki-war/src/main/java/org/apache/wiki/Release.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1b5a0c3c11dd7aea448f966e96aea6fc27ea63d1/jspwiki-war/src/main/java/org/apache/wiki/Release.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-war/src/main/java/org/apache/wiki/Release.java?ref=1b5a0c3c11dd7aea448f966e96aea6fc27ea63d1",
                "patch": "@@ -72,7 +72,7 @@ Licensed to the Apache Software Foundation (ASF) under one\n      *  <p>\n      *  If the build identifier is empty, it is not added.\n      */\n-    public static final String     BUILD         = \"14\";\n+    public static final String     BUILD         = \"15\";\n     \n     /**\n      *  This is the generic version string you should use when printing out the version.  It is of ",
                "deletions": 1
            }
        ],
        "patched_files": [
            "Release.java"
        ],
        "unit_tests": [
            "ReleaseTest.java"
        ]
    },
    "jspwiki_85297fc": {
        "repo": "jspwiki",
        "message": " * 2.10.2-svn-6\n\n * Fixed JSPWIKI-855: NullPointerException in FormInput.java:92, patch provided by J\u00fcrgen Weber - thanks!\n\ngit-svn-id: https://svn.apache.org/repos/asf/jspwiki/trunk@1617380 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/jspwiki/commit/85297fc9cadd575b456b5dc29724e5b68cd69db3",
        "parent": "https://github.com/apache/jspwiki/commit/d78fb1237f3c9479718dce51630772f6a911d684",
        "bug_id": "jspwiki_85297fc",
        "file": [
            {
                "sha": "368b70cf4e2d7cba1fb1b85ca53e5a3a6d5005da",
                "filename": "ChangeLog",
                "blob_url": "https://github.com/apache/jspwiki/blob/85297fc9cadd575b456b5dc29724e5b68cd69db3/ChangeLog",
                "raw_url": "https://github.com/apache/jspwiki/raw/85297fc9cadd575b456b5dc29724e5b68cd69db3/ChangeLog",
                "status": "modified",
                "changes": 6,
                "additions": 6,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/ChangeLog?ref=85297fc9cadd575b456b5dc29724e5b68cd69db3",
                "patch": "@@ -1,3 +1,9 @@\n+2014-08-12  Juan Pablo Santos (juanpablo AT apache DOT org)\n+\n+       * 2.10.2-svn-6\n+\n+       * Fixed JSPWIKI-855: NullPointerException in FormInput.java:92, patch provided by J\u00fcrgen Weber - thanks!\n+\n 2014-07-31  Harry Metske (metskem@apache.org)\n \n        * 2.10.2-svn-5",
                "deletions": 0
            },
            {
                "sha": "9d63e7a60b0f5ef27c316eb2c8cbfd7222fb37b8",
                "filename": "jspwiki-war/src/main/java/org/apache/wiki/Release.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/85297fc9cadd575b456b5dc29724e5b68cd69db3/jspwiki-war/src/main/java/org/apache/wiki/Release.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/85297fc9cadd575b456b5dc29724e5b68cd69db3/jspwiki-war/src/main/java/org/apache/wiki/Release.java",
                "status": "modified",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-war/src/main/java/org/apache/wiki/Release.java?ref=85297fc9cadd575b456b5dc29724e5b68cd69db3",
                "patch": "@@ -72,8 +72,8 @@ Licensed to the Apache Software Foundation (ASF) under one\n      *  <p>\n      *  If the build identifier is empty, it is not added.\n      */\n-    public static final String     BUILD         = \"5\";\n-    \n+    public static final String     BUILD         = \"6\";\n+\n     /**\n      *  This is the generic version string you should use when printing out the version.  It is of \n      *  the form \"VERSION.REVISION.MINORREVISION[-POSTFIX][-BUILD]\".",
                "deletions": 2
            },
            {
                "sha": "c6b3174156c5aab174a27fa5ffe8a5c9d04df8f3",
                "filename": "jspwiki-war/src/main/java/org/apache/wiki/forms/FormInput.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/85297fc9cadd575b456b5dc29724e5b68cd69db3/jspwiki-war/src/main/java/org/apache/wiki/forms/FormInput.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/85297fc9cadd575b456b5dc29724e5b68cd69db3/jspwiki-war/src/main/java/org/apache/wiki/forms/FormInput.java",
                "status": "modified",
                "changes": 6,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-war/src/main/java/org/apache/wiki/forms/FormInput.java?ref=85297fc9cadd575b456b5dc29724e5b68cd69db3",
                "patch": "@@ -43,6 +43,8 @@ Licensed to the Apache Software Foundation (ASF) under one\n     /** Parameter name for setting the size of the input field.  Value is <tt>{@value}</tt>. */\n     public static final String PARAM_SIZE  = \"size\";\n \n+    public static final String PARAM_CHECKED  = \"checked\";\n+\n     /**\n      * Generates a dynamic form element on the WikiPage.\n      * \n@@ -55,6 +57,7 @@ public String execute( WikiContext ctx, Map< String, String > params )\n         String inputValue = params.get( PARAM_VALUE );\n         String inputType  = params.get( PARAM_TYPE );\n         String size       = params.get( PARAM_SIZE );\n+        String checked    = params.get( PARAM_CHECKED );\n         ResourceBundle rb = Preferences.getBundle( ctx, WikiPlugin.CORE_PLUGINS_RESOURCEBUNDLE );\n \n         if ( inputName == null ) {\n@@ -88,9 +91,8 @@ public String execute( WikiContext ctx, Map< String, String > params )\n         \n         Element field = XhtmlUtil.input(inputType,HANDLERPARAM_PREFIX + inputName,inputValue);\n         \n-        String checked = params.get(\"checked\");\n         field.setAttribute(XHTML.ATTR_class,\n-                String.valueOf(TextUtil.isPositive(checked) || checked.equalsIgnoreCase(\"checked\")));\n+                String.valueOf(TextUtil.isPositive(checked) || \"checked\".equalsIgnoreCase(checked)));\n         \n         String oldValue = previousValues.get( inputName );\n         if ( oldValue != null )",
                "deletions": 2
            }
        ],
        "patched_files": [
            "Release.java"
        ],
        "unit_tests": [
            "ReleaseTest.java"
        ]
    },
    "jspwiki_f682550": {
        "repo": "jspwiki",
        "message": "p can't be null here, as an NPE would've raised on the call to m_engine.getReferenceManager().updateReferences( p );",
        "commit": "https://github.com/apache/jspwiki/commit/f6825505d7ca47df6c788d9dc1d880d2a5a1ac4f",
        "parent": "https://github.com/apache/jspwiki/commit/1a01c8153fd48630d5ca8c190524fde8a6464bad",
        "bug_id": "jspwiki_f682550",
        "file": [
            {
                "sha": "c1d9c160275294261b54eb65bde91d84928e81c4",
                "filename": "jspwiki-main/src/main/java/org/apache/wiki/pages/DefaultPageManager.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/f6825505d7ca47df6c788d9dc1d880d2a5a1ac4f/jspwiki-main/src/main/java/org/apache/wiki/pages/DefaultPageManager.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/f6825505d7ca47df6c788d9dc1d880d2a5a1ac4f/jspwiki-main/src/main/java/org/apache/wiki/pages/DefaultPageManager.java",
                "status": "modified",
                "changes": 40,
                "additions": 15,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/main/java/org/apache/wiki/pages/DefaultPageManager.java?ref=f6825505d7ca47df6c788d9dc1d880d2a5a1ac4f",
                "patch": "@@ -95,11 +95,11 @@ Licensed to the Apache Software Foundation (ASF) under one\n      * @throws NoSuchElementException {@value #PROP_PAGEPROVIDER} property not found on WikiEngine properties\n      * @throws WikiException If anything goes wrong, you get this.\n      */\n-    public DefaultPageManager(WikiEngine engine, Properties props) throws NoSuchElementException, WikiException {\n+    public DefaultPageManager(final WikiEngine engine, final Properties props) throws NoSuchElementException, WikiException {\n         super(engine);\n-        String classname;\n+        final String classname;\n         m_engine = engine;\n-        boolean useCache = \"true\".equals(props.getProperty(PROP_USECACHE));\n+        final boolean useCache = \"true\".equals(props.getProperty(PROP_USECACHE));\n \n         m_expiryTime = TextUtil.parseIntParameter(props.getProperty(PROP_LOCKEXPIRY), 60);\n \n@@ -116,24 +116,24 @@ public DefaultPageManager(WikiEngine engine, Properties props) throws NoSuchElem\n \n         try {\n             LOG.debug(\"Page provider class: '\" + classname + \"'\");\n-            Class<?> providerclass = ClassUtil.findClass(\"org.apache.wiki.providers\", classname);\n+            final Class<?> providerclass = ClassUtil.findClass(\"org.apache.wiki.providers\", classname);\n             m_provider = (WikiPageProvider) providerclass.newInstance();\n \n             LOG.debug(\"Initializing page provider class \" + m_provider);\n             m_provider.initialize(m_engine, props);\n-        } catch (ClassNotFoundException e) {\n+        } catch (final ClassNotFoundException e) {\n             LOG.error(\"Unable to locate provider class '\" + classname + \"' (\" + e.getMessage() + \")\", e);\n             throw new WikiException(\"No provider class. (\" + e.getMessage() + \")\", e);\n-        } catch (InstantiationException e) {\n+        } catch (final InstantiationException e) {\n             LOG.error(\"Unable to create provider class '\" + classname + \"' (\" + e.getMessage() + \")\", e);\n             throw new WikiException(\"Faulty provider class. (\" + e.getMessage() + \")\", e);\n-        } catch (IllegalAccessException e) {\n+        } catch (final IllegalAccessException e) {\n             LOG.error(\"Illegal access to provider class '\" + classname + \"' (\" + e.getMessage() + \")\", e);\n             throw new WikiException(\"Illegal provider class. (\" + e.getMessage() + \")\", e);\n-        } catch (NoRequiredPropertyException e) {\n+        } catch (final NoRequiredPropertyException e) {\n             LOG.error(\"Provider did not found a property it was looking for: \" + e.getMessage(), e);\n             throw e;  // Same exception works.\n-        } catch (IOException e) {\n+        } catch (final IOException e) {\n             LOG.error(\"An I/O exception occurred while trying to create a new page provider: \" + classname, e);\n             throw new WikiException(\"Unable to start page provider: \" + e.getMessage(), e);\n         }\n@@ -164,30 +164,20 @@ public String getPageText( final String pageName, final int version) throws Prov\n         if (pageName == null || pageName.length() == 0) {\n             throw new ProviderException(\"Illegal page name\");\n         }\n-        String text = null;\n+        String text;\n \n         try {\n             text = m_provider.getPageText(pageName, version);\n-        } catch (final RepositoryModifiedException e) {\n+        } catch ( final RepositoryModifiedException e ) {\n             //  This only occurs with the latest version.\n-            LOG.info(\"Repository has been modified externally while fetching page \" + pageName);\n+            LOG.info( \"Repository has been modified externally while fetching page \" + pageName );\n \n             //  Empty the references and yay, it shall be recalculated\n-            final WikiPage p = m_provider.getPageInfo(pageName, version);\n+            final WikiPage p = m_provider.getPageInfo( pageName, version );\n \n             m_engine.getReferenceManager().updateReferences( p );\n-\n-            if (p != null) {\n-                m_engine.getSearchManager().reindexPage(p);\n-                text = m_provider.getPageText(pageName, version);\n-            } else {\n-                //\n-                //  Make sure that it no longer exists in internal data structures either.\n-                //\n-                final WikiPage dummy = new WikiPage(m_engine, pageName);\n-                m_engine.getSearchManager().pageRemoved(dummy);\n-                m_engine.getReferenceManager().pageRemoved(dummy);\n-            }\n+            m_engine.getSearchManager().reindexPage( p );\n+            text = m_provider.getPageText( pageName, version );\n         }\n \n         return text;",
                "deletions": 25
            }
        ],
        "patched_files": [
            "DefaultPageManager.java"
        ],
        "unit_tests": [
            "DefaultPageManagerTest.java"
        ]
    },
    "jspwiki_1ec1151": {
        "repo": "jspwiki",
        "message": "JSPWIKI-120: move deletePage(..) and deleteVersion(..) methods from WikiEngine to PageManager\n\nalso removed deletePage from TestEngine - was there to try to debug some nasty NPEs on tests but didn't end up being useful (NPEs probably due to objects being garbage collected on some ci nodes)",
        "commit": "https://github.com/apache/jspwiki/commit/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
        "parent": "https://github.com/apache/jspwiki/commit/9e05cc521a812ed781ac835307e45f34923119c4",
        "bug_id": "jspwiki_1ec1151",
        "file": [
            {
                "sha": "19a2eaa910fc444e4bddeb973d0ce916b455c069",
                "filename": "jspwiki-main/src/main/java/org/apache/wiki/WikiEngine.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/main/java/org/apache/wiki/WikiEngine.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/main/java/org/apache/wiki/WikiEngine.java",
                "status": "modified",
                "changes": 46,
                "additions": 0,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/main/java/org/apache/wiki/WikiEngine.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -1834,52 +1834,6 @@ public WikiContext createContext( final HttpServletRequest request, final String\n         return new WikiContext( this, request, command );\n     }\n \n-    /**\n-     *  Deletes a page or an attachment completely, including all versions.  If the page\n-     *  does not exist, does nothing.\n-     *\n-     * @param pageName The name of the page.\n-     * @throws ProviderException If something goes wrong.\n-     */\n-    public void deletePage( final String pageName ) throws ProviderException {\n-        final WikiPage p = getPage( pageName );\n-        if( p != null ) {\n-            if( p instanceof Attachment ) {\n-                m_attachmentManager.deleteAttachment( ( Attachment )p );\n-            } else {\n-                final Collection< String > refTo = m_referenceManager.findRefersTo( pageName );\n-                // May return null, if the page does not exist or has not been indexed yet.\n-\n-                if( m_attachmentManager.hasAttachments( p ) ) {\n-                    final List< Attachment > attachments = m_attachmentManager.listAttachments( p );\n-                    for( final Attachment attachment : attachments ) {\n-                        if( refTo != null ) {\n-                            refTo.remove( attachment.getName() );\n-                        }\n-\n-                        m_attachmentManager.deleteAttachment( attachment );\n-                    }\n-                }\n-                m_pageManager.deletePage( p );\n-                firePageEvent( WikiPageEvent.PAGE_DELETED, pageName );\n-            }\n-        }\n-    }\n-\n-    /**\n-     *  Deletes a specific version of a page or an attachment.\n-     *\n-     *  @param page The page object.\n-     *  @throws ProviderException If something goes wrong.\n-     */\n-    public void deleteVersion( final WikiPage page ) throws ProviderException {\n-        if( page instanceof Attachment ) {\n-            m_attachmentManager.deleteVersion( (Attachment) page );\n-        } else {\n-            m_pageManager.deleteVersion( page );\n-        }\n-    }\n-\n     /**\n      *  Returns the URL of the global RSS file.  May be null, if the\n      *  RSS file generation is not operational.",
                "deletions": 46
            },
            {
                "sha": "e4f97b9a434da606000b890c3172d0b0a44b90dc",
                "filename": "jspwiki-main/src/main/java/org/apache/wiki/pages/DefaultPageManager.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/main/java/org/apache/wiki/pages/DefaultPageManager.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/main/java/org/apache/wiki/pages/DefaultPageManager.java",
                "status": "modified",
                "changes": 47,
                "additions": 41,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/main/java/org/apache/wiki/pages/DefaultPageManager.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -27,6 +27,7 @@ Licensed to the Apache Software Foundation (ASF) under one\n import org.apache.wiki.api.exceptions.NoRequiredPropertyException;\n import org.apache.wiki.api.exceptions.ProviderException;\n import org.apache.wiki.api.exceptions.WikiException;\n+import org.apache.wiki.attachment.Attachment;\n import org.apache.wiki.auth.WikiPrincipal;\n import org.apache.wiki.auth.WikiSecurityException;\n import org.apache.wiki.auth.acl.Acl;\n@@ -363,18 +364,52 @@ public boolean pageExists(String pageName, int version) throws ProviderException\n         return m_provider.pageExists(pageName, version);\n     }\n \n-    /* (non-Javadoc)\n+    /**\n+     * {@inheritDoc}\n      * @see org.apache.wiki.pages.PageManager#deleteVersion(org.apache.wiki.WikiPage)\n      */\n     @Override\n-    public void deleteVersion(WikiPage page) throws ProviderException {\n-        m_provider.deleteVersion(page.getName(), page.getVersion());\n+    public void deleteVersion( final WikiPage page ) throws ProviderException {\n+        if( page instanceof Attachment ) {\n+            m_engine.getAttachmentManager().deleteVersion( (Attachment) page );\n+        } else {\n+            m_provider.deleteVersion(page.getName(), page.getVersion());\n+            // FIXME: If this was the latest, reindex Lucene\n+            // FIXME: Update RefMgr\n+        }\n+    }\n \n-        // FIXME: If this was the latest, reindex Lucene\n-        // FIXME: Update RefMgr\n+    /**\n+     * {@inheritDoc}\n+     * @see org.apache.wiki.pages.PageManager#deletePage(java.lang.String)\n+     */\n+    public void deletePage( final String pageName ) throws ProviderException {\n+        final WikiPage p = m_engine.getPage( pageName );\n+        if( p != null ) {\n+            if( p instanceof Attachment ) {\n+                m_engine.getAttachmentManager().deleteAttachment( ( Attachment )p );\n+            } else {\n+                final Collection< String > refTo = m_engine.getReferenceManager().findRefersTo( pageName );\n+                // May return null, if the page does not exist or has not been indexed yet.\n+\n+                if( m_engine.getAttachmentManager().hasAttachments( p ) ) {\n+                    final List< Attachment > attachments = m_engine.getAttachmentManager().listAttachments( p );\n+                    for( final Attachment attachment : attachments ) {\n+                        if( refTo != null ) {\n+                            refTo.remove( attachment.getName() );\n+                        }\n+\n+                        m_engine.getAttachmentManager().deleteAttachment( attachment );\n+                    }\n+                }\n+                deletePage( p );\n+                fireEvent( WikiPageEvent.PAGE_DELETED, pageName );\n+            }\n+        }\n     }\n \n-    /* (non-Javadoc)\n+    /**\n+     * {@inheritDoc}\n      * @see org.apache.wiki.pages.PageManager#deletePage(org.apache.wiki.WikiPage)\n      */\n     @Override",
                "deletions": 6
            },
            {
                "sha": "7337c8d30aac6d375a596449b79fc33fe20e6e29",
                "filename": "jspwiki-main/src/main/java/org/apache/wiki/pages/PageManager.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/main/java/org/apache/wiki/pages/PageManager.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/main/java/org/apache/wiki/pages/PageManager.java",
                "status": "modified",
                "changes": 28,
                "additions": 16,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/main/java/org/apache/wiki/pages/PageManager.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -18,16 +18,16 @@ Licensed to the Apache Software Foundation (ASF) under one\n  */\n package org.apache.wiki.pages;\n \n-import java.util.Collection;\n-import java.util.List;\n-\n import org.apache.wiki.WikiEngine;\n import org.apache.wiki.WikiPage;\n import org.apache.wiki.api.exceptions.ProviderException;\n import org.apache.wiki.event.WikiEvent;\n import org.apache.wiki.event.WikiEventListener;\n import org.apache.wiki.providers.WikiPageProvider;\n \n+import java.util.Collection;\n+import java.util.List;\n+\n \n public interface PageManager extends WikiEventListener {\n \n@@ -47,7 +47,7 @@ Licensed to the Apache Software Foundation (ASF) under one\n \n     /**\n      * Returns all pages in some random order.  If you need just the page names,\n-     * please see {@link org.apache.wiki.ReferenceManager#findCreated() ReferenceManager#findCreated()}, which is probably a lot\n+     * please see {@link org.apache.wiki.references.ReferenceManager#findCreated() ReferenceManager#findCreated()}, which is probably a lot\n      * faster.  This method may cause repository access.\n      *\n      * @return A Collection of WikiPage objects.\n@@ -85,8 +85,7 @@ Licensed to the Apache Software Foundation (ASF) under one\n     void putPageText(WikiPage page, String content) throws ProviderException;\n \n     /**\n-     * Locks page for editing.  Note, however, that the PageManager\n-     * will in no way prevent you from actually editing this page;\n+     * Locks page for editing.  Note, however, that the PageManager will in no way prevent you from actually editing this page;\n      * the lock is just for information.\n      *\n      * @param page WikiPage to lock\n@@ -103,8 +102,7 @@ Licensed to the Apache Software Foundation (ASF) under one\n     void unlockPage(PageLock lock);\n \n     /**\n-     * Returns the current lock owner of a page.  If the page is not\n-     * locked, will return null.\n+     * Returns the current lock owner of a page.  If the page is not locked, will return null.\n      *\n      * @param page The page to check the lock for\n      * @return Current lock, or null, if there is no lock\n@@ -115,8 +113,7 @@ Licensed to the Apache Software Foundation (ASF) under one\n      * Returns a list of currently applicable locks.  Note that by the time you get the list,\n      * the locks may have already expired, so use this only for informational purposes.\n      *\n-     * @return List of PageLock objects, detailing the locks.  If no locks exist, returns\n-     *         an empty list.\n+     * @return List of PageLock objects, detailing the locks.  If no locks exist, returns an empty list.\n      * @since 2.0.22.\n      */\n     List<PageLock> getActiveLocks();\n@@ -127,8 +124,7 @@ Licensed to the Apache Software Foundation (ASF) under one\n      * @param pageName The name of the page\n      * @param version  A version number\n      * @return A WikiPage object, or null, if the page does not exist\n-     * @throws ProviderException If there is something wrong with the page\n-     *                           name or the repository\n+     * @throws ProviderException If there is something wrong with the page name or the repository\n      */\n     WikiPage getPageInfo(String pageName, int version) throws ProviderException;\n \n@@ -186,6 +182,14 @@ Licensed to the Apache Software Foundation (ASF) under one\n      */\n     void deleteVersion(WikiPage page) throws ProviderException;\n \n+    /**\n+     *  Deletes a page or an attachment completely, including all versions.  If the page does not exist, does nothing.\n+     *\n+     * @param pageName The name of the page.\n+     * @throws ProviderException If something goes wrong.\n+     */\n+    void deletePage( final String pageName ) throws ProviderException;\n+\n     /**\n      * Deletes an entire page, all versions, all traces.\n      *",
                "deletions": 12
            },
            {
                "sha": "6115fea157e04de6d8a4c59bdd76bda5dc3cfe74",
                "filename": "jspwiki-main/src/test/java/org/apache/wiki/TestEngine.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/TestEngine.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/TestEngine.java",
                "status": "modified",
                "changes": 9,
                "additions": 0,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/test/java/org/apache/wiki/TestEngine.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -282,15 +282,6 @@ protected static String mangleName( String pagename ) {\n         return pagename;\n     }\n \n-    public void deletePage( final String pageName ) throws ProviderException {\n-        try {\n-            super.deletePage( pageName );\n-        } catch( final ProviderException | RuntimeException e ) {\n-            log.error( e.getMessage(), e );\n-            throw e;\n-        }\n-    }\n-\n     /**\n      *  Removes a page, but not any auxiliary information.  Works only\n      *  with FileSystemProvider.",
                "deletions": 9
            },
            {
                "sha": "4cf193084865093a1d5de52599c8ad28b730f176",
                "filename": "jspwiki-main/src/test/java/org/apache/wiki/WikiEngineTest.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/WikiEngineTest.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/WikiEngineTest.java",
                "status": "modified",
                "changes": 14,
                "additions": 7,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/test/java/org/apache/wiki/WikiEngineTest.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -568,7 +568,7 @@ public void testDeletePage()\n \n         WikiPage page = m_engine.getPage( NAME1, WikiProvider.LATEST_VERSION );\n \n-        m_engine.deletePage( page.getName() );\n+        m_engine.getPageManager().deletePage( page.getName() );\n \n         Assertions.assertFalse( saved.exists(), \"Page has not been removed!\" );\n     }\n@@ -596,7 +596,7 @@ public void testDeletePageAndAttachments()\n \n         WikiPage page = m_engine.getPage( NAME1, WikiProvider.LATEST_VERSION );\n \n-        m_engine.deletePage( page.getName() );\n+        m_engine.getPageManager().deletePage( page.getName() );\n \n         Assertions.assertFalse( saved.exists(), \"Page has not been removed!\" );\n         Assertions.assertFalse( attfile.exists(), \"Attachment has not been removed\" );\n@@ -628,9 +628,9 @@ public void testDeletePageAndAttachments2()\n \n         att = m_engine.getAttachmentManager().getAttachmentInfo(NAME1+\"/TestAtt.txt\");\n \n-        m_engine.deletePage(att.getName());\n+        m_engine.getPageManager().deletePage(att.getName());\n \n-        m_engine.deletePage( NAME1 );\n+        m_engine.getPageManager().deletePage( NAME1 );\n \n         Assertions.assertNull( m_engine.getPage(NAME1), \"Page not removed\" );\n         Assertions.assertNull( m_engine.getPage(NAME1+\"/TestAtt.txt\"), \"Att not removed\" );\n@@ -653,7 +653,7 @@ public void testDeleteVersion()\n \n         WikiPage page = engine.getPage( NAME1, 3 );\n \n-        engine.deleteVersion( page );\n+        engine.getPageManager().deleteVersion( page );\n \n         Assertions.assertNull( engine.getPage( NAME1, 3 ), \"got page\" );\n \n@@ -675,7 +675,7 @@ public void testDeleteVersion2()\n \n         WikiPage page = engine.getPage( NAME1, 1 );\n \n-        engine.deleteVersion( page );\n+        engine.getPageManager().deleteVersion( page );\n \n         Assertions.assertNull( engine.getPage( NAME1, 1 ), \"got page\" );\n \n@@ -714,7 +714,7 @@ public void testOldVersionVars()\n         // FIXME: The following must run as well\n         Assertions.assertEquals( \"notbar\", v2.getAttribute(\"foo\"), \"V2\" );\n \n-        engine.deletePage( NAME1 );\n+        engine.getPageManager().deletePage( NAME1 );\n     }\n \n     @Test",
                "deletions": 7
            },
            {
                "sha": "8128b4758ae2e83d6542bb024323db0211e26516",
                "filename": "jspwiki-main/src/test/java/org/apache/wiki/attachment/AttachmentManagerTest.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/attachment/AttachmentManagerTest.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/attachment/AttachmentManagerTest.java",
                "status": "modified",
                "changes": 21,
                "additions": 10,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/test/java/org/apache/wiki/attachment/AttachmentManagerTest.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -12,15 +12,7 @@\n  * limitations under the License.\n  */\n package org.apache.wiki.attachment;\n-import java.io.File;\n-import java.io.FileWriter;\n-import java.io.InputStream;\n-import java.io.InputStreamReader;\n-import java.io.StringReader;\n-import java.io.StringWriter;\n-import java.util.List;\n-import java.util.Properties;\n-\n+import net.sf.ehcache.CacheManager;\n import org.apache.wiki.TestEngine;\n import org.apache.wiki.WikiContext;\n import org.apache.wiki.WikiPage;\n@@ -31,7 +23,14 @@\n import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n \n-import net.sf.ehcache.CacheManager;\n+import java.io.File;\n+import java.io.FileWriter;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.StringReader;\n+import java.io.StringWriter;\n+import java.util.List;\n+import java.util.Properties;\n \n public class AttachmentManagerTest\n {\n@@ -361,7 +360,7 @@ public void testNonexistentPage() throws Exception\n         }\n         finally\n         {\n-            m_engine.deletePage(\"TestPage\");\n+            m_engine.getPageManager().deletePage(\"TestPage\");\n         }\n     }\n ",
                "deletions": 11
            },
            {
                "sha": "674c821fb057c3ea4f172c0ab5baf49e5543fd49",
                "filename": "jspwiki-main/src/test/java/org/apache/wiki/auth/AuthorizationManagerTest.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/auth/AuthorizationManagerTest.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/auth/AuthorizationManagerTest.java",
                "status": "modified",
                "changes": 10,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/test/java/org/apache/wiki/auth/AuthorizationManagerTest.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -114,7 +114,7 @@ public void testDefaultPermissions() throws Exception\n         // Delete the test page\n         try\n         {\n-            m_engine.deletePage( \"TestDefaultPage\" );\n+            m_engine.getPageManager().deletePage( \"TestDefaultPage\" );\n         }\n         catch( ProviderException e )\n         {\n@@ -294,7 +294,7 @@ public void testInheritedPermissions() throws Exception\n \n         // Delete test page & attachment\n         m_engine.getAttachmentManager().deleteAttachment( att );\n-        m_engine.deletePage( \"Test\" );\n+        m_engine.getPageManager().deletePage( \"Test\" );\n     }\n \n     @Test\n@@ -326,7 +326,7 @@ public void testInheritedAclPermissions() throws Exception\n \n         // Delete test page & attachment\n         m_engine.getAttachmentManager().deleteAttachment( att );\n-        m_engine.deletePage( \"Test\" );\n+        m_engine.getPageManager().deletePage( \"Test\" );\n     }\n \n     @Test\n@@ -468,7 +468,7 @@ public void testPrincipalAcl() throws Exception\n         // Cleanup\n         try\n         {\n-            m_engine.deletePage( \"Test\" );\n+            m_engine.getPageManager().deletePage( \"Test\" );\n         }\n         catch( ProviderException e )\n         {\n@@ -590,7 +590,7 @@ public void testRoleAcl() throws Exception\n         // Cleanup\n         try\n         {\n-            m_engine.deletePage( \"Test\" );\n+            m_engine.getPageManager().deletePage( \"Test\" );\n         }\n         catch( ProviderException e )\n         {",
                "deletions": 5
            },
            {
                "sha": "e9d770d63f640def1ba0bc21eda52c196956ab26",
                "filename": "jspwiki-main/src/test/java/org/apache/wiki/auth/UserManagerTest.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/auth/UserManagerTest.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/auth/UserManagerTest.java",
                "status": "modified",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/test/java/org/apache/wiki/auth/UserManagerTest.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -194,7 +194,7 @@ public void testSetRenamedUserProfile() throws Exception {\n         Assertions.assertEquals( expectedText, actualText );\n \n         // Remove our test page\n-        m_engine.deletePage( pageName );\n+        m_engine.getPageManager().deletePage( pageName );\n \n         // Setup Step 6: re-create the group with our old test user names in it\n         group = groupManager.parseGroup( m_groupName, \"Alice \\n Bob \\n Charlie \\n \" + oldLogin + \"\\n\" + oldName, true );\n@@ -259,7 +259,7 @@ public void testSetRenamedUserProfile() throws Exception {\n         groupManager.removeGroup( group.getName() );\n         Assertions.assertEquals( oldGroupCount, groupManager.getRoles().length );\n \n-        m_engine.deletePage( pageName );\n+        m_engine.getPageManager().deletePage( pageName );\n         Assertions.assertEquals( oldPageCount, pageManager.getTotalPageCount() );\n     }\n ",
                "deletions": 2
            },
            {
                "sha": "3326cfc6f70df467cf709cc601d226dc3bbbc1e5",
                "filename": "jspwiki-main/src/test/java/org/apache/wiki/auth/acl/DefaultAclManagerTest.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/auth/acl/DefaultAclManagerTest.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/auth/acl/DefaultAclManagerTest.java",
                "status": "modified",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/test/java/org/apache/wiki/auth/acl/DefaultAclManagerTest.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -55,8 +55,8 @@ public void tearDown()\n     {\n         try\n         {\n-            m_engine.deletePage( \"TestDefaultPage\" );\n-            m_engine.deletePage( \"TestAclPage\" );\n+            m_engine.getPageManager().deletePage( \"TestDefaultPage\" );\n+            m_engine.getPageManager().deletePage( \"TestAclPage\" );\n         }\n         catch ( ProviderException e )\n         {",
                "deletions": 2
            },
            {
                "sha": "9a0a14eaee82722b86acd3d235b39df598133d90",
                "filename": "jspwiki-main/src/test/java/org/apache/wiki/plugin/DefaultPluginManagerTest.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/plugin/DefaultPluginManagerTest.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/plugin/DefaultPluginManagerTest.java",
                "status": "modified",
                "changes": 21,
                "additions": 7,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/test/java/org/apache/wiki/plugin/DefaultPluginManagerTest.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -18,7 +18,6 @@ Licensed to the Apache Software Foundation (ASF) under one\n  */\n \n package org.apache.wiki.plugin;\n-import java.util.Properties;\n \n import org.apache.wiki.TestEngine;\n import org.apache.wiki.WikiContext;\n@@ -30,31 +29,25 @@ Licensed to the Apache Software Foundation (ASF) under one\n import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n \n-public class DefaultPluginManagerTest\n-{\n-    public static final String NAME1 = \"Test1\";\n+import java.util.Properties;\n+\n+public class DefaultPluginManagerTest {\n \n     Properties props = TestEngine.getTestProperties();\n-\n-    WikiEngine engine;\n+    WikiEngine engine = TestEngine.build();\n+    DefaultPluginManager manager = new DefaultPluginManager( engine, props );\n \n     WikiContext context;\n \n-    DefaultPluginManager manager;\n-\n     @BeforeEach\n-    public void setUp()\n-        throws Exception\n-    {\n-        engine = new TestEngine(props);\n+    public void setUp() throws Exception {\n         context = new WikiContext( engine, new WikiPage(engine, \"Testpage\") );\n-        manager = new DefaultPluginManager( engine, props );\n     }\n \n     @AfterEach\n     public void tearDown() throws ProviderException\n     {\n-        engine.deletePage(\"Testpage\");\n+        engine.getPageManager().deletePage(\"Testpage\");\n     }\n \n     @Test",
                "deletions": 14
            },
            {
                "sha": "529af2c5a300f2c888017ef8c32870b61f8e5798",
                "filename": "jspwiki-main/src/test/java/org/apache/wiki/plugin/GroupsTest.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/plugin/GroupsTest.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/plugin/GroupsTest.java",
                "status": "modified",
                "changes": 21,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/test/java/org/apache/wiki/plugin/GroupsTest.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -19,31 +19,18 @@ Licensed to the Apache Software Foundation (ASF) under one\n \n package org.apache.wiki.plugin;\n \n-import java.util.Properties;\n-\n import org.apache.wiki.TestEngine;\n import org.junit.jupiter.api.AfterEach;\n import org.junit.jupiter.api.Assertions;\n-import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n \n \n-public class GroupsTest\n-{\n-    Properties props = TestEngine.getTestProperties();\n-    TestEngine testEngine;\n-\n-    @BeforeEach\n-    public void setUp()\n-        throws Exception\n-    {\n-        testEngine = new TestEngine(props);\n-    }\n+public class GroupsTest {\n+    TestEngine testEngine = TestEngine.build();\n \n     @AfterEach\n-    public void tearDown() throws Exception\n-    {\n-        testEngine.deletePage( \"Test\" );\n+    public void tearDown() throws Exception {\n+        testEngine.getPageManager().deletePage( \"Test\" );\n     }\n \n     @Test",
                "deletions": 17
            },
            {
                "sha": "4ac3c1967e48e5ed267f469b8e1028fba6212d97",
                "filename": "jspwiki-main/src/test/java/org/apache/wiki/plugin/IfPluginTest.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/plugin/IfPluginTest.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/plugin/IfPluginTest.java",
                "status": "modified",
                "changes": 23,
                "additions": 5,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/test/java/org/apache/wiki/plugin/IfPluginTest.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -17,8 +17,7 @@ Licensed to the Apache Software Foundation (ASF) under one\n     under the License.\n  */\n package org.apache.wiki.plugin;\n-import java.util.Properties;\n-\n+import net.sourceforge.stripes.mock.MockHttpServletRequest;\n import org.apache.wiki.TestEngine;\n import org.apache.wiki.WikiContext;\n import org.apache.wiki.WikiPage;\n@@ -28,27 +27,15 @@ Licensed to the Apache Software Foundation (ASF) under one\n import org.apache.wiki.providers.WikiPageProvider;\n import org.junit.jupiter.api.AfterEach;\n import org.junit.jupiter.api.Assertions;\n-import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n \n-import net.sourceforge.stripes.mock.MockHttpServletRequest;\n-\n-public class IfPluginTest\n-{\n+public class IfPluginTest {\n \n-    TestEngine testEngine;\n-\n-    @BeforeEach\n-    public void setUp() throws Exception\n-    {\n-        Properties props = TestEngine.getTestProperties();\n-        testEngine = new TestEngine( props );\n-    }\n+    TestEngine testEngine = TestEngine.build();\n \n     @AfterEach\n-    public void tearDown() throws Exception\n-    {\n-        testEngine.deletePage( \"Test\" );\n+    public void tearDown() throws Exception {\n+        testEngine.getPageManager().deletePage( \"Test\" );\n     }\n \n     /**",
                "deletions": 18
            },
            {
                "sha": "47a0784fe103bd9842f6c4acc6ac99440c30046f",
                "filename": "jspwiki-main/src/test/java/org/apache/wiki/plugin/TableOfContentsTest.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/plugin/TableOfContentsTest.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/plugin/TableOfContentsTest.java",
                "status": "modified",
                "changes": 17,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/test/java/org/apache/wiki/plugin/TableOfContentsTest.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -26,30 +26,19 @@ Licensed to the Apache Software Foundation (ASF) under one\n import org.apache.wiki.api.exceptions.WikiException;\n import org.junit.jupiter.api.AfterEach;\n import org.junit.jupiter.api.Assertions;\n-import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n \n-import java.util.Properties;\n-\n /**\n  *\n  *  @since\n  */\n public class TableOfContentsTest\n {\n-    TestEngine testEngine;\n-\n-    @BeforeEach\n-    public void setUp() throws Exception\n-    {\n-        Properties props = TestEngine.getTestProperties();\n-        testEngine = new TestEngine( props );\n-    }\n+    TestEngine testEngine = TestEngine.build();\n \n     @AfterEach\n-    public void tearDown() throws Exception\n-    {\n-        testEngine.deletePage( \"Test\" );\n+    public void tearDown() throws Exception {\n+        testEngine.getPageManager().deletePage( \"Test\" );\n     }\n \n     @Test",
                "deletions": 14
            },
            {
                "sha": "3ae3b30a6d51cab2df788d95a00d2aa5f6921807",
                "filename": "jspwiki-main/src/test/java/org/apache/wiki/plugin/WeblogPluginTest.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/plugin/WeblogPluginTest.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/plugin/WeblogPluginTest.java",
                "status": "modified",
                "changes": 13,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/test/java/org/apache/wiki/plugin/WeblogPluginTest.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -4,25 +4,16 @@\n import org.apache.wiki.api.exceptions.WikiException;\n import org.junit.jupiter.api.AfterEach;\n import org.junit.jupiter.api.Assertions;\n-import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n \n-import java.util.Properties;\n-\n \n public class WeblogPluginTest {\n \n-    TestEngine testEngine;\n-\n-    @BeforeEach\n-    public void setUp() throws Exception {\n-        final Properties props = TestEngine.getTestProperties();\n-        testEngine = new TestEngine( props );\n-    }\n+    TestEngine testEngine = TestEngine.build();\n \n     @AfterEach\n     public void tearDown() throws Exception {\n-        testEngine.deletePage( \"Test\" );\n+        testEngine.getPageManager().deletePage( \"Test\" );\n     }\n \n     @Test",
                "deletions": 11
            },
            {
                "sha": "76122ded5a34742b342b6de30adc247d30b8abdf",
                "filename": "jspwiki-main/src/test/java/org/apache/wiki/references/ReferenceManagerTest.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/references/ReferenceManagerTest.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/references/ReferenceManagerTest.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/test/java/org/apache/wiki/references/ReferenceManagerTest.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -82,7 +82,7 @@ public void testRemove() throws Exception {\n         Assertions.assertNotNull( c, \"referrers expected\" );\n         Assertions.assertTrue( c.size() == 1 && c.contains(\"Foobar\") );\n \n-        engine.deletePage( \"Foobar\" );\n+        engine.getPageManager().deletePage( \"Foobar\" );\n         c = mgr.findReferrers(\"Foobar2\");\n         Assertions.assertNull( c );\n ",
                "deletions": 1
            },
            {
                "sha": "cf5aada8ad92a2707bc07bb2c860830403e94132",
                "filename": "jspwiki-main/src/test/java/org/apache/wiki/render/RenderingManagerTest.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/render/RenderingManagerTest.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/render/RenderingManagerTest.java",
                "status": "modified",
                "changes": 19,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/test/java/org/apache/wiki/render/RenderingManagerTest.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -27,28 +27,17 @@ Licensed to the Apache Software Foundation (ASF) under one\n import org.apache.wiki.parser.WikiDocument;\n import org.junit.jupiter.api.AfterEach;\n import org.junit.jupiter.api.Assertions;\n-import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n \n-import java.util.Properties;\n-\n public class RenderingManagerTest {\n \n-    RenderingManager m_manager;\n-    TestEngine       m_engine;\n-\n-    @BeforeEach\n-    public void setUp() throws Exception {\n-        CacheManager.getInstance().removeAllCaches();\n-        Properties props = TestEngine.getTestProperties();\n-        m_engine = new TestEngine( props );\n-\n-        m_manager = m_engine.getRenderingManager();\n-    }\n+    TestEngine       m_engine = TestEngine.build();\n+    RenderingManager m_manager = m_engine.getRenderingManager();\n \n     @AfterEach\n     public void tearDown() throws Exception {\n-        m_engine.deletePage( \"TestPage\" );\n+        m_engine.getPageManager().deletePage( \"TestPage\" );\n+        CacheManager.getInstance().removeAllCaches();\n     }\n \n     /**",
                "deletions": 15
            },
            {
                "sha": "a557d5cbbd0d819ff6045f92d11da26a19a80de8",
                "filename": "jspwiki-main/src/test/java/org/apache/wiki/ui/CommandResolverTest.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/ui/CommandResolverTest.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/ui/CommandResolverTest.java",
                "status": "modified",
                "changes": 4,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/test/java/org/apache/wiki/ui/CommandResolverTest.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -52,8 +52,8 @@ public void setUp() throws Exception {\n \n     @AfterEach\n     public void tearDown() throws Exception {\n-        m_engine.deletePage( \"SinglePage\" );\n-        m_engine.deletePage( \"PluralPage\" );\n+        m_engine.getPageManager().deletePage( \"SinglePage\" );\n+        m_engine.getPageManager().deletePage( \"PluralPage\" );\n     }\n \n     @Test",
                "deletions": 2
            },
            {
                "sha": "5e03505c1c5fa1ccd6815e07e3d7ccecc188500d",
                "filename": "jspwiki-main/src/test/java/org/apache/wiki/workflow/ApprovalWorkflowTest.java",
                "blob_url": "https://github.com/apache/jspwiki/blob/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/workflow/ApprovalWorkflowTest.java",
                "raw_url": "https://github.com/apache/jspwiki/raw/1ec1151a07212fba3d6193c9c57e2bfe530eb2c3/jspwiki-main/src/test/java/org/apache/wiki/workflow/ApprovalWorkflowTest.java",
                "status": "modified",
                "changes": 17,
                "additions": 8,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-main/src/test/java/org/apache/wiki/workflow/ApprovalWorkflowTest.java?ref=1ec1151a07212fba3d6193c9c57e2bfe530eb2c3",
                "patch": "@@ -18,11 +18,6 @@ Licensed to the Apache Software Foundation (ASF) under one\n  */\n package org.apache.wiki.workflow;\n \n-import java.security.Principal;\n-import java.util.Collection;\n-import java.util.List;\n-import java.util.Properties;\n-\n import org.apache.wiki.TestEngine;\n import org.apache.wiki.WikiContext;\n import org.apache.wiki.api.engine.FilterManager;\n@@ -35,14 +30,18 @@ Licensed to the Apache Software Foundation (ASF) under one\n import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n \n-public class ApprovalWorkflowTest\n-{\n+import java.security.Principal;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Properties;\n+\n+public class ApprovalWorkflowTest {\n+\n     WorkflowBuilder m_builder;\n     TestEngine m_engine;\n     WorkflowManager m_wm;\n     DecisionQueue m_dq;\n \n-\n     @BeforeEach\n     public void setUp() throws Exception\n     {\n@@ -209,7 +208,7 @@ public void testSaveWikiPageWithApproval() throws WikiException\n         Assertions.assertEquals(0, decisions.size());\n \n         // Delete the page we created\n-        m_engine.deletePage( pageName );\n+        m_engine.getPageManager().deletePage( pageName );\n     }\n \n     @Test",
                "deletions": 9
            }
        ],
        "patched_files": [
            "WikiEngine.java",
            "DefaultPluginManager.java",
            "WeblogPlugin.java",
            "CommandResolver.java",
            "AttachmentManager.java",
            "DefaultAclManager.java",
            "ReferenceManager.java",
            "DefaultPageManager.java",
            "IfPlugin.java",
            "RenderingManager.java",
            "PageManager.java",
            "TableOfContents.java",
            "UserManager.java",
            "AuthorizationManager.java",
            "Groups.java"
        ],
        "unit_tests": [
            "TestEngine.java",
            "ReferenceManagerTest.java",
            "TableOfContentsTest.java",
            "GroupsTest.java",
            "AuthorizationManagerTest.java",
            "WeblogPluginTest.java",
            "ApprovalWorkflowTest.java",
            "DefaultPageManagerTest.java",
            "DefaultPluginManagerTest.java",
            "IfPluginTest.java",
            "DefaultAclManagerTest.java",
            "WikiEngineTest.java",
            "CommandResolverTest.java",
            "RenderingManagerTest.java",
            "AttachmentManagerTest.java",
            "UserManagerTest.java"
        ]
    }
}