[
    {
        "repo": "rocketmq",
        "commit": "https://github.com/apache/rocketmq/commit/6f322c46df9b14c2ac37512eb6e569398427bf0d",
        "bug_id": "rocketmq_6f322c4",
        "message": "[issue#789]fix NullPointerException in the PlainAccessValidator#parse() method when recieved some admin request command,if configed no aclRPCHook. (#819)\n\n* [issue#790]fix defaultTopicPerm and defaultGroupPerm values which are in the yaml config file doesn't work.\r\n\r\n* [issue#790]fix defaultTopicPerm and defaultGroupPerm doesn't work,fix the unit test.\r\n\r\n* [issue#789]fix NullPointerException in the PlainAccessValidator#parse() method when recieved some admin request command,if configed no aclRPCHook.",
        "parent": "https://github.com/apache/rocketmq/commit/13b5dd11603c4c01f793720ac608dcca3b57a3e8",
        "patched_files": [
            "PlainAccessValidator.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 5,
                "raw_url": "https://github.com/apache/rocketmq/raw/6f322c46df9b14c2ac37512eb6e569398427bf0d/acl/src/main/java/org/apache/rocketmq/acl/plain/PlainAccessValidator.java",
                "contents_url": "https://api.github.com/repos/apache/rocketmq/contents/acl/src/main/java/org/apache/rocketmq/acl/plain/PlainAccessValidator.java?ref=6f322c46df9b14c2ac37512eb6e569398427bf0d",
                "filename": "acl/src/main/java/org/apache/rocketmq/acl/plain/PlainAccessValidator.java",
                "deletions": 0,
                "sha": "bd50e1292ad4e1682bc0dcd547b343a47d4c9d04",
                "blob_url": "https://github.com/apache/rocketmq/blob/6f322c46df9b14c2ac37512eb6e569398427bf0d/acl/src/main/java/org/apache/rocketmq/acl/plain/PlainAccessValidator.java",
                "patch": "@@ -52,6 +52,11 @@ public AccessResource parse(RemotingCommand request, String remoteAddr) {\n         } else {\n             accessResource.setWhiteRemoteAddress(remoteAddr);\n         }\n+\n+        if (request.getExtFields() == null) {\n+            throw new AclException(\"request's extFields value is null\");\n+        }\n+        \n         accessResource.setRequestCode(request.getCode());\n         accessResource.setAccessKey(request.getExtFields().get(SessionCredentials.ACCESS_KEY));\n         accessResource.setSignature(request.getExtFields().get(SessionCredentials.SIGNATURE));",
                "changes": 5
            },
            {
                "status": "modified",
                "additions": 17,
                "raw_url": "https://github.com/apache/rocketmq/raw/6f322c46df9b14c2ac37512eb6e569398427bf0d/acl/src/test/java/org/apache/rocketmq/acl/plain/PlainAccessValidatorTest.java",
                "contents_url": "https://api.github.com/repos/apache/rocketmq/contents/acl/src/test/java/org/apache/rocketmq/acl/plain/PlainAccessValidatorTest.java?ref=6f322c46df9b14c2ac37512eb6e569398427bf0d",
                "filename": "acl/src/test/java/org/apache/rocketmq/acl/plain/PlainAccessValidatorTest.java",
                "deletions": 0,
                "sha": "e7b6f2d68af27cbfe1879175e3ead04dd63de86b",
                "blob_url": "https://github.com/apache/rocketmq/blob/6f322c46df9b14c2ac37512eb6e569398427bf0d/acl/src/test/java/org/apache/rocketmq/acl/plain/PlainAccessValidatorTest.java",
                "patch": "@@ -43,6 +43,7 @@\n     @Before\n     public void init() {\n         System.setProperty(\"rocketmq.home.dir\", \"src/test/resources\");\n+        System.setProperty(\"rocketmq.acl.plain.file\", \"/conf/plain_acl.yml\");\n         plainAccessValidator = new PlainAccessValidator();\n         sessionCredentials = new SessionCredentials();\n         sessionCredentials.setAccessKey(\"RocketMQ\");\n@@ -115,6 +116,22 @@ public void validateSendMessageV2Test() {\n         plainAccessValidator.validate(accessResource);\n     }\n \n+    @Test(expected = AclException.class)\n+    public void validateForAdminCommandWithOutAclRPCHook() {\n+        RemotingCommand consumerOffsetAdminRequest = RemotingCommand.createRequestCommand(RequestCode.GET_ALL_CONSUMER_OFFSET, null);\n+        plainAccessValidator.parse(consumerOffsetAdminRequest, \"192.168.0.1:9876\");\n+\n+        RemotingCommand subscriptionGroupAdminRequest = RemotingCommand.createRequestCommand(RequestCode.GET_ALL_SUBSCRIPTIONGROUP_CONFIG, null);\n+        plainAccessValidator.parse(subscriptionGroupAdminRequest, \"192.168.0.1:9876\");\n+\n+        RemotingCommand delayOffsetAdminRequest = RemotingCommand.createRequestCommand(RequestCode.GET_ALL_DELAY_OFFSET, null);\n+        plainAccessValidator.parse(delayOffsetAdminRequest, \"192.168.0.1:9876\");\n+\n+        RemotingCommand allTopicConfigAdminRequest = RemotingCommand.createRequestCommand(RequestCode.GET_ALL_TOPIC_CONFIG, null);\n+        plainAccessValidator.parse(allTopicConfigAdminRequest, \"192.168.0.1:9876\");\n+\n+    }\n+\n     @Test\n     public void validatePullMessageTest() {\n         PullMessageRequestHeader pullMessageRequestHeader=new PullMessageRequestHeader();",
                "changes": 17
            }
        ],
        "unit_tests": [
            "PlainAccessValidatorTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "acl/src/test/java/org/apache/rocketmq/acl/plain/PlainAccessValidatorTest.java",
        "buggy_files": [
            "acl/src/main/java/org/apache/rocketmq/acl/plain/PlainAccessValidator.java"
        ],
        "fixed": true
    }
]