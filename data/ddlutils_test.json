{
    "ddlutils_10c4683": {
        "bug_id": "ddlutils_10c4683",
        "commit": "https://github.com/apache/ddlutils/commit/10c468338f1bd3c37e0ae04a6e5f100bd061ed31",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/ddlutils/blob/10c468338f1bd3c37e0ae04a6e5f100bd061ed31/src/main/java/org/apache/ddlutils/platform/PlatformImplBase.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/ddlutils/contents/src/main/java/org/apache/ddlutils/platform/PlatformImplBase.java?ref=10c468338f1bd3c37e0ae04a6e5f100bd061ed31",
                "deletions": 1,
                "filename": "src/main/java/org/apache/ddlutils/platform/PlatformImplBase.java",
                "patch": "@@ -1457,7 +1457,7 @@ public void processChange(Database            currentModel,\n         else\r\n         {\r\n             getSqlBuilder().dropTable(changedTable);\r\n-            getSqlBuilder().createTable(currentModel, targetTable, params.getParametersFor(targetTable));\r\n+            getSqlBuilder().createTable(currentModel, targetTable, parameters);\r\n         }\r\n \r\n         change.apply(currentModel, isDelimitedIdentifierModeOn());\r",
                "raw_url": "https://github.com/apache/ddlutils/raw/10c468338f1bd3c37e0ae04a6e5f100bd061ed31/src/main/java/org/apache/ddlutils/platform/PlatformImplBase.java",
                "sha": "ca67ff3f4031ae65e80cda94f1e019635d59ba36",
                "status": "modified"
            }
        ],
        "message": "Fix for DDLUTILS-204: NullPointerException in PlatformImplBase\n\ngit-svn-id: https://svn.apache.org/repos/asf/db/ddlutils/trunk@668046 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/ddlutils/commit/849bdbd18d8637100132fe43be32207da42b7d28",
        "patched_files": [
            "PlatformImplBase.java"
        ],
        "repo": "ddlutils",
        "unit_tests": [
            "TestPlatformImplBase.java"
        ]
    },
    "ddlutils_59aac8a": {
        "bug_id": "ddlutils_59aac8a",
        "commit": "https://github.com/apache/ddlutils/commit/59aac8acc4c1844b11eb71a090e1417ffe55d1ff",
        "file": [
            {
                "additions": 34,
                "blob_url": "https://github.com/apache/ddlutils/blob/59aac8acc4c1844b11eb71a090e1417ffe55d1ff/src/java/org/apache/commons/sql/io/JdbcModelReader.java",
                "changes": 46,
                "contents_url": "https://api.github.com/repos/apache/ddlutils/contents/src/java/org/apache/commons/sql/io/JdbcModelReader.java?ref=59aac8acc4c1844b11eb71a090e1417ffe55d1ff",
                "deletions": 12,
                "filename": "src/java/org/apache/commons/sql/io/JdbcModelReader.java",
                "patch": "@@ -21,6 +21,7 @@\n import java.sql.ResultSet;\n import java.sql.ResultSetMetaData;\n import java.sql.SQLException;\n+import java.sql.Types;\n import java.util.HashMap;\n import java.util.Iterator;\n import java.util.List;\n@@ -48,19 +49,38 @@\n public class JdbcModelReader {\n \n     /** The Log to which logging calls will be made. */\n-    private static final Log log = LogFactory.getLog( JdbcModelReader.class );\n+    private final Log log = LogFactory.getLog( JdbcModelReader.class );\n \n-    Connection connection = null;\n-    String catalog = null;\n-    String schema = null;\n-    String[] tableTypes = { \"TABLE\", \"VIEW\" };\n-    Pattern defaultPattern = Pattern.compile(\"\\\\(\\\\'?(.*?)\\\\'?\\\\)\"); //value with parenthesis and/or quotes around it\n+    /** Contains default column sizes (minimum sizes that a JDBC-compliant db must support) */\n+    private HashMap defaultSizes = new HashMap();\n+    \n+    private Connection connection = null;\n+    private String catalog = null;\n+    private String schema = null;\n+    private String[] tableTypes = { \"TABLE\", \"VIEW\" };\n+    private Pattern defaultPattern = Pattern.compile(\"\\\\(\\\\'?(.*?)\\\\'?\\\\)\"); //value with parenthesis and/or quotes around it\n \n-    public JdbcModelReader() {\n+    public JdbcModelReader()\n+    {\n+        this(null);\n     }\n     \n-    public JdbcModelReader(Connection conn) {\n-        this.connection = conn;\n+    public JdbcModelReader(Connection conn)\n+    {\n+        connection = conn;\n+        defaultSizes.put(new Integer(Types.CHAR),          \"254\");\n+        defaultSizes.put(new Integer(Types.VARCHAR),       \"254\");\n+        defaultSizes.put(new Integer(Types.LONGVARCHAR),   \"254\");\n+        defaultSizes.put(new Integer(Types.BINARY),        \"254\");\n+        defaultSizes.put(new Integer(Types.VARBINARY),     \"254\");\n+        defaultSizes.put(new Integer(Types.LONGVARBINARY), \"254\");\n+        defaultSizes.put(new Integer(Types.INTEGER),       \"32\");\n+        defaultSizes.put(new Integer(Types.BIGINT),        \"64\");\n+        defaultSizes.put(new Integer(Types.REAL),          \"7,0\");\n+        defaultSizes.put(new Integer(Types.FLOAT),         \"15,0\");\n+        defaultSizes.put(new Integer(Types.DOUBLE),        \"15,0\");\n+        defaultSizes.put(new Integer(Types.DECIMAL),       \"15,15\");\n+        defaultSizes.put(new Integer(Types.NUMERIC),       \"15,15\");\n     }\n     \n     public void setCatalog(String catalog) {\n@@ -243,7 +263,7 @@ private List getColumnsForTable(String tableName) throws SQLException {\n                 String columnSize =\n                     columnInfoColumns.contains(\"COLUMN_SIZE\")\n                         ? columnData.getString(\"COLUMN_SIZE\")\n-                        : null;\n+                        : (String)defaultSizes.get(new Integer(columnType));\n                 /* the number of fractional digits */\n                 int columnScale =\n                     columnInfoColumns.contains(\"DECIMAL_DIGITS\")\n@@ -338,6 +358,10 @@ private List getColumnsForTable(String tableName) throws SQLException {\n                 Column col = new Column();\n                 col.setName(columnName);\n                 col.setTypeCode(columnType);\n+                col.setPrecisionRadix(columnPrecision);\n+                col.setScale(columnScale);\n+                // we're setting the size after the precision and radix in case\n+                // the database prefers to return them in the size value \n                 col.setSize(columnSize);\n                 col.setRequired(!columnIsNullable);\n                 if (primaryKeys.contains(col.getName())) {\n@@ -355,8 +379,6 @@ private List getColumnsForTable(String tableName) throws SQLException {\n                     }\n                     col.setDefaultValue(columnDefaultValue);\n                 }\n-                col.setPrecisionRadix(columnPrecision);\n-                col.setScale(columnScale);\n                 columns.add(col);\n             }\n             return columns;",
                "raw_url": "https://github.com/apache/ddlutils/raw/59aac8acc4c1844b11eb71a090e1417ffe55d1ff/src/java/org/apache/commons/sql/io/JdbcModelReader.java",
                "sha": "fe44ab41ad6be03de6bc10d5329421f9ce9f8f17",
                "status": "modified"
            },
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/ddlutils/blob/59aac8acc4c1844b11eb71a090e1417ffe55d1ff/src/java/org/apache/commons/sql/model/Column.java",
                "changes": 21,
                "contents_url": "https://api.github.com/repos/apache/ddlutils/contents/src/java/org/apache/commons/sql/model/Column.java?ref=59aac8acc4c1844b11eb71a090e1417ffe55d1ff",
                "deletions": 9,
                "filename": "src/java/org/apache/commons/sql/model/Column.java",
                "patch": "@@ -201,16 +201,19 @@ public int getSizeAsInt()\n \n     public void setSize(String size)\n     {\n-        int pos = size.indexOf(\",\");\n-\n-        if (pos < 0)\n-        {\n-            this.size = size;\n-        }\n-        else\n+        if (size != null)\n         {\n-            this.size = size.substring(0, pos);\n-            scale     = Integer.parseInt(size.substring(pos + 1));\n+            int pos = size.indexOf(\",\");\n+    \n+            if (pos < 0)\n+            {\n+                this.size = size;\n+            }\n+            else\n+            {\n+                this.size = size.substring(0, pos);\n+                scale     = Integer.parseInt(size.substring(pos + 1));\n+            }\n         }\n     }\n     ",
                "raw_url": "https://github.com/apache/ddlutils/raw/59aac8acc4c1844b11eb71a090e1417ffe55d1ff/src/java/org/apache/commons/sql/model/Column.java",
                "sha": "e57a1309a1204440f7e1baa2a020be4134dc6ed9",
                "status": "modified"
            }
        ],
        "message": "Fixed NPE that occurs when using JdbcModelReader with numeric column types in Hsqldb\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/jakarta/commons/sandbox/sql/trunk@147532 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/ddlutils/commit/3661aa0f599c87ff683f82e309bd74eebf02ef1b",
        "patched_files": [
            "Column.java"
        ],
        "repo": "ddlutils",
        "unit_tests": [
            "TestColumn.java"
        ]
    },
    "ddlutils_7c30513": {
        "bug_id": "ddlutils_7c30513",
        "commit": "https://github.com/apache/ddlutils/commit/7c30513e4be87a6077b67b18d1399b67ab9ab16b",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/ddlutils/blob/7c30513e4be87a6077b67b18d1399b67ab9ab16b/src/main/java/org/apache/ddlutils/platform/ModelBasedResultSetIterator.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/ddlutils/contents/src/main/java/org/apache/ddlutils/platform/ModelBasedResultSetIterator.java?ref=7c30513e4be87a6077b67b18d1399b67ab9ab16b",
                "deletions": 1,
                "filename": "src/main/java/org/apache/ddlutils/platform/ModelBasedResultSetIterator.java",
                "patch": "@@ -135,7 +135,7 @@ private void initFromMetaData(Database model) throws SQLException\n                 // the JDBC driver gave us enough meta data info\r\n                 table = model.findTable(tableOfColumn, _caseSensitive);\r\n             }\r\n-            else\r\n+            if (table == null)\r\n             {\r\n                 // not enough info in the meta data of the result set, lets try the\r\n                 // user-supplied query hints\r",
                "raw_url": "https://github.com/apache/ddlutils/raw/7c30513e4be87a6077b67b18d1399b67ab9ab16b/src/main/java/org/apache/ddlutils/platform/ModelBasedResultSetIterator.java",
                "sha": "0ec97bcf71edfe0cd25f70732bbaea38108e6d84",
                "status": "modified"
            },
            {
                "additions": 73,
                "blob_url": "https://github.com/apache/ddlutils/blob/7c30513e4be87a6077b67b18d1399b67ab9ab16b/src/test/java/org/apache/ddlutils/io/TestMisc.java",
                "changes": 73,
                "contents_url": "https://api.github.com/repos/apache/ddlutils/contents/src/test/java/org/apache/ddlutils/io/TestMisc.java?ref=7c30513e4be87a6077b67b18d1399b67ab9ab16b",
                "deletions": 0,
                "filename": "src/test/java/org/apache/ddlutils/io/TestMisc.java",
                "patch": "@@ -34,7 +34,12 @@\n import org.apache.commons.beanutils.DynaBean;\r\n import org.apache.ddlutils.TestAgainstLiveDatabaseBase;\r\n import org.apache.ddlutils.model.Database;\r\n+import org.apache.ddlutils.model.Table;\r\n+import org.apache.ddlutils.platform.derby.DerbyPlatform;\r\n import org.apache.ddlutils.platform.hsqldb.HsqlDbPlatform;\r\n+import org.apache.ddlutils.platform.mysql.MySql50Platform;\r\n+import org.apache.ddlutils.platform.mysql.MySqlPlatform;\r\n+import org.apache.ddlutils.platform.postgresql.PostgreSqlPlatform;\r\n import org.apache.ddlutils.platform.sybase.SybasePlatform;\r\n import org.dom4j.Document;\r\n import org.dom4j.Element;\r\n@@ -1215,4 +1220,72 @@ public void testDdlUtils214() throws Exception\n         assertEquals(new Integer(2), beans2.get(0), \"pk1\");\r\n         assertEquals((Object)\"bar\",  beans2.get(0), \"pk2\");\r\n     }\r\n+\r\n+    /**\r\n+     * Test for DDLUTILS-227.\r\n+     */\r\n+    public void testDdlUtils227() throws Exception\r\n+    {\r\n+        final String modelXml = \r\n+            \"<?xml version='1.0' encoding='ISO-8859-1'?>\\n\"+\r\n+            \"<database xmlns='\" + DatabaseIO.DDLUTILS_NAMESPACE + \"' name='roundtriptest'>\\n\"+\r\n+            \"  <table name='Roundtrip'>\\n\"+\r\n+            \"    <column name='Pk' type='INTEGER' primaryKey='true' required='true'/>\\n\"+\r\n+            \"    <column name='Avalue' type='VARCHAR'/>\\n\"+\r\n+            \"  </table>\\n\"+\r\n+            \"</database>\";\r\n+\r\n+        createDatabase(modelXml);\r\n+\r\n+        Database readModel = readModelFromDatabase(\"roundtriptest\");\r\n+        \r\n+        assertEquals(getAdjustedModel(),\r\n+                     readModel);\r\n+\r\n+        insertRow(\"Roundtrip\", new Object[] { new Integer(1), \"foo\" });\r\n+\r\n+        List beans = getRows(\"Roundtrip\");\r\n+\r\n+        assertEquals(1, beans.size());\r\n+        assertEquals(new Integer(1), beans.get(0), \"Pk\");\r\n+        assertEquals((Object)\"foo\",  beans.get(0), \"Avalue\");\r\n+\r\n+        Table        table = getModel().findTable(\"Roundtrip\", getPlatform().isDelimitedIdentifierModeOn());\r\n+        StringBuffer query = new StringBuffer();\r\n+\r\n+        query.append(\"SELECT * FROM (SELECT * FROM \");\r\n+        if (getPlatform().isDelimitedIdentifierModeOn())\r\n+        {\r\n+            query.append(getPlatformInfo().getDelimiterToken());\r\n+        }\r\n+        query.append(table.getName());\r\n+        if (getPlatform().isDelimitedIdentifierModeOn())\r\n+        {\r\n+            query.append(getPlatformInfo().getDelimiterToken());\r\n+        }\r\n+        query.append(\")\");\r\n+        // Some JDBC drivers do not allow us to perform the query without an explicit alias \r\n+        if (MySqlPlatform.DATABASENAME.equals(getPlatform().getName()) ||\r\n+            MySql50Platform.DATABASENAME.equals(getPlatform().getName()) ||\r\n+            PostgreSqlPlatform.DATABASENAME.equals(getPlatform().getName()) ||\r\n+            DerbyPlatform.DATABASENAME.equals(getPlatform().getName()))\r\n+        {\r\n+            query.append(\" AS \");\r\n+            if (getPlatform().isDelimitedIdentifierModeOn())\r\n+            {\r\n+                query.append(getPlatformInfo().getDelimiterToken());\r\n+            }\r\n+            query.append(table.getName());\r\n+            if (getPlatform().isDelimitedIdentifierModeOn())\r\n+            {\r\n+                query.append(getPlatformInfo().getDelimiterToken());\r\n+            }\r\n+        }\r\n+\r\n+        beans = getPlatform().fetch(getModel(), query.toString(), new Table[] { table });\r\n+\r\n+        assertEquals(1, beans.size());\r\n+        assertEquals(new Integer(1), beans.get(0), \"Pk\");\r\n+        assertEquals((Object)\"foo\",  beans.get(0), \"Avalue\");\r\n+    }\r\n }\r",
                "raw_url": "https://github.com/apache/ddlutils/raw/7c30513e4be87a6077b67b18d1399b67ab9ab16b/src/test/java/org/apache/ddlutils/io/TestMisc.java",
                "sha": "c19e3ffb4ee34e0a7ccf89e3cc802f787a8796ef",
                "status": "modified"
            }
        ],
        "message": "Fix and test for DDLUTILS-227: NullPointerException in ModelBasedResultSetIterator\n\ngit-svn-id: https://svn.apache.org/repos/asf/db/ddlutils/trunk@711686 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/ddlutils/commit/b37209b48880e5977d25ed59f38b0fe10b7abec7",
        "patched_files": [
            "ModelBasedResultSetIterator.java"
        ],
        "repo": "ddlutils",
        "unit_tests": [
            "TestMisc.java"
        ]
    }
}