[
    {
        "repo": "mina-vysper",
        "message": "Fixed a bug in the testcase - the NullPointerException came from the wrong method.\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/sandbox/vysper/trunk@791225 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-vysper/commit/6a114ffeb30a92a104bdb3503c3522b2153ff049",
        "parent": "https://github.com/apache/mina-vysper/commit/cf738f71e32bd529aaa950fa5caaf7888a6fe549",
        "bug_id": "mina-vysper_1",
        "file": [
            {
                "sha": "609f439e9a426e4e26dbb2863bc2115b67da379c",
                "filename": "src/test/java/org/apache/vysper/xmpp/modules/extension/xep0060_pubsub/handler/PubSubSubscribeTestCase.java",
                "blob_url": "https://github.com/apache/mina-vysper/blob/6a114ffeb30a92a104bdb3503c3522b2153ff049/src/test/java/org/apache/vysper/xmpp/modules/extension/xep0060_pubsub/handler/PubSubSubscribeTestCase.java",
                "raw_url": "https://github.com/apache/mina-vysper/raw/6a114ffeb30a92a104bdb3503c3522b2153ff049/src/test/java/org/apache/vysper/xmpp/modules/extension/xep0060_pubsub/handler/PubSubSubscribeTestCase.java",
                "status": "modified",
                "changes": 4,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/mina-vysper/contents/src/test/java/org/apache/vysper/xmpp/modules/extension/xep0060_pubsub/handler/PubSubSubscribeTestCase.java?ref=6a114ffeb30a92a104bdb3503c3522b2153ff049",
                "patch": "@@ -79,7 +79,9 @@ public void testSubscribe() throws Exception {\n     }\n     \n     public void testSubscribeNoFrom() throws Exception {\n-        AbstractStanzaGenerator sg = getDefaultStanzaGenerator();\n+        DefaultSubscribeStanzaGenerator sg = (DefaultSubscribeStanzaGenerator)getDefaultStanzaGenerator();\n+        sg.overrideSubscriberJID(client.getFullQualifiedName());\n+        \n         Stanza stanza = sg.getStanza(null, pubsubService, \"id123\", testNode);\n         ResponseStanzaContainer result = sendStanza(stanza, true);\n         assertTrue(result.hasResponse());",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "mina-vysper",
        "message": "VYSPER-335: check for NPEs in DefaultResourceRegistry\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/vysper/trunk@1412056 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-vysper/commit/e421335e4eb005a44711b0f0a44a1c574fae9d2c",
        "parent": "https://github.com/apache/mina-vysper/commit/1c4c5a82d603f9a9d82044b53181cc88b5c2627a",
        "bug_id": "mina-vysper_2",
        "file": [
            {
                "sha": "00b09553c130b15a42bc4eec968a68197a4b2a01",
                "filename": "server/core/src/main/java/org/apache/vysper/xmpp/state/resourcebinding/DefaultResourceRegistry.java",
                "blob_url": "https://github.com/apache/mina-vysper/blob/e421335e4eb005a44711b0f0a44a1c574fae9d2c/server/core/src/main/java/org/apache/vysper/xmpp/state/resourcebinding/DefaultResourceRegistry.java",
                "raw_url": "https://github.com/apache/mina-vysper/raw/e421335e4eb005a44711b0f0a44a1c574fae9d2c/server/core/src/main/java/org/apache/vysper/xmpp/state/resourcebinding/DefaultResourceRegistry.java",
                "status": "modified",
                "changes": 15,
                "additions": 11,
                "contents_url": "https://api.github.com/repos/apache/mina-vysper/contents/server/core/src/main/java/org/apache/vysper/xmpp/state/resourcebinding/DefaultResourceRegistry.java?ref=e421335e4eb005a44711b0f0a44a1c574fae9d2c",
                "patch": "@@ -136,17 +136,20 @@ public String bindSession(SessionContext sessionContext) {\n      * @param resourceId\n      */\n     public boolean unbindResource(String resourceId) {\n-        boolean noResourceRemainsForSession = false;\n+        boolean noResourceRemainsForSession;\n         synchronized (boundResources) {\n             synchronized (entityResources) {\n                 synchronized (sessionResources) {\n                     SessionContext sessionContext = getSessionContext(resourceId);\n \n                     // remove from entity's list of resources\n                     List<String> resourceListForEntity = getResourceList(sessionContext.getInitiatingEntity());\n-                    resourceListForEntity.remove(resourceId);\n-                    if (resourceListForEntity.isEmpty())\n-                        entityResources.remove(sessionContext.getInitiatingEntity());\n+                    if (resourceListForEntity != null) {\n+                        resourceListForEntity.remove(resourceId);\n+                        if (resourceListForEntity.isEmpty()) {\n+                            entityResources.remove(sessionContext.getInitiatingEntity());\n+                        }\n+                    }\n \n                     // remove from session's list of resources\n                     List<String> resourceListForSession = sessionResources.get(sessionContext);\n@@ -411,6 +414,8 @@ public void setResourcePriority(String resourceId, int priority) {\n     public List<String> getInterestedResources(Entity entity) {\n         List<String> resources = getResourceList(entity);\n         List<String> result = new ArrayList<String>();\n+        if (resources == null) return result;\n+        \n         for (String resource : resources) {\n             ResourceState resourceState = getResourceState(resource);\n             if (ResourceState.isInterested(resourceState))\n@@ -426,6 +431,8 @@ public void setResourcePriority(String resourceId, int priority) {\n     public List<String> getAvailableResources(Entity entity) {\n         List<String> resources = getResourceList(entity);\n         List<String> result = new ArrayList<String>();\n+        if (resources == null) return result;\n+\n         for (String resource : resources) {\n             ResourceState resourceState = getResourceState(resource);\n             if (resourceState == AVAILABLE || resourceState == AVAILABLE_INTERESTED) {",
                "deletions": 4
            }
        ]
    },
    {
        "repo": "mina-vysper",
        "message": "Fixed NPE if accountjid was not provided by client\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/vysper/trunk@1058895 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-vysper/commit/b543223880c9c4adeb5b8aa0170692aa872498e6",
        "parent": "https://github.com/apache/mina-vysper/commit/719d411b519fbcfb361d24d753ba5446ad9c8978",
        "bug_id": "mina-vysper_3",
        "file": [
            {
                "sha": "20a56ac50d7bfc3153d9e2dfecb343f6c9ea45ae",
                "filename": "server/core/src/main/java/org/apache/vysper/xmpp/modules/extension/xep0133_service_administration/command/AddUserCommandHandler.java",
                "blob_url": "https://github.com/apache/mina-vysper/blob/b543223880c9c4adeb5b8aa0170692aa872498e6/server/core/src/main/java/org/apache/vysper/xmpp/modules/extension/xep0133_service_administration/command/AddUserCommandHandler.java",
                "raw_url": "https://github.com/apache/mina-vysper/raw/b543223880c9c4adeb5b8aa0170692aa872498e6/server/core/src/main/java/org/apache/vysper/xmpp/modules/extension/xep0133_service_administration/command/AddUserCommandHandler.java",
                "status": "modified",
                "changes": 5,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/mina-vysper/contents/server/core/src/main/java/org/apache/vysper/xmpp/modules/extension/xep0133_service_administration/command/AddUserCommandHandler.java?ref=b543223880c9c4adeb5b8aa0170692aa872498e6",
                "patch": "@@ -73,11 +73,14 @@ protected XMLElement processForm(List<XMLElement> commandElements, List<Note> no\n         }\n         final DataFormParser dataFormParser = new DataFormParser(commandElements.get(0));\n         final Map<String,Object> valueMap = dataFormParser.extractFieldValues();\n+        \n         final Entity accountjid;\n         if(valueMap.get(\"accountjid\") instanceof Entity) {\n             accountjid = (Entity) valueMap.get(\"accountjid\");\n-        } else {\n+        } else if(valueMap.get(\"accountjid\") != null) {\n             accountjid = EntityImpl.parseUnchecked((String) valueMap.get(\"accountjid\"));\n+        } else {\n+            accountjid = null;\n         }\n         final String password = (String)valueMap.get(\"password\");\n         final String password2 = (String)valueMap.get(\"password-verify\");",
                "deletions": 1
            },
            {
                "sha": "cfecb1d149f714c89f6b6920bcd2527632113dd5",
                "filename": "server/core/src/main/java/org/apache/vysper/xmpp/modules/extension/xep0133_service_administration/command/ChangeUserPasswordCommandHandler.java",
                "blob_url": "https://github.com/apache/mina-vysper/blob/b543223880c9c4adeb5b8aa0170692aa872498e6/server/core/src/main/java/org/apache/vysper/xmpp/modules/extension/xep0133_service_administration/command/ChangeUserPasswordCommandHandler.java",
                "raw_url": "https://github.com/apache/mina-vysper/raw/b543223880c9c4adeb5b8aa0170692aa872498e6/server/core/src/main/java/org/apache/vysper/xmpp/modules/extension/xep0133_service_administration/command/ChangeUserPasswordCommandHandler.java",
                "status": "modified",
                "changes": 4,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/mina-vysper/contents/server/core/src/main/java/org/apache/vysper/xmpp/modules/extension/xep0133_service_administration/command/ChangeUserPasswordCommandHandler.java?ref=b543223880c9c4adeb5b8aa0170692aa872498e6",
                "patch": "@@ -80,8 +80,10 @@ protected XMLElement processForm(List<XMLElement> commandElements, List<Note> no\n         final Entity accountjid;\n         if(valueMap.get(\"accountjid\") instanceof Entity) {\n             accountjid = (Entity) valueMap.get(\"accountjid\");\n-        } else {\n+        } else if(valueMap.get(\"accountjid\") != null) {\n             accountjid = EntityImpl.parseUnchecked((String) valueMap.get(\"accountjid\"));\n+        } else {\n+            accountjid = null;\n         }\n         final String password = (String)valueMap.get(\"password\");\n         final String password2 = (String)valueMap.get(\"password-verify\");",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "mina-vysper",
        "message": "Fix potential NPE when getting the port for a non-started TCPEndpoint\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/vysper/trunk@1095374 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-vysper/commit/2f8ca2c409fc406d4630813eafa16ea7ebe5c51a",
        "parent": "https://github.com/apache/mina-vysper/commit/dbfedf822349f53e1848297145634079b204988f",
        "bug_id": "mina-vysper_4",
        "file": [
            {
                "sha": "bdf4a62e72cda9bcf7b9a4fb56ee24c7067baa7b",
                "filename": "server/core/src/main/java/org/apache/vysper/mina/TCPEndpoint.java",
                "blob_url": "https://github.com/apache/mina-vysper/blob/2f8ca2c409fc406d4630813eafa16ea7ebe5c51a/server/core/src/main/java/org/apache/vysper/mina/TCPEndpoint.java",
                "raw_url": "https://github.com/apache/mina-vysper/raw/2f8ca2c409fc406d4630813eafa16ea7ebe5c51a/server/core/src/main/java/org/apache/vysper/mina/TCPEndpoint.java",
                "status": "modified",
                "changes": 5,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/mina-vysper/contents/server/core/src/main/java/org/apache/vysper/mina/TCPEndpoint.java?ref=2f8ca2c409fc406d4630813eafa16ea7ebe5c51a",
                "patch": "@@ -51,8 +51,11 @@ public void setServerRuntimeContext(ServerRuntimeContext serverRuntimeContext) {\n         this.serverRuntimeContext = serverRuntimeContext;\n     }\n     \n+    /**\n+     * Returns the configured port if one is provided (non-zero value).\n+     */\n     public int getPort() {\n-        if(port != 0) {\n+        if(port != 0 || acceptor == null) {\n             return port;\n         } else {\n             return acceptor.getLocalAddress().getPort();",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "mina-vysper",
        "message": "Fix NPE in XML renderer\nFix bug on parsing element names with dashes\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/vysper/trunk@980973 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-vysper/commit/2d4da7bcd6cb3773a54e200d3ccbb565e401f067",
        "parent": "https://github.com/apache/mina-vysper/commit/9383c4cad0462a21c69cb691dd5b6f692358ac2e",
        "bug_id": "mina-vysper_5",
        "file": [
            {
                "sha": "550b749b967c063b02c305c42ea7794768b5fd85",
                "filename": "nbxml/src/main/java/org/apache/vysper/xml/fragment/Renderer.java",
                "blob_url": "https://github.com/apache/mina-vysper/blob/2d4da7bcd6cb3773a54e200d3ccbb565e401f067/nbxml/src/main/java/org/apache/vysper/xml/fragment/Renderer.java",
                "raw_url": "https://github.com/apache/mina-vysper/raw/2d4da7bcd6cb3773a54e200d3ccbb565e401f067/nbxml/src/main/java/org/apache/vysper/xml/fragment/Renderer.java",
                "status": "modified",
                "changes": 2,
                "additions": 1,
                "contents_url": "https://api.github.com/repos/apache/mina-vysper/contents/nbxml/src/main/java/org/apache/vysper/xml/fragment/Renderer.java?ref=2d4da7bcd6cb3773a54e200d3ccbb565e401f067",
                "patch": "@@ -121,7 +121,7 @@ private boolean hasXmlnsReservedName(Attribute attribute) {\n \n     private void renderElementName(StringBuilder buffer, XMLElement element, ResolverNamespaceResolver nsResolver) {\n         // if the element has a namespace prefix, retrieves the prefix from the defining attribute\n-        if (element.getNamespacePrefix().length() > 0) {\n+        if (element.getNamespacePrefix() != null && element.getNamespacePrefix().length() > 0) {\n             buffer.append(element.getNamespacePrefix()).append(COLON);\n         } else if (element.getNamespaceURI().length() > 0) {\n             // element is in a namespace, but without a declared prefix, we need to resolve the prefix",
                "deletions": 1
            },
            {
                "sha": "4743168b4ac02cdb44a9df58ec5e3dcff428848c",
                "filename": "nbxml/src/main/java/org/apache/vysper/xml/sax/impl/XMLParser.java",
                "blob_url": "https://github.com/apache/mina-vysper/blob/2d4da7bcd6cb3773a54e200d3ccbb565e401f067/nbxml/src/main/java/org/apache/vysper/xml/sax/impl/XMLParser.java",
                "raw_url": "https://github.com/apache/mina-vysper/raw/2d4da7bcd6cb3773a54e200d3ccbb565e401f067/nbxml/src/main/java/org/apache/vysper/xml/sax/impl/XMLParser.java",
                "status": "modified",
                "changes": 2,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/mina-vysper/contents/nbxml/src/main/java/org/apache/vysper/xml/sax/impl/XMLParser.java?ref=2d4da7bcd6cb3773a54e200d3ccbb565e401f067",
                "patch": "@@ -193,6 +193,8 @@ public void token(char c, String token) throws SAXException {\n             // token must be =\n             if (c == '=') {\n                 state = State.AFTER_ATTRIBUTE_EQUALS;\n+            } else {\n+                fatalError(\"Not wellformed\");\n             }\n             break;\n         case AFTER_ATTRIBUTE_EQUALS:",
                "deletions": 0
            },
            {
                "sha": "d1a67fe87dd95bfcc848a4aa1bfbae723ce172ce",
                "filename": "nbxml/src/main/java/org/apache/vysper/xml/sax/impl/XMLTokenizer.java",
                "blob_url": "https://github.com/apache/mina-vysper/blob/2d4da7bcd6cb3773a54e200d3ccbb565e401f067/nbxml/src/main/java/org/apache/vysper/xml/sax/impl/XMLTokenizer.java",
                "raw_url": "https://github.com/apache/mina-vysper/raw/2d4da7bcd6cb3773a54e200d3ccbb565e401f067/nbxml/src/main/java/org/apache/vysper/xml/sax/impl/XMLTokenizer.java",
                "status": "modified",
                "changes": 4,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/mina-vysper/contents/nbxml/src/main/java/org/apache/vysper/xml/sax/impl/XMLTokenizer.java?ref=2d4da7bcd6cb3773a54e200d3ccbb565e401f067",
                "patch": "@@ -87,6 +87,8 @@ public void parse(IoBuffer byteBuffer, CharsetDecoder decoder) throws SAXExcepti\n                 } else if (c == '\\'') {\n                     emit(c, byteBuffer);\n                     state = State.IN_SINGLE_ATTRIBUTE_VALUE;\n+                } else if (c == '-') {\n+                    emit(c, byteBuffer);\n                 } else if (isControlChar(c)) {\n                     emit(c, byteBuffer);\n                 } else if (Character.isWhitespace(c)) {\n@@ -132,7 +134,7 @@ public void close() {\n     }\n \n     private boolean isControlChar(char c) {\n-        return c == '<' || c == '>' || c == '-' || c == '!' || c == '/' || c == '?' || c == '=';\n+        return c == '<' || c == '>' || c == '!' || c == '/' || c == '?' || c == '=';\n     }\n \n     private void emit(char token, IoBuffer byteBuffer) throws SAXException {",
                "deletions": 1
            },
            {
                "sha": "2944c315499a5a0c38eaf30e6109c8b50ef93b46",
                "filename": "nbxml/src/test/java/org/apache/vysper/xml/sax/impl/ParseElementsTestCase.java",
                "blob_url": "https://github.com/apache/mina-vysper/blob/2d4da7bcd6cb3773a54e200d3ccbb565e401f067/nbxml/src/test/java/org/apache/vysper/xml/sax/impl/ParseElementsTestCase.java",
                "raw_url": "https://github.com/apache/mina-vysper/raw/2d4da7bcd6cb3773a54e200d3ccbb565e401f067/nbxml/src/test/java/org/apache/vysper/xml/sax/impl/ParseElementsTestCase.java",
                "status": "modified",
                "changes": 11,
                "additions": 11,
                "contents_url": "https://api.github.com/repos/apache/mina-vysper/contents/nbxml/src/test/java/org/apache/vysper/xml/sax/impl/ParseElementsTestCase.java?ref=2d4da7bcd6cb3773a54e200d3ccbb565e401f067",
                "patch": "@@ -107,6 +107,17 @@ public void testNumberInName() throws Exception {\n         assertNoMoreevents(events);\n     }\n \n+    public void testDashInName() throws Exception {\n+        Iterator<TestEvent> events = parse(\"<ro-ot />\").iterator();\n+\n+        assertStartDocument(events.next());\n+        assertStartElement(\"\", \"ro-ot\", \"ro-ot\", events.next());\n+        assertEndElement(\"\", \"ro-ot\", \"ro-ot\", events.next());\n+        assertEndDocument(events.next());\n+\n+        assertNoMoreevents(events);\n+    }\n+    \n     public void testInvalidUnicodeInName() throws Exception {\n         Iterator<TestEvent> events = parse(\"<r\\u2190oot />\").iterator();\n ",
                "deletions": 0
            }
        ]
    },
    {
        "repo": "mina-vysper",
        "message": "Fix NPE when characters sent outside of stanza\nAllow XML declaration for restarting XML streams\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/vysper/trunk@941229 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/mina-vysper/commit/7198c26c8523f6b36fca98de8162996ee0b052e0",
        "parent": "https://github.com/apache/mina-vysper/commit/0d44e84d49a93f1ac45d4cb6cd0c7bd09017815a",
        "bug_id": "mina-vysper_6",
        "file": [
            {
                "sha": "64094d36eef89be7dce77437ae3e650ad5201e74",
                "filename": "nbxml/src/main/java/org/apache/vysper/xml/decoder/XMPPContentHandler.java",
                "blob_url": "https://github.com/apache/mina-vysper/blob/7198c26c8523f6b36fca98de8162996ee0b052e0/nbxml/src/main/java/org/apache/vysper/xml/decoder/XMPPContentHandler.java",
                "raw_url": "https://github.com/apache/mina-vysper/raw/7198c26c8523f6b36fca98de8162996ee0b052e0/nbxml/src/main/java/org/apache/vysper/xml/decoder/XMPPContentHandler.java",
                "status": "modified",
                "changes": 6,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/mina-vysper/contents/nbxml/src/main/java/org/apache/vysper/xml/decoder/XMPPContentHandler.java?ref=7198c26c8523f6b36fca98de8162996ee0b052e0",
                "patch": "@@ -76,7 +76,9 @@ public XMPPContentHandler(XMLElementBuilderFactory builderFactory) {\n \tpublic void characters(char[] ch, int start, int length)\n \t\t\tthrows SAXException {\n \t\t// TODO handle start and length\n-\t\tbuilder.addText(new String(ch));\n+\t\tif(builder != null) {\n+\t\t\tbuilder.addText(new String(ch));\n+\t\t}\n \t\t\n \t}\n \n@@ -90,7 +92,7 @@ public void endElement(String uri, String localName, String qName)\n \t\t\t// complete stanza, emit\n \t\t\temitStanza();\n \t\t} else if(depth == 0) {\n-\t\t\t// end stanza:stanza element\n+\t\t\t// end stream:stream element\n \t\t\t// TODO handle\n \t\t} else {\n \t\t\tbuilder.endInnerElement();",
                "deletions": 2
            },
            {
                "sha": "b4694e871637f67bd9a11850d1421c71c3914264",
                "filename": "nbxml/src/main/java/org/apache/vysper/xml/decoder/XMPPDecoder.java",
                "blob_url": "https://github.com/apache/mina-vysper/blob/7198c26c8523f6b36fca98de8162996ee0b052e0/nbxml/src/main/java/org/apache/vysper/xml/decoder/XMPPDecoder.java",
                "raw_url": "https://github.com/apache/mina-vysper/raw/7198c26c8523f6b36fca98de8162996ee0b052e0/nbxml/src/main/java/org/apache/vysper/xml/decoder/XMPPDecoder.java",
                "status": "modified",
                "changes": 3,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/mina-vysper/contents/nbxml/src/main/java/org/apache/vysper/xml/decoder/XMPPDecoder.java?ref=7198c26c8523f6b36fca98de8162996ee0b052e0",
                "patch": "@@ -36,6 +36,7 @@\n  */\n public class XMPPDecoder extends CumulativeProtocolDecoder {\n \n+\tprivate static final String XML_DECL = \"<?xml\";\n     private static final String STREAM_STREAM = \"<stream:stream\";\n \n \tpublic static final String SESSION_ATTRIBUTE_NAME = \"xmppParser\";\n@@ -80,7 +81,7 @@ protected boolean doDecode(IoSession session,\n     \tString peek = in.getString(14, CharsetUtil.UTF8_DECODER);\n     \tin.reset();\n \n-    \tif (reader == null || STREAM_STREAM.equals(peek)) {\n+    \tif (reader == null || STREAM_STREAM.equals(peek) || (peek != null && peek.startsWith(XML_DECL))) {\n         \treader = new DefaultNonBlockingXMLReader();\n         \t\n         \t// we need to check the jabber:client/jabber:server NS declarations",
                "deletions": 1
            }
        ]
    }
]