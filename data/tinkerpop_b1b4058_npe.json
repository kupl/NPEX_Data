[
    {
        "repo": "tinkerpop",
        "commit": "https://github.com/apache/tinkerpop/commit/b1b4058180a995fc9f7f465c2ec5ce5948c910dd",
        "bug_id": "tinkerpop_b1b4058",
        "message": "Fixed a NullPointerException in PeerPressureVertexProgram. PageRankVertexProgram had the null pointer check and PeerPressure did not. Added PeerPressureVertexProgramTest to ProcessComputeSuite. Ingeration tested Spark. CTR given the simplicity of the fix.",
        "parent": "https://github.com/apache/tinkerpop/commit/6ae06da112049c363a152bc1445bf113cf1a90e8",
        "patched_files": [
            "ProcessComputerSuite.java",
            "CHANGELOG.asciidoc",
            "GroovyProcessComputerSuite.java",
            "PageRankVertexProgram.java",
            "PeerPressureVertexProgram.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 1,
                "raw_url": "https://github.com/apache/tinkerpop/raw/b1b4058180a995fc9f7f465c2ec5ce5948c910dd/CHANGELOG.asciidoc",
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/CHANGELOG.asciidoc?ref=b1b4058180a995fc9f7f465c2ec5ce5948c910dd",
                "filename": "CHANGELOG.asciidoc",
                "deletions": 0,
                "sha": "2bf0df709f9b840f3cd6e9b808df80efb65248ba",
                "blob_url": "https://github.com/apache/tinkerpop/blob/b1b4058180a995fc9f7f465c2ec5ce5948c910dd/CHANGELOG.asciidoc",
                "patch": "@@ -26,6 +26,7 @@ image::https://raw.githubusercontent.com/apache/incubator-tinkerpop/master/docs/\n TinkerPop 3.1.1 (NOT OFFICIALLY RELEASED YET)\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n+* Fixed a `NullPointerException` bug in `PeerPressureVertexProgram` that occurred when an adjacency traversal was not provided.\n * Fixed a long standing issue around having to use `reduceByKey()` on input data to Spark. It is no longer required.\n * Added `Spark` static object to allow \"file system\" control of persisted RDDs in Spark.\n * Improved logging control during builds with Maven.",
                "changes": 1
            },
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/tinkerpop/raw/b1b4058180a995fc9f7f465c2ec5ce5948c910dd/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/clustering/peerpressure/PeerPressureVertexProgram.java",
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/clustering/peerpressure/PeerPressureVertexProgram.java?ref=b1b4058180a995fc9f7f465c2ec5ce5948c910dd",
                "filename": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/clustering/peerpressure/PeerPressureVertexProgram.java",
                "deletions": 2,
                "sha": "f2989e08204a3a7ca4425654f4ffc358e8e366f5",
                "blob_url": "https://github.com/apache/tinkerpop/blob/b1b4058180a995fc9f7f465c2ec5ce5948c910dd/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/clustering/peerpressure/PeerPressureVertexProgram.java",
                "patch": "@@ -93,10 +93,11 @@ public void loadState(final Graph graph, final Configuration configuration) {\n     @Override\n     public void storeState(final Configuration configuration) {\n         super.storeState(configuration);\n-        this.configurationTraversal.storeState(configuration);\n         configuration.setProperty(MAX_ITERATIONS, this.maxIterations);\n         configuration.setProperty(DISTRIBUTE_VOTE, this.distributeVote);\n-\n+        if (null != this.configurationTraversal) {\n+            this.configurationTraversal.storeState(configuration);\n+        }\n     }\n \n     @Override",
                "changes": 5
            },
            {
                "status": "modified",
                "additions": 4,
                "raw_url": "https://github.com/apache/tinkerpop/raw/b1b4058180a995fc9f7f465c2ec5ce5948c910dd/gremlin-groovy-test/src/main/java/org/apache/tinkerpop/gremlin/process/GroovyProcessComputerSuite.java",
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-groovy-test/src/main/java/org/apache/tinkerpop/gremlin/process/GroovyProcessComputerSuite.java?ref=b1b4058180a995fc9f7f465c2ec5ce5948c910dd",
                "filename": "gremlin-groovy-test/src/main/java/org/apache/tinkerpop/gremlin/process/GroovyProcessComputerSuite.java",
                "deletions": 1,
                "sha": "7187062e168024ce8fd94b9d9886ed9190546bfc",
                "blob_url": "https://github.com/apache/tinkerpop/blob/b1b4058180a995fc9f7f465c2ec5ce5948c910dd/gremlin-groovy-test/src/main/java/org/apache/tinkerpop/gremlin/process/GroovyProcessComputerSuite.java",
                "patch": "@@ -24,7 +24,9 @@\n import org.apache.tinkerpop.gremlin.groovy.util.SugarTestHelper;\n import org.apache.tinkerpop.gremlin.process.computer.GraphComputer;\n import org.apache.tinkerpop.gremlin.process.computer.bulkloading.BulkLoaderVertexProgramTest;\n-import org.apache.tinkerpop.gremlin.process.computer.ranking.PageRankVertexProgramTest;\n+import org.apache.tinkerpop.gremlin.process.computer.clustering.peerpressure.PeerPressureVertexProgram;\n+import org.apache.tinkerpop.gremlin.process.computer.clustering.peerpressure.PeerPressureVertexProgramTest;\n+import org.apache.tinkerpop.gremlin.process.computer.ranking.pagerank.PageRankVertexProgramTest;\n import org.apache.tinkerpop.gremlin.process.traversal.step.branch.GroovyBranchTest;\n import org.apache.tinkerpop.gremlin.process.traversal.step.branch.GroovyChooseTest;\n import org.apache.tinkerpop.gremlin.process.traversal.step.branch.GroovyLocalTest;\n@@ -168,6 +170,7 @@\n \n             // algorithms\n             PageRankVertexProgramTest.class,\n+            PeerPressureVertexProgramTest.class,\n             BulkLoaderVertexProgramTest.class,\n     };\n ",
                "changes": 5
            },
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/tinkerpop/raw/b1b4058180a995fc9f7f465c2ec5ce5948c910dd/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/ProcessComputerSuite.java",
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/ProcessComputerSuite.java?ref=b1b4058180a995fc9f7f465c2ec5ce5948c910dd",
                "filename": "gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/ProcessComputerSuite.java",
                "deletions": 1,
                "sha": "76919bef3bcb4f64506de1596cc2c42c023f5986",
                "blob_url": "https://github.com/apache/tinkerpop/blob/b1b4058180a995fc9f7f465c2ec5ce5948c910dd/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/ProcessComputerSuite.java",
                "patch": "@@ -22,7 +22,8 @@\n import org.apache.tinkerpop.gremlin.process.computer.GraphComputer;\n import org.apache.tinkerpop.gremlin.process.computer.GraphComputerTest;\n import org.apache.tinkerpop.gremlin.process.computer.bulkloading.BulkLoaderVertexProgramTest;\n-import org.apache.tinkerpop.gremlin.process.computer.ranking.PageRankVertexProgramTest;\n+import org.apache.tinkerpop.gremlin.process.computer.clustering.peerpressure.PeerPressureVertexProgramTest;\n+import org.apache.tinkerpop.gremlin.process.computer.ranking.pagerank.PageRankVertexProgramTest;\n import org.apache.tinkerpop.gremlin.process.traversal.TraversalEngine;\n import org.apache.tinkerpop.gremlin.process.traversal.step.branch.BranchTest;\n import org.apache.tinkerpop.gremlin.process.traversal.step.branch.ChooseTest;\n@@ -172,6 +173,7 @@\n \n             // algorithms\n             PageRankVertexProgramTest.class,\n+            PeerPressureVertexProgramTest.class,\n             BulkLoaderVertexProgramTest.class,\n \n             // strategy",
                "changes": 4
            },
            {
                "status": "added",
                "additions": 63,
                "raw_url": "https://github.com/apache/tinkerpop/raw/b1b4058180a995fc9f7f465c2ec5ce5948c910dd/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/computer/clustering/peerpressure/PeerPressureVertexProgramTest.java",
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/computer/clustering/peerpressure/PeerPressureVertexProgramTest.java?ref=b1b4058180a995fc9f7f465c2ec5ce5948c910dd",
                "filename": "gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/computer/clustering/peerpressure/PeerPressureVertexProgramTest.java",
                "deletions": 0,
                "sha": "5d96eafcc4afe65f1055e66aec3c965bd6ee9d21",
                "blob_url": "https://github.com/apache/tinkerpop/blob/b1b4058180a995fc9f7f465c2ec5ce5948c910dd/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/computer/clustering/peerpressure/PeerPressureVertexProgramTest.java",
                "patch": "@@ -0,0 +1,63 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.tinkerpop.gremlin.process.computer.clustering.peerpressure;\n+\n+import org.apache.tinkerpop.gremlin.LoadGraphWith;\n+import org.apache.tinkerpop.gremlin.process.AbstractGremlinProcessTest;\n+import org.apache.tinkerpop.gremlin.process.computer.ComputerResult;\n+import org.apache.tinkerpop.gremlin.process.computer.GraphComputer;\n+import org.apache.tinkerpop.gremlin.util.iterator.IteratorUtils;\n+import org.junit.Test;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import static org.apache.tinkerpop.gremlin.LoadGraphWith.GraphData.MODERN;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+\n+/**\n+ * @author Marko A. Rodriguez (http://markorodriguez.com)\n+ */\n+public class PeerPressureVertexProgramTest extends AbstractGremlinProcessTest {\n+\n+    @Test\n+    @LoadGraphWith(MODERN)\n+    public void shouldExecutePeerPressure() throws Exception {\n+        if (g.getGraphComputer().get().features().supportsResultGraphPersistCombination(GraphComputer.ResultGraph.NEW, GraphComputer.Persist.VERTEX_PROPERTIES)) {\n+            final ComputerResult result = graph.compute(g.getGraphComputer().get().getClass()).program(PeerPressureVertexProgram.build().create(graph)).submit().get();\n+            final Set<Object> clusters = new HashSet<>();\n+            result.graph().traversal().V().forEachRemaining(v -> {\n+                assertEquals(4, v.keys().size()); // name, age/lang, voteStrength, cluster\n+                assertTrue(v.keys().contains(\"name\"));\n+                assertTrue(v.keys().contains(PeerPressureVertexProgram.VOTE_STRENGTH));\n+                assertTrue(v.keys().contains(PeerPressureVertexProgram.CLUSTER));\n+                assertEquals(1, IteratorUtils.count(v.values(\"name\")));\n+                assertEquals(1, IteratorUtils.count(v.values(PeerPressureVertexProgram.CLUSTER)));\n+                final Object cluster = v.value(PeerPressureVertexProgram.CLUSTER);\n+                clusters.add(cluster);\n+            });\n+            assertEquals(2, clusters.size());\n+            assertEquals(3, result.memory().getIteration());\n+            assertEquals(1, result.memory().asMap().size());\n+            assertTrue(result.memory().keys().contains(\"gremlin.peerPressureVertexProgram.voteToHalt\"));  // this is private in PeerPressureVertexProgram (and that is okay)\n+        }\n+    }\n+}\n\\ No newline at end of file",
                "changes": 63
            },
            {
                "status": "renamed",
                "additions": 1,
                "raw_url": "https://github.com/apache/tinkerpop/raw/b1b4058180a995fc9f7f465c2ec5ce5948c910dd/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/computer/ranking/pagerank/PageRankVertexProgramTest.java",
                "contents_url": "https://api.github.com/repos/apache/tinkerpop/contents/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/computer/ranking/pagerank/PageRankVertexProgramTest.java?ref=b1b4058180a995fc9f7f465c2ec5ce5948c910dd",
                "filename": "gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/computer/ranking/pagerank/PageRankVertexProgramTest.java",
                "previous_filename": "gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/computer/ranking/PageRankVertexProgramTest.java",
                "deletions": 1,
                "sha": "1e52fd07119b8237825152cd11cf21611799280c",
                "blob_url": "https://github.com/apache/tinkerpop/blob/b1b4058180a995fc9f7f465c2ec5ce5948c910dd/gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/computer/ranking/pagerank/PageRankVertexProgramTest.java",
                "patch": "@@ -16,7 +16,7 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-package org.apache.tinkerpop.gremlin.process.computer.ranking;\n+package org.apache.tinkerpop.gremlin.process.computer.ranking.pagerank;\n \n import org.apache.tinkerpop.gremlin.LoadGraphWith;\n import org.apache.tinkerpop.gremlin.process.AbstractGremlinProcessTest;",
                "changes": 2
            }
        ],
        "unit_tests": [
            "PageRankVertexProgramTest.java",
            "PeerPressureVertexProgramTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/computer/ranking/pagerank/PageRankVertexProgramTest.java",
        "buggy_files": [
            "gremlin-test/src/main/java/org/apache/tinkerpop/gremlin/process/ProcessComputerSuite.java",
            "CHANGELOG.asciidoc",
            "gremlin-groovy-test/src/main/java/org/apache/tinkerpop/gremlin/process/GroovyProcessComputerSuite.java",
            "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/ranking/pagerank/PageRankVertexProgram.java",
            "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/computer/clustering/peerpressure/PeerPressureVertexProgram.java"
        ],
        "fixed": true
    }
]