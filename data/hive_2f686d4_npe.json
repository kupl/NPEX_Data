[
    {
        "repo": "hive",
        "commit": "https://github.com/apache/hive/commit/2f686d4c0c20540079660de202c619e42ed5cd4f",
        "bug_id": "hive_2f686d4",
        "message": "HIVE-14617: NPE in UDF MapValues() if input is null (reviewed by Chao)",
        "parent": "https://github.com/apache/hive/commit/9343fee5d10ab5ab64692d9723a6c35e77adefc3",
        "patched_files": [
            "GenericUDFMapValues.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 5,
                "raw_url": "https://github.com/apache/hive/raw/2f686d4c0c20540079660de202c619e42ed5cd4f/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFMapValues.java",
                "contents_url": "https://api.github.com/repos/apache/hive/contents/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFMapValues.java?ref=2f686d4c0c20540079660de202c619e42ed5cd4f",
                "filename": "ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFMapValues.java",
                "deletions": 1,
                "sha": "3bd5864499ea7d9e4d6e8e7f2284ec96f445ad06",
                "blob_url": "https://github.com/apache/hive/blob/2f686d4c0c20540079660de202c619e42ed5cd4f/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFMapValues.java",
                "patch": "@@ -19,6 +19,7 @@\n package org.apache.hadoop.hive.ql.udf.generic;\n \n import java.util.ArrayList;\n+import java.util.Map;\n \n import org.apache.hadoop.hive.ql.exec.Description;\n import org.apache.hadoop.hive.ql.exec.UDFArgumentException;\n@@ -61,7 +62,10 @@ public ObjectInspector initialize(ObjectInspector[] arguments)\n   public Object evaluate(DeferredObject[] arguments) throws HiveException {\n     retArray.clear();\n     Object mapObj = arguments[0].get();\n-    retArray.addAll(mapOI.getMap(mapObj).values());\n+    Map<?, ?> map = mapOI.getMap(mapObj);\n+    if (map != null) {\n+      retArray.addAll(map.values());\n+    }\n     return retArray;\n   }\n ",
                "changes": 6
            },
            {
                "status": "added",
                "additions": 56,
                "raw_url": "https://github.com/apache/hive/raw/2f686d4c0c20540079660de202c619e42ed5cd4f/ql/src/test/org/apache/hadoop/hive/ql/udf/generic/TestGenericUDFMapValues.java",
                "contents_url": "https://api.github.com/repos/apache/hive/contents/ql/src/test/org/apache/hadoop/hive/ql/udf/generic/TestGenericUDFMapValues.java?ref=2f686d4c0c20540079660de202c619e42ed5cd4f",
                "filename": "ql/src/test/org/apache/hadoop/hive/ql/udf/generic/TestGenericUDFMapValues.java",
                "deletions": 0,
                "sha": "44676ed6f877666b89f2f3e7109a5d924597e901",
                "blob_url": "https://github.com/apache/hive/blob/2f686d4c0c20540079660de202c619e42ed5cd4f/ql/src/test/org/apache/hadoop/hive/ql/udf/generic/TestGenericUDFMapValues.java",
                "patch": "@@ -0,0 +1,56 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hive.ql.udf.generic;\n+\n+import java.io.IOException;\n+import java.util.Map;\n+\n+import org.apache.hadoop.hive.ql.metadata.HiveException;\n+import org.apache.hadoop.hive.ql.udf.generic.GenericUDF.DeferredJavaObject;\n+import org.apache.hadoop.hive.ql.udf.generic.GenericUDF.DeferredObject;\n+import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspector;\n+import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspectorFactory;\n+import org.apache.hadoop.hive.serde2.objectinspector.StandardListObjectInspector;\n+import org.apache.hadoop.hive.serde2.objectinspector.primitive.PrimitiveObjectInspectorFactory;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+public class TestGenericUDFMapValues {\n+\n+  @Test\n+  public void testNullMap() throws HiveException, IOException {\n+    ObjectInspector[] inputOIs = {\n+        ObjectInspectorFactory.getStandardMapObjectInspector(\n+            PrimitiveObjectInspectorFactory.writableStringObjectInspector,\n+            PrimitiveObjectInspectorFactory.writableStringObjectInspector),\n+    };\n+\n+    Map<String, String> input = null;\n+    DeferredObject[] args = {\n+        new DeferredJavaObject(input)\n+    };\n+\n+  GenericUDFMapValues udf = new GenericUDFMapValues();\n+    StandardListObjectInspector oi = (StandardListObjectInspector) udf.initialize(inputOIs);\n+    Object res = udf.evaluate(args);\n+    Assert.assertTrue(oi.getList(res).isEmpty());\n+    udf.close();\n+  }\n+\n+}",
                "changes": 56
            }
        ],
        "unit_tests": [
            "TestGenericUDFMapValues.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "ql/src/test/org/apache/hadoop/hive/ql/udf/generic/TestGenericUDFMapValues.java",
        "buggy_files": [
            "ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFMapValues.java"
        ],
        "fixed": true
    }
]