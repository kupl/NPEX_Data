{
    "tajo_0000793": {
        "bug_id": "tajo_0000793",
        "commit": "https://github.com/apache/tajo/commit/0000793a57b4504b3454adfa8ff7e02262e047a0",
        "file": [
            {
                "additions": 22,
                "blob_url": "https://github.com/apache/tajo/blob/0000793a57b4504b3454adfa8ff7e02262e047a0/engine/src/test/java/nta/cluster/TestClusterManager.java",
                "changes": 48,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/nta/cluster/TestClusterManager.java?ref=0000793a57b4504b3454adfa8ff7e02262e047a0",
                "deletions": 26,
                "filename": "engine/src/test/java/nta/cluster/TestClusterManager.java",
                "patch": "@@ -1,23 +1,6 @@\n package nta.cluster;\n \n-import static org.junit.Assert.assertEquals;\n-import static org.junit.Assert.assertNotNull;\n-\n-import java.io.IOException;\n-import java.net.URISyntaxException;\n-import java.util.ArrayList;\n-import java.util.Collection;\n-import java.util.Iterator;\n-import java.util.List;\n-import java.util.Random;\n-import java.util.Set;\n-\n-import nta.catalog.CatalogService;\n-import nta.catalog.Schema;\n-import nta.catalog.TCatUtil;\n-import nta.catalog.TableDesc;\n-import nta.catalog.TableDescImpl;\n-import nta.catalog.TableMeta;\n+import nta.catalog.*;\n import nta.catalog.proto.CatalogProtos.DataType;\n import nta.catalog.proto.CatalogProtos.StoreType;\n import nta.engine.*;\n@@ -37,7 +20,6 @@\n import nta.engine.query.GlobalPlanner;\n import nta.storage.CSVFile2;\n import nta.util.FileUtil;\n-\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.hadoop.fs.FSDataOutputStream;\n@@ -47,6 +29,12 @@\n import org.junit.BeforeClass;\n import org.junit.Test;\n \n+import java.io.IOException;\n+import java.util.*;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n public class TestClusterManager {\n   static final Log LOG = LogFactory.getLog(TestClusterManager.class);\n   \n@@ -163,26 +151,34 @@ public void testGetFragAndWorker() throws Exception {\n     workersCollection = cm.getOnlineWorkers().values();\n \n     List<Set<Fragment>> frags = new ArrayList<Set<Fragment>>();\n+\n     int i = 0;\n     for (List<String> workers : workersCollection) {\n       i+= workers.size();\n       for (String w : workers) {\n-        LOG.info(\">>>>> \" + cm.getFragbyWorker(w).size());\n-        frags.add(cm.getFragbyWorker(w));\n+        if (cm.getFragbyWorker(w) != null) {\n+          frags.add(cm.getFragbyWorker(w));\n+        }\n       }\n     }\n-    assertEquals(CLUST_NUM, i);\n \n-    for (int n = 0; n < CLUST_NUM; n++) {\n-      for (Fragment frag : frags.get(n)) {\n-        String workerName = cm.getWorkerbyFrag(frag);\n+    String prevName;\n+    for (Set<Fragment> fragmentSet : frags) {\n+      prevName = \"\";\n+      for (Fragment fragment : fragmentSet) {\n+        String workerName = cm.getWorkerbyFrag(fragment);\n         assertNotNull(workerName);\n+        if (!prevName.equals(\"\")) {\n+          assertEquals(prevName, workerName);\n+        } else {\n+          prevName = workerName;\n+        }\n       }\n     }\n   }\n \n   @Test\n-  public void testGetProperHost() throws Exception, URISyntaxException {\n+  public void testGetProperHost() throws Exception {\n     QueryAnalyzer analyzer = new QueryAnalyzer(local);\n     QueryContext.Factory factory = new QueryContext.Factory(local);\n     String query = \"select id, age, name from HostsByTable0\";",
                "raw_url": "https://github.com/apache/tajo/raw/0000793a57b4504b3454adfa8ff7e02262e047a0/engine/src/test/java/nta/cluster/TestClusterManager.java",
                "sha": "67a17f6f6258a4cb6db6c5749e2777b4a0f99556",
                "status": "modified"
            }
        ],
        "message": "TAJO-843: TestClusterManager\uc5d0\uc11c \ubc1c\uc0dd\ud558\ub294 NPE\n\nChange-Id: I6fd505cd5e6e2e64bcdb50541925e0914b491a0f\nReviewed-on: https://dbserver.korea.ac.kr/reviews/268\nTested-by:  Jenkins <build@dbserver.korea.ac.kr>\nReviewed-by:  jihoon <jihoonson@korea.ac.kr>",
        "parent": "https://github.com/apache/tajo/commit/d2a7ba9467d39b23db5f5c3232c7c38a7baaa646",
        "patched_files": [
            "ClusterManager.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestClusterManager.java"
        ]
    },
    "tajo_0781a38": {
        "bug_id": "tajo_0781a38",
        "commit": "https://github.com/apache/tajo/commit/0781a3864e85da47c215e4da26d7344cecb3656f",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/CHANGES.txt",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES.txt?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 0,
                "filename": "CHANGES.txt",
                "patch": "@@ -243,6 +243,8 @@ Release 0.8.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-581: Inline view on column partitioned table causes NPE. (hyunsik)\n+\n     TAJO-577: Support S3FileSystem split. (Yongjun Park via jihoon)\n \n     TAJO-568: Union query with the same alias names cause NPE. (hyunsik)",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/CHANGES.txt",
                "sha": "cd757b5c854842cf29bef7ba003b54d846c04f75",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/BasicLogicalPlanVisitor.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/BasicLogicalPlanVisitor.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 3,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/BasicLogicalPlanVisitor.java",
                "patch": "@@ -195,8 +195,10 @@ public RESULT visitJoin(CONTEXT context, LogicalPlan plan, LogicalPlan.QueryBloc\n   public RESULT visitUnion(CONTEXT context, LogicalPlan plan, LogicalPlan.QueryBlock block, UnionNode node,\n                            Stack<LogicalNode> stack) throws PlanningException {\n     stack.push(node);\n-    RESULT result = visit(context, plan, block, node.getLeftChild(), stack);\n-    visit(context, plan, block, node.getRightChild(), stack);\n+    LogicalPlan.QueryBlock leftBlock = plan.getBlock(node.getLeftChild());\n+    RESULT result = visit(context, plan, leftBlock, leftBlock.getRoot(), stack);\n+    LogicalPlan.QueryBlock rightBlock = plan.getBlock(node.getRightChild());\n+    visit(context, plan, rightBlock, rightBlock.getRoot(), stack);\n     stack.pop();\n     return result;\n   }\n@@ -225,7 +227,8 @@ public RESULT visitIntersect(CONTEXT context, LogicalPlan plan, LogicalPlan.Quer\n   public RESULT visitTableSubQuery(CONTEXT context, LogicalPlan plan, LogicalPlan.QueryBlock block,\n                                    TableSubQueryNode node, Stack<LogicalNode> stack) throws PlanningException {\n     stack.push(node);\n-    RESULT result = visit(context, plan, plan.getBlock(node.getSubQuery()), node.getSubQuery(), stack);\n+    LogicalPlan.QueryBlock childBlock = plan.getBlock(node.getSubQuery());\n+    RESULT result = visit(context, plan, childBlock, childBlock.getRoot(), new Stack<LogicalNode>());\n     stack.pop();\n     return result;\n   }",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/BasicLogicalPlanVisitor.java",
                "sha": "94e24823e6edb3deb609b785ad727a7d40a648ac",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalOptimizer.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalOptimizer.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalOptimizer.java",
                "patch": "@@ -89,8 +89,8 @@ private void optimizeJoinOrder(LogicalPlan plan, String blockName) throws Planni\n       FoundJoinOrder order = joinOrderAlgorithm.findBestOrder(plan, block,\n           joinGraphContext.joinGraph, joinGraphContext.relationsForProduct);\n       JoinNode newJoinNode = order.getOrderedJoin();\n+      JoinNode old = PlannerUtil.findTopNode(block.getRoot(), NodeType.JOIN);\n \n-      JoinNode old = block.getNode(NodeType.JOIN);\n       JoinTargetCollector collector = new JoinTargetCollector();\n       Set<Target> targets = new LinkedHashSet<Target>();\n       collector.visitJoin(targets, plan, block, old, new Stack<LogicalNode>());",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalOptimizer.java",
                "sha": "974dc60a5ae99b250d0fa8f5045637ac6cfbb200",
                "status": "modified"
            },
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalPlan.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalPlan.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalPlan.java",
                "patch": "@@ -180,6 +180,9 @@ public String getBlockNameByExpr(Expr expr) {\n   public String getNormalizedColumnName(QueryBlock block, ColumnReferenceExpr columnRef)\n       throws PlanningException {\n     Column found = resolveColumn(block, columnRef);\n+    if (found == null) {\n+      throw new NoSuchColumnException(columnRef.getCanonicalName());\n+    }\n     return found.getQualifiedName();\n   }\n \n@@ -242,6 +245,13 @@ public Column resolveColumn(QueryBlock block, ColumnReferenceExpr columnRef) thr\n \n       // Trying to find the column within the current block\n \n+      if (block.currentNode != null) {\n+        Column found = block.currentNode.getInSchema().getColumn(columnRef.getCanonicalName());\n+        if (found != null) {\n+          return found;\n+        }\n+      }\n+\n       if (block.getLatestNode() != null) {\n         Column found = block.getLatestNode().getOutSchema().getColumnByName(columnRef.getName());\n         if (found != null) {\n@@ -264,7 +274,7 @@ public Column resolveColumn(QueryBlock block, ColumnReferenceExpr columnRef) thr\n \n       // Trying to find columns from other relations in the current block\n       for (RelationNode rel : block.getRelations()) {\n-        Column found = rel.getOutSchema().getColumnByName(columnRef.getName());\n+        Column found = rel.getTableSchema().getColumnByName(columnRef.getName());\n         if (found != null) {\n           candidates.add(found);\n         }",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalPlan.java",
                "sha": "6afaaad7b067258ec0cefcca634164b8ae9afa06",
                "status": "modified"
            },
            {
                "additions": 41,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalPlanner.java",
                "changes": 63,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalPlanner.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 22,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalPlanner.java",
                "patch": "@@ -18,6 +18,7 @@\n \n package org.apache.tajo.engine.planner;\n \n+import com.google.common.annotations.VisibleForTesting;\n import com.google.common.base.Joiner;\n import com.google.common.collect.Lists;\n import org.apache.commons.logging.Log;\n@@ -72,14 +73,18 @@ public LogicalPlanner(CatalogService catalog) {\n     // transient data for each query block\n     QueryBlock queryBlock;\n \n-    public PlanContext(LogicalPlan plan, QueryBlock block) {\n+    boolean debugOrUnitTests;\n+\n+    public PlanContext(LogicalPlan plan, QueryBlock block, boolean debugOrUnitTests) {\n       this.plan = plan;\n       this.queryBlock = block;\n+      this.debugOrUnitTests = debugOrUnitTests;\n     }\n \n     public PlanContext(PlanContext context, QueryBlock block) {\n       this.plan = context.plan;\n       this.queryBlock = block;\n+      this.debugOrUnitTests = context.debugOrUnitTests;\n     }\n \n     public String toString() {\n@@ -95,21 +100,26 @@ public String toString() {\n    * @return A logical plan\n    */\n   public LogicalPlan createPlan(Expr expr) throws PlanningException {\n+    return createPlan(expr, false);\n+  }\n+\n+  @VisibleForTesting\n+  public LogicalPlan createPlan(Expr expr, boolean debug) throws PlanningException {\n \n     LogicalPlan plan = new LogicalPlan(this);\n \n     QueryBlock rootBlock = plan.newAndGetBlock(LogicalPlan.ROOT_BLOCK);\n     PreprocessContext preProcessorCtx = new PreprocessContext(plan, rootBlock);\n     preprocessor.visit(preProcessorCtx, new Stack<Expr>(), expr);\n \n-    PlanContext context = new PlanContext(plan, plan.getRootBlock());\n+    PlanContext context = new PlanContext(plan, plan.getRootBlock(), debug);\n     LogicalNode topMostNode = this.visit(context, new Stack<Expr>(), expr);\n \n     // Add Root Node\n     LogicalRootNode root = new LogicalRootNode(plan.newPID());\n     root.setInSchema(topMostNode.getOutSchema());\n-    root.setOutSchema(topMostNode.getOutSchema());\n     root.setChild(topMostNode);\n+    root.setOutSchema(topMostNode.getOutSchema());\n     plan.getRootBlock().setRoot(root);\n \n     return plan;\n@@ -205,22 +215,23 @@ public LogicalNode visitProjection(PlanContext context, Stack<Expr> stack, Proje\n \n     // Set ProjectionNode\n     projectionNode = context.queryBlock.getNodeFromExpr(projection);\n-    projectionNode.setTargets(targets);\n-    projectionNode.setOutSchema(PlannerUtil.targetToSchema(projectionNode.getTargets()));\n     projectionNode.setInSchema(child.getOutSchema());\n+    projectionNode.setTargets(targets);\n     projectionNode.setChild(child);\n \n     if (projection.isDistinct() && block.hasNode(NodeType.GROUP_BY)) {\n       throw new VerifyException(\"Cannot support grouping and distinct at the same time yet\");\n     } else {\n       if (projection.isDistinct()) {\n-        insertDistinctOperator(context, projectionNode, child);\n+        insertDistinctOperator(context, projectionNode, child, stack);\n       }\n     }\n \n     // It's for debugging and unit tests purpose.\n     // It sets raw targets, all of them are raw expressions instead of references.\n-    setRawTargets(context, targets, referenceNames, projection);\n+    if (context.debugOrUnitTests) {\n+      setRawTargets(context, targets, referenceNames, projection);\n+    }\n \n     verifyProjectedFields(block, projectionNode);\n     return projectionNode;\n@@ -246,16 +257,21 @@ private void setRawTargets(PlanContext context, Target[] targets, String[] refer\n     }\n   }\n \n-  private void insertDistinctOperator(PlanContext context, ProjectionNode projectionNode, LogicalNode child) {\n+  private void insertDistinctOperator(PlanContext context, ProjectionNode projectionNode, LogicalNode child,\n+                                      Stack<Expr> stack) throws PlanningException {\n     LogicalPlan plan = context.plan;\n+    QueryBlock block = context.queryBlock;\n \n     Schema outSchema = projectionNode.getOutSchema();\n     GroupbyNode dupRemoval = new GroupbyNode(plan.newPID());\n-    dupRemoval.setGroupingColumns(outSchema.toArray());\n-    dupRemoval.setTargets(PlannerUtil.schemaToTargets(outSchema));\n-    dupRemoval.setInSchema(projectionNode.getInSchema());\n-    dupRemoval.setOutSchema(outSchema);\n     dupRemoval.setChild(child);\n+    dupRemoval.setInSchema(projectionNode.getInSchema());\n+    dupRemoval.setTargets(PlannerUtil.schemaToTargets(outSchema));\n+    dupRemoval.setGroupingColumns(outSchema.toArray());\n+\n+    block.registerNode(dupRemoval);\n+    postHook(context, stack, null, dupRemoval);\n+\n     projectionNode.setChild(dupRemoval);\n     projectionNode.setInSchema(dupRemoval.getOutSchema());\n   }\n@@ -345,7 +361,7 @@ private EvalExprNode buildPlanForNoneFromStatement(PlanContext context, Stack<Ex\n     return targets;\n   }\n \n-  private static void verifyProjectedFields(QueryBlock block, Projectable projectable) throws PlanningException {\n+  public static void verifyProjectedFields(QueryBlock block, Projectable projectable) throws PlanningException {\n     if (projectable instanceof ProjectionNode && block.hasNode(NodeType.GROUP_BY)) {\n       for (Target target : projectable.getTargets()) {\n         Set<Column> columns = EvalTreeUtil.findDistinctRefColumns(target.getEvalTree());\n@@ -403,6 +419,9 @@ private LogicalNode insertGroupbyNode(PlanContext context, LogicalNode child, St\n     LogicalPlan plan = context.plan;\n     QueryBlock block = context.queryBlock;\n     GroupbyNode groupbyNode = new GroupbyNode(plan.newPID());\n+    groupbyNode.setChild(child);\n+    groupbyNode.setInSchema(child.getOutSchema());\n+\n     groupbyNode.setGroupingColumns(new Column[] {});\n \n     Set<String> aggEvalNames = new LinkedHashSet<String>();\n@@ -421,12 +440,11 @@ private LogicalNode insertGroupbyNode(PlanContext context, LogicalNode child, St\n       } catch (VerifyException ve) {\n       }\n     }\n+\n     groupbyNode.setDistinct(includeDistinctFunction);\n     groupbyNode.setAggFunctions(aggEvals.toArray(new AggregationFunctionCallEval[aggEvals.size()]));\n     Target [] targets = ProjectionPushDownRule.buildGroupByTarget(groupbyNode, aggEvalNames.toArray(new String[aggEvalNames.size()]));\n     groupbyNode.setTargets(targets);\n-    groupbyNode.setChild(child);\n-    groupbyNode.setInSchema(child.getOutSchema());\n \n     // this inserted group-by node doesn't pass through preprocessor. So manually added.\n     block.registerNode(groupbyNode);\n@@ -515,9 +533,10 @@ public SortNode visitSort(PlanContext context, Stack<Expr> stack, Sort sort) thr\n     ////////////////////////////////////////////////////////\n \n     SortNode sortNode = block.getNodeFromExpr(sort);\n+    sortNode.setChild(child);\n     sortNode.setInSchema(child.getOutSchema());\n     sortNode.setOutSchema(child.getOutSchema());\n-    sortNode.setChild(child);\n+\n \n     // Building sort keys\n     Column column;\n@@ -557,9 +576,9 @@ public LogicalNode visitHaving(PlanContext context, Stack<Expr> stack, Having ex\n     ////////////////////////////////////////////////////////\n \n     HavingNode having = new HavingNode(context.plan.newPID());\n+    having.setChild(child);\n     having.setInSchema(child.getOutSchema());\n     having.setOutSchema(child.getOutSchema());\n-    having.setChild(child);\n \n     EvalNode havingCondition;\n     if (block.namedExprsMgr.isResolved(referName)) {\n@@ -861,6 +880,10 @@ private LogicalNode createCartesianProduct(PlanContext context, LogicalNode left\n     LogicalPlan plan = context.plan;\n     QueryBlock block = context.queryBlock;\n \n+    Schema merged = SchemaUtil.merge(left.getOutSchema(), right.getOutSchema());\n+    JoinNode join = new JoinNode(plan.newPID(), JoinType.CROSS, left, right);\n+    join.setInSchema(merged);\n+\n     EvalNode evalNode;\n     List<Expr> newlyEvaluatedExprs = TUtil.newList();\n     for (Iterator<NamedExpr> it = block.namedExprsMgr.getUnresolvedExprs(); it.hasNext();) {\n@@ -874,15 +897,11 @@ private LogicalNode createCartesianProduct(PlanContext context, LogicalNode left\n       } catch (VerifyException ve) {}\n     }\n \n-    Schema merged = SchemaUtil.merge(left.getOutSchema(), right.getOutSchema());\n     List<Target> targets = TUtil.newList(PlannerUtil.schemaToTargets(merged));\n     for (Expr newAddedExpr : newlyEvaluatedExprs) {\n       targets.add(block.namedExprsMgr.getTarget(newAddedExpr, true));\n     }\n-\n-    JoinNode join = new JoinNode(plan.newPID(), JoinType.CROSS, left, right);\n     join.setTargets(targets.toArray(new Target[targets.size()]));\n-    join.setInSchema(merged);\n     return join;\n   }\n \n@@ -1092,8 +1111,8 @@ private LogicalNode buildSetPlan(PlanContext context, Stack<Expr> stack, SetOper\n     Target [] leftStrippedTargets = PlannerUtil.stripTarget(\n         PlannerUtil.schemaToTargets(leftBlock.getRoot().getOutSchema()));\n \n-    Schema outSchema = PlannerUtil.targetToSchema(leftStrippedTargets);\n     setOp.setInSchema(leftChild.getOutSchema());\n+    Schema outSchema = PlannerUtil.targetToSchema(leftStrippedTargets);\n     setOp.setOutSchema(outSchema);\n \n     return setOp;",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalPlanner.java",
                "sha": "d929218498c681b52f95e72d4435cf6ef395b9c4",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/PlannerUtil.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/PlannerUtil.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/PlannerUtil.java",
                "patch": "@@ -223,7 +223,7 @@ public static void replaceNode(LogicalNode plan, LogicalNode newNode, NodeType t\n     Preconditions.checkNotNull(type);\n     \n     LogicalNodeFinder finder = new LogicalNodeFinder(type);\n-    node.postOrder(finder);\n+    node.preOrder(finder);\n     \n     if (finder.getFoundNodes().size() == 0) {\n       return null;",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/PlannerUtil.java",
                "sha": "bd9001c679f7d9b0914760c83ca10891c0ce0fd4",
                "status": "modified"
            },
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/global/GlobalPlanner.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/global/GlobalPlanner.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 4,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/global/GlobalPlanner.java",
                "patch": "@@ -692,9 +692,9 @@ public LogicalNode visitGroupBy(GlobalPlanContext context, LogicalPlan plan, Log\n \n       ExecutionBlock childBlock = context.execBlockMap.remove(child.getPID());\n       ExecutionBlock newExecBlock = buildGroupBy(context, childBlock, node);\n-      context.execBlockMap.put(node.getPID(), newExecBlock);\n+      context.execBlockMap.put(newExecBlock.getPlan().getPID(), newExecBlock);\n \n-      return node;\n+      return newExecBlock.getPlan();\n     }\n \n     @Override\n@@ -730,8 +730,11 @@ public LogicalNode visitJoin(GlobalPlanContext context, LogicalPlan plan, Logica\n     public LogicalNode visitUnion(GlobalPlanContext context, LogicalPlan plan, LogicalPlan.QueryBlock queryBlock,\n                                   UnionNode node, Stack<LogicalNode> stack) throws PlanningException {\n       stack.push(node);\n-      LogicalNode leftChild = visit(context, plan, queryBlock, node.getLeftChild(), stack);\n-      LogicalNode rightChild = visit(context, plan, queryBlock, node.getRightChild(), stack);\n+      LogicalPlan.QueryBlock leftQueryBlock = plan.getBlock(node.getLeftChild());\n+      LogicalNode leftChild = visit(context, plan, leftQueryBlock, leftQueryBlock.getRoot(), stack);\n+\n+      LogicalPlan.QueryBlock rightQueryBlock = plan.getBlock(node.getRightChild());\n+      LogicalNode rightChild = visit(context, plan, rightQueryBlock, rightQueryBlock.getRoot(), stack);\n       stack.pop();\n \n       List<ExecutionBlock> unionBlocks = Lists.newArrayList();\n@@ -801,6 +804,7 @@ public LogicalNode visitTableSubQuery(GlobalPlanContext context, LogicalPlan pla\n                                           LogicalPlan.QueryBlock queryBlock,\n                                           TableSubQueryNode node, Stack<LogicalNode> stack) throws PlanningException {\n       LogicalNode child = super.visitTableSubQuery(context, plan, queryBlock, node, stack);\n+      node.setSubQuery(child);\n \n       ExecutionBlock currentBlock = context.execBlockMap.remove(child.getPID());\n ",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/global/GlobalPlanner.java",
                "sha": "cb2ac1536791626ae151dc5ac62e5d293c90813d",
                "status": "modified"
            },
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/logical/GroupbyNode.java",
                "changes": 20,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/logical/GroupbyNode.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 8,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/logical/GroupbyNode.java",
                "patch": "@@ -181,16 +181,20 @@ public PlanString getPlanString() {\n \n     planStr.appendTitle(sb.toString());\n \n-    sb = new StringBuilder();\n-    sb.append(\"(\");\n-    for (int j = 0; j < aggrFunctions.length; j++) {\n-      sb.append(aggrFunctions[j]);\n-      if(j < aggrFunctions.length - 1) {\n-        sb.append(\",\");\n+    // there can be no aggregation functions\n+    if (hasAggFunctions()) {\n+      sb = new StringBuilder();\n+      sb.append(\"(\");\n+\n+      for (int j = 0; j < aggrFunctions.length; j++) {\n+        sb.append(aggrFunctions[j]);\n+        if(j < aggrFunctions.length - 1) {\n+          sb.append(\",\");\n+        }\n       }\n+      sb.append(\")\");\n+      planStr.appendExplain(\"exprs: \").appendExplain(sb.toString());\n     }\n-    sb.append(\")\");\n-    planStr.appendExplain(\"exprs: \").appendExplain(sb.toString());\n \n     sb = new StringBuilder(\"target list: \");\n     for (int i = 0; i < targets.length; i++) {",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/logical/GroupbyNode.java",
                "sha": "58fa6e294b83f7282140a7d8b03cfe3c2a2eb178",
                "status": "modified"
            },
            {
                "additions": 13,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/logical/TableSubQueryNode.java",
                "changes": 15,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/logical/TableSubQueryNode.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 2,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/logical/TableSubQueryNode.java",
                "patch": "@@ -54,14 +54,25 @@ public String getCanonicalName() {\n \n   @Override\n   public Schema getTableSchema() {\n-    return getOutSchema();\n+    // an output schema can be determined by targets. So, an input schema of\n+    // TableSubQueryNode is only eligible for table schema.\n+    //\n+    // TODO - but, a derived table can have column alias. For that, we should improve here.\n+    //\n+    // example) select * from (select col1, col2, col3 from t1) view (c1, c2);\n+\n+    return getInSchema();\n   }\n \n   public void setSubQuery(LogicalNode node) {\n     this.subQuery = node;\n     setInSchema((Schema) this.subQuery.getOutSchema().clone());\n     getInSchema().setQualifier(this.tableName);\n-    setOutSchema((Schema) this.subQuery.getOutSchema().clone());\n+    if (hasTargets()) {\n+      setOutSchema(PlannerUtil.targetToSchema(targets));\n+    } else {\n+      setOutSchema((Schema) this.subQuery.getOutSchema().clone());\n+    }\n     getOutSchema().setQualifier(this.tableName);\n   }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/logical/TableSubQueryNode.java",
                "sha": "01d17de7c6a41584fdb9fe65bb4056c60fb8058a",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/logical/join/GreedyHeuristicJoinOrderAlgorithm.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/logical/join/GreedyHeuristicJoinOrderAlgorithm.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/logical/join/GreedyHeuristicJoinOrderAlgorithm.java",
                "patch": "@@ -62,9 +62,14 @@ public FoundJoinOrder findBestOrder(LogicalPlan plan, LogicalPlan.QueryBlock blo\n \n       latestJoin = createJoinNode(plan, bestPair);\n       remainRelations.add(latestJoin);\n+\n+      // all logical nodes should be registered to corresponding blocks\n+      block.registerNode(latestJoin);\n     }\n \n     JoinNode joinTree = (JoinNode) remainRelations.iterator().next();\n+    // all generated nodes should be registered to corresponding blocks\n+    block.registerNode(joinTree);\n     return new FoundJoinOrder(joinTree, getCost(joinTree));\n   }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/logical/join/GreedyHeuristicJoinOrderAlgorithm.java",
                "sha": "428152bfa935e822cdacd76898d8c361f8c4be66",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/rewrite/PartitionedTableRewriter.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/rewrite/PartitionedTableRewriter.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/rewrite/PartitionedTableRewriter.java",
                "patch": "@@ -357,7 +357,13 @@ public Object visitScan(Object object, LogicalPlan plan, LogicalPlan.QueryBlock\n         PartitionedTableScanNode rewrittenScanNode =\n             new PartitionedTableScanNode(plan.newPID(), scanNode, filteredPaths);\n         updateTableStat(rewrittenScanNode);\n-        PlannerUtil.replaceNode(plan, stack.peek(), scanNode, rewrittenScanNode);\n+\n+        // if it is topmost node, set it as the rootnode of this block.\n+        if (stack.empty()) {\n+          block.setRoot(rewrittenScanNode);\n+        } else {\n+          PlannerUtil.replaceNode(plan, stack.peek(), scanNode, rewrittenScanNode);\n+        }\n       } catch (IOException e) {\n         throw new PlanningException(\"Partitioned Table Rewrite Failed: \\n\" + e.getMessage());\n       }",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/rewrite/PartitionedTableRewriter.java",
                "sha": "e5f7fb40414e0b2e2e40bccebe24069ee4d9301b",
                "status": "modified"
            },
            {
                "additions": 53,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/rewrite/ProjectionPushDownRule.java",
                "changes": 97,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/rewrite/ProjectionPushDownRule.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 44,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/rewrite/ProjectionPushDownRule.java",
                "patch": "@@ -304,45 +304,50 @@ public LogicalNode visitProjection(Context context, LogicalPlan plan, LogicalPla\n \n     // Removing ProjectionNode\n     // TODO - Consider INSERT and CTAS statement, and then remove the check of stack.empty.\n-    if (resolvingCount == 0 && !stack.empty() &&\n-        PlannerUtil.targetToSchema(finalTargets).equals(child.getOutSchema())) {\n-      LogicalNode parentNode = stack.peek();\n-      switch (parentNode.getType()) {\n-      case ROOT:\n-        LogicalRootNode rootNode = (LogicalRootNode) parentNode;\n-        rootNode.setChild(child);\n-        rootNode.setInSchema(child.getOutSchema());\n-        rootNode.setOutSchema(child.getOutSchema());\n-        break;\n-      case TABLE_SUBQUERY:\n-        TableSubQueryNode tableSubQueryNode = (TableSubQueryNode) parentNode;\n-        tableSubQueryNode.setSubQuery(child);\n-        break;\n-      case STORE:\n-        StoreTableNode storeTableNode = (StoreTableNode) parentNode;\n-        storeTableNode.setChild(child);\n-        storeTableNode.setInSchema(child.getOutSchema());\n-        break;\n-      case INSERT:\n-        InsertNode insertNode = (InsertNode) parentNode;\n-        insertNode.setSubQuery(child);\n-        break;\n-      case CREATE_TABLE:\n-        CreateTableNode createTableNode = (CreateTableNode) parentNode;\n-        createTableNode.setChild(child);\n-        createTableNode.setInSchema(child.getOutSchema());\n-        createTableNode.setInSchema(child.getOutSchema());\n-        break;\n-      default:\n-        throw new PlanningException(\"Unexpected Parent Node: \" + parentNode.getType());\n+    if (resolvingCount == 0 && PlannerUtil.targetToSchema(finalTargets).equals(child.getOutSchema())) {\n+      if (stack.empty()) {\n+        // if it is topmost, set it as the root of this block.\n+        block.setRoot(child);\n+      } else {\n+        LogicalNode parentNode = stack.peek();\n+        switch (parentNode.getType()) {\n+        case ROOT:\n+          LogicalRootNode rootNode = (LogicalRootNode) parentNode;\n+          rootNode.setChild(child);\n+          rootNode.setInSchema(child.getOutSchema());\n+          rootNode.setOutSchema(child.getOutSchema());\n+          break;\n+        case TABLE_SUBQUERY:\n+          TableSubQueryNode tableSubQueryNode = (TableSubQueryNode) parentNode;\n+          tableSubQueryNode.setSubQuery(child);\n+          break;\n+        case STORE:\n+          StoreTableNode storeTableNode = (StoreTableNode) parentNode;\n+          storeTableNode.setChild(child);\n+          storeTableNode.setInSchema(child.getOutSchema());\n+          break;\n+        case INSERT:\n+          InsertNode insertNode = (InsertNode) parentNode;\n+          insertNode.setSubQuery(child);\n+          break;\n+        case CREATE_TABLE:\n+          CreateTableNode createTableNode = (CreateTableNode) parentNode;\n+          createTableNode.setChild(child);\n+          createTableNode.setInSchema(child.getOutSchema());\n+          break;\n+        default:\n+          throw new PlanningException(\"Unexpected Parent Node: \" + parentNode.getType());\n+        }\n+        plan.addHistory(\"ProjectionNode is eliminated.\");\n       }\n-      plan.addHistory(\"ProjectionNode is eliminated.\");\n+\n+      return child;\n+\n     } else {\n       node.setInSchema(child.getOutSchema());\n       node.setTargets(finalTargets.toArray(new Target[finalTargets.size()]));\n+      return node;\n     }\n-\n-    return node;\n   }\n \n   public LogicalNode visitLimit(Context context, LogicalPlan plan, LogicalPlan.QueryBlock block, LimitNode node,\n@@ -382,6 +387,9 @@ public LogicalNode visitHaving(Context context, LogicalPlan plan, LogicalPlan.Qu\n \n     LogicalNode child = super.visitHaving(newContext, plan, block, node, stack);\n \n+    node.setInSchema(child.getOutSchema());\n+    node.setOutSchema(child.getOutSchema());\n+\n     Target target = context.targetListMgr.getTarget(referenceName);\n     if (newContext.targetListMgr.isResolved(referenceName)) {\n       node.setQual(new FieldEval(target.getNamedColumn()));\n@@ -390,8 +398,6 @@ public LogicalNode visitHaving(Context context, LogicalPlan plan, LogicalPlan.Qu\n       newContext.targetListMgr.resolve(target);\n     }\n \n-    node.setInSchema(child.getOutSchema());\n-    node.setOutSchema(child.getOutSchema());\n     return node;\n   }\n \n@@ -428,6 +434,8 @@ public LogicalNode visitGroupBy(Context context, LogicalPlan plan, LogicalPlan.Q\n     // visit a child node\n     LogicalNode child = super.visitGroupBy(newContext, plan, block, node, stack);\n \n+    node.setInSchema(child.getOutSchema());\n+\n     if (groupingKeyNum > 0) {\n       // Restoring grouping key columns\n       final Column [] groupingColumns = new Column[groupingKeyNum];\n@@ -466,7 +474,6 @@ public LogicalNode visitGroupBy(Context context, LogicalPlan plan, LogicalPlan.Q\n         node.setAggFunctions(aggEvals);\n       }\n     }\n-    node.setInSchema(child.getOutSchema());\n     Target [] targets = buildGroupByTarget(node, aggEvalNames);\n     node.setTargets(targets);\n \n@@ -501,6 +508,9 @@ public LogicalNode visitFilter(Context context, LogicalPlan plan, LogicalPlan.Qu\n \n     LogicalNode child = super.visitFilter(newContext, plan, block, node, stack);\n \n+    node.setInSchema(child.getOutSchema());\n+    node.setOutSchema(child.getOutSchema());\n+\n     Target target = context.targetListMgr.getTarget(referenceName);\n     if (newContext.targetListMgr.isResolved(referenceName)) {\n       node.setQual(new FieldEval(target.getNamedColumn()));\n@@ -509,9 +519,6 @@ public LogicalNode visitFilter(Context context, LogicalPlan plan, LogicalPlan.Qu\n       newContext.targetListMgr.resolve(target);\n     }\n \n-    node.setInSchema(child.getOutSchema());\n-    node.setOutSchema(child.getOutSchema());\n-\n     return node;\n   }\n \n@@ -540,6 +547,7 @@ public LogicalNode visitJoin(Context context, LogicalPlan plan, LogicalPlan.Quer\n     stack.pop();\n \n     Schema merged = SchemaUtil.merge(left.getOutSchema(), right.getOutSchema());\n+\n     node.setInSchema(merged);\n \n     if (node.hasJoinQual()) {\n@@ -676,8 +684,8 @@ public LogicalNode visitUnion(Context context, LogicalPlan plan, LogicalPlan.Que\n         rightBlock.getName()));\n \n     stack.push(node);\n-    visit(leftContext, plan, leftBlock, node.getLeftChild(), new Stack<LogicalNode>());\n-    visit(rightContext, plan, rightBlock, node.getRightChild(), new Stack<LogicalNode>());\n+    visit(leftContext, plan, leftBlock, leftBlock.getRoot(), new Stack<LogicalNode>());\n+    visit(rightContext, plan, rightBlock, rightBlock.getRoot(), new Stack<LogicalNode>());\n     stack.pop();\n     return node;\n   }\n@@ -751,7 +759,8 @@ public LogicalNode visitTableSubQuery(Context upperContext, LogicalPlan plan, Lo\n                                    TableSubQueryNode node, Stack<LogicalNode> stack) throws PlanningException {\n     Context childContext = new Context(plan, upperContext.requiredSet);\n     stack.push(node);\n-    LogicalNode child = visit(childContext, plan, plan.getBlock(node.getSubQuery()), node.getSubQuery(), stack);\n+    LogicalNode child = super.visitTableSubQuery(childContext, plan, block, node, stack);\n+    node.setSubQuery(child);\n     stack.pop();\n \n     Context newContext = new Context(upperContext);\n@@ -779,7 +788,7 @@ public LogicalNode visitTableSubQuery(Context upperContext, LogicalPlan plan, Lo\n     }\n \n     node.setTargets(projectedTargets.toArray(new Target[projectedTargets.size()]));\n-\n+    LogicalPlanner.verifyProjectedFields(block, node);\n     return node;\n   }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/rewrite/ProjectionPushDownRule.java",
                "sha": "7512f23533cce31a4f87e5badf0296da71806124",
                "status": "modified"
            },
            {
                "additions": 16,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/QueryTestCaseBase.java",
                "changes": 23,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/QueryTestCaseBase.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 7,
                "filename": "tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/QueryTestCaseBase.java",
                "patch": "@@ -25,6 +25,7 @@\n import org.apache.tajo.algebra.DropTable;\n import org.apache.tajo.algebra.Expr;\n import org.apache.tajo.algebra.OpType;\n+import org.apache.tajo.catalog.CatalogService;\n import org.apache.tajo.client.TajoClient;\n import org.apache.tajo.conf.TajoConf;\n import org.apache.tajo.engine.parser.SQLAnalyzer;\n@@ -117,9 +118,11 @@\n  */\n public class QueryTestCaseBase {\n \n-  protected static final TpchTestBase testingCluster;\n+  protected static final TpchTestBase testBase;\n+  protected static final TajoTestingCluster testingCluster;\n   protected static TajoConf conf;\n   protected static TajoClient client;\n+  protected static CatalogService catalog;\n   protected static SQLAnalyzer sqlParser = new SQLAnalyzer();\n \n   /** the base path of dataset directories */\n@@ -130,8 +133,10 @@\n   protected static final Path resultBasePath;\n \n   static {\n-    testingCluster = TpchTestBase.getInstance();\n-    conf = testingCluster.getTestingCluster().getConfiguration();\n+    testBase = TpchTestBase.getInstance();\n+    testingCluster = testBase.getTestingCluster();\n+    conf = testBase.getTestingCluster().getConfiguration();\n+    catalog = testBase.getTestingCluster().getMaster().getCatalog();\n     URL datasetBaseURL = ClassLoader.getSystemResource(\"dataset\");\n     datasetBasePath = new Path(datasetBaseURL.toString());\n     URL queryBaseURL = ClassLoader.getSystemResource(\"queries\");\n@@ -152,7 +157,7 @@\n \n   @BeforeClass\n   public static void setUpClass() throws IOException {\n-    conf = testingCluster.getTestingCluster().getConfiguration();\n+    conf = testBase.getTestingCluster().getConfiguration();\n     client = new TajoClient(conf);\n   }\n \n@@ -173,6 +178,10 @@ public void setUp() {\n     currentDatasetPath = new Path(datasetBasePath, className);\n   }\n \n+  protected ResultSet execute(String sql) throws Exception {\n+    return testBase.execute(sql);\n+  }\n+\n   /**\n    * Execute a query contained in the file located in src/test/resources/results/<i>ClassName</i>/<i>MethodName</i>.\n    * <i>ClassName</i> and <i>MethodName</i> will be replaced by actual executed class and methods.\n@@ -192,9 +201,9 @@ public ResultSet executeQuery() throws Exception {\n    */\n   public ResultSet executeQuery(String queryFileName) throws Exception {\n     Path queryFilePath = getQueryFilePath(queryFileName);\n-    FileSystem fs = currentQueryPath.getFileSystem(testingCluster.getTestingCluster().getConfiguration());\n+    FileSystem fs = currentQueryPath.getFileSystem(testBase.getTestingCluster().getConfiguration());\n     assertTrue(queryFilePath.toString() + \" existence check\", fs.exists(queryFilePath));\n-    ResultSet result = testingCluster.execute(FileUtil.readTextFile(new File(queryFilePath.toUri())));\n+    ResultSet result = testBase.execute(FileUtil.readTextFile(new File(queryFilePath.toUri())));\n     assertNotNull(\"Query succeeded test\", result);\n     return result;\n   }\n@@ -228,7 +237,7 @@ public final void assertResultSet(ResultSet result, String resultFileName) throw\n    * @param result Query result to be compared.\n    */\n   public final void assertResultSet(String message, ResultSet result, String resultFileName) throws IOException {\n-    FileSystem fs = currentQueryPath.getFileSystem(testingCluster.getTestingCluster().getConfiguration());\n+    FileSystem fs = currentQueryPath.getFileSystem(testBase.getTestingCluster().getConfiguration());\n     Path resultFile = getResultFile(resultFileName);\n     assertTrue(resultFile.toString() + \" existence check\", fs.exists(resultFile));\n     try {",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/QueryTestCaseBase.java",
                "sha": "24a4237ed3c46c87ee480e36a40402102dfe5531",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/ExprTestBase.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/ExprTestBase.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/ExprTestBase.java",
                "patch": "@@ -76,7 +76,7 @@ private static void assertJsonSerDer(EvalNode expr) {\n \n   private static Target[] getRawTargets(String query) throws PlanningException {\n     Expr expr = analyzer.parse(query);\n-    LogicalPlan plan = planner.createPlan(expr);\n+    LogicalPlan plan = planner.createPlan(expr, true);\n     Target [] targets = plan.getRootBlock().getRawTargets();\n     if (targets == null) {\n       throw new PlanningException(\"Wrong query statement or query plan: \" + query);",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/ExprTestBase.java",
                "sha": "76bc9e87f24592923f79fe7d2135eefcf69dbabe",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/TestEvalTreeUtil.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/TestEvalTreeUtil.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 2,
                "filename": "tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/TestEvalTreeUtil.java",
                "patch": "@@ -189,7 +189,7 @@ public final void testGetSchemaFromTargets() throws InternalException {\n   @Test\n   public final void testGetContainExprs() throws CloneNotSupportedException, PlanningException {\n     Expr expr = analyzer.parse(QUERIES[1]);\n-    LogicalPlan plan = planner.createPlan(expr);\n+    LogicalPlan plan = planner.createPlan(expr, true);\n     Target [] targets = plan.getRootBlock().getRawTargets();\n     Column col1 = new Column(\"people.score\", TajoDataTypes.Type.INT4);\n     Collection<EvalNode> exprs =\n@@ -267,7 +267,7 @@ public final void testSimplify() throws PlanningException {\n     assertTrue(7.0d == node.eval(null, null).asFloat8());\n \n     Expr expr = analyzer.parse(QUERIES[1]);\n-    LogicalPlan plan = planner.createPlan(expr);\n+    LogicalPlan plan = planner.createPlan(expr, true);\n     targets = plan.getRootBlock().getRawTargets();\n     Column col1 = new Column(\"people.score\", TajoDataTypes.Type.INT4);\n     Collection<EvalNode> exprs =",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/TestEvalTreeUtil.java",
                "sha": "c25afc87fd2bfc1b626e41f3bf285da35f80ef34",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestCTASQuery.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestCTASQuery.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 3,
                "filename": "tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestCTASQuery.java",
                "patch": "@@ -49,7 +49,7 @@ public final void testCtasWithoutTableDefinition() throws Exception {\n     ResultSet res = executeQuery();\n \n     res.close();\n-    CatalogService catalog = testingCluster.getTestingCluster().getMaster().getCatalog();\n+    CatalogService catalog = testBase.getTestingCluster().getMaster().getCatalog();\n     TableDesc desc = catalog.getTableDesc(\"testCtasWithoutTableDefinition\");\n     assertTrue(catalog.existsTable(\"testCtasWithoutTableDefinition\"));\n \n@@ -58,7 +58,7 @@ public final void testCtasWithoutTableDefinition() throws Exception {\n     assertEquals(partitionDesc.getPartitionType(), CatalogProtos.PartitionType.COLUMN);\n     assertEquals(\"key\", partitionDesc.getExpressionSchema().getColumns().get(0).getColumnName());\n \n-    FileSystem fs = FileSystem.get(testingCluster.getTestingCluster().getConfiguration());\n+    FileSystem fs = FileSystem.get(testBase.getTestingCluster().getConfiguration());\n     Path path = desc.getPath();\n     assertTrue(fs.isDirectory(path));\n     assertTrue(fs.isDirectory(new Path(path.toUri() + \"/key=17.0\")));\n@@ -89,7 +89,7 @@ public final void testCtasWithColumnedPartition() throws Exception {\n     ResultSet res = executeQuery();\n     res.close();\n \n-    TajoTestingCluster cluster = testingCluster.getTestingCluster();\n+    TajoTestingCluster cluster = testBase.getTestingCluster();\n     CatalogService catalog = cluster.getMaster().getCatalog();\n     TableDesc desc = catalog.getTableDesc(\"testCtasWithColumnedPartition\");\n     assertTrue(catalog.existsTable(\"testCtasWithColumnedPartition\"));",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestCTASQuery.java",
                "sha": "ede0d584cfa9350d820e0ab64e3d1cf65b95b170",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestJoinQuery.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestJoinQuery.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestJoinQuery.java",
                "patch": "@@ -65,7 +65,7 @@ public final void testWhereClauseJoin4() throws Exception {\n   @Test\n   public final void testWhereClauseJoin5() throws Exception {\n     ResultSet res = executeQuery();\n-    System.out.println(resultSetToString(res));\n+    assertResultSet(res);\n     cleanupQuery(res);\n   }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestJoinQuery.java",
                "sha": "dc951cfc5923f8cf7cc91085538e3064dbdeca50",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestSelectQuery.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestSelectQuery.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 2,
                "filename": "tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestSelectQuery.java",
                "patch": "@@ -190,10 +190,10 @@ public final void testNotInClause() throws Exception {\n \n   @Test\n   public final void testCreateAfterSelect() throws Exception {\n-    ResultSet res = testingCluster.execute(\n+    ResultSet res = testBase.execute(\n         \"create table orderkeys as select l_orderkey from lineitem\");\n     res.close();\n-    TajoTestingCluster cluster = testingCluster.getTestingCluster();\n+    TajoTestingCluster cluster = testBase.getTestingCluster();\n     CatalogService catalog = cluster.getMaster().getCatalog();\n     assertTrue(catalog.existsTable(\"orderkeys\"));\n     TableDesc orderKeys = catalog.getTableDesc(\"orderkeys\");",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestSelectQuery.java",
                "sha": "4d852fc2e58468abf9934a3aefb743963b2aa998",
                "status": "modified"
            },
            {
                "additions": 86,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestTablePartitions.java",
                "changes": 154,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestTablePartitions.java?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 68,
                "filename": "tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestTablePartitions.java",
                "patch": "@@ -25,90 +25,75 @@\n import org.apache.hadoop.io.compress.CompressionCodec;\n import org.apache.hadoop.io.compress.CompressionCodecFactory;\n import org.apache.hadoop.io.compress.DeflateCodec;\n+import org.apache.tajo.QueryTestCaseBase;\n import org.apache.tajo.TajoTestingCluster;\n-import org.apache.tajo.TpchTestBase;\n import org.apache.tajo.catalog.CatalogService;\n import org.apache.tajo.catalog.TableDesc;\n-import org.junit.BeforeClass;\n import org.junit.Test;\n \n import java.io.IOException;\n import java.sql.ResultSet;\n import java.util.Map;\n \n import static org.junit.Assert.*;\n+import static org.junit.Assert.assertEquals;\n+\n+public class TestTablePartitions extends QueryTestCaseBase {\n \n-public class TestTablePartitions {\n \n-  private static TpchTestBase tpch;\n   public TestTablePartitions() throws IOException {\n     super();\n   }\n \n-  @BeforeClass\n-  public static void setUp() throws Exception {\n-    tpch = TpchTestBase.getInstance();\n-  }\n-\n   @Test\n   public final void testCreateColumnPartitionedTable() throws Exception {\n     String tableName =\"testCreateColumnPartitionedTable\";\n-    ResultSet res = tpch.execute(\n-        \"create table \" + tableName +\" (col1 int4, col2 int4) partition by column(key float8) \");\n+    ResultSet res = execute(\n+        \"create table \" + tableName + \" (col1 int4, col2 int4) partition by column(key float8) \");\n     res.close();\n-    TajoTestingCluster cluster = tpch.getTestingCluster();\n-    CatalogService catalog = cluster.getMaster().getCatalog();\n+\n     assertTrue(catalog.existsTable(tableName));\n     assertEquals(2, catalog.getTableDesc(tableName).getSchema().getColumnNum());\n     assertEquals(3, catalog.getTableDesc(tableName).getLogicalSchema().getColumnNum());\n \n-    res = tpch.execute(\"insert overwrite into \" + tableName + \" select l_orderkey, l_partkey, l_quantity from lineitem\");\n+    res = testBase.execute(\n+        \"insert overwrite into \" + tableName + \" select l_orderkey, l_partkey, l_quantity from lineitem\");\n     res.close();\n   }\n \n   @Test\n   public final void testCreateColumnPartitionedTableWithSelectedColumns() throws Exception {\n     String tableName =\"testCreateColumnPartitionedTableWithSelectedColumns\";\n-    ResultSet res = tpch.execute(\n-        \"create table \" + tableName +\" (col1 int4, col2 int4, null_col int4) partition by column(key float8) \");\n+    ResultSet res = execute(\n+        \"create table \" + tableName + \" (col1 int4, col2 int4, null_col int4) partition by column(key float8) \");\n     res.close();\n-    TajoTestingCluster cluster = tpch.getTestingCluster();\n-    CatalogService catalog = cluster.getMaster().getCatalog();\n+\n     assertTrue(catalog.existsTable(tableName));\n     assertEquals(3, catalog.getTableDesc(tableName).getSchema().getColumnNum());\n     assertEquals(4, catalog.getTableDesc(tableName).getLogicalSchema().getColumnNum());\n \n-    res = tpch.execute(\"insert overwrite into \" + tableName + \" (col1, col2, key) select l_orderkey, l_partkey, l_quantity from lineitem\");\n+    res = execute(\"insert overwrite into \" + tableName + \" (col1, col2, key) select l_orderkey, \" +\n+        \"l_partkey, l_quantity from lineitem\");\n     res.close();\n   }\n \n   @Test\n   public final void testColumnPartitionedTableByOneColumn() throws Exception {\n     String tableName =\"testColumnPartitionedTableByOneColumn\";\n-    ResultSet res = tpch.execute(\n-        \"create table \" + tableName +\" (col1 int4, col2 int4, null_col int4) partition by column(key float8) \");\n+    ResultSet res = execute(\n+        \"create table \" + tableName + \" (col1 int4, col2 int4, null_col int4) partition by column(key float8) \");\n     res.close();\n-    TajoTestingCluster cluster = tpch.getTestingCluster();\n-    CatalogService catalog = cluster.getMaster().getCatalog();\n+\n     assertTrue(catalog.existsTable(tableName));\n \n-    res = tpch.execute(\"insert overwrite into \" + tableName\n+    res = execute(\"insert overwrite into \" + tableName\n         + \" (col1, col2, key) select l_orderkey, l_partkey, l_quantity from lineitem\");\n     res.close();\n \n     TableDesc desc = catalog.getTableDesc(tableName);\n-    Path path = desc.getPath();\n+    assertPartitionDirectories(desc);\n \n-    FileSystem fs = FileSystem.get(tpch.getTestingCluster().getConfiguration());\n-    assertTrue(fs.isDirectory(path));\n-    assertTrue(fs.isDirectory(new Path(path.toUri() + \"/key=17.0\")));\n-    assertTrue(fs.isDirectory(new Path(path.toUri() + \"/key=36.0\")));\n-    assertTrue(fs.isDirectory(new Path(path.toUri() + \"/key=38.0\")));\n-    assertTrue(fs.isDirectory(new Path(path.toUri() + \"/key=45.0\")));\n-    assertTrue(fs.isDirectory(new Path(path.toUri() + \"/key=49.0\")));\n-    assertEquals(5, desc.getStats().getNumRows().intValue());\n-\n-    res = tpch.execute(\n+    res = execute(\n         \"select distinct * from \" + tableName + \" where (key = 45.0 or key = 38.0) and null_col is null\");\n \n     Map<Double, int []> resultRows1 = Maps.newHashMap();\n@@ -123,24 +108,62 @@ public final void testColumnPartitionedTableByOneColumn() throws Exception {\n     res.close();\n   }\n \n+  private void assertPartitionDirectories(TableDesc desc) throws IOException {\n+    FileSystem fs = FileSystem.get(conf);\n+    Path path = desc.getPath();\n+    assertTrue(fs.isDirectory(path));\n+    assertTrue(fs.isDirectory(new Path(path.toUri() + \"/key=17.0\")));\n+    assertTrue(fs.isDirectory(new Path(path.toUri() + \"/key=36.0\")));\n+    assertTrue(fs.isDirectory(new Path(path.toUri() + \"/key=38.0\")));\n+    assertTrue(fs.isDirectory(new Path(path.toUri() + \"/key=45.0\")));\n+    assertTrue(fs.isDirectory(new Path(path.toUri() + \"/key=49.0\")));\n+    assertEquals(5, desc.getStats().getNumRows().intValue());\n+  }\n+\n+  @Test\n+  public final void testQueryCasesOnColumnPartitionedTable() throws Exception {\n+    String tableName =\"testQueryCasesOnColumnPartitionedTable\";\n+    ResultSet res = execute(\n+        \"create table \" + tableName + \" (col1 int4, col2 int4, null_col int4) partition by column(key float8) \");\n+    res.close();\n+\n+    assertTrue(catalog.existsTable(tableName));\n+\n+    res = execute(\n+        \"insert overwrite into \" + tableName\n+            + \" (col1, col2, key) select l_orderkey, l_partkey, l_quantity from lineitem\");\n+    res.close();\n+\n+    TableDesc desc = catalog.getTableDesc(tableName);\n+    assertPartitionDirectories(desc);\n+\n+    res = executeQuery(\"case1.sql\");\n+    assertResultSet(res, \"case1.result\");\n+    res.close();\n+\n+    res = executeQuery(\"case2.sql\");\n+    assertResultSet(res, \"case2.result\");\n+    res.close();\n+  }\n+\n   @Test\n   public final void testColumnPartitionedTableByThreeColumns() throws Exception {\n     String tableName =\"testColumnPartitionedTableByThreeColumns\";\n-    ResultSet res = tpch.execute(\n+    ResultSet res = testBase.execute(\n         \"create table \" + tableName +\" (col4 text) partition by column(col1 int4, col2 int4, col3 float8) \");\n     res.close();\n-    TajoTestingCluster cluster = tpch.getTestingCluster();\n+    TajoTestingCluster cluster = testBase.getTestingCluster();\n     CatalogService catalog = cluster.getMaster().getCatalog();\n     assertTrue(catalog.existsTable(tableName));\n \n-    res = tpch.execute(\"insert overwrite into \" + tableName\n+    res = execute(\"insert overwrite into \" + tableName\n         + \" select l_returnflag, l_orderkey, l_partkey, l_quantity from lineitem\");\n     res.close();\n \n     TableDesc desc = catalog.getTableDesc(tableName);\n     Path path = desc.getPath();\n \n-    FileSystem fs = FileSystem.get(tpch.getTestingCluster().getConfiguration());\n+    FileSystem fs = FileSystem.get(conf);\n     assertTrue(fs.isDirectory(path));\n     assertTrue(fs.isDirectory(new Path(path.toUri() + \"/col1=1\")));\n     assertTrue(fs.isDirectory(new Path(path.toUri() + \"/col1=1/col2=1\")));\n@@ -155,7 +178,7 @@ public final void testColumnPartitionedTableByThreeColumns() throws Exception {\n     assertTrue(fs.isDirectory(new Path(path.toUri() + \"/col1=3/col2=3/col3=49.0\")));\n     assertEquals(5, desc.getStats().getNumRows().intValue());\n \n-    res = tpch.execute(\"select * from \" + tableName + \" where col2 = 2\");\n+    res = execute(\"select * from \" + tableName + \" where col2 = 2\");\n \n     Map<Double, int []> resultRows1 = Maps.newHashMap();\n     resultRows1.put(45.0d, new int[]{3, 2});\n@@ -175,7 +198,7 @@ public final void testColumnPartitionedTableByThreeColumns() throws Exception {\n     resultRows2.put(45.0d, new int[]{3, 2});\n     resultRows2.put(38.0d, new int[]{2, 2});\n \n-    res = tpch.execute(\"select * from \" + tableName + \" where (col1 = 2 or col1 = 3) and col2 >= 2\");\n+    res = execute(\"select * from \" + tableName + \" where (col1 = 2 or col1 = 3) and col2 >= 2\");\n \n     for (int i = 0; i < 3; i++) {\n       assertTrue(res.next());\n@@ -188,24 +211,22 @@ public final void testColumnPartitionedTableByThreeColumns() throws Exception {\n   @Test\n   public final void testColumnPartitionedTableByOneColumnsWithCompression() throws Exception {\n     String tableName = \"testColumnPartitionedTableByOneColumnsWithCompression\";\n-    ResultSet res = tpch.execute(\n+    ResultSet res = execute(\n         \"create table \" + tableName + \" (col2 int4, col3 float8) USING csv \" +\n             \"WITH ('csvfile.delimiter'='|','compression.codec'='org.apache.hadoop.io.compress.DeflateCodec') \" +\n             \"PARTITION BY column(col1 int4)\");\n     res.close();\n-    TajoTestingCluster cluster = tpch.getTestingCluster();\n-    CatalogService catalog = cluster.getMaster().getCatalog();\n     assertTrue(catalog.existsTable(tableName));\n \n-    res = tpch.execute(\n+    res = execute(\n         \"insert overwrite into \" + tableName + \" select l_partkey, l_quantity, l_orderkey from lineitem\");\n     res.close();\n     TableDesc desc = catalog.getTableDesc(tableName);\n     assertEquals(5, desc.getStats().getNumRows().intValue());\n \n-    FileSystem fs = FileSystem.get(tpch.getTestingCluster().getConfiguration());\n+    FileSystem fs = FileSystem.get(conf);\n     assertTrue(fs.exists(desc.getPath()));\n-    CompressionCodecFactory factory = new CompressionCodecFactory(tpch.getTestingCluster().getConfiguration());\n+    CompressionCodecFactory factory = new CompressionCodecFactory(conf);\n \n     Path path = desc.getPath();\n     assertTrue(fs.isDirectory(new Path(path.toUri() + \"/col1=1\")));\n@@ -224,24 +245,23 @@ public final void testColumnPartitionedTableByOneColumnsWithCompression() throws\n   @Test\n   public final void testColumnPartitionedTableByTwoColumnsWithCompression() throws Exception {\n     String tableName = \"testColumnPartitionedTableByTwoColumnsWithCompression\";\n-    ResultSet res = tpch.execute(\"create table \" + tableName + \" (col3 float8, col4 text) USING csv \" +\n+    ResultSet res = execute(\"create table \" + tableName + \" (col3 float8, col4 text) USING csv \" +\n         \"WITH ('csvfile.delimiter'='|','compression.codec'='org.apache.hadoop.io.compress.DeflateCodec') \" +\n         \"PARTITION by column(col1 int4, col2 int4)\");\n     res.close();\n-    TajoTestingCluster cluster = tpch.getTestingCluster();\n-    CatalogService catalog = cluster.getMaster().getCatalog();\n+\n     assertTrue(catalog.existsTable(tableName));\n \n-    res = tpch.execute(\n+    res = execute(\n         \"insert overwrite into \" + tableName +\n             \" select  l_quantity, l_returnflag, l_orderkey, l_partkey from lineitem\");\n     res.close();\n     TableDesc desc = catalog.getTableDesc(tableName);\n     assertEquals(5, desc.getStats().getNumRows().intValue());\n \n-    FileSystem fs = FileSystem.get(tpch.getTestingCluster().getConfiguration());\n+    FileSystem fs = FileSystem.get(conf);\n     assertTrue(fs.exists(desc.getPath()));\n-    CompressionCodecFactory factory = new CompressionCodecFactory(tpch.getTestingCluster().getConfiguration());\n+    CompressionCodecFactory factory = new CompressionCodecFactory(conf);\n \n     Path path = desc.getPath();\n     assertTrue(fs.isDirectory(new Path(path.toUri() + \"/col1=1\")));\n@@ -267,25 +287,24 @@ public final void testColumnPartitionedTableByTwoColumnsWithCompression() throws\n   @Test\n   public final void testColumnPartitionedTableByThreeColumnsWithCompression() throws Exception {\n     String tableName = \"testColumnPartitionedTableByThreeColumnsWithCompression\";\n-    ResultSet res = tpch.execute(\n+    ResultSet res = execute(\n         \"create table \" + tableName + \" (col4 text) USING csv \" +\n             \"WITH ('csvfile.delimiter'='|','compression.codec'='org.apache.hadoop.io.compress.DeflateCodec') \" +\n             \"partition by column(col1 int4, col2 int4, col3 float8)\");\n     res.close();\n-    TajoTestingCluster cluster = tpch.getTestingCluster();\n-    CatalogService catalog = cluster.getMaster().getCatalog();\n+\n     assertTrue(catalog.existsTable(tableName));\n \n-    res = tpch.execute(\n+    res = execute(\n         \"insert overwrite into \" + tableName +\n             \" select l_returnflag, l_orderkey, l_partkey, l_quantity from lineitem\");\n     res.close();\n     TableDesc desc = catalog.getTableDesc(tableName);\n     assertEquals(5, desc.getStats().getNumRows().intValue());\n \n-    FileSystem fs = FileSystem.get(tpch.getTestingCluster().getConfiguration());\n+    FileSystem fs = FileSystem.get(conf);\n     assertTrue(fs.exists(desc.getPath()));\n-    CompressionCodecFactory factory = new CompressionCodecFactory(tpch.getTestingCluster().getConfiguration());\n+    CompressionCodecFactory factory = new CompressionCodecFactory(conf);\n \n     Path path = desc.getPath();\n     assertTrue(fs.isDirectory(new Path(path.toUri() + \"/col1=1\")));\n@@ -314,7 +333,7 @@ public final void testColumnPartitionedTableByThreeColumnsWithCompression() thro\n       }\n     }\n \n-    res = tpch.execute(\"select * from \" + tableName + \" where col2 = 2\");\n+    res = execute(\"select * from \" + tableName + \" where col2 = 2\");\n \n     Map<Double, int []> resultRows1 = Maps.newHashMap();\n     resultRows1.put(45.0d, new int[]{3, 2});\n@@ -334,7 +353,7 @@ public final void testColumnPartitionedTableByThreeColumnsWithCompression() thro\n     resultRows2.put(45.0d, new int[]{3, 2});\n     resultRows2.put(38.0d, new int[]{2, 2});\n \n-    res = tpch.execute(\"select * from \" + tableName + \" where (col1 = 2 or col1 = 3) and col2 >= 2\");\n+    res = execute(\"select * from \" + tableName + \" where (col1 = 2 or col1 = 3) and col2 >= 2\");\n     i = 0;\n     while(res.next()) {\n       assertEquals(resultRows2.get(res.getDouble(4))[0], res.getInt(2));\n@@ -349,25 +368,24 @@ public final void testColumnPartitionedTableByThreeColumnsWithCompression() thro\n   @Test\n   public final void testColumnPartitionedTableNoMatchedPartition() throws Exception {\n     String tableName = \"testColumnPartitionedTableNoMatchedPartition\";\n-    ResultSet res = tpch.execute(\n+    ResultSet res = execute(\n         \"create table \" + tableName + \" (col4 text) USING csv \" +\n             \"WITH ('csvfile.delimiter'='|','compression.codec'='org.apache.hadoop.io.compress.DeflateCodec') \" +\n             \"partition by column(col1 int4, col2 int4, col3 float8)\");\n     res.close();\n-    TajoTestingCluster cluster = tpch.getTestingCluster();\n-    CatalogService catalog = cluster.getMaster().getCatalog();\n+\n     assertTrue(catalog.existsTable(tableName));\n \n-    res = tpch.execute(\n+    res = execute(\n         \"insert overwrite into \" + tableName +\n             \" select l_returnflag , l_orderkey, l_partkey, l_quantity from lineitem\");\n     res.close();\n     TableDesc desc = catalog.getTableDesc(tableName);\n     assertEquals(5, desc.getStats().getNumRows().intValue());\n \n-    FileSystem fs = FileSystem.get(tpch.getTestingCluster().getConfiguration());\n+    FileSystem fs = FileSystem.get(conf);\n     assertTrue(fs.exists(desc.getPath()));\n-    CompressionCodecFactory factory = new CompressionCodecFactory(tpch.getTestingCluster().getConfiguration());\n+    CompressionCodecFactory factory = new CompressionCodecFactory(conf);\n \n     Path path = desc.getPath();\n     assertTrue(fs.isDirectory(new Path(path.toUri() + \"/col1=1\")));\n@@ -396,7 +414,7 @@ public final void testColumnPartitionedTableNoMatchedPartition() throws Exceptio\n       }\n     }\n \n-    res = tpch.execute(\"select * from \" + tableName + \" where col2 = 9\");\n+    res = execute(\"select * from \" + tableName + \" where col2 = 9\");\n     assertFalse(res.next());\n     res.close();\n   }",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestTablePartitions.java",
                "sha": "46c1d94ef8c3824ccefedd00fe7e074e0537ecb6",
                "status": "modified"
            },
            {
                "additions": 16,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/resources/queries/TestTablePartitions/case1.sql",
                "changes": 16,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/resources/queries/TestTablePartitions/case1.sql?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/test/resources/queries/TestTablePartitions/case1.sql",
                "patch": "@@ -0,0 +1,16 @@\n+select\n+  *\n+from (\n+  select\n+    col1,\n+    col2,\n+    null_col,\n+    key\n+  from\n+    testQueryCasesOnColumnPartitionedTable\n+  where\n+    (key = 45.0 or key = 38.0) and null_col is null\n+) test\n+order by\n+  col1, col2\n+;\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/resources/queries/TestTablePartitions/case1.sql",
                "sha": "8c1116eab49e3249f9e6b068281941b47f793ae8",
                "status": "added"
            },
            {
                "additions": 31,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/resources/queries/TestTablePartitions/case2.sql",
                "changes": 31,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/resources/queries/TestTablePartitions/case2.sql?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/test/resources/queries/TestTablePartitions/case2.sql",
                "patch": "@@ -0,0 +1,31 @@\n+select\n+  *\n+from (\n+  select\n+    col1,\n+    col2,\n+    null_col,\n+    key\n+  from\n+    testQueryCasesOnColumnPartitionedTable\n+  where\n+    (key = 45.0 or key = 38.0) and null_col is null\n+\n+  union\n+\n+  select\n+    col1,\n+    col2,\n+    null_col,\n+    key\n+  from\n+    testQueryCasesOnColumnPartitionedTable\n+  where\n+    (key = 45.0 or key = 38.0) and null_col is null\n+\n+) t1\n+\n+order by\n+  col1,\n+  col2\n+;\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/resources/queries/TestTablePartitions/case2.sql",
                "sha": "c5100658468eb730a82debe79fa35d06c8e6374b",
                "status": "added"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/resources/results/TestTablePartitions/case1.result",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/resources/results/TestTablePartitions/case1.result?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/test/resources/results/TestTablePartitions/case1.result",
                "patch": "@@ -0,0 +1,4 @@\n+col1,col2,null_col,key\n+-------------------------------\n+2,2,0,38.0\n+3,2,0,45.0\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/resources/results/TestTablePartitions/case1.result",
                "sha": "4bfe8a269cc6c4e10222ad55550bb8adde50b9fb",
                "status": "added"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/resources/results/TestTablePartitions/case2.result",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/resources/results/TestTablePartitions/case2.result?ref=0781a3864e85da47c215e4da26d7344cecb3656f",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/test/resources/results/TestTablePartitions/case2.result",
                "patch": "@@ -0,0 +1,6 @@\n+col1,col2,null_col,key\n+-------------------------------\n+2,2,0,38.0\n+2,2,0,38.0\n+3,2,0,45.0\n+3,2,0,45.0\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/0781a3864e85da47c215e4da26d7344cecb3656f/tajo-core/tajo-core-backend/src/test/resources/results/TestTablePartitions/case2.result",
                "sha": "45b1a44fdbcf546ecbc05277a9e2a3835097c452",
                "status": "added"
            }
        ],
        "message": "TAJO-581: Inline view on column partitioned table causes NPE.",
        "parent": "https://github.com/apache/tajo/commit/51919cf9eb7c2b96d9f20126c780c3c26a4e8a05",
        "patched_files": [
            "TableSubQueryNode.java",
            "LogicalPlanner.java",
            "LogicalOptimizer.java",
            "GreedyHeuristicJoinOrderAlgorithm.java",
            "GlobalPlanner.java",
            "LogicalPlan.java",
            "BasicLogicalPlanVisitor.java",
            "PlannerUtil.java",
            "EvalTreeUtil.java",
            "case1.sql",
            "CHANGES.txt",
            "case2.sql",
            "GroupbyNode.java",
            "PartitionedTableRewriter.java",
            "ExprTestBase.java",
            "ProjectionPushDownRule.java",
            "case2.result",
            "case1.result",
            "QueryTestCaseBase.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestLogicalPlanner.java",
            "TestLogicalOptimizer.java",
            "TestPlannerUtil.java",
            "TestSelectQuery.java",
            "TestGlobalPlanner.java",
            "TestLogicalPlan.java",
            "TestTablePartitions.java",
            "TestJoinQuery.java",
            "TestEvalTreeUtil.java",
            "TestCTASQuery.java"
        ]
    },
    "tajo_109d0c6": {
        "bug_id": "tajo_109d0c6",
        "commit": "https://github.com/apache/tajo/commit/109d0c64b15f7af6a6545380c3e3d7ca50e6262e",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-common/src/main/java/tajo/util/TajoIdUtils.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-common/src/main/java/tajo/util/TajoIdUtils.java?ref=109d0c64b15f7af6a6545380c3e3d7ca50e6262e",
                "deletions": 0,
                "filename": "tajo-common/src/main/java/tajo/util/TajoIdUtils.java",
                "patch": "@@ -27,6 +27,10 @@\n  * @author Hyunsik Choi\n  */\n public class TajoIdUtils {\n+  /** It is mainly for DDL statements which don's have any query id. */\n+  public static final QueryId NullQueryId =\n+      TajoIdUtils.createQueryId(BuilderUtils.newApplicationId(0, 0), 0);\n+\n   public static QueryId createQueryId(ApplicationId appId, int attemptId) {\n     return newQueryId(appId, attemptId);\n   }",
                "raw_url": "https://github.com/apache/tajo/raw/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-common/src/main/java/tajo/util/TajoIdUtils.java",
                "sha": "34f63af72bbb00c7c6caacb61b5d47826c5fa0be",
                "status": "modified"
            },
            {
                "additions": 16,
                "blob_url": "https://github.com/apache/tajo/blob/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/main/java/tajo/cli/TajoCli.java",
                "changes": 30,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/cli/TajoCli.java?ref=109d0c64b15f7af6a6545380c3e3d7ca50e6262e",
                "deletions": 14,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/cli/TajoCli.java",
                "patch": "@@ -9,12 +9,13 @@\n import tajo.QueryId;\n import tajo.catalog.Column;\n import tajo.catalog.TableDesc;\n+import tajo.client.ClientProtocol;\n import tajo.client.TajoClient;\n import tajo.conf.TajoConf;\n import tajo.conf.TajoConf.ConfVars;\n import tajo.master.cluster.ServerName;\n-import tajo.master.cluster.ServerNodeTracker;\n import tajo.util.FileUtil;\n+import tajo.util.TajoIdUtils;\n \n import java.io.InputStream;\n import java.io.OutputStream;\n@@ -29,12 +30,9 @@\n public class TajoCli {\n   private final TajoConf conf;\n   private static final Options options;\n-  private ServerNodeTracker masterTracker;\n   private TajoClient client;\n \n-  private String zkAddr;\n   private String entryAddr;\n-  private static final int WAIT_TIME = 3000;\n   private static final int PRINT_LIMIT = 24;\n \n   private ConsoleReader reader;\n@@ -131,11 +129,19 @@ public int executeShell() throws Exception {\n       } else if (cmd[0].equalsIgnoreCase(\"history\")) {\n \n       } else {\n-        QueryId queryId = client.executeQuery(line);\n-        if (queryId != null) {\n-          getQueryResult(queryId);\n+        ClientProtocol.SubmitQueryRespose response = client.executeQuery(line);\n+\n+        if (response.getResultCode() == ClientProtocol.ResultCode.OK) {\n+          QueryId queryId = new QueryId(response.getQueryId());\n+          if (queryId.equals(TajoIdUtils.NullQueryId)) {\n+            sout.println(\"OK\");\n+          } else {\n+            getQueryResult(queryId);\n+          }\n         } else {\n-          sout.println(client.getErrorMessage());\n+        if (response.hasErrorMessage()) {\n+          sout.println(response.getErrorMessage());\n+        }\n         }\n       }\n     }\n@@ -145,13 +151,9 @@ public int executeShell() throws Exception {\n     return 0;\n   }\n \n-  private void executeQuery(String tql) {\n-\n-  }\n-\n   private void getQueryResult(QueryId queryId) {\n     // if query is empty string\n-    if (queryId.equals(\"\")) {\n+    if (queryId.equals(TajoIdUtils.NullQueryId)) {\n       return;\n     }\n \n@@ -177,7 +179,7 @@ private void getQueryResult(QueryId queryId) {\n           sout.print(columnValue);\n         }\n         sout.println();\n-        sout.flush();;\n+        sout.flush();\n         numOfPrintedRows++;\n         if (numOfPrintedRows >= PRINT_LIMIT) {\n           sout.print(\"continue... ('q' is quit)\");",
                "raw_url": "https://github.com/apache/tajo/raw/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/main/java/tajo/cli/TajoCli.java",
                "sha": "5210e35fc400b15f25c65bfd6dfac7887bd46ca2",
                "status": "modified"
            },
            {
                "additions": 69,
                "blob_url": "https://github.com/apache/tajo/blob/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/main/java/tajo/client/TajoClient.java",
                "changes": 101,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/client/TajoClient.java?ref=109d0c64b15f7af6a6545380c3e3d7ca50e6262e",
                "deletions": 32,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/client/TajoClient.java",
                "patch": "@@ -1,3 +1,19 @@\n+/*\n+ * Copyright 2012 Database Lab., Korea Univ.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n package tajo.client;\n \n import com.google.protobuf.ServiceException;\n@@ -16,6 +32,7 @@\n import tajo.engine.query.ResultSetImpl;\n import tajo.rpc.ProtoBlockingRpcClient;\n import tajo.rpc.protocolrecords.PrimitiveProtos.StringProto;\n+import tajo.util.TajoIdUtils;\n \n import java.io.IOException;\n import java.net.InetSocketAddress;\n@@ -41,13 +58,11 @@ public TajoClient(TajoConf conf) throws IOException {\n \n   public TajoClient(InetSocketAddress addr) throws IOException {\n     this.conf = new TajoConf();\n-    this.conf.setBoolVar(ConfVars.CLUSTER_DISTRIBUTED, true);\n     connect(addr);\n   }\n \n   public TajoClient(String hostname, int port) throws IOException {\n     this.conf = new TajoConf();\n-    this.conf.setBoolVar(ConfVars.CLUSTER_DISTRIBUTED, true);\n     connect(NetUtils.createSocketAddr(hostname, port));\n   }\n \n@@ -59,7 +74,7 @@ private void connect(InetSocketAddress addr) throws IOException {\n       throw new IOException(e);\n     }\n \n-    LOG.info(\"Connected to tajo cluster (\" +\n+    LOG.info(\"connected to tajo cluster (\" +\n         tajo.util.NetUtils.getIpPortString(addr) + \")\");\n   }\n \n@@ -71,30 +86,38 @@ public boolean isConnected() {\n     return client.isConnected();\n   }\n \n-  private String errorMessage;\n-\n-  public QueryId executeQuery(String tql) throws ServiceException {\n+  /**\n+   * It submits a query statement and get a response immediately.\n+   * The response only contains a query id, and submission status.\n+   * In order to get the result, you should use {@link #getQueryResult(tajo.QueryId)}\n+   * or {@link #getQueryResultAndWait(tajo.QueryId)}.\n+   */\n+  public SubmitQueryRespose executeQuery(String tql) throws ServiceException {\n     QueryRequest.Builder builder = QueryRequest.newBuilder();\n     builder.setQuery(tql);\n-    SubmitQueryRespose response = service.submitQuery(null, builder.build());\n-    if (response.hasErrorMessage()) {\n-      errorMessage = response.getErrorMessage();\n-      return null;\n-    }\n-    return new QueryId(response.getQueryId());\n-  }\n \n-  public String getErrorMessage() {\n-    return errorMessage;\n+    return service.submitQuery(null, builder.build());\n   }\n \n-  public ResultSet executeQueryAndWait(String tql)\n+  /**\n+   * It submits a query statement and get a response.\n+   * The main difference from {@link #executeQuery(String)}\n+   * is a blocking method. So, this method is wait for\n+   * the finish of the submitted query.\n+   *\n+   * @return If failed, return null.\n+   */\n+  public ResultSet executeQueryAndGetResult(String tql)\n       throws ServiceException, IOException {\n     QueryRequest.Builder builder = QueryRequest.newBuilder();\n     builder.setQuery(tql);\n     SubmitQueryRespose response = service.submitQuery(null, builder.build());\n+    QueryId queryId = new QueryId(response.getQueryId());\n+    if (queryId.equals(TajoIdUtils.NullQueryId)) {\n+      return null;\n+    }\n \n-    return getQueryResultAndWait(new QueryId(response.getQueryId()));\n+    return getQueryResultAndWait(queryId);\n   }\n \n   public QueryStatus getQueryStatus(QueryId queryId) throws ServiceException {\n@@ -116,18 +139,24 @@ private static boolean isQueryRunnning(QueryState state) {\n \n   public ResultSet getQueryResult(QueryId queryId)\n       throws ServiceException, IOException {\n-    TableDesc tableDesc = getQueryResultDesc(queryId);\n-    ResultSet resultSet = new ResultSetImpl(conf, tableDesc.getPath());\n-    return resultSet;\n+    if (queryId.equals(TajoIdUtils.NullQueryId)) {\n+      return null;\n+    }\n+\n+    TableDesc tableDesc = getResultDesc(queryId);\n+    return new ResultSetImpl(conf, tableDesc.getPath());\n   }\n \n   public ResultSet getQueryResultAndWait(QueryId queryId)\n       throws ServiceException, IOException {\n+    if (queryId.equals(TajoIdUtils.NullQueryId)) {\n+      return null;\n+    }\n     QueryStatus status = getQueryStatus(queryId);\n \n     while(status != null && isQueryRunnning(status.getState())) {\n       try {\n-        Thread.sleep(1000);\n+        Thread.sleep(500);\n       } catch (InterruptedException e) {\n         e.printStackTrace();\n       }\n@@ -144,26 +173,26 @@ public ResultSet getQueryResultAndWait(QueryId queryId)\n     }\n   }\n \n-  public TableDesc getQueryResultDesc(QueryId queryId) throws ServiceException {\n+  public TableDesc getResultDesc(QueryId queryId) throws ServiceException {\n+    if (queryId.equals(TajoIdUtils.NullQueryId)) {\n+      return null;\n+    }\n+\n     GetQueryResultRequest.Builder builder = GetQueryResultRequest.newBuilder();\n     builder.setQueryId(queryId.getProto());\n     GetQueryResultResponse response = service.getQueryResult(null,\n         builder.build());\n \n-    TableDesc tableDesc = TCatUtil.newTableDesc(response.getTableDesc());\n-    return tableDesc;\n+    return TCatUtil.newTableDesc(response.getTableDesc());\n   }\n \n   public boolean updateQuery(String tql) throws ServiceException {\n     QueryRequest.Builder builder = QueryRequest.newBuilder();\n     builder.setQuery(tql);\n \n-    if (service.updateQuery(null, builder.build()).getResultCode()\n-        == ResultCode.OK) {\n-      return true;\n-    } else {\n-      return false;\n-    }\n+    ResultCode resultCode =\n+        service.updateQuery(null, builder.build()).getResultCode();\n+    return resultCode == ResultCode.OK;\n   }\n \n   public boolean existTable(String name) throws ServiceException {\n@@ -177,11 +206,15 @@ public TableDesc attachTable(String name, String path)\n     AttachTableRequest.Builder builder = AttachTableRequest.newBuilder();\n     builder.setName(name);\n     builder.setPath(path);\n-    TableResponse res = null;\n-    res = service.attachTable(null, builder.build());\n+    TableResponse res = service.attachTable(null, builder.build());\n     return TCatUtil.newTableDesc(res.getTableDesc());\n   }\n \n+  public TableDesc attachTable(String name, Path path)\n+      throws ServiceException {\n+    return attachTable(name, path.toString());\n+  }\n+\n   public boolean detachTable(String name) throws ServiceException {\n     StringProto.Builder builder = StringProto.newBuilder();\n     builder.setValue(name);\n@@ -208,6 +241,10 @@ public boolean dropTable(String name) throws ServiceException {\n     return null;\n   }\n \n+  /**\n+   * Get a list of table names. All table and column names are\n+   * represented as lower-case letters.\n+   */\n   public List<String> getTableList() throws ServiceException {\n     GetTableListRequest.Builder builder = GetTableListRequest.newBuilder();\n     GetTableListResponse res = service.getTableList(null, builder.build());",
                "raw_url": "https://github.com/apache/tajo/raw/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/main/java/tajo/client/TajoClient.java",
                "sha": "1f2a93e5e184ae5a4a2a3a3ef1faae207056b837",
                "status": "modified"
            },
            {
                "additions": 21,
                "blob_url": "https://github.com/apache/tajo/blob/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/main/java/tajo/master/ClientService.java",
                "changes": 31,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/master/ClientService.java?ref=109d0c64b15f7af6a6545380c3e3d7ca50e6262e",
                "deletions": 10,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/master/ClientService.java",
                "patch": "@@ -25,6 +25,7 @@\n import org.apache.hadoop.yarn.proto.YarnProtos.ApplicationAttemptIdProto;\n import org.apache.hadoop.yarn.service.AbstractService;\n import tajo.QueryId;\n+import tajo.TajoProtos;\n import tajo.catalog.*;\n import tajo.catalog.exception.AlreadyExistsTableException;\n import tajo.catalog.exception.NoSuchTableException;\n@@ -42,6 +43,7 @@\n import tajo.rpc.protocolrecords.PrimitiveProtos.BoolProto;\n import tajo.rpc.protocolrecords.PrimitiveProtos.StringProto;\n import tajo.storage.StorageUtil;\n+import tajo.util.TajoIdUtils;\n \n import java.io.IOException;\n import java.net.InetSocketAddress;\n@@ -160,6 +162,9 @@ public GetQueryResultResponse getQueryResult(RpcController controller,\n                                                  GetQueryResultRequest request)\n         throws ServiceException {\n       QueryId queryId = new QueryId(request.getQueryId());\n+      if (queryId.equals(TajoIdUtils.NullQueryId)) {\n+\n+      }\n       Query query = context.getQuery(queryId).getContext().getQuery();\n \n       GetQueryResultResponse.Builder builder\n@@ -190,21 +195,27 @@ public GetQueryStatusResponse getQueryStatus(RpcController controller,\n                                                  GetQueryStatusRequest request)\n         throws ServiceException {\n \n-      QueryId queryId = new QueryId(request.getQueryId());\n-      Query query = context.getQuery(queryId).getContext().getQuery();\n-\n       GetQueryStatusResponse.Builder builder\n           = GetQueryStatusResponse.newBuilder();\n-\n+      QueryId queryId = new QueryId(request.getQueryId());\n       builder.setQueryId(request.getQueryId());\n-      if (query != null) {\n+\n+      if (queryId.equals(TajoIdUtils.NullQueryId)) {\n         builder.setResultCode(ResultCode.OK);\n-        builder.setState(query.getState());\n-        builder.setProgress(query.getProgress());\n-        builder.setExecutionTime(System.currentTimeMillis() - query.getStartTime());\n+        builder.setState(TajoProtos.QueryState.QUERY_SUCCEEDED);\n+        builder.setProgress(1.0f);\n+        builder.setExecutionTime(0);\n       } else {\n-        builder.setResultCode(ResultCode.ERROR);\n-        builder.setErrorMessage(\"No such query: \" + queryId.toString());\n+        Query query = context.getQuery(queryId).getContext().getQuery();\n+        if (query != null) {\n+          builder.setResultCode(ResultCode.OK);\n+          builder.setState(query.getState());\n+          builder.setProgress(query.getProgress());\n+          builder.setExecutionTime(System.currentTimeMillis() - query.getStartTime());\n+        } else {\n+          builder.setResultCode(ResultCode.ERROR);\n+          builder.setErrorMessage(\"No such query: \" + queryId.toString());\n+        }\n       }\n \n       return builder.build();",
                "raw_url": "https://github.com/apache/tajo/raw/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/main/java/tajo/master/ClientService.java",
                "sha": "5892d03ed4b7df2b2ecdf892ac92caf3ff0ab7d7",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/main/java/tajo/master/GlobalEngine.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/master/GlobalEngine.java?ref=109d0c64b15f7af6a6545380c3e3d7ca50e6262e",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/master/GlobalEngine.java",
                "patch": "@@ -154,7 +154,7 @@ public QueryId executeQuery(String tql)\n     if (plan.getSubNode().getType() == ExprType.CREATE_TABLE) {\n       createTable(plan);\n \n-      return null;\n+      return TajoIdUtils.NullQueryId;\n     } else {\n       ApplicationAttemptId appAttemptId = submitQuery();\n       QueryId queryId = TajoIdUtils.createQueryId(appAttemptId);",
                "raw_url": "https://github.com/apache/tajo/raw/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/main/java/tajo/master/GlobalEngine.java",
                "sha": "9a921da6e7f29d0095cbb69940b618202da64e54",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/test/java/tajo/LocalTajoTestingUtility.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/tajo/LocalTajoTestingUtility.java?ref=109d0c64b15f7af6a6545380c3e3d7ca50e6262e",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/test/java/tajo/LocalTajoTestingUtility.java",
                "patch": "@@ -51,7 +51,7 @@ public void setup(String[] names,\n   }\n \n   public ResultSet execute(String query) throws IOException, ServiceException {\n-    return client.executeQueryAndWait(query);\n+    return client.executeQueryAndGetResult(query);\n   }\n \n   public void shutdown() throws IOException {",
                "raw_url": "https://github.com/apache/tajo/raw/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/test/java/tajo/LocalTajoTestingUtility.java",
                "sha": "6f558e4da57768806517c4022fd8d58fb40f8000",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/test/java/tajo/TajoTestingCluster.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/tajo/TajoTestingCluster.java?ref=109d0c64b15f7af6a6545380c3e3d7ca50e6262e",
                "deletions": 3,
                "filename": "tajo-core/tajo-core-backend/src/test/java/tajo/TajoTestingCluster.java",
                "patch": "@@ -431,7 +431,7 @@ public static ResultSet runInLocal(String[] tableNames,\n       client.createTable(tableNames[i], new Path(tableDir.getAbsolutePath()), meta);\n     }\n     Thread.sleep(1000);\n-    ResultSet res = client.executeQueryAndWait(query);\n+    ResultSet res = client.executeQueryAndGetResult(query);\n     util.shutdownMiniCluster();\n     return res;\n   }\n@@ -463,7 +463,7 @@ public static ResultSet run(String[] names,\n       client.createTable(names[i], tablePath, meta);\n     }\n     Thread.sleep(1000);\n-    ResultSet res = client.executeQueryAndWait(query);\n+    ResultSet res = client.executeQueryAndGetResult(query);\n     util.shutdownMiniCluster();\n     return res;\n   }\n@@ -498,7 +498,7 @@ public static ResultSet run(String[] names,\n       client.createTable(names[i], tablePath, meta);\n     }\n     Thread.sleep(1000);\n-    ResultSet res = client.executeQueryAndWait(query);\n+    ResultSet res = client.executeQueryAndGetResult(query);\n     util.shutdownMiniCluster();\n     return res;\n   }",
                "raw_url": "https://github.com/apache/tajo/raw/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/test/java/tajo/TajoTestingCluster.java",
                "sha": "4c8381aa8500b6371662708b823d1442a8307777",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/test/java/tajo/TajoTestingUtility.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/tajo/TajoTestingUtility.java?ref=109d0c64b15f7af6a6545380c3e3d7ca50e6262e",
                "deletions": 3,
                "filename": "tajo-core/tajo-core-backend/src/test/java/tajo/TajoTestingUtility.java",
                "patch": "@@ -472,7 +472,7 @@ public static ResultSet runInLocal(String[] tableNames,\n       client.createTable(tableNames[i], new Path(tableDir.getAbsolutePath()), meta);\n     }\n     Thread.sleep(1000);\n-    ResultSet res = client.executeQueryAndWait(query);\n+    ResultSet res = client.executeQueryAndGetResult(query);\n     client.close();\n     util.shutdownMiniCluster();\n     return res;\n@@ -505,7 +505,7 @@ public static ResultSet run(String[] names,\n       client.createTable(names[i], tablePath, meta);\n     }\n     Thread.sleep(1000);\n-    ResultSet res = client.executeQueryAndWait(query);\n+    ResultSet res = client.executeQueryAndGetResult(query);\n     client.close();\n     util.shutdownMiniCluster();\n     return res;\n@@ -541,7 +541,7 @@ public static ResultSet run(String[] names,\n       client.createTable(names[i], tablePath, meta);\n     }\n     Thread.sleep(1000);\n-    ResultSet res = client.executeQueryAndWait(query);\n+    ResultSet res = client.executeQueryAndGetResult(query);\n     util.shutdownMiniCluster();\n     client.close();\n     return res;",
                "raw_url": "https://github.com/apache/tajo/raw/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/test/java/tajo/TajoTestingUtility.java",
                "sha": "f5b53cfdf7f77e5e028a4de3240d0523316ae282",
                "status": "modified"
            },
            {
                "additions": 13,
                "blob_url": "https://github.com/apache/tajo/blob/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/test/java/tajo/WorkerTestingUtil.java",
                "changes": 21,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/tajo/WorkerTestingUtil.java?ref=109d0c64b15f7af6a6545380c3e3d7ca50e6262e",
                "deletions": 8,
                "filename": "tajo-core/tajo-core-backend/src/test/java/tajo/WorkerTestingUtil.java",
                "patch": "@@ -93,18 +93,19 @@ public static Path buildTestDir(String dir) throws IOException {\n     mockupMeta = TCatUtil.newTableMeta(mockupSchema, StoreType.CSV);\n \t}\n \n-\tpublic static void writeTmpTable(TajoConf conf, String parent,\n-\t    String tbName, boolean writeMeta) throws IOException {\n-\t  StorageManager sm = StorageManager.get(conf, parent);\n+  public static void writeTmpTable(TajoConf conf, Path path,\n+                                   String tableName, boolean writeMeta)\n+      throws IOException {\n+    StorageManager sm = StorageManager.get(conf, path);\n \n     Appender appender;\n     if (writeMeta) {\n-      appender = sm.getTableAppender(mockupMeta, tbName);\n+      appender = sm.getTableAppender(mockupMeta, tableName);\n     } else {\n       FileSystem fs = sm.getFileSystem();\n-      fs.mkdirs(StorageUtil.concatPath(parent, tbName, \"data\"));\n+      fs.mkdirs(StorageUtil.concatPath(path, tableName, \"data\"));\n       appender = sm.getAppender(mockupMeta,\n-          StorageUtil.concatPath(parent, tbName, \"data\", \"tb000\"));\n+          StorageUtil.concatPath(path, tableName, \"data\", \"tb000\"));\n     }\n     int deptSize = 10000;\n     int tupleNum = 100;\n@@ -117,6 +118,11 @@ public static void writeTmpTable(TajoConf conf, String parent,\n       appender.addTuple(tuple);\n     }\n     appender.close();\n+  }\n+\n+\tpublic static void writeTmpTable(TajoConf conf, String parent,\n+\t    String tableName, boolean writeMeta) throws IOException {\n+    writeTmpTable(conf, new Path(parent), tableName, writeMeta);\n \t}\n \n   private TajoConf conf;\n@@ -151,8 +157,7 @@ public ResultSet run(String [] tableNames, File [] tables, Schema [] schemas, St\n     PhysicalPlanner phyPlanner = new PhysicalPlannerImpl(conf, sm);\n     PhysicalExec exec = phyPlanner.createPlan(ctx, plan);\n \n-    ResultSet result = new ResultSetImpl(conf, new File(workDir, \"out\").getAbsolutePath());\n-    return result;\n+    return new ResultSetImpl(conf, new File(workDir, \"out\").getAbsolutePath());\n   }\n \n   public static File createTmpTestDir() {",
                "raw_url": "https://github.com/apache/tajo/raw/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/test/java/tajo/WorkerTestingUtil.java",
                "sha": "03ba95485429a8d10abf48919b3ea59e67b90334",
                "status": "modified"
            },
            {
                "additions": 48,
                "blob_url": "https://github.com/apache/tajo/blob/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/test/java/tajo/client/TestTajoClient.java",
                "changes": 74,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/tajo/client/TestTajoClient.java?ref=109d0c64b15f7af6a6545380c3e3d7ca50e6262e",
                "deletions": 26,
                "filename": "tajo-core/tajo-core-backend/src/test/java/tajo/client/TestTajoClient.java",
                "patch": "@@ -13,18 +13,22 @@\n import tajo.WorkerTestingUtil;\n import tajo.catalog.TableDesc;\n import tajo.conf.TajoConf;\n-import tajo.storage.StorageManager;\n+import tajo.storage.StorageUtil;\n+import tajo.util.CommonTestingUtil;\n \n import java.io.IOException;\n import java.util.Set;\n \n import static org.junit.Assert.*;\n \n @Category(IntegrationTest.class)\n-public class TestTajoCluster {\n+public class TestTajoClient {\n   private static TajoTestingCluster util;\n   private static TajoConf conf;\n   private static TajoClient tajo;\n+  private static String TEST_PATH = \"target/test-data/\"\n+      + TestTajoClient.class.getName();\n+  private static Path testDir;\n \n   @BeforeClass\n   public static void setUp() throws Exception {\n@@ -33,6 +37,8 @@ public static void setUp() throws Exception {\n     conf = util.getConfiguration();\n     Thread.sleep(3000);\n     tajo = new TajoClient(conf);\n+\n+    testDir = CommonTestingUtil.buildTestDir(TEST_PATH);\n   }\n \n   @AfterClass\n@@ -41,51 +47,66 @@ public static void tearDown() throws Exception {\n     tajo.close();\n   }\n \n+  private static Path writeTmpTable(String tableName) throws IOException {\n+    Path tablePath = StorageUtil.concatPath(testDir, tableName);\n+    WorkerTestingUtil.writeTmpTable(conf, testDir, tableName, true);\n+    return tablePath;\n+  }\n+\n   @Test\n   public final void testAttachTable() throws IOException, ServiceException {\n     final String tableName = \"attach\";\n-    WorkerTestingUtil.writeTmpTable(conf, \"/tajo/data\", tableName, true);\n+    Path tablePath = writeTmpTable(tableName);\n     assertFalse(tajo.existTable(tableName));\n-    tajo.attachTable(tableName, \"/tajo/data/attach\");\n+    tajo.attachTable(tableName, tablePath);\n     assertTrue(tajo.existTable(tableName));\n     tajo.detachTable(tableName);\n     assertFalse(tajo.existTable(tableName));\n   }\n \n   @Test\n   public final void testUpdateQuery() throws IOException, ServiceException {\n-    TajoConf conf = util.getConfiguration();\n-    final String tableName = \"updateQuery\";\n-    WorkerTestingUtil.writeTmpTable(conf, \"/tmp\", tableName, false);\n-    StorageManager sm = StorageManager.get(conf, \"/tmp\");\n-    FileSystem fs = sm.getFileSystem();\n-    assertTrue(fs.exists(new Path(\"/tmp\", tableName)));\n+    final String tableName = \"testUpdateQuery\";\n+    Path tablePath = writeTmpTable(tableName);\n \n     assertFalse(tajo.existTable(tableName));\n     String tql =\n         \"create table \" + tableName + \" (deptname string, score int) \"\n-            + \"using csv location '/tmp/\" + tableName + \"'\";\n+            + \"using csv location '\" + tablePath + \"'\";\n     tajo.updateQuery(tql);\n     assertTrue(tajo.existTable(tableName));\n   }\n \n   @Test\n   public final void testCreateAndDropTable()\n       throws IOException, ServiceException {\n-    final String tableName = \"create\";\n-    WorkerTestingUtil.writeTmpTable(conf, \"/tmp\", tableName, false);\n-    StorageManager sm = StorageManager.get(conf, \"/tmp\");\n-    FileSystem fs = sm.getFileSystem();\n-    assertTrue(fs.exists(new Path(\"/tmp\", tableName)));\n+    final String tableName = \"testCreateAndDropTable\";\n+    Path tablePath = writeTmpTable(tableName);\n+\n     assertFalse(tajo.existTable(tableName));\n-    tajo.createTable(tableName, new Path(\"/tmp\", tableName),\n-        WorkerTestingUtil.mockupMeta);\n+    tajo.createTable(tableName, tablePath, WorkerTestingUtil.mockupMeta);\n     assertTrue(tajo.existTable(tableName));\n     tajo.dropTable(tableName);\n     assertFalse(tajo.existTable(tableName));\n-    assertFalse(fs.exists(new Path(\"/tmp\", tableName)));\n+    FileSystem fs = tablePath.getFileSystem(conf);\n+    assertFalse(fs.exists(tablePath));\n+  }\n+\n+  @Test\n+  public final void testDDLByExecuteQuery() throws IOException, ServiceException {\n+    TajoConf conf = util.getConfiguration();\n+    final String tableName = \"testDDLByExecuteQuery\";\n+    WorkerTestingUtil.writeTmpTable(conf, \"/tmp\", tableName, false);\n+\n+    assertFalse(tajo.existTable(tableName));\n+    String tql =\n+        \"create table \" + tableName + \" (deptname string, score int) \"\n+            + \"using csv location '/tmp/\" + tableName + \"'\";\n+    tajo.executeQueryAndGetResult(tql);\n+    assertTrue(tajo.existTable(tableName));\n   }\n \n+  // disabled\n   public final void testGetClusterInfo() throws IOException, InterruptedException {\n     assertEquals(1,tajo.getClusterInfo().size());\n   }\n@@ -94,15 +115,16 @@ public final void testGetClusterInfo() throws IOException, InterruptedException\n   public final void testGetTableList() throws IOException, ServiceException {\n     final String tableName1 = \"table1\";\n     final String tableName2 = \"table2\";\n-    WorkerTestingUtil.writeTmpTable(conf, \"/tajo/data\", tableName1, true);\n-    WorkerTestingUtil.writeTmpTable(conf, \"/tajo/data\", tableName2, true);\n+    Path table1Path = writeTmpTable(tableName1);\n+    Path table2Path = writeTmpTable(tableName2);\n+\n     assertFalse(tajo.existTable(tableName1));\n     assertFalse(tajo.existTable(tableName2));\n-    tajo.attachTable(tableName1, \"/tajo/data/\"+tableName1);\n+    tajo.attachTable(tableName1, table1Path);\n     assertTrue(tajo.existTable(tableName1));\n     Set<String> tables = Sets.newHashSet(tajo.getTableList());\n     assertTrue(tables.contains(tableName1));\n-    tajo.attachTable(tableName2, \"/tajo/data/\"+tableName2);\n+    tajo.attachTable(tableName2, table2Path);\n     assertTrue(tajo.existTable(tableName2));\n     tables = Sets.newHashSet(tajo.getTableList());\n     assertTrue(tables.contains(tableName1));\n@@ -111,10 +133,10 @@ public final void testGetTableList() throws IOException, ServiceException {\n \n   @Test\n   public final void testGetTableDesc() throws IOException, ServiceException {\n-    final String tableName1 = \"tabledesc\";\n-    WorkerTestingUtil.writeTmpTable(conf, \"/tajo/data\", tableName1, true);\n+    final String tableName1 = \"table3\";\n+    Path tablePath = writeTmpTable(tableName1);\n     assertFalse(tajo.existTable(tableName1));\n-    tajo.attachTable(tableName1, \"/tajo/data/\"+tableName1);\n+    tajo.attachTable(tableName1, tablePath);\n     assertTrue(tajo.existTable(tableName1));\n     TableDesc desc = tajo.getTableDesc(tableName1);\n     assertNotNull(desc);",
                "previous_filename": "tajo-core/tajo-core-backend/src/test/java/tajo/client/TestTajoCluster.java",
                "raw_url": "https://github.com/apache/tajo/raw/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/test/java/tajo/client/TestTajoClient.java",
                "sha": "632ba0827b966314f70fd7873f91355f9c5b321c",
                "status": "renamed"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/test/java/tajo/engine/query/TestGlobalEngine.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/tajo/engine/query/TestGlobalEngine.java?ref=109d0c64b15f7af6a6545380c3e3d7ca50e6262e",
                "deletions": 6,
                "filename": "tajo-core/tajo-core-backend/src/test/java/tajo/engine/query/TestGlobalEngine.java",
                "patch": "@@ -241,7 +241,7 @@ public void testCreateTable() throws Exception {\n   @Test\n   public void testScanQuery() throws Exception {\n \n-    ResultSet res = client.executeQueryAndWait(query[1]);\n+    ResultSet res = client.executeQueryAndGetResult(query[1]);\n \n     String deptname;\n     while (res.next()) {\n@@ -252,7 +252,7 @@ public void testScanQuery() throws Exception {\n \n   @Test\n   public void testGroupbyQuery() throws Exception {\n-    ResultSet res = client.executeQueryAndWait(query[0]);\n+    ResultSet res = client.executeQueryAndGetResult(query[0]);\n \n     String deptname;\n     int year;\n@@ -267,7 +267,7 @@ public void testGroupbyQuery() throws Exception {\n \n   @Test\n   public void testJoin() throws Exception {\n-    ResultSet res = client.executeQueryAndWait(query[2]);\n+    ResultSet res = client.executeQueryAndGetResult(query[2]);\n \n     String deptname;\n     Set<Integer> results;\n@@ -280,7 +280,7 @@ public void testJoin() throws Exception {\n \n   @Test\n   public void testSelectAfterJoin() throws Exception {\n-    ResultSet res = client.executeQueryAndWait(query[4]);\n+    ResultSet res = client.executeQueryAndGetResult(query[4]);\n \n     String deptname;\n     Set<Integer> results;\n@@ -293,7 +293,7 @@ public void testSelectAfterJoin() throws Exception {\n \n   //@Test\n   public void testCubeby() throws Exception {\n-    ResultSet res = client.executeQueryAndWait(query[5]);\n+    ResultSet res = client.executeQueryAndGetResult(query[5]);\n \n     String deptname;\n     int year;\n@@ -330,7 +330,7 @@ public void run() {\n       @Override\n       public void run() {\n         try {\n-          queryId[0] = client.executeQuery(query[0]);\n+          queryId[0] = new QueryId(client.executeQuery(query[0]).getQueryId());\n         } catch (Exception e) {\n           e.printStackTrace();\n         }",
                "raw_url": "https://github.com/apache/tajo/raw/109d0c64b15f7af6a6545380c3e3d7ca50e6262e/tajo-core/tajo-core-backend/src/test/java/tajo/engine/query/TestGlobalEngine.java",
                "sha": "8447cdf2c9c03e5ccffa46041f2e0dc8bf9654c1",
                "status": "modified"
            }
        ],
        "message": "Merge pull request #84 from hyunsik/issue_84\n\nDDL statements cause NPE",
        "parent": "https://github.com/apache/tajo/commit/4f70ea468b3895a0724bb39fdc5e21c24174cfa7",
        "patched_files": [
            "ClientService.java",
            "LocalTajoTestingUtility.java",
            "TajoTestingCluster.java",
            "TajoClient.java",
            "GlobalEngine.java",
            "TajoTestingUtility.java",
            "WorkerTestingUtil.java",
            "TajoCli.java",
            "TajoIdUtils.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestTajoClient.java",
            "TestGlobalEngine.java"
        ]
    },
    "tajo_128d9c8": {
        "bug_id": "tajo_128d9c8",
        "commit": "https://github.com/apache/tajo/commit/128d9c8904f5b1541575320a8f7309c5e4e67192",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/128d9c8904f5b1541575320a8f7309c5e4e67192/tajo-core/tajo-core-backend/src/main/java/tajo/master/Repartitioner.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/master/Repartitioner.java?ref=128d9c8904f5b1541575320a8f7309c5e4e67192",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/master/Repartitioner.java",
                "patch": "@@ -410,7 +410,9 @@ public static String createBasicFetchUri(String hostName, int port,\n \n     List<IntermediateEntry> partitions = new ArrayList<>();\n     for (QueryUnit tasks : childSubQuery.getQueryUnits()) {\n-      partitions.addAll(tasks.getIntermediateData());\n+      if (tasks.getIntermediateData() != null) {\n+        partitions.addAll(tasks.getIntermediateData());\n+      }\n     }\n \n     Fragment frag = new Fragment(scan.getTableId(), tablePath,",
                "raw_url": "https://github.com/apache/tajo/raw/128d9c8904f5b1541575320a8f7309c5e4e67192/tajo-core/tajo-core-backend/src/main/java/tajo/master/Repartitioner.java",
                "sha": "13d1b7ccb56811f0a4d11f4a4b5c7dc82d13bc62",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/128d9c8904f5b1541575320a8f7309c5e4e67192/tajo-core/tajo-core-backend/src/main/java/tajo/master/TaskRunnerLauncherImpl.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/master/TaskRunnerLauncherImpl.java?ref=128d9c8904f5b1541575320a8f7309c5e4e67192",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/master/TaskRunnerLauncherImpl.java",
                "patch": "@@ -271,7 +271,7 @@ public ContainerLaunchContext createContainerLaunchContext(TaskRunnerLaunchEvent\n     Vector<CharSequence> vargs = new Vector<>(30);\n \n     // Set java executable command\n-    LOG.info(\"Setting up app master command\");\n+    //LOG.info(\"Setting up app master command\");\n     vargs.add(\"${JAVA_HOME}\" + \"/bin/java\");\n     // Set Xmx based on am memory size\n     vargs.add(\"-Xmx2000m\");",
                "raw_url": "https://github.com/apache/tajo/raw/128d9c8904f5b1541575320a8f7309c5e4e67192/tajo-core/tajo-core-backend/src/main/java/tajo/master/TaskRunnerLauncherImpl.java",
                "sha": "704832ac9f3601b51851e5b5375f1853eb79b1a5",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/128d9c8904f5b1541575320a8f7309c5e4e67192/tajo-core/tajo-core-backend/src/main/java/tajo/master/TaskSchedulerImpl.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/master/TaskSchedulerImpl.java?ref=128d9c8904f5b1541575320a8f7309c5e4e67192",
                "deletions": 3,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/master/TaskSchedulerImpl.java",
                "patch": "@@ -313,7 +313,7 @@ public void assignToLeafTasks(List<TaskRequestEvent> taskRequests) {\n           if (leafTasks.contains(tId)) {\n             leafTasks.remove(tId);\n             attemptId = tId;\n-            LOG.info(attemptId + \" Assigned based on host match \" + hostName);\n+            //LOG.info(attemptId + \" Assigned based on host match \" + hostName);\n             hostLocalAssigned++;\n             break;\n           }\n@@ -330,7 +330,7 @@ public void assignToLeafTasks(List<TaskRequestEvent> taskRequests) {\n             if (leafTasks.contains(tId)) {\n               leafTasks.remove(tId);\n               attemptId = tId;\n-              LOG.info(attemptId + \"Assigned based on rack match \" + rack);\n+              //LOG.info(attemptId + \"Assigned based on rack match \" + rack);\n               rackLocalAssigned++;\n               break;\n             }\n@@ -340,7 +340,7 @@ public void assignToLeafTasks(List<TaskRequestEvent> taskRequests) {\n           if (attemptId == null && leafTaskNum() > 0) {\n             attemptId = leafTasks.iterator().next();\n             leafTasks.remove(attemptId);\n-            LOG.info(attemptId + \" Assigned based on * match\");\n+            //LOG.info(attemptId + \" Assigned based on * match\");\n           }\n         }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/128d9c8904f5b1541575320a8f7309c5e4e67192/tajo-core/tajo-core-backend/src/main/java/tajo/master/TaskSchedulerImpl.java",
                "sha": "4ed4e084ea276ac67d3d17ef655af36c4f889961",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tajo/blob/128d9c8904f5b1541575320a8f7309c5e4e67192/tajo-core/tajo-core-backend/src/main/java/tajo/master/rm/RMContainerAllocator.java",
                "changes": 18,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/master/rm/RMContainerAllocator.java?ref=128d9c8904f5b1541575320a8f7309c5e4e67192",
                "deletions": 8,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/master/rm/RMContainerAllocator.java",
                "patch": "@@ -171,15 +171,17 @@ protected AMResponse makeRemoteRequest() throws YarnException, YarnRemoteExcepti\n     //LOG.info(\"Response Id: \" + response.getResponseId());\n     LOG.info(\"Available Resource: \" + response.getAvailableResources());\n     LOG.info(\"Num of Allocated Containers: \" + response.getAllocatedContainers().size());\n-    LOG.info(\"================================================================\");\n-    for (Container container : response.getAllocatedContainers()) {\n-      LOG.info(\"> Container Id: \" + container.getId());\n-      LOG.info(\"> Node Id: \" + container.getNodeId());\n-      LOG.info(\"> Resource (Mem): \" + container.getResource().getMemory());\n-      LOG.info(\"> State : \" + container.getState());\n-      LOG.info(\"> Priority: \" + container.getPriority());\n+    if (response.getAllocatedContainers().size() > 0) {\n+      LOG.info(\"================================================================\");\n+      for (Container container : response.getAllocatedContainers()) {\n+        LOG.info(\"> Container Id: \" + container.getId());\n+        LOG.info(\"> Node Id: \" + container.getNodeId());\n+        LOG.info(\"> Resource (Mem): \" + container.getResource().getMemory());\n+        LOG.info(\"> State : \" + container.getState());\n+        LOG.info(\"> Priority: \" + container.getPriority());\n+      }\n+      LOG.info(\"================================================================\");\n     }\n-    LOG.info(\"================================================================\");\n     /*\n     LOG.info(\"Reboot: \" + response.getReboot());\n     LOG.info(\"Num of Updated Node: \" + response.getUpdatedNodes());",
                "raw_url": "https://github.com/apache/tajo/raw/128d9c8904f5b1541575320a8f7309c5e4e67192/tajo-core/tajo-core-backend/src/main/java/tajo/master/rm/RMContainerAllocator.java",
                "sha": "16ebc4bc48dc833a40238f07f07568c6e05d2ac9",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tajo/blob/128d9c8904f5b1541575320a8f7309c5e4e67192/tajo-core/tajo-core-backend/src/main/java/tajo/worker/Task2.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/worker/Task2.java?ref=128d9c8904f5b1541575320a8f7309c5e4e67192",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/worker/Task2.java",
                "patch": "@@ -362,7 +362,6 @@ public void run() {\n         this.executor.init();\n         while(executor.next() != null && !killed) {\n           ++progress;\n-          System.out.println(\"ROW PROCEED: \" + progress);\n         }\n         this.executor.close();\n       }",
                "raw_url": "https://github.com/apache/tajo/raw/128d9c8904f5b1541575320a8f7309c5e4e67192/tajo-core/tajo-core-backend/src/main/java/tajo/worker/Task2.java",
                "sha": "1cf67dad8f2f77d652087753b81946986c9eb0ed",
                "status": "modified"
            },
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/tajo/blob/128d9c8904f5b1541575320a8f7309c5e4e67192/tajo-core/tajo-core-backend/src/main/java/tajo/worker/TaskRunner.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/worker/TaskRunner.java?ref=128d9c8904f5b1541575320a8f7309c5e4e67192",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/worker/TaskRunner.java",
                "patch": "@@ -38,12 +38,14 @@\n import tajo.SubQueryId;\n import tajo.TajoProtos.TaskAttemptState;\n import tajo.conf.TajoConf.ConfVars;\n+import tajo.engine.MasterWorkerProtos;\n import tajo.engine.MasterWorkerProtos.QueryUnitRequestProto;\n import tajo.engine.query.QueryUnitRequestImpl;\n import tajo.ipc.MasterWorkerProtocol;\n import tajo.ipc.MasterWorkerProtocol.MasterWorkerProtocolService;\n import tajo.ipc.MasterWorkerProtocol.MasterWorkerProtocolService.Interface;\n import tajo.rpc.CallFuture2;\n+import tajo.rpc.NullCallback;\n import tajo.rpc.ProtoAsyncRpcClient;\n import tajo.util.TajoIdUtils;\n \n@@ -257,13 +259,22 @@ public void run() {\n                     LOG.info(\"Accumulated Received Task: \" + (++receivedNum));\n                     QueryUnitAttemptId taskAttemptId =\n                         new QueryUnitAttemptId(taskRequest.getId());\n+                    if (tasks.containsKey(taskAttemptId)) {\n+                      MasterWorkerProtos.TaskFatalErrorReport.Builder builder =\n+                      MasterWorkerProtos.TaskFatalErrorReport.newBuilder()\n+                          .setErrorMessage(\"Duplicate Task Attempt: \" +\n+                          taskAttemptId);\n+                      master.fatalError(null, builder.build(), NullCallback.get());\n+                      continue;\n+                    }\n                     Path taskTempDir = localFS.makeQualified(\n                         lDirAllocator.getLocalPathForWrite(baseDir +\n                             \"/\" + taskAttemptId.getQueryUnitId().getId()\n                             + \"_\" + taskAttemptId.getId(), conf));\n \n                     Task2 task = new Task2(taskAttemptId, workerContext, master,\n                         new QueryUnitRequestImpl(taskRequest), taskTempDir);\n+                    tasks.put(taskAttemptId, task);\n                     task.init();\n                     if (task.hasFetchPhase()) {\n                       task.fetch(); // The fetch is performed in an asynchronous way.",
                "raw_url": "https://github.com/apache/tajo/raw/128d9c8904f5b1541575320a8f7309c5e4e67192/tajo-core/tajo-core-backend/src/main/java/tajo/worker/TaskRunner.java",
                "sha": "aea241c87bac02ec76129470db840bdf07632c2f",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/128d9c8904f5b1541575320a8f7309c5e4e67192/tajo-core/tajo-core-storage/src/main/java/tajo/storage/StorageManager.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-storage/src/main/java/tajo/storage/StorageManager.java?ref=128d9c8904f5b1541575320a8f7309c5e4e67192",
                "deletions": 4,
                "filename": "tajo-core/tajo-core-storage/src/main/java/tajo/storage/StorageManager.java",
                "patch": "@@ -77,11 +77,10 @@ public Path initTableBase(TableMeta meta, String tableName)\n \tpublic Path initLocalTableBase(Path tablePath, TableMeta meta) throws IOException {\n \t  FileSystem fs = FileSystem.getLocal(conf);\n     if (fs.exists(tablePath)) {\n-      //throw new AlreadyExistsStorageException(tablePath);\n-      fs.delete(tablePath, true);\n+      throw new AlreadyExistsStorageException(tablePath);\n+    } else {\n+      fs.mkdirs(tablePath);\n     }\n-\n-    fs.mkdirs(tablePath);\n     Path dataDir = new Path(tablePath,\"data\");\n \n     if (meta != null) {",
                "raw_url": "https://github.com/apache/tajo/raw/128d9c8904f5b1541575320a8f7309c5e4e67192/tajo-core/tajo-core-storage/src/main/java/tajo/storage/StorageManager.java",
                "sha": "c54f631bc603103dec9c89d0e5c6bf8adfe3e352",
                "status": "modified"
            }
        ],
        "message": "Fixed NPE bugs of Repartitioner.",
        "parent": "https://github.com/apache/tajo/commit/5b33b87c38a536949920c1955a9bb26e16c1e9c8",
        "patched_files": [
            "StorageManager.java",
            "TaskRunner.java",
            "Repartitioner.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestStorageManager.java",
            "TestRepartitioner.java",
            "TaskRunnerTest.java"
        ]
    },
    "tajo_1971d85": {
        "bug_id": "tajo_1971d85",
        "commit": "https://github.com/apache/tajo/commit/1971d85fce473da5cec407adecf89117253eca45",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/1971d85fce473da5cec407adecf89117253eca45/CHANGES",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=1971d85fce473da5cec407adecf89117253eca45",
                "deletions": 0,
                "filename": "CHANGES",
                "patch": "@@ -104,6 +104,9 @@ Release 0.11.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-1574: Fix NPE on natural join.\n+    (Contributed by Dongjoon Hyun, Committed by jihoon)\n+\n     TAJO-1581: Does not update last state of query stage in non-hash shuffle.\n     (jinho)\n ",
                "raw_url": "https://github.com/apache/tajo/raw/1971d85fce473da5cec407adecf89117253eca45/CHANGES",
                "sha": "7b16e11f104e0a8ed8c674cdf58778e92517d252",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/1971d85fce473da5cec407adecf89117253eca45/tajo-algebra/src/main/java/org/apache/tajo/algebra/Join.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-algebra/src/main/java/org/apache/tajo/algebra/Join.java?ref=1971d85fce473da5cec407adecf89117253eca45",
                "deletions": 1,
                "filename": "tajo-algebra/src/main/java/org/apache/tajo/algebra/Join.java",
                "patch": "@@ -96,7 +96,9 @@ public String toJson() {\n   public Object clone() throws CloneNotSupportedException {\n     Join join = (Join) super.clone();\n     join.joinType = joinType;\n-    join.joinQual = (Expr) joinQual.clone();\n+    if (joinQual != null) {\n+      join.joinQual = (Expr) joinQual.clone();\n+    }\n     if (joinColumns != null) {\n       join.joinColumns = new ColumnReferenceExpr[joinColumns.length];\n       for (ColumnReferenceExpr colume : joinColumns) {",
                "raw_url": "https://github.com/apache/tajo/raw/1971d85fce473da5cec407adecf89117253eca45/tajo-algebra/src/main/java/org/apache/tajo/algebra/Join.java",
                "sha": "6b3ce61d892cf23f0d77b8ac3d6b39c1d3edd970",
                "status": "modified"
            },
            {
                "additions": 13,
                "blob_url": "https://github.com/apache/tajo/blob/1971d85fce473da5cec407adecf89117253eca45/tajo-core/src/test/java/org/apache/tajo/engine/query/TestJoinQuery.java",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/java/org/apache/tajo/engine/query/TestJoinQuery.java?ref=1971d85fce473da5cec407adecf89117253eca45",
                "deletions": 0,
                "filename": "tajo-core/src/test/java/org/apache/tajo/engine/query/TestJoinQuery.java",
                "patch": "@@ -18,6 +18,7 @@\n \n package org.apache.tajo.engine.query;\n \n+import junit.framework.Assert;\n import org.apache.tajo.IntegrationTest;\n import org.apache.tajo.QueryTestCaseBase;\n import org.apache.tajo.TajoConstants;\n@@ -1191,4 +1192,16 @@ public final void testJoinWithOrPredicates() throws Exception {\n     assertResultSet(res);\n     cleanupQuery(res);\n   }\n+\n+  @Test\n+  public final void testNaturalJoin() throws Exception {\n+    ResultSet res = null;\n+    try {\n+      res = executeQuery();\n+    } catch (Exception e) {\n+      Assert.fail();\n+    }\n+    assertResultSet(res);\n+    cleanupQuery(res);\n+  }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/1971d85fce473da5cec407adecf89117253eca45/tajo-core/src/test/java/org/apache/tajo/engine/query/TestJoinQuery.java",
                "sha": "7ac25ea09c291c47cba71e4e90c888bdc2dc9ad5",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/1971d85fce473da5cec407adecf89117253eca45/tajo-core/src/test/resources/queries/TestJoinQuery/testNaturalJoin.sql",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/queries/TestJoinQuery/testNaturalJoin.sql?ref=1971d85fce473da5cec407adecf89117253eca45",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/queries/TestJoinQuery/testNaturalJoin.sql",
                "patch": "@@ -0,0 +1,3 @@\n+select n1.n_name, n2.n_name\n+from nation n1 natural join nation n2\n+order by n2.n_name;\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/1971d85fce473da5cec407adecf89117253eca45/tajo-core/src/test/resources/queries/TestJoinQuery/testNaturalJoin.sql",
                "sha": "fcbdcdc838d931e02e1df816cc6474be5022ca7f",
                "status": "added"
            },
            {
                "additions": 27,
                "blob_url": "https://github.com/apache/tajo/blob/1971d85fce473da5cec407adecf89117253eca45/tajo-core/src/test/resources/results/TestJoinQuery/testNaturalJoin.result",
                "changes": 27,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/results/TestJoinQuery/testNaturalJoin.result?ref=1971d85fce473da5cec407adecf89117253eca45",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/results/TestJoinQuery/testNaturalJoin.result",
                "patch": "@@ -0,0 +1,27 @@\n+n_name,n_name\n+-------------------------------\n+ALGERIA,ALGERIA\n+ARGENTINA,ARGENTINA\n+BRAZIL,BRAZIL\n+CANADA,CANADA\n+CHINA,CHINA\n+EGYPT,EGYPT\n+ETHIOPIA,ETHIOPIA\n+FRANCE,FRANCE\n+GERMANY,GERMANY\n+INDIA,INDIA\n+INDONESIA,INDONESIA\n+IRAN,IRAN\n+IRAQ,IRAQ\n+JAPAN,JAPAN\n+JORDAN,JORDAN\n+KENYA,KENYA\n+MOROCCO,MOROCCO\n+MOZAMBIQUE,MOZAMBIQUE\n+PERU,PERU\n+ROMANIA,ROMANIA\n+RUSSIA,RUSSIA\n+SAUDI ARABIA,SAUDI ARABIA\n+UNITED KINGDOM,UNITED KINGDOM\n+UNITED STATES,UNITED STATES\n+VIETNAM,VIETNAM\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/1971d85fce473da5cec407adecf89117253eca45/tajo-core/src/test/resources/results/TestJoinQuery/testNaturalJoin.result",
                "sha": "fa5a71ed0786941f2cb9ea3ed550d467c282cadd",
                "status": "added"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/1971d85fce473da5cec407adecf89117253eca45/tajo-plan/src/main/java/org/apache/tajo/plan/algebra/BaseAlgebraVisitor.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-plan/src/main/java/org/apache/tajo/plan/algebra/BaseAlgebraVisitor.java?ref=1971d85fce473da5cec407adecf89117253eca45",
                "deletions": 1,
                "filename": "tajo-plan/src/main/java/org/apache/tajo/plan/algebra/BaseAlgebraVisitor.java",
                "patch": "@@ -364,7 +364,9 @@ public RESULT visitGroupBy(CONTEXT ctx, Stack<Expr> stack, Aggregation expr) thr\n   @Override\n   public RESULT visitJoin(CONTEXT ctx, Stack<Expr> stack, Join expr) throws PlanningException {\n     stack.push(expr);\n-    visit(ctx, stack, expr.getQual());\n+    if (expr.getQual() != null) {\n+      visit(ctx, stack, expr.getQual());\n+    }\n     visit(ctx, stack, expr.getLeft());\n     RESULT result = visit(ctx, stack, expr.getRight());\n     stack.pop();",
                "raw_url": "https://github.com/apache/tajo/raw/1971d85fce473da5cec407adecf89117253eca45/tajo-plan/src/main/java/org/apache/tajo/plan/algebra/BaseAlgebraVisitor.java",
                "sha": "eb11f33e3cae2201f295301d6099881988965e22",
                "status": "modified"
            }
        ],
        "message": "TAJO-1574: Fix NPE on natural join.\n\nCloses #548\n\nSigned-off-by: Jihoon Son <jihoonson@apache.org>",
        "parent": "https://github.com/apache/tajo/commit/b50831ffa66d94b67a419a95f81beed8fcab8ba2",
        "patched_files": [
            "testNaturalJoin.sql",
            "Join.java",
            "CHANGES",
            "testNaturalJoin.result",
            "BaseAlgebraVisitor.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestJoinQuery.java"
        ]
    },
    "tajo_1cdbe46": {
        "bug_id": "tajo_1cdbe46",
        "commit": "https://github.com/apache/tajo/commit/1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac/CHANGES",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac",
                "deletions": 2,
                "filename": "CHANGES",
                "patch": "@@ -15,7 +15,8 @@ Release 0.9.1 - unreleased\n \n   IMPROVEMENT\n \n-    TAJO-1165: Needs to show error messages on query_executor.jsp. (Jihun Kang via jaehwa)\n+    TAJO-1165: Needs to show error messages on query_executor.jsp. \n+    (Jihun Kang via jaehwa)\n \n     TAJO-1204: Remove unused ServerName class. (DaeMyung Kang via jaehwa)\n \n@@ -79,6 +80,8 @@ Release 0.9.1 - unreleased\n \n   BUG FIXES\n \n+    TAJO-1190: INSERT INTO to partition tables may cause NPE. (hyunsik)\n+\n     TAJO-1211: Staging directory for CTAS and INSERT should be in \n     the output dir. (hyunsik)\n \n@@ -87,7 +90,8 @@ Release 0.9.1 - unreleased\n \n     TAJO-1119: JDBC driver should support TIMESTAMP type. (jaehwa)\n \n-    TAJO-1166: S3 related storage causes compilation error in Hadoop 2.6.0-SNAPSHOT. (jaehwa)\n+    TAJO-1166: S3 related storage causes compilation error in Hadoop \n+    2.6.0-SNAPSHOT. (jaehwa)\n \n     TAJO-1208: Failure of create table using textfile on hivemeta.\n     (jinho)",
                "raw_url": "https://github.com/apache/tajo/raw/1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac/CHANGES",
                "sha": "188e0242ffd0bbbdefbfae32bb57fea818ad2e1f",
                "status": "modified"
            },
            {
                "additions": 51,
                "blob_url": "https://github.com/apache/tajo/blob/1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/PhysicalPlanUtil.java",
                "changes": 65,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/PhysicalPlanUtil.java?ref=1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac",
                "deletions": 14,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/PhysicalPlanUtil.java",
                "patch": "@@ -77,31 +77,33 @@\n     Path path = new Path(tableDesc.getPath());\n     FileSystem fs = path.getFileSystem(tajoConf);\n \n+    //In the case of partitioned table, we should return same partition key data files.\n+    int partitionDepth = 0;\n+    if (tableDesc.hasPartition()) {\n+      partitionDepth = tableDesc.getPartitionMethod().getExpressionSchema().getColumns().size();\n+    }\n+\n     List<FileStatus> nonZeroLengthFiles = new ArrayList<FileStatus>();\n     if (fs.exists(path)) {\n       getNonZeroLengthDataFiles(fs, path, nonZeroLengthFiles, fileIndex, numResultFiles,\n-          new AtomicInteger(0));\n+          new AtomicInteger(0), tableDesc.hasPartition(), 0, partitionDepth);\n     }\n \n     List<FileFragment> fragments = new ArrayList<FileFragment>();\n \n-    //In the case of partitioned table, return same partition key data files.\n-    int numPartitionColumns = 0;\n-    if (tableDesc.hasPartition()) {\n-      numPartitionColumns = tableDesc.getPartitionMethod().getExpressionSchema().getColumns().size();\n-    }\n+\n     String[] previousPartitionPathNames = null;\n     for (FileStatus eachFile: nonZeroLengthFiles) {\n       FileFragment fileFragment = new FileFragment(tableDesc.getName(), eachFile.getPath(), 0, eachFile.getLen(), null);\n \n-      if (numPartitionColumns > 0) {\n+      if (partitionDepth > 0) {\n         // finding partition key;\n         Path filePath = fileFragment.getPath();\n         Path parentPath = filePath;\n-        String[] parentPathNames = new String[numPartitionColumns];\n-        for (int i = 0; i < numPartitionColumns; i++) {\n+        String[] parentPathNames = new String[partitionDepth];\n+        for (int i = 0; i < partitionDepth; i++) {\n           parentPath = parentPath.getParent();\n-          parentPathNames[numPartitionColumns - i - 1] = parentPath.getName();\n+          parentPathNames[partitionDepth - i - 1] = parentPath.getName();\n         }\n \n         // If current partitionKey == previousPartitionKey, add to result.\n@@ -120,27 +122,62 @@\n     return FragmentConvertor.toFragmentProtoArray(fragments.toArray(new FileFragment[]{}));\n   }\n \n+  /**\n+   *\n+   * @param fs\n+   * @param path The table path\n+   * @param result The final result files to be used\n+   * @param startFileIndex\n+   * @param numResultFiles\n+   * @param currentFileIndex\n+   * @param partitioned A flag to indicate if this table is partitioned\n+   * @param currentDepth Current visiting depth of partition directories\n+   * @param maxDepth The partition depth of this table\n+   * @throws IOException\n+   */\n   private static void getNonZeroLengthDataFiles(FileSystem fs, Path path, List<FileStatus> result,\n                                          int startFileIndex, int numResultFiles,\n-                                         AtomicInteger currentFileIndex) throws IOException {\n+                                         AtomicInteger currentFileIndex, boolean partitioned,\n+                                         int currentDepth, int maxDepth) throws IOException {\n+    // Intermediate directory\n     if (fs.isDirectory(path)) {\n+\n       FileStatus[] files = fs.listStatus(path, StorageManager.hiddenFileFilter);\n+\n       if (files != null && files.length > 0) {\n+\n         for (FileStatus eachFile : files) {\n+\n+          // checking if the enough number of files are found\n           if (result.size() >= numResultFiles) {\n             return;\n           }\n+\n           if (eachFile.isDirectory()) {\n-            getNonZeroLengthDataFiles(fs, eachFile.getPath(), result, startFileIndex, numResultFiles,\n-                currentFileIndex);\n-          } else if (eachFile.isFile() && eachFile.getLen() > 0) {\n+            getNonZeroLengthDataFiles(\n+                fs,\n+                eachFile.getPath(),\n+                result,\n+                startFileIndex,\n+                numResultFiles,\n+                currentFileIndex,\n+                partitioned,\n+                currentDepth + 1, // increment a visiting depth\n+                maxDepth);\n+\n+\n+            // if partitioned table, we should ignore files located in the intermediate directory.\n+            // we can ensure that this file is in leaf directory if currentDepth == maxDepth.\n+          } else if (eachFile.isFile() && eachFile.getLen() > 0 && (!partitioned || currentDepth == maxDepth)) {\n             if (currentFileIndex.get() >= startFileIndex) {\n               result.add(eachFile);\n             }\n             currentFileIndex.incrementAndGet();\n           }\n         }\n       }\n+\n+      // Files located in leaf directory\n     } else {\n       FileStatus fileStatus = fs.getFileStatus(path);\n       if (fileStatus != null && fileStatus.getLen() > 0) {",
                "raw_url": "https://github.com/apache/tajo/raw/1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/PhysicalPlanUtil.java",
                "sha": "a63b838e4ebe89729c780a2f6d40e794b0c94a1f",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/SeqScanExec.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/SeqScanExec.java?ref=1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac",
                "deletions": 1,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/SeqScanExec.java",
                "patch": "@@ -332,7 +332,12 @@ public TableStats getInputStats() {\n     if (scanner != null) {\n       return scanner.getInputStats();\n     } else {\n-      return inputStats;\n+      if (inputStats != null) {\n+        return inputStats;\n+      } else {\n+        // If no fragment, there is no scanner. So, we need to create a dummy table stat.\n+        return new TableStats();\n+      }\n     }\n   }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/SeqScanExec.java",
                "sha": "759b19c6abdafd10f3ea9c5b48d1c8f47289fb2c",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/tajo/blob/1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac/tajo-core/src/main/java/org/apache/tajo/worker/TajoWorkerClientService.java",
                "changes": 16,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/worker/TajoWorkerClientService.java?ref=1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac",
                "deletions": 7,
                "filename": "tajo-core/src/main/java/org/apache/tajo/worker/TajoWorkerClientService.java",
                "patch": "@@ -32,15 +32,14 @@\n import org.apache.tajo.TajoIdProtos;\n import org.apache.tajo.TajoProtos;\n import org.apache.tajo.conf.TajoConf;\n+import org.apache.tajo.engine.query.QueryContext;\n import org.apache.tajo.ipc.ClientProtos;\n import org.apache.tajo.ipc.ClientProtos.GetQueryHistoryResponse;\n import org.apache.tajo.ipc.ClientProtos.QueryIdRequest;\n import org.apache.tajo.ipc.ClientProtos.ResultCode;\n import org.apache.tajo.ipc.QueryMasterClientProtocol;\n import org.apache.tajo.ipc.TajoWorkerProtocol;\n import org.apache.tajo.master.querymaster.Query;\n-import org.apache.tajo.master.querymaster.QueryInProgress;\n-import org.apache.tajo.master.querymaster.QueryJobManager;\n import org.apache.tajo.master.querymaster.QueryMasterTask;\n import org.apache.tajo.rpc.BlockingRpcServer;\n import org.apache.tajo.rpc.protocolrecords.PrimitiveProtos;\n@@ -132,6 +131,10 @@ public InetSocketAddress getBindAddr() {\n       return null;\n     }\n \n+    private boolean hasResultTableDesc(QueryContext queryContext) {\n+      return !(queryContext.isCreateTable() || queryContext.isInsert());\n+    }\n+\n     @Override\n     public ClientProtos.GetQueryResultResponse getQueryResult(\n             RpcController controller,\n@@ -151,7 +154,9 @@ public InetSocketAddress getBindAddr() {\n       } else {\n         switch (queryMasterTask.getState()) {\n           case QUERY_SUCCEEDED:\n-            builder.setTableDesc(queryMasterTask.getQuery().getResultDesc().getProto());\n+//            if (hasResultTableDesc(queryMasterTask.getQueryTaskContext().getQueryContext())) {\n+              builder.setTableDesc(queryMasterTask.getQuery().getResultDesc().getProto());\n+            //}\n             break;\n           case QUERY_FAILED:\n           case QUERY_ERROR:\n@@ -191,10 +196,7 @@ public InetSocketAddress getBindAddr() {\n           return builder.build();\n         }\n \n-        builder.setHasResult(\n-            !(queryMasterTask.getQueryTaskContext().getQueryContext().isCreateTable() ||\n-                queryMasterTask.getQueryTaskContext().getQueryContext().isInsert())\n-        );\n+        builder.setHasResult(hasResultTableDesc(queryMasterTask.getQueryTaskContext().getQueryContext()));\n \n         queryMasterTask.touchSessionTime();\n         Query query = queryMasterTask.getQuery();",
                "raw_url": "https://github.com/apache/tajo/raw/1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac/tajo-core/src/main/java/org/apache/tajo/worker/TajoWorkerClientService.java",
                "sha": "0f4a60cb7e865fc18fa26afefafcbfafa9128bc2",
                "status": "modified"
            },
            {
                "additions": 56,
                "blob_url": "https://github.com/apache/tajo/blob/1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac/tajo-core/src/test/java/org/apache/tajo/engine/query/TestTablePartitions.java",
                "changes": 56,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/java/org/apache/tajo/engine/query/TestTablePartitions.java?ref=1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac",
                "deletions": 0,
                "filename": "tajo-core/src/test/java/org/apache/tajo/engine/query/TestTablePartitions.java",
                "patch": "@@ -19,6 +19,7 @@\n package org.apache.tajo.engine.query;\n \n import com.google.common.collect.Maps;\n+import org.apache.hadoop.fs.FSDataOutputStream;\n import org.apache.hadoop.fs.FileStatus;\n import org.apache.hadoop.fs.FileSystem;\n import org.apache.hadoop.fs.Path;\n@@ -43,6 +44,7 @@\n import org.apache.tajo.master.querymaster.QueryMasterTask;\n import org.apache.tajo.plan.logical.NodeType;\n import org.apache.tajo.storage.StorageConstants;\n+import org.apache.tajo.util.CommonTestingUtil;\n import org.apache.tajo.util.KeyValueSet;\n import org.apache.tajo.worker.TajoWorker;\n import org.junit.Test;\n@@ -820,6 +822,39 @@ public final void testColumnPartitionedTableWithSmallerExpressions3() throws Exc\n     }\n   }\n \n+  @Test\n+  public final void testColumnPartitionedTableWithSmallerExpressions5() throws Exception {\n+    String tableName = CatalogUtil.normalizeIdentifier(\"testColumnPartitionedTableWithSmallerExpressions5\");\n+    ResultSet res = executeString(\n+        \"create table \" + tableName + \" (col1 text) partition by column(col2 text) \");\n+    res.close();\n+\n+    assertTrue(catalog.existsTable(DEFAULT_DATABASE_NAME, tableName));\n+\n+    res = executeString(\"insert overwrite into \" + tableName + \"(col1) select l_returnflag from lineitem\");\n+    res.close();\n+    res = executeString(\"select * from \" + tableName);\n+    assertResultSet(res);\n+    res.close();\n+  }\n+\n+  @Test\n+  public final void testColumnPartitionedTableWithSmallerExpressions6() throws Exception {\n+    String tableName = CatalogUtil.normalizeIdentifier(\"testColumnPartitionedTableWithSmallerExpressions6\");\n+    ResultSet res = executeString(\n+        \"create table \" + tableName + \" (col1 text) partition by column(col2 text) \");\n+    res.close();\n+\n+    assertTrue(catalog.existsTable(DEFAULT_DATABASE_NAME, tableName));\n+\n+    res = executeString(\n+        \"insert overwrite into \" + tableName + \"(col1) select l_returnflag from lineitem where l_orderkey = 1\");\n+    res.close();\n+    res = executeString(\"select * from \" + tableName);\n+    assertResultSet(res);\n+    res.close();\n+  }\n+\n   private MasterPlan getQueryPlan(ResultSet res) {\n     QueryId queryId = ((TajoResultSet)res).getQueryId();\n     for (TajoWorker eachWorker: testingCluster.getTajoWorkers()) {\n@@ -936,4 +971,25 @@ public final void TestSpecialCharPartitionKeys2() throws Exception {\n     assertResultSet(res);\n     cleanupQuery(res);\n   }\n+\n+  @Test\n+  public final void testIgnoreFilesInIntermediateDir() throws Exception {\n+    // See - TAJO-1219: Files located in intermediate directories of partitioned table should be ignored\n+    // It verifies that Tajo ignores files located in intermediate directories of partitioned table.\n+\n+    Path testDir = CommonTestingUtil.getTestDir();\n+\n+    executeString(\n+        \"CREATE EXTERNAL TABLE testIgnoreFilesInIntermediateDir (col1 int) USING CSV PARTITION BY COLUMN (col2 text) \" +\n+        \"LOCATION '\" + testDir + \"'\");\n+\n+    FileSystem fs = testDir.getFileSystem(conf);\n+    FSDataOutputStream fos = fs.create(new Path(testDir, \"table1.data\"));\n+    fos.write(\"a|b|c\".getBytes());\n+    fos.close();\n+\n+    ResultSet res = executeString(\"select * from testIgnoreFilesInIntermediateDir;\");\n+    assertFalse(res.next());\n+    res.close();\n+  }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac/tajo-core/src/test/java/org/apache/tajo/engine/query/TestTablePartitions.java",
                "sha": "cff5bfb719c23ef4b1982a5b4e422fbf994f890d",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tajo/blob/1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac/tajo-core/src/test/resources/results/TestTablePartitions/testColumnPartitionedTableWithSmallerExpressions5.result",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/results/TestTablePartitions/testColumnPartitionedTableWithSmallerExpressions5.result?ref=1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/results/TestTablePartitions/testColumnPartitionedTableWithSmallerExpressions5.result",
                "patch": "@@ -0,0 +1,7 @@\n+col1,col2\n+-------------------------------\n+N,__TAJO_DEFAULT_PARTITION__\n+N,__TAJO_DEFAULT_PARTITION__\n+N,__TAJO_DEFAULT_PARTITION__\n+R,__TAJO_DEFAULT_PARTITION__\n+R,__TAJO_DEFAULT_PARTITION__\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac/tajo-core/src/test/resources/results/TestTablePartitions/testColumnPartitionedTableWithSmallerExpressions5.result",
                "sha": "f9727530487bd0af3496c17c104b0a5e4937e068",
                "status": "added"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac/tajo-core/src/test/resources/results/TestTablePartitions/testColumnPartitionedTableWithSmallerExpressions6.result",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/results/TestTablePartitions/testColumnPartitionedTableWithSmallerExpressions6.result?ref=1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/results/TestTablePartitions/testColumnPartitionedTableWithSmallerExpressions6.result",
                "patch": "@@ -0,0 +1,4 @@\n+col1,col2\n+-------------------------------\n+N,__TAJO_DEFAULT_PARTITION__\n+N,__TAJO_DEFAULT_PARTITION__\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac/tajo-core/src/test/resources/results/TestTablePartitions/testColumnPartitionedTableWithSmallerExpressions6.result",
                "sha": "6b8e2f1bda3e94a388ec9940af35bb7346cf257a",
                "status": "added"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tajo/blob/1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac/tajo-rpc/src/main/java/org/apache/tajo/rpc/RemoteCallException.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-rpc/src/main/java/org/apache/tajo/rpc/RemoteCallException.java?ref=1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac",
                "deletions": 1,
                "filename": "tajo-rpc/src/main/java/org/apache/tajo/rpc/RemoteCallException.java",
                "patch": "@@ -49,7 +49,11 @@ public RemoteCallException(int seqId, Throwable t) {\n   public RpcResponse getResponse() {\n     RpcResponse.Builder builder = RpcResponse.newBuilder();\n     builder.setId(seqId);\n-    builder.setErrorMessage(getCause().getMessage());\n+    if (getCause().getMessage() == null) {\n+      builder.setErrorMessage(getCause().getClass().getName());\n+    } else {\n+      builder.setErrorMessage(getCause().getMessage());\n+    }\n     builder.setErrorTrace(getStackTraceString(getCause()));\n     builder.setErrorClass(originExceptionClass);\n ",
                "raw_url": "https://github.com/apache/tajo/raw/1cdbe467e3dc25d7af59afc116ff9e8e6273a1ac/tajo-rpc/src/main/java/org/apache/tajo/rpc/RemoteCallException.java",
                "sha": "52ef31ab7bcca2e0ded741daf8cc5c3d706d7418",
                "status": "modified"
            }
        ],
        "message": "TAJO-1190: INSERT INTO to partition tables may cause NPE.\n\nCloses #250",
        "parent": "https://github.com/apache/tajo/commit/b4adc18cd25de550fe04a43ef69d715c146976db",
        "patched_files": [
            "testColumnPartitionedTableWithSmallerExpressions5.result",
            "testColumnPartitionedTableWithSmallerExpressions6.result",
            "SeqScanExec.java",
            "TajoWorkerClientService.java",
            "CHANGES",
            "PhysicalPlanUtil.java",
            "RemoteCallException.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestTablePartitions.java"
        ]
    },
    "tajo_1cdd018": {
        "bug_id": "tajo_1cdd018",
        "commit": "https://github.com/apache/tajo/commit/1cdd018d92f0400ffbfc09d07a1dfd18d9b13d87",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/1cdd018d92f0400ffbfc09d07a1dfd18d9b13d87/CHANGES",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=1cdd018d92f0400ffbfc09d07a1dfd18d9b13d87",
                "deletions": 0,
                "filename": "CHANGES",
                "patch": "@@ -255,6 +255,8 @@ Release 0.11.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-1829: Fix DelimitedTextFileAppender NPE in negative tests. (jinho)\n+\n     TAJO-1674: Validation of CTAS schema mismatch. (hyunsik)\n \n     TAJO-1819: Cannot find existing tables when pgsql catalog starts up. ",
                "raw_url": "https://github.com/apache/tajo/raw/1cdd018d92f0400ffbfc09d07a1dfd18d9b13d87/CHANGES",
                "sha": "303dbe38e06f7a905ec24b9fa443115d1dcee99a",
                "status": "modified"
            },
            {
                "additions": 24,
                "blob_url": "https://github.com/apache/tajo/blob/1cdd018d92f0400ffbfc09d07a1dfd18d9b13d87/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/text/DelimitedTextFile.java",
                "changes": 43,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/text/DelimitedTextFile.java?ref=1cdd018d92f0400ffbfc09d07a1dfd18d9b13d87",
                "deletions": 19,
                "filename": "tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/text/DelimitedTextFile.java",
                "patch": "@@ -137,6 +137,22 @@ public void init() throws IOException {\n         throw new FileNotFoundException(path.toString());\n       }\n \n+      if (enabledStats) {\n+        this.stats = new TableStatistics(this.schema);\n+      }\n+\n+      if(serializer != null) {\n+        serializer.release();\n+      }\n+      serializer = getLineSerde().createSerializer(schema, meta);\n+      serializer.init();\n+\n+      bufferSize = conf.getInt(WRITE_BUFFER_SIZE, DEFAULT_BUFFER_SIZE);\n+      if (os == null) {\n+        os = new NonSyncByteArrayOutputStream(bufferSize);\n+      }\n+      os.reset();\n+\n       if (this.meta.containsOption(StorageConstants.COMPRESSION_CODEC)) {\n         String codecName = this.meta.getOption(StorageConstants.COMPRESSION_CODEC);\n         codecFactory = new CompressionCodecFactory(conf);\n@@ -163,19 +179,6 @@ public void init() throws IOException {\n         outputStream = new DataOutputStream(new BufferedOutputStream(fos));\n       }\n \n-      if (enabledStats) {\n-        this.stats = new TableStatistics(this.schema);\n-      }\n-\n-      serializer = getLineSerde().createSerializer(schema, meta);\n-      serializer.init();\n-\n-      bufferSize = conf.getInt(WRITE_BUFFER_SIZE, DEFAULT_BUFFER_SIZE);\n-      if (os == null) {\n-        os = new NonSyncByteArrayOutputStream(bufferSize);\n-      }\n-\n-      os.reset();\n       pos = fos.getPos();\n       bufferedBytes = 0;\n       super.init();\n@@ -219,20 +222,22 @@ public long getOffset() throws IOException {\n \n     @Override\n     public void flush() throws IOException {\n-      flushBuffer();\n-      outputStream.flush();\n+      if(inited) {\n+        flushBuffer();\n+        outputStream.flush();\n+      }\n     }\n \n     @Override\n     public void close() throws IOException {\n \n       try {\n-        serializer.release();\n-\n-        if(outputStream != null){\n-          flush();\n+        if(serializer != null) {\n+          serializer.release();\n         }\n \n+        flush();\n+\n         // Statistical section\n         if (enabledStats) {\n           stats.setNumBytes(getOffset());",
                "raw_url": "https://github.com/apache/tajo/raw/1cdd018d92f0400ffbfc09d07a1dfd18d9b13d87/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/text/DelimitedTextFile.java",
                "sha": "bc1d7ba9ba3c2cfa00b5f13fb899a28c148b3c07",
                "status": "modified"
            }
        ],
        "message": "TAJO-1829: Fix DelimitedTextFileAppender NPE in negative tests.\n\nCloses #747",
        "parent": "https://github.com/apache/tajo/commit/c66d0b4708814ed8f7a1ae530338e1fcf87caddc",
        "patched_files": [
            "DelimitedTextFile.java",
            "CHANGES"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestDelimitedTextFile.java"
        ]
    },
    "tajo_22a9fe0": {
        "bug_id": "tajo_22a9fe0",
        "commit": "https://github.com/apache/tajo/commit/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/conf/tajo-site.xml",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/conf/tajo-site.xml?ref=22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
                "deletions": 1,
                "filename": "engine/conf/tajo-site.xml",
                "patch": "@@ -4,7 +4,7 @@\n <configuration>\n <property>\n   <name>engine.rootdir</name>\n-  <value>file:///tmp/tazo-${user.name}</value>\n+  <value>file:///tmp/tajo-${user.name}</value>\n   <description>A base for other temporary directories.</description>\n </property>\n ",
                "raw_url": "https://github.com/apache/tajo/raw/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/conf/tajo-site.xml",
                "sha": "2bd0c6ad15399a5e853a5203184bb9c46c2c4e80",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tajo/blob/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/main/findbugs/findbugs-exclude.xml",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/findbugs/findbugs-exclude.xml?ref=22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
                "deletions": 2,
                "filename": "engine/src/main/findbugs/findbugs-exclude.xml",
                "patch": "@@ -1,5 +1,8 @@\n <FindBugsFilter>\n      <Match>\n-\t\t<Package name=\"~nta\\.query\\.parser\" />\n+\t\t<Package name=\"~nta\\.engine\\.parser\" />\n \t</Match>\n-</FindBugsFilter>\n\\ No newline at end of file\n+\t<Match>\n+\t\t<Class name=\"~.*\\.*Protos\" />\n+\t</Match>\n+</FindBugsFilter>",
                "raw_url": "https://github.com/apache/tajo/raw/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/main/findbugs/findbugs-exclude.xml",
                "sha": "e3cf54ca4dfa94e58ddc99203ddad0cecbb98925",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tajo/blob/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/main/java/nta/catalog/Schema.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/catalog/Schema.java?ref=22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
                "deletions": 0,
                "filename": "engine/src/main/java/nta/catalog/Schema.java",
                "patch": "@@ -87,6 +87,16 @@ public int getColumnId(String colName) {\n \t  initColumns();\n \t  return fieldsByName.get(colName.toLowerCase());\n \t}\n+\n+  public int getColumnIdByName(String colName) {\n+    initColumns();\n+    for (Column col : fields) {\n+      if (col.getColumnName().equals(colName.toLowerCase())) {\n+        return fieldsByName.get(col.getQualifiedName());\n+      }\n+    }\n+    return -1;\n+  }\n \t\n \tpublic Collection<Column> getColumns() {\n \t\tinitColumns();",
                "raw_url": "https://github.com/apache/tajo/raw/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/main/java/nta/catalog/Schema.java",
                "sha": "ee797a2de4e861557f80414be1009b7aea0ecf9c",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/main/java/nta/engine/parser/QueryAnalyzer.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/parser/QueryAnalyzer.java?ref=22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
                "deletions": 0,
                "filename": "engine/src/main/java/nta/engine/parser/QueryAnalyzer.java",
                "patch": "@@ -832,6 +832,9 @@ public EvalNode createEvalTree(final Context ctx,\n     case NQLParser.REAL:\n       return new ConstEval(DatumFactory.createDouble(\n           Double.valueOf(ast.getText())));\n+\n+    case NQLParser.STRING:\n+      return new ConstEval(DatumFactory.createString(ast.getText()));\n     \n     case NQLParser.AND:\n       return new BinaryEval(Type.AND, createEvalTree(ctx, ast.getChild(0), query), ",
                "raw_url": "https://github.com/apache/tajo/raw/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/main/java/nta/engine/parser/QueryAnalyzer.java",
                "sha": "c03d3369972537cee49841ce087a06b378c74079",
                "status": "modified"
            },
            {
                "additions": 64,
                "blob_url": "https://github.com/apache/tajo/blob/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/main/java/nta/engine/planner/LogicalOptimizer.java",
                "changes": 91,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/planner/LogicalOptimizer.java?ref=22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
                "deletions": 27,
                "filename": "engine/src/main/java/nta/engine/planner/LogicalOptimizer.java",
                "patch": "@@ -70,12 +70,12 @@ public static LogicalNode optimize(Context ctx, LogicalNode plan) {\n     //case INTERSECT:\n     case CREATE_TABLE:\n       // if there are selection node \n+      pushProjection(ctx, toBeOptimized);\n+\n       if(PlannerUtil.findTopNode(plan, ExprType.SELECTION) != null) {\n         pushSelection(ctx, toBeOptimized);\n       }\n       \n-      pushProjection(ctx, toBeOptimized);\n-      \n       break;\n     default:\n     }\n@@ -130,25 +130,25 @@ private static void pushSelection(Context ctx, LogicalNode plan) {\n     Preconditions.checkNotNull(selNode);\n     \n     Stack<LogicalNode> stack = new Stack<LogicalNode>();\n-    EvalNode [] cnfs = EvalTreeUtil.getConjNormalForm(selNode.getQual());\n-    pushSelectionRecursive(ctx, plan, Lists.newArrayList(cnfs), stack);\n+    EvalNode [] cnf = EvalTreeUtil.getConjNormalForm(selNode.getQual());\n+    pushSelectionRecursive(ctx, plan, Lists.newArrayList(cnf), stack);\n   }\n   \n   private static void pushSelectionRecursive(Context ctx, LogicalNode plan,\n-      List<EvalNode> evalTrees, Stack<LogicalNode> stack) {\n+      List<EvalNode> cnf, Stack<LogicalNode> stack) {\n     \n     switch(plan.getType()) {\n     \n     case SELECTION:\n       SelectionNode selNode = (SelectionNode) plan;\n       stack.push(selNode);\n       pushSelectionRecursive(ctx, selNode.getSubNode(),\n-          evalTrees, stack);\n+          cnf, stack);\n       stack.pop();\n       \n       // remove the selection operator if there is no search condition \n       // after selection push.\n-      if(evalTrees.size() == 0) {\n+      if(cnf.size() == 0) {\n         LogicalNode node = stack.peek();\n         if (node instanceof UnaryNode) {\n           UnaryNode unary = (UnaryNode) node;\n@@ -158,26 +158,33 @@ private static void pushSelectionRecursive(Context ctx, LogicalNode plan,\n         }\n       }\n       break;\n-    case SCAN:\n-    case JOIN:      \n+    case JOIN:\n+      JoinNode join = (JoinNode) plan;\n+\n+      LogicalNode outer = join.getOuterNode();\n+      LogicalNode inner = join.getInnerNode();\n+\n+      pushSelectionRecursive(ctx, outer, cnf, stack);\n+      pushSelectionRecursive(ctx, inner, cnf, stack);\n+\n       List<EvalNode> matched = Lists.newArrayList();\n-      for (EvalNode eval : evalTrees) {\n+      for (EvalNode eval : cnf) {\n         if (selectionPushable(eval, plan)) {\n           matched.add(eval);\n         }\n       }\n-      EvalNode qual;\n+\n+      EvalNode qual = null;\n       if (matched.size() > 1) {\n+        // merged into one eval tree\n         qual = EvalTreeUtil.transformCNF2Singleton(\n             matched.toArray(new EvalNode [matched.size()]));\n-      } else {\n+      } else if (matched.size() == 1) {\n+        // if the number of matched expr is one\n         qual = matched.get(0);\n       }\n-      \n-      if (plan.getType() == ExprType.SCAN) {\n-        ScanNode scanNode = (ScanNode) plan;\n-        scanNode.setQual(qual);\n-      } else if (plan.getType() == ExprType.JOIN) {\n+\n+      if (qual != null) {\n         JoinNode joinNode = (JoinNode) plan;\n         if (joinNode.hasJoinQual()) {\n           EvalNode conjQual = EvalTreeUtil.\n@@ -186,19 +193,46 @@ private static void pushSelectionRecursive(Context ctx, LogicalNode plan,\n         } else {\n           joinNode.setJoinQual(qual);\n         }\n-      }      \n-      evalTrees.removeAll(matched);      \n+        cnf.removeAll(matched);\n+      }\n+\n       break;\n-      \n+\n+    case SCAN:\n+      matched = Lists.newArrayList();\n+      for (EvalNode eval : cnf) {\n+        if (selectionPushable(eval, plan)) {\n+          matched.add(eval);\n+        }\n+      }\n+\n+      qual = null;\n+      if (matched.size() > 1) {\n+        // merged into one eval tree\n+        qual = EvalTreeUtil.transformCNF2Singleton(\n+            matched.toArray(new EvalNode [matched.size()]));\n+      } else if (matched.size() == 1) {\n+        // if the number of matched expr is one\n+        qual = matched.get(0);\n+      }\n+\n+      if (qual != null) { // if a matched qual exists\n+        ScanNode scanNode = (ScanNode) plan;\n+        scanNode.setQual(qual);\n+      }\n+\n+      cnf.removeAll(matched);\n+      break;\n+\n     default:\n       stack.push(plan);\n       if (plan instanceof UnaryNode) {\n         UnaryNode unary = (UnaryNode) plan;\n-        pushSelectionRecursive(ctx, unary.getSubNode(), evalTrees, stack);\n+        pushSelectionRecursive(ctx, unary.getSubNode(), cnf, stack);\n       } else if (plan instanceof BinaryNode) {\n         BinaryNode binary = (BinaryNode) plan;\n-        pushSelectionRecursive(ctx, binary.getOuterNode(), evalTrees, stack);\n-        pushSelectionRecursive(ctx, binary.getInnerNode(), evalTrees, stack);\n+        pushSelectionRecursive(ctx, binary.getOuterNode(), cnf, stack);\n+        pushSelectionRecursive(ctx, binary.getInnerNode(), cnf, stack);\n       }\n       stack.pop();\n       break;\n@@ -232,18 +266,21 @@ public static boolean selectionPushable(EvalNode eval, LogicalNode node) {\n         return false;\n       }\n       \n-      String outer = PlannerUtil.getLineage(joinNode.getOuterNode());\n-      String inner = PlannerUtil.getLineage(joinNode.getInnerNode());\n+      String [] outer = PlannerUtil.getLineage(joinNode.getOuterNode());\n+      String [] inner = PlannerUtil.getLineage(joinNode.getInnerNode());\n+\n+      Set<String> o = Sets.newHashSet(outer);\n+      Set<String> i = Sets.newHashSet(inner);\n       if (outer == null || inner == null) {      \n         throw new InvalidQueryException(\"ERROR: Unexpected logical plan\");\n       }\n       Iterator<String> it = tableIds.iterator();\n-      if (it.next().equals(outer) && it.next().equals(inner)) {\n+      if (o.contains(it.next()) && i.contains(it.next())) {\n         return true;\n       }\n       \n       it = tableIds.iterator();\n-      if (it.next().equals(inner) && it.next().equals(outer)) {\n+      if (i.contains(it.next()) && o.contains(it.next())) {\n         return true;\n       }\n       ",
                "raw_url": "https://github.com/apache/tajo/raw/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/main/java/nta/engine/planner/LogicalOptimizer.java",
                "sha": "e77cd27df5454e6823daf49329d88dc675cc4091",
                "status": "modified"
            },
            {
                "additions": 40,
                "blob_url": "https://github.com/apache/tajo/blob/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/main/java/nta/engine/planner/PlannerUtil.java",
                "changes": 48,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/planner/PlannerUtil.java?ref=22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
                "deletions": 8,
                "filename": "engine/src/main/java/nta/engine/planner/PlannerUtil.java",
                "patch": "@@ -59,9 +59,20 @@ public static LogicalNode refreshSchema(LogicalNode plan) {\n     return plan;\n   }\n   \n-  public static String getLineage(LogicalNode node) {\n-    ScanNode scanNode = (ScanNode) PlannerUtil.findTopNode(node, ExprType.SCAN);\n-    return scanNode.getTableId();\n+  public static String [] getLineage(LogicalNode node) {\n+    LogicalNode [] scans =  PlannerUtil.findAllNodes(node, ExprType.SCAN);\n+    String [] tableNames = new String[scans.length];\n+    String name;\n+    ScanNode scan;\n+    for (int i = 0; i < scans.length; i++) {\n+      scan = (ScanNode) scans[i];\n+      /*if (scan.hasAlias()) {\n+        tableNames[i] = scan.getAlias();\n+      } else {*/\n+        tableNames[i] = scan.getTableId();\n+      //}\n+    }\n+    return tableNames;\n   }\n   \n   public static LogicalNode insertNode(LogicalNode parent, LogicalNode newNode) {\n@@ -227,24 +238,45 @@ private static LogicalNode insertStore(LogicalNode parent,\n   }\n   \n   /**\n-   * Find the top node of the given plan\n+   * Find the top logical node matched to type from the given node\n    * \n-   * @param plan\n+   * @param node\n    * @param type to find\n    * @return a found logical node\n    */\n-  public static LogicalNode findTopNode(LogicalNode plan, ExprType type) {\n-    Preconditions.checkNotNull(plan);\n+  public static LogicalNode findTopNode(LogicalNode node, ExprType type) {\n+    Preconditions.checkNotNull(node);\n     Preconditions.checkNotNull(type);\n     \n     LogicalNodeFinder finder = new LogicalNodeFinder(type);\n-    plan.postOrder(finder);\n+    node.postOrder(finder);\n     \n     if (finder.getFoundNodes().size() == 0) {\n       return null;\n     }\n     return finder.getFoundNodes().get(0);\n   }\n+\n+  /**\n+   * Find the all logical node matched to type from the given node\n+   *\n+   * @param node\n+   * @param type to find\n+   * @return a found logical node\n+   */\n+  public static LogicalNode [] findAllNodes(LogicalNode node, ExprType type) {\n+    Preconditions.checkNotNull(node);\n+    Preconditions.checkNotNull(type);\n+\n+    LogicalNodeFinder finder = new LogicalNodeFinder(type);\n+    node.postOrder(finder);\n+\n+    if (finder.getFoundNodes().size() == 0) {\n+      return new LogicalNode[] {};\n+    }\n+    List<LogicalNode> founds = finder.getFoundNodes();\n+    return founds.toArray(new LogicalNode[founds.size()]);\n+  }\n   \n   /**\n    * Find a parent node of a given-typed operator.",
                "raw_url": "https://github.com/apache/tajo/raw/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/main/java/nta/engine/planner/PlannerUtil.java",
                "sha": "8101edffc80afbfea9073a80588470593fb15994",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/main/java/nta/engine/query/ResultSetImpl.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/query/ResultSetImpl.java?ref=22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
                "deletions": 1,
                "filename": "engine/src/main/java/nta/engine/query/ResultSetImpl.java",
                "patch": "@@ -204,7 +204,7 @@ public void deleteRow() throws SQLException {\n    */\n   @Override\n   public int findColumn(String colName) throws SQLException {\n-    return this.meta.getSchema().getColumnId(colName);\n+    return this.meta.getSchema().getColumnIdByName(colName);\n   }\n \n   /* (non-Javadoc)",
                "raw_url": "https://github.com/apache/tajo/raw/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/main/java/nta/engine/query/ResultSetImpl.java",
                "sha": "31f73ce0fbcef2d8b5fbc7db6b9be3275d16e4de",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/main/java/nta/storage/CSVFile2.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/storage/CSVFile2.java?ref=22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
                "deletions": 1,
                "filename": "engine/src/main/java/nta/storage/CSVFile2.java",
                "patch": "@@ -35,7 +35,7 @@\n  */\n public class CSVFile2 extends Storage {\n   public static final String DELIMITER = \"csvfile.delimiter\";\n-  public static final String DELIMITER_DEFAULT = \",\";\n+  public static final String DELIMITER_DEFAULT = \"|\";\n   private static final Log LOG = LogFactory.getLog(CSVFile2.class);\n \n   public CSVFile2(Configuration conf) {",
                "raw_url": "https://github.com/apache/tajo/raw/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/main/java/nta/storage/CSVFile2.java",
                "sha": "bca1983023731a23a8ae86554afb0fbc25c2b305",
                "status": "modified"
            },
            {
                "additions": 34,
                "blob_url": "https://github.com/apache/tajo/blob/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/main/java/tajo/client/ResultSetUtil.java",
                "changes": 34,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/tajo/client/ResultSetUtil.java?ref=22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
                "deletions": 0,
                "filename": "engine/src/main/java/tajo/client/ResultSetUtil.java",
                "patch": "@@ -0,0 +1,34 @@\n+package tajo.client;\n+\n+import java.sql.ResultSet;\n+import java.sql.ResultSetMetaData;\n+import java.sql.SQLException;\n+\n+/**\n+ * @author Hyunsik Choi\n+ */\n+public class ResultSetUtil {\n+  public static String prettyFormat(ResultSet res) throws SQLException {\n+    StringBuilder sb = new StringBuilder();\n+    ResultSetMetaData rsmd = res.getMetaData();\n+    int numOfColumns = rsmd.getColumnCount();\n+\n+    for (int i = 1; i <= numOfColumns; i++) {\n+      if (i > 1) sb.append(\",  \");\n+      String columnName = rsmd.getColumnName(i);\n+      sb.append(columnName);\n+    }\n+    sb.append(\"\\n-------------------------------\\n\");\n+\n+    while (res.next()) {\n+      for (int i = 1; i <= numOfColumns; i++) {\n+        if (i > 1) sb.append(\",  \");\n+        String columnValue = res.getObject(i).toString();\n+        sb.append(columnValue);\n+      }\n+      sb.append(\"\\n\");\n+    }\n+\n+    return sb.toString();\n+  }\n+}",
                "raw_url": "https://github.com/apache/tajo/raw/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/main/java/tajo/client/ResultSetUtil.java",
                "sha": "a61ddcf64b9bc8545044e0bd93c81e4e960e45a4",
                "status": "added"
            },
            {
                "additions": 16,
                "blob_url": "https://github.com/apache/tajo/blob/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/test/java/nta/engine/parser/TestNQLParser.java",
                "changes": 18,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/nta/engine/parser/TestNQLParser.java?ref=22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
                "deletions": 2,
                "filename": "engine/src/test/java/nta/engine/parser/TestNQLParser.java",
                "patch": "@@ -358,7 +358,8 @@ public void testShowTable() throws RecognitionException, NQLSyntaxException {\n       \"now()\", // 22\n       \"not (90 > 100)\", // 23\n       \"type like '%top'\", // 24\n-      \"type not like 'top%'\" // 25\n+      \"type not like 'top%'\", // 25\n+      \"col = 'value'\" // 26\n   };\n \n   public static NQLParser parseExpr(String expr) {\n@@ -553,5 +554,18 @@ public void testLikeEvalTree() throws RecognitionException {\n     fieldName = new FieldName(node.getChild(1));\n     assertEquals(fieldName.getName(), \"type\");\n     assertEquals(NQLParser.STRING, node.getChild(2).getType());\n-  } \n+  }\n+\n+  @Test\n+  /**\n+   * TODO - needs more tests\n+   */\n+  public void testConstEval() throws RecognitionException {\n+    NQLParser p = parseExpr(exprs[26]);\n+    CommonTree node = (CommonTree) p.search_condition().getTree();\n+    System.out.println(node.toStringTree());\n+    assertEquals(NQLParser.EQUAL, node.getType());\n+    assertEquals(NQLParser.FIELD_NAME, node.getChild(0).getType());\n+    assertEquals(NQLParser.STRING, node.getChild(1).getType());\n+  }\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/test/java/nta/engine/parser/TestNQLParser.java",
                "sha": "5acddd3f94c5c4a09b7aff80274a8439f672e05b",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/test/java/nta/engine/plan/global/TestGlobalQueryPlanner.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/nta/engine/plan/global/TestGlobalQueryPlanner.java?ref=22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
                "deletions": 4,
                "filename": "engine/src/test/java/nta/engine/plan/global/TestGlobalQueryPlanner.java",
                "patch": "@@ -42,7 +42,6 @@\n import nta.engine.planner.logical.GroupbyNode;\n import nta.engine.planner.logical.LogicalNode;\n import nta.engine.planner.logical.ScanNode;\n-import nta.engine.planner.logical.SelectionNode;\n import nta.engine.planner.logical.StoreTableNode;\n import nta.engine.planner.logical.UnionNode;\n import nta.engine.query.GlobalPlanner;\n@@ -305,9 +304,7 @@ public void testSelectAfterJoin() throws IOException {\n     \n     ScheduleUnit unit = globalPlan.getRoot();\n     StoreTableNode store = unit.getStoreTableNode();\n-    assertEquals(ExprType.SELECTION, store.getSubNode().getType());\n-    SelectionNode select = (SelectionNode) store.getSubNode();\n-    assertEquals(ExprType.JOIN, select.getSubNode().getType());\n+    assertEquals(ExprType.JOIN, store.getSubNode().getType());\n     assertTrue(unit.hasChildQuery());\n     ScanNode [] scans = unit.getScanNodes();\n     assertEquals(2, scans.length);",
                "raw_url": "https://github.com/apache/tajo/raw/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/test/java/nta/engine/plan/global/TestGlobalQueryPlanner.java",
                "sha": "01fd49b4fe43e7a682a9a13e402739a63ae25573",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/test/java/nta/engine/planner/TestLogicalOptimizer.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/nta/engine/planner/TestLogicalOptimizer.java?ref=22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
                "deletions": 0,
                "filename": "engine/src/test/java/nta/engine/planner/TestLogicalOptimizer.java",
                "patch": "@@ -208,6 +208,8 @@ public final void testPushable() throws CloneNotSupportedException {\n     assertFalse(joinNode.hasJoinQual());\n     \n     // Test for Pushable\n+    System.out.println(\"===> \" + selNode.getQual());\n+    System.out.println(\"===> \" + joinNode);\n     assertTrue(LogicalOptimizer.selectionPushable(selNode.getQual(), joinNode));\n     \n     // Optimized plan",
                "raw_url": "https://github.com/apache/tajo/raw/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/test/java/nta/engine/planner/TestLogicalOptimizer.java",
                "sha": "92f120244dd5f98e59b138801ac42d742e989f05",
                "status": "modified"
            },
            {
                "additions": 42,
                "blob_url": "https://github.com/apache/tajo/blob/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/test/java/nta/engine/planner/TestLogicalPlanner.java",
                "changes": 65,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/nta/engine/planner/TestLogicalPlanner.java?ref=22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
                "deletions": 23,
                "filename": "engine/src/test/java/nta/engine/planner/TestLogicalPlanner.java",
                "patch": "@@ -54,6 +54,7 @@\n import com.google.common.collect.Lists;\n import com.google.common.collect.Sets;\n import com.google.gson.Gson;\n+import tajo.benchmark.TPCH;\n \n /**\n  * @author Hyunsik Choi\n@@ -131,7 +132,7 @@ public static void tearDown() throws Exception {\n   @Test\n   public final void testSingleRelation() throws CloneNotSupportedException {\n     QueryContext ctx = factory.create();\n-    ParseTree block = (ParseTree) analyzer.parse(ctx, QUERIES[0]);\n+    ParseTree block = analyzer.parse(ctx, QUERIES[0]);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, block);\n     assertEquals(ExprType.ROOT, plan.getType());\n     TestLogicalNode.testCloneLogicalNode(plan);\n@@ -152,7 +153,7 @@ public final void testSingleRelation() throws CloneNotSupportedException {\n   public final void testImplicityJoinPlan() throws CloneNotSupportedException {\n     // two relations\n     QueryContext ctx = factory.create();\n-    ParseTree block = (ParseTree) analyzer.parse(ctx, QUERIES[1]);\n+    ParseTree block = analyzer.parse(ctx, QUERIES[1]);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, block);\n \n     assertEquals(ExprType.ROOT, plan.getType());\n@@ -174,7 +175,7 @@ public final void testImplicityJoinPlan() throws CloneNotSupportedException {\n \n     // three relations\n     ctx = factory.create();\n-    block = (ParseTree) analyzer.parse(ctx, QUERIES[2]);\n+    block = analyzer.parse(ctx, QUERIES[2]);\n     plan = LogicalPlanner.createPlan(ctx, block);\n     TestLogicalNode.testCloneLogicalNode(plan);\n \n@@ -213,7 +214,7 @@ public final void testImplicityJoinPlan() throws CloneNotSupportedException {\n   public final void testNaturalJoinPlan() {\n     // two relations\n     QueryContext ctx = factory.create();\n-    ParseTree block = (ParseTree) analyzer.parse(ctx, JOINS[0]);\n+    ParseTree block = analyzer.parse(ctx, JOINS[0]);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, block);\n     assertEquals(ExprType.ROOT, plan.getType());\n     LogicalRootNode root = (LogicalRootNode) plan;    \n@@ -242,7 +243,7 @@ public final void testNaturalJoinPlan() {\n   public final void testInnerJoinPlan() {\n     // two relations\n     QueryContext ctx = factory.create();\n-    ParseTree block = (ParseTree) analyzer.parse(ctx, JOINS[1]);\n+    ParseTree block = analyzer.parse(ctx, JOINS[1]);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, block);\n     assertEquals(ExprType.ROOT, plan.getType());\n     LogicalRootNode root = (LogicalRootNode) plan;    \n@@ -272,7 +273,7 @@ public final void testInnerJoinPlan() {\n   public final void testOuterJoinPlan() {\n     // two relations\n     QueryContext ctx = factory.create();\n-    ParseTree block = (ParseTree) analyzer.parse(ctx, JOINS[2]);\n+    ParseTree block = analyzer.parse(ctx, JOINS[2]);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, block);\n     assertEquals(ExprType.ROOT, plan.getType());\n     LogicalRootNode root = (LogicalRootNode) plan;    \n@@ -302,7 +303,7 @@ public final void testOuterJoinPlan() {\n   public final void testGroupby() throws CloneNotSupportedException {\n     // without 'having clause'\n     QueryContext ctx = factory.create();\n-    ParseTree block = (ParseTree) analyzer.parse(ctx, QUERIES[7]);\n+    ParseTree block = analyzer.parse(ctx, QUERIES[7]);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, block);\n \n     assertEquals(ExprType.ROOT, plan.getType());\n@@ -311,7 +312,7 @@ public final void testGroupby() throws CloneNotSupportedException {\n     \n     // with having clause\n     ctx = factory.create();\n-    block = (ParseTree) analyzer.parse(ctx, QUERIES[3]);\n+    block = analyzer.parse(ctx, QUERIES[3]);\n     plan = LogicalPlanner.createPlan(ctx, block);\n     TestLogicalNode.testCloneLogicalNode(plan);\n \n@@ -335,6 +336,24 @@ public final void testGroupby() throws CloneNotSupportedException {\n     \n     LogicalOptimizer.optimize(ctx, plan);    \n   }\n+\n+  @Test\n+  public final void testMultipleJoin() {\n+    TPCH tpch = new TPCH();\n+    tpch.loadSchemas();\n+    tpch.loadQueries();\n+\n+    for (String name : tpch.getTableNames()) {\n+      TableMeta meta = TCatUtil.newTableMeta(tpch.getSchema(name), StoreType.CSV);\n+      TableDesc desc = TCatUtil.newTableDesc(name, meta, new Path(\"/\"));\n+      catalog.addTable(desc);\n+    }\n+\n+    QueryContext ctx = factory.create();\n+    ParseTree block = analyzer.parse(ctx, tpch.getQuery(\"q2\"));\n+    LogicalNode plan = LogicalPlanner.createPlan(ctx, block);\n+    System.out.println(plan);\n+  }\n   \n   static void testQuery7(LogicalNode plan) {\n     assertEquals(ExprType.PROJECTION, plan.getType());\n@@ -356,7 +375,7 @@ static void testQuery7(LogicalNode plan) {\n   @Test\n   public final void testStoreTable() throws CloneNotSupportedException {\n     QueryContext ctx = factory.create();\n-    ParseTree tree = (ParseTree) analyzer.parse(ctx, QUERIES[8]);\n+    ParseTree tree = analyzer.parse(ctx, QUERIES[8]);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, tree);\n     TestLogicalNode.testCloneLogicalNode(plan);\n     \n@@ -372,7 +391,7 @@ public final void testStoreTable() throws CloneNotSupportedException {\n   @Test\n   public final void testOrderBy() throws CloneNotSupportedException {\n     QueryContext ctx = factory.create();\n-    ParseTree block = (ParseTree) analyzer.parse(ctx, QUERIES[4]);\n+    ParseTree block = analyzer.parse(ctx, QUERIES[4]);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, block);\n     TestLogicalNode.testCloneLogicalNode(plan);\n \n@@ -401,7 +420,7 @@ public final void testOrderBy() throws CloneNotSupportedException {\n   @Test\n   public final void testSPJPush() throws CloneNotSupportedException {\n     QueryContext ctx = factory.create();\n-    ParseTree block = (ParseTree) analyzer.parse(ctx, QUERIES[5]);\n+    ParseTree block = analyzer.parse(ctx, QUERIES[5]);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, block);\n     TestLogicalNode.testCloneLogicalNode(plan);\n     \n@@ -426,15 +445,15 @@ public final void testSPJPush() throws CloneNotSupportedException {\n   @Test\n   public final void testSPJ() throws CloneNotSupportedException {\n     QueryContext ctx = factory.create();\n-    ParseTree block = (ParseTree) analyzer.parse(ctx, QUERIES[6]);\n+    ParseTree block = analyzer.parse(ctx, QUERIES[6]);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, block);\n     TestLogicalNode.testCloneLogicalNode(plan);\n   }\n   \n   @Test\n   public final void testJson() {\n     QueryContext ctx = factory.create();\n-\t  ParseTree block = (ParseTree) analyzer.parse(ctx, QUERIES[9]);\n+\t  ParseTree block = analyzer.parse(ctx, QUERIES[9]);\n \t  LogicalNode plan = LogicalPlanner.createPlan(ctx, block);\n \t  LogicalOptimizer.optimize(ctx, plan);\n \t    \n@@ -456,7 +475,7 @@ public final void testJson() {\n   public final void testVisitor() {\n     // two relations\n     QueryContext ctx = factory.create();\n-    ParseTree block = (ParseTree) analyzer.parse(ctx, QUERIES[1]);\n+    ParseTree block = analyzer.parse(ctx, QUERIES[1]);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, block);\n     \n     TestVisitor vis = new TestVisitor();\n@@ -480,7 +499,7 @@ public void visit(LogicalNode node) {\n   @Test\n   public final void testExprNode() {\n     QueryContext ctx = factory.create();\n-    ParseTree block = (ParseTree) analyzer.parse(ctx, QUERIES[10]);\n+    ParseTree block = analyzer.parse(ctx, QUERIES[10]);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, block);\n     LogicalOptimizer.optimize(ctx, plan);\n     assertEquals(ExprType.ROOT, plan.getType());\n@@ -500,7 +519,7 @@ public final void testExprNode() {\n   @Test\n   public final void testCreateIndex() {\n     QueryContext ctx = factory.create();\n-    ParseTree block = (ParseTree) analyzer.parse(ctx, QUERIES[11]);\n+    ParseTree block = analyzer.parse(ctx, QUERIES[11]);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, block);\n     LogicalOptimizer.optimize(ctx, plan);\n     LogicalRootNode root = (LogicalRootNode) plan;\n@@ -529,7 +548,7 @@ public final void testCreateIndex() {\n   @Test\n   public final void testAlias() {\n     QueryContext ctx = factory.create();\n-    ParseTree block = (ParseTree) analyzer.parse(ctx, ALIAS[0]);\n+    ParseTree block = analyzer.parse(ctx, ALIAS[0]);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, block);\n     plan = LogicalOptimizer.optimize(ctx, plan);\n     LogicalRootNode root = (LogicalRootNode) plan;\n@@ -542,7 +561,7 @@ public final void testAlias() {\n     assertEquals(\"total\", col.getColumnName());\n     \n     ctx = factory.create();\n-    block = (ParseTree) analyzer.parse(ctx, ALIAS[1]);\n+    block = analyzer.parse(ctx, ALIAS[1]);\n     plan = LogicalPlanner.createPlan(ctx, block);\n     plan = LogicalOptimizer.optimize(ctx, plan);\n     root = (LogicalRootNode) plan;\n@@ -562,7 +581,7 @@ public final void testAlias() {\n   @Test\n   public final void testCreateTableDef() {\n     QueryContext ctx = factory.create();\n-    ParseTree block = (ParseTree) analyzer.parse(ctx, CREATE_TABLE[0]);\n+    ParseTree block = analyzer.parse(ctx, CREATE_TABLE[0]);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, block);\n     plan = LogicalOptimizer.optimize(ctx, plan);\n     LogicalRootNode root = (LogicalRootNode) plan;\n@@ -647,7 +666,7 @@ public final void testGenerateCuboids() {\n   @Test\n   public final void testCubeBy() {\n     QueryContext ctx = factory.create();\n-    ParseTree block = (ParseTree) analyzer.parse(ctx, CUBE_ROLLUP[0]);\n+    ParseTree block = analyzer.parse(ctx, CUBE_ROLLUP[0]);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, block);    \n     plan = LogicalOptimizer.optimize(ctx, plan);\n     \n@@ -690,7 +709,7 @@ public final void testCubeBy() {\n   @Test\n   public final void testSetPlan() {\n     QueryContext ctx = factory.create();\n-    ParseTree block = (ParseTree) analyzer.parse(ctx, setStatements[0]);\n+    ParseTree block = analyzer.parse(ctx, setStatements[0]);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, block);    \n     plan = LogicalOptimizer.optimize(ctx, plan);\n     assertEquals(ExprType.ROOT, plan.getType());\n@@ -706,7 +725,7 @@ public final void testSetPlan() {\n     \n     // for testing multiple set statements\n     ctx = factory.create();\n-    block = (ParseTree) analyzer.parse(ctx, setStatements[1]);\n+    block = analyzer.parse(ctx, setStatements[1]);\n     plan = LogicalPlanner.createPlan(ctx, block);    \n     plan = LogicalOptimizer.optimize(ctx, plan);\n     assertEquals(ExprType.ROOT, plan.getType());\n@@ -721,7 +740,7 @@ public final void testSetPlan() {\n     \n     // for testing multiple set statements\n     ctx = factory.create();\n-    block = (ParseTree) analyzer.parse(ctx, setStatements[2]);\n+    block = analyzer.parse(ctx, setStatements[2]);\n     plan = LogicalPlanner.createPlan(ctx, block);    \n     plan = LogicalOptimizer.optimize(ctx, plan);\n     assertEquals(ExprType.ROOT, plan.getType());",
                "raw_url": "https://github.com/apache/tajo/raw/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/test/java/nta/engine/planner/TestLogicalPlanner.java",
                "sha": "2037f99066d8bfb3009f5e5db2fa6f2c50091592",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/test/java/nta/engine/query/TestGlobalEngine.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/nta/engine/query/TestGlobalEngine.java?ref=22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
                "deletions": 5,
                "filename": "engine/src/test/java/nta/engine/query/TestGlobalEngine.java",
                "patch": "@@ -21,7 +21,6 @@\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.hadoop.conf.Configuration;\n-import org.apache.hadoop.fs.FileStatus;\n import org.apache.hadoop.fs.FileSystem;\n import org.apache.hadoop.fs.Path;\n import org.junit.After;\n@@ -84,7 +83,7 @@ public boolean equals(Object o) {\n       \"select deptname from score\",\n       \"select dept.deptname, score.score from dept,score where score.deptname = dept.deptname\",\n       \"create table test (id int, name string) using csv location '/tmp/data' with ('csv.delimiter'='|')\",\n-      \"select dept.deptname, score.score from dept,score where score.deptname = dept.deptname and score.score > 10000\",\n+      \"select dept.deptname, score.score from dept,score where score.deptname = dept.deptname and score.score > 50\",\n       \"select deptname, year, sum(score) from score group by cube (deptname, year)\"\n   };\n   private static Map<CompositeKey, Integer> groupbyResult;\n@@ -169,7 +168,7 @@ public void setup() throws Exception {\n         joinResult.get(id).add((i+1));\n       }\n \n-      if (i+1 > 10000) {\n+      if (i+1 > 50) {\n         if (!selectAfterJoinResult.containsKey(id)) {\n           List<Integer> list = new ArrayList<Integer>();\n           list.add((i+1));\n@@ -281,7 +280,7 @@ public void testJoin() throws Exception {\n     while ((tuple = scanner.next()) != null) {\n       deptname = tuple.get(0).asChars();\n       results = new HashSet<Integer>(joinResult.get(deptname));\n-      assertTrue(results.contains(tuple.get(1).asInt()));\n+      assertTrue(results.contains(tuple.get(2).asInt()));\n     }\n   }\n \n@@ -300,7 +299,7 @@ public void testSelectAfterJoin() throws Exception {\n     while ((tuple = scanner.next()) != null) {\n       deptname = tuple.get(0).asChars();\n       results = new HashSet<Integer>(selectAfterJoinResult.get(deptname));\n-      assertTrue(results.contains(tuple.get(1).asInt()));\n+      assertTrue(results.contains(tuple.get(2).asInt()));\n     }\n   }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/test/java/nta/engine/query/TestGlobalEngine.java",
                "sha": "d85d13a197241fc667040b51289db0ac2a44670f",
                "status": "modified"
            },
            {
                "additions": 66,
                "blob_url": "https://github.com/apache/tajo/blob/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/test/java/tajo/engine/TestJoinQuery.java",
                "changes": 66,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/tajo/engine/TestJoinQuery.java?ref=22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
                "deletions": 0,
                "filename": "engine/src/test/java/tajo/engine/TestJoinQuery.java",
                "patch": "@@ -0,0 +1,66 @@\n+package tajo.engine;\n+\n+import org.junit.Test;\n+import tajo.client.ResultSetUtil;\n+\n+import java.io.IOException;\n+import java.sql.ResultSet;\n+\n+import static org.junit.Assert.*;\n+\n+/**\n+ * @author Hyunsik Choi\n+ */\n+public class TestJoinQuery extends TpchTestBase {\n+\n+  public TestJoinQuery() throws IOException {\n+    super();\n+  }\n+\n+  @Test\n+  public final void testCrossJoin() throws Exception {\n+    ResultSet res = execute(\"select n_name, r_name, n_regionkey, r_regionkey from nation, region\");\n+    String str = ResultSetUtil.prettyFormat(res);\n+    System.out.println(str);\n+  }\n+\n+  //@Test\n+  public final void testCrossJoinWithExplicitJoinQual() throws Exception {\n+    ResultSet res = execute(\"select n_name, r_name, n_regionkey, r_regionkey from nation, region where n_regionkey = r_regionkey\");\n+    String str = ResultSetUtil.prettyFormat(res);\n+    System.out.println(str);\n+  }\n+\n+  @Test\n+  public final void testTPCHQ2Join() throws Exception {\n+    ResultSet res = execute(\n+        \"select s_acctbal, s_name, n_name, p_partkey, p_mfgr, s_address, s_phone, s_comment \" +\n+        \"from part, supplier, partsupp, nation, region \" +\n+        \"where p_partkey = ps_partkey and s_suppkey = ps_suppkey and s_nationkey = n_nationkey \" +\n+        \"and n_regionkey = r_regionkey\");\n+\n+    res.next();\n+    assertTrue(4032.68f == res.getFloat(\"s_acctbal\"));\n+    assertEquals(\"Supplier#000000002\", res.getString(\"s_name\"));\n+    assertEquals(\"ETHIOPIA\", res.getString(\"n_name\"));\n+\n+    res.next();\n+    assertTrue(4192.4f == res.getFloat(\"s_acctbal\"));\n+    assertEquals(\"Supplier#000000003\", res.getString(\"s_name\"));\n+    assertEquals(\"ARGENTINA\", res.getString(\"n_name\"));\n+\n+    res.next();\n+    assertTrue(4641.08f == res.getFloat(\"s_acctbal\"));\n+    assertEquals(\"Supplier#000000004\", res.getString(\"s_name\"));\n+    assertEquals(\"MOROCCO\", res.getString(\"n_name\"));\n+\n+    assertFalse(res.next());\n+  }\n+\n+  //@Test\n+  public final void testCount() throws Exception {\n+    ResultSet res = execute(\"select count(l_orderkey) as total from lineitem\");\n+    res.next();\n+    System.out.println(\"====> \" + res.getLong(1));\n+  }\n+}",
                "raw_url": "https://github.com/apache/tajo/raw/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/test/java/tajo/engine/TestJoinQuery.java",
                "sha": "ff983c05cabe6e126d060f8d159f122539f801c7",
                "status": "added"
            },
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/tajo/blob/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/test/java/tajo/engine/TestSelectQuery.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/tajo/engine/TestSelectQuery.java?ref=22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
                "deletions": 0,
                "filename": "engine/src/test/java/tajo/engine/TestSelectQuery.java",
                "patch": "@@ -71,4 +71,12 @@ public final void testSelectAsterik() throws Exception {\n     assertEquals(\"MAIL\",res.getString(15));\n     assertEquals(\"ly final dependencies: slyly bold\",res.getString(16));\n   }\n+\n+  @Test\n+  public final void testSelectWithFilter() throws Exception {\n+    ResultSet res = execute(\"select l_orderkey, l_linenumber from lineitem where l_shipdate = '1997-01-28'\");\n+    res.next();\n+    assertEquals(2, res.getInt(1));\n+    assertEquals(1, res.getInt(2));\n+  }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/test/java/tajo/engine/TestSelectQuery.java",
                "sha": "29905de13c5592c235cd86210ff517a3afebc643",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/test/java/tajo/engine/TpchTestBase.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/tajo/engine/TpchTestBase.java?ref=22a9fe00f3d2ef4aae804000ad22ddf2a9cef852",
                "deletions": 1,
                "filename": "engine/src/test/java/tajo/engine/TpchTestBase.java",
                "patch": "@@ -21,15 +21,17 @@\n   String [][] tables;\n   Schema[] schemas;\n   Map<String, Integer> nameMap = Maps.newHashMap();\n+  protected TPCH tpch;\n \n   public TpchTestBase() throws IOException {\n     names = new String[] {\"customer\", \"lineitem\", \"nation\", \"orders\", \"part\", \"partsupp\", \"region\", \"supplier\"};\n     for (int i = 0; i < names.length; i++) {\n       nameMap.put(names[i], i);\n     }\n \n-    TPCH tpch = new TPCH();\n+    tpch = new TPCH();\n     tpch.loadSchemas();\n+    tpch.loadQueries();\n \n     schemas = new Schema[names.length];\n     for (int i = 0; i < names.length; i++) {",
                "raw_url": "https://github.com/apache/tajo/raw/22a9fe00f3d2ef4aae804000ad22ddf2a9cef852/engine/src/test/java/tajo/engine/TpchTestBase.java",
                "sha": "e5dcbb10b3f8138bd1f2723294cf189bfaee470f",
                "status": "modified"
            }
        ],
        "message": "TAJO-723: Q2 of TPC-H causes NPE\n\nChange-Id: Ie43ac03a08ec5c8202cbb4d3f66ba04d6a795f80\nReviewed-on: https://dbserver.korea.ac.kr/reviews/170\nTested-by:  Jenkins <build@dbserver.korea.ac.kr>\nTested-by: HyoSeok Ryu <ohmyhaker@gmail.com>\nReviewed-by: Hyunsik Choi <hyunsik.choi@gmail.com>",
        "parent": "https://github.com/apache/tajo/commit/f06d63c589926eaa98702e4e20da24d19afc8186",
        "patched_files": [
            "PlannerUtil.java",
            "ResultSetUtil.java",
            "TpchTestBase.java",
            "findbugs-exclude.xml",
            "Schema.java",
            "QueryAnalyzer.java",
            "LogicalOptimizer.java",
            "LogicalPlanner.java",
            "tajo-site.xml",
            "GlobalEngine.java",
            "ResultSetImpl.java",
            "CSVFile2.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestResultSetImpl.java",
            "TestLogicalOptimizer.java",
            "TestPlannerUtil.java",
            "TestLogicalPlanner.java",
            "TestGlobalQueryPlanner.java",
            "TestGlobalEngine.java",
            "TestSelectQuery.java",
            "TestCSVFile2.java",
            "TestSchema.java",
            "TestJoinQuery.java",
            "TestNQLParser.java",
            "TestQueryAnalyzer.java"
        ]
    },
    "tajo_22d2ba4": {
        "bug_id": "tajo_22d2ba4",
        "commit": "https://github.com/apache/tajo/commit/22d2ba4db5c2623a1f8e77fb4028c923631f3536",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/22d2ba4db5c2623a1f8e77fb4028c923631f3536/CHANGES",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=22d2ba4db5c2623a1f8e77fb4028c923631f3536",
                "deletions": 0,
                "filename": "CHANGES",
                "patch": "@@ -200,6 +200,9 @@ Release 0.11.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-1552: NPE occurs when GreedyHeuristicJoinOrderAlgorithm.getCost() returns \n+    infinity. (Contributed by Hyoungjun Kim, Committed by jihoon)\n+\n     TAJO-1712: querytasks.jsp throws NPE occasionally when tasks are running.\n     (jinho)\n ",
                "raw_url": "https://github.com/apache/tajo/raw/22d2ba4db5c2623a1f8e77fb4028c923631f3536/CHANGES",
                "sha": "4632ddf10f98c557128fdfc13741f508095a8aa9",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/22d2ba4db5c2623a1f8e77fb4028c923631f3536/tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/CatalogService.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/CatalogService.java?ref=22d2ba4db5c2623a1f8e77fb4028c923631f3536",
                "deletions": 12,
                "filename": "tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/CatalogService.java",
                "patch": "@@ -22,23 +22,13 @@\n import org.apache.tajo.catalog.exception.UndefinedPartitionException;\n import org.apache.tajo.catalog.partition.PartitionMethodDesc;\n import org.apache.tajo.catalog.proto.CatalogProtos;\n-import org.apache.tajo.catalog.proto.CatalogProtos.ColumnProto;\n-import org.apache.tajo.catalog.proto.CatalogProtos.DatabaseProto;\n-import org.apache.tajo.catalog.proto.CatalogProtos.IndexProto;\n-import org.apache.tajo.catalog.proto.CatalogProtos.TableDescriptorProto;\n-import org.apache.tajo.catalog.proto.CatalogProtos.TableOptionProto;\n-import org.apache.tajo.catalog.proto.CatalogProtos.TablePartitionProto;\n-import org.apache.tajo.catalog.proto.CatalogProtos.TableStatsProto;\n+import org.apache.tajo.catalog.proto.CatalogProtos.*;\n import org.apache.tajo.common.TajoDataTypes.DataType;\n \n-import java.sql.SQLException;\n import java.util.Collection;\n import java.util.List;\n \n-import static org.apache.tajo.catalog.proto.CatalogProtos.AlterTablespaceProto;\n-import static org.apache.tajo.catalog.proto.CatalogProtos.FunctionType;\n-import static org.apache.tajo.catalog.proto.CatalogProtos.TablespaceProto;\n-import static org.apache.tajo.catalog.proto.CatalogProtos.UpdateTableStatsProto;\n+import static org.apache.tajo.catalog.proto.CatalogProtos.*;\n \n \n public interface CatalogService {",
                "raw_url": "https://github.com/apache/tajo/raw/22d2ba4db5c2623a1f8e77fb4028c923631f3536/tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/CatalogService.java",
                "sha": "f1bfe6a7248612ef90c58c9d93b96d2c3ec6f071",
                "status": "modified"
            },
            {
                "additions": 185,
                "blob_url": "https://github.com/apache/tajo/blob/22d2ba4db5c2623a1f8e77fb4028c923631f3536/tajo-core/src/test/java/org/apache/tajo/engine/planner/TestJoinOrderAlgorithm.java",
                "changes": 185,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/java/org/apache/tajo/engine/planner/TestJoinOrderAlgorithm.java?ref=22d2ba4db5c2623a1f8e77fb4028c923631f3536",
                "deletions": 0,
                "filename": "tajo-core/src/test/java/org/apache/tajo/engine/planner/TestJoinOrderAlgorithm.java",
                "patch": "@@ -0,0 +1,185 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.tajo.engine.planner;\n+\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.tajo.LocalTajoTestingUtility;\n+import org.apache.tajo.TajoConstants;\n+import org.apache.tajo.TajoTestingCluster;\n+import org.apache.tajo.algebra.Expr;\n+import org.apache.tajo.catalog.*;\n+import org.apache.tajo.catalog.proto.CatalogProtos.StoreType;\n+import org.apache.tajo.catalog.statistics.TableStats;\n+import org.apache.tajo.common.TajoDataTypes.Type;\n+import org.apache.tajo.engine.function.FunctionLoader;\n+import org.apache.tajo.engine.parser.SQLAnalyzer;\n+import org.apache.tajo.engine.query.QueryContext;\n+import org.apache.tajo.plan.LogicalOptimizer;\n+import org.apache.tajo.plan.LogicalPlan;\n+import org.apache.tajo.plan.LogicalPlanner;\n+import org.apache.tajo.plan.logical.*;\n+import org.apache.tajo.plan.util.PlannerUtil;\n+import org.apache.tajo.storage.TablespaceManager;\n+import org.apache.tajo.unit.StorageUnit;\n+import org.apache.tajo.util.CommonTestingUtil;\n+import org.apache.tajo.util.KeyValueSet;\n+import org.junit.AfterClass;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import static org.apache.tajo.TajoConstants.DEFAULT_DATABASE_NAME;\n+import static org.apache.tajo.TajoConstants.DEFAULT_TABLESPACE_NAME;\n+import static org.junit.Assert.*;\n+\n+public class TestJoinOrderAlgorithm {\n+\n+  private static TajoTestingCluster util;\n+  private static CatalogService catalog;\n+  private static SQLAnalyzer sqlAnalyzer;\n+  private static LogicalPlanner planner;\n+  private static LogicalOptimizer optimizer;\n+  private static QueryContext defaultContext;\n+\n+  @BeforeClass\n+  public static void setUp() throws Exception {\n+    util = new TajoTestingCluster();\n+    util.startCatalogCluster();\n+    catalog = util.getMiniCatalogCluster().getCatalog();\n+    catalog.createTablespace(DEFAULT_TABLESPACE_NAME, \"hdfs://localhost:1234/warehouse\");\n+    catalog.createDatabase(DEFAULT_DATABASE_NAME, DEFAULT_TABLESPACE_NAME);\n+    for (FunctionDesc funcDesc : FunctionLoader.findLegacyFunctions()) {\n+      catalog.createFunction(funcDesc);\n+    }\n+\n+    Schema schema = new Schema();\n+    schema.addColumn(\"name\", Type.TEXT);\n+    schema.addColumn(\"empid\", Type.INT4);\n+    schema.addColumn(\"deptname\", Type.TEXT);\n+\n+    Schema schema2 = new Schema();\n+    schema2.addColumn(\"deptname\", Type.TEXT);\n+    schema2.addColumn(\"manager\", Type.TEXT);\n+\n+    Schema schema3 = new Schema();\n+    schema3.addColumn(\"deptname\", Type.TEXT);\n+    schema3.addColumn(\"score\", Type.INT4);\n+    schema3.addColumn(\"phone\", Type.INT4);\n+\n+    TableMeta meta = CatalogUtil.newTableMeta(\"TEXT\");\n+    TableDesc people = new TableDesc(\n+        CatalogUtil.buildFQName(TajoConstants.DEFAULT_DATABASE_NAME, \"employee\"), schema, meta,\n+        CommonTestingUtil.getTestDir().toUri());\n+    catalog.createTable(people);\n+\n+    TableDesc student =\n+        new TableDesc(\n+            CatalogUtil.buildFQName(DEFAULT_DATABASE_NAME, \"dept\"), schema2, \"TEXT\", new KeyValueSet(),\n+            CommonTestingUtil.getTestDir().toUri());\n+    catalog.createTable(student);\n+\n+    TableDesc score =\n+        new TableDesc(\n+            CatalogUtil.buildFQName(DEFAULT_DATABASE_NAME, \"score\"), schema3, \"TEXT\", new KeyValueSet(),\n+            CommonTestingUtil.getTestDir().toUri());\n+    catalog.createTable(score);\n+\n+    ///////////////////////////////////////////////////////////////////////////\n+    // creating table for overflow in JoinOrderOptimizer.\n+    Schema schema4 = new Schema();\n+    schema4.addColumn(\"deptname\", Type.TEXT);\n+    schema4.addColumn(\"manager\", Type.TEXT);\n+    // Set store type as FAKEFILE to prevent auto update of physical information in LogicalPlanner.updatePhysicalInfo()\n+    TableMeta largeTableMeta = CatalogUtil.newTableMeta(\"FAKEFILE\");\n+    TableDesc largeDept;\n+    TableStats largeTableStats;\n+    FileSystem fs = FileSystem.getLocal(util.getConfiguration());\n+    for (int i = 0; i < 6; i++) {\n+      Path tablePath = new Path(CommonTestingUtil.getTestDir(), \"\" + (i+1));\n+      fs.create(tablePath);\n+      largeDept =\n+          new TableDesc(\n+              CatalogUtil.buildFQName(DEFAULT_DATABASE_NAME, \"large_dept\"+(i+1)), schema4, largeTableMeta,\n+              tablePath.toUri());\n+      largeTableStats = new TableStats();\n+      largeTableStats.setNumBytes(StorageUnit.PB * (i+1));  //1 PB * i\n+      largeDept.setStats(largeTableStats);\n+      catalog.createTable(largeDept);\n+    }\n+    ///////////////////////////////////////////////////////////////////////////\n+\n+    sqlAnalyzer = new SQLAnalyzer();\n+    planner = new LogicalPlanner(catalog, TablespaceManager.getInstance());\n+    optimizer = new LogicalOptimizer(util.getConfiguration());\n+\n+    defaultContext = LocalTajoTestingUtility.createDummyContext(util.getConfiguration());\n+  }\n+\n+  @AfterClass\n+  public static void tearDown() throws Exception {\n+    util.shutdownCatalogCluster();\n+  }\n+\n+  @Test\n+  public final void testCheckingInfinityJoinScore() throws Exception {\n+    // Test for TAJO-1552\n+    String query = \"select a.deptname from large_dept1 a, large_dept2 b, large_dept3 c, \" +\n+        \"large_dept4 d, large_dept5 e, large_dept6 f \";\n+\n+    Expr expr = sqlAnalyzer.parse(query);\n+    LogicalPlan newPlan = planner.createPlan(defaultContext, expr);\n+    LogicalNode[] joinNodes = PlannerUtil.findAllNodes(newPlan. getRootBlock().getRoot() , NodeType.JOIN);\n+    assertNotNull(joinNodes);\n+    assertEquals(5, joinNodes.length);\n+    assertJoinNode(joinNodes[0], \"default.a\", \"default.b\");\n+    assertJoinNode(joinNodes[1], null, \"default.c\");\n+    assertJoinNode(joinNodes[2], null, \"default.d\");\n+    assertJoinNode(joinNodes[3], null, \"default.e\");\n+    assertJoinNode(joinNodes[4], null, \"default.f\");\n+\n+    optimizer.optimize(newPlan);\n+\n+    joinNodes = PlannerUtil.findAllNodes(newPlan. getRootBlock().getRoot() , NodeType.JOIN);\n+    assertNotNull(joinNodes);\n+    assertEquals(5, joinNodes.length);\n+    assertJoinNode(joinNodes[0], \"default.d\", \"default.c\");\n+    assertJoinNode(joinNodes[1], \"default.b\", \"default.a\");\n+    assertJoinNode(joinNodes[2], null, null);\n+    assertJoinNode(joinNodes[3], \"default.f\", \"default.e\");\n+    assertJoinNode(joinNodes[4], null, null);\n+\n+  }\n+\n+  private void assertJoinNode(LogicalNode node, String left, String right) {\n+    assertEquals(NodeType.JOIN, node.getType());\n+    JoinNode joinNode = (JoinNode)node;\n+\n+    if (left != null) {\n+      assertEquals(left, ((ScanNode)joinNode.getLeftChild()).getCanonicalName());\n+    } else {\n+      assertEquals(NodeType.JOIN, joinNode.getLeftChild().getType());\n+    }\n+\n+    if (right != null) {\n+      assertEquals(right, ((ScanNode)joinNode.getRightChild()).getCanonicalName());\n+    } else {\n+      assertEquals(NodeType.JOIN, joinNode.getRightChild().getType());\n+    }\n+  }\n+}",
                "raw_url": "https://github.com/apache/tajo/raw/22d2ba4db5c2623a1f8e77fb4028c923631f3536/tajo-core/src/test/java/org/apache/tajo/engine/planner/TestJoinOrderAlgorithm.java",
                "sha": "eb4a3f45ea0412e1a53398f0d504c5a7986083ed",
                "status": "added"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/22d2ba4db5c2623a1f8e77fb4028c923631f3536/tajo-plan/src/main/java/org/apache/tajo/plan/LogicalPlanner.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-plan/src/main/java/org/apache/tajo/plan/LogicalPlanner.java?ref=22d2ba4db5c2623a1f8e77fb4028c923631f3536",
                "deletions": 1,
                "filename": "tajo-plan/src/main/java/org/apache/tajo/plan/LogicalPlanner.java",
                "patch": "@@ -1357,7 +1357,9 @@ public ScanNode visitRelation(PlanContext context, Stack<Expr> stack, Relation e\n \n   private void updatePhysicalInfo(PlanContext planContext, TableDesc desc) {\n     if (desc.getUri() != null &&\n-        desc.getMeta().getStoreType() != \"SYSTEM\" && PlannerUtil.isFileStorageType(desc.getMeta().getStoreType())) {\n+        !desc.getMeta().getStoreType().equals(\"SYSTEM\") &&\n+        !desc.getMeta().getStoreType().equals(\"FAKEFILE\") && // FAKEFILE is used for test\n+        PlannerUtil.isFileStorageType(desc.getMeta().getStoreType())) {\n       try {\n         Path path = new Path(desc.getUri());\n         FileSystem fs = path.getFileSystem(planContext.queryContext.getConf());",
                "raw_url": "https://github.com/apache/tajo/raw/22d2ba4db5c2623a1f8e77fb4028c923631f3536/tajo-plan/src/main/java/org/apache/tajo/plan/LogicalPlanner.java",
                "sha": "7f5cf9a2a665d4880322e7ecfae1ffa92094b252",
                "status": "modified"
            },
            {
                "additions": 21,
                "blob_url": "https://github.com/apache/tajo/blob/22d2ba4db5c2623a1f8e77fb4028c923631f3536/tajo-plan/src/main/java/org/apache/tajo/plan/joinorder/GreedyHeuristicJoinOrderAlgorithm.java",
                "changes": 25,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-plan/src/main/java/org/apache/tajo/plan/joinorder/GreedyHeuristicJoinOrderAlgorithm.java?ref=22d2ba4db5c2623a1f8e77fb4028c923631f3536",
                "deletions": 4,
                "filename": "tajo-plan/src/main/java/org/apache/tajo/plan/joinorder/GreedyHeuristicJoinOrderAlgorithm.java",
                "patch": "@@ -203,7 +203,8 @@ private JoinEdge getBestPair(JoinEdgeFinderContext context, JoinGraphContext gra\n         JoinOrderingUtil.updateQualIfNecessary(graphContext, foundJoin);\n         double cost = getCost(foundJoin);\n \n-        if (cost < minCost) {\n+        if (cost < minCost ||\n+            (cost == minCost && cost == Double.MAX_VALUE)) {\n           minCost = cost;\n           bestJoin = foundJoin;\n         }\n@@ -236,7 +237,7 @@ private JoinEdge getBestPair(JoinEdgeFinderContext context, JoinGraphContext gra\n   }\n \n   private static JoinEdge swapLeftAndRightIfNecessary(JoinEdge edge) {\n-    if (PlannerUtil.isCommutativeJoinType(edge.getJoinType()) || edge.getJoinType() == JoinType.FULL_OUTER) {\n+    if (PlannerUtil.isCommutativeJoinType(edge.getJoinType())) {\n       double leftCost = getCost(edge.getLeftVertex());\n       double rightCost = getCost(edge.getRightVertex());\n       if (leftCost < rightCost) {\n@@ -398,7 +399,7 @@ public static double getCost(JoinEdge joinEdge) {\n           getCost(joinEdge.getRightVertex()), 2);\n     }\n \n-    return cost * COMPUTATION_FACTOR;\n+    return checkInfinity(cost * COMPUTATION_FACTOR);\n   }\n \n   public static double getCost(JoinVertex joinVertex) {\n@@ -411,6 +412,22 @@ public static double getCost(JoinVertex joinVertex) {\n     return cost;\n   }\n \n+  /**\n+   * Return the MAX(MIN) value if the given cost is positive(negative) infinity.\n+   *\n+   * @param cost\n+   * @return\n+   */\n+  private static double checkInfinity(double cost) {\n+    if (cost == Double.POSITIVE_INFINITY) {\n+      return Long.MAX_VALUE;\n+    } else if (cost == Double.NEGATIVE_INFINITY) {\n+      return Long.MIN_VALUE;\n+    } else {\n+      return cost;\n+    }\n+  }\n+\n   // TODO - costs of other operator operators (e.g., group-by and sort) should be computed in proper manners.\n   public static double getCost(LogicalNode node) {\n     double cost;\n@@ -449,7 +466,7 @@ public static double getCost(LogicalNode node) {\n       if (scanNode.getTableDesc().getStats() != null) {\n         cost = ((ScanNode)node).getTableDesc().getStats().getNumBytes();\n       } else {\n-        cost = Long.MAX_VALUE;\n+        cost = Integer.MAX_VALUE;\n       }\n       break;\n ",
                "raw_url": "https://github.com/apache/tajo/raw/22d2ba4db5c2623a1f8e77fb4028c923631f3536/tajo-plan/src/main/java/org/apache/tajo/plan/joinorder/GreedyHeuristicJoinOrderAlgorithm.java",
                "sha": "403d0b809114ce81102c25d32c9f8afbe3980eca",
                "status": "modified"
            }
        ],
        "message": "TAJO-1552: NPE occurs when GreedyHeuristicJoinOrderAlgorithm.getCost() returns infinity.\n\nCloses #655, closes #547\n\nSigned-off-by: Jihoon Son <jihoonson@apache.org>",
        "parent": "https://github.com/apache/tajo/commit/aa8969ac810e3341fb87b41e521f196e425ad069",
        "patched_files": [
            "CatalogService.java",
            "CHANGES",
            "JoinOrderAlgorithm.java",
            "GreedyHeuristicJoinOrderAlgorithm.java",
            "LogicalPlanner.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestJoinOrderAlgorithm.java",
            "TestLogicalPlanner.java"
        ]
    },
    "tajo_358dbac": {
        "bug_id": "tajo_358dbac",
        "commit": "https://github.com/apache/tajo/commit/358dbace5b48cfbc139b46c96752a66b0f817908",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/358dbace5b48cfbc139b46c96752a66b0f817908/CHANGES.txt",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES.txt?ref=358dbace5b48cfbc139b46c96752a66b0f817908",
                "deletions": 0,
                "filename": "CHANGES.txt",
                "patch": "@@ -222,6 +222,9 @@ Release 0.8.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-360: If there is no matched function, catalog causes NPE.\n+    (hyoungjunkim via hyunsik)\n+\n     TAJO-537: After TAJO-522, still OutOfMemoryError: unable to create new\n     native thread. (Min Zhou  via hyunsik)\n ",
                "raw_url": "https://github.com/apache/tajo/raw/358dbace5b48cfbc139b46c96752a66b0f817908/CHANGES.txt",
                "sha": "e4feb6a4ff315c2bee4ba8af7053070371a49961",
                "status": "modified"
            },
            {
                "additions": 14,
                "blob_url": "https://github.com/apache/tajo/blob/358dbace5b48cfbc139b46c96752a66b0f817908/tajo-catalog/tajo-catalog-client/src/main/java/org/apache/tajo/catalog/AbstractCatalogClient.java",
                "changes": 19,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-catalog/tajo-catalog-client/src/main/java/org/apache/tajo/catalog/AbstractCatalogClient.java?ref=358dbace5b48cfbc139b46c96752a66b0f817908",
                "deletions": 5,
                "filename": "tajo-catalog/tajo-catalog-client/src/main/java/org/apache/tajo/catalog/AbstractCatalogClient.java",
                "patch": "@@ -22,6 +22,7 @@\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.tajo.catalog.CatalogProtocol.CatalogProtocolService;\n+import org.apache.tajo.catalog.exception.NoSuchFunctionException;\n import org.apache.tajo.catalog.proto.CatalogProtos.*;\n import org.apache.tajo.common.TajoDataTypes.DataType;\n import org.apache.tajo.conf.TajoConf;\n@@ -316,17 +317,25 @@ public final FunctionDesc getFunction(final String signature, FunctionType funcT\n       builder.addParameterTypes(type);\n     }\n \n-    FunctionDescProto descProto;\n+    FunctionDescProto descProto = null;\n     try {\n       descProto = new ServerCallable<FunctionDescProto>(conf, catalogServerAddr, CatalogProtocol.class, false) {\n         public FunctionDescProto call(NettyClientBase client) throws ServiceException {\n-          CatalogProtocolService.BlockingInterface stub = getStub(client);\n-          return stub.getFunctionMeta(null, builder.build());\n+          try {\n+            CatalogProtocolService.BlockingInterface stub = getStub(client);\n+            return stub.getFunctionMeta(null, builder.build());\n+          } catch (NoSuchFunctionException e) {\n+            abort();\n+            throw e;\n+          }\n         }\n       }.withRetries();\n     } catch (ServiceException e) {\n       LOG.error(e.getMessage(), e);\n-      return null;\n+    }\n+\n+    if (descProto == null) {\n+      throw new NoSuchFunctionException(signature);\n     }\n     if(descProto == null) {\n       LOG.error(\"No matched function:\" + signature + \",\" + funcType + \",\" + paramTypes);\n@@ -336,7 +345,7 @@ public FunctionDescProto call(NettyClientBase client) throws ServiceException {\n       return new FunctionDesc(descProto);\n     } catch (ClassNotFoundException e) {\n       LOG.error(e);\n-      return null;\n+      throw new NoSuchFunctionException(signature);\n     }\n   }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/358dbace5b48cfbc139b46c96752a66b0f817908/tajo-catalog/tajo-catalog-client/src/main/java/org/apache/tajo/catalog/AbstractCatalogClient.java",
                "sha": "322faed9f146726cae0dd1f9c57ced379de8d0fa",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tajo/blob/358dbace5b48cfbc139b46c96752a66b0f817908/tajo-catalog/tajo-catalog-server/src/main/java/org/apache/tajo/catalog/CatalogServer.java",
                "changes": 16,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-catalog/tajo-catalog-server/src/main/java/org/apache/tajo/catalog/CatalogServer.java?ref=358dbace5b48cfbc139b46c96752a66b0f817908",
                "deletions": 6,
                "filename": "tajo-catalog/tajo-catalog-server/src/main/java/org/apache/tajo/catalog/CatalogServer.java",
                "patch": "@@ -447,7 +447,7 @@ private FunctionDescProto findFunction(String signature, List<DataType> params)\n           }\n         }\n       }\n-      return null;\n+      throw new NoSuchFunctionException(signature);\n     }\n \n     private FunctionDescProto findFunction(String signature, FunctionType type, List<DataType> params) {\n@@ -458,7 +458,7 @@ private FunctionDescProto findFunction(String signature, FunctionType type, List\n           }\n         }\n       }\n-      return null;\n+      throw new NoSuchFunctionException(signature);\n     }\n \n     private FunctionDescProto findFunction(FunctionDescProto target) {\n@@ -471,9 +471,13 @@ public BoolProto createFunction(RpcController controller, FunctionDescProto func\n       FunctionSignature signature = FunctionSignature.create(funcDesc);\n \n       if (functions.containsKey(funcDesc.getSignature())) {\n-        FunctionDescProto found = findFunction(funcDesc);\n-        if (found != null) {\n-          throw new AlreadyExistsFunctionException(signature.toString());\n+        try {\n+          FunctionDescProto found = findFunction(funcDesc);\n+          if (found != null) {\n+            throw new AlreadyExistsFunctionException(signature.toString());\n+          }\n+        } catch (NoSuchFunctionException e) {\n+          //create function\n         }\n       }\n \n@@ -508,7 +512,7 @@ public FunctionDescProto getFunctionMeta(RpcController controller, GetFunctionMe\n               request.getParameterTypesList());\n           return desc;\n         }\n-        return null;\n+        throw new NoSuchFunctionException(request.getSignature());\n       } else {\n         FunctionDescProto function = findFunction(request.getSignature(), request.getParameterTypesList());\n         return function;",
                "raw_url": "https://github.com/apache/tajo/raw/358dbace5b48cfbc139b46c96752a66b0f817908/tajo-catalog/tajo-catalog-server/src/main/java/org/apache/tajo/catalog/CatalogServer.java",
                "sha": "38686e3dfd01d942f9d21391cc0bc87c3e376f51",
                "status": "modified"
            },
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/tajo/blob/358dbace5b48cfbc139b46c96752a66b0f817908/tajo-catalog/tajo-catalog-server/src/test/java/org/apache/tajo/catalog/TestCatalog.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-catalog/tajo-catalog-server/src/test/java/org/apache/tajo/catalog/TestCatalog.java?ref=358dbace5b48cfbc139b46c96752a66b0f817908",
                "deletions": 2,
                "filename": "tajo-catalog/tajo-catalog-server/src/test/java/org/apache/tajo/catalog/TestCatalog.java",
                "patch": "@@ -19,6 +19,7 @@\n package org.apache.tajo.catalog;\n \n import org.apache.hadoop.fs.Path;\n+import org.apache.tajo.catalog.exception.NoSuchFunctionException;\n import org.apache.tajo.catalog.function.Function;\n import org.apache.tajo.catalog.partition.PartitionDesc;\n import org.apache.tajo.catalog.partition.Specifier;\n@@ -88,7 +89,7 @@ public void testGetTable() throws Exception {\n     assertFalse(catalog.existsTable(\"getTable\"));\n \t}\n \t\n-\t@Test(expected = Throwable.class)\n+\t@Test\n \tpublic void testAddTableNoName() throws Exception {\n \t  schema1 = new Schema();\n     schema1.addColumn(FieldName1, Type.BLOB);\n@@ -99,7 +100,7 @@ public void testAddTableNoName() throws Exception {\n \t  TableDesc desc = new TableDesc();\n \t  desc.setMeta(info);\n \t  \n-\t  catalog.addTable(desc);\n+\t  assertFalse(catalog.addTable(desc));\n \t}\n \n   static IndexDesc desc1;\n@@ -189,6 +190,11 @@ public final void testRegisterFunc() throws Exception {\n \t\tassertEquals(retrived.getFuncType(),FunctionType.UDF);\n \t}\n \n+  @Test(expected = NoSuchFunctionException.class)\n+  public final void testSuchFunctionException() throws Exception {\n+    catalog.getFunction(\"test123\", CatalogUtil.newSimpleDataTypeArray(Type.INT4));\n+  }\n+\n   @Test\n   public final void testDropFunction() throws Exception {\n     assertFalse(catalog.containFunction(\"test3\", CatalogUtil.newSimpleDataTypeArray(Type.INT4)));",
                "raw_url": "https://github.com/apache/tajo/raw/358dbace5b48cfbc139b46c96752a66b0f817908/tajo-catalog/tajo-catalog-server/src/test/java/org/apache/tajo/catalog/TestCatalog.java",
                "sha": "a56253150786e7bbcf1bd59d87f18b524bd429de",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tajo/blob/9a9d6eaf432f1903414792a0384b464753aa52a3/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/exception/UndefinedFunctionException.java",
                "changes": 34,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/exception/UndefinedFunctionException.java?ref=9a9d6eaf432f1903414792a0384b464753aa52a3",
                "deletions": 34,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/exception/UndefinedFunctionException.java",
                "patch": "@@ -1,34 +0,0 @@\n-/**\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-\n-/**\n- * \n- */\n-package org.apache.tajo.engine.exception;\n-\n-\n-public class UndefinedFunctionException extends InvalidQueryException {\n-\tprivate static final long serialVersionUID = 113593927391549716L;\n-\n-\t/**\n-\t * @param signature\n-\t */\n-\tpublic UndefinedFunctionException(String signature) {\n-\t\tsuper(\"Error: call to undefined function \"+signature+\"()\");\t\n-\t}\n-}",
                "raw_url": "https://github.com/apache/tajo/raw/9a9d6eaf432f1903414792a0384b464753aa52a3/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/exception/UndefinedFunctionException.java",
                "sha": "36d9c5daa6e0251911fcc29a485203cad971fc38",
                "status": "removed"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/358dbace5b48cfbc139b46c96752a66b0f817908/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/ExprAnnotator.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/ExprAnnotator.java?ref=358dbace5b48cfbc139b46c96752a66b0f817908",
                "deletions": 6,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/ExprAnnotator.java",
                "patch": "@@ -23,11 +23,11 @@\n import org.apache.tajo.catalog.CatalogUtil;\n import org.apache.tajo.catalog.Column;\n import org.apache.tajo.catalog.FunctionDesc;\n+import org.apache.tajo.catalog.exception.NoSuchFunctionException;\n import org.apache.tajo.catalog.proto.CatalogProtos;\n import org.apache.tajo.common.TajoDataTypes;\n import org.apache.tajo.datum.*;\n import org.apache.tajo.engine.eval.*;\n-import org.apache.tajo.engine.exception.UndefinedFunctionException;\n import org.apache.tajo.engine.function.AggFunction;\n import org.apache.tajo.engine.function.GeneralFunction;\n import org.apache.tajo.engine.planner.logical.NodeType;\n@@ -390,12 +390,12 @@ public EvalNode visitFunction(Context ctx, Stack<Expr> stack, FunctionExpr expr)\n     stack.pop(); // <--- Pop\n \n     if (!catalog.containFunction(expr.getSignature(), paramTypes)) {\n-      throw new UndefinedFunctionException(CatalogUtil.getCanonicalName(expr.getSignature(), paramTypes));\n+      throw new NoSuchFunctionException(CatalogUtil.getCanonicalName(expr.getSignature(), paramTypes));\n     }\n \n     FunctionDesc funcDesc = catalog.getFunction(expr.getSignature(), paramTypes);\n     if (funcDesc == null) {\n-      throw new UndefinedFunctionException(CatalogUtil.getCanonicalName(expr.getSignature(), paramTypes));\n+      throw new NoSuchFunctionException(CatalogUtil.getCanonicalName(expr.getSignature(), paramTypes));\n     }\n     try {\n     CatalogProtos.FunctionType functionType = funcDesc.getFuncType();\n@@ -429,7 +429,7 @@ public EvalNode visitCountRowsFunction(Context ctx, Stack<Expr> stack, CountRows\n     FunctionDesc countRows = catalog.getFunction(\"count\", CatalogProtos.FunctionType.AGGREGATION,\n         new TajoDataTypes.DataType[] {});\n     if (countRows == null) {\n-      throw new UndefinedFunctionException(CatalogUtil.\n+      throw new NoSuchFunctionException(CatalogUtil.\n           getCanonicalName(countRows.getSignature(), new TajoDataTypes.DataType[]{}));\n     }\n \n@@ -439,7 +439,7 @@ public EvalNode visitCountRowsFunction(Context ctx, Stack<Expr> stack, CountRows\n       return new AggregationFunctionCallEval(countRows, (AggFunction) countRows.newInstance(),\n           new EvalNode[] {});\n     } catch (InternalException e) {\n-      throw new UndefinedFunctionException(CatalogUtil.\n+      throw new NoSuchFunctionException(CatalogUtil.\n           getCanonicalName(countRows.getSignature(), new TajoDataTypes.DataType[]{}));\n     }\n   }\n@@ -462,7 +462,7 @@ public EvalNode visitGeneralSetFunction(Context ctx, Stack<Expr> stack, GeneralS\n     }\n \n     if (!catalog.containFunction(setFunction.getSignature(), functionType, paramTypes)) {\n-      throw new UndefinedFunctionException(CatalogUtil. getCanonicalName(setFunction.getSignature(), paramTypes));\n+      throw new NoSuchFunctionException(CatalogUtil. getCanonicalName(setFunction.getSignature(), paramTypes));\n     }\n \n     FunctionDesc funcDesc = catalog.getFunction(setFunction.getSignature(), functionType, paramTypes);",
                "raw_url": "https://github.com/apache/tajo/raw/358dbace5b48cfbc139b46c96752a66b0f817908/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/ExprAnnotator.java",
                "sha": "ffa8f7a88858d53a33018bafc71847be39f1ba8a",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/358dbace5b48cfbc139b46c96752a66b0f817908/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/TestSQLExpression.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/TestSQLExpression.java?ref=358dbace5b48cfbc139b46c96752a66b0f817908",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/TestSQLExpression.java",
                "patch": "@@ -19,6 +19,7 @@\n package org.apache.tajo.engine.eval;\n \n import org.apache.tajo.catalog.Schema;\n+import org.apache.tajo.catalog.exception.NoSuchFunctionException;\n import org.apache.tajo.datum.TimestampDatum;\n import org.junit.Test;\n \n@@ -28,6 +29,11 @@\n \n public class TestSQLExpression extends ExprTestBase {\n \n+  @Test(expected = NoSuchFunctionException.class)\n+  public void testNoSuchFunction() throws IOException {\n+    testSimpleEval(\"select test123('abc') col1 \", new String[]{\"abc\"});\n+  }\n+\n   @Test\n   public void testCast() throws IOException {\n     testSimpleEval(\"select cast (1 as char)\", new String[] {\"1\"});",
                "raw_url": "https://github.com/apache/tajo/raw/358dbace5b48cfbc139b46c96752a66b0f817908/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/TestSQLExpression.java",
                "sha": "6520f9c0d171cf752429a7e866ab2cf3bbf52bb4",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/358dbace5b48cfbc139b46c96752a66b0f817908/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/function/TestStringOperatorsAndFunctions.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/function/TestStringOperatorsAndFunctions.java?ref=358dbace5b48cfbc139b46c96752a66b0f817908",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/function/TestStringOperatorsAndFunctions.java",
                "patch": "@@ -21,12 +21,14 @@\n \n import org.apache.commons.lang.StringEscapeUtils;\n import org.apache.tajo.catalog.Schema;\n+import org.apache.tajo.catalog.exception.NoSuchFunctionException;\n import org.apache.tajo.engine.eval.ExprTestBase;\n import org.junit.Test;\n \n import java.io.IOException;\n \n import static org.apache.tajo.common.TajoDataTypes.Type.*;\n+import static org.junit.Assert.fail;\n \n public class TestStringOperatorsAndFunctions extends ExprTestBase {\n ",
                "raw_url": "https://github.com/apache/tajo/raw/358dbace5b48cfbc139b46c96752a66b0f817908/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/function/TestStringOperatorsAndFunctions.java",
                "sha": "f1d0ce3d89d92a03df7366dc710d28551791a617",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/358dbace5b48cfbc139b46c96752a66b0f817908/tajo-rpc/src/main/java/org/apache/tajo/rpc/ServerCallable.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-rpc/src/main/java/org/apache/tajo/rpc/ServerCallable.java?ref=358dbace5b48cfbc139b46c96752a66b0f817908",
                "deletions": 3,
                "filename": "tajo-rpc/src/main/java/org/apache/tajo/rpc/ServerCallable.java",
                "patch": "@@ -78,8 +78,7 @@ public void abort() {\n    *\n    * @param <T> the type of the return value\n    * @return an object of type T\n-   * @throws java.io.IOException if a remote or network exception occurs\n-   * @throws RuntimeException other unspecified error\n+   * @throws com.google.protobuf.ServiceException if a remote or network exception occurs\n    */\n   public T withRetries() throws ServiceException {\n     //TODO configurable\n@@ -105,7 +104,7 @@ public T withRetries() throws ServiceException {\n           throw new ServiceException(t.getMessage(), t);\n         }\n         if (tries == numRetries - 1) {\n-          throw new RetriesExhaustedException(tries, exceptions);\n+          throw new ServiceException(\"Giving up after tries=\" + tries, t);\n         }\n       } finally {\n         afterCall();",
                "raw_url": "https://github.com/apache/tajo/raw/358dbace5b48cfbc139b46c96752a66b0f817908/tajo-rpc/src/main/java/org/apache/tajo/rpc/ServerCallable.java",
                "sha": "143c9f7b4b25a0606efa52911ab9bd3e53832944",
                "status": "modified"
            }
        ],
        "message": "TAJO-360: If there is no matched function, catalog causes NPE. (hyoungjunkim via hyunsik)",
        "parent": "https://github.com/apache/tajo/commit/9a9d6eaf432f1903414792a0384b464753aa52a3",
        "patched_files": [
            "CatalogServer.java",
            "AbstractCatalogClient.java",
            "UndefinedFunctionException.java",
            "CHANGES.txt",
            "ServerCallable.java",
            "ExprAnnotator.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestCatalog.java",
            "TestStringOperatorsAndFunctions.java",
            "TestSQLExpression.java"
        ]
    },
    "tajo_450fbcb": {
        "bug_id": "tajo_450fbcb",
        "commit": "https://github.com/apache/tajo/commit/450fbcb93c02c74fd8889751bdec5ce155e3e294",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/450fbcb93c02c74fd8889751bdec5ce155e3e294/CHANGES.txt",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES.txt?ref=450fbcb93c02c74fd8889751bdec5ce155e3e294",
                "deletions": 0,
                "filename": "CHANGES.txt",
                "patch": "@@ -160,6 +160,8 @@ Release 0.8.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-442: Cast operator with nested functions causes NPE. (hyunsik)\n+\n     TAJO-426: HCatalogStore created partitions automatically. (jaehwa)\n \n     TAJO-418: sort operator after inline views consisting of unions can cause ",
                "raw_url": "https://github.com/apache/tajo/raw/450fbcb93c02c74fd8889751bdec5ce155e3e294/CHANGES.txt",
                "sha": "89b89eea8875457b004d9d71a9406dd4d98080e8",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/450fbcb93c02c74fd8889751bdec5ce155e3e294/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/eval/CastEval.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/eval/CastEval.java?ref=450fbcb93c02c74fd8889751bdec5ce155e3e294",
                "deletions": 2,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/eval/CastEval.java",
                "patch": "@@ -111,11 +111,11 @@ public boolean equals(Object obj) {\n   @Override\n   public void preOrder(EvalNodeVisitor visitor) {\n     visitor.visit(this);\n-    visitor.visit(operand);\n+    operand.preOrder(visitor);\n   }\n \n   public void postOrder(EvalNodeVisitor visitor) {\n-    visitor.visit(operand);\n+    operand.postOrder(visitor);\n     visitor.visit(this);\n   }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/450fbcb93c02c74fd8889751bdec5ce155e3e294/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/eval/CastEval.java",
                "sha": "411dd091cfe2d13ce992df95718c96062cb913c1",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/450fbcb93c02c74fd8889751bdec5ce155e3e294/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/TestSQLExpression.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/TestSQLExpression.java?ref=450fbcb93c02c74fd8889751bdec5ce155e3e294",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/TestSQLExpression.java",
                "patch": "@@ -60,6 +60,12 @@ public void testCast() throws IOException {\n     testSimpleEval(\"select '123'::double\", new String[] {\"123.0\"});\n   }\n \n+  @Test\n+  public void testCastWithNestedFunction() throws IOException {\n+    testSimpleEval(\"select to_timestamp(CAST(split_part('1386577650.123', '.', 1) as INT8));\",\n+        new String[] {\"1970-01-17 10:09:37\"});\n+  }\n+\n   @Test\n   public void testCastFromTable() throws IOException {\n     Schema schema = new Schema();",
                "raw_url": "https://github.com/apache/tajo/raw/450fbcb93c02c74fd8889751bdec5ce155e3e294/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/TestSQLExpression.java",
                "sha": "c96f7e54f600d8a3c67e4d4d45fc36b5f3fd2bd7",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tajo/blob/450fbcb93c02c74fd8889751bdec5ce155e3e294/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/function/TestStringOperatorsAndFunctions.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/function/TestStringOperatorsAndFunctions.java?ref=450fbcb93c02c74fd8889751bdec5ce155e3e294",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/function/TestStringOperatorsAndFunctions.java",
                "patch": "@@ -336,6 +336,11 @@ public void testOctetLength() throws IOException {\n         new String[]{\"6\"});\n   }\n \n+  @Test\n+  public void testSplitPart() throws IOException {\n+    testSimpleEval(\"select split_part('1386577650.123', '.', 1) as col1 \", new String[]{\"1386577650\"});\n+  }\n+\n   @Test\n   public void testSubstr() throws IOException {\n     testSimpleEval(\"select substr('abcdef', 3, 2) as col1 \", new String[]{\"cd\"});",
                "raw_url": "https://github.com/apache/tajo/raw/450fbcb93c02c74fd8889751bdec5ce155e3e294/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/function/TestStringOperatorsAndFunctions.java",
                "sha": "7d3aa7d1948e8aba2266fadaeceeff3cbc15d09c",
                "status": "modified"
            }
        ],
        "message": "TAJO-442: Cast operator with nested functions causes NPE. (hyunsik)",
        "parent": "https://github.com/apache/tajo/commit/f08724f9c8bb80d93db0d5517fe6351a9a4d6e63",
        "patched_files": [
            "CHANGES.txt",
            "CastEval.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestStringOperatorsAndFunctions.java",
            "TestSQLExpression.java"
        ]
    },
    "tajo_48a833f": {
        "bug_id": "tajo_48a833f",
        "commit": "https://github.com/apache/tajo/commit/48a833f3ef349da6074994d509c4da1d32a1e767",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-common/src/main/java/tajo/util/TajoIdUtils.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-common/src/main/java/tajo/util/TajoIdUtils.java?ref=48a833f3ef349da6074994d509c4da1d32a1e767",
                "deletions": 0,
                "filename": "tajo-common/src/main/java/tajo/util/TajoIdUtils.java",
                "patch": "@@ -27,6 +27,10 @@\n  * @author Hyunsik Choi\n  */\n public class TajoIdUtils {\n+  /** It is mainly for DDL statements which don's have any query id. */\n+  public static final QueryId NullQueryId =\n+      TajoIdUtils.createQueryId(BuilderUtils.newApplicationId(0, 0), 0);\n+\n   public static QueryId createQueryId(ApplicationId appId, int attemptId) {\n     return newQueryId(appId, attemptId);\n   }",
                "raw_url": "https://github.com/apache/tajo/raw/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-common/src/main/java/tajo/util/TajoIdUtils.java",
                "sha": "34f63af72bbb00c7c6caacb61b5d47826c5fa0be",
                "status": "modified"
            },
            {
                "additions": 16,
                "blob_url": "https://github.com/apache/tajo/blob/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/main/java/tajo/cli/TajoCli.java",
                "changes": 30,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/cli/TajoCli.java?ref=48a833f3ef349da6074994d509c4da1d32a1e767",
                "deletions": 14,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/cli/TajoCli.java",
                "patch": "@@ -9,12 +9,13 @@\n import tajo.QueryId;\n import tajo.catalog.Column;\n import tajo.catalog.TableDesc;\n+import tajo.client.ClientProtocol;\n import tajo.client.TajoClient;\n import tajo.conf.TajoConf;\n import tajo.conf.TajoConf.ConfVars;\n import tajo.master.cluster.ServerName;\n-import tajo.master.cluster.ServerNodeTracker;\n import tajo.util.FileUtil;\n+import tajo.util.TajoIdUtils;\n \n import java.io.InputStream;\n import java.io.OutputStream;\n@@ -29,12 +30,9 @@\n public class TajoCli {\n   private final TajoConf conf;\n   private static final Options options;\n-  private ServerNodeTracker masterTracker;\n   private TajoClient client;\n \n-  private String zkAddr;\n   private String entryAddr;\n-  private static final int WAIT_TIME = 3000;\n   private static final int PRINT_LIMIT = 24;\n \n   private ConsoleReader reader;\n@@ -131,11 +129,19 @@ public int executeShell() throws Exception {\n       } else if (cmd[0].equalsIgnoreCase(\"history\")) {\n \n       } else {\n-        QueryId queryId = client.executeQuery(line);\n-        if (queryId != null) {\n-          getQueryResult(queryId);\n+        ClientProtocol.SubmitQueryRespose response = client.executeQuery(line);\n+\n+        if (response.getResultCode() == ClientProtocol.ResultCode.OK) {\n+          QueryId queryId = new QueryId(response.getQueryId());\n+          if (queryId.equals(TajoIdUtils.NullQueryId)) {\n+            sout.println(\"OK\");\n+          } else {\n+            getQueryResult(queryId);\n+          }\n         } else {\n-          sout.println(client.getErrorMessage());\n+        if (response.hasErrorMessage()) {\n+          sout.println(response.getErrorMessage());\n+        }\n         }\n       }\n     }\n@@ -145,13 +151,9 @@ public int executeShell() throws Exception {\n     return 0;\n   }\n \n-  private void executeQuery(String tql) {\n-\n-  }\n-\n   private void getQueryResult(QueryId queryId) {\n     // if query is empty string\n-    if (queryId.equals(\"\")) {\n+    if (queryId.equals(TajoIdUtils.NullQueryId)) {\n       return;\n     }\n \n@@ -177,7 +179,7 @@ private void getQueryResult(QueryId queryId) {\n           sout.print(columnValue);\n         }\n         sout.println();\n-        sout.flush();;\n+        sout.flush();\n         numOfPrintedRows++;\n         if (numOfPrintedRows >= PRINT_LIMIT) {\n           sout.print(\"continue... ('q' is quit)\");",
                "raw_url": "https://github.com/apache/tajo/raw/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/main/java/tajo/cli/TajoCli.java",
                "sha": "5210e35fc400b15f25c65bfd6dfac7887bd46ca2",
                "status": "modified"
            },
            {
                "additions": 69,
                "blob_url": "https://github.com/apache/tajo/blob/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/main/java/tajo/client/TajoClient.java",
                "changes": 101,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/client/TajoClient.java?ref=48a833f3ef349da6074994d509c4da1d32a1e767",
                "deletions": 32,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/client/TajoClient.java",
                "patch": "@@ -1,3 +1,19 @@\n+/*\n+ * Copyright 2012 Database Lab., Korea Univ.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n package tajo.client;\n \n import com.google.protobuf.ServiceException;\n@@ -16,6 +32,7 @@\n import tajo.engine.query.ResultSetImpl;\n import tajo.rpc.ProtoBlockingRpcClient;\n import tajo.rpc.protocolrecords.PrimitiveProtos.StringProto;\n+import tajo.util.TajoIdUtils;\n \n import java.io.IOException;\n import java.net.InetSocketAddress;\n@@ -41,13 +58,11 @@ public TajoClient(TajoConf conf) throws IOException {\n \n   public TajoClient(InetSocketAddress addr) throws IOException {\n     this.conf = new TajoConf();\n-    this.conf.setBoolVar(ConfVars.CLUSTER_DISTRIBUTED, true);\n     connect(addr);\n   }\n \n   public TajoClient(String hostname, int port) throws IOException {\n     this.conf = new TajoConf();\n-    this.conf.setBoolVar(ConfVars.CLUSTER_DISTRIBUTED, true);\n     connect(NetUtils.createSocketAddr(hostname, port));\n   }\n \n@@ -59,7 +74,7 @@ private void connect(InetSocketAddress addr) throws IOException {\n       throw new IOException(e);\n     }\n \n-    LOG.info(\"Connected to tajo cluster (\" +\n+    LOG.info(\"connected to tajo cluster (\" +\n         tajo.util.NetUtils.getIpPortString(addr) + \")\");\n   }\n \n@@ -71,30 +86,38 @@ public boolean isConnected() {\n     return client.isConnected();\n   }\n \n-  private String errorMessage;\n-\n-  public QueryId executeQuery(String tql) throws ServiceException {\n+  /**\n+   * It submits a query statement and get a response immediately.\n+   * The response only contains a query id, and submission status.\n+   * In order to get the result, you should use {@link #getQueryResult(tajo.QueryId)}\n+   * or {@link #getQueryResultAndWait(tajo.QueryId)}.\n+   */\n+  public SubmitQueryRespose executeQuery(String tql) throws ServiceException {\n     QueryRequest.Builder builder = QueryRequest.newBuilder();\n     builder.setQuery(tql);\n-    SubmitQueryRespose response = service.submitQuery(null, builder.build());\n-    if (response.hasErrorMessage()) {\n-      errorMessage = response.getErrorMessage();\n-      return null;\n-    }\n-    return new QueryId(response.getQueryId());\n-  }\n \n-  public String getErrorMessage() {\n-    return errorMessage;\n+    return service.submitQuery(null, builder.build());\n   }\n \n-  public ResultSet executeQueryAndWait(String tql)\n+  /**\n+   * It submits a query statement and get a response.\n+   * The main difference from {@link #executeQuery(String)}\n+   * is a blocking method. So, this method is wait for\n+   * the finish of the submitted query.\n+   *\n+   * @return If failed, return null.\n+   */\n+  public ResultSet executeQueryAndGetResult(String tql)\n       throws ServiceException, IOException {\n     QueryRequest.Builder builder = QueryRequest.newBuilder();\n     builder.setQuery(tql);\n     SubmitQueryRespose response = service.submitQuery(null, builder.build());\n+    QueryId queryId = new QueryId(response.getQueryId());\n+    if (queryId.equals(TajoIdUtils.NullQueryId)) {\n+      return null;\n+    }\n \n-    return getQueryResultAndWait(new QueryId(response.getQueryId()));\n+    return getQueryResultAndWait(queryId);\n   }\n \n   public QueryStatus getQueryStatus(QueryId queryId) throws ServiceException {\n@@ -116,18 +139,24 @@ private static boolean isQueryRunnning(QueryState state) {\n \n   public ResultSet getQueryResult(QueryId queryId)\n       throws ServiceException, IOException {\n-    TableDesc tableDesc = getQueryResultDesc(queryId);\n-    ResultSet resultSet = new ResultSetImpl(conf, tableDesc.getPath());\n-    return resultSet;\n+    if (queryId.equals(TajoIdUtils.NullQueryId)) {\n+      return null;\n+    }\n+\n+    TableDesc tableDesc = getResultDesc(queryId);\n+    return new ResultSetImpl(conf, tableDesc.getPath());\n   }\n \n   public ResultSet getQueryResultAndWait(QueryId queryId)\n       throws ServiceException, IOException {\n+    if (queryId.equals(TajoIdUtils.NullQueryId)) {\n+      return null;\n+    }\n     QueryStatus status = getQueryStatus(queryId);\n \n     while(status != null && isQueryRunnning(status.getState())) {\n       try {\n-        Thread.sleep(1000);\n+        Thread.sleep(500);\n       } catch (InterruptedException e) {\n         e.printStackTrace();\n       }\n@@ -144,26 +173,26 @@ public ResultSet getQueryResultAndWait(QueryId queryId)\n     }\n   }\n \n-  public TableDesc getQueryResultDesc(QueryId queryId) throws ServiceException {\n+  public TableDesc getResultDesc(QueryId queryId) throws ServiceException {\n+    if (queryId.equals(TajoIdUtils.NullQueryId)) {\n+      return null;\n+    }\n+\n     GetQueryResultRequest.Builder builder = GetQueryResultRequest.newBuilder();\n     builder.setQueryId(queryId.getProto());\n     GetQueryResultResponse response = service.getQueryResult(null,\n         builder.build());\n \n-    TableDesc tableDesc = TCatUtil.newTableDesc(response.getTableDesc());\n-    return tableDesc;\n+    return TCatUtil.newTableDesc(response.getTableDesc());\n   }\n \n   public boolean updateQuery(String tql) throws ServiceException {\n     QueryRequest.Builder builder = QueryRequest.newBuilder();\n     builder.setQuery(tql);\n \n-    if (service.updateQuery(null, builder.build()).getResultCode()\n-        == ResultCode.OK) {\n-      return true;\n-    } else {\n-      return false;\n-    }\n+    ResultCode resultCode =\n+        service.updateQuery(null, builder.build()).getResultCode();\n+    return resultCode == ResultCode.OK;\n   }\n \n   public boolean existTable(String name) throws ServiceException {\n@@ -177,11 +206,15 @@ public TableDesc attachTable(String name, String path)\n     AttachTableRequest.Builder builder = AttachTableRequest.newBuilder();\n     builder.setName(name);\n     builder.setPath(path);\n-    TableResponse res = null;\n-    res = service.attachTable(null, builder.build());\n+    TableResponse res = service.attachTable(null, builder.build());\n     return TCatUtil.newTableDesc(res.getTableDesc());\n   }\n \n+  public TableDesc attachTable(String name, Path path)\n+      throws ServiceException {\n+    return attachTable(name, path.toString());\n+  }\n+\n   public boolean detachTable(String name) throws ServiceException {\n     StringProto.Builder builder = StringProto.newBuilder();\n     builder.setValue(name);\n@@ -208,6 +241,10 @@ public boolean dropTable(String name) throws ServiceException {\n     return null;\n   }\n \n+  /**\n+   * Get a list of table names. All table and column names are\n+   * represented as lower-case letters.\n+   */\n   public List<String> getTableList() throws ServiceException {\n     GetTableListRequest.Builder builder = GetTableListRequest.newBuilder();\n     GetTableListResponse res = service.getTableList(null, builder.build());",
                "raw_url": "https://github.com/apache/tajo/raw/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/main/java/tajo/client/TajoClient.java",
                "sha": "1f2a93e5e184ae5a4a2a3a3ef1faae207056b837",
                "status": "modified"
            },
            {
                "additions": 21,
                "blob_url": "https://github.com/apache/tajo/blob/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/main/java/tajo/master/ClientService.java",
                "changes": 31,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/master/ClientService.java?ref=48a833f3ef349da6074994d509c4da1d32a1e767",
                "deletions": 10,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/master/ClientService.java",
                "patch": "@@ -25,6 +25,7 @@\n import org.apache.hadoop.yarn.proto.YarnProtos.ApplicationAttemptIdProto;\n import org.apache.hadoop.yarn.service.AbstractService;\n import tajo.QueryId;\n+import tajo.TajoProtos;\n import tajo.catalog.*;\n import tajo.catalog.exception.AlreadyExistsTableException;\n import tajo.catalog.exception.NoSuchTableException;\n@@ -42,6 +43,7 @@\n import tajo.rpc.protocolrecords.PrimitiveProtos.BoolProto;\n import tajo.rpc.protocolrecords.PrimitiveProtos.StringProto;\n import tajo.storage.StorageUtil;\n+import tajo.util.TajoIdUtils;\n \n import java.io.IOException;\n import java.net.InetSocketAddress;\n@@ -160,6 +162,9 @@ public GetQueryResultResponse getQueryResult(RpcController controller,\n                                                  GetQueryResultRequest request)\n         throws ServiceException {\n       QueryId queryId = new QueryId(request.getQueryId());\n+      if (queryId.equals(TajoIdUtils.NullQueryId)) {\n+\n+      }\n       Query query = context.getQuery(queryId).getContext().getQuery();\n \n       GetQueryResultResponse.Builder builder\n@@ -190,21 +195,27 @@ public GetQueryStatusResponse getQueryStatus(RpcController controller,\n                                                  GetQueryStatusRequest request)\n         throws ServiceException {\n \n-      QueryId queryId = new QueryId(request.getQueryId());\n-      Query query = context.getQuery(queryId).getContext().getQuery();\n-\n       GetQueryStatusResponse.Builder builder\n           = GetQueryStatusResponse.newBuilder();\n-\n+      QueryId queryId = new QueryId(request.getQueryId());\n       builder.setQueryId(request.getQueryId());\n-      if (query != null) {\n+\n+      if (queryId.equals(TajoIdUtils.NullQueryId)) {\n         builder.setResultCode(ResultCode.OK);\n-        builder.setState(query.getState());\n-        builder.setProgress(query.getProgress());\n-        builder.setExecutionTime(System.currentTimeMillis() - query.getStartTime());\n+        builder.setState(TajoProtos.QueryState.QUERY_SUCCEEDED);\n+        builder.setProgress(1.0f);\n+        builder.setExecutionTime(0);\n       } else {\n-        builder.setResultCode(ResultCode.ERROR);\n-        builder.setErrorMessage(\"No such query: \" + queryId.toString());\n+        Query query = context.getQuery(queryId).getContext().getQuery();\n+        if (query != null) {\n+          builder.setResultCode(ResultCode.OK);\n+          builder.setState(query.getState());\n+          builder.setProgress(query.getProgress());\n+          builder.setExecutionTime(System.currentTimeMillis() - query.getStartTime());\n+        } else {\n+          builder.setResultCode(ResultCode.ERROR);\n+          builder.setErrorMessage(\"No such query: \" + queryId.toString());\n+        }\n       }\n \n       return builder.build();",
                "raw_url": "https://github.com/apache/tajo/raw/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/main/java/tajo/master/ClientService.java",
                "sha": "5892d03ed4b7df2b2ecdf892ac92caf3ff0ab7d7",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/main/java/tajo/master/GlobalEngine.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/master/GlobalEngine.java?ref=48a833f3ef349da6074994d509c4da1d32a1e767",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/master/GlobalEngine.java",
                "patch": "@@ -154,7 +154,7 @@ public QueryId executeQuery(String tql)\n     if (plan.getSubNode().getType() == ExprType.CREATE_TABLE) {\n       createTable(plan);\n \n-      return null;\n+      return TajoIdUtils.NullQueryId;\n     } else {\n       ApplicationAttemptId appAttemptId = submitQuery();\n       QueryId queryId = TajoIdUtils.createQueryId(appAttemptId);",
                "raw_url": "https://github.com/apache/tajo/raw/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/main/java/tajo/master/GlobalEngine.java",
                "sha": "9a921da6e7f29d0095cbb69940b618202da64e54",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/test/java/tajo/LocalTajoTestingUtility.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/tajo/LocalTajoTestingUtility.java?ref=48a833f3ef349da6074994d509c4da1d32a1e767",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/test/java/tajo/LocalTajoTestingUtility.java",
                "patch": "@@ -51,7 +51,7 @@ public void setup(String[] names,\n   }\n \n   public ResultSet execute(String query) throws IOException, ServiceException {\n-    return client.executeQueryAndWait(query);\n+    return client.executeQueryAndGetResult(query);\n   }\n \n   public void shutdown() throws IOException {",
                "raw_url": "https://github.com/apache/tajo/raw/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/test/java/tajo/LocalTajoTestingUtility.java",
                "sha": "6f558e4da57768806517c4022fd8d58fb40f8000",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/test/java/tajo/TajoTestingCluster.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/tajo/TajoTestingCluster.java?ref=48a833f3ef349da6074994d509c4da1d32a1e767",
                "deletions": 3,
                "filename": "tajo-core/tajo-core-backend/src/test/java/tajo/TajoTestingCluster.java",
                "patch": "@@ -431,7 +431,7 @@ public static ResultSet runInLocal(String[] tableNames,\n       client.createTable(tableNames[i], new Path(tableDir.getAbsolutePath()), meta);\n     }\n     Thread.sleep(1000);\n-    ResultSet res = client.executeQueryAndWait(query);\n+    ResultSet res = client.executeQueryAndGetResult(query);\n     util.shutdownMiniCluster();\n     return res;\n   }\n@@ -463,7 +463,7 @@ public static ResultSet run(String[] names,\n       client.createTable(names[i], tablePath, meta);\n     }\n     Thread.sleep(1000);\n-    ResultSet res = client.executeQueryAndWait(query);\n+    ResultSet res = client.executeQueryAndGetResult(query);\n     util.shutdownMiniCluster();\n     return res;\n   }\n@@ -498,7 +498,7 @@ public static ResultSet run(String[] names,\n       client.createTable(names[i], tablePath, meta);\n     }\n     Thread.sleep(1000);\n-    ResultSet res = client.executeQueryAndWait(query);\n+    ResultSet res = client.executeQueryAndGetResult(query);\n     util.shutdownMiniCluster();\n     return res;\n   }",
                "raw_url": "https://github.com/apache/tajo/raw/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/test/java/tajo/TajoTestingCluster.java",
                "sha": "4c8381aa8500b6371662708b823d1442a8307777",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/test/java/tajo/TajoTestingUtility.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/tajo/TajoTestingUtility.java?ref=48a833f3ef349da6074994d509c4da1d32a1e767",
                "deletions": 3,
                "filename": "tajo-core/tajo-core-backend/src/test/java/tajo/TajoTestingUtility.java",
                "patch": "@@ -472,7 +472,7 @@ public static ResultSet runInLocal(String[] tableNames,\n       client.createTable(tableNames[i], new Path(tableDir.getAbsolutePath()), meta);\n     }\n     Thread.sleep(1000);\n-    ResultSet res = client.executeQueryAndWait(query);\n+    ResultSet res = client.executeQueryAndGetResult(query);\n     client.close();\n     util.shutdownMiniCluster();\n     return res;\n@@ -505,7 +505,7 @@ public static ResultSet run(String[] names,\n       client.createTable(names[i], tablePath, meta);\n     }\n     Thread.sleep(1000);\n-    ResultSet res = client.executeQueryAndWait(query);\n+    ResultSet res = client.executeQueryAndGetResult(query);\n     client.close();\n     util.shutdownMiniCluster();\n     return res;\n@@ -541,7 +541,7 @@ public static ResultSet run(String[] names,\n       client.createTable(names[i], tablePath, meta);\n     }\n     Thread.sleep(1000);\n-    ResultSet res = client.executeQueryAndWait(query);\n+    ResultSet res = client.executeQueryAndGetResult(query);\n     util.shutdownMiniCluster();\n     client.close();\n     return res;",
                "raw_url": "https://github.com/apache/tajo/raw/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/test/java/tajo/TajoTestingUtility.java",
                "sha": "f5b53cfdf7f77e5e028a4de3240d0523316ae282",
                "status": "modified"
            },
            {
                "additions": 13,
                "blob_url": "https://github.com/apache/tajo/blob/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/test/java/tajo/WorkerTestingUtil.java",
                "changes": 21,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/tajo/WorkerTestingUtil.java?ref=48a833f3ef349da6074994d509c4da1d32a1e767",
                "deletions": 8,
                "filename": "tajo-core/tajo-core-backend/src/test/java/tajo/WorkerTestingUtil.java",
                "patch": "@@ -93,18 +93,19 @@ public static Path buildTestDir(String dir) throws IOException {\n     mockupMeta = TCatUtil.newTableMeta(mockupSchema, StoreType.CSV);\n \t}\n \n-\tpublic static void writeTmpTable(TajoConf conf, String parent,\n-\t    String tbName, boolean writeMeta) throws IOException {\n-\t  StorageManager sm = StorageManager.get(conf, parent);\n+  public static void writeTmpTable(TajoConf conf, Path path,\n+                                   String tableName, boolean writeMeta)\n+      throws IOException {\n+    StorageManager sm = StorageManager.get(conf, path);\n \n     Appender appender;\n     if (writeMeta) {\n-      appender = sm.getTableAppender(mockupMeta, tbName);\n+      appender = sm.getTableAppender(mockupMeta, tableName);\n     } else {\n       FileSystem fs = sm.getFileSystem();\n-      fs.mkdirs(StorageUtil.concatPath(parent, tbName, \"data\"));\n+      fs.mkdirs(StorageUtil.concatPath(path, tableName, \"data\"));\n       appender = sm.getAppender(mockupMeta,\n-          StorageUtil.concatPath(parent, tbName, \"data\", \"tb000\"));\n+          StorageUtil.concatPath(path, tableName, \"data\", \"tb000\"));\n     }\n     int deptSize = 10000;\n     int tupleNum = 100;\n@@ -117,6 +118,11 @@ public static void writeTmpTable(TajoConf conf, String parent,\n       appender.addTuple(tuple);\n     }\n     appender.close();\n+  }\n+\n+\tpublic static void writeTmpTable(TajoConf conf, String parent,\n+\t    String tableName, boolean writeMeta) throws IOException {\n+    writeTmpTable(conf, new Path(parent), tableName, writeMeta);\n \t}\n \n   private TajoConf conf;\n@@ -151,8 +157,7 @@ public ResultSet run(String [] tableNames, File [] tables, Schema [] schemas, St\n     PhysicalPlanner phyPlanner = new PhysicalPlannerImpl(conf, sm);\n     PhysicalExec exec = phyPlanner.createPlan(ctx, plan);\n \n-    ResultSet result = new ResultSetImpl(conf, new File(workDir, \"out\").getAbsolutePath());\n-    return result;\n+    return new ResultSetImpl(conf, new File(workDir, \"out\").getAbsolutePath());\n   }\n \n   public static File createTmpTestDir() {",
                "raw_url": "https://github.com/apache/tajo/raw/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/test/java/tajo/WorkerTestingUtil.java",
                "sha": "03ba95485429a8d10abf48919b3ea59e67b90334",
                "status": "modified"
            },
            {
                "additions": 48,
                "blob_url": "https://github.com/apache/tajo/blob/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/test/java/tajo/client/TestTajoClient.java",
                "changes": 74,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/tajo/client/TestTajoClient.java?ref=48a833f3ef349da6074994d509c4da1d32a1e767",
                "deletions": 26,
                "filename": "tajo-core/tajo-core-backend/src/test/java/tajo/client/TestTajoClient.java",
                "patch": "@@ -13,18 +13,22 @@\n import tajo.WorkerTestingUtil;\n import tajo.catalog.TableDesc;\n import tajo.conf.TajoConf;\n-import tajo.storage.StorageManager;\n+import tajo.storage.StorageUtil;\n+import tajo.util.CommonTestingUtil;\n \n import java.io.IOException;\n import java.util.Set;\n \n import static org.junit.Assert.*;\n \n @Category(IntegrationTest.class)\n-public class TestTajoCluster {\n+public class TestTajoClient {\n   private static TajoTestingCluster util;\n   private static TajoConf conf;\n   private static TajoClient tajo;\n+  private static String TEST_PATH = \"target/test-data/\"\n+      + TestTajoClient.class.getName();\n+  private static Path testDir;\n \n   @BeforeClass\n   public static void setUp() throws Exception {\n@@ -33,6 +37,8 @@ public static void setUp() throws Exception {\n     conf = util.getConfiguration();\n     Thread.sleep(3000);\n     tajo = new TajoClient(conf);\n+\n+    testDir = CommonTestingUtil.buildTestDir(TEST_PATH);\n   }\n \n   @AfterClass\n@@ -41,51 +47,66 @@ public static void tearDown() throws Exception {\n     tajo.close();\n   }\n \n+  private static Path writeTmpTable(String tableName) throws IOException {\n+    Path tablePath = StorageUtil.concatPath(testDir, tableName);\n+    WorkerTestingUtil.writeTmpTable(conf, testDir, tableName, true);\n+    return tablePath;\n+  }\n+\n   @Test\n   public final void testAttachTable() throws IOException, ServiceException {\n     final String tableName = \"attach\";\n-    WorkerTestingUtil.writeTmpTable(conf, \"/tajo/data\", tableName, true);\n+    Path tablePath = writeTmpTable(tableName);\n     assertFalse(tajo.existTable(tableName));\n-    tajo.attachTable(tableName, \"/tajo/data/attach\");\n+    tajo.attachTable(tableName, tablePath);\n     assertTrue(tajo.existTable(tableName));\n     tajo.detachTable(tableName);\n     assertFalse(tajo.existTable(tableName));\n   }\n \n   @Test\n   public final void testUpdateQuery() throws IOException, ServiceException {\n-    TajoConf conf = util.getConfiguration();\n-    final String tableName = \"updateQuery\";\n-    WorkerTestingUtil.writeTmpTable(conf, \"/tmp\", tableName, false);\n-    StorageManager sm = StorageManager.get(conf, \"/tmp\");\n-    FileSystem fs = sm.getFileSystem();\n-    assertTrue(fs.exists(new Path(\"/tmp\", tableName)));\n+    final String tableName = \"testUpdateQuery\";\n+    Path tablePath = writeTmpTable(tableName);\n \n     assertFalse(tajo.existTable(tableName));\n     String tql =\n         \"create table \" + tableName + \" (deptname string, score int) \"\n-            + \"using csv location '/tmp/\" + tableName + \"'\";\n+            + \"using csv location '\" + tablePath + \"'\";\n     tajo.updateQuery(tql);\n     assertTrue(tajo.existTable(tableName));\n   }\n \n   @Test\n   public final void testCreateAndDropTable()\n       throws IOException, ServiceException {\n-    final String tableName = \"create\";\n-    WorkerTestingUtil.writeTmpTable(conf, \"/tmp\", tableName, false);\n-    StorageManager sm = StorageManager.get(conf, \"/tmp\");\n-    FileSystem fs = sm.getFileSystem();\n-    assertTrue(fs.exists(new Path(\"/tmp\", tableName)));\n+    final String tableName = \"testCreateAndDropTable\";\n+    Path tablePath = writeTmpTable(tableName);\n+\n     assertFalse(tajo.existTable(tableName));\n-    tajo.createTable(tableName, new Path(\"/tmp\", tableName),\n-        WorkerTestingUtil.mockupMeta);\n+    tajo.createTable(tableName, tablePath, WorkerTestingUtil.mockupMeta);\n     assertTrue(tajo.existTable(tableName));\n     tajo.dropTable(tableName);\n     assertFalse(tajo.existTable(tableName));\n-    assertFalse(fs.exists(new Path(\"/tmp\", tableName)));\n+    FileSystem fs = tablePath.getFileSystem(conf);\n+    assertFalse(fs.exists(tablePath));\n+  }\n+\n+  @Test\n+  public final void testDDLByExecuteQuery() throws IOException, ServiceException {\n+    TajoConf conf = util.getConfiguration();\n+    final String tableName = \"testDDLByExecuteQuery\";\n+    WorkerTestingUtil.writeTmpTable(conf, \"/tmp\", tableName, false);\n+\n+    assertFalse(tajo.existTable(tableName));\n+    String tql =\n+        \"create table \" + tableName + \" (deptname string, score int) \"\n+            + \"using csv location '/tmp/\" + tableName + \"'\";\n+    tajo.executeQueryAndGetResult(tql);\n+    assertTrue(tajo.existTable(tableName));\n   }\n \n+  // disabled\n   public final void testGetClusterInfo() throws IOException, InterruptedException {\n     assertEquals(1,tajo.getClusterInfo().size());\n   }\n@@ -94,15 +115,16 @@ public final void testGetClusterInfo() throws IOException, InterruptedException\n   public final void testGetTableList() throws IOException, ServiceException {\n     final String tableName1 = \"table1\";\n     final String tableName2 = \"table2\";\n-    WorkerTestingUtil.writeTmpTable(conf, \"/tajo/data\", tableName1, true);\n-    WorkerTestingUtil.writeTmpTable(conf, \"/tajo/data\", tableName2, true);\n+    Path table1Path = writeTmpTable(tableName1);\n+    Path table2Path = writeTmpTable(tableName2);\n+\n     assertFalse(tajo.existTable(tableName1));\n     assertFalse(tajo.existTable(tableName2));\n-    tajo.attachTable(tableName1, \"/tajo/data/\"+tableName1);\n+    tajo.attachTable(tableName1, table1Path);\n     assertTrue(tajo.existTable(tableName1));\n     Set<String> tables = Sets.newHashSet(tajo.getTableList());\n     assertTrue(tables.contains(tableName1));\n-    tajo.attachTable(tableName2, \"/tajo/data/\"+tableName2);\n+    tajo.attachTable(tableName2, table2Path);\n     assertTrue(tajo.existTable(tableName2));\n     tables = Sets.newHashSet(tajo.getTableList());\n     assertTrue(tables.contains(tableName1));\n@@ -111,10 +133,10 @@ public final void testGetTableList() throws IOException, ServiceException {\n \n   @Test\n   public final void testGetTableDesc() throws IOException, ServiceException {\n-    final String tableName1 = \"tabledesc\";\n-    WorkerTestingUtil.writeTmpTable(conf, \"/tajo/data\", tableName1, true);\n+    final String tableName1 = \"table3\";\n+    Path tablePath = writeTmpTable(tableName1);\n     assertFalse(tajo.existTable(tableName1));\n-    tajo.attachTable(tableName1, \"/tajo/data/\"+tableName1);\n+    tajo.attachTable(tableName1, tablePath);\n     assertTrue(tajo.existTable(tableName1));\n     TableDesc desc = tajo.getTableDesc(tableName1);\n     assertNotNull(desc);",
                "previous_filename": "tajo-core/tajo-core-backend/src/test/java/tajo/client/TestTajoCluster.java",
                "raw_url": "https://github.com/apache/tajo/raw/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/test/java/tajo/client/TestTajoClient.java",
                "sha": "632ba0827b966314f70fd7873f91355f9c5b321c",
                "status": "renamed"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/test/java/tajo/engine/query/TestGlobalEngine.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/tajo/engine/query/TestGlobalEngine.java?ref=48a833f3ef349da6074994d509c4da1d32a1e767",
                "deletions": 6,
                "filename": "tajo-core/tajo-core-backend/src/test/java/tajo/engine/query/TestGlobalEngine.java",
                "patch": "@@ -241,7 +241,7 @@ public void testCreateTable() throws Exception {\n   @Test\n   public void testScanQuery() throws Exception {\n \n-    ResultSet res = client.executeQueryAndWait(query[1]);\n+    ResultSet res = client.executeQueryAndGetResult(query[1]);\n \n     String deptname;\n     while (res.next()) {\n@@ -252,7 +252,7 @@ public void testScanQuery() throws Exception {\n \n   @Test\n   public void testGroupbyQuery() throws Exception {\n-    ResultSet res = client.executeQueryAndWait(query[0]);\n+    ResultSet res = client.executeQueryAndGetResult(query[0]);\n \n     String deptname;\n     int year;\n@@ -267,7 +267,7 @@ public void testGroupbyQuery() throws Exception {\n \n   @Test\n   public void testJoin() throws Exception {\n-    ResultSet res = client.executeQueryAndWait(query[2]);\n+    ResultSet res = client.executeQueryAndGetResult(query[2]);\n \n     String deptname;\n     Set<Integer> results;\n@@ -280,7 +280,7 @@ public void testJoin() throws Exception {\n \n   @Test\n   public void testSelectAfterJoin() throws Exception {\n-    ResultSet res = client.executeQueryAndWait(query[4]);\n+    ResultSet res = client.executeQueryAndGetResult(query[4]);\n \n     String deptname;\n     Set<Integer> results;\n@@ -293,7 +293,7 @@ public void testSelectAfterJoin() throws Exception {\n \n   //@Test\n   public void testCubeby() throws Exception {\n-    ResultSet res = client.executeQueryAndWait(query[5]);\n+    ResultSet res = client.executeQueryAndGetResult(query[5]);\n \n     String deptname;\n     int year;\n@@ -330,7 +330,7 @@ public void run() {\n       @Override\n       public void run() {\n         try {\n-          queryId[0] = client.executeQuery(query[0]);\n+          queryId[0] = new QueryId(client.executeQuery(query[0]).getQueryId());\n         } catch (Exception e) {\n           e.printStackTrace();\n         }",
                "raw_url": "https://github.com/apache/tajo/raw/48a833f3ef349da6074994d509c4da1d32a1e767/tajo-core/tajo-core-backend/src/test/java/tajo/engine/query/TestGlobalEngine.java",
                "sha": "8447cdf2c9c03e5ccffa46041f2e0dc8bf9654c1",
                "status": "modified"
            }
        ],
        "message": "#84 - DDL statements cause NPE",
        "parent": "https://github.com/apache/tajo/commit/4f70ea468b3895a0724bb39fdc5e21c24174cfa7",
        "patched_files": [
            "ClientService.java",
            "LocalTajoTestingUtility.java",
            "TajoTestingCluster.java",
            "TajoClient.java",
            "GlobalEngine.java",
            "TajoTestingUtility.java",
            "WorkerTestingUtil.java",
            "TajoCli.java",
            "TajoIdUtils.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestTajoClient.java",
            "TestGlobalEngine.java"
        ]
    },
    "tajo_4ac5976": {
        "bug_id": "tajo_4ac5976",
        "commit": "https://github.com/apache/tajo/commit/4ac59763d07b4dca9c7d8d18131618806f1bcaf4",
        "file": [
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tajo/blob/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/catalog/SchemaUtil.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/catalog/SchemaUtil.java?ref=4ac59763d07b4dca9c7d8d18131618806f1bcaf4",
                "deletions": 0,
                "filename": "engine/src/main/java/nta/catalog/SchemaUtil.java",
                "patch": "@@ -1,6 +1,7 @@\n package nta.catalog;\n \n \n+import nta.engine.parser.QueryBlock;\n \n public class SchemaUtil {\n   public static Schema merge(Schema left, Schema right) {\n@@ -14,6 +15,15 @@ public static Schema merge(Schema left, Schema right) {\n     \n     return merged;\n   }\n+\n+  public static Schema merge(QueryBlock.FromTable [] fromTables) {\n+    Schema merged = new Schema();\n+    for (QueryBlock.FromTable table : fromTables) {\n+      merged.addColumns(table.getSchema());\n+    }\n+\n+    return merged;\n+  }\n   \n   public static Schema getCommons(Schema left, Schema right) {\n     Schema common = new Schema();",
                "raw_url": "https://github.com/apache/tajo/raw/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/catalog/SchemaUtil.java",
                "sha": "eef230dd00b3b68e59433a1fc0e8aaa60a2a581a",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/LeafServer.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/LeafServer.java?ref=4ac59763d07b4dca9c7d8d18131618806f1bcaf4",
                "deletions": 1,
                "filename": "engine/src/main/java/nta/engine/LeafServer.java",
                "patch": "@@ -547,7 +547,7 @@ public Task(QueryUnitRequest request) throws IOException {\n       LOG.info(\"* Task Initialization Info \");\n       LOG.info(\"* queryId: \" + request.getId());\n       LOG.info(\"* interQuery: \" + interQuery);\n-      LOG.info(\"* fragments (total: \" + request.getFragments().size());\n+      LOG.info(\"* fragments (total: \" + request.getFragments().size() + \")\");\n       for (Fragment f: request.getFragments()) {\n         LOG.info(\"** table id:\" + f.getId());\n         LOG.info(\"** path:\" + f.getPath());",
                "raw_url": "https://github.com/apache/tajo/raw/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/LeafServer.java",
                "sha": "61529f27b6ece7079d7823264d34145bb454c48b",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/QueryUnitScheduler.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/QueryUnitScheduler.java?ref=4ac59763d07b4dca9c7d8d18131618806f1bcaf4",
                "deletions": 1,
                "filename": "engine/src/main/java/nta/engine/QueryUnitScheduler.java",
                "patch": "@@ -5,6 +5,7 @@\n \n import java.net.URI;\n import java.util.ArrayList;\n+import java.util.Collection;\n import java.util.Iterator;\n import java.util.List;\n import java.util.concurrent.BlockingQueue;\n@@ -130,7 +131,7 @@ private void requestPendingQueryUnits() throws Exception {\n       }\n       \n       for (ScanNode scan : q.getScanNodes()) {\n-        List<URI> fetches = q.getFetch(scan);\n+        Collection<URI> fetches = q.getFetch(scan);\n         if (fetches != null) {\n           for (URI fetch : fetches) {\n             request.addFetch(scan.getTableId(), fetch);\n@@ -149,6 +150,7 @@ private void requestPendingQueryUnits() throws Exception {\n         LOG.info(\"InterQuery is disabled\");\n       }\n       LOG.info(\"Fetches: \" + request.getFetches());\n+      LOG.info(\"=====================================================================\");\n     }\n   }\n   ",
                "raw_url": "https://github.com/apache/tajo/raw/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/QueryUnitScheduler.java",
                "sha": "8dfe9fadffc97e23a50e8570dd0ecea96522cd86",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tajo/blob/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/cluster/QueryManager.java",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/cluster/QueryManager.java?ref=4ac59763d07b4dca9c7d8d18131618806f1bcaf4",
                "deletions": 8,
                "filename": "engine/src/main/java/nta/engine/cluster/QueryManager.java",
                "patch": "@@ -10,14 +10,8 @@\n import java.util.Map;\n \n import nta.catalog.statistics.StatSet;\n+import nta.engine.*;\n import nta.engine.MasterInterfaceProtos.InProgressStatusProto;\n-import nta.engine.Query;\n-import nta.engine.QueryId;\n-import nta.engine.QueryUnitId;\n-import nta.engine.QueryUnitScheduler;\n-import nta.engine.ScheduleUnitId;\n-import nta.engine.SubQuery;\n-import nta.engine.SubQueryId;\n import nta.engine.exception.NoSuchQueryIdException;\n import nta.engine.planner.global.QueryUnit;\n import nta.engine.planner.global.ScheduleUnit;\n@@ -101,7 +95,10 @@ public synchronized void updateQueryAssignInfo(String servername,\n   public synchronized void updateProgress(QueryUnitId queryUnitId, \n       InProgressStatusProto progress) throws NoSuchQueryIdException {\n     QueryUnit unit = queries.get(queryUnitId.getQueryId()).getQueryUnit(queryUnitId);\n-    if (unit != null) {\n+    if (unit != null\n+        && (unit.getStatus() != MasterInterfaceProtos.QueryStatus.FINISHED\n+        || unit.getStatus() != MasterInterfaceProtos.QueryStatus.ABORTED\n+        || unit.getStatus() != MasterInterfaceProtos.QueryStatus.KILLED)) {\n       unit.setProgress(progress.getProgress());\n       unit.setStatus(progress.getStatus());\n       if (progress.getPartitionsCount() > 0) {",
                "raw_url": "https://github.com/apache/tajo/raw/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/cluster/QueryManager.java",
                "sha": "988817898eff62f2b802bc5148b61d9049785c6b",
                "status": "modified"
            },
            {
                "additions": 29,
                "blob_url": "https://github.com/apache/tajo/blob/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/parser/QueryAnalyzer.java",
                "changes": 61,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/parser/QueryAnalyzer.java?ref=4ac59763d07b4dca9c7d8d18131618806f1bcaf4",
                "deletions": 32,
                "filename": "engine/src/main/java/nta/engine/parser/QueryAnalyzer.java",
                "patch": "@@ -113,9 +113,9 @@ private ParseTree parseQueryTree(final Context ctx, CommonTree ast) {\n    * @param ast\n    * @return\n    */\n-  private final CreateTableStmt parseCreateStatement(final Context ctx,\n+  private CreateTableStmt parseCreateStatement(final Context ctx,\n       final CommonTree ast) {\n-    CreateTableStmt stmt = null;\n+    CreateTableStmt stmt;\n     \n     int idx = 0;\n     CommonTree node;\n@@ -147,9 +147,9 @@ private final CreateTableStmt parseCreateStatement(final Context ctx,\n     return stmt;\n   }\n   \n-  private final Schema parseCreateTableDef(final Context ctx, final CommonTree ast) {\n+  private Schema parseCreateTableDef(final Context ctx, final CommonTree ast) {\n     Schema tableDef = new Schema();\n-    DataType type = null;\n+    DataType type;\n     for (int i = 0; i < ast.getChildCount(); i++) {\n       switch(ast.getChild(i).getChild(1).getType()) {      \n       case NQLParser.BOOL: type = DataType.BOOLEAN; break;\n@@ -170,9 +170,9 @@ private final Schema parseCreateTableDef(final Context ctx, final CommonTree ast\n     return tableDef;\n   }  \n   \n-  private final SetStmt parseSetStatement(final Context ctx,\n+  private SetStmt parseSetStatement(final Context ctx,\n       final CommonTree ast) {\n-    StatementType type = null;\n+    StatementType type;\n     boolean distinct = true;\n     ParseTree left;\n     ParseTree right;\n@@ -211,7 +211,7 @@ private final SetStmt parseSetStatement(final Context ctx,\n     return set;\n   }\n \n-  private final QueryBlock parseSelectStatement(final Context ctx,\n+  private QueryBlock parseSelectStatement(final Context ctx,\n       final CommonTree ast) {\n     \n     QueryBlock block = new QueryBlock();\n@@ -264,9 +264,8 @@ private final QueryBlock parseSelectStatement(final Context ctx,\n    * \n    * @param ctx\n    * @param ast\n-   * @param block\n    */\n-  private final CreateIndexStmt parseIndexStatement(final Context ctx,\n+  private CreateIndexStmt parseIndexStatement(final Context ctx,\n       final CommonTree ast) {\n     \n     int idx = 0;\n@@ -349,8 +348,7 @@ private void parseFromClause(final Context ctx,\n       } else if (numTables > 1) {\n         // if the number of tables is greater than 1,\n         // it means the implicit join clause\n-        JoinClause joinClause = parseImplicitJoinClause(ctx, block, \n-            (CommonTree) ast);\n+        JoinClause joinClause = parseImplicitJoinClause(ctx, block, ast);\n         block.setJoinClause(joinClause);\n       }\n     }\n@@ -361,7 +359,7 @@ private JoinClause parseImplicitJoinClause(final Context ctx,\n     int numTables = ast.getChildCount();\n     Preconditions.checkArgument(numTables > 1);\n     \n-    return parseImplicitJoinClause_(ctx, block, (CommonTree) ast, 0);\n+    return parseImplicitJoinClause_(ctx, block, ast, 0);\n   }\n   \n   private JoinClause parseImplicitJoinClause_(final Context ctx,\n@@ -392,7 +390,7 @@ private JoinClause parseImplicitJoinClause_(final Context ctx,\n   \n   private JoinClause parseExplicitJoinClause(final Context ctx, final QueryBlock block, \n       final CommonTree ast) {\n-    CommonTree joinAST = (CommonTree) ast;\n+    CommonTree joinAST = ast;\n     \n     int idx = 0;\n     int parsedJoinType = joinAST.getChild(idx).getType();\n@@ -474,7 +472,7 @@ private static FromTable parseTable(final Context ctx, final QueryBlock block,\n       final CommonTree tableAST) {\n     String tableName = tableAST.getChild(0).getText();\n     TableDesc desc = checkAndGetTableByName(ctx, tableName);\n-    FromTable table = null;\n+    FromTable table;\n     if (tableAST.getChildCount() > 1) {\n       table = new FromTable(desc, \n           tableAST.getChild(1).getText());\n@@ -511,8 +509,8 @@ private void parseSelectList(final Context ctx,\n       CommonTree node = null;\n       int numTargets = ast.getChildCount();\n       Target [] targets = new Target[numTargets];\n-      EvalNode evalTree = null;\n-      String alias = null;\n+      EvalNode evalTree;\n+      String alias;\n       \n       // the final one for each target is the alias\n       // EBNF: bool_expr AS? fieldName\n@@ -553,10 +551,10 @@ private void parseGroupByClause(final Context ctx,\n       clause.setEmptyGroupSet();\n     } else {\n       // the remain ones are grouping fields.\n-      Tree group = null;\n+      Tree group;\n       List<Column> columnRefs = new ArrayList<Column>();\n-      Column [] columns = null;\n-      Column column = null;\n+      Column [] columns;\n+      Column column;\n       for (; idx < ast.getChildCount(); idx++) {\n         group = ast.getChild(idx);\n         switch (group.getType()) {\n@@ -592,7 +590,7 @@ private void parseGroupByClause(final Context ctx,\n   private void parseHavingClause(final Context ctx,\n       final QueryBlock block, final CommonTree ast) {\n     EvalNode evalTree = \n-        createEvalTree(ctx, (CommonTree) ast.getChild(0), block);      \n+        createEvalTree(ctx, ast.getChild(0), block);\n     block.setHavingCond(evalTree);\n   }\n   \n@@ -606,7 +604,7 @@ private void parseHavingClause(final Context ctx,\n    * @param ast\n    * @return\n    */\n-  private static final Options parseParams(final Context ctx, \n+  private static Options parseParams(final Context ctx,\n       final CommonTree ast) {\n     Options params = new Options();\n     \n@@ -625,15 +623,14 @@ private static final Options parseParams(final Context ctx,\n    * EBNF: sort_specifier (COMMA sort_specifier)* -> sort_specifier+\n    * \n    * @param ctx\n-   * @param block\n    * @param ast\n    */\n   private static SortSpec [] parseSortSpecifiers(final Context ctx, \n       final CommonTree ast) {\n     int numSortKeys = ast.getChildCount();\n     SortSpec[] sortKeys = new SortSpec[numSortKeys];\n-    CommonTree node = null;\n-    Column column = null;\n+    CommonTree node;\n+    Column column;\n     \n     // Each child has the following EBNF and AST:\n     // EBNF: fn=fieldName a=order_specification? o=null_ordering? \n@@ -644,7 +641,7 @@ private static final Options parseParams(final Context ctx,\n       sortKeys[i] = new SortSpec(column);\n             \n       if (node.getChildCount() > 1) {\n-        Tree child = null;\n+        Tree child;\n         for (int j = 1; j < node.getChildCount(); j++) {\n           child = node.getChild(j);\n           \n@@ -676,9 +673,9 @@ private static Column checkAndGetColumnByAST(final Context ctx,\n       tableName = fieldNode.getChild(1).getText();\n     }\n     \n-    Column column = null;\n+    Column column;\n     if(tableName != null) {\n-      TableDesc desc = null;\n+      TableDesc desc;\n       desc = checkAndGetTableByMappedName(ctx, tableName);  \n       column = checkAndGetFieldByName(desc, columnName);\n     } else {\n@@ -696,7 +693,7 @@ private static TableDesc checkAndGetTableByMappedName(final Context ctx,\n   \n   private static TableDesc checkAndGetTableByName(final Context ctx,\n       final String tableName) {\n-    TableDesc desc = null;\n+    TableDesc desc;\n \n     try {\n       desc =\n@@ -711,7 +708,7 @@ private static TableDesc checkAndGetTableByName(final Context ctx,\n   \n   private static Column checkAndGetFieldByName(final TableDesc desc,\n       final String columnName) {\n-    Column column = null;\n+    Column column;\n     \n     column = desc.getMeta().getSchema().getColumn(desc.getId()+\".\"+columnName);\n     if(column == null) {\n@@ -730,8 +727,8 @@ private static Column checkAndGetFieldByName(final TableDesc desc,\n    * @return a found column\n    */\n   private static Column expectTableByField(Context ctx, String columnName) {\n-    TableDesc desc = null;\n-    Schema schema = null;\n+    TableDesc desc;\n+    Schema schema;\n     Column column = null;    \n     int count = 0;\n     for(String table : ctx.getInputTables()) {\n@@ -764,7 +761,7 @@ private static CommonTree parseTree(final String query) {\n     CommonTokenStream tokens = new CommonTokenStream(lexer);\n     NQLParser parser = new NQLParser(tokens);\n \n-    CommonTree ast = null;\n+    CommonTree ast;\n     try {\n       ast = ((CommonTree) parser.statement().getTree());\n     } catch (RecognitionException e) {",
                "raw_url": "https://github.com/apache/tajo/raw/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/parser/QueryAnalyzer.java",
                "sha": "b252978c3ed1d43a1ac4315f8da9e66694c0824b",
                "status": "modified"
            },
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/tajo/blob/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/planner/LogicalOptimizer.java",
                "changes": 29,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/planner/LogicalOptimizer.java?ref=4ac59763d07b4dca9c7d8d18131618806f1bcaf4",
                "deletions": 21,
                "filename": "engine/src/main/java/nta/engine/planner/LogicalOptimizer.java",
                "patch": "@@ -276,14 +276,11 @@ public void visit(LogicalNode node) {\n         break;\n       case PROJECTION:\n         ProjectionNode projNode = (ProjectionNode) node;\n-\n-        if (!projNode.isAll()) {\n-          for (Target t : projNode.getTargetList()) {\n+        for (Target t : projNode.getTargetList()) {\n             temp = EvalTreeUtil.findDistinctRefColumns(t.getEvalTree());\n             if (!temp.isEmpty()) {\n               necessary.addAll(temp);\n             }\n-          }\n         }\n \n         break;\n@@ -458,15 +455,9 @@ public static void pushProjection(Context ctx,\n     case PROJECTION:\n       ProjectionNode projNode = ((ProjectionNode)logicalNode);\n       if(necessary != null) {\n-        if(projNode.isAll()) {\n-          for(Column column : projNode.getOutputSchema().getColumns()) {\n-            necessary.add(column);\n-          }          \n-        } else {\n-          for(Target t : projNode.getTargetList()) {\n+        for(Target t : projNode.getTargetList()) {\n             getTargetListFromEvalTree(projNode.getInputSchema(), t.getEvalTree(), \n                 necessary);\n-          }\n         }\n         \n         stack.push(projNode);\n@@ -488,17 +479,13 @@ public static void pushProjection(Context ctx,\n       if (projNode.getSubNode() != null)\n         projNode.setInputSchema(projNode.getSubNode().getOutputSchema());\n       \n-      if(projNode.isAll()) {\n-        projNode.setOutputSchema(projNode.getInputSchema());  \n-      } else {\n-        Schema prjTargets = new Schema();\n-        for(Target t : projNode.getTargetList()) {\n-          DataType type = t.getEvalTree().getValueType();\n-          String name = t.getEvalTree().getName();\n-          prjTargets.addColumn(name,type);\n-        }\n-        projNode.setOutputSchema(prjTargets);\n+      Schema prjTargets = new Schema();\n+      for(Target t : projNode.getTargetList()) {\n+        DataType type = t.getEvalTree().getValueType();\n+        String name = t.getEvalTree().getName();\n+        prjTargets.addColumn(name,type);\n       }\n+      projNode.setOutputSchema(prjTargets);\n       \n       break;\n       ",
                "raw_url": "https://github.com/apache/tajo/raw/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/planner/LogicalOptimizer.java",
                "sha": "3299e4f7bb089be50d0ab4fd4ff6fdb2af2a6ead",
                "status": "modified"
            },
            {
                "additions": 20,
                "blob_url": "https://github.com/apache/tajo/blob/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/planner/LogicalPlanner.java",
                "changes": 38,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/planner/LogicalPlanner.java?ref=4ac59763d07b4dca9c7d8d18131618806f1bcaf4",
                "deletions": 18,
                "filename": "engine/src/main/java/nta/engine/planner/LogicalPlanner.java",
                "patch": "@@ -68,7 +68,7 @@ private LogicalPlanner() {\n    * @return a initial logical plan\n    */\n   public static LogicalNode createPlan(Context ctx, ParseTree query) {\n-    LogicalNode plan = null;\n+    LogicalNode plan;\n     \n     plan = createPlanInternal(ctx, query);\n     \n@@ -81,7 +81,7 @@ public static LogicalNode createPlan(Context ctx, ParseTree query) {\n   }\n   \n   private static LogicalNode createPlanInternal(Context ctx, ParseTree query) {\n-    LogicalNode plan = null;\n+    LogicalNode plan;\n     \n     switch(query.getType()) {\n     case SELECT:\n@@ -109,8 +109,8 @@ private static LogicalNode createPlanInternal(Context ctx, ParseTree query) {\n       plan = buildCreateTablePlan(ctx, createTable);\n       break;\n \n-    default:;\n-    throw new NotSupportQueryException(query.toString());\n+    default:\n+      throw new NotSupportQueryException(query.toString());\n     }\n     \n     return plan;\n@@ -129,6 +129,8 @@ private static LogicalNode buildSetPlan(Context ctx,\n     case INTERSECT:\n       bin = new IntersectNode();\n       break;\n+    default:\n+      throw new IllegalStateException(\"the statement cannot be matched to any set operation type\");\n     }\n     \n     bin.setOuter(createPlanInternal(ctx, stmt.getLeftTree()));\n@@ -182,10 +184,10 @@ private static LogicalNode buildCreateTablePlan(Context ctx,\n    * ^(SELECT from_clause? where_clause? groupby_clause? selectList)\n    * \n    * @param query\n-   * @return\n+   * @return the planed logical plan\n    */\n   private static LogicalNode buildSelectPlan(Context ctx, QueryBlock query) {\n-    LogicalNode subroot = null;\n+    LogicalNode subroot;\n     if(query.hasFromClause()) {\n       if (query.hasJoinClause()) {\n         subroot = createExplicitJoinTree(ctx, query.getJoinClause());\n@@ -246,10 +248,14 @@ private static LogicalNode buildSelectPlan(Context ctx, QueryBlock query) {\n       subroot = sortNode;\n     }\n     \n-    ProjectionNode prjNode = null;\n+    ProjectionNode prjNode;\n     if (query.getProjectAll()) {\n-      prjNode = new ProjectionNode();\n+      Schema merged = SchemaUtil.merge(query.getFromTables());\n+      Target [] allTargets = PlannerUtil.schemaToTargets(merged);\n+      prjNode = new ProjectionNode(allTargets);\n       prjNode.setSubNode(subroot);\n+      prjNode.setInputSchema(merged);\n+      prjNode.setOutputSchema(merged);\n       subroot = prjNode;\n     } else {\n       prjNode = new ProjectionNode(query.getTargetList());\n@@ -275,7 +281,7 @@ public static LogicalNode createGroupByUnionByCube(Context ctx,\n   \n   private static UnionNode createGroupByUnion(Context ctx, LogicalNode subNode, \n       List<Column []> cuboids, int idx) {\n-    UnionNode union = null;\n+    UnionNode union;\n     try {\n     if ((cuboids.size() - idx) > 2) {\n       GroupbyNode g1 = new GroupbyNode(cuboids.get(idx));\n@@ -322,7 +328,7 @@ private static UnionNode createGroupByUnion(Context ctx, LogicalNode subNode,\n     int maxBits = columns.length;    \n     \n     List<Column []> cube = Lists.newArrayList();\n-    List<Column> cuboidCols = null;\n+    List<Column> cuboidCols;\n     \n     cube.add(ALL);\n     for (int cuboidId = 1; cuboidId < numCuboids; cuboidId++) {\n@@ -340,9 +346,7 @@ private static UnionNode createGroupByUnion(Context ctx, LogicalNode subNode,\n   \n   private static LogicalNode createExplicitJoinTree(Context ctx, \n       JoinClause joinClause) {\n-    JoinNode join = null;\n-    \n-    join = new JoinNode(joinClause.getJoinType(),\n+    JoinNode join = new JoinNode(joinClause.getJoinType(),\n         new ScanNode(joinClause.getLeft()));\n     if (joinClause.hasJoinQual()) {\n       join.setJoinQual(joinClause.getJoinQual());\n@@ -358,7 +362,7 @@ private static LogicalNode createExplicitJoinTree(Context ctx,\n     }\n     \n     // Determine Join Schemas\n-    Schema merged = null;\n+    Schema merged;\n     if (join.getJoinType() == JoinType.NATURAL) {\n       merged = getNaturalJoin(join.getOuterNode(), join.getInnerNode());\n     } else {\n@@ -388,7 +392,7 @@ private static LogicalNode createExplicitJoinTree(Context ctx,\n   \n   private static EvalNode getNJCond(Schema outer, Schema inner, Schema commons) {\n     EvalNode njQual = null;\n-    EvalNode equiQual = null;\n+    EvalNode equiQual;\n     \n     Column leftJoinKey;\n     Column rightJoinKey;\n@@ -410,9 +414,7 @@ private static EvalNode getNJCond(Schema outer, Schema inner, Schema commons) {\n   \n   private static LogicalNode createImplicitJoinTree(Context ctx, \n       FromTable [] tables) {\n-    LogicalNode subroot = null;\n-    \n-    subroot = new ScanNode(tables[0]);\n+    LogicalNode subroot = new ScanNode(tables[0]);\n     Schema joinSchema = null;\n     if(tables.length > 1) {    \n       for(int i=1; i < tables.length; i++) {",
                "raw_url": "https://github.com/apache/tajo/raw/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/planner/LogicalPlanner.java",
                "sha": "313f5ef9d3ab3bb2974450cec2c356288868e8e1",
                "status": "modified"
            },
            {
                "additions": 20,
                "blob_url": "https://github.com/apache/tajo/blob/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/planner/PlannerUtil.java",
                "changes": 29,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/planner/PlannerUtil.java?ref=4ac59763d07b4dca9c7d8d18131618806f1bcaf4",
                "deletions": 9,
                "filename": "engine/src/main/java/nta/engine/planner/PlannerUtil.java",
                "patch": "@@ -6,8 +6,10 @@\n import java.util.Set;\n \n import nta.catalog.Column;\n+import nta.catalog.Schema;\n import nta.engine.exec.eval.EvalNode.Type;\n import nta.engine.exec.eval.EvalTreeUtil;\n+import nta.engine.exec.eval.FieldEval;\n import nta.engine.exec.eval.FuncCallEval;\n import nta.engine.parser.QueryBlock.SortSpec;\n import nta.engine.parser.QueryBlock.Target;\n@@ -45,8 +47,8 @@\n    * This method changes the input logical plan. If you do not want that, you\n    * should copy the input logical plan before do it.\n    * \n-   * @param plan\n-   * @return\n+   * @param plan - to be refreshed\n+   * @return refreshed Schema\n    */\n   public static LogicalNode refreshSchema(LogicalNode plan) {    \n     OutSchemaRefresher outRefresher = new OutSchemaRefresher();\n@@ -81,7 +83,7 @@ public static LogicalNode insertNode(LogicalNode parent, LogicalNode newNode) {\n    * Delete the child of a given parent operator.\n    * \n    * @param parent Must be a unary logical operator.\n-   * @return\n+   * @return input parent node\n    */\n   public static LogicalNode deleteNode(LogicalNode parent) {\n     if (parent instanceof UnaryNode) {\n@@ -333,12 +335,10 @@ public void visit(LogicalNode node) {\n       case PROJECTION:\n         ProjectionNode projNode = (ProjectionNode) node;\n \n-        if (!projNode.isAll()) {\n-          for (Target t : projNode.getTargetList()) {\n-            temp = EvalTreeUtil.findDistinctRefColumns(t.getEvalTree());\n-            if (!temp.isEmpty()) {\n-              collected.addAll(temp);\n-            }\n+        for (Target t : projNode.getTargetList()) {\n+          temp = EvalTreeUtil.findDistinctRefColumns(t.getEvalTree());\n+          if (!temp.isEmpty()) {\n+            collected.addAll(temp);\n           }\n         }\n \n@@ -406,4 +406,15 @@ public void visit(LogicalNode node) {\n       }\n     }\n   }\n+\n+  public static Target [] schemaToTargets(Schema schema) {\n+    Target [] targets = new Target[schema.getColumnNum()];\n+\n+    FieldEval eval = null;\n+    for (int i = 0; i < schema.getColumnNum(); i++) {\n+      eval = new FieldEval(schema.getColumn(i));\n+      targets[i] = new Target(eval);\n+    }\n+    return targets;\n+  }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/planner/PlannerUtil.java",
                "sha": "634a5e81fc43ba427b002fd3889ec4f041cf0ba0",
                "status": "modified"
            },
            {
                "additions": 13,
                "blob_url": "https://github.com/apache/tajo/blob/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/planner/global/QueryUnit.java",
                "changes": 29,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/planner/global/QueryUnit.java?ref=4ac59763d07b4dca9c7d8d18131618806f1bcaf4",
                "deletions": 16,
                "filename": "engine/src/main/java/nta/engine/planner/global/QueryUnit.java",
                "patch": "@@ -5,11 +5,7 @@\n \n import java.net.URI;\n import java.net.URISyntaxException;\n-import java.util.ArrayList;\n-import java.util.Collection;\n-import java.util.HashMap;\n-import java.util.List;\n-import java.util.Map;\n+import java.util.*;\n import java.util.Map.Entry;\n \n import nta.catalog.Schema;\n@@ -26,6 +22,7 @@\n import nta.engine.planner.logical.UnaryNode;\n \n import com.google.common.base.Preconditions;\n+import org.apache.hadoop.thirdparty.guava.common.collect.Sets;\n \n /**\n  * @author jihoon\n@@ -42,7 +39,7 @@\n \t\n \tprivate String hostName;\n \tprivate Map<String, List<Fragment>> fragMap;\n-\tprivate Map<String, List<URI>> fetchMap;\n+\tprivate Map<String, Set<URI>> fetchMap;\n \t\n \tprivate int expire;\n \tprivate List<Partition> partitions;\n@@ -51,7 +48,7 @@\n \tpublic QueryUnit(QueryUnitId id) {\n \t\tthis.id = id;\n \t\tscan = new ArrayList<ScanNode>();\n-    fetchMap = new HashMap<String, List<URI>>();\n+    fetchMap = new HashMap<String, Set<URI>>();\n     fragMap = new HashMap<String, List<Fragment>>();\n     partitions = new ArrayList<Partition>();\n     expire = QueryUnit.EXPIRE_TIME;\n@@ -112,28 +109,28 @@ public void addFetch(String key, String uri) throws URISyntaxException {\n \t}\n \t\n \tpublic void addFetch(String key, URI uri) {\n-\t  List<URI> uris = null;\n+\t  Set<URI> uris = null;\n \t  if (fetchMap.containsKey(key)) {\n \t    uris = fetchMap.get(key);\n \t  } else {\n-\t    uris = new ArrayList<URI>();\n+\t    uris = Sets.newHashSet();\n \t  }\n \t  uris.add(uri);\n     fetchMap.put(key, uris);\n \t}\n \t\n \tpublic void addFetches(String key, List<URI> urilist) {\n-\t  List<URI> uris = null;\n+\t  Set<URI> uris = null;\n     if (fetchMap.containsKey(key)) {\n       uris = fetchMap.get(key);\n     } else {\n-      uris = new ArrayList<URI>();\n+      uris = Sets.newHashSet();\n     }\n     uris.addAll(urilist);\n     fetchMap.put(key, uris);\n \t}\n \t\n-\tpublic void setFetches(Map<String, List<URI>> fetches) {\n+\tpublic void setFetches(Map<String, Set<URI>> fetches) {\n \t  this.fetchMap.clear();\n \t  this.fetchMap.putAll(fetches);\n \t}\n@@ -150,15 +147,15 @@ public QueryUnitId getId() {\n \t\treturn id;\n \t}\n \t\n-\tpublic List<URI> getFetchHosts(String tableId) {\n+\tpublic Collection<URI> getFetchHosts(String tableId) {\n \t  return fetchMap.get(tableId);\n \t}\n \t\n-\tpublic Collection<List<URI>> getFetches() {\n+\tpublic Collection<Set<URI>> getFetches() {\n \t  return fetchMap.values();\n \t}\n \t\n-\tpublic List<URI> getFetch(ScanNode scan) {\n+\tpublic Collection<URI> getFetch(ScanNode scan) {\n \t  return this.fetchMap.get(scan.getTableId());\n \t}\n \t\n@@ -191,7 +188,7 @@ public String toString() {\n \t      str += t + \" \";\n \t    }\n \t\t}\n-\t\tfor (Entry<String, List<URI>> e : fetchMap.entrySet()) {\n+\t\tfor (Entry<String, Set<URI>> e : fetchMap.entrySet()) {\n       str += e.getKey() + \" : \";\n       for (URI t : e.getValue()) {\n         str += t + \" \";",
                "raw_url": "https://github.com/apache/tajo/raw/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/planner/global/QueryUnit.java",
                "sha": "7809d8962781118996dd490dfb2a84ddb6671e63",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/tajo/blob/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/planner/logical/ProjectionNode.java",
                "changes": 17,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/planner/logical/ProjectionNode.java?ref=4ac59763d07b4dca9c7d8d18131618806f1bcaf4",
                "deletions": 8,
                "filename": "engine/src/main/java/nta/engine/planner/logical/ProjectionNode.java",
                "patch": "@@ -13,10 +13,15 @@\n  *\n  */\n public class ProjectionNode extends UnaryNode {\n-\t@Expose\n-\tprivate Target [] targets;\n-\t\n-\tpublic ProjectionNode() {\n+  /**\n+   * the targets are always filled even if the query is 'select *'\n+   */\n+  @Expose\tprivate Target [] targets;\n+\n+  /**\n+   * This method is for gson.\n+   */\n+\tprivate ProjectionNode() {\n \t\tsuper();\n \t}\n \n@@ -29,10 +34,6 @@ public ProjectionNode(Target [] targets) {\n \t  return this.targets;\n \t}\n \t\n-\tpublic boolean isAll() {\n-\t  return targets == null;\n-\t}\n-\t\n \tpublic void setSubNode(LogicalNode subNode) {\n \t  super.setSubNode(subNode);\n \t}",
                "raw_url": "https://github.com/apache/tajo/raw/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/java/nta/engine/planner/logical/ProjectionNode.java",
                "sha": "bde09489303f34856188a228f77be833fcfd7e2e",
                "status": "modified"
            },
            {
                "additions": 16,
                "blob_url": "https://github.com/apache/tajo/blob/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/scala/tajo/benchmark/TPCH.scala",
                "changes": 32,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/scala/tajo/benchmark/TPCH.scala?ref=4ac59763d07b4dca9c7d8d18131618806f1bcaf4",
                "deletions": 16,
                "filename": "engine/src/main/scala/tajo/benchmark/TPCH.scala",
                "patch": "@@ -21,22 +21,22 @@ class TPCH (conf : Configuration, datadir : String) extends BenchmarkSet(conf) {\n \n   override def loadSchemas() {\n     schemas += (\"lineitem\" -> (new Schema)\n-      .addColumn(\"l_orderkey\", DataType.INT)\n-      .addColumn(\"l_partkey\", DataType.INT)\n-      .addColumn(\"l_suppkey\", DataType.INT)\n-      .addColumn(\"l_linenumber\", DataType.INT)\n-      .addColumn(\"l_quantity\", DataType.FLOAT)\n-      .addColumn(\"l_extendedprice\", DataType.FLOAT)\n-      .addColumn(\"l_discount\", DataType.FLOAT)\n-      .addColumn(\"l_tax\", DataType.FLOAT)\n-      .addColumn(\"l_returnflag\", DataType.CHAR)\n-      .addColumn(\"l_linestatus\", DataType.CHAR)\n-      .addColumn(\"l_shipdate\", DataType.DATE)\n-      .addColumn(\"l_commitdate\", DataType.DATE)\n-      .addColumn(\"l_receiptdate\", DataType.DATE)\n-      .addColumn(\"l_shipinstruct\", DataType.STRING)\n-      .addColumn(\"l_shipmode\", DataType.STRING)\n-      .addColumn(\"l_comment\", DataType.STRING))\n+      .addColumn(\"l_orderkey\", DataType.INT)  // 0\n+      .addColumn(\"l_partkey\", DataType.INT) // 1\n+      .addColumn(\"l_suppkey\", DataType.INT) // 2\n+      .addColumn(\"l_linenumber\", DataType.INT) // 3\n+      .addColumn(\"l_quantity\", DataType.FLOAT) // 4\n+      .addColumn(\"l_extendedprice\", DataType.FLOAT) // 5\n+      .addColumn(\"l_discount\", DataType.FLOAT) // 6\n+      .addColumn(\"l_tax\", DataType.FLOAT) // 7\n+      .addColumn(\"l_returnflag\", DataType.CHAR) // 8\n+      .addColumn(\"l_linestatus\", DataType.CHAR) // 9\n+      .addColumn(\"l_shipdate\", DataType.DATE) // 10\n+      .addColumn(\"l_commitdate\", DataType.DATE) // 11\n+      .addColumn(\"l_receiptdate\", DataType.DATE) // 12\n+      .addColumn(\"l_shipinstruct\", DataType.STRING) // 13\n+      .addColumn(\"l_shipmode\", DataType.STRING) // 14\n+      .addColumn(\"l_comment\", DataType.STRING)) // 15\n \n     schemas += (\"customer\" -> (new Schema)\n       .addColumn(\"c_custkey\", DataType.INT)",
                "raw_url": "https://github.com/apache/tajo/raw/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/main/scala/tajo/benchmark/TPCH.scala",
                "sha": "c2b57cc0ece6aa908bd140d5f90701786a1eb09d",
                "status": "modified"
            },
            {
                "additions": 23,
                "blob_url": "https://github.com/apache/tajo/blob/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/test/java/nta/engine/TestQueries.java",
                "changes": 23,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/nta/engine/TestQueries.java?ref=4ac59763d07b4dca9c7d8d18131618806f1bcaf4",
                "deletions": 0,
                "filename": "engine/src/test/java/nta/engine/TestQueries.java",
                "patch": "@@ -36,4 +36,27 @@ public final void testSelect() throws Exception {\n     assertEquals(\"c\", res.getString(1));\n     assertTrue(2.0f == res.getFloat(2));\n   }\n+\n+  @Test\n+  public final void testSelectAsterik() throws Exception {\n+    String [] names = {\"table1\"};\n+    String [][] tables = new String[1][];\n+    tables[0] = new String[] {\"1,b,1.0\", \"2,c,2.0\"};\n+\n+    Schema[] schemas = new Schema[1];\n+    schemas[0] = new Schema()\n+        .addColumn(\"f1\", CatalogProtos.DataType.INT)\n+        .addColumn(\"f2\", CatalogProtos.DataType.STRING)\n+        .addColumn(\"f3\", CatalogProtos.DataType.FLOAT);\n+\n+    ResultSet res = NtaTestingUtility.run(names, schemas, tables, \"select * from table1\");\n+    res.next();\n+    assertEquals(1, res.getInt(0));\n+    assertEquals(\"b\", res.getString(1));\n+    assertTrue(1.0f == res.getFloat(2));\n+    res.next();\n+    assertEquals(2, res.getInt(0));\n+    assertEquals(\"c\", res.getString(1));\n+    assertTrue(2.0f == res.getFloat(2));\n+  }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/test/java/nta/engine/TestQueries.java",
                "sha": "e35a360326062da1c06441b993b4092ab8be8a5a",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tajo/blob/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/test/java/nta/engine/WorkerTestingUtil.java",
                "changes": 70,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/nta/engine/WorkerTestingUtil.java?ref=4ac59763d07b4dca9c7d8d18131618806f1bcaf4",
                "deletions": 63,
                "filename": "engine/src/test/java/nta/engine/WorkerTestingUtil.java",
                "patch": "@@ -3,24 +3,14 @@\n  */\n package nta.engine;\n \n-import static org.junit.Assert.assertEquals;\n-\n import java.io.File;\n-import java.io.FileWriter;\n import java.io.IOException;\n-import java.io.Writer;\n import java.sql.ResultSet;\n import java.util.List;\n import java.util.UUID;\n \n-import com.google.common.base.Charsets;\n import com.google.common.collect.Lists;\n-import com.google.common.io.Closeables;\n-import com.google.common.io.Files;\n-import nta.catalog.CatalogService;\n-import nta.catalog.Schema;\n-import nta.catalog.TCatUtil;\n-import nta.catalog.TableMeta;\n+import nta.catalog.*;\n import nta.catalog.proto.CatalogProtos.DataType;\n import nta.catalog.proto.CatalogProtos.StoreType;\n import nta.conf.NtaConf;\n@@ -39,24 +29,18 @@\n import nta.storage.StorageUtil;\n import nta.storage.Tuple;\n import nta.storage.VTuple;\n-import nta.util.FileUtil;\n-import nta.util.ReflectionUtil;\n \n import org.apache.hadoop.conf.Configuration;\n import org.apache.hadoop.fs.FileSystem;\n import org.apache.hadoop.fs.Path;\n-import org.apache.hadoop.io.DataInputBuffer;\n-import org.apache.hadoop.io.DataOutputBuffer;\n-import org.apache.hadoop.io.Writable;\n-import tajo.client.TajoClient;\n \n /**\n  * @author Hyunsik Choi\n  *\n  */\n public class WorkerTestingUtil {\n \n-\tpublic static final void buildTestDir(String dir) throws IOException {\n+\tpublic static void buildTestDir(String dir) throws IOException {\n \t\tPath path = new Path(dir);\n \t\tFileSystem fs = path.getFileSystem(new Configuration());\n \t\tif(fs.exists(path))\n@@ -65,46 +49,6 @@ public static final void buildTestDir(String dir) throws IOException {\n \t\tfs.mkdirs(path);\n \t}\n \n-\tpublic static final void cleanTestDir(String dir) throws IOException {\n-\t\tPath path = new Path(dir);\n-\t\tFileSystem fs = path.getFileSystem(new Configuration());\n-\t\tif(fs.exists(path))\n-\t\t\tfs.delete(path, true);\n-\t}\n-\tpublic static final void writeCSVTable(String tablePath, TableMeta meta, String [] tuples)\n-\t\tthrows IOException {\n-\t\tFile tableRoot = new File(tablePath);\n-\t\ttableRoot.mkdir();\n-\n-\t\tFile metaFile = new File(tableRoot+\"/.meta\");\n-\t\tFileUtil.writeProto(metaFile, meta.getProto());\n-\n-\t\tFile dataDir = new File(tableRoot+\"/data\");\n-\t\tdataDir.mkdir();\n-\n-\t\tFileWriter writer = new FileWriter(\n-\t\t\tnew File(tableRoot+\"/data/table1.csv\"));\n-\t\tfor(String tuple : tuples) {\n-\t\t\twriter.write(tuple+\"\\n\");\n-\t\t}\n-\t\twriter.close();\n-\t}\n-\n-\t/** Utility method for testing writables. */\n-\tpublic static Writable testWritable(Writable before) throws Exception {\n-\t\tDataOutputBuffer dob = new DataOutputBuffer();\n-\t\tbefore.write(dob);\n-\n-\t\tDataInputBuffer dib = new DataInputBuffer();\n-\t\tdib.reset(dob.getData(), dob.getLength());\n-\n-\t\tWritable after = (Writable)ReflectionUtil.newInstance(before.getClass());\n-\t\tafter.readFields(dib);\n-\n-\t\tassertEquals(before, after);\n-\t\treturn after;\n-\t}\n-\n \tpublic final static Schema mockupSchema;\n \tpublic final static TableMeta mockupMeta;\n \n@@ -119,7 +63,7 @@ public static void writeTmpTable(Configuration conf, String parent,\n \t    String tbName, boolean writeMeta) throws IOException {\n \t  StorageManager sm = StorageManager.get(conf, parent);\n \n-    Appender appender = null;\n+    Appender appender;\n     if (writeMeta) {\n       appender = sm.getTableAppender(mockupMeta, tbName);\n     } else {\n@@ -130,7 +74,7 @@ public static void writeTmpTable(Configuration conf, String parent,\n     }\n     int deptSize = 10000;\n     int tupleNum = 100;\n-    Tuple tuple = null;\n+    Tuple tuple;\n     for (int i = 0; i < tupleNum; i++) {\n       tuple = new VTuple(2);\n       String key = \"test\" + (i % deptSize);\n@@ -145,9 +89,9 @@ public static void writeTmpTable(Configuration conf, String parent,\n   private CatalogService catalog;\n   private SubqueryContext.Factory factory;\n   private QueryAnalyzer analyzer;\n-  public WorkerTestingUtil(Configuration conf, CatalogService catalog) {\n+  public WorkerTestingUtil(Configuration conf) throws IOException {\n     this.conf = conf;\n-    this.catalog = catalog;\n+    this.catalog = new LocalCatalog(conf);\n     factory = new SubqueryContext.Factory(catalog);\n     analyzer = new QueryAnalyzer(catalog);\n   }\n@@ -168,7 +112,7 @@ public ResultSet run(String [] tableNames, File [] tables, Schema [] schemas, St\n         QueryIdFactory.newScheduleUnitId(QueryIdFactory.newSubQueryId(\n                 QueryIdFactory.newQueryId()))),\n         frags.toArray(new Fragment[frags.size()]), workDir);\n-    ParseTree tree = (ParseTree) analyzer.parse(ctx, query);\n+    ParseTree tree = analyzer.parse(ctx, query);\n     LogicalNode plan = LogicalPlanner.createPlan(ctx, tree);\n     plan = LogicalOptimizer.optimize(ctx, plan);\n     PhysicalPlanner phyPlanner = new PhysicalPlanner(sm);",
                "raw_url": "https://github.com/apache/tajo/raw/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/test/java/nta/engine/WorkerTestingUtil.java",
                "sha": "fcb6e84ba269b4979370d95dba78b81f910dc463",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tajo/blob/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/test/java/nta/engine/query/TestGlobalEngine.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/nta/engine/query/TestGlobalEngine.java?ref=4ac59763d07b4dca9c7d8d18131618806f1bcaf4",
                "deletions": 1,
                "filename": "engine/src/test/java/nta/engine/query/TestGlobalEngine.java",
                "patch": "@@ -21,6 +21,7 @@\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileStatus;\n import org.apache.hadoop.fs.FileSystem;\n import org.apache.hadoop.fs.Path;\n import org.junit.After;\n@@ -104,7 +105,7 @@ public void setup() throws Exception {\n     sm = new StorageManager(conf);\n \n     catalog = master.getCatalog();\n-    groupbyResult = new HashMap<TestGlobalEngine.CompositeKey, Integer>();\n+    groupbyResult = new HashMap<CompositeKey, Integer>();\n     cubebyResult = new HashMap<CompositeKey, Integer>();\n     scanResult = new HashSet<String>();\n     joinResult = new HashMap<String, List<Integer>>();\n@@ -315,12 +316,20 @@ public void testCubeby() throws Exception {\n     Tuple tuple;\n     String deptname;\n     int year;\n+    FileSystem fs = util.getMiniDFSCluster().getFileSystem();\n     while ((tuple = scanner.next()) != null) {\n       deptname = tuple.get(0).asChars();\n       year = tuple.get(1).asInt();\n       CompositeKey key = new CompositeKey(deptname, year);\n       int expected = cubebyResult.get(key);\n       int value = tuple.get(2).asInt();\n+      if (expected != value) {\n+        System.out.println(\">>>>>>>>DIFF: \" + tuple);\n+        FileStatus [] fss = fs.listStatus(new Path(res.getPath(), \"data\"));\n+        for (FileStatus s : fss) {\n+          fs.copyToLocalFile(s.getPath(), new Path(\"file:/home/hyunsik/diff/\" + s.getPath().getName()));\n+        }\n+      }\n       assertEquals(expected, value);\n     }\n   }",
                "raw_url": "https://github.com/apache/tajo/raw/4ac59763d07b4dca9c7d8d18131618806f1bcaf4/engine/src/test/java/nta/engine/query/TestGlobalEngine.java",
                "sha": "09276c69681f7c6849c71279bdb8e5bfec15899d",
                "status": "modified"
            }
        ],
        "message": "TAJO-701: 'SELECT * FROM' Clause incurs NPE (Fixed TAJO-712)\n\nChange-Id: I731ce2acb82796b08e1400750520863fca840449\nReviewed-on: https://dbserver.korea.ac.kr/reviews/161\nTested-by:  Jenkins <build@dbserver.korea.ac.kr>\nReviewed-by: Hyunsik Choi <hyunsik.choi@gmail.com>",
        "parent": "https://github.com/apache/tajo/commit/ee3ccb50ba9bbf450aefed2d9c11bef4b8db602b",
        "patched_files": [
            "PlannerUtil.java",
            "QueryUnitScheduler.java",
            "QueryUnit.java",
            "ProjectionNode.java",
            "TPCH.scala",
            "QueryAnalyzer.java",
            "LeafServer.java",
            "LogicalOptimizer.java",
            "LogicalPlanner.java",
            "GlobalEngine.java",
            "WorkerTestingUtil.java",
            "QueryManager.java",
            "SchemaUtil.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestLogicalPlanner.java",
            "TestLogicalOptimizer.java",
            "TestPlannerUtil.java",
            "TestLeafServer.java",
            "TestGlobalEngine.java",
            "TestQueries.java",
            "TestQueryManager.java",
            "TestQueryAnalyzer.java"
        ]
    },
    "tajo_4f3a46c": {
        "bug_id": "tajo_4f3a46c",
        "commit": "https://github.com/apache/tajo/commit/4f3a46c3646ca7a551916c57c980b2862a9dbb4e",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/4f3a46c3646ca7a551916c57c980b2862a9dbb4e/CHANGES",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=4f3a46c3646ca7a551916c57c980b2862a9dbb4e",
                "deletions": 0,
                "filename": "CHANGES",
                "patch": "@@ -136,6 +136,8 @@ Release 0.11.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-1623: INSERT INTO with wrong target columns causes NPE. (hyunsik)\n+\n     TAJO-1621: Compilation error with hadoop 2.7.0. (jinho)\n \n     TAJO-1619: JDBC program is stuck after closing. (jihoon)",
                "raw_url": "https://github.com/apache/tajo/raw/4f3a46c3646ca7a551916c57c980b2862a9dbb4e/CHANGES",
                "sha": "aeda418207758ce0fc4cb4a3bb120df360bf677b",
                "status": "modified"
            },
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/tajo/blob/4f3a46c3646ca7a551916c57c980b2862a9dbb4e/tajo-core/src/test/java/org/apache/tajo/QueryTestCaseBase.java",
                "changes": 16,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/java/org/apache/tajo/QueryTestCaseBase.java?ref=4f3a46c3646ca7a551916c57c980b2862a9dbb4e",
                "deletions": 4,
                "filename": "tajo-core/src/test/java/org/apache/tajo/QueryTestCaseBase.java",
                "patch": "@@ -306,24 +306,32 @@ private static VerificationState verify(String query) throws PlanningException {\n     return state;\n   }\n \n-  public void assertValidSQL(String fileName) throws PlanningException, IOException {\n-    Path queryFilePath = getQueryFilePath(fileName);\n-    String query = FileUtil.readTextFile(new File(queryFilePath.toUri()));\n+  public void assertValidSQL(String query) throws PlanningException, IOException {\n     VerificationState state = verify(query);\n     if (state.getErrorMessages().size() > 0) {\n       fail(state.getErrorMessages().get(0));\n     }\n   }\n \n-  public void assertInvalidSQL(String fileName) throws PlanningException, IOException {\n+  public void assertValidSQLFromFile(String fileName) throws PlanningException, IOException {\n     Path queryFilePath = getQueryFilePath(fileName);\n     String query = FileUtil.readTextFile(new File(queryFilePath.toUri()));\n+    assertValidSQL(query);\n+  }\n+\n+  public void assertInvalidSQL(String query) throws PlanningException, IOException {\n     VerificationState state = verify(query);\n     if (state.getErrorMessages().size() == 0) {\n       fail(PreLogicalPlanVerifier.class.getSimpleName() + \" cannot catch any verification error: \" + query);\n     }\n   }\n \n+  public void assertInvalidSQLFromFile(String fileName) throws PlanningException, IOException {\n+    Path queryFilePath = getQueryFilePath(fileName);\n+    String query = FileUtil.readTextFile(new File(queryFilePath.toUri()));\n+    assertInvalidSQL(query);\n+  }\n+\n   public void assertPlanError(String fileName) throws PlanningException, IOException {\n     Path queryFilePath = getQueryFilePath(fileName);\n     String query = FileUtil.readTextFile(new File(queryFilePath.toUri()));",
                "raw_url": "https://github.com/apache/tajo/raw/4f3a46c3646ca7a551916c57c980b2862a9dbb4e/tajo-core/src/test/java/org/apache/tajo/QueryTestCaseBase.java",
                "sha": "9a92e909a079c8231986989ab42b5dc3860575db",
                "status": "modified"
            },
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/tajo/blob/4f3a46c3646ca7a551916c57c980b2862a9dbb4e/tajo-core/src/test/java/org/apache/tajo/engine/planner/TestQueryValidation.java",
                "changes": 17,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/java/org/apache/tajo/engine/planner/TestQueryValidation.java?ref=4f3a46c3646ca7a551916c57c980b2862a9dbb4e",
                "deletions": 5,
                "filename": "tajo-core/src/test/java/org/apache/tajo/engine/planner/TestQueryValidation.java",
                "patch": "@@ -25,19 +25,26 @@\n import java.io.IOException;\n \n public class TestQueryValidation extends QueryTestCaseBase {\n+\n+  @Test\n+  public void testInsertWithWrongTargetColumn() throws Exception {\n+    executeString(\"CREATE TABLE T1 (col1 int, col2 int)\").close();\n+    assertInvalidSQL(\"INSERT INTO T1 (col1, col3) select l_orderkey, l_partkey from default.lineitem\");\n+  }\n+\n   @Test\n   public void testLimitClauses() throws PlanningException, IOException {\n     // select * from lineitem limit 3;\n-    assertValidSQL(\"valid_limit_1.sql\");\n+    assertValidSQLFromFile(\"valid_limit_1.sql\");\n \n     // select * from lineitem limit l_orderkey;\n-    assertInvalidSQL(\"invalid_limit_1.sql\");\n+    assertInvalidSQLFromFile(\"invalid_limit_1.sql\");\n   }\n \n   @Test\n   public void testGroupByClauses() throws PlanningException, IOException {\n     // select l_orderkey from lineitem group by l_orderkey;\n-    assertValidSQL(\"valid_groupby_1.sql\");\n+    assertValidSQLFromFile(\"valid_groupby_1.sql\");\n \n     // select * from lineitem group by l_orderkey;\n     assertPlanError(\"error_groupby_1.sql\");\n@@ -48,12 +55,12 @@ public void testGroupByClauses() throws PlanningException, IOException {\n   @Test\n   public void testCaseWhenExprs() throws PlanningException, IOException {\n     // See TAJO-1098\n-    assertInvalidSQL(\"invalid_casewhen_1.sql\");\n+    assertInvalidSQLFromFile(\"invalid_casewhen_1.sql\");\n   }\n \n   @Test\n   public void testUnsupportedStoreType() throws PlanningException, IOException {\n     // See TAJO-1249\n-    assertInvalidSQL(\"invalid_store_format.sql\");\n+    assertInvalidSQLFromFile(\"invalid_store_format.sql\");\n   }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/4f3a46c3646ca7a551916c57c980b2862a9dbb4e/tajo-core/src/test/java/org/apache/tajo/engine/planner/TestQueryValidation.java",
                "sha": "fd60a5e53f6edc4b2a763abf36aa07215da62612",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/4f3a46c3646ca7a551916c57c980b2862a9dbb4e/tajo-plan/src/main/java/org/apache/tajo/plan/LogicalPlanner.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-plan/src/main/java/org/apache/tajo/plan/LogicalPlanner.java?ref=4f3a46c3646ca7a551916c57c980b2862a9dbb4e",
                "deletions": 0,
                "filename": "tajo-plan/src/main/java/org/apache/tajo/plan/LogicalPlanner.java",
                "patch": "@@ -1564,6 +1564,12 @@ private InsertNode buildInsertIntoTablePlan(PlanContext context, InsertNode inse\n       Schema targetColumns = new Schema();\n       for (int i = 0; i < targets.length; i++) {\n         Column targetColumn = desc.getLogicalSchema().getColumn(targets[i]);\n+\n+        if (targetColumn == null) {\n+          throw new PlanningException(\"column \\\"\" + targets[i] + \"\\\" of relation \\\"\" +\n+              desc.getName() + \"\\\" does not exist\");\n+        }\n+\n         targetColumns.addColumn(targetColumn);\n       }\n       insertNode.setTargetSchema(targetColumns);",
                "raw_url": "https://github.com/apache/tajo/raw/4f3a46c3646ca7a551916c57c980b2862a9dbb4e/tajo-plan/src/main/java/org/apache/tajo/plan/LogicalPlanner.java",
                "sha": "5571cdf0f230ca5e2889e6e335f0219d52121fb3",
                "status": "modified"
            }
        ],
        "message": "TAJO-1623: INSERT INTO with wrong target columns causes NPE.\n\nCloses #587",
        "parent": "https://github.com/apache/tajo/commit/1872df94355bed50a3ac55ffd7632ab532bdb506",
        "patched_files": [
            "CHANGES",
            "LogicalPlanner.java",
            "QueryTestCaseBase.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestLogicalPlanner.java",
            "TestQueryValidation.java"
        ]
    },
    "tajo_5893e74": {
        "bug_id": "tajo_5893e74",
        "commit": "https://github.com/apache/tajo/commit/5893e74978d99d25b40af4ae465471493abbb89e",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/5893e74978d99d25b40af4ae465471493abbb89e/engine/src/main/java/nta/catalog/statistics/ColumnStat.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/catalog/statistics/ColumnStat.java?ref=5893e74978d99d25b40af4ae465471493abbb89e",
                "deletions": 3,
                "filename": "engine/src/main/java/nta/catalog/statistics/ColumnStat.java",
                "patch": "@@ -107,7 +107,7 @@ public Datum getMaxValue() {\n     if (!p.hasMaxValue()) {\n       return null;\n     }\n-    this.maxValue = TupleUtil.createFromBytes(column.getDataType(), p.getMaxValue().toByteArray());\n+    this.maxValue = TupleUtil.createFromBytes(getColumn().getDataType(), p.getMaxValue().toByteArray());\n \n     return this.maxValue;\n   }\n@@ -191,10 +191,10 @@ public void initFromProto() {\n       this.numNulls = p.getNumNulls();\n     }\n     if (this.minValue == null && p.hasMinValue()) {\n-      this.minValue = TupleUtil.createFromBytes(column.getDataType(), p.getMinValue().toByteArray());\n+      this.minValue = TupleUtil.createFromBytes(getColumn().getDataType(), p.getMinValue().toByteArray());\n     }\n     if (this.maxValue == null && p.hasMaxValue()) {\n-      this.maxValue = TupleUtil.createFromBytes(column.getDataType(), p.getMaxValue().toByteArray());\n+      this.maxValue = TupleUtil.createFromBytes(getColumn().getDataType(), p.getMaxValue().toByteArray());\n     }\n   }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/5893e74978d99d25b40af4ae465471493abbb89e/engine/src/main/java/nta/catalog/statistics/ColumnStat.java",
                "sha": "0247071c2bd025fca7ed24e2aa41f532911f0cb1",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/tajo/blob/5893e74978d99d25b40af4ae465471493abbb89e/engine/src/main/java/nta/catalog/statistics/StatisticsUtil.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/catalog/statistics/StatisticsUtil.java?ref=5893e74978d99d25b40af4ae465471493abbb89e",
                "deletions": 0,
                "filename": "engine/src/main/java/nta/catalog/statistics/StatisticsUtil.java",
                "patch": "@@ -1,13 +1,18 @@\n package nta.catalog.statistics;\n \n+import com.google.common.base.Preconditions;\n import com.google.common.collect.Lists;\n+import org.apache.commons.logging.LogFactory;\n+import org.apache.commons.logging.Log;\n \n import java.util.List;\n \n /**\n  * @author Hyunsik Choi\n  */\n public class StatisticsUtil {\n+  private static final Log LOG = LogFactory.getLog(StatisticsUtil.class);\n+\n   public static StatSet aggregate(List<StatSet> statSets) {\n     StatSet aggregated = new StatSet();\n \n@@ -38,6 +43,10 @@ public static TableStat aggregate(List<TableStat> tableStats) {\n       // aggregate column stats for each table\n       for (int i = 0; i < ts.getColumnStats().size(); i++) {\n         ColumnStat cs = ts.getColumnStats().get(i);\n+        if (cs == null) {\n+          LOG.warn(\"ERROR: One of column stats is NULL (expected column: \" + css[i].getColumn() + \")\");\n+          continue;\n+        }\n         css[i].setNumDistVals(css[i].getNumDistValues() + cs.getNumDistValues());\n         css[i].setNumNulls(css[i].getNumNulls() + cs.getNumNulls());\n         if (!cs.minIsNotSet() && (css[i].minIsNotSet() ||",
                "raw_url": "https://github.com/apache/tajo/raw/5893e74978d99d25b40af4ae465471493abbb89e/engine/src/main/java/nta/catalog/statistics/StatisticsUtil.java",
                "sha": "d1ed8598b4f5bc71da053e0343cba76026ff233c",
                "status": "modified"
            }
        ],
        "message": "TAJO-802: StatisticsUtil.aggregate incurs NPE\n\nChange-Id: I0f84a623952a21f645521dd9aa6baaeaddeff0f4\nReviewed-on: https://dbserver.korea.ac.kr/reviews/234\nTested-by:  Jenkins <build@dbserver.korea.ac.kr>\nReviewed-by: Hyunsik Choi <hyunsik.choi@gmail.com>",
        "parent": "https://github.com/apache/tajo/commit/94b25a9a983a6dedeb240d635fc2f47cf23bc6ed",
        "patched_files": [
            "ColumnStat.java",
            "StatisticsUtil.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestColumnStat.java",
            "TestStatisticsUtil.java"
        ]
    },
    "tajo_5a8176d": {
        "bug_id": "tajo_5a8176d",
        "commit": "https://github.com/apache/tajo/commit/5a8176de8f52ac5c2fe3f668bcbcbd4059adf9d2",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/5a8176de8f52ac5c2fe3f668bcbcbd4059adf9d2/engine/src/main/java/nta/catalog/statistics/TableStatistics.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/catalog/statistics/TableStatistics.java?ref=5a8176de8f52ac5c2fe3f668bcbcbd4059adf9d2",
                "deletions": 6,
                "filename": "engine/src/main/java/nta/catalog/statistics/TableStatistics.java",
                "patch": "@@ -36,7 +36,9 @@ public TableStatistics(Schema schema) {\n     CatalogProtos.DataType type;\n     for (int i = 0; i < schema.getColumnNum(); i++) {\n       type = schema.getColumn(i).getDataType();\n-      if (type == CatalogProtos.DataType.SHORT ||\n+      if (type == CatalogProtos.DataType.CHAR ||\n+          type == CatalogProtos.DataType.BYTE ||\n+          type == CatalogProtos.DataType.SHORT ||\n           type == CatalogProtos.DataType.INT ||\n           type == CatalogProtos.DataType.LONG ||\n           type == CatalogProtos.DataType.FLOAT ||\n@@ -73,11 +75,7 @@ public void analyzeField(int idx, Datum datum) {\n       numNulls[idx]++;\n     }\n \n-    if (datum.type() == DatumType.LONG ||\n-        datum.type() == DatumType.INT ||\n-        datum.type() == DatumType.SHORT ||\n-        datum.type() == DatumType.FLOAT ||\n-        datum.type() == DatumType.DOUBLE) {\n+    if (datum.type() != DatumType.ARRAY) {\n       if (numericFields[idx]) {\n         if (maxValues[idx] < datum.asLong()) {\n           maxValues[idx] = datum.asLong();",
                "raw_url": "https://github.com/apache/tajo/raw/5a8176de8f52ac5c2fe3f668bcbcbd4059adf9d2/engine/src/main/java/nta/catalog/statistics/TableStatistics.java",
                "sha": "05c04794979f19603c4f57aedc6d7d907d8b71f9",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/5a8176de8f52ac5c2fe3f668bcbcbd4059adf9d2/engine/src/main/java/nta/engine/LocalTajoCluster.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/LocalTajoCluster.java?ref=5a8176de8f52ac5c2fe3f668bcbcbd4059adf9d2",
                "deletions": 1,
                "filename": "engine/src/main/java/nta/engine/LocalTajoCluster.java",
                "patch": "@@ -19,7 +19,7 @@\n \tprivate JVMClusterUtil.MasterThread masterThread;\n \tprivate final List<JVMClusterUtil.LeafServerThread> leafThreads\n \t  = new CopyOnWriteArrayList<JVMClusterUtil.LeafServerThread>();\n-\tprivate final static int DEFAULT_NO = 4;\n+\tprivate final static int DEFAULT_NO = 2;\n \tprivate final Configuration conf;\n \n \tpublic LocalTajoCluster(final Configuration conf) throws Exception {",
                "raw_url": "https://github.com/apache/tajo/raw/5a8176de8f52ac5c2fe3f668bcbcbd4059adf9d2/engine/src/main/java/nta/engine/LocalTajoCluster.java",
                "sha": "8927f2efbe33d5db53ce27a7e52554e0b038066f",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/5a8176de8f52ac5c2fe3f668bcbcbd4059adf9d2/engine/src/main/java/nta/storage/StorageUtil.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/storage/StorageUtil.java?ref=5a8176de8f52ac5c2fe3f668bcbcbd4059adf9d2",
                "deletions": 0,
                "filename": "engine/src/main/java/nta/storage/StorageUtil.java",
                "patch": "@@ -25,6 +25,7 @@ public static int getRowByteSize(Schema schema) {\n   public static int getColByteSize(Column col) {\n     switch(col.getDataType()) {\n     case BOOLEAN: return 1;\n+    case CHAR: return 1;\n     case BYTE: return 1;\n     case SHORT: return 2;\n     case INT: return 4;",
                "raw_url": "https://github.com/apache/tajo/raw/5a8176de8f52ac5c2fe3f668bcbcbd4059adf9d2/engine/src/main/java/nta/storage/StorageUtil.java",
                "sha": "c6e5564d40da8d3e8fc727793846fc9fe686d41f",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tajo/blob/5a8176de8f52ac5c2fe3f668bcbcbd4059adf9d2/engine/src/test/java/tajo/engine/TestGroupByQuery.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/tajo/engine/TestGroupByQuery.java?ref=5a8176de8f52ac5c2fe3f668bcbcbd4059adf9d2",
                "deletions": 14,
                "filename": "engine/src/test/java/tajo/engine/TestGroupByQuery.java",
                "patch": "@@ -31,18 +31,4 @@ public final void testComplexParameter2() throws Exception {\n     res.next();\n     assertEquals(8, res.getLong(\"merged\"));\n   }\n-\n-  @Test\n-  public final void testTPCH14Expr() throws Exception {\n-    // The query result is computed as:\n-    // 100 * (21168.23 + 45983) / ((21168.23 * (1-0.04)) + (45983.16 * (1-0.09)) + (44694.46 * 1)\n-    // + (54058.05 * (1-0.06)) + (46796.47 * (1-0.10)))\n-\n-    String query = \"select 100 * sum(\"+\n-        \"case when p_type like 'PROMO%' then l_extendedprice else 0 end) / sum(l_extendedprice * (1 - l_discount)) \" +\n-        \"as promo_revenue from lineitem, part where l_partkey = p_partkey\";\n-    ResultSet res = execute(query);\n-    res.next();\n-    assertEquals(33, res.getInt(1));\n-  }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/5a8176de8f52ac5c2fe3f668bcbcbd4059adf9d2/engine/src/test/java/tajo/engine/TestGroupByQuery.java",
                "sha": "9cd9abdf9816c2cc22400fe7b445b29d8ceee1da",
                "status": "modified"
            }
        ],
        "message": "TAJO-788: the order-by clause of TPC-H Q1 incurs NPE\n\nChange-Id: I7534a8e65c4b4467c9f6ac9107ac0b9bb4986989\nReviewed-on: https://dbserver.korea.ac.kr/reviews/229\nTested-by:  Jenkins <build@dbserver.korea.ac.kr>\nReviewed-by: Hyunsik Choi <hyunsik.choi@gmail.com>",
        "parent": "https://github.com/apache/tajo/commit/06161b54137354a6c9c9eda0b8a8f567f96c3095",
        "patched_files": [
            "StorageUtil.java",
            "LocalTajoCluster.java",
            "TableStatistics.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestStorageUtil.java",
            "TestGroupByQuery.java"
        ]
    },
    "tajo_5e024f9": {
        "bug_id": "tajo_5e024f9",
        "commit": "https://github.com/apache/tajo/commit/5e024f947b441fb49f5740deab119867eb655795",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/5e024f947b441fb49f5740deab119867eb655795/CHANGES",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=5e024f947b441fb49f5740deab119867eb655795",
                "deletions": 0,
                "filename": "CHANGES",
                "patch": "@@ -179,6 +179,9 @@ Release 0.10.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-1316: NPE occurs when performing window functions after join.\n+    (jihun)\n+\n     TAJO-1325: Invalid history cleaner timeout. (jinho)\n \n     TAJO-1283: ORDER BY with the first descending order causes wrong results.",
                "raw_url": "https://github.com/apache/tajo/raw/5e024f947b441fb49f5740deab119867eb655795/CHANGES",
                "sha": "e9a93324b71c1083ad6f843a60804732d4d1a801",
                "status": "modified"
            },
            {
                "additions": 38,
                "blob_url": "https://github.com/apache/tajo/blob/5e024f947b441fb49f5740deab119867eb655795/tajo-core/src/test/java/org/apache/tajo/engine/function/TestBuiltinFunctions.java",
                "changes": 38,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/java/org/apache/tajo/engine/function/TestBuiltinFunctions.java?ref=5e024f947b441fb49f5740deab119867eb655795",
                "deletions": 0,
                "filename": "tajo-core/src/test/java/org/apache/tajo/engine/function/TestBuiltinFunctions.java",
                "patch": "@@ -352,4 +352,42 @@ public void testSplitPartNested() throws Exception {\n     assertResultSet(res);\n     cleanupQuery(res);\n   }\n+  \n+  @Test\n+  public void testRankWithTwoTables() throws Exception {\n+    KeyValueSet tableOptions = new KeyValueSet();\n+    tableOptions.set(StorageConstants.TEXT_DELIMITER, StorageConstants.DEFAULT_FIELD_DELIMITER);\n+    tableOptions.set(StorageConstants.TEXT_NULL, \"\\\\\\\\N\");\n+    \n+    Schema schema = new Schema();\n+    schema.addColumn(\"id\", TajoDataTypes.Type.INT4);\n+    String[] data = new String[] {\"1\", \"3\", \"2\", \"4\"};\n+    TajoTestingCluster.createTable(\"rank_table1\", schema, tableOptions, data, 1);\n+    schema = new Schema();\n+    schema.addColumn(\"refid\", TajoDataTypes.Type.INT4);\n+    schema.addColumn(\"value\", TajoDataTypes.Type.TEXT);\n+    data = new String[] {\"1|efgh\", \"2|abcd\", \"4|erjk\", \"8|dfef\"};\n+    TajoTestingCluster.createTable(\"rank_table2\", schema, tableOptions, data, 1);\n+    ResultSet res = null;\n+    \n+    try {\n+      res = executeString(\"select rank() over (order by id) from rank_table1 a, rank_table2 b \"\n+          + \" where a.id = b.refid\");\n+      String expectedString = \"?windowfunction\\n\" +\n+          \"-------------------------------\\n\" +\n+          \"1\\n\" +\n+          \"2\\n\" +\n+          \"3\\n\";\n+      \n+      assertEquals(expectedString, resultSetToString(res));\n+    } finally {\n+      if (res != null) {\n+        try {\n+        res.close();\n+        } catch(Throwable ignored) {}\n+      }\n+      executeString(\"DROP TABLE rank_table1 PURGE\");\n+      executeString(\"DROP TABLE rank_table2 PURGE\");\n+    }\n+  }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/5e024f947b441fb49f5740deab119867eb655795/tajo-core/src/test/java/org/apache/tajo/engine/function/TestBuiltinFunctions.java",
                "sha": "9f687865fc54c3e0f05074b638799eb7b2ceaf26",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/5e024f947b441fb49f5740deab119867eb655795/tajo-plan/src/main/java/org/apache/tajo/plan/LogicalPlanner.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-plan/src/main/java/org/apache/tajo/plan/LogicalPlanner.java?ref=5e024f947b441fb49f5740deab119867eb655795",
                "deletions": 2,
                "filename": "tajo-plan/src/main/java/org/apache/tajo/plan/LogicalPlanner.java",
                "patch": "@@ -22,7 +22,6 @@\n import com.google.common.base.Joiner;\n import com.google.common.collect.Lists;\n import com.google.common.collect.Sets;\n-import org.apache.commons.lang.math.NumberUtils;\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.hadoop.conf.Configuration;\n@@ -1221,7 +1220,8 @@ private LogicalNode createCartesianProduct(PlanContext context, LogicalNode left\n       NamedExpr namedExpr = it.next();\n       try {\n         evalNode = exprAnnotator.createEvalNode(context, namedExpr.getExpr(), NameResolvingMode.LEGACY);\n-        if (EvalTreeUtil.findDistinctAggFunction(evalNode).size() == 0) {\n+        if (EvalTreeUtil.findDistinctAggFunction(evalNode).size() == 0 \n+            && EvalTreeUtil.findWindowFunction(evalNode).size() == 0) {\n           block.namedExprsMgr.markAsEvaluated(namedExpr.getAlias(), evalNode);\n           newlyEvaluatedExprs.add(namedExpr.getAlias());\n         }",
                "raw_url": "https://github.com/apache/tajo/raw/5e024f947b441fb49f5740deab119867eb655795/tajo-plan/src/main/java/org/apache/tajo/plan/LogicalPlanner.java",
                "sha": "babcb1ef24b42a870c86ea6e6409d9764f369bf2",
                "status": "modified"
            },
            {
                "additions": 22,
                "blob_url": "https://github.com/apache/tajo/blob/5e024f947b441fb49f5740deab119867eb655795/tajo-plan/src/main/java/org/apache/tajo/plan/expr/EvalTreeUtil.java",
                "changes": 22,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-plan/src/main/java/org/apache/tajo/plan/expr/EvalTreeUtil.java?ref=5e024f947b441fb49f5740deab119867eb655795",
                "deletions": 0,
                "filename": "tajo-plan/src/main/java/org/apache/tajo/plan/expr/EvalTreeUtil.java",
                "patch": "@@ -486,6 +486,28 @@ public void visit(EvalNode node) {\n       return this.aggFucntions;\n     }\n   }\n+  \n+  public static Set<WindowFunctionEval> findWindowFunction(EvalNode expr) {\n+    AllWindowFunctionFinder finder = new AllWindowFunctionFinder();\n+    expr.postOrder(finder);\n+    return finder.getWindowFunctionSet();\n+  }\n+  \n+  public static class AllWindowFunctionFinder implements EvalNodeVisitor {\n+    private Set<WindowFunctionEval> windowFunctions = Sets.newHashSet();\n+\n+    @Override\n+    public void visit(EvalNode node) {\n+      if (node.getType() == EvalType.WINDOW_FUNCTION) {\n+        WindowFunctionEval field = (WindowFunctionEval) node;\n+        windowFunctions.add(field);\n+      }\n+    }\n+    \n+    public Set<WindowFunctionEval> getWindowFunctionSet() {\n+      return windowFunctions;\n+    }\n+  }\n \n   public static <T extends EvalNode> Collection<T> findEvalsByType(EvalNode evalNode, EvalType type) {\n     EvalFinder finder = new EvalFinder(type);",
                "raw_url": "https://github.com/apache/tajo/raw/5e024f947b441fb49f5740deab119867eb655795/tajo-plan/src/main/java/org/apache/tajo/plan/expr/EvalTreeUtil.java",
                "sha": "f1d4498a851fcbe56795f6f7d983547d3c2fd854",
                "status": "modified"
            }
        ],
        "message": "TAJO-1316: NPE occurs when performing window functions after join\n\nCloses #372",
        "parent": "https://github.com/apache/tajo/commit/ae7862b284371069522a853df6a1db8249428644",
        "patched_files": [
            "EvalTreeUtil.java",
            "CHANGES",
            "LogicalPlanner.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestLogicalPlanner.java",
            "TestBuiltinFunctions.java",
            "TestEvalTreeUtil.java"
        ]
    },
    "tajo_5f9330b": {
        "bug_id": "tajo_5f9330b",
        "commit": "https://github.com/apache/tajo/commit/5f9330b101d20760dffd96ec5191134352b5a6aa",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/5f9330b101d20760dffd96ec5191134352b5a6aa/CHANGES",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=5f9330b101d20760dffd96ec5191134352b5a6aa",
                "deletions": 0,
                "filename": "CHANGES",
                "patch": "@@ -40,6 +40,9 @@ Release 0.9.0 - unreleased\n     (Hyoungjun Kim via hyunsik)\n \n   BUG FIXES\n+ \n+    TAJO-833: NPE occurs when using the column as a alias name in the multiple \n+    DISTINCT. (Hyoungjun Kim via hyunsik)\n \n     TAJO-821: IllegalStateException occurs when a NettyClientBase object is created \n     within single thread. (hyoungjunkim via jinho)",
                "raw_url": "https://github.com/apache/tajo/raw/5f9330b101d20760dffd96ec5191134352b5a6aa/CHANGES",
                "sha": "3d1ec45a1f8090845053b25c9f1dbbe9732ab2c5",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/main/java/org/apache/tajo/engine/eval/FieldEval.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/eval/FieldEval.java?ref=5f9330b101d20760dffd96ec5191134352b5a6aa",
                "deletions": 1,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/eval/FieldEval.java",
                "patch": "@@ -42,7 +42,12 @@ public FieldEval(Column column) {\n \t@Override\n \tpublic Datum eval(Schema schema, Tuple tuple) {\n \t  if (fieldId == -1) {\n-\t    fieldId = schema.getColumnId(column.getQualifiedName());\n+      // TODO - column namespace should be improved to simplify name handling and resolving.\n+      if (column.hasQualifier()) {\n+        fieldId = schema.getColumnId(column.getQualifiedName());\n+      } else {\n+        fieldId = schema.getColumnIdByName(column.getSimpleName());\n+      }\n       if (fieldId == -1) {\n         throw new IllegalStateException(\"No Such Column Reference: \" + column + \", schema: \" + schema);\n       }",
                "raw_url": "https://github.com/apache/tajo/raw/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/main/java/org/apache/tajo/engine/eval/FieldEval.java",
                "sha": "20af8542a6aad46c99757a985d40aef812e83781",
                "status": "modified"
            },
            {
                "additions": 17,
                "blob_url": "https://github.com/apache/tajo/blob/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/main/java/org/apache/tajo/engine/planner/global/builder/DistinctGroupbyBuilder.java",
                "changes": 22,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/planner/global/builder/DistinctGroupbyBuilder.java?ref=5f9330b101d20760dffd96ec5191134352b5a6aa",
                "deletions": 5,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/planner/global/builder/DistinctGroupbyBuilder.java",
                "patch": "@@ -263,7 +263,11 @@ private DistinctGroupbyNode buildBaseDistinctGroupByNode(GlobalPlanContext conte\n     int[] secondStageColumnIds = new int[secondStageDistinctNode.getOutSchema().size()];\n     int columnIdIndex = 0;\n     for (Column column: secondStageDistinctNode.getGroupingColumns()) {\n-      secondStageColumnIds[originOutputSchema.getColumnId(column.getQualifiedName())] = columnIdIndex;\n+      if (column.hasQualifier()) {\n+        secondStageColumnIds[originOutputSchema.getColumnId(column.getQualifiedName())] = columnIdIndex;\n+      } else {\n+        secondStageColumnIds[originOutputSchema.getColumnIdByName(column.getSimpleName())] = columnIdIndex;\n+      }\n       columnIdIndex++;\n     }\n \n@@ -312,8 +316,12 @@ private DistinctGroupbyNode buildBaseDistinctGroupByNode(GlobalPlanContext conte\n           int targetIdx = originGroupColumns.size() + uniqueDistinctColumn.size() + aggFuncIdx;\n           Target aggFuncTarget = oldTargets[targetIdx];\n           secondGroupbyTargets.add(aggFuncTarget);\n-          int outputColumnId = originOutputSchema.getColumnId(aggFuncTarget.getNamedColumn().getQualifiedName());\n-          secondStageColumnIds[outputColumnId] = columnIdIndex;\n+          Column column = aggFuncTarget.getNamedColumn();\n+          if (column.hasQualifier()) {\n+            secondStageColumnIds[originOutputSchema.getColumnId(column.getQualifiedName())] = columnIdIndex;\n+          } else {\n+            secondStageColumnIds[originOutputSchema.getColumnIdByName(column.getSimpleName())] = columnIdIndex;\n+          }\n           columnIdIndex++;\n         }\n         secondStageGroupbyNode.setTargets(secondGroupbyTargets.toArray(new Target[]{}));\n@@ -336,8 +344,12 @@ private DistinctGroupbyNode buildBaseDistinctGroupByNode(GlobalPlanContext conte\n           secondStageAggFunction.setArgs(new EvalNode[] {firstEval});\n \n           Target secondTarget = secondStageGroupbyNode.getTargets()[secondStageGroupbyNode.getGroupingColumns().length + aggFuncIdx];\n-          int outputColumnId = originOutputSchema.getColumnId(secondTarget.getNamedColumn().getQualifiedName());\n-          secondStageColumnIds[outputColumnId] = columnIdIndex;\n+          Column column = secondTarget.getNamedColumn();\n+          if (column.hasQualifier()) {\n+            secondStageColumnIds[originOutputSchema.getColumnId(column.getQualifiedName())] = columnIdIndex;\n+          } else {\n+            secondStageColumnIds[originOutputSchema.getColumnIdByName(column.getSimpleName())] = columnIdIndex;\n+          }\n           columnIdIndex++;\n           aggFuncIdx++;\n         }",
                "raw_url": "https://github.com/apache/tajo/raw/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/main/java/org/apache/tajo/engine/planner/global/builder/DistinctGroupbyBuilder.java",
                "sha": "8727b84eefc400ee9b304cebf6ca47e4b6aebd12",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tajo/blob/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/AggregationExec.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/AggregationExec.java?ref=5f9330b101d20760dffd96ec5191134352b5a6aa",
                "deletions": 1,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/AggregationExec.java",
                "patch": "@@ -49,7 +49,11 @@ public AggregationExec(final TaskAttemptContext context, GroupbyNode plan,\n     Column col;\n     for (int idx = 0; idx < plan.getGroupingColumns().length; idx++) {\n       col = keyColumns[idx];\n-      groupingKeyIds[idx] = inSchema.getColumnId(col.getQualifiedName());\n+      if (col.hasQualifier()) {\n+        groupingKeyIds[idx] = inSchema.getColumnId(col.getQualifiedName());\n+      } else {\n+        groupingKeyIds[idx] = inSchema.getColumnIdByName(col.getSimpleName());\n+      }\n     }\n \n     if (plan.hasAggFunctions()) {",
                "raw_url": "https://github.com/apache/tajo/raw/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/AggregationExec.java",
                "sha": "2a671e63068786aa582a4df46f489c23b6829905",
                "status": "modified"
            },
            {
                "additions": 51,
                "blob_url": "https://github.com/apache/tajo/blob/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/DistinctGroupbyHashAggregationExec.java",
                "changes": 62,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/DistinctGroupbyHashAggregationExec.java?ref=5f9330b101d20760dffd96ec5191134352b5a6aa",
                "deletions": 11,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/DistinctGroupbyHashAggregationExec.java",
                "patch": "@@ -40,7 +40,6 @@\n \n   private HashAggregator[] hashAggregators;\n   private PhysicalExec child;\n-  private int distinctGroupingKeyNum;\n   private int distinctGroupingKeyIds[];\n   private boolean first = true;\n   private int groupbyNodeNum;\n@@ -58,14 +57,22 @@ public DistinctGroupbyHashAggregationExec(TaskAttemptContext context, DistinctGr\n     this.child = subOp;\n     this.child.init();\n \n-    distinctGroupingKeyNum = plan.getGroupingColumns().length;\n-    distinctGroupingKeyIds = new int[distinctGroupingKeyNum];\n-\n-    Column[] keyColumns = plan.getGroupingColumns();\n-    Column col;\n-    for (int idx = 0; idx < plan.getGroupingColumns().length; idx++) {\n-      col = keyColumns[idx];\n-      distinctGroupingKeyIds[idx] = inSchema.getColumnId(col.getQualifiedName());\n+    List<Integer> distinctGroupingKeyIdList = new ArrayList<Integer>();\n+    for (Column col: plan.getGroupingColumns()) {\n+      int keyIndex;\n+      if (col.hasQualifier()) {\n+        keyIndex = inSchema.getColumnId(col.getQualifiedName());\n+      } else {\n+        keyIndex = inSchema.getColumnIdByName(col.getSimpleName());\n+      }\n+      if (!distinctGroupingKeyIdList.contains(keyIndex)) {\n+        distinctGroupingKeyIdList.add(keyIndex);\n+      }\n+    }\n+    int idx = 0;\n+    distinctGroupingKeyIds = new int[distinctGroupingKeyIdList.size()];\n+    for (Integer intVal: distinctGroupingKeyIdList) {\n+      distinctGroupingKeyIds[idx++] = intVal.intValue();\n     }\n \n     List<GroupbyNode> groupbyNodes = plan.getGroupByNodes();\n@@ -152,6 +159,34 @@ public Tuple next() throws IOException {\n       return null;\n     }\n \n+\n+    /*\n+    Tuple materialization example\n+    =============================\n+\n+    Output Tuple Index: 0(l_orderkey), 1(l_partkey), 2(default.lineitem.l_suppkey), 5(default.lineitem.\n+    l_partkey), 8(sum)\n+\n+              select\n+                  lineitem.l_orderkey as l_orderkey,\n+                  lineitem.l_partkey as l_partkey,\n+                  count(distinct lineitem.l_partkey) as cnt1,\n+                  count(distinct lineitem.l_suppkey) as cnt2,\n+                  sum(lineitem.l_quantity) as sum1\n+              from\n+                  lineitem\n+              group by\n+                  lineitem.l_orderkey, lineitem.l_partkey\n+\n+    The above case will result in the following materialization\n+    ------------------------------------------------------------\n+\n+    l_orderkey  l_partkey  default.lineitem.l_suppkey  l_orderkey  l_partkey  default.lineitem.l_partkey  l_orderkey  l_partkey  sum\n+        1            1              7311                   1            1                1                    1           1      53.0\n+        1            1              7706\n+\n+    */\n+\n     currentAggregatedTuples = new ArrayList<Tuple>();\n     int listIndex = 0;\n     while (true) {\n@@ -296,9 +331,14 @@ public HashAggregator(GroupbyNode groupbyNode) throws IOException {\n       List<Integer> groupingKeyIdList = new ArrayList<Integer>(distinctGroupingKeyIdSet);\n       Column[] keyColumns = groupbyNode.getGroupingColumns();\n       Column col;\n-      for (int idx = 0; idx < groupbyNode.getGroupingColumns().length; idx++) {\n+      for (int idx = 0; idx < keyColumns.length; idx++) {\n         col = keyColumns[idx];\n-        int keyIndex = inSchema.getColumnId(col.getQualifiedName());\n+        int keyIndex;\n+        if (col.hasQualifier()) {\n+          keyIndex = inSchema.getColumnId(col.getQualifiedName());\n+        } else {\n+          keyIndex = inSchema.getColumnIdByName(col.getSimpleName());\n+        }\n         if (!distinctGroupingKeyIdSet.contains(keyIndex)) {\n           groupingKeyIdList.add(keyIndex);\n         }",
                "raw_url": "https://github.com/apache/tajo/raw/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/DistinctGroupbyHashAggregationExec.java",
                "sha": "8daad0b2bc9c2036ee8eac75b96d5989984c9fe2",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tajo/blob/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/DistinctGroupbySortAggregationExec.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/DistinctGroupbySortAggregationExec.java?ref=5f9330b101d20760dffd96ec5191134352b5a6aa",
                "deletions": 7,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/DistinctGroupbySortAggregationExec.java",
                "patch": "@@ -18,7 +18,6 @@\n \n package org.apache.tajo.engine.planner.physical;\n \n-import org.apache.tajo.catalog.Column;\n import org.apache.tajo.catalog.statistics.TableStats;\n import org.apache.tajo.engine.planner.logical.DistinctGroupbyNode;\n import org.apache.tajo.engine.planner.logical.GroupbyNode;\n@@ -34,8 +33,6 @@\n \n   private boolean finished = false;\n \n-  private int distinctGroupingKeyNum;\n-\n   private Tuple[] currentTuples;\n   private int outColumnNum;\n   private int groupbyNodeNum;\n@@ -49,9 +46,6 @@ public DistinctGroupbySortAggregationExec(final TaskAttemptContext context, Dist\n     this.aggregateExecs = aggregateExecs;\n     this.groupbyNodeNum = plan.getGroupByNodes().size();\n \n-    final Column[] keyColumns = plan.getGroupingColumns();\n-    distinctGroupingKeyNum = keyColumns.length;\n-\n     currentTuples = new Tuple[groupbyNodeNum];\n     outColumnNum = outSchema.size();\n \n@@ -116,7 +110,6 @@ public Tuple next() throws IOException {\n         mergeTupleIndex++;\n       }\n     }\n-\n     return mergedTuple;\n   }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/DistinctGroupbySortAggregationExec.java",
                "sha": "fd79725da3e1776edbc876621c0fdf0a045e9891",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tajo/blob/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/SortAggregateExec.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/SortAggregateExec.java?ref=5f9330b101d20760dffd96ec5191134352b5a6aa",
                "deletions": 1,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/SortAggregateExec.java",
                "patch": "@@ -57,7 +57,6 @@ public Tuple next() throws IOException {\n     Tuple outputTuple = null;\n \n     while(!context.isStopped() && (tuple = child.next()) != null) {\n-\n       // get a key tuple\n       currentKey = new VTuple(groupingKeyIds.length);\n       for(int i = 0; i < groupingKeyIds.length; i++) {",
                "raw_url": "https://github.com/apache/tajo/raw/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/main/java/org/apache/tajo/engine/planner/physical/SortAggregateExec.java",
                "sha": "9a415d1d6c2f7501287c2ed5ba88543978d323fb",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/test/java/org/apache/tajo/engine/query/TestGroupByQuery.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/java/org/apache/tajo/engine/query/TestGroupByQuery.java?ref=5f9330b101d20760dffd96ec5191134352b5a6aa",
                "deletions": 0,
                "filename": "tajo-core/src/test/java/org/apache/tajo/engine/query/TestGroupByQuery.java",
                "patch": "@@ -249,6 +249,10 @@ public final void testDistinctAggregationCasebyCase() throws Exception {\n     res = executeFile(\"testDistinctAggregation_case7.sql\");\n     assertResultSet(res, \"testDistinctAggregation_case7.result\");\n     res.close();\n+\n+    res = executeFile(\"testDistinctAggregation_case8.sql\");\n+    assertResultSet(res, \"testDistinctAggregation_case8.result\");\n+    res.close();\n   }\n \n   @Test",
                "raw_url": "https://github.com/apache/tajo/raw/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/test/java/org/apache/tajo/engine/query/TestGroupByQuery.java",
                "sha": "1263bbecfe9bfe5014f257ebdaeb60a9b7fa44ea",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tajo/blob/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/test/resources/queries/TestGroupByQuery/testDistinctAggregation_case8.sql",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/queries/TestGroupByQuery/testDistinctAggregation_case8.sql?ref=5f9330b101d20760dffd96ec5191134352b5a6aa",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/queries/TestGroupByQuery/testDistinctAggregation_case8.sql",
                "patch": "@@ -0,0 +1,10 @@\n+select\n+    lineitem.l_orderkey as l_orderkey,\n+    lineitem.l_partkey as l_partkey,\n+    count(distinct lineitem.l_partkey) as cnt1,\n+    count(distinct lineitem.l_suppkey) as cnt2,\n+    sum(lineitem.l_quantity) as sum1\n+from\n+    lineitem\n+group by\n+    lineitem.l_orderkey, lineitem.l_partkey\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/test/resources/queries/TestGroupByQuery/testDistinctAggregation_case8.sql",
                "sha": "ed8e363c1fea975059b453f05cf09c565e0acb60",
                "status": "added"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/test/resources/results/TestGroupByQuery/testDistinctAggregation_case8.result",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/results/TestGroupByQuery/testDistinctAggregation_case8.result?ref=5f9330b101d20760dffd96ec5191134352b5a6aa",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/results/TestGroupByQuery/testDistinctAggregation_case8.result",
                "patch": "@@ -0,0 +1,6 @@\n+l_orderkey,l_partkey,cnt1,cnt2,sum1\n+-------------------------------\n+1,1,1,2,53.0\n+2,2,1,1,38.0\n+3,2,1,1,45.0\n+3,3,1,1,49.0\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-core/src/test/resources/results/TestGroupByQuery/testDistinctAggregation_case8.result",
                "sha": "e2348966ee6ac9750cc6f50af4d0b41bd329079f",
                "status": "added"
            },
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/tajo/blob/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-storage/src/main/java/org/apache/tajo/storage/TupleComparator.java",
                "changes": 20,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-storage/src/main/java/org/apache/tajo/storage/TupleComparator.java?ref=5f9330b101d20760dffd96ec5191134352b5a6aa",
                "deletions": 1,
                "filename": "tajo-storage/src/main/java/org/apache/tajo/storage/TupleComparator.java",
                "patch": "@@ -58,7 +58,11 @@ public TupleComparator(Schema schema, SortSpec[] sortKeys) {\n     this.asc = new boolean[sortKeys.length];\n     this.nullFirsts = new boolean[sortKeys.length];\n     for (int i = 0; i < sortKeys.length; i++) {\n-      this.sortKeyIds[i] = schema.getColumnId(sortKeys[i].getSortKey().getQualifiedName());\n+      if (sortKeys[i].getSortKey().hasQualifier()) {\n+        this.sortKeyIds[i] = schema.getColumnId(sortKeys[i].getSortKey().getQualifiedName());\n+      } else {\n+        this.sortKeyIds[i] = schema.getColumnIdByName(sortKeys[i].getSortKey().getSimpleName());\n+      }\n           \n       this.asc[i] = sortKeys[i].isAscending();\n       this.nullFirsts[i]= sortKeys[i].isNullFirst();\n@@ -160,4 +164,18 @@ public TupleComparatorProto getProto() {\n \n     return builder.build();\n   }\n+\n+  @Override\n+  public String toString() {\n+    StringBuilder sb = new StringBuilder();\n+\n+    String prefix = \"\";\n+    for (int i = 0; i < sortKeyIds.length; i++) {\n+      sb.append(prefix).append(\"SortKeyId=\").append(sortKeyIds[i])\n+        .append(\",Asc=\").append(asc[i])\n+        .append(\",NullFirst=\").append(nullFirsts[i]);\n+      prefix = \" ,\";\n+    }\n+    return sb.toString();\n+  }\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/5f9330b101d20760dffd96ec5191134352b5a6aa/tajo-storage/src/main/java/org/apache/tajo/storage/TupleComparator.java",
                "sha": "51388a47c9afb6d5d81d5a09c7e62bb0696948d5",
                "status": "modified"
            }
        ],
        "message": "TAJO-833: NPE occurs when using the column as a alias name in the multiple DISTINCT. (Hyoungjun Kim via hyunsik)\n\nCloses #11",
        "parent": "https://github.com/apache/tajo/commit/d0528d1bcb5b57b2287fd435701234cd226e8ac2",
        "patched_files": [
            "TupleComparator.java",
            "testDistinctAggregation_case8.sql",
            "SortAggregateExec.java",
            "DistinctGroupbyHashAggregationExec.java",
            "FieldEval.java",
            "DistinctGroupbySortAggregationExec.java",
            "DistinctGroupbyBuilder.java",
            "CHANGES",
            "testDistinctAggregation_case8.result",
            "AggregationExec.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestTupleComparator.java",
            "TestGroupByQuery.java"
        ]
    },
    "tajo_6cdf522": {
        "bug_id": "tajo_6cdf522",
        "commit": "https://github.com/apache/tajo/commit/6cdf5224e7b4dd8c8359278023727acb87209e81",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tajo/blob/6cdf5224e7b4dd8c8359278023727acb87209e81/engine/src/main/java/nta/engine/exec/eval/LikeEval.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/exec/eval/LikeEval.java?ref=6cdf5224e7b4dd8c8359278023727acb87209e81",
                "deletions": 7,
                "filename": "engine/src/main/java/nta/engine/exec/eval/LikeEval.java",
                "patch": "@@ -23,6 +23,8 @@\n   @Expose private boolean not;\n   @Expose private Column column;\n   @Expose private String pattern;\n+\n+  // temporal variables\n   private int fieldId = -1;\n   private Pattern compiled;\n   private BoolDatum result;\n@@ -35,11 +37,10 @@ public LikeEval(boolean not, Column column, String pattern) {\n     this();\n     this.not = not;\n     this.column = column;\n-    this.setPattern(pattern);\n+    this.pattern = pattern;\n   }\n   \n-  public void setPattern(String pattern) {\n-    this.pattern = pattern;\n+  public void compile(String pattern) {\n     String regex = pattern.replace(\"?\", \".\");\n     regex = regex.replace(\"%\", \".*\");\n     \n@@ -57,15 +58,12 @@ public DataType getValueType() {\n   public String getName() {\n     return \"?\";\n   }\n-  \n-  public String getPattern() {\n-    return this.pattern;\n-  }\n \n   @Override\n   public Datum eval(Schema schema, Tuple tuple, Datum... args) {\n     if (fieldId == -1) {\n       fieldId = schema.getColumnId(column.getQualifiedName());\n+      compile(this.pattern);\n     }    \n     StringDatum str = tuple.getString(fieldId);\n     if (not) {",
                "raw_url": "https://github.com/apache/tajo/raw/6cdf5224e7b4dd8c8359278023727acb87209e81/engine/src/main/java/nta/engine/exec/eval/LikeEval.java",
                "sha": "21e88ee208bac9cca3145c236da88aeafc6d8755",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/6cdf5224e7b4dd8c8359278023727acb87209e81/engine/src/main/java/tajo/cli/TajoCli.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/tajo/cli/TajoCli.java?ref=6cdf5224e7b4dd8c8359278023727acb87209e81",
                "deletions": 0,
                "filename": "engine/src/main/java/tajo/cli/TajoCli.java",
                "patch": "@@ -179,6 +179,7 @@ private void executeQuery(String queryStr) {\n             break;\n           }\n           numOfPrintedRows = 0;\n+          sout.println();\n         }\n       }\n     } catch (Throwable t) {",
                "raw_url": "https://github.com/apache/tajo/raw/6cdf5224e7b4dd8c8359278023727acb87209e81/engine/src/main/java/tajo/cli/TajoCli.java",
                "sha": "4e22b0e4db4fa3141266067bbeb6c73e529032f1",
                "status": "modified"
            },
            {
                "additions": 14,
                "blob_url": "https://github.com/apache/tajo/blob/6cdf5224e7b4dd8c8359278023727acb87209e81/engine/src/test/java/tajo/engine/TestSelectQuery.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/tajo/engine/TestSelectQuery.java?ref=6cdf5224e7b4dd8c8359278023727acb87209e81",
                "deletions": 0,
                "filename": "engine/src/test/java/tajo/engine/TestSelectQuery.java",
                "patch": "@@ -100,4 +100,18 @@ public final void testSelectDistinct() throws Exception {\n     }\n     assertEquals(3,cnt);\n   }\n+\n+  @Test\n+  public final void testLikeClause() throws Exception {\n+    Set<String> result = Sets.newHashSet(new String[]\n+        {\"ALGERIA\", \"ETHIOPIA\", \"INDIA\", \"INDONESIA\", \"ROMANIA\", \"SAUDI ARABIA\", \"RUSSIA\"});\n+\n+    ResultSet res = execute(\"select n_name from nation where n_name like '%IA'\");\n+    int cnt = 0;\n+    while(res.next()) {\n+      assertTrue(result.contains(res.getString(1)));\n+      cnt++;\n+    }\n+    assertEquals(result.size(), cnt);\n+  }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/6cdf5224e7b4dd8c8359278023727acb87209e81/engine/src/test/java/tajo/engine/TestSelectQuery.java",
                "sha": "1c8de56dff92da8126f9480a9621fef36abeacfd",
                "status": "modified"
            }
        ],
        "message": "TAJO-731: LIKE expression causes NPE\n\nChange-Id: Ifc8d38b26c74a54452c7244eb8f4952101780d4f\nReviewed-on: https://dbserver.korea.ac.kr/reviews/173\nTested-by:  Jenkins <build@dbserver.korea.ac.kr>\nReviewed-by: Hyunsik Choi <hyunsik.choi@gmail.com>",
        "parent": "https://github.com/apache/tajo/commit/d23dca9a281e0cf1f70df944cbc897391ec150a7",
        "patched_files": [
            "TajoCli.java",
            "LikeEval.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestSelectQuery.java"
        ]
    },
    "tajo_6cfd448": {
        "bug_id": "tajo_6cfd448",
        "commit": "https://github.com/apache/tajo/commit/6cfd448f7fb60a254a237230f071456f188f9179",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/6cfd448f7fb60a254a237230f071456f188f9179/CHANGES",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=6cfd448f7fb60a254a237230f071456f188f9179",
                "deletions": 0,
                "filename": "CHANGES",
                "patch": "@@ -74,6 +74,8 @@ Release 0.9.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-881: JOIN with union query occurs NPE. (Hyoungjun Kim via hyunsik)\n+\n     TAJO-884: complex join conditions should be supported in ON clause.\n     (hyunsik)\n ",
                "raw_url": "https://github.com/apache/tajo/raw/6cfd448f7fb60a254a237230f071456f188f9179/CHANGES",
                "sha": "6389bf9dceb1b7cf86a1af7f7b302a53f5b37d23",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/main/java/org/apache/tajo/engine/planner/enforce/Enforcer.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/planner/enforce/Enforcer.java?ref=6cfd448f7fb60a254a237230f071456f188f9179",
                "deletions": 0,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/planner/enforce/Enforcer.java",
                "patch": "@@ -311,6 +311,8 @@ public static String toString(EnforceProperty property) {\n       }\n       break;\n     case SORTED_INPUT:\n+      SortedInputEnforce sortedInput = property.getSortedInput();\n+      sb.append(\"sorted input=\" + sortedInput.getTableName());\n     }\n \n     return sb.toString();",
                "raw_url": "https://github.com/apache/tajo/raw/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/main/java/org/apache/tajo/engine/planner/enforce/Enforcer.java",
                "sha": "031569eae3f347165c8cf460784161a5fa576f6a",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tajo/blob/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/main/java/org/apache/tajo/engine/planner/global/ExecutionBlock.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/planner/global/ExecutionBlock.java?ref=6cfd448f7fb60a254a237230f071456f188f9179",
                "deletions": 0,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/planner/global/ExecutionBlock.java",
                "patch": "@@ -34,6 +34,9 @@\n   private List<ScanNode> scanlist = new ArrayList<ScanNode>();\n   private Enforcer enforcer = new Enforcer();\n \n+  // Actual ScanNode's ExecutionBlockId -> Delegated ScanNode's ExecutionBlockId.\n+  private Map<ExecutionBlockId, ExecutionBlockId> unionScanMap = new HashMap<ExecutionBlockId, ExecutionBlockId>();\n+\n   private boolean hasJoinPlan;\n   private boolean hasUnionPlan;\n \n@@ -83,6 +86,13 @@ public void setPlan(LogicalNode plan) {\n     }\n   }\n \n+  public void addUnionScan(ExecutionBlockId realScanEbId, ExecutionBlockId delegatedScanEbId) {\n+    unionScanMap.put(realScanEbId, delegatedScanEbId);\n+  }\n+\n+  public Map<ExecutionBlockId, ExecutionBlockId> getUnionScanMap() {\n+    return unionScanMap;\n+  }\n \n   public LogicalNode getPlan() {\n     return plan;",
                "raw_url": "https://github.com/apache/tajo/raw/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/main/java/org/apache/tajo/engine/planner/global/ExecutionBlock.java",
                "sha": "1d14996af817d4669e646d7b7255471c266d6a55",
                "status": "modified"
            },
            {
                "additions": 144,
                "blob_url": "https://github.com/apache/tajo/blob/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/main/java/org/apache/tajo/engine/planner/global/GlobalPlanner.java",
                "changes": 157,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/planner/global/GlobalPlanner.java?ref=6cfd448f7fb60a254a237230f071456f188f9179",
                "deletions": 13,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/planner/global/GlobalPlanner.java",
                "patch": "@@ -25,6 +25,7 @@\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.hadoop.fs.Path;\n+import org.apache.tajo.ExecutionBlockId;\n import org.apache.tajo.algebra.JoinType;\n import org.apache.tajo.catalog.*;\n import org.apache.tajo.catalog.partition.PartitionMethodDesc;\n@@ -230,7 +231,7 @@ private ExecutionBlock buildJoinPlan(GlobalPlanContext context, JoinNode joinNod\n                                         ExecutionBlock leftBlock, ExecutionBlock rightBlock)\n       throws PlanningException {\n     MasterPlan masterPlan = context.plan;\n-    ExecutionBlock currentBlock = null;\n+    ExecutionBlock currentBlock;\n \n     boolean autoBroadcast = conf.getBoolVar(TajoConf.ConfVars.DIST_QUERY_BROADCAST_JOIN_AUTO);\n \n@@ -310,22 +311,143 @@ private ExecutionBlock buildJoinPlan(GlobalPlanContext context, JoinNode joinNod\n     }\n \n     // symmetric repartition join\n-    currentBlock = masterPlan.newExecutionBlock();\n+    boolean leftUnion = leftNode.getType() == NodeType.TABLE_SUBQUERY &&\n+        ((TableSubQueryNode)leftNode).getSubQuery().getType() == NodeType.UNION;\n+    boolean rightUnion = rightNode.getType() == NodeType.TABLE_SUBQUERY &&\n+        ((TableSubQueryNode)rightNode).getSubQuery().getType() == NodeType.UNION;\n+\n+    if (leftUnion || rightUnion) { // if one of child execution block is union\n+      /*\n+       Join with tableC and result of union tableA, tableB is expected the following physical plan.\n+       But Union execution block is not necessary.\n+       |-eb_0001_000006 (Terminal)\n+          |-eb_0001_000005 (Join eb_0001_000003, eb_0001_000004)\n+             |-eb_0001_000004 (Scan TableC)\n+             |-eb_0001_000003 (Union TableA, TableB)\n+               |-eb_0001_000002 (Scan TableB)\n+               |-eb_0001_000001 (Scan TableA)\n+\n+       The above plan can be changed to the following plan.\n+       |-eb_0001_000005 (Terminal)\n+          |-eb_0001_000003    (Join [eb_0001_000001, eb_0001_000002], eb_0001_000004)\n+             |-eb_0001_000004 (Scan TableC)\n+             |-eb_0001_000002 (Scan TableB)\n+             |-eb_0001_000001 (Scan TableA)\n+\n+       eb_0001_000003's left child should be eb_0001_000001 + eb_0001_000001 and right child should be eb_0001_000004.\n+       For this eb_0001_000001 is representative of eb_0001_000001, eb_0001_000002.\n+       So eb_0001_000003's left child is eb_0001_000001\n+       */\n+      Column[][] joinColumns = null;\n+      if (joinNode.getJoinType() != JoinType.CROSS) {\n+        // ShuffleKeys need to not have thea-join condition because Tajo supports only equi-join.\n+        joinColumns = PlannerUtil.joinJoinKeyForEachTable(joinNode.getJoinQual(),\n+            leftNode.getOutSchema(), rightNode.getOutSchema(), false);\n+      }\n \n-    DataChannel leftChannel = createDataChannelFromJoin(leftBlock, rightBlock, currentBlock, joinNode, true);\n-    DataChannel rightChannel = createDataChannelFromJoin(leftBlock, rightBlock, currentBlock, joinNode, false);\n+      if (leftUnion && !rightUnion) { // if only left is union\n+        currentBlock = leftBlock;\n+        context.execBlockMap.remove(leftNode.getPID());\n+        Column[] shuffleKeys = (joinColumns != null) ? joinColumns[0] : null;\n+        Column[] otherSideShuffleKeys = (joinColumns != null) ? joinColumns[1] : null;\n+        buildJoinPlanWithUnionChannel(context, joinNode, currentBlock, leftBlock, rightBlock, leftNode,\n+            shuffleKeys, otherSideShuffleKeys, true);\n+        currentBlock.setPlan(joinNode);\n+      } else if (!leftUnion && rightUnion) { // if only right is union\n+        currentBlock = rightBlock;\n+        context.execBlockMap.remove(rightNode.getPID());\n+        Column[] shuffleKeys = (joinColumns != null) ? joinColumns[1] : null;\n+        Column[] otherSideShuffleKeys = (joinColumns != null) ? joinColumns[0] : null;\n+        buildJoinPlanWithUnionChannel(context, joinNode, currentBlock, rightBlock, leftBlock, rightNode,\n+            shuffleKeys, otherSideShuffleKeys, false);\n+        currentBlock.setPlan(joinNode);\n+      } else { // if both are unions\n+        currentBlock = leftBlock;\n+        context.execBlockMap.remove(leftNode.getPID());\n+        context.execBlockMap.remove(rightNode.getPID());\n+        buildJoinPlanWithUnionChannel(context, joinNode, currentBlock, leftBlock, null, leftNode,\n+            (joinColumns != null ? joinColumns[0] : null), null, true);\n+        buildJoinPlanWithUnionChannel(context, joinNode, currentBlock, rightBlock, null, rightNode,\n+            (joinColumns != null ? joinColumns[1] : null), null, false);\n+        currentBlock.setPlan(joinNode);\n+      }\n \n-    ScanNode leftScan = buildInputExecutor(masterPlan.getLogicalPlan(), leftChannel);\n-    ScanNode rightScan = buildInputExecutor(masterPlan.getLogicalPlan(), rightChannel);\n+      return currentBlock;\n+    } else {\n+      // !leftUnion && !rightUnion\n+      currentBlock = masterPlan.newExecutionBlock();\n+      DataChannel leftChannel = createDataChannelFromJoin(leftBlock, rightBlock, currentBlock, joinNode, true);\n+      DataChannel rightChannel = createDataChannelFromJoin(leftBlock, rightBlock, currentBlock, joinNode, false);\n \n-    joinNode.setLeftChild(leftScan);\n-    joinNode.setRightChild(rightScan);\n-    currentBlock.setPlan(joinNode);\n+      ScanNode leftScan = buildInputExecutor(masterPlan.getLogicalPlan(), leftChannel);\n+      ScanNode rightScan = buildInputExecutor(masterPlan.getLogicalPlan(), rightChannel);\n \n-    masterPlan.addConnect(leftChannel);\n-    masterPlan.addConnect(rightChannel);\n+      joinNode.setLeftChild(leftScan);\n+      joinNode.setRightChild(rightScan);\n+      currentBlock.setPlan(joinNode);\n \n-    return currentBlock;\n+      masterPlan.addConnect(leftChannel);\n+      masterPlan.addConnect(rightChannel);\n+\n+      return currentBlock;\n+    }\n+  }\n+\n+  private void buildJoinPlanWithUnionChannel(GlobalPlanContext context, JoinNode joinNode,\n+                                             ExecutionBlock targetBlock,\n+                                             ExecutionBlock sourceBlock,\n+                                             ExecutionBlock otherSideBlock,\n+                                             LogicalNode childNode,\n+                                             Column[] shuffleKeys,\n+                                             Column[] otherSideShuffleKeys,\n+                                             boolean left) {\n+    MasterPlan masterPlan = context.getPlan();\n+    String subQueryRelationName = ((TableSubQueryNode)childNode).getCanonicalName();\n+    ExecutionBlockId dedicatedScanNodeBlock = null;\n+    for (DataChannel channel : masterPlan.getIncomingChannels(sourceBlock.getId())) {\n+      // If all union and right, add channel to left\n+      if (otherSideBlock == null && !left) {\n+        DataChannel oldChannel = channel;\n+        masterPlan.disconnect(oldChannel.getSrcId(), oldChannel.getTargetId());\n+        channel = new DataChannel(oldChannel.getSrcId(), targetBlock.getId());\n+      }\n+      channel.setSchema(childNode.getOutSchema());\n+      channel.setShuffleType(HASH_SHUFFLE);\n+      channel.setShuffleOutputNum(32);\n+      if (shuffleKeys != null) {\n+        channel.setShuffleKeys(shuffleKeys);\n+      }\n+\n+      ScanNode scanNode = buildInputExecutor(masterPlan.getLogicalPlan(), channel);\n+      scanNode.getOutSchema().setQualifier(subQueryRelationName);\n+      if (dedicatedScanNodeBlock == null) {\n+        dedicatedScanNodeBlock = channel.getSrcId();\n+        if (left) {\n+          joinNode.setLeftChild(scanNode);\n+        } else {\n+          joinNode.setRightChild(scanNode);\n+        }\n+      }\n+      masterPlan.addConnect(channel);\n+      targetBlock.addUnionScan(channel.getSrcId(), dedicatedScanNodeBlock);\n+    }\n+\n+    // create other side channel\n+    if (otherSideBlock != null) {\n+      DataChannel otherSideChannel = new DataChannel(otherSideBlock, targetBlock, HASH_SHUFFLE, 32);\n+      otherSideChannel.setStoreType(storeType);\n+      if (otherSideShuffleKeys != null) {\n+        otherSideChannel.setShuffleKeys(otherSideShuffleKeys);\n+      }\n+      masterPlan.addConnect(otherSideChannel);\n+\n+      ScanNode scan = buildInputExecutor(masterPlan.getLogicalPlan(), otherSideChannel);\n+      if (left) {\n+        joinNode.setRightChild(scan);\n+      } else {\n+        joinNode.setLeftChild(scan);\n+      }\n+    }\n   }\n \n   private AggregationFunctionCallEval createSumFunction(EvalNode [] args) throws InternalException {\n@@ -1211,7 +1333,6 @@ public LogicalNode visitTableSubQuery(GlobalPlanContext context, LogicalPlan pla\n             }\n           }\n         }\n-\n         if (leftMostSubQueryNode != null) {\n           // replace target column name\n           Target[] targets = leftMostSubQueryNode.getTargets();\n@@ -1221,6 +1342,16 @@ public LogicalNode visitTableSubQuery(GlobalPlanContext context, LogicalPlan pla\n               throw new PlanningException(\"Target of a UnionNode's subquery should be FieldEval.\");\n             }\n             int index = leftMostSubQueryNode.getInSchema().getColumnId(targets[i].getNamedColumn().getQualifiedName());\n+            if (index < 0) {\n+              // If a target has alias, getNamedColumn() only returns alias\n+              Set<Column> columns = EvalTreeUtil.findUniqueColumns(targets[i].getEvalTree());\n+              Column column = columns.iterator().next();\n+              index = leftMostSubQueryNode.getInSchema().getColumnId(column.getQualifiedName());\n+            }\n+            if (index < 0) {\n+              throw new PlanningException(\"Can't find matched Target in UnionNode's input schema: \" + targets[i]\n+                  + \"->\" + leftMostSubQueryNode.getInSchema());\n+            }\n             targetMappings[i] = index;\n           }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/main/java/org/apache/tajo/engine/planner/global/GlobalPlanner.java",
                "sha": "f12b7e2580b8505044913c687fe231725f8eed35",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/main/java/org/apache/tajo/engine/planner/global/MasterPlan.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/planner/global/MasterPlan.java?ref=6cfd448f7fb60a254a237230f071456f188f9179",
                "deletions": 1,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/planner/global/MasterPlan.java",
                "patch": "@@ -238,7 +238,11 @@ public String toString() {\n       if (!isLeaf(block)) {\n         sb.append(\"\\n[Incoming]\\n\");\n         for (DataChannel channel : getIncomingChannels(block.getId())) {\n-          sb.append(channel).append(\"\\n\");\n+          sb.append(channel);\n+          if (block.getUnionScanMap().containsKey(channel.getSrcId())) {\n+            sb.append(\", union delegated scan: \").append(block.getUnionScanMap().get(channel.getSrcId()));\n+          }\n+          sb.append(\"\\n\");\n         }\n       }\n \n@@ -250,6 +254,7 @@ public String toString() {\n         }\n       }\n \n+\n       if (block.getEnforcer().getProperties().size() > 0) {\n         sb.append(\"\\n[Enforcers]\\n\");\n         int i = 0;",
                "raw_url": "https://github.com/apache/tajo/raw/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/main/java/org/apache/tajo/engine/planner/global/MasterPlan.java",
                "sha": "a8593e58d6a22c3836d41d02eb53104efed545e2",
                "status": "modified"
            },
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/tajo/blob/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/main/java/org/apache/tajo/engine/planner/rewrite/ProjectionPushDownRule.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/planner/rewrite/ProjectionPushDownRule.java?ref=6cfd448f7fb60a254a237230f071456f188f9179",
                "deletions": 3,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/planner/rewrite/ProjectionPushDownRule.java",
                "patch": "@@ -27,6 +27,7 @@\n import org.apache.tajo.catalog.SortSpec;\n import org.apache.tajo.engine.eval.*;\n import org.apache.tajo.engine.planner.*;\n+import org.apache.tajo.engine.planner.LogicalPlan.QueryBlock;\n import org.apache.tajo.engine.planner.logical.*;\n import org.apache.tajo.engine.utils.SchemaUtil;\n import org.apache.tajo.util.TUtil;\n@@ -54,11 +55,15 @@ public String getName() {\n   public boolean isEligible(LogicalPlan plan) {\n     LogicalNode toBeOptimized = plan.getRootBlock().getRoot();\n \n-    if (PlannerUtil.checkIfDDLPlan(toBeOptimized) || !plan.getRootBlock().hasTableExpression()) {\n+    if (PlannerUtil.checkIfDDLPlan(toBeOptimized)) {\n       return false;\n     }\n-\n-    return true;\n+    for (QueryBlock eachBlock: plan.getQueryBlocks()) {\n+      if (eachBlock.hasTableExpression()) {\n+        return true;\n+      }\n+    }\n+    return false;\n   }\n \n   @Override",
                "raw_url": "https://github.com/apache/tajo/raw/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/main/java/org/apache/tajo/engine/planner/rewrite/ProjectionPushDownRule.java",
                "sha": "8d80d390d213e056aacb54df6ca8fa70f617cfd4",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/main/java/org/apache/tajo/master/DefaultTaskScheduler.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/master/DefaultTaskScheduler.java?ref=6cfd448f7fb60a254a237230f071456f188f9179",
                "deletions": 4,
                "filename": "tajo-core/src/main/java/org/apache/tajo/master/DefaultTaskScheduler.java",
                "patch": "@@ -30,7 +30,6 @@\n import org.apache.tajo.QueryUnitAttemptId;\n import org.apache.tajo.engine.planner.global.ExecutionBlock;\n import org.apache.tajo.engine.planner.global.MasterPlan;\n-import org.apache.tajo.engine.planner.logical.ScanNode;\n import org.apache.tajo.engine.query.QueryUnitRequest;\n import org.apache.tajo.engine.query.QueryUnitRequestImpl;\n import org.apache.tajo.ipc.TajoWorkerProtocol;\n@@ -872,11 +871,11 @@ public void assignToNonLeafTasks(LinkedList<TaskRequestEvent> taskRequests) {\n           if (checkIfInterQuery(subQuery.getMasterPlan(), subQuery.getBlock())) {\n             taskAssign.setInterQuery();\n           }\n-          for (ScanNode scan : task.getScanNodes()) {\n-            Collection<FetchImpl> fetches = task.getFetch(scan);\n+          for(Map.Entry<String, Set<FetchImpl>> entry: task.getFetchMap().entrySet()) {\n+            Collection<FetchImpl> fetches = entry.getValue();\n             if (fetches != null) {\n               for (FetchImpl fetch : fetches) {\n-                taskAssign.addFetch(scan.getTableName(), fetch);\n+                taskAssign.addFetch(entry.getKey(), fetch);\n               }\n             }\n           }",
                "raw_url": "https://github.com/apache/tajo/raw/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/main/java/org/apache/tajo/master/DefaultTaskScheduler.java",
                "sha": "21df4e9d1aad78a43ab54b430483ef7511d826df",
                "status": "modified"
            },
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/tajo/blob/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/main/java/org/apache/tajo/master/querymaster/QueryUnit.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/master/querymaster/QueryUnit.java?ref=6cfd448f7fb60a254a237230f071456f188f9179",
                "deletions": 1,
                "filename": "tajo-core/src/main/java/org/apache/tajo/master/querymaster/QueryUnit.java",
                "patch": "@@ -28,6 +28,7 @@\n import org.apache.hadoop.conf.Configuration;\n import org.apache.hadoop.yarn.event.EventHandler;\n import org.apache.hadoop.yarn.state.*;\n+import org.apache.tajo.ExecutionBlockId;\n import org.apache.tajo.QueryIdFactory;\n import org.apache.tajo.QueryUnitAttemptId;\n import org.apache.tajo.QueryUnitId;\n@@ -661,6 +662,7 @@ public boolean equals(Object obj) {\n   }\n \n   public static class IntermediateEntry {\n+    ExecutionBlockId ebId;\n     int taskId;\n     int attemptId;\n     int partId;\n@@ -673,6 +675,14 @@ public IntermediateEntry(int taskId, int attemptId, int partId, PullHost host) {\n       this.host = host;\n     }\n \n+    public ExecutionBlockId getEbId() {\n+      return ebId;\n+    }\n+\n+    public void setEbId(ExecutionBlockId ebId) {\n+      this.ebId = ebId;\n+    }\n+\n     public int getTaskId() {\n       return this.taskId;\n     }\n@@ -691,7 +701,7 @@ public PullHost getPullHost() {\n \n     @Override\n     public int hashCode() {\n-      return Objects.hashCode(taskId, partId, attemptId, host);\n+      return Objects.hashCode(ebId, taskId, partId, attemptId, host);\n     }\n   }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/main/java/org/apache/tajo/master/querymaster/QueryUnit.java",
                "sha": "6cada0774a2407848c602e477a7b9c2b1f49fbde",
                "status": "modified"
            },
            {
                "additions": 51,
                "blob_url": "https://github.com/apache/tajo/blob/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/main/java/org/apache/tajo/master/querymaster/Repartitioner.java",
                "changes": 91,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/master/querymaster/Repartitioner.java?ref=6cfd448f7fb60a254a237230f071456f188f9179",
                "deletions": 40,
                "filename": "tajo-core/src/main/java/org/apache/tajo/master/querymaster/Repartitioner.java",
                "patch": "@@ -87,13 +87,9 @@ public static void scheduleFragmentsForJoinQuery(TaskSchedulerContext schedulerC\n     for (int i = 0; i < scans.length; i++) {\n       TableDesc tableDesc = masterContext.getTableDescMap().get(scans[i].getCanonicalName());\n       if (tableDesc == null) { // if it is a real table stored on storage\n-        // TODO - to be fixed (wrong directory)\n-        ExecutionBlock [] childBlocks = new ExecutionBlock[2];\n-        childBlocks[0] = masterPlan.getChild(execBlock.getId(), 0);\n-        childBlocks[1] = masterPlan.getChild(execBlock.getId(), 1);\n-\n         tablePath = storageManager.getTablePath(scans[i].getTableName());\n-        stats[i] = masterContext.getSubQuery(childBlocks[i].getId()).getResultStats().getNumBytes();\n+        ExecutionBlockId scanEBId = TajoIdUtils.createExecutionBlockId(scans[i].getTableName());\n+        stats[i] = masterContext.getSubQuery(scanEBId).getResultStats().getNumBytes();\n         fragments[i] = new FileFragment(scans[i].getCanonicalName(), tablePath, 0, 0, new String[]{UNKNOWN_HOST});\n       } else {\n         tablePath = tableDesc.getPath();\n@@ -161,44 +157,54 @@ public static void scheduleFragmentsForJoinQuery(TaskSchedulerContext schedulerC\n     } else {\n       LOG.info(\"[Distributed Join Strategy] : Symmetric Repartition Join\");\n       // The hash map is modeling as follows:\n-      // <Part Id, <Table Name, Intermediate Data>>\n-      Map<Integer, Map<String, List<IntermediateEntry>>> hashEntries = new HashMap<Integer, Map<String, List<IntermediateEntry>>>();\n+      // <Part Id, <EbId, Intermediate Data>>\n+      Map<Integer, Map<ExecutionBlockId, List<IntermediateEntry>>> hashEntries =\n+          new HashMap<Integer, Map<ExecutionBlockId, List<IntermediateEntry>>>();\n \n       // Grouping IntermediateData by a partition key and a table name\n-      for (ScanNode scan : scans) {\n-        SubQuery childSubQuery = masterContext.getSubQuery(TajoIdUtils.createExecutionBlockId(scan.getCanonicalName()));\n-        for (QueryUnit task : childSubQuery.getQueryUnits()) {\n+      List<ExecutionBlock> childBlocks = masterPlan.getChilds(subQuery.getId());\n+\n+      // In the case of join with union, there is one ScanNode for union.\n+      Map<ExecutionBlockId, ExecutionBlockId> unionScanMap = execBlock.getUnionScanMap();\n+      for (ExecutionBlock childBlock : childBlocks) {\n+        ExecutionBlockId scanEbId = unionScanMap.get(childBlock.getId());\n+        if (scanEbId == null) {\n+          scanEbId = childBlock.getId();\n+        }\n+        SubQuery childExecSM = subQuery.getContext().getSubQuery(childBlock.getId());\n+        for (QueryUnit task : childExecSM.getQueryUnits()) {\n           if (task.getIntermediateData() != null && !task.getIntermediateData().isEmpty()) {\n             for (IntermediateEntry intermEntry : task.getIntermediateData()) {\n+              intermEntry.setEbId(childBlock.getId());\n               if (hashEntries.containsKey(intermEntry.getPartId())) {\n-                Map<String, List<IntermediateEntry>> tbNameToInterm =\n+                Map<ExecutionBlockId, List<IntermediateEntry>> tbNameToInterm =\n                     hashEntries.get(intermEntry.getPartId());\n \n-                if (tbNameToInterm.containsKey(scan.getCanonicalName())) {\n-                  tbNameToInterm.get(scan.getCanonicalName()).add(intermEntry);\n+                if (tbNameToInterm.containsKey(scanEbId)) {\n+                  tbNameToInterm.get(scanEbId).add(intermEntry);\n                 } else {\n-                  tbNameToInterm.put(scan.getCanonicalName(), TUtil.newList(intermEntry));\n+                  tbNameToInterm.put(scanEbId, TUtil.newList(intermEntry));\n                 }\n               } else {\n-                Map<String, List<IntermediateEntry>> tbNameToInterm =\n-                    new HashMap<String, List<IntermediateEntry>>();\n-                tbNameToInterm.put(scan.getCanonicalName(), TUtil.newList(intermEntry));\n+                Map<ExecutionBlockId, List<IntermediateEntry>> tbNameToInterm =\n+                    new HashMap<ExecutionBlockId, List<IntermediateEntry>>();\n+                tbNameToInterm.put(scanEbId, TUtil.newList(intermEntry));\n                 hashEntries.put(intermEntry.getPartId(), tbNameToInterm);\n               }\n             }\n           } else {\n             //if no intermidatedata(empty table), make empty entry\n             int emptyPartitionId = 0;\n             if (hashEntries.containsKey(emptyPartitionId)) {\n-              Map<String, List<IntermediateEntry>> tbNameToInterm = hashEntries.get(emptyPartitionId);\n-              if (tbNameToInterm.containsKey(scan.getCanonicalName()))\n-                tbNameToInterm.get(scan.getCanonicalName())\n-                    .addAll(new ArrayList<IntermediateEntry>());\n+              Map<ExecutionBlockId, List<IntermediateEntry>> tbNameToInterm = hashEntries.get(emptyPartitionId);\n+              if (tbNameToInterm.containsKey(scanEbId))\n+                tbNameToInterm.get(scanEbId).addAll(new ArrayList<IntermediateEntry>());\n               else\n-                tbNameToInterm.put(scan.getCanonicalName(), new ArrayList<IntermediateEntry>());\n+                tbNameToInterm.put(scanEbId, new ArrayList<IntermediateEntry>());\n             } else {\n-              Map<String, List<IntermediateEntry>> tbNameToInterm = new HashMap<String, List<IntermediateEntry>>();\n-              tbNameToInterm.put(scan.getCanonicalName(), new ArrayList<IntermediateEntry>());\n+              Map<ExecutionBlockId, List<IntermediateEntry>> tbNameToInterm =\n+                  new HashMap<ExecutionBlockId, List<IntermediateEntry>>();\n+              tbNameToInterm.put(scanEbId, new ArrayList<IntermediateEntry>());\n               hashEntries.put(emptyPartitionId, tbNameToInterm);\n             }\n           }\n@@ -234,7 +240,7 @@ public static void scheduleFragmentsForJoinQuery(TaskSchedulerContext schedulerC\n       SubQuery.scheduleFragment(subQuery, fragments[0], Arrays.asList(new FileFragment[]{fragments[1]}));\n \n       // Assign partitions to tasks in a round robin manner.\n-      for (Entry<Integer, Map<String, List<IntermediateEntry>>> entry\n+      for (Entry<Integer, Map<ExecutionBlockId, List<IntermediateEntry>>> entry\n           : hashEntries.entrySet()) {\n         addJoinShuffle(subQuery, entry.getKey(), entry.getValue());\n       }\n@@ -321,17 +327,19 @@ private static void scheduleLeafTasksWithBroadcastTable(TaskSchedulerContext sch\n   }\n \n   private static void addJoinShuffle(SubQuery subQuery, int partitionId,\n-                                     Map<String, List<IntermediateEntry>> grouppedPartitions) {\n+                                     Map<ExecutionBlockId, List<IntermediateEntry>> grouppedPartitions) {\n     Map<String, List<FetchImpl>> fetches = new HashMap<String, List<FetchImpl>>();\n     for (ExecutionBlock execBlock : subQuery.getMasterPlan().getChilds(subQuery.getId())) {\n-      Collection<FetchImpl> requests;\n-      if (grouppedPartitions.containsKey(execBlock.getId().toString())) {\n-          requests = mergeShuffleRequest(execBlock.getId(), partitionId, HASH_SHUFFLE,\n-              grouppedPartitions.get(execBlock.getId().toString()));\n-      } else {\n-        return;\n+      if (grouppedPartitions.containsKey(execBlock.getId())) {\n+        Collection<FetchImpl> requests = mergeShuffleRequest(partitionId, HASH_SHUFFLE,\n+            grouppedPartitions.get(execBlock.getId()));\n+        fetches.put(execBlock.getId().toString(), Lists.newArrayList(requests));\n       }\n-      fetches.put(execBlock.getId().toString(), Lists.newArrayList(requests));\n+    }\n+\n+    if (fetches.isEmpty()) {\n+      LOG.info(subQuery.getId() + \"'s \" + partitionId + \" partition has empty result.\");\n+      return;\n     }\n     SubQuery.scheduleFetches(subQuery, fetches);\n   }\n@@ -342,20 +350,23 @@ private static void addJoinShuffle(SubQuery subQuery, int partitionId,\n    *\n    * @return key: pullserver's address, value: a list of requests\n    */\n-  private static Collection<FetchImpl> mergeShuffleRequest(ExecutionBlockId ebid, int partitionId,\n+  private static Collection<FetchImpl> mergeShuffleRequest(int partitionId,\n                                                           TajoWorkerProtocol.ShuffleType type,\n                                                           List<IntermediateEntry> partitions) {\n-    Map<QueryUnit.PullHost, FetchImpl> mergedPartitions = new HashMap<QueryUnit.PullHost, FetchImpl>();\n+    // ebId + pullhost -> FetchImmpl\n+    Map<String, FetchImpl> mergedPartitions = new HashMap<String, FetchImpl>();\n \n     for (IntermediateEntry partition : partitions) {\n-      QueryUnit.PullHost host = partition.getPullHost();\n-      if (mergedPartitions.containsKey(host)) {\n+      String mergedKey = partition.getEbId().toString() + \",\" + partition.getPullHost();\n+\n+      if (mergedPartitions.containsKey(mergedKey)) {\n         FetchImpl fetch = mergedPartitions.get(partition.getPullHost());\n         fetch.addPart(partition.getTaskId(), partition.getAttemptId());\n       } else {\n-        FetchImpl fetch = new FetchImpl(host, type, ebid, partitionId);\n+        // In some cases like union each IntermediateEntry has different EBID.\n+        FetchImpl fetch = new FetchImpl(partition.getPullHost(), type, partition.getEbId(), partitionId);\n         fetch.addPart(partition.getTaskId(), partition.getAttemptId());\n-        mergedPartitions.put(partition.getPullHost(), fetch);\n+        mergedPartitions.put(mergedKey, fetch);\n       }\n     }\n     return mergedPartitions.values();",
                "raw_url": "https://github.com/apache/tajo/raw/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/main/java/org/apache/tajo/master/querymaster/Repartitioner.java",
                "sha": "6373bb4f0e3001ab90d17467def75083422e8c52",
                "status": "modified"
            },
            {
                "additions": 220,
                "blob_url": "https://github.com/apache/tajo/blob/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/test/java/org/apache/tajo/engine/query/TestUnionQuery.java",
                "changes": 220,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/java/org/apache/tajo/engine/query/TestUnionQuery.java?ref=6cfd448f7fb60a254a237230f071456f188f9179",
                "deletions": 0,
                "filename": "tajo-core/src/test/java/org/apache/tajo/engine/query/TestUnionQuery.java",
                "patch": "@@ -26,6 +26,8 @@\n \n import java.sql.ResultSet;\n \n+import static org.junit.Assert.assertEquals;\n+\n /*\n  * Notations\n  * - S - select\n@@ -205,4 +207,222 @@ public final void testUnionWithDifferentAliasAndFunction() throws Exception {\n     assertResultSet(res);\n     cleanupQuery(res);\n   }\n+\n+  @Test\n+  public final void testLeftUnionWithJoin() throws Exception {\n+    // https://issues.apache.org/jira/browse/TAJO-881\n+    ResultSet res = executeString(\n+        \"select * from ( \" +\n+        \"  select a.id, b.c_name, a.code from ( \" +\n+        \"    select l_orderkey as id, 'lineitem' as code from lineitem \" +\n+        \"    union all \" +\n+        \"    select o_orderkey as id, 'order' as code from orders \" +\n+         \"  ) a \" +\n+         \"  join customer b on a.id = b.c_custkey\" +\n+        \") c order by id, code\"\n+    );\n+\n+    String expected =\n+        \"id,c_name,code\\n\" +\n+            \"-------------------------------\\n\" +\n+            \"1,Customer#000000001,lineitem\\n\" +\n+            \"1,Customer#000000001,lineitem\\n\" +\n+            \"1,Customer#000000001,order\\n\" +\n+            \"2,Customer#000000002,lineitem\\n\" +\n+            \"2,Customer#000000002,order\\n\" +\n+            \"3,Customer#000000003,lineitem\\n\" +\n+            \"3,Customer#000000003,lineitem\\n\" +\n+            \"3,Customer#000000003,order\\n\";\n+\n+    assertEquals(expected, resultSetToString(res));\n+\n+    cleanupQuery(res);\n+  }\n+\n+  @Test\n+  public final void testRightUnionWithJoin() throws Exception {\n+    // https://issues.apache.org/jira/browse/TAJO-881\n+    ResultSet res = executeString(\n+            \"select * from ( \" +\n+            \"  select a.id, b.c_name, a.code from customer b \" +\n+            \"  join ( \" +\n+            \"    select l_orderkey as id, 'lineitem' as code from lineitem \" +\n+            \"    union all \" +\n+            \"    select o_orderkey as id, 'order' as code from orders \" +\n+            \"  ) a on a.id = b.c_custkey\" +\n+            \") c order by id, code\"\n+    );\n+\n+    String expected =\n+        \"id,c_name,code\\n\" +\n+            \"-------------------------------\\n\" +\n+            \"1,Customer#000000001,lineitem\\n\" +\n+            \"1,Customer#000000001,lineitem\\n\" +\n+            \"1,Customer#000000001,order\\n\" +\n+            \"2,Customer#000000002,lineitem\\n\" +\n+            \"2,Customer#000000002,order\\n\" +\n+            \"3,Customer#000000003,lineitem\\n\" +\n+            \"3,Customer#000000003,lineitem\\n\" +\n+            \"3,Customer#000000003,order\\n\";\n+\n+    assertEquals(expected, resultSetToString(res));\n+\n+    cleanupQuery(res);\n+  }\n+\n+  @Test\n+  public final void testAllUnionWithJoin() throws Exception {\n+    // https://issues.apache.org/jira/browse/TAJO-881\n+    ResultSet res = executeString(\n+        \"select * from ( \" +\n+        \"  select a.id, a.code as code, b.name, b.code as code2 from ( \" +\n+        \"    select l_orderkey as id, 'lineitem' as code from lineitem \" +\n+        \"    union all \" +\n+        \"    select o_orderkey as id, 'order' as code from orders \" +\n+        \"  ) a \" +\n+        \"  join ( \" +\n+        \"    select c_custkey as id, c_name as name, 'customer' as code from customer \" +\n+        \"    union all \" +\n+        \"    select p_partkey as id, p_name as name, 'part' as code from part \" +\n+        \"  ) b on a.id = b.id\" +\n+        \") c order by id, code, code2\"\n+    );\n+\n+    String expected =\n+        \"id,code,name,code2\\n\" +\n+            \"-------------------------------\\n\" +\n+            \"1,lineitem,Customer#000000001,customer\\n\" +\n+            \"1,lineitem,Customer#000000001,customer\\n\" +\n+            \"1,lineitem,goldenrod lavender spring chocolate lace,part\\n\" +\n+            \"1,lineitem,goldenrod lavender spring chocolate lace,part\\n\" +\n+            \"1,order,Customer#000000001,customer\\n\" +\n+            \"1,order,goldenrod lavender spring chocolate lace,part\\n\" +\n+            \"2,lineitem,Customer#000000002,customer\\n\" +\n+            \"2,lineitem,blush thistle blue yellow saddle,part\\n\" +\n+            \"2,order,Customer#000000002,customer\\n\" +\n+            \"2,order,blush thistle blue yellow saddle,part\\n\" +\n+            \"3,lineitem,Customer#000000003,customer\\n\" +\n+            \"3,lineitem,Customer#000000003,customer\\n\" +\n+            \"3,lineitem,spring green yellow purple cornsilk,part\\n\" +\n+            \"3,lineitem,spring green yellow purple cornsilk,part\\n\" +\n+            \"3,order,Customer#000000003,customer\\n\" +\n+            \"3,order,spring green yellow purple cornsilk,part\\n\";\n+\n+    assertEquals(expected, resultSetToString(res));\n+\n+    cleanupQuery(res);\n+  }\n+\n+  @Test\n+  public final void testUnionWithCrossJoin() throws Exception {\n+    // https://issues.apache.org/jira/browse/TAJO-881\n+    ResultSet res = executeString(\n+        \"select * from ( \" +\n+        \"  select a.id, b.c_name, a.code from ( \" +\n+            \"    select l_orderkey as id, 'lineitem' as code from lineitem \" +\n+            \"    union all \" +\n+            \"    select o_orderkey as id, 'order' as code from orders \" +\n+            \"  ) a, \" +\n+            \"  customer b \" +\n+        \") c order by id, code, c_name\"\n+    );\n+\n+    String expected =\n+        \"id,c_name,code\\n\" +\n+            \"-------------------------------\\n\" +\n+            \"1,Customer#000000001,lineitem\\n\" +\n+            \"1,Customer#000000001,lineitem\\n\" +\n+            \"1,Customer#000000002,lineitem\\n\" +\n+            \"1,Customer#000000002,lineitem\\n\" +\n+            \"1,Customer#000000003,lineitem\\n\" +\n+            \"1,Customer#000000003,lineitem\\n\" +\n+            \"1,Customer#000000004,lineitem\\n\" +\n+            \"1,Customer#000000004,lineitem\\n\" +\n+            \"1,Customer#000000005,lineitem\\n\" +\n+            \"1,Customer#000000005,lineitem\\n\" +\n+            \"1,Customer#000000001,order\\n\" +\n+            \"1,Customer#000000002,order\\n\" +\n+            \"1,Customer#000000003,order\\n\" +\n+            \"1,Customer#000000004,order\\n\" +\n+            \"1,Customer#000000005,order\\n\" +\n+            \"2,Customer#000000001,lineitem\\n\" +\n+            \"2,Customer#000000002,lineitem\\n\" +\n+            \"2,Customer#000000003,lineitem\\n\" +\n+            \"2,Customer#000000004,lineitem\\n\" +\n+            \"2,Customer#000000005,lineitem\\n\" +\n+            \"2,Customer#000000001,order\\n\" +\n+            \"2,Customer#000000002,order\\n\" +\n+            \"2,Customer#000000003,order\\n\" +\n+            \"2,Customer#000000004,order\\n\" +\n+            \"2,Customer#000000005,order\\n\" +\n+            \"3,Customer#000000001,lineitem\\n\" +\n+            \"3,Customer#000000001,lineitem\\n\" +\n+            \"3,Customer#000000002,lineitem\\n\" +\n+            \"3,Customer#000000002,lineitem\\n\" +\n+            \"3,Customer#000000003,lineitem\\n\" +\n+            \"3,Customer#000000003,lineitem\\n\" +\n+            \"3,Customer#000000004,lineitem\\n\" +\n+            \"3,Customer#000000004,lineitem\\n\" +\n+            \"3,Customer#000000005,lineitem\\n\" +\n+            \"3,Customer#000000005,lineitem\\n\" +\n+            \"3,Customer#000000001,order\\n\" +\n+            \"3,Customer#000000002,order\\n\" +\n+            \"3,Customer#000000003,order\\n\" +\n+            \"3,Customer#000000004,order\\n\" +\n+            \"3,Customer#000000005,order\\n\";\n+\n+    assertEquals(expected, resultSetToString(res));\n+\n+    cleanupQuery(res);\n+  }\n+\n+  @Test\n+  public final void testThreeJoinInUnion() throws Exception {\n+    // https://issues.apache.org/jira/browse/TAJO-881\n+    ResultSet res = executeString(\n+      \"select orders.o_orderkey \\n\" +\n+          \"from orders\\n\" +\n+          \"join lineitem on orders.o_orderkey = lineitem.l_orderkey\\n\" +\n+          \"join customer on orders.o_custkey =  customer.c_custkey\\n\" +\n+          \"union all \\n\" +\n+          \"select nation.n_nationkey from nation\"\n+    );\n+    String expected =\n+        \"o_orderkey\\n\" +\n+            \"-------------------------------\\n\" +\n+            \"1\\n\" +\n+            \"1\\n\" +\n+            \"2\\n\" +\n+            \"3\\n\" +\n+            \"3\\n\" +\n+            \"0\\n\" +\n+            \"1\\n\" +\n+            \"2\\n\" +\n+            \"3\\n\" +\n+            \"4\\n\" +\n+            \"5\\n\" +\n+            \"6\\n\" +\n+            \"7\\n\" +\n+            \"8\\n\" +\n+            \"9\\n\" +\n+            \"10\\n\" +\n+            \"11\\n\" +\n+            \"12\\n\" +\n+            \"13\\n\" +\n+            \"14\\n\" +\n+            \"15\\n\" +\n+            \"16\\n\" +\n+            \"17\\n\" +\n+            \"18\\n\" +\n+            \"19\\n\" +\n+            \"20\\n\" +\n+            \"21\\n\" +\n+            \"22\\n\" +\n+            \"23\\n\" +\n+            \"24\\n\";\n+\n+    assertEquals(expected, resultSetToString(res));\n+\n+    cleanupQuery(res);\n+  }\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/6cfd448f7fb60a254a237230f071456f188f9179/tajo-core/src/test/java/org/apache/tajo/engine/query/TestUnionQuery.java",
                "sha": "1ec2c33b02b14f8b7159c1786ec61b397ffbe8c4",
                "status": "modified"
            }
        ],
        "message": "TAJO-881: JOIN with union query occurs NPE. (Hyoungjun Kim via hyunsik)\n\nCloses #48",
        "parent": "https://github.com/apache/tajo/commit/b3758361335a4cd26d8b7b9d18879b2b35f612fb",
        "patched_files": [
            "ExecutionBlock.java",
            "QueryUnit.java",
            "DefaultTaskScheduler.java",
            "MasterPlan.java",
            "GlobalPlanner.java",
            "ProjectionPushDownRule.java",
            "Enforcer.java",
            "CHANGES",
            "Repartitioner.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestGlobalPlanner.java",
            "TestRepartitioner.java",
            "TestMasterPlan.java",
            "TestUnionQuery.java"
        ]
    },
    "tajo_72ebc43": {
        "bug_id": "tajo_72ebc43",
        "commit": "https://github.com/apache/tajo/commit/72ebc43d6e685dad58b2bf238fae12e51c8dec96",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/72ebc43d6e685dad58b2bf238fae12e51c8dec96/CHANGES",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=72ebc43d6e685dad58b2bf238fae12e51c8dec96",
                "deletions": 0,
                "filename": "CHANGES",
                "patch": "@@ -90,6 +90,9 @@ Release 0.12.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-1921: Hbase Storage can cause NPE when the hbase cluster is restarted.\n+    (Byunghwa Yun via hyunsik)\n+\n     TAJO-2038: NPE in FileScanner#getProgress. (jinho)\n \n     TAJO-2034: Files required for executing python functions are not copied in ",
                "raw_url": "https://github.com/apache/tajo/raw/72ebc43d6e685dad58b2bf238fae12e51c8dec96/CHANGES",
                "sha": "f680eb010d26d454044415c1df87153c677abd1c",
                "status": "modified"
            },
            {
                "additions": 56,
                "blob_url": "https://github.com/apache/tajo/blob/72ebc43d6e685dad58b2bf238fae12e51c8dec96/tajo-core-tests/src/test/java/org/apache/tajo/engine/query/TestHBaseTable.java",
                "changes": 56,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core-tests/src/test/java/org/apache/tajo/engine/query/TestHBaseTable.java?ref=72ebc43d6e685dad58b2bf238fae12e51c8dec96",
                "deletions": 0,
                "filename": "tajo-core-tests/src/test/java/org/apache/tajo/engine/query/TestHBaseTable.java",
                "patch": "@@ -26,10 +26,13 @@\n import org.apache.hadoop.hbase.HColumnDescriptor;\n import org.apache.hadoop.hbase.HConstants;\n import org.apache.hadoop.hbase.HTableDescriptor;\n+import org.apache.hadoop.hbase.MiniHBaseCluster;\n import org.apache.hadoop.hbase.TableName;\n import org.apache.hadoop.hbase.client.*;\n import org.apache.hadoop.hbase.filter.Filter;\n import org.apache.hadoop.hbase.filter.InclusiveStopFilter;\n+import org.apache.hadoop.hbase.master.HMaster;\n+import org.apache.hadoop.hbase.regionserver.HRegionServer;\n import org.apache.tajo.IntegrationTest;\n import org.apache.tajo.QueryTestCaseBase;\n import org.apache.tajo.TajoTestingCluster;\n@@ -1376,6 +1379,59 @@ public void testInsertIntoLocation() throws Exception {\n     }\n   }\n \n+  @Test\n+  public void testGetSplitsWhenRestartHBase() throws Exception {\n+    executeString(\"CREATE TABLE hbase_mapped_table1 (rk text, col1 text, col2 text, col3 int) \"\n+      + \"TABLESPACE cluster1 USING hbase WITH ('table'='hbase_table1', 'columns'=':key,col1:a,col2:,col3:#b', \"\n+      + \"'hbase.split.rowkeys'='010,020,030,040,050,060,070,080,090')\").close();\n+\n+    assertTableExists(\"hbase_mapped_table1\");\n+    HBaseAdmin hAdmin = new HBaseAdmin(testingCluster.getHBaseUtil().getConf());\n+    HTable htable = null;\n+    try {\n+      hAdmin.tableExists(\"hbase_table1\");\n+      htable = new HTable(testingCluster.getHBaseUtil().getConf(), \"hbase_table1\");\n+      org.apache.hadoop.hbase.util.Pair<byte[][], byte[][]> keys = htable.getStartEndKeys();\n+      assertEquals(10, keys.getFirst().length);\n+\n+      DecimalFormat df = new DecimalFormat(\"000\");\n+      for (int i = 0; i < 100; i++) {\n+        Put put = new Put(String.valueOf(df.format(i)).getBytes());\n+        put.add(\"col1\".getBytes(), \"a\".getBytes(), (\"a-\" + i).getBytes());\n+        put.add(\"col1\".getBytes(), \"b\".getBytes(), (\"b-\" + i).getBytes());\n+        put.add(\"col2\".getBytes(), \"k1\".getBytes(), (\"k1-\" + i).getBytes());\n+        put.add(\"col2\".getBytes(), \"k2\".getBytes(), (\"k2-\" + i).getBytes());\n+        put.add(\"col3\".getBytes(), \"\".getBytes(), Bytes.toBytes(i));\n+        htable.put(put);\n+      }\n+\n+      ResultSet res = executeString(\"select * from hbase_mapped_table1\");\n+      assertResultSet(res);\n+      res.close();\n+\n+      MiniHBaseCluster cluster = testingCluster.getHBaseUtil().getMiniHBaseCluster();\n+      HMaster master = cluster.getMaster();\n+      master.balanceSwitch(true);\n+      assertEquals(1, cluster.getLiveRegionServerThreads().size());\n+      HRegionServer orgRegionServer = cluster.getLiveRegionServerThreads().get(0).getRegionServer();\n+      cluster.startRegionServer().waitForServerOnline();\n+      cluster.startRegionServer().waitForServerOnline();\n+      cluster.startRegionServer().waitForServerOnline();\n+      cluster.stopRegionServer(orgRegionServer.getServerName());\n+      cluster.waitForRegionServerToStop(orgRegionServer.getServerName(), 1000);\n+\n+      res = executeString(\"select * from hbase_mapped_table1\");\n+      assertResultSet(res);\n+      res.close();\n+    } finally {\n+      executeString(\"DROP TABLE hbase_mapped_table1 PURGE\").close();\n+      hAdmin.close();\n+      if (htable == null) {\n+        htable.close();\n+      }\n+    }\n+  }\n+\n   private String resultSetToString(ResultScanner scanner, byte[][] cfNames, byte[][] qualifiers,\n                                    boolean [] binaries, Schema schema) throws Exception {\n     StringBuilder sb = new StringBuilder();",
                "raw_url": "https://github.com/apache/tajo/raw/72ebc43d6e685dad58b2bf238fae12e51c8dec96/tajo-core-tests/src/test/java/org/apache/tajo/engine/query/TestHBaseTable.java",
                "sha": "97feb65f2f6de8159de86b29d545f91c1b547095",
                "status": "modified"
            },
            {
                "additions": 102,
                "blob_url": "https://github.com/apache/tajo/blob/72ebc43d6e685dad58b2bf238fae12e51c8dec96/tajo-core-tests/src/test/resources/results/TestHBaseTable/testGetSplitsWhenRestartHBase.result",
                "changes": 102,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core-tests/src/test/resources/results/TestHBaseTable/testGetSplitsWhenRestartHBase.result?ref=72ebc43d6e685dad58b2bf238fae12e51c8dec96",
                "deletions": 0,
                "filename": "tajo-core-tests/src/test/resources/results/TestHBaseTable/testGetSplitsWhenRestartHBase.result",
                "patch": "@@ -0,0 +1,102 @@\n+rk,col1,col2,col3\n+-------------------------------\n+000,a-0,{\"k1\":\"k1-0\", \"k2\":\"k2-0\"},0\n+001,a-1,{\"k1\":\"k1-1\", \"k2\":\"k2-1\"},1\n+002,a-2,{\"k1\":\"k1-2\", \"k2\":\"k2-2\"},2\n+003,a-3,{\"k1\":\"k1-3\", \"k2\":\"k2-3\"},3\n+004,a-4,{\"k1\":\"k1-4\", \"k2\":\"k2-4\"},4\n+005,a-5,{\"k1\":\"k1-5\", \"k2\":\"k2-5\"},5\n+006,a-6,{\"k1\":\"k1-6\", \"k2\":\"k2-6\"},6\n+007,a-7,{\"k1\":\"k1-7\", \"k2\":\"k2-7\"},7\n+008,a-8,{\"k1\":\"k1-8\", \"k2\":\"k2-8\"},8\n+009,a-9,{\"k1\":\"k1-9\", \"k2\":\"k2-9\"},9\n+010,a-10,{\"k1\":\"k1-10\", \"k2\":\"k2-10\"},10\n+011,a-11,{\"k1\":\"k1-11\", \"k2\":\"k2-11\"},11\n+012,a-12,{\"k1\":\"k1-12\", \"k2\":\"k2-12\"},12\n+013,a-13,{\"k1\":\"k1-13\", \"k2\":\"k2-13\"},13\n+014,a-14,{\"k1\":\"k1-14\", \"k2\":\"k2-14\"},14\n+015,a-15,{\"k1\":\"k1-15\", \"k2\":\"k2-15\"},15\n+016,a-16,{\"k1\":\"k1-16\", \"k2\":\"k2-16\"},16\n+017,a-17,{\"k1\":\"k1-17\", \"k2\":\"k2-17\"},17\n+018,a-18,{\"k1\":\"k1-18\", \"k2\":\"k2-18\"},18\n+019,a-19,{\"k1\":\"k1-19\", \"k2\":\"k2-19\"},19\n+020,a-20,{\"k1\":\"k1-20\", \"k2\":\"k2-20\"},20\n+021,a-21,{\"k1\":\"k1-21\", \"k2\":\"k2-21\"},21\n+022,a-22,{\"k1\":\"k1-22\", \"k2\":\"k2-22\"},22\n+023,a-23,{\"k1\":\"k1-23\", \"k2\":\"k2-23\"},23\n+024,a-24,{\"k1\":\"k1-24\", \"k2\":\"k2-24\"},24\n+025,a-25,{\"k1\":\"k1-25\", \"k2\":\"k2-25\"},25\n+026,a-26,{\"k1\":\"k1-26\", \"k2\":\"k2-26\"},26\n+027,a-27,{\"k1\":\"k1-27\", \"k2\":\"k2-27\"},27\n+028,a-28,{\"k1\":\"k1-28\", \"k2\":\"k2-28\"},28\n+029,a-29,{\"k1\":\"k1-29\", \"k2\":\"k2-29\"},29\n+030,a-30,{\"k1\":\"k1-30\", \"k2\":\"k2-30\"},30\n+031,a-31,{\"k1\":\"k1-31\", \"k2\":\"k2-31\"},31\n+032,a-32,{\"k1\":\"k1-32\", \"k2\":\"k2-32\"},32\n+033,a-33,{\"k1\":\"k1-33\", \"k2\":\"k2-33\"},33\n+034,a-34,{\"k1\":\"k1-34\", \"k2\":\"k2-34\"},34\n+035,a-35,{\"k1\":\"k1-35\", \"k2\":\"k2-35\"},35\n+036,a-36,{\"k1\":\"k1-36\", \"k2\":\"k2-36\"},36\n+037,a-37,{\"k1\":\"k1-37\", \"k2\":\"k2-37\"},37\n+038,a-38,{\"k1\":\"k1-38\", \"k2\":\"k2-38\"},38\n+039,a-39,{\"k1\":\"k1-39\", \"k2\":\"k2-39\"},39\n+040,a-40,{\"k1\":\"k1-40\", \"k2\":\"k2-40\"},40\n+041,a-41,{\"k1\":\"k1-41\", \"k2\":\"k2-41\"},41\n+042,a-42,{\"k1\":\"k1-42\", \"k2\":\"k2-42\"},42\n+043,a-43,{\"k1\":\"k1-43\", \"k2\":\"k2-43\"},43\n+044,a-44,{\"k1\":\"k1-44\", \"k2\":\"k2-44\"},44\n+045,a-45,{\"k1\":\"k1-45\", \"k2\":\"k2-45\"},45\n+046,a-46,{\"k1\":\"k1-46\", \"k2\":\"k2-46\"},46\n+047,a-47,{\"k1\":\"k1-47\", \"k2\":\"k2-47\"},47\n+048,a-48,{\"k1\":\"k1-48\", \"k2\":\"k2-48\"},48\n+049,a-49,{\"k1\":\"k1-49\", \"k2\":\"k2-49\"},49\n+050,a-50,{\"k1\":\"k1-50\", \"k2\":\"k2-50\"},50\n+051,a-51,{\"k1\":\"k1-51\", \"k2\":\"k2-51\"},51\n+052,a-52,{\"k1\":\"k1-52\", \"k2\":\"k2-52\"},52\n+053,a-53,{\"k1\":\"k1-53\", \"k2\":\"k2-53\"},53\n+054,a-54,{\"k1\":\"k1-54\", \"k2\":\"k2-54\"},54\n+055,a-55,{\"k1\":\"k1-55\", \"k2\":\"k2-55\"},55\n+056,a-56,{\"k1\":\"k1-56\", \"k2\":\"k2-56\"},56\n+057,a-57,{\"k1\":\"k1-57\", \"k2\":\"k2-57\"},57\n+058,a-58,{\"k1\":\"k1-58\", \"k2\":\"k2-58\"},58\n+059,a-59,{\"k1\":\"k1-59\", \"k2\":\"k2-59\"},59\n+060,a-60,{\"k1\":\"k1-60\", \"k2\":\"k2-60\"},60\n+061,a-61,{\"k1\":\"k1-61\", \"k2\":\"k2-61\"},61\n+062,a-62,{\"k1\":\"k1-62\", \"k2\":\"k2-62\"},62\n+063,a-63,{\"k1\":\"k1-63\", \"k2\":\"k2-63\"},63\n+064,a-64,{\"k1\":\"k1-64\", \"k2\":\"k2-64\"},64\n+065,a-65,{\"k1\":\"k1-65\", \"k2\":\"k2-65\"},65\n+066,a-66,{\"k1\":\"k1-66\", \"k2\":\"k2-66\"},66\n+067,a-67,{\"k1\":\"k1-67\", \"k2\":\"k2-67\"},67\n+068,a-68,{\"k1\":\"k1-68\", \"k2\":\"k2-68\"},68\n+069,a-69,{\"k1\":\"k1-69\", \"k2\":\"k2-69\"},69\n+070,a-70,{\"k1\":\"k1-70\", \"k2\":\"k2-70\"},70\n+071,a-71,{\"k1\":\"k1-71\", \"k2\":\"k2-71\"},71\n+072,a-72,{\"k1\":\"k1-72\", \"k2\":\"k2-72\"},72\n+073,a-73,{\"k1\":\"k1-73\", \"k2\":\"k2-73\"},73\n+074,a-74,{\"k1\":\"k1-74\", \"k2\":\"k2-74\"},74\n+075,a-75,{\"k1\":\"k1-75\", \"k2\":\"k2-75\"},75\n+076,a-76,{\"k1\":\"k1-76\", \"k2\":\"k2-76\"},76\n+077,a-77,{\"k1\":\"k1-77\", \"k2\":\"k2-77\"},77\n+078,a-78,{\"k1\":\"k1-78\", \"k2\":\"k2-78\"},78\n+079,a-79,{\"k1\":\"k1-79\", \"k2\":\"k2-79\"},79\n+080,a-80,{\"k1\":\"k1-80\", \"k2\":\"k2-80\"},80\n+081,a-81,{\"k1\":\"k1-81\", \"k2\":\"k2-81\"},81\n+082,a-82,{\"k1\":\"k1-82\", \"k2\":\"k2-82\"},82\n+083,a-83,{\"k1\":\"k1-83\", \"k2\":\"k2-83\"},83\n+084,a-84,{\"k1\":\"k1-84\", \"k2\":\"k2-84\"},84\n+085,a-85,{\"k1\":\"k1-85\", \"k2\":\"k2-85\"},85\n+086,a-86,{\"k1\":\"k1-86\", \"k2\":\"k2-86\"},86\n+087,a-87,{\"k1\":\"k1-87\", \"k2\":\"k2-87\"},87\n+088,a-88,{\"k1\":\"k1-88\", \"k2\":\"k2-88\"},88\n+089,a-89,{\"k1\":\"k1-89\", \"k2\":\"k2-89\"},89\n+090,a-90,{\"k1\":\"k1-90\", \"k2\":\"k2-90\"},90\n+091,a-91,{\"k1\":\"k1-91\", \"k2\":\"k2-91\"},91\n+092,a-92,{\"k1\":\"k1-92\", \"k2\":\"k2-92\"},92\n+093,a-93,{\"k1\":\"k1-93\", \"k2\":\"k2-93\"},93\n+094,a-94,{\"k1\":\"k1-94\", \"k2\":\"k2-94\"},94\n+095,a-95,{\"k1\":\"k1-95\", \"k2\":\"k2-95\"},95\n+096,a-96,{\"k1\":\"k1-96\", \"k2\":\"k2-96\"},96\n+097,a-97,{\"k1\":\"k1-97\", \"k2\":\"k2-97\"},97\n+098,a-98,{\"k1\":\"k1-98\", \"k2\":\"k2-98\"},98\n+099,a-99,{\"k1\":\"k1-99\", \"k2\":\"k2-99\"},99\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/72ebc43d6e685dad58b2bf238fae12e51c8dec96/tajo-core-tests/src/test/resources/results/TestHBaseTable/testGetSplitsWhenRestartHBase.result",
                "sha": "4f5fd8f2ef75c01df6265e1397f1010ee69dc10b",
                "status": "added"
            },
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/tajo/blob/72ebc43d6e685dad58b2bf238fae12e51c8dec96/tajo-storage/tajo-storage-hbase/src/main/java/org/apache/tajo/storage/hbase/HBaseTablespace.java",
                "changes": 49,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-storage/tajo-storage-hbase/src/main/java/org/apache/tajo/storage/hbase/HBaseTablespace.java?ref=72ebc43d6e685dad58b2bf238fae12e51c8dec96",
                "deletions": 30,
                "filename": "tajo-storage/tajo-storage-hbase/src/main/java/org/apache/tajo/storage/hbase/HBaseTablespace.java",
                "patch": "@@ -33,6 +33,7 @@\n import org.apache.hadoop.hbase.mapreduce.LoadIncrementalHFiles;\n import org.apache.hadoop.hbase.security.User;\n import org.apache.hadoop.hbase.security.UserProvider;\n+import org.apache.hadoop.hbase.util.RegionSizeCalculator;\n import org.apache.hadoop.mapreduce.JobID;\n import org.apache.hadoop.mapreduce.lib.output.FileOutputCommitter;\n import org.apache.hadoop.mapreduce.task.JobContextImpl;\n@@ -421,10 +422,10 @@ public URI getTableUri(String databaseName, String tableName) {\n \n     List<IndexPredication> indexPredications = getIndexPredications(columnMapping, tableDesc, filterCondition);\n     HTable htable = null;\n-    HBaseAdmin hAdmin = null;\n \n     try {\n       htable = new HTable(hbaseConf, tableDesc.getMeta().getProperty(HBaseStorageConstants.META_TABLE_KEY));\n+      RegionSizeCalculator sizeCalculator = new RegionSizeCalculator(htable);\n \n       org.apache.hadoop.hbase.util.Pair<byte[][], byte[][]> keys = htable.getStartEndKeys();\n       if (keys == null || keys.getFirst() == null || keys.getFirst().length == 0) {\n@@ -433,12 +434,18 @@ public URI getTableUri(String databaseName, String tableName) {\n           throw new IOException(\"Expecting at least one region.\");\n         }\n         List<Fragment> fragments = new ArrayList<>(1);\n-        Fragment fragment = new HBaseFragment(\n+        HBaseFragment fragment = new HBaseFragment(\n             tableDesc.getUri(),\n             inputSourceId, htable.getName().getNameAsString(),\n             HConstants.EMPTY_BYTE_ARRAY,\n             HConstants.EMPTY_BYTE_ARRAY,\n             regLoc.getHostname());\n+        long regionSize = sizeCalculator.getRegionSize(regLoc.getRegionInfo().getRegionName());\n+        if (regionSize == 0) {\n+          fragment.setLength(TajoConstants.UNKNOWN_LENGTH);\n+        } else {\n+          fragment.setLength(regionSize);\n+        }\n         fragments.add(fragment);\n         return fragments;\n       }\n@@ -473,13 +480,14 @@ public URI getTableUri(String databaseName, String tableName) {\n         stopRows  = EMPTY_END_ROW_KEY;\n       }\n \n-      hAdmin =  new HBaseAdmin(hbaseConf);\n-      Map<ServerName, ServerLoad> serverLoadMap = new HashMap<>();\n-\n+      // reference: org.apache.hadoop.hbase.mapreduce.TableInputFormatBase.getSplits(JobContext)\n       // region startkey -> HBaseFragment\n       Map<byte[], HBaseFragment> fragmentMap = new HashMap<>();\n       for (int i = 0; i < keys.getFirst().length; i++) {\n         HRegionLocation location = htable.getRegionLocation(keys.getFirst()[i], false);\n+        if (null == location) {\n+          throw new IOException(\"Can't find the region of the key: \" +  Bytes.toStringBinary(keys.getFirst()[i]));\n+        }\n \n         byte[] regionStartKey = keys.getFirst()[i];\n         byte[] regionStopKey = keys.getSecond()[i];\n@@ -497,14 +505,6 @@ public URI getTableUri(String databaseName, String tableName) {\n             byte[] fragmentStop = (stopRow.length == 0 || Bytes.compareTo(regionStopKey, stopRow) <= 0) &&\n                 regionStopKey.length > 0 ? regionStopKey : stopRow;\n \n-            String regionName = location.getRegionInfo().getRegionNameAsString();\n-\n-            ServerLoad serverLoad = serverLoadMap.get(location.getServerName());\n-            if (serverLoad == null) {\n-              serverLoad = hAdmin.getClusterStatus().getLoad(location.getServerName());\n-              serverLoadMap.put(location.getServerName(), serverLoad);\n-            }\n-\n             if (fragmentMap.containsKey(regionStartKey)) {\n               HBaseFragment prevFragment = fragmentMap.get(regionStartKey);\n               if (Bytes.compareTo(fragmentStart, prevFragment.getStartRow()) < 0) {\n@@ -514,27 +514,19 @@ public URI getTableUri(String databaseName, String tableName) {\n                 prevFragment.setStopRow(fragmentStop);\n               }\n             } else {\n+              byte[] regionName = location.getRegionInfo().getRegionName();\n+              long regionSize = sizeCalculator.getRegionSize(regionName);\n+\n               HBaseFragment fragment = new HBaseFragment(tableDesc.getUri(),\n                   inputSourceId,\n                   htable.getName().getNameAsString(),\n                   fragmentStart,\n                   fragmentStop,\n                   location.getHostname());\n-\n-              // get region size\n-              boolean foundLength = false;\n-              for (Map.Entry<byte[], RegionLoad> entry : serverLoad.getRegionsLoad().entrySet()) {\n-                if (regionName.equals(Bytes.toString(entry.getKey()))) {\n-                  RegionLoad regionLoad = entry.getValue();\n-                  long storeFileSize = (regionLoad.getStorefileSizeMB() + regionLoad.getMemStoreSizeMB()) * 1024L * 1024L;\n-                  fragment.setLength(storeFileSize);\n-                  foundLength = true;\n-                  break;\n-                }\n-              }\n-\n-              if (!foundLength) {\n+              if (regionSize == 0) {\n                 fragment.setLength(TajoConstants.UNKNOWN_LENGTH);\n+              } else {\n+                fragment.setLength(regionSize);\n               }\n \n               fragmentMap.put(regionStartKey, fragment);\n@@ -557,9 +549,6 @@ public URI getTableUri(String databaseName, String tableName) {\n       if (htable != null) {\n         htable.close();\n       }\n-      if (hAdmin != null) {\n-        hAdmin.close();\n-      }\n     }\n   }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/72ebc43d6e685dad58b2bf238fae12e51c8dec96/tajo-storage/tajo-storage-hbase/src/main/java/org/apache/tajo/storage/hbase/HBaseTablespace.java",
                "sha": "1b81531d45d2509a94b54f3a8a66006d717c4d9c",
                "status": "modified"
            }
        ],
        "message": "TAJO-1921: Hbase Storage can cause NPE when the hbase cluster is restarted\n\nCloses #918",
        "parent": "https://github.com/apache/tajo/commit/6c87e8e9daba0a934c6dbba20b361788e42f2cda",
        "patched_files": [
            "HBaseTablespace.java",
            "CHANGES",
            "testGetSplitsWhenRestartHBase.result"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestHBaseTable.java"
        ]
    },
    "tajo_78bde55": {
        "bug_id": "tajo_78bde55",
        "commit": "https://github.com/apache/tajo/commit/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tajo/blob/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/CHANGES",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=78bde551772b8d7a7ce459e2cae2d1f73c4fa65b",
                "deletions": 1,
                "filename": "CHANGES",
                "patch": "@@ -153,10 +153,14 @@ Release 0.12.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-2168: NullPointerException occurs when a simple query contains a python udf. \n+    (jihoon)\n+\n     TAJO-2164: SequenceFile print wrong values with TextSerializerDeserializer.\n     (jaehwa)\n \n-    TAJO-2163: No error message is showed when query execution failed. (Wonjun Hong via jihoon)\n+    TAJO-2163: No error message is showed when query execution failed. \n+    (Wonjun Hong via jihoon)\n \n     TAJO-2150: Fix invalid implementation of date time in jdbc. (jinho)\n ",
                "raw_url": "https://github.com/apache/tajo/raw/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/CHANGES",
                "sha": "5ec513d9d8fbcf9909c88c66f21dda58a947d4cf",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tajo/blob/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-cluster-tests/src/test/java/org/apache/tajo/TajoTestingCluster.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-cluster-tests/src/test/java/org/apache/tajo/TajoTestingCluster.java?ref=78bde551772b8d7a7ce459e2cae2d1f73c4fa65b",
                "deletions": 1,
                "filename": "tajo-cluster-tests/src/test/java/org/apache/tajo/TajoTestingCluster.java",
                "patch": "@@ -59,6 +59,7 @@\n import java.io.Writer;\n import java.net.InetSocketAddress;\n import java.net.URI;\n+import java.net.URL;\n import java.sql.ResultSet;\n import java.sql.SQLException;\n import java.util.ArrayList;\n@@ -151,7 +152,10 @@ void initPropertiesAndConfigs() {\n     conf.setIntVar(ConfVars.HISTORY_QUERY_CACHE_SIZE, 10);\n \n     // Python function path\n-    conf.setStrings(ConfVars.PYTHON_CODE_DIR.varname, getClass().getResource(\"/python\").toString());\n+    URL pythonUdfURL = getClass().getResource(\"/pyudf\");\n+    if (pythonUdfURL != null) {\n+      conf.setStrings(ConfVars.PYTHON_CODE_DIR.varname, pythonUdfURL.toString());\n+    }\n \n     // Buffer size\n     conf.setInt(ConfVars.$EXECUTOR_EXTERNAL_SORT_BUFFER_SIZE.varname, 1);",
                "raw_url": "https://github.com/apache/tajo/raw/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-cluster-tests/src/test/java/org/apache/tajo/TajoTestingCluster.java",
                "sha": "a7559eca77c564e7f0a2f6f7d27e1127f9be714a",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tajo/blob/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core-tests/src/test/java/org/apache/tajo/engine/query/TestSelectQuery.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core-tests/src/test/java/org/apache/tajo/engine/query/TestSelectQuery.java?ref=78bde551772b8d7a7ce459e2cae2d1f73c4fa65b",
                "deletions": 0,
                "filename": "tajo-core-tests/src/test/java/org/apache/tajo/engine/query/TestSelectQuery.java",
                "patch": "@@ -725,6 +725,13 @@ public void testMultiBytesDelimiter4() throws Exception {\n     }\n   }\n \n+  @Test\n+  public void testSimpleQueryWithPythonFuncs() throws Exception {\n+    ResultSet res = executeQuery();\n+    assertResultSet(res);\n+    cleanupQuery(res);\n+  }\n+\n   @Test\n   public void testSelectPythonFuncs() throws Exception {\n     ResultSet res = executeQuery();",
                "raw_url": "https://github.com/apache/tajo/raw/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core-tests/src/test/java/org/apache/tajo/engine/query/TestSelectQuery.java",
                "sha": "2e1ac85c7842d7581b89c992243eecedc63de366",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tajo/blob/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core-tests/src/test/resources/pyudf/__init__.py",
                "changes": 0,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core-tests/src/test/resources/pyudf/__init__.py?ref=78bde551772b8d7a7ce459e2cae2d1f73c4fa65b",
                "deletions": 0,
                "filename": "tajo-core-tests/src/test/resources/pyudf/__init__.py",
                "previous_filename": "tajo-core-tests/src/test/resources/python/__init__.py",
                "raw_url": "https://github.com/apache/tajo/raw/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core-tests/src/test/resources/pyudf/__init__.py",
                "sha": "8093a2f8faa6200770ef26c8a4a524dbaed2b9c7",
                "status": "renamed"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tajo/blob/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core-tests/src/test/resources/pyudf/test_funcs.py",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core-tests/src/test/resources/pyudf/test_funcs.py?ref=78bde551772b8d7a7ce459e2cae2d1f73c4fa65b",
                "deletions": 0,
                "filename": "tajo-core-tests/src/test/resources/pyudf/test_funcs.py",
                "patch": "@@ -15,6 +15,7 @@\n #  limitations under the License.\n \n from tajo_util import output_type\n+from types import StringType\n \n @output_type('int4')\n def return_one():\n@@ -34,3 +35,9 @@ def add_py(a,b):\n         return a+b\n     else:\n         return None\n+\n+def str_len(a):\n+    if a is None:\n+        return 0\n+    else:\n+        return len(a)\n\\ No newline at end of file",
                "previous_filename": "tajo-core-tests/src/test/resources/python/test_funcs.py",
                "raw_url": "https://github.com/apache/tajo/raw/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core-tests/src/test/resources/pyudf/test_funcs.py",
                "sha": "404ceb6e65ed0abd6e6e0e11f6b33037123ba432",
                "status": "renamed"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tajo/blob/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core-tests/src/test/resources/pyudf/test_funcs2.py",
                "changes": 0,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core-tests/src/test/resources/pyudf/test_funcs2.py?ref=78bde551772b8d7a7ce459e2cae2d1f73c4fa65b",
                "deletions": 0,
                "filename": "tajo-core-tests/src/test/resources/pyudf/test_funcs2.py",
                "previous_filename": "tajo-core-tests/src/test/resources/python/test_funcs2.py",
                "raw_url": "https://github.com/apache/tajo/raw/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core-tests/src/test/resources/pyudf/test_funcs2.py",
                "sha": "8a6f6080891397057298a1d42c3679a435025e68",
                "status": "renamed"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tajo/blob/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core-tests/src/test/resources/pyudf/test_udaf.py",
                "changes": 0,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core-tests/src/test/resources/pyudf/test_udaf.py?ref=78bde551772b8d7a7ce459e2cae2d1f73c4fa65b",
                "deletions": 0,
                "filename": "tajo-core-tests/src/test/resources/pyudf/test_udaf.py",
                "previous_filename": "tajo-core-tests/src/test/resources/python/test_udaf.py",
                "raw_url": "https://github.com/apache/tajo/raw/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core-tests/src/test/resources/pyudf/test_udaf.py",
                "sha": "4e7b34d2fc2e8a9baa6eb555d4554fb26bf68366",
                "status": "renamed"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core-tests/src/test/resources/queries/TestSelectQuery/testSimpleQueryWithPythonFuncs.sql",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core-tests/src/test/resources/queries/TestSelectQuery/testSimpleQueryWithPythonFuncs.sql?ref=78bde551772b8d7a7ce459e2cae2d1f73c4fa65b",
                "deletions": 0,
                "filename": "tajo-core-tests/src/test/resources/queries/TestSelectQuery/testSimpleQueryWithPythonFuncs.sql",
                "patch": "@@ -0,0 +1 @@\n+select str_len(r_name) from region;\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core-tests/src/test/resources/queries/TestSelectQuery/testSimpleQueryWithPythonFuncs.sql",
                "sha": "5e5910f16a84e7e18f250106f4bd8c9f16657b7a",
                "status": "added"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tajo/blob/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core-tests/src/test/resources/results/TestSelectQuery/testSimpleQueryWithPythonFuncs.result",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core-tests/src/test/resources/results/TestSelectQuery/testSimpleQueryWithPythonFuncs.result?ref=78bde551772b8d7a7ce459e2cae2d1f73c4fa65b",
                "deletions": 0,
                "filename": "tajo-core-tests/src/test/resources/results/TestSelectQuery/testSimpleQueryWithPythonFuncs.result",
                "patch": "@@ -0,0 +1,10 @@\n+?str_len\n+-------------------------------\n+6\n+7\n+4\n+6\n+11\n+0\n+0\n+0\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core-tests/src/test/resources/results/TestSelectQuery/testSimpleQueryWithPythonFuncs.result",
                "sha": "38069597df80943a16c7d93c174cad95a745bc65",
                "status": "added"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core/src/main/java/org/apache/tajo/engine/function/FunctionLoader.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/function/FunctionLoader.java?ref=78bde551772b8d7a7ce459e2cae2d1f73c4fa65b",
                "deletions": 1,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/function/FunctionLoader.java",
                "patch": "@@ -101,7 +101,7 @@\n         try {\n           codePath = new Path(codePathStr);\n         } catch (IllegalArgumentException e) {\n-          LOG.warn(e);\n+          LOG.warn(\"Illegal function path\", e);\n           continue;\n         }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core/src/main/java/org/apache/tajo/engine/function/FunctionLoader.java",
                "sha": "a32d5a533b9b9ceaf84f7ed14ec72f02b130ee62",
                "status": "modified"
            },
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/tajo/blob/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core/src/main/java/org/apache/tajo/master/exec/NonForwardQueryResultFileScanner.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/master/exec/NonForwardQueryResultFileScanner.java?ref=78bde551772b8d7a7ce459e2cae2d1f73c4fa65b",
                "deletions": 0,
                "filename": "tajo-core/src/main/java/org/apache/tajo/master/exec/NonForwardQueryResultFileScanner.java",
                "patch": "@@ -115,6 +115,13 @@ private void initSeqScanExec() throws IOException, TajoException {\n           new QueryContext(tajoConf), null,\n           new TaskAttemptId(new TaskId(new ExecutionBlockId(queryId, 1), 0), 0),\n           fragmentProtos, null);\n+\n+      if (scanNode.hasTargets()) {\n+        QueryExecutor.startScriptExecutors(taskContext.getQueryContext(),\n+            taskContext.getEvalContext(),\n+            scanNode.getTargets());\n+      }\n+\n       this.scanExec = new PartitionMergeScanExec(taskContext, scanNode, fragmentProtos);\n       this.scanExec.init();\n     } else {\n@@ -155,6 +162,10 @@ public void close() throws IOException {\n       rowBlock = null;\n     }\n \n+    if (taskContext != null) {\n+      QueryExecutor.stopScriptExecutors(taskContext.getEvalContext());\n+    }\n+\n     //remove temporal final output\n     if (!tajoConf.getBoolVar(TajoConf.ConfVars.$DEBUG_ENABLED)) {\n       Path temporalResultDir = TajoConf.getTemporalResultDir(tajoConf, queryId);",
                "raw_url": "https://github.com/apache/tajo/raw/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-core/src/main/java/org/apache/tajo/master/exec/NonForwardQueryResultFileScanner.java",
                "sha": "70268cb03a01b5791d6fa42a1fc23683850af945",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-plan/src/main/java/org/apache/tajo/plan/expr/FunctionEval.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-plan/src/main/java/org/apache/tajo/plan/expr/FunctionEval.java?ref=78bde551772b8d7a7ce459e2cae2d1f73c4fa65b",
                "deletions": 1,
                "filename": "tajo-plan/src/main/java/org/apache/tajo/plan/expr/FunctionEval.java",
                "patch": "@@ -32,6 +32,8 @@\n import org.apache.tajo.type.Type;\n import org.apache.tajo.util.TUtil;\n \n+import java.util.Arrays;\n+\n import static org.apache.tajo.catalog.proto.CatalogProtos.FunctionType.DISTINCT_AGGREGATION;\n import static org.apache.tajo.catalog.proto.CatalogProtos.FunctionType.DISTINCT_UDA;\n \n@@ -149,7 +151,7 @@ public boolean equals(Object obj) {\n \t\n \t@Override\n \tpublic int hashCode() {\n-\t  return Objects.hashCode(funcDesc, argEvals);\n+\t  return Objects.hashCode(funcDesc, Arrays.hashCode(argEvals));\n \t}\n \t\n \t@Override",
                "raw_url": "https://github.com/apache/tajo/raw/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-plan/src/main/java/org/apache/tajo/plan/expr/FunctionEval.java",
                "sha": "575d1585ce7575be6ccd2b89af96965062315819",
                "status": "modified"
            },
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/tajo/blob/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-plan/src/main/java/org/apache/tajo/plan/function/python/PythonScriptEngine.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-plan/src/main/java/org/apache/tajo/plan/function/python/PythonScriptEngine.java?ref=78bde551772b8d7a7ce459e2cae2d1f73c4fa65b",
                "deletions": 1,
                "filename": "tajo-plan/src/main/java/org/apache/tajo/plan/function/python/PythonScriptEngine.java",
                "patch": "@@ -109,7 +109,7 @@\n         }\n       } catch (Throwable t) {\n         // ignore invalid functions\n-        LOG.warn(t);\n+        LOG.warn(\"Cannot parse function \" + funcInfo, t);\n       }\n     }\n     return functionDescs;\n@@ -154,6 +154,11 @@ private static boolean isValidUdaf(AggFuncInfo aggFuncInfo) {\n     ScalarFuncInfo mergeInfo;\n     ScalarFuncInfo getPartialResultInfo;\n     ScalarFuncInfo getFinalResultInfo;\n+\n+    @Override\n+    public String toString() {\n+      return className + \".\" + funcName;\n+    }\n   }\n \n   private static class ScalarFuncInfo implements FunctionInfo {\n@@ -171,6 +176,11 @@ public ScalarFuncInfo(String[] quotedSchemaStrings, String funcName, int paramNu\n       this.funcName = funcName;\n       this.paramNum = paramNum;\n     }\n+\n+    @Override\n+    public String toString() {\n+      return funcName;\n+    }\n   }\n \n   // TODO: python parser must be improved.",
                "raw_url": "https://github.com/apache/tajo/raw/78bde551772b8d7a7ce459e2cae2d1f73c4fa65b/tajo-plan/src/main/java/org/apache/tajo/plan/function/python/PythonScriptEngine.java",
                "sha": "e5b5f47531010b2bdcecc29675b4de1d1bbf26d8",
                "status": "modified"
            }
        ],
        "message": "TAJO-2168: NullPointerException occurs when a simple query contains a python udf.\n\nCloses #1035",
        "parent": "https://github.com/apache/tajo/commit/4d2bd647ff7ee2450e0b9ed920f8179d32178186",
        "patched_files": [
            "FunctionLoader.java",
            "test_funcs.py",
            "TajoTestingCluster.java",
            "FunctionEval.java",
            "testSimpleQueryWithPythonFuncs.result",
            "NonForwardQueryResultFileScanner.java",
            "PythonScriptEngine.java",
            "test_funcs2.py",
            "test_udaf.py",
            "testSimpleQueryWithPythonFuncs.sql",
            "__init__.py",
            "CHANGES"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestFunctionLoader.java",
            "TestSelectQuery.java"
        ]
    },
    "tajo_7aba395": {
        "bug_id": "tajo_7aba395",
        "commit": "https://github.com/apache/tajo/commit/7aba3958e2d7f3ae5f82cc50928f778566430b1c",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/7aba3958e2d7f3ae5f82cc50928f778566430b1c/CHANGES.txt",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES.txt?ref=7aba3958e2d7f3ae5f82cc50928f778566430b1c",
                "deletions": 0,
                "filename": "CHANGES.txt",
                "patch": "@@ -192,6 +192,9 @@ Release 0.8.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-469: CTAS with no column definition will get  a NPE.\n+    (Min Zhou via hyunsik)\n+\n     TAJO-467: Too many open FD when master failed. (hyoungjunkim via hyunsik)\n \n     TAJO-455: Throw PlanningException when Creating table with Partition",
                "raw_url": "https://github.com/apache/tajo/raw/7aba3958e2d7f3ae5f82cc50928f778566430b1c/CHANGES.txt",
                "sha": "48bfa3db75540adfd4df232b8840ac987f5d9432",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/7aba3958e2d7f3ae5f82cc50928f778566430b1c/tajo-core/tajo-core-backend/src/main/antlr4/org/apache/tajo/engine/parser/SQLParser.g4",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/antlr4/org/apache/tajo/engine/parser/SQLParser.g4?ref=7aba3958e2d7f3ae5f82cc50928f778566430b1c",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/antlr4/org/apache/tajo/engine/parser/SQLParser.g4",
                "patch": "@@ -66,8 +66,10 @@ index_statement\n create_table_statement\n   : CREATE EXTERNAL TABLE table_name table_elements USING file_type=Identifier\n     (param_clause)? (table_partitioning_clauses)? (LOCATION path=Character_String_Literal)\n-  | CREATE TABLE table_name (table_elements)? (USING file_type=Identifier)?\n+  | CREATE TABLE table_name table_elements (USING file_type=Identifier)?\n     (param_clause)? (table_partitioning_clauses)? (AS query_expression)?\n+  | CREATE TABLE table_name (USING file_type=Identifier)?\n+    (param_clause)? (table_partitioning_clauses)? AS query_expression\n   ;\n \n table_elements",
                "raw_url": "https://github.com/apache/tajo/raw/7aba3958e2d7f3ae5f82cc50928f778566430b1c/tajo-core/tajo-core-backend/src/main/antlr4/org/apache/tajo/engine/parser/SQLParser.g4",
                "sha": "fbae1751c3467aa71b2d7276b91dc3eb4d2c25ce",
                "status": "modified"
            },
            {
                "additions": 16,
                "blob_url": "https://github.com/apache/tajo/blob/7aba3958e2d7f3ae5f82cc50928f778566430b1c/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalPlanner.java",
                "changes": 23,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalPlanner.java?ref=7aba3958e2d7f3ae5f82cc50928f778566430b1c",
                "deletions": 7,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalPlanner.java",
                "patch": "@@ -758,15 +758,13 @@ public LogicalNode visitCreateTable(PlanContext context, Stack<OpType> stack, Cr\n       storeNode.setCreateTable();\n       storeNode.setChild(subQuery);\n \n-      if (expr.hasTableElements()) {\n-        // CREATE TABLE tbl(col1 type, col2 type) AS SELECT ...\n-        Schema schema = convertTableElementsSchema(expr.getTableElements());\n-        storeNode.setOutSchema(schema);\n-      } else {\n+      storeNode.setInSchema(subQuery.getOutSchema());\n+      if(!expr.hasTableElements()) {\n         // CREATE TABLE tbl AS SELECT ...\n-        storeNode.setOutSchema(subQuery.getOutSchema());\n+        expr.setTableElements(convertSchemaToTableElements(subQuery.getOutSchema()));\n       }\n-      storeNode.setInSchema(subQuery.getOutSchema());\n+      // else CREATE TABLE tbl(col1 type, col2 type) AS SELECT ...\n+      storeNode.setOutSchema(convertTableElementsSchema(expr.getTableElements()));\n \n       if (expr.hasStorageType()) {\n         storeNode.setStorageType(CatalogUtil.getStoreType(expr.getStorageType()));\n@@ -977,6 +975,17 @@ private Schema convertTableElementsSchema(CreateTable.ColumnDefinition [] elemen\n     return schema;\n   }\n \n+  private ColumnDefinition[] convertSchemaToTableElements(Schema schema) {\n+    List<Column> columns = schema.getColumns();\n+    ColumnDefinition[] columnDefinitions = new ColumnDefinition[columns.size()];\n+    for(int i = 0; i < columns.size(); i ++) {\n+      Column col = columns.get(i);\n+      columnDefinitions[i] = new ColumnDefinition(col.getColumnName(), col.getDataType().getType().name());\n+    }\n+\n+    return columnDefinitions;\n+  }\n+\n   private Collection<Column> convertTableElementsColumns(CreateTable.ColumnDefinition [] elements,\n                                                    ColumnReferenceExpr[] references) {\n     List<Column> columnList = TUtil.newList();",
                "raw_url": "https://github.com/apache/tajo/raw/7aba3958e2d7f3ae5f82cc50928f778566430b1c/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalPlanner.java",
                "sha": "7349c0dfc89498b93b8d7c3851d9c903ca6eff77",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/7aba3958e2d7f3ae5f82cc50928f778566430b1c/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/global/GlobalPlanner.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/global/GlobalPlanner.java?ref=7aba3958e2d7f3ae5f82cc50928f778566430b1c",
                "deletions": 2,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/global/GlobalPlanner.java",
                "patch": "@@ -340,8 +340,7 @@ private ExecutionBlock buildSortPlan(GlobalPlanContext context, ExecutionBlock c\n   private ExecutionBlock buildStorePlan(GlobalPlanContext context,\n                                         ExecutionBlock childBlock,\n                                         StoreTableNode currentNode) \n-    throws PlanningException\n-    {\n+    throws PlanningException {\n     PartitionDesc partitionDesc = currentNode.getPartitions();\n \n     // if result table is not a partitioned table, directly store it",
                "raw_url": "https://github.com/apache/tajo/raw/7aba3958e2d7f3ae5f82cc50928f778566430b1c/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/global/GlobalPlanner.java",
                "sha": "2b3ecea15dc940f8d7627625211fe57f431396eb",
                "status": "modified"
            },
            {
                "additions": 44,
                "blob_url": "https://github.com/apache/tajo/blob/7aba3958e2d7f3ae5f82cc50928f778566430b1c/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestCTASQuery.java",
                "changes": 46,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestCTASQuery.java?ref=7aba3958e2d7f3ae5f82cc50928f778566430b1c",
                "deletions": 2,
                "filename": "tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestCTASQuery.java",
                "patch": "@@ -39,6 +39,7 @@\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertTrue;\n \n+\n /**\n  * Test CREATE TABLE AS SELECT statements\n  */\n@@ -54,13 +55,54 @@ public static void setUp() throws Exception {\n     tpch = TpchTestBase.getInstance();\n   }\n \n+  @Test\n+  public final void testCtasWithoutTableDefinition() throws Exception {\n+    String tableName =\"testCtasWithoutTableDefinition\";\n+    tpch.execute(\n+        \"create table \" + tableName\n+            + \" partition by column(key float8) \"\n+            + \" as select l_orderkey as col1, l_partkey as col2, l_quantity as key from lineitem\");\n+\n+    TajoTestingCluster cluster = tpch.getTestingCluster();\n+    CatalogService catalog = cluster.getMaster().getCatalog();\n+    TableDesc desc = catalog.getTableDesc(tableName);\n+    assertTrue(catalog.existsTable(tableName));\n+    assertTrue(desc.getSchema().contains(\"testCtasWithoutTableDefinition.col1\"));\n+    PartitionDesc partitionDesc = desc.getPartitions();\n+    assertEquals(partitionDesc.getPartitionsType(), CatalogProtos.PartitionsType.COLUMN);\n+    assertEquals(\"key\", partitionDesc.getColumns().get(0).getColumnName());\n+\n+    FileSystem fs = FileSystem.get(tpch.getTestingCluster().getConfiguration());\n+    Path path = desc.getPath();\n+    assertTrue(fs.isDirectory(path));\n+    assertTrue(fs.isDirectory(new Path(path.toUri() + \"/key=17.0\")));\n+    assertTrue(fs.isDirectory(new Path(path.toUri() + \"/key=36.0\")));\n+    assertTrue(fs.isDirectory(new Path(path.toUri() + \"/key=38.0\")));\n+    assertTrue(fs.isDirectory(new Path(path.toUri() + \"/key=45.0\")));\n+    assertTrue(fs.isDirectory(new Path(path.toUri() + \"/key=49.0\")));\n+    assertEquals(5, desc.getStats().getNumRows().intValue());\n+\n+    ResultSet res = tpch.execute(\n+        \"select distinct * from \" + tableName + \" where (key = 45.0 or key = 38.0)\");\n+\n+    Map<Double, int []> resultRows1 = Maps.newHashMap();\n+    resultRows1.put(45.0d, new int[]{3, 2});\n+    resultRows1.put(38.0d, new int[]{2, 2});\n+\n+    for (int i = 0; i < 3 && res.next(); i++) {\n+      assertEquals(resultRows1.get(res.getDouble(3))[0], res.getInt(1));\n+      assertEquals(resultRows1.get(res.getDouble(3))[1], res.getInt(2));\n+    }\n+    res.close();\n+  }\n+\n   @Test\n   public final void testCtasWithColumnedPartition() throws Exception {\n     String tableName =\"testCtasWithColumnedPartition\";\n     tpch.execute(\n         \"create table \" + tableName\n-        + \" (col1 int4, col2 int4) partition by column(key float8) \"\n-        + \" as select l_orderkey as col1, l_partkey as col2, l_quantity as key from lineitem\");\n+            + \" (col1 int4, col2 int4) partition by column(key float8) \"\n+            + \" as select l_orderkey as col1, l_partkey as col2, l_quantity as key from lineitem\");\n \n     TajoTestingCluster cluster = tpch.getTestingCluster();\n     CatalogService catalog = cluster.getMaster().getCatalog();",
                "raw_url": "https://github.com/apache/tajo/raw/7aba3958e2d7f3ae5f82cc50928f778566430b1c/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestCTASQuery.java",
                "sha": "f879c2cc7e057c37cdb5c74b23075f57d8ef2ed4",
                "status": "modified"
            }
        ],
        "message": "TAJO-469: CTAS with no column definition will get  a NPE. (Min Zhou via hyunsik)",
        "parent": "https://github.com/apache/tajo/commit/bb7e6b6b3ca3f729e292df3b5905a46fe773f392",
        "patched_files": [
            "GlobalPlanner.java",
            "CHANGES.txt",
            "SQLParser.g4",
            "LogicalPlanner.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestLogicalPlanner.java",
            "TestGlobalPlanner.java",
            "TestCTASQuery.java"
        ]
    },
    "tajo_7bacc09": {
        "bug_id": "tajo_7bacc09",
        "commit": "https://github.com/apache/tajo/commit/7bacc091f7a3939d540dcea37aca61ba2772b181",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tajo/blob/7bacc091f7a3939d540dcea37aca61ba2772b181/common/src/main/java/nta/datum/FloatDatum.java",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/common/src/main/java/nta/datum/FloatDatum.java?ref=7bacc091f7a3939d540dcea37aca61ba2772b181",
                "deletions": 8,
                "filename": "common/src/main/java/nta/datum/FloatDatum.java",
                "patch": "@@ -1,6 +1,3 @@\n-/**\n- * \n- */\n package nta.datum;\n \n import java.nio.ByteBuffer;\n@@ -196,9 +193,9 @@ public Datum plus(Datum datum) {\n     case INT:\n       return DatumFactory.createFloat(val + datum.asInt());\n     case LONG:\n-      return DatumFactory.createFloat(val + datum.asLong());\n+      return DatumFactory.createDouble(val + datum.asLong());\n     case FLOAT:\n-      return DatumFactory.createFloat(val + datum.asFloat());\n+      return DatumFactory.createDouble(val + datum.asFloat());\n     case DOUBLE:\n       return DatumFactory.createDouble(val + datum.asDouble());\n     default:\n@@ -216,7 +213,7 @@ public Datum minus(Datum datum) {\n     case LONG:\n       return DatumFactory.createDouble(val - datum.asLong());\n     case FLOAT:\n-      return DatumFactory.createFloat(val - datum.asFloat());\n+      return DatumFactory.createDouble(val - datum.asFloat());\n     case DOUBLE:\n       return DatumFactory.createDouble(val - datum.asDouble());\n     default:\n@@ -234,7 +231,7 @@ public Datum multiply(Datum datum) {\n     case LONG:\n       return DatumFactory.createDouble(val * datum.asLong());\n     case FLOAT:\n-      return DatumFactory.createFloat(val * datum.asFloat());\n+      return DatumFactory.createDouble(val * datum.asFloat());\n     case DOUBLE:\n       return DatumFactory.createDouble(val * datum.asDouble());\n     default:\n@@ -252,7 +249,7 @@ public Datum divide(Datum datum) {\n     case LONG:\n       return DatumFactory.createDouble(val / datum.asLong());\n     case FLOAT:\n-      return DatumFactory.createFloat(val / datum.asFloat());\n+      return DatumFactory.createDouble(val / datum.asFloat());\n     case DOUBLE:\n       return DatumFactory.createDouble(val / datum.asDouble());\n     default:",
                "raw_url": "https://github.com/apache/tajo/raw/7bacc091f7a3939d540dcea37aca61ba2772b181/common/src/main/java/nta/datum/FloatDatum.java",
                "sha": "da40de76f37da1ef7eaefaf77e67ae90079fc8c6",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/7bacc091f7a3939d540dcea37aca61ba2772b181/engine/benchmark/tpch/q6.tql",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/benchmark/tpch/q6.tql?ref=7bacc091f7a3939d540dcea37aca61ba2772b181",
                "deletions": 3,
                "filename": "engine/benchmark/tpch/q6.tql",
                "patch": "@@ -3,8 +3,8 @@ select\n from\n \tlineitem\n where\n-\tl_shipdate >= date '1994-01-01'\n-\tand l_shipdate < date '1994-01-01' + interval '1' year\n-\tand l_discount between 0.06 - 0.01 and 0.06 + 0.01\n+\tl_shipdate >= '1994-01-01'\n+\tand l_shipdate < '1994-01-01' + interval '1' year\n+\tand l_discount > 0.05 and l_discount < 0.07\n \tand l_quantity < 24;\n ",
                "raw_url": "https://github.com/apache/tajo/raw/7bacc091f7a3939d540dcea37aca61ba2772b181/engine/benchmark/tpch/q6.tql",
                "sha": "5989c84a862e8de58bd3b5ae73b72b41a99e4293",
                "status": "modified"
            },
            {
                "additions": 50,
                "blob_url": "https://github.com/apache/tajo/blob/7bacc091f7a3939d540dcea37aca61ba2772b181/engine/src/main/java/nta/engine/exec/eval/BinaryEval.java",
                "changes": 103,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/exec/eval/BinaryEval.java?ref=7bacc091f7a3939d540dcea37aca61ba2772b181",
                "deletions": 53,
                "filename": "engine/src/main/java/nta/engine/exec/eval/BinaryEval.java",
                "patch": "@@ -55,59 +55,56 @@ public BinaryEval(Type type, EvalNode left, EvalNode right) {\n \tpublic BinaryEval(PartialBinaryExpr expr) {\n \t  this(expr.type, expr.leftExpr, expr.rightExpr);\n \t}\n-\t\n-\tprivate DataType determineType(DataType left, DataType right) {\n-\t\tif(left == right) \n-\t\t\treturn left;\n-\t\telse {\n-\t\t\tswitch (left) {\n-\t\t\t\tcase INT: {\n-\t\t\t\t\tswitch(right) {\n-\t\t\t\t\t\tcase SHORT:\n-\t\t\t\t\t\tcase LONG:\n-\t\t\t\t\t\tcase FLOAT:\n-\t\t\t\t\t\tcase DOUBLE:\n-\t\t\t\t\t\tcase STRING: return right;\n-\t\t\t\t\t\tdefault: throw new InvalidEvalException(); \n-\t\t\t\t\t}\t\t\t\t\t\n-\t\t\t\t}\n-\t\t\t\t\n-\t\t\t\tcase LONG: {\n-\t\t\t\t\tswitch(right) {\n-\t\t\t\t\t\tcase SHORT:\n-\t\t\t\t\t\tcase INT: return left;\n-\t\t\t\t\t\tcase FLOAT:\n-\t\t\t\t\t\tcase DOUBLE:\n-\t\t\t\t\t\tcase STRING: return right;\n-\t\t\t\t\t\tdefault: throw new InvalidEvalException(); \n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t\t\n-\t\t\t\tcase FLOAT: {\n-\t\t\t\t\tswitch(right) {\n-\t\t\t\t\t\tcase SHORT:\n-\t\t\t\t\t\tcase INT: return left;\n-\t\t\t\t\t\tcase LONG: return DataType.DOUBLE;\n-\t\t\t\t\t\tcase DOUBLE:\n-\t\t\t\t\t\tcase STRING: return right;\n-\t\t\t\t\t\tdefault: throw new InvalidEvalException(); \n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t\t\n-\t\t\t\tcase DOUBLE: {\n-\t\t\t\t\tswitch(right) {\n-\t\t\t\t\t\tcase SHORT:\n-\t\t\t\t\t\tcase INT:\n-\t\t\t\t\t\tcase LONG: return left;\n-\t\t\t\t\t\tcase STRING: return right;\n-\t\t\t\t\t\tdefault: throw new InvalidEvalException(); \n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t\t\n-\t\t\t\tdefault: return left;\n-\t\t\t}\n-\t\t}\n-\t}\n+\n+  private DataType determineType(DataType left, DataType right) {\n+    switch (left) {\n+      case INT: {\n+        switch(right) {\n+          case SHORT:\n+          case INT: return DataType.INT;\n+          case LONG: return DataType.LONG;\n+          case FLOAT:\n+          case DOUBLE: return DataType.DOUBLE;\n+          default: throw new InvalidEvalException();\n+        }\n+      }\n+\n+      case LONG: {\n+        switch(right) {\n+          case SHORT:\n+          case INT:\n+          case LONG: return DataType.LONG;\n+          case FLOAT:\n+          case DOUBLE: return DataType.DOUBLE;\n+          default: throw new InvalidEvalException();\n+        }\n+      }\n+\n+      case FLOAT: {\n+        switch(right) {\n+          case SHORT:\n+          case INT:\n+          case LONG:\n+          case FLOAT:\n+          case DOUBLE: return DataType.DOUBLE;\n+          default: throw new InvalidEvalException();\n+        }\n+      }\n+\n+      case DOUBLE: {\n+        switch(right) {\n+          case SHORT:\n+          case INT:\n+          case LONG:\n+          case FLOAT:\n+          case DOUBLE: return DataType.DOUBLE;\n+          default: throw new InvalidEvalException();\n+        }\n+      }\n+\n+      default: return left;\n+    }\n+  }\n \n \t/* (non-Javadoc)\n \t * @see nta.query.executor.eval.Expr#evalBool(nta.storage.Tuple)",
                "raw_url": "https://github.com/apache/tajo/raw/7bacc091f7a3939d540dcea37aca61ba2772b181/engine/src/main/java/nta/engine/exec/eval/BinaryEval.java",
                "sha": "23b60bf36a3e0714156f8472c783bd6e154c339e",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tajo/blob/7bacc091f7a3939d540dcea37aca61ba2772b181/engine/src/main/java/nta/engine/exec/eval/FuncCallEval.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/exec/eval/FuncCallEval.java?ref=7bacc091f7a3939d540dcea37aca61ba2772b181",
                "deletions": 4,
                "filename": "engine/src/main/java/nta/engine/exec/eval/FuncCallEval.java",
                "patch": "@@ -27,9 +27,6 @@\n \t@Expose\n \tprotected EvalNode [] givenArgs;\n \n-\t/**\n-\t * @param type\n-\t */\n \tpublic FuncCallEval(FunctionDesc desc, Function instance, \n \t    EvalNode [] givenArgs) {\n \t\tsuper(Type.FUNCTION);\n@@ -38,9 +35,13 @@ public FuncCallEval(FunctionDesc desc, Function instance,\n \t\tthis.givenArgs = givenArgs;\n \t}\n \t\n-\tpublic EvalNode [] getGivenArgs() {\n+\tpublic EvalNode [] getArgs() {\n \t  return this.givenArgs;\n \t}\n+\n+  public void setArgs(EvalNode [] args) {\n+    this.givenArgs = args;\n+  }\n \t\n \tpublic DataType getValueType() {\n \t\treturn this.desc.getReturnType();",
                "raw_url": "https://github.com/apache/tajo/raw/7bacc091f7a3939d540dcea37aca61ba2772b181/engine/src/main/java/nta/engine/exec/eval/FuncCallEval.java",
                "sha": "179732318a0b6b0dd63bcb1243692bfe2ade23e7",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tajo/blob/7bacc091f7a3939d540dcea37aca61ba2772b181/engine/src/main/java/nta/engine/planner/PlannerUtil.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/planner/PlannerUtil.java?ref=7bacc091f7a3939d540dcea37aca61ba2772b181",
                "deletions": 5,
                "filename": "engine/src/main/java/nta/engine/planner/PlannerUtil.java",
                "patch": "@@ -16,7 +16,6 @@\n import org.apache.commons.logging.LogFactory;\n \n import java.util.ArrayList;\n-import java.util.Collection;\n import java.util.List;\n import java.util.Set;\n \n@@ -154,10 +153,11 @@ public static LogicalNode transformGroupbyTo2P(GroupbyNode gp) {\n         if (targets[i].getEvalTree().getType() == Type.FUNCTION) {\n           Column tobe = child.getOutputSchema().getColumn(i);        \n           FuncCallEval eval = (FuncCallEval) targets[i].getEvalTree();\n-          Collection<Column> tobeChanged = \n-              EvalTreeUtil.findDistinctRefColumns(eval);\n-          EvalTreeUtil.changeColumnRef(eval, tobeChanged.iterator().next(), \n-              tobe);\n+//          Collection<Column> tobeChanged =\n+//              EvalTreeUtil.findDistinctRefColumns(eval);\n+//          EvalTreeUtil.changeColumnRef(eval, tobeChanged.iterator().next(),\n+//              tobe);\n+          eval.setArgs(new EvalNode [] {new FieldEval(tobe)});\n         }\n       }\n       ",
                "raw_url": "https://github.com/apache/tajo/raw/7bacc091f7a3939d540dcea37aca61ba2772b181/engine/src/main/java/nta/engine/planner/PlannerUtil.java",
                "sha": "cd7e1745f178934f3778014262d9cd255b966e84",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/7bacc091f7a3939d540dcea37aca61ba2772b181/engine/src/test/java/nta/engine/exec/eval/TestEvalTreeUtil.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/nta/engine/exec/eval/TestEvalTreeUtil.java?ref=7bacc091f7a3939d540dcea37aca61ba2772b181",
                "deletions": 2,
                "filename": "engine/src/test/java/nta/engine/exec/eval/TestEvalTreeUtil.java",
                "patch": "@@ -64,7 +64,7 @@ public static void setUp() throws Exception {\n     catalog.addTable(desc);\n \n     FunctionDesc funcMeta = new FunctionDesc(\"sum\", TestSum.class,\n-        FunctionType.GENERAL, DataType.INT, \n+        FunctionType.GENERAL, DataType.INT,\n         new DataType [] { DataType.INT, DataType.INT});\n     catalog.registerFunction(funcMeta);\n     \n@@ -76,7 +76,7 @@ public static void setUp() throws Exception {\n     factory = new QueryContext.Factory(catalog);\n     analyzer = new QueryAnalyzer(catalog);\n     \n-    QueryBlock block = null;    \n+    QueryBlock block;\n \n     QueryContext ctx = factory.create();\n     block = (QueryBlock) analyzer.parse(ctx, TestEvalTree.QUERIES[0]);",
                "raw_url": "https://github.com/apache/tajo/raw/7bacc091f7a3939d540dcea37aca61ba2772b181/engine/src/test/java/nta/engine/exec/eval/TestEvalTreeUtil.java",
                "sha": "f2e2d41cb641318b0d31295200091e8f7671e6ea",
                "status": "modified"
            },
            {
                "additions": 30,
                "blob_url": "https://github.com/apache/tajo/blob/7bacc091f7a3939d540dcea37aca61ba2772b181/engine/src/test/java/tajo/engine/TestGroupByQuery.java",
                "changes": 30,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/tajo/engine/TestGroupByQuery.java?ref=7bacc091f7a3939d540dcea37aca61ba2772b181",
                "deletions": 0,
                "filename": "engine/src/test/java/tajo/engine/TestGroupByQuery.java",
                "patch": "@@ -0,0 +1,30 @@\n+package tajo.engine;\n+\n+import org.apache.hadoop.thirdparty.guava.common.collect.Sets;\n+import org.junit.Test;\n+import tajo.client.ResultSetUtil;\n+\n+import java.io.IOException;\n+import java.sql.ResultSet;\n+import java.util.Set;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.assertFalse;\n+\n+/**\n+ * @author Hyunsik Choi\n+ */\n+public class TestGroupByQuery extends TpchTestBase {\n+  public TestGroupByQuery() throws IOException {\n+    super();\n+  }\n+\n+  @Test\n+  public final void testComplexParameter() throws Exception {\n+    ResultSet res = execute(\"select sum(l_extendedprice*l_discount) as revenue from lineitem\");\n+    assertTrue(res.next());\n+    assertTrue(12908 == (int)res.getDouble(\"revenue\"));\n+    assertFalse(res.next());\n+  }\n+}",
                "raw_url": "https://github.com/apache/tajo/raw/7bacc091f7a3939d540dcea37aca61ba2772b181/engine/src/test/java/tajo/engine/TestGroupByQuery.java",
                "sha": "478c8bab77ccd326a3c5021960752ac7b951517b",
                "status": "added"
            }
        ],
        "message": "TAJO-745: an algebraic parameter of some function causes NPE\n\nChange-Id: Id6df3c65bcd05af4c66c60a3d0e93f99be42dff7\nReviewed-on: https://dbserver.korea.ac.kr/reviews/188\nTested-by:  Jenkins <build@dbserver.korea.ac.kr>\nReviewed-by: Hyunsik Choi <hyunsik.choi@gmail.com>",
        "parent": "https://github.com/apache/tajo/commit/a4dc1075913285ad84cf5b3c0ea14548db129d48",
        "patched_files": [
            "PlannerUtil.java",
            "EvalTreeUtil.java",
            "FuncCallEval.java",
            "BinaryEval.java",
            "q6.tql",
            "FloatDatum.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestGroupByQuery.java",
            "TestPlannerUtil.java",
            "TestEvalTreeUtil.java",
            "TestFloatDatum.java"
        ]
    },
    "tajo_7c3dff5": {
        "bug_id": "tajo_7c3dff5",
        "commit": "https://github.com/apache/tajo/commit/7c3dff560575be64d8ca5468fa403fd73013d8ea",
        "file": [
            {
                "additions": 143,
                "blob_url": "https://github.com/apache/tajo/blob/7c3dff560575be64d8ca5468fa403fd73013d8ea/engine/src/main/java/nta/storage/RawFile2.java",
                "changes": 306,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/storage/RawFile2.java?ref=7c3dff560575be64d8ca5468fa403fd73013d8ea",
                "deletions": 163,
                "filename": "engine/src/main/java/nta/storage/RawFile2.java",
                "patch": "@@ -54,17 +54,27 @@ public Scanner openScanner(Schema schema, Fragment[] tablets)\n   public static int SYNC_INTERVAL;\n \n   public static class RawFileScanner extends FileScanner {\n-\t  \n     private FSDataInputStream in;\n     private SortedSet<Fragment> tabletSet;\n     private Iterator<Fragment> tableIter;\n     private Fragment curTablet;\n     private FileSystem fs;\n     private byte[] sync;\n     private byte[] checkSync;\n-    private long start, end, headerPos, lastSyncPos; \n+    private long start, end;\n+    private long startPos, headerPos, lastSyncPos; \n+    private long pageStart, pageLen;\n+    private long curTupleOffset;\n     private Options option;\n-    private long currentTupleOffset;\n+    \n+    private byte[] buf;\n+    private byte[] extra;\n+    private byte[] bufextra;\n+    private int bufSize, extraSize;\n+    private final static int DEFAULT_BUFFER_SIZE = 65536;\n+    \n+    private ByteArrayInputStream bin;\n+    private DataInputStream din;     \n \n     public RawFileScanner(Configuration conf, final Schema schema, \n         final Fragment[] tablets) throws IOException {\n@@ -80,10 +90,14 @@ public RawFileScanner(Configuration conf, final Schema schema,\n     }\n \n     private void init() throws IOException {\n-      this.tabletSet = new TreeSet<Fragment>();\n+      // set default page size.\n+      this.bufSize = DEFAULT_BUFFER_SIZE;\n+      \n       this.sync = new byte[SYNC_HASH_SIZE];\n       this.checkSync = new byte[SYNC_HASH_SIZE];\n \n+      // set tablet iterator.\n+      this.tabletSet = new TreeSet<Fragment>();\n       for (Fragment t: tablets) {\n         this.tabletSet.add(t);\n       }\n@@ -95,19 +109,41 @@ private boolean openNextTablet() throws IOException {\n       if (this.in != null) {\n         this.in.close();\n       }\n+      \n+      // set tablet information.\n       if (tableIter.hasNext()) {\n         curTablet = tableIter.next();\n         this.fs = curTablet.getPath().getFileSystem(this.conf);\n         this.in = fs.open(curTablet.getPath());\n         this.start = curTablet.getStartOffset();\n         this.end = curTablet.getStartOffset() + curTablet.getLength();\n-\n-        if (start == 0) { // read sync maker.\n-          readHeader();\n+        \n+        readHeader();\n+        // set correct start offset.\n+        headerPos = in.getPos();\n+        if (start < headerPos) {\n+          in.seek(headerPos);\n+        } else {\n+          in.seek(start);\n         }\n-        if (!pageBuffer()) {\n-          return false;\n+        if (in.getPos() != headerPos) {\n+          in.seek(in.getPos()-SYNC_SIZE);\n+          while(in.getPos() < end) {\n+            if (checkSync()) {\n+              lastSyncPos = in.getPos();\n+              break;\n+            } else {\n+              in.seek(in.getPos()+1);\n+            }\n+          }\n         }\n+        startPos = in.getPos();\n+        \n+        if (in.getPos() >= end)\n+          if (!openNextTablet())\n+            return false;\n+        \n+        pageBuffer();\n         return true;\n       } else {\n         return false;\n@@ -121,7 +157,7 @@ private void readHeader() throws IOException {\n     }\n \n     private boolean checkSync() throws IOException {\n-      in.readInt(); // escape\n+      in.readInt();                           // escape\n       in.read(checkSync, 0, SYNC_HASH_SIZE);  // sync\n       if (!Arrays.equals(checkSync, sync)) {\n         in.seek(in.getPos()-SYNC_SIZE);\n@@ -130,145 +166,100 @@ private boolean checkSync() throws IOException {\n         return true;\n       }\n     }\n-\n-    private long pageStart, pageLen;\n-    private int tupleSize, pieceSize1, pieceSize2, bufferSize, defaultSize = 65536;\n-    private byte[] buffer;\n-    ByteArrayInputStream in_byte;\n-    DataInputStream in_buffer;     \n-    private boolean pageBuffer() throws IOException {      \n-      if (in.getPos() - SYNC_SIZE == start) { // first.\n-        tupleSize = checkTupleSize();\n-        if(defaultSize > tabletable()) {\n-        \tbuffer = new byte[(int)(tabletable())];\n-        } else {\n-        \tbuffer = new byte[defaultSize];\n-        }\n-        pageStart = in.getPos();\n-        in.read(buffer);\n-      } else if (in_buffer.available() > 0 || tabletable() > 0) { // tuple \uc774 \uc798\ub9bc.\n-        pieceSize1 = in_buffer.available();      \n-        pieceSize2 = (int)tabletable();\n-\n-        if (pieceSize1 + pieceSize2 < defaultSize) {\n-          bufferSize = pieceSize1 + pieceSize2;\n-          buffer = new byte[bufferSize];\n-          in_buffer.read(buffer, 0, pieceSize1);\n-          pageStart = in.getPos() - pieceSize1;\n-          in.read(buffer, pieceSize1, pieceSize2);\n-        } else {\n-          bufferSize = defaultSize;\n-          buffer = new byte[bufferSize];\n-          in_buffer.read(buffer, 0, pieceSize1);\n-          pageStart = in.getPos() - pieceSize1;\n-          in.read(buffer, pieceSize1, (bufferSize - pieceSize1));\n-        }\n+    \n+    private boolean checkSyncinPage() throws IOException {\n+      din.mark(1);\n+      din.readInt();                           // escape\n+      din.read(checkSync, 0, SYNC_HASH_SIZE);  // sync\n+      if (!Arrays.equals(checkSync, sync)) {\n+        din.reset();\n+        return false;\n       } else {\n-        if (!openNextTablet()) {  // last.\n-          return false;\n-        }\n+        return true;\n       }\n-      pageLen = buffer.length;\n-      in_byte = new ByteArrayInputStream(buffer);\n-      in_buffer = new DataInputStream(in_byte);\n-      this.currentTupleOffset = 0;\n-//      checkSyncinPage();\n-      return true;\n     }\n-\n-    private boolean checkSyncinPage() throws IOException {  // page buffer \uc548\uc758 sync maker \ub97c \ud655\uc778.\n-      in_buffer.mark(1);\n-      in_buffer.readInt();  // escape\n-      in_buffer.read(checkSync, 0, SYNC_HASH_SIZE);  // sync\n-      if (!Arrays.equals(checkSync, sync)) {\n-        in_buffer.reset();\n+    \n+    private boolean pageBuffer() throws IOException {\n+      if (tabletable() < 1) {\n+        // initialize.\n+        this.curTupleOffset = 0;\n+        this.bufSize = DEFAULT_BUFFER_SIZE;\n         return false;\n+      }\n+      \n+      // set buffer size.\n+      if (tabletable() <= bufSize) {\n+        bufSize = (int) tabletable();\n       } else {\n-        return true;\n+        bufSize = DEFAULT_BUFFER_SIZE;\n       }\n+      \n+      buf = new byte[bufSize];\n+      pageStart = in.getPos();\n+      in.read(buf);\n+      \n+      checkSyncMarker();\n+      bufextra = new byte[bufSize + extraSize];\n+      System.arraycopy(buf, 0, bufextra, 0, bufSize);\n+      if (extraSize > 0)\n+        System.arraycopy(extra, 0, bufextra, bufSize, extraSize);\n+      \n+      pageLen = bufextra.length;\n+      bin = new ByteArrayInputStream(bufextra);\n+      din = new DataInputStream(bin);\n+      this.curTupleOffset = 0;\n+     \n+      return true;\n     }\n-\n-    private int checkTupleSize() throws IOException { // raw type \uc740 tuple \uc0ac\uc774\ub97c \uad6c\ubd84 \ud560 \uc218 \uc5c6\uc73c\ubbc0\ub85c, tuple size \ub97c \uc608\uce21\ud574\uc11c tuple \uad6c\ubd84\uc744 \ud568.\n+    \n+    private void checkSyncMarker() throws IOException {\n+      long mark = in.getPos();\n       int i;\n-      long before = in.getPos();\n-\n-      boolean [] contains = new boolean[schema.getColumnNum()];\n-      for (i = 0; i < schema.getColumnNum(); i++) {\n-        contains[i] = in.readBoolean();\n+      in.seek(in.getPos()-SYNC_SIZE);\n+      for (i = 1; in.available() != 0; i++) {\n+        if (!checkSync())\n+          in.seek(in.getPos()+1);\n+        else break;\n       }\n \n-      Column col = null;\n-      for (i = 0; i < schema.getColumnNum(); i++) {\n-        if (contains[i]) {\n-          col = schema.getColumn(i);\n-          switch (col.getDataType()) {\n-          case BYTE:\n-            in.readByte();\n-            break;\n-          case SHORT:\n-            in.readShort();\n-            break;\n-          case INT:\n-            in.readInt();\n-            break;\n-          case LONG:\n-            in.readLong();\n-            break;\n-          case FLOAT:\n-            in.readFloat();\n-            break;\n-          case DOUBLE:\n-            in.readDouble();\n-            break;\n-          case STRING:\n-            short len = in.readShort();\n-            byte[] buf = new byte[len];\n-            in.read(buf, 0, len);\n-            break;\n-          case IPv4:\n-            byte[] ipv4 = new byte[4];\n-            in.read(ipv4, 0, 4);\n-            break;\n-          default:\n-            break;\n-          }\n-        }\n-      }\n-      long after = in.getPos();\n-      in.seek(before);\n-      return (int) (after - before);\n+      in.seek(mark);\n+      if (i > 1) {\n+        extra = new byte[i - 1];\n+        in.read(extra);\n+        extraSize = extra.length;\n+      } else extraSize = 0;\n     }\n \n     @Override\n     public void seek(long offset) throws IOException {\n-    \tif ( offset >= this.pageStart + this.pageLen  ||\n+    \tif (offset >= this.pageStart + this.pageLen  ||\n     \t\t\toffset < this.pageStart) {\n     \t\tin.seek(offset);\n-    \t\tin_byte.close();\n-    \t\tin_buffer.close();\n-    \t\tin_byte = new ByteArrayInputStream(new byte[0]);\n-    \t    in_buffer = new DataInputStream(in_byte);\n+    \t\tbin.close();\n+    \t\tdin.close();\n+    \t\tbin = new ByteArrayInputStream(new byte[0]);\n+    \t\tdin = new DataInputStream(bin);\n     \t\tpageBuffer();\n     \t} else {\n     \t\tlong bufferOffset = offset - this.pageStart;\n-    \t\tif(this.currentTupleOffset == bufferOffset) {\n+    \t\tif(this.curTupleOffset == bufferOffset) {\n     \t\t\t\n-    \t\t} else if( this.currentTupleOffset < bufferOffset) {\n-    \t\t\tin_buffer.skip(bufferOffset - this.currentTupleOffset);\n-    \t\t\tthis.currentTupleOffset = bufferOffset;\n+    \t\t} else if( this.curTupleOffset < bufferOffset) {\n+    \t\t  din.skip(bufferOffset - this.curTupleOffset);\n+    \t\t\tthis.curTupleOffset = bufferOffset;\n     \t\t} else {\n-    \t\t\tin_buffer.close();\n-    \t\t\tin_byte.close();\n-    \t\t\tin_byte = new ByteArrayInputStream(buffer);\n-    \t\t\tin_buffer = new DataInputStream(in_byte);\n-    \t\t\tthis.currentTupleOffset = bufferOffset;\n+    \t\t  din.close();\n+    \t\t\tbin.close();\n+    \t\t\tbin = new ByteArrayInputStream(bufextra);\n+    \t\t\tdin = new DataInputStream(bin);\n+    \t\t\tthis.curTupleOffset = bufferOffset;\n     \t\t}\n     \t}\n     }\n     \n     @Override\n     public long getNextOffset() {\n-    \treturn this.pageStart + this.currentTupleOffset;\n+    \treturn this.pageStart + this.curTupleOffset;\n     }\n     \n     @Override\n@@ -278,37 +269,26 @@ public long tabletable() throws IOException{\n     \n     @Override\n     public Tuple next() throws IOException {\n-      if (in_buffer.available() == 0) { // page buffer \ub2e4 \uc77d\uc74c.\n-        if (!pageBuffer()) {\n-          return null;\n-        }       \n-      }\n-      if (in_buffer.available() < tupleSize) {  // tuple \uc798\ub9b4 \uac83\uc784. \n-        if (!pageBuffer()) {\n-          return null;\n-        }\n-      }\n-      if (checkSyncinPage()) {  // page buffer \uc5d0 sync maker \uac00 \uc788\ub294\uc9c0 \ud655\uc778.\n-    \tthis.currentTupleOffset += SYNC_SIZE;  \n-        if (in_buffer.available() == 0) { // sync maker \uc77d\uc5c8\ub354\ub2c8 page buffer \ub2e4 \uc77d\uc74c.\n-          if (!pageBuffer()) {\n+      if (din.available() < 1) {\n+        if (!pageBuffer()) \n+          if (!openNextTablet())\n             return null;\n-          }\n-        }\n-        if (in_buffer.available() < tupleSize) { // sync maker \uc77d\uc5c8\ub354\ub2c8 tuple \uc798\ub9b4 \uac83\uc784.\n-          if (!pageBuffer()) {\n+      }\n+      if (checkSyncinPage())\n+        this.curTupleOffset += SYNC_SIZE;\n+      if (din.available() < 1) {\n+        if (!pageBuffer()) \n+          if (!openNextTablet())\n             return null;\n-          }\n-        }\n       }\n-\n+      \n       int i;\n       VTuple tuple = new VTuple(schema.getColumnNum());\n \n       boolean [] contains = new boolean[schema.getColumnNum()];\n       for (i = 0; i < schema.getColumnNum(); i++) {\n-        contains[i] = in_buffer.readBoolean();\n-        this.currentTupleOffset += DatumFactory.createBool(true).size();\n+        contains[i] = din.readBoolean();\n+        this.curTupleOffset += DatumFactory.createBool(true).size();\n       }\n       Column col = null;\n       for (i = 0; i < schema.getColumnNum(); i++) {\n@@ -317,49 +297,49 @@ public Tuple next() throws IOException {\n           col = schema.getColumn(i);\n           switch (col.getDataType()) {\n           case BYTE:\n-        \tdatum = DatumFactory.createByte(in_buffer.readByte());\n-        \tthis.currentTupleOffset += datum.size();\n+        \tdatum = DatumFactory.createByte(din.readByte());\n+        \tthis.curTupleOffset += datum.size();\n             tuple.put(i, datum );\n             break;\n           case SHORT:\n-        \tdatum = DatumFactory.createShort(in_buffer.readShort());\n-        \tthis.currentTupleOffset += datum.size();\n+        \tdatum = DatumFactory.createShort(din.readShort());\n+        \tthis.curTupleOffset += datum.size();\n             tuple.put(i, datum );\n             break;\n           case INT:\n-            datum = DatumFactory.createInt(in_buffer.readInt());\n-        \tthis.currentTupleOffset += datum.size();\n+            datum = DatumFactory.createInt(din.readInt());\n+        \tthis.curTupleOffset += datum.size();\n             tuple.put(i, datum );\n             break;\n           case LONG:\n-        \tdatum = DatumFactory.createLong(in_buffer.readLong());   \n-        \tthis.currentTupleOffset += datum.size();  \n+        \tdatum = DatumFactory.createLong(din.readLong());   \n+        \tthis.curTupleOffset += datum.size();  \n             tuple.put(i, datum );\n             break;\n           case FLOAT:\n-        \tdatum = DatumFactory.createFloat(in_buffer.readFloat());  \n-        \tthis.currentTupleOffset += datum.size();  \n+        \tdatum = DatumFactory.createFloat(din.readFloat());  \n+        \tthis.curTupleOffset += datum.size();  \n             tuple.put(i, datum);\n             break;\n           case DOUBLE:\n-        \tdatum = DatumFactory.createDouble(in_buffer.readDouble());\n-        \tthis.currentTupleOffset += datum.size();\n+        \tdatum = DatumFactory.createDouble(din.readDouble());\n+        \tthis.curTupleOffset += datum.size();\n             tuple.put(i, datum);\n             break;\n           case STRING:\n-        \tthis.currentTupleOffset += DatumFactory.createShort((short)0).size();  \n-            short len = in_buffer.readShort();\n+        \tthis.curTupleOffset += DatumFactory.createShort((short)0).size();  \n+            short len = din.readShort();\n             byte[] buf = new byte[len];\n-            in_buffer.read(buf, 0, len);\n+            din.read(buf, 0, len);\n             datum = DatumFactory.createString(new String(buf));\n-            this.currentTupleOffset += datum.size();\n+            this.curTupleOffset += datum.size();\n             tuple.put(i, datum);\n             break;\n           case IPv4:\n         \tbyte[] ipv4 = new byte[4];\n-            in_buffer.read(ipv4, 0, 4);\n+            din.read(ipv4, 0, 4);\n             datum = DatumFactory.createIPv4(ipv4);\n-            this.currentTupleOffset += datum.size();\n+            this.curTupleOffset += datum.size();\n             tuple.put(i, datum);\n             break;\n           default:",
                "raw_url": "https://github.com/apache/tajo/raw/7c3dff560575be64d8ca5468fa403fd73013d8ea/engine/src/main/java/nta/storage/RawFile2.java",
                "sha": "57bd988d1eef692ece0efb1efb0b6a31cfc7ae3b",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tajo/blob/7c3dff560575be64d8ca5468fa403fd73013d8ea/engine/src/test/java/nta/storage/TestIndex.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/nta/storage/TestIndex.java?ref=7c3dff560575be64d8ca5468fa403fd73013d8ea",
                "deletions": 0,
                "filename": "engine/src/test/java/nta/storage/TestIndex.java",
                "patch": "@@ -87,6 +87,7 @@ public void testsearchEQLValueInCSVcol0() throws IOException {\n \t\t\tassertTrue(\"[seek check \" + i + \" ]\" , i == (tuple.get(0).asInt()));\n \t\t}\n \t}\n+\t\n \t@Test\n \tpublic void testsearchGTHValueInCSVcol1() throws IOException {\n \t\t\n@@ -125,6 +126,7 @@ public void testsearchGTHValueInCSVcol1() throws IOException {\n       assertTrue(\"[seek check \" + (i + 1) + \" ]\" , (i + 1) == (tuple.get(1).asLong()));\n \t\t}\n \t}\n+\t\n \t@Test\n \tpublic void testsearchEQLValueInCSVcol2() throws IOException {\n \t\t\n@@ -163,6 +165,7 @@ public void testsearchEQLValueInCSVcol2() throws IOException {\n       assertTrue(\"[seek check \" + i + \" ]\" , i  == (tuple.get(2).asDouble()));\n \t\t}\n \t}\n+\t\n \t@Test\n \tpublic void testsearchGTHValueInCSVcol3() throws IOException {\n \t\t\n@@ -201,6 +204,7 @@ public void testsearchGTHValueInCSVcol3() throws IOException {\n       assertTrue(\"[seek check \" + (i + 1) + \" ]\" , (i + 1 ) == (tuple.get(3).asFloat()));\n \t\t}\n \t}\n+\t\n \t@Test\n \tpublic void testRandomSearchEQLValueInCSVCol0 () throws IOException {\n \t  meta = new TableMetaImpl();\n@@ -251,6 +255,7 @@ public void testRandomSearchEQLValueInCSVCol0 () throws IOException {\n     }\n \t  \n \t}\n+\t\n \t@Test\n \tpublic void testSearchEQLValueInRawCol0() throws IOException {\n \t\tmeta = new TableMetaImpl();",
                "raw_url": "https://github.com/apache/tajo/raw/7c3dff560575be64d8ca5468fa403fd73013d8ea/engine/src/test/java/nta/storage/TestIndex.java",
                "sha": "16e852ce4a8f3f977c513e6e0202b21131ae0d1e",
                "status": "modified"
            },
            {
                "additions": 114,
                "blob_url": "https://github.com/apache/tajo/blob/7c3dff560575be64d8ca5468fa403fd73013d8ea/engine/src/test/java/nta/storage/TestRawFile2.java",
                "changes": 135,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/nta/storage/TestRawFile2.java?ref=7c3dff560575be64d8ca5468fa403fd73013d8ea",
                "deletions": 21,
                "filename": "engine/src/test/java/nta/storage/TestRawFile2.java",
                "patch": "@@ -16,6 +16,7 @@\n import nta.engine.ipc.protocolrecords.Fragment;\n \n import org.apache.hadoop.fs.FileStatus;\n+import org.apache.hadoop.fs.Path;\n import org.junit.Before;\n import org.junit.Test;\n \n@@ -36,46 +37,138 @@ public void setUp() throws Exception {\n   public void testRawFile() throws IOException {\n     Schema schema = new Schema();\n     schema.addColumn(\"id\", DataType.INT);\n-    schema.addColumn(\"name\", DataType.STRING);\n-    schema.addColumn(\"age\", DataType.INT);\n-    schema.addColumn(\"blood\", DataType.STRING);\n-    schema.addColumn(\"country\", DataType.STRING);\n-    schema.addColumn(\"region\", DataType.STRING);\n+    schema.addColumn(\"age\", DataType.LONG);\n     \n     TableMeta meta = new TableMetaImpl();\n     meta.setSchema(schema);\n     meta.setStorageType(StoreType.RAW);\n     \n     sm.initTableBase(meta, \"table1\");\n-    \n+    Appender appender = sm.getAppender(meta, \"table1\", \"file1\");\n     int tupleNum = 10000;\n-    VTuple tuple = null;\n-    Appender appender = sm.getAppender(meta, \"table1\",\"file1\");\n-    for (int i = 0; i < tupleNum; i++) {\n-      tuple = new VTuple(6);\n-      tuple.put(0, DatumFactory.createInt((Integer)(i+1)));\n-      tuple.put(1, DatumFactory.createString(\"haemi\"));\n-      tuple.put(2, DatumFactory.createInt(25));\n-      tuple.put(3, DatumFactory.createString(\"a\"));\n-      tuple.put(4, DatumFactory.createString(\"korea\"));\n-      tuple.put(5, DatumFactory.createString(\"sanbon\"));\n-      appender.addTuple(tuple);\n+    VTuple vTuple = null;\n+    \n+    for(int i = 0; i < tupleNum; i++) {\n+      vTuple = new VTuple(2);\n+      vTuple.put(0, DatumFactory.createInt((Integer)(i+1)));\n+      vTuple.put(1, DatumFactory.createLong(25l));\n+      appender.addTuple(vTuple);\n     }\n     appender.close();\n     \n     FileStatus status = sm.listTableFiles(\"table1\")[0];\n     long fileLen = status.getLen();\n-  \n-    Fragment[] tablets = new Fragment[1];\n-    tablets[0] = new Fragment(\"table1_1\", status.getPath(), meta, 0, fileLen);    \n+    long randomNum = (long) (Math.random() * fileLen) + 1;\n     \n+    Fragment[] tablets = new Fragment[2];\n+    tablets[0] = new Fragment(\"tablet1_1\", status.getPath(), meta, 0, randomNum);\n+    tablets[1] = new Fragment(\"tablet1_2\", status.getPath(), meta, randomNum, (fileLen - randomNum));\n+\n     Scanner scanner = sm.getScanner(meta, tablets);\n     int tupleCnt = 0;\n-    while ((tuple = (VTuple) scanner.next()) != null) {\n+    while ((vTuple = (VTuple) scanner.next()) != null) {\n       tupleCnt++;\n     }\n     scanner.close();    \n     \n     assertEquals(tupleNum, tupleCnt);\n \t}\n+\t\n+\t@Test\n+  public void testForSingleFile() throws IOException {\n+    Schema schema = new Schema();\n+    schema.addColumn(\"id\", DataType.INT);\n+    schema.addColumn(\"age\", DataType.LONG);\n+    \n+    TableMeta meta = new TableMetaImpl();\n+    meta.setSchema(schema);\n+    meta.setStorageType(StoreType.RAW);\n+    \n+    sm.initTableBase(meta, \"table1\");\n+    Appender appender = sm.getAppender(meta, \"table1\", \"file1\");\n+    int tupleNum = 10000;\n+    VTuple vTuple = null;\n+    \n+    for(int i = 0; i < tupleNum; i++) {\n+      vTuple = new VTuple(2);\n+      vTuple.put(0, DatumFactory.createInt((Integer)(i+1)));\n+      vTuple.put(1, DatumFactory.createLong(25l));\n+      appender.addTuple(vTuple);\n+    }\n+    appender.close();\n+    \n+    // Read a table composed of multiple files\n+    FileStatus status = sm.listTableFiles(\"table1\")[0];\n+    long fileLen = status.getLen();\n+    long randomNum = (long) (Math.random() * fileLen) + 1;\n+    \n+    Fragment[] tablets = new Fragment[3];\n+    tablets[0] = new Fragment(\"tablet1_1\", status.getPath(), meta, 0, randomNum/2);\n+    tablets[1] = new Fragment(\"tablet1_2\", status.getPath(), meta, randomNum/2, (randomNum - randomNum/2));\n+    tablets[2] = new Fragment(\"tablet1_2\", status.getPath(), meta, randomNum, (fileLen - randomNum));\n+\n+    Scanner scanner = sm.getScanner(meta, tablets);\n+    int tupleCnt = 0;\n+    while ((vTuple = (VTuple) scanner.next()) != null) {\n+      tupleCnt++;\n+    }\n+    scanner.close();   \n+    \n+    assertEquals(tupleNum, tupleCnt);\n+  }\n+  \n+  @Test\n+  public void testForMultiFile() throws IOException {\n+    Schema schema = new Schema();\n+    schema.addColumn(\"id\", DataType.INT);\n+    schema.addColumn(\"age\", DataType.LONG);\n+    \n+    TableMeta meta = new TableMetaImpl();\n+    meta.setSchema(schema);\n+    meta.setStorageType(StoreType.RAW);\n+    \n+    sm.initTableBase(meta, \"table1\");\n+    Appender appender = sm.getAppender(meta, \"table1\", \"file1\");\n+    int tupleNum = 10000;\n+    VTuple vTuple = null;\n+    \n+    for(int i = 0; i < tupleNum; i++) {\n+      vTuple = new VTuple(2);\n+      vTuple.put(0, DatumFactory.createInt((Integer)(i+1)));\n+      vTuple.put(1, DatumFactory.createLong(25l));\n+      appender.addTuple(vTuple);\n+    }\n+    appender.close();\n+    \n+    appender = sm.getAppender(meta, \"table1\", \"file2\");\n+    for(int i = 0; i < tupleNum; i++) {\n+      vTuple = new VTuple(2);\n+      vTuple.put(0, DatumFactory.createInt((Integer)(i+1000)));\n+      vTuple.put(1, DatumFactory.createLong(25l));\n+      appender.addTuple(vTuple);\n+    }\n+    appender.close();\n+\n+    FileStatus[] status = sm.listTableFiles(\"table1\");\n+    long fileLen = status[0].getLen();\n+    long randomNum = (long) (Math.random() * fileLen) + 1;\n+\n+    Fragment[] tablets = new Fragment[4];\n+    tablets[0] = new Fragment(\"tablet1_1\", status[0].getPath(), meta, 0, randomNum);\n+    tablets[1] = new Fragment(\"tablet1_2\", status[0].getPath(), meta, randomNum, (fileLen - randomNum));\n+    \n+    fileLen = status[1].getLen();\n+    randomNum = (long) (Math.random() * fileLen) + 1;\n+    tablets[2] = new Fragment(\"tablet1_2\", status[1].getPath(), meta, 0, randomNum);\n+    tablets[3] = new Fragment(\"tablet1_2\", status[1].getPath(), meta, randomNum, (fileLen - randomNum));\n+    \n+    Scanner scanner = sm.getScanner(meta, tablets);\n+    int tupleCnt = 0;\n+    while ((vTuple = (VTuple) scanner.next()) != null) {\n+      tupleCnt++;\n+    }\n+    scanner.close();   \n+    \n+    assertEquals(tupleNum*2, tupleCnt);\n+  }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/7c3dff560575be64d8ca5468fa403fd73013d8ea/engine/src/test/java/nta/storage/TestRawFile2.java",
                "sha": "06c3d68a348b462a32cd503c9139112923dddf0e",
                "status": "modified"
            }
        ],
        "message": "TAJO-460 : RawFile fragment\ub97c \uc911\uac04\ubd80\ud130 \uc77d\uc744 \uc2dc NullPointerException \ubc1c\uc0dd\n\nChange-Id: Ie0005242087b6b4e1dd040c952b92e5c69880744\nReviewed-on: https://dbserver.korea.ac.kr/reviews/9\nTested-by: Hyunsik Choi <hyunsik.choi@gmail.com>\nReviewed-by: Hyunsik Choi <hyunsik.choi@gmail.com>\nReviewed-by:  jihoon <jihoonson@korea.ac.kr>",
        "parent": "https://github.com/apache/tajo/commit/fe0342753c517964b9c8f4c13a0a6212d6e72537",
        "patched_files": [
            "RawFile2.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestIndex.java",
            "TestRawFile2.java"
        ]
    },
    "tajo_83228ce": {
        "bug_id": "tajo_83228ce",
        "commit": "https://github.com/apache/tajo/commit/83228ce670370e7a8b2fa74c8683b8f1bd7b0ae3",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/83228ce670370e7a8b2fa74c8683b8f1bd7b0ae3/CHANGES",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=83228ce670370e7a8b2fa74c8683b8f1bd7b0ae3",
                "deletions": 0,
                "filename": "CHANGES",
                "patch": "@@ -188,6 +188,8 @@ Release 0.11.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-1697: RCFile progress causes NPE occasionally. (jinho)\n+\n     TAJO-1689: Metrics file reporter prints histogram metric without group name.\n     (hyunsik)\n ",
                "raw_url": "https://github.com/apache/tajo/raw/83228ce670370e7a8b2fa74c8683b8f1bd7b0ae3/CHANGES",
                "sha": "aef8235c12dce4e380e9f26a10dbf9cb1e311e4c",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/83228ce670370e7a8b2fa74c8683b8f1bd7b0ae3/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/rcfile/RCFile.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/rcfile/RCFile.java?ref=83228ce670370e7a8b2fa74c8683b8f1bd7b0ae3",
                "deletions": 0,
                "filename": "tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/rcfile/RCFile.java",
                "patch": "@@ -1651,6 +1651,8 @@ public Tuple next() throws IOException {\n \n     @Override\n     public float getProgress() {\n+      if(!inited) return super.getProgress();\n+\n       try {\n         if(!more) {\n           return 1.0f;",
                "raw_url": "https://github.com/apache/tajo/raw/83228ce670370e7a8b2fa74c8683b8f1bd7b0ae3/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/rcfile/RCFile.java",
                "sha": "99c727c527259d209dee2d8af9a5a434c7a27633",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/83228ce670370e7a8b2fa74c8683b8f1bd7b0ae3/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/text/DelimitedTextFile.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/text/DelimitedTextFile.java?ref=83228ce670370e7a8b2fa74c8683b8f1bd7b0ae3",
                "deletions": 0,
                "filename": "tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/text/DelimitedTextFile.java",
                "patch": "@@ -359,6 +359,8 @@ public TextLineSerDe getLineSerde() {\n \n     @Override\n     public float getProgress() {\n+      if(!inited) return super.getProgress();\n+\n       try {\n         if (!reader.isReadable()) {\n           return 1.0f;",
                "raw_url": "https://github.com/apache/tajo/raw/83228ce670370e7a8b2fa74c8683b8f1bd7b0ae3/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/text/DelimitedTextFile.java",
                "sha": "4a691df3a75c0f84bbbdac3f171c72775b979e55",
                "status": "modified"
            }
        ],
        "message": "TAJO-1697: RCFile progress causes NPE occasionally. (jinho)\n\nCloses #641",
        "parent": "https://github.com/apache/tajo/commit/1706746cee6dc51f5013aa46f14db0fcfffd1728",
        "patched_files": [
            "DelimitedTextFile.java",
            "CHANGES"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestDelimitedTextFile.java"
        ]
    },
    "tajo_8967d11": {
        "bug_id": "tajo_8967d11",
        "commit": "https://github.com/apache/tajo/commit/8967d113571fe72131433e39753e41c35abe2297",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/8967d113571fe72131433e39753e41c35abe2297/CHANGES",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=8967d113571fe72131433e39753e41c35abe2297",
                "deletions": 0,
                "filename": "CHANGES",
                "patch": "@@ -163,6 +163,8 @@ Release 0.9.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-1104: Using asterisk with GROUP BY causes NPE. (hyunsik)\n+\n     TAJO-1099: LogicalPlanner::convertDataType causes NPE in some cases.\n     (hyunsik)\n ",
                "raw_url": "https://github.com/apache/tajo/raw/8967d113571fe72131433e39753e41c35abe2297/CHANGES",
                "sha": "cc2b8b8c7a6379366cf341ed24f110907264e0eb",
                "status": "modified"
            },
            {
                "additions": 22,
                "blob_url": "https://github.com/apache/tajo/blob/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/main/java/org/apache/tajo/engine/planner/LogicalPlanPreprocessor.java",
                "changes": 35,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/planner/LogicalPlanPreprocessor.java?ref=8967d113571fe72131433e39753e41c35abe2297",
                "deletions": 13,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/planner/LogicalPlanPreprocessor.java",
                "patch": "@@ -148,15 +148,29 @@ public LogicalNode postHook(LogicalPlanner.PlanContext ctx, Stack<Expr> stack, E\n     return newTargetExprs;\n   }\n \n-  private static boolean hasAsterisk(Projection projection) {\n-    for (NamedExpr eachTarget : projection.getNamedExprs()) {\n+  private static boolean hasAsterisk(NamedExpr [] namedExprs) {\n+    for (NamedExpr eachTarget : namedExprs) {\n       if (eachTarget.getExpr().getType() == OpType.Asterisk) {\n         return true;\n       }\n     }\n     return false;\n   }\n \n+  private static NamedExpr [] voidResolveAsteriskNamedExpr(LogicalPlanner.PlanContext context,\n+                                                           NamedExpr [] namedExprs) throws PlanningException {\n+    List<NamedExpr> rewrittenTargets = TUtil.newList();\n+    for (NamedExpr originTarget : namedExprs) {\n+      if (originTarget.getExpr().getType() == OpType.Asterisk) {\n+        // rewrite targets\n+        rewrittenTargets.addAll(resolveAsterisk(context, (QualifiedAsteriskExpr) originTarget.getExpr()));\n+      } else {\n+        rewrittenTargets.add(originTarget);\n+      }\n+    }\n+    return rewrittenTargets.toArray(new NamedExpr[rewrittenTargets.size()]);\n+  }\n+\n   @Override\n   public LogicalNode visitProjection(LogicalPlanner.PlanContext ctx, Stack<Expr> stack, Projection expr)\n       throws PlanningException {\n@@ -171,17 +185,8 @@ public LogicalNode visitProjection(LogicalPlanner.PlanContext ctx, Stack<Expr> s\n     LogicalNode child = visit(ctx, stack, expr.getChild());\n \n     // Resolve the asterisk expression\n-    if (hasAsterisk(expr)) {\n-      List<NamedExpr> rewrittenTargets = TUtil.newList();\n-      for (NamedExpr originTarget : expr.getNamedExprs()) {\n-        if (originTarget.getExpr().getType() == OpType.Asterisk) {\n-          // rewrite targets\n-          rewrittenTargets.addAll(resolveAsterisk(ctx, (QualifiedAsteriskExpr) originTarget.getExpr()));\n-        } else {\n-          rewrittenTargets.add(originTarget);\n-        }\n-      }\n-      expr.setNamedExprs(rewrittenTargets.toArray(new NamedExpr[rewrittenTargets.size()]));\n+    if (hasAsterisk(expr.getNamedExprs())) {\n+      expr.setNamedExprs(voidResolveAsteriskNamedExpr(ctx, expr.getNamedExprs()));\n     }\n \n     NamedExpr[] projectTargetExprs = expr.getNamedExprs();\n@@ -278,6 +283,10 @@ public LogicalNode visitGroupBy(LogicalPlanner.PlanContext ctx, Stack<Expr> stac\n     int finalTargetNum = projection.getNamedExprs().length;\n     Target [] targets = new Target[finalTargetNum];\n \n+    if (hasAsterisk(projection.getNamedExprs())) {\n+      projection.setNamedExprs(voidResolveAsteriskNamedExpr(ctx, projection.getNamedExprs()));\n+    }\n+\n     for (int i = 0; i < finalTargetNum; i++) {\n       NamedExpr namedExpr = projection.getNamedExprs()[i];\n       EvalNode evalNode = annotator.createEvalNode(ctx, namedExpr.getExpr(), NameResolvingMode.SUBEXPRS_AND_RELS);",
                "raw_url": "https://github.com/apache/tajo/raw/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/main/java/org/apache/tajo/engine/planner/LogicalPlanPreprocessor.java",
                "sha": "93389798ff05fdcbc159e7d0685a2c99fb2e32ce",
                "status": "modified"
            },
            {
                "additions": 14,
                "blob_url": "https://github.com/apache/tajo/blob/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/main/java/org/apache/tajo/engine/planner/LogicalPlanVerifier.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/planner/LogicalPlanVerifier.java?ref=8967d113571fe72131433e39753e41c35abe2297",
                "deletions": 0,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/planner/LogicalPlanVerifier.java",
                "patch": "@@ -183,6 +183,20 @@ public LogicalNode visitIntersect(Context context, LogicalPlan plan, LogicalPlan\n     return node;\n   }\n \n+  @Override\n+  public LogicalNode visitTableSubQuery(Context context, LogicalPlan plan, LogicalPlan.QueryBlock block,\n+                                   TableSubQueryNode node, Stack<LogicalNode> stack) throws PlanningException {\n+    super.visitTableSubQuery(context, plan, block, node, stack);\n+    if (node.hasTargets()) {\n+      for (Target target : node.getTargets()) {\n+        ExprsVerifier.verify(context.state, node, target.getEvalTree());\n+      }\n+    }\n+\n+    verifyProjectableOutputSchema(node);\n+    return node;\n+  }\n+\n   @Override\n   public LogicalNode visitScan(Context context, LogicalPlan plan, LogicalPlan.QueryBlock block, ScanNode node,\n                                Stack<LogicalNode> stack) throws PlanningException {",
                "raw_url": "https://github.com/apache/tajo/raw/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/main/java/org/apache/tajo/engine/planner/LogicalPlanVerifier.java",
                "sha": "c9932fa8e8a159d1bd761834de1acf083a3124e1",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/main/java/org/apache/tajo/master/GlobalEngine.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/master/GlobalEngine.java?ref=8967d113571fe72131433e39753e41c35abe2297",
                "deletions": 0,
                "filename": "tajo-core/src/main/java/org/apache/tajo/master/GlobalEngine.java",
                "patch": "@@ -137,6 +137,10 @@ public LogicalOptimizer getLogicalOptimizer() {\n     return optimizer;\n   }\n \n+  public LogicalPlanVerifier getLogicalPlanVerifier() {\n+    return annotatedPlanVerifier;\n+  }\n+\n   private QueryContext createQueryContext(Session session) {\n     QueryContext newQueryContext =  new QueryContext(context.getConf(), session);\n ",
                "raw_url": "https://github.com/apache/tajo/raw/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/main/java/org/apache/tajo/master/GlobalEngine.java",
                "sha": "342f8d7a2fadc495325a2de85e245c9552a2e0ae",
                "status": "modified"
            },
            {
                "additions": 76,
                "blob_url": "https://github.com/apache/tajo/blob/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/test/java/org/apache/tajo/QueryTestCaseBase.java",
                "changes": 91,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/java/org/apache/tajo/QueryTestCaseBase.java?ref=8967d113571fe72131433e39753e41c35abe2297",
                "deletions": 15,
                "filename": "tajo-core/src/test/java/org/apache/tajo/QueryTestCaseBase.java",
                "patch": "@@ -34,6 +34,9 @@\n import org.apache.tajo.client.TajoClient;\n import org.apache.tajo.conf.TajoConf;\n import org.apache.tajo.engine.parser.SQLAnalyzer;\n+import org.apache.tajo.engine.planner.*;\n+import org.apache.tajo.engine.query.QueryContext;\n+import org.apache.tajo.master.GlobalEngine;\n import org.apache.tajo.storage.StorageUtil;\n import org.apache.tajo.util.FileUtil;\n import org.junit.*;\n@@ -125,7 +128,11 @@\n   protected static TajoConf conf;\n   protected static TajoClient client;\n   protected static final CatalogService catalog;\n-  protected static final SQLAnalyzer sqlParser = new SQLAnalyzer();\n+  protected static final SQLAnalyzer sqlParser;\n+  protected static PreLogicalPlanVerifier verifier;\n+  protected static LogicalPlanner planner;\n+  protected static LogicalOptimizer optimizer;\n+  protected static LogicalPlanVerifier postVerifier;\n \n   /** the base path of dataset directories */\n   protected static final Path datasetBasePath;\n@@ -145,6 +152,13 @@\n     queryBasePath = new Path(queryBaseURL.toString());\n     URL resultBaseURL = ClassLoader.getSystemResource(\"results\");\n     resultBasePath = new Path(resultBaseURL.toString());\n+\n+    GlobalEngine engine = testingCluster.getMaster().getContext().getGlobalEngine();\n+    sqlParser = engine.getAnalyzer();\n+    verifier = engine.getPreLogicalPlanVerifier();\n+    planner = engine.getLogicalPlanner();\n+    optimizer = engine.getLogicalOptimizer();\n+    postVerifier = engine.getLogicalPlanVerifier();\n   }\n \n   /** It transiently contains created tables for the running test class. */\n@@ -225,6 +239,52 @@ public String getCurrentDatabase() {\n     return currentDatabase;\n   }\n \n+  private static VerificationState verify(String query) throws PlanningException {\n+\n+    VerificationState state = new VerificationState();\n+    QueryContext context = LocalTajoTestingUtility.createDummyContext(conf);\n+\n+    Expr expr = sqlParser.parse(query);\n+    verifier.verify(context, state, expr);\n+    if (state.getErrorMessages().size() > 0) {\n+      return state;\n+    }\n+    LogicalPlan plan = planner.createPlan(context, expr);\n+    optimizer.optimize(plan);\n+    postVerifier.verify(context, state, plan);\n+\n+    return state;\n+  }\n+\n+  public void assertValidSQL(String fileName) throws PlanningException, IOException {\n+    Path queryFilePath = getQueryFilePath(fileName);\n+    String query = FileUtil.readTextFile(new File(queryFilePath.toUri()));\n+    VerificationState state = verify(query);\n+    if (state.getErrorMessages().size() > 0) {\n+      fail(state.getErrorMessages().get(0));\n+    }\n+  }\n+\n+  public void assertInvalidSQL(String fileName) throws PlanningException, IOException {\n+    Path queryFilePath = getQueryFilePath(fileName);\n+    String query = FileUtil.readTextFile(new File(queryFilePath.toUri()));\n+    VerificationState state = verify(query);\n+    if (state.getErrorMessages().size() == 0) {\n+      fail(PreLogicalPlanVerifier.class.getSimpleName() + \" cannot catch any verification error: \" + query);\n+    }\n+  }\n+\n+  public void assertPlanError(String fileName) throws PlanningException, IOException {\n+    Path queryFilePath = getQueryFilePath(fileName);\n+    String query = FileUtil.readTextFile(new File(queryFilePath.toUri()));\n+    try {\n+      verify(query);\n+    } catch (PlanningException e) {\n+      return;\n+    }\n+    fail(\"Cannot catch any planning error from: \" + query);\n+  }\n+\n   protected ResultSet executeString(String sql) throws Exception {\n     return client.executeQueryAndGetResult(sql);\n   }\n@@ -261,8 +321,6 @@ public ResultSet executeJsonQuery() throws Exception {\n    */\n   public ResultSet executeFile(String queryFileName) throws Exception {\n     Path queryFilePath = getQueryFilePath(queryFileName);\n-    FileSystem fs = currentQueryPath.getFileSystem(testBase.getTestingCluster().getConfiguration());\n-    assertTrue(queryFilePath.toString() + \" existence check\", fs.exists(queryFilePath));\n \n     List<ParsedResult> parsedResults = SimpleParser.parseScript(FileUtil.readTextFile(new File(queryFilePath.toUri())));\n     if (parsedResults.size() > 1) {\n@@ -275,8 +333,6 @@ public ResultSet executeFile(String queryFileName) throws Exception {\n \n   public ResultSet executeJsonFile(String jsonFileName) throws Exception {\n     Path queryFilePath = getQueryFilePath(jsonFileName);\n-    FileSystem fs = currentQueryPath.getFileSystem(testBase.getTestingCluster().getConfiguration());\n-    assertTrue(queryFilePath.toString() + \" existence check\", fs.exists(queryFilePath));\n \n     ResultSet result = client.executeJsonQueryAndGetResult(FileUtil.readTextFile(new File(queryFilePath.toUri())));\n     assertNotNull(\"Query succeeded test\", result);\n@@ -314,7 +370,6 @@ public final void assertResultSet(ResultSet result, String resultFileName) throw\n   public final void assertResultSet(String message, ResultSet result, String resultFileName) throws IOException {\n     FileSystem fs = currentQueryPath.getFileSystem(testBase.getTestingCluster().getConfiguration());\n     Path resultFile = getResultFile(resultFileName);\n-    assertTrue(resultFile.toString() + \" existence check\", fs.exists(resultFile));\n     try {\n       verifyResultText(message, result, resultFile);\n     } catch (SQLException e) {\n@@ -331,10 +386,7 @@ public final void assertStrings(String actual, String resultFileName) throws IOE\n   }\n \n   public final void assertStrings(String message, String actual, String resultFileName) throws IOException {\n-    FileSystem fs = currentQueryPath.getFileSystem(testBase.getTestingCluster().getConfiguration());\n     Path resultFile = getResultFile(resultFileName);\n-    assertTrue(resultFile.toString() + \" existence check\", fs.exists(resultFile));\n-\n     String expectedResult = FileUtil.readTextFile(new File(resultFile.toUri()));\n     assertEquals(message, expectedResult, actual);\n   }\n@@ -438,16 +490,25 @@ private void verifyResultText(String message, ResultSet res, Path resultFile) th\n     assertEquals(message, expectedResult.trim(), actualResult.trim());\n   }\n \n-  private Path getQueryFilePath(String fileName) {\n-    return StorageUtil.concatPath(currentQueryPath, fileName);\n+  private Path getQueryFilePath(String fileName) throws IOException {\n+    Path queryFilePath = StorageUtil.concatPath(currentQueryPath, fileName);\n+    FileSystem fs = currentQueryPath.getFileSystem(testBase.getTestingCluster().getConfiguration());\n+    assertTrue(queryFilePath.toString() + \" existence check\", fs.exists(queryFilePath));\n+    return queryFilePath;\n   }\n \n-  private Path getResultFile(String fileName) {\n-    return StorageUtil.concatPath(currentResultPath, fileName);\n+  private Path getResultFile(String fileName) throws IOException {\n+    Path resultPath = StorageUtil.concatPath(currentResultPath, fileName);\n+    FileSystem fs = currentResultPath.getFileSystem(testBase.getTestingCluster().getConfiguration());\n+    assertTrue(resultPath.toString() + \" existence check\", fs.exists(resultPath));\n+    return resultPath;\n   }\n \n-  private Path getDataSetFile(String fileName) {\n-    return StorageUtil.concatPath(currentDatasetPath, fileName);\n+  private Path getDataSetFile(String fileName) throws IOException {\n+    Path dataFilePath = StorageUtil.concatPath(currentDatasetPath, fileName);\n+    FileSystem fs = currentDatasetPath.getFileSystem(testBase.getTestingCluster().getConfiguration());\n+    assertTrue(dataFilePath.toString() + \" existence check\", fs.exists(dataFilePath));\n+    return dataFilePath;\n   }\n \n   public List<String> executeDDL(String ddlFileName, @Nullable String [] args) throws Exception {",
                "raw_url": "https://github.com/apache/tajo/raw/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/test/java/org/apache/tajo/QueryTestCaseBase.java",
                "sha": "7b89587a0247160359b89eacfa8c162ded4298c3",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tajo/blob/561edf3cb5328a5582d743e96ab596da347c1b90/tajo-core/src/test/java/org/apache/tajo/engine/planner/TestPreLogicalPlanVerifier.java",
                "changes": 74,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/java/org/apache/tajo/engine/planner/TestPreLogicalPlanVerifier.java?ref=561edf3cb5328a5582d743e96ab596da347c1b90",
                "deletions": 74,
                "filename": "tajo-core/src/test/java/org/apache/tajo/engine/planner/TestPreLogicalPlanVerifier.java",
                "patch": "@@ -1,74 +0,0 @@\n-/*\n- * Lisensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-\n-package org.apache.tajo.engine.planner;\n-\n-import org.apache.tajo.LocalTajoTestingUtility;\n-import org.apache.tajo.QueryTestCaseBase;\n-import org.apache.tajo.algebra.Expr;\n-import org.apache.tajo.engine.parser.SQLAnalyzer;\n-import org.apache.tajo.engine.query.QueryContext;\n-import org.apache.tajo.master.GlobalEngine;\n-import org.junit.BeforeClass;\n-import org.junit.Test;\n-\n-import static org.junit.Assert.fail;\n-\n-public class TestPreLogicalPlanVerifier extends QueryTestCaseBase {\n-\n-  private static SQLAnalyzer analyzer;\n-  private static PreLogicalPlanVerifier verifier;\n-\n-  @BeforeClass\n-  public static void setUp() {\n-    GlobalEngine engine = testingCluster.getMaster().getContext().getGlobalEngine();\n-    analyzer = engine.getAnalyzer();\n-    verifier = engine.getPreLogicalPlanVerifier();\n-  }\n-\n-  public static VerificationState verify(String query) throws PlanningException {\n-\n-    VerificationState state = new VerificationState();\n-    QueryContext context = LocalTajoTestingUtility.createDummyContext(conf);\n-\n-    Expr expr = analyzer.parse(query);\n-    verifier.verify(context, state, expr);\n-\n-    return state;\n-  }\n-\n-  public static void valid(String query) throws PlanningException {\n-    VerificationState state = verify(query);\n-    if (state.errorMessages.size() > 0) {\n-      fail(state.getErrorMessages().get(0));\n-    }\n-  }\n-\n-  public static void invalid(String query) throws PlanningException {\n-    VerificationState state = verify(query);\n-    if (state.errorMessages.size() == 0) {\n-      fail(PreLogicalPlanVerifier.class.getSimpleName() + \" cannot catch any verification error: \" + query);\n-    }\n-  }\n-\n-  @Test\n-  public void testLimitWithFieldReference() throws PlanningException {\n-    valid(\"select * from lineitem limit 3\");\n-    invalid(\"select * from lineitem limit l_orderkey\");\n-  }\n-}",
                "raw_url": "https://github.com/apache/tajo/raw/561edf3cb5328a5582d743e96ab596da347c1b90/tajo-core/src/test/java/org/apache/tajo/engine/planner/TestPreLogicalPlanVerifier.java",
                "sha": "b009785706bb127d1c8561bc564b6965e815d6c8",
                "status": "removed"
            },
            {
                "additions": 52,
                "blob_url": "https://github.com/apache/tajo/blob/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/test/java/org/apache/tajo/engine/planner/TestQueryValidation.java",
                "changes": 52,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/java/org/apache/tajo/engine/planner/TestQueryValidation.java?ref=8967d113571fe72131433e39753e41c35abe2297",
                "deletions": 0,
                "filename": "tajo-core/src/test/java/org/apache/tajo/engine/planner/TestQueryValidation.java",
                "patch": "@@ -0,0 +1,52 @@\n+/*\n+ * Lisensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.tajo.engine.planner;\n+\n+import org.apache.tajo.QueryTestCaseBase;\n+import org.junit.Test;\n+\n+import java.io.IOException;\n+\n+public class TestQueryValidation extends QueryTestCaseBase {\n+  @Test\n+  public void testLimitClauses() throws PlanningException, IOException {\n+    // select * from lineitem limit 3;\n+    assertValidSQL(\"valid_limit_1.sql\");\n+\n+    // select * from lineitem limit l_orderkey;\n+    assertInvalidSQL(\"invalid_limit_1.sql\");\n+  }\n+\n+  @Test\n+  public void testGroupByClauses() throws PlanningException, IOException {\n+    // select l_orderkey from lineitem group by l_orderkey;\n+    assertValidSQL(\"valid_groupby_1.sql\");\n+\n+    // select * from lineitem group by l_orderkey;\n+    assertPlanError(\"error_groupby_1.sql\");\n+    // select l_orderkey from lineitem group by l_paerkey;\n+    assertPlanError(\"error_groupby_2.sql\");\n+  }\n+\n+  @Test\n+  public void testCaseWhenExprs() throws PlanningException, IOException {\n+    // See TAJO-1098\n+    assertInvalidSQL(\"invalid_casewhen_1.sql\");\n+  }\n+}",
                "raw_url": "https://github.com/apache/tajo/raw/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/test/java/org/apache/tajo/engine/planner/TestQueryValidation.java",
                "sha": "e17b325aae15bf5be525c706fbad8834c3413b47",
                "status": "added"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/test/resources/queries/TestQueryValidation/error_groupby_1.sql",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/queries/TestQueryValidation/error_groupby_1.sql?ref=8967d113571fe72131433e39753e41c35abe2297",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/queries/TestQueryValidation/error_groupby_1.sql",
                "patch": "@@ -0,0 +1 @@\n+select * from lineitem group by l_orderkey;\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/test/resources/queries/TestQueryValidation/error_groupby_1.sql",
                "sha": "7aa94395425b86f571698ffbadce5c22dc2738a3",
                "status": "added"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/test/resources/queries/TestQueryValidation/error_groupby_2.sql",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/queries/TestQueryValidation/error_groupby_2.sql?ref=8967d113571fe72131433e39753e41c35abe2297",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/queries/TestQueryValidation/error_groupby_2.sql",
                "patch": "@@ -0,0 +1 @@\n+select l_orderkey from lineitem group by l_paerkey;\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/test/resources/queries/TestQueryValidation/error_groupby_2.sql",
                "sha": "90b31b29c01e629d3e92b77c33f6b51caa4fe2a8",
                "status": "added"
            },
            {
                "additions": 15,
                "blob_url": "https://github.com/apache/tajo/blob/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/test/resources/queries/TestQueryValidation/invalid_casewhen_1.sql",
                "changes": 15,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/queries/TestQueryValidation/invalid_casewhen_1.sql?ref=8967d113571fe72131433e39753e41c35abe2297",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/queries/TestQueryValidation/invalid_casewhen_1.sql",
                "patch": "@@ -0,0 +1,15 @@\n+SELECT\n+  CASE\n+    WHEN PERIOD < 0 THEN 'N/A'\n+    WHEN PERIOD <= INTERVAL '12h' THEN 'C0'\n+    WHEN PERIOD <= INTERVAL '24h' THEN 'C1'\n+    WHEN PERIOD <= INTERVAL '48h' THEN 'C2'\n+    ELSE 'XX'\n+  END AS P\n+FROM (\n+  SELECT\n+    INTERVAL '12h' as PERIOD,\n+    L_ORDERKEY\n+  FROM\n+    LINEITEM\n+) T;",
                "raw_url": "https://github.com/apache/tajo/raw/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/test/resources/queries/TestQueryValidation/invalid_casewhen_1.sql",
                "sha": "57b369ba4705151709638d556802b462f76294da",
                "status": "added"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/test/resources/queries/TestQueryValidation/invalid_limit_1.sql",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/queries/TestQueryValidation/invalid_limit_1.sql?ref=8967d113571fe72131433e39753e41c35abe2297",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/queries/TestQueryValidation/invalid_limit_1.sql",
                "patch": "@@ -0,0 +1 @@\n+select * from lineitem limit l_orderkey;\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/test/resources/queries/TestQueryValidation/invalid_limit_1.sql",
                "sha": "65c72b1f49eee749c6813eaedea65fa9f10e979e",
                "status": "added"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/test/resources/queries/TestQueryValidation/valid_groupby_1.sql",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/queries/TestQueryValidation/valid_groupby_1.sql?ref=8967d113571fe72131433e39753e41c35abe2297",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/queries/TestQueryValidation/valid_groupby_1.sql",
                "patch": "@@ -0,0 +1 @@\n+select l_orderkey from lineitem group by l_orderkey;\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/test/resources/queries/TestQueryValidation/valid_groupby_1.sql",
                "sha": "90c2371d964545dfc7c878c79bfd9b1c537eb658",
                "status": "added"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/test/resources/queries/TestQueryValidation/valid_limit_1.sql",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/queries/TestQueryValidation/valid_limit_1.sql?ref=8967d113571fe72131433e39753e41c35abe2297",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/queries/TestQueryValidation/valid_limit_1.sql",
                "patch": "@@ -0,0 +1 @@\n+select * from lineitem limit 3;\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/8967d113571fe72131433e39753e41c35abe2297/tajo-core/src/test/resources/queries/TestQueryValidation/valid_limit_1.sql",
                "sha": "79cf804b9abede5e75bf432b648381821141c0b5",
                "status": "added"
            }
        ],
        "message": "TAJO-1104: Using asterisk with GROUP BY causes NPE.\n\nCloses #187",
        "parent": "https://github.com/apache/tajo/commit/561edf3cb5328a5582d743e96ab596da347c1b90",
        "patched_files": [
            "valid_groupby_1.sql",
            "GlobalEngine.java",
            "invalid_casewhen_1.sql",
            "error_groupby_1.sql",
            "error_groupby_2.sql",
            "invalid_limit_1.sql",
            "LogicalPlanPreprocessor.java",
            "valid_limit_1.sql",
            "LogicalPlanVerifier.java",
            "PreLogicalPlanVerifier.java",
            "CHANGES",
            "QueryTestCaseBase.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestPreLogicalPlanVerifier.java",
            "TestQueryValidation.java"
        ]
    },
    "tajo_a90895a": {
        "bug_id": "tajo_a90895a",
        "commit": "https://github.com/apache/tajo/commit/a90895a74a13c654a8d12345bbbdd8d3b08c604c",
        "file": [
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/tajo/blob/a90895a74a13c654a8d12345bbbdd8d3b08c604c/CHANGES.txt",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES.txt?ref=a90895a74a13c654a8d12345bbbdd8d3b08c604c",
                "deletions": 3,
                "filename": "CHANGES.txt",
                "patch": "@@ -146,11 +146,17 @@ Release 0.8.0 - unreleased\n \n   BUG FIXES\n \n-    TAJO-414: Fix bug of bit operations in decode() method of DateDatum class. (Keuntae Park via jihoon)\n+    TAJO-415: Some complex queries causes NPE and unlimited recursions.\n+    (hyunsik)\n+\n+    TAJO-414: Fix bug of bit operations in decode() method of DateDatum class.\n+    (Keuntae Park via jihoon)\n \n-    TAJO-407: PostgreSQL-style cast should be higher operator priority. (hyunsik)\n+    TAJO-407: PostgreSQL-style cast should be higher operator priority.\n+    (hyunsik)\n \n-    TAJO-411: Fix Bug: createFromInt8's DATE type should be TIMESTAMP. (DaeMyung Kang via jihoon)\n+    TAJO-411: Fix Bug: createFromInt8's DATE type should be TIMESTAMP.\n+    (DaeMyung Kang via jihoon)\n \n     TAJO-390: Queries on history are expired ealier than a given expiry time.\n     (hyoungjunkim via hyunsik)",
                "raw_url": "https://github.com/apache/tajo/raw/a90895a74a13c654a8d12345bbbdd8d3b08c604c/CHANGES.txt",
                "sha": "87bbec5a86500f8064be3ab61ea47b0fd6e000a8",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/FunctionDesc.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/FunctionDesc.java?ref=a90895a74a13c654a8d12345bbbdd8d3b08c604c",
                "deletions": 2,
                "filename": "tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/FunctionDesc.java",
                "patch": "@@ -18,6 +18,7 @@\n \n package org.apache.tajo.catalog;\n \n+import com.google.common.base.Objects;\n import com.google.gson.annotations.Expose;\n import org.apache.tajo.json.GsonObject;\n import org.apache.tajo.catalog.function.Function;\n@@ -99,8 +100,9 @@ public DataType getReturnType() {\n     return this.returnType;\n   }\n \n-  public static DataType [] newNoNameSchema(DataType ... types) {\n-    return types.clone();\n+  @Override\n+  public int hashCode() {\n+    return Objects.hashCode(signature, params);\n   }\n   \n   @Override",
                "raw_url": "https://github.com/apache/tajo/raw/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/FunctionDesc.java",
                "sha": "c64ac458b1c5ec915e3ab47d2fea8f64dfa5c50d",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/eval/FieldEval.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/eval/FieldEval.java?ref=a90895a74a13c654a8d12345bbbdd8d3b08c604c",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/eval/FieldEval.java",
                "patch": "@@ -84,7 +84,7 @@ public Column getColumnRef() {\n     return column;\n   }\n \t\n-\tpublic String getTableId() {\t  \n+\tpublic String getQualifier() {\n \t  return column.getQualifier();\n \t}\n \t",
                "raw_url": "https://github.com/apache/tajo/raw/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/eval/FieldEval.java",
                "sha": "6a840e4d82b94aa142193d15732d66d813fee10b",
                "status": "modified"
            },
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/tajo/blob/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/logical/join/GreedyHeuristicJoinOrderAlgorithm.java",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/logical/join/GreedyHeuristicJoinOrderAlgorithm.java?ref=a90895a74a13c654a8d12345bbbdd8d3b08c604c",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/logical/join/GreedyHeuristicJoinOrderAlgorithm.java",
                "patch": "@@ -193,6 +193,7 @@ public static double getCost(JoinEdge joinEdge) {\n     }\n   }\n \n+  // TODO - costs of other operator operators (e.g., group-by and sort) should be computed in proper manners.\n   public static double getCost(LogicalNode node) {\n     switch (node.getType()) {\n \n@@ -229,8 +230,18 @@ public static double getCost(LogicalNode node) {\n         return Long.MAX_VALUE;\n       }\n \n+    case UNION:\n+      UnionNode unionNode = (UnionNode) node;\n+      return getCost(unionNode.getLeftChild()) + getCost(unionNode.getRightChild());\n+\n+    case EXCEPT:\n+    case INTERSECT:\n+      throw new UnsupportedOperationException(\"getCost() does not support EXCEPT or INTERSECT yet\");\n+\n     default:\n-      return getCost(node);\n+      // all binary operators (join, union, except, and intersect) are handled in the above cases.\n+      // So, we need to handle only unary nodes in default.\n+      return getCost(((UnaryNode) node).getChild());\n     }\n   }\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/logical/join/GreedyHeuristicJoinOrderAlgorithm.java",
                "sha": "bd1b8d38a1528d964cd4c21ee9da940341c03d69",
                "status": "modified"
            },
            {
                "additions": 13,
                "blob_url": "https://github.com/apache/tajo/blob/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/rewrite/FilterPushDownRule.java",
                "changes": 26,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/rewrite/FilterPushDownRule.java?ref=a90895a74a13c654a8d12345bbbdd8d3b08c604c",
                "deletions": 13,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/rewrite/FilterPushDownRule.java",
                "patch": "@@ -105,13 +105,13 @@ public LogicalNode visitJoin(Set<EvalNode> cnf, LogicalPlan plan, JoinNode joinN\n       // if both are fields\n        if (joinQual.getLeftExpr().getType() == EvalType.FIELD && joinQual.getRightExpr().getType() == EvalType.FIELD) {\n \n-          String leftTableName = ((FieldEval) joinQual.getLeftExpr()).getTableId();\n-          String rightTableName = ((FieldEval) joinQual.getRightExpr()).getTableId();\n+          String leftTableName = ((FieldEval) joinQual.getLeftExpr()).getQualifier();\n+          String rightTableName = ((FieldEval) joinQual.getRightExpr()).getQualifier();\n           List<String> nullSuppliers = Lists.newArrayList();\n-          String [] leftLineage = PlannerUtil.getRelationLineage(joinNode.getLeftChild());\n-          String [] rightLineage = PlannerUtil.getRelationLineage(joinNode.getRightChild());\n-          Set<String> leftTableSet = Sets.newHashSet(leftLineage);\n-          Set<String> rightTableSet = Sets.newHashSet(rightLineage);\n+          Set<String> leftTableSet = Sets.newHashSet(PlannerUtil.getRelationLineageWithinQueryBlock(plan,\n+              joinNode.getLeftChild()));\n+          Set<String> rightTableSet = Sets.newHashSet(PlannerUtil.getRelationLineageWithinQueryBlock(plan,\n+              joinNode.getRightChild()));\n \n           // some verification\n           if (joinType == JoinType.FULL_OUTER) {\n@@ -127,13 +127,13 @@ public LogicalNode visitJoin(Set<EvalNode> cnf, LogicalPlan plan, JoinNode joinN\n              }\n \n           } else if (joinType == JoinType.LEFT_OUTER) {\n-             nullSuppliers.add(((ScanNode)joinNode.getRightChild()).getTableName()); \n+             nullSuppliers.add(((RelationNode)joinNode.getRightChild()).getCanonicalName());\n              //verify that this null supplier is indeed in the right sub-tree\n              if (!rightTableSet.contains(nullSuppliers.get(0))) {\n                  throw new InvalidQueryException(\"Incorrect Logical Query Plan with regard to outer join\");\n              }\n           } else if (joinType == JoinType.RIGHT_OUTER) {\n-            if (((ScanNode)joinNode.getRightChild()).getTableName().equals(rightTableName)) {\n+            if (((RelationNode)joinNode.getRightChild()).getCanonicalName().equals(rightTableName)) {\n               nullSuppliers.add(leftTableName);\n             } else {\n               nullSuppliers.add(rightTableName);\n@@ -144,12 +144,12 @@ public LogicalNode visitJoin(Set<EvalNode> cnf, LogicalPlan plan, JoinNode joinN\n               throw new InvalidQueryException(\"Incorrect Logical Query Plan with regard to outer join\");\n             }\n           }\n-         \n+\n          // retain in this outer join node's JoinQual those selection predicates\n          // related to the outer join's null supplier(s)\n          List<EvalNode> matched2 = Lists.newArrayList();\n          for (EvalNode eval : cnf) {\n-            \n+\n             Set<Column> columnRefs = EvalTreeUtil.findDistinctRefColumns(eval);\n             Set<String> tableNames = Sets.newHashSet();\n             // getting distinct table references\n@@ -158,20 +158,20 @@ public LogicalNode visitJoin(Set<EvalNode> cnf, LogicalPlan plan, JoinNode joinN\n                 tableNames.add(col.getQualifier());\n               }\n             }\n-            \n+\n             //if the predicate involves any of the null suppliers\n             boolean shouldKeep=false;\n             Iterator<String> it2 = nullSuppliers.iterator();\n             while(it2.hasNext()){\n               if(tableNames.contains(it2.next()) == true) {\n-                   shouldKeep = true; \n+                   shouldKeep = true;\n               }\n             }\n \n             if(shouldKeep == true) {\n                 matched2.add(eval);\n             }\n-            \n+\n           }\n \n           //merge the retained predicates and establish them in the current outer join node. Then remove them from the cnf",
                "raw_url": "https://github.com/apache/tajo/raw/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/rewrite/FilterPushDownRule.java",
                "sha": "767325338b76a77458469105301077b9eb595499",
                "status": "modified"
            },
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/tajo/blob/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/rewrite/ProjectionPushDownRule.java",
                "changes": 30,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/rewrite/ProjectionPushDownRule.java?ref=a90895a74a13c654a8d12345bbbdd8d3b08c604c",
                "deletions": 11,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/rewrite/ProjectionPushDownRule.java",
                "patch": "@@ -271,26 +271,34 @@ public LogicalNode visitTableSubQuery(PushDownContext context, LogicalPlan plan,\n     Stack<LogicalNode> newStack = new Stack<LogicalNode>();\n     newStack.push(node);\n     PushDownContext newContext = new PushDownContext(subBlock);\n+\n+    newContext.upperRequired = new HashSet<Column>();\n+\n     if (subBlock.hasProjection() && subBlock.getProjection().isAllProjected()\n         && context.upperRequired.size() == 0) {\n       newContext.targetListManager = new TargetListManager(plan, subBlock.getProjectionNode().getTargets());\n     } else {\n-     List<Target> projectedTarget = new ArrayList<Target>();\n-      for (Target target : subBlock.getTargetListManager().getUnresolvedTargets()) {\n-        for (Column column : context.upperRequired) {\n-          if (column.hasQualifier() && !node.getTableName().equals(column.getQualifier())) {\n-            continue;\n-          }\n-          if (target.getColumnSchema().getColumnName().equalsIgnoreCase(column.getColumnName())) {\n-            projectedTarget.add(target);\n+      if (!subBlock.hasGrouping()) {\n+        List<Target> projectedTarget = new ArrayList<Target>();\n+        for (Target target : subBlock.getTargetListManager().getUnresolvedTargets()) {\n+          for (Column column : context.upperRequired) {\n+            if (column.hasQualifier() && !node.getTableName().equals(column.getQualifier())) {\n+              continue;\n+            }\n+            if (target.getColumnSchema().getColumnName().equalsIgnoreCase(column.getColumnName())) {\n+              projectedTarget.add(target);\n+            }\n           }\n         }\n+        newContext.targetListManager = new TargetListManager(plan,\n+            projectedTarget.toArray(new Target[projectedTarget.size()]));\n+\n+      } else {\n+        newContext.targetListManager = new TargetListManager(plan,\n+            subBlock.getTargetListManager().getUnresolvedTargets());\n       }\n-      newContext.targetListManager = new TargetListManager(plan,\n-          projectedTarget.toArray(new Target[projectedTarget.size()]));\n     }\n \n-    newContext.upperRequired = new HashSet<Column>();\n     newContext.upperRequired.addAll(PlannerUtil.targetToSchema(newContext.targetListManager.getTargets()).getColumns());\n \n     LogicalNode child = visitChild(newContext, plan, subRoot, newStack);",
                "raw_url": "https://github.com/apache/tajo/raw/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/rewrite/ProjectionPushDownRule.java",
                "sha": "d0e9a6f8fe20aec6c1e486c2cf190e1e418c64c2",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/master/querymaster/QueryUnit.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/master/querymaster/QueryUnit.java?ref=a90895a74a13c654a8d12345bbbdd8d3b08c604c",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/master/querymaster/QueryUnit.java",
                "patch": "@@ -177,7 +177,9 @@ public void setLogicalPlan(LogicalNode plan) {\n \t      s.add(s.size(), binary.getRightChild());\n \t    } else if (node instanceof ScanNode) {\n \t      scan.add((ScanNode)node);\n-\t    }\n+\t    } else if (node instanceof TableSubQueryNode) {\n+        s.add(((TableSubQueryNode) node).getSubQuery());\n+      }\n \t  }\n \t}\n ",
                "raw_url": "https://github.com/apache/tajo/raw/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/master/querymaster/QueryUnit.java",
                "sha": "28f93fcd64429eb485169a818d5ce091c9580d27",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tajo/blob/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/master/querymaster/SubQuery.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/master/querymaster/SubQuery.java?ref=a90895a74a13c654a8d12345bbbdd8d3b08c604c",
                "deletions": 2,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/master/querymaster/SubQuery.java",
                "patch": "@@ -695,7 +695,8 @@ public static int getNonLeafTaskNum(SubQuery subQuery) {\n       return maxTaskNum;\n     }\n \n-    public static long getInputVolume(MasterPlan masterPlan, QueryMasterTask.QueryMasterTaskContext context, ExecutionBlock execBlock) {\n+    public static long getInputVolume(MasterPlan masterPlan, QueryMasterTask.QueryMasterTaskContext context,\n+                                      ExecutionBlock execBlock) {\n       Map<String, TableDesc> tableMap = context.getTableDescMap();\n       if (masterPlan.isLeaf(execBlock)) {\n         ScanNode outerScan = execBlock.getScanNodes()[0];\n@@ -705,7 +706,11 @@ public static long getInputVolume(MasterPlan masterPlan, QueryMasterTask.QueryMa\n         long aggregatedVolume = 0;\n         for (ExecutionBlock childBlock : masterPlan.getChilds(execBlock)) {\n           SubQuery subquery = context.getSubQuery(childBlock.getId());\n-          aggregatedVolume += subquery.getTableStat().getNumBytes();\n+          if (subquery == null || subquery.getState() != SubQueryState.SUCCEEDED) {\n+            aggregatedVolume += getInputVolume(masterPlan, context, childBlock);\n+          } else {\n+            aggregatedVolume += subquery.getTableStat().getNumBytes();\n+          }\n         }\n \n         return aggregatedVolume;",
                "raw_url": "https://github.com/apache/tajo/raw/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/master/querymaster/SubQuery.java",
                "sha": "7fedd4f2df9331849c8e9958e1016bf406d216a5",
                "status": "modified"
            },
            {
                "additions": 66,
                "blob_url": "https://github.com/apache/tajo/blob/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestCaseByCases.java",
                "changes": 66,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestCaseByCases.java?ref=a90895a74a13c654a8d12345bbbdd8d3b08c604c",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestCaseByCases.java",
                "patch": "@@ -0,0 +1,66 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.tajo.engine.query;\n+\n+import com.google.common.collect.Lists;\n+import com.google.common.collect.Maps;\n+import org.apache.tajo.TpchTestBase;\n+import org.apache.tajo.util.FileUtil;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.sql.ResultSet;\n+import java.util.List;\n+import java.util.Map;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+public class TestCaseByCases {\n+  private static TpchTestBase tpch;\n+\n+  public TestCaseByCases() throws IOException {\n+    super();\n+  }\n+\n+  @BeforeClass\n+  public static void setUp() throws Exception {\n+    tpch = TpchTestBase.getInstance();\n+  }\n+\n+  @Test\n+  public final void testTAJO415Case() throws Exception {\n+    ResultSet res = tpch.execute(FileUtil.readTextFile(new File(\"src/test/queries/tajo415_case.sql\")));\n+    try {\n+      Map<Integer, List<Integer>> result = Maps.newHashMap();\n+      result.put(1, Lists.newArrayList(1, 1));\n+      result.put(2, Lists.newArrayList(2, 1));\n+      result.put(3, Lists.newArrayList(3, 1));\n+      result.put(4, Lists.newArrayList(0, 1));\n+      result.put(5, Lists.newArrayList(0, 1));\n+      while(res.next()) {\n+        assertTrue(result.get(res.getInt(1)).get(0) == res.getInt(2));\n+        assertTrue(result.get(res.getInt(1)).get(1) == res.getInt(3));\n+      }\n+    } finally {\n+      res.close();\n+    }\n+  }\n+}",
                "raw_url": "https://github.com/apache/tajo/raw/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestCaseByCases.java",
                "sha": "7f301be0ecd4a71627113fd2a8332785a3fb376e",
                "status": "added"
            },
            {
                "additions": 33,
                "blob_url": "https://github.com/apache/tajo/blob/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-core/tajo-core-backend/src/test/queries/tajo415_case.sql",
                "changes": 33,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/queries/tajo415_case.sql?ref=a90895a74a13c654a8d12345bbbdd8d3b08c604c",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/test/queries/tajo415_case.sql",
                "patch": "@@ -0,0 +1,33 @@\n+select\n+  c_custkey,\n+  o_orderkey,\n+  a.cnt\n+\n+from (\n+\n+  select\n+    c_custkey,\n+    count(*) as cnt\n+\n+  from\n+    customer\n+\n+  group by\n+    c_custkey\n+\n+) a left outer join (\n+\n+  select\n+    o_orderkey,\n+    count(*) as cnt\n+\n+  from\n+    orders\n+\n+  where\n+    o_orderkey is not null\n+\n+  group by\n+    o_orderkey\n+\n+) b on (a.c_custkey = b.o_orderkey);\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/a90895a74a13c654a8d12345bbbdd8d3b08c604c/tajo-core/tajo-core-backend/src/test/queries/tajo415_case.sql",
                "sha": "4a73b0442e8ff198425b020101842bef01420998",
                "status": "added"
            }
        ],
        "message": "TAJO-415: Some complex queries causes NPE and unlimited recursions. (hyunsik)",
        "parent": "https://github.com/apache/tajo/commit/62c49c05f522158d75d818df49100a0b1fd354bb",
        "patched_files": [
            "QueryUnit.java",
            "FilterPushDownRule.java",
            "CHANGES.txt",
            "ProjectionPushDownRule.java",
            "SubQuery.java",
            "FieldEval.java",
            "tajo415_case.sql",
            "FunctionDesc.java",
            "GreedyHeuristicJoinOrderAlgorithm.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestCaseByCases.java",
            "TestFunctionDesc.java"
        ]
    },
    "tajo_ab0d094": {
        "bug_id": "tajo_ab0d094",
        "commit": "https://github.com/apache/tajo/commit/ab0d0948966ae905bc46419a164fa672af813716",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/ab0d0948966ae905bc46419a164fa672af813716/CHANGES",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=ab0d0948966ae905bc46419a164fa672af813716",
                "deletions": 0,
                "filename": "CHANGES",
                "patch": "@@ -54,6 +54,8 @@ Release 0.12.0 - unreleased\n \n   SUB TASKS\n \n+    TAJO-1936: NPE when calling the query result REST api(DaeMyung Kang)\n+\n     TAJO-1909: Eliminate remained explicit diamond expressions.\n     (Contributed by Dongkyu Hwangbo, committed by hyunsik)\n ",
                "raw_url": "https://github.com/apache/tajo/raw/ab0d0948966ae905bc46419a164fa672af813716/CHANGES",
                "sha": "4d64ae1ab999ede1b3e6c1ca05547f0745b78458",
                "status": "modified"
            },
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/tajo/blob/ab0d0948966ae905bc46419a164fa672af813716/tajo-core-tests/src/test/java/org/apache/tajo/ws/rs/resources/TestQueryResultResource.java",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core-tests/src/test/java/org/apache/tajo/ws/rs/resources/TestQueryResultResource.java?ref=ab0d0948966ae905bc46419a164fa672af813716",
                "deletions": 1,
                "filename": "tajo-core-tests/src/test/java/org/apache/tajo/ws/rs/resources/TestQueryResultResource.java",
                "patch": "@@ -39,6 +39,7 @@\n import org.junit.Before;\n import org.junit.Test;\n \n+import javax.ws.rs.BadRequestException;\n import javax.ws.rs.client.Client;\n import javax.ws.rs.client.ClientBuilder;\n import javax.ws.rs.client.Entity;\n@@ -58,7 +59,6 @@\n import static org.junit.Assert.*;\n \n public class TestQueryResultResource extends QueryTestCaseBase {\n-\n   private URI restServiceURI;\n   private URI sessionsURI;\n   private URI queriesURI;\n@@ -150,6 +150,17 @@ public void testGetQueryResult() throws Exception {\n     assertNotNull(response.getResultset().getLink());\n   }\n \n+  @Test(expected = BadRequestException.class)\n+  public void testGetQueryResultWithoutSessionId() throws Exception {\n+    String sessionId = generateNewSessionAndGetId();\n+    URI queryIdURI = sendNewQueryResquest(sessionId, \"select * from lineitem\");\n+    URI queryResultURI = new URI(queryIdURI + \"/result\");\n+\n+    GetQueryResultDataResponse response = restClient.target(queryResultURI)\n+            .request()\n+            .get(new GenericType<>(GetQueryResultDataResponse.class));\n+  }\n+\n   @Test\n   public void testGetQueryResultNotFound() throws Exception {\n     String sessionId = generateNewSessionAndGetId();",
                "raw_url": "https://github.com/apache/tajo/raw/ab0d0948966ae905bc46419a164fa672af813716/tajo-core-tests/src/test/java/org/apache/tajo/ws/rs/resources/TestQueryResultResource.java",
                "sha": "2ab1add1ca37fb577f3c707449e9b51d5a184950",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/ab0d0948966ae905bc46419a164fa672af813716/tajo-core/src/main/java/org/apache/tajo/ws/rs/resources/QueryResource.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/ws/rs/resources/QueryResource.java?ref=ab0d0948966ae905bc46419a164fa672af813716",
                "deletions": 0,
                "filename": "tajo-core/src/main/java/org/apache/tajo/ws/rs/resources/QueryResource.java",
                "patch": "@@ -213,6 +213,12 @@ public Response submitQuery(@HeaderParam(tajoSessionIdHeaderName) String session\n       initializeContext();\n       JerseyResourceDelegateContextKey<String> sessionIdKey =\n           JerseyResourceDelegateContextKey.valueOf(sessionIdKeyName, String.class);\n+\n+      if (sessionId == null || sessionId.isEmpty()) {\n+        return ResourcesUtil.createBadRequestResponse(LOG, \"Session id is required. Please refer the header \" +\n+                QueryResource.tajoSessionIdHeaderName);\n+      }\n+\n       context.put(sessionIdKey, sessionId);\n       JerseyResourceDelegateContextKey<SubmitQueryRequest> submitQueryRequestKey =\n           JerseyResourceDelegateContextKey.valueOf(submitQueryRequestKeyName, SubmitQueryRequest.class);",
                "raw_url": "https://github.com/apache/tajo/raw/ab0d0948966ae905bc46419a164fa672af813716/tajo-core/src/main/java/org/apache/tajo/ws/rs/resources/QueryResource.java",
                "sha": "defb342adeee075d78a46446a98deacd50aa0b28",
                "status": "modified"
            },
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/tajo/blob/ab0d0948966ae905bc46419a164fa672af813716/tajo-core/src/main/java/org/apache/tajo/ws/rs/resources/QueryResultResource.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/ws/rs/resources/QueryResultResource.java?ref=ab0d0948966ae905bc46419a164fa672af813716",
                "deletions": 0,
                "filename": "tajo-core/src/main/java/org/apache/tajo/ws/rs/resources/QueryResultResource.java",
                "patch": "@@ -155,6 +155,12 @@ public Response getQueryResult(@HeaderParam(QueryResource.tajoSessionIdHeaderNam\n       initializeContext();\n       JerseyResourceDelegateContextKey<String> sessionIdKey =\n           JerseyResourceDelegateContextKey.valueOf(sessionIdKeyName, String.class);\n+\n+      if (sessionId == null || sessionId.isEmpty()) {\n+        return ResourcesUtil.createBadRequestResponse(LOG, \"Session id is required. Please refer the header \" +\n+                QueryResource.tajoSessionIdHeaderName);\n+      }\n+\n       context.put(sessionIdKey, sessionId);\n       \n       response = JerseyResourceDelegateUtil.runJerseyResourceDelegate(\n@@ -256,6 +262,12 @@ public Response getQueryResultSet(@HeaderParam(QueryResource.tajoSessionIdHeader\n       initializeContext();\n       JerseyResourceDelegateContextKey<String> sessionIdKey =\n           JerseyResourceDelegateContextKey.valueOf(sessionIdKeyName, String.class);\n+\n+      if (sessionId == null || sessionId.isEmpty()) {\n+        return ResourcesUtil.createBadRequestResponse(LOG, \"Session id is required. Please refer the header \" +\n+                QueryResource.tajoSessionIdHeaderName);\n+      }\n+\n       context.put(sessionIdKey, sessionId);\n       JerseyResourceDelegateContextKey<Long> cacheIdKey =\n           JerseyResourceDelegateContextKey.valueOf(cacheIdKeyName, Long.class);",
                "raw_url": "https://github.com/apache/tajo/raw/ab0d0948966ae905bc46419a164fa672af813716/tajo-core/src/main/java/org/apache/tajo/ws/rs/resources/QueryResultResource.java",
                "sha": "243806051a3bbed6b1cdd6b98262a8828b7d26c1",
                "status": "modified"
            },
            {
                "additions": 18,
                "blob_url": "https://github.com/apache/tajo/blob/ab0d0948966ae905bc46419a164fa672af813716/tajo-core/src/main/java/org/apache/tajo/ws/rs/resources/SessionsResource.java",
                "changes": 18,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/ws/rs/resources/SessionsResource.java?ref=ab0d0948966ae905bc46419a164fa672af813716",
                "deletions": 0,
                "filename": "tajo-core/src/main/java/org/apache/tajo/ws/rs/resources/SessionsResource.java",
                "patch": "@@ -177,6 +177,12 @@ public Response removeSession(@PathParam(\"session-id\") String sessionId) {\n       initializeContext();\n       JerseyResourceDelegateContextKey<String> sessionIdKey =\n           JerseyResourceDelegateContextKey.valueOf(sessionIdKeyName, String.class);\n+\n+      if (sessionId == null || sessionId.isEmpty()) {\n+        return ResourcesUtil.createBadRequestResponse(LOG, \"Session id is required. Please refer the header \" +\n+                QueryResource.tajoSessionIdHeaderName);\n+      }\n+\n       context.put(sessionIdKey, sessionId);\n       \n       response = JerseyResourceDelegateUtil.runJerseyResourceDelegate(\n@@ -239,6 +245,12 @@ public Response getAllSessionVariables(@PathParam(\"session-id\") String sessionId\n       initializeContext();\n       JerseyResourceDelegateContextKey<String> sessionIdKey =\n           JerseyResourceDelegateContextKey.valueOf(sessionIdKeyName, String.class);\n+\n+      if (sessionId == null || sessionId.isEmpty()) {\n+        return ResourcesUtil.createBadRequestResponse(LOG, \"Session id is required. Please refer the header \" +\n+                QueryResource.tajoSessionIdHeaderName);\n+      }\n+\n       context.put(sessionIdKey, sessionId);\n       \n       response = JerseyResourceDelegateUtil.runJerseyResourceDelegate(\n@@ -308,6 +320,12 @@ public Response updateSessionVariables(@PathParam(\"session-id\") String sessionId\n       initializeContext();\n       JerseyResourceDelegateContextKey<String> sessionIdKey =\n           JerseyResourceDelegateContextKey.valueOf(sessionIdKeyName, String.class);\n+\n+      if (sessionId == null || sessionId.isEmpty()) {\n+        return ResourcesUtil.createBadRequestResponse(LOG, \"Session id is required. Please refer the header \" +\n+                QueryResource.tajoSessionIdHeaderName);\n+      }\n+\n       context.put(sessionIdKey, sessionId);\n       JerseyResourceDelegateContextKey<Map> variablesMapKey =\n           JerseyResourceDelegateContextKey.valueOf(variablesKeyName, Map.class);",
                "raw_url": "https://github.com/apache/tajo/raw/ab0d0948966ae905bc46419a164fa672af813716/tajo-core/src/main/java/org/apache/tajo/ws/rs/resources/SessionsResource.java",
                "sha": "b8655e90a55198abe308ce771eed330f861a9c01",
                "status": "modified"
            }
        ],
        "message": "Squashed commit of the following:\n\ncommit 783a4236a265c5c3f743b6cf14878bc0b0857d9e\nAuthor: charsyam <charsyam@charsyamui-MacBook-Pro.local>\nDate:   Sun Oct 18 01:21:08 2015 +0900\n\n    TAJO-1936: Fix NPE\n\n    apply review\n\n    remove unused import\n\n    remove invalid conf",
        "parent": "https://github.com/apache/tajo/commit/1842ee194b2dcb295ebf875a6193e295ac3974a8",
        "patched_files": [
            "QueryResource.java",
            "SessionsResource.java",
            "QueryResultResource.java",
            "CHANGES"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestQueryResource.java",
            "TestQueryResultResource.java",
            "TestSessionsResource.java"
        ]
    },
    "tajo_ae38468": {
        "bug_id": "tajo_ae38468",
        "commit": "https://github.com/apache/tajo/commit/ae384685f5c16853d47cc4a9a611729dfe2b14fc",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/ae384685f5c16853d47cc4a9a611729dfe2b14fc/CHANGES",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=ae384685f5c16853d47cc4a9a611729dfe2b14fc",
                "deletions": 1,
                "filename": "CHANGES",
                "patch": "@@ -103,7 +103,10 @@ Release 0.9.0 - unreleased\n \n   BUG FIXES\n     \n-    TAJO-979: Dividing float value by zero should throw \"Divide by zero \n+    TAJO-975: alias name which is the same to existing column name may cause\n+    NPE during PPD. (hyunsik)\n+\n+    TAJO-979: Dividing float value by zero should throw \"Divide by zero\n     Exception\" (Hyoungjun Kim via hyunsik)\n \n     TAJO-978: RoundFloat8 should return Float8Datum type. (Hyoungjun Kim via ",
                "raw_url": "https://github.com/apache/tajo/raw/ae384685f5c16853d47cc4a9a611729dfe2b14fc/CHANGES",
                "sha": "61593a29ec94672ae1725c5e8a86ebae162f8519",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tajo/blob/ae384685f5c16853d47cc4a9a611729dfe2b14fc/tajo-core/src/main/java/org/apache/tajo/engine/planner/rewrite/ProjectionPushDownRule.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/planner/rewrite/ProjectionPushDownRule.java?ref=ae384685f5c16853d47cc4a9a611729dfe2b14fc",
                "deletions": 0,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/planner/rewrite/ProjectionPushDownRule.java",
                "patch": "@@ -191,6 +191,7 @@ private String add(String specifiedName, EvalNode evalNode) throws PlanningExcep\n       // if a name already exists, it only just keeps an actual\n       // expression instead of a column reference.\n       if (nameToIdBiMap.containsKey(specifiedName)) {\n+\n         int refId = nameToIdBiMap.get(specifiedName);\n         EvalNode found = idToEvalBiMap.get(refId);\n         if (found != null) {\n@@ -204,7 +205,16 @@ private String add(String specifiedName, EvalNode evalNode) throws PlanningExcep\n             }\n \n             if (found.getType() == EvalType.FIELD) {\n+              Integer daggling = idToEvalBiMap.inverse().get(evalNode);\n               idToEvalBiMap.forcePut(refId, evalNode);\n+              if (daggling != null) {\n+                String name = getPrimaryName(daggling);\n+                idToNamesMap.remove(daggling);\n+                nameToIdBiMap.put(name, refId);\n+                if (!idToNamesMap.get(refId).contains(name)) {\n+                  TUtil.putToNestedList(idToNamesMap, refId, name);\n+                }\n+              }\n             }\n           }\n         }",
                "raw_url": "https://github.com/apache/tajo/raw/ae384685f5c16853d47cc4a9a611729dfe2b14fc/tajo-core/src/main/java/org/apache/tajo/engine/planner/rewrite/ProjectionPushDownRule.java",
                "sha": "4a12d99e4914cdfbde14eb8a2b0edcb9d8ae5e48",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/tajo/blob/ae384685f5c16853d47cc4a9a611729dfe2b14fc/tajo-core/src/test/java/org/apache/tajo/engine/query/TestSelectQuery.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/java/org/apache/tajo/engine/query/TestSelectQuery.java?ref=ae384685f5c16853d47cc4a9a611729dfe2b14fc",
                "deletions": 0,
                "filename": "tajo-core/src/test/java/org/apache/tajo/engine/query/TestSelectQuery.java",
                "patch": "@@ -138,6 +138,15 @@ public final void testSelectColumnAliasExistingInRelation2() throws Exception {\n     cleanupQuery(res);\n   }\n \n+  @Test\n+  public final void testSelectColumnAliasExistingInRelation3() throws Exception {\n+    // This is a reproduction code and validator of TAJO-975 Bug\n+    // Please see TAJO-975 in order to know this test in detail.\n+    ResultSet res = executeQuery();\n+    assertResultSet(res);\n+    cleanupQuery(res);\n+  }\n+\n \n   @Test\n   public final void testSelectSameConstantsWithDifferentAliases() throws Exception {",
                "raw_url": "https://github.com/apache/tajo/raw/ae384685f5c16853d47cc4a9a611729dfe2b14fc/tajo-core/src/test/java/org/apache/tajo/engine/query/TestSelectQuery.java",
                "sha": "50d274d500a0268963fccf86c4663f12ec045c2f",
                "status": "modified"
            },
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/tajo/blob/ae384685f5c16853d47cc4a9a611729dfe2b14fc/tajo-core/src/test/resources/queries/TestSelectQuery/testSelectColumnAliasExistingInRelation3.sql",
                "changes": 19,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/queries/TestSelectQuery/testSelectColumnAliasExistingInRelation3.sql?ref=ae384685f5c16853d47cc4a9a611729dfe2b14fc",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/queries/TestSelectQuery/testSelectColumnAliasExistingInRelation3.sql",
                "patch": "@@ -0,0 +1,19 @@\n+SELECT l_orderkey FROM (\n+\n+-- actual test query\n+  SELECT\n+    T1.l_orderkey\n+  FROM\n+    LINEITEM\n+  INNER JOIN (\n+    SELECT\n+      T1.l_orderkey\n+    FROM (\n+      SELECT\n+        LINEITEM.l_orderkey AS l_orderkey\n+      FROM\n+        LINEITEM\n+    ) T1\n+  ) T1 ON LINEITEM.l_orderkey=T1.l_orderkey\n+\n+) A ORDER BY l_orderkey; -- for determinant query result\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/ae384685f5c16853d47cc4a9a611729dfe2b14fc/tajo-core/src/test/resources/queries/TestSelectQuery/testSelectColumnAliasExistingInRelation3.sql",
                "sha": "98336b7a41e8ba259de9fd776ba6556a8e7121ea",
                "status": "added"
            },
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/tajo/blob/ae384685f5c16853d47cc4a9a611729dfe2b14fc/tajo-core/src/test/resources/results/TestSelectQuery/testSelectColumnAliasExistingInRelation3.result",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/results/TestSelectQuery/testSelectColumnAliasExistingInRelation3.result?ref=ae384685f5c16853d47cc4a9a611729dfe2b14fc",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/results/TestSelectQuery/testSelectColumnAliasExistingInRelation3.result",
                "patch": "@@ -0,0 +1,11 @@\n+l_orderkey\n+-------------------------------\n+1\n+1\n+1\n+1\n+2\n+3\n+3\n+3\n+3\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/ae384685f5c16853d47cc4a9a611729dfe2b14fc/tajo-core/src/test/resources/results/TestSelectQuery/testSelectColumnAliasExistingInRelation3.result",
                "sha": "3b40488a9870c25f96aad9cea1127cb5b0b5e233",
                "status": "added"
            }
        ],
        "message": "TAJO-975: alias name which is the same to existing column name may cause NPE during PPD.\n\nCloses #92",
        "parent": "https://github.com/apache/tajo/commit/6b16264c1860f7e8156466fd806ba9251147a702",
        "patched_files": [
            "CHANGES",
            "testSelectColumnAliasExistingInRelation3.result",
            "testSelectColumnAliasExistingInRelation3.sql",
            "ProjectionPushDownRule.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestSelectQuery.java"
        ]
    },
    "tajo_b55918b": {
        "bug_id": "tajo_b55918b",
        "commit": "https://github.com/apache/tajo/commit/b55918bd1dc32a1b034bb67a47114a92bce24b48",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/b55918bd1dc32a1b034bb67a47114a92bce24b48/CHANGES.txt",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES.txt?ref=b55918bd1dc32a1b034bb67a47114a92bce24b48",
                "deletions": 1,
                "filename": "CHANGES.txt",
                "patch": "@@ -4,7 +4,8 @@ Release 0.2.0 - unreleased\n \n   NEW FEATURES\n \n-    TAJO-267: Implement equals() and deepEquals() functions at LogicalNode. (jihoon)\n+    TAJO-267: Implement equals() and deepEquals() functions at LogicalNode. \n+    (jihoon)\n \n     TAJO-260: Add between predicate. (hyunsik)\n \n@@ -215,6 +216,8 @@ Release 0.2.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-273: NotEval incurs NPE with boolean column. (hyunsik)\n+\n     TAJO-272: boolean test does not work correctly. (hyunsik)\n \n     TAJO-264: Remove hard-coded 'standby' mode. (jinho)",
                "raw_url": "https://github.com/apache/tajo/raw/b55918bd1dc32a1b034bb67a47114a92bce24b48/CHANGES.txt",
                "sha": "a08858852fb73f464ead130827fa79cf7864f26b",
                "status": "modified"
            },
            {
                "additions": 79,
                "blob_url": "https://github.com/apache/tajo/blob/b55918bd1dc32a1b034bb67a47114a92bce24b48/LICENSE.txt",
                "changes": 85,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/LICENSE.txt?ref=b55918bd1dc32a1b034bb67a47114a92bce24b48",
                "deletions": 6,
                "filename": "LICENSE.txt",
                "patch": "@@ -208,9 +208,62 @@ Your use of the source code for these subcomponents is subject to the terms\n and conditions of the following licenses.\n \n ------------------------------------------------------------------------------\n-For the ANTLR 3 libraries:\n+For Jetty libraries (http://jetty.mortbay.org/) :\n \n-Copyright (c) 2010 Terence Parr\n+Copyright 1995-2009 Mort Bay Consulting Pty Ltd\n+\n+The Jetty Web Container is Copyright Mort Bay Consulting Pty Ltd\n+unless otherwise noted. It is licensed under the apache 2.0\n+license.\n+\n+The javax.servlet package used by Jetty is copyright\n+Sun Microsystems, Inc and Apache Software Foundation. It is\n+distributed under the Common Development and Distribution License.\n+You can obtain a copy of the license at\n+https://glassfish.dev.java.net/public/CDDLv1.0.html.\n+\n+The UnixCrypt.java code ~Implements the one way cryptography used by\n+Unix systems for simple password protection.  Copyright 1996 Aki Yoshida,\n+modified April 2001  by Iris Van den Broeke, Daniel Deville.\n+Permission to use, copy, modify and distribute UnixCrypt\n+for non-commercial or commercial purposes and without fee is\n+granted provided that the copyright notice appears in all copies.\n+\n+The default JSP implementation is provided by the Glassfish JSP engine\n+from project Glassfish http://glassfish.dev.java.net.  Copyright 2005\n+Sun Microsystems, Inc. and portions Copyright Apache Software Foundation.\n+\n+Some portions of the code are Copyright:\n+  2006 Tim Vernum\n+  1999 Jason Gilbert.\n+\n+The jboss integration module contains some LGPL code.\n+\n+The win32 Java Service Wrapper (v3.2.3) is Copyright (c) 1999, 2006\n+Tanuki Software, Inc.  and 2001 Silver Egg Technology.  It is\n+covered by an open license which is viewable at\n+http://svn.codehaus.org/jetty/jetty/branches/jetty-6.1/extras/win32service/LICENSE.txt\n+\n+------------------------------------------------------------------------------\n+For Netty libraries (http://netty.io) :\n+\n+Copyright 2011 The Netty Project\n+\n+The Netty Project licenses this file to you under the Apache License,\n+version 2.0 (the \"License\"); you may not use this file except in compliance\n+with the License. You may obtain a copy of the License at:\n+\n+http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+License for the specific language governing permissions and limitations\n+under the License.\n+------------------------------------------------------------------------------\n+For the ANTLR 4 libraries (http://antlr.org) :\n+\n+Copyright (c) 2012 Terence Parr and Sam Harwell\n All rights reserved.\n \n Redistribution and use in source and binary forms, with or without\n@@ -239,7 +292,7 @@ THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n \n ------------------------------------------------------------------------------\n-For the Mockito library:\n+For the Mockito library (http://code.google.com/p/mockito/):\n \n The MIT License\n \n@@ -264,7 +317,7 @@ OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n \n ------------------------------------------------------------------------------\n-For the JLine2 libraries:\n+For the JLine2 libraries (https://github.com/jline/jline2) :\n \n Copyright (c) 2002-2012, the original author or authors.\n All rights reserved.\n@@ -302,7 +355,23 @@ IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED\n OF THE POSSIBILITY OF SUCH DAMAGE.\n \n ------------------------------------------------------------------------------\n-For the Protocol Buffers libraries:\n+For guava-libraries (http://code.google.com/p/guava-libraries/) :\n+\n+Copyright (C) 2010 The Guava Authors\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+------------------------------------------------------------------------------\n+For the Protocol Buffers libraries (http://code.google.com/p/protobuf/) :\n \n Copyright 2008, Google Inc.\n All rights reserved.\n@@ -339,7 +408,7 @@ standalone and requires a support library to be linked with it.  This\n support library is itself covered by the above license.\n \n ------------------------------------------------------------------------------\n-For protobuf-java-format (http://code.google.com/p/protobuf-java-format/)\n+For protobuf-java-format libraries (http://code.google.com/p/protobuf-java-format/) :\n \n Copyright 2000-2011 NeuStar, Inc. All rights reserved.\n NeuStar, the Neustar logo and related names and logos are registered\n@@ -375,6 +444,8 @@ THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n \n ------------------------------------------------------------------------------\n+For jQuery libraries (http://jquery.com/) :\n+\n Copyright 2013 jQuery Foundation and other contributors\n http://jquery.com/\n \n@@ -398,6 +469,8 @@ OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n \n ------------------------------------------------------------------------------\n+For jsPlumb libraries (http://jsplumb.org/) :\n+\n Copyright (c) 2013 Simon Porritt, http://jsplumb.org/\n \n Permission is hereby granted, free of charge, to any person obtaining",
                "raw_url": "https://github.com/apache/tajo/raw/b55918bd1dc32a1b034bb67a47114a92bce24b48/LICENSE.txt",
                "sha": "6600131a08f05e31339f048c72f24c72728b78dc",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tajo/blob/b55918bd1dc32a1b034bb67a47114a92bce24b48/NOTICE.txt",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/NOTICE.txt?ref=b55918bd1dc32a1b034bb67a47114a92bce24b48",
                "deletions": 2,
                "filename": "NOTICE.txt",
                "patch": "@@ -7,12 +7,15 @@ Foundation (http://www.apache.org/).\n This product includes/uses Jetty (http://jetty.mortbay.org/),\n Copyright (c) Mort Bay Consulting Pty. Ltd. (Australia)\n \n-This product includes/uses Netty (http://www.jboss.org/netty)\n-Copyright 2009 Red Hat, Inc.\n+This product includes/uses Netty (http://netty.io)\n+Copyright 2011 The Netty Project.\n \n This product includes/uses ANTLR (http://www.antlr.org/),\n Copyright (c) 2010 Terence Parr.\n \n+This product includes/uses Mockito (http://code.google.com/p/mockito/)\n+Copyright (c) 2007 Mockito contributors.\n+\n This product includes/uses JLine2 (https://github.com/jline/jline2/),\n Copyright (c) 2002-2012, the original author or authors.\n ",
                "raw_url": "https://github.com/apache/tajo/raw/b55918bd1dc32a1b034bb67a47114a92bce24b48/NOTICE.txt",
                "sha": "e3c4ba81ac37409877fac39b728f95f3a3b43675",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/b55918bd1dc32a1b034bb67a47114a92bce24b48/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/eval/BasicEvalNodeVisitor.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/eval/BasicEvalNodeVisitor.java?ref=b55918bd1dc32a1b034bb67a47114a92bce24b48",
                "deletions": 6,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/eval/BasicEvalNodeVisitor.java",
                "patch": "@@ -197,12 +197,7 @@ public RESULT visitOr(CONTEXT context, BinaryEval evalNode, Stack<EvalNode> stac\n   public RESULT visitNot(CONTEXT context, NotEval evalNode, Stack<EvalNode> stack) {\n     RESULT result;\n     stack.push(evalNode);\n-    if (evalNode.getChild() instanceof NotEval) {\n-      result = visitChild(context, evalNode, stack);\n-    } else {\n-      result = visitChild(context, evalNode.getLeftExpr(), stack);\n-      visitChild(context, evalNode.getRightExpr(), stack);\n-    }\n+    result = visitChild(context, evalNode.getChild(), stack);\n     stack.pop();\n \n     return result;",
                "raw_url": "https://github.com/apache/tajo/raw/b55918bd1dc32a1b034bb67a47114a92bce24b48/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/eval/BasicEvalNodeVisitor.java",
                "sha": "8643ba66a21ffc5d79c656c053b74278b39ef14c",
                "status": "modified"
            },
            {
                "additions": 13,
                "blob_url": "https://github.com/apache/tajo/blob/b55918bd1dc32a1b034bb67a47114a92bce24b48/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/eval/NotEval.java",
                "changes": 38,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/eval/NotEval.java?ref=b55918bd1dc32a1b034bb67a47114a92bce24b48",
                "deletions": 25,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/eval/NotEval.java",
                "patch": "@@ -18,7 +18,6 @@\n \n package org.apache.tajo.engine.eval;\n \n-import com.google.common.base.Preconditions;\n import com.google.gson.annotations.Expose;\n import org.apache.tajo.catalog.CatalogUtil;\n import org.apache.tajo.catalog.Schema;\n@@ -29,24 +28,23 @@\n import org.apache.tajo.storage.Tuple;\n \n public class NotEval extends EvalNode implements Cloneable {\n-  @Expose private EvalNode subExpr;\n+  @Expose private EvalNode childEval;\n   private static final DataType RES_TYPE = CatalogUtil.newSimpleDataType(TajoDataTypes.Type.BOOLEAN);\n \n-  public NotEval(EvalNode subExpr) {\n+  public NotEval(EvalNode childEval) {\n     super(EvalType.NOT);\n-    Preconditions.checkArgument(subExpr instanceof BinaryEval || subExpr instanceof NotEval);\n-    this.subExpr = subExpr;\n+    this.childEval = childEval;\n   }\n \n   @Override\n   public EvalContext newContext() {\n     NotEvalCtx newCtx = new NotEvalCtx();\n-    newCtx.subExprCtx = subExpr.newContext();\n+    newCtx.childExprCtx = childEval.newContext();\n     return newCtx;\n   }\n \n   public EvalNode getChild() {\n-    return subExpr;\n+    return childEval;\n   }\n \n   @Override\n@@ -61,46 +59,36 @@ public String getName() {\n \n   @Override\n   public void eval(EvalContext ctx, Schema schema, Tuple tuple) {\n-    subExpr.eval(((NotEvalCtx)ctx).subExprCtx, schema, tuple);\n+    childEval.eval(((NotEvalCtx) ctx).childExprCtx, schema, tuple);\n   }\n \n   @Override\n   public Datum terminate(EvalContext ctx) {\n-    return DatumFactory.createBool(!subExpr.terminate(((NotEvalCtx)ctx).subExprCtx).asBool());\n+    return DatumFactory.createBool(!childEval.terminate(((NotEvalCtx) ctx).childExprCtx).asBool());\n   }\n \n   @Override\n   public String toString() {\n-    return \"NOT \" + subExpr.toString();\n+    return \"NOT \" + childEval.toString();\n   }\n \n   @Override\n   public void preOrder(EvalNodeVisitor visitor) {\n     visitor.visit(this);\n-    if (subExpr instanceof NotEval) {\n-      ((NotEval)subExpr).subExpr.preOrder(visitor);\n-    } else {\n-      subExpr.leftExpr.preOrder(visitor);\n-      subExpr.rightExpr.preOrder(visitor);\n-    }\n+    childEval.preOrder(visitor);\n   }\n \n   @Override\n   public void postOrder(EvalNodeVisitor visitor) {    \n-    if (subExpr instanceof NotEval) {\n-      ((NotEval)subExpr).subExpr.preOrder(visitor);\n-    } else {\n-      subExpr.leftExpr.preOrder(visitor);\n-      subExpr.rightExpr.preOrder(visitor);\n-    }\n+    childEval.postOrder(visitor);\n     visitor.visit(this);\n   }\n \n   @Override\n   public boolean equals(Object obj) {\n     if (obj instanceof NotEval) {\n       NotEval other = (NotEval) obj;\n-      return this.subExpr.equals(other.subExpr);\n+      return this.childEval.equals(other.childEval);\n     } else {\n       return false;\n     }\n@@ -109,11 +97,11 @@ public boolean equals(Object obj) {\n   @Override\n   public Object clone() throws CloneNotSupportedException {\n     NotEval eval = (NotEval) super.clone();\n-    eval.subExpr = (EvalNode) this.subExpr.clone();\n+    eval.childEval = (EvalNode) this.childEval.clone();\n     return eval;\n   }\n \n   private class NotEvalCtx implements EvalContext {\n-    EvalContext subExprCtx;\n+    EvalContext childExprCtx;\n   }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/b55918bd1dc32a1b034bb67a47114a92bce24b48/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/eval/NotEval.java",
                "sha": "a45e96d13652dd50c748b01f6c29819ee48ad859",
                "status": "modified"
            },
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/tajo/blob/b55918bd1dc32a1b034bb67a47114a92bce24b48/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/TestPredicates.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/TestPredicates.java?ref=b55918bd1dc32a1b034bb67a47114a92bce24b48",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/TestPredicates.java",
                "patch": "@@ -23,6 +23,7 @@\n \n import java.io.IOException;\n \n+import static org.apache.tajo.common.TajoDataTypes.Type.BOOLEAN;\n import static org.apache.tajo.common.TajoDataTypes.Type.INT4;\n import static org.apache.tajo.common.TajoDataTypes.Type.TEXT;\n \n@@ -130,6 +131,17 @@ public void testBooleanTest() throws IOException {\n     testSimpleEval(\"select not (1 > 3 is not true)\", new String [] {\"f\"});\n     testSimpleEval(\"select not (1 > 3 is false)\", new String [] {\"f\"});\n     testSimpleEval(\"select not (1 > 3 is not false)\", new String [] {\"t\"});\n+  }\n \n+  @Test\n+  public void testBooleanTestOnTable() throws IOException {\n+    Schema schema = new Schema();\n+    schema.addColumn(\"col1\", BOOLEAN);\n+    schema.addColumn(\"col2\", BOOLEAN);\n+    testEval(schema, \"table1\", \"t,f\", \"select col1 is true, col2 is false from table1\", new String [] {\"t\", \"t\"});\n+    testEval(schema, \"table1\", \"t,f\", \"select col1 is not true, col2 is not false from table1\",\n+        new String [] {\"f\", \"f\"});\n+    testEval(schema, \"table1\", \"t,f\", \"select not col1 is not true, not col2 is not false from table1\",\n+        new String [] {\"t\", \"t\"});\n   }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/b55918bd1dc32a1b034bb67a47114a92bce24b48/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/eval/TestPredicates.java",
                "sha": "9005b427753cbad1beb6b39d742d84dfc60c237a",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/b55918bd1dc32a1b034bb67a47114a92bce24b48/tajo-dist/src/main/bin/tajo-daemons.sh",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-dist/src/main/bin/tajo-daemons.sh?ref=b55918bd1dc32a1b034bb67a47114a92bce24b48",
                "deletions": 1,
                "filename": "tajo-dist/src/main/bin/tajo-daemons.sh",
                "patch": "@@ -42,7 +42,7 @@ bin=`cd \"$bin\"; pwd`\n \n # If the workers file is specified in the command line,\n # then it takes precedence over the definition in\n-# neptune-env.sh. Save it here.\n+# tajo-env.sh. Save it here.\n HOSTLIST=$TAJO_WORKERS\n \n if [ -f \"${TAJO_CONF_DIR}/tajo-env.sh\" ]; then",
                "raw_url": "https://github.com/apache/tajo/raw/b55918bd1dc32a1b034bb67a47114a92bce24b48/tajo-dist/src/main/bin/tajo-daemons.sh",
                "sha": "90c7a1f07eb0195f8c3c35ebb5ae752f1d220232",
                "status": "modified"
            }
        ],
        "message": "TAJO-273: NotEval incurs NPE with boolean column. (hyunsik)",
        "parent": "https://github.com/apache/tajo/commit/5855b00c262ea291b9a0298e0d5b89074599a50f",
        "patched_files": [
            "NotEval.java",
            "NOTICE.txt",
            "CHANGES.txt",
            "BasicEvalNodeVisitor.java",
            "LICENSE.txt",
            "tajo-daemons.sh"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestPredicates.java"
        ]
    },
    "tajo_bccac70": {
        "bug_id": "tajo_bccac70",
        "commit": "https://github.com/apache/tajo/commit/bccac701d5c3467ec7d7b39a1f1dd10b73cadf76",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/bccac701d5c3467ec7d7b39a1f1dd10b73cadf76/CHANGES",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=bccac701d5c3467ec7d7b39a1f1dd10b73cadf76",
                "deletions": 0,
                "filename": "CHANGES",
                "patch": "@@ -155,6 +155,8 @@ Release 0.9.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-962: Column reference used in LIMIT clause incurs NPE.\n+\n     TAJO-1074: Query calculates wrong progress before subquery init. (jinho)\n \n     TAJO-1025: Network disconnection during query processing can cause ",
                "raw_url": "https://github.com/apache/tajo/raw/bccac701d5c3467ec7d7b39a1f1dd10b73cadf76/CHANGES",
                "sha": "67972e569243967ba2e05188d49e8e6551a87e0f",
                "status": "modified"
            },
            {
                "additions": 14,
                "blob_url": "https://github.com/apache/tajo/blob/bccac701d5c3467ec7d7b39a1f1dd10b73cadf76/tajo-core/src/main/java/org/apache/tajo/engine/planner/PreLogicalPlanVerifier.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/planner/PreLogicalPlanVerifier.java?ref=bccac701d5c3467ec7d7b39a1f1dd10b73cadf76",
                "deletions": 0,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/planner/PreLogicalPlanVerifier.java",
                "patch": "@@ -89,6 +89,20 @@ public Expr visitProjection(Context context, Stack<Expr> stack, Projection expr)\n     return expr;\n   }\n \n+  @Override\n+  public Expr visitLimit(Context context, Stack<Expr> stack, Limit expr) throws PlanningException {\n+    stack.push(expr);\n+\n+    if (ExprFinder.finds(expr.getFetchFirstNum(), OpType.Column).size() > 0) {\n+      context.state.addVerification(\"argument of LIMIT must not contain variables\");\n+    }\n+\n+    visit(context, stack, expr.getFetchFirstNum());\n+    Expr result = visit(context, stack, expr.getChild());\n+    stack.pop();\n+    return result;\n+  }\n+\n   @Override\n   public Expr visitGroupBy(Context context, Stack<Expr> stack, Aggregation expr) throws PlanningException {\n     super.visitGroupBy(context, stack, expr);",
                "raw_url": "https://github.com/apache/tajo/raw/bccac701d5c3467ec7d7b39a1f1dd10b73cadf76/tajo-core/src/main/java/org/apache/tajo/engine/planner/PreLogicalPlanVerifier.java",
                "sha": "f6d5540320c51871fa6756331c77cc0a86f82956",
                "status": "modified"
            },
            {
                "additions": 21,
                "blob_url": "https://github.com/apache/tajo/blob/bccac701d5c3467ec7d7b39a1f1dd10b73cadf76/tajo-core/src/main/java/org/apache/tajo/master/GlobalEngine.java",
                "changes": 21,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/master/GlobalEngine.java?ref=bccac701d5c3467ec7d7b39a1f1dd10b73cadf76",
                "deletions": 0,
                "filename": "tajo-core/src/main/java/org/apache/tajo/master/GlobalEngine.java",
                "patch": "@@ -18,6 +18,7 @@\n \n package org.apache.tajo.master;\n \n+import com.google.common.annotations.VisibleForTesting;\n import com.google.common.base.Preconditions;\n import com.google.protobuf.ByteString;\n import org.apache.commons.logging.Log;\n@@ -115,6 +116,26 @@ public void stop() {\n     super.stop();\n   }\n \n+  @VisibleForTesting\n+  public SQLAnalyzer getAnalyzer() {\n+    return analyzer;\n+  }\n+\n+  @VisibleForTesting\n+  public PreLogicalPlanVerifier getPreLogicalPlanVerifier() {\n+    return preVerifier;\n+  }\n+\n+  @VisibleForTesting\n+  public LogicalPlanner getLogicalPlanner() {\n+    return planner;\n+  }\n+\n+  @VisibleForTesting\n+  public LogicalOptimizer getLogicalOptimizer() {\n+    return optimizer;\n+  }\n+\n   private QueryContext createQueryContext(Session session) {\n     QueryContext newQueryContext =  new QueryContext(context.getConf(), session);\n ",
                "raw_url": "https://github.com/apache/tajo/raw/bccac701d5c3467ec7d7b39a1f1dd10b73cadf76/tajo-core/src/main/java/org/apache/tajo/master/GlobalEngine.java",
                "sha": "9612eeb02f2403d610fdcbda495b2b0501fec8e6",
                "status": "modified"
            },
            {
                "additions": 74,
                "blob_url": "https://github.com/apache/tajo/blob/bccac701d5c3467ec7d7b39a1f1dd10b73cadf76/tajo-core/src/test/java/org/apache/tajo/engine/planner/TestPreLogicalPlanVerifier.java",
                "changes": 74,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/java/org/apache/tajo/engine/planner/TestPreLogicalPlanVerifier.java?ref=bccac701d5c3467ec7d7b39a1f1dd10b73cadf76",
                "deletions": 0,
                "filename": "tajo-core/src/test/java/org/apache/tajo/engine/planner/TestPreLogicalPlanVerifier.java",
                "patch": "@@ -0,0 +1,74 @@\n+/*\n+ * Lisensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.tajo.engine.planner;\n+\n+import org.apache.tajo.LocalTajoTestingUtility;\n+import org.apache.tajo.QueryTestCaseBase;\n+import org.apache.tajo.algebra.Expr;\n+import org.apache.tajo.engine.parser.SQLAnalyzer;\n+import org.apache.tajo.engine.query.QueryContext;\n+import org.apache.tajo.master.GlobalEngine;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import static org.junit.Assert.fail;\n+\n+public class TestPreLogicalPlanVerifier extends QueryTestCaseBase {\n+\n+  private static SQLAnalyzer analyzer;\n+  private static PreLogicalPlanVerifier verifier;\n+\n+  @BeforeClass\n+  public static void setUp() {\n+    GlobalEngine engine = testingCluster.getMaster().getContext().getGlobalEngine();\n+    analyzer = engine.getAnalyzer();\n+    verifier = engine.getPreLogicalPlanVerifier();\n+  }\n+\n+  public static VerificationState verify(String query) throws PlanningException {\n+\n+    VerificationState state = new VerificationState();\n+    QueryContext context = LocalTajoTestingUtility.createDummyContext(conf);\n+\n+    Expr expr = analyzer.parse(query);\n+    verifier.verify(context, state, expr);\n+\n+    return state;\n+  }\n+\n+  public static void valid(String query) throws PlanningException {\n+    VerificationState state = verify(query);\n+    if (state.errorMessages.size() > 0) {\n+      fail(state.getErrorMessages().get(0));\n+    }\n+  }\n+\n+  public static void invalid(String query) throws PlanningException {\n+    VerificationState state = verify(query);\n+    if (state.errorMessages.size() == 0) {\n+      fail(PreLogicalPlanVerifier.class.getSimpleName() + \" cannot catch any verification error: \" + query);\n+    }\n+  }\n+\n+  @Test\n+  public void testLimitWithFieldReference() throws PlanningException {\n+    valid(\"select * from lineitem limit 3\");\n+    invalid(\"select * from lineitem limit l_orderkey\");\n+  }\n+}",
                "raw_url": "https://github.com/apache/tajo/raw/bccac701d5c3467ec7d7b39a1f1dd10b73cadf76/tajo-core/src/test/java/org/apache/tajo/engine/planner/TestPreLogicalPlanVerifier.java",
                "sha": "b009785706bb127d1c8561bc564b6965e815d6c8",
                "status": "added"
            }
        ],
        "message": "TAJO-962: Column reference used in LIMIT clause incurs NPE.\n\nCloses #164",
        "parent": "https://github.com/apache/tajo/commit/35e49f039ccabf46d8cf20511c189aea7c15571a",
        "patched_files": [
            "PreLogicalPlanVerifier.java",
            "CHANGES",
            "GlobalEngine.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestPreLogicalPlanVerifier.java"
        ]
    },
    "tajo_c46dc1a": {
        "bug_id": "tajo_c46dc1a",
        "commit": "https://github.com/apache/tajo/commit/c46dc1a64f9528adc5f2a54db3bc6aa247252b84",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/c46dc1a64f9528adc5f2a54db3bc6aa247252b84/CHANGES",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=c46dc1a64f9528adc5f2a54db3bc6aa247252b84",
                "deletions": 0,
                "filename": "CHANGES",
                "patch": "@@ -200,6 +200,9 @@ Release 0.11.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-1712: querytasks.jsp throws NPE occasionally when tasks are running.\n+    (jinho)\n+\n     TAJO-1716: Repartitioner.makeEvenDistributedFetchImpl() does not distribute \n     fetches evenly. (jihoon)\n ",
                "raw_url": "https://github.com/apache/tajo/raw/c46dc1a64f9528adc5f2a54db3bc6aa247252b84/CHANGES",
                "sha": "1389b6f6930a709135ae28deb76111cc09519586",
                "status": "modified"
            },
            {
                "additions": 38,
                "blob_url": "https://github.com/apache/tajo/blob/c46dc1a64f9528adc5f2a54db3bc6aa247252b84/tajo-core/src/main/java/org/apache/tajo/master/QueryManager.java",
                "changes": 44,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/master/QueryManager.java?ref=c46dc1a64f9528adc5f2a54db3bc6aa247252b84",
                "deletions": 6,
                "filename": "tajo-core/src/main/java/org/apache/tajo/master/QueryManager.java",
                "patch": "@@ -18,6 +18,7 @@\n \n package org.apache.tajo.master;\n \n+import com.google.common.collect.Lists;\n import com.google.common.collect.Maps;\n import com.google.common.collect.Sets;\n import org.apache.commons.collections.map.LRUMap;\n@@ -44,10 +45,7 @@\n import org.apache.tajo.util.history.HistoryReader;\n \n import java.io.IOException;\n-import java.util.Collection;\n-import java.util.Collections;\n-import java.util.Map;\n-import java.util.Set;\n+import java.util.*;\n import java.util.concurrent.atomic.AtomicLong;\n \n /**\n@@ -119,17 +117,51 @@ public EventHandler getEventHandler() {\n     return Collections.unmodifiableCollection(runningQueries.values());\n   }\n \n+  @Deprecated\n   public Collection<QueryInfo> getFinishedQueries() {\n     Set<QueryInfo> result = Sets.newTreeSet();\n+\n     synchronized (historyCache) {\n       result.addAll(historyCache.values());\n     }\n \n     try {\n       synchronized (this) {\n-        result.addAll(this.masterContext.getHistoryReader().getQueries(null));\n+        result.addAll(this.masterContext.getHistoryReader().getQueriesInHistory());\n+      }\n+      return result;\n+    } catch (Throwable e) {\n+      LOG.error(e, e);\n+      return result;\n+    }\n+  }\n+\n+  /**\n+   * Get query history in cache or persistent storage\n+   */\n+  public Collection<QueryInfo> getFinishedQueries(int page, int size) {\n+    TreeSet<QueryInfo> result = Sets.newTreeSet();\n+    if(page <= 0 || size <= 0) {\n+      return result;\n+    }\n+\n+    List<QueryInfo> cacheList = Lists.newArrayList();\n+    synchronized (historyCache) {\n+      // request size fits in cache\n+      if (page == 1 && size <= historyCache.size()) {\n+        cacheList.addAll(historyCache.values());\n       }\n+    }\n+\n+    if (cacheList.size() > 0) {\n+      result.addAll(cacheList.subList(0, size));\n       return result;\n+    }\n+\n+    try {\n+      synchronized (this) {\n+        return this.masterContext.getHistoryReader().getQueriesInHistory(page, size);\n+      }\n     } catch (Throwable e) {\n       LOG.error(e, e);\n       return result;\n@@ -144,7 +176,7 @@ public QueryInfo getFinishedQuery(QueryId queryId) {\n       }\n       if (queryInfo == null) {\n         synchronized (this) {\n-          queryInfo = this.masterContext.getHistoryReader().getQueryInfo(queryId.toString());\n+          queryInfo = this.masterContext.getHistoryReader().getQueryByQueryId(queryId);\n         }\n       }\n       return queryInfo;",
                "raw_url": "https://github.com/apache/tajo/raw/c46dc1a64f9528adc5f2a54db3bc6aa247252b84/tajo-core/src/main/java/org/apache/tajo/master/QueryManager.java",
                "sha": "8be298ec35ebc62d6ccf1dad184867dc8655f7b9",
                "status": "modified"
            },
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/tajo/blob/c46dc1a64f9528adc5f2a54db3bc6aa247252b84/tajo-core/src/main/java/org/apache/tajo/util/JSPUtil.java",
                "changes": 19,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/util/JSPUtil.java?ref=c46dc1a64f9528adc5f2a54db3bc6aa247252b84",
                "deletions": 0,
                "filename": "tajo-core/src/main/java/org/apache/tajo/util/JSPUtil.java",
                "patch": "@@ -355,6 +355,25 @@ public static String getPageNavigation(int currentPage, int totalPage, String ur\n     return sb.toString();\n   }\n \n+  public static String getPageNavigation(int currentPage, boolean next, String url) {\n+    StringBuilder sb = new StringBuilder();\n+    if (currentPage > 1) {\n+      sb.append(\"<a href='\").append(url)\n+          .append(\"&page=\").append(currentPage - 1).append(\"'>\")\n+          .append(\"&lt;prev</a>\");\n+      sb.append(\"&nbsp;&nbsp;\");\n+    }\n+\n+    sb.append(currentPage);\n+\n+    if(next) {\n+      sb.append(\"&nbsp;&nbsp;\").append(\"<a href='\").append(url)\n+          .append(\"&page=\").append(currentPage + 1).append(\"'>\")\n+          .append(\"next&gt;</a>\");\n+    }\n+    return sb.toString();\n+  }\n+\n   public static <T extends Object> List<T> getPageNavigationList(List<T> originList, int page, int pageSize) {\n     if (originList == null) {\n       return new ArrayList<T>();",
                "raw_url": "https://github.com/apache/tajo/raw/c46dc1a64f9528adc5f2a54db3bc6aa247252b84/tajo-core/src/main/java/org/apache/tajo/util/JSPUtil.java",
                "sha": "1d93c3c491a397a095ffe776a8f2704186f03353",
                "status": "modified"
            },
            {
                "additions": 66,
                "blob_url": "https://github.com/apache/tajo/blob/c46dc1a64f9528adc5f2a54db3bc6aa247252b84/tajo-core/src/main/java/org/apache/tajo/util/history/HistoryReader.java",
                "changes": 100,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/util/history/HistoryReader.java?ref=c46dc1a64f9528adc5f2a54db3bc6aa247252b84",
                "deletions": 34,
                "filename": "tajo-core/src/main/java/org/apache/tajo/util/history/HistoryReader.java",
                "patch": "@@ -18,16 +18,19 @@\n \n package org.apache.tajo.util.history;\n \n+import org.apache.commons.lang.ArrayUtils;\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.hadoop.fs.FSDataInputStream;\n import org.apache.hadoop.fs.FileStatus;\n import org.apache.hadoop.fs.FileSystem;\n import org.apache.hadoop.fs.Path;\n import org.apache.hadoop.io.IOUtils;\n+import org.apache.tajo.QueryId;\n+import org.apache.tajo.ResourceProtos.TaskHistoryProto;\n import org.apache.tajo.TaskAttemptId;\n+import org.apache.tajo.annotation.Nullable;\n import org.apache.tajo.conf.TajoConf;\n-import org.apache.tajo.ResourceProtos.TaskHistoryProto;\n import org.apache.tajo.master.QueryInfo;\n import org.apache.tajo.util.Bytes;\n \n@@ -54,15 +57,36 @@ public HistoryReader(String processName, TajoConf tajoConf) throws IOException {\n     taskHistoryParentPath = tajoConf.getTaskHistoryDir(tajoConf);\n   }\n \n-  public List<QueryInfo> getQueries(String keyword) throws IOException {\n+  @Deprecated\n+  public List<QueryInfo> getQueriesInHistory() throws IOException {\n+    return getQueriesInHistory(-1, Integer.MAX_VALUE);\n+  }\n+\n+  public List<QueryInfo> getQueriesInHistory(int page, int size) throws IOException {\n+    List<QueryInfo> queryList = getQueryInfoInHistory(page, size, null);\n+    if (queryList.size() > size) {\n+      queryList = queryList.subList(0, size);\n+    }\n+\n+    Collections.sort(queryList, new Comparator<QueryInfo>() {\n+      @Override\n+      public int compare(QueryInfo query1, QueryInfo query2) {\n+        return query2.compareTo(query1);\n+      }\n+    });\n+\n+    return queryList;\n+  }\n+\n+  private List<QueryInfo> getQueryInfoInHistory(int page, int size, @Nullable QueryId queryId) throws IOException {\n     List<QueryInfo> queryInfos = new ArrayList<QueryInfo>();\n \n     FileSystem fs = HistoryWriter.getNonCrcFileSystem(historyParentPath, tajoConf);\n     try {\n       if (!fs.exists(historyParentPath)) {\n         return queryInfos;\n       }\n-    } catch (Throwable e){\n+    } catch (Throwable e) {\n       return queryInfos;\n     }\n \n@@ -71,7 +95,11 @@ public HistoryReader(String processName, TajoConf tajoConf) throws IOException {\n       return queryInfos;\n     }\n \n-    for (FileStatus eachDateFile: files) {\n+    int startIndex = page < 1 ? page : (page - 1) * size; // set index to last index of previous page\n+    int currentIndex = 0;\n+\n+    ArrayUtils.reverse(files);\n+    for (FileStatus eachDateFile : files) {\n       Path queryListPath = new Path(eachDateFile.getPath(), HistoryWriter.QUERY_LIST);\n       if (eachDateFile.isFile() || !fs.exists(queryListPath)) {\n         continue;\n@@ -82,52 +110,70 @@ public HistoryReader(String processName, TajoConf tajoConf) throws IOException {\n         continue;\n       }\n \n-      for (FileStatus eachFile: dateFiles) {\n+      ArrayUtils.reverse(dateFiles);\n+      for (FileStatus eachFile : dateFiles) {\n         Path path = eachFile.getPath();\n         if (eachFile.isDirectory() || !path.getName().endsWith(HistoryWriter.HISTORY_FILE_POSTFIX)) {\n           continue;\n         }\n \n         FSDataInputStream in = null;\n+        long totalLength = 0;\n+\n         try {\n           in = fs.open(path);\n \n-          byte[] buf = new byte[100 * 1024];\n-          while (true) {\n+          while (totalLength < eachFile.getLen()) {\n             int length = in.readInt();\n-            if (length > buf.length) {\n-              buf = new byte[length];\n+            totalLength += 4;\n+\n+            currentIndex++;\n+            //skip previous page\n+            if (startIndex >= currentIndex) {\n+              totalLength += in.skipBytes(length);\n+              continue;\n             }\n+\n+            byte[] buf = new byte[length];\n             in.readFully(buf, 0, length);\n+            totalLength += length;\n+\n             String queryInfoJson = new String(buf, 0, length, Bytes.UTF8_CHARSET);\n             QueryInfo queryInfo = QueryInfo.fromJson(queryInfoJson);\n-            if (keyword != null) {\n-              if (queryInfo.getSql().indexOf(keyword) >= 0) {\n+\n+            if (queryId != null) {\n+              if (queryInfo.getQueryId().equals(queryId)) {\n                 queryInfos.add(queryInfo);\n+                return queryInfos;\n               }\n             } else {\n               queryInfos.add(queryInfo);\n             }\n           }\n-        } catch (EOFException e) {\n         } catch (Throwable e) {\n-          LOG.warn(\"Reading error:\" + path + \", \" +e.getMessage());\n+          LOG.warn(\"Reading error:\" + path + \", \" + e.getMessage());\n         } finally {\n           IOUtils.cleanup(LOG, in);\n         }\n-      }\n-    }\n \n-    Collections.sort(queryInfos, new Comparator<QueryInfo>() {\n-      @Override\n-      public int compare(QueryInfo query1, QueryInfo query2) {\n-        return query2.getQueryIdStr().toString().compareTo(query1.getQueryIdStr().toString());\n+        if (queryInfos.size() >= size) {\n+          return queryInfos;\n+        }\n       }\n-    });\n+    }\n \n     return queryInfos;\n   }\n \n+  public QueryInfo getQueryByQueryId(QueryId queryId) throws IOException {\n+    List<QueryInfo> queryInfoList = getQueryInfoInHistory(-1, Integer.MAX_VALUE, queryId);\n+    if (queryInfoList.size() > 0) {\n+      return queryInfoList.get(0);\n+    } else {\n+      return null;\n+    }\n+  }\n+\n   private Path getQueryHistoryFilePath(String queryId, long startTime) throws IOException {\n     if (startTime == 0) {\n       String[] tokens = queryId.split(\"_\");\n@@ -298,18 +344,4 @@ public QueryHistory getQueryHistory(String queryId, long startTime) throws IOExc\n     }\n     return null;\n   }\n-\n-  public QueryInfo getQueryInfo(String queryId) throws IOException {\n-    List<QueryInfo> queries = getQueries(null);\n-\n-    if (queries != null) {\n-      for (QueryInfo queryInfo: queries) {\n-        if (queryId.equals(queryInfo.getQueryId().toString())) {\n-          return queryInfo;\n-        }\n-      }\n-    }\n-\n-    return null;\n-  }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/c46dc1a64f9528adc5f2a54db3bc6aa247252b84/tajo-core/src/main/java/org/apache/tajo/util/history/HistoryReader.java",
                "sha": "27d823e40b26c41c22e9c0059ee690942d8c68a1",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/c46dc1a64f9528adc5f2a54db3bc6aa247252b84/tajo-core/src/main/resources/webapps/admin/query.jsp",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/resources/webapps/admin/query.jsp?ref=c46dc1a64f9528adc5f2a54db3bc6aa247252b84",
                "deletions": 9,
                "filename": "tajo-core/src/main/resources/webapps/admin/query.jsp",
                "patch": "@@ -59,14 +59,9 @@\n     }\n   }\n \n-  List<QueryInfo> allFinishedQueries = new ArrayList<QueryInfo>(master.getContext().getQueryJobManager().getFinishedQueries());\n-  Collections.sort(allFinishedQueries, java.util.Collections.reverseOrder());\n-\n-  int numOfFinishedQueries = allFinishedQueries.size();\n-  int totalPage = numOfFinishedQueries % pageSize == 0 ?\n-      numOfFinishedQueries / pageSize : numOfFinishedQueries / pageSize + 1;\n-\n-  List<QueryInfo> finishedQueries = JSPUtil.getPageNavigationList(allFinishedQueries, currentPage, pageSize);\n+  List<QueryInfo> finishedQueries = new ArrayList<QueryInfo>(\n+          master.getContext().getQueryJobManager().getFinishedQueries(currentPage, pageSize));\n+  Collections.sort(finishedQueries, java.util.Collections.reverseOrder());\n \n   SimpleDateFormat df = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");\n \n@@ -220,7 +215,7 @@\n     %>\n   </table>\n   <div align=\"center\">\n-    <%=JSPUtil.getPageNavigation(currentPage, totalPage, \"query.jsp?pageSize=\" + pageSize)%>\n+      <%=JSPUtil.getPageNavigation(currentPage, finishedQueries.size() == pageSize, \"query.jsp?pageSize=\" + pageSize)%>\n   </div>\n   <p/>\n <%",
                "raw_url": "https://github.com/apache/tajo/raw/c46dc1a64f9528adc5f2a54db3bc6aa247252b84/tajo-core/src/main/resources/webapps/admin/query.jsp",
                "sha": "7422a03d16f6cae9fc1a6e566bb1a5c24d35ebb2",
                "status": "modified"
            },
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/tajo/blob/c46dc1a64f9528adc5f2a54db3bc6aa247252b84/tajo-core/src/main/resources/webapps/worker/querytasks.jsp",
                "changes": 18,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/resources/webapps/worker/querytasks.jsp?ref=c46dc1a64f9528adc5f2a54db3bc6aa247252b84",
                "deletions": 7,
                "filename": "tajo-core/src/main/resources/webapps/worker/querytasks.jsp",
                "patch": "@@ -111,16 +111,18 @@\n \n   float totalProgress = 0.0f;\n   for(Task eachTask : allTasks) {\n-    totalProgress += eachTask.getLastAttempt() != null ? eachTask.getLastAttempt().getProgress(): 0.0f;\n+\n     numShuffles = eachTask.getShuffleOutpuNum();\n-    if (eachTask.getLastAttempt() != null) {\n-      TableStats inputStats = eachTask.getLastAttempt().getInputStats();\n+    TaskAttempt lastAttempt = eachTask.getLastAttempt();\n+    if (lastAttempt != null) {\n+      totalProgress +=  lastAttempt.getProgress();\n+      TableStats inputStats = lastAttempt.getInputStats();\n       if (inputStats != null) {\n         totalInputBytes += inputStats.getNumBytes();\n         totalReadBytes += inputStats.getReadBytes();\n         totalReadRows += inputStats.getNumRows();\n       }\n-      TableStats outputStats = eachTask.getLastAttempt().getResultStats();\n+      TableStats outputStats = lastAttempt.getResultStats();\n       if (outputStats != null) {\n         totalWriteBytes += outputStats.getNumBytes();\n         totalWriteRows += outputStats.getNumRows();\n@@ -231,18 +233,20 @@\n             \"&taskSeq=\" + taskSeq + \"&sort=\" + sort + \"&sortOrder=\" + sortOrder;\n \n     TaskAttempt lastAttempt = eachTask.getLastAttempt();\n-    String taskHost = lastAttempt == null ? \"-\" : lastAttempt.getWorkerConnectionInfo().getHost();\n-    if(lastAttempt != null) {\n+    String taskHost = \"-\";\n+    float progress = 0.0f;\n+    if(lastAttempt != null && lastAttempt.getWorkerConnectionInfo() != null) {\n       WorkerConnectionInfo conn = lastAttempt.getWorkerConnectionInfo();\n       TaskAttemptId lastAttemptId = lastAttempt.getId();\n       taskHost = \"<a href='http://\" + conn.getHost() + \":\" + conn.getHttpInfoPort() + \"/taskdetail.jsp?taskAttemptId=\" + lastAttemptId + \"'>\" + conn.getHost() + \"</a>\";\n+      progress = eachTask.getLastAttempt().getProgress();\n     }\n %>\n     <tr>\n       <td align='center'><%=rowNo%></td>\n       <td><a href=\"<%=taskDetailUrl%>\"><%=eachTask.getId()%></a></td>\n       <td align='center'><%=eachTask.getLastAttemptStatus()%></td>\n-      <td align='center'><%=JSPUtil.percentFormat(eachTask.getLastAttempt().getProgress())%>%</td>\n+      <td align='center'><%=JSPUtil.percentFormat(progress)%>%</td>\n       <td align='center'><%=eachTask.getLaunchTime() == 0 ? \"-\" : df.format(eachTask.getLaunchTime())%></td>\n       <td align='right'><%=eachTask.getLaunchTime() == 0 ? \"-\" : eachTask.getRunningTime() + \" ms\"%></td>\n       <td align='center'><%=eachTask.getRetryCount()%></td>",
                "raw_url": "https://github.com/apache/tajo/raw/c46dc1a64f9528adc5f2a54db3bc6aa247252b84/tajo-core/src/main/resources/webapps/worker/querytasks.jsp",
                "sha": "caaec35cc05a072dd361e69b0064b9a35c32ae5e",
                "status": "modified"
            },
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/tajo/blob/c46dc1a64f9528adc5f2a54db3bc6aa247252b84/tajo-core/src/test/java/org/apache/tajo/util/history/TestHistoryWriterReader.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/java/org/apache/tajo/util/history/TestHistoryWriterReader.java?ref=c46dc1a64f9528adc5f2a54db3bc6aa247252b84",
                "deletions": 1,
                "filename": "tajo-core/src/test/java/org/apache/tajo/util/history/TestHistoryWriterReader.java",
                "patch": "@@ -90,7 +90,7 @@ public void testQueryInfoReadAndWrite() throws Exception {\n       assertTrue(histFiles[0].getPath().getName().endsWith(\".hist\"));\n \n       HistoryReader reader = new HistoryReader(\"127.0.0.1:28090\", tajoConf);\n-      List<QueryInfo> queryInfos = reader.getQueries(null);\n+      List<QueryInfo> queryInfos = reader.getQueriesInHistory(1, 2);\n       assertNotNull(queryInfos);\n       assertEquals(2, queryInfos.size());\n \n@@ -99,10 +99,20 @@ public void testQueryInfoReadAndWrite() throws Exception {\n       assertEquals(queryInfo2.getQueryState(), foundQueryInfo.getQueryState());\n       assertEquals(queryInfo2.getProgress(), foundQueryInfo.getProgress(), 0);\n \n+      foundQueryInfo = reader.getQueryByQueryId(queryInfo2.getQueryId());\n+      assertEquals(queryInfo2.getQueryId(), foundQueryInfo.getQueryId());\n+      assertEquals(queryInfo2.getQueryState(), foundQueryInfo.getQueryState());\n+      assertEquals(queryInfo2.getProgress(), foundQueryInfo.getProgress(), 0);\n+\n       foundQueryInfo = queryInfos.get(1);\n       assertEquals(queryInfo1.getQueryId(), foundQueryInfo.getQueryId());\n       assertEquals(queryInfo1.getQueryState(), foundQueryInfo.getQueryState());\n       assertEquals(queryInfo1.getProgress(), foundQueryInfo.getProgress(), 0);\n+\n+      foundQueryInfo = reader.getQueryByQueryId(queryInfo1.getQueryId());\n+      assertEquals(queryInfo1.getQueryId(), foundQueryInfo.getQueryId());\n+      assertEquals(queryInfo1.getQueryState(), foundQueryInfo.getQueryState());\n+      assertEquals(queryInfo1.getProgress(), foundQueryInfo.getProgress(), 0);\n     } finally {\n       writer.stop();\n     }",
                "raw_url": "https://github.com/apache/tajo/raw/c46dc1a64f9528adc5f2a54db3bc6aa247252b84/tajo-core/src/test/java/org/apache/tajo/util/history/TestHistoryWriterReader.java",
                "sha": "aee418cf037653d4d388ac58c8d38892becbd67d",
                "status": "modified"
            }
        ],
        "message": "TAJO-1712: querytasks.jsp throws NPE occasionally when tasks are running. (jinho)\n\nCloses #657",
        "parent": "https://github.com/apache/tajo/commit/33f4b7a061d0b4f7867f89b32b880f686fe1dc51",
        "patched_files": [
            "JSPUtil.java",
            "querytasks.jsp",
            "query.jsp",
            "CHANGES",
            "QueryManager.java",
            "HistoryReader.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestJSPUtil.java",
            "TestHistoryWriterReader.java"
        ]
    },
    "tajo_cb0b74d": {
        "bug_id": "tajo_cb0b74d",
        "commit": "https://github.com/apache/tajo/commit/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/LeafServer.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/LeafServer.java?ref=cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f",
                "deletions": 0,
                "filename": "engine/src/main/java/nta/engine/LeafServer.java",
                "patch": "@@ -584,6 +584,7 @@ public Task(QueryUnitRequest request) throws IOException {\n           LogicalNode.class);      \n       interQuery = request.getProto().getInterQuery();\n       if (interQuery) {\n+        ctx.setInterQuery();\n         StoreTableNode store = (StoreTableNode) plan;\n         this.partitionType = store.getPartitionType();\n         if (store.getSubNode().getType() == ExprType.SORT) {\n@@ -699,6 +700,9 @@ public InProgressStatusProto getReport() {\n               part.setFileName(\n                   dataServerURL + \"/?qid=\" + getId().toString() + \"&fn=\" +\n                   entry.getValue());\n+            } else if (partitionType == ScheduleUnit.PARTITION_TYPE.LIST) {\n+              part.setFileName(dataServerURL + \"/?qid=\" + getId().toString() +\n+                  \"&fn=0\");\n             } else {\n               part.setFileName(dataServerURL + \"/?qid=\" + getId().toString());\n             }",
                "raw_url": "https://github.com/apache/tajo/raw/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/LeafServer.java",
                "sha": "5717c0a12304c5856110c7d3286b0b4a04f7dff9",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tajo/blob/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/QueryUnitScheduler.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/QueryUnitScheduler.java?ref=cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f",
                "deletions": 9,
                "filename": "engine/src/main/java/nta/engine/QueryUnitScheduler.java",
                "patch": "@@ -204,15 +204,6 @@ private void recursiveExecuteScheduleUnit(ScheduleUnit plan)\n   private QueryUnit[] prepareExecutionOfQueryUnits(QueryUnit[] units,\n                                                    boolean hasChild)\n       throws Exception {\n-    /*String hostName;\n-\n-    for (QueryUnit q : units) {\n-      hostName = getHost(q);\n-      q.setHost(hostName);\n-      pendingQueue.add(q);\n-      qm.updateQueryAssignInfo(hostName, q);\n-      this.queryUnitAttemptMap.put(q.getId(), 1);\n-    }*/\n     if (hasChild) {\n       for (QueryUnit q : units) {\n         q.setHost(cm.getRandomHost());",
                "raw_url": "https://github.com/apache/tajo/raw/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/QueryUnitScheduler.java",
                "sha": "d1c2e7a06d2ecfa0d1e12c4ce5f88a78a42cf97c",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/tajo/blob/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/SubqueryContext.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/SubqueryContext.java?ref=cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f",
                "deletions": 0,
                "filename": "engine/src/main/java/nta/engine/SubqueryContext.java",
                "patch": "@@ -45,6 +45,7 @@\n   private Map<Integer, String> repartitions;\n   private File fetchIn;\n   private boolean stopped = false;\n+  private boolean interQuery = false;\n   \n   @VisibleForTesting\n   SubqueryContext(final QueryUnitId queryId, final Fragment [] fragments, final File workDir) {\n@@ -106,6 +107,14 @@ public TableStat getResultStats() {\n   public boolean isStopped() {\n     return this.stopped;\n   }\n+\n+  public void setInterQuery() {\n+    this.interQuery = true;\n+  }\n+\n+  public boolean isInterQuery() {\n+    return this.interQuery;\n+  }\n   \n   public void stop() {\n     this.stopped = true;",
                "raw_url": "https://github.com/apache/tajo/raw/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/SubqueryContext.java",
                "sha": "e38d46921a386858fc430950b4d8879ab25fe475",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/cluster/QueryManager.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/cluster/QueryManager.java?ref=cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f",
                "deletions": 1,
                "filename": "engine/src/main/java/nta/engine/cluster/QueryManager.java",
                "patch": "@@ -186,7 +186,8 @@ public synchronized void updateQueryAssignInfo(String servername,\n   \n   public void updateProgress(QueryUnitId queryUnitId,\n       InProgressStatusProto progress) throws NoSuchQueryIdException {\n-    QueryUnit unit = queries.get(queryUnitId.getQueryId()).getQueryUnit(queryUnitId);\n+    QueryUnit unit = queries.get(queryUnitId.getQueryId()).\n+        getQueryUnit(queryUnitId);\n     if (unit != null\n         && (unit.getStatus() != QueryStatus.QUERY_FINISHED\n         || unit.getStatus() != QueryStatus.QUERY_ABORTED",
                "raw_url": "https://github.com/apache/tajo/raw/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/cluster/QueryManager.java",
                "sha": "94d97f860878bf572d000c2bcbc5d246938a497f",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/planner/global/GlobalOptimizer.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/planner/global/GlobalOptimizer.java?ref=cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f",
                "deletions": 1,
                "filename": "engine/src/main/java/nta/engine/planner/global/GlobalOptimizer.java",
                "patch": "@@ -56,7 +56,8 @@ private void reduceLogicalQueryUnitStep_(ScheduleUnit cur) {\n       it = prevs.iterator();\n       while (it.hasNext()) {\n         prev = it.next();\n-        if (prev.getOutputType() == PARTITION_TYPE.LIST) {\n+        if (prev.getStoreTableNode().getSubNode().getType() != ExprType.UNION &&\n+            prev.getOutputType() == PARTITION_TYPE.LIST) {\n           mergeLogicalUnits(cur, prev);\n         }\n       }",
                "raw_url": "https://github.com/apache/tajo/raw/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/planner/global/GlobalOptimizer.java",
                "sha": "1a8d031a6a5b4f1a29fad9ab5696559d15c53d63",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/planner/logical/StoreTableNode.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/planner/logical/StoreTableNode.java?ref=cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f",
                "deletions": 0,
                "filename": "engine/src/main/java/nta/engine/planner/logical/StoreTableNode.java",
                "patch": "@@ -56,6 +56,12 @@ public final void clearPartitions() {\n     this.partitionKeys = null;\n     this.numPartitions = 0;\n   }\n+\n+  public final void setListPartition() {\n+    this.partitionType = ScheduleUnit.PARTITION_TYPE.LIST;\n+    this.partitionKeys = null;\n+    this.numPartitions = 0;\n+  }\n   \n   public final void setPartitions(ScheduleUnit.PARTITION_TYPE type, Column [] keys, int numPartitions) {\n     Preconditions.checkArgument(keys.length >= 0, ",
                "raw_url": "https://github.com/apache/tajo/raw/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/planner/logical/StoreTableNode.java",
                "sha": "00d60fce063cf8caecb53e1b8a92b21bed9db4ce",
                "status": "modified"
            },
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/tajo/blob/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/planner/physical/StoreTableExec.java",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/planner/physical/StoreTableExec.java?ref=cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f",
                "deletions": 2,
                "filename": "engine/src/main/java/nta/engine/planner/physical/StoreTableExec.java",
                "patch": "@@ -13,7 +13,9 @@\n import nta.engine.planner.logical.StoreTableNode;\n import nta.storage.Appender;\n import nta.storage.StorageManager;\n+import nta.storage.StorageUtil;\n import nta.storage.Tuple;\n+import org.apache.hadoop.fs.Path;\n \n /**\n  * This physical operator stores a relation into a table.\n@@ -45,8 +47,15 @@ public StoreTableExec(SubqueryContext ctx, StorageManager sm,\n     this.outputSchema = this.annotation.getOutputSchema();\n     \n     TableMeta meta = TCatUtil.newTableMeta(this.outputSchema, StoreType.CSV);\n-    this.appender = sm.getAppender(meta,this.annotation.getTableName(),\n-        ctx.getQueryId().toString());\n+    if (ctx.isInterQuery()) {\n+      Path storeTablePath = new Path(ctx.getWorkDir().getAbsolutePath(), \"out\");\n+      sm.initLocalTableBase(storeTablePath, meta);\n+      this.appender = sm.getLocalAppender(meta,\n+          StorageUtil.concatPath(storeTablePath, \"data\", \"0\"));\n+    } else {\n+      this.appender = sm.getAppender(meta,this.annotation.getTableName(),\n+          ctx.getQueryId().toString());\n+    }\n   }\n \n   /* (non-Javadoc)",
                "raw_url": "https://github.com/apache/tajo/raw/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/planner/physical/StoreTableExec.java",
                "sha": "dbc8c788234749b7a56fdba03e9fde1ebc495985",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tajo/blob/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/query/GlobalEngine.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/query/GlobalEngine.java?ref=cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f",
                "deletions": 3,
                "filename": "engine/src/main/java/nta/engine/query/GlobalEngine.java",
                "patch": "@@ -18,9 +18,6 @@\n import nta.engine.exception.NoSuchQueryIdException;\n import nta.engine.parser.ParseTree;\n import nta.engine.parser.QueryAnalyzer;\n-import nta.engine.parser.QueryBlock;\n-import nta.engine.parser.QueryBlock.FromTable;\n-import nta.engine.parser.SetStmt;\n import nta.engine.planner.LogicalOptimizer;\n import nta.engine.planner.LogicalPlanner;\n import nta.engine.planner.global.GlobalOptimizer;",
                "raw_url": "https://github.com/apache/tajo/raw/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/query/GlobalEngine.java",
                "sha": "93b9f9dd7baeffcc5bbca6a47a92021af1188fa0",
                "status": "modified"
            },
            {
                "additions": 75,
                "blob_url": "https://github.com/apache/tajo/blob/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/query/GlobalPlanner.java",
                "changes": 101,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/main/java/nta/engine/query/GlobalPlanner.java?ref=cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f",
                "deletions": 26,
                "filename": "engine/src/main/java/nta/engine/query/GlobalPlanner.java",
                "patch": "@@ -108,6 +108,7 @@ private StoreTableNode insertStore(String tableId, LogicalNode parent) {\n     @Override\n     public void visit(LogicalNode node) {\n       String tableId;\n+      StoreTableNode store;\n       if (node.getType() == ExprType.GROUP_BY) {\n         // transform group by to two-phase plan \n         GroupbyNode groupby = (GroupbyNode) node;\n@@ -142,14 +143,14 @@ public void visit(LogicalNode node) {\n         if (join.getOuterNode().getType() != ExprType.UNION &&\n             join.getOuterNode().getType() != ExprType.STORE) {\n           tableId = QueryIdFactory.newScheduleUnitId(subId).toString();\n-          StoreTableNode store = new StoreTableNode(tableId);\n+          store = new StoreTableNode(tableId);\n           store.setLocal(true);\n           PlannerUtil.insertOuterNode(node, store);\n         }\n         if (join.getInnerNode().getType() != ExprType.UNION &&\n             join.getInnerNode().getType() != ExprType.STORE) {\n           tableId = QueryIdFactory.newScheduleUnitId(subId).toString();\n-          StoreTableNode store = new StoreTableNode(tableId);\n+          store = new StoreTableNode(tableId);\n           store.setLocal(true);\n           PlannerUtil.insertInnerNode(node, store);\n         }\n@@ -160,17 +161,24 @@ public void visit(LogicalNode node) {\n         if (union.getOuterNode().getType() != ExprType.UNION &&\n             union.getOuterNode().getType() != ExprType.STORE) {\n           tableId = QueryIdFactory.newScheduleUnitId(subId).toString();\n-          StoreTableNode store = new StoreTableNode(tableId);\n+          store = new StoreTableNode(tableId);\n           store.setLocal(true);\n           PlannerUtil.insertOuterNode(node, store);\n         }\n         if (union.getInnerNode().getType() != ExprType.UNION &&\n             union.getInnerNode().getType() != ExprType.STORE) {\n           tableId = QueryIdFactory.newScheduleUnitId(subId).toString();\n-          StoreTableNode store = new StoreTableNode(tableId);\n+          store = new StoreTableNode(tableId);\n           store.setLocal(true);\n           PlannerUtil.insertInnerNode(node, store);\n         }\n+      } else if (node instanceof UnaryNode) {\n+        UnaryNode unary = (UnaryNode)node;\n+        if (unary.getType() != ExprType.STORE &&\n+            unary.getSubNode().getType() != ExprType.STORE) {\n+          tableId = QueryIdFactory.newScheduleUnitId(subId).toString();\n+          insertStore(tableId, unary);\n+        }\n       }\n     }\n   }\n@@ -220,11 +228,11 @@ private void recursiveBuildScheduleUnit(LogicalNode node)\n           break;\n         case SELECTION:\n         case PROJECTION:\n-          unit = makeUnifiableUnit(store, store.getSubNode(), unit);\n+          unit = makeUnaryUnit(store, node, unit);\n           unit.setLogicalPlan(node);\n           break;\n         case GROUP_BY:\n-          unit = makeTwoPhaseUnit(store, node, unit);\n+          unit = makeGroupbyUnit(store, node, unit);\n           unit.setLogicalPlan(node);\n           break;\n         case SORT:\n@@ -267,31 +275,51 @@ private ScheduleUnit makeScanUnit(ScheduleUnit unit) {\n    * @return\n    * @throws IOException\n    */\n-  private ScheduleUnit makeUnifiableUnit(StoreTableNode rootStore, \n-      LogicalNode plan, ScheduleUnit unit) throws IOException {\n+  private ScheduleUnit makeUnaryUnit(StoreTableNode rootStore,\n+                                     LogicalNode plan, ScheduleUnit unit) throws IOException {\n+    ScanNode newScan;\n+    ScheduleUnit prev;\n     UnaryNode unary = (UnaryNode) plan;\n-    switch (unary.getSubNode().getType()) {\n+    UnaryNode child = (UnaryNode) unary.getSubNode();\n+    StoreTableNode prevStore = (StoreTableNode)child.getSubNode();\n+\n+    // add scan\n+    TableMeta meta = TCatUtil.newTableMeta(prevStore.getOutputSchema(),\n+        StoreType.CSV);\n+    newScan = (ScanNode)insertScan(child,\n+        prevStore.getTableName(), meta);\n+    prev = convertMap.get(prevStore);\n+\n+    if (prev != null) {\n+      prev.setParentQuery(unit);\n+      unit.addChildQuery(newScan, prev);\n+      prev.setOutputType(PARTITION_TYPE.LIST);\n+    }\n+\n+    unit.setOutputType(PARTITION_TYPE.LIST);\n+\n+    /*switch (unary.getSubNode().getType()) {\n     case SCAN:\n       unit = makeScanUnit(unit);\n       break;\n     case SELECTION:\n     case PROJECTION:\n-      unit = makeUnifiableUnit(rootStore, unary.getSubNode(), unit);\n+      unit = makeUnaryUnit(rootStore, unary.getSubNode(), unit);\n       break;\n     case SORT:\n       unit = makeSortUnit(rootStore, plan, unit);\n       break;\n \n     case GROUP_BY:\n-      unit = makeTwoPhaseUnit(rootStore, plan, unit);\n+      unit = makeGroupbyUnit(rootStore, plan, unit);\n       break;\n     case JOIN:\n       unit = makeJoinUnit(rootStore, plan, unit);\n       break;\n     case UNION:\n       unit = makeUnionUnit(rootStore, plan, unit);\n       break;\n-    }\n+    }*/\n     return unit;\n   }\n   \n@@ -304,8 +332,8 @@ private ScheduleUnit makeUnifiableUnit(StoreTableNode rootStore,\n    * @return\n    * @throws IOException\n    */\n-  private ScheduleUnit makeTwoPhaseUnit(StoreTableNode rootStore, \n-      LogicalNode plan, ScheduleUnit unit) throws IOException {\n+  private ScheduleUnit makeGroupbyUnit(StoreTableNode rootStore,\n+                                       LogicalNode plan, ScheduleUnit unit) throws IOException {\n     UnaryNode unary = (UnaryNode) plan;\n     UnaryNode unaryChild;\n     StoreTableNode prevStore;\n@@ -319,24 +347,26 @@ private ScheduleUnit makeTwoPhaseUnit(StoreTableNode rootStore,\n       prevStore = (StoreTableNode) unaryChild;\n       TableMeta meta = TCatUtil.newTableMeta(prevStore.getOutputSchema(), \n           StoreType.CSV);\n-      newScan = (ScanNode)insertScan(unary.getSubNode(), \n+      newScan = (ScanNode)insertScan(unary.getSubNode(),\n           prevStore.getTableName(), meta);\n       prev = convertMap.get(prevStore);\n       if (prev != null) {\n         prev.setParentQuery(unit);\n         unit.addChildQuery(newScan, prev);\n-        if (unaryChild.getSubNode().getType() == curType) {\n-          prev.setOutputType(PARTITION_TYPE.HASH);\n-        } else {\n-          prev.setOutputType(PARTITION_TYPE.LIST);\n-        }\n       }\n+\n       if (unaryChild.getSubNode().getType() == curType) {\n         // the second phase\n         unit.setOutputType(PARTITION_TYPE.LIST);\n+        if (prev != null) {\n+          prev.setOutputType(PARTITION_TYPE.HASH);\n+        }\n       } else {\n         // the first phase\n         unit.setOutputType(PARTITION_TYPE.HASH);\n+        if (prev != null) {\n+          prev.setOutputType(PARTITION_TYPE.LIST);\n+        }\n       }\n     } else if (unaryChild.getSubNode().getType() == ExprType.SCAN) {\n       // the first phase\n@@ -623,7 +653,7 @@ private MasterPlan convertToGlobalPlan(SubQueryId subQueryId,\n   private ScheduleUnit setPartitionNumberForTwoPhase(ScheduleUnit unit, int n) {\n     // if the next query is join, \n     // set the partition number for the current logicalUnit\n-    // TODO: union handling when join has union as its child\n+    // TODO: the union handling is required when a join has unions as its child\n     ScheduleUnit parentQueryUnit = unit.getParentQuery();\n     if (parentQueryUnit != null) {\n       if (parentQueryUnit.getStoreTableNode().getSubNode().getType() == ExprType.JOIN) {\n@@ -656,7 +686,7 @@ private ScheduleUnit setPartitionNumberForTwoPhase(ScheduleUnit unit, int n) {\n         store.setPartitions(unit.getOutputType(), keys, n);\n       }\n     } else {\n-      // TODO: error\n+      store.setListPartition();\n     }\n     return unit;\n   }\n@@ -718,8 +748,11 @@ private ScheduleUnit setPartitionNumberForTwoPhase(ScheduleUnit unit, int n) {\n           LOG.info(\"The desired number of tasks is set to \" + n);\n \n           // calculate the number of maximum query ranges\n-          TupleRange mergedRange = TupleUtil.columnStatToRange(sort.getOutputSchema(), sortSchema, stat.getColumnStats());\n-          RangePartitionAlgorithm partitioner = new UniformRangePartition(sortSchema, mergedRange);\n+          TupleRange mergedRange =\n+              TupleUtil.columnStatToRange(sort.getOutputSchema(),\n+                  sortSchema, stat.getColumnStats());\n+          RangePartitionAlgorithm partitioner =\n+              new UniformRangePartition(sortSchema, mergedRange);\n           BigDecimal card = partitioner.getTotalCardinality();\n \n           // if the number of the range cardinality is less than the desired number of tasks,\n@@ -729,7 +762,8 @@ private ScheduleUnit setPartitionNumberForTwoPhase(ScheduleUnit unit, int n) {\n             n = card.intValue();\n           }\n \n-          LOG.info(\"Try to divide \" + mergedRange + \" into \" + n + \" sub ranges (total units: \" + n + \")\");\n+          LOG.info(\"Try to divide \" + mergedRange + \" into \" + n +\n+              \" sub ranges (total units: \" + n + \")\");\n           TupleRange [] ranges = partitioner.partition(n);\n           String [] queries = TupleUtil.rangesToQueries(sortSchema, ranges);\n           for (QueryUnit qu : unit.getChildQuery(scan).getQueryUnits()) {\n@@ -740,7 +774,22 @@ private ScheduleUnit setPartitionNumberForTwoPhase(ScheduleUnit unit, int n) {\n             }\n           }\n         } else {\n-          for (QueryUnit qu : unit.getChildQuery(scan).getQueryUnits()) {\n+          ScheduleUnit child = unit.getChildQuery(scan);\n+          QueryUnit[] units = null;\n+          if (child.getStoreTableNode().getSubNode().getType() ==\n+              ExprType.UNION) {\n+            List<QueryUnit> list = Lists.newArrayList();\n+            for (ScanNode s : child.getScanNodes()) {\n+              for (QueryUnit qu : child.getChildQuery(s).getQueryUnits()) {\n+                list.add(qu);\n+              }\n+            }\n+            units = new QueryUnit[list.size()];\n+            units = list.toArray(units);\n+          } else {\n+            units = child.getQueryUnits();\n+          }\n+          for (QueryUnit qu : units) {\n             for (Partition p : qu.getPartitions()) {\n               uriList.add(new URI(p.getFileName()));\n //              System.out.println(\"Partition: \" + uriList.get(uriList.size() - 1));",
                "raw_url": "https://github.com/apache/tajo/raw/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/main/java/nta/engine/query/GlobalPlanner.java",
                "sha": "d6fceb5329db87e9131e7f64b96ef59c79b6a76c",
                "status": "modified"
            },
            {
                "additions": 30,
                "blob_url": "https://github.com/apache/tajo/blob/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/test/java/nta/engine/plan/global/TestGlobalQueryPlanner.java",
                "changes": 42,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/nta/engine/plan/global/TestGlobalQueryPlanner.java?ref=cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f",
                "deletions": 12,
                "filename": "engine/src/test/java/nta/engine/plan/global/TestGlobalQueryPlanner.java",
                "patch": "@@ -143,7 +143,7 @@ public void testScan() throws IOException {\n     logicalPlan = LogicalOptimizer.optimize(ctx, logicalPlan);\n \n     MasterPlan globalPlan = planner.build(subQueryId, logicalPlan);\n-    \n+\n     ScheduleUnit unit = globalPlan.getRoot();\n     assertFalse(unit.hasChildQuery());\n     assertEquals(PARTITION_TYPE.LIST, unit.getOutputType());\n@@ -201,13 +201,23 @@ public void testSort() throws IOException {\n     logicalPlan = LogicalOptimizer.optimize(ctx, logicalPlan);\n \n     MasterPlan globalPlan = planner.build(subQueryId, logicalPlan);\n-    \n+\n     ScheduleUnit next, prev;\n     \n     next = globalPlan.getRoot();\n+    assertEquals(ExprType.PROJECTION,\n+        next.getStoreTableNode().getSubNode().getType());\n     assertTrue(next.hasChildQuery());\n     assertEquals(PARTITION_TYPE.LIST, next.getOutputType());\n     Iterator<ScheduleUnit> it= next.getChildIterator();\n+\n+    prev = it.next();\n+    assertEquals(ExprType.SORT,\n+        prev.getStoreTableNode().getSubNode().getType());\n+    assertTrue(prev.hasChildQuery());\n+    assertEquals(PARTITION_TYPE.LIST, prev.getOutputType());\n+    it= prev.getChildIterator();\n+    next = prev;\n     \n     prev = it.next();\n     assertFalse(prev.hasChildQuery());\n@@ -231,23 +241,27 @@ public void testJoin() throws IOException {\n     ParseTree tree = analyzer.parse(ctx,\n         \"select table0.age,table0.salary,table1.salary from table0,table1 where table0.salary = table1.salary order by table0.age\");\n     LogicalNode logicalPlan = LogicalPlanner.createPlan(ctx, tree);\n-    System.out.println(logicalPlan);\n     logicalPlan = LogicalOptimizer.optimize(ctx, logicalPlan);\n \n     MasterPlan globalPlan = planner.build(subQueryId, logicalPlan);\n-    \n+\n     ScheduleUnit next, prev;\n     \n     // the second phase of the sort\n     next = globalPlan.getRoot();\n     assertTrue(next.hasChildQuery());\n     assertEquals(PARTITION_TYPE.LIST, next.getOutputType());\n     assertEquals(ExprType.PROJECTION, next.getStoreTableNode().getSubNode().getType());\n-    ProjectionNode projNode = (ProjectionNode) next.getStoreTableNode().getSubNode();\n-    assertEquals(ExprType.SORT, projNode.getSubNode().getType());\n     ScanNode []scans = next.getScanNodes();\n     assertEquals(1, scans.length);\n     Iterator<ScheduleUnit> it= next.getChildIterator();\n+\n+    prev = it.next();\n+    assertEquals(ExprType.SORT, prev.getStoreTableNode().getSubNode().getType());\n+    assertEquals(PARTITION_TYPE.LIST, prev.getOutputType());\n+    scans = prev.getScanNodes();\n+    assertEquals(1, scans.length);\n+    it= prev.getChildIterator();\n     \n     // the first phase of the sort\n     prev = it.next();\n@@ -297,7 +311,7 @@ public void testSelectAfterJoin() throws IOException {\n     logicalPlan = LogicalOptimizer.optimize(ctx, logicalPlan);\n     \n     MasterPlan globalPlan = planner.build(subQueryId, logicalPlan);\n-    \n+\n     ScheduleUnit unit = globalPlan.getRoot();\n     StoreTableNode store = unit.getStoreTableNode();\n     assertEquals(ExprType.JOIN, store.getSubNode().getType());\n@@ -321,13 +335,18 @@ public void testCubeby() throws IOException {\n     logicalPlan = LogicalOptimizer.optimize(ctx, logicalPlan);\n \n     MasterPlan globalPlan = planner.build(subQueryId, logicalPlan);\n-    \n+\n     ScheduleUnit unit = globalPlan.getRoot();\n     StoreTableNode store = unit.getStoreTableNode();\n     assertEquals(ExprType.PROJECTION, store.getSubNode().getType());\n     ProjectionNode projNode = (ProjectionNode) store.getSubNode();\n-    assertEquals(ExprType.UNION, projNode.getSubNode().getType());\n-    UnionNode union = (UnionNode) projNode.getSubNode();\n+    ScanNode[] scans = unit.getScanNodes();\n+    assertEquals(1, scans.length);\n+\n+    unit = unit.getChildQuery(scans[0]);\n+    store = unit.getStoreTableNode();\n+    assertEquals(ExprType.UNION, store.getSubNode().getType());\n+    UnionNode union = (UnionNode) store.getSubNode();\n     assertEquals(ExprType.SCAN, union.getOuterNode().getType());\n     assertEquals(ExprType.UNION, union.getInnerNode().getType());\n     union = (UnionNode) union.getInnerNode();\n@@ -368,7 +387,7 @@ public void testLocalize() throws IOException, URISyntaxException, NoSuchQueryId\n     logicalPlan = LogicalOptimizer.optimize(ctx, logicalPlan);\n \n     MasterPlan globalPlan = planner.build(subQueryId, logicalPlan);\n-    \n+\n     recursiveTestLocalize(globalPlan.getRoot());\n   }\n   \n@@ -475,7 +494,6 @@ public void testHashFetchesForBinary() {\n     assertEquals(3, hashed.get(\"0\").get(scan2).size());\n \n     QueryStringDecoder decoder = new QueryStringDecoder(hashed.get(\"0\").get(scan1).get(0));\n-    System.out.println(hashed.get(\"0\").get(scan1).get(0));\n     Map<String, List<String>> params = decoder.getParameters();\n     String [] qids = params.get(\"qid\").get(0).split(\",\");\n     assertEquals(2, qids.length);",
                "raw_url": "https://github.com/apache/tajo/raw/cb0b74dbbfb57c4efdfbe1e2c7ac541b196fbc7f/engine/src/test/java/nta/engine/plan/global/TestGlobalQueryPlanner.java",
                "sha": "889e20656b9885ca3b6f0ccb8ba96a457b242029",
                "status": "modified"
            }
        ],
        "message": "TAJO-860: TestGlobalEngine.testCubeBy \uc775\uc149\uc158, cube by operator \uc218\ud589\uc2dc GlobalPlanner.localize()\uc5d0\uc11c NPE \ubc1c\uc0dd\n\nChange-Id: I0c08d9f13a427b675d126b3110031aebbb95b72f\nReviewed-on: https://dbserver.korea.ac.kr/reviews/291\nTested-by:  Jenkins <build@dbserver.korea.ac.kr>\nReviewed-by:  jihoon <jihoonson@korea.ac.kr>",
        "parent": "https://github.com/apache/tajo/commit/fbc5e3e340e12b3cf6be264185d4315b6ac8532d",
        "patched_files": [
            "QueryUnitScheduler.java",
            "SubqueryContext.java",
            "LeafServer.java",
            "StoreTableNode.java",
            "GlobalEngine.java",
            "GlobalPlanner.java",
            "GlobalOptimizer.java",
            "QueryManager.java",
            "StoreTableExec.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestGlobalQueryPlanner.java",
            "TestLeafServer.java",
            "TestQueryManager.java",
            "TestGlobalEngine.java"
        ]
    },
    "tajo_d2a7ba9": {
        "bug_id": "tajo_d2a7ba9",
        "commit": "https://github.com/apache/tajo/commit/d2a7ba9467d39b23db5f5c3232c7c38a7baaa646",
        "file": [
            {
                "additions": 34,
                "blob_url": "https://github.com/apache/tajo/blob/d2a7ba9467d39b23db5f5c3232c7c38a7baaa646/engine/src/test/java/nta/engine/TestNtaTestingUtility.java",
                "changes": 47,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/engine/src/test/java/nta/engine/TestNtaTestingUtility.java?ref=d2a7ba9467d39b23db5f5c3232c7c38a7baaa646",
                "deletions": 13,
                "filename": "engine/src/test/java/nta/engine/TestNtaTestingUtility.java",
                "patch": "@@ -3,6 +3,7 @@\n import static org.junit.Assert.assertFalse;\n \n import java.util.Arrays;\n+import java.util.List;\n \n import nta.catalog.CatalogService;\n import nta.catalog.FunctionDesc;\n@@ -21,6 +22,8 @@\n import nta.engine.parser.QueryAnalyzer;\n import nta.engine.planner.LogicalOptimizer;\n import nta.engine.planner.LogicalPlanner;\n+import nta.engine.planner.global.QueryUnit;\n+import nta.engine.planner.global.ScheduleUnit;\n import nta.engine.planner.logical.LogicalNode;\n import nta.engine.query.QueryUnitRequestImpl;\n import nta.storage.Appender;\n@@ -89,53 +92,71 @@ public void setUp() throws Exception {\n   public void tearDown() throws Exception {\n     util.shutdownMiniCluster();\n   }\n- \n+\n   @Test\n   public final void test() throws Exception {\n     Fragment[] frags = sm.split(\"employee\", 40000);\n     int splitIdx = (int) Math.ceil(frags.length / 2.f);\n     QueryIdFactory.reset();\n-    ScheduleUnitId sid = QueryIdFactory.newScheduleUnitId(\n-        QueryIdFactory.newSubQueryId(\n-            QueryIdFactory.newQueryId()));\n+    QueryId queryId = QueryIdFactory.newQueryId();\n+    SubQueryId subQueryId = QueryIdFactory.newSubQueryId(queryId);\n+    ScheduleUnitId sid = QueryIdFactory.newScheduleUnitId(subQueryId);\n+    Query query = new Query(queryId);\n+    SubQuery subQuery = new SubQuery(subQueryId);\n+    ScheduleUnit scheduleUnit = new ScheduleUnit(sid);\n+    subQuery.addScheduleUnit(scheduleUnit);\n+    query.addSubQuery(subQuery);\n+    util.getMiniTajoCluster().getMaster().getQueryManager().addQuery(query);\n+\n     QueryUnitId qid;\n     QueryContext ctx;\n-    ParseTree query;\n+    ParseTree queryTree;\n     LogicalNode plan;\n     QueryUnitRequest req;\n     Thread.sleep(2000);\n-      \n+\n     sm.initTableBase(frags[0].getMeta(), \"testNtaTestingUtil\");\n+\n+    List<QueryUnit> queryUnits = Lists.newArrayList();\n+    List<QueryUnitRequest> queryUnitRequests = Lists.newArrayList();\n     for (int i = 0; i < 4; i++) {\n       qid = QueryIdFactory.newQueryUnitId(sid);\n       ctx = qcFactory.create();\n-      query = analyzer.parse(ctx, \n+      queryTree = analyzer.parse(ctx,\n           \"testNtaTestingUtil := select deptName, sleep(name) from employee group by deptName\");\n-      plan = LogicalPlanner.createPlan(ctx, query);\n+      plan = LogicalPlanner.createPlan(ctx, queryTree);\n       plan = LogicalOptimizer.optimize(ctx, plan);\n+      QueryUnit unit = new QueryUnit(qid);\n+      queryUnits.add(unit);\n       req = new QueryUnitRequestImpl(\n           qid, Lists.newArrayList(Arrays.copyOfRange(frags, 0, splitIdx)),\n           \"\", false, plan.toJSON());\n+      queryUnitRequests.add(req);\n+    }\n+    scheduleUnit.setQueryUnits(queryUnits.toArray(new QueryUnit[queryUnits.size()]));\n+\n+    for (int i = 0; i < 4; i++) {\n       util.getMiniTajoCluster().getLeafServerThreads().get(i)\n-        .getLeafServer().requestQueryUnit(req.getProto());\n+          .getLeafServer().requestQueryUnit(queryUnitRequests.get(i).getProto());\n     }\n-    \n+\n+\n     Thread.sleep(3000);\n     LeafServer leaf0 = util.getMiniTajoCluster().getLeafServer(0);\n     leaf0.shutdown(\"Aborted!\");\n \n     Thread.sleep(1000);\n     LeafServer leaf1 = util.getMiniTajoCluster().getLeafServer(1);\n     leaf1.shutdown(\"Aborted!\");\n-    \n+\n     Thread.sleep(1000);\n     LeafServer leaf2 = util.getMiniTajoCluster().getLeafServer(2);\n     leaf2.shutdown(\"Aborted!\");\n-    \n+\n     Thread.sleep(1000);\n     LeafServer leaf3 = util.getMiniTajoCluster().getLeafServer(3);\n     leaf3.shutdown(\"Aborted!\");\n-    \n+\n     assertFalse(leaf0.isAlive());\n     assertFalse(leaf1.isAlive());\n     assertFalse(leaf2.isAlive());",
                "raw_url": "https://github.com/apache/tajo/raw/d2a7ba9467d39b23db5f5c3232c7c38a7baaa646/engine/src/test/java/nta/engine/TestNtaTestingUtility.java",
                "sha": "8da7df12018f52617412c5ba8967c1172222ef31",
                "status": "modified"
            }
        ],
        "message": "TAJO-842: TestNtaTestingUtility\uc5d0\uc11c \ud14c\uc2a4\ud2b8 \uc2dc \ubc1c\uc0dd\ud558\ub294 NPE\n\nChange-Id: I443b49635a1a54ee0a7a58426dc0fa99aed3ed4f\nReviewed-on: https://dbserver.korea.ac.kr/reviews/267\nTested-by:  Jenkins <build@dbserver.korea.ac.kr>\nReviewed-by: Hyunsik Choi <hyunsik.choi@gmail.com>",
        "parent": "https://github.com/apache/tajo/commit/ef8c77464319041d5fcd3eab9b1038a4ee037c31",
        "patched_files": [],
        "repo": "tajo",
        "unit_tests": [
            "TestNtaTestingUtility.java"
        ]
    },
    "tajo_d3727c7": {
        "bug_id": "tajo_d3727c7",
        "commit": "https://github.com/apache/tajo/commit/d3727c73560f4d4c0fd3d2ead84b577e6f3a51b1",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/d3727c73560f4d4c0fd3d2ead84b577e6f3a51b1/CHANGES",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=d3727c73560f4d4c0fd3d2ead84b577e6f3a51b1",
                "deletions": 0,
                "filename": "CHANGES",
                "patch": "@@ -127,6 +127,9 @@ Release 0.9.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-1020: TajoContainerProxy::assignExecutionBlock causes NPE by race.\n+    (hyunsik)\n+\n     TAJO-986: Task scheduler gets incorrect task size. (Mai Hai Thanh via jihoon)\n \n     TAJO-873: Query status is still RUNNING after session expired.",
                "raw_url": "https://github.com/apache/tajo/raw/d3727c73560f4d4c0fd3d2ead84b577e6f3a51b1/CHANGES",
                "sha": "269c3070465501bb6f11774b4d29ee4f8e46d723",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tajo/blob/d3727c73560f4d4c0fd3d2ead84b577e6f3a51b1/tajo-common/src/main/java/org/apache/tajo/util/KeyValueSet.java",
                "changes": 17,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-common/src/main/java/org/apache/tajo/util/KeyValueSet.java?ref=d3727c73560f4d4c0fd3d2ead84b577e6f3a51b1",
                "deletions": 12,
                "filename": "tajo-common/src/main/java/org/apache/tajo/util/KeyValueSet.java",
                "patch": "@@ -37,9 +37,7 @@\n   public static final String TRUE_STR = \"true\";\n   public static final String FALSE_STR = \"false\";\n \n-\tprivate KeyValueSetProto.Builder builder = KeyValueSetProto.newBuilder();\n-\t\n-\t@Expose private Map<String,String> keyVals;\n+  @Expose private Map<String,String> keyVals;\n \t\n \tpublic KeyValueSet() {\n     keyVals = TUtil.newHashMap();\n@@ -221,27 +219,22 @@ public boolean equals(Object object) {\n \t@Override\n   public Object clone() throws CloneNotSupportedException {    \n     KeyValueSet keyValueSet = (KeyValueSet) super.clone();\n-    keyValueSet.builder = KeyValueSetProto.newBuilder();\n     keyValueSet.keyVals = keyVals != null ? new HashMap<String, String>(keyVals) : null;\n     return keyValueSet;\n \t}\n \t\n \t@Override\n \tpublic KeyValueSetProto getProto() {\n-    if (builder == null) {\n-      builder = KeyValueSetProto.newBuilder();\n-    } else {\n-      builder.clear();\n-    }\n+    KeyValueSetProto.Builder builder = KeyValueSetProto.newBuilder();\n \n-    KeyValueProto.Builder kvBuilder;\n+    KeyValueProto.Builder kvBuilder = KeyValueProto.newBuilder();\n     if(this.keyVals != null) {\n       for(Entry<String,String> kv : keyVals.entrySet()) {\n-        kvBuilder = KeyValueProto.newBuilder();\n         kvBuilder.setKey(kv.getKey());\n-\n         kvBuilder.setValue(kv.getValue());\n         builder.addKeyval(kvBuilder.build());\n+\n+        kvBuilder.clear();\n       }\n     }\n     return builder.build();",
                "raw_url": "https://github.com/apache/tajo/raw/d3727c73560f4d4c0fd3d2ead84b577e6f3a51b1/tajo-common/src/main/java/org/apache/tajo/util/KeyValueSet.java",
                "sha": "c1e7092c131cf7dbd2f0e03030ad8367ab0153c4",
                "status": "modified"
            }
        ],
        "message": "TAJO-1020: TajoContainerProxy::assignExecutionBlock causes NPE by race condition.\n\nCloses #127",
        "parent": "https://github.com/apache/tajo/commit/1ab39706ec3fafe4edeef857d49db8dcace9c2d6",
        "patched_files": [
            "CHANGES",
            "KeyValueSet.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestKeyValueSet.java"
        ]
    },
    "tajo_db2f733": {
        "bug_id": "tajo_db2f733",
        "commit": "https://github.com/apache/tajo/commit/db2f733a6753c78de673a339e9cba1c817201c76",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/db2f733a6753c78de673a339e9cba1c817201c76/CHANGES.txt",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES.txt?ref=db2f733a6753c78de673a339e9cba1c817201c76",
                "deletions": 0,
                "filename": "CHANGES.txt",
                "patch": "@@ -243,6 +243,8 @@ Release 0.8.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-568: Union query with the same alias names cause NPE. (hyunsik)\n+\n     TAJO-570: InvalidOperationException in outer join with constant values.\n     (hyunsik)\n ",
                "raw_url": "https://github.com/apache/tajo/raw/db2f733a6753c78de673a339e9cba1c817201c76/CHANGES.txt",
                "sha": "e6f34a0b3cda666c43f7ea84349c32d4a1378ed7",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/db2f733a6753c78de673a339e9cba1c817201c76/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalPlanPreprocessor.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalPlanPreprocessor.java?ref=db2f733a6753c78de673a339e9cba1c817201c76",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalPlanPreprocessor.java",
                "patch": "@@ -250,7 +250,7 @@ public LogicalNode visitTableSubQuery(PreprocessContext ctx, Stack<Expr> stack,\n     PreprocessContext newContext;\n     // Note: TableSubQuery always has a table name.\n     // SELECT .... FROM (SELECT ...) TB_NAME <-\n-    newContext = new PreprocessContext(ctx, ctx.plan.newAndGetBlock(expr.getName()));\n+    newContext = new PreprocessContext(ctx, ctx.plan.newQueryBlock());\n     LogicalNode child = super.visitTableSubQuery(newContext, stack, expr);\n \n     // a table subquery should be dealt as a relation.",
                "raw_url": "https://github.com/apache/tajo/raw/db2f733a6753c78de673a339e9cba1c817201c76/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/planner/LogicalPlanPreprocessor.java",
                "sha": "099e462c37e0e79b737af1dbc7a7099aed799d5d",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/db2f733a6753c78de673a339e9cba1c817201c76/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/planner/TestLogicalPlan.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/planner/TestLogicalPlan.java?ref=db2f733a6753c78de673a339e9cba1c817201c76",
                "deletions": 2,
                "filename": "tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/planner/TestLogicalPlan.java",
                "patch": "@@ -85,8 +85,8 @@ public static void tearDown() {\n   public final void testQueryBlockGraph() {\n     LogicalPlan plan = new LogicalPlan(planner);\n     LogicalPlan.QueryBlock root = plan.newAndGetBlock(LogicalPlan.ROOT_BLOCK);\n-    LogicalPlan.QueryBlock new1 = plan.newAndGetBlock(\"@new1\");\n-    LogicalPlan.QueryBlock new2 = plan.newAndGetBlock(\"@new2\");\n+    LogicalPlan.QueryBlock new1 = plan.newQueryBlock();\n+    LogicalPlan.QueryBlock new2 = plan.newQueryBlock();\n \n     plan.getQueryBlockGraph().addEdge(new1.getName(), root.getName(),\n         new LogicalPlan.BlockEdge(new1, root, BlockType.TableSubQuery));",
                "raw_url": "https://github.com/apache/tajo/raw/db2f733a6753c78de673a339e9cba1c817201c76/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/planner/TestLogicalPlan.java",
                "sha": "bfd1f81ef821f5b5a8dd994a72225dc17b5525fe",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tajo/blob/db2f733a6753c78de673a339e9cba1c817201c76/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestUnionQuery.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestUnionQuery.java?ref=db2f733a6753c78de673a339e9cba1c817201c76",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestUnionQuery.java",
                "patch": "@@ -126,4 +126,11 @@ public final void testUnion10() throws Exception {\n     assertResultSet(res);\n     cleanupQuery(res);\n   }\n+\n+  @Test\n+  public final void testUnionWithSameAliasNames() throws Exception {\n+    ResultSet res = executeQuery();\n+    assertResultSet(res);\n+    cleanupQuery(res);\n+  }\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/db2f733a6753c78de673a339e9cba1c817201c76/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/query/TestUnionQuery.java",
                "sha": "22830bf8131e558b018f76cf928c352ff0340957",
                "status": "modified"
            },
            {
                "additions": 25,
                "blob_url": "https://github.com/apache/tajo/blob/db2f733a6753c78de673a339e9cba1c817201c76/tajo-core/tajo-core-backend/src/test/resources/queries/TestUnionQuery/testUnionWithSameAliasNames.sql",
                "changes": 25,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/resources/queries/TestUnionQuery/testUnionWithSameAliasNames.sql?ref=db2f733a6753c78de673a339e9cba1c817201c76",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/test/resources/queries/TestUnionQuery/testUnionWithSameAliasNames.sql",
                "patch": "@@ -0,0 +1,25 @@\n+select\n+  *\n+from (\n+  select\n+    l_orderkey\n+  from (\n+    select\n+      l_orderkey\n+    from\n+      lineitem\n+  ) l1\n+\n+  union\n+\n+  select\n+    l_orderkey\n+  from (\n+    select\n+      l_orderkey\n+    from\n+      lineitem\n+  ) l1\n+) t1\n+order by\n+  l_orderkey;",
                "raw_url": "https://github.com/apache/tajo/raw/db2f733a6753c78de673a339e9cba1c817201c76/tajo-core/tajo-core-backend/src/test/resources/queries/TestUnionQuery/testUnionWithSameAliasNames.sql",
                "sha": "c39940cbcf71b97265bf673e4feef0e68fb60738",
                "status": "added"
            },
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/tajo/blob/db2f733a6753c78de673a339e9cba1c817201c76/tajo-core/tajo-core-backend/src/test/resources/results/TestUnionQuery/testUnionWithSameAliasNames.result",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/resources/results/TestUnionQuery/testUnionWithSameAliasNames.result?ref=db2f733a6753c78de673a339e9cba1c817201c76",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/test/resources/results/TestUnionQuery/testUnionWithSameAliasNames.result",
                "patch": "@@ -0,0 +1,12 @@\n+l_orderkey\n+-------------------------------\n+1\n+1\n+1\n+1\n+2\n+2\n+3\n+3\n+3\n+3\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/db2f733a6753c78de673a339e9cba1c817201c76/tajo-core/tajo-core-backend/src/test/resources/results/TestUnionQuery/testUnionWithSameAliasNames.result",
                "sha": "d269baa51eb79f74aa37a9189f2f88eabd70f56f",
                "status": "added"
            }
        ],
        "message": "TAJO-568: Union query with the same alias names cause NPE.",
        "parent": "https://github.com/apache/tajo/commit/10c599f4b057308eca7ac8d5d7cc2542a69f0524",
        "patched_files": [
            "testUnionWithSameAliasNames.result",
            "testUnionWithSameAliasNames.sql",
            "LogicalPlan.java",
            "CHANGES.txt",
            "LogicalPlanPreprocessor.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestLogicalPlan.java",
            "TestUnionQuery.java"
        ]
    },
    "tajo_dbaa8a5": {
        "bug_id": "tajo_dbaa8a5",
        "commit": "https://github.com/apache/tajo/commit/dbaa8a500a34c8f0ad69b1c2ea24f7db0071aff7",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/dbaa8a500a34c8f0ad69b1c2ea24f7db0071aff7/CHANGES.txt",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES.txt?ref=dbaa8a500a34c8f0ad69b1c2ea24f7db0071aff7",
                "deletions": 0,
                "filename": "CHANGES.txt",
                "patch": "@@ -68,6 +68,8 @@ Release 0.2.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-82: NullPointerException occurs when Schema is converted as an array of columns. (jihoon)\n+\n     TAJO-65: Invalid pom.xml configurations for source directories. \n     (Takuya Ueshin via hyunsik)\n ",
                "raw_url": "https://github.com/apache/tajo/raw/dbaa8a500a34c8f0ad69b1c2ea24f7db0071aff7/CHANGES.txt",
                "sha": "25c73f923d3c2f6b3cf67929bf4a2c2f1a7b4863",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/dbaa8a500a34c8f0ad69b1c2ea24f7db0071aff7/tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/Schema.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/Schema.java?ref=dbaa8a500a34c8f0ad69b1c2ea24f7db0071aff7",
                "deletions": 0,
                "filename": "tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/Schema.java",
                "patch": "@@ -248,6 +248,7 @@ public String toJson() {\n \t}\n \n   public Column [] toArray() {\n+    initFromProto();\n     return this.fields.toArray(new Column[this.fields.size()]);\n   }\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/dbaa8a500a34c8f0ad69b1c2ea24f7db0071aff7/tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/Schema.java",
                "sha": "5a4be0d53781ade7a79ab2068830c79abd00afc1",
                "status": "modified"
            }
        ],
        "message": "TAJO-82: NullPointerException occurs when Schema is converted as an array of columns. (jihoon)",
        "parent": "https://github.com/apache/tajo/commit/a68e4d9feea506ebd6cdde065945577de25aad6e",
        "patched_files": [
            "Schema.java",
            "CHANGES.txt"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestSchema.java"
        ]
    },
    "tajo_e0b6f7a": {
        "bug_id": "tajo_e0b6f7a",
        "commit": "https://github.com/apache/tajo/commit/e0b6f7ae8e2215e71500d1d0d8faa2318d3d3d1e",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/e0b6f7ae8e2215e71500d1d0d8faa2318d3d3d1e/CHANGES.txt",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES.txt?ref=e0b6f7ae8e2215e71500d1d0d8faa2318d3d3d1e",
                "deletions": 0,
                "filename": "CHANGES.txt",
                "patch": "@@ -269,6 +269,8 @@ Release 0.8.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-641: NPE in HCatalogStore.addTable(). (jaehwa)\n+\n     TAJO-646: TajoClient is blocked while main thread finished.\n     (hyoungjunkim via jinho)\n ",
                "raw_url": "https://github.com/apache/tajo/raw/e0b6f7ae8e2215e71500d1d0d8faa2318d3d3d1e/CHANGES.txt",
                "sha": "ecd5eb9501e36f589adbe1ce644df028fdf7b02b",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/e0b6f7ae8e2215e71500d1d0d8faa2318d3d3d1e/tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/Schema.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/Schema.java?ref=e0b6f7ae8e2215e71500d1d0d8faa2318d3d3d1e",
                "deletions": 1,
                "filename": "tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/Schema.java",
                "patch": "@@ -130,7 +130,10 @@ public Column getColumn(Column column) {\n    */\n   public Column getColumn(String name) {\n     String [] parts = name.split(\"\\\\.\");\n-    if (parts.length == 2) {\n+    // Some of the string can includes database name and table name and column name.\n+    // For example, it can be 'default.table1.id'.\n+    // Therefore, spilt string array length can be 3.\n+    if (parts.length >= 2) {\n       return getColumnByQName(name);\n     } else {\n       return getColumnByName(name);",
                "raw_url": "https://github.com/apache/tajo/raw/e0b6f7ae8e2215e71500d1d0d8faa2318d3d3d1e/tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/Schema.java",
                "sha": "0c812f178d92b091d18404f5fb16624101d36d90",
                "status": "modified"
            },
            {
                "additions": 60,
                "blob_url": "https://github.com/apache/tajo/blob/e0b6f7ae8e2215e71500d1d0d8faa2318d3d3d1e/tajo-catalog/tajo-catalog-drivers/tajo-hcatalog/src/main/java/org/apache/tajo/catalog/store/HCatalogStore.java",
                "changes": 80,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-catalog/tajo-catalog-drivers/tajo-hcatalog/src/main/java/org/apache/tajo/catalog/store/HCatalogStore.java?ref=e0b6f7ae8e2215e71500d1d0d8faa2318d3d3d1e",
                "deletions": 20,
                "filename": "tajo-catalog/tajo-catalog-drivers/tajo-hcatalog/src/main/java/org/apache/tajo/catalog/store/HCatalogStore.java",
                "patch": "@@ -18,6 +18,7 @@\n \n package org.apache.tajo.catalog.store;\n \n+import org.apache.commons.lang.StringEscapeUtils;\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n import org.apache.hadoop.conf.Configuration;\n@@ -39,6 +40,9 @@\n import org.apache.tajo.exception.InternalException;\n \n import java.io.IOException;\n+import java.lang.management.ManagementFactory;\n+import java.lang.management.ThreadInfo;\n+import java.lang.management.ThreadMXBean;\n import java.util.ArrayList;\n import java.util.HashMap;\n import java.util.List;\n@@ -47,17 +51,31 @@\n import static org.apache.tajo.catalog.proto.CatalogProtos.PartitionType;\n \n public class HCatalogStore extends CatalogConstants implements CatalogStore {\n-  public static final String CVSFILE_DELIMITER = \"csvfile.delimiter\";\n+  public static final String CSVFILE_DELIMITER = \"csvfile.delimiter\";\n+  public static final String CSVFILE_NULL = \"csvfile.null\";\n \n   protected final Log LOG = LogFactory.getLog(getClass());\n   protected Configuration conf;\n   private static final int CLIENT_POOL_SIZE = 2;\n   private final HCatalogStoreClientPool clientPool = new HCatalogStoreClientPool(0);\n+  private ThreadMXBean threadBean = ManagementFactory.getThreadMXBean();\n \n   public HCatalogStore(final Configuration conf)\n       throws InternalException {\n     this.conf = conf;\n     try {\n+      // In unit test case, HCatalogStore has to set some hive configurations by force.\n+      // So, it checks caller class name and caller method name.\n+      long[] threadIds = threadBean.getAllThreadIds();\n+      for (long tid : threadIds) {\n+        ThreadInfo info = threadBean.getThreadInfo(tid, 5);\n+        for (StackTraceElement frame : info.getStackTrace()) {\n+          if (frame.toString().equals(\"org.apache.tajo.catalog.store.TestHCatalogStore.setUp\")) {\n+            clientPool.setParameters(this.conf);\n+          }\n+        }\n+      }\n+\n       clientPool.addClients(CLIENT_POOL_SIZE);\n     } catch (Exception e) {\n       e.printStackTrace();\n@@ -179,21 +197,28 @@ public boolean existTable(final String name) throws CatalogException {\n       Properties properties = table.getMetadata();\n       if (properties != null) {\n         // set field delimiter\n-        String fieldDelimiter = \"\", fileOutputformat = \"\";\n+        String fieldDelimiter = \"\", fileOutputformat = \"\", nullFormat = \"\";\n         if (properties.getProperty(serdeConstants.FIELD_DELIM) != null) {\n           fieldDelimiter = properties.getProperty(serdeConstants.FIELD_DELIM);\n         } else {\n           // if hive table used default row format delimiter, Properties doesn't have it.\n           // So, Tajo must set as follows:\n-          fieldDelimiter = \"\\\\001\";\n+          fieldDelimiter = \"\\u0001\";\n+        }\n+\n+        // set null format\n+        if (properties.getProperty(serdeConstants.SERIALIZATION_NULL_FORMAT) != null) {\n+          nullFormat = properties.getProperty(serdeConstants.SERIALIZATION_NULL_FORMAT);\n+        } else {\n+          nullFormat = \"\\\\N\";\n         }\n \n         // set file output format\n         fileOutputformat = properties.getProperty(\"file.outputformat\");\n         storeType = CatalogUtil.getStoreType(HCatalogUtil.getStoreType(fileOutputformat));\n-\n         if (storeType.equals(CatalogProtos.StoreType.CSV) ) {\n-          options.put(CVSFILE_DELIMITER, fieldDelimiter);\n+          options.put(CSVFILE_DELIMITER, StringEscapeUtils.escapeJava(fieldDelimiter));\n+          options.put(CSVFILE_NULL, StringEscapeUtils.escapeJava(nullFormat));\n         }\n \n         // set data size\n@@ -310,46 +335,61 @@ public final void addTable(final CatalogProtos.TableDescProto tableDesc) throws\n       //table.setOwner();\n \n       StorageDescriptor sd = new StorageDescriptor();\n+      sd.setParameters(new HashMap<String, String>());\n+      sd.setSerdeInfo(new SerDeInfo());\n+      sd.getSerdeInfo().setParameters(new HashMap<String, String>());\n+      sd.getSerdeInfo().setName(table.getTableName());\n \n       // if tajo set location method, thrift client make exception as follows:\n       // Caused by: MetaException(message:java.lang.NullPointerException)\n       // If you want to modify table path, you have to modify on Hive cli.\n-      //sd.setLocation(tableDesc.getPath().toString());\n+      // sd.setLocation(tableDesc.getPath().toString());\n \n       // set column information\n       ArrayList<FieldSchema> cols = new ArrayList<FieldSchema>(tableDesc.getSchema().getFieldsCount());\n-      for (CatalogProtos.ColumnProto col : tableDesc.getSchema().getFieldsList()) {\n-        cols.add(new FieldSchema(\n-            col.getName(),\n-            HCatalogUtil.getHiveFieldType(col.getDataType().getType().name()),\n-            \"\"));\n+\n+      for (CatalogProtos.ColumnProto eachField : tableDesc.getSchema().getFieldsList()) {\n+        cols.add(new FieldSchema( eachField.getName(), HCatalogUtil.getHiveFieldType(eachField.getDataType().getType().name()), \"\"));\n       }\n       sd.setCols(cols);\n \n+      // set partition keys\n+      if (tableDesc.getPartition() != null && tableDesc.getPartition().getPartitionType().equals(PartitionType.COLUMN)) {\n+        List<FieldSchema> partitionKeys = new ArrayList<FieldSchema>();\n+        for(CatalogProtos.ColumnProto eachPartitionKey: tableDesc.getPartition().getExpressionSchema().getFieldsList()) {\n+          partitionKeys.add(new FieldSchema( eachPartitionKey.getName(), HCatalogUtil.getHiveFieldType(eachPartitionKey.getDataType().getType().name()), \"\"));\n+        }\n+        table.setPartitionKeys(partitionKeys);\n+      }\n+\n       sd.setCompressed(false);\n+\n       if (tableDesc.getMeta().hasParams()) {\n         for (CatalogProtos.KeyValueProto entry: tableDesc.getMeta().getParams().getKeyvalList()) {\n           if (entry.getKey().equals(\"compression.codec\")) {\n             sd.setCompressed(true);\n-          } else if (entry.getKey().equals(CVSFILE_DELIMITER)) {\n-            sd.getSerdeInfo().getParameters().put(serdeConstants.FIELD_DELIM, entry.getValue());\n+          } else if (entry.getKey().equals(CSVFILE_NULL)) {\n+            sd.getSerdeInfo().getParameters().put(serdeConstants.SERIALIZATION_NULL_FORMAT, StringEscapeUtils.unescapeJava(entry.getValue()));\n+          } else if (entry.getKey().equals(CSVFILE_DELIMITER)) {\n+            String fieldDelimiter = entry.getValue();\n+\n+            // User can use an unicode for filed delimiter such as \\u0001, \\001.\n+            // In this case, java console will convert this value into \"\\\\u001\".\n+            // And hive will un-espace this value again.\n+            // As a result, user can use right field delimiter.\n+            // So, we have to un-escape this value.\n+            sd.getSerdeInfo().getParameters().put(serdeConstants.SERIALIZATION_FORMAT, StringEscapeUtils.unescapeJava(fieldDelimiter));\n+            sd.getSerdeInfo().getParameters().put(serdeConstants.FIELD_DELIM, StringEscapeUtils.unescapeJava(fieldDelimiter));\n           }\n         }\n       }\n \n-      sd.setParameters(new HashMap<String, String>());\n-      sd.setSerdeInfo(new SerDeInfo());\n-      sd.getSerdeInfo().setName(table.getTableName());\n-\n       if(tableDesc.getMeta().getStoreType().equals(CatalogProtos.StoreType.RCFILE)) {\n         sd.getSerdeInfo().setSerializationLib(org.apache.hadoop.hive.serde2.columnar.ColumnarSerDe.class.getName());\n       } else {\n         sd.getSerdeInfo().setSerializationLib(org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.class.getName());\n       }\n \n-      sd.getSerdeInfo().setParameters(new HashMap<String, String>());\n-//      sd.getSerdeInfo().getParameters().put(serdeConstants.SERIALIZATION_FORMAT, \"1\");\n-\n       if(tableDesc.getMeta().getStoreType().equals(CatalogProtos.StoreType.RCFILE)) {\n         sd.setInputFormat(org.apache.hadoop.hive.ql.io.RCFileInputFormat.class.getName());\n       } else {",
                "raw_url": "https://github.com/apache/tajo/raw/e0b6f7ae8e2215e71500d1d0d8faa2318d3d3d1e/tajo-catalog/tajo-catalog-drivers/tajo-hcatalog/src/main/java/org/apache/tajo/catalog/store/HCatalogStore.java",
                "sha": "d61837537b32d8a33f71c81dd007192e166af881",
                "status": "modified"
            },
            {
                "additions": 13,
                "blob_url": "https://github.com/apache/tajo/blob/e0b6f7ae8e2215e71500d1d0d8faa2318d3d3d1e/tajo-catalog/tajo-catalog-drivers/tajo-hcatalog/src/main/java/org/apache/tajo/catalog/store/HCatalogStoreClientPool.java",
                "changes": 16,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-catalog/tajo-catalog-drivers/tajo-hcatalog/src/main/java/org/apache/tajo/catalog/store/HCatalogStoreClientPool.java?ref=e0b6f7ae8e2215e71500d1d0d8faa2318d3d3d1e",
                "deletions": 3,
                "filename": "tajo-catalog/tajo-catalog-drivers/tajo-hcatalog/src/main/java/org/apache/tajo/catalog/store/HCatalogStoreClientPool.java",
                "patch": "@@ -15,10 +15,14 @@\n \n \n import com.google.common.base.Preconditions;\n+import org.apache.hadoop.conf.Configuration;\n import org.apache.hadoop.hive.conf.HiveConf;\n import org.apache.hadoop.hive.metastore.HiveMetaStoreClient;\n import org.apache.log4j.Logger;\n \n+import java.util.Iterator;\n+import java.util.Map;\n+import java.util.Map.Entry;\n import java.util.concurrent.ConcurrentLinkedQueue;\n import java.util.concurrent.atomic.AtomicBoolean;\n \n@@ -31,7 +35,7 @@\n   private final ConcurrentLinkedQueue<HCatalogStoreClient> clientPool =\n       new ConcurrentLinkedQueue<HCatalogStoreClient>();\n   private AtomicBoolean poolClosed = new AtomicBoolean(false);\n-  private final HiveConf hiveConf;\n+  private HiveConf hiveConf;\n \n   /**\n    * A wrapper around the HiveMetaStoreClient that manages interactions with the\n@@ -43,9 +47,7 @@\n \n     private HCatalogStoreClient(HiveConf hiveConf) {\n       try {\n-\n         LOG.info(\"Creating MetaStoreClient. Pool Size = \" + clientPool.size());\n-\n         this.hiveClient = new HiveMetaStoreClient(hiveConf);\n       } catch (Exception e) {\n         // Turn in to an unchecked exception\n@@ -99,6 +101,13 @@ public HCatalogStoreClientPool(int initialSize, HiveConf hiveConf) {\n     addClients(initialSize);\n   }\n \n+  public void setParameters(Configuration conf) {\n+    for( Iterator<Entry<String, String>> iter = conf.iterator(); iter.hasNext();) {\n+      Map.Entry<String, String> entry = iter.next();\n+      this.hiveConf.set(entry.getKey(), entry.getValue());\n+    }\n+  }\n+\n   /**\n    * Add numClients to the client pool.\n    */\n@@ -127,6 +136,7 @@ public HCatalogStoreClient getClient() {\n       client = new HCatalogStoreClient(hiveConf);\n     }\n     client.markInUse();\n+\n     return client;\n   }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/e0b6f7ae8e2215e71500d1d0d8faa2318d3d3d1e/tajo-catalog/tajo-catalog-drivers/tajo-hcatalog/src/main/java/org/apache/tajo/catalog/store/HCatalogStoreClientPool.java",
                "sha": "0f0ea0495a9ef9030c68eccfb19af10d17af57ed",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tajo/blob/e47242e68e217f3d897ae897766f987a44657f7d/tajo-catalog/tajo-catalog-drivers/tajo-hcatalog/src/test/java/org/apache/tajo/catalog/store/DummyListener.java",
                "changes": 97,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-catalog/tajo-catalog-drivers/tajo-hcatalog/src/test/java/org/apache/tajo/catalog/store/DummyListener.java?ref=e47242e68e217f3d897ae897766f987a44657f7d",
                "deletions": 97,
                "filename": "tajo-catalog/tajo-catalog-drivers/tajo-hcatalog/src/test/java/org/apache/tajo/catalog/store/DummyListener.java",
                "patch": "@@ -1,97 +0,0 @@\n-/**\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-\n-package org.apache.tajo.catalog.store;\n-\n-import org.apache.hadoop.conf.Configuration;\n-import org.apache.hadoop.hive.metastore.MetaStoreEventListener;\n-import org.apache.hadoop.hive.metastore.api.MetaException;\n-import org.apache.hadoop.hive.metastore.events.*;\n-\n-import java.util.ArrayList;\n-import java.util.List;\n-\n-/** A dummy implementation for\n- * {@link org.apache.hadoop.hive.metastore.MetaStoreEventListener}\n- * for testing purposes.\n- */\n-public class DummyListener extends MetaStoreEventListener {\n-\n-  public static final List<ListenerEvent> notifyList = new ArrayList<ListenerEvent>();\n-\n-  /**\n-   * @return The last event received, or null if no event was received.\n-   */\n-  public static ListenerEvent getLastEvent() {\n-    if (notifyList.isEmpty()) {\n-      return null;\n-    } else {\n-      return notifyList.get(notifyList.size() - 1);\n-    }\n-  }\n-\n-  public DummyListener(Configuration config) {\n-    super(config);\n-  }\n-\n-  @Override\n-  public void onAddPartition(AddPartitionEvent partition) throws MetaException {\n-    notifyList.add(partition);\n-  }\n-\n-  @Override\n-  public void onCreateDatabase(CreateDatabaseEvent db) throws MetaException {\n-    notifyList.add(db);\n-  }\n-\n-  @Override\n-  public void onCreateTable(CreateTableEvent table) throws MetaException {\n-    notifyList.add(table);\n-  }\n-\n-  @Override\n-  public void onDropDatabase(DropDatabaseEvent db) throws MetaException {\n-    notifyList.add(db);\n-  }\n-\n-  @Override\n-  public void onDropPartition(DropPartitionEvent partition) throws MetaException {\n-    notifyList.add(partition);\n-  }\n-\n-  @Override\n-  public void onDropTable(DropTableEvent table) throws MetaException {\n-    notifyList.add(table);\n-  }\n-\n-  @Override\n-  public void onAlterTable(AlterTableEvent event) throws MetaException {\n-    notifyList.add(event);\n-  }\n-\n-  @Override\n-  public void onAlterPartition(AlterPartitionEvent event) throws MetaException {\n-    notifyList.add(event);\n-  }\n-\n-  @Override\n-  public void onLoadPartitionDone(LoadPartitionDoneEvent partEvent) throws MetaException {\n-    notifyList.add(partEvent);\n-  }\n-\n-}",
                "raw_url": "https://github.com/apache/tajo/raw/e47242e68e217f3d897ae897766f987a44657f7d/tajo-catalog/tajo-catalog-drivers/tajo-hcatalog/src/test/java/org/apache/tajo/catalog/store/DummyListener.java",
                "sha": "a3c2dca5665f69c078a219911f3381db769c46f6",
                "status": "removed"
            },
            {
                "additions": 218,
                "blob_url": "https://github.com/apache/tajo/blob/e0b6f7ae8e2215e71500d1d0d8faa2318d3d3d1e/tajo-catalog/tajo-catalog-drivers/tajo-hcatalog/src/test/java/org/apache/tajo/catalog/store/TestHCatalogStore.java",
                "changes": 363,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-catalog/tajo-catalog-drivers/tajo-hcatalog/src/test/java/org/apache/tajo/catalog/store/TestHCatalogStore.java?ref=e0b6f7ae8e2215e71500d1d0d8faa2318d3d3d1e",
                "deletions": 145,
                "filename": "tajo-catalog/tajo-catalog-drivers/tajo-hcatalog/src/test/java/org/apache/tajo/catalog/store/TestHCatalogStore.java",
                "patch": "@@ -19,20 +19,17 @@\n package org.apache.tajo.catalog.store;\n \n \n+import org.apache.commons.lang.StringEscapeUtils;\n import org.apache.hadoop.conf.Configuration;\n import org.apache.hadoop.fs.FileSystem;\n import org.apache.hadoop.fs.Path;\n-import org.apache.hadoop.hive.cli.CliSessionState;\n import org.apache.hadoop.hive.conf.HiveConf;\n import org.apache.hadoop.hive.metastore.HiveMetaStoreClient;\n-import org.apache.hadoop.hive.metastore.MetaStoreUtils;\n-import org.apache.hadoop.hive.metastore.api.*;\n-import org.apache.hadoop.hive.ql.session.SessionState;\n-import org.apache.hadoop.hive.serde.serdeConstants;\n-import org.apache.hadoop.hive.shims.ShimLoader;\n-import org.apache.tajo.catalog.CatalogConstants;\n-import org.apache.tajo.catalog.Column;\n-import org.apache.tajo.catalog.TableDesc;\n+import org.apache.hadoop.hive.metastore.api.Database;\n+import org.apache.hadoop.hive.metastore.api.InvalidOperationException;\n+import org.apache.hadoop.hive.metastore.api.NoSuchObjectException;\n+import org.apache.tajo.catalog.*;\n+import org.apache.tajo.catalog.partition.PartitionMethodDesc;\n import org.apache.tajo.catalog.proto.CatalogProtos;\n import org.apache.tajo.common.TajoDataTypes;\n import org.apache.tajo.conf.TajoConf;\n@@ -42,7 +39,9 @@\n import org.junit.Test;\n \n import java.io.IOException;\n-import java.util.*;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n \n import static org.junit.Assert.*;\n \n@@ -56,9 +55,14 @@\n   private static final String DB_NAME = \"test_hive\";\n   private static final String CUSTOMER = \"customer\";\n   private static final String NATION = \"nation\";\n+  private static final String REGION = \"region\";\n+  private static final String SUPPLIER = \"supplier\";\n+\n   private static CatalogStore store;\n   private static int port;\n \n+  private static Path warehousePath;\n+\n   @BeforeClass\n   public static void setUp() throws Exception {\n     // delete metstore default path for successful unit tests\n@@ -68,46 +72,30 @@ public static void setUp() throws Exception {\n     Database db = new Database();\n     db.setName(DB_NAME);\n \n-    Path warehousePath = new Path(CommonTestingUtil.getTestDir(), DB_NAME);\n-    port = MetaStoreUtils.findFreePort();\n-    MetaStoreUtils.startMetaStore(port, ShimLoader.getHadoopThriftAuthBridge());\n+    warehousePath = new Path(CommonTestingUtil.getTestDir(), DB_NAME);\n     db.setLocationUri(warehousePath.toString());\n \n-    String metastoreUri = \"thrift://localhost:\" + port;\n-\n     HiveConf conf = new HiveConf();\n-    conf.setVar(HiveConf.ConfVars.METASTOREURIS, metastoreUri);\n-    conf.setIntVar(HiveConf.ConfVars.METASTORETHRIFTCONNECTIONRETRIES, 3);\n-    conf.set(HiveConf.ConfVars.PREEXECHOOKS.varname, \"\");\n-    conf.set(HiveConf.ConfVars.POSTEXECHOOKS.varname, \"\");\n-    conf.set(HiveConf.ConfVars.HIVE_SUPPORT_CONCURRENCY.varname, \"false\");\n-    conf.set(HiveConf.ConfVars.METASTORE_EVENT_LISTENERS.varname, DummyListener.class.getName());\n-\n-    // set property to use at HCatalogUtil\n-    System.setProperty(HiveConf.ConfVars.METASTOREURIS.varname, metastoreUri);\n-    System.setProperty(HiveConf.ConfVars.METASTORETHRIFTCONNECTIONRETRIES.varname, \"3\");\n-    System.setProperty(HiveConf.ConfVars.PREEXECHOOKS.varname, \"\");\n-    System.setProperty(HiveConf.ConfVars.POSTEXECHOOKS.varname, \"\");\n-    System.setProperty(HiveConf.ConfVars.HIVE_SUPPORT_CONCURRENCY.varname, \"false\");\n-    System.setProperty(HiveConf.ConfVars.METASTORE_EVENT_LISTENERS.varname, DummyListener.class.getName());\n-\n-    SessionState.start(new CliSessionState(conf));\n+    conf.set(HiveConf.ConfVars.METASTOREWAREHOUSE.varname, warehousePath.toString());\n+\n+    // create hive configuration file for unit tests\n+    Path path = new Path(warehousePath.getParent(), \"hive-site.xml\");\n+    FileSystem fs = FileSystem.getLocal(new Configuration());\n+    conf.writeXml(fs.create(path));\n \n     // create database and tables on Hive MetaStore.\n     client = new HiveMetaStoreClient(conf);\n-\n     client.createDatabase(db);\n-    createTable(NATION);\n-    createTable(CUSTOMER);\n-\n-    DummyListener.notifyList.clear();\n \n     // create local HCatalogStore.\n     TajoConf tajoConf = new TajoConf();\n     tajoConf.set(CatalogConstants.STORE_CLASS, HCatalogStore.class.getCanonicalName());\n     tajoConf.setVar(TajoConf.ConfVars.CATALOG_ADDRESS, \"127.0.0.1:0\");\n+    tajoConf.addResource(path.toString());\n+    tajoConf.set(HiveConf.ConfVars.METASTOREWAREHOUSE.varname, warehousePath.toString());\n \n     store = new HCatalogStore(tajoConf);\n+\n   }\n \n   private static void deleteMetaStoreDirectory() throws Exception {\n@@ -119,66 +107,17 @@ private static void deleteMetaStoreDirectory() throws Exception {\n     fs.close();\n   }\n \n-  private static void createTable(String tableName) throws Exception {\n-    Map<String, String> tableParams = new HashMap<String, String>();\n-\n-    List<FieldSchema> cols = new ArrayList<FieldSchema>();\n-\n-    if (tableName.equals(CUSTOMER)) {\n-      cols.add(new FieldSchema(\"c_custkey\", \"int\", \"\"));\n-      cols.add(new FieldSchema(\"c_name\", \"string\", \"\"));\n-      cols.add(new FieldSchema(\"c_address\", \"string\", \"\"));\n-      cols.add(new FieldSchema(\"c_nationkey\", \"int\", \"\"));\n-      cols.add(new FieldSchema(\"c_phone\", \"string\", \"\"));\n-      cols.add(new FieldSchema(\"c_acctbal\", \"double\", \"\"));\n-      cols.add(new FieldSchema(\"c_mktsegment\", \"string\", \"\"));\n-      cols.add(new FieldSchema(\"c_comment\", \"string\", \"\"));\n-    } else {\n-      cols.add(new FieldSchema(\"n_nationkey\", \"int\", \"\"));\n-      cols.add(new FieldSchema(\"n_name\", \"string\", \"\"));\n-      cols.add(new FieldSchema(\"n_regionkey\", \"int\", \"\"));\n-      cols.add(new FieldSchema(\"n_comment\", \"string\", \"\"));\n-    }\n-\n-    StorageDescriptor sd = new StorageDescriptor();\n-    sd.setCols(cols);\n-    sd.setCompressed(false);\n-    sd.setParameters(tableParams);\n-    sd.setSerdeInfo(new SerDeInfo());\n-    sd.getSerdeInfo().setName(tableName);\n-    sd.getSerdeInfo().setParameters(new HashMap<String, String>());\n-    sd.getSerdeInfo().getParameters().put(serdeConstants.SERIALIZATION_FORMAT, \"1\");\n-\n-    if (tableName.equals(CUSTOMER)) {\n-      sd.getSerdeInfo().setSerializationLib(org.apache.hadoop.hive.serde2.columnar.ColumnarSerDe.class.getName());\n-      sd.setInputFormat(org.apache.hadoop.hive.ql.io.RCFileInputFormat.class.getName());\n-      sd.setOutputFormat(org.apache.hadoop.hive.ql.io.RCFileOutputFormat.class.getName());\n-    } else {\n-      sd.setInputFormat(org.apache.hadoop.mapred.TextInputFormat.class.getName());\n-      sd.setOutputFormat(org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat.class.getName());\n-    }\n-\n-\n-    Table table = new Table();\n-    table.setDbName(DB_NAME);\n-    table.setTableName(tableName);\n-    table.setParameters(tableParams);\n-    table.setSd(sd);\n-\n-    if (tableName.equals(NATION)) {\n-      table.addToPartitionKeys(new FieldSchema(\"type\", \"string\", \"\"));\n-    }\n-\n-    client.createTable(table);\n-  }\n-\n   @AfterClass\n   public static void tearDown() throws IOException {\n     try {\n       if (store.existTable(DB_NAME + \".\" + CUSTOMER))\n         store.deleteTable(DB_NAME + \".\" + CUSTOMER);\n       if (store.existTable(DB_NAME + \".\" + NATION))\n         store.deleteTable(DB_NAME + \".\" + NATION);\n+      if (store.existTable(DB_NAME + \".\" + REGION))\n+        store.deleteTable(DB_NAME + \".\" + REGION);\n+      if (store.existTable(DB_NAME + \".\" + SUPPLIER))\n+        store.deleteTable(DB_NAME + \".\" + SUPPLIER);\n       dropDatabase();\n       client.close();\n       store.close();\n@@ -198,56 +137,122 @@ private static void dropDatabase() throws Exception {\n     }\n   }\n \n-  // Current Hive MetaStoreClient doesn't support to set table location.\n-  // If Tajo update table path, ThriftHiveMetaStore make a MetaException.\n-  // So, it needs to disable until Hive support to set table location.\n-//  @Test\n-//  public void testAddTable() throws Exception {\n-//    TableDesc table = new TableDesc();\n-//\n-//    table.setName(CUSTOMER);\n-//\n-//    org.apache.tajo.catalog.Schema schema = new org.apache.tajo.catalog.Schema();\n-//    schema.addColumn(\"c_custkey\", TajoDataTypes.Type.INT4);\n-//    schema.addColumn(\"c_name\", TajoDataTypes.Type.TEXT);\n-//    schema.addColumn(\"c_address\", TajoDataTypes.Type.TEXT);\n-//    schema.addColumn(\"c_nationkey\", TajoDataTypes.Type.INT4);\n-//    schema.addColumn(\"c_phone\", TajoDataTypes.Type.TEXT);\n-//    schema.addColumn(\"c_acctbal\", TajoDataTypes.Type.FLOAT8);\n-//    schema.addColumn(\"c_mktsegment\", TajoDataTypes.Type.TEXT);\n-//    schema.addColumn(\"c_comment\", TajoDataTypes.Type.TEXT);\n-//\n-//    table.setSchema(schema);\n-//    store.addTable(table);\n-//  }\n-//  @Test\n-//  public void testAddTableByPartition() throws Exception {\n-//    TableDesc table = new TableDesc();\n-//\n-//    table.setName(NATION);\n-//\n-//    org.apache.tajo.catalog.Schema schema = new org.apache.tajo.catalog.Schema();\n-//    schema.addColumn(\"n_nationkey\", TajoDataTypes.Type.INT4);\n-//    schema.addColumn(\"n_name\", TajoDataTypes.Type.TEXT);\n-//    schema.addColumn(\"n_regionkey\", TajoDataTypes.Type.INT4);\n-//    schema.addColumn(\"n_comment\", TajoDataTypes.Type.TEXT);\n-//    table.setSchema(schema);\n-//\n-//    Partitions partitions = new Partitions();\n-//    partitions.addColumn(\"type\", TajoDataTypes.Type.TEXT);\n-//    table.setPartitions(partitions);\n-//\n-//    store.addTable(table);\n-//  }\n+  @Test\n+  public void testAddTable1() throws Exception {\n+    TableDesc table = new TableDesc();\n+\n+    table.setName(DB_NAME + \".\" + CUSTOMER);\n+\n+    Options options = new Options();\n+    options.put(HCatalogStore.CSVFILE_DELIMITER, \"\\u0001\");\n+    TableMeta meta = new TableMeta(CatalogProtos.StoreType.RCFILE, options);\n+    table.setMeta(meta);\n+\n+    table.setPath(new Path(warehousePath, CUSTOMER));\n+\n+    org.apache.tajo.catalog.Schema schema = new org.apache.tajo.catalog.Schema();\n+    schema.addColumn(\"c_custkey\", TajoDataTypes.Type.INT4);\n+    schema.addColumn(\"c_name\", TajoDataTypes.Type.TEXT);\n+    schema.addColumn(\"c_address\", TajoDataTypes.Type.TEXT);\n+    schema.addColumn(\"c_nationkey\", TajoDataTypes.Type.INT4);\n+    schema.addColumn(\"c_phone\", TajoDataTypes.Type.TEXT);\n+    schema.addColumn(\"c_acctbal\", TajoDataTypes.Type.FLOAT8);\n+    schema.addColumn(\"c_mktsegment\", TajoDataTypes.Type.TEXT);\n+    schema.addColumn(\"c_comment\", TajoDataTypes.Type.TEXT);\n+\n+    table.setSchema(schema);\n+    store.addTable(table.getProto());\n+  }\n+\n+  @Test\n+  public void testAddTable2() throws Exception {\n+    TableDesc table = new TableDesc();\n+\n+    table.setName(DB_NAME + \".\" + REGION);\n+\n+    Options options = new Options();\n+    options.put(HCatalogStore.CSVFILE_DELIMITER, \"|\");\n+    options.put(HCatalogStore.CSVFILE_NULL, \"\\t\");\n+    TableMeta meta = new TableMeta(CatalogProtos.StoreType.CSV, options);\n+    table.setMeta(meta);\n+\n+    table.setPath(new Path(warehousePath, REGION));\n+\n+    org.apache.tajo.catalog.Schema schema = new org.apache.tajo.catalog.Schema();\n+    schema.addColumn(\"r_regionkey\", TajoDataTypes.Type.INT4);\n+    schema.addColumn(\"r_name\", TajoDataTypes.Type.TEXT);\n+    schema.addColumn(\"r_comment\", TajoDataTypes.Type.TEXT);\n+\n+    table.setSchema(schema);\n+    store.addTable(table.getProto());\n+  }\n+\n+  @Test\n+  public void testAddTable3() throws Exception {\n+    TableDesc table = new TableDesc();\n+\n+    table.setName(DB_NAME + \".\" + SUPPLIER);\n+\n+    Options options = new Options();\n+    options.put(HCatalogStore.CSVFILE_DELIMITER, \"\\t\");\n+    options.put(HCatalogStore.CSVFILE_NULL, \"\\u0002\");\n+    TableMeta meta = new TableMeta(CatalogProtos.StoreType.CSV, options);\n+    table.setMeta(meta);\n+\n+    table.setPath(new Path(warehousePath, SUPPLIER));\n+\n+    org.apache.tajo.catalog.Schema schema = new org.apache.tajo.catalog.Schema();\n+    schema.addColumn(\"s_suppkey\", TajoDataTypes.Type.INT4);\n+    schema.addColumn(\"s_name\", TajoDataTypes.Type.TEXT);\n+    schema.addColumn(\"s_address\", TajoDataTypes.Type.TEXT);\n+    schema.addColumn(\"s_nationkey\", TajoDataTypes.Type.INT4);\n+    schema.addColumn(\"s_phone\", TajoDataTypes.Type.TEXT);\n+    schema.addColumn(\"s_acctbal\", TajoDataTypes.Type.FLOAT8);\n+    schema.addColumn(\"s_comment\", TajoDataTypes.Type.TEXT);\n+\n+    table.setSchema(schema);\n+    store.addTable(table.getProto());\n+  }\n+\n+  @Test\n+  public void testAddTableByPartition() throws Exception {\n+    TableDesc table = new TableDesc();\n+\n+    table.setName(DB_NAME + \".\" + NATION);\n+\n+    Options options = new Options();\n+    options.put(HCatalogStore.CSVFILE_DELIMITER, \"\\u0001\");\n+    TableMeta meta = new TableMeta(CatalogProtos.StoreType.CSV, options);\n+    table.setMeta(meta);\n+\n+    table.setPath(new Path(warehousePath, NATION));\n+\n+    org.apache.tajo.catalog.Schema schema = new org.apache.tajo.catalog.Schema();\n+    schema.addColumn(\"n_name\", TajoDataTypes.Type.TEXT);\n+    schema.addColumn(\"n_regionkey\", TajoDataTypes.Type.INT4);\n+    schema.addColumn(\"n_comment\", TajoDataTypes.Type.TEXT);\n+    table.setSchema(schema);\n+\n+    org.apache.tajo.catalog.Schema expressionSchema = new org.apache.tajo.catalog.Schema();\n+    expressionSchema.addColumn(\"n_nationkey\", TajoDataTypes.Type.INT4);\n+\n+    PartitionMethodDesc partitions = new PartitionMethodDesc(DB_NAME + \".\" + NATION,\n+        CatalogProtos.PartitionType.COLUMN, expressionSchema.getColumn(0).getQualifiedName(), expressionSchema);\n+    table.setPartitionMethod(partitions);\n+\n+    store.addTable(table.getProto());\n+  }\n \n   @Test\n   public void testExistTable() throws Exception {\n     assertTrue(store.existTable(DB_NAME + \".\" + CUSTOMER));\n     assertTrue(store.existTable(DB_NAME + \".\" + NATION));\n+    assertTrue(store.existTable(DB_NAME + \".\" + REGION));\n+    assertTrue(store.existTable(DB_NAME + \".\" + SUPPLIER));\n   }\n \n   @Test\n-  public void testGetTable() throws Exception {\n+  public void testGetTable1() throws Exception {\n     TableDesc table = new TableDesc(store.getTable(DB_NAME + \".\" + CUSTOMER));\n \n     List<Column> columns = table.getSchema().getColumns();\n@@ -269,37 +274,95 @@ public void testGetTable() throws Exception {\n     assertEquals(TajoDataTypes.Type.TEXT, columns.get(6).getDataType().getType());\n     assertEquals(\"c_comment\", columns.get(7).getSimpleName());\n     assertEquals(TajoDataTypes.Type.TEXT, columns.get(7).getDataType().getType());\n+\n     assertNull(table.getPartitionMethod());\n+\n     assertEquals(table.getMeta().getStoreType().name(), CatalogProtos.StoreType.RCFILE.name());\n+  }\n \n+  @Test\n+  public void testGetTable2() throws Exception {\n+    TableDesc table = new TableDesc(store.getTable(DB_NAME + \".\" + NATION));\n \n-    table = new TableDesc(store.getTable(DB_NAME + \".\" + NATION));\n-    columns = table.getSchema().getColumns();\n+    List<Column> columns = table.getSchema().getColumns();\n     assertEquals(DB_NAME + \".\" + NATION, table.getName());\n-    assertEquals(4, columns.size());\n-    assertEquals(\"n_nationkey\", columns.get(0).getSimpleName());\n-    assertEquals(TajoDataTypes.Type.INT4, columns.get(0).getDataType().getType());\n-    assertEquals(\"n_name\", columns.get(1).getSimpleName());\n-    assertEquals(TajoDataTypes.Type.TEXT, columns.get(1).getDataType().getType());\n-    assertEquals(\"n_regionkey\", columns.get(2).getSimpleName());\n-    assertEquals(TajoDataTypes.Type.INT4, columns.get(2).getDataType().getType());\n-    assertEquals(\"n_comment\", columns.get(3).getSimpleName());\n-    assertEquals(TajoDataTypes.Type.TEXT, columns.get(3).getDataType().getType());\n+    assertEquals(3, columns.size());\n+    assertEquals(\"n_name\", columns.get(0).getSimpleName());\n+    assertEquals(TajoDataTypes.Type.TEXT, columns.get(0).getDataType().getType());\n+    assertEquals(\"n_regionkey\", columns.get(1).getSimpleName());\n+    assertEquals(TajoDataTypes.Type.INT4, columns.get(1).getDataType().getType());\n+    assertEquals(\"n_comment\", columns.get(2).getSimpleName());\n+    assertEquals(TajoDataTypes.Type.TEXT, columns.get(2).getDataType().getType());\n+\n     assertNotNull(table.getPartitionMethod());\n-    assertEquals(\"type\", table.getPartitionMethod().getExpressionSchema().getColumn(0).getSimpleName());\n+\n+    assertEquals(\"n_nationkey\", table.getPartitionMethod().getExpressionSchema().getColumn(0).getSimpleName());\n     assertEquals(CatalogProtos.PartitionType.COLUMN, table.getPartitionMethod().getPartitionType());\n \n-    assertEquals(table.getMeta().getOption(HCatalogStore.CVSFILE_DELIMITER), \"\\\\001\");\n     assertEquals(table.getMeta().getStoreType().name(), CatalogProtos.StoreType.CSV.name());\n+    assertEquals(table.getMeta().getOption(HCatalogStore.CSVFILE_DELIMITER), StringEscapeUtils.escapeJava(\"\\u0001\"));\n+    assertEquals(table.getMeta().getOption(HCatalogStore.CSVFILE_NULL), StringEscapeUtils.escapeJava(\"\\\\N\"));\n+  }\n+\n+  @Test\n+  public void testGetTable3() throws Exception {\n+    TableDesc table = new TableDesc(store.getTable(DB_NAME + \".\" + REGION));\n+\n+    List<Column> columns = table.getSchema().getColumns();\n+    assertEquals(DB_NAME + \".\" + REGION, table.getName());\n+    assertEquals(3, columns.size());\n+    assertEquals(\"r_regionkey\", columns.get(0).getSimpleName());\n+    assertEquals(TajoDataTypes.Type.INT4, columns.get(0).getDataType().getType());\n+    assertEquals(\"r_name\", columns.get(1).getSimpleName());\n+    assertEquals(TajoDataTypes.Type.TEXT, columns.get(1).getDataType().getType());\n+    assertEquals(\"r_comment\", columns.get(2).getSimpleName());\n+    assertEquals(TajoDataTypes.Type.TEXT, columns.get(2).getDataType().getType());\n+\n+    assertNull(table.getPartitionMethod());\n \n+    assertEquals(table.getMeta().getStoreType().name(), CatalogProtos.StoreType.CSV.name());\n+    assertEquals(table.getMeta().getOption(HCatalogStore.CSVFILE_DELIMITER), StringEscapeUtils.escapeJava(\"|\"));\n+    assertEquals(table.getMeta().getOption(HCatalogStore.CSVFILE_NULL), StringEscapeUtils.escapeJava(\"\\t\"));\n+  }\n+\n+  @Test\n+  public void testGetTable4() throws Exception {\n+    TableDesc table = new TableDesc(store.getTable(DB_NAME + \".\" + SUPPLIER));\n+\n+    List<Column> columns = table.getSchema().getColumns();\n+    assertEquals(DB_NAME + \".\" + SUPPLIER, table.getName());\n+    assertEquals(7, columns.size());\n+    assertEquals(\"s_suppkey\", columns.get(0).getSimpleName());\n+    assertEquals(TajoDataTypes.Type.INT4, columns.get(0).getDataType().getType());\n+    assertEquals(\"s_name\", columns.get(1).getSimpleName());\n+    assertEquals(TajoDataTypes.Type.TEXT, columns.get(1).getDataType().getType());\n+    assertEquals(\"s_address\", columns.get(2).getSimpleName());\n+    assertEquals(TajoDataTypes.Type.TEXT, columns.get(2).getDataType().getType());\n+    assertEquals(\"s_nationkey\", columns.get(3).getSimpleName());\n+    assertEquals(TajoDataTypes.Type.INT4, columns.get(3).getDataType().getType());\n+    assertEquals(\"s_phone\", columns.get(4).getSimpleName());\n+    assertEquals(TajoDataTypes.Type.TEXT, columns.get(4).getDataType().getType());\n+    assertEquals(\"s_acctbal\", columns.get(5).getSimpleName());\n+    assertEquals(TajoDataTypes.Type.FLOAT8, columns.get(5).getDataType().getType());\n+    assertEquals(\"s_comment\", columns.get(6).getSimpleName());\n+    assertEquals(TajoDataTypes.Type.TEXT, columns.get(6).getDataType().getType());\n+\n+    assertNull(table.getPartitionMethod());\n+\n+    assertEquals(table.getMeta().getStoreType().name(), CatalogProtos.StoreType.CSV.name());\n+    assertEquals(table.getMeta().getOption(HCatalogStore.CSVFILE_DELIMITER), StringEscapeUtils.escapeJava(\"\\t\"));\n+    assertEquals(table.getMeta().getOption(HCatalogStore.CSVFILE_NULL), StringEscapeUtils.escapeJava(\"\\u0002\"));\n   }\n \n+\n   @Test\n   public void testGetAllTableNames() throws Exception{\n     Set<String> tables = new HashSet<String>(store.getAllTableNames());\n-    assertEquals(2, tables.size());\n+    assertEquals(4, tables.size());\n     assertTrue(tables.contains(DB_NAME + \".\" + CUSTOMER));\n     assertTrue(tables.contains(DB_NAME + \".\" + NATION));\n+    assertTrue(tables.contains(DB_NAME + \".\" + REGION));\n+    assertTrue(tables.contains(DB_NAME + \".\" + SUPPLIER));\n   }\n \n   @Test\n@@ -310,12 +373,22 @@ public void testDeleteTable() throws Exception {\n     table = new TableDesc(store.getTable(DB_NAME + \".\" + NATION));\n     Path nationPath = table.getPath();\n \n+    table = new TableDesc(store.getTable(DB_NAME + \".\" + REGION));\n+    Path regionPath = table.getPath();\n+\n+    table = new TableDesc(store.getTable(DB_NAME + \".\" + SUPPLIER));\n+    Path supplierPath = table.getPath();\n+\n     store.deleteTable(DB_NAME + \".\" + CUSTOMER);\n     store.deleteTable(DB_NAME + \".\" + NATION);\n+    store.deleteTable(DB_NAME + \".\" + REGION);\n+    store.deleteTable(DB_NAME + \".\" + SUPPLIER);\n \n     FileSystem fs = FileSystem.getLocal(new Configuration());\n     assertTrue(fs.exists(customerPath));\n     assertTrue(fs.exists(nationPath));\n+    assertTrue(fs.exists(regionPath));\n+    assertTrue(fs.exists(supplierPath));\n     fs.close();\n   }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/e0b6f7ae8e2215e71500d1d0d8faa2318d3d3d1e/tajo-catalog/tajo-catalog-drivers/tajo-hcatalog/src/test/java/org/apache/tajo/catalog/store/TestHCatalogStore.java",
                "sha": "3cf2302a05818ab2ee64c343103a4db372e82fc8",
                "status": "modified"
            }
        ],
        "message": "TAJO-641: NPE in HCatalogStore.addTable(). (jaehwa)",
        "parent": "https://github.com/apache/tajo/commit/e47242e68e217f3d897ae897766f987a44657f7d",
        "patched_files": [
            "HCatalogStoreClientPool.java",
            "DummyListener.java",
            "CHANGES.txt",
            "Schema.java",
            "HCatalogStore.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestSchema.java",
            "TestHCatalogStore.java"
        ]
    },
    "tajo_e56a7a4": {
        "bug_id": "tajo_e56a7a4",
        "commit": "https://github.com/apache/tajo/commit/e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/CHANGES.txt",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES.txt?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 0,
                "filename": "CHANGES.txt",
                "patch": "@@ -334,6 +334,9 @@ Release 0.8.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-777: Partition column in function parameter occurs NPE.\n+    (Hyoungjun Kim via hyunsik)\n+\n     TAJO-763: Out of range problem in utc_usec_to(). (Ilhyun Suh via hyunsik)\n \n     TAJO-741: GreedyHeuristicJoinOrderAlgorithm removes some join pairs. (jaehwa)",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/CHANGES.txt",
                "sha": "d6ed95a9cc5881f745cda52f3a2732ec176d6946",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/DDLBuilder.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/DDLBuilder.java?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 1,
                "filename": "tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/DDLBuilder.java",
                "patch": "@@ -54,7 +54,6 @@ public static String buildDDLForBaseTable(TableDesc desc) {\n     sb.append(\"--\\n\")\n         .append(\"-- Name: \").append(CatalogUtil.denormalizeIdentifier(desc.getName())).append(\"; Type: TABLE;\")\n         .append(\" Storage: \").append(desc.getMeta().getStoreType().name());\n-    sb.append(\"\\n-- Path: \").append(desc.getPath());\n     sb.append(\"\\n--\\n\");\n     sb.append(\"CREATE TABLE \").append(CatalogUtil.denormalizeIdentifier(desc.getName()));\n     buildSchema(sb, desc.getSchema());",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-catalog/tajo-catalog-common/src/main/java/org/apache/tajo/catalog/DDLBuilder.java",
                "sha": "77dccd2ee1a67d5787fb4420b8c28bd3e15b5fb3",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-client/src/main/java/org/apache/tajo/client/TajoDump.java",
                "changes": 18,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-client/src/main/java/org/apache/tajo/client/TajoDump.java?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 8,
                "filename": "tajo-client/src/main/java/org/apache/tajo/client/TajoDump.java",
                "patch": "@@ -110,15 +110,15 @@ public static void main(String [] args) throws ParseException, IOException, Serv\n     }\n \n     PrintWriter writer = new PrintWriter(System.out);\n-    dump(client, userInfo, baseDatabaseName, isDumpingAllDatabases, true, writer);\n+    dump(client, userInfo, baseDatabaseName, isDumpingAllDatabases, true, true, writer);\n \n     System.exit(0);\n   }\n \n   public static void dump(TajoClient client, UserGroupInformation userInfo, String baseDatabaseName,\n-                   boolean isDumpingAllDatabases, boolean includeDate, PrintWriter out)\n+                   boolean isDumpingAllDatabases, boolean includeUserName, boolean includeDate, PrintWriter out)\n       throws SQLException, ServiceException {\n-    printHeader(out, userInfo, includeDate);\n+    printHeader(out, userInfo, includeUserName, includeDate);\n \n     if (isDumpingAllDatabases) {\n       // sort database names in an ascending lexicographic order of the names.\n@@ -134,13 +134,15 @@ public static void dump(TajoClient client, UserGroupInformation userInfo, String\n     out.flush();\n   }\n \n-  private static void printHeader(PrintWriter writer, UserGroupInformation userInfo, boolean includeDate) {\n+  private static void printHeader(PrintWriter writer, UserGroupInformation userInfo, boolean includeUSerName,\n+                                  boolean includeDate) {\n     writer.write(\"--\\n\");\n     writer.write(\"-- Tajo database dump\\n\");\n-    writer.write(\"--\\n\");\n-    writer.write(\"-- Dump user: \" + userInfo.getUserName() + \"\\n\");\n+    if (includeUSerName) {\n+      writer.write(\"--\\nDump user: \" + userInfo.getUserName() + \"\\n\");\n+    }\n     if (includeDate) {\n-      writer.write(\"-- Dump date: \" + toDateString() + \"\\n\");\n+      writer.write(\"\\n-- Dump date: \" + toDateString() + \"\\n\");\n     }\n     writer.write(\"--\\n\");\n     writer.write(\"\\n\");\n@@ -154,7 +156,7 @@ private static void dumpDatabase(TajoClient client, String databaseName, PrintWr\n     writer.write(\"--\\n\");\n     writer.write(\"\\n\");\n     writer.write(String.format(\"CREATE DATABASE IF NOT EXISTS %s;\", CatalogUtil.denormalizeIdentifier(databaseName)));\n-    writer.write(\"\\n\");\n+    writer.write(\"\\n\\n\");\n \n     // returned list is immutable.\n     List<String> tableNames = TUtil.newList(client.getTableList(databaseName));",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-client/src/main/java/org/apache/tajo/client/TajoDump.java",
                "sha": "60b1a7e7cbea0c924e7880ae91ba15e6837e7b62",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/main/java/org/apache/tajo/engine/eval/BasicEvalNodeVisitor.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/eval/BasicEvalNodeVisitor.java?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 2,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/eval/BasicEvalNodeVisitor.java",
                "patch": "@@ -280,8 +280,8 @@ public RESULT visitCaseWhen(CONTEXT context, CaseWhenEval evalNode, Stack<EvalNo\n   public RESULT visitIfThen(CONTEXT context, CaseWhenEval.IfThenEval evalNode, Stack<EvalNode> stack) {\n     RESULT result;\n     stack.push(evalNode);\n-    result = visitChild(context, evalNode.getConditionExpr(), stack);\n-    visitChild(context, evalNode.getResultExpr(), stack);\n+    result = visitChild(context, evalNode.getCondition(), stack);\n+    visitChild(context, evalNode.getResult(), stack);\n     stack.pop();\n     return result;\n   }",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/main/java/org/apache/tajo/engine/eval/BasicEvalNodeVisitor.java",
                "sha": "015e9dbd1c762cc2843fde33d812e992ad9de965",
                "status": "modified"
            },
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/main/java/org/apache/tajo/engine/eval/BetweenPredicateEval.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/eval/BetweenPredicateEval.java?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 0,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/eval/BetweenPredicateEval.java",
                "patch": "@@ -46,14 +46,26 @@ public BetweenPredicateEval(boolean not, boolean symmetric, EvalNode predicand,\n     this.end = end;\n   }\n \n+  public void setPredicand(EvalNode predicand) {\n+    this.predicand = predicand;\n+  }\n+\n   public EvalNode getPredicand() {\n     return predicand;\n   }\n \n+  public void setBegin(EvalNode begin) {\n+    this.begin = begin;\n+  }\n+\n   public EvalNode getBegin() {\n     return begin;\n   }\n \n+  public void setEnd(EvalNode end) {\n+    this.end = end;\n+  }\n+\n   public EvalNode getEnd() {\n     return end;\n   }",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/main/java/org/apache/tajo/engine/eval/BetweenPredicateEval.java",
                "sha": "80e6494e486e80b903abf1ecaba87e17352664b8",
                "status": "modified"
            },
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/main/java/org/apache/tajo/engine/eval/CaseWhenEval.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/eval/CaseWhenEval.java?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 3,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/eval/CaseWhenEval.java",
                "patch": "@@ -63,7 +63,7 @@ public void setElseResult(EvalNode elseResult) {\n \n   @Override\n   public DataType getValueType() {\n-    return whens.get(0).getResultExpr().getValueType();\n+    return whens.get(0).getResult().getValueType();\n   }\n \n   @Override\n@@ -163,11 +163,19 @@ public Datum eval(Schema schema, Tuple tuple) {\n       return result.eval(schema, tuple);\n     }\n \n-    public EvalNode getConditionExpr() {\n+    public void setCondition(EvalNode condition) {\n+      this.condition = condition;\n+    }\n+\n+    public EvalNode getCondition() {\n       return this.condition;\n     }\n \n-    public EvalNode getResultExpr() {\n+    public void setResult(EvalNode result) {\n+      this.result = result;\n+    }\n+\n+    public EvalNode getResult() {\n       return this.result;\n     }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/main/java/org/apache/tajo/engine/eval/CaseWhenEval.java",
                "sha": "0883e5c8e239800dd61a1d58cfdfe89138b39de9",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/main/java/org/apache/tajo/engine/eval/CastEval.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/eval/CastEval.java?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 0,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/eval/CastEval.java",
                "patch": "@@ -36,6 +36,10 @@ public CastEval(EvalNode operand, DataType target) {\n     this.target = target;\n   }\n \n+  public void setOperand(EvalNode operand) {\n+    this.operand = operand;\n+  }\n+\n   public EvalNode getOperand() {\n     return operand;\n   }",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/main/java/org/apache/tajo/engine/eval/CastEval.java",
                "sha": "24a0409045cedfea72a779dae0e6d96f0cbe04d5",
                "status": "modified"
            },
            {
                "additions": 63,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/main/java/org/apache/tajo/engine/eval/EvalTreeUtil.java",
                "changes": 68,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/eval/EvalTreeUtil.java?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 5,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/eval/EvalTreeUtil.java",
                "patch": "@@ -57,11 +57,69 @@ public EvalNode visitChild(EvalNode context, EvalNode evalNode, Stack<EvalNode>\n       if (evalNode.equals(target)) {\n         EvalNode parent = stack.peek();\n \n-        if (parent.getLeftExpr().equals(evalNode)) {\n-          parent.setLeftExpr(tobeReplaced);\n-        }\n-        if (parent.getRightExpr().equals(evalNode)) {\n-          parent.setRightExpr(tobeReplaced);\n+        if (parent instanceof BetweenPredicateEval) {\n+          BetweenPredicateEval between = (BetweenPredicateEval) parent;\n+          if (between.getPredicand().equals(evalNode)) {\n+            between.setPredicand(tobeReplaced);\n+          }\n+          if (between.getBegin().equals(evalNode)) {\n+            between.setBegin(tobeReplaced);\n+          }\n+          if (between.getEnd().equals(evalNode)) {\n+            between.setEnd(tobeReplaced);\n+          }\n+\n+        } else if (parent instanceof CaseWhenEval) {\n+          CaseWhenEval caseWhen = (CaseWhenEval) parent;\n+\n+          // Here, we need to only consider only 'Else'\n+          // because IfElseEval is handled in the below condition.\n+          if (caseWhen.hasElse() && caseWhen.getElse().equals(evalNode)) {\n+            caseWhen.setElseResult(tobeReplaced);\n+          }\n+        } else if (parent instanceof CaseWhenEval.IfThenEval) {\n+          CaseWhenEval.IfThenEval ifThen = (CaseWhenEval.IfThenEval) parent;\n+          if (ifThen.getCondition().equals(evalNode)) {\n+            ifThen.setCondition(tobeReplaced);\n+          }\n+          if (ifThen.getResult().equals(evalNode)) {\n+            ifThen.setResult(tobeReplaced);\n+          }\n+        } else if (parent instanceof CastEval) {\n+          CastEval cast = (CastEval) parent;\n+          if (cast.getOperand().equals(evalNode)) {\n+            cast.setOperand(tobeReplaced);\n+          }\n+\n+       } else if (parent instanceof FunctionEval) {\n+          FunctionEval functionEval = (FunctionEval) parent;\n+          EvalNode [] arguments = functionEval.getArgs();\n+          for (int i = 0; i < arguments.length; i++) {\n+            if (arguments[i].equals(evalNode)) {\n+              arguments[i] = tobeReplaced;\n+            }\n+          }\n+          functionEval.setArgs(arguments);\n+\n+        } else if (parent instanceof NotEval) {\n+          NotEval not = (NotEval) parent;\n+          if (not.getChild().equals(evalNode)) {\n+            not.setChild(tobeReplaced);\n+          }\n+\n+        } else if (parent instanceof SignedEval) {\n+          SignedEval sign = (SignedEval) parent;\n+          if (sign.getChild().equals(evalNode)) {\n+            sign.setChild(tobeReplaced);\n+          }\n+\n+        } else {\n+          if (parent.getLeftExpr() != null && parent.getLeftExpr().equals(evalNode)) {\n+            parent.setLeftExpr(tobeReplaced);\n+          }\n+          if (parent.getRightExpr() != null && parent.getRightExpr().equals(evalNode)) {\n+            parent.setRightExpr(tobeReplaced);\n+          }\n         }\n       }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/main/java/org/apache/tajo/engine/eval/EvalTreeUtil.java",
                "sha": "38c7e1f7336266f6cd26f2633fda16aa543507e8",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/main/java/org/apache/tajo/engine/eval/FunctionEval.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/eval/FunctionEval.java?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 1,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/eval/FunctionEval.java",
                "patch": "@@ -64,7 +64,7 @@ public FunctionEval(EvalType type, FunctionDesc funcDesc, EvalNode[] argEvals) {\n   public boolean isDistinct() {\n     return funcDesc.getFuncType() == DISTINCT_AGGREGATION || funcDesc.getFuncType() == DISTINCT_UDA;\n   }\n-\t\n+\n \tpublic EvalNode [] getArgs() {\n \t  return this.argEvals;\n \t}",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/main/java/org/apache/tajo/engine/eval/FunctionEval.java",
                "sha": "6781c3415650c81cbca3f36eadd926a38f75da60",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/main/java/org/apache/tajo/engine/eval/NotEval.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/eval/NotEval.java?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 0,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/eval/NotEval.java",
                "patch": "@@ -36,6 +36,10 @@ public NotEval(EvalNode childEval) {\n     this.childEval = childEval;\n   }\n \n+  public void setChild(EvalNode child) {\n+    this.childEval = child;\n+  }\n+\n   public EvalNode getChild() {\n     return childEval;\n   }",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/main/java/org/apache/tajo/engine/eval/NotEval.java",
                "sha": "20de725c214cd071e06e178655f0fdf11942f06c",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/main/java/org/apache/tajo/engine/eval/SignedEval.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/engine/eval/SignedEval.java?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 0,
                "filename": "tajo-core/src/main/java/org/apache/tajo/engine/eval/SignedEval.java",
                "patch": "@@ -39,6 +39,10 @@ public boolean isNegative() {\n     return negative;\n   }\n \n+  public void setChild(EvalNode child) {\n+    this.childEval = child;\n+  }\n+\n   public EvalNode getChild() {\n     return childEval;\n   }",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/main/java/org/apache/tajo/engine/eval/SignedEval.java",
                "sha": "33ea70fc62bf9a6cf2d6505936bc1101877ed310",
                "status": "modified"
            },
            {
                "additions": 12,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/java/org/apache/tajo/client/TestTajoDump.java",
                "changes": 22,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/java/org/apache/tajo/client/TestTajoDump.java?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 10,
                "filename": "tajo-core/src/test/java/org/apache/tajo/client/TestTajoDump.java",
                "patch": "@@ -29,16 +29,18 @@\n \n   @Test\n   public void testDump1() throws Exception {\n-    executeString(\"CREATE TABLE \\\"\" +getCurrentDatabase() +\n-        \"\\\".\\\"TableName1\\\" (\\\"Age\\\" int, \\\"FirstName\\\" TEXT, lastname TEXT)\");\n+    if (!testingCluster.isHCatalogStoreRunning()) {\n+      executeString(\"CREATE TABLE \\\"\" + getCurrentDatabase() +\n+          \"\\\".\\\"TableName1\\\" (\\\"Age\\\" int, \\\"FirstName\\\" TEXT, lastname TEXT)\");\n \n-    UserGroupInformation userInfo = UserGroupInformation.getCurrentUser();\n-    ByteArrayOutputStream bos = new ByteArrayOutputStream();\n-    PrintWriter printWriter = new PrintWriter(bos);\n-    TajoDump.dump(client, userInfo, getCurrentDatabase(), false, false, printWriter);\n-    printWriter.flush();\n-    printWriter.close();\n-    assertStrings(new String(bos.toByteArray()));\n-    bos.close();\n+      UserGroupInformation userInfo = UserGroupInformation.getCurrentUser();\n+      ByteArrayOutputStream bos = new ByteArrayOutputStream();\n+      PrintWriter printWriter = new PrintWriter(bos);\n+      TajoDump.dump(client, userInfo, getCurrentDatabase(), false, false, false, printWriter);\n+      printWriter.flush();\n+      printWriter.close();\n+      assertStrings(new String(bos.toByteArray()));\n+      bos.close();\n+    }\n   }\n }",
                "previous_filename": "tajo-core/src/test/resources/org/apache/tajo/client/TestTajoDump.java",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/java/org/apache/tajo/client/TestTajoDump.java",
                "sha": "e0d745ea4b77c43bc0cffbc98a3eae3bca0e5dd5",
                "status": "renamed"
            },
            {
                "additions": 35,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/java/org/apache/tajo/engine/query/TestTablePartitions.java",
                "changes": 35,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/java/org/apache/tajo/engine/query/TestTablePartitions.java?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 0,
                "filename": "tajo-core/src/test/java/org/apache/tajo/engine/query/TestTablePartitions.java",
                "patch": "@@ -152,6 +152,41 @@ public final void testQueryCasesOnColumnPartitionedTable() throws Exception {\n     res = executeFile(\"case3.sql\");\n     assertResultSet(res, \"case3.result\");\n     res.close();\n+\n+    // select pow(key, 2) from testQueryCasesOnColumnPartitionedTable\n+    res = executeFile(\"case4.sql\");\n+    assertResultSet(res, \"case4.result\");\n+    res.close();\n+\n+    // select round(pow(key + 1, 2)) from testQueryCasesOnColumnPartitionedTable\n+    res = executeFile(\"case5.sql\");\n+    assertResultSet(res, \"case5.result\");\n+    res.close();\n+\n+    // select col1, key from testQueryCasesOnColumnPartitionedTable order by pow(key, 2) desc\n+    res = executeFile(\"case6.sql\");\n+    assertResultSet(res, \"case6.result\");\n+    res.close();\n+\n+    // select col1, key from testQueryCasesOnColumnPartitionedTable WHERE key BETWEEN 35 AND 48;\n+    res = executeFile(\"case7.sql\");\n+    assertResultSet(res, \"case7.result\");\n+    res.close();\n+\n+    // select col1, CASE key WHEN 36 THEN key WHEN 49 THEN key ELSE key END from testQueryCasesOnColumnPartitionedTable;\n+    res = executeFile(\"case8.sql\");\n+    assertResultSet(res, \"case8.result\");\n+    res.close();\n+\n+    // select col1, CAST(key AS INT) from testQueryCasesOnColumnPartitionedTable;\n+    res = executeFile(\"case9.sql\");\n+    assertResultSet(res, \"case9.result\");\n+    res.close();\n+\n+    // select col1, (!(key > 35)) from testQueryCasesOnColumnPartitionedTable;\n+    res = executeFile(\"case10.sql\");\n+    assertResultSet(res, \"case10.result\");\n+    res.close();\n   }\n \n   @Test",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/java/org/apache/tajo/engine/query/TestTablePartitions.java",
                "sha": "9cc2410853cd9e117917912fba044bc629380921",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/queries/TestTablePartitions/case10.sql",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/queries/TestTablePartitions/case10.sql?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/queries/TestTablePartitions/case10.sql",
                "patch": "@@ -0,0 +1 @@\n+select col1, key, -key as res from testQueryCasesOnColumnPartitionedTable;\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/queries/TestTablePartitions/case10.sql",
                "sha": "715d8e896f48b3a44c0812362e6a6b3aed891bb9",
                "status": "added"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/queries/TestTablePartitions/case8.sql",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/queries/TestTablePartitions/case8.sql?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/queries/TestTablePartitions/case8.sql",
                "patch": "@@ -0,0 +1 @@\n+select col1, CASE key WHEN 36 THEN key WHEN 49 THEN key ELSE key END from testQueryCasesOnColumnPartitionedTable;\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/queries/TestTablePartitions/case8.sql",
                "sha": "fe57eb8f330a0143264f3e81e986af3e4b55fa3e",
                "status": "added"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/queries/TestTablePartitions/case9.sql",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/queries/TestTablePartitions/case9.sql?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/queries/TestTablePartitions/case9.sql",
                "patch": "@@ -0,0 +1 @@\n+select col1, CAST(key AS INT) from testQueryCasesOnColumnPartitionedTable;\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/queries/TestTablePartitions/case9.sql",
                "sha": "595e5336a2c99010521c624da49d97ce4f97d683",
                "status": "added"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/results/TestTablePartitions/case10.result",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/results/TestTablePartitions/case10.result?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/results/TestTablePartitions/case10.result",
                "patch": "@@ -0,0 +1,7 @@\n+col1,key,res\n+-------------------------------\n+1,17.0,-17.0\n+1,36.0,-36.0\n+2,38.0,-38.0\n+3,45.0,-45.0\n+3,49.0,-49.0\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/results/TestTablePartitions/case10.result",
                "sha": "a6be56d09320a971b9330392596e02ec5f2b4576",
                "status": "added"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/results/TestTablePartitions/case7.result",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/results/TestTablePartitions/case7.result?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/results/TestTablePartitions/case7.result",
                "patch": "@@ -0,0 +1,5 @@\n+col1,key\n+-------------------------------\n+1,36.0\n+2,38.0\n+3,45.0\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/results/TestTablePartitions/case7.result",
                "sha": "8426f48c8651708ec74a641534740389dd21cd6c",
                "status": "added"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/results/TestTablePartitions/case8.result",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/results/TestTablePartitions/case8.result?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/results/TestTablePartitions/case8.result",
                "patch": "@@ -0,0 +1,7 @@\n+col1,?casewhen\n+-------------------------------\n+1,17.0\n+1,36.0\n+2,38.0\n+3,45.0\n+3,49.0\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/results/TestTablePartitions/case8.result",
                "sha": "cb51cd6f99cc05e05fb18856229aa883e1cead12",
                "status": "added"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/results/TestTablePartitions/case9.result",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/results/TestTablePartitions/case9.result?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 0,
                "filename": "tajo-core/src/test/resources/results/TestTablePartitions/case9.result",
                "patch": "@@ -0,0 +1,7 @@\n+col1,?cast\n+-------------------------------\n+1,17\n+1,36\n+2,38\n+3,45\n+3,49\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/results/TestTablePartitions/case9.result",
                "sha": "ebfaad27a801448e2ef89953c23d62ef755c05a1",
                "status": "added"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/results/TestTajoDump/testDump1.result",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/results/TestTajoDump/testDump1.result?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 5,
                "filename": "tajo-core/src/test/resources/results/TestTajoDump/testDump1.result",
                "patch": "@@ -1,17 +1,16 @@\n --\n -- Tajo database dump\n --\n--- Dump user: hyunsik\n--- Dump date: 04/17/2014 13:33:45\n---\n \n \n --\n -- Database name: \"TestTajoDump\"\n --\n \n CREATE DATABASE IF NOT EXISTS \"TestTajoDump\";\n+\n --\n--- Name: TestTajoDump.TableName1; Type: TABLE; Storage: CSV\n+-- Name: \"TestTajoDump\".\"TableName1\"; Type: TABLE; Storage: CSV\n --\n-CREATE TABLE \"TestTajoDump\".\"TableName1\" (\"Age\" INT4, \"FirstName\" TEXT, lastname TEXT) USING CSV WITH ('csvfile.delimiter'='|');\n\\ No newline at end of file\n+CREATE TABLE \"TestTajoDump\".\"TableName1\" (\"Age\" INT4, \"FirstName\" TEXT, lastname TEXT) USING CSV WITH ('csvfile.delimiter'='|');\n+",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/results/TestTajoDump/testDump1.result",
                "sha": "fa684356ea131958603800987a3fc937955478b3",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/results/testDDLBuilder/testBuildDDLForBaseTable.result",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/results/testDDLBuilder/testBuildDDLForBaseTable.result?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 1,
                "filename": "tajo-core/src/test/resources/results/testDDLBuilder/testBuildDDLForBaseTable.result",
                "patch": "@@ -1,5 +1,4 @@\n --\n -- Name: db1.table2; Type: TABLE; Storage: CSV\n--- Path: /table1\n --\n CREATE TABLE db1.table2 (name BLOB, addr TEXT) USING CSV WITH ('compression.codec'='org.apache.hadoop.io.compress.GzipCodec', 'csvfile.delimiter'='|');\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/results/testDDLBuilder/testBuildDDLForBaseTable.result",
                "sha": "a6e2d05cbc4a6aae1b5ce3d39666d38ef7175e4d",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tajo/blob/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/results/testDDLBuilder/testBuildDDLQuotedTableName2.result",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/test/resources/results/testDDLBuilder/testBuildDDLQuotedTableName2.result?ref=e56a7a41fb6b27e093c5c49a2d86a8cabc203156",
                "deletions": 1,
                "filename": "tajo-core/src/test/resources/results/testDDLBuilder/testBuildDDLQuotedTableName2.result",
                "patch": "@@ -1,5 +1,4 @@\n --\n -- Name: db1.\"TABLE1\"; Type: TABLE; Storage: CSV\n--- Path: /table1\n --\n CREATE TABLE db1.\"TABLE1\" (name BLOB, addr TEXT, \"FirstName\" TEXT, \"LastName\" TEXT, \"with\" TEXT) USING CSV WITH ('compression.codec'='org.apache.hadoop.io.compress.GzipCodec', 'csvfile.delimiter'='|') PARTITION BY COLUMN(\"BirthYear\" INT4);\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/e56a7a41fb6b27e093c5c49a2d86a8cabc203156/tajo-core/src/test/resources/results/testDDLBuilder/testBuildDDLQuotedTableName2.result",
                "sha": "eeb9b594f1437b58ce38b9ebc9d3307483e2073f",
                "status": "modified"
            }
        ],
        "message": "TAJO-777: Partition column in function parameter occurs NPE. (Hyoungjun Kim via hyunsik)",
        "parent": "https://github.com/apache/tajo/commit/6a005ce7e4c5ed80278da702255197936c189ff3",
        "patched_files": [
            "BetweenPredicateEval.java",
            "TajoDump.java",
            "case8.sql",
            "testBuildDDLQuotedTableName2.result",
            "case8.result",
            "SignedEval.java",
            "FunctionEval.java",
            "case7.result",
            "case9.sql",
            "NotEval.java",
            "testBuildDDLForBaseTable.result",
            "case10.sql",
            "CastEval.java",
            "EvalTreeUtil.java",
            "testDump1.result",
            "CHANGES.txt",
            "BasicEvalNodeVisitor.java",
            "case10.result",
            "CaseWhenEval.java",
            "DDLBuilder.java",
            "case9.result"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestTablePartitions.java",
            "TestDDLBuilder.java",
            "TestTajoDump.java",
            "TestEvalTreeUtil.java"
        ]
    },
    "tajo_eef7878": {
        "bug_id": "tajo_eef7878",
        "commit": "https://github.com/apache/tajo/commit/eef7878bd3d82dc0468e3e977e43a46d3903781a",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/eef7878bd3d82dc0468e3e977e43a46d3903781a/CHANGES",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=eef7878bd3d82dc0468e3e977e43a46d3903781a",
                "deletions": 0,
                "filename": "CHANGES",
                "patch": "@@ -273,6 +273,8 @@ Release 0.11.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-1873: Fix NPE in QueryExecutorServlet. (jinho)\n+\n     TAJO-1871: '-DskipTests' flag does not work. (jihoon)\n \n     TAJO-1869: Incorrect result when sorting table with small files. (jinho)",
                "raw_url": "https://github.com/apache/tajo/raw/eef7878bd3d82dc0468e3e977e43a46d3903781a/CHANGES",
                "sha": "992eb276d9f6fa3bcbbe8cdb168f2dcba7b357dd",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/eef7878bd3d82dc0468e3e977e43a46d3903781a/tajo-client/src/main/java/org/apache/tajo/client/ResultSetUtil.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-client/src/main/java/org/apache/tajo/client/ResultSetUtil.java?ref=eef7878bd3d82dc0468e3e977e43a46d3903781a",
                "deletions": 2,
                "filename": "tajo-client/src/main/java/org/apache/tajo/client/ResultSetUtil.java",
                "patch": "@@ -43,8 +43,7 @@ public static String prettyFormat(ResultSet res) throws SQLException {\n     while (res.next()) {\n       for (int i = 1; i <= numOfColumns; i++) {\n         if (i > 1) sb.append(\",  \");\n-        String columnValue = res.getObject(i).toString();\n-        sb.append(columnValue);\n+        sb.append(String.valueOf(res.getObject(i)));\n       }\n       sb.append(\"\\n\");\n     }",
                "raw_url": "https://github.com/apache/tajo/raw/eef7878bd3d82dc0468e3e977e43a46d3903781a/tajo-client/src/main/java/org/apache/tajo/client/ResultSetUtil.java",
                "sha": "b2e00beb984823b3cf70e403e0fc6b9daecb9714",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/eef7878bd3d82dc0468e3e977e43a46d3903781a/tajo-core/src/main/java/org/apache/tajo/webapp/QueryExecutorServlet.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/src/main/java/org/apache/tajo/webapp/QueryExecutorServlet.java?ref=eef7878bd3d82dc0468e3e977e43a46d3903781a",
                "deletions": 1,
                "filename": "tajo-core/src/main/java/org/apache/tajo/webapp/QueryExecutorServlet.java",
                "patch": "@@ -514,7 +514,7 @@ private void MakeResultText(ResultSet res, TableDesc desc) throws SQLException {\n         }\n         List<Object> row = new ArrayList<Object>();\n         for(int i = 0; i < numOfColumns; i++) {\n-          row.add(res.getObject(i + 1).toString());\n+          row.add(String.valueOf(res.getObject(i + 1)));\n         }\n         queryResult.add(row);\n         rowCount++;",
                "raw_url": "https://github.com/apache/tajo/raw/eef7878bd3d82dc0468e3e977e43a46d3903781a/tajo-core/src/main/java/org/apache/tajo/webapp/QueryExecutorServlet.java",
                "sha": "a04ff6c6b63d9812bacb3777ea29e697e4e1867f",
                "status": "modified"
            }
        ],
        "message": "TAJO-1873: Fix NPE in QueryExecutorServlet.\n\nCloses #774",
        "parent": "https://github.com/apache/tajo/commit/08def97c45140d8ffcf50eeef989e2b5760a2195",
        "patched_files": [
            "CHANGES",
            "ResultSetUtil.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestResultSetUtil.java"
        ]
    },
    "tajo_f0eabf0": {
        "bug_id": "tajo_f0eabf0",
        "commit": "https://github.com/apache/tajo/commit/f0eabf02aa555b9999d1215aaf4940fa8ea507a2",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/f0eabf02aa555b9999d1215aaf4940fa8ea507a2/tajo-core/tajo-core-backend/src/main/java/tajo/master/Repartitioner.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/master/Repartitioner.java?ref=f0eabf02aa555b9999d1215aaf4940fa8ea507a2",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/master/Repartitioner.java",
                "patch": "@@ -410,7 +410,9 @@ public static String createBasicFetchUri(String hostName, int port,\n \n     List<IntermediateEntry> partitions = new ArrayList<>();\n     for (QueryUnit tasks : childSubQuery.getQueryUnits()) {\n-      partitions.addAll(tasks.getIntermediateData());\n+      if (tasks.getIntermediateData() != null) {\n+        partitions.addAll(tasks.getIntermediateData());\n+      }\n     }\n \n     Fragment frag = new Fragment(scan.getTableId(), tablePath,",
                "raw_url": "https://github.com/apache/tajo/raw/f0eabf02aa555b9999d1215aaf4940fa8ea507a2/tajo-core/tajo-core-backend/src/main/java/tajo/master/Repartitioner.java",
                "sha": "13d1b7ccb56811f0a4d11f4a4b5c7dc82d13bc62",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/f0eabf02aa555b9999d1215aaf4940fa8ea507a2/tajo-core/tajo-core-backend/src/main/java/tajo/master/TaskRunnerLauncherImpl.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/master/TaskRunnerLauncherImpl.java?ref=f0eabf02aa555b9999d1215aaf4940fa8ea507a2",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/master/TaskRunnerLauncherImpl.java",
                "patch": "@@ -271,7 +271,7 @@ public ContainerLaunchContext createContainerLaunchContext(TaskRunnerLaunchEvent\n     Vector<CharSequence> vargs = new Vector<>(30);\n \n     // Set java executable command\n-    LOG.info(\"Setting up app master command\");\n+    //LOG.info(\"Setting up app master command\");\n     vargs.add(\"${JAVA_HOME}\" + \"/bin/java\");\n     // Set Xmx based on am memory size\n     vargs.add(\"-Xmx2000m\");",
                "raw_url": "https://github.com/apache/tajo/raw/f0eabf02aa555b9999d1215aaf4940fa8ea507a2/tajo-core/tajo-core-backend/src/main/java/tajo/master/TaskRunnerLauncherImpl.java",
                "sha": "704832ac9f3601b51851e5b5375f1853eb79b1a5",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/f0eabf02aa555b9999d1215aaf4940fa8ea507a2/tajo-core/tajo-core-backend/src/main/java/tajo/master/TaskSchedulerImpl.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/master/TaskSchedulerImpl.java?ref=f0eabf02aa555b9999d1215aaf4940fa8ea507a2",
                "deletions": 3,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/master/TaskSchedulerImpl.java",
                "patch": "@@ -313,7 +313,7 @@ public void assignToLeafTasks(List<TaskRequestEvent> taskRequests) {\n           if (leafTasks.contains(tId)) {\n             leafTasks.remove(tId);\n             attemptId = tId;\n-            LOG.info(attemptId + \" Assigned based on host match \" + hostName);\n+            //LOG.info(attemptId + \" Assigned based on host match \" + hostName);\n             hostLocalAssigned++;\n             break;\n           }\n@@ -330,7 +330,7 @@ public void assignToLeafTasks(List<TaskRequestEvent> taskRequests) {\n             if (leafTasks.contains(tId)) {\n               leafTasks.remove(tId);\n               attemptId = tId;\n-              LOG.info(attemptId + \"Assigned based on rack match \" + rack);\n+              //LOG.info(attemptId + \"Assigned based on rack match \" + rack);\n               rackLocalAssigned++;\n               break;\n             }\n@@ -340,7 +340,7 @@ public void assignToLeafTasks(List<TaskRequestEvent> taskRequests) {\n           if (attemptId == null && leafTaskNum() > 0) {\n             attemptId = leafTasks.iterator().next();\n             leafTasks.remove(attemptId);\n-            LOG.info(attemptId + \" Assigned based on * match\");\n+            //LOG.info(attemptId + \" Assigned based on * match\");\n           }\n         }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/f0eabf02aa555b9999d1215aaf4940fa8ea507a2/tajo-core/tajo-core-backend/src/main/java/tajo/master/TaskSchedulerImpl.java",
                "sha": "4ed4e084ea276ac67d3d17ef655af36c4f889961",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tajo/blob/f0eabf02aa555b9999d1215aaf4940fa8ea507a2/tajo-core/tajo-core-backend/src/main/java/tajo/master/rm/RMContainerAllocator.java",
                "changes": 18,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/master/rm/RMContainerAllocator.java?ref=f0eabf02aa555b9999d1215aaf4940fa8ea507a2",
                "deletions": 8,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/master/rm/RMContainerAllocator.java",
                "patch": "@@ -171,15 +171,17 @@ protected AMResponse makeRemoteRequest() throws YarnException, YarnRemoteExcepti\n     //LOG.info(\"Response Id: \" + response.getResponseId());\n     LOG.info(\"Available Resource: \" + response.getAvailableResources());\n     LOG.info(\"Num of Allocated Containers: \" + response.getAllocatedContainers().size());\n-    LOG.info(\"================================================================\");\n-    for (Container container : response.getAllocatedContainers()) {\n-      LOG.info(\"> Container Id: \" + container.getId());\n-      LOG.info(\"> Node Id: \" + container.getNodeId());\n-      LOG.info(\"> Resource (Mem): \" + container.getResource().getMemory());\n-      LOG.info(\"> State : \" + container.getState());\n-      LOG.info(\"> Priority: \" + container.getPriority());\n+    if (response.getAllocatedContainers().size() > 0) {\n+      LOG.info(\"================================================================\");\n+      for (Container container : response.getAllocatedContainers()) {\n+        LOG.info(\"> Container Id: \" + container.getId());\n+        LOG.info(\"> Node Id: \" + container.getNodeId());\n+        LOG.info(\"> Resource (Mem): \" + container.getResource().getMemory());\n+        LOG.info(\"> State : \" + container.getState());\n+        LOG.info(\"> Priority: \" + container.getPriority());\n+      }\n+      LOG.info(\"================================================================\");\n     }\n-    LOG.info(\"================================================================\");\n     /*\n     LOG.info(\"Reboot: \" + response.getReboot());\n     LOG.info(\"Num of Updated Node: \" + response.getUpdatedNodes());",
                "raw_url": "https://github.com/apache/tajo/raw/f0eabf02aa555b9999d1215aaf4940fa8ea507a2/tajo-core/tajo-core-backend/src/main/java/tajo/master/rm/RMContainerAllocator.java",
                "sha": "16ebc4bc48dc833a40238f07f07568c6e05d2ac9",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/tajo/blob/f0eabf02aa555b9999d1215aaf4940fa8ea507a2/tajo-core/tajo-core-backend/src/main/java/tajo/worker/Task2.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/worker/Task2.java?ref=f0eabf02aa555b9999d1215aaf4940fa8ea507a2",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/worker/Task2.java",
                "patch": "@@ -362,7 +362,6 @@ public void run() {\n         this.executor.init();\n         while(executor.next() != null && !killed) {\n           ++progress;\n-          System.out.println(\"ROW PROCEED: \" + progress);\n         }\n         this.executor.close();\n       }",
                "raw_url": "https://github.com/apache/tajo/raw/f0eabf02aa555b9999d1215aaf4940fa8ea507a2/tajo-core/tajo-core-backend/src/main/java/tajo/worker/Task2.java",
                "sha": "1cf67dad8f2f77d652087753b81946986c9eb0ed",
                "status": "modified"
            },
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/tajo/blob/f0eabf02aa555b9999d1215aaf4940fa8ea507a2/tajo-core/tajo-core-backend/src/main/java/tajo/worker/TaskRunner.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/tajo/worker/TaskRunner.java?ref=f0eabf02aa555b9999d1215aaf4940fa8ea507a2",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/main/java/tajo/worker/TaskRunner.java",
                "patch": "@@ -38,12 +38,14 @@\n import tajo.SubQueryId;\n import tajo.TajoProtos.TaskAttemptState;\n import tajo.conf.TajoConf.ConfVars;\n+import tajo.engine.MasterWorkerProtos;\n import tajo.engine.MasterWorkerProtos.QueryUnitRequestProto;\n import tajo.engine.query.QueryUnitRequestImpl;\n import tajo.ipc.MasterWorkerProtocol;\n import tajo.ipc.MasterWorkerProtocol.MasterWorkerProtocolService;\n import tajo.ipc.MasterWorkerProtocol.MasterWorkerProtocolService.Interface;\n import tajo.rpc.CallFuture2;\n+import tajo.rpc.NullCallback;\n import tajo.rpc.ProtoAsyncRpcClient;\n import tajo.util.TajoIdUtils;\n \n@@ -257,13 +259,22 @@ public void run() {\n                     LOG.info(\"Accumulated Received Task: \" + (++receivedNum));\n                     QueryUnitAttemptId taskAttemptId =\n                         new QueryUnitAttemptId(taskRequest.getId());\n+                    if (tasks.containsKey(taskAttemptId)) {\n+                      MasterWorkerProtos.TaskFatalErrorReport.Builder builder =\n+                      MasterWorkerProtos.TaskFatalErrorReport.newBuilder()\n+                          .setErrorMessage(\"Duplicate Task Attempt: \" +\n+                          taskAttemptId);\n+                      master.fatalError(null, builder.build(), NullCallback.get());\n+                      continue;\n+                    }\n                     Path taskTempDir = localFS.makeQualified(\n                         lDirAllocator.getLocalPathForWrite(baseDir +\n                             \"/\" + taskAttemptId.getQueryUnitId().getId()\n                             + \"_\" + taskAttemptId.getId(), conf));\n \n                     Task2 task = new Task2(taskAttemptId, workerContext, master,\n                         new QueryUnitRequestImpl(taskRequest), taskTempDir);\n+                    tasks.put(taskAttemptId, task);\n                     task.init();\n                     if (task.hasFetchPhase()) {\n                       task.fetch(); // The fetch is performed in an asynchronous way.",
                "raw_url": "https://github.com/apache/tajo/raw/f0eabf02aa555b9999d1215aaf4940fa8ea507a2/tajo-core/tajo-core-backend/src/main/java/tajo/worker/TaskRunner.java",
                "sha": "aea241c87bac02ec76129470db840bdf07632c2f",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/f0eabf02aa555b9999d1215aaf4940fa8ea507a2/tajo-core/tajo-core-storage/src/main/java/tajo/storage/StorageManager.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-storage/src/main/java/tajo/storage/StorageManager.java?ref=f0eabf02aa555b9999d1215aaf4940fa8ea507a2",
                "deletions": 4,
                "filename": "tajo-core/tajo-core-storage/src/main/java/tajo/storage/StorageManager.java",
                "patch": "@@ -77,11 +77,10 @@ public Path initTableBase(TableMeta meta, String tableName)\n \tpublic Path initLocalTableBase(Path tablePath, TableMeta meta) throws IOException {\n \t  FileSystem fs = FileSystem.getLocal(conf);\n     if (fs.exists(tablePath)) {\n-      //throw new AlreadyExistsStorageException(tablePath);\n-      fs.delete(tablePath, true);\n+      throw new AlreadyExistsStorageException(tablePath);\n+    } else {\n+      fs.mkdirs(tablePath);\n     }\n-\n-    fs.mkdirs(tablePath);\n     Path dataDir = new Path(tablePath,\"data\");\n \n     if (meta != null) {",
                "raw_url": "https://github.com/apache/tajo/raw/f0eabf02aa555b9999d1215aaf4940fa8ea507a2/tajo-core/tajo-core-storage/src/main/java/tajo/storage/StorageManager.java",
                "sha": "c54f631bc603103dec9c89d0e5c6bf8adfe3e352",
                "status": "modified"
            }
        ],
        "message": "Merge pull request #90 from hyunsik/Q6_WORKAROUND\n\nFixed NPE bugs of Repartitioner",
        "parent": "https://github.com/apache/tajo/commit/5b33b87c38a536949920c1955a9bb26e16c1e9c8",
        "patched_files": [
            "StorageManager.java",
            "TaskRunner.java",
            "Repartitioner.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestStorageManager.java",
            "TestRepartitioner.java",
            "TaskRunnerTest.java"
        ]
    },
    "tajo_f62d34b": {
        "bug_id": "tajo_f62d34b",
        "commit": "https://github.com/apache/tajo/commit/f62d34beab7fba2da6a54ad88eb37fed093c37b5",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/tajo/blob/f62d34beab7fba2da6a54ad88eb37fed093c37b5/CHANGES",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES?ref=f62d34beab7fba2da6a54ad88eb37fed093c37b5",
                "deletions": 0,
                "filename": "CHANGES",
                "patch": "@@ -78,6 +78,8 @@ Release 0.12.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-2038: NPE in FileScanner#getProgress. (jinho)\n+\n     TAJO-2034: Files required for executing python functions are not copied in \n     testEval(). (jihoon)\n ",
                "raw_url": "https://github.com/apache/tajo/raw/f62d34beab7fba2da6a54ad88eb37fed093c37b5/CHANGES",
                "sha": "b1a85a8123f1b2a99b39b194173ee0fa89cc6095",
                "status": "modified"
            },
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/tajo/blob/f62d34beab7fba2da6a54ad88eb37fed093c37b5/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/avro/AvroScanner.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/avro/AvroScanner.java?ref=f62d34beab7fba2da6a54ad88eb37fed093c37b5",
                "deletions": 0,
                "filename": "tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/avro/AvroScanner.java",
                "patch": "@@ -292,4 +292,15 @@ public void setFilter(EvalNode filter) {\n   public boolean isSplittable() {\n     return false;\n   }\n+\n+  @Override\n+  public float getProgress() {\n+    if (!inited) return super.getProgress();\n+\n+    if (!dataFileReader.hasNext()) {\n+      return 1.0f;\n+    } else {\n+      return 0.0f;\n+    }\n+  }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/f62d34beab7fba2da6a54ad88eb37fed093c37b5/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/avro/AvroScanner.java",
                "sha": "ad488505659b96af6b9d111e62306f7cccf8a03f",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/f62d34beab7fba2da6a54ad88eb37fed093c37b5/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/orc/ORCScanner.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/orc/ORCScanner.java?ref=f62d34beab7fba2da6a54ad88eb37fed093c37b5",
                "deletions": 2,
                "filename": "tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/orc/ORCScanner.java",
                "patch": "@@ -113,8 +113,6 @@ public void init() throws IOException {\n       targets = schema.toArray();\n     }\n \n-    super.init();\n-\n     outTuple = new VTuple(targets.length);\n \n     Path path = fragment.getPath();\n@@ -163,6 +161,7 @@ public void init() throws IOException {\n     recordReader = orcReader.createRecordReader(columnSet, OrcPredicate.TRUE,\n         fragment.getStartKey(), fragment.getLength(), DateTimeZone.forTimeZone(timezone));\n \n+    super.init();\n     LOG.debug(\"file fragment { path: \" + fragment.getPath() +\n       \", start offset: \" + fragment.getStartKey() +\n       \", length: \" + fragment.getLength() + \"}\");\n@@ -307,6 +306,8 @@ private void getNextBatch() throws IOException {\n \n   @Override\n   public float getProgress() {\n+    if(!inited) return super.getProgress();\n+\n     return recordReader.getProgress();\n   }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/f62d34beab7fba2da6a54ad88eb37fed093c37b5/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/orc/ORCScanner.java",
                "sha": "9351c59926b8299a9fae3edc76e65172f2134abc",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/tajo/blob/f62d34beab7fba2da6a54ad88eb37fed093c37b5/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/parquet/ParquetScanner.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/parquet/ParquetScanner.java?ref=f62d34beab7fba2da6a54ad88eb37fed093c37b5",
                "deletions": 0,
                "filename": "tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/parquet/ParquetScanner.java",
                "patch": "@@ -124,4 +124,14 @@ public void setFilter(EvalNode filter) {\n   public boolean isSplittable() {\n     return false;\n   }\n+\n+  @Override\n+  public float getProgress() {\n+\n+    if (!inited) {\n+      return super.getProgress();\n+    } else {\n+      return reader.getProgress();\n+    }\n+  }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/f62d34beab7fba2da6a54ad88eb37fed093c37b5/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/parquet/ParquetScanner.java",
                "sha": "d7f753caa8b9fc1aeb5cb71e5056cfb8f7f57b5d",
                "status": "modified"
            },
            {
                "additions": 25,
                "blob_url": "https://github.com/apache/tajo/blob/f62d34beab7fba2da6a54ad88eb37fed093c37b5/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/sequencefile/SequenceFileScanner.java",
                "changes": 25,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/sequencefile/SequenceFileScanner.java?ref=f62d34beab7fba2da6a54ad88eb37fed093c37b5",
                "deletions": 0,
                "filename": "tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/sequencefile/SequenceFileScanner.java",
                "patch": "@@ -361,4 +361,29 @@ public void setFilter(EvalNode filter) {\n   public boolean isSplittable(){\n     return true;\n   }\n+\n+  @Override\n+  public float getProgress() {\n+    if (!inited) return super.getProgress();\n+\n+    if (!more) {\n+      return 1.0f;\n+    } else {\n+      long filePos;\n+      float progress;\n+      try {\n+        filePos = reader.getPosition();\n+        if (start == filePos) {\n+          progress = 0.0f;\n+        } else {\n+          long readBytes = filePos - start;\n+          long remainingBytes = Math.max(end - filePos, 0);\n+          progress = Math.min(1.0f, (float) (readBytes) / (float) (readBytes + remainingBytes));\n+        }\n+      } catch (IOException e) {\n+        progress = 0.0f;\n+      }\n+      return progress;\n+    }\n+  }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/f62d34beab7fba2da6a54ad88eb37fed093c37b5/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/sequencefile/SequenceFileScanner.java",
                "sha": "9ad5ab3174d008493fe71d0cc61414a7a6011adf",
                "status": "modified"
            },
            {
                "additions": 41,
                "blob_url": "https://github.com/apache/tajo/blob/f62d34beab7fba2da6a54ad88eb37fed093c37b5/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/text/DelimitedTextFile.java",
                "changes": 76,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/text/DelimitedTextFile.java?ref=f62d34beab7fba2da6a54ad88eb37fed093c37b5",
                "deletions": 35,
                "filename": "tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/text/DelimitedTextFile.java",
                "patch": "@@ -300,50 +300,19 @@ public DelimitedTextFileScanner(Configuration conf, final Schema schema, final T\n \n     @Override\n     public void init() throws IOException {\n-      if (reader != null) {\n-        reader.close();\n-      }\n-\n-      if(deserializer != null) {\n-        deserializer.release();\n-      }\n \n-      reader = new DelimitedLineReader(conf, fragment, conf.getInt(READ_BUFFER_SIZE, 128 * StorageUnit.KB));\n       reader.init();\n-      recordCount = 0;\n \n       if (targets == null) {\n         targets = schema.toArray();\n       }\n \n-      outTuple = new VTuple(targets.length);\n+      reset();\n \n       super.init();\n       if (LOG.isDebugEnabled()) {\n         LOG.debug(\"DelimitedTextFileScanner open:\" + fragment.getPath() + \",\" + startOffset + \",\" + endOffset);\n       }\n-\n-      // skip first line if it reads from middle of file\n-      if (startOffset > 0) {\n-        reader.readLine();\n-      } else { // skip header lines if it is defined\n-\n-        // initialization for skipping header(max 20)\n-        int headerLineNum = Math.min(Integer.parseInt(meta.getProperty(StorageConstants.TEXT_SKIP_HEADER_LINE, \"0\")), 20);\n-        if (headerLineNum > 0) {\n-          LOG.info(String.format(\"Skip %d header lines\", headerLineNum));\n-          for (int i = 0; i < headerLineNum; i++) {\n-            if (!reader.isReadable()) {\n-              return;\n-            }\n-\n-            reader.readLine();\n-          }\n-        }\n-      }\n-\n-      deserializer = getLineSerde().createDeserializer(schema, meta, targets);\n-      deserializer.init();\n     }\n \n     public TextLineSerDe getLineSerde() {\n@@ -436,7 +405,44 @@ public Tuple next() throws IOException {\n \n     @Override\n     public void reset() throws IOException {\n-      init();\n+      recordCount = 0;\n+\n+      if (reader.getReadBytes() > 0) {\n+        reader.close();\n+\n+        reader = new DelimitedLineReader(conf, fragment, conf.getInt(READ_BUFFER_SIZE, 128 * StorageUnit.KB));\n+        reader.init();\n+      }\n+\n+      if(deserializer != null) {\n+        deserializer.release();\n+      }\n+\n+      deserializer = getLineSerde().createDeserializer(schema, meta, targets);\n+      deserializer.init();\n+\n+      outTuple = new VTuple(targets.length);\n+\n+      // skip first line if it reads from middle of file\n+      if (startOffset > 0) {\n+        reader.readLine();\n+      } else { // skip header lines if it is defined\n+\n+        // initialization for skipping header(max 20)\n+        int headerLineNum = Math.min(Integer.parseInt(\n+            meta.getProperty(StorageConstants.TEXT_SKIP_HEADER_LINE, \"0\")), 20);\n+\n+        if (headerLineNum > 0) {\n+          LOG.info(String.format(\"Skip %d header lines\", headerLineNum));\n+          for (int i = 0; i < headerLineNum; i++) {\n+            if (!reader.isReadable()) {\n+              return;\n+            }\n+\n+            reader.readLine();\n+          }\n+        }\n+      }\n     }\n \n     @Override\n@@ -446,16 +452,16 @@ public void close() throws IOException {\n           deserializer.release();\n         }\n \n-        if (tableStats != null && reader != null) {\n+        if (reader != null) {\n           tableStats.setReadBytes(reader.getReadBytes());  //Actual Processed Bytes. (decompressed bytes + overhead)\n           tableStats.setNumRows(recordCount);\n         }\n+\n         if (LOG.isDebugEnabled()) {\n           LOG.debug(\"DelimitedTextFileScanner processed record:\" + recordCount);\n         }\n       } finally {\n         IOUtils.cleanup(LOG, reader);\n-        reader = null;\n         outTuple = null;\n       }\n     }",
                "raw_url": "https://github.com/apache/tajo/raw/f62d34beab7fba2da6a54ad88eb37fed093c37b5/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/text/DelimitedTextFile.java",
                "sha": "12ab738414f84c0b5140a1cf066819ee5412c522",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/tajo/blob/f62d34beab7fba2da6a54ad88eb37fed093c37b5/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/thirdparty/parquet/InternalParquetRecordReader.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/thirdparty/parquet/InternalParquetRecordReader.java?ref=f62d34beab7fba2da6a54ad88eb37fed093c37b5",
                "deletions": 1,
                "filename": "tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/thirdparty/parquet/InternalParquetRecordReader.java",
                "patch": "@@ -134,7 +134,7 @@ public T getCurrentValue() throws IOException,\n     return currentValue;\n   }\n \n-  public float getProgress() throws IOException, InterruptedException {\n+  public float getProgress() {\n     return (float) current / total;\n   }\n ",
                "raw_url": "https://github.com/apache/tajo/raw/f62d34beab7fba2da6a54ad88eb37fed093c37b5/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/thirdparty/parquet/InternalParquetRecordReader.java",
                "sha": "5beba14ec5b1eddf8fb565e67a1e5c23a4e8d71a",
                "status": "modified"
            },
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/tajo/blob/f62d34beab7fba2da6a54ad88eb37fed093c37b5/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/thirdparty/parquet/ParquetReader.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/thirdparty/parquet/ParquetReader.java?ref=f62d34beab7fba2da6a54ad88eb37fed093c37b5",
                "deletions": 0,
                "filename": "tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/thirdparty/parquet/ParquetReader.java",
                "patch": "@@ -143,4 +143,12 @@ public void close() throws IOException {\n       reader.close();\n     }\n   }\n+\n+  public float getProgress() {\n+    if (!footersIterator.hasNext()) {\n+      return 1.0f;\n+    } else {\n+      return reader != null ? reader.getProgress() : 0.0f;\n+    }\n+  }\n }",
                "raw_url": "https://github.com/apache/tajo/raw/f62d34beab7fba2da6a54ad88eb37fed093c37b5/tajo-storage/tajo-storage-hdfs/src/main/java/org/apache/tajo/storage/thirdparty/parquet/ParquetReader.java",
                "sha": "c353a8196f32669147e75f0c5c7b678bcc2a4071",
                "status": "modified"
            },
            {
                "additions": 53,
                "blob_url": "https://github.com/apache/tajo/blob/f62d34beab7fba2da6a54ad88eb37fed093c37b5/tajo-storage/tajo-storage-hdfs/src/test/java/org/apache/tajo/storage/TestStorages.java",
                "changes": 53,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-storage/tajo-storage-hdfs/src/test/java/org/apache/tajo/storage/TestStorages.java?ref=f62d34beab7fba2da6a54ad88eb37fed093c37b5",
                "deletions": 0,
                "filename": "tajo-storage/tajo-storage-hdfs/src/test/java/org/apache/tajo/storage/TestStorages.java",
                "patch": "@@ -48,6 +48,7 @@\n import org.apache.tajo.util.CommonTestingUtil;\n import org.apache.tajo.util.JavaResourceUtil;\n import org.apache.tajo.util.KeyValueSet;\n+import org.junit.After;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n import org.junit.runners.Parameterized;\n@@ -154,6 +155,11 @@ public TestStorages(String type, boolean splitable, boolean statsable, boolean s\n     });\n   }\n \n+  @After\n+  public void tearDown() throws IOException {\n+   fs.delete(testDir, true);\n+  }\n+\n   @Test\n   public void testSplitable() throws IOException {\n     if (splitable) {\n@@ -1303,4 +1309,51 @@ public void testFileAlreadyExists() throws IOException {\n       IOUtils.cleanup(null, appender);\n     }\n   }\n+\n+  @Test\n+  public void testProgress() throws IOException {\n+\n+    Schema schema = new Schema();\n+    schema.addColumn(\"col1\", Type.FLOAT4);\n+    schema.addColumn(\"col2\", Type.FLOAT8);\n+    schema.addColumn(\"col3\", Type.INT2);\n+    schema.addColumn(\"col4\", Type.INT4);\n+    schema.addColumn(\"col5\", Type.INT8);\n+\n+    KeyValueSet options = new KeyValueSet();\n+    TableMeta meta = CatalogUtil.newTableMeta(dataFormat, options);\n+    if (dataFormat.equalsIgnoreCase(BuiltinStorages.AVRO)) {\n+      meta.putProperty(StorageConstants.AVRO_SCHEMA_LITERAL, TEST_MAX_VALUE_AVRO_SCHEMA);\n+    }\n+\n+    FileTablespace sm = TablespaceManager.getLocalFs();\n+    Path tablePath = new Path(testDir, \"testProgress.data\");\n+    Appender appender = sm.getAppender(meta, schema, tablePath);\n+    appender.init();\n+\n+    VTuple tuple = new VTuple(new Datum[]{\n+        DatumFactory.createFloat4(Float.MAX_VALUE),\n+        DatumFactory.createFloat8(Double.MAX_VALUE),\n+        DatumFactory.createInt2(Short.MAX_VALUE),\n+        DatumFactory.createInt4(Integer.MAX_VALUE),\n+        DatumFactory.createInt8(Long.MAX_VALUE)\n+    });\n+\n+    appender.addTuple(tuple);\n+    appender.flush();\n+    appender.close();\n+\n+    FileStatus status = fs.getFileStatus(tablePath);\n+    FileFragment fragment = new FileFragment(\"table\", tablePath, 0, status.getLen());\n+    Scanner scanner =  sm.getScanner(meta, schema, fragment, null);\n+\n+    assertEquals(0.0f, scanner.getProgress(), 0.0f);\n+\n+    scanner.init();\n+    assertNotNull(scanner.next());\n+    assertNull(null, scanner.next());\n+\n+    scanner.close();\n+    assertEquals(1.0f, scanner.getProgress(), 0.0f);\n+  }\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/f62d34beab7fba2da6a54ad88eb37fed093c37b5/tajo-storage/tajo-storage-hdfs/src/test/java/org/apache/tajo/storage/TestStorages.java",
                "sha": "a08dfb92f02a425251401fb771038622723dcd51",
                "status": "modified"
            }
        ],
        "message": "TAJO-2038: NPE in DelimitedTextFileScanner#getProgress.\n\nCloses #930",
        "parent": "https://github.com/apache/tajo/commit/64c31a226339d981c17fcd9778446e702db205f5",
        "patched_files": [
            "DelimitedTextFile.java",
            "SequenceFileScanner.java",
            "ParquetReader.java",
            "ParquetScanner.java",
            "AvroScanner.java",
            "InternalParquetRecordReader.java",
            "CHANGES",
            "ORCScanner.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestStorages.java",
            "TestDelimitedTextFile.java"
        ]
    },
    "tajo_fb37ff3": {
        "bug_id": "tajo_fb37ff3",
        "commit": "https://github.com/apache/tajo/commit/fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/tajo/blob/fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a/CHANGES.txt",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/CHANGES.txt?ref=fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a",
                "deletions": 0,
                "filename": "CHANGES.txt",
                "patch": "@@ -124,6 +124,9 @@ Release 0.2.0 - unreleased\n \n   BUG FIXES\n \n+    TAJO-151: Multiple union queries within a table subquery causes NPE.\n+    (hyunsik)\n+\n     TAJO-137: Unreleased resources and wrong allocation requests in\n     TajoWorkerResourceManager. (hyoungjunkim via hyunsik)\n ",
                "raw_url": "https://github.com/apache/tajo/raw/fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a/CHANGES.txt",
                "sha": "3f87a232bf3706a6ad0282060eb1667b7e36639c",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a/tajo-algebra/src/main/java/org/apache/tajo/algebra/ColumnReferenceExpr.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-algebra/src/main/java/org/apache/tajo/algebra/ColumnReferenceExpr.java?ref=fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a",
                "deletions": 0,
                "filename": "tajo-algebra/src/main/java/org/apache/tajo/algebra/ColumnReferenceExpr.java",
                "patch": "@@ -29,6 +29,12 @@ public ColumnReferenceExpr(String columnName) {\n     this.name = columnName;\n   }\n \n+  public ColumnReferenceExpr(String tableName, String columnName) {\n+    super(OpType.Column);\n+    this.tableName = tableName;\n+    this.name = columnName;\n+  }\n+\n   public void setTableName(String tableName) {\n     this.tableName = tableName;\n   }",
                "raw_url": "https://github.com/apache/tajo/raw/fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a/tajo-algebra/src/main/java/org/apache/tajo/algebra/ColumnReferenceExpr.java",
                "sha": "aa942752e5910c1e282d00bac295d89f1b471390",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a/tajo-core/tajo-core-backend/src/main/antlr4/org/apache/tajo/engine/parser/SQLParser.g4",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/antlr4/org/apache/tajo/engine/parser/SQLParser.g4?ref=fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a",
                "deletions": 1,
                "filename": "tajo-core/tajo-core-backend/src/main/antlr4/org/apache/tajo/engine/parser/SQLParser.g4",
                "patch": "@@ -282,7 +282,12 @@ query_specification\n \n select_list\n   : MULTIPLY\n-  | derived_column (COMMA derived_column)*\n+  | select_sublist (COMMA select_sublist)*\n+  ;\n+\n+select_sublist\n+  : derived_column\n+  | asterisked_qualifier=Identifier DOT MULTIPLY\n   ;\n \n set_qualifier",
                "raw_url": "https://github.com/apache/tajo/raw/fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a/tajo-core/tajo-core-backend/src/main/antlr4/org/apache/tajo/engine/parser/SQLParser.g4",
                "sha": "5955da74a0292b3c942f5dcfe604ee2ee2da82cc",
                "status": "modified"
            },
            {
                "additions": 45,
                "blob_url": "https://github.com/apache/tajo/blob/fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/parser/SQLAnalyzer.java",
                "changes": 55,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/parser/SQLAnalyzer.java?ref=fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a",
                "deletions": 10,
                "filename": "tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/parser/SQLAnalyzer.java",
                "patch": "@@ -184,29 +184,64 @@ public Expr visitQuery_specification(SQLParser.Query_specificationContext ctx) {\n       }\n     }\n \n-    Projection projection = new Projection();\n+    Projection projection = visitSelect_list(ctx.select_list());\n \n     if (ctx.set_qualifier() != null && ctx.set_qualifier().DISTINCT() != null) {\n       projection.setDistinct();\n     }\n \n-    if (ctx.select_list().MULTIPLY() != null) {\n+    if (current != null) {\n+      projection.setChild(current);\n+    }\n+\n+    current = projection;\n+\n+    return current;\n+  }\n+\n+  /**\n+   * <pre>\n+   *   select_list\n+   *   : MULTIPLY\n+   *   | select_sublist (COMMA select_sublist)*\n+   *   ;\n+   * </pre>\n+   * @param ctx\n+   * @return\n+   */\n+  @Override\n+  public Projection visitSelect_list(SQLParser.Select_listContext ctx) {\n+    Projection projection = new Projection();\n+    if (ctx.MULTIPLY() != null) {\n       projection.setAll();\n     } else {\n-      Target targets [] = new Target[ctx.select_list().derived_column().size()];\n+      Target [] targets = new Target[ctx.select_sublist().size()];\n       for (int i = 0; i < targets.length; i++) {\n-        targets[i] = visitDerived_column(ctx.select_list().derived_column(i));\n+        targets[i] = visitSelect_sublist(ctx.select_sublist(i));\n       }\n       projection.setTargets(targets);\n     }\n \n-    if (current != null) {\n-      projection.setChild(current);\n-    }\n-\n-    current = projection;\n+    return projection;\n+  }\n \n-    return current;\n+  /**\n+   * <pre>\n+   *   select_sublist\n+   *   : derived_column\n+   *   | asterisked_qualifier=Identifier DOT MULTIPLY\n+   *   ;\n+   * </pre>\n+   * @param ctx\n+   * @return\n+   */\n+  @Override\n+  public Target visitSelect_sublist(SQLParser.Select_sublistContext ctx) {\n+    if (ctx.asterisked_qualifier != null) {\n+      return new Target(new ColumnReferenceExpr(ctx.asterisked_qualifier.getText(), \"*\"));\n+    } else {\n+      return visitDerived_column(ctx.derived_column());\n+    }\n   }\n \n   @Override",
                "raw_url": "https://github.com/apache/tajo/raw/fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a/tajo-core/tajo-core-backend/src/main/java/org/apache/tajo/engine/parser/SQLAnalyzer.java",
                "sha": "82b1295972445e6311013dbcc5fd4f91b7584feb",
                "status": "modified"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/tajo/blob/fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/parser/TestSQLAnalyzer.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/parser/TestSQLAnalyzer.java?ref=fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/parser/TestSQLAnalyzer.java",
                "patch": "@@ -245,6 +245,12 @@ public void testCreateTable10() throws IOException {\n     parseQuery(sql);\n   }\n \n+  @Test\n+  public void testTableSubQuery1() throws IOException {\n+    String sql = FileUtil.readTextFile(new File(\"src/test/queries/table_subquery1.sql\"));\n+    parseQuery(sql);\n+  }\n+\n   static String[] exprs = {\n       \"1 + 2\", // 0\n       \"3 - 4\", // 1",
                "raw_url": "https://github.com/apache/tajo/raw/fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a/tajo-core/tajo-core-backend/src/test/java/org/apache/tajo/engine/parser/TestSQLAnalyzer.java",
                "sha": "5ba26f856e1e7cdc393166668c0c6b6edc73403e",
                "status": "modified"
            },
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/tajo/blob/fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a/tajo-core/tajo-core-backend/src/test/queries/table_subquery1.sql",
                "changes": 19,
                "contents_url": "https://api.github.com/repos/apache/tajo/contents/tajo-core/tajo-core-backend/src/test/queries/table_subquery1.sql?ref=fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a",
                "deletions": 0,
                "filename": "tajo-core/tajo-core-backend/src/test/queries/table_subquery1.sql",
                "patch": "@@ -0,0 +1,19 @@\n+SELECT unioninput.*\n+FROM (\n+  select\n+    table1.key,\n+    table1.value\n+  FROM\n+    table1\n+  WHERE\n+    table1.key < 100\n+\n+  UNION ALL\n+\n+  SELECT\n+    table2.*\n+  FROM\n+    table2\n+  WHERE\n+    table2.key > 100\n+) unioninput\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/tajo/raw/fb37ff33cfaac9d46d2aaa62a9ad64abfc01ee2a/tajo-core/tajo-core-backend/src/test/queries/table_subquery1.sql",
                "sha": "3181e43c57ad0d000f1ee3bb5c154c21a88f8bd1",
                "status": "added"
            }
        ],
        "message": "TAJO-141: Multiple union queries within a table subquery causes NPE. (hyunsik)",
        "parent": "https://github.com/apache/tajo/commit/3703a7c3617584f157d485f735e374f17d9f27fd",
        "patched_files": [
            "SQLAnalyzer.java",
            "CHANGES.txt",
            "table_subquery1.sql",
            "SQLParser.g4",
            "ColumnReferenceExpr.java"
        ],
        "repo": "tajo",
        "unit_tests": [
            "TestSQLAnalyzer.java"
        ]
    }
}