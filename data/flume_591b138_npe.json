[
    {
        "repo": "flume",
        "commit": "https://github.com/apache/flume/commit/591b138321280cea1e7d61efcaf625a67202cb3d",
        "bug_id": "flume_591b138",
        "message": "FLUME-2966. Fix NPE in JMS Source\n\nJMS Source does not check for null text in a TextMessage. This can lead to NullPointerException.\nThis commit fixes that problem by checking for nullity of textMessage.getText().\n\nReviewers: Denes Arvay, Attila Simon, Mike Percy, Bessenyei Bal\u00e1zs Don\u00e1t\n\n(Siddharth Ahuja via Bessenyei Bal\u00e1zs Don\u00e1t)",
        "parent": "https://github.com/apache/flume/commit/d9c9a7dd9a6889ecf6b9dc88fb8e02ccc1cd5167",
        "patched_files": [
            "DefaultJMSMessageConverter.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 4,
                "raw_url": "https://github.com/apache/flume/raw/591b138321280cea1e7d61efcaf625a67202cb3d/flume-ng-sources/flume-jms-source/src/main/java/org/apache/flume/source/jms/DefaultJMSMessageConverter.java",
                "contents_url": "https://api.github.com/repos/apache/flume/contents/flume-ng-sources/flume-jms-source/src/main/java/org/apache/flume/source/jms/DefaultJMSMessageConverter.java?ref=591b138321280cea1e7d61efcaf625a67202cb3d",
                "filename": "flume-ng-sources/flume-jms-source/src/main/java/org/apache/flume/source/jms/DefaultJMSMessageConverter.java",
                "deletions": 1,
                "sha": "003f591fd53ef122dbf1c0fac1c3fe911fdd4588",
                "blob_url": "https://github.com/apache/flume/blob/591b138321280cea1e7d61efcaf625a67202cb3d/flume-ng-sources/flume-jms-source/src/main/java/org/apache/flume/source/jms/DefaultJMSMessageConverter.java",
                "patch": "@@ -100,7 +100,10 @@ public JMSMessageConverter build(Context context) {\n       }\n     } else if (message instanceof TextMessage) {\n       TextMessage textMessage = (TextMessage)message;\n-      event.setBody(textMessage.getText().getBytes(charset));\n+      String text = textMessage.getText();\n+      if (text != null) {\n+        event.setBody(text.getBytes(charset));\n+      }\n     } else if (message instanceof ObjectMessage) {\n       ObjectMessage objectMessage = (ObjectMessage)message;\n       Object object = objectMessage.getObject();",
                "changes": 5
            },
            {
                "status": "modified",
                "additions": 21,
                "raw_url": "https://github.com/apache/flume/raw/591b138321280cea1e7d61efcaf625a67202cb3d/flume-ng-sources/flume-jms-source/src/test/java/org/apache/flume/source/jms/TestDefaultJMSMessageConverter.java",
                "contents_url": "https://api.github.com/repos/apache/flume/contents/flume-ng-sources/flume-jms-source/src/test/java/org/apache/flume/source/jms/TestDefaultJMSMessageConverter.java?ref=591b138321280cea1e7d61efcaf625a67202cb3d",
                "filename": "flume-ng-sources/flume-jms-source/src/test/java/org/apache/flume/source/jms/TestDefaultJMSMessageConverter.java",
                "deletions": 0,
                "sha": "f0e46ca3ac2f6eba5d2c711083bd959736acb0c1",
                "blob_url": "https://github.com/apache/flume/blob/591b138321280cea1e7d61efcaf625a67202cb3d/flume-ng-sources/flume-jms-source/src/test/java/org/apache/flume/source/jms/TestDefaultJMSMessageConverter.java",
                "patch": "@@ -66,6 +66,13 @@ void createTextMessage() throws Exception {\n     when(message.getText()).thenReturn(TEXT);\n     this.message = message;\n   }\n+\n+  void createNullTextMessage() throws Exception {\n+    TextMessage message = mock(TextMessage.class);\n+    when(message.getText()).thenReturn(null);\n+    this.message = message;\n+  }\n+\n   void createBytesMessage() throws Exception {\n     BytesMessage message = mock(BytesMessage.class);\n     when(message.getBodyLength()).thenReturn((long)BYTES.length);\n@@ -117,6 +124,20 @@ public void testTextMessage() throws Exception {\n     assertEquals(headers, event.getHeaders());\n     assertEquals(TEXT, new String(event.getBody(), Charsets.UTF_8));\n   }\n+\n+  @Test\n+  public void testNullTextMessage() throws Exception {\n+    createNullTextMessage();\n+    headers.put(\"key1\", \"value1\");\n+    headers.put(\"key2\", \"value2\");\n+    createHeaders();\n+    Event event = converter.convert(message).iterator().next();\n+    assertEquals(headers, event.getHeaders());\n+    // In case of a null text message, the event's body will be empty due to\n+    // SimpleEvent's body not updated with a valid text message.\n+    assertEquals(event.getBody().length, 0);\n+  }\n+\n   @Test\n   public void testBytesMessage() throws Exception {\n     createBytesMessage();",
                "changes": 21
            }
        ],
        "unit_tests": [
            "TestDefaultJMSMessageConverter.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "flume-ng-sources/flume-jms-source/src/test/java/org/apache/flume/source/jms/TestDefaultJMSMessageConverter.java",
        "buggy_files": [
            "flume-ng-sources/flume-jms-source/src/main/java/org/apache/flume/source/jms/DefaultJMSMessageConverter.java"
        ],
        "fixed": true
    }
]