[
    {
        "repo": "maven-scm",
        "commit": "https://github.com/apache/maven-scm/commit/f5b3e3200ff2774099b1b9407349ac8f04e29497",
        "bug_id": "maven-scm_f5b3e32",
        "message": "Fix SCM-641 for HG: NPE when workingDirectory is null\n\ngit-svn-id: https://svn.apache.org/repos/asf/maven/scm/trunk@1241140 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/maven-scm/commit/c1a7e71219147a5a0b977be95d14e8118f42fb7d",
        "patched_files": [
            "HgUtils.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 11,
                "raw_url": "https://github.com/apache/maven-scm/raw/f5b3e3200ff2774099b1b9407349ac8f04e29497/maven-scm-providers/maven-scm-provider-hg/src/main/java/org/apache/maven/scm/provider/hg/HgUtils.java",
                "contents_url": "https://api.github.com/repos/apache/maven-scm/contents/maven-scm-providers/maven-scm-provider-hg/src/main/java/org/apache/maven/scm/provider/hg/HgUtils.java?ref=f5b3e3200ff2774099b1b9407349ac8f04e29497",
                "filename": "maven-scm-providers/maven-scm-provider-hg/src/main/java/org/apache/maven/scm/provider/hg/HgUtils.java",
                "deletions": 8,
                "sha": "a745bb5416b7126bb28bd531db0c9e59c1fce12f",
                "blob_url": "https://github.com/apache/maven-scm/blob/f5b3e3200ff2774099b1b9407349ac8f04e29497/maven-scm-providers/maven-scm-provider-hg/src/main/java/org/apache/maven/scm/provider/hg/HgUtils.java",
                "patch": "@@ -146,16 +146,19 @@ static Commandline buildCmd( File workingDir, String[] cmdAndArgs )\n     {\n         Commandline cmd = new Commandline();\n         cmd.setExecutable( HgCommandConstants.EXEC );\n-        cmd.setWorkingDirectory( workingDir.getAbsolutePath() );\n         cmd.addArguments( cmdAndArgs );\n-\n-        if ( !workingDir.exists() )\n+        if ( workingDir != null )\n         {\n-            boolean success = workingDir.mkdirs();\n-            if ( !success )\n+            cmd.setWorkingDirectory( workingDir.getAbsolutePath() );\n+\n+            if ( !workingDir.exists() )\n             {\n-                String msg = \"Working directory did not exist\" + \" and it couldn't be created: \" + workingDir;\n-                throw new ScmException( msg );\n+                boolean success = workingDir.mkdirs();\n+                if ( !success )\n+                {\n+                    String msg = \"Working directory did not exist\" + \" and it couldn't be created: \" + workingDir;\n+                    throw new ScmException( msg );\n+                }\n             }\n         }\n         return cmd;\n@@ -195,7 +198,7 @@ public static ScmResult execute( File workingDir, String[] cmdAndArgs )\n         int i = 0;\n         for ( Iterator<File> iterator = filesList.iterator(); iterator.hasNext(); i++ )\n         {\n-            File scmFile = (File) iterator.next();\n+            File scmFile = iterator.next();\n             String file = scmFile.getPath().replace( '\\\\', File.separatorChar );\n             cmd[i + cmdAndArgs.length] = file;\n ",
                "changes": 19
            },
            {
                "status": "added",
                "additions": 17,
                "raw_url": "https://github.com/apache/maven-scm/raw/f5b3e3200ff2774099b1b9407349ac8f04e29497/maven-scm-providers/maven-scm-provider-hg/src/test/java/org/apache/maven/scm/provider/hg/HgUtilsTest.java",
                "contents_url": "https://api.github.com/repos/apache/maven-scm/contents/maven-scm-providers/maven-scm-provider-hg/src/test/java/org/apache/maven/scm/provider/hg/HgUtilsTest.java?ref=f5b3e3200ff2774099b1b9407349ac8f04e29497",
                "filename": "maven-scm-providers/maven-scm-provider-hg/src/test/java/org/apache/maven/scm/provider/hg/HgUtilsTest.java",
                "deletions": 0,
                "sha": "3aeb4391f947f99228bb04522ea1ba594150e21f",
                "blob_url": "https://github.com/apache/maven-scm/blob/f5b3e3200ff2774099b1b9407349ac8f04e29497/maven-scm-providers/maven-scm-provider-hg/src/test/java/org/apache/maven/scm/provider/hg/HgUtilsTest.java",
                "patch": "@@ -0,0 +1,17 @@\n+package org.apache.maven.scm.provider.hg;\r\n+\r\n+import static org.junit.Assert.*;\r\n+import org.codehaus.plexus.util.cli.Commandline;\r\n+import org.junit.Test;\r\n+\r\n+public class HgUtilsTest\r\n+{\r\n+\r\n+    @Test\r\n+    public void testNullWorkingDirectory()\r\n+        throws Exception\r\n+    {\r\n+        Commandline cmd = HgUtils.buildCmd( null, new String[] {} );\r\n+        assertEquals( null, cmd.getWorkingDirectory() );\r\n+    }\r\n+}\n\\ No newline at end of file",
                "changes": 17
            }
        ],
        "unit_tests": [
            "HgUtilsTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "maven-scm-providers/maven-scm-provider-hg/src/test/java/org/apache/maven/scm/provider/hg/HgUtilsTest.java",
        "buggy_files": [
            "maven-scm-providers/maven-scm-provider-hg/src/main/java/org/apache/maven/scm/provider/hg/HgUtils.java"
        ],
        "fixed": true
    }
]