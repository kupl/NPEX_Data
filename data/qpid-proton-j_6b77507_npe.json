[
    {
        "repo": "qpid-proton-j",
        "commit": "https://github.com/apache/qpid-proton-j/commit/6b7750775bf57d05f9a8f29d79e7fc3e38a8d0a1",
        "bug_id": "qpid-proton-j_6b77507",
        "message": "PROTON-1906: avoid potential NPE when duplicating composite buffer",
        "parent": "https://github.com/apache/qpid-proton-j/commit/145b849c614220b68ac91f5a52bdc6c46be281da",
        "patched_files": [
            "CompositeReadableBuffer.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/qpid-proton-j/raw/6b7750775bf57d05f9a8f29d79e7fc3e38a8d0a1/proton-j/src/main/java/org/apache/qpid/proton/codec/CompositeReadableBuffer.java",
                "contents_url": "https://api.github.com/repos/apache/qpid-proton-j/contents/proton-j/src/main/java/org/apache/qpid/proton/codec/CompositeReadableBuffer.java?ref=6b7750775bf57d05f9a8f29d79e7fc3e38a8d0a1",
                "filename": "proton-j/src/main/java/org/apache/qpid/proton/codec/CompositeReadableBuffer.java",
                "deletions": 1,
                "sha": "c614e393579faaccb9d09bbaa1f71d3a358e38b8",
                "blob_url": "https://github.com/apache/qpid-proton-j/blob/6b7750775bf57d05f9a8f29d79e7fc3e38a8d0a1/proton-j/src/main/java/org/apache/qpid/proton/codec/CompositeReadableBuffer.java",
                "patch": "@@ -66,7 +66,9 @@ public CompositeReadableBuffer() {\n     private CompositeReadableBuffer(byte[] array, int offset) {\n         this.currentArray = array;\n         this.currentOffset = offset;\n-        this.capacity = array.length;\n+        if(array != null) {\n+            this.capacity = array.length;\n+        }\n         this.limit = capacity;\n     }\n ",
                "changes": 4
            },
            {
                "status": "modified",
                "additions": 21,
                "raw_url": "https://github.com/apache/qpid-proton-j/raw/6b7750775bf57d05f9a8f29d79e7fc3e38a8d0a1/proton-j/src/test/java/org/apache/qpid/proton/codec/CompositeReadableBufferTest.java",
                "contents_url": "https://api.github.com/repos/apache/qpid-proton-j/contents/proton-j/src/test/java/org/apache/qpid/proton/codec/CompositeReadableBufferTest.java?ref=6b7750775bf57d05f9a8f29d79e7fc3e38a8d0a1",
                "filename": "proton-j/src/test/java/org/apache/qpid/proton/codec/CompositeReadableBufferTest.java",
                "deletions": 0,
                "sha": "86ee4abfc5eb3f372f65b43096bf38fe97fd951e",
                "blob_url": "https://github.com/apache/qpid-proton-j/blob/6b7750775bf57d05f9a8f29d79e7fc3e38a8d0a1/proton-j/src/test/java/org/apache/qpid/proton/codec/CompositeReadableBufferTest.java",
                "patch": "@@ -2785,6 +2785,27 @@ public void testClear() {\n \n     //----- Test various cases of Duplicate ----------------------------------//\n \n+    @Test\n+    public void testDuplicateOnEmptyBuffer() {\n+        CompositeReadableBuffer buffer = new CompositeReadableBuffer();\n+        CompositeReadableBuffer dup = buffer.duplicate();\n+\n+        assertNotSame(buffer, dup);\n+        assertEquals(0, dup.capacity());\n+        assertEquals(0, buffer.capacity());\n+        assertEquals(0, dup.position());\n+        assertEquals(0, buffer.position());\n+        assertEquals(0, dup.limit());\n+        assertEquals(0, buffer.limit());\n+        assertContentEquals(buffer, dup);\n+\n+        try {\n+            dup.reclaimRead();\n+        } catch (Throwable t) {\n+            fail(\"Compacting an empty duplicate should not fail\");\n+        }\n+    }\n+\n     @Test\n     public void testDuplicateWithSingleArrayContent() {\n         CompositeReadableBuffer buffer = new CompositeReadableBuffer();",
                "changes": 21
            }
        ],
        "unit_tests": [
            "CompositeReadableBufferTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "proton-j/src/test/java/org/apache/qpid/proton/codec/CompositeReadableBufferTest.java",
        "buggy_files": [
            "proton-j/src/main/java/org/apache/qpid/proton/codec/CompositeReadableBuffer.java"
        ],
        "fixed": true
    }
]