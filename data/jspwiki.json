{
    "jspwiki_1a08b5b": {
        "bug_id": "jspwiki_1a08b5b",
        "commit": "https://github.com/apache/jspwiki/commit/1a08b5b7ecf250414274434b8db821a31048d32a",
        "file": [
            {
                "additions": 32,
                "blob_url": "https://github.com/apache/jspwiki/blob/1a08b5b7ecf250414274434b8db821a31048d32a/src/com/ecyrd/jspwiki/render/WysiwygEditingRenderer.java",
                "changes": 65,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/src/com/ecyrd/jspwiki/render/WysiwygEditingRenderer.java?ref=1a08b5b7ecf250414274434b8db821a31048d32a",
                "deletions": 33,
                "filename": "src/com/ecyrd/jspwiki/render/WysiwygEditingRenderer.java",
                "patch": "@@ -73,49 +73,48 @@ private void processChildren(Element baseElement)\n                         \n                         XHtmlToWikiConfig wikiConfig = new XHtmlToWikiConfig( m_context );\n                         \n-                        if( classValue.equals( \"wikipage\" ) )\n+                        // Get the url for wiki page link - it's typically \"Wiki.jsp?page=MyPage\"\n+                        // or when using the ShortURLConstructor option, it's \"wiki/MyPage\" .\n+                        String wikiPageLinkUrl = wikiConfig.getWikiJspPage();\n+                        String editPageLinkUrl = wikiConfig.getEditJspPage();\n+                        \n+                        if( classValue.equals( \"wikipage\" )\n+                            || ( hrefAttr != null && hrefAttr.getValue().startsWith( wikiPageLinkUrl ) ) )\n                         {\n-                            // get the url for wiki page link - it's typically \"Wiki.jsp?page=MyPage\"\n-                            // or when using the ShortURLConstructor option, it's \"wiki/MyPage\" .\n-                            String wikiPageLinkUrl = wikiConfig.getWikiJspPage();\n-\n-                            if( hrefAttr != null && hrefAttr.getValue().startsWith( wikiPageLinkUrl ) ) // we might not need this check\n-                            {\n-                                String newHref = null;\n+                            String newHref = null;\n \n-                                // Remove the leading url string so that users will only see the\n-                                // wikipage's name when editing an existing wiki link.\n-                                // For example, change \"Wiki.jsp?page=MyPage\" to just \"MyPage\".\n-                                newHref = hrefAttr.getValue().substring( wikiPageLinkUrl.length() );\n+                            // Remove the leading url string so that users will only see the\n+                            // wikipage's name when editing an existing wiki link.\n+                            // For example, change \"Wiki.jsp?page=MyPage\" to just \"MyPage\".\n+                            newHref = hrefAttr.getValue().substring( wikiPageLinkUrl.length() );\n                                 \n-                                // Handle links with section anchors.\n-                                // For example, we need to translate the html string \"TargetPage#section-TargetPage-Heading2\"\n-                                // to this wiki string: \"TargetPage#Heading2\".\n-                                hrefAttr.setValue( newHref.replaceFirst( \".+#section-(.+)-(.+)\", \"$1#$2\" ) );\n-                            }\n-                        }\n-                        else if( classValue.equals( \"editpage\" ) )\n+                            // Handle links with section anchors.\n+                            // For example, we need to translate the html string \"TargetPage#section-TargetPage-Heading2\"\n+                            // to this wiki string: \"TargetPage#Heading2\".\n+                            hrefAttr.setValue( newHref.replaceFirst( \".+#section-(.+)-(.+)\", \"$1#$2\" ) );\n+                        }                        \n+                        else if ( classValue.equals( \"editpage\" ) \n+                            || ( hrefAttr != null && hrefAttr.getValue().startsWith( editPageLinkUrl ) ) )\n                         {\n-                            String editPageLinkUrl = wikiConfig.getEditJspPage();\n-\n-                            if( hrefAttr != null && hrefAttr.getValue().startsWith( editPageLinkUrl ) ) // we might not need this check\n+                            Attribute titleAttr = element.getAttribute( \"title\" );\n+                            if( titleAttr != null )\n                             {\n-                                Attribute titleAttr = element.getAttribute( \"title\" );\n+                                // remove the title since we don't want to eventually save the default undefined page title.\n                                 titleAttr.detach();\n-                                \n-                                String newHref = null;\n-                                newHref = hrefAttr.getValue().substring( editPageLinkUrl.length() );\n-                                hrefAttr.setValue( newHref.replaceFirst( \".+#section-(.+)-(.+)\", \"$1#$2\" ) );\n-                                                             \n-                                // only remove the href if it's the same as the link text.\n-                                if( hrefAttr.getValue().equals( element.getText() ) )\n-                                {\n-                                    hrefAttr.detach();\n-                                }\n                             }\n+\n+                            hrefAttr.setValue( hrefAttr.getValue().substring( editPageLinkUrl.length() ) );\n                         }\n                     }\n                 } // end of check for \"a\" element\n+                else if( elementName.equals( \"pre\" ) )\n+                {\n+                    // We need to trim the surrounding whitespace to accomodate a FCK bug: when the first line \n+                    // of a <pre> tag contains only whitespace, then all the linebreaks in the <pre>\n+                    // tag will be lost due to FCK's html tidying.\n+                    String text = element.getTextTrim();\n+                    element.setText( text );\n+                }\n \n                 processChildren( element );\n             }",
                "raw_url": "https://github.com/apache/jspwiki/raw/1a08b5b7ecf250414274434b8db821a31048d32a/src/com/ecyrd/jspwiki/render/WysiwygEditingRenderer.java",
                "sha": "176b8a127551bc4a24a220f0a3cbb838b3d60076",
                "status": "modified"
            }
        ],
        "message": "    1. Handle defined & undefined wiki pages that have a CSS class value other than\n       the default ones.\n    2. Prevent NPE when a link tag doesn't have a title attribute.\n    3. Prevent a FCKeditor bug involving whitespace in a PRE tag from occuring.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jspwiki/trunk@626233 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jspwiki/commit/87cd277eca3dd34f280569d6c907b264d89b9eda",
        "repo": "jspwiki",
        "unit_tests": [
            "WysiwygEditingRendererTest.java"
        ]
    },
    "jspwiki_1b5a0c3": {
        "bug_id": "jspwiki_1b5a0c3",
        "commit": "https://github.com/apache/jspwiki/commit/1b5a0c3c11dd7aea448f966e96aea6fc27ea63d1",
        "file": [
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/jspwiki/blob/1b5a0c3c11dd7aea448f966e96aea6fc27ea63d1/ChangeLog",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/ChangeLog?ref=1b5a0c3c11dd7aea448f966e96aea6fc27ea63d1",
                "deletions": 0,
                "filename": "ChangeLog",
                "patch": "@@ -1,3 +1,11 @@\n+2014-04-20  Juan Pablo Santos (juanpablo AT apache DOT org)\n+\n+       * 2.10.1-svn-15\n+       \n+       * Fixed JSPWIKI-822 - NPE thrown by PluginContext#getText()\n+       \n+       * JSPWIKI-814 - VersioningFileProvider does migrate original page properties (thanks to Brian Burch)\n+\n 2014-04-20  Juan Pablo Santos (juanpablo AT apache DOT org)\n \n        * 2.10.1-svn-14",
                "raw_url": "https://github.com/apache/jspwiki/raw/1b5a0c3c11dd7aea448f966e96aea6fc27ea63d1/ChangeLog",
                "sha": "75d694b5d7cf6acae9186a39fb987646d18cbb59",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/jspwiki/blob/1b5a0c3c11dd7aea448f966e96aea6fc27ea63d1/jspwiki-war/src/main/java/org/apache/wiki/Release.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-war/src/main/java/org/apache/wiki/Release.java?ref=1b5a0c3c11dd7aea448f966e96aea6fc27ea63d1",
                "deletions": 1,
                "filename": "jspwiki-war/src/main/java/org/apache/wiki/Release.java",
                "patch": "@@ -72,7 +72,7 @@ Licensed to the Apache Software Foundation (ASF) under one\n      *  <p>\n      *  If the build identifier is empty, it is not added.\n      */\n-    public static final String     BUILD         = \"14\";\n+    public static final String     BUILD         = \"15\";\n     \n     /**\n      *  This is the generic version string you should use when printing out the version.  It is of ",
                "raw_url": "https://github.com/apache/jspwiki/raw/1b5a0c3c11dd7aea448f966e96aea6fc27ea63d1/jspwiki-war/src/main/java/org/apache/wiki/Release.java",
                "sha": "c7618450c001d2f5522618b68ed6971c1fb5a83b",
                "status": "modified"
            }
        ],
        "message": " * 2.10.1-svn-15\n       \n * Fixed JSPWIKI-822 - NPE thrown by PluginContext#getText()\n       \n * JSPWIKI-814 - VersioningFileProvider does migrate original page properties (thanks to Brian Burch)\n\ngit-svn-id: https://svn.apache.org/repos/asf/jspwiki/trunk@1589240 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jspwiki/commit/539c6495cb2d40eb38b815deb82ed8868d85396b",
        "repo": "jspwiki",
        "unit_tests": [
            "ReleaseTest.java"
        ]
    },
    "jspwiki_1e33295": {
        "bug_id": "jspwiki_1e33295",
        "commit": "https://github.com/apache/jspwiki/commit/1e3329514207242e1fc77a86281ce43739b5f4b5",
        "file": [
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/jspwiki/blob/1e3329514207242e1fc77a86281ce43739b5f4b5/ChangeLog",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/ChangeLog?ref=1e3329514207242e1fc77a86281ce43739b5f4b5",
                "deletions": 0,
                "filename": "ChangeLog",
                "patch": "@@ -1,3 +1,13 @@\n+2007-12-10  Andrew Jaquith <andrew AT apache DOT org>\n+\n+        * 2.6.1-cvs-2\n+        \n+        * [JSPWIKI-116] Under certain circumstances, calls to\n+        UserManager.getUserDatabase() are made before the user database is\n+        actually initialized, resulting in NPEs. To resolve, we simply replaced\n+        internal references to m_userDatabase with getUserDatabase(),\n+        which lazily initializes the database if it has not already happened.\n+        \n 2007-12-25  Janne Jalkanen <jalkanen@ecyrd.com>\n \n         * 2.6.1-cvs-1",
                "raw_url": "https://github.com/apache/jspwiki/raw/1e3329514207242e1fc77a86281ce43739b5f4b5/ChangeLog",
                "sha": "de38a46079e4c02b2b17f70ed1e514672c0a3f40",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/jspwiki/blob/1e3329514207242e1fc77a86281ce43739b5f4b5/src/com/ecyrd/jspwiki/Release.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/src/com/ecyrd/jspwiki/Release.java?ref=1e3329514207242e1fc77a86281ce43739b5f4b5",
                "deletions": 1,
                "filename": "src/com/ecyrd/jspwiki/Release.java",
                "patch": "@@ -66,7 +66,7 @@\n     public static final int        REVISION      = 6;\n \n     /** The minor revision.  */\n-    public static final int        MINORREVISION = 1;\n+    public static final int        MINORREVISION = 2;\n \n     /** The build number/identifier.  This is a String as opposed to an integer, just\n      *  so that people can add other identifiers to it.  The build number is incremented",
                "raw_url": "https://github.com/apache/jspwiki/raw/1e3329514207242e1fc77a86281ce43739b5f4b5/src/com/ecyrd/jspwiki/Release.java",
                "sha": "bec6f7219baaa30c4f515497d6135c6ab71da9cf",
                "status": "modified"
            },
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/jspwiki/blob/1e3329514207242e1fc77a86281ce43739b5f4b5/src/com/ecyrd/jspwiki/auth/UserManager.java",
                "changes": 22,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/src/com/ecyrd/jspwiki/auth/UserManager.java?ref=1e3329514207242e1fc77a86281ce43739b5f4b5",
                "deletions": 11,
                "filename": "src/com/ecyrd/jspwiki/auth/UserManager.java",
                "patch": "@@ -215,7 +215,7 @@ public final UserProfile getUserProfile( WikiSession session )\n             user = session.getUserPrincipal();\n             try\n             {\n-                profile = m_database.find( user.getName() );\n+                profile = getUserDatabase().find( user.getName() );\n                 newProfile = false;\n             }\n             catch( NoSuchPrincipalException e )\n@@ -225,7 +225,7 @@ public final UserProfile getUserProfile( WikiSession session )\n \n         if ( newProfile )\n         {\n-            profile = m_database.newProfile();\n+            profile = getUserDatabase().newProfile();\n             if ( user != null )\n             {\n                 profile.setLoginName( user.getName() );\n@@ -299,7 +299,7 @@ public final void setUserProfile( WikiSession session, UserProfile profile ) thr\n         UserProfile otherProfile;\n         try\n         {\n-            otherProfile = m_database.findByLoginName( profile.getLoginName() );\n+            otherProfile = getUserDatabase().findByLoginName( profile.getLoginName() );\n             if ( otherProfile != null && !otherProfile.equals( oldProfile ) )\n             {\n                 throw new DuplicateUserException( \"The login name '\" + profile.getLoginName() + \"' is already taken.\" );\n@@ -310,7 +310,7 @@ public final void setUserProfile( WikiSession session, UserProfile profile ) thr\n         }\n         try\n         {\n-            otherProfile = m_database.findByFullName( profile.getFullname() );\n+            otherProfile = getUserDatabase().findByFullName( profile.getFullname() );\n             if ( otherProfile != null && !otherProfile.equals( oldProfile ) )\n             {\n                 throw new DuplicateUserException( \"The full name '\" + profile.getFullname() + \"' is already taken.\" );\n@@ -382,11 +382,11 @@ public final void setUserProfile( WikiSession session, UserProfile profile ) thr\n             // If login name changed, rename it first\n             if ( nameChanged && oldProfile != null && !oldProfile.getLoginName().equals( profile.getLoginName() ) )\n             {\n-                m_database.rename( oldProfile.getLoginName(), profile.getLoginName() );\n+                getUserDatabase().rename( oldProfile.getLoginName(), profile.getLoginName() );\n             }\n \n             // Now, save the profile (userdatabase will take care of timestamps for us)\n-            m_database.save( profile );\n+            getUserDatabase().save( profile );\n \n             if ( nameChanged )\n             {\n@@ -501,7 +501,7 @@ public final void validateProfile( WikiContext context, UserProfile profile )\n         // unless we're allowed to add profiles to the container\n         if ( m_engine.getAuthenticationManager().isContainerAuthenticated()\n              && !context.getWikiSession().isAuthenticated()\n-             && !m_database.isSharedWithContainer() )\n+             && !getUserDatabase().isSharedWithContainer() )\n         {\n             session.addMessage( SESSION_MESSAGES, rb.getString(\"security.error.createprofilebeforelogin\") );\n         }\n@@ -539,7 +539,7 @@ public final void validateProfile( WikiContext context, UserProfile profile )\n         // It's illegal to use as a full name someone else's login name\n         try\n         {\n-            otherProfile = m_database.find( fullName );\n+            otherProfile = getUserDatabase().find( fullName );\n             if ( otherProfile != null && !profile.equals( otherProfile ) && !fullName.equals( otherProfile.getFullname() ) )\n             {\n                 Object[] args = { fullName };\n@@ -553,7 +553,7 @@ public final void validateProfile( WikiContext context, UserProfile profile )\n         // It's illegal to use as a login name someone else's full name\n         try\n         {\n-            otherProfile = m_database.find( loginName );\n+            otherProfile = getUserDatabase().find( loginName );\n             if ( otherProfile != null && !profile.equals( otherProfile ) && !loginName.equals( otherProfile.getLoginName() ) )\n             {\n                 Object[] args = { loginName };\n@@ -568,7 +568,7 @@ public final void validateProfile( WikiContext context, UserProfile profile )\n     public Principal[] listWikiNames()\n         throws WikiSecurityException\n     {\n-        return m_database.getWikiNames();\n+        return getUserDatabase().getWikiNames();\n     }\n \n     /**\n@@ -822,7 +822,7 @@ public UserProfile getUserInfo( String uid )\n             throws NoSuchPrincipalException\n         {\n             log.info(\"request \"+uid);\n-            UserProfile prof = m_database.find( uid );\n+            UserProfile prof = getUserDatabase().find( uid );\n \n             log.info(\"answer \"+prof);\n ",
                "raw_url": "https://github.com/apache/jspwiki/raw/1e3329514207242e1fc77a86281ce43739b5f4b5/src/com/ecyrd/jspwiki/auth/UserManager.java",
                "sha": "ebc43378d609ea3cb16bccd50af776620c1fce24",
                "status": "modified"
            }
        ],
        "message": "[JSPWIKI-116] Under certain circumstances, calls to UserManager.getUserDatabase() are made before the user database is actually initialized, resulting in NPEs. To resolve, we simply replaced internal references to m_userDatabase with getUserDatabase(), which lazily initializes the database if it has not already happened.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jspwiki/trunk@626951 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jspwiki/commit/3b4d89be7cbba860ddbdfa3a9f52a261096ed569",
        "repo": "jspwiki",
        "unit_tests": [
            "UserManagerTest.java"
        ]
    },
    "jspwiki_264a8ef": {
        "bug_id": "jspwiki_264a8ef",
        "commit": "https://github.com/apache/jspwiki/commit/264a8efa3475b5d06f689a1620d40fc70a958883",
        "file": [
            {
                "additions": 24,
                "blob_url": "https://github.com/apache/jspwiki/blob/264a8efa3475b5d06f689a1620d40fc70a958883/src/com/ecyrd/jspwiki/auth/user/JDBCUserDatabase.java",
                "changes": 34,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/src/com/ecyrd/jspwiki/auth/user/JDBCUserDatabase.java?ref=264a8efa3475b5d06f689a1620d40fc70a958883",
                "deletions": 10,
                "filename": "src/com/ecyrd/jspwiki/auth/user/JDBCUserDatabase.java",
                "patch": "@@ -77,6 +77,12 @@\n  *     <td><code>wiki_name</code></td>\n  *     <td>The column containing the user's wiki name</td>\n  *   </tr>\n+ *   <tr>\n+ *     <td><code>jspwiki.userdatabase.hashPrefix</code></td>\n+ *     <td><code>true</code></td>\n+ *     <td>Whether or not to prepend a prefix for the hash algorithm, <em>e.g.</em>,\n+ *         <code>{SHA}</code>.</td>\n+ *   </tr>\n  * </table>\n  * <p>This class hashes passwords using SHA-1. All of the underying SQL commands used by this class are implemented using\n  * prepared statements, so it is immune to SQL injection attacks.</p>\n@@ -97,7 +103,7 @@\n  * see <a href=\"http://tomcat.apache.org/tomcat-5.5-doc/jndi-resources-howto.html\">\n  * http://tomcat.apache.org/tomcat-5.5-doc/jndi-resources-howto.html</a>.\n  * @author Andrew R. Jaquith\n- * @version $Revision: 1.1 $ $Date: 2005-10-19 12:09:19 $\n+ * @version $Revision: 1.2 $ $Date: 2005-10-25 05:54:15 $\n  * @since 2.3\n  */public class JDBCUserDatabase extends AbstractUserDatabase\n {\n@@ -108,6 +114,8 @@\n \n     public static final String DEFAULT_DB_FULL_NAME  = \"full_name\";\n \n+    public static final String DEFAULT_DB_HASH_PREFIX = \"true\";\n+    \n     public static final String DEFAULT_DB_JNDI_NAME  = \"jdbc/UserDatabase\";\n \n     public static final String DEFAULT_DB_MODIFIED   = \"modified\";\n@@ -127,6 +135,8 @@\n     public static final String PROP_DB_FULL_NAME     = \"jspwiki.userdatabase.fullName\";\n \n     public static final String PROP_DB_DATASOURCE    = \"jspwiki.userdatabase.datasource\";\n+    \n+    public static final String PROP_DB_HASH_PREFIX   = \"jspwiki.userdatabase.hashPrefix\";\n \n     public static final String PROP_DB_LOGIN_NAME    = \"jspwiki.userdatabase.loginName\";\n \n@@ -149,6 +159,7 @@\n     private String m_table = null;\n     private String m_email = null;\n     private String m_fullName = null;\n+    private boolean m_hashPrefix = true;\n     private String m_loginName = null;\n     private String m_password = null;\n     private String m_wikiName = null;\n@@ -212,6 +223,7 @@ public void initialize( WikiEngine engine, Properties props ) throws NoRequiredP\n             m_table     = props.getProperty( PROP_DB_TABLE, DEFAULT_DB_TABLE );\n             m_email     = props.getProperty( PROP_DB_EMAIL, DEFAULT_DB_EMAIL );\n             m_fullName  = props.getProperty( PROP_DB_FULL_NAME, DEFAULT_DB_FULL_NAME );\n+            m_hashPrefix = Boolean.valueOf( props.getProperty( PROP_DB_HASH_PREFIX, DEFAULT_DB_HASH_PREFIX ) ).booleanValue();\n             m_loginName = props.getProperty( PROP_DB_LOGIN_NAME, DEFAULT_DB_LOGIN_NAME );\n             m_password  = props.getProperty( PROP_DB_PASSWORD, DEFAULT_DB_PASSWORD );\n             m_wikiName  = props.getProperty( PROP_DB_WIKI_NAME, DEFAULT_DB_WIKI_NAME );\n@@ -293,20 +305,22 @@ public void save( UserProfile profile ) throws WikiSecurityException\n         }\n         \n         // Get a clean password from the passed profile.\n-        // Hash the password if it isn't null, doesn't exist, or has changed.\n-        // Blank password is the same as null\n+        // Blank password is the same as null, which means we re-use the existing one.\n         String password = profile.getPassword();\n         String existingPassword = ( existingProfile == null ) ? null : existingProfile.getPassword();\n-        if ( password.equals(\"\") )\n+        if ( \"\".equals( password ) )\n         {\n             password = null;\n         }\n-        if ( password != null) \n-            {\n-            if ( existingPassword != null || !password.equals( existingPassword ) ) \n-            {\n-                password =  SHA_PREFIX + getHash( password );\n-            }\n+        if ( password == null) \n+        {\n+            password = existingPassword;\n+        }\n+        \n+        // If password changed, hash it before we save\n+        if ( !password.equals( existingPassword ) )\n+        {\n+            password =  ( m_hashPrefix ) ? SHA_PREFIX + getHash( password ) : getHash( password );\n         }\n         \n         try",
                "raw_url": "https://github.com/apache/jspwiki/raw/264a8efa3475b5d06f689a1620d40fc70a958883/src/com/ecyrd/jspwiki/auth/user/JDBCUserDatabase.java",
                "sha": "3cb7d5e7b80edc04718dd881d81a54c4a20c8d71",
                "status": "modified"
            }
        ],
        "message": "Fixed a NPE in JDBCUserDatabase that was triggered by a user editing a profile, but electing not to change the password. It now exhibits correct behavoir: no password means \"use the old one\", just like with XMLUserDatabase.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jspwiki/trunk@624717 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jspwiki/commit/a15e8b642e6a6b10aef6e2d1926741d04cacbe52",
        "repo": "jspwiki",
        "unit_tests": [
            "JDBCUserDatabaseTest.java"
        ]
    },
    "jspwiki_2a3c735": {
        "bug_id": "jspwiki_2a3c735",
        "commit": "https://github.com/apache/jspwiki/commit/2a3c735537a7f87c5d803f638aed83ad2b17a75e",
        "file": [
            {
                "additions": 18,
                "blob_url": "https://github.com/apache/jspwiki/blob/2a3c735537a7f87c5d803f638aed83ad2b17a75e/src/java/org/apache/wiki/NoSuchVariableException.java",
                "changes": 26,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/src/java/org/apache/wiki/NoSuchVariableException.java?ref=2a3c735537a7f87c5d803f638aed83ad2b17a75e",
                "deletions": 8,
                "filename": "src/java/org/apache/wiki/NoSuchVariableException.java",
                "patch": "@@ -23,20 +23,30 @@ Licensed to the Apache Software Foundation (ASF) under one\n import org.apache.wiki.api.WikiException;\n \n /**\n- *  Marks that no such variable was located.\n+ * Marks that no such variable was located.\n  */\n-public class NoSuchVariableException\n-    extends WikiException\n+public class NoSuchVariableException extends WikiException\n {\n-    private static final long          serialVersionUID = 1L;\n+    private static final long serialVersionUID = 1L;\n \n     /**\n-     *  Constructs an exception.\n-     *\n-     *  @param msg Message to show\n+     * Constructs an exception.\n+     * \n+     * @param msg Message to show\n      */\n     public NoSuchVariableException( String msg )\n     {\n-        super(msg);\n+        super( msg );\n+    }\n+\n+    /**\n+     * Constructs an exception.\n+     * \n+     * @param msg Message to show\n+     * @param cause the cause of the exception\n+     */\n+    public NoSuchVariableException( String msg, Throwable cause )\n+    {\n+        super( msg, cause );\n     }\n }",
                "raw_url": "https://github.com/apache/jspwiki/raw/2a3c735537a7f87c5d803f638aed83ad2b17a75e/src/java/org/apache/wiki/NoSuchVariableException.java",
                "sha": "a3eb194965caec5e70ba4f7ba41ee95ac1ba2824",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/jspwiki/blob/2a3c735537a7f87c5d803f638aed83ad2b17a75e/src/java/org/apache/wiki/VariableManager.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/src/java/org/apache/wiki/VariableManager.java?ref=2a3c735537a7f87c5d803f638aed83ad2b17a75e",
                "deletions": 2,
                "filename": "src/java/org/apache/wiki/VariableManager.java",
                "patch": "@@ -388,7 +388,7 @@ public String getValue( WikiContext context,\n         }\n         catch( Exception e )\n         {\n-            log.info(\"Interesting exception: cannot fetch variable value\",e);\n+            log.info( \"Interesting exception: cannot fetch variable value '\" + varName + \"'.\", e );\n         }\n         return \"\";\n     }\n@@ -420,7 +420,8 @@ public SystemVariables(WikiContext context)\n \n         public String getPagename()\n         {\n-            return m_context.getPage().getName();\n+            WikiPage page = m_context.getPage();\n+            return page == null ? null : page.getName();\n         }\n \n         public String getApplicationname()",
                "raw_url": "https://github.com/apache/jspwiki/raw/2a3c735537a7f87c5d803f638aed83ad2b17a75e/src/java/org/apache/wiki/VariableManager.java",
                "sha": "012280db0e6e95e5a715cd85eb083f08af8d2f5f",
                "status": "modified"
            }
        ],
        "message": "Fixed NPE in VariableManager.\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jspwiki/trunk@766530 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jspwiki/commit/196f98833e92628b1220f6452b38b5db1de0e2a9",
        "repo": "jspwiki",
        "unit_tests": [
            "VariableManagerTest.java"
        ]
    },
    "jspwiki_2caf9ec": {
        "bug_id": "jspwiki_2caf9ec",
        "commit": "https://github.com/apache/jspwiki/commit/2caf9ecff448a4f366c49c34630d1ad9f60b5e22",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/jspwiki/blob/2caf9ecff448a4f366c49c34630d1ad9f60b5e22/src/com/ecyrd/jspwiki/Release.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/src/com/ecyrd/jspwiki/Release.java?ref=2caf9ecff448a4f366c49c34630d1ad9f60b5e22",
                "deletions": 1,
                "filename": "src/com/ecyrd/jspwiki/Release.java",
                "patch": "@@ -77,7 +77,7 @@ Licensed to the Apache Software Foundation (ASF) under one\n      *  <p>\n      *  If the build identifier is empty, it is not added.\n      */\n-    public static final String     BUILD         = \"5\";\n+    public static final String     BUILD         = \"6\";\n     \n     /**\n      *  This is the generic version string you should use",
                "raw_url": "https://github.com/apache/jspwiki/raw/2caf9ecff448a4f366c49c34630d1ad9f60b5e22/src/com/ecyrd/jspwiki/Release.java",
                "sha": "df5c3dfedce54ba820ba9dd4db0823cdbf84ae06",
                "status": "modified"
            }
        ],
        "message": "JSPWIKI-326: Fixed NPE in ProfanityFilter.\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jspwiki/trunk@681274 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jspwiki/commit/d1695b71b2441b3c593cbe0e0f13f03cc2fd7205",
        "repo": "jspwiki",
        "unit_tests": [
            "ReleaseTest.java"
        ]
    },
    "jspwiki_3741265": {
        "bug_id": "jspwiki_3741265",
        "commit": "https://github.com/apache/jspwiki/commit/3741265b380d20f07d300c3e5e5d420d7c4c5ce9",
        "file": [
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/jspwiki/blob/3741265b380d20f07d300c3e5e5d420d7c4c5ce9/src/com/ecyrd/jspwiki/PageRenamer.java",
                "changes": 16,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/src/com/ecyrd/jspwiki/PageRenamer.java?ref=3741265b380d20f07d300c3e5e5d420d7c4c5ce9",
                "deletions": 7,
                "filename": "src/com/ecyrd/jspwiki/PageRenamer.java",
                "patch": "@@ -55,13 +55,6 @@\n     private Pattern m_longLinkPattern = null;\n     private Pattern m_camelCaseLinkPattern = null;\n \n-    /** Extension to be appended onto directories to denote they contain attachments. */\n-    public static final String DIR_EXTENSION   = \"-att\";\n-    \n-    /** Property key denoting storage directory for attachments. */\n-    public static final String PROP_STORAGEDIR = \"jspwiki.basicAttachmentProvider.storageDir\";\n-\n-\n     /**\n      * Constructor, ties this renamer instance to a WikiEngine.\n      * @param engine the wiki engine\n@@ -206,6 +199,10 @@ private void updateReferrersOnRename( WikiContext context,\n             updateReferrerOnRename( context, oldName, newName, changeReferrers, referrerName );\n         }\n \n+        //  Manage self-references, which the RefMgr is not managing for us\n+        \n+        updateReferrerOnRename( context, oldName, newName, changeReferrers, newName );\n+        \n         m_wikiEngine.getReferenceManager().clearPageEntries( oldName );\n \n         String text = m_wikiEngine.getText( newName );\n@@ -328,6 +325,11 @@ private String replaceLongLinks( String text, String oldName, String replacement\n             String anchor = \"\";\n             String subpage = \"\";\n \n+            if( link == null )\n+            {\n+                throw new InternalWikiException( \"Null link while trying to rename!  Culprit text is \"+text );\n+            }\n+            \n             int hash;\n             if( (hash = link.indexOf('#')) != -1 )\n             {",
                "raw_url": "https://github.com/apache/jspwiki/raw/3741265b380d20f07d300c3e5e5d420d7c4c5ce9/src/com/ecyrd/jspwiki/PageRenamer.java",
                "sha": "f120a1beeb0e8d3e8cadd2a2d8b617c24705fdae",
                "status": "modified"
            }
        ],
        "message": "Removed some cut-n-past code which was not being used.\nAdded fix for Bug 25, and self-reference pages For Bug 21\nAdded an extra NPE check\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jspwiki/trunk@626658 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jspwiki/commit/b17a9384475195886715dcf65db29b1c345e1e7c",
        "repo": "jspwiki",
        "unit_tests": [
            "PageRenamerTest.java"
        ]
    },
    "jspwiki_6f17cb7": {
        "bug_id": "jspwiki_6f17cb7",
        "commit": "https://github.com/apache/jspwiki/commit/6f17cb7e3910248f1846a82b21a49444fbc3dcaa",
        "file": [
            {
                "additions": 21,
                "blob_url": "https://github.com/apache/jspwiki/blob/6f17cb7e3910248f1846a82b21a49444fbc3dcaa/src/com/ecyrd/jspwiki/ReferenceManager.java",
                "changes": 38,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/src/com/ecyrd/jspwiki/ReferenceManager.java?ref=6f17cb7e3910248f1846a82b21a49444fbc3dcaa",
                "deletions": 17,
                "filename": "src/com/ecyrd/jspwiki/ReferenceManager.java",
                "patch": "@@ -568,31 +568,35 @@ public synchronized void pageRemoved( WikiPage page )\n     {\n         String pageName = page.getName();\n         \n-        Collection RefTo = (Collection)m_refersTo.get( pageName );\n-        Iterator it_refTo = RefTo.iterator();\n-        while( it_refTo.hasNext() )\n+        Collection refTo = (Collection)m_refersTo.get( pageName );\n+        \n+        if( refTo != null )\n         {\n-            String referredPageName = (String)it_refTo.next();\n-            Set refBy = (Set)m_referredBy.get( referredPageName );\n+            Iterator it_refTo = refTo.iterator();\n+            while( it_refTo.hasNext() )\n+            {\n+                String referredPageName = (String)it_refTo.next();\n+                Set refBy = (Set)m_referredBy.get( referredPageName );\n \n-            if( refBy == null )\n-                throw new InternalWikiException(\"Refmgr out of sync: page \"+pageName+\" refers to \"+referredPageName+\", which has null referrers.\");\n+                if( refBy == null )\n+                    throw new InternalWikiException(\"Refmgr out of sync: page \"+pageName+\" refers to \"+referredPageName+\", which has null referrers.\");\n \n-            refBy.remove(pageName);\n+                refBy.remove(pageName);\n             \n-            m_referredBy.remove( referredPageName );\n+                m_referredBy.remove( referredPageName );\n             \n-            // We won't put it back again if it becomes empty and does not exist.  It will be added\n-            // later on anyway, if it becomes referenced again.\n-            if( !(refBy.isEmpty() && !m_engine.pageExists(referredPageName)) )\n-            {\n-                m_referredBy.put( referredPageName, refBy );\n+                // We won't put it back again if it becomes empty and does not exist.  It will be added\n+                // later on anyway, if it becomes referenced again.\n+                if( !(refBy.isEmpty() && !m_engine.pageExists(referredPageName)) )\n+                {\n+                    m_referredBy.put( referredPageName, refBy );\n+                }\n             }\n+            \n+            log.debug(\"Removing from m_refersTo HashMap key:value \"+pageName+\":\"+m_refersTo.get( pageName ));\n+            m_refersTo.remove( pageName );\n         }\n \n-        log.debug(\"Removing from m_refersTo HashMap key:value \"+pageName+\":\"+m_refersTo.get( pageName ));\n-        m_refersTo.remove( pageName );\n-        \n         Set refBy = (Set) m_referredBy.get( pageName );\n         if( refBy == null || refBy.isEmpty() )\n         {",
                "raw_url": "https://github.com/apache/jspwiki/raw/6f17cb7e3910248f1846a82b21a49444fbc3dcaa/src/com/ecyrd/jspwiki/ReferenceManager.java",
                "sha": "60c7d6e37ffaf17d4448bfa7bf2f091c26fea1cf",
                "status": "modified"
            }
        ],
        "message": "pageRemoved would sometimes throw an NPE.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jspwiki/trunk@625313 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jspwiki/commit/599a2e20b75057ac1e5cd2c1b3f87eeeac2ae5be",
        "repo": "jspwiki",
        "unit_tests": [
            "ReferenceManagerTest.java"
        ]
    },
    "jspwiki_6f6549e": {
        "bug_id": "jspwiki_6f6549e",
        "commit": "https://github.com/apache/jspwiki/commit/6f6549ebad3075c201d65e92909a84fc72686e44",
        "file": [
            {
                "additions": 24,
                "blob_url": "https://github.com/apache/jspwiki/blob/6f6549ebad3075c201d65e92909a84fc72686e44/src/com/ecyrd/jspwiki/auth/UserManager.java",
                "changes": 33,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/src/com/ecyrd/jspwiki/auth/UserManager.java?ref=6f6549ebad3075c201d65e92909a84fc72686e44",
                "deletions": 9,
                "filename": "src/com/ecyrd/jspwiki/auth/UserManager.java",
                "patch": "@@ -364,7 +364,8 @@ public boolean login( String username, String password, HttpSession session )\n         }\n \n         UserProfile wup = getUserProfile( username );\n-        wup.setPassword( password );\n+        if( wup != null )\n+            wup.setPassword( password );\n \n         boolean isValid = m_authenticator.authenticate( wup );\n \n@@ -452,10 +453,12 @@ protected UserProfile limitedLogin( HttpServletRequest request )\n         if( uid != null )\n         {\n             wup = getUserProfile( uid );\n-            wup.setLoginStatus( UserProfile.CONTAINER );            \n-\n-            HttpSession session = request.getSession( true );\n-            session.setAttribute( WIKIUSER, wup );\n+            if( wup != null )\n+            {\n+                wup.setLoginStatus( UserProfile.CONTAINER );            \n+                HttpSession session = request.getSession( true );\n+                session.setAttribute( WIKIUSER, wup );\n+            }\n         }\n         else\n         {\n@@ -469,9 +472,11 @@ protected UserProfile limitedLogin( HttpServletRequest request )\n             if( uid != null )\n             {\n                 wup = UserProfile.parseStringRepresentation( uid );\n-\n-                log.debug(\"wup=\"+wup);\n-                wup.setLoginStatus( UserProfile.COOKIE );\n+                if( wup != null )\n+                {\n+                    log.debug(\"wup=\"+wup);\n+                    wup.setLoginStatus( UserProfile.COOKIE );\n+                }\n             }\n             else\n             {\n@@ -487,10 +492,20 @@ protected UserProfile limitedLogin( HttpServletRequest request )\n                     uid = \"unknown\"; // FIXME: Magic\n                 }\n                 wup = getUserProfile( uid );\n-                wup.setLoginStatus( UserProfile.NONE );\n+                if( wup != null )\n+                    wup.setLoginStatus( UserProfile.NONE );\n             }\n         }\n \n+        // If the UserDatabase declined to give us a UserPrincipal, \n+        // we manufacture one here explicitly. \n+        if( wup == null )\n+        {\n+            wup = new UserProfile();\n+            wup.setName( GROUP_GUEST );\n+            wup.setLoginStatus( UserProfile.NONE );\n+        }\n+\n         //\n         //  FIXME:\n         //",
                "raw_url": "https://github.com/apache/jspwiki/raw/6f6549ebad3075c201d65e92909a84fc72686e44/src/com/ecyrd/jspwiki/auth/UserManager.java",
                "sha": "31e8401aa530942f6a2e427ce459d3bd78c72bff",
                "status": "modified"
            }
        ],
        "message": "Ebu's npe prevention patch.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jspwiki/trunk@623435 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jspwiki/commit/a8abfba89e47e7c525ee0800be4b71ef5adcee7c",
        "repo": "jspwiki",
        "unit_tests": [
            "UserManagerTest.java"
        ]
    },
    "jspwiki_7383dbe": {
        "bug_id": "jspwiki_7383dbe",
        "commit": "https://github.com/apache/jspwiki/commit/7383dbe233fd0a37d2864606f4d02c151fe0d3e7",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/jspwiki/blob/7383dbe233fd0a37d2864606f4d02c151fe0d3e7/src/com/ecyrd/jspwiki/TextUtil.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/src/com/ecyrd/jspwiki/TextUtil.java?ref=7383dbe233fd0a37d2864606f4d02c151fe0d3e7",
                "deletions": 4,
                "filename": "src/com/ecyrd/jspwiki/TextUtil.java",
                "patch": "@@ -264,15 +264,16 @@ public static String replaceEntities( String src )\n      *  @param src  The string to find.\n      *  @param dest The string to replace <I>src</I> with.\n      */\n-\n-    public static String replaceString( String orig, String src, String dest )\n+    public final static String replaceString( String orig, String src, String dest )\n     {\n-        if( orig == null ) return null;\n+        if ( orig == null ) return null;\n+        if ( src == null || dest == null ) throw new NullPointerException();\n+        if ( src.length() == 0 ) return orig;\n \n         StringBuffer res = new StringBuffer();\n         int start, end = 0, last = 0;\n \n-        while( (start = orig.indexOf(src,end)) != -1 )\n+        while ( (start = orig.indexOf(src,end)) != -1 )\n         {\n             res.append( orig.substring( last, start ) );\n             res.append( dest );",
                "raw_url": "https://github.com/apache/jspwiki/raw/7383dbe233fd0a37d2864606f4d02c151fe0d3e7/src/com/ecyrd/jspwiki/TextUtil.java",
                "sha": "f0cfafb1f1559af52e0cdf2022215b83c3a1b822",
                "status": "modified"
            }
        ],
        "message": "Patch from Murray to fix an NPE in replaceString()\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jspwiki/trunk@625823 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jspwiki/commit/a69bd31fe5033acc6ab0e1152e587ac1f4870f98",
        "repo": "jspwiki",
        "unit_tests": [
            "TextUtilTest.java"
        ]
    },
    "jspwiki_8500885": {
        "bug_id": "jspwiki_8500885",
        "commit": "https://github.com/apache/jspwiki/commit/85008859e84df601f7337edbef684720e02c067e",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/jspwiki/blob/85008859e84df601f7337edbef684720e02c067e/src/com/ecyrd/jspwiki/providers/BasicAttachmentProvider.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/src/com/ecyrd/jspwiki/providers/BasicAttachmentProvider.java?ref=85008859e84df601f7337edbef684720e02c067e",
                "deletions": 2,
                "filename": "src/com/ecyrd/jspwiki/providers/BasicAttachmentProvider.java",
                "patch": "@@ -146,7 +146,7 @@ private int findLatestVersion( Attachment att )\n             int cutpoint = pages[i].indexOf( '.' );\n             if( cutpoint > 0 )\n             {\n-                String pageNum = pages[i].substring( 0, cutpoint );\n+                String pageNum = ( cutpoint > 0 ) ? pages[i].substring( 0, cutpoint ) : pages[i] ;\n \n                 try\n                 {\n@@ -432,7 +432,7 @@ public Attachment getAttachmentInfo( WikiPage page, String name, int version )\n         return att;\n     }\n \n-    public Collection getVersionHistory( Attachment att )\n+    public List getVersionHistory( Attachment att )\n     {\n         ArrayList list = new ArrayList();\n ",
                "raw_url": "https://github.com/apache/jspwiki/raw/85008859e84df601f7337edbef684720e02c067e/src/com/ecyrd/jspwiki/providers/BasicAttachmentProvider.java",
                "sha": "380e92e24e60b250cc3d29921aad15b54b44f06d",
                "status": "modified"
            }
        ],
        "message": "getVersionHistory() now returns a List\nTemporary fix to a NPE when running Windows.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jspwiki/trunk@622452 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jspwiki/commit/02f8c877c0afd862dffd8c3603b3085eff473050",
        "repo": "jspwiki",
        "unit_tests": [
            "BasicAttachmentProviderTest.java"
        ]
    },
    "jspwiki_99ed0c7": {
        "bug_id": "jspwiki_99ed0c7",
        "commit": "https://github.com/apache/jspwiki/commit/99ed0c72f2266b60aa6652e9fd326fb1fbe879cc",
        "file": [
            {
                "additions": 13,
                "blob_url": "https://github.com/apache/jspwiki/blob/99ed0c72f2266b60aa6652e9fd326fb1fbe879cc/src/com/ecyrd/jspwiki/plugin/ReferringPagesPlugin.java",
                "changes": 18,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/src/com/ecyrd/jspwiki/plugin/ReferringPagesPlugin.java?ref=99ed0c72f2266b60aa6652e9fd326fb1fbe879cc",
                "deletions": 5,
                "filename": "src/com/ecyrd/jspwiki/plugin/ReferringPagesPlugin.java",
                "patch": "@@ -47,6 +47,7 @@ public String execute( WikiContext context, Map params )\n     {\n         ReferenceManager refmgr = context.getEngine().getReferenceManager();\n         Collection       links  = refmgr.findReferrers( context.getPage().getName() );\n+        String           wikitext;\n \n         super.initialize( context, params );\n \n@@ -60,13 +61,20 @@ public String execute( WikiContext context, Map params )\n         log.debug( \"Fetching referring pages for \"+context.getPage().getName()+\n                    \" with a max of \"+items);\n         \n-        String wikitext = wikitizeCollection( links, \"\\\\\\\\\", items );\n-\n-        if( items < links.size() && items > 0 )\n+        if( links != null && links.size() > 0 )\n         {\n-            extras = TextUtil.replaceString( extras, \"%d\", \n+            wikitext = wikitizeCollection( links, \"\\\\\\\\\", items );\n+\n+            if( items < links.size() && items > 0 )\n+            {\n+                extras = TextUtil.replaceString( extras, \"%d\", \n                                              \"\"+(links.size()-items) );\n-            wikitext += extras;\n+                wikitext += extras;\n+            }\n+        }\n+        else\n+        {\n+            wikitext = \"...nobody\";\n         }\n \n         return makeHTML( context, wikitext );",
                "raw_url": "https://github.com/apache/jspwiki/raw/99ed0c72f2266b60aa6652e9fd326fb1fbe879cc/src/com/ecyrd/jspwiki/plugin/ReferringPagesPlugin.java",
                "sha": "56a11a73b6c740cae3998e897c9eac44344207f9",
                "status": "modified"
            }
        ],
        "message": "Fixed a NPE with NULL links list.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jspwiki/trunk@621411 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jspwiki/commit/1cd4b41ddfce50621fae5372da2fd28707861722",
        "repo": "jspwiki",
        "unit_tests": [
            "ReferringPagesPluginTest.java"
        ]
    },
    "jspwiki_b8caf6e": {
        "bug_id": "jspwiki_b8caf6e",
        "commit": "https://github.com/apache/jspwiki/commit/b8caf6e19ffde4ff68da007a34bde02b216110d2",
        "file": [
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/jspwiki/blob/b8caf6e19ffde4ff68da007a34bde02b216110d2/src/com/ecyrd/jspwiki/auth/AuthorizationManager.java",
                "changes": 23,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/src/com/ecyrd/jspwiki/auth/AuthorizationManager.java?ref=b8caf6e19ffde4ff68da007a34bde02b216110d2",
                "deletions": 4,
                "filename": "src/com/ecyrd/jspwiki/auth/AuthorizationManager.java",
                "patch": "@@ -405,10 +405,25 @@ public final void initialize( WikiEngine engine, Properties properties ) throws\n         try\n         {\n             URL policyURL = AuthenticationManager.findConfigFile( engine, DEFAULT_POLICY );\n-            File policyFile = new File( policyURL.getPath() );\n-            m_localPolicy = new LocalPolicy( policyFile, engine.getContentEncoding() );\n-            m_localPolicy.refresh();\n-            log.info(\"Initialized local security policy: \" + policyFile.getAbsolutePath());\n+            \n+            if (policyURL != null) \n+            {\n+                File policyFile = new File( policyURL.getPath() );\n+                m_localPolicy = new LocalPolicy( policyFile, engine.getContentEncoding() );\n+                m_localPolicy.refresh();\n+                log.info(\"Initialized default security policy: \" + policyFile.getAbsolutePath());\n+            }\n+            else\n+            {\n+                StringBuffer sb = new StringBuffer(\"JSPWiki was unable to initialize the \");\n+                sb.append(\"default security policy (WEB-INF/jspwiki.policy) file. \");\n+                sb.append(\"Please ensure that the jspwiki.policy file exists in the default location. \");\n+                sb.append(\"This file should exist regardless of the existance of a global policy file. \");\n+                sb.append(\"The global policy file is identified by the java.security.policy variable. \");\n+                WikiSecurityException wse = new WikiSecurityException(sb.toString());\n+                log.fatal(sb.toString(), wse);\n+                throw wse;\n+            }\n         }\n         catch ( PolicyException e )\n         {",
                "raw_url": "https://github.com/apache/jspwiki/raw/b8caf6e19ffde4ff68da007a34bde02b216110d2/src/com/ecyrd/jspwiki/auth/AuthorizationManager.java",
                "sha": "5e87506ea950e85ef008deea9bb6df36cdd33dcf",
                "status": "modified"
            }
        ],
        "message": "Added patch from Dave Wolf to fix an NPE.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jspwiki/trunk@626883 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jspwiki/commit/0e32a2fdf4d521ecf5dd9bf200848b7a9ae54f68",
        "repo": "jspwiki",
        "unit_tests": [
            "AuthorizationManagerTest.java"
        ]
    },
    "jspwiki_c53d53c": {
        "bug_id": "jspwiki_c53d53c",
        "commit": "https://github.com/apache/jspwiki/commit/c53d53c5005835b3330aa23fcf34af1e1cf3c50f",
        "file": [
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/jspwiki/blob/c53d53c5005835b3330aa23fcf34af1e1cf3c50f/ChangeLog",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/ChangeLog?ref=c53d53c5005835b3330aa23fcf34af1e1cf3c50f",
                "deletions": 0,
                "filename": "ChangeLog",
                "patch": "@@ -1,3 +1,13 @@\n+2013-06-02  Juan Pablo Santos (juanpablo AT apache DOT org)\n+\n+       * 2.10.0-svn-3\n+\n+       * JSPWIKI-771: inherit ASF parent pom. Deleted release profile in favour of\n+         apache-release and gpg configuration (both present on parent pom);\n+         added <ciManagement/>, <issueManagement/> and <mailingLists/> sections.\n+       \n+       * fixed runtime NPE on WikiJSPFilter (m_engine used before having been initialized)\n+\n 2013-06-01  Harry Metske (metskem@apache.org)\n \n        * 2.10.0-svn-2",
                "raw_url": "https://github.com/apache/jspwiki/raw/c53d53c5005835b3330aa23fcf34af1e1cf3c50f/ChangeLog",
                "sha": "89bc6031fb2d5df0c790e609057cd732fd099a7e",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/jspwiki/blob/c53d53c5005835b3330aa23fcf34af1e1cf3c50f/jspwiki-war/src/main/java/org/apache/wiki/Release.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/jspwiki-war/src/main/java/org/apache/wiki/Release.java?ref=c53d53c5005835b3330aa23fcf34af1e1cf3c50f",
                "deletions": 1,
                "filename": "jspwiki-war/src/main/java/org/apache/wiki/Release.java",
                "patch": "@@ -75,7 +75,7 @@ Licensed to the Apache Software Foundation (ASF) under one\n      *  <p>\n      *  If the build identifier is empty, it is not added.\n      */\n-    public static final String     BUILD         = \"2\";\n+    public static final String     BUILD         = \"3\";\n     \n     /**\n      *  This is the generic version string you should use",
                "raw_url": "https://github.com/apache/jspwiki/raw/c53d53c5005835b3330aa23fcf34af1e1cf3c50f/jspwiki-war/src/main/java/org/apache/wiki/Release.java",
                "sha": "83428cfee833972b5c6b48b90960264aaf0e57e6",
                "status": "modified"
            }
        ],
        "message": "* 2.10.0-svn-3\n\n* JSPWIKI-771: inherit ASF parent pom. Deleted release profile in favour of\n  apache-release and gpg configuration (both present on parent pom);\n  added <ciManagement/>, <issueManagement/> and <mailingLists/> sections.\n       \n* fixed runtime NPE on WikiJSPFilter (m_engine used before having been initialized)\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jspwiki/trunk@1488662 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jspwiki/commit/33f7b18db041a0731e07ab165855875665954c0d",
        "repo": "jspwiki",
        "unit_tests": [
            "ReleaseTest.java"
        ]
    },
    "jspwiki_dd8c00c": {
        "bug_id": "jspwiki_dd8c00c",
        "commit": "https://github.com/apache/jspwiki/commit/dd8c00c9e4e48a6dfbb5ba0bcdb122ab59997e4a",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/jspwiki/blob/dd8c00c9e4e48a6dfbb5ba0bcdb122ab59997e4a/src/com/ecyrd/jspwiki/auth/user/XMLUserDatabase.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/src/com/ecyrd/jspwiki/auth/user/XMLUserDatabase.java?ref=dd8c00c9e4e48a6dfbb5ba0bcdb122ab59997e4a",
                "deletions": 0,
                "filename": "src/com/ecyrd/jspwiki/auth/user/XMLUserDatabase.java",
                "patch": "@@ -611,6 +611,9 @@ private UserProfile findByAttribute( String matchAttribute, String index )\n         checkForRefresh();\n         \n         NodeList users = c_dom.getElementsByTagName( USER_TAG );\n+        \n+        if( users == null ) return null;\n+        \n         for( int i = 0; i < users.getLength(); i++ )\n         {\n             Element user = (Element) users.item( i );",
                "raw_url": "https://github.com/apache/jspwiki/raw/dd8c00c9e4e48a6dfbb5ba0bcdb122ab59997e4a/src/com/ecyrd/jspwiki/auth/user/XMLUserDatabase.java",
                "sha": "610212e93dc0cd8ba1040efd049c5fba9bc6b43e",
                "status": "modified"
            }
        ],
        "message": "Adding a NPE check to fight an annoying problem at jspwiki.org.\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jspwiki/trunk@703235 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jspwiki/commit/65a1d67ede1e00001b89a64cdcd9058e9eea796b",
        "repo": "jspwiki",
        "unit_tests": [
            "XMLUserDatabaseTest.java"
        ]
    },
    "jspwiki_e6d405d": {
        "bug_id": "jspwiki_e6d405d",
        "commit": "https://github.com/apache/jspwiki/commit/e6d405d09ca4f8c10e0fed34cd2b4f40d359c5c1",
        "file": [
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/jspwiki/blob/e6d405d09ca4f8c10e0fed34cd2b4f40d359c5c1/src/com/ecyrd/jspwiki/TextUtil.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/src/com/ecyrd/jspwiki/TextUtil.java?ref=e6d405d09ca4f8c10e0fed34cd2b4f40d359c5c1",
                "deletions": 1,
                "filename": "src/com/ecyrd/jspwiki/TextUtil.java",
                "patch": "@@ -144,8 +144,14 @@ protected static String urlDecode( byte[] bytes, String encoding )\n      */\n     public static String urlEncodeUTF8( String text )\n     {\n+        // If text is null, just return an empty string\n+        if ( text == null )\n+        {\n+            return \"\";\n+        }\n+        \n         byte[] rs = {};\n-\n+        \n         try\n         {\n             rs = text.getBytes(\"UTF-8\");",
                "raw_url": "https://github.com/apache/jspwiki/raw/e6d405d09ca4f8c10e0fed34cd2b4f40d359c5c1/src/com/ecyrd/jspwiki/TextUtil.java",
                "sha": "79ca60d41c6a7743a2fd0e3dbc4540f009da1a8e",
                "status": "modified"
            }
        ],
        "message": "Bugfix: Found and killed an NPE in TextUtil that was causing NewGroups.jsp to fail.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jspwiki/trunk@625161 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jspwiki/commit/9449e18420c1bbc9a52f234c6fab17560d71c9e5",
        "repo": "jspwiki",
        "unit_tests": [
            "TextUtilTest.java"
        ]
    },
    "jspwiki_ef0184e": {
        "bug_id": "jspwiki_ef0184e",
        "commit": "https://github.com/apache/jspwiki/commit/ef0184e4367dac4b92a43d4bdf196bdcfee770c9",
        "file": [
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/jspwiki/blob/ef0184e4367dac4b92a43d4bdf196bdcfee770c9/src/com/ecyrd/jspwiki/auth/permissions/PagePermission.java",
                "changes": 18,
                "contents_url": "https://api.github.com/repos/apache/jspwiki/contents/src/com/ecyrd/jspwiki/auth/permissions/PagePermission.java?ref=ef0184e4367dac4b92a43d4bdf196bdcfee770c9",
                "deletions": 12,
                "filename": "src/com/ecyrd/jspwiki/auth/permissions/PagePermission.java",
                "patch": "@@ -37,7 +37,7 @@\n  * <i>never </i> imply others.\n  * </p>\n  * @author Andrew Jaquith\n- * @version $Revision: 1.4 $ $Date: 2005-09-02 23:47:52 $\n+ * @version $Revision: 1.5 $ $Date: 2005-09-17 18:21:06 $\n  * @since 2.3\n  */\n public final class PagePermission extends Permission\n@@ -151,9 +151,9 @@ public PagePermission( String page, String actions )\n      * @param page\n      * @param actions\n      */\n-    public PagePermission( String wiki, WikiPage page, String actions )\n+    public PagePermission( WikiPage page, String actions )\n     {\n-        this( wiki + WIKI_SEPARATOR + page.getName(), actions );\n+        this( page.getWiki() + WIKI_SEPARATOR + page.getName(), actions );\n     }\n \n     /**\n@@ -169,7 +169,7 @@ public final boolean equals( Object obj )\n         }\n         PagePermission p = (PagePermission) obj;\n         return ( p.m_mask == m_mask && p.m_page.equals( m_page ) \n-                 && p.m_wiki.equals( m_wiki ));\n+                 && p.m_wiki != null && p.m_wiki.equals( m_wiki ));\n     }\n \n     /**\n@@ -208,13 +208,7 @@ public final String getWiki()\n      */\n     public final int hashCode()\n     {\n-        int hash = m_mask;\n-        String actions = getActions();\n-        for( int i = 0; i < actions.length(); i++ )\n-        {\n-            hash += 13 * actions.hashCode();\n-        }\n-        return hash;\n+        return m_mask + ( ( 13 * m_actionString.hashCode() ) * 23 * m_wiki.hashCode() );\n     }\n \n     /**\n@@ -330,7 +324,7 @@ protected static final int impliedMask( int mask )\n      * @return the results of the test, where <code>true</code> indicates that\n      *         <code>subSet</code> is a subset of <code>superSet</code>\n      */\n-    protected final boolean isSubset( String superSet, String subSet )\n+    protected static final boolean isSubset( String superSet, String subSet )\n     {\n         // If either is null, return false\n         if ( superSet == null || subSet == null )",
                "raw_url": "https://github.com/apache/jspwiki/raw/ef0184e4367dac4b92a43d4bdf196bdcfee770c9/src/com/ecyrd/jspwiki/auth/permissions/PagePermission.java",
                "sha": "2120c7b179d18eca3a598185df8fad920a4d83a4",
                "status": "modified"
            }
        ],
        "message": "Changed PagePermission constructor; fixed NPE for equals().\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/jspwiki/trunk@624574 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jspwiki/commit/fbda02884b67794464cc86624c894437bc0734ba",
        "repo": "jspwiki",
        "unit_tests": [
            "PagePermissionTest.java"
        ]
    }
}