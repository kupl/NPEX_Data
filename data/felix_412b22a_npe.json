[
    {
        "repo": "felix",
        "commit": "https://github.com/apache/felix/commit/412b22a76e61fdfd4d1e7d733d316139a56f14aa",
        "bug_id": "felix_412b22a",
        "message": "FELIX-5015 Unit tests (for NPE in ResolverImpl)\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/felix/trunk@1705686 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/felix/commit/6dea75105231d39ca155e89dda12acbb87bf8e63",
        "patched_files": [
            "Resolver.java",
            "ResolverImpl.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/felix/raw/412b22a76e61fdfd4d1e7d733d316139a56f14aa/resolver/src/main/java/org/apache/felix/resolver/ResolverImpl.java",
                "contents_url": "https://api.github.com/repos/apache/felix/contents/resolver/src/main/java/org/apache/felix/resolver/ResolverImpl.java?ref=412b22a76e61fdfd4d1e7d733d316139a56f14aa",
                "filename": "resolver/src/main/java/org/apache/felix/resolver/ResolverImpl.java",
                "deletions": 4,
                "sha": "211e5e21d80c5251a9b3ec47a4269b1be12ad66e",
                "blob_url": "https://github.com/apache/felix/blob/412b22a76e61fdfd4d1e7d733d316139a56f14aa/resolver/src/main/java/org/apache/felix/resolver/ResolverImpl.java",
                "patch": "@@ -40,7 +40,6 @@\n \n import org.apache.felix.resolver.util.ArrayMap;\n import org.apache.felix.resolver.util.OpenHashMap;\n-\n import org.osgi.framework.namespace.BundleNamespace;\n import org.osgi.framework.namespace.ExecutionEnvironmentNamespace;\n import org.osgi.framework.namespace.HostNamespace;\n@@ -1730,12 +1729,12 @@ private static boolean isCompatible(\n         }\n \n         Set<Capability> packageSources = sources.get(cap);\n-        if(packageSources == null) \n+        if(packageSources == null)\n         {\n             return new HashSet<Capability>();\n         }\n \n-        return packageSources;  \n+        return packageSources;\n     }\n \n     private static void getPackageSourcesInternal(\n@@ -2074,7 +2073,7 @@ public WireCandidate(Requirement requirement, Capability capability)\n         }\n     }\n \n-    private static class Packages\n+    public static class Packages\n     {\n         public final OpenHashMap<String, Blame> m_exportedPkgs;\n         public final OpenHashMap<String, List<Blame>> m_importedPkgs;",
                "changes": 7
            },
            {
                "status": "modified",
                "additions": 34,
                "raw_url": "https://github.com/apache/felix/raw/412b22a76e61fdfd4d1e7d733d316139a56f14aa/resolver/src/test/java/org/apache/felix/resolver/test/ResolverTest.java",
                "contents_url": "https://api.github.com/repos/apache/felix/contents/resolver/src/test/java/org/apache/felix/resolver/test/ResolverTest.java?ref=412b22a76e61fdfd4d1e7d733d316139a56f14aa",
                "filename": "resolver/src/test/java/org/apache/felix/resolver/test/ResolverTest.java",
                "deletions": 0,
                "sha": "11e518fa922aa07ebcf2a004374dca02ca88b804",
                "blob_url": "https://github.com/apache/felix/blob/412b22a76e61fdfd4d1e7d733d316139a56f14aa/resolver/src/test/java/org/apache/felix/resolver/test/ResolverTest.java",
                "patch": "@@ -23,13 +23,15 @@\n import static org.junit.Assert.assertTrue;\n import static org.junit.Assert.fail;\n \n+import java.lang.reflect.Method;\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.Collection;\n import java.util.Collections;\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n+import java.util.Set;\n \n import org.apache.felix.resolver.Logger;\n import org.apache.felix.resolver.ResolverImpl;\n@@ -42,6 +44,7 @@\n import org.apache.felix.resolver.test.util.ResolveContextImpl;\n import org.apache.felix.resolver.test.util.ResourceImpl;\n import org.junit.Test;\n+import org.mockito.Mockito;\n import org.osgi.framework.Constants;\n import org.osgi.framework.namespace.BundleNamespace;\n import org.osgi.framework.namespace.HostNamespace;\n@@ -577,6 +580,37 @@ public void testScenario12() throws Exception\n         assertEquals(0, wireMap.size());\n     }\n \n+    @Test\n+    public void testPackageSources() throws Exception {\n+        Method m = ResolverImpl.class.getDeclaredMethod(\"getPackageSources\",\n+                Capability.class, Map.class);\n+        m.setAccessible(true);\n+\n+        Capability cap = Mockito.mock(Capability.class);\n+        assertEquals(Collections.emptySet(),\n+                m.invoke(null, cap, new HashMap<Resource, ResolverImpl.Packages>()));\n+\n+        Capability cap2 = Mockito.mock(Capability.class);\n+        Resource res2 = Mockito.mock(Resource.class);\n+        Mockito.when(cap2.getResource()).thenReturn(res2);\n+        Map<Resource, ResolverImpl.Packages> map2 = new HashMap<Resource, ResolverImpl.Packages>();\n+        map2.put(res2, new ResolverImpl.Packages(res2));\n+        assertEquals(Collections.emptySet(), m.invoke(null, cap2, map2));\n+\n+        Capability cap3 = Mockito.mock(Capability.class);\n+        Resource res3 = Mockito.mock(Resource.class);\n+        Mockito.when(cap3.getResource()).thenReturn(res3);\n+        Map<Resource, ResolverImpl.Packages> map3 = new HashMap<Resource, ResolverImpl.Packages>();\n+        ResolverImpl.Packages pkgs3 = new ResolverImpl.Packages(res3);\n+        Set<Capability> srcCaps3 = Collections.singleton(Mockito.mock(Capability.class));\n+        Map<Capability, Set<Capability>> srcMap3 = Collections.singletonMap(\n+                cap3, srcCaps3);\n+        pkgs3.m_sources.putAll(srcMap3);\n+        map3.put(res3, pkgs3);\n+        assertEquals(srcCaps3, m.invoke(null, cap3, map3));\n+\n+    }\n+\n     private static String getResourceName(Resource r)\n     {\n         return r.getCapabilities(IdentityNamespace.IDENTITY_NAMESPACE).get(0).getAttributes()",
                "changes": 34
            }
        ],
        "unit_tests": [
            "ResolverTest.java",
            "ResolverImplTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "resolver/src/test/java/org/apache/felix/resolver/test/ResolverTest.java",
        "buggy_files": [
            "org.osgi.service.obr/src/main/java/org/osgi/service/obr/Resolver.java",
            "resolver/src/main/java/org/osgi/service/resolver/Resolver.java",
            "bundlerepository/src/main/java/org/apache/felix/bundlerepository/Resolver.java",
            "resolver/src/main/java/org/apache/felix/resolver/ResolverImpl.java",
            "bundlerepository/src/main/java/org/apache/felix/bundlerepository/impl/ResolverImpl.java"
        ],
        "fixed": true
    }
]