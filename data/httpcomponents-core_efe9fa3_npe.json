[
    {
        "repo": "httpcomponents-core",
        "commit": "https://github.com/apache/httpcomponents-core/commit/efe9fa317934a7d49a221de0d2d18c996448ed96",
        "bug_id": "httpcomponents-core_efe9fa3",
        "message": "Fixed NPE in StringEntity constructor thrown if ContentType#getCharset is null\n\ngit-svn-id: https://svn.apache.org/repos/asf/httpcomponents/httpcore/trunk@1334434 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/httpcomponents-core/commit/54351a165a3c907e3509d6a724b7f879d8f692f6",
        "patched_files": [
            "RELEASE_NOTES.txt",
            "StringEntity.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 6,
                "raw_url": "https://github.com/apache/httpcomponents-core/raw/efe9fa317934a7d49a221de0d2d18c996448ed96/RELEASE_NOTES.txt",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-core/contents/RELEASE_NOTES.txt?ref=efe9fa317934a7d49a221de0d2d18c996448ed96",
                "filename": "RELEASE_NOTES.txt",
                "deletions": 0,
                "sha": "55c9ca235a8e588b8cf5cf7317e3f96334c671c3",
                "blob_url": "https://github.com/apache/httpcomponents-core/blob/efe9fa317934a7d49a221de0d2d18c996448ed96/RELEASE_NOTES.txt",
                "patch": "@@ -1,3 +1,9 @@\n+Changes since 4.2\n+-------------------\n+\n+* Fixed NPE in StringEntity constructor thrown if ContentType#getCharset is null.\n+  Contributed by Oleg Kalnichevski <olegk at apache.org>\n+\n Release 4.2\n -------------------\n ",
                "changes": 6
            },
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/httpcomponents-core/raw/efe9fa317934a7d49a221de0d2d18c996448ed96/httpcore/src/main/java/org/apache/http/entity/StringEntity.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-core/contents/httpcore/src/main/java/org/apache/http/entity/StringEntity.java?ref=efe9fa317934a7d49a221de0d2d18c996448ed96",
                "filename": "httpcore/src/main/java/org/apache/http/entity/StringEntity.java",
                "deletions": 0,
                "sha": "a1f96c764013034a9a4cc6231b9070343ba12100",
                "blob_url": "https://github.com/apache/httpcomponents-core/blob/efe9fa317934a7d49a221de0d2d18c996448ed96/httpcore/src/main/java/org/apache/http/entity/StringEntity.java",
                "patch": "@@ -66,6 +66,9 @@ public StringEntity(final String string, final ContentType contentType) {\n             throw new IllegalArgumentException(\"Source string may not be null\");\n         }\n         Charset charset = contentType != null ? contentType.getCharset() : null;\n+        if (charset == null) {\n+            charset = HTTP.DEF_CONTENT_CHARSET;\n+        }\n         try {\n             this.content = string.getBytes(charset.name());\n         } catch (UnsupportedEncodingException ex) {",
                "changes": 3
            },
            {
                "status": "modified",
                "additions": 33,
                "raw_url": "https://github.com/apache/httpcomponents-core/raw/efe9fa317934a7d49a221de0d2d18c996448ed96/httpcore/src/test/java/org/apache/http/entity/TestStringEntity.java",
                "contents_url": "https://api.github.com/repos/apache/httpcomponents-core/contents/httpcore/src/test/java/org/apache/http/entity/TestStringEntity.java?ref=efe9fa317934a7d49a221de0d2d18c996448ed96",
                "filename": "httpcore/src/test/java/org/apache/http/entity/TestStringEntity.java",
                "deletions": 0,
                "sha": "5c083bfe931783c75e673506fdf1141f885cb3a5",
                "blob_url": "https://github.com/apache/httpcomponents-core/blob/efe9fa317934a7d49a221de0d2d18c996448ed96/httpcore/src/test/java/org/apache/http/entity/TestStringEntity.java",
                "patch": "@@ -28,8 +28,10 @@\n package org.apache.http.entity;\n \n import java.io.ByteArrayOutputStream;\n+import java.nio.charset.Charset;\n \n import org.apache.http.Consts;\n+import org.apache.http.util.EntityUtils;\n import org.junit.Assert;\n import org.junit.Test;\n \n@@ -77,6 +79,37 @@ public void testDefaultContent() throws Exception {\n                 httpentity.getContentType().getValue());\n     }\n \n+    private static String constructString(int [] unicodeChars) {\n+        StringBuilder buffer = new StringBuilder();\n+        if (unicodeChars != null) {\n+            for (int i = 0; i < unicodeChars.length; i++) {\n+                buffer.append((char)unicodeChars[i]);\n+            }\n+        }\n+        return buffer.toString();\n+    }\n+\n+    static final int SWISS_GERMAN_HELLO [] = {\n+            0x47, 0x72, 0xFC, 0x65, 0x7A, 0x69, 0x5F, 0x7A, 0xE4, 0x6D, 0xE4\n+        };\n+\n+    @Test\n+    public void testNullCharset() throws Exception {\n+        String s = constructString(SWISS_GERMAN_HELLO);\n+        StringEntity httpentity = new StringEntity(s, ContentType.create(\"text/plain\", (Charset) null));\n+        Assert.assertNotNull(httpentity.getContentType());\n+        Assert.assertEquals(\"text/plain\", httpentity.getContentType().getValue());\n+        Assert.assertEquals(s, EntityUtils.toString(httpentity));\n+        httpentity = new StringEntity(s, (Charset) null);\n+        Assert.assertNotNull(httpentity.getContentType());\n+        Assert.assertEquals(\"text/plain\", httpentity.getContentType().getValue());\n+        Assert.assertEquals(s, EntityUtils.toString(httpentity));\n+        httpentity = new StringEntity(s, (String) null);\n+        Assert.assertNotNull(httpentity.getContentType());\n+        Assert.assertEquals(\"text/plain\", httpentity.getContentType().getValue());\n+        Assert.assertEquals(s, EntityUtils.toString(httpentity));\n+    }\n+\n     @Test\n     public void testWriteTo() throws Exception {\n         String s = \"Message content\";",
                "changes": 33
            }
        ],
        "unit_tests": [
            "TestStringEntity.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "httpcore/src/test/java/org/apache/http/entity/TestStringEntity.java",
        "buggy_files": [
            "RELEASE_NOTES.txt",
            "httpcore/src/main/java/org/apache/http/entity/StringEntity.java"
        ],
        "fixed": true
    }
]