[
    {
        "repo": "sling-org-apache-sling-distribution-journal",
        "message": "SLING-9029 Warning logged by PackageQueuedNotifier if a DistributionPackage does not exist in the callback map (#23)\n\nSLING-9029 - PackageQueuedNotifier throws NPE for packages managed by an other type of agents",
        "commit": "https://github.com/apache/sling-org-apache-sling-distribution-journal/commit/6c1ac9980363ef420591c3f0784e8780b104d3fd",
        "parent": "https://github.com/apache/sling-org-apache-sling-distribution-journal/commit/efa518f39fcadd2aa44c4807908791c86d17520f",
        "bug_id": "sling-org-apache-sling-distribution-journal_1",
        "file": [
            {
                "sha": "8899397411fd2279abb9e0b50cfa5346209f9482",
                "filename": "src/main/java/org/apache/sling/distribution/journal/impl/publisher/PackageQueuedNotifier.java",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-distribution-journal/blob/6c1ac9980363ef420591c3f0784e8780b104d3fd/src/main/java/org/apache/sling/distribution/journal/impl/publisher/PackageQueuedNotifier.java",
                "raw_url": "https://github.com/apache/sling-org-apache-sling-distribution-journal/raw/6c1ac9980363ef420591c3f0784e8780b104d3fd/src/main/java/org/apache/sling/distribution/journal/impl/publisher/PackageQueuedNotifier.java",
                "status": "modified",
                "changes": 5,
                "additions": 4,
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-distribution-journal/contents/src/main/java/org/apache/sling/distribution/journal/impl/publisher/PackageQueuedNotifier.java?ref=6c1ac9980363ef420591c3f0784e8780b104d3fd",
                "patch": "@@ -63,7 +63,10 @@ public void deactivate() {\n     public void handleEvent(Event event) {\n         String packageId = (String) event.getProperty(DistributionEvent.PACKAGE_ID);\n         LOG.debug(\"Handling event for packageId {}\", packageId);\n-        CompletableFuture<Void> callback = receiveCallbacks.remove(packageId);\n+        CompletableFuture<Void> callback = null;\n+        if (packageId != null) {\n+            callback = receiveCallbacks.remove(packageId);\n+        }\n         if (callback != null) {\n             callback.complete(null);\n         }",
                "deletions": 1
            },
            {
                "sha": "2444d2118c1f80a967d58deb82f1f5f42afe2e47",
                "filename": "src/test/java/org/apache/sling/distribution/journal/impl/publisher/PackageQueuedNotifierTest.java",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-distribution-journal/blob/6c1ac9980363ef420591c3f0784e8780b104d3fd/src/test/java/org/apache/sling/distribution/journal/impl/publisher/PackageQueuedNotifierTest.java",
                "raw_url": "https://github.com/apache/sling-org-apache-sling-distribution-journal/raw/6c1ac9980363ef420591c3f0784e8780b104d3fd/src/test/java/org/apache/sling/distribution/journal/impl/publisher/PackageQueuedNotifierTest.java",
                "status": "modified",
                "changes": 17,
                "additions": 16,
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-distribution-journal/contents/src/test/java/org/apache/sling/distribution/journal/impl/publisher/PackageQueuedNotifierTest.java?ref=6c1ac9980363ef420591c3f0784e8780b104d3fd",
                "patch": "@@ -18,17 +18,19 @@\n  */\n package org.apache.sling.distribution.journal.impl.publisher;\n \n+import java.util.HashMap;\n import java.util.concurrent.CompletableFuture;\n import java.util.concurrent.ExecutionException;\n import java.util.concurrent.TimeUnit;\n import java.util.concurrent.TimeoutException;\n \n import org.junit.Assert;\n import org.junit.Test;\n-\n+import org.osgi.service.event.Event;\n import org.apache.sling.distribution.journal.impl.event.DistributionEvent;\n import org.apache.sling.distribution.journal.messages.Messages.PackageMessage;\n import org.apache.sling.distribution.journal.messages.Messages.PackageMessage.ReqType;\n+import static org.apache.sling.distribution.event.DistributionEventTopics.AGENT_PACKAGE_QUEUED;\n \n public class PackageQueuedNotifierTest {\n \n@@ -50,6 +52,19 @@ public void test() throws InterruptedException, ExecutionException, TimeoutExcep\n         arrived.get(1, TimeUnit.SECONDS);\n     }\n \n+    @Test\n+    public void testForNullPackage() throws InterruptedException, ExecutionException, TimeoutException {\n+        notifier = new PackageQueuedNotifier();\n+        CompletableFuture<Void> arrived = notifier.registerWait(\"1\");\n+        notifier.handleEvent(new Event(AGENT_PACKAGE_QUEUED, new HashMap<>()));\n+        try {\n+            arrived.get(100,TimeUnit.MILLISECONDS);\n+            Assert.fail(\"Expected TimeoutException as package ID is null\");\n+        } catch (TimeoutException e) {\n+            // Expected\n+        }\n+    }\n+\n     private PackageMessage pkgMsg(String packageId) {\n         return PackageMessage.newBuilder()\n             .addPaths(\"/test\")",
                "deletions": 1
            }
        ]
    },
    {
        "repo": "sling-org-apache-sling-distribution-journal",
        "message": "GRANITE-26607 - Fix possible NPE",
        "commit": "https://github.com/apache/sling-org-apache-sling-distribution-journal/commit/3a774df36ed4ac974383c22401ba0c22a39c0851",
        "parent": "https://github.com/apache/sling-org-apache-sling-distribution-journal/commit/a64f1b45bfb04bb23aea60c5dc82a297159451ca",
        "bug_id": "sling-org-apache-sling-distribution-journal_2",
        "file": [
            {
                "sha": "401d03898fc86187e9dcb3dbabb28cd7b6e7126b",
                "filename": "src/main/java/org/apache/sling/distribution/journal/impl/subscriber/ContentPackageExtractor.java",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-distribution-journal/blob/3a774df36ed4ac974383c22401ba0c22a39c0851/src/main/java/org/apache/sling/distribution/journal/impl/subscriber/ContentPackageExtractor.java",
                "raw_url": "https://github.com/apache/sling-org-apache-sling-distribution-journal/raw/3a774df36ed4ac974383c22401ba0c22a39c0851/src/main/java/org/apache/sling/distribution/journal/impl/subscriber/ContentPackageExtractor.java",
                "status": "modified",
                "changes": 3,
                "additions": 3,
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-distribution-journal/contents/src/main/java/org/apache/sling/distribution/journal/impl/subscriber/ContentPackageExtractor.java?ref=3a774df36ed4ac974383c22401ba0c22a39c0851",
                "patch": "@@ -87,6 +87,9 @@ private void installPackage(String path, Node node) {\n             Session session = node.getSession();\n             JcrPackageManager packMgr = packageService.getPackageManager(session);\n             try (JcrPackage pack = packMgr.open(node)) {\n+                if (pack == null) {\n+                    return;\n+                }\n                 ImportOptions opts = new ImportOptions();\n                 if (packageHandling == PackageHandling.Extract) {\n                     pack.extract(opts);",
                "deletions": 0
            }
        ]
    }
]