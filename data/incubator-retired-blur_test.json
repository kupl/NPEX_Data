{
    "incubator-retired-blur_146214d": {
        "bug_id": "incubator-retired-blur_146214d",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/146214d9c8d6230a102dddba4455f5c66934260e",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/146214d9c8d6230a102dddba4455f5c66934260e/blur-mapred/src/main/java/org/apache/blur/mapreduce/lib/update/Driver.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-mapred/src/main/java/org/apache/blur/mapreduce/lib/update/Driver.java?ref=146214d9c8d6230a102dddba4455f5c66934260e",
                "deletions": 3,
                "filename": "blur-mapred/src/main/java/org/apache/blur/mapreduce/lib/update/Driver.java",
                "patch": "@@ -105,10 +105,8 @@ public int run(String[] args) throws Exception {\n       inprogressPathList = movePathList(fileSystem, inprogressData, srcPathList);\n \n       Job job = Job.getInstance(getConf(), \"Blur Row Updater for table [\" + table + \"]\");\n-\n-      waitForOtherSnapshotsToBeRemoved(client, table, MRUPDATE_SNAPSHOT);\n-\n       client = BlurClient.getClientFromZooKeeperConnectionStr(blurZkConnection);\n+      waitForOtherSnapshotsToBeRemoved(client, table, MRUPDATE_SNAPSHOT);\n       client.createSnapshot(table, MRUPDATE_SNAPSHOT);\n       TableDescriptor descriptor = client.describe(table);\n       Path tablePath = new Path(descriptor.getTableUri());",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/146214d9c8d6230a102dddba4455f5c66934260e/blur-mapred/src/main/java/org/apache/blur/mapreduce/lib/update/Driver.java",
                "sha": "04cd81ea0e6b26182bbe8cd07c48bc1936424e65",
                "status": "modified"
            }
        ],
        "message": "Fixing another NPE.",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/1985869099fefa12f90ee386a736401e2c4bc04d",
        "patched_files": [
            "Driver.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "DriverTest.java"
        ]
    },
    "incubator-retired-blur_19749a3": {
        "bug_id": "incubator-retired-blur_19749a3",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/19749a390bf29ca799c911cc93a662fd57ad2c6d",
        "file": [
            {
                "additions": 16,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/19749a390bf29ca799c911cc93a662fd57ad2c6d/blur-core/src/main/java/org/apache/blur/server/cache/ThriftCache.java",
                "changes": 32,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-core/src/main/java/org/apache/blur/server/cache/ThriftCache.java?ref=19749a390bf29ca799c911cc93a662fd57ad2c6d",
                "deletions": 16,
                "filename": "blur-core/src/main/java/org/apache/blur/server/cache/ThriftCache.java",
                "patch": "@@ -84,6 +84,22 @@ public ThriftCache(long totalNumberOfBytes) {\n     _hits = Metrics.newMeter(new MetricName(ORG_APACHE_BLUR, THRIFT_CACHE, HIT), HIT, TimeUnit.SECONDS);\n     _misses = Metrics.newMeter(new MetricName(ORG_APACHE_BLUR, THRIFT_CACHE, MISS), MISS, TimeUnit.SECONDS);\n     _evictions = Metrics.newMeter(new MetricName(ORG_APACHE_BLUR, THRIFT_CACHE, EVICTION), EVICTION, TimeUnit.SECONDS);\n+    _cacheMap = new ConcurrentLinkedHashMap.Builder<ThriftCacheKey<?>, ThriftCacheValue<?>>()\n+        .weigher(new EntryWeigher<ThriftCacheKey<?>, ThriftCacheValue<?>>() {\n+          @Override\n+          public int weightOf(ThriftCacheKey<?> key, ThriftCacheValue<?> value) {\n+            return key.size() + value.size();\n+          }\n+        }).listener(new EvictionListener<ThriftCacheKey<?>, ThriftCacheValue<?>>() {\n+          @Override\n+          public void onEviction(ThriftCacheKey<?> key, ThriftCacheValue<?> value) {\n+            _evictions.mark();\n+            _evictionsAtomicLong.incrementAndGet();\n+          }\n+        }).maximumWeightedCapacity(totalNumberOfBytes).build();\n+    _hitsAtomicLong = new AtomicLong();\n+    _missesAtomicLong = new AtomicLong();\n+    _evictionsAtomicLong = new AtomicLong();\n     Metrics.newGauge(new MetricName(ORG_APACHE_BLUR, THRIFT_CACHE, SIZE), new Gauge<Long>() {\n       @Override\n       public Long value() {\n@@ -102,22 +118,6 @@ public Long value() {\n         return (long) _attributeKeys.size();\n       }\n     });\n-    _cacheMap = new ConcurrentLinkedHashMap.Builder<ThriftCacheKey<?>, ThriftCacheValue<?>>()\n-        .weigher(new EntryWeigher<ThriftCacheKey<?>, ThriftCacheValue<?>>() {\n-          @Override\n-          public int weightOf(ThriftCacheKey<?> key, ThriftCacheValue<?> value) {\n-            return key.size() + value.size();\n-          }\n-        }).listener(new EvictionListener<ThriftCacheKey<?>, ThriftCacheValue<?>>() {\n-          @Override\n-          public void onEviction(ThriftCacheKey<?> key, ThriftCacheValue<?> value) {\n-            _evictions.mark();\n-            _evictionsAtomicLong.incrementAndGet();\n-          }\n-        }).maximumWeightedCapacity(totalNumberOfBytes).build();\n-    _hitsAtomicLong = new AtomicLong();\n-    _missesAtomicLong = new AtomicLong();\n-    _evictionsAtomicLong = new AtomicLong();\n   }\n \n   public <K extends TBase<?, ?>, V extends TBase<?, ?>> V put(ThriftCacheKey<K> key, V t) throws BlurException {",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/19749a390bf29ca799c911cc93a662fd57ad2c6d/blur-core/src/main/java/org/apache/blur/server/cache/ThriftCache.java",
                "sha": "382fecd392b972c8d32b4e549d4ad280c74c370b",
                "status": "modified"
            }
        ],
        "message": "Fixing possible NPE for metric when asked for metric before construction of cache map is complete.",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/77e1f4f2f0f73c1e7c392e4453abf0566d868b76",
        "patched_files": [
            "ThriftCache.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "ThriftCacheTest.java"
        ]
    },
    "incubator-retired-blur_1985869": {
        "bug_id": "incubator-retired-blur_1985869",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/1985869099fefa12f90ee386a736401e2c4bc04d",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/1985869099fefa12f90ee386a736401e2c4bc04d/blur-mapred/src/main/java/org/apache/blur/mapreduce/lib/update/Driver.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-mapred/src/main/java/org/apache/blur/mapreduce/lib/update/Driver.java?ref=1985869099fefa12f90ee386a736401e2c4bc04d",
                "deletions": 1,
                "filename": "blur-mapred/src/main/java/org/apache/blur/mapreduce/lib/update/Driver.java",
                "patch": "@@ -144,7 +144,9 @@ public int run(String[] args) throws Exception {\n         LOG.error(\"Indexing job failed!\");\n         movePathList(fileSystem, newData, inprogressPathList);\n       }\n-      client.removeSnapshot(table, MRUPDATE_SNAPSHOT);\n+      if (client != null) {\n+        client.removeSnapshot(table, MRUPDATE_SNAPSHOT);\n+      }\n     }\n \n     if (success) {",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/1985869099fefa12f90ee386a736401e2c4bc04d/blur-mapred/src/main/java/org/apache/blur/mapreduce/lib/update/Driver.java",
                "sha": "7447673a53a8db042091fb2425a1a5d38f1d6cda",
                "status": "modified"
            }
        ],
        "message": "Fixing NPE.",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/1c7aba2619270aa64747f2dae6fc7756e51d382a",
        "patched_files": [
            "Driver.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "DriverTest.java"
        ]
    },
    "incubator-retired-blur_1c7aba2": {
        "bug_id": "incubator-retired-blur_1c7aba2",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/1c7aba2619270aa64747f2dae6fc7756e51d382a",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/1c7aba2619270aa64747f2dae6fc7756e51d382a/blur-query/src/main/java/org/apache/blur/analysis/type/spatial/BaseSpatialFieldTypeDefinition.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-query/src/main/java/org/apache/blur/analysis/type/spatial/BaseSpatialFieldTypeDefinition.java?ref=1c7aba2619270aa64747f2dae6fc7756e51d382a",
                "deletions": 2,
                "filename": "blur-query/src/main/java/org/apache/blur/analysis/type/spatial/BaseSpatialFieldTypeDefinition.java",
                "patch": "@@ -122,9 +122,12 @@ protected Shape getShape(Column column) {\n     return _shapeReadWriter.readShape(column.getValue());\n   }\n \n-  protected SpatialPrefixTree getSpatialPrefixTree(Map<String, String> properties) {\n+  protected SpatialPrefixTree getSpatialPrefixTree(String field, Map<String, String> properties) {\n     String spatialPrefixTreeStr = properties.get(SPATIAL_PREFIX_TREE);\n-    if (spatialPrefixTreeStr.equals(GEOHASH_PREFIX_TREE)) {\n+    if (spatialPrefixTreeStr == null) {\n+      throw new IllegalArgumentException(\"Property [\" + SPATIAL_PREFIX_TREE + \"] is missing from type def for field [\"\n+          + field + \"]\");\n+    } else if (spatialPrefixTreeStr.equals(GEOHASH_PREFIX_TREE)) {\n       int maxLevels = getMaxLevels(properties);\n       return new GeohashPrefixTree(_ctx, maxLevels);\n     } else if (spatialPrefixTreeStr.equals(QUAD_PREFIX_TREE)) {",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/1c7aba2619270aa64747f2dae6fc7756e51d382a/blur-query/src/main/java/org/apache/blur/analysis/type/spatial/BaseSpatialFieldTypeDefinition.java",
                "sha": "2533813b4d66bc0aac3d8dc35808e1a87df4fb8d",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/1c7aba2619270aa64747f2dae6fc7756e51d382a/blur-query/src/main/java/org/apache/blur/analysis/type/spatial/SpatialRecursivePrefixTreeStrategyFieldTypeDefinition.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-query/src/main/java/org/apache/blur/analysis/type/spatial/SpatialRecursivePrefixTreeStrategyFieldTypeDefinition.java?ref=1c7aba2619270aa64747f2dae6fc7756e51d382a",
                "deletions": 1,
                "filename": "blur-query/src/main/java/org/apache/blur/analysis/type/spatial/SpatialRecursivePrefixTreeStrategyFieldTypeDefinition.java",
                "patch": "@@ -52,7 +52,7 @@ public Analyzer getAnalyzerForIndex(String fieldName) {\n   @Override\n   public void configure(String fieldNameForThisInstance, Map<String, String> properties, Configuration configuration) {\n     _ctx = SpatialContext.GEO;\n-    _grid = getSpatialPrefixTree(properties);\n+    _grid = getSpatialPrefixTree(fieldNameForThisInstance, properties);\n     boolean docValue = false;\n     if (properties.get(DOC_VALUE) != null) {\n       docValue = true;",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/1c7aba2619270aa64747f2dae6fc7756e51d382a/blur-query/src/main/java/org/apache/blur/analysis/type/spatial/SpatialRecursivePrefixTreeStrategyFieldTypeDefinition.java",
                "sha": "879cd0d3fe346e7b91adf912ef78111686f41f20",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/1c7aba2619270aa64747f2dae6fc7756e51d382a/blur-query/src/main/java/org/apache/blur/analysis/type/spatial/SpatialTermQueryPrefixTreeStrategyFieldTypeDefinition.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-query/src/main/java/org/apache/blur/analysis/type/spatial/SpatialTermQueryPrefixTreeStrategyFieldTypeDefinition.java?ref=1c7aba2619270aa64747f2dae6fc7756e51d382a",
                "deletions": 1,
                "filename": "blur-query/src/main/java/org/apache/blur/analysis/type/spatial/SpatialTermQueryPrefixTreeStrategyFieldTypeDefinition.java",
                "patch": "@@ -56,7 +56,7 @@ public void configure(String fieldNameForThisInstance, Map<String, String> prope\n     if (properties.get(DOC_VALUE) != null) {\n       docValue = true;\n     }\n-    _grid = getSpatialPrefixTree(properties);\n+    _grid = getSpatialPrefixTree(fieldNameForThisInstance, properties);\n     _strategy = new TermQueryPrefixTreeStrategy(_grid, fieldNameForThisInstance, docValue);\n     _shapeReadWriter = new ShapeReadWriter<SpatialContext>(_ctx);\n     addSupportedIndexedShapes(Point.class);",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/1c7aba2619270aa64747f2dae6fc7756e51d382a/blur-query/src/main/java/org/apache/blur/analysis/type/spatial/SpatialTermQueryPrefixTreeStrategyFieldTypeDefinition.java",
                "sha": "3ad7bf89896208f46cab7033fae40f0fa1df934a",
                "status": "modified"
            }
        ],
        "message": "Adding an error message instead of NPE for missing required argument.  Fixed BLUR-351.",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/47ff43380157b75c0f703d3e482f13e5e2335656",
        "patched_files": [
            "BaseSpatialFieldTypeDefinition.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "BaseSpatialFieldTypeDefinitionTest.java"
        ]
    },
    "incubator-retired-blur_218c773": {
        "bug_id": "incubator-retired-blur_218c773",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/218c773485fa8748f1bd84c4092ca93472241c0c",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/218c773485fa8748f1bd84c4092ca93472241c0c/blur-core/src/main/java/org/apache/blur/utils/ShardUtil.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-core/src/main/java/org/apache/blur/utils/ShardUtil.java?ref=218c773485fa8748f1bd84c4092ca93472241c0c",
                "deletions": 0,
                "filename": "blur-core/src/main/java/org/apache/blur/utils/ShardUtil.java",
                "patch": "@@ -19,6 +19,8 @@\n import org.apache.blur.thrift.generated.Column;\n import org.apache.blur.thrift.generated.Record;\n \n+import com.google.common.base.Strings;\n+\n public class ShardUtil {\n   \n   public static String getShardName(int id) {\n@@ -57,6 +59,9 @@ public static void validateRowIdAndRecord(String rowId, Record record) {\n   }\n \n   public static boolean validate(String s) {\n+    if(Strings.isNullOrEmpty(s)) {\n+      return false;\n+    }\n     int length = s.length();\n     for (int i = 0; i < length; i++) {\n       char c = s.charAt(i);",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/218c773485fa8748f1bd84c4092ca93472241c0c/blur-core/src/main/java/org/apache/blur/utils/ShardUtil.java",
                "sha": "63ab7195ada2cb27dca36a124396b2ce8a835642",
                "status": "modified"
            },
            {
                "additions": 14,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/218c773485fa8748f1bd84c4092ca93472241c0c/blur-core/src/test/java/org/apache/blur/utils/ShardUtilTest.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-core/src/test/java/org/apache/blur/utils/ShardUtilTest.java?ref=218c773485fa8748f1bd84c4092ca93472241c0c",
                "deletions": 0,
                "filename": "blur-core/src/test/java/org/apache/blur/utils/ShardUtilTest.java",
                "patch": "@@ -0,0 +1,14 @@\n+package org.apache.blur.utils;\n+\n+import static org.junit.Assert.*;\n+\n+import org.junit.Test;\n+\n+public class ShardUtilTest {\n+\n+  @Test\n+  public void nullFamilyAndColumnNamesShouldFail() {\n+    assertFalse(\"Null names should fail.\", ShardUtil.validate(null));\n+  }\n+\n+}",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/218c773485fa8748f1bd84c4092ca93472241c0c/blur-core/src/test/java/org/apache/blur/utils/ShardUtilTest.java",
                "sha": "c4812bd39aa81d00da1ec48b879756feb443fab1",
                "status": "added"
            }
        ],
        "message": "fix NPE on bad row/record mutations.",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/7734b86fd5885d6d57cd1cf56e46d742f29792b7",
        "patched_files": [
            "ShardUtil.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "ShardUtilTest.java"
        ]
    },
    "incubator-retired-blur_2da8d8f": {
        "bug_id": "incubator-retired-blur_2da8d8f",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/2da8d8f91c4a02856ee234ba774958cb3d0a08fe",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/2da8d8f91c4a02856ee234ba774958cb3d0a08fe/blur-core/src/main/java/org/apache/blur/manager/writer/BlurIndexSimpleWriter.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-core/src/main/java/org/apache/blur/manager/writer/BlurIndexSimpleWriter.java?ref=2da8d8f91c4a02856ee234ba774958cb3d0a08fe",
                "deletions": 1,
                "filename": "blur-core/src/main/java/org/apache/blur/manager/writer/BlurIndexSimpleWriter.java",
                "patch": "@@ -425,7 +425,9 @@ private Closeable makeCloseable(final BlurIndexWriter blurIndexWriter) {\n     return new Closeable() {\n       @Override\n       public void close() throws IOException {\n-        blurIndexWriter.close(false);\n+        if (blurIndexWriter != null) {\n+          blurIndexWriter.close(false);\n+        }\n       }\n     };\n   }",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/2da8d8f91c4a02856ee234ba774958cb3d0a08fe/blur-core/src/main/java/org/apache/blur/manager/writer/BlurIndexSimpleWriter.java",
                "sha": "21d49419e4f5135e062904771b136c49eee45f63",
                "status": "modified"
            }
        ],
        "message": "Fixing a NPE.",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/0e4e324acf064d6e9cc11e2fb741ad715cb54673",
        "patched_files": [
            "BlurIndexSimpleWriter.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "BlurIndexSimpleWriterTest.java"
        ]
    },
    "incubator-retired-blur_417f392": {
        "bug_id": "incubator-retired-blur_417f392",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/417f39251048ec0a14117824f76c676108009505",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/417f39251048ec0a14117824f76c676108009505/blur-core/src/main/java/org/apache/blur/utils/BlurUtil.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-core/src/main/java/org/apache/blur/utils/BlurUtil.java?ref=417f39251048ec0a14117824f76c676108009505",
                "deletions": 0,
                "filename": "blur-core/src/main/java/org/apache/blur/utils/BlurUtil.java",
                "patch": "@@ -856,6 +856,10 @@ public static int countDocuments(IndexReader reader, Term term) throws IOExcepti\n     if (columnFamiliesToFetch == null || columnFamiliesToFetch.isEmpty()) {\n       return docs;\n     }\n+    Map<String, Set<String>> columnsToFetch = selector.getColumnsToFetch();\n+    if (columnsToFetch != null) {\n+      columnFamiliesToFetch.addAll(columnsToFetch.keySet());\n+    }\n     final Map<String, Integer> familyOrdering = getFamilyOrdering(columnFamiliesToFetch);\n     Collections.sort(docs, new Comparator<Document>() {\n       @Override",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/417f39251048ec0a14117824f76c676108009505/blur-core/src/main/java/org/apache/blur/utils/BlurUtil.java",
                "sha": "da1b0ddc3c3cc9317db37fbb1f259b8a2ff7be6c",
                "status": "modified"
            },
            {
                "additions": 43,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/417f39251048ec0a14117824f76c676108009505/blur-core/src/test/java/org/apache/blur/manager/IndexManagerTest.java",
                "changes": 43,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-core/src/test/java/org/apache/blur/manager/IndexManagerTest.java?ref=417f39251048ec0a14117824f76c676108009505",
                "deletions": 0,
                "filename": "blur-core/src/test/java/org/apache/blur/manager/IndexManagerTest.java",
                "patch": "@@ -40,6 +40,7 @@\n import java.io.IOException;\n import java.util.ArrayList;\n import java.util.Arrays;\n+import java.util.HashSet;\n import java.util.List;\n import java.util.Random;\n import java.util.UUID;\n@@ -595,6 +596,48 @@ public void testFetchRowByRowId() throws Exception {\n     assertEquals(row, fetchResult.rowResult.row);\n   }\n \n+  @Test\n+  public void testFetchRowByRowIdWithFamilySet() throws Exception {\n+    Selector selector = new Selector().setRowId(\"row-6\");\n+    selector.addToColumnFamiliesToFetch(FAMILY2);\n+    FetchResult fetchResult = new FetchResult();\n+    indexManager.fetchRow(TABLE, selector, fetchResult);\n+    assertNotNull(fetchResult.rowResult.row);\n+    Row row = newRow(\"row-6\", newRecord(FAMILY2, \"record-6C\", newColumn(\"testcol18\", \"value501\")));\n+    row.recordCount = 1;\n+    assertEquals(row, fetchResult.rowResult.row);\n+  }\n+\n+  @Test\n+  public void testFetchRowByRowIdWithColumnSet() throws Exception {\n+    Selector selector = new Selector().setRowId(\"row-6\");\n+    selector.putToColumnsToFetch(FAMILY, new HashSet<String>(Arrays.asList(\"testcol12\")));\n+\n+    FetchResult fetchResult = new FetchResult();\n+    indexManager.fetchRow(TABLE, selector, fetchResult);\n+    assertNotNull(fetchResult.rowResult.row);\n+    Row row = newRow(\"row-6\", newRecord(FAMILY, \"record-6A\", newColumn(\"testcol12\", \"value110\")),\n+        newRecord(FAMILY, \"record-6B\", newColumn(\"testcol12\", \"value101\")));\n+    row.recordCount = 2;\n+    assertEquals(row, fetchResult.rowResult.row);\n+  }\n+\n+  @Test\n+  public void testFetchRowByRowIdWithFamilyAndColumnSet() throws Exception {\n+    Selector selector = new Selector().setRowId(\"row-6\");\n+    selector.addToColumnFamiliesToFetch(FAMILY2);\n+    selector.putToColumnsToFetch(FAMILY, new HashSet<String>(Arrays.asList(\"testcol12\")));\n+\n+    FetchResult fetchResult = new FetchResult();\n+    indexManager.fetchRow(TABLE, selector, fetchResult);\n+    assertNotNull(fetchResult.rowResult.row);\n+    Row row = newRow(\"row-6\", newRecord(FAMILY2, \"record-6C\", newColumn(\"testcol18\", \"value501\")),\n+        newRecord(FAMILY, \"record-6A\", newColumn(\"testcol12\", \"value110\")),\n+        newRecord(FAMILY, \"record-6B\", newColumn(\"testcol12\", \"value101\")));\n+    row.recordCount = 3;\n+    assertEquals(row, fetchResult.rowResult.row);\n+  }\n+\n   @Test\n   public void testFetchRowByRowIdWithFilter() throws Exception {\n     IndexManagerTestReadInterceptor.interceptor = new ReadInterceptor(null) {",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/417f39251048ec0a14117824f76c676108009505/blur-core/src/test/java/org/apache/blur/manager/IndexManagerTest.java",
                "sha": "e805930a814ff15950ca0aa5939ebcac945a6761",
                "status": "modified"
            }
        ],
        "message": "Fixed a NPE in the fetching of a row with both columns to fetch and families to fetch being used with different families.",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/2498bcb9154eab4bb044cd2f19c908e272e9071d",
        "patched_files": [
            "IndexManager.java",
            "BlurUtil.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "IndexManagerTest.java"
        ]
    },
    "incubator-retired-blur_500114e": {
        "bug_id": "incubator-retired-blur_500114e",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/500114e6d2331d7f34b7ad6513280b0920638168",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/500114e6d2331d7f34b7ad6513280b0920638168/src/blur-core/src/main/java/org/apache/blur/manager/IndexManager.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/src/blur-core/src/main/java/org/apache/blur/manager/IndexManager.java?ref=500114e6d2331d7f34b7ad6513280b0920638168",
                "deletions": 3,
                "filename": "src/blur-core/src/main/java/org/apache/blur/manager/IndexManager.java",
                "patch": "@@ -106,7 +106,6 @@\n import org.apache.lucene.search.TopDocs;\n import org.apache.lucene.util.ReaderUtil;\n \n-\n public class IndexManager {\n \n   private static final String NOT_FOUND = \"NOT_FOUND\";\n@@ -123,7 +122,6 @@\n   private BlurMetrics _blurMetrics;\n   private QueryMetrics _queryMetrics;\n   private long _defaultParallelCallTimeout = TimeUnit.MINUTES.toMillis(1);\n-  \n \n   public void setMaxClauseCount(int maxClauseCount) {\n     BooleanQuery.setMaxClauseCount(maxClauseCount);\n@@ -867,7 +865,9 @@ private void doUpdateRowMutation(RowMutation mutation, BlurIndex blurIndex) thro\n       long s = System.nanoTime();\n       // Finally, replace the existing row with the new row we have built.\n       blurIndex.replaceRow(mutation.waitToBeVisible, mutation.wal, newRow);\n-      _queryMetrics.recordDataMutate(System.nanoTime() - s, newRow.records.size());\n+      if (newRow != null && newRow.records != null) {\n+        _queryMetrics.recordDataMutate(System.nanoTime() - s, newRow.records.size());\n+      }\n     } else {\n       throw new BException(\"Mutation cannot update row that does not exist.\", mutation);\n     }",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/500114e6d2331d7f34b7ad6513280b0920638168/src/blur-core/src/main/java/org/apache/blur/manager/IndexManager.java",
                "sha": "725174a93e4f1923b37b2018475908c29daab9ec",
                "status": "modified"
            }
        ],
        "message": "Fixed NPE.",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/6d05a5e8f8acd20409a4ceadbd03c40a331d6704",
        "patched_files": [
            "IndexManager.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "IndexManagerTest.java"
        ]
    },
    "incubator-retired-blur_7734b86": {
        "bug_id": "incubator-retired-blur_7734b86",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/7734b86fd5885d6d57cd1cf56e46d742f29792b7",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/7734b86fd5885d6d57cd1cf56e46d742f29792b7/blur-core/src/main/java/org/apache/blur/manager/clusterstatus/ZookeeperClusterStatus.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-core/src/main/java/org/apache/blur/manager/clusterstatus/ZookeeperClusterStatus.java?ref=7734b86fd5885d6d57cd1cf56e46d742f29792b7",
                "deletions": 1,
                "filename": "blur-core/src/main/java/org/apache/blur/manager/clusterstatus/ZookeeperClusterStatus.java",
                "patch": "@@ -609,7 +609,10 @@ private void assignTableUri(TableDescriptor tableDescriptor) {\n \n   private void assignMapReduceWorkingPath(TableDescriptor tableDescriptor) throws IOException {\n     Map<String, String> tableProperties = tableDescriptor.getTableProperties();\n-    String mrIncWorkingPathStr = tableProperties.get(BlurConstants.BLUR_BULK_UPDATE_WORKING_PATH);\n+    String mrIncWorkingPathStr = null;\n+    if (tableProperties != null) {\n+      mrIncWorkingPathStr = tableProperties.get(BlurConstants.BLUR_BULK_UPDATE_WORKING_PATH);\n+    }\n     if (mrIncWorkingPathStr == null) {\n       // If not set on the table, try to use cluster default\n       mrIncWorkingPathStr = _configuration.get(BlurConstants.BLUR_BULK_UPDATE_WORKING_PATH);",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/7734b86fd5885d6d57cd1cf56e46d742f29792b7/blur-core/src/main/java/org/apache/blur/manager/clusterstatus/ZookeeperClusterStatus.java",
                "sha": "7ae57610c41b7ee96e1e5a55480fdcee5b43a437",
                "status": "modified"
            }
        ],
        "message": "Fixing a NPE.",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/582eaa854f87840315b63c7b058e6dcd7d2078cd",
        "patched_files": [
            "ZookeeperClusterStatus.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "ZookeeperClusterStatusTest.java"
        ]
    },
    "incubator-retired-blur_7ef345f": {
        "bug_id": "incubator-retired-blur_7ef345f",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/7ef345f8f01e459435e5b1302754ce12dbe10d0f",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/7ef345f8f01e459435e5b1302754ce12dbe10d0f/blur-store/src/main/java/org/apache/blur/store/blockcache/BlockCache.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-store/src/main/java/org/apache/blur/store/blockcache/BlockCache.java?ref=7ef345f8f01e459435e5b1302754ce12dbe10d0f",
                "deletions": 0,
                "filename": "blur-store/src/main/java/org/apache/blur/store/blockcache/BlockCache.java",
                "patch": "@@ -262,6 +262,9 @@ private ByteBuffer getSlab(int slabId) {\n   }\n \n   public int getSize() {\n+    if (_cache == null) {\n+      return 0;\n+    }\n     return _cache.size();\n   }\n ",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/7ef345f8f01e459435e5b1302754ce12dbe10d0f/blur-store/src/main/java/org/apache/blur/store/blockcache/BlockCache.java",
                "sha": "4597ffac95b693fa2d8897bf043221e022fbefae",
                "status": "modified"
            }
        ],
        "message": "Hit a bug during startup that caused a NPE.",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/be55844a7047c2a1a8026576202956f915321405",
        "patched_files": [
            "BlockCache.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "BlockCacheTest.java"
        ]
    },
    "incubator-retired-blur_9b83279": {
        "bug_id": "incubator-retired-blur_9b83279",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/9b832793b4d06ce165f0066ac62fb619d3ccaacb",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/9b832793b4d06ce165f0066ac62fb619d3ccaacb/blur-core/src/main/java/org/apache/blur/manager/writer/BlurIndexSimpleWriter.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-core/src/main/java/org/apache/blur/manager/writer/BlurIndexSimpleWriter.java?ref=9b832793b4d06ce165f0066ac62fb619d3ccaacb",
                "deletions": 2,
                "filename": "blur-core/src/main/java/org/apache/blur/manager/writer/BlurIndexSimpleWriter.java",
                "patch": "@@ -663,8 +663,10 @@ public boolean accept(Path path) {\n     }\n \n     public void cleanupFiles(List<Path> unsortedPaths, Path sorted) throws IOException {\n-      for (Path p : unsortedPaths) {\n-        _fileSystem.delete(p, false);\n+      if (unsortedPaths != null) {\n+        for (Path p : unsortedPaths) {\n+          _fileSystem.delete(p, false);\n+        }\n       }\n       if (sorted != null) {\n         _fileSystem.delete(sorted, false);",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/9b832793b4d06ce165f0066ac62fb619d3ccaacb/blur-core/src/main/java/org/apache/blur/manager/writer/BlurIndexSimpleWriter.java",
                "sha": "975022a4486f3b040896a13f4a265c94fc8c425f",
                "status": "modified"
            }
        ],
        "message": "Fixing NPE.",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/b4dfa04f57db095cbeec526577825cacd792df85",
        "patched_files": [
            "BlurIndexSimpleWriter.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "BlurIndexSimpleWriterTest.java"
        ]
    },
    "incubator-retired-blur_ae31413": {
        "bug_id": "incubator-retired-blur_ae31413",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/ae3141357d358f8423b7449611644acee96a7ede",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/ae3141357d358f8423b7449611644acee96a7ede/blur-core/src/main/java/org/apache/blur/utils/BlurUtil.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-core/src/main/java/org/apache/blur/utils/BlurUtil.java?ref=ae3141357d358f8423b7449611644acee96a7ede",
                "deletions": 0,
                "filename": "blur-core/src/main/java/org/apache/blur/utils/BlurUtil.java",
                "patch": "@@ -856,6 +856,10 @@ public static int countDocuments(IndexReader reader, Term term) throws IOExcepti\n     if (columnFamiliesToFetch == null || columnFamiliesToFetch.isEmpty()) {\n       return docs;\n     }\n+    Map<String, Set<String>> columnsToFetch = selector.getColumnsToFetch();\n+    if (columnsToFetch != null) {\n+      columnFamiliesToFetch.addAll(columnsToFetch.keySet());\n+    }\n     final Map<String, Integer> familyOrdering = getFamilyOrdering(columnFamiliesToFetch);\n     Collections.sort(docs, new Comparator<Document>() {\n       @Override",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/ae3141357d358f8423b7449611644acee96a7ede/blur-core/src/main/java/org/apache/blur/utils/BlurUtil.java",
                "sha": "da1b0ddc3c3cc9317db37fbb1f259b8a2ff7be6c",
                "status": "modified"
            },
            {
                "additions": 43,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/ae3141357d358f8423b7449611644acee96a7ede/blur-core/src/test/java/org/apache/blur/manager/IndexManagerTest.java",
                "changes": 43,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-core/src/test/java/org/apache/blur/manager/IndexManagerTest.java?ref=ae3141357d358f8423b7449611644acee96a7ede",
                "deletions": 0,
                "filename": "blur-core/src/test/java/org/apache/blur/manager/IndexManagerTest.java",
                "patch": "@@ -40,6 +40,7 @@\n import java.io.IOException;\n import java.util.ArrayList;\n import java.util.Arrays;\n+import java.util.HashSet;\n import java.util.List;\n import java.util.Random;\n import java.util.UUID;\n@@ -595,6 +596,48 @@ public void testFetchRowByRowId() throws Exception {\n     assertEquals(row, fetchResult.rowResult.row);\n   }\n \n+  @Test\n+  public void testFetchRowByRowIdWithFamilySet() throws Exception {\n+    Selector selector = new Selector().setRowId(\"row-6\");\n+    selector.addToColumnFamiliesToFetch(FAMILY2);\n+    FetchResult fetchResult = new FetchResult();\n+    indexManager.fetchRow(TABLE, selector, fetchResult);\n+    assertNotNull(fetchResult.rowResult.row);\n+    Row row = newRow(\"row-6\", newRecord(FAMILY2, \"record-6C\", newColumn(\"testcol18\", \"value501\")));\n+    row.recordCount = 1;\n+    assertEquals(row, fetchResult.rowResult.row);\n+  }\n+\n+  @Test\n+  public void testFetchRowByRowIdWithColumnSet() throws Exception {\n+    Selector selector = new Selector().setRowId(\"row-6\");\n+    selector.putToColumnsToFetch(FAMILY, new HashSet<String>(Arrays.asList(\"testcol12\")));\n+\n+    FetchResult fetchResult = new FetchResult();\n+    indexManager.fetchRow(TABLE, selector, fetchResult);\n+    assertNotNull(fetchResult.rowResult.row);\n+    Row row = newRow(\"row-6\", newRecord(FAMILY, \"record-6A\", newColumn(\"testcol12\", \"value110\")),\n+        newRecord(FAMILY, \"record-6B\", newColumn(\"testcol12\", \"value101\")));\n+    row.recordCount = 2;\n+    assertEquals(row, fetchResult.rowResult.row);\n+  }\n+\n+  @Test\n+  public void testFetchRowByRowIdWithFamilyAndColumnSet() throws Exception {\n+    Selector selector = new Selector().setRowId(\"row-6\");\n+    selector.addToColumnFamiliesToFetch(FAMILY2);\n+    selector.putToColumnsToFetch(FAMILY, new HashSet<String>(Arrays.asList(\"testcol12\")));\n+\n+    FetchResult fetchResult = new FetchResult();\n+    indexManager.fetchRow(TABLE, selector, fetchResult);\n+    assertNotNull(fetchResult.rowResult.row);\n+    Row row = newRow(\"row-6\", newRecord(FAMILY2, \"record-6C\", newColumn(\"testcol18\", \"value501\")),\n+        newRecord(FAMILY, \"record-6A\", newColumn(\"testcol12\", \"value110\")),\n+        newRecord(FAMILY, \"record-6B\", newColumn(\"testcol12\", \"value101\")));\n+    row.recordCount = 3;\n+    assertEquals(row, fetchResult.rowResult.row);\n+  }\n+\n   @Test\n   public void testFetchRowByRowIdWithFilter() throws Exception {\n     IndexManagerTestReadInterceptor.interceptor = new ReadInterceptor(null) {",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/ae3141357d358f8423b7449611644acee96a7ede/blur-core/src/test/java/org/apache/blur/manager/IndexManagerTest.java",
                "sha": "e805930a814ff15950ca0aa5939ebcac945a6761",
                "status": "modified"
            }
        ],
        "message": "Fixed a NPE in the fetching of a row with both columns to fetch and families to fetch being used with different families.",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/d72ce236fdfae218bc113652b87e30df0b28643d",
        "patched_files": [
            "IndexManager.java",
            "BlurUtil.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "IndexManagerTest.java"
        ]
    },
    "incubator-retired-blur_c7385fb": {
        "bug_id": "incubator-retired-blur_c7385fb",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/c7385fb29de3d0f553c458336b01c6709d80e605",
        "file": [
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/c7385fb29de3d0f553c458336b01c6709d80e605/blur-query/src/main/java/org/apache/blur/analysis/HdfsFieldManager.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-query/src/main/java/org/apache/blur/analysis/HdfsFieldManager.java?ref=c7385fb29de3d0f553c458336b01c6709d80e605",
                "deletions": 3,
                "filename": "blur-query/src/main/java/org/apache/blur/analysis/HdfsFieldManager.java",
                "patch": "@@ -38,6 +38,8 @@\n \n public class HdfsFieldManager extends BaseFieldManager {\n \n+  private static final List<String> EMPTY_LIST = new ArrayList<String>();\n+\n   public static abstract class Lock {\n \n     public abstract void lock();\n@@ -86,14 +88,20 @@ public HdfsFieldManager(String fieldLessField, Analyzer defaultAnalyzerForQueryi\n     _configuration = configuration;\n     _fileSystem = _storagePath.getFileSystem(_configuration);\n   }\n-  \n+\n   @Override\n   protected List<String> getFieldNamesToLoad() throws IOException {\n+    if (!_fileSystem.exists(_storagePath)) {\n+      return EMPTY_LIST;\n+    }\n     FileStatus[] listStatus = _fileSystem.listStatus(_storagePath);\n-    List<String> fieldNames = new ArrayList<String>();\n+    if (listStatus == null) {\n+      return EMPTY_LIST;\n+    }\n+    List<String> fieldNames = EMPTY_LIST;\n     for (FileStatus fileStatus : listStatus) {\n       if (!fileStatus.isDir()) {\n-        fieldNames.add(fileStatus.getPath().getName());  \n+        fieldNames.add(fileStatus.getPath().getName());\n       }\n     }\n     return fieldNames;",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/c7385fb29de3d0f553c458336b01c6709d80e605/blur-query/src/main/java/org/apache/blur/analysis/HdfsFieldManager.java",
                "sha": "70f6c3c05179c9274c87191aecc8e5918249f879",
                "status": "modified"
            }
        ],
        "message": "Fixed NPE.",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/510de9917c1db85a2c573c15de0c2612691f7f22",
        "patched_files": [
            "HdfsFieldManager.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "HdfsFieldManagerTest.java"
        ]
    },
    "incubator-retired-blur_ce7fecc": {
        "bug_id": "incubator-retired-blur_ce7fecc",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/ce7fecc5dcb45caed939acec8c0a6835db2b9bcb",
        "file": [
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/ce7fecc5dcb45caed939acec8c0a6835db2b9bcb/blur-core/src/main/java/org/apache/blur/manager/IndexManager.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-core/src/main/java/org/apache/blur/manager/IndexManager.java?ref=ce7fecc5dcb45caed939acec8c0a6835db2b9bcb",
                "deletions": 4,
                "filename": "blur-core/src/main/java/org/apache/blur/manager/IndexManager.java",
                "patch": "@@ -111,6 +111,7 @@\n import org.apache.lucene.index.Term;\n import org.apache.lucene.index.Terms;\n import org.apache.lucene.index.TermsEnum;\n+import org.apache.lucene.index.TermsEnum.SeekStatus;\n import org.apache.lucene.queries.BooleanFilter;\n import org.apache.lucene.queryparser.classic.ParseException;\n import org.apache.lucene.search.BooleanClause.Occur;\n@@ -1013,15 +1014,18 @@ public static long recordFrequency(IndexReader reader, String columnFamily, Stri\n     List<String> terms = new ArrayList<String>(size);\n     AtomicReader areader = BlurUtil.getAtomicReader(reader);\n     Terms termsAll = areader.terms(term.field());\n-\n+    \n     if (termsAll == null) {\n       return terms;\n     }\n \n     TermsEnum termEnum = termsAll.iterator(null);\n-\n-    termEnum.seekCeil(term.bytes());\n-\n+    SeekStatus status = termEnum.seekCeil(term.bytes());\n+    \n+    if (status == SeekStatus.END) {\n+      return terms;\n+    }\n+    \n     BytesRef currentTermText = termEnum.term();\n     do {\n       terms.add(currentTermText.utf8ToString());",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/ce7fecc5dcb45caed939acec8c0a6835db2b9bcb/blur-core/src/main/java/org/apache/blur/manager/IndexManager.java",
                "sha": "0fad37410e284b4a52d23f4d56926a5bc6d76334",
                "status": "modified"
            },
            {
                "additions": 53,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/ce7fecc5dcb45caed939acec8c0a6835db2b9bcb/blur-core/src/test/java/org/apache/blur/thrift/TermsTests.java",
                "changes": 54,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-core/src/test/java/org/apache/blur/thrift/TermsTests.java?ref=ce7fecc5dcb45caed939acec8c0a6835db2b9bcb",
                "deletions": 1,
                "filename": "blur-core/src/test/java/org/apache/blur/thrift/TermsTests.java",
                "patch": "@@ -16,6 +16,7 @@\n  * limitations under the License.\n  */\n import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n \n import java.io.IOException;\n import java.util.List;\n@@ -27,7 +28,7 @@\n import com.google.common.collect.Lists;\n \n public class TermsTests extends BaseClusterTest {\n-\n+  \n   @Test\n   public void testTermsList() throws BlurException, TException, IOException, InterruptedException {\n     final String tableName = \"testTermsList\";\n@@ -39,6 +40,57 @@ public void testTermsList() throws BlurException, TException, IOException, Inter\n     \n     assertEquals(list, terms);\n   }\n+  \n+  @Test\n+  public void shouldBeAbleToSkipToTerms() throws Exception {\n+    final String tableName = \"shouldBeAbleToNavigateTerms\";\n+    TableGen.define(tableName)\n+      .cols(\"test\", \"col1\")\n+      .addRecord(\"1\",\"1\", \"aaa\")\n+      .addRecord(\"2\",\"2\", \"bbb\")\n+      .addRecord(\"3\",\"3\", \"ccc\")\n+      .addRecord(\"4\",\"4\", \"ddd\")\n+      .build(getClient());\n+    \n+    List<String> terms = getClient().terms(tableName, \"test\", \"col1\", \"c\", (short)10);\n+    List<String> expected = Lists.newArrayList(\"ccc\", \"ddd\");\n+    \n+    assertEquals(expected, terms);\n+  }\n+  \n+  @Test\n+  public void shouldOnlyReturnNumberOfTermsRequested() throws Exception {\n+    final String tableName = \"shouldOnlyReturnNumberOfTermsRequested\";\n+    TableGen.define(tableName)\n+      .cols(\"test\", \"col1\")\n+      .addRecord(\"1\",\"1\", \"aaa\")\n+      .addRecord(\"2\",\"2\", \"bbb\")\n+      .addRecord(\"3\",\"3\", \"ccc\")\n+      .addRecord(\"4\",\"4\", \"ddd\")\n+      .build(getClient());\n+    \n+    List<String> terms = getClient().terms(tableName, \"test\", \"col1\", \"c\", (short)1);\n+    List<String> expected = Lists.newArrayList(\"ccc\");\n+    \n+    assertEquals(expected, terms);\n+  }\n+  \n+  @Test\n+  public void shouldGetEmptyListForNonExistentTerms() throws Exception {\n+    final String tableName = \"shouldGetEmptyListForNonExistantTerms\";\n+    TableGen.define(tableName)\n+      .cols(\"test\", \"col1\")\n+      .addRecord(\"1\",\"1\", \"aaa\")\n+      .addRecord(\"2\",\"2\", \"bbb\")\n+      .addRecord(\"3\",\"3\", \"ccc\")\n+      .addRecord(\"4\",\"4\", \"ddd\")\n+      .build(getClient());\n+    \n+    List<String> terms = getClient().terms(tableName, \"test\", \"col1\", \"z\", (short)1);\n+    assertNotNull(terms);\n+    assertEquals(0, terms.size());\n+  }\n+  \n   @Test(expected=BlurException.class)\n   public void termsShouldFailOnUnknownTable() throws BlurException, TException {\n     getClient().terms(\"termsShouldFailOnUnknownTable\", \"test\",\"col1\", null, (short)10);",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/ce7fecc5dcb45caed939acec8c0a6835db2b9bcb/blur-core/src/test/java/org/apache/blur/thrift/TermsTests.java",
                "sha": "ae906fef3f2d67f28d3dd5d824d6ee89f0e80bc2",
                "status": "modified"
            }
        ],
        "message": "Add some more terms coverage; fix NPE when terms is called with a startsWith value that doesn't exist",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/dc0bb7ccbd651503cb7b29da98aee45f0e179a51",
        "patched_files": [
            "IndexManager.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "IndexManagerTest.java"
        ]
    },
    "incubator-retired-blur_d9ebd44": {
        "bug_id": "incubator-retired-blur_d9ebd44",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865/blur-store/src/main/java/org/apache/blur/store/blockcache_v2/BaseCache.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-store/src/main/java/org/apache/blur/store/blockcache_v2/BaseCache.java?ref=d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865",
                "deletions": 1,
                "filename": "blur-store/src/main/java/org/apache/blur/store/blockcache_v2/BaseCache.java",
                "patch": "@@ -74,7 +74,11 @@ public void onEviction(CacheKey key, CacheValue value) {\n   class BaseCacheWeigher implements Weigher<CacheValue> {\n     @Override\n     public int weightOf(CacheValue value) {\n-      return value.length();\n+      try {\n+        return value.length();\n+      } catch (EvictionException e) {\n+        return 0;\n+      }\n     }\n   }\n ",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865/blur-store/src/main/java/org/apache/blur/store/blockcache_v2/BaseCache.java",
                "sha": "d98637bc7291e913c7059c16af7e792e92741fc2",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865/blur-store/src/main/java/org/apache/blur/store/blockcache_v2/CacheIndexInput.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-store/src/main/java/org/apache/blur/store/blockcache_v2/CacheIndexInput.java?ref=d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865",
                "deletions": 1,
                "filename": "blur-store/src/main/java/org/apache/blur/store/blockcache_v2/CacheIndexInput.java",
                "patch": "@@ -364,7 +364,11 @@ private byte readByteFromCache() throws EvictionException {\n   }\n \n   private int remaining() {\n-    return _cacheValue.length() - _blockPosition;\n+    try {\n+      return _cacheValue.length() - _blockPosition;\n+    } catch (EvictionException e) {\n+      return 0;\n+    }\n   }\n \n   private void tryToFill() throws IOException {",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865/blur-store/src/main/java/org/apache/blur/store/blockcache_v2/CacheIndexInput.java",
                "sha": "dfdbccceaeb9f88826262aa6294b2c6b53eecdf4",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865/blur-store/src/main/java/org/apache/blur/store/blockcache_v2/CacheValue.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-store/src/main/java/org/apache/blur/store/blockcache_v2/CacheValue.java?ref=d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865",
                "deletions": 1,
                "filename": "blur-store/src/main/java/org/apache/blur/store/blockcache_v2/CacheValue.java",
                "patch": "@@ -32,8 +32,9 @@\n    * The length of the data in this block.\n    * \n    * @return the length.\n+   * @throws EvictionException \n    */\n-  int length();\n+  int length() throws EvictionException;\n \n   /**\n    * Writes data out to a given position in this block.",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865/blur-store/src/main/java/org/apache/blur/store/blockcache_v2/CacheValue.java",
                "sha": "2d5c567eacb686e058dea325932357806d9a8149",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865/blur-store/src/main/java/org/apache/blur/store/blockcache_v2/CacheValueBufferPool.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-store/src/main/java/org/apache/blur/store/blockcache_v2/CacheValueBufferPool.java?ref=d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865",
                "deletions": 5,
                "filename": "blur-store/src/main/java/org/apache/blur/store/blockcache_v2/CacheValueBufferPool.java",
                "patch": "@@ -91,13 +91,17 @@ private CacheValue createCacheValue(int cacheBlockSize) {\n   }\n \n   public void returnToPool(CacheValue cacheValue) {\n-    if (cacheValue == null) {\n+    if (cacheValue == null || cacheValue.isEvicted()) {\n       return;\n     }\n-    BlockingQueue<CacheValue> blockingQueue = getPool(cacheValue.length());\n-    if (!blockingQueue.offer(cacheValue)) {\n-      _detroyed.mark();\n-      cacheValue.release();\n+    try {\n+      BlockingQueue<CacheValue> blockingQueue = getPool(cacheValue.length());\n+      if (!blockingQueue.offer(cacheValue)) {\n+        _detroyed.mark();\n+        cacheValue.release();\n+      }\n+    } catch (EvictionException e) {\n+      return;\n     }\n   }\n ",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865/blur-store/src/main/java/org/apache/blur/store/blockcache_v2/CacheValueBufferPool.java",
                "sha": "968edab4f58373aba50eeaa277cc673e1fde57d3",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865/blur-store/src/main/java/org/apache/blur/store/blockcache_v2/cachevalue/DetachableCacheValue.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-store/src/main/java/org/apache/blur/store/blockcache_v2/cachevalue/DetachableCacheValue.java?ref=d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865",
                "deletions": 1,
                "filename": "blur-store/src/main/java/org/apache/blur/store/blockcache_v2/cachevalue/DetachableCacheValue.java",
                "patch": "@@ -63,7 +63,8 @@ public CacheValue detachFromCache() {\n   }\n \n   @Override\n-  public int length() {\n+  public int length() throws EvictionException {\n+    checkEviction();\n     return _baseCacheValue.length();\n   }\n ",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865/blur-store/src/main/java/org/apache/blur/store/blockcache_v2/cachevalue/DetachableCacheValue.java",
                "sha": "e5ce99d6f8ee72f69467f050e632a9f0def51778",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865/blur-store/src/test/java/org/apache/blur/store/blockcache_v2/CacheIndexInputTest.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-store/src/test/java/org/apache/blur/store/blockcache_v2/CacheIndexInputTest.java?ref=d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865",
                "deletions": 1,
                "filename": "blur-store/src/test/java/org/apache/blur/store/blockcache_v2/CacheIndexInputTest.java",
                "patch": "@@ -184,7 +184,11 @@ public void onEviction(CacheKey key, CacheValue value) {\n     Weigher<CacheValue> weigher = new Weigher<CacheValue>() {\n       @Override\n       public int weightOf(CacheValue value) {\n-        return value.length();\n+        try {\n+          return value.length();\n+        } catch (EvictionException e) {\n+          return 0;\n+        }\n       }\n     };\n     long maximumWeightedCapacity = 1 * 1024 * 1024;",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/d9ebd44f0d4dd5b9c3cacef0fbe0cddae271e865/blur-store/src/test/java/org/apache/blur/store/blockcache_v2/CacheIndexInputTest.java",
                "sha": "a87f28f87b32db963212087cfc310d142b70f2f9",
                "status": "modified"
            }
        ],
        "message": "Fixing a NPE when accessing the length of a evicted detachable cache value.",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/87f6fa5d84e6fb8ea9008619407769435c7075b9",
        "patched_files": [
            "CacheValue.java",
            "BaseCache.java",
            "DetachableCacheValue.java",
            "CacheValueBufferPool.java",
            "CacheIndexInput.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "CacheIndexInputTest.java"
        ]
    },
    "incubator-retired-blur_ebce22d": {
        "bug_id": "incubator-retired-blur_ebce22d",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/ebce22d9c57bbe3f0558100f19c23e3306cc0cc2",
        "file": [
            {
                "additions": 24,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/ebce22d9c57bbe3f0558100f19c23e3306cc0cc2/blur-core/src/main/java/org/apache/blur/manager/IndexManager.java",
                "changes": 40,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-core/src/main/java/org/apache/blur/manager/IndexManager.java?ref=ebce22d9c57bbe3f0558100f19c23e3306cc0cc2",
                "deletions": 16,
                "filename": "blur-core/src/main/java/org/apache/blur/manager/IndexManager.java",
                "patch": "@@ -154,11 +154,13 @@ public void setMaxClauseCount(int maxClauseCount) {\n   }\n \n   public void init() {\n-    _readRecordsMeter = Metrics.newMeter(new MetricName(ORG_APACHE_BLUR, BLUR, \"Read Records/s\"), \"Records/s\", TimeUnit.SECONDS);\n+    _readRecordsMeter = Metrics.newMeter(new MetricName(ORG_APACHE_BLUR, BLUR, \"Read Records/s\"), \"Records/s\",\n+        TimeUnit.SECONDS);\n     _readRowMeter = Metrics.newMeter(new MetricName(ORG_APACHE_BLUR, BLUR, \"Read Row/s\"), \"Row/s\", TimeUnit.SECONDS);\n-    _writeRecordsMeter = Metrics.newMeter(new MetricName(ORG_APACHE_BLUR, BLUR, \"Write Records/s\"), \"Records/s\", TimeUnit.SECONDS);\n+    _writeRecordsMeter = Metrics.newMeter(new MetricName(ORG_APACHE_BLUR, BLUR, \"Write Records/s\"), \"Records/s\",\n+        TimeUnit.SECONDS);\n     _writeRowMeter = Metrics.newMeter(new MetricName(ORG_APACHE_BLUR, BLUR, \"Write Row/s\"), \"Row/s\", TimeUnit.SECONDS);\n-    \n+\n     _queriesExternalMeter = Metrics.newMeter(new MetricName(ORG_APACHE_BLUR, BLUR, \"External Queries/s\"),\n         \"External Queries/s\", TimeUnit.SECONDS);\n     _queriesInternalMeter = Metrics.newMeter(new MetricName(ORG_APACHE_BLUR, BLUR, \"Internal Queries/s\"),\n@@ -204,13 +206,15 @@ public void fetchRow(String table, Selector selector, FetchResult fetchResult) t\n       Map<String, BlurIndex> blurIndexes = _indexServer.getIndexes(table);\n       if (blurIndexes == null) {\n         LOG.error(\"Table [{0}] not found\", table);\n-        //@TODO probably should make a enum for not found on this server so the controller knows to try another server.\n+        // @TODO probably should make a enum for not found on this server so the\n+        // controller knows to try another server.\n         throw new BException(\"Table [\" + table + \"] not found\");\n       }\n       index = blurIndexes.get(shard);\n       if (index == null) {\n         LOG.error(\"Shard [{0}] not found in table [{1}]\", shard, table);\n-        //@TODO probably should make a enum for not found on this server so the controller knows to try another server.\n+        // @TODO probably should make a enum for not found on this server so the\n+        // controller knows to try another server.\n         throw new BException(\"Shard [\" + shard + \"] not found in table [\" + table + \"]\");\n       }\n     } catch (BlurException e) {\n@@ -235,7 +239,8 @@ public void fetchRow(String table, Selector selector, FetchResult fetchResult) t\n \n       Query highlightQuery = getHighlightQuery(selector, table, analyzer);\n \n-      fetchRow(searcher.getIndexReader(), table, shard, selector, fetchResult, highlightQuery, analyzer, _maxHeapPerRowFetch);\n+      fetchRow(searcher.getIndexReader(), table, shard, selector, fetchResult, highlightQuery, analyzer,\n+          _maxHeapPerRowFetch);\n       if (fetchResult.rowResult != null) {\n         if (fetchResult.rowResult.row != null && fetchResult.rowResult.row.records != null) {\n           _readRecordsMeter.mark(fetchResult.rowResult.row.records.size());\n@@ -419,7 +424,7 @@ public void cancel() {\n       BlurQueryStatus queryStatus = status.getQueryStatus();\n       QueryState state = queryStatus.getState();\n       if (state == QueryState.BACK_PRESSURE_INTERRUPTED) {\n-        throw new BlurException(\"Cannot execute query right now.\", null, ErrorType.BACK_PRESSURE);  \n+        throw new BlurException(\"Cannot execute query right now.\", null, ErrorType.BACK_PRESSURE);\n       } else if (state == QueryState.INTERRUPTED) {\n         throw new BlurException(\"Cannot execute query right now.\", null, ErrorType.QUERY_CANCEL);\n       }\n@@ -428,7 +433,7 @@ public void cancel() {\n       BlurQueryStatus queryStatus = status.getQueryStatus();\n       QueryState state = queryStatus.getState();\n       if (state == QueryState.BACK_PRESSURE_INTERRUPTED) {\n-        throw new BlurException(\"Cannot execute query right now.\", null, ErrorType.BACK_PRESSURE);  \n+        throw new BlurException(\"Cannot execute query right now.\", null, ErrorType.BACK_PRESSURE);\n       } else if (state == QueryState.INTERRUPTED) {\n         throw new BlurException(\"Cannot execute query right now.\", null, ErrorType.QUERY_CANCEL);\n       }\n@@ -511,13 +516,14 @@ public BlurQueryStatus queryStatus(String table, long uuid) {\n     return _statusManager.queryStatusIdList(table);\n   }\n \n-  public static void fetchRow(IndexReader reader, String table, String shard, Selector selector, FetchResult fetchResult,\n-      Query highlightQuery, int maxHeap) throws CorruptIndexException, IOException {\n+  public static void fetchRow(IndexReader reader, String table, String shard, Selector selector,\n+      FetchResult fetchResult, Query highlightQuery, int maxHeap) throws CorruptIndexException, IOException {\n     fetchRow(reader, table, shard, selector, fetchResult, highlightQuery, null, maxHeap);\n   }\n \n-  public static void fetchRow(IndexReader reader, String table, String shard, Selector selector, FetchResult fetchResult,\n-      Query highlightQuery, BlurAnalyzer analyzer, int maxHeap) throws CorruptIndexException, IOException {\n+  public static void fetchRow(IndexReader reader, String table, String shard, Selector selector,\n+      FetchResult fetchResult, Query highlightQuery, BlurAnalyzer analyzer, int maxHeap) throws CorruptIndexException,\n+      IOException {\n     fetchResult.table = table;\n     String locationId = selector.locationId;\n     int lastSlash = locationId.lastIndexOf('/');\n@@ -962,7 +968,10 @@ private void doMutate(RowMutation mutation) throws BlurException, IOException {\n \n   private Row updateMetrics(Row row) {\n     _writeRowMeter.mark();\n-    _writeRecordsMeter.mark(row.getRecords().size());\n+    List<Record> records = row.getRecords();\n+    if (records != null) {\n+      _writeRecordsMeter.mark(records.size());\n+    }\n     return row;\n   }\n \n@@ -1184,14 +1193,13 @@ public void optimize(String table, int numberOfSegmentsPerShard) throws BExcepti\n   public void setClusterStatus(ClusterStatus clusterStatus) {\n     _clusterStatus = clusterStatus;\n   }\n-  \n+\n   public void setFetchCount(int fetchCount) {\n     _fetchCount = fetchCount;\n   }\n-  \n+\n   public void setMaxHeapPerRowFetch(int maxHeapPerRowFetch) {\n     _maxHeapPerRowFetch = maxHeapPerRowFetch;\n   }\n-  \n \n }",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/ebce22d9c57bbe3f0558100f19c23e3306cc0cc2/blur-core/src/main/java/org/apache/blur/manager/IndexManager.java",
                "sha": "4d04459ae1c07aed4ca524afad780cd8eed95c11",
                "status": "modified"
            }
        ],
        "message": "Unit test was breaking because of a NPE.",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/07f0756fd7ecd571aabfe51b15584f52d768fb16",
        "patched_files": [
            "IndexManager.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "IndexManagerTest.java"
        ]
    },
    "incubator-retired-blur_f66660e": {
        "bug_id": "incubator-retired-blur_f66660e",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/f66660e9f2bd57633c179463060da6b75a3b9e95",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/f66660e9f2bd57633c179463060da6b75a3b9e95/src/blur-core/src/main/java/com/nearinfinity/blur/utils/RowWalIndexWriter.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/src/blur-core/src/main/java/com/nearinfinity/blur/utils/RowWalIndexWriter.java?ref=f66660e9f2bd57633c179463060da6b75a3b9e95",
                "deletions": 2,
                "filename": "src/blur-core/src/main/java/com/nearinfinity/blur/utils/RowWalIndexWriter.java",
                "patch": "@@ -72,8 +72,10 @@ public void replace(boolean wal, Row row) throws IOException {\n   private void append(boolean wal, Row row, boolean replace) throws IOException {\n     primeDocSet = false;\n     List<Document> documents = new ArrayList<Document>();\n-    for (Record record : row.records) {\n-      convert(row.id, record, documents);\n+    if (row.records != null) {\n+      for (Record record : row.records) {\n+        convert(row.id, record, documents);\n+      }\n     }\n     if (replace) {\n       _indexWriter.updateDocuments(wal, new Term(ROW_ID, row.id), documents, _analyzer);",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/f66660e9f2bd57633c179463060da6b75a3b9e95/src/blur-core/src/main/java/com/nearinfinity/blur/utils/RowWalIndexWriter.java",
                "sha": "72569a1ecbefff089bcf0bbbd04bc2793174ada4",
                "status": "modified"
            },
            {
                "additions": 17,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/f66660e9f2bd57633c179463060da6b75a3b9e95/src/blur-core/src/test/java/com/nearinfinity/blur/manager/IndexManagerTest.java",
                "changes": 17,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/src/blur-core/src/test/java/com/nearinfinity/blur/manager/IndexManagerTest.java?ref=f66660e9f2bd57633c179463060da6b75a3b9e95",
                "deletions": 0,
                "filename": "src/blur-core/src/test/java/com/nearinfinity/blur/manager/IndexManagerTest.java",
                "patch": "@@ -54,6 +54,8 @@\n import com.nearinfinity.blur.thrift.generated.FetchRecordResult;\n import com.nearinfinity.blur.thrift.generated.FetchResult;\n import com.nearinfinity.blur.thrift.generated.Record;\n+import com.nearinfinity.blur.thrift.generated.RecordMutation;\n+import com.nearinfinity.blur.thrift.generated.RecordMutationType;\n import com.nearinfinity.blur.thrift.generated.Row;\n import com.nearinfinity.blur.thrift.generated.RowMutation;\n import com.nearinfinity.blur.thrift.generated.RowMutationType;\n@@ -411,4 +413,19 @@ public void testMutationDeleteRow() throws Exception {\n     assertNull(\"row should be deleted\", fetchResult.rowResult);\n   }\n \n+  @Test\n+  public void testMutationUpdateRowDeleteLastRecord() throws Exception {\n+    RecordMutation recordMutation = newRecordMutation(\"test-family\", \"record-2\");\n+    recordMutation.setRecordMutationType(RecordMutationType.DELETE_ENTIRE_RECORD);\n+\n+    RowMutation rowMutation = newRowMutation(TABLE, \"row-2\", recordMutation);\n+    rowMutation.setRowMutationType(RowMutationType.UPDATE_ROW);\n+    indexManager.mutate(rowMutation);\n+\n+    Selector selector = new Selector().setRowId(\"row-2\");\n+    FetchResult fetchResult = new FetchResult();\n+    indexManager.fetchRow(TABLE, selector, fetchResult);\n+    assertNull(\"row should not exist\", fetchResult.rowResult);\n+  }\n+\n }",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/f66660e9f2bd57633c179463060da6b75a3b9e95/src/blur-core/src/test/java/com/nearinfinity/blur/manager/IndexManagerTest.java",
                "sha": "29e632423e99b35ed2ea31b3f4013c8decdef5cb",
                "status": "modified"
            }
        ],
        "message": "(#123) Allow the last record in a row to be deleted without throwing a NullPointerException.  This results in the row being removed altogether because the row has no records left.",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/5a36a196621d2b59a044413b0f4975c840bafbda",
        "patched_files": [
            "IndexManager.java",
            "RowWalIndexWriter.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "IndexManagerTest.java"
        ]
    },
    "incubator-retired-blur_faab2e1": {
        "bug_id": "incubator-retired-blur_faab2e1",
        "commit": "https://github.com/apache/incubator-retired-blur/commit/faab2e145d159391bdaedd9128fdf5d6d7b001ce",
        "file": [
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/faab2e145d159391bdaedd9128fdf5d6d7b001ce/blur-core/src/main/java/org/apache/blur/manager/writer/TransactionRecorder.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-core/src/main/java/org/apache/blur/manager/writer/TransactionRecorder.java?ref=faab2e145d159391bdaedd9128fdf5d6d7b001ce",
                "deletions": 0,
                "filename": "blur-core/src/main/java/org/apache/blur/manager/writer/TransactionRecorder.java",
                "patch": "@@ -273,13 +273,20 @@ private static void writeDelete(DataOutputStream outputStream, String deleteRowI\n   }\n \n   private static void writeString(DataOutputStream outputStream, String s) throws IOException {\n+    if (s == null) {\n+      Utils.writeVInt(outputStream, -1);  \n+      return;\n+    }\n     byte[] bs = s.getBytes();\n     Utils.writeVInt(outputStream, bs.length);\n     outputStream.write(bs);\n   }\n \n   private static String readString(DataInputStream inputStream) throws IOException {\n     int length = Utils.readVInt(inputStream);\n+    if (length == -1) {\n+      return null;\n+    }\n     byte[] buffer = new byte[length];\n     inputStream.readFully(buffer);\n     return new String(buffer);",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/faab2e145d159391bdaedd9128fdf5d6d7b001ce/blur-core/src/main/java/org/apache/blur/manager/writer/TransactionRecorder.java",
                "sha": "605fe32054ac1760af2123aa458cd649301991d5",
                "status": "modified"
            },
            {
                "additions": 22,
                "blob_url": "https://github.com/apache/incubator-retired-blur/blob/faab2e145d159391bdaedd9128fdf5d6d7b001ce/blur-core/src/test/java/org/apache/blur/manager/IndexManagerTest.java",
                "changes": 22,
                "contents_url": "https://api.github.com/repos/apache/incubator-retired-blur/contents/blur-core/src/test/java/org/apache/blur/manager/IndexManagerTest.java?ref=faab2e145d159391bdaedd9128fdf5d6d7b001ce",
                "deletions": 0,
                "filename": "blur-core/src/test/java/org/apache/blur/manager/IndexManagerTest.java",
                "patch": "@@ -1000,6 +1000,28 @@ public void testMutationUpdateRowReplaceExistingColumns() throws Exception {\n     }\n     assertTrue(\"column 3 should be unmodified\", foundUnmodifiedColumn);\n   }\n+  \n+  @Test\n+  public void testMutationUpdateRowReplaceExistingColumnsWhileDeletingAColumn() throws Exception {\n+    Column c1 = newColumn(\"testcol1\", \"value999\");\n+    Column c2 = newColumn(\"testcol2\", null);\n+    String rec = \"record-1\";\n+    RecordMutation rm = newRecordMutation(REPLACE_COLUMNS, FAMILY, rec, c1, c2);\n+\n+    Record r = updateAndFetchRecord(\"row-1\", rec, rm);\n+\n+    assertNotNull(\"record should exist\", r);\n+    assertEquals(\"only 2 columns in record\", 2, r.getColumnsSize());\n+    assertTrue(\"column 1 should be in record\", r.columns.contains(c1));\n+    boolean foundUnmodifiedColumn = false;\n+    for (Column column : r.columns) {\n+      if (column.name.equals(\"testcol3\") && column.value.equals(\"value3\")) {\n+        foundUnmodifiedColumn = true;\n+        break;\n+      }\n+    }\n+    assertTrue(\"column 3 should be unmodified\", foundUnmodifiedColumn);\n+  }\n \n   @Test\n   public void testMutationUpdateRowReplaceExistingDuplicateColumns() throws Exception {",
                "raw_url": "https://github.com/apache/incubator-retired-blur/raw/faab2e145d159391bdaedd9128fdf5d6d7b001ce/blur-core/src/test/java/org/apache/blur/manager/IndexManagerTest.java",
                "sha": "8edb2d782e5f8ad74f46afbd955574b8f68f5c68",
                "status": "modified"
            }
        ],
        "message": "Adding test for deletion of column during row update where the record mutation type is replace columns.  If the column value is null then the column is removed form the record.  Also fixing a NPE in the transaction recorder.",
        "parent": "https://github.com/apache/incubator-retired-blur/commit/f76fa04daf94b9ba979e0e4c43e7ba9e5b677a26",
        "patched_files": [
            "IndexManager.java",
            "TransactionRecorder.java"
        ],
        "repo": "incubator-retired-blur",
        "unit_tests": [
            "TransactionRecorderTest.java",
            "IndexManagerTest.java"
        ]
    }
}