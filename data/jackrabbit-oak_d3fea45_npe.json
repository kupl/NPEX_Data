[
    {
        "repo": "jackrabbit-oak",
        "commit": "https://github.com/apache/jackrabbit-oak/commit/d3fea45b096fa2a6f66bb529ed145ae8c7bb01e7",
        "bug_id": "jackrabbit-oak_d3fea45",
        "message": "OAK-2363: NPE in DocumentNodeStore#retrieve for non existing checkpoint\nAdd null check and test case\n\ngit-svn-id: https://svn.apache.org/repos/asf/jackrabbit/oak/trunk@1646236 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jackrabbit-oak/commit/66195240e9c895d3f0940e2754a7b505166c8156",
        "patched_files": [
            "DocumentNodeStore.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 4,
                "raw_url": "https://github.com/apache/jackrabbit-oak/raw/d3fea45b096fa2a6f66bb529ed145ae8c7bb01e7/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentNodeStore.java",
                "contents_url": "https://api.github.com/repos/apache/jackrabbit-oak/contents/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentNodeStore.java?ref=d3fea45b096fa2a6f66bb529ed145ae8c7bb01e7",
                "filename": "oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentNodeStore.java",
                "deletions": 1,
                "sha": "5c519c2e693db549b494349202210e41511f0639",
                "blob_url": "https://github.com/apache/jackrabbit-oak/blob/d3fea45b096fa2a6f66bb529ed145ae8c7bb01e7/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentNodeStore.java",
                "patch": "@@ -39,6 +39,7 @@\n import java.util.Map;\n import java.util.NavigableSet;\n import java.util.Set;\n+import java.util.SortedMap;\n import java.util.TimeZone;\n import java.util.concurrent.Callable;\n import java.util.concurrent.ConcurrentHashMap;\n@@ -70,6 +71,7 @@\n import org.apache.jackrabbit.oak.commons.json.JsopTokenizer;\n import org.apache.jackrabbit.oak.plugins.blob.BlobStoreBlob;\n import org.apache.jackrabbit.oak.plugins.blob.MarkSweepGarbageCollector;\n+import org.apache.jackrabbit.oak.plugins.document.Checkpoints.Info;\n import org.apache.jackrabbit.oak.plugins.document.mongo.MongoBlobReferenceIterator;\n import org.apache.jackrabbit.oak.plugins.document.mongo.MongoDocumentStore;\n import org.apache.jackrabbit.oak.plugins.document.persistentCache.PersistentCache;\n@@ -1404,7 +1406,8 @@ public String checkpoint(long lifetime) {\n     @Override\n     public NodeState retrieve(@Nonnull String checkpoint) {\n         Revision r = Revision.fromString(checkpoint);\n-        if (checkpoints.getCheckpoints().containsKey(r)) {\n+        SortedMap<Revision, Info> checkpoints = this.checkpoints.getCheckpoints();\n+        if (checkpoints != null && checkpoints.containsKey(r)) {\n             return getRoot(r);\n         } else {\n             return null;",
                "changes": 5
            },
            {
                "status": "modified",
                "additions": 5,
                "raw_url": "https://github.com/apache/jackrabbit-oak/raw/d3fea45b096fa2a6f66bb529ed145ae8c7bb01e7/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/CheckpointTest.java",
                "contents_url": "https://api.github.com/repos/apache/jackrabbit-oak/contents/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/CheckpointTest.java?ref=d3fea45b096fa2a6f66bb529ed145ae8c7bb01e7",
                "filename": "oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/CheckpointTest.java",
                "deletions": 0,
                "sha": "f9fc298470d5ad2e4162cfdd1c69031a66880856",
                "blob_url": "https://github.com/apache/jackrabbit-oak/blob/d3fea45b096fa2a6f66bb529ed145ae8c7bb01e7/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/CheckpointTest.java",
                "patch": "@@ -107,4 +107,9 @@ public void checkpointInfo() throws CommitFailedException {\n         assertEquals(props, store.checkpointInfo(cp));\n     }\n \n+    @Test\n+    public void retrieveAny() {\n+        assertTrue(store.retrieve(\"r42-0-0\") == null);\n+    }\n+\n }",
                "changes": 5
            }
        ],
        "unit_tests": [
            "CheckpointTest.java",
            "DocumentNodeStoreTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/CheckpointTest.java",
        "buggy_files": [
            "oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentNodeStore.java"
        ],
        "fixed": true
    }
]