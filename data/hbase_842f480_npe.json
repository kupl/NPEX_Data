[
    {
        "repo": "hbase",
        "commit": "https://github.com/apache/hbase/commit/842f4808db3a4951f43d958f7933e12ca9bd4830",
        "bug_id": "hbase_842f480",
        "message": "HBASE-11880 NPE in MasterStatusServlet",
        "parent": "https://github.com/apache/hbase/commit/211c1e8ad439f2dfbbd2f07ce099c0f948e06df3",
        "patched_files": [
            "MasterStatusServlet.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 6,
                "raw_url": "https://github.com/apache/hbase/raw/842f4808db3a4951f43d958f7933e12ca9bd4830/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java",
                "contents_url": "https://api.github.com/repos/apache/hbase/contents/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java?ref=842f4808db3a4951f43d958f7933e12ca9bd4830",
                "filename": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java",
                "deletions": 2,
                "sha": "714b5a8aede574f53bc0ce160f540b6c6347820b",
                "blob_url": "https://github.com/apache/hbase/blob/842f4808db3a4951f43d958f7933e12ca9bd4830/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java",
                "patch": "@@ -480,8 +480,12 @@ private void finishActiveMasterInitialization(MonitoredTask status)\n     ZKClusterId.setClusterId(this.zooKeeper, fileSystemManager.getClusterId());\n     this.serverManager = createServerManager(this, this);\n \n-    metaTableLocator = new MetaTableLocator();\n-    shortCircuitConnection = createShortCircuitConnection();\n+    synchronized (this) {\n+      if (shortCircuitConnection == null) {\n+        shortCircuitConnection = createShortCircuitConnection();\n+        metaTableLocator = new MetaTableLocator();\n+      }\n+    }\n \n     // Invalidate all write locks held previously\n     this.tableLockManager.reapWriteLocks();",
                "changes": 8
            },
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/hbase/raw/842f4808db3a4951f43d958f7933e12ca9bd4830/hbase-server/src/main/java/org/apache/hadoop/hbase/master/MasterStatusServlet.java",
                "contents_url": "https://api.github.com/repos/apache/hbase/contents/hbase-server/src/main/java/org/apache/hadoop/hbase/master/MasterStatusServlet.java?ref=842f4808db3a4951f43d958f7933e12ca9bd4830",
                "filename": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/MasterStatusServlet.java",
                "deletions": 4,
                "sha": "3059096380943f801394cf1a88e2e8aacfcbbf81",
                "blob_url": "https://github.com/apache/hbase/blob/842f4808db3a4951f43d958f7933e12ca9bd4830/hbase-server/src/main/java/org/apache/hadoop/hbase/master/MasterStatusServlet.java",
                "patch": "@@ -27,8 +27,6 @@\n import javax.servlet.http.HttpServletRequest;\n import javax.servlet.http.HttpServletResponse;\n \n-import org.apache.commons.logging.Log;\n-import org.apache.commons.logging.LogFactory;\n import org.apache.hadoop.classification.InterfaceAudience;\n import org.apache.hadoop.conf.Configuration;\n import org.apache.hadoop.hbase.ServerName;\n@@ -43,7 +41,6 @@\n  */\n @InterfaceAudience.Private\n public class MasterStatusServlet extends HttpServlet {\n-  private static final Log LOG = LogFactory.getLog(MasterStatusServlet.class);\n   private static final long serialVersionUID = 1L;\n \n   @Override\n@@ -88,7 +85,9 @@ public void doGet(HttpServletRequest request, HttpServletResponse response)\n   }\n \n   private ServerName getMetaLocationOrNull(HMaster master) {\n-    return master.getMetaTableLocator().getMetaRegionLocation(master.getZooKeeper());\n+    MetaTableLocator metaTableLocator = master.getMetaTableLocator();\n+    return metaTableLocator == null ? null :\n+      metaTableLocator.getMetaRegionLocation(master.getZooKeeper());\n   }\n \n   private Map<String, Integer> getFragmentationInfo(",
                "changes": 7
            },
            {
                "status": "modified",
                "additions": 6,
                "raw_url": "https://github.com/apache/hbase/raw/842f4808db3a4951f43d958f7933e12ca9bd4830/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java",
                "contents_url": "https://api.github.com/repos/apache/hbase/contents/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java?ref=842f4808db3a4951f43d958f7933e12ca9bd4830",
                "filename": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java",
                "deletions": 2,
                "sha": "7947c4a6c55c6942df6642fe31efdbde958579b1",
                "blob_url": "https://github.com/apache/hbase/blob/842f4808db3a4951f43d958f7933e12ca9bd4830/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java",
                "patch": "@@ -637,8 +637,12 @@ private void initializeZooKeeper() throws IOException, InterruptedException {\n       this.abort(\"Failed to retrieve Cluster ID\",e);\n     }\n \n-    shortCircuitConnection = createShortCircuitConnection();\n-    metaTableLocator = new MetaTableLocator();\n+    synchronized (this) {\n+      if (shortCircuitConnection == null) {\n+        shortCircuitConnection = createShortCircuitConnection();\n+        metaTableLocator = new MetaTableLocator();\n+      }\n+    }\n \n     // watch for snapshots and other procedures\n     try {",
                "changes": 8
            }
        ],
        "unit_tests": [
            "TestMasterStatusServlet.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestMasterStatusServlet.java",
        "buggy_files": [
            "hbase-server/src/main/java/org/apache/hadoop/hbase/master/MasterStatusServlet.java"
        ],
        "fixed": true
    }
]