[{"commit": "https://github.com/apache/falcon/commit/7b2f0f650f8e6cf46544c5a63a1071c8391272d8", "parent": "https://github.com/apache/falcon/commit/fa540cce5e98a71034d7113d51ed5c6f8add455f", "message": "Handling NPE", "bug_id": "falcon_1", "file": [{"additions": 1, "raw_url": "https://github.com/apache/falcon/raw/7b2f0f650f8e6cf46544c5a63a1071c8391272d8/oozie/src/main/java/org/apache/ivory/workflow/engine/OozieWorkflowEngine.java", "blob_url": "https://github.com/apache/falcon/blob/7b2f0f650f8e6cf46544c5a63a1071c8391272d8/oozie/src/main/java/org/apache/ivory/workflow/engine/OozieWorkflowEngine.java", "sha": "3953baff192e02b4ab6a9704fbe1a0bc1e32a2d2", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/falcon/contents/oozie/src/main/java/org/apache/ivory/workflow/engine/OozieWorkflowEngine.java?ref=7b2f0f650f8e6cf46544c5a63a1071c8391272d8", "patch": "@@ -105,7 +105,7 @@ public void schedule(Entity entity) throws IvoryException {\n         for (String cluster : bundleMap.keySet()) {\n             BundleJob bundleJob = bundleMap.get(cluster);\n             if (bundleJob == MISSING || bundleJob.getStatus().equals(Job.Status.KILLED)) {\n-                if (bundleJob.getStatus().equals(Job.Status.KILLED)) {\n+                if (bundleJob != MISSING) {\n                     LOG.warn(\"Bundle id: \" + bundleJob.getId() + \" is in killed state, so allowing schedule\");\n                 }\n                 schedClusters.add(cluster);", "filename": "oozie/src/main/java/org/apache/ivory/workflow/engine/OozieWorkflowEngine.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/1207a8c9b460c4c4500c5c846f6107d02c7416d3", "parent": "https://github.com/apache/falcon/commit/e7b83a34addfcd583499a583b87a122889413401", "message": "fixed NPE", "bug_id": "falcon_2", "file": [{"additions": 4, "raw_url": "https://github.com/apache/falcon/raw/1207a8c9b460c4c4500c5c846f6107d02c7416d3/oozie/src/main/java/org/apache/ivory/workflow/engine/OozieWorkflowEngine.java", "blob_url": "https://github.com/apache/falcon/blob/1207a8c9b460c4c4500c5c846f6107d02c7416d3/oozie/src/main/java/org/apache/ivory/workflow/engine/OozieWorkflowEngine.java", "sha": "91a41ced0d69f21359d000a5a7b1761e92c506a7", "changes": 8, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/falcon/contents/oozie/src/main/java/org/apache/ivory/workflow/engine/OozieWorkflowEngine.java?ref=1207a8c9b460c4c4500c5c846f6107d02c7416d3", "patch": "@@ -543,11 +543,11 @@ private void updateInternal(Entity oldEntity, Entity newEntity, Cluster cluster,\n             // Add offset to end time for late coords\n             Date localEndTime = addOffest(endTime, minCoordStartTime, coord.getStartTime());\n \n-            // Pause time should be < endTime as coord materializes actions at\n-            // pauseTime, but not at endTime\n-            Date pauseTime = getPreviousMin(localEndTime);\n+            if (coord.getLastActionTime() != null && localEndTime.before(coord.getLastActionTime())) {\n+                // Pause time should be < endTime as coord materializes actions at\n+                // pauseTime, but not at endTime\n+                Date pauseTime = getPreviousMin(localEndTime);\n \n-            if (localEndTime.before(coord.getLastActionTime())) {\n                 // Set pause time to now so that future coord actions are\n                 // deleted\n                 change(cluster, coord.getId(), null, null, EntityUtil.formatDateUTC(pauseTime));", "filename": "oozie/src/main/java/org/apache/ivory/workflow/engine/OozieWorkflowEngine.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/cbd7c807e4fbc5ced48923529cbb29e3af7b4dfc", "parent": "https://github.com/apache/falcon/commit/7421c775679a39e69b704d29f49a0e21c3ff54a3", "message": "FALCON-1443 NPE in shutdown hook. Contributed by Pallavi Rao.", "bug_id": "falcon_3", "file": [{"additions": 2, "raw_url": "https://github.com/apache/falcon/raw/cbd7c807e4fbc5ced48923529cbb29e3af7b4dfc/CHANGES.txt", "blob_url": "https://github.com/apache/falcon/blob/cbd7c807e4fbc5ced48923529cbb29e3af7b4dfc/CHANGES.txt", "sha": "688c3c49aa0177e81370eb4c848333c5f802b28a", "changes": 2, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/CHANGES.txt?ref=cbd7c807e4fbc5ced48923529cbb29e3af7b4dfc", "patch": "@@ -18,6 +18,8 @@ Trunk (Unreleased)\n   OPTIMIZATIONS\n \n   BUG FIXES\n+    FALCON-1443 NPE in shutdown hook(Pallavi Rao via Ajay Yadava)\n+\n     FALCON-1445 Docfix for api/instance/dependencies endpoint(Raghav Kumar Gautam via Ajay Yadava)\n \n     FALCON-1381 The webservice response of Falcon includes a stack trace in case of errors(Narayan Periwal via Ajay Yadava)", "filename": "CHANGES.txt"}, {"additions": 7, "raw_url": "https://github.com/apache/falcon/raw/cbd7c807e4fbc5ced48923529cbb29e3af7b4dfc/prism/src/main/java/org/apache/falcon/Main.java", "blob_url": "https://github.com/apache/falcon/blob/cbd7c807e4fbc5ced48923529cbb29e3af7b4dfc/prism/src/main/java/org/apache/falcon/Main.java", "sha": "b0f19aea32a862e25c5f1eefc1a7c00784afbffc", "changes": 9, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/falcon/contents/prism/src/main/java/org/apache/falcon/Main.java?ref=cbd7c807e4fbc5ced48923529cbb29e3af7b4dfc", "patch": "@@ -66,8 +66,13 @@ private static CommandLine parseArgs(String[] args) throws ParseException {\n         public void run() {\n             try {\n                 LOG.info(\"calling shutdown hook\");\n-                server.stop();\n-                broker.stop();\n+                if (server != null) {\n+                    server.stop();\n+                }\n+                if (broker != null) {\n+                    broker.stop();\n+                }\n+                LOG.info(\"Shutdown Complete.\");\n             } catch (Exception e) {\n                 LOG.error(\"Server shutdown failed with \" , e);\n             }", "filename": "prism/src/main/java/org/apache/falcon/Main.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/d718ad737d63399e545a187d71420f106620913d", "parent": "https://github.com/apache/falcon/commit/693e8af52e46e673e2a47f0e3b9b44d6dd2e8422", "message": "FALCON-1099 FeedReplicator: throws NPE. Contributed by Sowmya Ramesh", "bug_id": "falcon_4", "file": [{"additions": 2, "raw_url": "https://github.com/apache/falcon/raw/d718ad737d63399e545a187d71420f106620913d/CHANGES.txt", "blob_url": "https://github.com/apache/falcon/blob/d718ad737d63399e545a187d71420f106620913d/CHANGES.txt", "sha": "7a52e95873026699f802a154b81b5c2fdd022868", "changes": 2, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/CHANGES.txt?ref=d718ad737d63399e545a187d71420f106620913d", "patch": "@@ -117,6 +117,8 @@ Trunk (Unreleased)\n    (Suhas vasu)\n \n   BUG FIXES\n+   FALCON-1099 FeedReplicator: throws NPE (Sowmya Ramesh via Suhas Vasu)\n+\n    FALCON-1064 Build hangs at the following test: JMSMessageProducerTest\n    (Sowmya Ramesh via Suhas Vasu)\n ", "filename": "CHANGES.txt"}, {"additions": 7, "raw_url": "https://github.com/apache/falcon/raw/d718ad737d63399e545a187d71420f106620913d/replication/src/main/java/org/apache/falcon/replication/FeedReplicator.java", "blob_url": "https://github.com/apache/falcon/blob/d718ad737d63399e545a187d71420f106620913d/replication/src/main/java/org/apache/falcon/replication/FeedReplicator.java", "sha": "aa58aa90c48070bab7fa207b7f9604ec269d0f06", "changes": 10, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/falcon/contents/replication/src/main/java/org/apache/falcon/replication/FeedReplicator.java?ref=d718ad737d63399e545a187d71420f106620913d", "patch": "@@ -69,10 +69,14 @@ public int run(String[] args) throws Exception {\n         final boolean includePathSet = (includePathConf != null)\n                 && !IGNORE.equalsIgnoreCase(includePathConf);\n \n+        String availabilityFlagOpt = cmd.getOptionValue(\"availabilityFlag\");\n+        if (StringUtils.isEmpty(availabilityFlagOpt)) {\n+            availabilityFlagOpt = \"NA\";\n+        }\n         String availabilityFlag = EntityUtil.SUCCEEDED_FILE_NAME;\n         if (cmd.getOptionValue(\"falconFeedStorageType\").equals(Storage.TYPE.FILESYSTEM.name())) {\n-            availabilityFlag = cmd.getOptionValue(\"availabilityFlag\").equals(\"NA\")\n-                    ? availabilityFlag : cmd.getOptionValue(\"availabilityFlag\");\n+            availabilityFlag = \"NA\".equals(availabilityFlagOpt)\n+                    ? availabilityFlag : availabilityFlagOpt;\n         }\n \n         conf.set(\"falcon.feed.availability.flag\", availabilityFlag);\n@@ -136,7 +140,7 @@ protected DistCpOptions getDistCpOptions(CommandLine cmd) {\n     }\n \n     private List<Path> getPaths(String[] paths) {\n-        List<Path> listPaths = new ArrayList<Path>();\n+        List<Path> listPaths = new ArrayList<>();\n         for (String path : paths) {\n             listPaths.add(new Path(path));\n         }", "filename": "replication/src/main/java/org/apache/falcon/replication/FeedReplicator.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/2bd691afc0c2621f3f54748e270f05688055feec", "parent": "https://github.com/apache/falcon/commit/685441eaedea5fcd7c438e706438fc4956ff7f08", "message": "Instance Status returning 500 due to NPE", "bug_id": "falcon_5", "file": [{"additions": 6, "raw_url": "https://github.com/apache/falcon/raw/2bd691afc0c2621f3f54748e270f05688055feec/prism/src/main/java/org/apache/ivory/resource/AbstractEntityManager.java", "blob_url": "https://github.com/apache/falcon/blob/2bd691afc0c2621f3f54748e270f05688055feec/prism/src/main/java/org/apache/ivory/resource/AbstractEntityManager.java", "sha": "fbcb6d1c7c72476e3e0cdaa128fe85456aa3aca5", "changes": 9, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/falcon/contents/prism/src/main/java/org/apache/ivory/resource/AbstractEntityManager.java?ref=2bd691afc0c2621f3f54748e270f05688055feec", "patch": "@@ -126,10 +126,13 @@ protected InstancesResult consolidateInstanceResult(APIResult[] results, String[\n             APIResult result = results[index];\n             message.append(colos[index]).append('/').append(result.getMessage()).append('\\n');\n             requestIds.append(colos[index]).append('/').append(results[index].getRequestId()).append('\\n');\n-            if (!(result instanceof InstancesResult))\n-                continue;\n+\n+            if ((result instanceof InstancesResult)) continue;\n+            if (((InstancesResult) result).getInstances() == null) continue;\n+\n             for (Instance instance : ((InstancesResult) result).getInstances()) {\n-                Instance instClone = new Instance(instance.cluster, colos[index] + \"/\" + instance.getInstance(), instance.getStatus());\n+                Instance instClone = new Instance(instance.cluster,\n+                        colos[index] + \"/\" + instance.getInstance(), instance.getStatus());\n                 instances.add(new Instance(instClone, instance.logFile, instance.actions));\n             }\n             statusCount += results[index].getStatus().ordinal();", "filename": "prism/src/main/java/org/apache/ivory/resource/AbstractEntityManager.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/52586b3e36b93dd71d9325f190dcb0917a42bda7", "parent": "https://github.com/apache/falcon/commit/947ed13b71aa80236396cbe86549feeb1c509a1c", "message": "FALCON-1461 NPE in DateValidator validate. Contributed by Raghav Kumar Gautam", "bug_id": "falcon_6", "file": [{"additions": 2, "raw_url": "https://github.com/apache/falcon/raw/52586b3e36b93dd71d9325f190dcb0917a42bda7/CHANGES.txt", "blob_url": "https://github.com/apache/falcon/blob/52586b3e36b93dd71d9325f190dcb0917a42bda7/CHANGES.txt", "sha": "b7a28316efe1d9139555361272ad6b33940f5836", "changes": 2, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/CHANGES.txt?ref=52586b3e36b93dd71d9325f190dcb0917a42bda7", "patch": "@@ -23,6 +23,8 @@ Trunk (Unreleased)\n   OPTIMIZATIONS\n \n   BUG FIXES\n+    FALCON-1461 NPE in DateValidator validate(Raghav Kumar Gautam via Sowmya Ramesh)\n+\n     FALCON-1446 Flaky TaskLogRetrieverYarnTest(Narayan Periwal via Pallavi Rao)\n \n     FALCON-1443 NPE in shutdown hook(Pallavi Rao via Ajay Yadava)", "filename": "CHANGES.txt"}, {"additions": 5, "raw_url": "https://github.com/apache/falcon/raw/52586b3e36b93dd71d9325f190dcb0917a42bda7/client/src/main/java/org/apache/falcon/entity/v0/DateValidator.java", "blob_url": "https://github.com/apache/falcon/blob/52586b3e36b93dd71d9325f190dcb0917a42bda7/client/src/main/java/org/apache/falcon/entity/v0/DateValidator.java", "sha": "e211f57d01ddcd974fe1c3be3915f1821148531a", "changes": 6, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/falcon/contents/client/src/main/java/org/apache/falcon/entity/v0/DateValidator.java?ref=52586b3e36b93dd71d9325f190dcb0917a42bda7", "patch": "@@ -17,6 +17,8 @@\n  */\n package org.apache.falcon.entity.v0;\n \n+import org.apache.commons.lang3.StringUtils;\n+\n import java.util.regex.Matcher;\n import java.util.regex.Pattern;\n \n@@ -39,7 +41,9 @@ private DateValidator() {\n      * @return true valid date fromat, false invalid date format\n      */\n     public static boolean validate(final String date) {\n-\n+        if (StringUtils.isBlank(date)) {\n+            return false;\n+        }\n         Matcher matcher = PATTERN.matcher(date);\n \n         if (matcher.matches()) {", "filename": "client/src/main/java/org/apache/falcon/entity/v0/DateValidator.java"}, {"additions": 1, "raw_url": "https://github.com/apache/falcon/raw/52586b3e36b93dd71d9325f190dcb0917a42bda7/client/src/test/java/org/apache/falcon/entity/v0/DateValidatorTest.java", "blob_url": "https://github.com/apache/falcon/blob/52586b3e36b93dd71d9325f190dcb0917a42bda7/client/src/test/java/org/apache/falcon/entity/v0/DateValidatorTest.java", "sha": "a1adb2440c059f83d6dde79701535e32ff323d5a", "changes": 1, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/client/src/test/java/org/apache/falcon/entity/v0/DateValidatorTest.java?ref=52586b3e36b93dd71d9325f190dcb0917a42bda7", "patch": "@@ -62,6 +62,7 @@\n             new Object[]{\"2010-6-31T00:00Z\", }, new Object[]{\"2010-06-31T00:00Z\", },\n             new Object[]{\"2010-9-31T00:00Z\", }, new Object[]{\"2010-09-31T00:00Z\", },\n             new Object[]{\"2010-11-31T00:00Z\", }, new Object[]{\"1999-04-31T01:00Z\", },\n+            new Object[]{null, }, new Object[]{\"\", }, new Object[]{\"      \", },\n         };\n     }\n ", "filename": "client/src/test/java/org/apache/falcon/entity/v0/DateValidatorTest.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/60e96f4a4088eb70eab7d6842dfd6d51bd521c98", "parent": "https://github.com/apache/falcon/commit/4cda54073f1a4389378c8e7365bca59c9728a424", "message": "FALCON-1323 Reverse lookup of feeds causes NPE. Contributed by Ajay Yadava.", "bug_id": "falcon_7", "file": [{"additions": 2, "raw_url": "https://github.com/apache/falcon/raw/60e96f4a4088eb70eab7d6842dfd6d51bd521c98/CHANGES.txt", "blob_url": "https://github.com/apache/falcon/blob/60e96f4a4088eb70eab7d6842dfd6d51bd521c98/CHANGES.txt", "sha": "9847422f262ce9bd8b7624c44b1fb538de7cbdc3", "changes": 2, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/CHANGES.txt?ref=60e96f4a4088eb70eab7d6842dfd6d51bd521c98", "patch": "@@ -65,6 +65,8 @@ Trunk (Unreleased)\n     (Suhas Vasu)\n \n   BUG FIXES\n+    FALCON-1323 Reverse lookup of feeds causes NPE(Ajay Yadava)\n+\n     FALCON-1329 Falcon's idempotent behaviour breaks in some cases(Ajay Yadava)\n \n     FALCON-1282 Incorrect hdfs servers property for feed replication in secured environment(Venkat Ranganathan via Ajay Yadava)", "filename": "CHANGES.txt"}, {"additions": 1, "raw_url": "https://github.com/apache/falcon/raw/60e96f4a4088eb70eab7d6842dfd6d51bd521c98/client/src/main/java/org/apache/falcon/resource/FeedLookupResult.java", "blob_url": "https://github.com/apache/falcon/blob/60e96f4a4088eb70eab7d6842dfd6d51bd521c98/client/src/main/java/org/apache/falcon/resource/FeedLookupResult.java", "sha": "f8d58aee65aca635624eee0eb0db9475f9e5a1d4", "changes": 1, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/client/src/main/java/org/apache/falcon/resource/FeedLookupResult.java?ref=60e96f4a4088eb70eab7d6842dfd6d51bd521c98", "patch": "@@ -79,6 +79,7 @@ public String toString() {\n         if (elements != null) {\n             for (FeedProperties element : elements) {\n                 buffer.append(element.toString());\n+                buffer.append(\"\\n\");\n             }\n         }\n         return buffer.toString();", "filename": "client/src/main/java/org/apache/falcon/resource/FeedLookupResult.java"}, {"additions": 1, "raw_url": "https://github.com/apache/falcon/raw/60e96f4a4088eb70eab7d6842dfd6d51bd521c98/common/src/main/java/org/apache/falcon/util/FalconRadixUtils.java", "blob_url": "https://github.com/apache/falcon/blob/60e96f4a4088eb70eab7d6842dfd6d51bd521c98/common/src/main/java/org/apache/falcon/util/FalconRadixUtils.java", "sha": "35f03b9cbe8e320472494590a0242878e0be2f1b", "changes": 6, "status": "modified", "deletions": 5, "contents_url": "https://api.github.com/repos/apache/falcon/contents/common/src/main/java/org/apache/falcon/util/FalconRadixUtils.java?ref=60e96f4a4088eb70eab7d6842dfd6d51bd521c98", "patch": "@@ -193,7 +193,7 @@ public RadixNode getNextCandidate(RadixNode currentNode, String input) {\n                     String regex = key.substring(0, key.indexOf(\"}\") + 1);\n                     // match the text and the regex\n                     FeedDataPath.VARS var = getMatchingRegex(regex);\n-                    if (matchPart(regex, input.substring(0, var.getValueSize()))) {\n+                    if (matchPart(regex, remainingText.substring(0, var.getValueSize()))) {\n                         newRoot = child; // if it matches then this is the newRoot\n                         break;\n                     }\n@@ -251,10 +251,6 @@ private int getPatternsEffectiveLength(String templateString) {\n \n         private FeedDataPath.VARS getMatchingRegex(String inputPart) {\n             //inputPart will be something like ${YEAR}\n-\n-            inputPart = inputPart.replace(\"${\", \"\\\\$\\\\{\");\n-            inputPart = inputPart.replace(\"}\", \"\\\\}\");\n-\n             for (FeedDataPath.VARS var : FeedDataPath.VARS.values()) {\n                 if (inputPart.equals(\"${\" + var.name() + \"}\")) {\n                     return var;", "filename": "common/src/main/java/org/apache/falcon/util/FalconRadixUtils.java"}, {"additions": 11, "raw_url": "https://github.com/apache/falcon/raw/60e96f4a4088eb70eab7d6842dfd6d51bd521c98/common/src/test/java/org/apache/falcon/util/RadixTreeTest.java", "blob_url": "https://github.com/apache/falcon/blob/60e96f4a4088eb70eab7d6842dfd6d51bd521c98/common/src/test/java/org/apache/falcon/util/RadixTreeTest.java", "sha": "e8b0e5bcf8a03837b9dfb4cbaf7a59a0712bbed2", "changes": 12, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/falcon/contents/common/src/test/java/org/apache/falcon/util/RadixTreeTest.java?ref=60e96f4a4088eb70eab7d6842dfd6d51bd521c98", "patch": "@@ -26,6 +26,7 @@\n import org.testng.annotations.BeforeMethod;\n import org.testng.annotations.Test;\n \n+import java.util.Collection;\n import java.util.List;\n \n /**\n@@ -42,7 +43,6 @@ public void setUp() {\n         tree.insert(\"key1\", \"value1\");\n         tree.insert(\"key2\", \"value2\");\n         tree.insert(\"random\", \"random\");\n-\n     }\n \n     @AfterMethod\n@@ -67,7 +67,17 @@ public void testDuplicateKeyInsert() {\n         Assert.assertEquals(tree.find(\"duplicatekey\").size(), 2);\n         Assert.assertTrue(tree.find(\"duplicatekey\").contains(\"value1\"));\n         Assert.assertTrue(tree.find(\"duplicatekey\").contains(\"value2\"));\n+    }\n \n+    @Test\n+    public void testGetNextCandidate() {\n+        tree.insert(\"/projects/userplatform/${YEAR}-${MONTH}-${DAY}\", \"feed1\");\n+        tree.insert(\"/projects/userplatform/another\", \"feed2\");\n+        Collection<String> result = tree.find(\"/projects/userplatform/another\");\n+        Assert.assertTrue(result.contains(\"feed2\"));\n+\n+        result = tree.find(\"/projects/userplatform/2014-07-07\", regexAlgorithm);\n+        Assert.assertTrue(result.contains(\"feed1\"));\n     }\n \n     @Test", "filename": "common/src/test/java/org/apache/falcon/util/RadixTreeTest.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/117fdcfe518154d634060e7557a5efe320e33362", "parent": "https://github.com/apache/falcon/commit/c7996deb76819fc7ef98dd28fd4dff19474b7602", "message": "FALCON-2107 NPE in FalconWorkflowEngine::isActive() method\n\nAuthor: bvellanki <bvellanki@hortonworks.com>\n\nReviewers: \"Venkat Ranganathan <venkat@hortonworks.com>\"\n\nCloses #254 from bvellanki/FALCON-2107", "bug_id": "falcon_8", "file": [{"additions": 10, "raw_url": "https://github.com/apache/falcon/raw/117fdcfe518154d634060e7557a5efe320e33362/scheduler/src/main/java/org/apache/falcon/workflow/engine/FalconWorkflowEngine.java", "blob_url": "https://github.com/apache/falcon/blob/117fdcfe518154d634060e7557a5efe320e33362/scheduler/src/main/java/org/apache/falcon/workflow/engine/FalconWorkflowEngine.java", "sha": "fe16443772ed920f5ccdca344e945b0e73ed0fd4", "changes": 15, "status": "modified", "deletions": 5, "contents_url": "https://api.github.com/repos/apache/falcon/contents/scheduler/src/main/java/org/apache/falcon/workflow/engine/FalconWorkflowEngine.java?ref=117fdcfe518154d634060e7557a5efe320e33362", "patch": "@@ -108,12 +108,17 @@ public void dryRun(Entity entity, String clusterName, Boolean skipDryRun) throws\n \n     @Override\n     public boolean isActive(Entity entity) throws FalconException {\n-        EntityID id = new EntityID(entity);\n-        // Ideally state store should have all entities, but, check anyway.\n-        if (STATE_STORE.entityExists(id)) {\n-            return STATE_STORE.getEntity(id).getCurrentState() != EntityState.STATE.SUBMITTED;\n+        try {\n+            EntityID id = new EntityID(entity);\n+            // Ideally state store should have all entities, but, check anyway.\n+            if (STATE_STORE.entityExists(id)) {\n+                return STATE_STORE.getEntity(id).getCurrentState() != EntityState.STATE.SUBMITTED;\n+            }\n+            return false;\n+        } catch (NullPointerException npe) {\n+            // FalconJPAService is not always used, so catch NPE and return false\n+            return false;\n         }\n-        return false;\n     }\n \n     @Override", "filename": "scheduler/src/main/java/org/apache/falcon/workflow/engine/FalconWorkflowEngine.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/523f2d5310a053a4e4d70642afa8707a089e3494", "parent": "https://github.com/apache/falcon/commit/fd712112838970b34d394bce8da0b806dcd41043", "message": "Handling NPE as there are no pending instanes", "bug_id": "falcon_9", "file": [{"additions": 5, "raw_url": "https://github.com/apache/falcon/raw/523f2d5310a053a4e4d70642afa8707a089e3494/prism/src/main/java/org/apache/ivory/service/SLAMonitoringService.java", "blob_url": "https://github.com/apache/falcon/blob/523f2d5310a053a4e4d70642afa8707a089e3494/prism/src/main/java/org/apache/ivory/service/SLAMonitoringService.java", "sha": "697b4b540d16719dcecdb6b3c709277e80f1cd27", "changes": 8, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/falcon/contents/prism/src/main/java/org/apache/ivory/service/SLAMonitoringService.java?ref=523f2d5310a053a4e4d70642afa8707a089e3494", "patch": "@@ -99,9 +99,11 @@ private void updateLatency(Entity entity, String cluster, long duration) {\n \n     private void removeFromPendingList(Entity entity, String cluster, Date nominalTime) {\n         ConcurrentMap<Date, Date> pendingInstances = pendingJobs.get(getKey(entity, cluster));\n-        LOG.debug(\"Removing from pending jobs: \" + getKey(entity,  cluster) + \" ---> \" +\n-                SchemaHelper.formatDateUTC(nominalTime));\n-        pendingInstances.remove(nominalTime);\n+        if (pendingInstances != null) {\n+            LOG.debug(\"Removing from pending jobs: \" + getKey(entity,  cluster) + \" ---> \" +\n+                    SchemaHelper.formatDateUTC(nominalTime));\n+            pendingInstances.remove(nominalTime);\n+        }\n     }\n \n     private class Monitor implements Runnable {", "filename": "prism/src/main/java/org/apache/ivory/service/SLAMonitoringService.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/b5baefbdbe4ab3bb319dbdcdd116bb527a1929e1", "parent": "https://github.com/apache/falcon/commit/1981f0050bd821fe87513f29e545d3e2a702f62e", "message": "DE187 rally fix NPE exception in console dump", "bug_id": "falcon_10", "file": [{"additions": 4, "raw_url": "https://github.com/apache/falcon/raw/b5baefbdbe4ab3bb319dbdcdd116bb527a1929e1/webapp/src/main/java/org/apache/ivory/resource/EntityManager.java", "blob_url": "https://github.com/apache/falcon/blob/b5baefbdbe4ab3bb319dbdcdd116bb527a1929e1/webapp/src/main/java/org/apache/ivory/resource/EntityManager.java", "sha": "72e473a027c0e64e74c191a209f9667893d6bd99", "changes": 4, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/webapp/src/main/java/org/apache/ivory/resource/EntityManager.java?ref=b5baefbdbe4ab3bb319dbdcdd116bb527a1929e1", "patch": "@@ -251,6 +251,10 @@ public String getEntityDefinition(@PathParam(\"type\") String type,\n \t\t\tEntityType entityType = EntityType.valueOf(type.toUpperCase());\n \t\t\tConfigurationStore configStore = ConfigurationStore.get();\n \t\t\tEntity entity= configStore.get(entityType, entityName);\n+\t\t\tif(entity==null){\n+\t\t\t\tLOG.error(entityName+\" does not exists\");\n+\t\t\t\treturn new APIResult(APIResult.Status.FAILED, entityName+\" does not exists\").toString();\t\n+\t\t\t}\n \t\t\tLOG.info(\"Returned entity: \" + entity);\n \t\t\treturn entity.toString();\n \t\t} catch (IllegalArgumentException e) {", "filename": "webapp/src/main/java/org/apache/ivory/resource/EntityManager.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/b364820dde20ff487492146afa1f10cd094dd26d", "parent": "https://github.com/apache/falcon/commit/4133c9633baf709a234c493cb973ac30d3bcb14c", "message": "FALCON-940 Avoid NPE in getAllEntitiesOfOneType() for zero elements. Contributed by Ruslan Ostafiychuk", "bug_id": "falcon_11", "file": [{"additions": 3, "raw_url": "https://github.com/apache/falcon/raw/b364820dde20ff487492146afa1f10cd094dd26d/falcon-regression/CHANGES.txt", "blob_url": "https://github.com/apache/falcon/blob/b364820dde20ff487492146afa1f10cd094dd26d/falcon-regression/CHANGES.txt", "sha": "04781f8ef1c9c2342e35179afcfef8fa5d32f12d", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/falcon-regression/CHANGES.txt?ref=b364820dde20ff487492146afa1f10cd094dd26d", "patch": "@@ -36,6 +36,9 @@ Trunk (Unreleased)\n    via Samarth Gupta)\n \n   IMPROVEMENTS\n+   FALCON-940 Avoid NPE in getAllEntitiesOfOneType() for zero elements\n+   (Ruslan Ostafiychuk via Raghav Kumar Gautam)\n+\n    FALCON-908 Remove jars that are not needed (Paul Isaychuk via Raghav Kumar Gautam)\n \n    FALCON-939 Fixing few typos and removing unused stuff (Paul Isaychuk via Ruslan Ostafiychuk)", "filename": "falcon-regression/CHANGES.txt"}, {"additions": 4, "raw_url": "https://github.com/apache/falcon/raw/b364820dde20ff487492146afa1f10cd094dd26d/falcon-regression/merlin-core/src/main/java/org/apache/falcon/regression/core/util/CleanupUtil.java", "blob_url": "https://github.com/apache/falcon/blob/b364820dde20ff487492146afa1f10cd094dd26d/falcon-regression/merlin-core/src/main/java/org/apache/falcon/regression/core/util/CleanupUtil.java", "sha": "e997fc8e51bac8f408dc355051844b783a9bbcbc", "changes": 6, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/falcon/contents/falcon-regression/merlin-core/src/main/java/org/apache/falcon/regression/core/util/CleanupUtil.java?ref=b364820dde20ff487492146afa1f10cd094dd26d", "patch": "@@ -68,8 +68,10 @@ private CleanupUtil() {\n         InterruptedException {\n         final EntityList entityList = getEntitiesResultOfOneType(entityManagerHelper, user);\n         List<String> clusters = new ArrayList<String>();\n-        for (EntityList.EntityElement entity : entityList.getElements()) {\n-            clusters.add(entity.name);\n+        if (entityList.getElements() != null) {\n+            for (EntityList.EntityElement entity : entityList.getElements()) {\n+                clusters.add(entity.name);\n+            }\n         }\n         return clusters;\n     }", "filename": "falcon-regression/merlin-core/src/main/java/org/apache/falcon/regression/core/util/CleanupUtil.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/20a13e3b458526153a884ce6135162245ab016cd", "parent": "https://github.com/apache/falcon/commit/b49360e77d69d5a7f2b027aadb561e95dd94b422", "message": "FALCON-840 Possible NPE in filteredInstanceSet method of AbstractInstanceManager. Contributed by Balu Vellanki", "bug_id": "falcon_12", "file": [{"additions": 3, "raw_url": "https://github.com/apache/falcon/raw/20a13e3b458526153a884ce6135162245ab016cd/CHANGES.txt", "blob_url": "https://github.com/apache/falcon/blob/20a13e3b458526153a884ce6135162245ab016cd/CHANGES.txt", "sha": "f83e4a8f17a15769315d16f1655844a005bc2d49", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/CHANGES.txt?ref=20a13e3b458526153a884ce6135162245ab016cd", "patch": "@@ -125,6 +125,9 @@ Trunk (Unreleased)\n   OPTIMIZATIONS\n \n   BUG FIXES\n+   FALCON-840 Possible NPE in filteredInstanceSet method of\n+   AbstractInstanceManager (Balu Vellanki via Venkatesh Seetharam)\n+\n    FALCON-839 Authorization succeeds with invalid acl owner based on group\n    membership (Venkatesh Seetharam)\n ", "filename": "CHANGES.txt"}, {"additions": 47, "raw_url": "https://github.com/apache/falcon/raw/20a13e3b458526153a884ce6135162245ab016cd/prism/src/main/java/org/apache/falcon/resource/AbstractEntityManager.java", "blob_url": "https://github.com/apache/falcon/blob/20a13e3b458526153a884ce6135162245ab016cd/prism/src/main/java/org/apache/falcon/resource/AbstractEntityManager.java", "sha": "c4c64936164b639b1c723b4f8178582f4cf439de", "changes": 106, "status": "modified", "deletions": 59, "contents_url": "https://api.github.com/repos/apache/falcon/contents/prism/src/main/java/org/apache/falcon/resource/AbstractEntityManager.java?ref=20a13e3b458526153a884ce6135162245ab016cd", "patch": "@@ -513,6 +513,7 @@ public EntityList getEntityList(String type, String fieldStr, String filterBy, S\n                                     String orderBy, String sortOrder, Integer offset, Integer resultsPerPage) {\n \n         HashSet<String> fields = new HashSet<String>(Arrays.asList(fieldStr.toLowerCase().split(\",\")));\n+        validateEntityFilterByClause(filterBy);\n         List<Entity> entities;\n         try {\n             entities = getEntities(type, \"\", \"\", \"\", filterBy, filterTags, orderBy, sortOrder, offset, resultsPerPage);\n@@ -526,19 +527,31 @@ public EntityList getEntityList(String type, String fieldStr, String filterBy, S\n                 : new EntityList(buildEntityElements(fields, entities));\n     }\n \n+    protected void validateEntityFilterByClause(String entityFilterByClause) {\n+        Map<String, String> filterByFieldsValues = getFilterByFieldsValues(entityFilterByClause);\n+        for (Map.Entry<String, String> entry : filterByFieldsValues.entrySet()) {\n+            try {\n+                EntityList.EntityFilterByFields.valueOf(entry.getKey().toUpperCase());\n+            } catch (IllegalArgumentException e) {\n+                throw FalconWebException.newInstanceException(\n+                        \"Invalid filter key: \" + entry.getKey(), Response.Status.BAD_REQUEST);\n+            }\n+        }\n+    }\n+\n     protected List<Entity> getEntities(String type, String startDate, String endDate, String cluster,\n                                        String filterBy, String filterTags, String orderBy, String sortOrder,\n                                        int offset, int resultsPerPage) throws FalconException {\n-        final HashMap<String, String> filterByFieldsValues = getFilterByFieldsValues(filterBy);\n-        final ArrayList<String> filterByTags = getFilterByTags(filterTags);\n+        final Map<String, String> filterByFieldsValues = getFilterByFieldsValues(filterBy);\n+        final List<String> filterByTags = getFilterByTags(filterTags);\n \n         EntityType entityType = EntityType.valueOf(type.toUpperCase());\n         Collection<String> entityNames = configStore.getEntities(entityType);\n         if (entityNames == null || entityNames.isEmpty()) {\n             return Collections.emptyList();\n         }\n \n-        ArrayList<Entity> entities = new ArrayList<Entity>();\n+        List<Entity> entities = new ArrayList<Entity>();\n         for (String entityName : entityNames) {\n             Entity entity;\n             try {\n@@ -603,25 +616,24 @@ private boolean filterEntityByDatesAndCluster(Entity entity, String startDate, S\n         return false;\n     }\n \n-    protected static HashMap<String, String> getFilterByFieldsValues(String filterBy) {\n-        //Filter the results by specific field:value\n-        HashMap<String, String> filterByFieldValues = new HashMap<String, String>();\n+    protected static Map<String, String> getFilterByFieldsValues(String filterBy) {\n+        // Filter the results by specific field:value, eliminate empty values\n+        Map<String, String> filterByFieldValues = new HashMap<String, String>();\n         if (!StringUtils.isEmpty(filterBy)) {\n             String[] fieldValueArray = filterBy.split(\",\");\n             for (String fieldValue : fieldValueArray) {\n                 String[] splits = fieldValue.split(\":\", 2);\n                 String filterByField = splits[0];\n-                if (splits.length == 2) {\n+                if (splits.length == 2 && !splits[1].equals(\"\")) {\n                     filterByFieldValues.put(filterByField, splits[1]);\n-                } else {\n-                    filterByFieldValues.put(filterByField, \"\");\n                 }\n             }\n         }\n+\n         return filterByFieldValues;\n     }\n \n-    private static ArrayList<String> getFilterByTags(String filterTags) {\n+    private static List<String> getFilterByTags(String filterTags) {\n         ArrayList<String> filterTagsList = new ArrayList<String>();\n         if (!StringUtils.isEmpty(filterTags)) {\n             String[] splits = filterTags.split(\",\");\n@@ -644,7 +656,7 @@ protected String getStatusString(Entity entity) {\n     }\n \n     private boolean filterEntity(Entity entity, String entityStatus,\n-                                 HashMap<String, String> filterByFieldsValues, ArrayList<String> filterByTags,\n+                                 Map<String, String> filterByFieldsValues, List<String> filterByTags,\n                                  List<String> tags, List<String> pipelines) {\n         if (SecurityUtil.isAuthorizationEnabled() && !isEntityAuthorized(entity)) {\n             // the user who requested list query has no permission to access this entity. Skip this entity\n@@ -670,7 +682,7 @@ protected boolean isEntityAuthorized(Entity entity) {\n         return true;\n     }\n \n-    private boolean filterEntityByTags(ArrayList<String> filterTagsList, List<String> tags) {\n+    private boolean filterEntityByTags(List<String> filterTagsList, List<String> tags) {\n         boolean filterEntity = false;\n         for (String tag : filterTagsList) {\n             if (!tags.contains(tag)) {\n@@ -682,64 +694,40 @@ private boolean filterEntityByTags(ArrayList<String> filterTagsList, List<String\n         return filterEntity;\n     }\n \n-    private boolean filterEntityByFields(Entity entity, HashMap<String, String> filterKeyVals,\n+    private boolean filterEntityByFields(Entity entity, Map<String, String> filterKeyVals,\n                                          String status, List<String> pipelines) {\n-        boolean filterEntity = false;\n-\n-        if (filterKeyVals.size() != 0) {\n-            String filterValue;\n-            for (Map.Entry<String, String> pair : filterKeyVals.entrySet()) {\n-                filterValue = pair.getValue();\n-                if (StringUtils.isEmpty(filterValue)) {\n-                    continue; // nothing to filter\n-                }\n-                EntityList.EntityFilterByFields filter =\n-                        EntityList.EntityFilterByFields.valueOf(pair.getKey().toUpperCase());\n-                switch (filter) {\n+        for (Map.Entry<String, String> pair : filterKeyVals.entrySet()) {\n+            String filterValue = pair.getValue();\n+            if (StringUtils.isEmpty(filterValue)) {\n+                continue; // nothing to filter\n+            }\n+            EntityList.EntityFilterByFields filter =\n+                    EntityList.EntityFilterByFields.valueOf(pair.getKey().toUpperCase());\n+            switch (filter) {\n \n-                case TYPE:\n-                    if (!entity.getEntityType().toString().equalsIgnoreCase(filterValue)) {\n-                        filterEntity = true;\n-                    }\n-                    break;\n+            case TYPE:\n+                return !entity.getEntityType().toString().equalsIgnoreCase(filterValue);\n \n-                case NAME:\n-                    if (!entity.getName().equalsIgnoreCase(filterValue)) {\n-                        filterEntity = true;\n-                    }\n-                    break;\n+            case NAME:\n+                return !entity.getName().equalsIgnoreCase(filterValue);\n \n-                case STATUS:\n-                    if (!status.equalsIgnoreCase(filterValue)) {\n-                        filterEntity = true;\n-                    }\n-                    break;\n+            case STATUS:\n+                return  !status.equalsIgnoreCase(filterValue);\n \n-                case PIPELINES:\n-                    if (entity.getEntityType().equals(EntityType.PROCESS)\n-                            && !pipelines.contains(filterValue)) {\n-                        filterEntity = true;\n-                    }\n-                    break;\n+            case PIPELINES:\n+                return  entity.getEntityType().equals(EntityType.PROCESS) && !pipelines.contains(filterValue);\n \n-                case CLUSTER:\n-                    Set<String> clusters = EntityUtil.getClustersDefined(entity);\n-                    if (!clusters.contains(filterValue)) {\n-                        filterEntity = true;\n-                    }\n+            case CLUSTER:\n+                return  !EntityUtil.getClustersDefined(entity).contains(filterValue);\n \n-                default:\n-                    break;\n-                }\n-                if (filterEntity) {\n-                    break;\n-                }\n+            default:\n+                break;\n             }\n         }\n-        return filterEntity;\n+        return false;\n     }\n \n-    private ArrayList<Entity> sortEntities(ArrayList<Entity> entities, String orderBy, String sortOrder) {\n+    private List<Entity> sortEntities(List<Entity> entities, String orderBy, String sortOrder) {\n         // Sort the ArrayList using orderBy param\n         if (!StringUtils.isEmpty(orderBy)) {\n             EntityList.EntityFieldList orderByField = EntityList.EntityFieldList.valueOf(orderBy.toUpperCase());", "filename": "prism/src/main/java/org/apache/falcon/resource/AbstractEntityManager.java"}, {"additions": 75, "raw_url": "https://github.com/apache/falcon/raw/20a13e3b458526153a884ce6135162245ab016cd/prism/src/main/java/org/apache/falcon/resource/AbstractInstanceManager.java", "blob_url": "https://github.com/apache/falcon/blob/20a13e3b458526153a884ce6135162245ab016cd/prism/src/main/java/org/apache/falcon/resource/AbstractInstanceManager.java", "sha": "8dd57edb4131c52066adcb513b1e71df03b3ec49", "changes": 133, "status": "modified", "deletions": 58, "contents_url": "https://api.github.com/repos/apache/falcon/contents/prism/src/main/java/org/apache/falcon/resource/AbstractInstanceManager.java?ref=20a13e3b458526153a884ce6135162245ab016cd", "patch": "@@ -95,6 +95,7 @@ public InstancesResult getRunningInstances(String type, String entity,\n         try {\n             lifeCycles = checkAndUpdateLifeCycle(lifeCycles, type);\n             validateNotEmpty(\"entityName\", entity);\n+            validateInstanceFilterByClause(filterBy);\n             AbstractWorkflowEngine wfEngine = getWorkflowEngine();\n             Entity entityObject = EntityUtil.getEntity(type, entity);\n             return getInstanceResultSubset(wfEngine.getRunningInstances(entityObject, lifeCycles),\n@@ -105,6 +106,25 @@ public InstancesResult getRunningInstances(String type, String entity,\n         }\n     }\n \n+    protected void validateInstanceFilterByClause(String entityFilterByClause) {\n+        Map<String, String> filterByFieldsValues = getFilterByFieldsValues(entityFilterByClause);\n+        for (Map.Entry<String, String> entry : filterByFieldsValues.entrySet()) {\n+            try {\n+                InstancesResult.InstanceFilterFields filterKey =\n+                        InstancesResult.InstanceFilterFields .valueOf(entry.getKey());\n+                if (filterKey == InstancesResult.InstanceFilterFields.STARTEDAFTER) {\n+                    EntityUtil.parseDateUTC(entry.getValue());\n+                }\n+            } catch (IllegalArgumentException e) {\n+                throw FalconWebException.newInstanceException(\n+                        \"Invalid filter key: \" + entry.getKey(), Response.Status.BAD_REQUEST);\n+            } catch (FalconException e) {\n+                throw FalconWebException.newInstanceException(\n+                        \"Invalid date value for key: \" + entry.getKey(), Response.Status.BAD_REQUEST);\n+            }\n+        }\n+    }\n+\n     //SUSPEND CHECKSTYLE CHECK ParameterNumberCheck\n     public InstancesResult getInstances(String type, String entity, String startStr, String endStr,\n                                         String colo, List<LifeCycle> lifeCycles,\n@@ -123,6 +143,7 @@ public InstancesResult getStatus(String type, String entity, String startStr, St\n         try {\n             lifeCycles = checkAndUpdateLifeCycle(lifeCycles, type);\n             validateParams(type, entity);\n+            validateInstanceFilterByClause(filterBy);\n             Entity entityObject = EntityUtil.getEntity(type, entity);\n             Pair<Date, Date> startAndEndDate = getStartAndEndDate(entityObject, startStr, endStr);\n \n@@ -149,7 +170,8 @@ public InstancesSummaryResult getSummary(String type, String entity, String star\n             Pair<Date, Date> startAndEndDate = getStartAndEndDate(entityObject, startStr, endStr);\n \n             AbstractWorkflowEngine wfEngine = getWorkflowEngine();\n-            return wfEngine.getSummary(entityObject, startAndEndDate.first, startAndEndDate.second, lifeCycles);\n+            return wfEngine.getSummary(entityObject, startAndEndDate.first, startAndEndDate.second,\n+                    lifeCycles);\n         } catch (Throwable e) {\n             LOG.error(\"Failed to get instances status\", e);\n             throw FalconWebException.newInstanceSummaryException(e, Response.Status.BAD_REQUEST);\n@@ -179,18 +201,17 @@ public InstancesResult getLogs(String type, String entity, String startStr, Stri\n     }\n \n     private InstancesResult getInstanceResultSubset(InstancesResult resultSet, String filterBy,\n-                                                    String orderBy, String sortOrder,\n-                                                    Integer offset, Integer numResults) {\n-\n-        ArrayList<Instance> instanceSet = new ArrayList<Instance>();\n+                                                    String orderBy, String sortOrder, Integer offset,\n+                                                    Integer numResults) throws FalconException {\n         if (resultSet.getInstances() == null) {\n             // return the empty resultSet\n             resultSet.setInstances(new Instance[0]);\n             return resultSet;\n         }\n \n         // Filter instances\n-        instanceSet = filteredInstanceSet(resultSet, instanceSet, getFilterByFieldsValues(filterBy));\n+        Map<String, String> filterByFieldsValues = getFilterByFieldsValues(filterBy);\n+        List<Instance> instanceSet = getFilteredInstanceSet(resultSet, filterByFieldsValues);\n \n         int pageCount = super.getRequiredNumberOfResults(instanceSet.size(), offset, numResults);\n         InstancesResult result = new InstancesResult(resultSet.getStatus(), resultSet.getMessage());\n@@ -201,69 +222,65 @@ private InstancesResult getInstanceResultSubset(InstancesResult resultSet, Strin\n         }\n         // Sort the ArrayList using orderBy\n         instanceSet = sortInstances(instanceSet, orderBy, sortOrder);\n-        result.setCollection(instanceSet.subList(offset, (offset+pageCount)).toArray(new Instance[pageCount]));\n+        result.setCollection(instanceSet.subList(\n+                offset, (offset+pageCount)).toArray(new Instance[pageCount]));\n         return result;\n     }\n \n-    private ArrayList<Instance> filteredInstanceSet(InstancesResult resultSet, ArrayList<Instance> instanceSet,\n-                                                  HashMap<String, String> filterByFieldsValues) {\n-\n-        for (Instance instance : resultSet.getInstances()) {\n-            boolean addInstance = true;\n-            // If filterBy is empty, return all instances. Else return instances with matching filter.\n-            if (filterByFieldsValues.size() > 0) {\n-                String filterValue;\n-                for (Map.Entry<String, String> pair : filterByFieldsValues.entrySet()) {\n-                    filterValue = pair.getValue();\n-                    if (filterValue.equals(\"\")) {\n-                        continue;\n-                    }\n-                    try {\n-                        switch (InstancesResult.InstanceFilterFields.valueOf(pair.getKey().toUpperCase())) {\n-                        case STATUS:\n-                            String status = \"\";\n-                            if (instance.getStatus() != null) {\n-                                status = instance.getStatus().toString();\n-                            }\n-                            if (!status.equalsIgnoreCase(filterValue)) {\n-                                addInstance = false;\n-                            }\n-                            break;\n-                        case CLUSTER:\n-                            if (!instance.getCluster().equalsIgnoreCase(filterValue)) {\n-                                addInstance = false;\n-                            }\n-                            break;\n-                        case SOURCECLUSTER:\n-                            if (!instance.getSourceCluster().equalsIgnoreCase(filterValue)) {\n-                                addInstance = false;\n-                            }\n-                            break;\n-                        case STARTEDAFTER:\n-                            if (instance.getStartTime().before(EntityUtil.parseDateUTC(filterValue))) {\n-                                addInstance = false;\n-                            }\n-                            break;\n-                        default:\n-                            break;\n-                        }\n-                    } catch (Exception e) {\n-                        LOG.error(\"Invalid entry for filterBy field\", e);\n-                        throw FalconWebException.newInstanceException(e, Response.Status.BAD_REQUEST);\n-                    }\n-                    if (!addInstance) {\n-                        break;\n-                    }\n+    private List<Instance> getFilteredInstanceSet(InstancesResult resultSet,\n+                                                  Map<String, String> filterByFieldsValues)\n+        throws FalconException {\n+        // If filterBy is empty, return all instances. Else return instances with matching filter.\n+        if (filterByFieldsValues.size() == 0) {\n+            return Arrays.asList(resultSet.getInstances());\n+        }\n+\n+        List<Instance> instanceSet = new ArrayList<Instance>();\n+        for (Instance instance : resultSet.getInstances()) {   // for each instance\n+            boolean isInstanceFiltered = false;\n+\n+            // for each filter\n+            for (Map.Entry<String, String> pair : filterByFieldsValues.entrySet()) {\n+                if (isInstanceFiltered(instance, pair)) { // wait until all filters are applied\n+                    isInstanceFiltered = true;\n+                    break;  // no use to continue other filters as the current one filtered this\n                 }\n             }\n-            if (addInstance) {\n+\n+            if (!isInstanceFiltered) {  // survived all filters\n                 instanceSet.add(instance);\n             }\n         }\n+\n         return instanceSet;\n     }\n \n-    private ArrayList<Instance> sortInstances(ArrayList<Instance> instanceSet,\n+    private boolean isInstanceFiltered(Instance instance,\n+                                       Map.Entry<String, String> pair) throws FalconException {\n+        final String filterValue = pair.getValue();\n+        switch (InstancesResult.InstanceFilterFields.valueOf(pair.getKey().toUpperCase())) {\n+        case STATUS:\n+            return instance.getStatus() == null\n+                    || !instance.getStatus().toString().equalsIgnoreCase(filterValue);\n+\n+        case CLUSTER:\n+            return instance.getCluster() == null\n+                    || !instance.getCluster().equalsIgnoreCase(filterValue);\n+\n+        case SOURCECLUSTER:\n+            return instance.getSourceCluster() == null\n+                    || !instance.getSourceCluster().equalsIgnoreCase(filterValue);\n+\n+        case STARTEDAFTER:\n+            return instance.getStartTime() == null\n+                    || instance.getStartTime().before(EntityUtil.parseDateUTC(filterValue));\n+\n+        default:\n+            return true;\n+        }\n+    }\n+\n+    private List<Instance> sortInstances(List<Instance> instanceSet,\n                                               String orderBy, String sortOrder) {\n         final String order = getValidSortOrder(sortOrder, orderBy);\n         if (orderBy.equals(\"status\")) {", "filename": "prism/src/main/java/org/apache/falcon/resource/AbstractInstanceManager.java"}, {"additions": 1, "raw_url": "https://github.com/apache/falcon/raw/20a13e3b458526153a884ce6135162245ab016cd/prism/src/main/java/org/apache/falcon/resource/AbstractSchedulableEntityManager.java", "blob_url": "https://github.com/apache/falcon/blob/20a13e3b458526153a884ce6135162245ab016cd/prism/src/main/java/org/apache/falcon/resource/AbstractSchedulableEntityManager.java", "sha": "687fde9cb7645524c9cfd667998be03de6cf2737", "changes": 1, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/prism/src/main/java/org/apache/falcon/resource/AbstractSchedulableEntityManager.java?ref=20a13e3b458526153a884ce6135162245ab016cd", "patch": "@@ -176,6 +176,7 @@ public EntitySummaryResult getEntitySummary(String type, String cluster, String\n                                                 Integer resultsPerPage, Integer numInstances) {\n         HashSet<String> fieldSet = new HashSet<String>(Arrays.asList(fields.toLowerCase().split(\",\")));\n         Pair<Date, Date> startAndEndDates = getStartEndDatesForSummary(startDate, endDate);\n+        validateEntityFilterByClause(filterBy);\n \n         List<Entity> entities;\n         String colo;", "filename": "prism/src/main/java/org/apache/falcon/resource/AbstractSchedulableEntityManager.java"}, {"additions": 14, "raw_url": "https://github.com/apache/falcon/raw/20a13e3b458526153a884ce6135162245ab016cd/webapp/src/test/java/org/apache/falcon/cli/FalconCLIIT.java", "blob_url": "https://github.com/apache/falcon/blob/20a13e3b458526153a884ce6135162245ab016cd/webapp/src/test/java/org/apache/falcon/cli/FalconCLIIT.java", "sha": "88aee0cc8ed00b23a816b62a63a88139ddc981f3", "changes": 20, "status": "modified", "deletions": 6, "contents_url": "https://api.github.com/repos/apache/falcon/contents/webapp/src/test/java/org/apache/falcon/cli/FalconCLIIT.java?ref=20a13e3b458526153a884ce6135162245ab016cd", "patch": "@@ -29,10 +29,10 @@\n \n import java.io.File;\n import java.io.FileOutputStream;\n+import java.io.IOException;\n import java.io.InputStream;\n import java.io.OutputStream;\n import java.io.PrintStream;\n-import java.io.IOException;\n import java.util.Date;\n import java.util.Map;\n import java.util.Properties;\n@@ -482,11 +482,24 @@ public void testInstanceRunningAndStatusCommands() throws Exception {\n                         + \" -start \"+ START_INSTANCE\n                         + \" -filterBy STATUS:SUCCEEDED,STARTEDAFTER:\"+START_INSTANCE\n                         + \" -orderBy startTime -sortOrder desc -offset 0 -numResults 1\"));\n+        Assert.assertEquals(0,\n+                executeWithURL(\"instance -status -type process -name \"\n+                        + overlay.get(\"processName\")\n+                        + \" -start \"+ START_INSTANCE\n+                        + \" -filterBy SOURCECLUSTER:\"+ overlay.get(\"cluster\")\n+                        + \" -orderBy startTime -sortOrder desc -offset 0 -numResults 1\"));\n+\n         Assert.assertEquals(0,\n                 executeWithURL(\"instance -list -type feed -lifecycle eviction -name \"\n                         + overlay.get(\"outputFeedName\")\n                         + \" -start \"+ SchemaHelper.getDateFormat().format(new Date())\n                         +\" -filterBy STATUS:SUCCEEDED -orderBy startTime -offset 0 -numResults 1\"));\n+        Assert.assertEquals(0,\n+                executeWithURL(\"instance -list -type feed -lifecycle eviction -name \"\n+                        + overlay.get(\"outputFeedName\")\n+                        + \" -start \"+ SchemaHelper.getDateFormat().format(new Date())\n+                        +\" -filterBy SOURCECLUSTER:\" + overlay.get(\"src.cluster.name\")\n+                        + \" -orderBy startTime -offset 0 -numResults 1\"));\n         Assert.assertEquals(-1,\n                 executeWithURL(\"instance -status -type feed -lifecycle eviction -name \"\n                         + overlay.get(\"outputFeedName\")\n@@ -502,11 +515,6 @@ public void testInstanceRunningAndStatusCommands() throws Exception {\n                         + overlay.get(\"outputFeedName\")\n                         + \" -start \"+ SchemaHelper.getDateFormat().format(new Date())\n                         +\" -filterBy STATUS:SUCCEEDED -orderBy startTime -offset 1 -numResults 1\"));\n-        Assert.assertEquals(0,\n-                executeWithURL(\"instance -list -type feed -lifecycle eviction -name \"\n-                        + overlay.get(\"outputFeedName\")\n-                        + \" -start \"+ SchemaHelper.getDateFormat().format(new Date())\n-                        +\" -filterBy STATUS:SUCCEEDED -offset 0 -numResults 1\"));\n         // When you get a cluster for which there are no feed entities,\n         Assert.assertEquals(0,\n                 executeWithURL(\"entity -summary -type feed -cluster \" + overlay.get(\"cluster\") + \" -fields status,tags\"", "filename": "webapp/src/test/java/org/apache/falcon/cli/FalconCLIIT.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/9aad374ab75ca477ada47c4bd2b0aaacd656602a", "parent": "https://github.com/apache/falcon/commit/331ad145e172c4a862bb294578dfb333b39d28d6", "message": "FALCON-669 Missing optional workflow execution listeners configuration results in NPE. Contributed by Raghav Kumar Gautam", "bug_id": "falcon_13", "file": [{"additions": 3, "raw_url": "https://github.com/apache/falcon/raw/9aad374ab75ca477ada47c4bd2b0aaacd656602a/CHANGES.txt", "blob_url": "https://github.com/apache/falcon/blob/9aad374ab75ca477ada47c4bd2b0aaacd656602a/CHANGES.txt", "sha": "4a3bbc47a4dcd068642b54d1965bcfc13a46910b", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/CHANGES.txt?ref=9aad374ab75ca477ada47c4bd2b0aaacd656602a", "patch": "@@ -77,6 +77,9 @@ Trunk (Unreleased)\n   OPTIMIZATIONS\n \n   BUG FIXES\n+   FALCON-669 Missing optional workflow execution listeners configuration\n+   results in NPE (Raghav Kumar Gautam via Venkatesh Seetharam)\n+\n    FALCON-644 Falcon message producer masks errors in Post processing\n    (Venkatesh Seetharam)\n ", "filename": "CHANGES.txt"}, {"additions": 5, "raw_url": "https://github.com/apache/falcon/raw/9aad374ab75ca477ada47c4bd2b0aaacd656602a/common/src/main/java/org/apache/falcon/workflow/WorkflowJobEndNotificationService.java", "blob_url": "https://github.com/apache/falcon/blob/9aad374ab75ca477ada47c4bd2b0aaacd656602a/common/src/main/java/org/apache/falcon/workflow/WorkflowJobEndNotificationService.java", "sha": "fb2d58d119aeaebd7b56509865fbcc72828c6312", "changes": 5, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/common/src/main/java/org/apache/falcon/workflow/WorkflowJobEndNotificationService.java?ref=9aad374ab75ca477ada47c4bd2b0aaacd656602a", "patch": "@@ -18,6 +18,7 @@\n \n package org.apache.falcon.workflow;\n \n+import org.apache.commons.lang.StringUtils;\n import org.apache.falcon.FalconException;\n import org.apache.falcon.aspect.GenericAlert;\n import org.apache.falcon.entity.v0.SchemaHelper;\n@@ -54,6 +55,10 @@ public String getName() {\n     public void init() throws FalconException {\n         String listenerClassNames = StartupProperties.get().getProperty(\n                 \"workflow.execution.listeners\");\n+        if (StringUtils.isEmpty(listenerClassNames)) {\n+            return;\n+        }\n+\n         for (String listenerClassName : listenerClassNames.split(\",\")) {\n             listenerClassName = listenerClassName.trim();\n             if (listenerClassName.isEmpty()) {", "filename": "common/src/main/java/org/apache/falcon/workflow/WorkflowJobEndNotificationService.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/e01dd79c73fa6bc9623dbdd87e7981eff1796c6c", "parent": "https://github.com/apache/falcon/commit/662adb2154cbd47bbdaebceae529013ed37d125f", "message": "FALCON-460 Concurrent deletion of same entity results in NPE. Contributed by Sowmya Ramesh", "bug_id": "falcon_14", "file": [{"additions": 3, "raw_url": "https://github.com/apache/falcon/raw/e01dd79c73fa6bc9623dbdd87e7981eff1796c6c/CHANGES.txt", "blob_url": "https://github.com/apache/falcon/blob/e01dd79c73fa6bc9623dbdd87e7981eff1796c6c/CHANGES.txt", "sha": "98b782bbbb4cd02fe6fa7c01300b72e009ce8460", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/CHANGES.txt?ref=e01dd79c73fa6bc9623dbdd87e7981eff1796c6c", "patch": "@@ -16,6 +16,9 @@ Trunk (Unreleased)\n   OPTIMIZATIONS\n \n   BUG FIXES\n+   FALCON-460 Concurrent deletion of same entity results in NPE (Sowmya Ramesh\n+   via Venkatesh Seetharam)\n+\n    FALCON-459 Lineage resource API fails with NPE for bad query params\n    (Sowmya Ramesh via Venkatesh Seetharam)\n ", "filename": "CHANGES.txt"}, {"additions": 1, "raw_url": "https://github.com/apache/falcon/raw/e01dd79c73fa6bc9623dbdd87e7981eff1796c6c/common/src/main/java/org/apache/falcon/entity/store/ConfigurationStore.java", "blob_url": "https://github.com/apache/falcon/blob/e01dd79c73fa6bc9623dbdd87e7981eff1796c6c/common/src/main/java/org/apache/falcon/entity/store/ConfigurationStore.java", "sha": "cb594d1c7ccc769cd9f5d1a8540b1dad35d21f0c", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/falcon/contents/common/src/main/java/org/apache/falcon/entity/store/ConfigurationStore.java?ref=e01dd79c73fa6bc9623dbdd87e7981eff1796c6c", "patch": "@@ -275,7 +275,7 @@ public synchronized void initiateUpdate(Entity entity) throws FalconException {\n      *         exist\n      * @throws FalconException\n      */\n-    public boolean remove(EntityType type, String name) throws FalconException {\n+    public synchronized boolean remove(EntityType type, String name) throws FalconException {\n         Map<String, Entity> entityMap = dictionary.get(type);\n         if (entityMap.containsKey(name)) {\n             try {", "filename": "common/src/main/java/org/apache/falcon/entity/store/ConfigurationStore.java"}, {"additions": 18, "raw_url": "https://github.com/apache/falcon/raw/e01dd79c73fa6bc9623dbdd87e7981eff1796c6c/common/src/test/java/org/apache/falcon/entity/store/ConfigurationStoreTest.java", "blob_url": "https://github.com/apache/falcon/blob/e01dd79c73fa6bc9623dbdd87e7981eff1796c6c/common/src/test/java/org/apache/falcon/entity/store/ConfigurationStoreTest.java", "sha": "9886d883c4ecc5b9393dd91b829646af30dfc2b6", "changes": 18, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/common/src/test/java/org/apache/falcon/entity/store/ConfigurationStoreTest.java?ref=e01dd79c73fa6bc9623dbdd87e7981eff1796c6c", "patch": "@@ -98,6 +98,7 @@ public void testRemove() throws Exception {\n         Process process = new Process();\n         process.setName(\"remove\");\n         store.publish(EntityType.PROCESS, process);\n+\n         Process p = store.get(EntityType.PROCESS, \"remove\");\n         Assert.assertEquals(p, process);\n         store.remove(EntityType.PROCESS, \"remove\");\n@@ -115,6 +116,23 @@ public void testRemove() throws Exception {\n         store.unregisterListener(listener);\n     }\n \n+\n+    @Test(threadPoolSize = 3, invocationCount = 6)\n+    public void testConcurrentRemoves() throws Exception {\n+        Process process = new Process();\n+        process.setName(\"remove\");\n+        try {\n+            store.publish(EntityType.PROCESS, process);\n+        } catch(EntityAlreadyExistsException e) {\n+            // Ignore this\n+        }\n+        Process p = store.get(EntityType.PROCESS, \"remove\");\n+        Assert.assertEquals(p, process);\n+        store.remove(EntityType.PROCESS, \"remove\");\n+        p = store.get(EntityType.PROCESS, \"remove\");\n+        Assert.assertNull(p);\n+    }\n+\n     @BeforeSuite\n     @AfterSuite\n     public void cleanup() throws IOException {", "filename": "common/src/test/java/org/apache/falcon/entity/store/ConfigurationStoreTest.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/662adb2154cbd47bbdaebceae529013ed37d125f", "parent": "https://github.com/apache/falcon/commit/ab07b44bb76237765e6dc2d8c576d69ac70a59a9", "message": "FALCON-459 Lineage resource API fails with NPE for bad query params. Contributed by Sowmya Ramesh", "bug_id": "falcon_15", "file": [{"additions": 3, "raw_url": "https://github.com/apache/falcon/raw/662adb2154cbd47bbdaebceae529013ed37d125f/CHANGES.txt", "blob_url": "https://github.com/apache/falcon/blob/662adb2154cbd47bbdaebceae529013ed37d125f/CHANGES.txt", "sha": "b24fc4b0f4de27d5ac55cc2a559eb5631c401cef", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/CHANGES.txt?ref=662adb2154cbd47bbdaebceae529013ed37d125f", "patch": "@@ -16,6 +16,9 @@ Trunk (Unreleased)\n   OPTIMIZATIONS\n \n   BUG FIXES\n+   FALCON-459 Lineage resource API fails with NPE for bad query params\n+   (Sowmya Ramesh via Venkatesh Seetharam)\n+\n    FALCON-456 Custom DistCp conflict with core DistCp in container classpath\n    fails falcon workflows (Venkatesh Seetharam)\n ", "filename": "CHANGES.txt"}, {"additions": 30, "raw_url": "https://github.com/apache/falcon/raw/662adb2154cbd47bbdaebceae529013ed37d125f/prism/src/main/java/org/apache/falcon/resource/metadata/LineageMetadataResource.java", "blob_url": "https://github.com/apache/falcon/blob/662adb2154cbd47bbdaebceae529013ed37d125f/prism/src/main/java/org/apache/falcon/resource/metadata/LineageMetadataResource.java", "sha": "cf6b6b1ea3fa47a0105ae5a0a118f9aa560355ff", "changes": 42, "status": "modified", "deletions": 12, "contents_url": "https://api.github.com/repos/apache/falcon/contents/prism/src/main/java/org/apache/falcon/resource/metadata/LineageMetadataResource.java?ref=662adb2154cbd47bbdaebceae529013ed37d125f", "patch": "@@ -38,6 +38,7 @@\n import org.codehaus.jettison.json.JSONObject;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n+import org.apache.commons.lang.StringUtils;\n \n import javax.ws.rs.DefaultValue;\n import javax.ws.rs.GET;\n@@ -143,6 +144,7 @@ public Response getVertices() {\n     public Response getVertex(@PathParam(\"id\") final String vertexId) {\n         checkIfMetadataMappingServiceIsEnabled();\n         LOG.info(\"Get vertex for vertexId= {}\", vertexId);\n+        validateInputs(\"Invalid argument: vertex id passed is null or empty.\", vertexId);\n         try {\n             Vertex vertex = findVertex(vertexId);\n \n@@ -182,6 +184,7 @@ public Response getVertexProperties(@PathParam(\"id\") final String vertexId,\n                                         final String relationships) {\n         checkIfMetadataMappingServiceIsEnabled();\n         LOG.info(\"Get vertex for vertexId= {}\", vertexId);\n+        validateInputs(\"Invalid argument: vertex id passed is null or empty.\", vertexId);\n         try {\n             Vertex vertex = findVertex(vertexId);\n \n@@ -281,6 +284,7 @@ public Response getVertices(@QueryParam(\"key\") final String key,\n                                 @QueryParam(\"value\") final String value) {\n         checkIfMetadataMappingServiceIsEnabled();\n         LOG.info(\"Get vertices for property key= {}, value= {}\", key, value);\n+        validateInputs(\"Invalid argument: key or value passed is null or empty.\", key, value);\n         try {\n             JSONObject response = buildJSONResponse(getGraph().getVertices(key, value));\n             return Response.ok(response).build();\n@@ -305,6 +309,8 @@ public Response getVertexEdges(@PathParam(\"id\") String vertexId,\n                                    @PathParam(\"direction\") String direction) {\n         checkIfMetadataMappingServiceIsEnabled();\n         LOG.info(\"Get vertex edges for vertexId= {}, direction= {}\", vertexId, direction);\n+        // Validate vertex id. Direction is validated in VertexQueryArguments.\n+        validateInputs(\"Invalid argument: vertex id or direction passed is null or empty.\", vertexId, direction);\n         try {\n             Vertex vertex = findVertex(vertexId);\n \n@@ -394,6 +400,7 @@ public Response getEdges() {\n     public Response getEdge(@PathParam(\"id\") final String edgeId) {\n         checkIfMetadataMappingServiceIsEnabled();\n         LOG.info(\"Get vertex for edgeId= {}\", edgeId);\n+        validateInputs(\"Invalid argument: edge id passed is null or empty.\", edgeId);\n         try {\n             Edge edge = getGraph().getEdge(edgeId);\n             if (edge == null) {\n@@ -439,6 +446,17 @@ private void checkIfMetadataMappingServiceIsEnabled() {\n         }\n     }\n \n+    private static void validateInputs(String errorMsg, String... inputs) {\n+        for (String input : inputs) {\n+            if (StringUtils.isEmpty(input)) {\n+                throw new WebApplicationException(Response.status(Response.Status.BAD_REQUEST)\n+                        .entity(errorMsg)\n+                        .type(\"text/plain\")\n+                        .build());\n+            }\n+        }\n+    }\n+\n     private enum ReturnType {VERTICES, EDGES, COUNT, VERTEX_IDS}\n \n     public static final String OUT_E = \"outE\";\n@@ -464,51 +482,51 @@ private void checkIfMetadataMappingServiceIsEnabled() {\n         private final boolean countOnly;\n \n         public VertexQueryArguments(String directionSegment) {\n-            if (directionSegment.equals(OUT_E)) {\n+            if (OUT_E.equals(directionSegment)) {\n                 returnType = ReturnType.EDGES;\n                 queryDirection = Direction.OUT;\n                 countOnly = false;\n-            } else if (directionSegment.equals(IN_E)) {\n+            } else if (IN_E.equals(directionSegment)) {\n                 returnType = ReturnType.EDGES;\n                 queryDirection = Direction.IN;\n                 countOnly = false;\n-            } else if (directionSegment.equals(BOTH_E)) {\n+            } else if (BOTH_E.equals(directionSegment)) {\n                 returnType = ReturnType.EDGES;\n                 queryDirection = Direction.BOTH;\n                 countOnly = false;\n-            } else if (directionSegment.equals(OUT)) {\n+            } else if (OUT.equals(directionSegment)) {\n                 returnType = ReturnType.VERTICES;\n                 queryDirection = Direction.OUT;\n                 countOnly = false;\n-            } else if (directionSegment.equals(IN)) {\n+            } else if (IN.equals(directionSegment)) {\n                 returnType = ReturnType.VERTICES;\n                 queryDirection = Direction.IN;\n                 countOnly = false;\n-            } else if (directionSegment.equals(BOTH)) {\n+            } else if (BOTH.equals(directionSegment)) {\n                 returnType = ReturnType.VERTICES;\n                 queryDirection = Direction.BOTH;\n                 countOnly = false;\n-            } else if (directionSegment.equals(BOTH_COUNT)) {\n+            } else if (BOTH_COUNT.equals(directionSegment)) {\n                 returnType = ReturnType.COUNT;\n                 queryDirection = Direction.BOTH;\n                 countOnly = true;\n-            } else if (directionSegment.equals(IN_COUNT)) {\n+            } else if (IN_COUNT.equals(directionSegment)) {\n                 returnType = ReturnType.COUNT;\n                 queryDirection = Direction.IN;\n                 countOnly = true;\n-            } else if (directionSegment.equals(OUT_COUNT)) {\n+            } else if (OUT_COUNT.equals(directionSegment)) {\n                 returnType = ReturnType.COUNT;\n                 queryDirection = Direction.OUT;\n                 countOnly = true;\n-            } else if (directionSegment.equals(BOTH_IDS)) {\n+            } else if (BOTH_IDS.equals(directionSegment)) {\n                 returnType = ReturnType.VERTEX_IDS;\n                 queryDirection = Direction.BOTH;\n                 countOnly = false;\n-            } else if (directionSegment.equals(IN_IDS)) {\n+            } else if (IN_IDS.equals(directionSegment)) {\n                 returnType = ReturnType.VERTEX_IDS;\n                 queryDirection = Direction.IN;\n                 countOnly = false;\n-            } else if (directionSegment.equals(OUT_IDS)) {\n+            } else if (OUT_IDS.equals(directionSegment)) {\n                 returnType = ReturnType.VERTEX_IDS;\n                 queryDirection = Direction.OUT;\n                 countOnly = false;", "filename": "prism/src/main/java/org/apache/falcon/resource/metadata/LineageMetadataResource.java"}, {"additions": 21, "raw_url": "https://github.com/apache/falcon/raw/662adb2154cbd47bbdaebceae529013ed37d125f/prism/src/test/java/org/apache/falcon/resource/metadata/LineageMetadataResourceTest.java", "blob_url": "https://github.com/apache/falcon/blob/662adb2154cbd47bbdaebceae529013ed37d125f/prism/src/test/java/org/apache/falcon/resource/metadata/LineageMetadataResourceTest.java", "sha": "26c24c70f9a476e81ca2cd8aad08fa9a55cdf675", "changes": 21, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/prism/src/test/java/org/apache/falcon/resource/metadata/LineageMetadataResourceTest.java?ref=662adb2154cbd47bbdaebceae529013ed37d125f", "patch": "@@ -214,6 +214,18 @@ public void testGetVerticesWithKeyValue() throws Exception {\n         assertBasicVertexProperties(vertex, vertexProperties);\n     }\n \n+    @Test\n+    public void testGetVerticesWithInvalidKeyValue() throws Exception {\n+        LineageMetadataResource resource = new LineageMetadataResource();\n+        try {\n+            resource.getVertices(null, null);\n+        } catch(WebApplicationException e) {\n+            Assert.assertEquals(e.getResponse().getStatus(), Response.Status.BAD_REQUEST.getStatusCode());\n+            Assert.assertEquals(e.getResponse().getEntity().toString(),\n+                    \"Invalid argument: key or value passed is null or empty.\");\n+        }\n+    }\n+\n     @Test\n     public void testVertexEdgesForIdAndDirectionOut() throws Exception {\n         String processInstance = PROCESS_ENTITY_NAME + \"/2014-01-01T01:00Z\";\n@@ -265,6 +277,15 @@ public void testVertexEdgesForIdAndDirectionBoth() throws Exception {\n         verifyVertexEdgesCount(vertexId, LineageMetadataResource.BOTH_IDS, expectedSize);\n     }\n \n+\n+\n+    @Test (expectedExceptions = WebApplicationException.class)\n+    public void testVertexEdgesForIdAndInvalidDirection() throws Exception {\n+        LineageMetadataResource resource = new LineageMetadataResource();\n+        resource.getVertexEdges(\"0\", \"blah\");\n+        Assert.fail(\"The API call should have thrown an exception\");\n+    }\n+\n     private void verifyVertexEdges(String vertexId, String direction,\n                                    int expectedSize, List<String> expected) {\n         LineageMetadataResource resource = new LineageMetadataResource();", "filename": "prism/src/test/java/org/apache/falcon/resource/metadata/LineageMetadataResourceTest.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/f769933b63a0bd11a6fb766b324d312e69700add", "parent": "https://github.com/apache/falcon/commit/e2545b0874d206f3be88d4b3ac7003eae1161c44", "message": "FALCON-360 Lineage recording fails with NPE for processes with >1 inputs. Contributed by Venkatesh Seetharam", "bug_id": "falcon_16", "file": [{"additions": 3, "raw_url": "https://github.com/apache/falcon/raw/f769933b63a0bd11a6fb766b324d312e69700add/CHANGES.txt", "blob_url": "https://github.com/apache/falcon/blob/f769933b63a0bd11a6fb766b324d312e69700add/CHANGES.txt", "sha": "68d900ac5e9a2a42ce8387274884022bfba7d537", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/CHANGES.txt?ref=f769933b63a0bd11a6fb766b324d312e69700add", "patch": "@@ -152,6 +152,9 @@ Trunk (Unreleased)\n     FALCON-354 Bug when MetadataMappingService is not configured as one of the\n     application services. (Venkatesh Seetharam)\n \n+    FALCON-360 Lineage recording fails with NPE for processes with >1 inputs.\n+    (Venkatesh Seetharam)\n+\n Release Version: 0.4-incubating\n \n    NEW FEATURES", "filename": "CHANGES.txt"}, {"additions": 4, "raw_url": "https://github.com/apache/falcon/raw/f769933b63a0bd11a6fb766b324d312e69700add/common/src/main/java/org/apache/falcon/metadata/InstanceRelationshipGraphBuilder.java", "blob_url": "https://github.com/apache/falcon/blob/f769933b63a0bd11a6fb766b324d312e69700add/common/src/main/java/org/apache/falcon/metadata/InstanceRelationshipGraphBuilder.java", "sha": "b02ba9a5a1606c09a6d8f66c02e018458e7d65cd", "changes": 6, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/falcon/contents/common/src/main/java/org/apache/falcon/metadata/InstanceRelationshipGraphBuilder.java?ref=f769933b63a0bd11a6fb766b324d312e69700add", "patch": "@@ -139,9 +139,9 @@ public void addInputFeedInstances(Map<String, String> lineageMetadata,\n         }\n \n         String[] inputFeedNames =\n-                lineageMetadata.get(LineageArgs.INPUT_FEED_NAMES.getOptionName()).split(\",\");\n+                lineageMetadata.get(LineageArgs.INPUT_FEED_NAMES.getOptionName()).split(\"#\");\n         String[] inputFeedInstancePaths =\n-                lineageMetadata.get(LineageArgs.INPUT_FEED_PATHS.getOptionName()).split(\",\");\n+                lineageMetadata.get(LineageArgs.INPUT_FEED_PATHS.getOptionName()).split(\"#\");\n \n         addFeedInstances(inputFeedNames, inputFeedInstancePaths,\n                 processInstance, FEED_PROCESS_EDGE_LABEL, lineageMetadata);\n@@ -156,6 +156,8 @@ public void addFeedInstances(String[] feedNames, String[] feedInstancePaths,\n             String feedName = feedNames[index];\n             String feedInstancePath = feedInstancePaths[index];\n \n+            LOG.info(\"Computing feed instance for : name=\" + feedName + \", path= \"\n+                    + feedInstancePath + \", in cluster: \" + clusterName);\n             String feedInstanceName = getFeedInstanceName(feedName, clusterName, feedInstancePath);\n             LOG.info(\"Adding feed instance: \" + feedInstanceName);\n             Vertex feedInstance = addVertex(feedInstanceName, FEED_INSTANCE_TYPE,", "filename": "common/src/main/java/org/apache/falcon/metadata/InstanceRelationshipGraphBuilder.java"}, {"additions": 2, "raw_url": "https://github.com/apache/falcon/raw/f769933b63a0bd11a6fb766b324d312e69700add/common/src/test/java/org/apache/falcon/metadata/MetadataMappingServiceTest.java", "blob_url": "https://github.com/apache/falcon/blob/f769933b63a0bd11a6fb766b324d312e69700add/common/src/test/java/org/apache/falcon/metadata/MetadataMappingServiceTest.java", "sha": "f5733922fadc914d8b91d0f4aa5bfc770de34d59", "changes": 4, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/falcon/contents/common/src/test/java/org/apache/falcon/metadata/MetadataMappingServiceTest.java?ref=f769933b63a0bd11a6fb766b324d312e69700add", "patch": "@@ -74,9 +74,9 @@\n     public static final String WORKFLOW_NAME = \"imp-click-join-workflow\";\n     public static final String WORKFLOW_VERSION = \"1.0.9\";\n \n-    public static final String INPUT_FEED_NAMES = \"impression-feed,clicks-feed\";\n+    public static final String INPUT_FEED_NAMES = \"impression-feed#clicks-feed\";\n     public static final String INPUT_INSTANCE_PATHS =\n-        \"jail://global:00/falcon/impression-feed/20140101,jail://global:00/falcon/clicks-feed/20140101\";\n+        \"jail://global:00/falcon/impression-feed/20140101#jail://global:00/falcon/clicks-feed/20140101\";\n \n     public static final String OUTPUT_FEED_NAMES = \"imp-click-join1,imp-click-join2\";\n     public static final String OUTPUT_INSTANCE_PATHS =", "filename": "common/src/test/java/org/apache/falcon/metadata/MetadataMappingServiceTest.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/464442af25a87f9b40c6b017f75da8e083449ad1", "parent": "https://github.com/apache/falcon/commit/d57c71e6e23a4de221f2e01a4021005f51564fae", "message": "FALCON-331 Summary API returning NPE if only start is passed. Contributed by Shwetha GS", "bug_id": "falcon_17", "file": [{"additions": 2, "raw_url": "https://github.com/apache/falcon/raw/464442af25a87f9b40c6b017f75da8e083449ad1/CHANGES.txt", "blob_url": "https://github.com/apache/falcon/blob/464442af25a87f9b40c6b017f75da8e083449ad1/CHANGES.txt", "sha": "237646cad1732e54fecc00bd36b60251c497a1ef", "changes": 2, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/CHANGES.txt?ref=464442af25a87f9b40c6b017f75da8e083449ad1", "patch": "@@ -57,6 +57,8 @@ Trunk (Unreleased)\n     FALCON-123 Improve build speeds in falcon. (Srikanth Sundarrajan via Shwetha GS)\n \n   BUG FIXES\n+    FALCON-331 Summary API returning NPE if only start is passed. (Shwetha GS)\n+\n     FALCON-323 Summary API deserialization fails if array has only one element.\n     (Shwetha GS via Shaik Idris)\n ", "filename": "CHANGES.txt"}, {"additions": 2, "raw_url": "https://github.com/apache/falcon/raw/464442af25a87f9b40c6b017f75da8e083449ad1/oozie/src/main/java/org/apache/falcon/workflow/engine/OozieWorkflowEngine.java", "blob_url": "https://github.com/apache/falcon/blob/464442af25a87f9b40c6b017f75da8e083449ad1/oozie/src/main/java/org/apache/falcon/workflow/engine/OozieWorkflowEngine.java", "sha": "328cd82ad3a56d1a1e97459682d63a8bc9d805de", "changes": 3, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/falcon/contents/oozie/src/main/java/org/apache/falcon/workflow/engine/OozieWorkflowEngine.java?ref=464442af25a87f9b40c6b017f75da8e083449ad1", "patch": "@@ -564,7 +564,8 @@ private InstancesSummaryResult doSummaryJobAction(Entity entity,\n                 Frequency freq = createFrequency(String.valueOf(coord.getFrequency()), coord.getTimeUnit());\n                 TimeZone tz = EntityUtil.getTimeZone(coord.getTimeZone());\n                 Date iterStart = EntityUtil.getNextStartTime(coord.getStartTime(), freq, tz, start);\n-                Date iterEnd = (coord.getLastActionTime().before(end) ? coord.getLastActionTime() : end);\n+                Date iterEnd = (coord.getLastActionTime() != null && coord.getLastActionTime().before(end) ?\n+                        coord.getLastActionTime() : end);\n \n                 if (i == (applicableCoords.size() - 1)) {\n                     isLastCoord = true;", "filename": "oozie/src/main/java/org/apache/falcon/workflow/engine/OozieWorkflowEngine.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/2eaaa4b20ca16b8bba8b2e4a4fa4e166d2d4a943", "parent": "https://github.com/apache/falcon/commit/5b5113d19d891872fa48b8c524347a49f3f1cdf5", "message": "FALCON-1117 Falcon Client throws NPE on no emtpy result in reverse lookup. Contributed by Ajay Yadava", "bug_id": "falcon_18", "file": [{"additions": 3, "raw_url": "https://github.com/apache/falcon/raw/2eaaa4b20ca16b8bba8b2e4a4fa4e166d2d4a943/CHANGES.txt", "blob_url": "https://github.com/apache/falcon/blob/2eaaa4b20ca16b8bba8b2e4a4fa4e166d2d4a943/CHANGES.txt", "sha": "afd726631426ddf283725fa59dd9f88bbc453036", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/CHANGES.txt?ref=2eaaa4b20ca16b8bba8b2e4a4fa4e166d2d4a943", "patch": "@@ -117,6 +117,9 @@ Trunk (Unreleased)\n    (Suhas vasu)\n \n   BUG FIXES\n+   FALCON-1117 Falcon Client throws NPE on no emtpy result in\n+   reverse lookup (Ajay Yadava via Suhas Vasu)\n+\n    FALCON-1099 FeedReplicator: throws NPE (Sowmya Ramesh via Suhas Vasu)\n \n    FALCON-1064 Build hangs at the following test: JMSMessageProducerTest", "filename": "CHANGES.txt"}, {"additions": 8, "raw_url": "https://github.com/apache/falcon/raw/2eaaa4b20ca16b8bba8b2e4a4fa4e166d2d4a943/client/src/main/java/org/apache/falcon/ResponseHelper.java", "blob_url": "https://github.com/apache/falcon/blob/2eaaa4b20ca16b8bba8b2e4a4fa4e166d2d4a943/client/src/main/java/org/apache/falcon/ResponseHelper.java", "sha": "666e4183d29b2ae36749bd8514ea4ca95eb83f1f", "changes": 12, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/falcon/contents/client/src/main/java/org/apache/falcon/ResponseHelper.java?ref=2eaaa4b20ca16b8bba8b2e4a4fa4e166d2d4a943", "patch": "@@ -267,10 +267,14 @@ public static String getString(InstancesSummaryResult result) {\n \n     public static String getString(FeedLookupResult feedLookupResult) {\n         StringBuilder sb = new StringBuilder();\n-        sb.append(feedLookupResult.toString());\n-        sb.append(\"\\nAdditional Information:\\n\");\n-        sb.append(\"Response: \").append(feedLookupResult.getMessage());\n-        sb.append(\"Request Id: \").append(feedLookupResult.getRequestId());\n+        String results = feedLookupResult.toString();\n+        if (StringUtils.isEmpty(results)) {\n+            sb.append(\"No matching feeds found!\");\n+        } else {\n+            sb.append(results);\n+        }\n+        sb.append(\"\\n\\nResponse: \").append(feedLookupResult.getMessage());\n+        sb.append(\"\\nRequest Id: \").append(feedLookupResult.getRequestId());\n         return sb.toString();\n     }\n }", "filename": "client/src/main/java/org/apache/falcon/ResponseHelper.java"}, {"additions": 4, "raw_url": "https://github.com/apache/falcon/raw/2eaaa4b20ca16b8bba8b2e4a4fa4e166d2d4a943/client/src/main/java/org/apache/falcon/resource/FeedLookupResult.java", "blob_url": "https://github.com/apache/falcon/blob/2eaaa4b20ca16b8bba8b2e4a4fa4e166d2d4a943/client/src/main/java/org/apache/falcon/resource/FeedLookupResult.java", "sha": "11988276853b0ae2379e71ab90f304abc0223ed1", "changes": 6, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/falcon/contents/client/src/main/java/org/apache/falcon/resource/FeedLookupResult.java?ref=2eaaa4b20ca16b8bba8b2e4a4fa4e166d2d4a943", "patch": "@@ -57,8 +57,10 @@ public void setElements(FeedProperties[] elements) {\n     @Override\n     public String toString() {\n         StringBuilder buffer = new StringBuilder();\n-        for (FeedProperties element : elements) {\n-            buffer.append(element.toString());\n+        if (elements != null) {\n+            for (FeedProperties element : elements) {\n+                buffer.append(element.toString());\n+            }\n         }\n         return buffer.toString();\n     }", "filename": "client/src/main/java/org/apache/falcon/resource/FeedLookupResult.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/0681050a78533f091680a945548401047d419877", "parent": "https://github.com/apache/falcon/commit/a42042c36f2c45cb3cd576115b73dbe993433d98", "message": "NPE in oozieFeedMapper when cluster type=null and deletion of logs for rerun cases", "bug_id": "falcon_19", "file": [{"additions": 11, "raw_url": "https://github.com/apache/falcon/raw/0681050a78533f091680a945548401047d419877/common/src/main/java/org/apache/ivory/cleanup/AbstractCleanupHandler.java", "blob_url": "https://github.com/apache/falcon/blob/0681050a78533f091680a945548401047d419877/common/src/main/java/org/apache/ivory/cleanup/AbstractCleanupHandler.java", "sha": "de28922856979cb678b807d138b7608d85edd8df", "changes": 11, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/common/src/main/java/org/apache/ivory/cleanup/AbstractCleanupHandler.java?ref=0681050a78533f091680a945548401047d419877", "patch": "@@ -109,6 +109,7 @@ protected void delete(Cluster cluster, Entity entity, long retention)\n \t\t\t\t\t} else {\n \t\t\t\t\t\tLOG.info(\"Deleted path: \" + log.getPath());\n \t\t\t\t\t}\n+\t\t\t\t\tdeleteParentIfEmpty(getFileSystem(cluster),log.getPath().getParent());\n \t\t\t\t} catch (IOException e) {\n \t\t\t\t\tthrow new IvoryException(\" Unable to delete log file : \"\n \t\t\t\t\t\t\t+ log.getPath() + \" for entity \" + entity.getName()\n@@ -124,6 +125,16 @@ protected void delete(Cluster cluster, Entity entity, long retention)\n \n \t}\n \n+\tprivate void deleteParentIfEmpty(FileSystem fs, Path parent) throws IOException {\n+\t\t FileStatus[] files = fs.listStatus(parent);\n+\t\tif(files!=null && files.length==0){\n+\t\t\tLOG.info(\"Parent path: \"+parent+ \" is empty, deleting path\");\n+\t\t\tfs.delete(parent, true);\n+\t\t\tdeleteParentIfEmpty(fs,parent.getParent());\n+\t\t}\n+\t\t\n+\t}\n+\n \tpublic abstract void cleanup() throws IvoryException;\n \n \tprotected abstract Path getLogPath(Entity entity, String stagingPath);", "filename": "common/src/main/java/org/apache/ivory/cleanup/AbstractCleanupHandler.java"}, {"additions": 1, "raw_url": "https://github.com/apache/falcon/raw/0681050a78533f091680a945548401047d419877/common/src/main/java/org/apache/ivory/cleanup/FeedCleanupHandler.java", "blob_url": "https://github.com/apache/falcon/blob/0681050a78533f091680a945548401047d419877/common/src/main/java/org/apache/ivory/cleanup/FeedCleanupHandler.java", "sha": "1a4675b6a0e2b5fc2fc19c52dcad2287d9e666c4", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/falcon/contents/common/src/main/java/org/apache/ivory/cleanup/FeedCleanupHandler.java?ref=0681050a78533f091680a945548401047d419877", "patch": "@@ -49,7 +49,7 @@ public void cleanup() throws IvoryException {\n \t@Override\n \tprotected Path getLogPath(Entity entity, String stagingPath) {\n \t\tPath logPath = new Path(stagingPath, \"ivory/workflows/feed/\"\n-\t\t\t\t+ entity.getName() + \"/logs/job-*\");\n+\t\t\t\t+ entity.getName() + \"/logs/job-*/*/*\");\n \t\treturn logPath;\n \t}\n ", "filename": "common/src/main/java/org/apache/ivory/cleanup/FeedCleanupHandler.java"}, {"additions": 2, "raw_url": "https://github.com/apache/falcon/raw/0681050a78533f091680a945548401047d419877/common/src/main/java/org/apache/ivory/cleanup/ProcessCleanupHandler.java", "blob_url": "https://github.com/apache/falcon/blob/0681050a78533f091680a945548401047d419877/common/src/main/java/org/apache/ivory/cleanup/ProcessCleanupHandler.java", "sha": "2bc81cf3523a7f06dee79297495c338574f0d1dc", "changes": 4, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/falcon/contents/common/src/main/java/org/apache/ivory/cleanup/ProcessCleanupHandler.java?ref=0681050a78533f091680a945548401047d419877", "patch": "@@ -39,7 +39,7 @@ public void cleanup() throws IvoryException {\n \t\t\tfor (org.apache.ivory.entity.v0.process.Cluster cluster : process\n \t\t\t\t\t.getClusters().getClusters()) {\n \t\t\t\tLOG.info(\"Cleaning up logs for process:\" + processName\n-\t\t\t\t\t\t+ \" in  cluster: \" + cluster.getName());\n+\t\t\t\t\t\t+ \" in  cluster: \" + cluster.getName() + \" with retention: \"+retention);\n \t\t\t\tCluster currentCluster = STORE.get(EntityType.CLUSTER,\n \t\t\t\t\t\tcluster.getName());\n \t\t\t\tdelete(currentCluster, process, retention);\n@@ -51,7 +51,7 @@ public void cleanup() throws IvoryException {\n \t@Override\n \tprotected Path getLogPath(Entity entity, String stagingPath) {\n \t\tPath logPath = new Path(stagingPath, \"ivory/workflows/process/\"\n-\t\t\t\t+ entity.getName() + \"/logs/job-*\");\n+\t\t\t\t+ entity.getName() + \"/logs/job-*/*\");\n \t\treturn logPath;\n \t}\n ", "filename": "common/src/main/java/org/apache/ivory/cleanup/ProcessCleanupHandler.java"}, {"additions": 2, "raw_url": "https://github.com/apache/falcon/raw/0681050a78533f091680a945548401047d419877/common/src/test/java/org/apache/ivory/cleanup/LogCleanupServiceTest.java", "blob_url": "https://github.com/apache/falcon/blob/0681050a78533f091680a945548401047d419877/common/src/test/java/org/apache/ivory/cleanup/LogCleanupServiceTest.java", "sha": "7bc93539d224794658f67590ae2c38bbde4cf224", "changes": 3, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/falcon/contents/common/src/test/java/org/apache/ivory/cleanup/LogCleanupServiceTest.java?ref=0681050a78533f091680a945548401047d419877", "patch": "@@ -98,10 +98,11 @@ public void testProcessLogs() throws IOException, IvoryException,\n \t\tfs.mkdirs(instanceLogPath2);\n \t\tfs.mkdirs(instanceLogPath3);\n \t\tfs.mkdirs(instanceLogPath4);\n-\t\tThread.sleep(61000);\n+\n \t\t// fs.setTimes wont work on dirs\n \t\tfs.createNewFile(new Path(instanceLogPath, \"oozie.log\"));\n \t\tfs.createNewFile(new Path(instanceLogPath, \"pigAction_SUCCEEDED.log\"));\n+\t\tThread.sleep(61000);\n \n \t\tAbstractCleanupHandler processCleanupHandler = new ProcessCleanupHandler();\n \t\tprocessCleanupHandler.cleanup();", "filename": "common/src/test/java/org/apache/ivory/cleanup/LogCleanupServiceTest.java"}, {"additions": 1, "raw_url": "https://github.com/apache/falcon/raw/0681050a78533f091680a945548401047d419877/feed/src/main/java/org/apache/ivory/converter/OozieFeedMapper.java", "blob_url": "https://github.com/apache/falcon/blob/0681050a78533f091680a945548401047d419877/feed/src/main/java/org/apache/ivory/converter/OozieFeedMapper.java", "sha": "3838ffc3a843d7d33af364c57f72cf8691669d1c", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/falcon/contents/feed/src/main/java/org/apache/ivory/converter/OozieFeedMapper.java?ref=0681050a78533f091680a945548401047d419877", "patch": "@@ -146,7 +146,7 @@ private ACTION getRetentionWorkflowAction(Cluster cluster, Path wfPath, String w\n             createReplicatonWorkflow(targetCluster, basePath, coordName);\n             \n             for (org.apache.ivory.entity.v0.feed.Cluster feedCluster : feed.getClusters().getClusters()) {\n-                if (feedCluster.getType().equals(ClusterType.SOURCE)) {\n+                if (feedCluster.getType()==ClusterType.SOURCE) {\n                     COORDINATORAPP coord = createAndGetCoord(feed,\n                             (Cluster) ConfigurationStore.get().get(EntityType.CLUSTER, feedCluster.getName()), targetCluster,\n                             bundlePath);", "filename": "feed/src/main/java/org/apache/ivory/converter/OozieFeedMapper.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/85427981afeacef84ef3c10fc5fc4190cf291545", "parent": "https://github.com/apache/falcon/commit/7827c39ea92d351865e02a60a3f82149670bfde1", "message": "FALCON-598 ProcessHelper throws NPE if the process has no inputs OR no outputs defined. Contributed by Balu Vellanki", "bug_id": "falcon_20", "file": [{"additions": 3, "raw_url": "https://github.com/apache/falcon/raw/85427981afeacef84ef3c10fc5fc4190cf291545/CHANGES.txt", "blob_url": "https://github.com/apache/falcon/blob/85427981afeacef84ef3c10fc5fc4190cf291545/CHANGES.txt", "sha": "ae8e03d675b16250a4cf749373db003633078664", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/CHANGES.txt?ref=85427981afeacef84ef3c10fc5fc4190cf291545", "patch": "@@ -61,6 +61,9 @@ Trunk (Unreleased)\n   OPTIMIZATIONS\n \n   BUG FIXES\n+   FALCON-598 ProcessHelper throws NPE if the process has no inputs OR no\n+   outputs defined (Balu Vellanki via Venkatesh Seetharam)\n+\n    FALCON-583 Post processing is broken in current trunk\n    (Venkatesh Seetharam via Suhas Vasu)\n ", "filename": "CHANGES.txt"}, {"additions": 10, "raw_url": "https://github.com/apache/falcon/raw/85427981afeacef84ef3c10fc5fc4190cf291545/client/src/main/java/org/apache/falcon/resource/EntityList.java", "blob_url": "https://github.com/apache/falcon/blob/85427981afeacef84ef3c10fc5fc4190cf291545/client/src/main/java/org/apache/falcon/resource/EntityList.java", "sha": "2de177d19def70091476fe36f025b3565da6c091", "changes": 16, "status": "modified", "deletions": 6, "contents_url": "https://api.github.com/repos/apache/falcon/contents/client/src/main/java/org/apache/falcon/resource/EntityList.java?ref=85427981afeacef84ef3c10fc5fc4190cf291545", "patch": "@@ -140,14 +140,18 @@ public String toString() {\n         }\n \n         if (process != null) {\n-            for (Input i : process.getInputs().getInputs()) {\n-                if (i.getFeed().equals(entityNameToMatch)) {\n-                    tagList.add(\"Input\");\n+            if (process.getInputs() != null) {\n+                for (Input i : process.getInputs().getInputs()) {\n+                    if (i.getFeed().equals(entityNameToMatch)) {\n+                        tagList.add(\"Input\");\n+                    }\n                 }\n             }\n-            for (Output o : process.getOutputs().getOutputs()) {\n-                if (o.getFeed().equals(entityNameToMatch)) {\n-                    tagList.add(\"Output\");\n+            if (process.getOutputs() != null) {\n+                for (Output o : process.getOutputs().getOutputs()) {\n+                    if (o.getFeed().equals(entityNameToMatch)) {\n+                        tagList.add(\"Output\");\n+                    }\n                 }\n             }\n         }", "filename": "client/src/main/java/org/apache/falcon/resource/EntityList.java"}, {"additions": 8, "raw_url": "https://github.com/apache/falcon/raw/85427981afeacef84ef3c10fc5fc4190cf291545/common/src/main/java/org/apache/falcon/entity/ProcessHelper.java", "blob_url": "https://github.com/apache/falcon/blob/85427981afeacef84ef3c10fc5fc4190cf291545/common/src/main/java/org/apache/falcon/entity/ProcessHelper.java", "sha": "8e0c87a2087ccdd1f3f6676d07f73ba7aa0cd26b", "changes": 14, "status": "modified", "deletions": 6, "contents_url": "https://api.github.com/repos/apache/falcon/contents/common/src/main/java/org/apache/falcon/entity/ProcessHelper.java?ref=85427981afeacef84ef3c10fc5fc4190cf291545", "patch": "@@ -59,16 +59,18 @@ public static String getProcessWorkflowName(String workflowName, String processN\n             return storageType;\n         }\n \n-        for (Input input : process.getInputs().getInputs()) {\n-            Feed feed = EntityUtil.getEntity(EntityType.FEED, input.getFeed());\n-            storageType = FeedHelper.getStorageType(feed, cluster);\n-            if (Storage.TYPE.TABLE == storageType) {\n-                break;\n+        if (process.getInputs() != null) {\n+            for (Input input : process.getInputs().getInputs()) {\n+                Feed feed = EntityUtil.getEntity(EntityType.FEED, input.getFeed());\n+                storageType = FeedHelper.getStorageType(feed, cluster);\n+                if (Storage.TYPE.TABLE == storageType) {\n+                    break;\n+                }\n             }\n         }\n \n         // If input feeds storage type is file system check storage type of output feeds\n-        if (Storage.TYPE.FILESYSTEM == storageType) {\n+        if (process.getOutputs() != null && Storage.TYPE.FILESYSTEM == storageType) {\n             for (Output output : process.getOutputs().getOutputs()) {\n                 Feed feed = EntityUtil.getEntity(EntityType.FEED, output.getFeed());\n                 storageType = FeedHelper.getStorageType(feed, cluster);", "filename": "common/src/main/java/org/apache/falcon/entity/ProcessHelper.java"}, {"additions": 10, "raw_url": "https://github.com/apache/falcon/raw/85427981afeacef84ef3c10fc5fc4190cf291545/common/src/main/java/org/apache/falcon/metadata/EntityRelationshipGraphBuilder.java", "blob_url": "https://github.com/apache/falcon/blob/85427981afeacef84ef3c10fc5fc4190cf291545/common/src/main/java/org/apache/falcon/metadata/EntityRelationshipGraphBuilder.java", "sha": "1b7a068a321e5e2a2836799996e054aa629f163a", "changes": 14, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/falcon/contents/common/src/main/java/org/apache/falcon/metadata/EntityRelationshipGraphBuilder.java?ref=85427981afeacef84ef3c10fc5fc4190cf291545", "patch": "@@ -358,8 +358,11 @@ private void updateProcessInputs(Inputs oldProcessInputs, Inputs newProcessInput\n     }\n \n     public static boolean areSame(Inputs oldProcessInputs, Inputs newProcessInputs) {\n-        if (oldProcessInputs == null && newProcessInputs == null\n-                || oldProcessInputs == null || newProcessInputs == null\n+        if (oldProcessInputs == null && newProcessInputs == null) {\n+            return true;\n+        }\n+\n+        if (oldProcessInputs == null || newProcessInputs == null\n                 || oldProcessInputs.getInputs().size() != newProcessInputs.getInputs().size()) {\n             return false;\n         }\n@@ -418,8 +421,11 @@ private void updateProcessOutputs(Outputs oldProcessOutputs, Outputs newProcessO\n     }\n \n     public static boolean areSame(Outputs oldProcessOutputs, Outputs newProcessOutputs) {\n-        if (oldProcessOutputs == null && newProcessOutputs == null\n-                || oldProcessOutputs == null || newProcessOutputs == null\n+        if (oldProcessOutputs == null && newProcessOutputs == null) {\n+            return true;\n+        }\n+\n+        if (oldProcessOutputs == null || newProcessOutputs == null\n                 || oldProcessOutputs.getOutputs().size() != newProcessOutputs.getOutputs().size()) {\n             return false;\n         }", "filename": "common/src/main/java/org/apache/falcon/metadata/EntityRelationshipGraphBuilder.java"}, {"additions": 37, "raw_url": "https://github.com/apache/falcon/raw/85427981afeacef84ef3c10fc5fc4190cf291545/common/src/test/java/org/apache/falcon/metadata/MetadataMappingServiceTest.java", "blob_url": "https://github.com/apache/falcon/blob/85427981afeacef84ef3c10fc5fc4190cf291545/common/src/test/java/org/apache/falcon/metadata/MetadataMappingServiceTest.java", "sha": "b51caf89fd15320f5904eb3d65971d428b2de3a6", "changes": 38, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/falcon/contents/common/src/test/java/org/apache/falcon/metadata/MetadataMappingServiceTest.java?ref=85427981afeacef84ef3c10fc5fc4190cf291545", "patch": "@@ -34,6 +34,10 @@\n import org.apache.falcon.entity.v0.feed.LocationType;\n import org.apache.falcon.entity.v0.feed.Locations;\n import org.apache.falcon.entity.v0.process.EngineType;\n+import org.apache.falcon.entity.v0.process.Input;\n+import org.apache.falcon.entity.v0.process.Inputs;\n+import org.apache.falcon.entity.v0.process.Output;\n+import org.apache.falcon.entity.v0.process.Outputs;\n import org.apache.falcon.entity.v0.process.Process;\n import org.apache.falcon.security.CurrentUser;\n import org.apache.falcon.service.Services;\n@@ -261,7 +265,8 @@ public void testOnFeedEntityChange() throws Exception {\n         Feed oldFeed = inputFeeds.get(0);\n         Feed newFeed = EntityBuilderTestUtil.buildFeed(oldFeed.getName(), clusterEntity,\n                 \"classified-as=Secured,source=data-warehouse\", \"reporting\");\n-        addStorage(newFeed, Storage.TYPE.FILESYSTEM, \"jail://global:00/falcon/impression-feed/20140101\");\n+        addStorage(newFeed, Storage.TYPE.FILESYSTEM,\n+                \"jail://global:00/falcon/impression-feed/20140101\");\n \n         try {\n             configStore.initiateUpdate(newFeed);\n@@ -324,6 +329,37 @@ public void testOnProcessEntityChange() throws Exception {\n         Assert.assertEquals(getEdgesCount(service.getGraph()), 69); // -6 = -2 outputs, -1 tag, -1 cluster, -2 pipelines\n     }\n \n+    @Test(dependsOnMethods = \"testOnProcessEntityChange\")\n+    public void testAreSame() throws Exception {\n+\n+        Inputs inputs1 = new Inputs();\n+        Inputs inputs2 = new Inputs();\n+        Outputs outputs1 = new Outputs();\n+        Outputs outputs2 = new Outputs();\n+        // return true when both are null\n+        Assert.assertTrue(EntityRelationshipGraphBuilder.areSame(inputs1, inputs2));\n+        Assert.assertTrue(EntityRelationshipGraphBuilder.areSame(outputs1, outputs2));\n+\n+        Input i1 = new Input();\n+        i1.setName(\"input1\");\n+        Input i2 = new Input();\n+        i2.setName(\"input2\");\n+        Output o1 = new Output();\n+        o1.setName(\"output1\");\n+        Output o2 = new Output();\n+        o2.setName(\"output2\");\n+\n+        inputs1.getInputs().add(i1);\n+        Assert.assertFalse(EntityRelationshipGraphBuilder.areSame(inputs1, inputs2));\n+        outputs1.getOutputs().add(o1);\n+        Assert.assertFalse(EntityRelationshipGraphBuilder.areSame(outputs1, outputs2));\n+\n+        inputs2.getInputs().add(i1);\n+        Assert.assertTrue(EntityRelationshipGraphBuilder.areSame(inputs1, inputs2));\n+        outputs2.getOutputs().add(o1);\n+        Assert.assertTrue(EntityRelationshipGraphBuilder.areSame(outputs1, outputs2));\n+    }\n+\n     private void verifyUpdatedEdges(Process newProcess) {\n         Vertex processVertex = getEntityVertex(newProcess.getName(), RelationshipType.PROCESS_ENTITY);\n ", "filename": "common/src/test/java/org/apache/falcon/metadata/MetadataMappingServiceTest.java"}, {"additions": 72, "raw_url": "https://github.com/apache/falcon/raw/85427981afeacef84ef3c10fc5fc4190cf291545/oozie/src/test/java/org/apache/falcon/oozie/process/OozieProcessWorkflowBuilderTest.java", "blob_url": "https://github.com/apache/falcon/blob/85427981afeacef84ef3c10fc5fc4190cf291545/oozie/src/test/java/org/apache/falcon/oozie/process/OozieProcessWorkflowBuilderTest.java", "sha": "4daf5d8bd8df6b6a1cd9ac44bbc69a8700798a6d", "changes": 79, "status": "modified", "deletions": 7, "contents_url": "https://api.github.com/repos/apache/falcon/contents/oozie/src/test/java/org/apache/falcon/oozie/process/OozieProcessWorkflowBuilderTest.java?ref=85427981afeacef84ef3c10fc5fc4190cf291545", "patch": "@@ -461,7 +461,8 @@ public void testHiveProcessWithNoInputsAndOutputs(String secureOption) throws Ex\n \n         ACTION hiveNode = getAction(parentWorkflow, \"user-action\");\n \n-        JAXBElement<org.apache.falcon.oozie.hive.ACTION> actionJaxbElement = OozieUtils.unMarshalHiveAction(hiveNode);\n+        JAXBElement<org.apache.falcon.oozie.hive.ACTION> actionJaxbElement = OozieUtils.unMarshalHiveAction(\n+                hiveNode);\n         org.apache.falcon.oozie.hive.ACTION hiveAction = actionJaxbElement.getValue();\n \n         Assert.assertEquals(hiveAction.getScript(),\n@@ -572,14 +573,18 @@ public void testProcessMapperForTableStorage(String secureOption) throws Excepti\n     private Map<String, String> getExpectedProperties(Feed inFeed, Feed outFeed,\n                                                       Process process) throws FalconException {\n         Map<String, String> expected = new HashMap<String, String>();\n-        for (Input input : process.getInputs().getInputs()) {\n-            CatalogStorage storage = (CatalogStorage) FeedHelper.createStorage(cluster, inFeed);\n-            propagateStorageProperties(input.getName(), storage, expected);\n+        if (process.getInputs() != null) {\n+            for (Input input : process.getInputs().getInputs()) {\n+                CatalogStorage storage = (CatalogStorage) FeedHelper.createStorage(cluster, inFeed);\n+                propagateStorageProperties(input.getName(), storage, expected);\n+            }\n         }\n \n-        for (Output output : process.getOutputs().getOutputs()) {\n-            CatalogStorage storage = (CatalogStorage) FeedHelper.createStorage(cluster, outFeed);\n-            propagateStorageProperties(output.getName(), storage, expected);\n+        if (process.getOutputs() != null) {\n+            for (Output output : process.getOutputs().getOutputs()) {\n+                CatalogStorage storage = (CatalogStorage) FeedHelper.createStorage(cluster, outFeed);\n+                propagateStorageProperties(output.getName(), storage, expected);\n+            }\n         }\n \n         return expected;\n@@ -696,4 +701,64 @@ public void testProcessWithNoInputsAndOutputs() throws Exception {\n             Assert.assertTrue(props.containsKey(property), \"expected property missing: \" + property);\n         }\n     }\n+\n+    @Test\n+    public void testProcessWithInputsNoOutputs() throws Exception {\n+        ClusterHelper.getInterface(cluster, Interfacetype.WRITE).setEndpoint(hdfsUrl);\n+\n+        URL resource = this.getClass().getResource(\"/config/process/process-no-outputs.xml\");\n+        Process processEntity = (Process) EntityType.PROCESS.getUnmarshaller().unmarshal(resource);\n+        ConfigurationStore.get().publish(EntityType.PROCESS, processEntity);\n+\n+        OozieEntityBuilder builder = OozieEntityBuilder.get(processEntity);\n+        Path bundlePath = new Path(\"/falcon/staging/workflows\", processEntity.getName());\n+        builder.build(cluster, bundlePath);\n+        assertTrue(fs.exists(bundlePath));\n+\n+        BUNDLEAPP bundle = getBundle(fs, bundlePath);\n+        assertEquals(EntityUtil.getWorkflowName(processEntity).toString(), bundle.getName());\n+        assertEquals(1, bundle.getCoordinator().size());\n+        assertEquals(EntityUtil.getWorkflowName(Tag.DEFAULT, processEntity).toString(),\n+                bundle.getCoordinator().get(0).getName());\n+        String coordPath = bundle.getCoordinator().get(0).getAppPath().replace(\"${nameNode}\", \"\");\n+\n+        COORDINATORAPP coord = getCoordinator(fs, new Path(coordPath));\n+        HashMap<String, String> props = getCoordProperties(coord);\n+        verifyEntityProperties(processEntity, cluster,\n+                WorkflowExecutionContext.EntityOperations.GENERATE, props);\n+        verifyBrokerProperties(cluster, props);\n+\n+        Assert.assertEquals(props.get(WorkflowExecutionArgs.INPUT_FEED_NAMES.getName()), \"clicks\");\n+        Assert.assertEquals(props.get(WorkflowExecutionArgs.FEED_NAMES.getName()), \"NONE\");\n+    }\n+\n+    @Test\n+    public void testProcessNoInputsWithOutputs() throws Exception {\n+        ClusterHelper.getInterface(cluster, Interfacetype.WRITE).setEndpoint(hdfsUrl);\n+\n+        URL resource = this.getClass().getResource(\"/config/process/process-no-inputs.xml\");\n+        Process processEntity = (Process) EntityType.PROCESS.getUnmarshaller().unmarshal(resource);\n+        ConfigurationStore.get().publish(EntityType.PROCESS, processEntity);\n+\n+        OozieEntityBuilder builder = OozieEntityBuilder.get(processEntity);\n+        Path bundlePath = new Path(\"/falcon/staging/workflows\", processEntity.getName());\n+        builder.build(cluster, bundlePath);\n+        assertTrue(fs.exists(bundlePath));\n+\n+        BUNDLEAPP bundle = getBundle(fs, bundlePath);\n+        assertEquals(EntityUtil.getWorkflowName(processEntity).toString(), bundle.getName());\n+        assertEquals(1, bundle.getCoordinator().size());\n+        assertEquals(EntityUtil.getWorkflowName(Tag.DEFAULT, processEntity).toString(),\n+                bundle.getCoordinator().get(0).getName());\n+        String coordPath = bundle.getCoordinator().get(0).getAppPath().replace(\"${nameNode}\", \"\");\n+\n+        COORDINATORAPP coord = getCoordinator(fs, new Path(coordPath));\n+        HashMap<String, String> props = getCoordProperties(coord);\n+        verifyEntityProperties(processEntity, cluster,\n+                WorkflowExecutionContext.EntityOperations.GENERATE, props);\n+        verifyBrokerProperties(cluster, props);\n+\n+        Assert.assertEquals(props.get(WorkflowExecutionArgs.FEED_NAMES.getName()), \"impressions\");\n+        Assert.assertEquals(props.get(WorkflowExecutionArgs.INPUT_FEED_NAMES.getName()), \"NONE\");\n+    }\n }", "filename": "oozie/src/test/java/org/apache/falcon/oozie/process/OozieProcessWorkflowBuilderTest.java"}, {"additions": 43, "raw_url": "https://github.com/apache/falcon/raw/85427981afeacef84ef3c10fc5fc4190cf291545/oozie/src/test/resources/config/process/process-no-inputs.xml", "blob_url": "https://github.com/apache/falcon/blob/85427981afeacef84ef3c10fc5fc4190cf291545/oozie/src/test/resources/config/process/process-no-inputs.xml", "sha": "85d01dba2ee0761a4237f42527ad4f82e7edd5b3", "changes": 43, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/oozie/src/test/resources/config/process/process-no-inputs.xml?ref=85427981afeacef84ef3c10fc5fc4190cf291545", "patch": "@@ -0,0 +1,43 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  Licensed to the Apache Software Foundation (ASF) under one\n+  or more contributor license agreements.  See the NOTICE file\n+  distributed with this work for additional information\n+  regarding copyright ownership.  The ASF licenses this file\n+  to you under the Apache License, Version 2.0 (the\n+  \"License\"); you may not use this file except in compliance\n+  with the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+  -->\n+<process name=\"process-no-inputs\" xmlns=\"uri:falcon:process:0.1\">\n+    <!-- where -->\n+    <clusters>\n+        <cluster name=\"corp\">\n+            <validity start=\"2011-11-02T00:00Z\" end=\"2011-12-30T00:00Z\"/>\n+        </cluster>\n+    </clusters>\n+\n+    <!-- when -->\n+    <parallel>1</parallel>\n+    <order>LIFO</order>\n+    <frequency>hours(1)</frequency>\n+    <timezone>UTC</timezone>\n+\n+    <!-- what = outputs only -->\n+    <outputs>\n+        <output name=\"clicksummary\" feed=\"impressions\" instance=\"today(0,0)\"/>\n+    </outputs>\n+\n+    <!-- how -->\n+    <workflow engine=\"pig\" path=\"/apps/pig/id.pig\"/>\n+\n+    <retry policy=\"periodic\" delay=\"hours(10)\" attempts=\"3\"/>\n+\n+</process>", "filename": "oozie/src/test/resources/config/process/process-no-inputs.xml"}, {"additions": 43, "raw_url": "https://github.com/apache/falcon/raw/85427981afeacef84ef3c10fc5fc4190cf291545/oozie/src/test/resources/config/process/process-no-outputs.xml", "blob_url": "https://github.com/apache/falcon/blob/85427981afeacef84ef3c10fc5fc4190cf291545/oozie/src/test/resources/config/process/process-no-outputs.xml", "sha": "0acba6048eb6c203739bf5821e4cd3627ad15984", "changes": 43, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/oozie/src/test/resources/config/process/process-no-outputs.xml?ref=85427981afeacef84ef3c10fc5fc4190cf291545", "patch": "@@ -0,0 +1,43 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  Licensed to the Apache Software Foundation (ASF) under one\n+  or more contributor license agreements.  See the NOTICE file\n+  distributed with this work for additional information\n+  regarding copyright ownership.  The ASF licenses this file\n+  to you under the Apache License, Version 2.0 (the\n+  \"License\"); you may not use this file except in compliance\n+  with the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+  -->\n+<process name=\"process-no-outputs\" xmlns=\"uri:falcon:process:0.1\">\n+    <!-- where -->\n+    <clusters>\n+        <cluster name=\"corp\">\n+            <validity start=\"2011-11-02T00:00Z\" end=\"2011-12-30T00:00Z\"/>\n+        </cluster>\n+    </clusters>\n+\n+    <!-- when -->\n+    <parallel>1</parallel>\n+    <order>LIFO</order>\n+    <frequency>hours(1)</frequency>\n+    <timezone>UTC</timezone>\n+\n+    <!-- what = inputs only -->\n+    <inputs>\n+        <input name=\"click\" feed=\"clicks\" start=\"yesterday(0,0)\" end=\"latest(0)\" partition=\"*/US\"/>\n+    </inputs>\n+\n+    <!-- how -->\n+    <workflow engine=\"pig\" path=\"/apps/pig/id.pig\"/>\n+\n+    <retry policy=\"periodic\" delay=\"hours(10)\" attempts=\"3\"/>\n+\n+</process>", "filename": "oozie/src/test/resources/config/process/process-no-outputs.xml"}, {"additions": 7, "raw_url": "https://github.com/apache/falcon/raw/85427981afeacef84ef3c10fc5fc4190cf291545/rerun/src/main/java/org/apache/falcon/rerun/handler/LateRerunHandler.java", "blob_url": "https://github.com/apache/falcon/blob/85427981afeacef84ef3c10fc5fc4190cf291545/rerun/src/main/java/org/apache/falcon/rerun/handler/LateRerunHandler.java", "sha": "bacc20f09f1fc7180aebf3c2c51acae6c2fa9a3d", "changes": 12, "status": "modified", "deletions": 5, "contents_url": "https://api.github.com/repos/apache/falcon/contents/rerun/src/main/java/org/apache/falcon/rerun/handler/LateRerunHandler.java?ref=85427981afeacef84ef3c10fc5fc4190cf291545", "patch": "@@ -154,11 +154,13 @@ public static Date getCutOffTime(Entity entity, String nominalTime) throws Falco\n             for (LateInput lp : process.getLateProcess().getLateInputs()) {\n                 Feed feed = null;\n                 String endInstanceTime = \"\";\n-                for (Input input : process.getInputs().getInputs()) {\n-                    if (input.getName().equals(lp.getInput())) {\n-                        endInstanceTime = input.getEnd();\n-                        feed = store.get(EntityType.FEED, input.getFeed());\n-                        break;\n+                if (process.getInputs() != null) {\n+                    for (Input input : process.getInputs().getInputs()) {\n+                        if (input.getName().equals(lp.getInput())) {\n+                            endInstanceTime = input.getEnd();\n+                            feed = store.get(EntityType.FEED, input.getFeed());\n+                            break;\n+                        }\n                     }\n                 }\n                 if (feed == null) {", "filename": "rerun/src/main/java/org/apache/falcon/rerun/handler/LateRerunHandler.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/b08eacb4a240bf25200762cce0caef2809279a5c", "parent": "https://github.com/apache/falcon/commit/c4035db227a3424547eddb953b1e28f92a2040d4", "message": "FALCON-429 Falcon CLI entity list command throws NPE stack trace in case of no entities. Contributed by Satish Mittal", "bug_id": "falcon_21", "file": [{"additions": 3, "raw_url": "https://github.com/apache/falcon/raw/b08eacb4a240bf25200762cce0caef2809279a5c/CHANGES.txt", "blob_url": "https://github.com/apache/falcon/blob/b08eacb4a240bf25200762cce0caef2809279a5c/CHANGES.txt", "sha": "6b20f60dd51950b0b183fbba52454cbe380638f6", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/CHANGES.txt?ref=b08eacb4a240bf25200762cce0caef2809279a5c", "patch": "@@ -134,6 +134,9 @@ Release Version: 0.5-incubating\n     FALCON-123 Improve build speeds in falcon. (Srikanth Sundarrajan via Shwetha GS)\n \n   BUG FIXES\n+    FALCON-429 Falcon CLI entity list command throws NPE stack trace in case\n+    of no entities (Satish Mittal via Venkatesh Seetharam)\n+\n     FALCON-427 Update default falcon endpoint URL in runtime.properties for\n     prism setup to work out of box (Satish Mittal via Venkatesh Seetharam)\n ", "filename": "CHANGES.txt"}, {"additions": 3, "raw_url": "https://github.com/apache/falcon/raw/b08eacb4a240bf25200762cce0caef2809279a5c/client/src/main/java/org/apache/falcon/cli/FalconCLI.java", "blob_url": "https://github.com/apache/falcon/blob/b08eacb4a240bf25200762cce0caef2809279a5c/client/src/main/java/org/apache/falcon/cli/FalconCLI.java", "sha": "2fb072926e7b192562c8bde8d5d2691f7683fae3", "changes": 4, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/falcon/contents/client/src/main/java/org/apache/falcon/cli/FalconCLI.java?ref=b08eacb4a240bf25200762cce0caef2809279a5c", "patch": "@@ -28,6 +28,7 @@\n import org.apache.falcon.client.FalconCLIException;\n import org.apache.falcon.client.FalconClient;\n import org.apache.falcon.entity.v0.SchemaHelper;\n+import org.apache.falcon.resource.EntityList;\n \n import java.io.IOException;\n import java.io.InputStream;\n@@ -347,7 +348,8 @@ private void entityCommand(CommandLine commandLine, FalconClient client)\n             result = client.getDependency(entityType, entityName).toString();\n         } else if (optionsList.contains(LIST_OPT)) {\n             validateColo(optionsList);\n-            result = client.getEntityList(entityType).toString();\n+            EntityList entityList = client.getEntityList(entityType);\n+            result = entityList != null ? entityList.toString() : \"No entity of type (\" + entityType + \") found.\";\n         } else if (optionsList.contains(HELP_CMD)) {\n             OUT.get().println(\"Falcon Help\");\n         } else {", "filename": "client/src/main/java/org/apache/falcon/cli/FalconCLI.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/20f2acec7c0c2819da9c8005a3b3d443cebc349f", "parent": "https://github.com/apache/falcon/commit/5a474ffab766a964e44096633016f6463537fd0a", "message": "FALCON-1402 Validate cmd throws NPE when source cluster and any one of target cluster doesn't have overlapping dates. Contributed by Pavan Kumar Kolamuri.", "bug_id": "falcon_22", "file": [{"additions": 2, "raw_url": "https://github.com/apache/falcon/raw/20f2acec7c0c2819da9c8005a3b3d443cebc349f/CHANGES.txt", "blob_url": "https://github.com/apache/falcon/blob/20f2acec7c0c2819da9c8005a3b3d443cebc349f/CHANGES.txt", "sha": "bc1422ab58ec08d4c2c59fbee17ea1b4d3bde065", "changes": 2, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/CHANGES.txt?ref=20f2acec7c0c2819da9c8005a3b3d443cebc349f", "patch": "@@ -20,6 +20,8 @@ Trunk (Unreleased)\n   OPTIMIZATIONS\n \n   BUG FIXES\n+    FALCON-1402 Validate cmd throws NPE when source cluster and any one of target cluster doesn't have overlapping dates(Pavan Kumar Kolamuri via Ajay Yadava)\n+\n     FALCON-1365 HCatReplication job fails with AccessControlException(Sowmya Ramesh via Ajay Yadava)\n \n     FALCON-298 Feed update with replication delay creates holes(Sandeep Samudrala via Ajay Yadava)", "filename": "CHANGES.txt"}, {"additions": 7, "raw_url": "https://github.com/apache/falcon/raw/20f2acec7c0c2819da9c8005a3b3d443cebc349f/oozie/src/main/java/org/apache/falcon/oozie/feed/FeedReplicationCoordinatorBuilder.java", "blob_url": "https://github.com/apache/falcon/blob/20f2acec7c0c2819da9c8005a3b3d443cebc349f/oozie/src/main/java/org/apache/falcon/oozie/feed/FeedReplicationCoordinatorBuilder.java", "sha": "db08d60d73a6cedadaa6e05e57ccc64f9ac087e5", "changes": 12, "status": "modified", "deletions": 5, "contents_url": "https://api.github.com/repos/apache/falcon/contents/oozie/src/main/java/org/apache/falcon/oozie/feed/FeedReplicationCoordinatorBuilder.java?ref=20f2acec7c0c2819da9c8005a3b3d443cebc349f", "patch": "@@ -90,7 +90,10 @@ public FeedReplicationCoordinatorBuilder(Feed entity) {\n                     // workflow is serialized to a specific dir\n                     Path coordPath = new Path(buildPath, Tag.REPLICATION.name() + \"/\" + srcCluster.getName());\n \n-                    props.add(doBuild(srcCluster, cluster, coordPath));\n+                    Properties buildProps = doBuild(srcCluster, cluster, coordPath);\n+                    if (buildProps != null && !buildProps.isEmpty()) {\n+                        props.add(buildProps);\n+                    }\n                 }\n             }\n             return props;\n@@ -107,10 +110,9 @@ private Properties doBuild(Cluster srcCluster, Cluster trgCluster, Path buildPat\n         Date targetEndDate = getEndDate(trgCluster);\n \n         if (noOverlapExists(sourceStartDate, sourceEndDate,\n-            targetStartDate, targetEndDate)) {\n-            LOG.warn(\"Not creating replication coordinator, as the source cluster: {} and target cluster: {} do \"\n-                + \"not have overlapping dates\", srcCluster.getName(), trgCluster.getName());\n-            return null;\n+                targetStartDate, targetEndDate)) {\n+            throw new FalconException(\"Source cluster: \" + srcCluster.getName() + \" and Target cluster: \"\n+                    + trgCluster.getName() + \" do not have overlapping dates for replication\");\n         }\n \n         // Different workflow for each source since hive credentials vary for each cluster", "filename": "oozie/src/main/java/org/apache/falcon/oozie/feed/FeedReplicationCoordinatorBuilder.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/d2c8adfadf0d25a5956194f3e82c85a5677a42fb", "parent": "https://github.com/apache/falcon/commit/edebc48aca8b2a3bb9a36481f3e6b13084e90239", "message": "FALCON-2121 If a feed does not exist on a cluster, process submission throws NPE\n\nAfter the change:\n`bin/falcon entity -submit -type process -file examples/entity/filesystem/pig-process.xml\nERROR: Bad Request;default/Feed in does not exist on cluster local2`\n\nAuthor: Pallavi Rao <pallavi.rao@inmobi.com>\n\nReviewers: @sandeepSamudrala\n\nCloses #270 from pallavi-rao/2121 and squashes the following commits:\n\ned3a8f4 [Pallavi Rao] Addressed review comment\n0884518 [Pallavi Rao] FALCON-2121 Removing static import\n60d1e00 [Pallavi Rao] FALCON-2121 If a feed does not exist on a cluster, process submission fails with NPE", "bug_id": "falcon_23", "file": [{"additions": 2, "raw_url": "https://github.com/apache/falcon/raw/d2c8adfadf0d25a5956194f3e82c85a5677a42fb/common/src/main/java/org/apache/falcon/entity/parser/CrossEntityValidations.java", "blob_url": "https://github.com/apache/falcon/blob/d2c8adfadf0d25a5956194f3e82c85a5677a42fb/common/src/main/java/org/apache/falcon/entity/parser/CrossEntityValidations.java", "sha": "d4b79fd5a202a8b12010776b68926cc04863aa82", "changes": 2, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/common/src/main/java/org/apache/falcon/entity/parser/CrossEntityValidations.java?ref=d2c8adfadf0d25a5956194f3e82c85a5677a42fb", "patch": "@@ -44,6 +44,7 @@ public static void validateInstanceRange(Process process, Input input, Feed feed\n         try {\n             for (Cluster cluster : process.getClusters().getClusters()) {\n                 String clusterName = cluster.getName();\n+                validateFeedDefinedForCluster(feed, clusterName);\n                 org.apache.falcon.entity.v0.feed.Validity feedValidity = FeedHelper.getCluster(feed,\n                         clusterName).getValidity();\n \n@@ -110,6 +111,7 @@ public static void validateInstance(Process process, Output output, Feed feed) t\n         try {\n             for (Cluster cluster : process.getClusters().getClusters()) {\n                 String clusterName = cluster.getName();\n+                validateFeedDefinedForCluster(feed, clusterName);\n                 org.apache.falcon.entity.v0.feed.Validity feedValidity = FeedHelper.getCluster(feed,\n                         clusterName).getValidity();\n                 Date feedStart = feedValidity.getStart();", "filename": "common/src/main/java/org/apache/falcon/entity/parser/CrossEntityValidations.java"}], "repo": "falcon"}, {"commit": "https://github.com/apache/falcon/commit/c9792ede54c804a925a235829c374eaa1414b692", "parent": "https://github.com/apache/falcon/commit/5cd3710099233d09e030e9cfc694a51bbcf0c209", "message": "FALCON-378 Feed status fails with NPE post update when the new coordinator is in PREP state. Contributed by Venkatesh Seetharam", "bug_id": "falcon_24", "file": [{"additions": 3, "raw_url": "https://github.com/apache/falcon/raw/c9792ede54c804a925a235829c374eaa1414b692/CHANGES.txt", "blob_url": "https://github.com/apache/falcon/blob/c9792ede54c804a925a235829c374eaa1414b692/CHANGES.txt", "sha": "1039ce91e2e335313cc0ab57aca77d57ce1b4a4c", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/falcon/contents/CHANGES.txt?ref=c9792ede54c804a925a235829c374eaa1414b692", "patch": "@@ -185,6 +185,9 @@ Trunk (Unreleased)\n     FALCON-360 Lineage recording fails with NPE for processes with >1 inputs.\n     (Venkatesh Seetharam)\n \n+    FALCON-378 Feed status fails with NPE post update when the new coordinator\n+    is in PREP state (Venkatesh Seetharam)\n+\n Release Version: 0.4-incubating\n \n    NEW FEATURES", "filename": "CHANGES.txt"}, {"additions": 19, "raw_url": "https://github.com/apache/falcon/raw/c9792ede54c804a925a235829c374eaa1414b692/oozie/src/main/java/org/apache/falcon/workflow/engine/OozieWorkflowEngine.java", "blob_url": "https://github.com/apache/falcon/blob/c9792ede54c804a925a235829c374eaa1414b692/oozie/src/main/java/org/apache/falcon/workflow/engine/OozieWorkflowEngine.java", "sha": "9d4103bf8e24eb40b26dc41ffd01f08085bc7e52", "changes": 30, "status": "modified", "deletions": 11, "contents_url": "https://api.github.com/repos/apache/falcon/contents/oozie/src/main/java/org/apache/falcon/workflow/engine/OozieWorkflowEngine.java?ref=c9792ede54c804a925a235829c374eaa1414b692", "patch": "@@ -753,22 +753,29 @@ private String mapActionStatus(String status) {\n             List<CoordinatorAction> actions = new ArrayList<CoordinatorAction>();\n \n             for (CoordinatorJob coord : applicableCoords) {\n+                Date nextMaterializedTime = coord.getNextMaterializedTime();\n+                if (nextMaterializedTime == null) {\n+                    continue;\n+                }\n+\n                 Frequency freq = createFrequency(String.valueOf(coord.getFrequency()), coord.getTimeUnit());\n                 TimeZone tz = EntityUtil.getTimeZone(coord.getTimeZone());\n                 Date iterStart = EntityUtil.getNextStartTime(coord.getStartTime(), freq, tz, start);\n-                Date iterEnd = (coord.getNextMaterializedTime().before(end) ? coord.getNextMaterializedTime() : end);\n+                Date iterEnd = (nextMaterializedTime.before(end) ? nextMaterializedTime : end);\n+\n                 while (!iterStart.after(iterEnd)) {\n                     int sequence = EntityUtil.getInstanceSequence(coord.getStartTime(), freq, tz, iterStart);\n                     String actionId = coord.getId() + \"@\" + sequence;\n-                    CoordinatorAction coordActionInfo = null;\n+\n                     try {\n-                        coordActionInfo = client.getCoordActionInfo(actionId);\n+                        CoordinatorAction coordActionInfo = client.getCoordActionInfo(actionId);\n+                        if (coordActionInfo != null) {\n+                            actions.add(coordActionInfo);\n+                        }\n                     } catch (OozieClientException e) {\n                         LOG.debug(\"Unable to get action for \" + actionId + \" \" + e.getMessage());\n                     }\n-                    if (coordActionInfo != null) {\n-                        actions.add(coordActionInfo);\n-                    }\n+\n                     Calendar startCal = Calendar.getInstance(EntityUtil.getTimeZone(coord.getTimeZone()));\n                     startCal.setTime(iterStart);\n                     startCal.add(freq.getTimeUnit().getCalendarUnit(), Integer.valueOf((coord.getFrequency())));\n@@ -805,18 +812,19 @@ public TimeUnit getFalconTimeUnit() {\n         }\n     }\n \n-    private List<CoordinatorJob> getApplicableCoords(Entity entity, ProxyOozieClient client, Date start, Date end,\n-        List<BundleJob> bundles) throws FalconException {\n-\n+    private List<CoordinatorJob> getApplicableCoords(Entity entity, ProxyOozieClient client, Date start,\n+                                                     Date end, List<BundleJob> bundles) throws FalconException {\n+        String retentionCoordName = EntityUtil.getWorkflowName(Tag.RETENTION, entity).toString();\n         List<CoordinatorJob> applicableCoords = new ArrayList<CoordinatorJob>();\n         try {\n             for (BundleJob bundle : bundles) {\n                 List<CoordinatorJob> coords = client.getBundleJobInfo(bundle.getId()).getCoordinators();\n                 for (CoordinatorJob coord : coords) {\n-                    String coordName = EntityUtil.getWorkflowName(Tag.RETENTION, entity).toString();\n-                    if (coordName.equals(coord.getAppName())) {\n+                    // ignore coords in PREP state, not yet running and retention coord\n+                    if (coord.getStatus() == Status.PREP || retentionCoordName.equals(coord.getAppName())) {\n                         continue;\n                     }\n+\n                     // if end time is before coord-start time or start time is\n                     // after coord-end time ignore.\n                     if (!(end.compareTo(coord.getStartTime()) <= 0 || start.compareTo(coord.getEndTime()) >= 0)) {", "filename": "oozie/src/main/java/org/apache/falcon/workflow/engine/OozieWorkflowEngine.java"}], "repo": "falcon"}]
