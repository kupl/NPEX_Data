[
    {
        "repo": "commons-vfs",
        "commit": "https://github.com/apache/commons-vfs/commit/add1a771a73c830378eca440f0e7a249c3638faf",
        "bug_id": "commons-vfs_add1a77",
        "message": "[VFS-739] Changes to parseUri breaks backward compatibility by throwing\nNullPointerException in some cases.",
        "parent": "https://github.com/apache/commons-vfs/commit/efbffc78807a17f0050f8e623ddef7b0be681f95",
        "patched_files": [
            "changes.xml",
            "LocalFileNameParser.java",
            "UrlFileNameParser.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 11,
                "raw_url": "https://github.com/apache/commons-vfs/raw/add1a771a73c830378eca440f0e7a249c3638faf/commons-vfs2/src/main/java/org/apache/commons/vfs2/provider/local/LocalFileNameParser.java",
                "contents_url": "https://api.github.com/repos/apache/commons-vfs/contents/commons-vfs2/src/main/java/org/apache/commons/vfs2/provider/local/LocalFileNameParser.java?ref=add1a771a73c830378eca440f0e7a249c3638faf",
                "filename": "commons-vfs2/src/main/java/org/apache/commons/vfs2/provider/local/LocalFileNameParser.java",
                "deletions": 1,
                "sha": "90abfeb71d918ab0bd28aa6ace1933e3fbb137e4",
                "blob_url": "https://github.com/apache/commons-vfs/blob/add1a771a73c830378eca440f0e7a249c3638faf/commons-vfs2/src/main/java/org/apache/commons/vfs2/provider/local/LocalFileNameParser.java",
                "patch": "@@ -16,8 +16,11 @@\n  */\n package org.apache.commons.vfs2.provider.local;\n \n+import java.net.URI;\n+\n import org.apache.commons.vfs2.FileName;\n import org.apache.commons.vfs2.FileSystemException;\n+import org.apache.commons.vfs2.FileSystemManager;\n import org.apache.commons.vfs2.FileType;\n import org.apache.commons.vfs2.VFS;\n import org.apache.commons.vfs2.provider.AbstractFileNameParser;\n@@ -63,7 +66,7 @@ public FileName parseUri(final VfsComponentContext context, final FileName base,\n         final StringBuilder name = new StringBuilder();\n \n         // Extract the scheme\n-        String scheme = UriParser.extractScheme(context.getFileSystemManager().getSchemes(), uri, name);\n+        String scheme = UriParser.extractScheme(getSchemes(context, base, uri), uri, name);\n         if (scheme == null && base != null) {\n             scheme = base.getScheme();\n         }\n@@ -87,6 +90,13 @@ public FileName parseUri(final VfsComponentContext context, final FileName base,\n         return createFileName(scheme, rootFile, path, fileType);\n     }\n \n+    private String[] getSchemes(final VfsComponentContext context, FileName base, String uri) {\n+        if (context == null) {\n+            return new String[] { base != null ? base.getScheme() : URI.create(uri).getScheme() };\n+        }\n+        return context.getFileSystemManager().getSchemes();\n+    }\n+\n     protected abstract FileName createFileName(String scheme, final String rootFile, final String path,\n             final FileType type);\n }",
                "changes": 12
            },
            {
                "status": "added",
                "additions": 38,
                "raw_url": "https://github.com/apache/commons-vfs/raw/add1a771a73c830378eca440f0e7a249c3638faf/commons-vfs2/src/test/java/org/apache/commons/vfs2/provider/url/UrlFileNameParserTest.java",
                "contents_url": "https://api.github.com/repos/apache/commons-vfs/contents/commons-vfs2/src/test/java/org/apache/commons/vfs2/provider/url/UrlFileNameParserTest.java?ref=add1a771a73c830378eca440f0e7a249c3638faf",
                "filename": "commons-vfs2/src/test/java/org/apache/commons/vfs2/provider/url/UrlFileNameParserTest.java",
                "deletions": 0,
                "sha": "6baadda4a8c6e3263e6d9a3fb75529e0129e8f8a",
                "blob_url": "https://github.com/apache/commons-vfs/blob/add1a771a73c830378eca440f0e7a249c3638faf/commons-vfs2/src/test/java/org/apache/commons/vfs2/provider/url/UrlFileNameParserTest.java",
                "patch": "@@ -0,0 +1,38 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.commons.vfs2.provider.url;\n+\n+import java.net.URI;\n+\n+import org.apache.commons.vfs2.FileName;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+public class UrlFileNameParserTest {\n+\n+    @Test\n+    public void testJira739() throws Exception {\n+        final String uriStr = \"maprfs:///\";\n+        // Check that we have a valid URI\n+        final URI uri = new URI(uriStr);\n+        // VFS-739 shows that parseUri throws an NPE:\n+        final FileName fileName = new UrlFileNameParser().parseUri(null, null, uriStr);\n+        Assert.assertEquals(uriStr, fileName.getURI());\n+        Assert.assertEquals(uri.getScheme(), fileName.getScheme());\n+    }\n+}",
                "changes": 38
            },
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/commons-vfs/raw/add1a771a73c830378eca440f0e7a249c3638faf/src/changes/changes.xml",
                "contents_url": "https://api.github.com/repos/apache/commons-vfs/contents/src/changes/changes.xml?ref=add1a771a73c830378eca440f0e7a249c3638faf",
                "filename": "src/changes/changes.xml",
                "deletions": 0,
                "sha": "8b39b814c5b430f7ae2313179c19926c80a2c737",
                "blob_url": "https://github.com/apache/commons-vfs/blob/add1a771a73c830378eca440f0e7a249c3638faf/src/changes/changes.xml",
                "patch": "@@ -95,6 +95,9 @@ The <action> type attribute can be add,update,fix,remove.\n       <action issue=\"VFS-738\" dev=\"ggregory\" type=\"add\" due-to=\"Gary Gregory\">\r\n         Deprecate org.apache.commons.vfs2.FileChangeEvent.getFile() in favor of getFileObject().\r\n       </action>\r\n+      <action issue=\"VFS-739\" dev=\"ggregory\" type=\"fix\" due-to=\"xia0c, Gary Gregory\">\r\n+        Changes to parseUri breaks backward compatibility by throwing NullPointerException in some cases.\r\n+      </action>\r\n     </release>\r\n     <release version=\"2.4.1\" date=\"2019-08-10\" description=\"Bug fix release.\">\r\n       <action issue=\"VFS-725\" dev=\"ggregory\" type=\"fix\" due-to=\"Gary Gregory\">\r",
                "changes": 3
            }
        ],
        "unit_tests": [
            "UrlFileNameParserTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "commons-vfs2/src/test/java/org/apache/commons/vfs2/provider/url/UrlFileNameParserTest.java",
        "buggy_files": [
            "src/changes/changes.xml",
            "commons-vfs2/src/main/java/org/apache/commons/vfs2/provider/local/LocalFileNameParser.java",
            "commons-vfs2/src/main/java/org/apache/commons/vfs2/provider/url/UrlFileNameParser.java"
        ],
        "fixed": true
    }
]