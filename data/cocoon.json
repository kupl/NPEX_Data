{
    "cocoon_85ca05f": {
        "bug_id": "cocoon_85ca05f",
        "commit": "https://github.com/apache/cocoon/commit/85ca05f6623eb6a8a187324f37c300afdd7c2423",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/cocoon/blob/85ca05f6623eb6a8a187324f37c300afdd7c2423/blocks/cocoon-template/cocoon-template-impl/src/test/resources/org/apache/cocoon/template/jxtg/JXTemplateGeneratorTestCase.spring.xml",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/cocoon/contents/blocks/cocoon-template/cocoon-template-impl/src/test/resources/org/apache/cocoon/template/jxtg/JXTemplateGeneratorTestCase.spring.xml?ref=85ca05f6623eb6a8a187324f37c300afdd7c2423",
                "deletions": 10,
                "filename": "blocks/cocoon-template/cocoon-template-impl/src/test/resources/org/apache/cocoon/template/jxtg/JXTemplateGeneratorTestCase.spring.xml",
                "patch": "@@ -29,16 +29,9 @@\n   <import resource=\"classpath:META-INF/cocoon/spring/RhinoScope.xml\"/>\n   <import resource=\"classpath:META-INF/cocoon/spring/AbstractStringTemplateParser.xml\"/>\n   <import resource=\"classpath:META-INF/cocoon/spring/LegacyStringTemplateParser.xml\"/>\n+  <import resource=\"classpath:META-INF/cocoon/spring/ObjectModelTemplate.xml\"/>\n   \n-  <!-- Redefining this bean instead of importing because originally it is in \"call\" scope -->\n-  <bean name=\"org.apache.cocoon.objectmodel.ObjectModel\" class=\"org.apache.cocoon.objectmodel.ObjectModelImpl\">\n-    <property name=\"initialEntries\">\n-      <map>\n-        <entry key=\"cocoon\" value-ref=\"org.apache.cocoon.objectmodel.provider.CocoonEntryObjectModelProvider\"/>\n-        <entry key=\"Packages\" value-ref=\"org.apache.cocoon.objectmodel.provider.PackagesEntryObjectModelProvider\"/>\n-        <entry key=\"java\" value-ref=\"org.apache.cocoon.objectmodel.provider.JavaEntryObjectModelProvider\"/>\n-      </map>\n-    </property>        \n-  </bean>\n+  <bean name=\"org.apache.cocoon.objectmodel.ObjectModel\" class=\"org.apache.cocoon.objectmodel.ObjectModelImpl\"\n+        parent=\"org.apache.cocoon.objectmodel.ObjectModel.template\"/>\n   \n </beans>\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/cocoon/raw/85ca05f6623eb6a8a187324f37c300afdd7c2423/blocks/cocoon-template/cocoon-template-impl/src/test/resources/org/apache/cocoon/template/jxtg/JXTemplateGeneratorTestCase.spring.xml",
                "sha": "a21028d386df9cd3e20b6e9ce306a8a32380197c",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/cocoon/blob/85ca05f6623eb6a8a187324f37c300afdd7c2423/core/cocoon-core/src/test/resources/org/apache/cocoon/components/treeprocessor/variables/PreparedVariableResolverTestCase.spring.xml",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/cocoon/contents/core/cocoon-core/src/test/resources/org/apache/cocoon/components/treeprocessor/variables/PreparedVariableResolverTestCase.spring.xml?ref=85ca05f6623eb6a8a187324f37c300afdd7c2423",
                "deletions": 10,
                "filename": "core/cocoon-core/src/test/resources/org/apache/cocoon/components/treeprocessor/variables/PreparedVariableResolverTestCase.spring.xml",
                "patch": "@@ -26,16 +26,9 @@\n   <import resource=\"classpath:META-INF/cocoon/spring/ObjectModelProviders.xml\"/>\n   <import resource=\"classpath:META-INF/cocoon/spring/CocoonEntryObjectModelProvider.xml\"/>\n   <import resource=\"classpath:META-INF/cocoon/spring/RhinoScope.xml\"/>\n+  <import resource=\"classpath:META-INF/cocoon/spring/ObjectModelTemplate.xml\"/>\n   \n-  <!-- Redefining this bean instead of importing because originally it is in \"call\" scope -->\n-  <bean name=\"org.apache.cocoon.objectmodel.ObjectModel\" class=\"org.apache.cocoon.objectmodel.ObjectModelImpl\">\n-    <property name=\"initialEntries\">\n-      <map>\n-        <entry key=\"cocoon\" value-ref=\"org.apache.cocoon.objectmodel.provider.CocoonEntryObjectModelProvider\"/>\n-        <entry key=\"Packages\" value-ref=\"org.apache.cocoon.objectmodel.provider.PackagesEntryObjectModelProvider\"/>\n-        <entry key=\"java\" value-ref=\"org.apache.cocoon.objectmodel.provider.JavaEntryObjectModelProvider\"/>\n-      </map>\n-    </property>        \n-  </bean>\n+  <bean name=\"org.apache.cocoon.objectmodel.ObjectModel\" class=\"org.apache.cocoon.objectmodel.ObjectModelImpl\"\n+        parent=\"org.apache.cocoon.objectmodel.ObjectModel.template\"/>\n   \n </beans>\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/cocoon/raw/85ca05f6623eb6a8a187324f37c300afdd7c2423/core/cocoon-core/src/test/resources/org/apache/cocoon/components/treeprocessor/variables/PreparedVariableResolverTestCase.spring.xml",
                "sha": "66a3662c93e92fd26117598264cb53198c802653",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/cocoon/blob/85ca05f6623eb6a8a187324f37c300afdd7c2423/core/cocoon-pipeline/cocoon-pipeline-impl/pom.xml",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/cocoon/contents/core/cocoon-pipeline/cocoon-pipeline-impl/pom.xml?ref=85ca05f6623eb6a8a187324f37c300afdd7c2423",
                "deletions": 5,
                "filename": "core/cocoon-pipeline/cocoon-pipeline-impl/pom.xml",
                "patch": "@@ -116,11 +116,6 @@\n       <artifactId>servlet-api</artifactId>\n       <scope>provided</scope>\n     </dependency>\n-    <dependency>\n-      <groupId>cglib</groupId>\n-      <artifactId>cglib</artifactId>\n-      <version>2.1_3</version>\n-    </dependency>    \n     <!-- Test Dependencies -->\n     <dependency>\n       <groupId>xmlunit</groupId>",
                "raw_url": "https://github.com/apache/cocoon/raw/85ca05f6623eb6a8a187324f37c300afdd7c2423/core/cocoon-pipeline/cocoon-pipeline-impl/pom.xml",
                "sha": "2ab0b68b7738a061200d7fb94c19cbd2941b1c1e",
                "status": "modified"
            },
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/cocoon/blob/85ca05f6623eb6a8a187324f37c300afdd7c2423/core/cocoon-pipeline/cocoon-pipeline-impl/src/main/java/org/apache/cocoon/components/pipeline/spring/PipelineComponentProxyDecorator.java",
                "changes": 27,
                "contents_url": "https://api.github.com/repos/apache/cocoon/contents/core/cocoon-pipeline/cocoon-pipeline-impl/src/main/java/org/apache/cocoon/components/pipeline/spring/PipelineComponentProxyDecorator.java?ref=85ca05f6623eb6a8a187324f37c300afdd7c2423",
                "deletions": 8,
                "filename": "core/cocoon-pipeline/cocoon-pipeline-impl/src/main/java/org/apache/cocoon/components/pipeline/spring/PipelineComponentProxyDecorator.java",
                "patch": "@@ -20,6 +20,7 @@\n import java.lang.reflect.Method;\n import java.lang.reflect.Proxy;\n import java.util.Arrays;\n+import java.util.HashMap;\n import java.util.LinkedHashSet;\n import java.util.Map;\n import java.util.Set;\n@@ -66,21 +67,31 @@ public void setHolder(PipelineComponentScopeHolder holder) {\n         public ScopeChangerProxy(Object wrapped, PipelineComponentScopeHolder holder) {\n             this.wrapped = wrapped;\n             this.holder = holder;\n+            this.beans = new HashMap();\n+            this.destructionCallbacks = new HashMap();\n         }\n \n         public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n-            Map currentBeans = null;\n-            Map currentDestructionCallbacks = null;\n             Object result;\n+            boolean modified = false;\n             try {\n-                currentBeans = holder.getBeans();\n-                currentDestructionCallbacks = holder.getDestructionCallbacks();\n-                holder.setBeans(beans);\n-                holder.setDestructionCallbacks(destructionCallbacks);\n+                if (!holder.getInScope()) {\n+                    holder.setParentBeans(holder.getBeans());\n+                    holder.setParentDestructionCallbacks(holder.getDestructionCallbacks());\n+                    holder.setBeans(beans);\n+                    holder.setDestructionCallbacks(destructionCallbacks);\n+                    holder.setInScope(true);\n+                    modified = true;\n+                }\n                 result = method.invoke(wrapped, args);\n             } finally {\n-                holder.setBeans(currentBeans);\n-                holder.setDestructionCallbacks(currentDestructionCallbacks);\n+                if (modified) {\n+                    holder.setBeans(holder.getParentBeans());\n+                    holder.setDestructionCallbacks(holder.getParentDestructionCallbacks());\n+                    holder.setParentBeans(null);\n+                    holder.setParentDestructionCallbacks(null);\n+                    holder.setInScope(false);\n+                }\n             }\n             return result;\n         }",
                "raw_url": "https://github.com/apache/cocoon/raw/85ca05f6623eb6a8a187324f37c300afdd7c2423/core/cocoon-pipeline/cocoon-pipeline-impl/src/main/java/org/apache/cocoon/components/pipeline/spring/PipelineComponentProxyDecorator.java",
                "sha": "561e6b15b1ab3c21badca5dcfcf8a6e83426e914",
                "status": "modified"
            },
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/cocoon/blob/85ca05f6623eb6a8a187324f37c300afdd7c2423/core/cocoon-pipeline/cocoon-pipeline-impl/src/main/java/org/apache/cocoon/components/pipeline/spring/PipelineComponentScopeHolder.java",
                "changes": 49,
                "contents_url": "https://api.github.com/repos/apache/cocoon/contents/core/cocoon-pipeline/cocoon-pipeline-impl/src/main/java/org/apache/cocoon/components/pipeline/spring/PipelineComponentScopeHolder.java?ref=85ca05f6623eb6a8a187324f37c300afdd7c2423",
                "deletions": 30,
                "filename": "core/cocoon-pipeline/cocoon-pipeline-impl/src/main/java/org/apache/cocoon/components/pipeline/spring/PipelineComponentScopeHolder.java",
                "patch": "@@ -16,40 +16,29 @@\n  */\n package org.apache.cocoon.components.pipeline.spring;\n \n-import java.util.HashMap;\n import java.util.Map;\n \n-public class PipelineComponentScopeHolder {\n-    private Map beans;\n-    private Map destructionCallbacks;\n-    private boolean inScope;\n+public interface PipelineComponentScopeHolder {\n+    //FIXME: This interface needs redesign\n+\n+    public Map getBeans();\n+\n+    public void setBeans(Map beans);\n     \n-    public PipelineComponentScopeHolder() {\n-        beans = new HashMap();\n-        destructionCallbacks = new HashMap();\n-    }\n+    public Map getParentBeans();\n     \n-    public Map getBeans() {\n-        return beans;\n-    }\n+    public void setParentBeans(Map parentBeans);\n+\n+    public Map getDestructionCallbacks();\n+\n+    public void setDestructionCallbacks(Map destructionCallbacks);\n     \n-    public void setBeans(Map beans) {\n-        this.beans = beans;\n-    }\n+    public Map getParentDestructionCallbacks();\n+\n+    public void setParentDestructionCallbacks(Map destructionCallbacks);\n     \n-    public Map getDestructionCallbacks() {\n-        return destructionCallbacks;\n-    }\n+    public void setInScope(boolean inScope);\n     \n-    public void setDestructionCallbacks(Map destructionCallbacks) {\n-        this.destructionCallbacks = destructionCallbacks;\n-    }\n-\n-    public boolean isInScope() {\n-        return inScope;\n-    }\n-\n-    public void setInScope(boolean inScope) {\n-        this.inScope = inScope;\n-    }\n-}\n+    public boolean getInScope();\n+\n+}\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/cocoon/raw/85ca05f6623eb6a8a187324f37c300afdd7c2423/core/cocoon-pipeline/cocoon-pipeline-impl/src/main/java/org/apache/cocoon/components/pipeline/spring/PipelineComponentScopeHolder.java",
                "sha": "c4824a074664c549743379ef50bb52675db5c448",
                "status": "modified"
            },
            {
                "additions": 103,
                "blob_url": "https://github.com/apache/cocoon/blob/85ca05f6623eb6a8a187324f37c300afdd7c2423/core/cocoon-pipeline/cocoon-pipeline-impl/src/main/java/org/apache/cocoon/components/pipeline/spring/PipelineComponentScopeHolderImpl.java",
                "changes": 103,
                "contents_url": "https://api.github.com/repos/apache/cocoon/contents/core/cocoon-pipeline/cocoon-pipeline-impl/src/main/java/org/apache/cocoon/components/pipeline/spring/PipelineComponentScopeHolderImpl.java?ref=85ca05f6623eb6a8a187324f37c300afdd7c2423",
                "deletions": 0,
                "filename": "core/cocoon-pipeline/cocoon-pipeline-impl/src/main/java/org/apache/cocoon/components/pipeline/spring/PipelineComponentScopeHolderImpl.java",
                "patch": "@@ -0,0 +1,103 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.cocoon.components.pipeline.spring;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class PipelineComponentScopeHolderImpl implements PipelineComponentScopeHolder {\n+    private Map beans;\n+    private Map destructionCallbacks;\n+    \n+    private Map parentBeans;\n+    private Map parentDestructionCallbacks;\n+    \n+    private boolean inScope;\n+    \n+    public PipelineComponentScopeHolderImpl() {\n+        beans = new HashMap();\n+        destructionCallbacks = new HashMap();\n+        parentBeans = null;\n+        parentDestructionCallbacks = null;\n+        inScope = false;\n+    }\n+    \n+    /* (non-Javadoc)\n+     * @see org.apache.cocoon.components.pipeline.spring.PipelineComponentScopeHolder#getBeans()\n+     */\n+    public Map getBeans() {\n+        return beans;\n+    }\n+    \n+    /* (non-Javadoc)\n+     * @see org.apache.cocoon.components.pipeline.spring.PipelineComponentScopeHolder#setBeans(java.util.Map)\n+     */\n+    public void setBeans(Map beans) {\n+        this.beans = beans;\n+    }\n+    \n+    /* (non-Javadoc)\n+     * @see org.apache.cocoon.components.pipeline.spring.PipelineComponentScopeHolder#getDestructionCallbacks()\n+     */\n+    public Map getDestructionCallbacks() {\n+        return destructionCallbacks;\n+    }\n+    \n+    /* (non-Javadoc)\n+     * @see org.apache.cocoon.components.pipeline.spring.PipelineComponentScopeHolder#setDestructionCallbacks(java.util.Map)\n+     */\n+    public void setDestructionCallbacks(Map destructionCallbacks) {\n+        this.destructionCallbacks = destructionCallbacks;\n+    }\n+\n+    /* (non-Javadoc)\n+     * @see org.apache.cocoon.components.pipeline.spring.PipelineComponentScopeHolder#getParentBeans()\n+     */\n+    public Map getParentBeans() {\n+        return parentBeans;\n+    }\n+\n+    /* (non-Javadoc)\n+     * @see org.apache.cocoon.components.pipeline.spring.PipelineComponentScopeHolder#getParentDestructionCallbacks()\n+     */\n+    public Map getParentDestructionCallbacks() {\n+        return parentDestructionCallbacks;\n+    }\n+\n+    /* (non-Javadoc)\n+     * @see org.apache.cocoon.components.pipeline.spring.PipelineComponentScopeHolder#setParentBeans()\n+     */\n+    public void setParentBeans(Map parentBeans) {\n+        this.parentBeans = parentBeans;\n+    }\n+\n+    /* (non-Javadoc)\n+     * @see org.apache.cocoon.components.pipeline.spring.PipelineComponentScopeHolder#setParentDestructionCallbacks(java.util.Map)\n+     */\n+    public void setParentDestructionCallbacks(Map destructionCallbacks) {\n+        this.parentDestructionCallbacks = destructionCallbacks;\n+    }\n+\n+    public boolean getInScope() {\n+        return inScope;\n+    }\n+\n+    public void setInScope(boolean inScope) {\n+        this.inScope = inScope;\n+    }\n+\n+}",
                "raw_url": "https://github.com/apache/cocoon/raw/85ca05f6623eb6a8a187324f37c300afdd7c2423/core/cocoon-pipeline/cocoon-pipeline-impl/src/main/java/org/apache/cocoon/components/pipeline/spring/PipelineComponentScopeHolderImpl.java",
                "sha": "7993575a239890afae2cdad538051d949cbb94d3",
                "status": "added"
            },
            {
                "additions": 31,
                "blob_url": "https://github.com/apache/cocoon/blob/85ca05f6623eb6a8a187324f37c300afdd7c2423/core/cocoon-pipeline/cocoon-pipeline-impl/src/main/resources/META-INF/cocoon/spring/ObjectModel.xml",
                "changes": 31,
                "contents_url": "https://api.github.com/repos/apache/cocoon/contents/core/cocoon-pipeline/cocoon-pipeline-impl/src/main/resources/META-INF/cocoon/spring/ObjectModel.xml?ref=85ca05f6623eb6a8a187324f37c300afdd7c2423",
                "deletions": 0,
                "filename": "core/cocoon-pipeline/cocoon-pipeline-impl/src/main/resources/META-INF/cocoon/spring/ObjectModel.xml",
                "patch": "@@ -0,0 +1,31 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  Licensed to the Apache Software Foundation (ASF) under one or more\n+  contributor license agreements.  See the NOTICE file distributed with\n+  this work for additional information regarding copyright ownership.\n+  The ASF licenses this file to You under the Apache License, Version 2.0\n+  (the \"License\"); you may not use this file except in compliance with\n+  the License.  You may obtain a copy of the License at\n+  \n+  http://www.apache.org/licenses/LICENSE-2.0\n+  \n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+-->\n+<!-- SVN $Id$ -->\n+<beans xmlns=\"http://www.springframework.org/schema/beans\"\n+  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+  xmlns:aop=\"http://www.springframework.org/schema/aop\"\n+  xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd\n+  http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd\">\n+  \n+  <!-- Default implementation of ObjectModel interface in pipelineComponent scope. -->\n+  <bean name=\"org.apache.cocoon.objectmodel.ObjectModel\" class=\"org.apache.cocoon.objectmodel.ObjectModelImpl\" \n+        scope=\"pipelineComponent\" parent=\"org.apache.cocoon.objectmodel.ObjectModel.template\">\n+    <aop:scoped-proxy proxy-target-class=\"false\"/>\n+  </bean>\n+  \n+</beans>\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/cocoon/raw/85ca05f6623eb6a8a187324f37c300afdd7c2423/core/cocoon-pipeline/cocoon-pipeline-impl/src/main/resources/META-INF/cocoon/spring/ObjectModel.xml",
                "sha": "baa32aacf9a14b9a33de133b29cae774a0b5325c",
                "status": "added"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/cocoon/blob/85ca05f6623eb6a8a187324f37c300afdd7c2423/core/cocoon-pipeline/cocoon-pipeline-impl/src/main/resources/META-INF/cocoon/spring/PipelineComponentScope.xml",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/cocoon/contents/core/cocoon-pipeline/cocoon-pipeline-impl/src/main/resources/META-INF/cocoon/spring/PipelineComponentScope.xml?ref=85ca05f6623eb6a8a187324f37c300afdd7c2423",
                "deletions": 2,
                "filename": "core/cocoon-pipeline/cocoon-pipeline-impl/src/main/resources/META-INF/cocoon/spring/PipelineComponentScope.xml",
                "patch": "@@ -36,8 +36,8 @@\n   </bean>\n   \n   <bean id=\"org.apache.cocoon.components.pipeline.spring.PipelineComponentScopeHolder\"\n-        class=\"org.apache.cocoon.components.pipeline.spring.PipelineComponentScopeHolder\" scope=\"call\">\n-    <aop:scoped-proxy/>\n+        class=\"org.apache.cocoon.components.pipeline.spring.PipelineComponentScopeHolderImpl\" scope=\"call\">\n+    <aop:scoped-proxy proxy-target-class=\"false\"/>\n   </bean>\n   \n   <bean id=\"org.apache.cocoon.components.pipeline.spring.PipelineComponentProxyDecorator\"",
                "raw_url": "https://github.com/apache/cocoon/raw/85ca05f6623eb6a8a187324f37c300afdd7c2423/core/cocoon-pipeline/cocoon-pipeline-impl/src/main/resources/META-INF/cocoon/spring/PipelineComponentScope.xml",
                "sha": "6433065c5721ed4876bec1ff96a76738face18af",
                "status": "modified"
            }
        ],
        "message": "COCOON-2122: Added support for calls of methods inside pipelineComponent scope (previously, each call created new scope and it led to NPEs)\nCOCOON-2124: Changed scope of Object Model to pipelineComponent.\n* ObjectModel configuration in cocoon-expression-language-impl is just a template. Actual definition of ObjectModel bean is in cocoon-pipeline-impl because Object Model is bound to pipelineComponent scope, now.\n* Redefinied ObjectModel in tests using newly introduced bean configuration template.\n* Introduced PipelinecomponentScopeHolder interface, this allows me to remove dependency on cglib.\n\ngit-svn-id: https://svn.apache.org/repos/asf/cocoon/trunk@567666 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/cocoon/commit/b4b0d3ccb462a9e53981bae2cf567b063fc71975",
        "repo": "cocoon",
        "unit_tests": [
            "ObjectModelTest.java"
        ]
    }
}