[
    {
        "repo": "logging-log4j2",
        "commit": "https://github.com/apache/logging-log4j2/commit/4786a7395121e0fd1b4e12d7e1b3c0eebd64d794",
        "bug_id": "logging-log4j2_4786a73",
        "message": "[LOG4J2-1067] ThrowableProxy getExtendedStackTraceAsString throws NPE on\ndeserialized nested exceptions.",
        "parent": "https://github.com/apache/logging-log4j2/commit/7d732fa7a5df8a24c36c30f4d716b863d76e79bd",
        "patched_files": [
            "changes.xml",
            "ThrowableProxy.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 9,
                "raw_url": "https://github.com/apache/logging-log4j2/raw/4786a7395121e0fd1b4e12d7e1b3c0eebd64d794/log4j-core/src/main/java/org/apache/logging/log4j/core/impl/ThrowableProxy.java",
                "contents_url": "https://api.github.com/repos/apache/logging-log4j2/contents/log4j-core/src/main/java/org/apache/logging/log4j/core/impl/ThrowableProxy.java?ref=4786a7395121e0fd1b4e12d7e1b3c0eebd64d794",
                "filename": "log4j-core/src/main/java/org/apache/logging/log4j/core/impl/ThrowableProxy.java",
                "deletions": 9,
                "sha": "d0800cc5a54b2e940ebc96d54d55e7cca9cf205a",
                "blob_url": "https://github.com/apache/logging-log4j2/blob/4786a7395121e0fd1b4e12d7e1b3c0eebd64d794/log4j-core/src/main/java/org/apache/logging/log4j/core/impl/ThrowableProxy.java",
                "patch": "@@ -202,15 +202,15 @@ public boolean equals(final Object obj) {\n     }\n \n     @SuppressWarnings(\"ThrowableResultOfMethodCallIgnored\")\n-    private void formatCause(final StringBuilder sb, final ThrowableProxy cause, final List<String> ignorePackages) {\n-        if (cause == null) {\n-            return;\n-        }\n-        sb.append(\"Caused by: \").append(cause).append(EOL);\n-        this.formatElements(sb, cause.commonElementCount, cause.getThrowable().getStackTrace(),\n-                cause.extendedStackTrace, ignorePackages);\n-        this.formatCause(sb, cause.causeProxy, ignorePackages);\n-    }\n+\tprivate void formatCause(final StringBuilder sb, final ThrowableProxy cause, final List<String> ignorePackages) {\n+\t\tif (cause == null) {\n+\t\t\treturn;\n+\t\t}\n+\t\tsb.append(\"Caused by: \").append(cause).append(EOL);\n+\t\tthis.formatElements(sb, cause.commonElementCount, cause.getStackTrace(), cause.extendedStackTrace,\n+\t\t\t\tignorePackages);\n+\t\tthis.formatCause(sb, cause.causeProxy, ignorePackages);\n+\t}\n \n     private void formatElements(final StringBuilder sb, final int commonCount, final StackTraceElement[] causedTrace,\n             final ExtendedStackTraceElement[] extStackTrace, final List<String> ignorePackages) {",
                "changes": 18
            },
            {
                "status": "modified",
                "additions": 28,
                "raw_url": "https://github.com/apache/logging-log4j2/raw/4786a7395121e0fd1b4e12d7e1b3c0eebd64d794/log4j-core/src/test/java/org/apache/logging/log4j/core/impl/ThrowableProxyTest.java",
                "contents_url": "https://api.github.com/repos/apache/logging-log4j2/contents/log4j-core/src/test/java/org/apache/logging/log4j/core/impl/ThrowableProxyTest.java?ref=4786a7395121e0fd1b4e12d7e1b3c0eebd64d794",
                "filename": "log4j-core/src/test/java/org/apache/logging/log4j/core/impl/ThrowableProxyTest.java",
                "deletions": 1,
                "sha": "08d0a4b94b4424c7f75197f508082170e7bd5d10",
                "blob_url": "https://github.com/apache/logging-log4j2/blob/4786a7395121e0fd1b4e12d7e1b3c0eebd64d794/log4j-core/src/test/java/org/apache/logging/log4j/core/impl/ThrowableProxyTest.java",
                "patch": "@@ -35,7 +35,6 @@\n import org.apache.logging.log4j.LogManager;\n import org.apache.logging.log4j.Logger;\n import org.apache.logging.log4j.core.jackson.Log4jJsonObjectMapper;\n-import org.junit.Ignore;\n import org.junit.Test;\n \n import com.fasterxml.jackson.annotation.JsonProperty;\n@@ -146,6 +145,34 @@ public void testSerialization_getExtendedStackTraceAsString() throws Exception {\n \n         assertEquals(proxy.getExtendedStackTraceAsString(), proxy2.getExtendedStackTraceAsString());\n     }\n+    \n+    @Test\n+\tpublic void testSerialization_getExtendedStackTraceAsStringWithNestedThrowableDepth1() throws Exception {\n+\t\tfinal Throwable throwable = new RuntimeException(new IllegalArgumentException(\"This is a test\"));\n+\t\ttestSerialization_getExtendedStackTraceAsStringWithNestedThrowable(throwable);\n+\t}\n+\n+    @Test\n+\tpublic void testSerialization_getExtendedStackTraceAsStringWithNestedThrowableDepth2() throws Exception {\n+\t\tfinal Throwable throwable = new RuntimeException(\n+\t\t\t\tnew IllegalArgumentException(\"This is a test\", new IOException(\"level 2\")));\n+\t\ttestSerialization_getExtendedStackTraceAsStringWithNestedThrowable(throwable);\n+\t}\n+\n+    @Test\n+\tpublic void testSerialization_getExtendedStackTraceAsStringWithNestedThrowableDepth3() throws Exception {\n+\t\tfinal Throwable throwable = new RuntimeException(new IllegalArgumentException(\"level 1\",\n+\t\t\t\tnew IOException(\"level 2\", new IllegalStateException(\"level 3\"))));\n+\t\ttestSerialization_getExtendedStackTraceAsStringWithNestedThrowable(throwable);\n+\t}\n+\n+    private void testSerialization_getExtendedStackTraceAsStringWithNestedThrowable(Throwable throwable) throws Exception {\n+        final ThrowableProxy proxy = new ThrowableProxy(throwable);\n+        final byte[] binary = serialize(proxy);\n+        final ThrowableProxy proxy2 = deserialize(binary);\n+\n+        assertEquals(proxy.getExtendedStackTraceAsString(), proxy2.getExtendedStackTraceAsString());\n+    }\n \n     @Test\n     public void testSerializationWithUnknownThrowable() throws Exception {",
                "changes": 29
            },
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/logging-log4j2/raw/4786a7395121e0fd1b4e12d7e1b3c0eebd64d794/src/changes/changes.xml",
                "contents_url": "https://api.github.com/repos/apache/logging-log4j2/contents/src/changes/changes.xml?ref=4786a7395121e0fd1b4e12d7e1b3c0eebd64d794",
                "filename": "src/changes/changes.xml",
                "deletions": 0,
                "sha": "3451f8598f79bb06cb6409ebb8fe9193dc1a8854",
                "blob_url": "https://github.com/apache/logging-log4j2/blob/4786a7395121e0fd1b4e12d7e1b3c0eebd64d794/src/changes/changes.xml",
                "patch": "@@ -48,6 +48,9 @@\n       <action issue=\"LOG4J2-1051\" dev=\"ggregory\" type=\"fix\" due-to=\"Lukasz Lenart\">\r\n         NoClassDefFoundError when starting app on Google App Engine.\r\n       </action>\r\n+      <action issue=\"LOG4J2-1067\" dev=\"ggregory\" type=\"fix\" due-to=\"Sam Braam\">\r\n+        ThrowableProxy getExtendedStackTraceAsString throws NPE on deserialized nested exceptions.\r\n+      </action>\r\n       <action issue=\"LOG4J2-1049\" dev=\"rpopma\" type=\"fix\" due-to=\"Robert Schaft\">\r\n         AsyncAppender now resets the thread interrupted flag after catching InterruptedException.\r\n       </action>\r",
                "changes": 3
            }
        ],
        "unit_tests": [
            "ThrowableProxyTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "log4j-core/src/test/java/org/apache/logging/log4j/core/impl/ThrowableProxyTest.java",
        "buggy_files": [
            "src/changes/changes.xml",
            "log4j-core/src/main/java/org/apache/logging/log4j/core/impl/ThrowableProxy.java"
        ],
        "fixed": true
    }
]