[{"commit": "https://github.com/apache/lenya/commit/84e2cedde53e39ef40a4d383dd549a2ed1bb892d", "parent": "https://github.com/apache/lenya/commit/35d8498948614372e5a9976d8c5b06c274d137c1", "message": "fixed some NPEs when migrating a pub with no areas (should skip pub, not give npe)\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@438213 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_1", "file": [{"additions": 5, "raw_url": "https://github.com/apache/lenya/raw/84e2cedde53e39ef40a4d383dd549a2ed1bb892d/src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java", "blob_url": "https://github.com/apache/lenya/blob/84e2cedde53e39ef40a4d383dd549a2ed1bb892d/src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java", "sha": "302162aca45048dbff53441c93523568b5cccf54", "changes": 8, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java?ref=84e2cedde53e39ef40a4d383dd549a2ed1bb892d", "patch": "@@ -477,9 +477,11 @@ public boolean accept(File file) {\n                     return file.isDirectory() && !name.equals(\"rcml\") && !name.equals(\"rcbak\");\n                 }\n             });\n-            this.areas = new String[directories.length];\n-            for (int i = 0; i < directories.length; i++) {\n-                this.areas[i] = directories[i].getName();\n+            if (directories != null) {\n+                this.areas = new String[directories.length];\n+                for (int i = 0; i < directories.length; i++) {\n+                    this.areas[i] = directories[i].getName();\n+                }\n             }\n         }\n         return this.areas;", "filename": "src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java"}, {"additions": 5, "raw_url": "https://github.com/apache/lenya/raw/84e2cedde53e39ef40a4d383dd549a2ed1bb892d/src/modules/migration/java/test/org/apache/lenya/cms/migration/MigrateUuidsTest.java", "blob_url": "https://github.com/apache/lenya/blob/84e2cedde53e39ef40a4d383dd549a2ed1bb892d/src/modules/migration/java/test/org/apache/lenya/cms/migration/MigrateUuidsTest.java", "sha": "91546bba901226db02aed34cb4136b199cde8d0e", "changes": 8, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/migration/java/test/org/apache/lenya/cms/migration/MigrateUuidsTest.java?ref=84e2cedde53e39ef40a4d383dd549a2ed1bb892d", "patch": "@@ -67,9 +67,11 @@ private void migratePublication(Publication pub) throws Exception {\n         getLogger().info(\"Migrating publication [\" + pub.getId() + \"]\");\n \n         String[] areaNames = pub.getAreaNames();\n-        for (int i = 0; i < areaNames.length; i++) {\n-            Area area = pub.getArea(areaNames[i]);\n-            migrateArea(area);\n+        if (areaNames != null) {\n+            for (int i = 0; i < areaNames.length; i++) {\n+                Area area = pub.getArea(areaNames[i]);\n+                migrateArea(area);\n+            }\n         }\n     }\n ", "filename": "src/modules/migration/java/test/org/apache/lenya/cms/migration/MigrateUuidsTest.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/304ff122ce0d951d72414cc9d275c5b262f06531", "parent": "https://github.com/apache/lenya/commit/57061cd7b110a689d78bee2a34f439fd4121ba91", "message": "Fixed possible NPE.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@571470 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_2", "file": [{"additions": 3, "raw_url": "https://github.com/apache/lenya/raw/304ff122ce0d951d72414cc9d275c5b262f06531/src/impl/java/org/apache/lenya/cms/publication/PublicationManagerImpl.java", "blob_url": "https://github.com/apache/lenya/blob/304ff122ce0d951d72414cc9d275c5b262f06531/src/impl/java/org/apache/lenya/cms/publication/PublicationManagerImpl.java", "sha": "6a8f29aebce660daf59efb5f55e1dd889480aa26", "changes": 5, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/impl/java/org/apache/lenya/cms/publication/PublicationManagerImpl.java?ref=304ff122ce0d951d72414cc9d275c5b262f06531", "patch": "@@ -148,13 +148,14 @@ public void initialize() throws Exception {\n     }\n \n     public void addPublication(String pubId) throws PublicationException {\n-        if (this.id2config.containsKey(pubId)) {\n+        Map id2config = getId2config();\n+        if (id2config.containsKey(pubId)) {\n             throw new PublicationException(\"The publication [\" + pubId + \"] already exists.\");\n         }\n         PublicationConfiguration config = new PublicationConfiguration(pubId,\n                 this.servletContextPath);\n         ContainerUtil.enableLogging(config, getLogger());\n-        this.id2config.put(pubId, config);\n+        id2config.put(pubId, config);\n     }\n \n     protected String getServletContextPath() {", "filename": "src/impl/java/org/apache/lenya/cms/publication/PublicationManagerImpl.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/384f04347ffc94b1ce6fa4b999194db2533eb4bc", "parent": "https://github.com/apache/lenya/commit/1ce4e3b9ec4cfce2dea053b353b20537ddfd8a52", "message": "Fix potential NPE\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@565388 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_3", "file": [{"additions": 3, "raw_url": "https://github.com/apache/lenya/raw/384f04347ffc94b1ce6fa4b999194db2533eb4bc/src/java/org/apache/lenya/util/ServletHelper.java", "blob_url": "https://github.com/apache/lenya/blob/384f04347ffc94b1ce6fa4b999194db2533eb4bc/src/java/org/apache/lenya/util/ServletHelper.java", "sha": "9f654ef1fee3f364c83af979d526ff86bb059c20", "changes": 5, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/util/ServletHelper.java?ref=384f04347ffc94b1ce6fa4b999194db2533eb4bc", "patch": "@@ -124,9 +124,10 @@ public static synchronized boolean isUploadEnabled(ServiceManager manager)\n \n             if (node == null) {\n                 ServletHelper.uploadEnabled = Boolean.FALSE;\n+            } else {\n+                boolean enabled = node.getNodeValue().equals(\"true\");\n+                ServletHelper.uploadEnabled = Boolean.valueOf(enabled);\n             }\n-            boolean enabled = node.getNodeValue().equals(\"true\");\n-            ServletHelper.uploadEnabled = Boolean.valueOf(enabled);\n         }\n         return ServletHelper.uploadEnabled.booleanValue();\n     }", "filename": "src/java/org/apache/lenya/util/ServletHelper.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/b5f88e944c8a163474c4e8c65fcb7c0901cbd882", "parent": "https://github.com/apache/lenya/commit/2b3527c11c2ecddbba36f8a9bed6dfbe9193ab67", "message": "Avoid NPE when there is no parent.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@644484 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_4", "file": [{"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/b5f88e944c8a163474c4e8c65fcb7c0901cbd882/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/CreateDocument.java", "blob_url": "https://github.com/apache/lenya/blob/b5f88e944c8a163474c4e8c65fcb7c0901cbd882/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/CreateDocument.java", "sha": "b91c82dc689c927ed24bd5a785c5b337d90d8830", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/CreateDocument.java?ref=b5f88e944c8a163474c4e8c65fcb7c0901cbd882", "patch": "@@ -55,6 +55,7 @@ protected void initParameters() {\n         if (parent == null) {\n             setParameter(PARENT_PATH, \"\");\n         } else {\n+            setParameter(LANGUAGE,parent.getLanguage());\n             try {\n                 setParameter(PARENT_PATH, parent.getPath());\n             } catch (DocumentException e) {\n@@ -67,7 +68,6 @@ protected void initParameters() {\n             addErrorMessage(\"The publication doesn't contain any languages!\");\n         }\n         setParameter(LANGUAGES, languages);\n-        setParameter(LANGUAGE,parent.getLanguage());\n \n         Document sourceDoc = getSourceDocument();\n         String[] childOnly = { RELATION_CHILD };", "filename": "src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/CreateDocument.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/f13098df81bde0b40988e938ee3f095d1c7f486d", "parent": "https://github.com/apache/lenya/commit/5ece66aad8f2bbf52b4e1ea31b2111e5040ba153", "message": "Fix NPE in bug 43916.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@596749 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_5", "file": [{"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/f13098df81bde0b40988e938ee3f095d1c7f486d/src/modules-core/sitemanagement/config/cocoon-xconf/tab/usecase-tab-acArchive.xconf", "blob_url": "https://github.com/apache/lenya/blob/f13098df81bde0b40988e938ee3f095d1c7f486d/src/modules-core/sitemanagement/config/cocoon-xconf/tab/usecase-tab-acArchive.xconf", "sha": "65a43fb9829181db82c78eb810295390eff71fe8", "changes": 1, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/sitemanagement/config/cocoon-xconf/tab/usecase-tab-acArchive.xconf?ref=f13098df81bde0b40988e938ee3f095d1c7f486d", "patch": "@@ -26,6 +26,7 @@\n       <view uri=\"modules/sitemanagement/usecases/tab/acArchive.jx\" menu=\"true\">\r\n         <tab group=\"site\" name=\"acArchive\"/>\r\n       </view>\r\n+      <parameter name=\"acArea\" value=\"archive\"/>\r\n       <exit usecase=\"tab.acArchive\"/>\r\n     </component-instance>\r\n   </xconf>\r", "filename": "src/modules-core/sitemanagement/config/cocoon-xconf/tab/usecase-tab-acArchive.xconf"}, {"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/f13098df81bde0b40988e938ee3f095d1c7f486d/src/modules-core/sitemanagement/config/cocoon-xconf/tab/usecase-tab-acTrash.xconf", "blob_url": "https://github.com/apache/lenya/blob/f13098df81bde0b40988e938ee3f095d1c7f486d/src/modules-core/sitemanagement/config/cocoon-xconf/tab/usecase-tab-acTrash.xconf", "sha": "83ff95bcdfa3993799ee6d7b825a013417b1284c", "changes": 1, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/sitemanagement/config/cocoon-xconf/tab/usecase-tab-acTrash.xconf?ref=f13098df81bde0b40988e938ee3f095d1c7f486d", "patch": "@@ -26,6 +26,7 @@\n       <view uri=\"modules/sitemanagement/usecases/tab/acTrash.jx\" menu=\"true\">\r\n         <tab group=\"site\" name=\"acTrash\"/>\r\n       </view>\r\n+      <parameter name=\"acArea\" value=\"trash\"/>\r\n       <exit usecase=\"tab.acTrash\"/>\r\n     </component-instance>\r\n   </xconf>\r", "filename": "src/modules-core/sitemanagement/config/cocoon-xconf/tab/usecase-tab-acTrash.xconf"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/45149c09a73b5afbc5c35113aa3b066d7839ac62", "parent": "https://github.com/apache/lenya/commit/99e05a9a54c3804d1b62a14df42981642c401ed0", "message": "Commented out invalid checks to avoid NPE in RevisionControllerTest\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@588618 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_6", "file": [{"additions": 2, "raw_url": "https://github.com/apache/lenya/raw/45149c09a73b5afbc5c35113aa3b066d7839ac62/src/impl/test/org/apache/lenya/cms/rc/RevisionControllerTest.java", "blob_url": "https://github.com/apache/lenya/blob/45149c09a73b5afbc5c35113aa3b066d7839ac62/src/impl/test/org/apache/lenya/cms/rc/RevisionControllerTest.java", "sha": "c0acd9def9765631dac6841f2398eb95be355923", "changes": 4, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/impl/test/org/apache/lenya/cms/rc/RevisionControllerTest.java?ref=45149c09a73b5afbc5c35113aa3b066d7839ac62", "patch": "@@ -77,8 +77,8 @@ public void testRevisionController() throws RepositoryException, RevisionControl\n         String source = args[1];\n         String identityD = args[2];\n         String destination = args[3];\n-        doc1.getRepositoryNode().checkout();\n-        doc2.getRepositoryNode().checkin();\n+        //doc1.getRepositoryNode().checkout();\n+        //doc2.getRepositoryNode().checkin();\n     }\n \n }", "filename": "src/impl/test/org/apache/lenya/cms/rc/RevisionControllerTest.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/e713661bf0049ddd93bb7f1587c41587eaf5c662", "parent": "https://github.com/apache/lenya/commit/049abece913839dcf96988e9110e0675d4654eee", "message": "Avoid NPE in PageEnvelopeModule for non-publication URLs\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@570146 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_7", "file": [{"additions": 2, "raw_url": "https://github.com/apache/lenya/raw/e713661bf0049ddd93bb7f1587c41587eaf5c662/src/java/org/apache/lenya/cms/cocoon/components/modules/input/PageEnvelopeModule.java", "blob_url": "https://github.com/apache/lenya/blob/e713661bf0049ddd93bb7f1587c41587eaf5c662/src/java/org/apache/lenya/cms/cocoon/components/modules/input/PageEnvelopeModule.java", "sha": "20acf8c4623f86f035c3b449c8aa0fa449fa0459", "changes": 3, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/cocoon/components/modules/input/PageEnvelopeModule.java?ref=e713661bf0049ddd93bb7f1587c41587eaf5c662", "patch": "@@ -76,7 +76,8 @@ public Object getAttribute(final String attributeName, Configuration modeConf, M\n             } else if (name.equals(PageEnvelope.IS_PUBLICATION)) {\n                 value = Boolean.toString(envelope.getPublication() != null);\n             } else if (name.equals(PageEnvelope.PUBLICATION_ID)) {\n-                value = envelope.getPublication().getId();\n+                Publication pub = envelope.getPublication();\n+                value = pub != null ? pub.getId() : \"\";\n             } else if (name.equals(PageEnvelope.PUBLICATION)) {\n                 value = envelope.getPublication();\n             } else if (name.equals(PageEnvelope.PUBLICATION_LANGUAGES_CSV)) {", "filename": "src/java/org/apache/lenya/cms/cocoon/components/modules/input/PageEnvelopeModule.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/afded45ea6763591a2321dfd13f4e1951118b1d7", "parent": "https://github.com/apache/lenya/commit/0ef315576aad0c5fba450719d29bdc6fe4b2cc61", "message": "Prevent NPE in final handleError() method.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@565832 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_8", "file": [{"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/afded45ea6763591a2321dfd13f4e1951118b1d7/src/modules/lucene/java/src/org/apache/cocoon/transformation/LuceneIndexTransformer2.java", "blob_url": "https://github.com/apache/lenya/blob/afded45ea6763591a2321dfd13f4e1951118b1d7/src/modules/lucene/java/src/org/apache/cocoon/transformation/LuceneIndexTransformer2.java", "sha": "4a4e266cb5798f6253f7cb530502faaf735ec23e", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/lucene/java/src/org/apache/cocoon/transformation/LuceneIndexTransformer2.java?ref=afded45ea6763591a2321dfd13f4e1951118b1d7", "patch": "@@ -579,7 +579,7 @@ private void initIndexer(Attributes atts) throws SAXException {\n     }\n \n     void handleError(String msg) throws SAXException {\n-        this.handleError(msg, null);\n+        this.handleError(msg, new Exception());\n     }\n \n     void handleError(Exception ex) throws SAXException {", "filename": "src/modules/lucene/java/src/org/apache/cocoon/transformation/LuceneIndexTransformer2.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/a6a0427654d2a2755d1edf0b860053f54395acca", "parent": "https://github.com/apache/lenya/commit/d275f0b5ea4509c521212ce0da2d40cdb2009d81", "message": "Avoid NPE in force check-in usecase\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@564598 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_9", "file": [{"additions": 4, "raw_url": "https://github.com/apache/lenya/raw/a6a0427654d2a2755d1edf0b860053f54395acca/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ForceCheckIn.java", "blob_url": "https://github.com/apache/lenya/blob/a6a0427654d2a2755d1edf0b860053f54395acca/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ForceCheckIn.java", "sha": "16a0c2d2301c335dde6b4ce6cc9fd96f98655dc8", "changes": 5, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ForceCheckIn.java?ref=a6a0427654d2a2755d1edf0b860053f54395acca", "patch": "@@ -44,7 +44,10 @@ protected void doCheckPreconditions() throws Exception {\n         super.doCheckPreconditions();\n \n         Document doc = getSourceDocument();\n-\n+        if (doc == null) {\n+            return;\n+        }\n+        \n         Node node = doc.getRepositoryNode();\n         if (!node.isCheckedOut()) {\n             String[] params = { DublinCoreHelper.getTitle(doc) };", "filename": "src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ForceCheckIn.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/3f51dc7ca08da282724f7e1e2f31ab102be300a8", "parent": "https://github.com/apache/lenya/commit/4d2feeee13e44424d7a2d2df08526d0d703ae0de", "message": "Revisions usecase: Removed NPE workaround, use parameter for workflow event\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@562400 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_10", "file": [{"additions": 2, "raw_url": "https://github.com/apache/lenya/raw/3f51dc7ca08da282724f7e1e2f31ab102be300a8/src/modules-core/sitemanagement/config/cocoon-xconf/tab/usecase-tab-revisions.xconf", "blob_url": "https://github.com/apache/lenya/blob/3f51dc7ca08da282724f7e1e2f31ab102be300a8/src/modules-core/sitemanagement/config/cocoon-xconf/tab/usecase-tab-revisions.xconf", "sha": "b575a65eb729394b82470a00d115cb9a2637f3d2", "changes": 3, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/sitemanagement/config/cocoon-xconf/tab/usecase-tab-revisions.xconf?ref=3f51dc7ca08da282724f7e1e2f31ab102be300a8", "patch": "@@ -25,7 +25,8 @@\n     <component-instance name=\"tab.revisions\" logger=\"lenya.site\" class=\"org.apache.lenya.cms.site.usecases.Revisions\">\r\n       <view template=\"modules/sitemanagement/usecases/tab/revisions.jx\" menu=\"true\">\r\n         <tab group=\"site\" name=\"revisions\"/>\r\n-      </view>\r\n+      </view>\n+      <parameter name=\"workflowEvent\" value=\"edit\"/>\r\n       <exit usecase=\"tab.revisions\"/>\r\n     </component-instance>\r\n   </xconf>\r", "filename": "src/modules-core/sitemanagement/config/cocoon-xconf/tab/usecase-tab-revisions.xconf"}, {"additions": 45, "raw_url": "https://github.com/apache/lenya/raw/3f51dc7ca08da282724f7e1e2f31ab102be300a8/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/Revisions.java", "blob_url": "https://github.com/apache/lenya/blob/3f51dc7ca08da282724f7e1e2f31ab102be300a8/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/Revisions.java", "sha": "90d3b57ce29e4744bbbc2401dd238d61bc394e2f", "changes": 99, "status": "modified", "deletions": 54, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/Revisions.java?ref=3f51dc7ca08da282724f7e1e2f31ab102be300a8", "patch": "@@ -22,6 +22,9 @@\n import org.apache.lenya.cms.publication.Document;\n import org.apache.lenya.cms.rc.RCML;\n import org.apache.lenya.cms.workflow.WorkflowUtil;\n+import org.apache.lenya.workflow.Version;\n+import org.apache.lenya.workflow.Workflow;\n+import org.apache.lenya.workflow.Workflowable;\n \n /**\n  * Usecase to display revisions of a resource.\n@@ -32,8 +35,6 @@\n \n     private RCML rcml = null;\n \n-    public static final String WORKFLOW_EVENT_EDIT = \"edit\";\n-\n     /**\n      * @see org.apache.lenya.cms.usecase.AbstractUsecase#initParameters() TODO\n      *      filter out checkin entries\n@@ -47,76 +48,66 @@ protected void initParameters() {\n             } catch (final Exception e) {\n                 throw new RuntimeException(e);\n             }\n-    \n+\n             Vector entries;\n             try {\n                 entries = this.rcml.getBackupEntries();\n             } catch (final Exception e) {\n                 throw new RuntimeException(e);\n             }\n             setParameter(\"entries\", entries);\n-           \n+\n             Boolean canRollback;\n-            try { \n-                canRollback = new Boolean(WorkflowUtil.canInvoke(\n-                    this.manager, \n-                    getDocumentFactory().getSession(),\n-                    getLogger(),\n-                    sourceDoc,\n-                    WORKFLOW_EVENT_EDIT));\n+            try {\n+                canRollback = new Boolean(WorkflowUtil.canInvoke(this.manager, getDocumentFactory()\n+                        .getSession(), getLogger(), sourceDoc, getEvent()));\n             } catch (final Exception e) {\n                 throw new RuntimeException(e);\n             }\n             setParameter(\"canRollback\", canRollback);\n \n-            String workflowState;\n             try {\n-                // looks like this throws a null pointer exception\n-                // when a document has never been edited :(\n-                // guess this should be fixed elsewhere. for now\n-                // let's abuse the exception handler.\n-                workflowState = WorkflowUtil.getWorkflowable(\n-                    this.manager, \n-                    getDocumentFactory().getSession(),\n-                    getLogger(),\n-                    sourceDoc\n-                ).getLatestVersion().getState();\n-                setParameter(\"workflowState\", workflowState);\n+                if (WorkflowUtil.hasWorkflow(this.manager, getSession(), getLogger(), sourceDoc)) {\n+                    Workflowable workflowable = WorkflowUtil.getWorkflowable(this.manager,\n+                            getSession(), getLogger(), sourceDoc);\n+                    Version latestVersion = workflowable.getLatestVersion();\n+                    String state;\n+                    if (latestVersion != null) {\n+                        state = latestVersion.getState();\n+                    } else {\n+                        Workflow workflow = WorkflowUtil.getWorkflowSchema(this.manager,\n+                                getSession(), getLogger(), sourceDoc);\n+                        state = workflow.getInitialState();\n+                    }\n+                    setParameter(\"workflowState\", state);\n+                }\n             } catch (final Exception e) {\n-                setParameter(\"workflowState\", \"\"); //FIXME: should return Workflow.getInitialState(). But then again, there should not be an NPE anyways...\n-                //throw new RuntimeException(e);\n-            }\n-            \n-/*\n-            // since we need both state and canInvoke, we could deal with the avalon\n-            // component ourselves rather than using WorkflowUtil - saves one\n-            // service manager lookup.\n-            // problem is that DocumentWorkflowable is not public and Workflowable is abstract :(\n-\n-            WorkflowManager wfManager = null;\n-            String workflowState;\n-            Boolean canRollback;\n-            try {\n-                wfManager = (WorkflowManager) this.manager.lookup(WorkflowManager.ROLE);\n-                Workflowable workflowable = new DocumentWorkflowable(\n-                    this.manager, \n-                    getDocumentFactory().getSession(),\n-                    sourceDoc,\n-                    getLogger()\n-                );\n-                workflowState = workflowable.getLatestVersion().getState();\n-                canRollback = new Boolean(wfManager.canInvoke(workflowable, WORKFLOW_EVENT_EDIT));\n-            } catch (ServiceException e) {\n                 throw new RuntimeException(e);\n-            } finally {\n-                if (wfManager != null) {\n-                    manager.release(wfManager);\n-                }\n             }\n-            setParameter(\"workflowState\", workflowState);\n-            setParameter(\"canRollback\", canRollback);\n-*/\n+\n+            /*\n+             * // since we need both state and canInvoke, we could deal with the\n+             * avalon // component ourselves rather than using WorkflowUtil -\n+             * saves one // service manager lookup. // problem is that\n+             * DocumentWorkflowable is not public and Workflowable is abstract :(\n+             * \n+             * WorkflowManager wfManager = null; String workflowState; Boolean\n+             * canRollback; try { wfManager = (WorkflowManager)\n+             * this.manager.lookup(WorkflowManager.ROLE); Workflowable\n+             * workflowable = new DocumentWorkflowable( this.manager,\n+             * getDocumentFactory().getSession(), sourceDoc, getLogger() );\n+             * workflowState = workflowable.getLatestVersion().getState();\n+             * canRollback = new Boolean(wfManager.canInvoke(workflowable,\n+             * WORKFLOW_EVENT_EDIT)); } catch (ServiceException e) { throw new\n+             * RuntimeException(e); } finally { if (wfManager != null) {\n+             * manager.release(wfManager); } } setParameter(\"workflowState\",\n+             * workflowState); setParameter(\"canRollback\", canRollback);\n+             */\n \n         }\n     }\n+\n+    protected String getEvent() {\n+        return getParameterAsString(\"workflowEvent\");\n+    }\n }", "filename": "src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/Revisions.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/9bfb11b3d9eefaf8da0795838ed9b1e363112baa", "parent": "https://github.com/apache/lenya/commit/54e97a0ffbd75567ebd0e8d5de2d10c7560368d8", "message": "Fixes NPE problem when trying to select the authoring node.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@559054 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_11", "file": [{"additions": 11, "raw_url": "https://github.com/apache/lenya/raw/9bfb11b3d9eefaf8da0795838ed9b1e363112baa/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/DeleteLanguage.java", "blob_url": "https://github.com/apache/lenya/blob/9bfb11b3d9eefaf8da0795838ed9b1e363112baa/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/DeleteLanguage.java", "sha": "15baba7f3753201f77abef9dff5823d7ca5c1a98", "changes": 15, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/DeleteLanguage.java?ref=9bfb11b3d9eefaf8da0795838ed9b1e363112baa", "patch": "@@ -17,6 +17,9 @@\n  */\n package org.apache.lenya.cms.site.usecases;\n \n+import java.util.ArrayList;\n+import java.util.List;\n+\n import org.apache.lenya.cms.publication.Document;\n import org.apache.lenya.cms.publication.Publication;\n import org.apache.lenya.cms.publication.util.DocumentHelper;\n@@ -57,10 +60,14 @@ protected void doCheckPreconditions() throws Exception {\n      * @see org.apache.lenya.cms.usecase.AbstractUsecase#getNodesToLock()\n      */\n     protected Node[] getNodesToLock() throws UsecaseException {\n-        Node docNode = getSourceDocument().getRepositoryNode();\n-        Node siteNode = getSourceDocument().area().getSite().getRepositoryNode();\n-        Node[] nodes = { docNode, siteNode };\n-        return nodes;\n+        List nodes = new ArrayList();\n+        if(getSourceDocument() != null) {\n+            Node docNode = getSourceDocument().getRepositoryNode();\n+            Node siteNode = getSourceDocument().area().getSite().getRepositoryNode();\n+            nodes.add(docNode);\n+            nodes.add(siteNode);\n+        }\n+        return (Node[]) nodes.toArray(new Node[nodes.size()]);\n     }\n \n     /**", "filename": "src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/DeleteLanguage.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/06f0c37c65d1df32b4e573fed7b2641840aba5f8", "parent": "https://github.com/apache/lenya/commit/233e23b0e96b861b8de98ec9aa45cfbce22029e9", "message": "URLInformation: avoid NPE for '/' URLs\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@550461 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_12", "file": [{"additions": 3, "raw_url": "https://github.com/apache/lenya/raw/06f0c37c65d1df32b4e573fed7b2641840aba5f8/src/java/org/apache/lenya/cms/publication/URLInformation.java", "blob_url": "https://github.com/apache/lenya/blob/06f0c37c65d1df32b4e573fed7b2641840aba5f8/src/java/org/apache/lenya/cms/publication/URLInformation.java", "sha": "bc8f53d75244b73ae00a682b942587bafc21abec", "changes": 5, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/publication/URLInformation.java?ref=06f0c37c65d1df32b4e573fed7b2641840aba5f8", "patch": "@@ -53,8 +53,9 @@ public String getArea() {\n      * @return A string.\n      */\n     public String getCompleteArea() {\n-        if (this.completeArea == null) {\n-            String pubUrl = this.url.substring(getPublicationId().length());\n+        String pubId = getPublicationId();\n+        if (this.completeArea == null && pubId != null) {\n+            String pubUrl = this.url.substring(pubId.length());\n             if (pubUrl.startsWith(\"/\")) {\n                 this.completeArea = extractBeforeSlash(pubUrl.substring(1));\n             } else {", "filename": "src/java/org/apache/lenya/cms/publication/URLInformation.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/2c9f20dbf6d8813f8662f4c4b904684f799289eb", "parent": "https://github.com/apache/lenya/commit/c6a254b0d3f138f57d0a626976573a734f31ae3a", "message": "AbstractUsecase.getSourceURL() doesn't use getParameter() to avoid NPEs\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@509212 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_13", "file": [{"additions": 3, "raw_url": "https://github.com/apache/lenya/raw/2c9f20dbf6d8813f8662f4c4b904684f799289eb/src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/AbstractUsecase.java", "blob_url": "https://github.com/apache/lenya/blob/2c9f20dbf6d8813f8662f4c4b904684f799289eb/src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/AbstractUsecase.java", "sha": "0c4794e5e1671bc3792288dbc9991f5c09363462", "changes": 4, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/AbstractUsecase.java?ref=2c9f20dbf6d8813f8662f4c4b904684f799289eb", "patch": "@@ -86,9 +86,11 @@ protected void advanceState(String event) {\n \n     /**\n      * @see org.apache.lenya.cms.usecase.Usecase#getSourceURL()\n+     * We don't use getParameterAsString() because this will typically\n+     * cause stack overflows or NPEs in connection with initParameters().\n      */\n     public String getSourceURL() {\n-        return getParameterAsString(SOURCE_URL);\n+        return (String) this.parameters.get(SOURCE_URL);\n     }\n \n     /**", "filename": "src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/AbstractUsecase.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/d42af1843880956365ad1b7039cb82c3597a423c", "parent": "https://github.com/apache/lenya/commit/884e0ddb2c8ab8bc12ce341377aad630e72af930", "message": "Don't throw NPE when user doesn't exist in InboxModule\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@507480 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_14", "file": [{"additions": 27, "raw_url": "https://github.com/apache/lenya/raw/d42af1843880956365ad1b7039cb82c3597a423c/src/modules/notification/java/src/org/apache/lenya/inbox/InboxModule.java", "blob_url": "https://github.com/apache/lenya/blob/d42af1843880956365ad1b7039cb82c3597a423c/src/modules/notification/java/src/org/apache/lenya/inbox/InboxModule.java", "sha": "5ab77095979cf48c3eba553e56707141d6f8757c", "changes": 45, "status": "modified", "deletions": 18, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/notification/java/src/org/apache/lenya/inbox/InboxModule.java?ref=d42af1843880956365ad1b7039cb82c3597a423c", "patch": "@@ -32,19 +32,25 @@\n import org.apache.lenya.cms.repository.Session;\n \n /**\n- * <p>Inbox module.</p>\n- * <p>Attributes:</p>\n+ * <p>\n+ * Inbox module.\n+ * </p>\n+ * <p>\n+ * Attributes:\n+ * </p>\n  * <ul>\n- * <li><strong>newMessageCount</strong> - the number of unread messages as string</li>\n+ * <li><strong>newMessageCount</strong> - the number of unread messages as\n+ * string</li>\n  * </ul>\n  */\n public class InboxModule extends AbstractInputModule implements Serviceable {\n \n     protected static final String NEW_MESSAGE_COUNT = \"newMessageCount\";\n     protected ServiceManager manager;\n \n-    public Object getAttribute(String name, Configuration modeConf, Map objectModel) throws ConfigurationException {\n-        \n+    public Object getAttribute(String name, Configuration modeConf, Map objectModel)\n+            throws ConfigurationException {\n+\n         Object value = null;\n         if (name.equals(NEW_MESSAGE_COUNT)) {\n             InboxManager inboxManager = null;\n@@ -53,33 +59,36 @@ public Object getAttribute(String name, Configuration modeConf, Map objectModel)\n                 Request request = ObjectModelHelper.getRequest(objectModel);\n                 Session session = RepositoryUtil.getSession(manager, request);\n                 User user = session.getIdentity().getUser();\n-                Inbox inbox = inboxManager.getInbox(user);\n-                \n-                int count = 0;\n-                InboxMessage[] messages = inbox.getMessages();\n-                for (int i = 0; i < messages.length; i++) {\n-                    if (!messages[i].isMarkedAsRead()) {\n-                        count++;\n+                if (user == null) {\n+                    return \"0\";\n+                } else {\n+                    Inbox inbox = inboxManager.getInbox(user);\n+                    int count = 0;\n+                    InboxMessage[] messages = inbox.getMessages();\n+                    for (int i = 0; i < messages.length; i++) {\n+                        if (!messages[i].isMarkedAsRead()) {\n+                            count++;\n+                        }\n                     }\n+                    value = Integer.toString(count);\n                 }\n-                value = Integer.toString(count);\n-                \n+\n             } catch (Exception e) {\n                 throw new ConfigurationException(\"Attribute [\" + name + \"]: \", e);\n-            }\n-            finally {\n+            } finally {\n                 if (inboxManager != null) {\n                     this.manager.release(inboxManager);\n                 }\n             }\n         }\n+        else {\n+            throw new ConfigurationException(\"Attribute: [\" + name + \"] not supported.\");\n+        }\n         return value;\n     }\n \n     public void service(ServiceManager manager) throws ServiceException {\n         this.manager = manager;\n     }\n \n-    \n-    \n }", "filename": "src/modules/notification/java/src/org/apache/lenya/inbox/InboxModule.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/8fd070ce25f72c74c5c40c2858f3f31e7d665015", "parent": "https://github.com/apache/lenya/commit/e8c2e5b514e5a04d37b2626072c818fcc760f1c9", "message": "Avoid NPE (no null params for UsecaseMessage)\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@495641 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_15", "file": [{"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/8fd070ce25f72c74c5c40c2858f3f31e7d665015/src/modules-core/usecase-impl/java/src/org/apache/lenya/cms/usecase/gui/GUIManagerImpl.java", "blob_url": "https://github.com/apache/lenya/blob/8fd070ce25f72c74c5c40c2858f3f31e7d665015/src/modules-core/usecase-impl/java/src/org/apache/lenya/cms/usecase/gui/GUIManagerImpl.java", "sha": "f78fea4671c7aabaaf44c6534df6e3a0bea65d34", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/usecase-impl/java/src/org/apache/lenya/cms/usecase/gui/GUIManagerImpl.java?ref=8fd070ce25f72c74c5c40c2858f3f31e7d665015", "patch": "@@ -183,7 +183,7 @@ public Tab getTab(String group, String name) {\n                         getLogger().debug(\"Usecase not authorized\");\r\n                     }\r\n                     messages = new UsecaseMessage[1];\r\n-                    messages[0] = new UsecaseMessage(\"Access denied\", null);\r\n+                    messages[0] = new UsecaseMessage(\"Access denied\");\r\n                 }\r\n             }\r\n \r", "filename": "src/modules-core/usecase-impl/java/src/org/apache/lenya/cms/usecase/gui/GUIManagerImpl.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/1d914cd1f778d81f5115c686ab88c7f82bf4619b", "parent": "https://github.com/apache/lenya/commit/3849f34be24994020747082638cf2b485af900d6", "message": "Avoid NPE when instantiating UsecaseMessage\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@495203 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_16", "file": [{"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/1d914cd1f778d81f5115c686ab88c7f82bf4619b/src/modules-core/usecase/java/src/org/apache/lenya/cms/cocoon/transformation/UsecaseMenuTransformer.java", "blob_url": "https://github.com/apache/lenya/blob/1d914cd1f778d81f5115c686ab88c7f82bf4619b/src/modules-core/usecase/java/src/org/apache/lenya/cms/cocoon/transformation/UsecaseMenuTransformer.java", "sha": "e279cfd3a5866176019b95259ac54d00160db28d", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/usecase/java/src/org/apache/lenya/cms/cocoon/transformation/UsecaseMenuTransformer.java?ref=1d914cd1f778d81f5115c686ab88c7f82bf4619b", "patch": "@@ -111,7 +111,7 @@ public void startElement(String uri, String localName, String raw, Attributes at\n                             getLogger().debug(\"Usecase not authorized\");\n                         }\n                         attributes = removeHrefAttribute(attr);\n-                        UsecaseMessage message = new UsecaseMessage(\"Access denied\", null);\n+                        UsecaseMessage message = new UsecaseMessage(\"Access denied\");\n                         messages = Collections.singletonList(message);\n                     }\n                 }", "filename": "src/modules-core/usecase/java/src/org/apache/lenya/cms/cocoon/transformation/UsecaseMenuTransformer.java"}, {"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/1d914cd1f778d81f5115c686ab88c7f82bf4619b/src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/UsecaseMessage.java", "blob_url": "https://github.com/apache/lenya/blob/1d914cd1f778d81f5115c686ab88c7f82bf4619b/src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/UsecaseMessage.java", "sha": "83590739ac2e275e255a596475e318a0a4a4d72e", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/UsecaseMessage.java?ref=1d914cd1f778d81f5115c686ab88c7f82bf4619b", "patch": "@@ -39,7 +39,6 @@\n     public UsecaseMessage(String _message) {\n         Assert.notNull(\"message\", _message);\n         this.message = _message;\n-        this.message = _message;\n     }\n \n     /**\n@@ -50,6 +49,7 @@ public UsecaseMessage(String _message) {\n     public UsecaseMessage(String _message, String[] _params) {\n         this(_message);\n         \n+        Assert.notNull(\"params\", _params);\n         for (int i = 0; i < _params.length; i++) {\n             Assert.notNull(\"params[\" + i + \"]\", _params[i]);\n         }", "filename": "src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/UsecaseMessage.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/5b64ead80b57fdab4906bfcc03aaceedd58c33d1", "parent": "https://github.com/apache/lenya/commit/45b75efceacb149129782f832a225333294fd4ca", "message": "Don't throw NPE if no parent pub exists\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@475296 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_17", "file": [{"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/5b64ead80b57fdab4906bfcc03aaceedd58c33d1/src/impl/java/org/apache/lenya/cms/publication/PublicationImpl.java", "blob_url": "https://github.com/apache/lenya/blob/5b64ead80b57fdab4906bfcc03aaceedd58c33d1/src/impl/java/org/apache/lenya/cms/publication/PublicationImpl.java", "sha": "892502d9aaa57cedb7903a13f5503a845ab2de52", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/impl/java/org/apache/lenya/cms/publication/PublicationImpl.java?ref=5b64ead80b57fdab4906bfcc03aaceedd58c33d1", "patch": "@@ -146,7 +146,7 @@ public String getSourceURI() {\n \n     public String getWorkflowSchema(ResourceType resourceType) {\n         String schema = this.delegate.getWorkflowSchema(resourceType);\n-        if (schema == null) {\n+        if (schema == null && getTemplateIds().length > 0) {\n             String templateId = getFirstTemplateId();\n             try {\n                 Publication template = getFactory().getPublication(templateId);", "filename": "src/impl/java/org/apache/lenya/cms/publication/PublicationImpl.java"}, {"additions": 2, "raw_url": "https://github.com/apache/lenya/raw/5b64ead80b57fdab4906bfcc03aaceedd58c33d1/src/impl/java/org/apache/lenya/cms/publication/PublicationManagerImpl.java", "blob_url": "https://github.com/apache/lenya/blob/5b64ead80b57fdab4906bfcc03aaceedd58c33d1/src/impl/java/org/apache/lenya/cms/publication/PublicationManagerImpl.java", "sha": "358287be098a08a9dad4a8f03b2d1f1e7dee94db", "changes": 3, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/impl/java/org/apache/lenya/cms/publication/PublicationManagerImpl.java?ref=5b64ead80b57fdab4906bfcc03aaceedd58c33d1", "patch": "@@ -37,6 +37,7 @@\n import org.apache.excalibur.source.Source;\n import org.apache.excalibur.source.SourceResolver;\n import org.apache.excalibur.source.SourceUtil;\n+import org.apache.lenya.util.Assert;\n \n /**\n  * Factory for creating publication objects.\n@@ -54,7 +55,7 @@ public PublicationManagerImpl() {\n \n     public synchronized Publication getPublication(DocumentFactory factory, String id) throws PublicationException {\n         \n-        assert id != null;\n+        Assert.notNull(\"publication ID\", id);\n         if (id.indexOf(\"/\") != -1) {\n             throw new PublicationException(\"The publication ID [\" + id + \"] must not contain a slash!\");\n         }", "filename": "src/impl/java/org/apache/lenya/cms/publication/PublicationManagerImpl.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/6c8c4aa5e69d747cfb09c2c239ca1839354f5592", "parent": "https://github.com/apache/lenya/commit/2c1af5027253e4880d598876dcc277e2698ee7af", "message": "Avoid NPE for non-existing AggregatingSource\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@474905 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_18", "file": [{"additions": 9, "raw_url": "https://github.com/apache/lenya/raw/6c8c4aa5e69d747cfb09c2c239ca1839354f5592/src/java/org/apache/lenya/cms/cocoon/source/AggregatingSource.java", "blob_url": "https://github.com/apache/lenya/blob/6c8c4aa5e69d747cfb09c2c239ca1839354f5592/src/java/org/apache/lenya/cms/cocoon/source/AggregatingSource.java", "sha": "1df859a32977c1881692cbf2538482f758219398", "changes": 16, "status": "modified", "deletions": 7, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/cocoon/source/AggregatingSource.java?ref=6c8c4aa5e69d747cfb09c2c239ca1839354f5592", "patch": "@@ -86,19 +86,21 @@ protected Document getDom() {\n     protected byte[] getData() {\n         if (this.data == null) {\n             Document dom = getDom();\n-            ByteArrayOutputStream out = new ByteArrayOutputStream();\n-            try {\n-                DocumentHelper.writeDocument(dom, out);\n-            } catch (Exception e) {\n-                throw new RuntimeException(e);\n+            if (dom != null) {\n+                ByteArrayOutputStream out = new ByteArrayOutputStream();\n+                try {\n+                    DocumentHelper.writeDocument(dom, out);\n+                } catch (Exception e) {\n+                    throw new RuntimeException(e);\n+                }\n+                this.data = out.toByteArray();\n             }\n-            this.data = out.toByteArray();\n         }\n         return this.data;\n     }\n \n     public boolean exists() {\n-        return getData().length > 0;\n+        return getData() != null;\n     }\n \n     public long getContentLength() {", "filename": "src/java/org/apache/lenya/cms/cocoon/source/AggregatingSource.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/167978f332e313600b314880236cbb8f866b3a0e", "parent": "https://github.com/apache/lenya/commit/4ca98a436df5122e3259f63d1a3b445d24276016", "message": "Avoid NPE for null message parameter\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@473081 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_19", "file": [{"additions": 3, "raw_url": "https://github.com/apache/lenya/raw/167978f332e313600b314880236cbb8f866b3a0e/src/modules-core/workflow-impl/java/src/org/apache/lenya/cms/workflow/usecases/CheckWorkflow.java", "blob_url": "https://github.com/apache/lenya/blob/167978f332e313600b314880236cbb8f866b3a0e/src/modules-core/workflow-impl/java/src/org/apache/lenya/cms/workflow/usecases/CheckWorkflow.java", "sha": "70e4211dc8d0b59f4d8fe29f0d3a91ea10099b2d", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/workflow-impl/java/src/org/apache/lenya/cms/workflow/usecases/CheckWorkflow.java?ref=167978f332e313600b314880236cbb8f866b3a0e", "patch": "@@ -62,6 +62,9 @@ protected void doCheckPreconditions() throws Exception {\n         Document doc = getSourceDocument();\r\n         if (!WorkflowUtil.canInvoke(this.manager, getSession(), getLogger(), doc, getEvent())) {\r\n             String title = DublinCoreHelper.getTitle(doc);\r\n+            if (title == null) {\r\n+                title = \"\";\r\n+            }\r\n             addErrorMessage(\"error-workflow-document\", new String[] { getEvent(), title });\r\n         }\r\n     }\r", "filename": "src/modules-core/workflow-impl/java/src/org/apache/lenya/cms/workflow/usecases/CheckWorkflow.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/53441eec498c8c01bf5dc37a3b674f988de36884", "parent": "https://github.com/apache/lenya/commit/d40ff4c78e1a1e6599f4b2a407f10e15d028a369", "message": "JCR module: added Assertion utility class, fixed some NPE issues\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@349406 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_20", "file": [{"additions": 16, "raw_url": "https://github.com/apache/lenya/raw/53441eec498c8c01bf5dc37a3b674f988de36884/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/AbstractNodeWrapperBuilder.java", "blob_url": "https://github.com/apache/lenya/blob/53441eec498c8c01bf5dc37a3b674f988de36884/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/AbstractNodeWrapperBuilder.java", "sha": "efa8e4767e3ca4eb7d317814ef3881490464b1fb", "changes": 16, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/AbstractNodeWrapperBuilder.java?ref=53441eec498c8c01bf5dc37a3b674f988de36884", "patch": "@@ -1,3 +1,19 @@\n+/*\n+ * Copyright  1999-2004 The Apache Software Foundation\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n package org.apache.lenya.cms.jcr;\n \n import org.apache.lenya.cms.repo.RepositoryException;", "filename": "src/modules/jcr/java/src/org/apache/lenya/cms/jcr/AbstractNodeWrapperBuilder.java"}, {"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/53441eec498c8c01bf5dc37a3b674f988de36884/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/JCRContent.java", "blob_url": "https://github.com/apache/lenya/blob/53441eec498c8c01bf5dc37a3b674f988de36884/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/JCRContent.java", "sha": "ec048b11fd00a9e5ce0db872926ae7bd74f6e0a8", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/JCRContent.java?ref=53441eec498c8c01bf5dc37a3b674f988de36884", "patch": "@@ -51,7 +51,7 @@ protected JCRPublicationNode getArea() {\n \n     public ContentNode getNode(String id) throws RepositoryException {\n         BuilderParameters params =  builder.createParameters(this, id);\n-        ContentNode node = (ContentNode) this.nodeManager.getNode(id, params, false);\n+        ContentNode node = (ContentNode) this.nodeManager.getNode(id, params);\n         if (node == null) {\n             throw new RepositoryException(\"The content node [\" + id + \"]\ufffddoes not exist.\");\n         }", "filename": "src/modules/jcr/java/src/org/apache/lenya/cms/jcr/JCRContent.java"}, {"additions": 2, "raw_url": "https://github.com/apache/lenya/raw/53441eec498c8c01bf5dc37a3b674f988de36884/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/JCRContentNode.java", "blob_url": "https://github.com/apache/lenya/blob/53441eec498c8c01bf5dc37a3b674f988de36884/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/JCRContentNode.java", "sha": "9b5ead42b91abc8a5310345d3af85443f99bace7", "changes": 4, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/JCRContentNode.java?ref=53441eec498c8c01bf5dc37a3b674f988de36884", "patch": "@@ -72,7 +72,7 @@ protected JCRContent getContent() {\n \n     public Document addDocument(String language, String label) throws RepositoryException {\n         BuilderParameters params = builder.createParameters(this, language, label);\n-        return (Document) this.documentManager.getNode(language, params, true);\n+        return (Document) this.documentManager.addNode(language, params);\n     }\n \n     public void removeDocument(Document document) throws RepositoryException {\n@@ -85,7 +85,7 @@ public void removeDocument(Document document) throws RepositoryException {\n \n     public Document getDocument(String language) throws RepositoryException {\n         BuilderParameters params = builder.createParameters(this, language, null);\n-        return (Document) this.documentManager.getNode(language, params, false);\n+        return (Document) this.documentManager.getNode(language, params);\n     }\n \n     public DocumentType getDocumentType() throws RepositoryException {", "filename": "src/modules/jcr/java/src/org/apache/lenya/cms/jcr/JCRContentNode.java"}, {"additions": 13, "raw_url": "https://github.com/apache/lenya/raw/53441eec498c8c01bf5dc37a3b674f988de36884/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/JCRContentNodeBuilder.java", "blob_url": "https://github.com/apache/lenya/blob/53441eec498c8c01bf5dc37a3b674f988de36884/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/JCRContentNodeBuilder.java", "sha": "a05695ced695a01da426720931cd88b6a72aa147", "changes": 15, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/JCRContentNodeBuilder.java?ref=53441eec498c8c01bf5dc37a3b674f988de36884", "patch": "@@ -25,6 +25,7 @@\n import javax.jcr.PathNotFoundException;\n import javax.jcr.ValueFormatException;\n \n+import org.apache.lenya.cms.jcr.util.Assertion;\n import org.apache.lenya.cms.repo.DocumentType;\n import org.apache.lenya.cms.repo.RepositoryException;\n \n@@ -67,8 +68,12 @@ public NodeWrapper addNode(JCRSession session, BuilderParameters parameters)\n \n                 contentNode = content.addNode(NODE_NAME, NODE_TYPE);\n                 contentNode.setProperty(ID_PROPERTY, params.getId());\n-                contentNode.setProperty(DOCUMENT_TYPE_PROPERTY, params.getDocumentType());\n                 contentNode.setProperty(VISIBLE_IN_NAV_PROPERTY, true);\n+                \n+                if (params.getDocumentType() != null) {\n+                    contentNode.setProperty(DOCUMENT_TYPE_PROPERTY, params.getDocumentType());\n+                }\n+                \n                 jcrContentNode = new JCRContentNode(session, params.getContent(), contentNode);\n             } else {\n                 throw new RepositoryException(\"The node already exists!\");\n@@ -153,9 +158,15 @@ public BuilderParameters createParameters(JCRContent content, String id) {\n          */\n         public JCRContentNodeBuilderParameters(JCRContent content, String id,\n                 DocumentType documentType) {\n+\n+            Assertion.notNull(content, \"JCR content\");\n+            Assertion.notNull(id, \"ID\");\n+\n             this.content = content;\n             this.id = id;\n-            this.documentType = documentType.getName();\n+            if (documentType != null) {\n+                this.documentType = documentType.getName();\n+            }\n         }\n \n         /**", "filename": "src/modules/jcr/java/src/org/apache/lenya/cms/jcr/JCRContentNodeBuilder.java"}, {"additions": 8, "raw_url": "https://github.com/apache/lenya/raw/53441eec498c8c01bf5dc37a3b674f988de36884/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/JCRSiteNode.java", "blob_url": "https://github.com/apache/lenya/blob/53441eec498c8c01bf5dc37a3b674f988de36884/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/JCRSiteNode.java", "sha": "23989b7de46844f25cf971d9bc58fd612934a311", "changes": 10, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/JCRSiteNode.java?ref=53441eec498c8c01bf5dc37a3b674f988de36884", "patch": "@@ -22,6 +22,7 @@\n import javax.jcr.Node;\n import javax.jcr.NodeIterator;\n \n+import org.apache.lenya.cms.jcr.util.Assertion;\n import org.apache.lenya.cms.repo.ContentNode;\n import org.apache.lenya.cms.repo.RepositoryException;\n import org.apache.lenya.cms.repo.SiteNode;\n@@ -38,14 +39,19 @@\n      * @param session The session.\n      * @param node The JCR node.\n      * @param site The site.\n-     * @param parent The parent.\n+     * @param parent The parent or <code>null</code> if this is a top-level node.\n      */\n     public JCRSiteNode(JCRSession session, Node node, JCRSite site, JCRSiteNode parent) {\n         super(node);\n+        \n+        Assertion.notNull(session, \"session\");\n+        Assertion.notNull(site, \"site\");\n+        \n         this.site = site;\n+        this.parent = parent;\n+        \n         this.builder = new JCRSiteNodeBuilder(site);\n         this.childManager = new NodeWrapperManager(session, this.builder);\n-        this.parent = parent;\n     }\n \n     public String getName() throws RepositoryException {", "filename": "src/modules/jcr/java/src/org/apache/lenya/cms/jcr/JCRSiteNode.java"}, {"additions": 3, "raw_url": "https://github.com/apache/lenya/raw/53441eec498c8c01bf5dc37a3b674f988de36884/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/NodeWrapper.java", "blob_url": "https://github.com/apache/lenya/blob/53441eec498c8c01bf5dc37a3b674f988de36884/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/NodeWrapper.java", "sha": "f9eda57913970e19827c393e74f63d10ccd32133", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/NodeWrapper.java?ref=53441eec498c8c01bf5dc37a3b674f988de36884", "patch": "@@ -18,6 +18,8 @@\n \n import javax.jcr.Node;\n \n+import org.apache.lenya.cms.jcr.util.Assertion;\n+\n /**\n  * A JCR node wrapper.\n  */\n@@ -28,6 +30,7 @@\n      * @param node The node.\n      */\n     public NodeWrapper(Node node) {\n+        Assertion.notNull(node, \"node\");\n         this.node = node;\n     }\n ", "filename": "src/modules/jcr/java/src/org/apache/lenya/cms/jcr/NodeWrapper.java"}, {"additions": 17, "raw_url": "https://github.com/apache/lenya/raw/53441eec498c8c01bf5dc37a3b674f988de36884/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/NodeWrapperManager.java", "blob_url": "https://github.com/apache/lenya/blob/53441eec498c8c01bf5dc37a3b674f988de36884/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/NodeWrapperManager.java", "sha": "e4faeefd5c8336eb6d814167f2a20188c7f8810d", "changes": 33, "status": "modified", "deletions": 16, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/NodeWrapperManager.java?ref=53441eec498c8c01bf5dc37a3b674f988de36884", "patch": "@@ -48,37 +48,38 @@ public NodeWrapperManager(JCRSession session, NodeWrapperBuilder builder) {\n \n     protected NodeWrapper getNode(String key, BuilderParameters parameters)\n             throws org.apache.lenya.cms.repo.RepositoryException {\n+        return getNode(key, parameters, false);\n+    }\n+\n+    protected NodeWrapper getNode(String key, BuilderParameters parameters, boolean create)\n+            throws org.apache.lenya.cms.repo.RepositoryException {\n \n         NodeWrapper wrapper = (NodeWrapper) this.key2node.get(key);\n+\n         if (wrapper == null) {\n-            wrapper = builder.getNode(this.session, parameters);\n+            if (builder.existsNode(this.session, parameters)) {\n+                wrapper = builder.getNode(this.session, parameters);\n+            } else if (create) {\n+                wrapper = builder.addNode(this.session, parameters);\n+            } else {\n+                throw new org.apache.lenya.cms.repo.RepositoryException(\"The node does not exist!\");\n+            }\n             this.key2node.put(key, wrapper);\n         }\n-\n         return wrapper;\n     }\n \n-    protected NodeWrapper getNode(String key, BuilderParameters parameters, boolean create)\n-            throws org.apache.lenya.cms.repo.RepositoryException {\n-        \n-        if (builder.existsNode(this.session, parameters)) {\n-            return builder.getNode(this.session, parameters);\n-        }\n-        else if (create) {\n-            return builder.addNode(this.session, parameters);\n-        }\n-        else {\n-            throw new org.apache.lenya.cms.repo.RepositoryException(\"The node does not exist!\");\n-        }\n-    }\n-\n     protected NodeWrapper addNode(String key, BuilderParameters parameters)\n             throws org.apache.lenya.cms.repo.RepositoryException {\n \n         NodeWrapper wrapper = (NodeWrapper) this.key2node.get(key);\n+\n         if (wrapper == null) {\n             wrapper = builder.addNode(this.session, parameters);\n             this.key2node.put(key, wrapper);\n+        } else {\n+            throw new org.apache.lenya.cms.repo.RepositoryException(\"The node for key [\" + key\n+                    + \"] already exists!\");\n         }\n \n         return wrapper;", "filename": "src/modules/jcr/java/src/org/apache/lenya/cms/jcr/NodeWrapperManager.java"}, {"additions": 34, "raw_url": "https://github.com/apache/lenya/raw/53441eec498c8c01bf5dc37a3b674f988de36884/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/util/Assertion.java", "blob_url": "https://github.com/apache/lenya/blob/53441eec498c8c01bf5dc37a3b674f988de36884/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/util/Assertion.java", "sha": "99a64ac271337284f31b492626d3f0f1407d5e95", "changes": 34, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/jcr/java/src/org/apache/lenya/cms/jcr/util/Assertion.java?ref=53441eec498c8c01bf5dc37a3b674f988de36884", "patch": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright  1999-2004 The Apache Software Foundation\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+package org.apache.lenya.cms.jcr.util;\n+\n+/**\n+ * Utility class for assertions.\n+ */\n+public class Assertion {\n+\n+    /**\n+     * @param obj The object to check.\n+     * @param name The name of the parameter.\n+     */\n+    public static void notNull(Object obj, String name) {\n+        if (obj == null) {\n+            throw new RuntimeException(\"The parameter [\" + name + \"] must not be null!\");\n+        }\n+    }\n+\n+}", "filename": "src/modules/jcr/java/src/org/apache/lenya/cms/jcr/util/Assertion.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/41cfaede095a001a27d3cc9676613f8ef7817511", "parent": "https://github.com/apache/lenya/commit/d281f35394bcc04ab8a90aba7856347a760f3b09", "message": "avoid NPE when calling TreeSiteManager methods for non-existing tree nodes\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@159698 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_21", "file": [{"additions": 23, "raw_url": "https://github.com/apache/lenya/raw/41cfaede095a001a27d3cc9676613f8ef7817511/src/java/org/apache/lenya/cms/site/tree/TreeSiteManager.java", "blob_url": "https://github.com/apache/lenya/blob/41cfaede095a001a27d3cc9676613f8ef7817511/src/java/org/apache/lenya/cms/site/tree/TreeSiteManager.java", "sha": "a6e601bdafee5e1f99c727ca2e07d30ba6390df1", "changes": 40, "status": "modified", "deletions": 17, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/site/tree/TreeSiteManager.java?ref=41cfaede095a001a27d3cc9676613f8ef7817511", "patch": "@@ -125,32 +125,38 @@ public boolean requires(Document dependingResource, Document requiredResource)\n             getLogger().debug(\"Obtaining requiring resources of [\" + resource + \"]\");\n         }\n \n+        Document[] resources;\n         SiteTree tree = getTree(resource);\n \n         SiteTreeNode node = tree.getNode(resource.getId());\n-        List preOrder = node.preOrder();\n+        if (node != null) {\n+            List preOrder = node.preOrder();\n \n-        // remove original resource (does not require itself)\n-        preOrder.remove(0);\n+            // remove original resource (does not require itself)\n+            preOrder.remove(0);\n \n-        Document[] resources = new Document[preOrder.size()];\n+            resources = new Document[preOrder.size()];\n \n-        try {\n-            for (int i = 0; i < resources.length; i++) {\n-                SiteTreeNode descendant = (SiteTreeNode) preOrder.get(i);\n-                resources[i] = resource.getIdentityMap().get(resource.getPublication(),\n-                        resource.getArea(),\n-                        descendant.getAbsoluteId());\n-                if (getLogger().isDebugEnabled()) {\n-                    getLogger().debug(\"    Descendant: [\" + resources[i] + \"]\");\n+            try {\n+                for (int i = 0; i < resources.length; i++) {\n+                    SiteTreeNode descendant = (SiteTreeNode) preOrder.get(i);\n+                    resources[i] = resource.getIdentityMap().get(resource.getPublication(),\n+                            resource.getArea(),\n+                            descendant.getAbsoluteId());\n+                    if (getLogger().isDebugEnabled()) {\n+                        getLogger().debug(\"    Descendant: [\" + resources[i] + \"]\");\n+                    }\n                 }\n+            } catch (PublicationException e) {\n+                throw new SiteException(e);\n             }\n-        } catch (PublicationException e) {\n-            throw new SiteException(e);\n-        }\n \n-        if (getLogger().isDebugEnabled()) {\n-            getLogger().debug(\"Obtaining requiring resources completed.\");\n+            if (getLogger().isDebugEnabled()) {\n+                getLogger().debug(\"Obtaining requiring resources completed.\");\n+            }\n+        }\n+        else {\n+            resources = new Document[0];\n         }\n \n         return resources;", "filename": "src/java/org/apache/lenya/cms/site/tree/TreeSiteManager.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/a65be31aeb23ee3db823c5cc68e8722c30dc1e1f", "parent": "https://github.com/apache/lenya/commit/51e791534aedcd9194479d18552cc4465590c54a", "message": "fixed NPE for empty sitetree node labels\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@155316 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_22", "file": [{"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/a65be31aeb23ee3db823c5cc68e8722c30dc1e1f/src/java/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java", "blob_url": "https://github.com/apache/lenya/blob/a65be31aeb23ee3db823c5cc68e8722c30dc1e1f/src/java/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java", "sha": "9d17668e0ba7192cba59d9a3b600870ea3656639", "changes": 3, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java?ref=a65be31aeb23ee3db823c5cc68e8722c30dc1e1f", "patch": "@@ -202,8 +202,7 @@ public void removeLabel(Label label) {\n                 Node child = children.item(i);\n \n                 if ((child.getNodeType() == Node.ELEMENT_NODE)\n-                        && child.getNodeName().equals(LABEL_NAME)\n-                        && child.getFirstChild().getNodeValue().equals(label.getLabel())) {\n+                        && child.getNodeName().equals(LABEL_NAME)) {\n \n                     Node languageAttribute = child.getAttributes()\n                             .getNamedItem(LANGUAGE_ATTRIBUTE_NAME);", "filename": "src/java/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/92f584f6c39488813e4fb74a1083745e763c5053", "parent": "https://github.com/apache/lenya/commit/345f333963cf83b6594ae428ab4b865ddc8a1ddc", "message": "avoid NPE when fetching source document\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@124409 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_23", "file": [{"additions": 6, "raw_url": "https://github.com/apache/lenya/raw/92f584f6c39488813e4fb74a1083745e763c5053/src/java/org/apache/lenya/cms/usecase/DocumentUsecase.java", "blob_url": "https://github.com/apache/lenya/blob/92f584f6c39488813e4fb74a1083745e763c5053/src/java/org/apache/lenya/cms/usecase/DocumentUsecase.java", "sha": "dfe0160097b5ce06f179c74409ffa4b86e29914e", "changes": 7, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/usecase/DocumentUsecase.java?ref=92f584f6c39488813e4fb74a1083745e763c5053", "patch": "@@ -92,7 +92,12 @@ public String getTargetURL(boolean success) {\n      * @see org.apache.lenya.cms.usecase.AbstractUsecase#getSourceURL()\n      */\n     protected String getSourceURL() {\n-        return getSourceDocument().getCanonicalWebappURL();\n+        if (this.sourceDocument == null) {\n+            return super.getSourceURL();\n+        }\n+        else {\n+            return getSourceDocument().getCanonicalWebappURL();\n+        }\n     }\n \n     /**", "filename": "src/java/org/apache/lenya/cms/usecase/DocumentUsecase.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/cc8afb8edfa19c03fca3c30177088f4546388b59", "parent": "https://github.com/apache/lenya/commit/88a8b5fd10d4b38ddff04f145ab014a220b4d3e2", "message": "use NULL to generate NPEs instead of FileNotFoundException\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@123059 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_24", "file": [{"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/cc8afb8edfa19c03fca3c30177088f4546388b59/src/test/org/apache/lenya/cms/rc/RevisionControllerTest.java", "blob_url": "https://github.com/apache/lenya/blob/cc8afb8edfa19c03fca3c30177088f4546388b59/src/test/org/apache/lenya/cms/rc/RevisionControllerTest.java", "sha": "18df08fbd26ab9f96e0c98554fb7e4fc3318ecfb", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/test/org/apache/lenya/cms/rc/RevisionControllerTest.java?ref=cc8afb8edfa19c03fca3c30177088f4546388b59", "patch": "@@ -53,7 +53,7 @@ public static void main(String[] args) {\n         String source = args[1];\n         String identityD = args[2];\n         String destination = args[3];\n-        RevisionController rc = new RevisionController(\"\", \"\", \"\");\n+        RevisionController rc = new RevisionController(null, null, null);\n         try {\n             rc.reservedCheckOut(source, identityS);\n         } catch (FileNotFoundException e) // No such source file", "filename": "src/test/org/apache/lenya/cms/rc/RevisionControllerTest.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/dbdccf0b153b0e9a966b07e5d006df664719aa89", "parent": "https://github.com/apache/lenya/commit/0117f1ec86b8da5283af53a8a44d71f06a376933", "message": "calling super.setup() to avoid NPE in startPrefixMapping()\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@109489 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_25", "file": [{"additions": 3, "raw_url": "https://github.com/apache/lenya/raw/dbdccf0b153b0e9a966b07e5d006df664719aa89/src/java/org/apache/lenya/cms/cocoon/transformation/UsecaseMenuTransformer.java", "blob_url": "https://github.com/apache/lenya/blob/dbdccf0b153b0e9a966b07e5d006df664719aa89/src/java/org/apache/lenya/cms/cocoon/transformation/UsecaseMenuTransformer.java", "sha": "3a557707123741e3de30d0a40a53bbf3f15be137", "changes": 4, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/cocoon/transformation/UsecaseMenuTransformer.java?ref=dbdccf0b153b0e9a966b07e5d006df664719aa89", "patch": "@@ -15,7 +15,7 @@\n  *\n  */\n \n-/* $Id: UsecaseMenuTransformer.java,v 1.13 2004/03/01 16:18:20 gregor Exp $  */\n+/* $Id$  */\n \n package org.apache.lenya.cms.cocoon.transformation;\n \n@@ -101,6 +101,8 @@ public void startElement(String uri, String localName, String raw, Attributes at\n      */\n     public void setup(SourceResolver resolver, Map objectModel, String src, Parameters parameters)\n         throws ProcessingException, SAXException, IOException {\n+        \n+        super.setup(resolver, objectModel, src, parameters);\n \n         getLogger().debug(\"Setting up transformer\");\n ", "filename": "src/java/org/apache/lenya/cms/cocoon/transformation/UsecaseMenuTransformer.java"}, {"additions": 2, "raw_url": "https://github.com/apache/lenya/raw/dbdccf0b153b0e9a966b07e5d006df664719aa89/src/java/org/apache/lenya/cms/cocoon/transformation/WorkflowMenuTransformer.java", "blob_url": "https://github.com/apache/lenya/blob/dbdccf0b153b0e9a966b07e5d006df664719aa89/src/java/org/apache/lenya/cms/cocoon/transformation/WorkflowMenuTransformer.java", "sha": "52a92b6f4954adba9ff14742d729ee5889b3c3db", "changes": 2, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/cocoon/transformation/WorkflowMenuTransformer.java?ref=dbdccf0b153b0e9a966b07e5d006df664719aa89", "patch": "@@ -108,6 +108,8 @@ public void startElement(String uri, String localName, String raw, Attributes at\n     public void setup(SourceResolver resolver, Map objectModel, String src, Parameters parameters)\n             throws ProcessingException, SAXException, IOException {\n \n+        super.setup(resolver, objectModel, src, parameters);\n+        \n         PageEnvelope envelope = null;\n \n         try {", "filename": "src/java/org/apache/lenya/cms/cocoon/transformation/WorkflowMenuTransformer.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/f4c78509b2e2d87b496898145ae848350f15bfde", "parent": "https://github.com/apache/lenya/commit/fc6500c0f15ba4ea4fb0e53b45a495007d086564", "message": "Tweaked NPE guard clause\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/lenya/trunk@43138 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_26", "file": [{"additions": 2, "raw_url": "https://github.com/apache/lenya/raw/f4c78509b2e2d87b496898145ae848350f15bfde/src/java/org/apache/lenya/util/FileUtil.java", "blob_url": "https://github.com/apache/lenya/blob/f4c78509b2e2d87b496898145ae848350f15bfde/src/java/org/apache/lenya/util/FileUtil.java", "sha": "6f399fab49f496fbac5b445f33b145c606faa475", "changes": 4, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/util/FileUtil.java?ref=f4c78509b2e2d87b496898145ae848350f15bfde", "patch": "@@ -15,7 +15,7 @@\n  *\n  */\n \n-/* $Id: FileUtil.java,v 1.16 2004/07/23 12:32:13 roku Exp $  */\n+/* $Id: FileUtil.java,v 1.17 2004/07/23 12:32:57 roku Exp $  */\n \n package org.apache.lenya.util;\n \n@@ -123,7 +123,7 @@ public static void copy(File src, File dest)\n         } else {\n             File[] contents = src.listFiles();\n             \n-            if(contents == null || contents.length == 0)\n+            if(contents == null)\n                 return;\n             \n             dest.mkdirs();", "filename": "src/java/org/apache/lenya/util/FileUtil.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/7a26d4c7a2da33a3f210bd8f8a7c58c1374e93c7", "parent": "https://github.com/apache/lenya/commit/c7ec334590cdf300597f78882c12d7e11481d0a2", "message": "initializing session (avoid NPE)\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/lenya/trunk@43113 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_27", "file": [{"additions": 3, "raw_url": "https://github.com/apache/lenya/raw/7a26d4c7a2da33a3f210bd8f8a7c58c1374e93c7/src/webapp/lenya/content/ac/login.xsp", "blob_url": "https://github.com/apache/lenya/blob/7a26d4c7a2da33a3f210bd8f8a7c58c1374e93c7/src/webapp/lenya/content/ac/login.xsp", "sha": "6e95d582359fea046bb2d387b77c13dc659d504a", "changes": 7, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/content/ac/login.xsp?ref=7a26d4c7a2da33a3f210bd8f8a7c58c1374e93c7", "patch": "@@ -15,7 +15,7 @@\n   limitations under the License.\n -->\n \n-<!-- $Id: login.xsp,v 1.10 2004/03/13 12:31:32 gregor Exp $ -->\n+<!-- $Id: login.xsp,v 1.11 2004/07/10 23:52:49 andreas Exp $ -->\n \n <xsp:page\n        language=\"java\"\n@@ -32,7 +32,8 @@\n <login>\n \n   <xsp:logic>\n-      Session session=request.getSession(false);\n+      Session session = request.getSession(true);\n+      \n       String authenticatorId=(String)session.getAttribute(\"org.apache.lenya.cms.cocoon.acting.Authenticator.id\");\n       String authenticatorName=(String)session.getAttribute(\"org.apache.lenya.cms.cocoon.acting.Authenticator.name\");\n \n@@ -45,8 +46,6 @@\n           <no_authenticator_id_yet/>\n       }\n \n-\n-\n       String protected_destination=(String)session.getAttribute(\"protected_destination\");\n       if(protected_destination != null){\n         <xsp:content><protected_destination><xsp:expr>protected_destination</xsp:expr></protected_destination></xsp:content>", "filename": "src/webapp/lenya/content/ac/login.xsp"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/a1dcd156a4c6d8f7f016dc38cb3f00011a2482f6", "parent": "https://github.com/apache/lenya/commit/fdf6ebe4e59cf0a48c8ad2e79a6b782688ac4b39", "message": "Throw SourceNotFoundException instead of NPE if SiteSource doesn't exist in getInputStream().\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@676561 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_28", "file": [{"additions": 3, "raw_url": "https://github.com/apache/lenya/raw/a1dcd156a4c6d8f7f016dc38cb3f00011a2482f6/src/java/org/apache/lenya/cms/cocoon/source/SiteSource.java", "blob_url": "https://github.com/apache/lenya/blob/a1dcd156a4c6d8f7f016dc38cb3f00011a2482f6/src/java/org/apache/lenya/cms/cocoon/source/SiteSource.java", "sha": "1511b9fd5a0a22ec8c172268f70dbacfda49e28f", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/cocoon/source/SiteSource.java?ref=a1dcd156a4c6d8f7f016dc38cb3f00011a2482f6", "patch": "@@ -138,6 +138,9 @@ public long getContentLength() {\n     }\n \n     public InputStream getInputStream() throws IOException, SourceNotFoundException {\n+        if (!exists()) {\n+            throw new SourceNotFoundException(\"The source [\" + getURI() + \"] does not exist!\");\n+        }\n         return this.delegate.getInputStream();\n     }\n ", "filename": "src/java/org/apache/lenya/cms/cocoon/source/SiteSource.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/3c1c58862e388fef3a24a13112b1781d9daefa65", "parent": "https://github.com/apache/lenya/commit/f4edb0af41e38e106ae84028630d9204351c2ef3", "message": "AbstractIndexer: throw exception when index directory was not set before opening index reader (avoids NPE)\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@646468 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_29", "file": [{"additions": 3, "raw_url": "https://github.com/apache/lenya/raw/3c1c58862e388fef3a24a13112b1781d9daefa65/src/modules/lucene/java/src/org/apache/cocoon/components/search/components/impl/AbstractIndexer.java", "blob_url": "https://github.com/apache/lenya/blob/3c1c58862e388fef3a24a13112b1781d9daefa65/src/modules/lucene/java/src/org/apache/cocoon/components/search/components/impl/AbstractIndexer.java", "sha": "dd38c3375ee2d6b55aa3f5b2e770f39dc0802fa8", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/lucene/java/src/org/apache/cocoon/components/search/components/impl/AbstractIndexer.java?ref=3c1c58862e388fef3a24a13112b1781d9daefa65", "patch": "@@ -325,6 +325,9 @@ final protected void openIndexWriter(boolean create) throws IndexException {\n      */\n     final protected void openIndexReader() throws IndexException {\n         try {\n+\t    if (this.dir == null) {\n+\t        throw new IllegalStateException(\"Index directory not set.\");\n+\t    }\n             this.delete_reader = IndexReader.open(dir);\n         } catch (IOException e) {\n             throw new IndexException(\"open reader error\", e);", "filename": "src/modules/lucene/java/src/org/apache/cocoon/components/search/components/impl/AbstractIndexer.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/f80a75d0bee94c1ccbcd2f453c87ecfab0b3f7d9", "parent": "https://github.com/apache/lenya/commit/68bec5c880e75af258458031c060c963f24edc0a", "message": "DocumentSourceFactory: throw SourceNotFoundException instead of NPE if the link target doesn't exist.\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@627201 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_30", "file": [{"additions": 7, "raw_url": "https://github.com/apache/lenya/raw/f80a75d0bee94c1ccbcd2f453c87ecfab0b3f7d9/src/modules-core/linking/java/src/org/apache/lenya/cms/cocoon/source/DocumentSourceFactory.java", "blob_url": "https://github.com/apache/lenya/blob/f80a75d0bee94c1ccbcd2f453c87ecfab0b3f7d9/src/modules-core/linking/java/src/org/apache/lenya/cms/cocoon/source/DocumentSourceFactory.java", "sha": "c1165137d54c52fdeb25ea5415a2bb0eb68479a8", "changes": 8, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/linking/java/src/org/apache/lenya/cms/cocoon/source/DocumentSourceFactory.java?ref=f80a75d0bee94c1ccbcd2f453c87ecfab0b3f7d9", "patch": "@@ -38,6 +38,7 @@\n import org.apache.excalibur.source.Source;\n import org.apache.excalibur.source.SourceException;\n import org.apache.excalibur.source.SourceFactory;\n+import org.apache.excalibur.source.SourceNotFoundException;\n import org.apache.excalibur.source.SourceResolver;\n import org.apache.lenya.cms.linking.Link;\n import org.apache.lenya.cms.linking.LinkResolver;\n@@ -136,6 +137,10 @@ public Source getSource(String location, Map parameters) throws MalformedURLExce\n                 contextualize(link, webappUrl);\n                 target = resolver.resolve(factory, link.getUri());\n             }\n+            \n+            if (!target.exists()) {\n+                throw new SourceNotFoundException(\"Source not found: [\" + location + \"]\");\n+            }\n \n             Document doc = target.getDocument();\n \n@@ -160,7 +165,8 @@ public Source getSource(String location, Map parameters) throws MalformedURLExce\n                 }\n                 return this.sourceResolver.resolveURI(lenyaURL);\n             }\n-\n+        } catch (SourceException e) {\n+            throw e;\n         } catch (Exception e) {\n             throw new RuntimeException(e);\n         }", "filename": "src/modules-core/linking/java/src/org/apache/lenya/cms/cocoon/source/DocumentSourceFactory.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/09f25df0cbfff4efe7ca7908915b43e87ea0871b", "parent": "https://github.com/apache/lenya/commit/374e5e9c81e840336dc5a9020928bce0b1e01865", "message": "Add DublinCore.getTitle() with fallback to UUID if the title is null, avoids NPEs in usecase message generation\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@590939 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_31", "file": [{"additions": 13, "raw_url": "https://github.com/apache/lenya/raw/09f25df0cbfff4efe7ca7908915b43e87ea0871b/src/java/org/apache/lenya/cms/metadata/dublincore/DublinCoreHelper.java", "blob_url": "https://github.com/apache/lenya/blob/09f25df0cbfff4efe7ca7908915b43e87ea0871b/src/java/org/apache/lenya/cms/metadata/dublincore/DublinCoreHelper.java", "sha": "deb9fe6a1e4db0eab533adebe1a9f1e2c19eeda1", "changes": 14, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/metadata/dublincore/DublinCoreHelper.java?ref=09f25df0cbfff4efe7ca7908915b43e87ea0871b", "patch": "@@ -20,6 +20,7 @@\n import org.apache.lenya.cms.metadata.MetaData;\r\n import org.apache.lenya.cms.metadata.MetaDataException;\r\n import org.apache.lenya.cms.metadata.MetaDataOwner;\r\n+import org.apache.lenya.cms.publication.Document;\r\n \r\n /**\r\n  * Helper class to access dublin core meta data.\r\n@@ -28,13 +29,24 @@\n \r\n     /**\r\n      * @param owner The owner.\r\n-     * @return The dublin core title.\r\n+     * @return The dublin core title or <code>null</code> if the title is not set.\r\n      * @throws MetaDataException if the owner has no dublin core meta data.\r\n      */\r\n     public static String getTitle(MetaDataOwner owner) throws MetaDataException {\r\n         return getDublinCore(owner).getFirstValue(DublinCore.ELEMENT_TITLE);\r\n     }\r\n     \r\n+    /**\r\n+     * @param doc The document.\r\n+     * @param fallbackToUuid If the dublin core title is <code>null</code>, the document's UUID is returned.\r\n+     * @return The dublin core title.\r\n+     * @throws MetaDataException if the document has no dublin core meta data.\r\n+     */\r\n+    public static String getTitle(Document doc, boolean fallbackToUuid) throws MetaDataException {\r\n+        String title = DublinCoreHelper.getTitle(doc);\r\n+        return title == null ? doc.getUUID() : title;\r\n+    }\r\n+    \r\n     protected static MetaData getDublinCore(MetaDataOwner owner) throws MetaDataException {\r\n         return owner.getMetaData(DublinCore.DC_NAMESPACE);\r\n     }\r", "filename": "src/java/org/apache/lenya/cms/metadata/dublincore/DublinCoreHelper.java"}, {"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/09f25df0cbfff4efe7ca7908915b43e87ea0871b/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ForceCheckIn.java", "blob_url": "https://github.com/apache/lenya/blob/09f25df0cbfff4efe7ca7908915b43e87ea0871b/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ForceCheckIn.java", "sha": "ab3ed3341a63ef0221c7583d272c59abd1bc1a8e", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ForceCheckIn.java?ref=09f25df0cbfff4efe7ca7908915b43e87ea0871b", "patch": "@@ -50,7 +50,7 @@ protected void doCheckPreconditions() throws Exception {\n         \n         Node node = doc.getRepositoryNode();\n         if (!node.isCheckedOut()) {\n-            String[] params = { DublinCoreHelper.getTitle(doc) };\n+            String[] params = { DublinCoreHelper.getTitle(doc, true) };\n             addErrorMessage(\"not-checked-out\", params);\n         }\n     }", "filename": "src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ForceCheckIn.java"}, {"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/09f25df0cbfff4efe7ca7908915b43e87ea0871b/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Publish.java", "blob_url": "https://github.com/apache/lenya/blob/09f25df0cbfff4efe7ca7908915b43e87ea0871b/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Publish.java", "sha": "981db6415b4bf18ea8362b401125a451edec50ec", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Publish.java?ref=09f25df0cbfff4efe7ca7908915b43e87ea0871b", "patch": "@@ -221,7 +221,7 @@ protected void doCheckPreconditions() throws Exception {\n                      * doc.getPath() + \" (\" + doc.getLanguage() + \")\" };\n                      */\n                     String[] params = { doc.getPath() + \":\" + doc.getLanguage(),\n-                            DublinCoreHelper.getTitle(doc) };\n+                            DublinCoreHelper.getTitle(doc, true) };\n                     addErrorMessage(\"missing-document\", params);\n                 }\n             }", "filename": "src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Publish.java"}, {"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/09f25df0cbfff4efe7ca7908915b43e87ea0871b/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/UsecaseWorkflowHelper.java", "blob_url": "https://github.com/apache/lenya/blob/09f25df0cbfff4efe7ca7908915b43e87ea0871b/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/UsecaseWorkflowHelper.java", "sha": "c0cbc51186c620a3fddaf5eaada1d68934e41873", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/UsecaseWorkflowHelper.java?ref=09f25df0cbfff4efe7ca7908915b43e87ea0871b", "patch": "@@ -46,7 +46,7 @@\n      */\n     protected static final void addWorkflowError(AbstractUsecase usecase, String event, Document doc) {\n         try {\n-            String title = DublinCoreHelper.getTitle(doc);\n+            String title = DublinCoreHelper.getTitle(doc, true);\n             if (title == null) {\n                 title = \"\";\n             }", "filename": "src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/UsecaseWorkflowHelper.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/11521b41a93a59d420faf5319b11448e36931a7e", "parent": "https://github.com/apache/lenya/commit/254f2170dee7e7e28ed7891f3662b6b66d959143", "message": "Prevent NPE. Not sure how it happened, but I did get a null identity.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@567518 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_32", "file": [{"additions": 4, "raw_url": "https://github.com/apache/lenya/raw/11521b41a93a59d420faf5319b11448e36931a7e/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ForceCheckIn.java", "blob_url": "https://github.com/apache/lenya/blob/11521b41a93a59d420faf5319b11448e36931a7e/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ForceCheckIn.java", "sha": "7e328ed3cc02b41e12a1850beb327e7b63a98dfb", "changes": 4, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ForceCheckIn.java?ref=11521b41a93a59d420faf5319b11448e36931a7e", "patch": "@@ -82,6 +82,10 @@ protected boolean isLoggedIn(String userId) {\n \n             Identity identity = (Identity) nextsession.getAttribute(IDENTITY);\n \n+            if(identity == null) {\n+                continue;\n+            }\n+\n             User user = identity.getUser();\n             Vector history = (Vector) nextsession.getAttribute(HISTORY);\n             String publicationID = getPublicationIDfromHistory(history);", "filename": "src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ForceCheckIn.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/6ab3f7a37978c2bf4a91479bde794336a352ec09", "parent": "https://github.com/apache/lenya/commit/e41efc2415df890373c182f00bcc54691819e623", "message": "Last changes to prevent NPEs when selecting authoring node under site tab.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@559063 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_33", "file": [{"additions": 4, "raw_url": "https://github.com/apache/lenya/raw/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/metadata/usecases/Metadata.java", "blob_url": "https://github.com/apache/lenya/blob/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/metadata/usecases/Metadata.java", "sha": "a19f41b8a650c26c33bc2447f92f6f2b2105a895", "changes": 5, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/metadata/usecases/Metadata.java?ref=6ab3f7a37978c2bf4a91479bde794336a352ec09", "patch": "@@ -45,7 +45,10 @@\n      * @see org.apache.lenya.cms.usecase.AbstractUsecase#getNodesToLock()\n      */\n     protected Node[] getNodesToLock() throws UsecaseException {\n-        Node[] objects = { getSourceDocument().getRepositoryNode() };\n+        Node[] objects = new Node[0];\n+        if(getSourceDocument() != null) {\n+            objects = new Node[] { getSourceDocument().getRepositoryNode() };\n+        }\n         return objects;\n     }\n ", "filename": "src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/metadata/usecases/Metadata.java"}, {"additions": 19, "raw_url": "https://github.com/apache/lenya/raw/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/MoveSubsite.java", "blob_url": "https://github.com/apache/lenya/blob/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/MoveSubsite.java", "sha": "4475477fb000b0d5be75bdbd5dc5d1c0fd74725c", "changes": 35, "status": "modified", "deletions": 16, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/MoveSubsite.java?ref=6ab3f7a37978c2bf4a91479bde794336a352ec09", "patch": "@@ -98,27 +98,30 @@ protected void doCheckPreconditions() throws Exception {\n      * changes to the site structure would compromise the operation.\n      */\n     protected Node[] getNodesToLock() throws UsecaseException {\n-        try {\n+        Set nodes = new HashSet();\n+  \n+        if(getSourceDocument() != null) {\n+            try {\n \n-            Set nodes = new HashSet();\n+                SiteStructure sourceSite = getSourceDocument().area().getSite();\n+                SiteStructure targetSite = getSourceDocument().getPublication()\n+                        .getArea(getTargetArea()).getSite();\n \n-            SiteStructure sourceSite = getSourceDocument().area().getSite();\n-            SiteStructure targetSite = getSourceDocument().getPublication()\n-                    .getArea(getTargetArea()).getSite();\n+                nodes.add(sourceSite.getRepositoryNode());\n+                nodes.add(targetSite.getRepositoryNode());\n \n-            nodes.add(sourceSite.getRepositoryNode());\n-            nodes.add(targetSite.getRepositoryNode());\n+                Document[] docs = SiteUtil.getSubSite(this.manager,\n+                        getSourceDocument().getLink().getNode()).getDocuments();\n+                for (int i = 0; i < docs.length; i++) {\n+                    nodes.add(docs[i].getRepositoryNode());\n+                }\n \n-            Document[] docs = SiteUtil.getSubSite(this.manager,\n-                    getSourceDocument().getLink().getNode()).getDocuments();\n-            for (int i = 0; i < docs.length; i++) {\n-                nodes.add(docs[i].getRepositoryNode());\n+            } catch (PublicationException e) {\n+                throw new UsecaseException(e);\n             }\n-\n-            return (Node[]) nodes.toArray(new Node[nodes.size()]);\n-        } catch (PublicationException e) {\n-            throw new UsecaseException(e);\n         }\n+ \n+        return (Node[]) nodes.toArray(new Node[nodes.size()]);\n     }\n \n     /**\n@@ -215,4 +218,4 @@ protected static String getParentPath(String path) {\n         return path.substring(0, path.lastIndexOf(\"/\"));\n     }\n \n-}\n\\ No newline at end of file\n+}", "filename": "src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/MoveSubsite.java"}, {"additions": 6, "raw_url": "https://github.com/apache/lenya/raw/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Deactivate.java", "blob_url": "https://github.com/apache/lenya/blob/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Deactivate.java", "sha": "84fa6bcf25cd4c45c3f7b21df43dc727a225f344", "changes": 10, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Deactivate.java?ref=6ab3f7a37978c2bf4a91479bde794336a352ec09", "patch": "@@ -86,9 +86,11 @@ protected void doCheckPreconditions() throws Exception {\n             List nodes = new ArrayList();\n \n             Document doc = getSourceDocument();\n-            Document liveDoc = doc.getAreaVersion(Publication.LIVE_AREA);\n-            nodes.add(liveDoc.getRepositoryNode());\n-            nodes.add(liveDoc.area().getSite().getRepositoryNode());\n+            if(doc != null) {\n+                Document liveDoc = doc.getAreaVersion(Publication.LIVE_AREA);\n+                nodes.add(liveDoc.getRepositoryNode());\n+                nodes.add(liveDoc.area().getSite().getRepositoryNode());\n+            }\n             return (org.apache.lenya.cms.repository.Node[]) nodes.toArray(new org.apache.lenya.cms.repository.Node[nodes.size()]);\n \n         } catch (Exception e) {\n@@ -201,4 +203,4 @@ public LinkList(ServiceManager manager, Document doc) {\n \n     }\n \n-}\n\\ No newline at end of file\n+}", "filename": "src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Deactivate.java"}, {"additions": 5, "raw_url": "https://github.com/apache/lenya/raw/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/InvokeWorkflow.java", "blob_url": "https://github.com/apache/lenya/blob/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/InvokeWorkflow.java", "sha": "27718860a02b7452e0911ce1637afcdfdc8b7e68", "changes": 7, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/InvokeWorkflow.java?ref=6ab3f7a37978c2bf4a91479bde794336a352ec09", "patch": "@@ -41,7 +41,10 @@\n      * @see org.apache.lenya.cms.usecase.AbstractUsecase#getNodesToLock()\n      */\n     protected Node[] getNodesToLock() throws UsecaseException {\n-        Node[] objects = { getSourceDocument().getRepositoryNode() };\n+        Node[] objects = new Node[0];\n+        if(getSourceDocument() != null) {\n+            objects = new Node[] { getSourceDocument().getRepositoryNode() };\n+        }\n         return objects;\n     }\n \n@@ -54,4 +57,4 @@ protected void doExecute() throws Exception {\n                 getEvent());\n     }\n \n-}\n\\ No newline at end of file\n+}", "filename": "src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/InvokeWorkflow.java"}, {"additions": 4, "raw_url": "https://github.com/apache/lenya/raw/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Publish.java", "blob_url": "https://github.com/apache/lenya/blob/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Publish.java", "sha": "91d9590e14a9f422f7674e5d0ac14982191b7f5b", "changes": 6, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Publish.java?ref=6ab3f7a37978c2bf4a91479bde794336a352ec09", "patch": "@@ -133,8 +133,10 @@ protected boolean hasBrokenLinks() {\n             List nodes = new ArrayList();\n \n             Document doc = getSourceDocument();\n-            nodes.add(doc.getRepositoryNode());\n-            nodes.add(doc.area().getSite().getRepositoryNode());\n+            if(doc != null) {\n+                nodes.add(doc.getRepositoryNode());\n+                nodes.add(doc.area().getSite().getRepositoryNode());\n+            }\n \n             return (org.apache.lenya.cms.repository.Node[]) nodes\n                     .toArray(new org.apache.lenya.cms.repository.Node[nodes.size()]);", "filename": "src/modules-core/workflow/java/src/org/apache/lenya/cms/workflow/usecases/Publish.java"}, {"additions": 6, "raw_url": "https://github.com/apache/lenya/raw/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules/sitetree/java/src/org/apache/lenya/cms/site/usecases/Nudge.java", "blob_url": "https://github.com/apache/lenya/blob/6ab3f7a37978c2bf4a91479bde794336a352ec09/src/modules/sitetree/java/src/org/apache/lenya/cms/site/usecases/Nudge.java", "sha": "a679fb525c08804a78d73f1fcbb1441c68fad95d", "changes": 9, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/sitetree/java/src/org/apache/lenya/cms/site/usecases/Nudge.java?ref=6ab3f7a37978c2bf4a91479bde794336a352ec09", "patch": "@@ -104,8 +104,11 @@ protected void doCheckPreconditions() throws Exception {\n      * @see org.apache.lenya.cms.usecase.AbstractUsecase#getNodesToLock()\n      */\n     protected Node[] getNodesToLock() throws UsecaseException {\n-        Node node = getSourceDocument().area().getSite().getRepositoryNode();\n-        Node[] nodes = { node };\n+        Node[] nodes = new Node[0];\n+        if(getSourceDocument() != null) {\n+            Node node = getSourceDocument().area().getSite().getRepositoryNode();\n+            nodes = new Node[] { node };\n+        }\n         return nodes;\n     }\n \n@@ -150,4 +153,4 @@ protected void doExecute() throws Exception {\n         }\n \n     }\n-}\n\\ No newline at end of file\n+}", "filename": "src/modules/sitetree/java/src/org/apache/lenya/cms/site/usecases/Nudge.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/e41efc2415df890373c182f00bcc54691819e623", "parent": "https://github.com/apache/lenya/commit/9bfb11b3d9eefaf8da0795838ed9b1e363112baa", "message": "Fixes to prevent NPEs when choosing authoring node in the site tab.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@559056 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_34", "file": [{"additions": 10, "raw_url": "https://github.com/apache/lenya/raw/e41efc2415df890373c182f00bcc54691819e623/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ChangeLabel.java", "blob_url": "https://github.com/apache/lenya/blob/e41efc2415df890373c182f00bcc54691819e623/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ChangeLabel.java", "sha": "c5e08cb6dc62e81667c89b31b328876534aab41e", "changes": 13, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ChangeLabel.java?ref=e41efc2415df890373c182f00bcc54691819e623", "patch": "@@ -17,6 +17,9 @@\n  */\n package org.apache.lenya.cms.site.usecases;\n \n+import java.util.ArrayList;\n+import java.util.List;\n+\n import org.apache.lenya.cms.publication.Document;\n import org.apache.lenya.cms.publication.DocumentException;\n import org.apache.lenya.cms.publication.Publication;\n@@ -63,9 +66,13 @@ protected void doCheckPreconditions() throws Exception {\n      * @see org.apache.lenya.cms.usecase.AbstractUsecase#getNodesToLock()\n      */\n     protected Node[] getNodesToLock() throws UsecaseException {\n-        SiteStructure structure = getSourceDocument().area().getSite();\n-        Node[] objects = { structure.getRepositoryNode() };\n-        return objects;\n+        List nodes = new ArrayList();\n+        if(getSourceDocument() != null) {\n+            SiteStructure structure = getSourceDocument().area().getSite();\n+            nodes.add(structure.getRepositoryNode());\n+        }    \n+\n+        return (Node[]) nodes.toArray(new Node[nodes.size()]);\n     }\n \n     /**", "filename": "src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ChangeLabel.java"}, {"additions": 15, "raw_url": "https://github.com/apache/lenya/raw/e41efc2415df890373c182f00bcc54691819e623/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ChangeNodeID.java", "blob_url": "https://github.com/apache/lenya/blob/e41efc2415df890373c182f00bcc54691819e623/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ChangeNodeID.java", "sha": "3e206413f0d9407722074d0f1701d8a15fd4bdf5", "changes": 29, "status": "modified", "deletions": 14, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ChangeNodeID.java?ref=e41efc2415df890373c182f00bcc54691819e623", "patch": "@@ -66,21 +66,22 @@ protected void initParameters() {\n         List nodes = new ArrayList();\n \n         try {\n-            Node siteNode = getSourceDocument().area().getSite().getRepositoryNode();\n-            nodes.add(siteNode);\n-\n-            Document sourceDocument = getSourceDocument();\n-\n-            NodeSet subsite = SiteUtil.getSubSite(this.manager, sourceDocument.getLink().getNode());\n-            for (NodeIterator i = subsite.ascending(); i.hasNext();) {\n-                SiteNode node = i.next();\n-                String[] languages = node.getLanguages();\n-                for (int l = 0; l < languages.length; l++) {\n-                    Document doc = node.getLink(languages[l]).getDocument();\n-                    nodes.add(doc.getRepositoryNode());\n+            if(getSourceDocument() != null) {\n+                Node siteNode = getSourceDocument().area().getSite().getRepositoryNode();\n+                nodes.add(siteNode);\n+\n+                Document sourceDocument = getSourceDocument();\n+  \n+                NodeSet subsite = SiteUtil.getSubSite(this.manager, sourceDocument.getLink().getNode());\n+                for (NodeIterator i = subsite.ascending(); i.hasNext();) {\n+                    SiteNode node = i.next();\n+                    String[] languages = node.getLanguages();\n+                    for (int l = 0; l < languages.length; l++) {\n+                        Document doc = node.getLink(languages[l]).getDocument();\n+                        nodes.add(doc.getRepositoryNode());\n+                    }\n                 }\n             }\n-\n         } catch (Exception e) {\n             throw new UsecaseException(e);\n         }\n@@ -189,4 +190,4 @@ protected String getNewDocumentId() {\n \n         return newDocumentId;\n     }\n-}\n\\ No newline at end of file\n+}", "filename": "src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ChangeNodeID.java"}, {"additions": 10, "raw_url": "https://github.com/apache/lenya/raw/e41efc2415df890373c182f00bcc54691819e623/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ChangeVisibility.java", "blob_url": "https://github.com/apache/lenya/blob/e41efc2415df890373c182f00bcc54691819e623/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ChangeVisibility.java", "sha": "b0454ce1b6c3b82cb4baf65cf170f4d3bf0c2128", "changes": 13, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ChangeVisibility.java?ref=e41efc2415df890373c182f00bcc54691819e623", "patch": "@@ -17,6 +17,9 @@\n  */\n package org.apache.lenya.cms.site.usecases;\n \n+import java.util.ArrayList;\n+import java.util.List;\n+\n import org.apache.lenya.cms.publication.Document;\n import org.apache.lenya.cms.publication.Publication;\n import org.apache.lenya.cms.repository.Node;\n@@ -75,9 +78,13 @@ protected void doExecute() throws Exception {\n      * @see org.apache.lenya.cms.usecase.AbstractUsecase#getNodesToLock()\n      */\n     protected Node[] getNodesToLock() throws UsecaseException {\n-        SiteStructure structure = getSourceDocument().area().getSite();\n-        Node[] objects = { structure.getRepositoryNode() };\n-        return objects;\n+        List nodes = new ArrayList();\n+        if(getSourceDocument() != null) {\n+            SiteStructure structure = getSourceDocument().area().getSite();\n+            nodes.add(structure.getRepositoryNode());\n+        }\n+\n+        return (Node[]) nodes.toArray(new Node[nodes.size()]);\n     }\n \n }", "filename": "src/modules-core/sitemanagement/java/src/org/apache/lenya/cms/site/usecases/ChangeVisibility.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/47c1964952876442068de8a54789588e30edf99b", "parent": "https://github.com/apache/lenya/commit/85dd56c95b3df38549c6e991be2042eeb749b379", "message": "AccessControlUsecase: throw reasonable exception instead of NPE if access controller could not be resolved\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@550517 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_35", "file": [{"additions": 14, "raw_url": "https://github.com/apache/lenya/raw/47c1964952876442068de8a54789588e30edf99b/src/modules-core/acusecases/java/src/org/apache/lenya/cms/ac/usecases/AccessControlUsecase.java", "blob_url": "https://github.com/apache/lenya/blob/47c1964952876442068de8a54789588e30edf99b/src/modules-core/acusecases/java/src/org/apache/lenya/cms/ac/usecases/AccessControlUsecase.java", "sha": "5e014168d9731ea1ee3da1d95f23627769d76472", "changes": 19, "status": "modified", "deletions": 5, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/acusecases/java/src/org/apache/lenya/cms/ac/usecases/AccessControlUsecase.java?ref=47c1964952876442068de8a54789588e30edf99b", "patch": "@@ -48,8 +48,8 @@ public AccessControlUsecase() {\n     private AccessController accessController;\n \n     /**\n-     * Initializes the accreditable managers. FIXME: This method resolves the AccessController, it\n-     * has to be released after it is used!\n+     * Initializes the accreditable managers. FIXME: This method resolves the\n+     * AccessController, it has to be released after it is used!\n      */\n     protected void initializeAccessController() {\n         super.doInitialize();\n@@ -64,11 +64,18 @@ protected void initializeAccessController() {\n         try {\n             selector = (ServiceSelector) this.manager.lookup(AccessControllerResolver.ROLE\n                     + \"Selector\");\n-            resolver = (AccessControllerResolver) selector.select(AccessControllerResolver.DEFAULT_RESOLVER);\n+            resolver = (AccessControllerResolver) selector\n+                    .select(AccessControllerResolver.DEFAULT_RESOLVER);\n \n             this.accessController = resolver.resolveAccessController(getSourceURL());\n \n-            AccreditableManager accreditableManager = this.accessController.getAccreditableManager();\n+            if (this.accessController == null) {\n+                throw new RuntimeException(\"No access controller could be resolved for URL [\"\n+                        + getSourceURL() + \"].\");\n+            }\n+\n+            AccreditableManager accreditableManager = this.accessController\n+                    .getAccreditableManager();\n \n             this.userManager = accreditableManager.getUserManager();\n             this.groupManager = accreditableManager.getGroupManager();\n@@ -124,7 +131,9 @@ protected RoleManager getRoleManager() {\n     protected UserManager getUserManager() {\n         if (this.userManager == null) {\n             if (getLogger().isDebugEnabled())\n-                getLogger().debug(\"getUserManager() accessed, is null, so calling initializeAccessController\");\n+                getLogger()\n+                        .debug(\n+                                \"getUserManager() accessed, is null, so calling initializeAccessController\");\n             initializeAccessController();\n         }\n         return this.userManager;", "filename": "src/modules-core/acusecases/java/src/org/apache/lenya/cms/ac/usecases/AccessControlUsecase.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/c19ffb48827dcf6a008db003dc5a40f6895c10b8", "parent": "https://github.com/apache/lenya/commit/e2597809ec3c4b7f005317efc1878e20e67dc8a3", "message": "richard has added a check to the previous patch to avoid future NPEs.\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@528541 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_36", "file": [{"additions": 0, "raw_url": "https://github.com/apache/lenya/raw/c19ffb48827dcf6a008db003dc5a40f6895c10b8/tools/anttasks/build/classes/org/apache/lenya/cms/ant/CopyJavaSourcesTask.class", "blob_url": "https://github.com/apache/lenya/blob/c19ffb48827dcf6a008db003dc5a40f6895c10b8/tools/anttasks/build/classes/org/apache/lenya/cms/ant/CopyJavaSourcesTask.class", "sha": "17e48eb6552af38612096316d50c8217ddf80f88", "changes": 0, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/tools/anttasks/build/classes/org/apache/lenya/cms/ant/CopyJavaSourcesTask.class?ref=c19ffb48827dcf6a008db003dc5a40f6895c10b8", "filename": "tools/anttasks/build/classes/org/apache/lenya/cms/ant/CopyJavaSourcesTask.class"}, {"additions": 0, "raw_url": "https://github.com/apache/lenya/raw/c19ffb48827dcf6a008db003dc5a40f6895c10b8/tools/anttasks/build/classes/org/apache/lenya/cms/ant/CopyPublicationsTask.class", "blob_url": "https://github.com/apache/lenya/blob/c19ffb48827dcf6a008db003dc5a40f6895c10b8/tools/anttasks/build/classes/org/apache/lenya/cms/ant/CopyPublicationsTask.class", "sha": "4bac092b3e2f72548b9d9ac4db14a224b9a48757", "changes": 0, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/tools/anttasks/build/classes/org/apache/lenya/cms/ant/CopyPublicationsTask.class?ref=c19ffb48827dcf6a008db003dc5a40f6895c10b8", "filename": "tools/anttasks/build/classes/org/apache/lenya/cms/ant/CopyPublicationsTask.class"}, {"additions": 10, "raw_url": "https://github.com/apache/lenya/raw/c19ffb48827dcf6a008db003dc5a40f6895c10b8/tools/anttasks/src/org/apache/lenya/cms/ant/CopyJavaSourcesTask.java", "blob_url": "https://github.com/apache/lenya/blob/c19ffb48827dcf6a008db003dc5a40f6895c10b8/tools/anttasks/src/org/apache/lenya/cms/ant/CopyJavaSourcesTask.java", "sha": "50bc0ae6eef8c9a49a6287357bdfff236fac0333", "changes": 19, "status": "modified", "deletions": 9, "contents_url": "https://api.github.com/repos/apache/lenya/contents/tools/anttasks/src/org/apache/lenya/cms/ant/CopyJavaSourcesTask.java?ref=c19ffb48827dcf6a008db003dc5a40f6895c10b8", "patch": "@@ -88,15 +88,16 @@ public void execute() throws BuildException {\n                     // FIXME: Look for publications defined by the file \"publication.xml\" or modules\n                     // defined by the file \"module.xml\"\n                     String[] pubs = path.list();\n-\n-                    for (int i = 0; i < pubs.length; i++) {\n-                        File pubJavaDir = new File(path, new File(pubs[i], this.javaDir).toString());\n-\n-                        copyContentOfDir(pubJavaDir,\n-                                absoluteBuildDir,\n-                                twoTuple,\n-                                new JavaFilenameFilter(),\n-                                this);\n+                    if (pubs != null) {\n+                        for (int i = 0; i < pubs.length; i++) {\n+                            File pubJavaDir = new File(path, new File(pubs[i], this.javaDir).toString());\n+\n+                            copyContentOfDir(pubJavaDir,\n+                                    absoluteBuildDir,\n+                                    twoTuple,\n+                                    new JavaFilenameFilter(),\n+                                    this);\n+                        }\n                     }\n                 }\n             } else {", "filename": "tools/anttasks/src/org/apache/lenya/cms/ant/CopyJavaSourcesTask.java"}, {"additions": 5, "raw_url": "https://github.com/apache/lenya/raw/c19ffb48827dcf6a008db003dc5a40f6895c10b8/tools/anttasks/src/org/apache/lenya/cms/ant/CopyPublicationsTask.java", "blob_url": "https://github.com/apache/lenya/blob/c19ffb48827dcf6a008db003dc5a40f6895c10b8/tools/anttasks/src/org/apache/lenya/cms/ant/CopyPublicationsTask.java", "sha": "ec75d60f0e9eafc8c7455dab8ae6a079e8703783", "changes": 8, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/lenya/contents/tools/anttasks/src/org/apache/lenya/cms/ant/CopyPublicationsTask.java?ref=c19ffb48827dcf6a008db003dc5a40f6895c10b8", "patch": "@@ -91,10 +91,12 @@ public void copy(String pubsRootDir, FilenameFilter filter, TwoTuple twoTuple) {\n                 CopyJavaSourcesTask.copyDir(new File(pubsRootDir), new File(this.toDir.toString()), twoTuple, filter, this);\n             } else {\n                 File[] files = new File(pubsRootDir).listFiles(filter);\n-                for (int i = 0; i < files.length; i++) {\n-                    copy(files[i].getAbsolutePath(), filter, twoTuple);\n+                if (files != null) {\n+                    for (int i = 0; i < files.length; i++) {\n+                        copy(files[i].getAbsolutePath(), filter, twoTuple);\n+                    }\n                 }\n-                if (files.length < 1) log(\"ERROR: No children: \" + pubsRootDir);\n+                else log(\"ERROR: No children: \" + pubsRootDir);\n             }\n     }\n ", "filename": "tools/anttasks/src/org/apache/lenya/cms/ant/CopyPublicationsTask.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/4b0c9497e35d9624be356e2ac7be14adb1ca2240", "parent": "https://github.com/apache/lenya/commit/815dc4b11925a8f6cc284afefa8f3a5e6a103b06", "message": "Added workaround for https://issues.apache.org/jira/browse/COCOON-889 (CInclude, NPEs in AbstractEnvironment.release())\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@528387 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_37", "file": [{"additions": 12, "raw_url": "https://github.com/apache/lenya/raw/4b0c9497e35d9624be356e2ac7be14adb1ca2240/src/modules/news/sitemap.xmap", "blob_url": "https://github.com/apache/lenya/blob/4b0c9497e35d9624be356e2ac7be14adb1ca2240/src/modules/news/sitemap.xmap", "sha": "651c350e4bd65cb6153adc96fd84e13fe0b6a4f5", "changes": 12, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/news/sitemap.xmap?ref=4b0c9497e35d9624be356e2ac7be14adb1ca2240", "patch": "@@ -46,7 +46,19 @@\n       </map:match>\n       \n       <map:match pattern=\"*.xml/*/*/*/*\">\n+        \n+        <!-- This is a workaround (see below). -->\n+        <map:generate src=\"lenya-document:{4},pub={2},area={3},lang={5}{link:rev}\"/>\n+        <map:transform src=\"fallback://lenya/modules/collection/xslt/prepareCinclude.xsl\">\n+          <map:parameter name=\"uuid\" value=\"{4}\"/>\n+          <map:parameter name=\"language\" value=\"{5}\"/>\n+        </map:transform>\n+        <map:transform type=\"cinclude\"/>\n+        \n+        <!-- This would be a nicer way, but causes NPES in AbstractEnvironment.release(AbstractEnvironment.java:561)\n         <map:generate src=\"{resource-type:collection:format-collection}/{2}/{3}/{4}/{5}\"/>\n+        -->\n+        \n         <map:transform src=\"fallback://lenya/modules/collection/xslt/collection2cinclude.xsl\">\n           <map:parameter name=\"uuid\" value=\"{4}\"/>\n           <map:parameter name=\"language\" value=\"{5}\"/>", "filename": "src/modules/news/sitemap.xmap"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/f132ebae6419a630fd1059a7c75bc4520bafa2f9", "parent": "https://github.com/apache/lenya/commit/5c074cbb46bac155df973482b2ec720c8f347dc2", "message": "Avoid NPE in FallbackSourceFactory when resolved source is null. Thanks to Richard Frovarp for the patch (although I altered it a bit)\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@488185 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_38", "file": [{"additions": 4, "raw_url": "https://github.com/apache/lenya/raw/f132ebae6419a630fd1059a7c75bc4520bafa2f9/src/java/org/apache/lenya/cms/cocoon/source/FallbackSourceFactory.java", "blob_url": "https://github.com/apache/lenya/blob/f132ebae6419a630fd1059a7c75bc4520bafa2f9/src/java/org/apache/lenya/cms/cocoon/source/FallbackSourceFactory.java", "sha": "b9eee2a72d2a493cd7bcf7ee4298d3db886f0fe1", "changes": 8, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/cocoon/source/FallbackSourceFactory.java?ref=f132ebae6419a630fd1059a7c75bc4520bafa2f9", "patch": "@@ -126,10 +126,6 @@ public Source getSource(final String location, Map parameters) throws IOExceptio\n                 source = resolver.getSource();\n             }\n \n-            if (getLogger().isDebugEnabled()) {\n-                getLogger().debug(\"Resolved URI:  [\" + source.getURI() + \"]\");\n-            }\n-\n             if (source == null) {\n                 if (path.startsWith(\"lenya/modules/\")) {\n                     ModuleManager moduleMgr = null;\n@@ -150,6 +146,10 @@ public Source getSource(final String location, Map parameters) throws IOExceptio\n                 }\n             }\n \n+            if (getLogger().isDebugEnabled()) {\n+                getLogger().debug(\"Resolved source:  [\" + source.getURI() + \"]\");\n+            }\n+\n         } catch (Exception e) {\n             throw new RuntimeException(\"Resolving path [\" + location + \"] failed: \", e);\n         } finally {", "filename": "src/java/org/apache/lenya/cms/cocoon/source/FallbackSourceFactory.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/7126ecc3f73a91f1300de15bcdb61f24670a6a80", "parent": "https://github.com/apache/lenya/commit/1bfa0028f69f9002f3e29cf1b16190837e940fa3", "message": "Don't treat the 'insert asset' button as usecase submit button. This avoids the NPE in Create.checkPreConditions(), see bug 40558.\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@467948 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_39", "file": [{"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/7126ecc3f73a91f1300de15bcdb61f24670a6a80/src/modules/bxe/usecases/insertAsset.jx", "blob_url": "https://github.com/apache/lenya/blob/7126ecc3f73a91f1300de15bcdb61f24670a6a80/src/modules/bxe/usecases/insertAsset.jx", "sha": "eda5ba3be2305029915643383002c32128f0b66f", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/bxe/usecases/insertAsset.jx?ref=7126ecc3f73a91f1300de15bcdb61f24670a6a80", "patch": "@@ -88,7 +88,7 @@\n               </jx:if>\n               <tr>\n                 <td colspan=\"2\">\n-                  <input i18n:attr=\"value\" type=\"submit\" name=\"submit\" value=\"Submit\"\n+                  <input i18n:attr=\"value\" type=\"submit\" value=\"Submit\"\n                     onClick=\"javascript:${usecase.getView().getParameter('callbackFunction')}('${usecase.getParameter('document').getName()}');\" />\n                   &#160;\n                   <input i18n:attr=\"value\" type=\"submit\" name=\"cancel\" value=\"Cancel\"", "filename": "src/modules/bxe/usecases/insertAsset.jx"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/19da45e4e045790cdd3c559ff0802a5225cf3205", "parent": "https://github.com/apache/lenya/commit/8397f305e42a57724b179d160014b23c9de92395", "message": "Added isVisibleInNav() method to SiteManager. This allows to fix an NPE in the CreateLanguage usecase.\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@370125 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_40", "file": [{"additions": 10, "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/SiteManager.java", "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/SiteManager.java", "sha": "b81699467e81276bb642896a144c7e3e242d2661", "changes": 11, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/site/SiteManager.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205", "patch": "@@ -147,10 +147,19 @@ boolean requires(DocumentIdentityMap map, Node dependingResource, Node requiredR\n      * It is meant to hide specific nodes within the \"public\" navigation whereas the node is visible within the info/site area.\n      * \n      * @param document The document.\n-     * @param label The label.\n+     * @param visibleInNav The visibility.\n      * @throws SiteException if an error occurs.\n      */\n     void setVisibleInNav(Document document, boolean visibleInNav) throws SiteException;\n+    \n+    /**\n+     * Returns the visibility of a node in the navigation. \n+     * \n+     * @param document The document.\n+     * @return A boolean value.\n+     * @throws SiteException if an error occurs.\n+     */\n+    boolean isVisibleInNav(Document document) throws SiteException;\n \n     /**\n      * Returns all documents in a certain area.", "filename": "src/java/org/apache/lenya/cms/site/SiteManager.java"}, {"additions": 5, "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/simple/SimpleSiteManager.java", "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/simple/SimpleSiteManager.java", "sha": "7aebca3b3599b25c49eaf47ff3080386ffad02fb", "changes": 6, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/site/simple/SimpleSiteManager.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205", "patch": "@@ -201,7 +201,7 @@ public void setLabel(Document document, String label) throws SiteException {\n \n     /**\n      * @see org.apache.lenya.cms.site.SiteManager#setVisibleInNav(org.apache.lenya.cms.publication.Document,\n-     *      java.lang.String)\n+     *      boolean)\n      */\n     public void setVisibleInNav(Document document, boolean visibleInNav) throws SiteException {\n     }\n@@ -236,4 +236,8 @@ public Document getAvailableDocument(Document document) throws SiteException {\n         return document;\n     }\n \n+    public boolean isVisibleInNav(Document document) throws SiteException {\n+        return true;\n+    }\n+\n }\n\\ No newline at end of file", "filename": "src/java/org/apache/lenya/cms/site/simple/SimpleSiteManager.java"}, {"additions": 5, "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/topicmap/TopicMapSiteManager.java", "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/topicmap/TopicMapSiteManager.java", "sha": "5b51ec333cf574bfc494b3e37c78eb1452a68baa", "changes": 6, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/site/topicmap/TopicMapSiteManager.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205", "patch": "@@ -118,7 +118,7 @@ public void setLabel(Document document, String label) throws SiteException {\n     \n     /**\n      * @see org.apache.lenya.cms.site.SiteManager#setVisibleInNav(org.apache.lenya.cms.publication.Document,\n-     *      java.lang.String)\n+     *      boolean)\n      */\n     public void setVisibleInNav(Document document, boolean visibleInNav) throws SiteException {\n     }\n@@ -151,4 +151,8 @@ public Document getAvailableDocument(Document document) throws SiteException {\n         return document;\n     }\n \n+    public boolean isVisibleInNav(Document document) throws SiteException {\n+        return true;\n+    }\n+\n }\n\\ No newline at end of file", "filename": "src/java/org/apache/lenya/cms/site/topicmap/TopicMapSiteManager.java"}, {"additions": 25, "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/usecases/CreateLanguage.java", "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/java/org/apache/lenya/cms/site/usecases/CreateLanguage.java", "sha": "7231a989e9079cd9675dd89d52905ad67cc58f9f", "changes": 26, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/site/usecases/CreateLanguage.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205", "patch": "@@ -19,12 +19,14 @@\n import java.util.ArrayList;\n import java.util.List;\n \n+import org.apache.avalon.framework.service.ServiceSelector;\n import org.apache.lenya.cms.publication.Document;\n import org.apache.lenya.cms.publication.DocumentBuildException;\n import org.apache.lenya.cms.publication.DocumentException;\n import org.apache.lenya.cms.publication.DocumentIdentityMap;\n-import org.apache.lenya.cms.publication.ResourceType;\n import org.apache.lenya.cms.publication.Publication;\n+import org.apache.lenya.cms.publication.ResourceType;\n+import org.apache.lenya.cms.site.SiteManager;\n \n /**\n  * Usecase to create a new language version of a resource.\n@@ -88,6 +90,7 @@ protected void initParameters() {\n \n         Document source = getSourceDocument();\n         if (source != null) {\n+            setParameter(DOCUMENT_ID, source.getId());\n             try {\n                 List nonExistingLanguages = getNonExistingLanguages();\n                 setParameter(LANGUAGES, nonExistingLanguages\n@@ -142,4 +145,25 @@ protected String getDocumentTypeName() {\n         return this.documentTypeName;\n     }\n \n+    protected boolean getVisibleInNav() {\n+        Document source = getSourceDocument();\n+        ServiceSelector selector = null;\n+        SiteManager siteManager = null;\n+        try {\n+            selector = (ServiceSelector) manager.lookup(SiteManager.ROLE + \"Selector\");\n+            siteManager = (SiteManager) selector.select(source.getPublication()\n+                    .getSiteManagerHint());\n+            return siteManager.isVisibleInNav(source);\n+        } catch (Exception e) {\n+            throw new RuntimeException(e);\n+        } finally {\n+            if (selector != null) {\n+                if (siteManager != null) {\n+                    selector.release(siteManager);\n+                }\n+                manager.release(selector);\n+            }\n+        }\n+    }\n+\n }\n\\ No newline at end of file", "filename": "src/java/org/apache/lenya/cms/site/usecases/CreateLanguage.java"}, {"additions": 35, "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/DefaultSiteTree.java", "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/DefaultSiteTree.java", "sha": "3f929d3b28e28af33265726350f4462c057c33ba", "changes": 53, "status": "modified", "deletions": 18, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/DefaultSiteTree.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205", "patch": "@@ -120,9 +120,8 @@ public synchronized Document createDocument() throws ParserConfigurationExceptio\n \n         Element root = document.getDocumentElement();\n         root.setAttribute(\"xmlns:xsi\", \"http://www.w3.org/2001/XMLSchema-instance\");\n-        root\n-                .setAttribute(\"xsi:schemaLocation\",\n-                        \"http://apache.org/cocoon/lenya/sitetree/1.0  ../../../../resources/entities/sitetree.xsd\");\n+        root.setAttribute(\"xsi:schemaLocation\",\n+                \"http://apache.org/cocoon/lenya/sitetree/1.0  ../../../../resources/entities/sitetree.xsd\");\n \n         return document;\n     }\n@@ -177,8 +176,8 @@ public synchronized void addNode(SiteTreeNode node, String refDocumentId) throws\n      * @see org.apache.lenya.cms.site.tree.SiteTree#addNode(java.lang.String, java.lang.String,\n      *      org.apache.lenya.cms.site.Label[], boolean)\n      */\n-    public synchronized void addNode(String parentid, String id, Label[] labels, boolean visibleInNav)\n-            throws SiteException {\n+    public synchronized void addNode(String parentid, String id, Label[] labels,\n+            boolean visibleInNav) throws SiteException {\n         addNode(parentid, id, labels, visibleInNav, null, null, false);\n     }\n \n@@ -194,8 +193,8 @@ public synchronized void addNode(SiteTreeNode node) throws SiteException {\n      *      org.apache.lenya.cms.site.Label[], boolean, java.lang.String, java.lang.String, boolean,\n      *      java.lang.String)\n      */\n-    public synchronized void addNode(String documentid, Label[] labels, boolean visibleInNav, String href, String suffix,\n-            boolean link, String refDocumentId) throws SiteException {\n+    public synchronized void addNode(String documentid, Label[] labels, boolean visibleInNav,\n+            String href, String suffix, boolean link, String refDocumentId) throws SiteException {\n         StringBuffer buf = new StringBuffer();\n         StringTokenizer st = new StringTokenizer(documentid, \"/\");\n         int length = st.countTokens();\n@@ -212,17 +211,17 @@ public synchronized void addNode(String documentid, Label[] labels, boolean visi\n      * @see org.apache.lenya.cms.site.tree.SiteTree#addNode(java.lang.String,\n      *      org.apache.lenya.cms.site.Label[], boolean, java.lang.String, java.lang.String, boolean)\n      */\n-    public synchronized void addNode(String documentid, Label[] labels, boolean visibleInNav, String href, String suffix,\n-            boolean link) throws SiteException {\n+    public synchronized void addNode(String documentid, Label[] labels, boolean visibleInNav,\n+            String href, String suffix, boolean link) throws SiteException {\n         addNode(documentid, labels, visibleInNav, href, suffix, link, null);\n     }\n \n     /**\n      * @see org.apache.lenya.cms.site.tree.SiteTree#addNode(java.lang.String, java.lang.String,\n      *      org.apache.lenya.cms.site.Label[], boolean, java.lang.String, java.lang.String, boolean)\n      */\n-    public synchronized void addNode(String parentid, String id, Label[] labels, boolean visibleInNav, String href,\n-            String suffix, boolean link) throws SiteException {\n+    public synchronized void addNode(String parentid, String id, Label[] labels,\n+            boolean visibleInNav, String href, String suffix, boolean link) throws SiteException {\n         addNode(parentid, id, labels, visibleInNav, href, suffix, link, null);\n     }\n \n@@ -231,8 +230,9 @@ public synchronized void addNode(String parentid, String id, Label[] labels, boo\n      *      org.apache.lenya.cms.site.Label[], boolean, java.lang.String, java.lang.String, boolean,\n      *      java.lang.String)\n      */\n-    public synchronized void addNode(String parentid, String id, Label[] labels, boolean visibleInNav, String href,\n-            String suffix, boolean link, String refDocumentId) throws SiteException {\n+    public synchronized void addNode(String parentid, String id, Label[] labels,\n+            boolean visibleInNav, String href, String suffix, boolean link, String refDocumentId)\n+            throws SiteException {\n \n         Node parentNode = getNodeInternal(parentid);\n \n@@ -263,7 +263,7 @@ public synchronized void addNode(String parentid, String id, Label[] labels, boo\n         } else {\n             child.setAttribute(SiteTreeNodeImpl.VISIBLEINNAV_ATTRIBUTE_NAME, \"false\");\n         }\n-        \n+\n         if ((href != null) && (href.length() > 0)) {\n             child.setAttribute(SiteTreeNodeImpl.HREF_ATTRIBUTE_NAME, href);\n         }\n@@ -514,8 +514,14 @@ public synchronized void importSubtree(SiteTreeNode newParent, SiteTreeNode subt\n         String parentId = newParent.getAbsoluteId();\n         String id = newid;\n \n-        this.addNode(parentId, id, subtreeRoot.getLabels(), subtreeRoot.visibleInNav(), subtreeRoot.getHref(), subtreeRoot\n-                .getSuffix(), subtreeRoot.hasLink(), refDocumentId);\n+        this.addNode(parentId,\n+                id,\n+                subtreeRoot.getLabels(),\n+                subtreeRoot.visibleInNav(),\n+                subtreeRoot.getHref(),\n+                subtreeRoot.getSuffix(),\n+                subtreeRoot.hasLink(),\n+                refDocumentId);\n         newParent = this.getNode(parentId + \"/\" + id);\n         if (newParent == null) {\n             throw new SiteException(\"The added node was not found.\");\n@@ -546,11 +552,12 @@ public synchronized void setLabel(String documentId, Label label) {\n             throw new RuntimeException(e);\n         }\n     }\n-    \n+\n     /**\n      * @see org.apache.lenya.cms.site.tree.SiteTree#setVisibleInNav(java.lang.String, boolean)\n      */\n-    public synchronized void setVisibleInNav(String documentId, boolean visibleInNav)  throws SiteException {\n+    public synchronized void setVisibleInNav(String documentId, boolean visibleInNav)\n+            throws SiteException {\n         SiteTreeNode node = getNode(documentId);\n         if (visibleInNav) {\n             node.setNodeAttribute(SiteTreeNodeImpl.VISIBLEINNAV_ATTRIBUTE_NAME, \"true\");\n@@ -601,4 +608,14 @@ public void save() throws SiteException {\n         saveDocument();\n     }\n \n+    public boolean isVisibleInNav(String documentId) throws SiteException {\n+        SiteTreeNode node = getNode(documentId);\n+        String value = node.getNodeAttribute(SiteTreeNodeImpl.VISIBLEINNAV_ATTRIBUTE_NAME);\n+        if (value != null && !value.equals(\"\")) {\n+            return Boolean.valueOf(value).booleanValue();\n+        } else {\n+            return true;\n+        }\n+    }\n+\n }", "filename": "src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/DefaultSiteTree.java"}, {"additions": 12, "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTree.java", "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTree.java", "sha": "2768394aa3661ec5c911e42bb3e0dcbfa8893e4f", "changes": 14, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTree.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205", "patch": "@@ -158,9 +158,19 @@ void addNode(String documentid, Label[] labels, boolean visibleInNav, String hre\n      * Sets the visibility in the navigation of an existing node. \n      * \n      * @param documentId the document-id to which the visibility is to be added.\n-     * @param visiblieInNav \n+     * @param visibleInNav The visibility. \n+     * @throws SiteException if an error occurs.\n+     */\n+    void setVisibleInNav(String documentId, boolean visibleInNav) throws SiteException;\n+    \n+    /**\n+     * Returns the visibility in the navigation of an existing node.\n+     *  \n+     * @param documentId The document ID.\n+     * @return A boolean value.\n+     * @throws SiteException\n      */\n-    void setVisibleInNav (String documentId, boolean visibleInNav) throws SiteException;\n+    boolean isVisibleInNav(String documentId) throws SiteException;\n \n     /**\n      * Remove a label from a node", "filename": "src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTree.java"}, {"additions": 8, "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNode.java", "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNode.java", "sha": "3e70570046622b3e2617256099ef30b52fc18ffb", "changes": 8, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNode.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205", "patch": "@@ -204,6 +204,14 @@\n      */\n     void setNodeAttribute (String attributeName, String attributeValue);\n \n+    /**\n+     * Returns an attribute of this node.\n+     *\n+     * @param attributeName name of the attribute\n+     * @return The value.\n+     */\n+    String getNodeAttribute (String attributeName);\n+\n     /**\n      * Give a list of the children and this node in a pre order way\n      * @return The list", "filename": "src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNode.java"}, {"additions": 5, "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java", "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java", "sha": "6bbd43c8bdb8a47b95a5ebcb7aa8940e013fba40", "changes": 5, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205", "patch": "@@ -490,4 +490,9 @@ public List preOrder() {\n         return list;\n     }\n \n+    public String getNodeAttribute(String attributeName) {\n+        Element element = (Element) this.node;\n+        return element.getAttribute(attributeName);\n+    }\n+\n }\n\\ No newline at end of file", "filename": "src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/SiteTreeNodeImpl.java"}, {"additions": 6, "raw_url": "https://github.com/apache/lenya/raw/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/TreeSiteManager.java", "blob_url": "https://github.com/apache/lenya/blob/19da45e4e045790cdd3c559ff0802a5225cf3205/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/TreeSiteManager.java", "sha": "5988d9e589c558938415fb00be9fe50f51e81ac4", "changes": 8, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/TreeSiteManager.java?ref=19da45e4e045790cdd3c559ff0802a5225cf3205", "patch": "@@ -302,10 +302,9 @@ public void setLabel(Document document, String label) throws SiteException {\n \n     /**\n      * @see org.apache.lenya.cms.site.SiteManager#setVisibleInNav(org.apache.lenya.cms.publication.Document,\n-     *      java.lang.String)\n+     *      boolean)\n      */\n     public void setVisibleInNav(Document document, boolean visibleInNav) throws SiteException {\n-\n         SiteTree tree = getTree(document);\n         tree.setVisibleInNav(document.getId(), visibleInNav);\n     }\n@@ -469,4 +468,9 @@ protected String computeUniqueDocumentId(Document document) throws SiteException\n \n         return documentId;\n     }\n+\n+    public boolean isVisibleInNav(Document document) throws SiteException {\n+        SiteTree tree = getTree(document);\n+        return tree.isVisibleInNav(document.getId());\n+    }\n }\n\\ No newline at end of file", "filename": "src/modules/sitetree/java/src/org/apache/lenya/cms/site/tree/TreeSiteManager.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/aa79cb9a0bab3ee10b941e4435719ed02c353ffe", "parent": "https://github.com/apache/lenya/commit/2dda93e0ea180d72cf50b99f0f2cc57851cb0368", "message": "Avoid NPE when DocumentHelper passes DTD information to the transformer. This fixes bug #36419. Thanks to Felix Roethenbacher.\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@264963 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_41", "file": [{"additions": 4, "raw_url": "https://github.com/apache/lenya/raw/aa79cb9a0bab3ee10b941e4435719ed02c353ffe/src/java/org/apache/lenya/xml/DocumentHelper.java", "blob_url": "https://github.com/apache/lenya/blob/aa79cb9a0bab3ee10b941e4435719ed02c353ffe/src/java/org/apache/lenya/xml/DocumentHelper.java", "sha": "57fe25be2dc5f44c92b33f655fc2223dafb68c4b", "changes": 6, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/xml/DocumentHelper.java?ref=aa79cb9a0bab3ee10b941e4435719ed02c353ffe", "patch": "@@ -230,8 +230,10 @@ protected static Transformer getTransformer(DocumentType documentType)\n         transformer.setOutputProperty(OutputKeys.METHOD, \"xml\");\n \n         if (documentType != null) {\n-            transformer.setOutputProperty(OutputKeys.DOCTYPE_PUBLIC, documentType.getPublicId());\n-            transformer.setOutputProperty(OutputKeys.DOCTYPE_SYSTEM, documentType.getSystemId());\n+            if (documentType.getPublicId() != null)\n+                transformer.setOutputProperty(OutputKeys.DOCTYPE_PUBLIC, documentType.getPublicId());\n+            if (documentType.getSystemId() != null)\n+                transformer.setOutputProperty(OutputKeys.DOCTYPE_SYSTEM, documentType.getSystemId());\n         }\n \n         return transformer;", "filename": "src/java/org/apache/lenya/xml/DocumentHelper.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/0da9bc340236e6f10911b2a1c67c383e529d7c63", "parent": "https://github.com/apache/lenya/commit/7893547264e5734ac63d6f1fb3f6682420465f37", "message": "we need to set the area before we call the DublinCore constructor or we'll get a NPE\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/lenya/trunk@40628 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_42", "file": [{"additions": 6, "raw_url": "https://github.com/apache/lenya/raw/0da9bc340236e6f10911b2a1c67c383e529d7c63/src/java/org/apache/lenya/cms/publication/DefaultDocument.java", "blob_url": "https://github.com/apache/lenya/blob/0da9bc340236e6f10911b2a1c67c383e529d7c63/src/java/org/apache/lenya/cms/publication/DefaultDocument.java", "sha": "31fd40418246754dea36f5aea99419b697317728", "changes": 9, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/publication/DefaultDocument.java?ref=0da9bc340236e6f10911b2a1c67c383e529d7c63", "patch": "@@ -1,5 +1,5 @@\n /*\n-$Id: DefaultDocument.java,v 1.20 2003/07/31 11:56:42 andreas Exp $\n+$Id: DefaultDocument.java,v 1.21 2003/08/08 08:35:58 gregor Exp $\n <License>\n \n  ============================================================================\n@@ -105,9 +105,11 @@ protected DefaultDocument(Publication publication, String id, String area) {\n \n         assert (publication != null) && !\"\".equals(publication);\n         this.publication = publication;\n+\n+\t\tsetArea(area);\n+\n \t\tthis.dublincore =  new DublinCore(this);\n \n-        setArea(area);\n     }\n \n \t/**\n@@ -124,9 +126,10 @@ protected DefaultDocument(Publication publication, String id, String area, Strin\n \t\tassert (publication != null) && !\"\".equals(publication);\n \t\tthis.publication = publication;\n \t\tthis.language = language;\n+\t\tsetArea(area);\n+\n \t\tthis.dublincore =  new DublinCore(this);\n \n-\t\tsetArea(area);\n \t}\n \n     /**", "filename": "src/java/org/apache/lenya/cms/publication/DefaultDocument.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/bbc329e65a712a301943d807909289952e0532b3", "parent": "https://github.com/apache/lenya/commit/a1dcd156a4c6d8f7f016dc38cb3f00011a2482f6", "message": "Reverting change: Check SiteSource existence when requested with format parameter based on repository source, not SitemapSource (was not the real cause of the NPE).\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@676562 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_43", "file": [{"additions": 4, "raw_url": "https://github.com/apache/lenya/raw/bbc329e65a712a301943d807909289952e0532b3/src/java/org/apache/lenya/cms/cocoon/source/SiteSource.java", "blob_url": "https://github.com/apache/lenya/blob/bbc329e65a712a301943d807909289952e0532b3/src/java/org/apache/lenya/cms/cocoon/source/SiteSource.java", "sha": "857e36b545d55d9d9fb62a5e26ebf94007c7a5dc", "changes": 10, "status": "modified", "deletions": 6, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/cocoon/source/SiteSource.java?ref=bbc329e65a712a301943d807909289952e0532b3", "patch": "@@ -51,7 +51,6 @@\n \n     private ServiceManager manager;\n     private Source delegate;\n-    private Source repositorySource;\n     private String scheme;\n     private String uri;\n \n@@ -108,9 +107,6 @@ public SiteSource(ServiceManager manager, Request request, String location, Logg\n \n             if (site.contains(path, language)) {\n                 Document doc = site.getNode(path).getLink(language).getDocument();\n-                String lenyaURL = doc.getSourceURI();\n-                Session session = RepositoryUtil.getSession(this.manager, request);\n-                this.repositorySource = new RepositorySource(manager, lenyaURL, session, getLogger());\n \n                 if (locationSteps.hasMoreTokens()) {\n                     Query query = new Query(locationSteps.nextToken());\n@@ -120,7 +116,9 @@ public SiteSource(ServiceManager manager, Request request, String location, Logg\n                     }\n                 }\n                 if (this.delegate == null) {\n-                    this.delegate = this.repositorySource;\n+                    String lenyaURL = doc.getSourceURI();\n+                    Session session = RepositoryUtil.getSession(this.manager, request);\n+                    this.delegate = new RepositorySource(manager, lenyaURL, session, getLogger());\n                 }\n             }\n \n@@ -130,7 +128,7 @@ public SiteSource(ServiceManager manager, Request request, String location, Logg\n     }\n     \n     public boolean exists() {\n-        return this.repositorySource != null;\n+        return this.delegate != null;\n     }\n \n     public long getContentLength() {", "filename": "src/java/org/apache/lenya/cms/cocoon/source/SiteSource.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/f13c7c10c0d5ee5ff04df2f2b9cc4fce4a632819", "parent": "https://github.com/apache/lenya/commit/b232776b4825a90d385bb8b8ce229635f5a69f9a", "message": "fixes mismatch in usecasedocument module between view and model (causing\nnpe). thanks to richard frovarp for the report and the fix.\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=40664\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@452347 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_44", "file": [{"additions": 5, "raw_url": "https://github.com/apache/lenya/raw/f13c7c10c0d5ee5ff04df2f2b9cc4fce4a632819/src/modules/usecasedocument/usecases/createUsecaseDocument.jx", "blob_url": "https://github.com/apache/lenya/blob/f13c7c10c0d5ee5ff04df2f2b9cc4fce4a632819/src/modules/usecasedocument/usecases/createUsecaseDocument.jx", "sha": "fbc31b87ef633fd682c2271628bad42364133447", "changes": 10, "status": "modified", "deletions": 5, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules/usecasedocument/usecases/createUsecaseDocument.jx?ref=f13c7c10c0d5ee5ff04df2f2b9cc4fce4a632819", "patch": "@@ -39,22 +39,22 @@\n             <jx:if test=\"${!usecase.getParameter('documentIdProvided')}\">\n               <tr>\n                 <td class=\"lenya-entry-caption\">\n-                  <i18n:text>Parent ID</i18n:text>:</td>\n+                  <i18n:text>Parent Path</i18n:text>:</td>\n                 <td>\n-                  <jx:out value=\"${usecase.getParameter('parentId')}\"/>\n+                  <jx:out value=\"${usecase.getParameter('parentPath')}\"/>\n                 </td>\n               </tr>\n             </jx:if>\n             <tr>\n               <td class=\"lenya-entry-caption\">\n-                <label for=\"documentId\"><i18n:text>Document ID</i18n:text>*: </label></td>\n+                <label for=\"nodeName\"><i18n:text>Node Name</i18n:text>*: </label></td>\n               <td>\n                 <jx:choose>\n                   <jx:when test=\"${usecase.getParameter('documentIdProvided')}\">\n                     <jx:out value=\"${usecase.getParameter('documentId')}\"/>\n                   </jx:when>\n                   <jx:otherwise>\n-                    <input class=\"lenya-form-element\" type=\"text\" name=\"documentId\" value=\"${usecase.getParameter('documentId')}\"/>\n+                    <input class=\"lenya-form-element\" type=\"text\" name=\"nodeName\" value=\"${usecase.getParameter('nodeName')}\"/>\n                     <br/> (<i18n:text>No whitespace, no special characters</i18n:text>)\n                   </jx:otherwise>\n                 </jx:choose>\n@@ -64,7 +64,7 @@\n               <td class=\"lenya-entry-caption\">\n                 <label for=\"title\"><i18n:text>Navigation Title</i18n:text>*: </label></td>\n               <td>\n-                <input class=\"lenya-form-element\" type=\"text\" name=\"title\" value=\"${usecase.getParameter('title')}\"/>\n+                <input class=\"lenya-form-element\" type=\"text\" name=\"dublincore.title\" value=\"${usecase.getParameter('dublincore.title')}\"/>\n               </td>\n             </tr>\n             <tr>", "filename": "src/modules/usecasedocument/usecases/createUsecaseDocument.jx"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/b56ea9f024688e2f9d3d39257f5e8d047b2cbe74", "parent": "https://github.com/apache/lenya/commit/6205f2aa9fc883edeb7ef00719045ecd258c11dd", "message": "Avoid NPE in menu XSP when document is null, return original source URI in usecase when source document is not referenced in site structure.\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@438078 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_45", "file": [{"additions": 3, "raw_url": "https://github.com/apache/lenya/raw/b56ea9f024688e2f9d3d39257f5e8d047b2cbe74/src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/DocumentUsecase.java", "blob_url": "https://github.com/apache/lenya/blob/b56ea9f024688e2f9d3d39257f5e8d047b2cbe74/src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/DocumentUsecase.java", "sha": "ae6397ddb75298a59a9ec0f24d0ce45ea604eb88", "changes": 5, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/DocumentUsecase.java?ref=b56ea9f024688e2f9d3d39257f5e8d047b2cbe74", "patch": "@@ -118,10 +118,11 @@ public String getTargetURL(boolean success) {\n      * @see org.apache.lenya.cms.usecase.AbstractUsecase#getSourceURL()\n      */\n     public String getSourceURL() {\n-        if (getSourceDocument() == null) {\n+        Document doc = getSourceDocument();\n+        if (doc == null || !doc.hasLink()) {\n             return super.getSourceURL();\n         }\n-        return getSourceDocument().getCanonicalWebappURL();\n+        return doc.getCanonicalWebappURL();\n     }\n \n     /**", "filename": "src/modules-core/usecase/java/src/org/apache/lenya/cms/usecase/DocumentUsecase.java"}, {"additions": 5, "raw_url": "https://github.com/apache/lenya/raw/b56ea9f024688e2f9d3d39257f5e8d047b2cbe74/src/pubs/default/config/menus/generic.xsp", "blob_url": "https://github.com/apache/lenya/blob/b56ea9f024688e2f9d3d39257f5e8d047b2cbe74/src/pubs/default/config/menus/generic.xsp", "sha": "7c7d6ab70356070b08f8cbed40588ec12f5b1ee6", "changes": 8, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/pubs/default/config/menus/generic.xsp?ref=b56ea9f024688e2f9d3d39257f5e8d047b2cbe74", "patch": "@@ -41,8 +41,13 @@\n       \n       Object documentObject = <input:get-attribute as=\"object\" module=\"page-envelope\" name=\"document\"/>;\n       Document document = null;\n+      String visible = null;\n       if (documentObject != null &amp;&amp; !\"\".equals(documentObject)) {\n           document = (Document) documentObject;\n+\n+        visible = <input:get-attribute module=\"doc-info\" as=\"string\">\n+          <input:param name=\"name\"><xsp:expr>document.getPublication().getId() + \":\" + document.getArea() + \":\" + document.getId() + \":\" + document.getLanguage() + \":visibleInNav\"</xsp:expr></input:param>\n+        </input:get-attribute>;\n       }\n \n       boolean isDocument = false;\n@@ -55,9 +60,6 @@\n           throw new ProcessingException(e);\n       }\n       \n-      String visible = <input:get-attribute module=\"doc-info\" as=\"string\">\n-        <input:param name=\"name\"><xsp:expr>document.getPublication().getId() + \":\" + document.getArea() + \":\" + document.getId() + \":\" + document.getLanguage() + \":visibleInNav\"</xsp:expr></input:param>\n-      </input:get-attribute>;\n       \n     </xsp:logic>\n     ", "filename": "src/pubs/default/config/menus/generic.xsp"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/8d861fadab698ec02424d43beb45d10ae04b2cf5", "parent": "https://github.com/apache/lenya/commit/dd74f4c14bf3900f3c54781371e5fdc4a2ffdf14", "message": "ChangeNodeID usecase: fixed NPE for top-level nodes, don't call super.getObjectsToLock() to avoid stack overflow. Patch by Josias Thoeny. This resolves bug #35873.\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@225773 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_46", "file": [{"additions": 4, "raw_url": "https://github.com/apache/lenya/raw/8d861fadab698ec02424d43beb45d10ae04b2cf5/src/java/org/apache/lenya/cms/site/usecases/ChangeNodeID.java", "blob_url": "https://github.com/apache/lenya/blob/8d861fadab698ec02424d43beb45d10ae04b2cf5/src/java/org/apache/lenya/cms/site/usecases/ChangeNodeID.java", "sha": "2198a1b6c7e3971b41190a7df3a10a893bc281c0", "changes": 6, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/site/usecases/ChangeNodeID.java?ref=8d861fadab698ec02424d43beb45d10ae04b2cf5", "patch": "@@ -60,7 +60,6 @@ protected void initParameters() {\n      * @see org.apache.lenya.cms.usecase.AbstractUsecase#getObjectsToLock()\n      */\n     protected Transactionable[] getObjectsToLock() throws UsecaseException {\n-        super.lockInvolvedObjects();\n \n         SiteManager siteManager = null;\n         ServiceSelector selector = null;\n@@ -134,10 +133,13 @@ protected void doCheckExecutionConditions() throws Exception {\n                 addErrorMessage(\"The document ID is not valid.\");\n             } else {\n                 Document parent = identityMap.getParent(getSourceDocument());\n+                String parentId = \"\";\n+                // if the document is at the top level, the parent is null\n+                if (parent != null) parentId = parent.getId();\n                 Publication publication = getSourceDocument().getPublication();\n                 Document document = identityMap.get(publication,\n                         getSourceDocument().getArea(),\n-                        parent.getId() + \"/\" + nodeId,\n+                        parentId + \"/\" + nodeId,\n                         getSourceDocument().getLanguage());\n                 if (document.exists()) {\n                     addErrorMessage(\"The document does already exist.\");", "filename": "src/java/org/apache/lenya/cms/site/usecases/ChangeNodeID.java"}, {"additions": 67, "raw_url": "https://github.com/apache/lenya/raw/8d861fadab698ec02424d43beb45d10ae04b2cf5/src/webapp/lenya/usecases/site/changeNodeID.jx", "blob_url": "https://github.com/apache/lenya/blob/8d861fadab698ec02424d43beb45d10ae04b2cf5/src/webapp/lenya/usecases/site/changeNodeID.jx", "sha": "a89928c47dce62a487a3e13693e462c63b3018b9", "changes": 134, "status": "modified", "deletions": 67, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/usecases/site/changeNodeID.jx?ref=8d861fadab698ec02424d43beb45d10ae04b2cf5", "patch": "@@ -1,68 +1,68 @@\n-<?xml version=\"1.0\"?>\n-<!--\n-  Copyright 1999-2004 The Apache Software Foundation\n-\n-  Licensed under the Apache License, Version 2.0 (the \"License\");\n-  you may not use this file except in compliance with the License.\n-  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n--->\n-<!-- $Id: renameLabel.jx 123364 2004-12-26 16:11:27Z gregor $ -->\n-<page:page xmlns:c=\"http://apache.org/cocoon/templates/jx/1.0\" \n-           xmlns=\"http://www.w3.org/1999/xhtml\" \n-           xmlns:i18n=\"http://apache.org/cocoon/i18n/2.1\" \n-           xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\n-           xmlns:jx=\"http://apache.org/cocoon/templates/jx/1.0\"\n-           >\n-           \n-  <page:title>\n-    <i18n:text>Change Document ID</i18n:text>\n-  </page:title>\n-  <page:body>\n-    <div class=\"lenya-box\">\n-      <div class=\"lenya-box-title\">\n-        <i18n:translate>\n-          <i18n:text key=\"rename-label-doc\"/>\n-          <i18n:param>\n-            <q>\n-              <jx:out value=\"${usecase.getParameter('documentId')}\"/>\n-            </q>\n-          </i18n:param>\n-        </i18n:translate>\n-      </div>\n-      <div class=\"lenya-box-body\">\n-        <form method=\"get\" action=\"\">\n-          <input type=\"hidden\" name=\"lenya.continuation\" value=\"${continuation.id}\"/>\n-          <input type=\"hidden\" name=\"lenya.usecase\" value=\"${request.getParameter('lenya.usecase')}\"/>\n-          <table class=\"lenya-table-noborder\">\n-            <tr>\n-              <td colspan=\"2\">\n-                <jx:import uri=\"templates/messages.jx\"/>\n-              </td>\n-            </tr>\n-            <tr>\n-              <td class=\"lenya-entry-caption\"><label for=\"nodeId\"><i18n:text>New Document ID</i18n:text>:</label></td>\n-              <td><input type=\"text\" class=\"lenya-form-element\" name=\"nodeId\" value=\"${usecase.getParameter('nodeId')}\"/></td>\n-            </tr>\n-            <tr>\n-              <td/>\n-              <td>\n-                <br/>\n-                <input i18n:attr=\"value\" type=\"submit\" name=\"submit\" value=\"Save\"/>\n-                &#160;\n-                <input i18n:attr=\"value\" type=\"submit\" name=\"cancel\" value=\"Cancel\"/>\n-              </td>\n-            </tr>\n-          </table>\n-        </form>\n-      </div>\n-    </div>\n-  </page:body>\n+<?xml version=\"1.0\"?>\r\n+<!--\r\n+  Copyright 1999-2004 The Apache Software Foundation\r\n+\r\n+  Licensed under the Apache License, Version 2.0 (the \"License\");\r\n+  you may not use this file except in compliance with the License.\r\n+  You may obtain a copy of the License at\r\n+\r\n+      http://www.apache.org/licenses/LICENSE-2.0\r\n+\r\n+  Unless required by applicable law or agreed to in writing, software\r\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\r\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n+  See the License for the specific language governing permissions and\r\n+  limitations under the License.\r\n+-->\r\n+<!-- $Id: renameLabel.jx 123364 2004-12-26 16:11:27Z gregor $ -->\r\n+<page:page xmlns:c=\"http://apache.org/cocoon/templates/jx/1.0\" \r\n+           xmlns=\"http://www.w3.org/1999/xhtml\" \r\n+           xmlns:i18n=\"http://apache.org/cocoon/i18n/2.1\" \r\n+           xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\r\n+           xmlns:jx=\"http://apache.org/cocoon/templates/jx/1.0\"\r\n+           >\r\n+           \r\n+  <page:title>\r\n+    <i18n:text>Change Document ID</i18n:text>\r\n+  </page:title>\r\n+  <page:body>\r\n+    <div class=\"lenya-box\">\r\n+      <div class=\"lenya-box-title\">\r\n+        <i18n:translate>\r\n+          <i18n:text key=\"rename-label-doc\"/>\r\n+          <i18n:param>\r\n+            <q>\r\n+              <jx:out value=\"${usecase.getParameter('document').getId()}\"/>\r\n+            </q>\r\n+          </i18n:param>\r\n+        </i18n:translate>\r\n+      </div>\r\n+      <div class=\"lenya-box-body\">\r\n+        <form method=\"get\" action=\"\">\r\n+          <input type=\"hidden\" name=\"lenya.continuation\" value=\"${continuation.id}\"/>\r\n+          <input type=\"hidden\" name=\"lenya.usecase\" value=\"${request.getParameter('lenya.usecase')}\"/>\r\n+          <table class=\"lenya-table-noborder\">\r\n+            <tr>\r\n+              <td colspan=\"2\">\r\n+                <jx:import uri=\"templates/messages.jx\"/>\r\n+              </td>\r\n+            </tr>\r\n+            <tr>\r\n+              <td class=\"lenya-entry-caption\"><label for=\"nodeId\"><i18n:text>New Document ID</i18n:text>:</label></td>\r\n+              <td><input type=\"text\" class=\"lenya-form-element\" name=\"nodeId\" value=\"${usecase.getParameter('nodeId')}\"/></td>\r\n+            </tr>\r\n+            <tr>\r\n+              <td/>\r\n+              <td>\r\n+                <br/>\r\n+                <input i18n:attr=\"value\" type=\"submit\" name=\"submit\" value=\"Save\"/>\r\n+                &#160;\r\n+                <input i18n:attr=\"value\" type=\"submit\" name=\"cancel\" value=\"Cancel\"/>\r\n+              </td>\r\n+            </tr>\r\n+          </table>\r\n+        </form>\r\n+      </div>\r\n+    </div>\r\n+  </page:body>\r\n </page:page>\n\\ No newline at end of file", "filename": "src/webapp/lenya/usecases/site/changeNodeID.jx"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/129ed37abce0fad006a91eafe3fd0d286ecf2564", "parent": "https://github.com/apache/lenya/commit/d6760e1ed1c827ec3fd1778fa663665788c9591e", "message": "fix to avoid NPE in logging when new user is added and then used for log\nin. Note: this is a quick fix, a restructuring of the Item hierarchy\nmight be necessary to avoid these problems, see discussion on dev list\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@157066 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_47", "file": [{"additions": 3, "raw_url": "https://github.com/apache/lenya/raw/129ed37abce0fad006a91eafe3fd0d286ecf2564/src/java/org/apache/lenya/cms/ac/usecases/AddUser.java", "blob_url": "https://github.com/apache/lenya/blob/129ed37abce0fad006a91eafe3fd0d286ecf2564/src/java/org/apache/lenya/cms/ac/usecases/AddUser.java", "sha": "57237826ade6671178badafd79223ecfd22ef293", "changes": 5, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/ac/usecases/AddUser.java?ref=129ed37abce0fad006a91eafe3fd0d286ecf2564", "patch": "@@ -18,6 +18,7 @@\n \n import java.io.File;\n \n+import org.apache.avalon.framework.container.ContainerUtil;\n import org.apache.lenya.ac.AccessControlException;\n import org.apache.lenya.ac.User;\n import org.apache.lenya.ac.file.FileUser;\n@@ -115,9 +116,9 @@ protected void doExecute() throws Exception {\n             user.setName(fullName);\n             user.setPassword(password);\n         }\n-\n+        ContainerUtil.enableLogging(user, getLogger());\n         user.setDescription(description);\n         user.save();\n         getUserManager().add(user);\n     }\n-}\n\\ No newline at end of file\n+}", "filename": "src/java/org/apache/lenya/cms/ac/usecases/AddUser.java"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/6aca9871fde3ef7e3d8e82e0026c073d299c8f10", "parent": "https://github.com/apache/lenya/commit/b8008f6b754cec3a4e111579ac1a8c4b7cb6d5a0", "message": "avoid NPE when a user requests <host>:<port>/foo.\nsee bug http://issues.apache.org/bugzilla/show_bug.cgi?id=41694.\n* make URLInformation handle null strings gracefully\n* check for null strings in DocumentPolicyManagerWrapper\n\nadditionally, redirect \"*\" to \"index.html\" in global-sitemap.xmap to\navoid spurious authentication warnings.\nFIXME: a request of the form <pub-id> without a trailing slash is not\nyet handled - it triggers a login usecase, but permission is not granted\nregardless of credentials.\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@511371 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_48", "file": [{"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/6aca9871fde3ef7e3d8e82e0026c073d299c8f10/src/java/org/apache/lenya/cms/publication/URLInformation.java", "blob_url": "https://github.com/apache/lenya/blob/6aca9871fde3ef7e3d8e82e0026c073d299c8f10/src/java/org/apache/lenya/cms/publication/URLInformation.java", "sha": "9ffb6d2201bfbdffacd350672169388858db2c0c", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/java/org/apache/lenya/cms/publication/URLInformation.java?ref=6aca9871fde3ef7e3d8e82e0026c073d299c8f10", "patch": "@@ -39,7 +39,7 @@\n     public String getArea() {\n         if (this.area == null) {\n             String completeArea = getCompleteArea();\n-            if (completeArea.equals(Publication.DAV_AREA)) {\n+            if (Publication.DAV_AREA.equals(completeArea)) {\n                 this.area = Publication.AUTHORING_AREA;\n             } else {\n                 this.area = completeArea;", "filename": "src/java/org/apache/lenya/cms/publication/URLInformation.java"}, {"additions": 6, "raw_url": "https://github.com/apache/lenya/raw/6aca9871fde3ef7e3d8e82e0026c073d299c8f10/src/modules-core/ac/java/src/org/apache/lenya/cms/ac/DocumentPolicyManagerWrapper.java", "blob_url": "https://github.com/apache/lenya/blob/6aca9871fde3ef7e3d8e82e0026c073d299c8f10/src/modules-core/ac/java/src/org/apache/lenya/cms/ac/DocumentPolicyManagerWrapper.java", "sha": "db7a06eb142ab6b756d503b350fdfd59634c9066", "changes": 8, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/modules-core/ac/java/src/org/apache/lenya/cms/ac/DocumentPolicyManagerWrapper.java?ref=6aca9871fde3ef7e3d8e82e0026c073d299c8f10", "patch": "@@ -95,10 +95,14 @@ protected String getPolicyURL(String webappUrl)\n             // have to exist\n \n             URLInformation info = new URLInformation(webappUrl);\n+            // Danger, Will Robinson! If area or pubId is null, webappUrl.substring()\n+            // will be out of bounds, because null becomes \"null\" in string concatenation\n             String pubId = info.getPublicationId();\n             String area = info.getArea();\n-            String prefix = \"/\" + pubId + \"/\";\n-            String prefixWithArea = prefix + area;\n+            String prefix = \"/\" + ((pubId != null) ? pubId : \"\");\n+            // String prefix = \"/\" + pubId + \"/\";\n+            String prefixWithArea = prefix + ((area != null) ? area : \"\");\n+            // String prefixWithArea = prefix + area;\n             String authoringUrl = prefix + Publication.AUTHORING_AREA\n                     + webappUrl.substring(prefixWithArea.length());\n ", "filename": "src/modules-core/ac/java/src/org/apache/lenya/cms/ac/DocumentPolicyManagerWrapper.java"}, {"additions": 4, "raw_url": "https://github.com/apache/lenya/raw/6aca9871fde3ef7e3d8e82e0026c073d299c8f10/src/webapp/global-sitemap.xmap", "blob_url": "https://github.com/apache/lenya/blob/6aca9871fde3ef7e3d8e82e0026c073d299c8f10/src/webapp/global-sitemap.xmap", "sha": "afa68a2650c2fed7ca9065c0148a06a6ed13cb71", "changes": 8, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/global-sitemap.xmap?ref=6aca9871fde3ef7e3d8e82e0026c073d299c8f10", "patch": "@@ -301,10 +301,6 @@\n     </map:pipeline>\n \n     <map:pipeline>\n-      <map:match pattern=\"\">\n-        <map:redirect-to uri=\"index.html\"/>\n-      </map:match>\n-\n       <map:match pattern=\"index.html\">\n         <map:aggregate element=\"lenya\" ns=\"http://apache.org/cocoon/lenya/publication/1.0\" prefix=\"lenya\" label=\"aggregate\">\n           <map:part src=\"cocoon:/publications.xml\"/>\n@@ -320,6 +316,10 @@\n         <map:serialize />\n       </map:match>\n \n+      <map:match pattern=\"*\">\n+        <map:redirect-to uri=\"index.html\"/>\n+      </map:match>\n+\n       <!-- Publications -->\n       <map:match pattern=\"*\">\n         <map:select type=\"request-method\">", "filename": "src/webapp/global-sitemap.xmap"}], "repo": "lenya"}, {"commit": "https://github.com/apache/lenya/commit/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "parent": "https://github.com/apache/lenya/commit/0db5be126f05d2c026e5cf63ef6ded6b2d3556a9", "message": "merged new publication configuration from branch trunk-rework-pubconf.\nworks for me, please test.\n\nHEADSUP:\nTHIS COMMIT WILL BREAK YOUR EXISTING PUBLICATIONS.\nyou will need to tweak your publication.xconf file. for details, just\nbuild the trunk and read the introductory page you see after starting\nlenya. take a look at src/pubs/default/config/publication.xconf for\nwhat's changed.\n\nTODO:\n* fix NPE during build if src/pubs/[default|blog]/publication.xml is\n  deleted entirely (as a workaround, it's now a null-byte file).\n* get rid of multiple-inheritance templating code (which does not work).\n  currently, that stuff has only been removed from the user-visible\n  configuration. under the hood, it still looks as if we supported it.\n  some weird empty-array semantics and a world of null objects pain...\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/lenya/trunk@528490 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "lenya_49", "file": [{"additions": 87, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java", "sha": "afc6d97fbb18f28d0d2ad60e12b6312ab7620e2f", "changes": 138, "status": "modified", "deletions": 51, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -30,7 +30,9 @@\n import org.apache.lenya.cms.repository.Node;\n \n /**\n- * A publication configuration.\n+ * A publication's configuration.\n+ * Keep in sync with src/webapp/lenya/resources/schemas/publication.rng!\n+ * FIXME: validate publication.xconf before attempting to parse\n  */\n public class PublicationConfiguration extends AbstractLogEnabled implements Publication {\n \n@@ -43,11 +45,6 @@\n     private String instantiatorHint = null;\n     private String contentDir = null;\n \n-    private static final String ELEMENT_PROXY = \"proxy\";\n-    private static final String ATTRIBUTE_AREA = \"area\";\n-    private static final String ATTRIBUTE_URL = \"url\";\n-    private static final String ATTRIBUTE_SSL = \"ssl\";\n-\n     private boolean isConfigLoaded = false;\n \n     /**\n@@ -56,20 +53,41 @@\n     public static final String CONFIGURATION_FILE = CONFIGURATION_PATH + File.separator\n             + \"publication.xconf\";\n \n-    private static final String ELEMENT_TEMPLATES = \"templates\";\n+    private static final String CONFIGURATION_NAMESPACE = \n+            \"http://apache.org/cocoon/lenya/publication/1.1\" ;\n+\n+    // properties marked with \"*\" are currently not parsed by this class.\n+    private static final String ELEMENT_NAME = \"name\";\n+    private static final String ELEMENT_DESCRIPTION = \"description\"; //*\n+    private static final String ELEMENT_LONGDESC = \"longdesc\"; //*\n+    private static final String ELEMENT_VERSION = \"version\"; //*\n+    private static final String ELEMENT_LENYA_VERSION = \"lenya-version\"; //*\n+    private static final String ELEMENT_LENYA_REVISION = \"lenya-revision\"; //*\n+    private static final String ELEMENT_COCOON_VERSION = \"cocoon-version\"; //*\n+    private static final String ELEMENT_LANGUAGES = \"languages\";\n+    private static final String ELEMENT_LANGUAGE = \"language\";\n+    private static final String ATTRIBUTE_DEFAULT_LANGUAGE = \"default\";\n     private static final String ELEMENT_TEMPLATE = \"template\";\n     private static final String ATTRIBUTE_ID = \"id\";\n+    private static final String ELEMENT_TEMPLATE_INSTANTIATOR = \"template-instantiator\";\n+    private static final String ATTRIBUTE_NAME = \"name\";\n     private static final String ELEMENT_PATH_MAPPER = \"path-mapper\";\n     private static final String ELEMENT_DOCUMENT_BUILDER = \"document-builder\";\n     private static final String ELEMENT_SITE_MANAGER = \"site-manager\";\n-    private static final String ATTRIBUTE_NAME = \"name\";\n-    private static final String ELEMENT_TEMPLATE_INSTANTIATOR = \"template-instantiator\";\n-    private static final String ELEMENT_CONTENT_DIR = \"content-dir\";\n-    private static final String LANGUAGES = \"languages\";\n-    private static final String DEFAULT_LANGUAGE_ATTR = \"default\";\n-    private static final String BREADCRUMB_PREFIX = \"breadcrumb-prefix\";\n-    private static final String ELEMENT_RESOURCE_TYPE = \"resource-type\";\n+    private static final String ELEMENT_RESOURCE_TYPES = \"resource-types\";//*\n+    private static final String ELEMENT_RESOURCE_TYPE = \"resource-type\";//*\n     private static final String ATTRIBUTE_WORKFLOW = \"workflow\";\n+    private static final String ELEMENT_MODULES = \"modules\";//*\n+    private static final String ELEMENT_MODULE = \"module\";//*\n+    private static final String ELEMENT_BREADCRUMB_PREFIX = \"breadcrumb-prefix\";\n+    private static final String ELEMENT_CONTENT_DIR = \"content-dir\";\n+    private static final String ATTRIBUTE_SRC = \"src\";\n+    private static final String ELEMENT_PROXIES = \"proxies\";\n+    private static final String ELEMENT_PROXY = \"proxy\";\n+    private static final String ATTRIBUTE_AREA = \"area\";\n+    private static final String ATTRIBUTE_URL = \"url\";\n+    private static final String ATTRIBUTE_SSL = \"ssl\";\n+\n \n     /**\n      * Creates a new instance of Publication\n@@ -108,8 +126,9 @@ protected void loadConfiguration() {\n         } else {\n             getLogger().debug(\"Configuration file [\" + configFile + \"] exists.\");\n         }\n-\n-        DefaultConfigurationBuilder builder = new DefaultConfigurationBuilder();\n+        \n+        final boolean ENABLE_XML_NAMESPACES = true;\n+        DefaultConfigurationBuilder builder = new DefaultConfigurationBuilder(ENABLE_XML_NAMESPACES);\n \n         Configuration config;\n \n@@ -119,6 +138,13 @@ protected void loadConfiguration() {\n             config = builder.buildFromFile(configFile);\n \n             try {\n+                // one sanity check for the proper namespace. we should really do that for every element,\n+                // but since ELEMENT_PATH_MAPPER is mandatory, this should catch most cases of forgotten namespace.\n+                if (config.getChild(ELEMENT_PATH_MAPPER).getNamespace() != CONFIGURATION_NAMESPACE) {\n+                   getLogger().warn(\"Deprecated configuration: the publication configuration elements in \"\n+                       + configFile + \" must be in the \" + CONFIGURATION_NAMESPACE + \" namespace.\"\n+                       + \" See webapp/lenya/resources/schemas/publication.xconf.\");\n+                }\n                 pathMapperClassName = config.getChild(ELEMENT_PATH_MAPPER).getValue();\n                 Class pathMapperClass = Class.forName(pathMapperClassName);\n                 this.mapper = (DocumentIdToPathMapper) pathMapperClass.newInstance();\n@@ -134,12 +160,12 @@ protected void loadConfiguration() {\n                         .getAttribute(ATTRIBUTE_NAME);\n             }\n \n-            Configuration[] _languages = config.getChild(LANGUAGES).getChildren();\n+            Configuration[] _languages = config.getChild(ELEMENT_LANGUAGES).getChildren(ELEMENT_LANGUAGE);\n             for (int i = 0; i < _languages.length; i++) {\n                 Configuration languageConfig = _languages[i];\n                 String language = languageConfig.getValue();\n                 this.languages.add(language);\n-                if (languageConfig.getAttribute(DEFAULT_LANGUAGE_ATTR, null) != null) {\n+                if (languageConfig.getAttribute(ATTRIBUTE_DEFAULT_LANGUAGE, null) != null) {\n                     this.defaultLanguage = language;\n                 }\n             }\n@@ -149,34 +175,41 @@ protected void loadConfiguration() {\n                 this.siteManagerName = siteManagerConfiguration.getAttribute(ATTRIBUTE_NAME);\n             }\n \n-            Configuration[] proxyConfigs = config.getChildren(ELEMENT_PROXY);\n-            for (int i = 0; i < proxyConfigs.length; i++) {\n-                String url = proxyConfigs[i].getAttribute(ATTRIBUTE_URL);\n-                String ssl = proxyConfigs[i].getAttribute(ATTRIBUTE_SSL);\n-                String area = proxyConfigs[i].getAttribute(ATTRIBUTE_AREA);\n-\n-                Proxy proxy = new Proxy();\n-                proxy.setUrl(url);\n-\n-                Object key = getProxyKey(area, Boolean.valueOf(ssl).booleanValue());\n-                this.areaSsl2proxy.put(key, proxy);\n-                if (getLogger().isDebugEnabled()) {\n-                    getLogger().debug(\n-                            \"Adding proxy: [\" + proxy + \"] for area=[\" + area + \"] SSL=[\" + ssl\n-                                    + \"]\");\n+            Configuration proxyConfig = config.getChild(ELEMENT_PROXIES);\n+            if (proxyConfig != null) {\n+                Configuration[] proxyConfigs = proxyConfig.getChildren(ELEMENT_PROXY);\n+                for (int i = 0; i < proxyConfigs.length; i++) {\n+                    String url = proxyConfigs[i].getAttribute(ATTRIBUTE_URL);\n+                    String ssl = proxyConfigs[i].getAttribute(ATTRIBUTE_SSL);\n+                    String area = proxyConfigs[i].getAttribute(ATTRIBUTE_AREA);\n+    \n+                    Proxy proxy = new Proxy();\n+                    proxy.setUrl(url);\n+    \n+                    Object key = getProxyKey(area, Boolean.valueOf(ssl).booleanValue());\n+                    this.areaSsl2proxy.put(key, proxy);\n+                    if (getLogger().isDebugEnabled()) {\n+                        getLogger().debug(\n+                                \"Adding proxy: [\" + proxy + \"] for area=[\" + area + \"] SSL=[\" + ssl\n+                                        + \"]\");\n+                    }\n                 }\n             }\n \n-            Configuration templatesConfig = config.getChild(ELEMENT_TEMPLATES);\n-            if (templatesConfig != null) {\n-                Configuration[] templateConfigs = templatesConfig.getChildren(ELEMENT_TEMPLATE);\n-                this.templates = new String[templateConfigs.length];\n-                for (int i = 0; i < templateConfigs.length; i++) {\n-                    String templateId = templateConfigs[i].getAttribute(ATTRIBUTE_ID);\n-                    this.templates[i] = templateId;\n-                }\n+            Configuration templateConfig = config.getChild(ELEMENT_TEMPLATE, false);\n+            //FIXME: this is a hack. For some reason, the old code seems to imply that a publication\n+            // can have multiple templates. This is not the case. All this code should use a simple string\n+            // rather than arrays at some point. For now, the old array is kept, to avoid having to deal\n+            // with all kinds of NPEs that keep cropping up...\n+            if (templateConfig == null) {\n+                this.templates = new String[0]; // ugh. empty array to keep the legacy code from breaking.\n+            }\n+            else {\n+                 this.templates = new String[1];\n+                 this.templates[0] = templateConfig.getAttribute(ATTRIBUTE_ID);\n             }\n \n+\n             Configuration templateInstantiatorConfig = config.getChild(\n                     ELEMENT_TEMPLATE_INSTANTIATOR, false);\n             if (templateInstantiatorConfig != null) {\n@@ -186,21 +219,24 @@ protected void loadConfiguration() {\n \n             Configuration contentDirConfig = config.getChild(ELEMENT_CONTENT_DIR, false);\n             if (contentDirConfig != null) {\n-                this.contentDir = contentDirConfig.getAttribute(\"src\");\n+                this.contentDir = contentDirConfig.getAttribute(ATTRIBUTE_SRC);\n                 getLogger().info(\n                         \"Content directory loaded from pub configuration: \" + this.contentDir);\n             } else {\n                 getLogger().info(\"No content directory specified within pub configuration!\");\n             }\n \n-            Configuration[] resourceTypeConfigs = config.getChildren(ELEMENT_RESOURCE_TYPE);\n-            for (int i = 0; i < resourceTypeConfigs.length; i++) {\n-                String name = resourceTypeConfigs[i].getAttribute(ATTRIBUTE_NAME);\n-                this.resourceTypes.add(name);\n-\n-                String workflow = resourceTypeConfigs[i].getAttribute(ATTRIBUTE_WORKFLOW, null);\n-                if (workflow != null) {\n-                    this.resourceType2workflow.put(name, workflow);\n+            Configuration resourceTypeConfig = config.getChild(ELEMENT_RESOURCE_TYPES);\n+            if (resourceTypeConfig != null) {\n+                Configuration[] resourceTypeConfigs = resourceTypeConfig.getChildren(ELEMENT_RESOURCE_TYPE);\n+                for (int i = 0; i < resourceTypeConfigs.length; i++) {\n+                    String name = resourceTypeConfigs[i].getAttribute(ATTRIBUTE_NAME);\n+                    this.resourceTypes.add(name);\n+    \n+                    String workflow = resourceTypeConfigs[i].getAttribute(ATTRIBUTE_WORKFLOW, null);\n+                    if (workflow != null) {\n+                        this.resourceType2workflow.put(name, workflow);\n+                    }\n                 }\n             }\n \n@@ -209,7 +245,7 @@ protected void loadConfiguration() {\n                     e);\n         }\n \n-        this.breadcrumbprefix = config.getChild(BREADCRUMB_PREFIX).getValue(\"\");\n+        this.breadcrumbprefix = config.getChild(ELEMENT_BREADCRUMB_PREFIX).getValue(\"\");\n \n         isConfigLoaded = true;\n     }", "filename": "src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java"}, {"additions": 12, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/blog/config/publication.xconf", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/blog/config/publication.xconf", "sha": "c4683826e8fa4b485fde5b0fc505b546c0394f73", "changes": 26, "status": "modified", "deletions": 14, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/pubs/blog/config/publication.xconf?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -18,7 +18,13 @@\n \n <!-- $Id$ -->\n \n-<publication>\n+<publication xmlns=\"http://apache.org/cocoon/lenya/publication/1.1\" show=\"true\">\n+  <name>Lenya Blog</name>\n+  <description>An experimental Lenya-based blog in proof-of-concept stage.</description>\n+  <version>@lenya.version@</version>\n+  <lenya-version>@lenya.version@</lenya-version>\n+  <lenya-revision>@lenya.revision@</lenya-revision>\n+  <cocoon-version>2.1.8+</cocoon-version>\n   <languages>\n     <language default=\"true\">en</language>\n     <language>de</language>\n@@ -28,17 +34,9 @@\n   <breadcrumb-prefix/>\n   <ssl-prefix/>\n   <site-manager name=\"simple\"/>\n-  <resource-type name=\"entry\" workflow=\"workflow.xml\"/>\n-  <resource-type name=\"sidebar\" workflow=\"workflow.xml\"/>\n-\n-  <!-- NOTE: The configuration of the content directory has NOT been fully tested yet and might lead to unexpected results. Use at own risk ;-) -->\n-  <!-- Relative to webapp context: -->\n-  <!--\n-  <content-dir src=\"lenya/pubs/blog\"/>\n-  -->\n-  <!-- Absolute: -->\n-  <!--\n-  <content-dir src=\"/home/USERNAME/data/blog\"/>\n-  <content-dir src=\"D:/tmp/blog\"/>\n-  -->\n+  <resource-types>\n+    <resource-type name=\"entry\" workflow=\"workflow.xml\"/>\n+    <resource-type name=\"sidebar\" workflow=\"workflow.xml\"/>\n+  </resource-types>\n </publication>\n+", "filename": "src/pubs/blog/config/publication.xconf"}, {"additions": 0, "raw_url": "https://github.com/apache/lenya/raw/0db5be126f05d2c026e5cf63ef6ded6b2d3556a9/src/pubs/blog/publication-tests.xml", "blob_url": "https://github.com/apache/lenya/blob/0db5be126f05d2c026e5cf63ef6ded6b2d3556a9/src/pubs/blog/publication-tests.xml", "sha": "0ae011ad5f9ce93f45bae13cb6798967d5e88d6d", "changes": 27, "status": "removed", "deletions": 27, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/pubs/blog/publication-tests.xml?ref=0db5be126f05d2c026e5cf63ef6ded6b2d3556a9", "patch": "@@ -1,27 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>\n-<!--\n-  Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n--->\n-\n-<!-- $Id$ -->\n-\n-<lenya:publication xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.0\">\n-<lenya:tests>\n-  <lenya:test>Feed example: <a href=\"live/feeds/all/index.xml\">XML</a>, <a href=\"live/feeds/all/index.html\">HTML</a></lenya:test>\n-  <lenya:test>WebDAV: <a href=\"webdav://127.0.0.1:8080/lenya/blog/webdav/entries/2003/\">Collection</a></lenya:test>\n-  <lenya:test>Atom: <a href=\"atomapi/\">Introspection</a>, <a href=\"atomapi/search?atom-all\">atom-all</a></lenya:test>\n-</lenya:tests>\n-</lenya:publication>", "filename": "src/pubs/blog/publication-tests.xml"}, {"additions": 0, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/blog/publication.xml", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/blog/publication.xml", "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391", "changes": 79, "status": "modified", "deletions": 79, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/pubs/blog/publication.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -1,79 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<!--\n-  Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n--->\n-\n-<!-- $Id$ -->\n-\n-<lenya:publication xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.0\" lenya:show=\"true\">\n-<lenya:pub-version>@lenya.version@</lenya:pub-version>\n-<lenya:lenya-version>@lenya.version@</lenya:lenya-version>\n-<lenya:lenya-revision>@lenya.revision@</lenya:lenya-revision>\n-<lenya:cocoon-version>2.1.8 or 2.1.9-dev</lenya:cocoon-version>\n-<lenya:name>Lenya's Weblog</lenya:name>\n-\n-<lenya:description>\n-This publication is an initiative to implement the <a href=\"http://www.intertwingly.net/wiki/pie/FrontPage\">\"Echo/Atom\"</a> specification for syndicating, archiving and\n-editing episodic web sites (e.g. weblogs).\n-</lenya:description>\n-\n-<lenya:readme>\n-<h3>Customizing the layout</h3>\n-The fonts and colors can be customized by editing the file <code>resources/css/styles.css</code>.\n-The positioning can be customized by editing the file <code>xslt/global.xsl</code>. The following CSS resources\n-might be helpful\n-<br /><a href=\"http://www.w3schools.com/css/css_reference.asp\">CSS2 Reference</a>\n-<br /><a href=\"http://www.csszengarden.com\">The Beauty of CSS Design</a>\n-<br /><a href=\"http://www.lightsphere.com/colors/\">216 Color Square</a>\n-\n-<h3>Weblog Resources</h3>\n-<a href=\"http://www.intertwingly.net/wiki/pie/Syntax\">Doctypes</a> (entry, feed, etc.)\n-<br />\n-<a href=\"http://www.imc.org/atom-syntax/mail-archive/maillist.html\">Mailing List</a>\n-<br />\n-<a href=\"http://intertwingly.net/stories/2003/07/01/example.necho\">XML proposal of doctype entry</a>\n-<br />\n-<a href=\"http://www.dynamicobjects.com/d2r/archives/001921.html\">A Review of Blogging APIs</a>\n-<br />\n-<a href=\"http://btrott.typepad.com/typepad/atom.xml\">Sample Feed by TypePad</a>\n-\n-<h3>Other Atom API Implementations</h3>\n-<a href=\"http://bitworking.org/rfc/\">Specification</a>\n-<br />\n-<a href=\"http://diveintomark.org/archives/2003/08/18/atom_api_implementation\">Overview</a>\n-<br />\n-<a href=\"http://bitworking.org/rfc/implementation/wxAtomClient_25Aug2003.zip\">Python Client</a>\n-<br />\n-<code>export HTTP_PROXY=http://127.0.0.1:4444</code>\n-<br />\n-<code>python wxAtomClientApp.py</code>\n-<br />\n-<a href=\"http://www.diveintomark.org/atom/\">Testing the client</a>\n-<br />\n-<code>java -classpath lib/axis.jar org.apache.axis.utils.tcpmon</code>\n-(Listen Port # 4444, Act as a ... Proxy, Options: HTTP Proxy Support)\n-<br />\n-<a href=\"http://diveintomark.org/public/2003/08/atom-api-20030825.py\">Python Server</a>\n-<br />\n-<a href=\"http://www.intertwingly.net/code/mombo/\">Python Server</a>\n-\n-<h3>Atom Misc</h3>\n-<a href=\"http://www.feedvalidator.org\">http://www.feedvalidator.org</a>\n-<br />\n-<a href=\"http://feedvalidator.org/download/rssvalidator-latest.zip\">Download Feed Validator</a>\n-</lenya:readme>\n-\n-</lenya:publication>", "filename": "src/pubs/blog/publication.xml"}, {"additions": 79, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/blog/readme.xml", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/blog/readme.xml", "sha": "64051a46651cb3cf4947079d02bdc5ce950b52ba", "changes": 79, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/pubs/blog/readme.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -0,0 +1,79 @@\n+<?xml version=\"1.0\"?>\n+<!--\n+  Licensed to the Apache Software Foundation (ASF) under one or more\n+  contributor license agreements.  See the NOTICE file distributed with\n+  this work for additional information regarding copyright ownership.\n+  The ASF licenses this file to You under the Apache License, Version 2.0\n+  (the \"License\"); you may not use this file except in compliance with\n+  the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+-->\n+\n+<!-- $Id: introduction.xml 473861 2006-11-12 03:51:14Z gregor $ -->\n+\n+<page:page \n+  xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\n+  xmlns=\"http://www.w3.org/1999/xhtml\"\n+>\n+  <page:head/>\n+  <page:body>\n+    <h1>README: Blog</h1>\n+    <h2>Customizing the layout</h2>\n+    <p>\n+      The fonts and colors can be customized by editing the file <code>resources/css/styles.css</code>.\n+      The positioning can be customized by editing the file <code>xslt/global.xsl</code>. The following CSS resources\n+      might be helpful:\n+    </p>\n+    <ul>\n+      <li><a href=\"http://www.w3schools.com/css/css_reference.asp\">CSS2 Reference</a></li>\n+      <li><a href=\"http://www.csszengarden.com\">The Beauty of CSS Design</a></li>\n+      <li><a href=\"http://www.lightsphere.com/colors/\">216 Color Square</a></li>\n+    </ul>\n+    <h2>Testing the blog</h2>\n+    <ul>\n+      <li>Feed example: <a href=\"live/feeds/all/index.xml\">XML</a>, <a href=\"live/feeds/all/index.html\">HTML</a></li>\n+      <li>WebDAV: <a href=\"webdav://127.0.0.1:8080/lenya/blog/webdav/entries/2003/\">Collection</a></li>\n+      <li>Atom: <a href=\"atomapi/\">Introspection</a>, <a href=\"atomapi/search?atom-all\">atom-all</a></li>\n+    </ul>\n+    <h2>Weblog Resources</h2>\n+    <ul>\n+      <li><a href=\"http://www.intertwingly.net/wiki/pie/Syntax\">Doctypes</a> (entry, feed, etc.)</li>\n+      <li><a href=\"http://www.imc.org/atom-syntax/mail-archive/maillist.html\">Mailing List</a></li>\n+      <li><a href=\"http://intertwingly.net/stories/2003/07/01/example.necho\">XML proposal of doctype entry</a></li>\n+      <li><a href=\"http://www.dynamicobjects.com/d2r/archives/001921.html\">A Review of Blogging APIs</a></li>\n+      <li><a href=\"http://btrott.typepad.com/typepad/atom.xml\">Sample Feed by TypePad</a></li>\n+    </ul>\n+    \n+    <h2>Other Atom API Implementations</h2>\n+    <ul>\n+      <li><a href=\"http://bitworking.org/rfc/\">Specification</a></li>\n+      <li><a href=\"http://diveintomark.org/archives/2003/08/18/atom_api_implementation\">Overview</a></li>\n+      <li>\n+        <a href=\"http://bitworking.org/rfc/implementation/wxAtomClient_25Aug2003.zip\">Python Client</a><br />\n+        <code>export HTTP_PROXY=http://127.0.0.1:4444</code><br />\n+        <code>python wxAtomClientApp.py</code>\n+      </li>\n+      <li>\n+        <a href=\"http://www.diveintomark.org/atom/\">Testing the client</a><br />\n+        <code>java -classpath lib/axis.jar org.apache.axis.utils.tcpmon</code><br />\n+        (Listen Port # 4444, Act as a ... Proxy, Options: HTTP Proxy Support)\n+      </li>\n+      <li><a href=\"http://diveintomark.org/public/2003/08/atom-api-20030825.py\">Python Server</a></li>\n+      <li><a href=\"http://www.intertwingly.net/code/mombo/\">Python Server</a></li>\n+    </ul>\n+    \n+    <h2>Atom Misc</h2>\n+    <ul>\n+      <li><a href=\"http://www.feedvalidator.org\">http://www.feedvalidator.org</a></li>\n+      <li><a href=\"http://feedvalidator.org/download/rssvalidator-latest.zip\">Download Feed Validator</a></li>\n+    </ul>\n+  </page:body>\n+</page:page>\n+ ", "filename": "src/pubs/blog/readme.xml"}, {"additions": 65, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/default/config/publication.xconf", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/default/config/publication.xconf", "sha": "ebee85052fe4795e0505c4b0d822d68f62e9628c", "changes": 113, "status": "modified", "deletions": 48, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/pubs/default/config/publication.xconf?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -18,76 +18,93 @@\n \n <!-- $Id$ -->\n \n-<publication>\n+<publication xmlns=\"http://apache.org/cocoon/lenya/publication/1.1\" >\n \n-  <!-- NOTE: The various languages need to be listed for verification and widget building -->\n+  <name>Default Publication</name>\n+  <description>This publication is a best practice, getting started publication.</description>\n+  <!-- the @...@ macros are evaluated by ant at build time -->\n+  <version>@lenya.version@</version>\n+  <lenya-version>@lenya.version@</lenya-version>\n+  <lenya-revision>@lenya.revision@</lenya-revision>\n+  <cocoon-version>2.1.10-dev</cocoon-version>\n+\n+  <!-- The various languages need to be listed for verification and widget building -->\n   <languages>\n     <language default=\"true\">en</language>\n     <language>de</language>\n     <language>he</language>\n     <language>es</language>\n     <language>fr</language>\n   </languages>\n+  <!-- A template instantiator is used to create new publications based on this one. -->\n   <template-instantiator name=\"default\"/>\n+  <!-- A publication can inherit from another publication. \"id\" corresponds to the publication id \n+       of that template (and thus to the name of the directory it's stored in) -->\n+  <!--\n+     <template id=\"some-pub-id\"/>\n+  -->\n   <path-mapper>org.apache.lenya.cms.publication.DefaultDocumentIdToPathMapper</path-mapper>\n   <document-builder name=\"default\"/>\n   <breadcrumb-prefix/>\n   <site-manager name=\"tree\"/>\n   \n-  <!-- NOTE: Resource types need to be listed because of the workflow resp. because the workflow depends on the publication and not on the resource type -->\n-  <resource-type name=\"xhtml\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n-  <resource-type name=\"homepage\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n-  <resource-type name=\"links\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n-  <resource-type name=\"cforms\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n-  <resource-type name=\"opendocument\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n-  <resource-type name=\"resource\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n-  <resource-type name=\"usecase\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n-  <resource-type name=\"news\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+  <!-- Resource types need to be listed because of the workflow resp. because the workflow depends on the publication and not on the resource type -->\n+  <resource-types>\n+    <resource-type name=\"xhtml\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+    <resource-type name=\"homepage\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+    <resource-type name=\"links\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+    <resource-type name=\"cforms\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+    <resource-type name=\"opendocument\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+    <resource-type name=\"resource\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+    <resource-type name=\"usecase\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+    <resource-type name=\"news\" workflow=\"fallback://config/workflow/workflow.xml\"/>\n+  </resource-types>\n   \n-  <!-- NOTE: Modules need to be listed because of the menu and i18n -->\n-  <module name=\"editors\"/>\n-  <module name=\"xhtml\"/>\n-  <module name=\"links\"/>\n-  <module name=\"opendocument\"/>\n-  <module name=\"cforms\"/>\n-  <module name=\"homepage\"/>\n-  <module name=\"resource\"/>\n-  <module name=\"sitemanagement\"/>\n-  <module name=\"sitetree\"/>\n-  <module name=\"export\"/>\n-  <module name=\"workflow\"/>\n-  <module name=\"notification\"/>\n-  <module name=\"svg\"/>\n-  <module name=\"lucene\"/>\n-  <module name=\"development\"/>\n-  <module name=\"languageselector\"/>\n-  <module name=\"administration\"/>\n-  <module name=\"news\"/>\n-  <module name=\"contactform\"/>\n+  <!-- Modules need to be listed because of the menu and i18n -->\n+  <modules>\n+    <module name=\"editors\"/>\n+    <module name=\"xhtml\"/>\n+    <module name=\"links\"/>\n+    <module name=\"opendocument\"/>\n+    <module name=\"cforms\"/>\n+    <module name=\"homepage\"/>\n+    <module name=\"resource\"/>\n+    <module name=\"sitemanagement\"/>\n+    <module name=\"sitetree\"/>\n+    <module name=\"export\"/>\n+    <module name=\"workflow\"/>\n+    <module name=\"notification\"/>\n+    <module name=\"svg\"/>\n+    <module name=\"lucene\"/>\n+    <module name=\"development\"/>\n+    <module name=\"languageselector\"/>\n+    <module name=\"administration\"/>\n+    <module name=\"news\"/>\n+  </modules>\n   <!-- TODO: The goal is to have a blog module ;-) -->\n   <!--\n   <module name=\"blog\"/>\n   -->\n \n-  <!-- NOTE: The configuration of the content directory has NOT been fully tested yet and might lead to unexpected results. Use at own risk ;-) -->\n-  <!-- Relative to webapp context: -->\n-  <!--\n-  <content-dir src=\"lenya/pubs/default\"/>\n-  -->\n-  <!-- Absolute: -->\n+  <!-- You can specify a custom location for your content, outside the Lenya build tree. Note that you will probably also want\n+       to specify custom locations for access control (see ac/ac.xconf), so that all your dynamically generated data is in one place\n+       for easy backup. -->\n   <!--\n-  <content-dir src=\"/home/USERNAME/data/default\"/>\n-  <content-dir src=\"D:/tmp/default\"/>\n+       Relative to webapp context: \n+          <content-dir src=\"lenya/pubs/default\"/>\n+       Absolute:\n+          <content-dir src=\"/home/USERNAME/data/default\"/>\n+          <content-dir src=\"D:/tmp/default\"/>\n   -->\n   \n-  <!--\n-       For information about these settings, read \n-       http://lenya.apache.org/1_2_x/components/deployment/proxying.html\n-\n-  <proxy area=\"live\" ssl=\"true\" url=\"https://www.host.com/ssl/default\"/>\n-  <proxy area=\"live\" ssl=\"false\" url=\"http://www.host.com/default\"/>\n-  <proxy area=\"authoring\" ssl=\"true\" url=\"https://www.host.com/lenya/default/authoring\"/>\n-  <proxy area=\"authoring\" ssl=\"false\" url=\"http://www.host.com/lenya/default/authoring\"/>\n+  <!-- Lenya can rewrite the links to cater to special proxy setups.\n+       For information about these settings, read http://lenya.apache.org/1_2_x/components/deployment/proxying.html\n+       (yes, this needs some updating... sorry.)\n+  <proxies>\n+    <proxy area=\"live\" ssl=\"true\" url=\"https://www.host.com/ssl/default\"/>\n+    <proxy area=\"live\" ssl=\"false\" url=\"http://www.host.com/default\"/>\n+    <proxy area=\"authoring\" ssl=\"true\" url=\"https://www.host.com/lenya/default/authoring\"/>\n+    <proxy area=\"authoring\" ssl=\"false\" url=\"http://www.host.com/lenya/default/authoring\"/>\n+  </proxies>\n   -->\n-  \n </publication>", "filename": "src/pubs/default/config/publication.xconf"}, {"additions": 40, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/default/java/src/org/apache/lenya/defaultpub/cms/publication/templating/Instantiator.java", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/default/java/src/org/apache/lenya/defaultpub/cms/publication/templating/Instantiator.java", "sha": "6cc4fd323f36634eb16b7f76e451287060794936", "changes": 65, "status": "modified", "deletions": 25, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/pubs/default/java/src/org/apache/lenya/defaultpub/cms/publication/templating/Instantiator.java?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -28,7 +28,7 @@\n import javax.xml.transform.TransformerConfigurationException;\n import javax.xml.transform.TransformerException;\n \n-import org.apache.avalon.framework.configuration.Configuration;\n+import org.apache.avalon.framework.configuration.MutableConfiguration;\n import org.apache.avalon.framework.configuration.ConfigurationException;\n import org.apache.avalon.framework.configuration.DefaultConfiguration;\n import org.apache.avalon.framework.configuration.DefaultConfigurationBuilder;\n@@ -44,6 +44,7 @@\n import org.apache.excalibur.source.SourceResolver;\n import org.apache.excalibur.source.impl.FileSource;\n import org.apache.lenya.cms.publication.Publication;\n+//import org.apache.lenya.cms.publication.PublicationConfiguration;\n import org.apache.lenya.xml.DocumentHelper;\n import org.apache.lenya.xml.NamespaceHelper;\n import org.w3c.dom.Document;\n@@ -58,15 +59,27 @@\n public class Instantiator extends AbstractLogEnabled implements\n         org.apache.lenya.cms.publication.templating.Instantiator, Serviceable {\n \n-    protected static final String[] sourcesToCopy = { \"publication.xml\",\n-            \"config/publication.xconf\", \"config/ac/ac.xconf\",\n-            \"config/ac/policies/\", \"config/ac/usecase-policies.xml\", \"config/workflow/workflow.xml\",\n+    protected static final String[] sourcesToCopy = { \n+            \"config/publication.xconf\",\n+            \"config/ac/ac.xconf\", \"config/ac/policies/\", \"config/ac/usecase-policies.xml\", \n+            \"config/workflow/workflow.xml\",\n             \"config/\" + org.apache.cocoon.components.search.components.impl.IndexManagerImpl.INDEX_CONF_FILE};\n \n-    /*\n-     * \"config/cocoon-xconf/index_manager_index.xconf\", \"config/cocoon-xconf/index_manager.xconf\",\n-     */\n-\n+    // the following stuff should actually come from PublicationConfiguration, but there's currently no way to get at it.\n+    // the correct solution suggested by andreas is not to meddle with config files here at all, but instead implement\n+    // appropriate setter functions in the Publication class. postponed to after 1.4.\n+    // thus, don't waste too much effort on this file, it's all an intermediate hack.\n+    private static final String CONFIGURATION_FILE = \"config/publication.xconf\";\n+    private static final String CONFIGURATION_NAMESPACE = \"http://apache.org/cocoon/lenya/publication/1.1\";\n+    private static final String ELEMENT_NAME = \"name\";\n+    private static final String ELEMENT_TEMPLATES = \"templates\";\n+    private static final String ELEMENT_TEMPLATE = \"template\";\n+    private static final String ATTRIBUTE_ID = \"id\";\n+    private static final String ELEMENT_RESOURCE_TYPES = \"resource-types\";//*\n+    private static final String ELEMENT_RESOURCE_TYPE = \"resource-type\";//*\n+    private static final String ELEMENT_MODULES = \"modules\";//*\n+    private static final String ELEMENT_MODULE = \"module\";//*\n+ \n     /**\n      * @see org.apache.lenya.cms.publication.templating.Instantiator#instantiate(org.apache.lenya.cms.publication.Publication,\n      *      java.lang.String, java.lang.String)\n@@ -117,12 +130,12 @@ protected void updateMetaData(SourceResolver resolver, String newPublicationId,\n         ModifiableSource metaSource = null;\n         try {\n             metaSource = (ModifiableSource) resolver.resolveURI(publicationsUri + \"/\"\n-                    + newPublicationId + \"/publication.xml\");\n+                    + newPublicationId + \"/\" + CONFIGURATION_FILE);\n             Document metaDoc = DocumentHelper.readDocument(metaSource.getInputStream());\n-            NamespaceHelper helper = new NamespaceHelper(\"http://apache.org/cocoon/lenya/publication/1.0\",\n-                    \"lenya\",\n+            NamespaceHelper helper = new NamespaceHelper(CONFIGURATION_NAMESPACE,\n+                    \"\",\n                     metaDoc);\n-            Element nameElement = helper.getFirstChild(metaDoc.getDocumentElement(), \"name\");\n+            Element nameElement = helper.getFirstChild(metaDoc.getDocumentElement(), ELEMENT_NAME);\n             DocumentHelper.setSimpleElementText(nameElement, name);\n \n             save(metaDoc, metaSource);\n@@ -142,12 +155,15 @@ protected void updateConfiguration(SourceResolver resolver, Publication template\n         try {\n \n             configSource = (ModifiableSource) resolver.resolveURI(publicationsUri + \"/\"\n-                    + newPublicationId + \"/config/publication.xconf\");\n-            DefaultConfiguration config = (DefaultConfiguration) new DefaultConfigurationBuilder().build(configSource.getInputStream());\n+                    + newPublicationId + \"/\" + CONFIGURATION_FILE);\n+\n+            final boolean ENABLE_XML_NAMESPACES = true;\n+            DefaultConfiguration config = \n+                    (DefaultConfiguration) new DefaultConfigurationBuilder(ENABLE_XML_NAMESPACES).build(configSource.getInputStream());\n             addTemplateConfiguration(template, config);\n             \n-            removeChildren(config, \"module\");\n-            removeChildren(config, \"resource-type\");\n+            removeChildren(config.getMutableChild(ELEMENT_MODULES), ELEMENT_MODULE);\n+            removeChildren(config.getMutableChild(ELEMENT_RESOURCE_TYPES), ELEMENT_RESOURCE_TYPE);\n             \n             OutputStream oStream = configSource.getOutputStream();\n             new DefaultConfigurationSerializer().serialize(oStream, config);\n@@ -171,25 +187,24 @@ protected void updateConfiguration(SourceResolver resolver, Publication template\n         }\n     }\n \n-    protected void addTemplateConfiguration(Publication template, DefaultConfiguration config) {\n-        DefaultConfiguration templatesConfig = (DefaultConfiguration) config.getChild(\"templates\",\n-                false);\n+    protected void addTemplateConfiguration(Publication template, DefaultConfiguration config) throws ConfigurationException {\n+        MutableConfiguration templatesConfig = config.getMutableChild(ELEMENT_TEMPLATES, false);\n         if (templatesConfig == null) {\n-            templatesConfig = new DefaultConfiguration(\"templates\");\n+            templatesConfig = new DefaultConfiguration(ELEMENT_TEMPLATES, null, CONFIGURATION_NAMESPACE, \"\");\n             config.addChild(templatesConfig);\n         } else {\n-            Configuration[] templateConfigs = templatesConfig.getChildren(\"template\");\n+            MutableConfiguration[] templateConfigs = templatesConfig.getMutableChildren(ELEMENT_TEMPLATE);\n             for (int i = 0; i < templateConfigs.length; i++) {\n                 templatesConfig.removeChild(templateConfigs[i]);\n             }\n         }\n-        DefaultConfiguration templateConfig = new DefaultConfiguration(\"template\");\n-        templateConfig.setAttribute(\"id\", template.getId());\n+        DefaultConfiguration templateConfig = new DefaultConfiguration(ELEMENT_TEMPLATE, null, CONFIGURATION_NAMESPACE, \"\");\n+        templateConfig.setAttribute(ATTRIBUTE_ID, template.getId());\n         templatesConfig.addChild(templateConfig);\n     }\n \n-    protected void removeChildren(DefaultConfiguration config, String name) {\n-        Configuration[] moduleConfigs = config.getChildren(name);\n+    protected void removeChildren(MutableConfiguration config, String name) throws ConfigurationException {\n+        MutableConfiguration[] moduleConfigs = config.getMutableChildren(name);\n         for (int i = 0; i < moduleConfigs.length; i++) {\n             config.removeChild(moduleConfigs[i]);\n         }", "filename": "src/pubs/default/java/src/org/apache/lenya/defaultpub/cms/publication/templating/Instantiator.java"}, {"additions": 0, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/default/publication.xml", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/default/publication.xml", "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391", "changes": 69, "status": "modified", "deletions": 69, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/pubs/default/publication.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -1,69 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<!--\n-  Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n--->\n-\n-<!-- $Id$ -->\n-\n-<lenya:publication xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.0\" lenya:show=\"true\">\n-  <lenya:name>Default Publication</lenya:name>\n-  <lenya:pub-version>@lenya.version@</lenya:pub-version>\n-  <lenya:lenya-version>@lenya.version@</lenya:lenya-version>\n-  <lenya:lenya-revision>@lenya.revision@</lenya:lenya-revision>\n-  <lenya:cocoon-version>2.1.8 or 2.1.9-dev</lenya:cocoon-version>\n-  <lenya:modules>\n-    <lenya:module>lucene</lenya:module>\n-    <lenya:module>homepage</lenya:module>\n-    <lenya:module>xhtml</lenya:module>\n-    <lenya:module>links</lenya:module>\n-    <lenya:module href=\"https://svn.apache.org/repos/asf/lenya/trunk/src/modules/opendocument\">opendocument</lenya:module>\n-    <lenya:module>cforms</lenya:module>\n-    <lenya:module>sitetree</lenya:module>\n-    <lenya:module>...</lenya:module>\n-  </lenya:modules>\n-  <lenya:description>This publication is a best practice, getting started publication.</lenya:description>\n-  <lenya:credits>Special thanks to </lenya:credits>\n-  <lenya:help></lenya:help>\n-  <lenya:changelog>changes.xml</lenya:changelog>\n-  <lenya:license></lenya:license>\n-  <lenya:readme>\n-    <ol>\n-      <li><a href=\"live/index.html\">Reader`s View</a> (Live)</li>\n-      <li><a href=\"authoring/index.html\">Editor`s View</a> (Authoring)</li>\n-    </ol>\n-\n-    <h4>Use WebDAV</h4>\n-    <ul>\n-      <li>Cadaver: cadaver http://127.0.0.1:8888/default/webdav</li>\n-      <li>More Info: <a href=\"http://wiki.apache.org/lenya/HowToEditWithWebDAV\">http://wiki.apache.org/lenya/HowToEditWithWebDAV</a></li>\n-    </ul>\n-\n-    <!--\n-    <h4>Enable JCR</h4>\n-    <ul>\n-      <li>Build Lenya and start it</li>\n-      <li>Import content from filesystem into JCR Repository by executing: <a href=\"../index.html?lenya.usecase=jcr.import\">../index.html?lenya.usecase=jcr.import</a>\n-      </li>\n-      <li>Stop Lenya</li>\n-      <li>Switch the NodeFactory within <i>build/lenya/webapp/WEB-INF/classes/org/apache/lenya/lenya.roles</i> to <i>org.apache.lenya.cms.jcr.JCRNodeFactory</i>\n-      </li>\n-      <li>Optional: The JCR implementation can be configured within local.build.properties resp. build.properties</li>\n-      <li>Start Lenya</li>\n-    </ul>\n-    -->\n-\n-  </lenya:readme>\n-</lenya:publication>", "filename": "src/pubs/default/publication.xml"}, {"additions": 51, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/default/readme.xml", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/pubs/default/readme.xml", "sha": "b89bf4aee9952898b6004a107e49ee9724c008ec", "changes": 51, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/pubs/default/readme.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -0,0 +1,51 @@\n+<?xml version=\"1.0\"?>\n+<!--\n+  Licensed to the Apache Software Foundation (ASF) under one or more\n+  contributor license agreements.  See the NOTICE file distributed with\n+  this work for additional information regarding copyright ownership.\n+  The ASF licenses this file to You under the Apache License, Version 2.0\n+  (the \"License\"); you may not use this file except in compliance with\n+  the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+-->\n+\n+<!-- $Id: introduction.xml 473861 2006-11-12 03:51:14Z gregor $ -->\n+\n+<page:page \n+  xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\n+  xmlns=\"http://www.w3.org/1999/xhtml\"\n+>\n+  <page:head/>\n+  <page:body>\n+    <h1>README: Default publication</h1>\n+    <h2>Use WebDAV:</h2>\n+    <ul>\n+      <li>Cadaver: cadaver http://127.0.0.1:8888/default/webdav</li>\n+      <li>More Info: <a href=\"http://wiki.apache.org/lenya/HowToEditWithWebDAV\">http://wiki.apache.org/lenya/HowToEditWithWebDAV</a></li>\n+    </ul>\n+<!--\n+    <h2>Enable JCR</h2>\n+    <ul>\n+      <li>Build Lenya and start it</li>\n+      <li>\n+        Import content from filesystem into JCR Repository by executing:\n+        <a href=\"../index.html?lenya.usecase=jcr.import\">../index.html?lenya.usecase=jcr.import</a>\n+      </li>\n+      <li>Stop Lenya</li>\n+      <li>\n+        Switch the NodeFactory within <i>build/lenya/webapp/WEB-INF/classes/org/apache/lenya/lenya.roles</i>\n+        to <i>org.apache.lenya.cms.jcr.JCRNodeFactory</i>\n+      </li>\n+      <li>Optional: The JCR implementation can be configured within local.build.properties resp. build.properties</li>\n+      <li>Start Lenya</li>\n+    </ul>\n+-->\n+  </page:body>\n+</page:page>", "filename": "src/pubs/default/readme.xml"}, {"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/resources/dev/eclipse/project", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/resources/dev/eclipse/project", "sha": "8612750ed1a277aa1de841f6aa0570da7ec083df", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/resources/dev/eclipse/project?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -1,6 +1,6 @@\n <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <projectDescription>\n-  <name>Lenya @VERSION@</name>\n+  <name>Lenya @VERSION@ pubconf</name>\n   <comment></comment>\n   <projects>\n     <project>@COCOON_PROJECT@</project>", "filename": "src/resources/dev/eclipse/project"}, {"additions": 2, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/targets/dist-build.xml", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/targets/dist-build.xml", "sha": "13ca2f98cf2004a4d7570da9507470e932326a36", "changes": 4, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/targets/dist-build.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -117,9 +117,9 @@\n   \t\n   \t<!-- Replace version placeholder with build version -->\n   \t<replace dir=\"${dist.src.dir}\">\n-  \t  <include name=\"**/introduction.xml\"/>\n+          <include name=\"**/welcome.xml\"/>\n   \t  <include name=\"**/about.xml\"/>\n-\t  <include name=\"**/publication.xml\"/>\n+\t  <include name=\"**/config/publication.xconf\"/>\n   \t  <replacefilter token=\"@lenya.version@\" value=\"${version}\"/>\n   \t  <replacefilter token=\"@lenya.revision@\" value=\"${lenya.revision}\"/>\n   \t</replace>", "filename": "src/targets/dist-build.xml"}, {"additions": 1, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/targets/test-build.xml", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/targets/test-build.xml", "sha": "af078b305bd0a993342a02efd7d022c222313a2b", "changes": 2, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/targets/test-build.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -73,7 +73,7 @@\n       </fileset>\n     </copy>\n     <replace encoding=\"utf-8\"\n-      file=\"${build.webapp}/lenya/pubs/${test.pub.id}/publication.xml\"\n+      file=\"${build.webapp}/lenya/pubs/${test.pub.id}/config/publication.xconf\"\n       token=\"Default Publication\" value=\"Test Publication\"/>\n   </target>\n   ", "filename": "src/targets/test-build.xml"}, {"additions": 2, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/targets/webapp-build.xml", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/targets/webapp-build.xml", "sha": "a99cae27199975c8cf9a87ed2adb57c35c4db737", "changes": 4, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/targets/webapp-build.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -194,9 +194,9 @@\n   \t\n     <!-- Replace version placeholder with build version -->\n     <replace dir=\"${build.webapp}\">\n-      <include name=\"lenya/content/introduction.xml\"/>\n+      <include name=\"lenya/content/welcome.xml\"/>\n       <include name=\"lenya/content/about.xml\"/>\n-      <include name=\"**/publication.xml\"/>\n+      <include name=\"**/config/publication.xconf\"/>\n       <replacefilter token=\"@lenya.version@\" value=\"${version}\"/>\n       <replacefilter token=\"@lenya.revision@\" value=\"${lenya.revision}\"/>\n     </replace>", "filename": "src/targets/webapp-build.xml"}, {"additions": 15, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/global-sitemap.xmap", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/global-sitemap.xmap", "sha": "a0965c60da79240358427e2bcbd6fe89fa5a380c", "changes": 31, "status": "modified", "deletions": 16, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/global-sitemap.xmap?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -89,9 +89,9 @@\n <!-- =========================== Pipelines ================================= -->\n \n     <map:pipeline>\n-      <map:match pattern=\"publications.xml\">\n+      <map:match pattern=\"aggregate-publications\">\n         <map:generate type=\"directory\" src=\"lenya/pubs\"/>\n-        <map:transform src=\"lenya/xslt/util/xinclude.xsl\"/>\n+        <map:transform src=\"lenya/xslt/util/aggregate-publications.xsl\"/>\n         <map:transform type=\"xinclude\"/>\n         <map:serialize type=\"xml\"/>\n       </map:match>\n@@ -210,8 +210,9 @@\n         <map:serialize type=\"xml\"/>\n       </map:match>\n       \n+    </map:pipeline>\n       <!-- menus -->\n-      \n+    <map:pipeline type=\"profile-noncaching\">  \n       <!-- menu-xml/modules -->\n       <!-- menu-xml/modules/{pub-id}/{area}.xml -->\n       <map:match pattern=\"menu-xml/modules/*/*.xml\">\n@@ -222,8 +223,9 @@\n         <map:transform type=\"xinclude\"/>\n         <map:serialize type=\"xml\"/>\n       </map:match>\n+    </map:pipeline>\n \n-\n+    <map:pipeline>\n       <!-- menu-xml/module/{area}/{module-id}.xml -->\n       <map:match pattern=\"menu-xml/module/*/*.xml\">\n         <map:select type=\"resource-exists\">\n@@ -307,9 +309,10 @@\n \n     <map:pipeline>\n       <map:match pattern=\"index.html\">\n-        <map:aggregate element=\"lenya\" ns=\"http://apache.org/cocoon/lenya/publication/1.0\" prefix=\"lenya\" label=\"aggregate\">\n-          <map:part src=\"cocoon:/publications.xml\"/>\n-          <map:part src=\"lenya/content/introduction.xml\"/>\n+        <map:aggregate element=\"aggregation-wrapper\" label=\"aggregate\">\n+          <map:part src=\"cocoon:/aggregate-publications\"/>\n+          <map:part src=\"lenya/content/welcome.xml\"/>\n+          <map:part src=\"readme.xml\"/>\n         </map:aggregate>\n         <map:transform src=\"lenya/xslt/util/welcome.xsl\"/>\n         <map:call resource=\"style-cms-page\"/>\n@@ -367,15 +370,11 @@\n \n       <!-- About Publication -->\n       <map:match pattern=\"*/introduction.html\">\n-        <map:generate src=\"lenya/pubs/{1}/publication.xml\" />\n-        <map:transform src=\"lenya/xslt/util/publication.xsl\"/>\n-        <map:call resource=\"style-cms-page\"/>\n-        <map:serialize />\n-      </map:match>\n-      <!-- Publication Tests-->\n-      <map:match pattern=\"*/tests.html\">\n-        <map:generate src=\"lenya/pubs/{1}/publication-tests.xml\" />\n-        <map:transform src=\"lenya/xslt/util/publication.xsl\"/>\n+        <map:aggregate element=\"aggregation-wrapper\">\n+          <map:part src=\"aggregate-fallback://readme.xml\"/>\n+          <map:part src=\"lenya/pubs/{1}/config/publication.xconf\"/>\n+        </map:aggregate>\n+        <map:transform src=\"lenya/xslt/util/introduction.xsl\"/>\n         <map:call resource=\"style-cms-page\"/>\n         <map:serialize />\n       </map:match>", "filename": "src/webapp/global-sitemap.xmap"}, {"additions": 24, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/content/about.xml", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/content/about.xml", "sha": "d9f8ef177b4c266a14b57b011bb2137c6622ee47", "changes": 46, "status": "modified", "deletions": 22, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/content/about.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -18,25 +18,27 @@\n \n <!-- $Id$ -->\n \n-<page:page  \n-   xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\">\n-\n-<page:title>Apache Lenya @lenya.version@ (Revision: @lenya.revision@)</page:title>\n-<page:body>\n-<div class=\"lenya-box\">\n-<p>\n-This software consists of voluntary contributions made by many individuals\n-on behalf of the <br /><a href=\"http://www.apache.org/\">Apache Software Foundation</a> \n-and was originally created by <a href=\"mailto:michi@apache.org\">Michael Wechner</a>.\n-<br /><br />\n-Apache Lenya includes software developed by the <a href=\"http://www.apache.org/\">Apache Software Foundation</a>, \n-<a href=\"http://w3c.org\">W3C</a>, <br /> and <a href=\"http://sf.net/projects/websphinx\">WebSPHINX</a>.\n-<br /><br /> \n-Copyright (C) 2006 The Apache Software Foundation. All rights reserved.\n-</p>\n-<form id=\"form-about-back\">\n-<input type=\"button\" value=\"Back\" onClick=\"history.go(-1)\" name=\"input-back\"/>\n-</form>\t\t\n-</div>\n-      </page:body>\n-    </page:page>\n+<page:page xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\">\n+  <page:title>Apache Lenya @lenya.version@ (Revision: @lenya.revision@)</page:title>\n+  <page:body>\n+    <div class=\"lenya-box\">\n+      <p>\n+        This software consists of voluntary contributions made by many individuals\n+        on behalf of the <br /><a href=\"http://www.apache.org/\">Apache Software Foundation</a> \n+        and was originally created by <a href=\"mailto:michi@apache.org\">Michael Wechner</a>.\n+      </p>\n+      <p>\n+        Apache Lenya includes software developed by the \n+        <a href=\"http://www.apache.org/\">Apache Software Foundation</a>, \n+        <a href=\"http://w3c.org\">W3C</a>, and \n+        <a href=\"http://sf.net/projects/websphinx\">WebSPHINX</a>.\n+      </p>\n+      <p>\n+        Copyright (C) 2006 The Apache Software Foundation. All rights reserved.\n+      </p>\n+      <form id=\"form-about-back\">\n+        <input type=\"button\" value=\"Back\" onClick=\"history.go(-1)\" name=\"input-back\"/>\n+      </form>\t\t\n+    </div>\n+  </page:body>\n+</page:page>", "filename": "src/webapp/lenya/content/about.xml"}, {"additions": 57, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/content/introduction.xml", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/content/introduction.xml", "sha": "cf333b51f0192b3b8134b0ba79cf439fc4565489", "changes": 80, "status": "modified", "deletions": 23, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/content/introduction.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -18,26 +18,60 @@\n \n <!-- $Id$ -->\n \n-<div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lenya-frontpage\">\n-<h2>Welcome to Apache Lenya</h2>\n-<p>\n-You have successfully installed Apache Lenya <strong>@lenya.version@</strong> (Revision: @lenya.revision@). To start, click on any of the publications on the left.</p>\n-\n-<h3>About Apache Lenya</h3>\n-<p>\n-<a href=\"http://lenya.apache.org\">Apache Lenya</a> is a Java-based <a href=\"http://www.opensource.org\">Open-Source</a>\n-Content Management System. It\n-is based on open standards such as <a href=\"http://www.w3c.org/XML/\">XML</a> and <a href=\"http://www.w3c.org/TR/xslt\">XSLT</a>. One of its core\n-components is <a href=\"http://cocoon.apache.org\">Cocoon</a> from the\n-<a href=\"http://www.apache.org\">Apache Software Foundation</a>.\n-</p>\n-\t\t\n-<p>\n-Lenya supports inline WYSIWYG editors such as <a href=\"http://kupu.oscom.org\">Kupu</a> or <a href=\"http://bxe.oscom.org\">BXE</a>. Your site editors do\n-not have to learn XML. This is possible thanks to the support\n-of XML, XSLT and XML Schema on the client side.\n-An administration interface allows advanced users to\n-monitor the CMS, and perform configuration tasks.\n-</p>\n-\t\t\n-</div>\n+<page:page xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\">\n+  <page:title>Apache Lenya @lenya.version@ (Revision:@lenya.revision@)</page:title>\n+  <page:body>\n+  \n+    <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"lenya-frontpage\">\n+    \n+      <h2>Welcome to Apache Lenya</h2>\n+      <p>\n+        You have successfully installed Apache Lenya \n+        <strong>@lenya.version@</strong> (Revision: @lenya.revision@).\n+        To start, click on any of the publications on the left, or create\n+        a new publication.\n+      </p>\n+    \n+      <h3>About</h3>\n+      <p>\n+        <a href=\"http://lenya.apache.org\">Apache Lenya</a> is a Java-based\n+        <a href=\"http://www.opensource.org\">open-source</a> Content Management \n+        System. It is based on open standards such as \n+        <a href=\"http://www.w3c.org/XML/\">XML</a> and \n+        <a href=\"http://www.w3c.org/TR/xslt\">XSLT</a>. It is based on\n+        <a href=\"http://cocoon.apache.org\">Apache Cocoon</a>.\n+      </p>\n+      <p>\n+        Lenya is a community project and is being developed under the aegis of the \n+        <a href=\"http://www.apache.org/\">Apache Software Foundation (ASF)</a>. The\n+        project was donated to the ASF by Michael Wechner of <a\n+        href=\"http://wyona.com\">Wyona AG</a> and accepted as a top-level ASF\n+        project in 2004. You are welcome to join our mailing lists and contribute!\n+      </p>\n+      \n+      <h3>Features</h3>\n+      <ul>\n+        <li>supports multi-lingual websites</li>\n+        <li>\n+          includes several client-side content editors, many of them\n+          WYSIWYG\n+        </li>\n+        <li>allows for complex workflows (edit/submit/review/publish)</li>\n+        <li>\n+          allows for arbitrary output, does not impose standard layouts or \n+          techniques (such as HTML tables) on the user\n+        </li>\n+        <li>\n+          provides revision control, old page versions can be viewed and restored\n+          if necessary\n+        </li>\n+        <li>\n+          powerful XML processing capabilities thanks to the underlying Cocoon\n+          engine\n+        </li>\n+        <li>...</li>\n+      </ul>\n+    </div>\n+  \n+  </page:body>\n+</page:page>", "filename": "src/webapp/lenya/content/introduction.xml"}, {"additions": 77, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/content/welcome.xml", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/content/welcome.xml", "sha": "8c5c8d0f065d745c8940e5639eb835e0e27a97de", "changes": 77, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/content/welcome.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -0,0 +1,77 @@\n+<?xml version=\"1.0\"?>\n+<!--\n+  Licensed to the Apache Software Foundation (ASF) under one or more\n+  contributor license agreements.  See the NOTICE file distributed with\n+  this work for additional information regarding copyright ownership.\n+  The ASF licenses this file to You under the Apache License, Version 2.0\n+  (the \"License\"); you may not use this file except in compliance with\n+  the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+-->\n+\n+<!-- $Id: introduction.xml 473861 2006-11-12 03:51:14Z gregor $ -->\n+\n+<page:page \n+  xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\n+  xmlns=\"http://www.w3.org/1999/xhtml\"\n+>\n+  <page:title>Apache Lenya @lenya.version@ (Revision:@lenya.revision@)</page:title>\n+  <page:body>\n+  \n+    <h1>Welcome to Apache Lenya</h1>\n+    <p>\n+      You have successfully installed Apache Lenya \n+      <strong>@lenya.version@</strong> (Revision: @lenya.revision@).\n+      To start, click on any of the publications on the left, or create\n+      a new publication.\n+    </p>\n+  \n+    <h2>About</h2>\n+    <p>\n+      <a href=\"http://lenya.apache.org\">Apache Lenya</a> is a Java-based\n+      <a href=\"http://www.opensource.org\">open-source</a> Content Management \n+      System. It is based on open standards such as \n+      <a href=\"http://www.w3c.org/XML/\">XML</a> and \n+      <a href=\"http://www.w3c.org/TR/xslt\">XSLT</a>. It is based on\n+      <a href=\"http://cocoon.apache.org\">Apache Cocoon</a>.\n+    </p>\n+    <p>\n+      Lenya is a community project and is being developed under the aegis of the \n+      <a href=\"http://www.apache.org/\">Apache Software Foundation (ASF)</a>. The\n+      project was donated to the ASF by Michael Wechner of <a\n+      href=\"http://wyona.com\">Wyona AG</a> and accepted as a top-level ASF\n+      project in 2004. You are welcome to join our mailing lists and contribute!\n+    </p>\n+    \n+    <h2>Features</h2>\n+    <ul>\n+      <li>supports multi-lingual websites</li>\n+      <li>\n+        includes several client-side content editors, many of them\n+        WYSIWYG\n+      </li>\n+      <li>allows for complex workflows (edit/submit/review/publish)</li>\n+      <li>\n+        allows for arbitrary output, does not impose standard layouts or \n+        techniques (such as HTML tables) on the user\n+      </li>\n+      <li>\n+        provides revision control, old page versions can be viewed and restored\n+        if necessary\n+      </li>\n+      <li>\n+        powerful XML processing capabilities thanks to the underlying Cocoon\n+        engine\n+      </li>\n+      <li>...</li>\n+    </ul>\n+  \n+  </page:body>\n+</page:page>", "filename": "src/webapp/lenya/content/welcome.xml"}, {"additions": 7, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/css/default.css", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/css/default.css", "sha": "4465d70f857753b8fa482ca67baf81cea8c01433", "changes": 9, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/resources/css/default.css?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -20,20 +20,25 @@\n @import url(menu.css);\n @import url(tabs.css);\n @import url(boxes.css);\n-\n+  \n body {\n     margin: 0px;\n     padding: 0px;\n     font-family: Verdana, sans-serif;\n }\n \n h1 {\n-    font-family: Verdana, sans-serif;\n     font-size: 150%;\n     padding: 0px;\n     margin: 0px;\n }\n \n+h2 { font-size: 120%; }\n+h3 { font-size: 110%; }\n+h4 { font-size: 100%; }\n+h5 { font-size: 90%; }\n+h6 { font-size: 80%; }\n+\n p {\n     font-size: small;\n }", "filename": "src/webapp/lenya/resources/css/default.css"}, {"additions": 14, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/css/tables.css", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/css/tables.css", "sha": "3234e6afc277eb345f2ab205a23de9d76f65a9d1", "changes": 17, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/resources/css/tables.css?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -28,29 +28,35 @@ table.lenya-table-noborder {\n }\n \n table.lenya-table th {\n-    background-color: #DDDCCF;\n+  background-color: #DDDCCF;\n \tborder: solid 1px #CCCCCC;\n \tcolor: Black;\n \tfont-weight: bold;\n \tpadding: 3px 10px;\n \ttext-align: left;\n+\tvertical-align: top;\n \tfont-size: small;\n }\n \n table.lenya-table td {\n-    background-color: #F5F4E9;\n+  background-color: #F5F4E9;\n \tborder: solid 1px #CCCCCC;\n \tpadding: 3px 10px;\n \tfont-size: small;\n \tcolor: Black;\n }\n \n-table.lenya-table-noborder td {\n+table.lenya-table-noborder td, table.lenya-table-noborder th {\n \tborder: 0px;\n \tpadding: 3px 10px;\n \tfont-size: small;\n }\n \n+table.lenya-table-noborder th {\n+  vertical-align: top;\n+  text-align: left;\n+}\n+\n table.lenya-table-noborder-nopadding td {\n \tborder: 0px;\n \tpadding: 0px;\n@@ -72,6 +78,7 @@ table.lenya-table-list td,\n table.lenya-table-list-noborder th,\n table.lenya-table-list-noborder td {\n   text-align: left;\n+  vertical-align: top;\n   padding: 2px 2em 2px 5px;\n   border-bottom: solid 1px #CCCCCC;\n \tfont-size: small;\n@@ -106,6 +113,10 @@ table.lenya-table-list-noborder td {\n   border-bottom: none;\n }\n \n+table.lenya-table-list-noborder td.border {\n+  border-bottom: solid 1px #CCCCCC;\n+}\n+\n table.lenya-table-list-noborder th,\n table.lenya-table-list-noborder td {\n   padding-left: 0px;", "filename": "src/webapp/lenya/resources/css/tables.css"}, {"additions": 14, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/i18n/cmsui_de.xml", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/i18n/cmsui_de.xml", "sha": "0ac73bdc423416876f2791fb1d6125c9195c9a48", "changes": 16, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/resources/i18n/cmsui_de.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -379,8 +379,19 @@\n   <message key=\"lenya.rc.checkedoutalready\">Die Ressource wurde bereits von jemand anders ausgecheckt.</message>\n   <message key=\"lenya.rc.nocheckin\">Resource konnte nicht eingecheckt werden</message>\n   <message key=\"Generic Exception\">Allgemeiner Fehler</message>\n-  <message key=\"Check the log files.\">\u00dc\tberpr\u00fcfen Sie die Logdatei.</message>\n-\n+  <message key=\"Check the log files.\">\u00dcberpr\u00fcfen Sie die Logdatei.</message>\n+  \n+  <!-- Publication introduction page -->\n+  <message key=\"Publication properties\">Eigenschaften der Publikation</message>\n+  <message key=\"Available languages\">Verf\u00fcgbare Sprachen</message>\n+  <message key=\"Available resource types\">Verf\u00fcgbare Ressource-Typen</message>\n+  <message key=\"Required Lenya version\">Ben\u00f6tigte Lenya-Version</message>\n+  <message key=\"Required Lenya revision\">Ben\u00f6tigte Lenya-Revision</message>\n+  <message key=\"Required Cocoon version\">Ben\u00f6tigte Cocoon-Version</message>\n+  <message key=\"Modules used\">Verwendete Module</message>\n+  <message key=\"Templates used\">Verwendete Templates</message>\n+  <message key=\"Inherited: see template publication\">Vererbt: Siehe Template-Publikation</message>\n+  \n   <!-- Error messages of a general nature -->\n   <message key=\"error-document-form\">Dokument ist nicht wohlgeformt: {0}</message>\n   <message key=\"error-validation\">Schema Validierung schlug fehl: {0}</message>\n@@ -389,5 +400,6 @@\n   <message key=\"error-document-existance\">Das angeforderte Dokument {0} existiert nicht.</message>\n   <message key=\"error-generic\">Ein Fehler ist aufgetreten.</message>\n   <message key=\"error-404\">404: Seite nicht gefunden</message>\n+  \n </catalogue>\n ", "filename": "src/webapp/lenya/resources/i18n/cmsui_de.xml"}, {"additions": 7, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/i18n/modules2xinclude.xsl", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/i18n/modules2xinclude.xsl", "sha": "a5846365c27558edd25a3fa14a0ce33d76ac10e4", "changes": 16, "status": "modified", "deletions": 9, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/resources/i18n/modules2xinclude.xsl?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -21,27 +21,25 @@\n <xsl:stylesheet version=\"1.0\"\r\n   xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n   xmlns:xi=\"http://www.w3.org/2001/XInclude\"\r\n-  xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.0\"\r\n+  xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.1\"\r\n   >\r\n-  \r\n+\r\n   <xsl:param name=\"pubId\"/>\r\n   <xsl:param name=\"catalogue\"/>\r\n \r\n \r\n   <xsl:template match=\"catalogue\">\r\n     <xsl:copy>\r\n       <xsl:copy-of select=\"@*|node()\"/>\r\n-      <xsl:apply-templates select=\"document('aggregate-fallback://config/publication.xconf')/publication/module\"/>\r\n+      <xsl:apply-templates select=\"document('aggregate-fallback://config/publication.xconf')/*/lenya:modules/lenya:module\"/>\r\n     </xsl:copy>\r\n-  </xsl:template>  \r\n-  \r\n-  \r\n-  <xsl:template match=\"module\">\r\n+  </xsl:template>\r\n+\r\n+  <xsl:template match=\"lenya:module\">\r\n     <xsl:if test=\"not(preceding-sibling::module[@name = current()/@name])\">\r\n       <xi:include href=\"cocoon:/i18n-catalogue/module/{@name}/{$catalogue}\"\r\n         xpointer=\"xpointer(/catalogue/message)\"/>\r\n     </xsl:if>\r\n   </xsl:template>\r\n-  \r\n-  \r\n+\r\n </xsl:stylesheet>\r", "filename": "src/webapp/lenya/resources/i18n/modules2xinclude.xsl"}, {"additions": 204, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/schemas/publication.rng", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/resources/schemas/publication.rng", "sha": "e24bad0b95d55c07c24f5d5497b225a7a4104ba8", "changes": 204, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/resources/schemas/publication.rng?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -0,0 +1,204 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<!--\n+  Licensed to the Apache Software Foundation (ASF) under one or more\n+  contributor license agreements.  See the NOTICE file distributed with\n+  this work for additional information regarding copyright ownership.\n+  The ASF licenses this file to You under the Apache License, Version 2.0\n+  (the \"License\"); you may not use this file except in compliance with\n+  the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+-->\n+\n+<!-- \n+  This RELAX NG grammar defines the configuration file of a. Lenya publication.\n+  Configuration files must be located under \"$YOURPUBROOT/$PUBNAME/config/publication.xconf\".\n+  \n+  This schema is new as of 2007-02-23. It is NOT backwards-compatible. It combines the\n+  contents of $YOURPUBROOT/$PUBNAME/publication.xml and $YOURPUBROOT/$PUBNAME/config/publication.xconf.\n+  \n+  The publication.xconf file is parsed by:\n+  \n+  * src/impl/java/org/apache/lenya/cms/publication/PublicationConfiguration.java\n+  * src/java/org/apache/lenya/cms/publication/templating/ExistingUsecaseResolver.java\n+  * src/modules/repository/java/src/org/apache/lenya/cms/migration/Migrate14.java (?)\n+  * src/webapp/lenya/xslt/util/aggregate-publications.xsl\n+  * webapp/lenya/resources/i18n/modules2xinclude.xsl\n+  * webapp/global-sitemap.xmap\n+  \n+  Please keep the implementations and this grammar in sync!\n+-->\n+\n+<grammar \n+  xmlns=\"http://relaxng.org/ns/structure/1.0\"\n+  datatypeLibrary=\"http://www.w3.org/2001/XMLSchema-datatypes\"\n+>\n+\n+  <!-- some convenience data types used in this grammar: -->\n+  \n+  <define name=\"booleanString\">\n+    <choice>\n+      <value>true</value>\n+      <value>false</value>\n+    </choice>\n+  </define>\n+  \n+  <define name=\"fileURL\">\n+    <!-- regex anyone? -->\n+    <data type=\"string\"/>\n+  </define>\n+  \n+  <define name=\"isoLanguage\">\n+    <data type=\"string\">\n+      <param name=\"pattern\">[a-zA-Z]{2}</param>\n+    </data>\n+  </define>\n+  \n+  <define name=\"lenyaAreaName\">\n+    <choice>\n+      <value>live</value>\n+      <value>authoring</value>\n+    </choice>\n+  </define>\n+  \n+  <define name=\"javaClassName\">\n+    <data type=\"string\">\n+      <!-- too lenient, needs tightening -->\n+      <param name=\"pattern\">([\\-_a-zA-Z0-9]+\\.)+[\\-_a-zA-Z0-9]+</param>\n+    </data>\n+  </define>\n+  \n+  <define name=\"moduleName\">\n+    <ref name=\"simpleNameToken\"/>\n+  </define>\n+\n+  <define name=\"resourceTypeName\">\n+    <ref name=\"simpleNameToken\"/>\n+  </define>\n+  \n+  <define name=\"revisionString\">\n+    <data type=\"string\">\n+    </data>\n+  </define>\n+  \n+  <define name=\"simpleNameToken\">\n+    <data type=\"string\">\n+      <param name=\"pattern\">[a-z]+</param>\n+    </data>\n+  </define>\n+  \n+  <define name=\"versionString\">\n+    <data type=\"string\">\n+      <param name=\"pattern\">(@lenya.version@)|(([0-9]+\\.)+[0-9]+(-[\\-_a-zA-Z0-9]+)?)</param>\n+    </data>\n+  </define>\n+  \n+  <define name=\"workflowUri\">\n+    <data type=\"anyURI\"/>\n+  </define>\n+  \n+  <define name=\"XPathExpression\">\n+    <!-- regex anyone? -->\n+    <data type=\"string\"/>\n+  </define>\n+  \n+<!-- here comes the important part -->\n+\n+<start>\n+\n+<element name=\"publication\"\n+  ns=\"http://apache.org/cocoon/lenya/publication/1.1\"\n+>\n+  <optional> \n+    <attribute name=\"show\"><ref name=\"booleanString\"/></attribute>\n+  </optional>\n+  <interleave>\n+    <element name=\"name\"><data type=\"string\"/></element>\n+    <optional>\n+      <element name=\"description\"><data type=\"string\"/></element>\n+    </optional>\n+    <optional>\n+      <element name=\"version\"><ref name=\"versionString\"/></element>\n+    </optional>\n+    <optional>\n+      <element name=\"lenya-version\"><ref name=\"versionString\"/></element>\n+    </optional>\n+    <optional>\n+      <element name=\"lenya-revision\"><ref name=\"revisionString\"/></element>\n+    </optional>\n+    <optional>\n+      <element name=\"cocoon-version\"><ref name=\"versionString\"/></element>\n+    </optional>\n+    <element name=\"languages\">\n+      <oneOrMore>\n+        <element name=\"language\">\n+          <optional>\n+            <attribute name=\"default\">\n+              <ref name=\"booleanString\"/>\n+            </attribute>\n+          </optional>\n+          <ref name=\"isoLanguage\"/>\n+        </element>\n+      </oneOrMore>\n+    </element>\n+    <optional>\n+      <element name=\"template\">\n+        <attribute name=\"id\">\n+          <ref name=\"simpleNameToken\"/>\n+        </attribute>\n+      </element>\n+    </optional>\n+    <!-- FIXME: is template-instantiator optional?-->\n+    <element name=\"template-instantiator\"><attribute name=\"name\"><data type=\"string\"/></attribute></element>\n+    <element name=\"path-mapper\">\n+      <ref name=\"javaClassName\"/>\n+    </element>\n+    <element name=\"document-builder\"><attribute name=\"name\"><data type=\"string\"/></attribute></element>\n+    <element name=\"site-manager\"><attribute name=\"name\"><data type=\"string\"/></attribute></element>\n+    <element name=\"resource-types\">\n+       <oneOrMore>\n+        <element name=\"resource-type\">\n+          <attribute name=\"name\"><ref name=\"resourceTypeName\"/></attribute>\n+          <attribute name=\"workflow\"><ref name=\"workflowUri\"/></attribute>\n+        </element>\n+      </oneOrMore>\n+    </element>\n+    <element name=\"modules\">\n+       <oneOrMore>\n+        <element name=\"module\">\n+          <attribute name=\"name\"><ref name=\"moduleName\"/></attribute>\n+        </element>\n+      </oneOrMore>\n+    </element>\n+    <element name=\"breadcrumb-prefix\"><data type=\"string\"/></element>\n+    <optional>\n+      <element name=\"content-dir\">\n+        <attribute name=\"src\">\n+          <ref name=\"fileURL\"/>\n+        </attribute>\n+      </element>\n+    </optional>\n+    <optional>\n+      <element name=\"proxies\">\n+        <oneOrMore>\n+          <element name=\"proxy\">\n+            <attribute name=\"area\"><ref name=\"lenyaAreaName\"/></attribute>\n+            <attribute name=\"ssl\"><ref name=\"booleanString\"/></attribute>\n+            <attribute name=\"url\"><data type=\"anyURI\"/></attribute>\n+          </element>\n+        </oneOrMore>\n+      </element>\n+    </optional>\n+  </interleave>\n+  \n+</element>\n+\n+</start>\n+\n+</grammar>", "filename": "src/webapp/lenya/resources/schemas/publication.rng"}, {"additions": 9, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/xslt/modules/modules2xinclude.xsl", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/xslt/modules/modules2xinclude.xsl", "sha": "450403605b734759f9d8515d44369e9f577e3567", "changes": 19, "status": "modified", "deletions": 10, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/xslt/modules/modules2xinclude.xsl?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -19,25 +19,24 @@\n <!-- $Id: xinclude.xsl 123414 2004-12-27 14:52:24Z gregor $ -->\r\n \r\n <xsl:stylesheet version=\"1.0\"\r\n-    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n-    xmlns:xi=\"http://www.w3.org/2001/XInclude\"\r\n-    xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.0\"\r\n-    xmlns:dir=\"http://apache.org/cocoon/directory/2.0\"\r\n+    xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.1\"\n     xmlns:menu=\"http://apache.org/cocoon/lenya/menubar/1.0\"\r\n-    >\r\n+    xmlns:xi=\"http://www.w3.org/2001/XInclude\"\r\n+    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n+>\r\n \r\n   <xsl:param name=\"area\"/>\r\n \r\n-  <xsl:template match=\"publication\">\n+  <xsl:template match=\"lenya:publication\">\n     <menu:menu>\n-      <xsl:apply-templates select=\"module\"/>\n+      <xsl:apply-templates select=\"lenya:modules/lenya:module\"/>\n     </menu:menu>\n   </xsl:template>\r\n \r\n-  <xsl:template match=\"module\">\n-    <xsl:if test=\"not(preceding-sibling::module[@name = current()/@name])\">\n+  <xsl:template match=\"lenya:module\">\n+    <xsl:if test=\"not(preceding-sibling::lenya:module[@name = current()/@name])\">\n       <xi:include href=\"cocoon:/menu-xml/module/{$area}/{@name}.xml\" xpointer=\"xpointer(/*/*)\"/>\r\n-    </xsl:if>\n+    </xsl:if>\r\n   </xsl:template>\r\n \r\n </xsl:stylesheet>\r", "filename": "src/webapp/lenya/xslt/modules/modules2xinclude.xsl"}, {"additions": 14, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/xslt/util/aggregate-publications.xsl", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/xslt/util/aggregate-publications.xsl", "previous_filename": "src/webapp/lenya/xslt/util/xinclude.xsl", "sha": "ddded3c1d2cfae6dc5f79f9408c3d5c65a3c3656", "changes": 24, "status": "renamed", "deletions": 10, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/xslt/util/aggregate-publications.xsl?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -16,30 +16,34 @@\n   limitations under the License.\n -->\n \n-<!-- $Id$ -->\n+<!-- $Id: xinclude.xsl 473861 2006-11-12 03:51:14Z gregor $ -->\n \n <xsl:stylesheet version=\"1.0\"\n     xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\n     xmlns:xi=\"http://www.w3.org/2001/XInclude\"\n-    xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.0\"\n+    xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.1\"\n     xmlns:dir=\"http://apache.org/cocoon/directory/2.0\"\n     >\n \n <xsl:template match=\"/\">\n   <xsl:apply-templates select=\"dir:directory\"/>\n </xsl:template>                                                                                                                             \n-<xsl:template match=\"dir:directory\" >\n-<lenya:publications>\n-  <xsl:for-each select=\"dir:directory\">\n-    <lenya:publication pid=\"{@name}\">\n-        <xi:include href=\"lenya/pubs/{@name}/publication.xml\">\n+\n+<xsl:template match=\"dir:directory\">\n+  <lenya:publications>\n+    <xsl:for-each select=\"dir:directory\">\n+      <lenya:publication dirname=\"{@name}\">\n+        <xi:include \n+          href=\"lenya/pubs/{@name}/config/publication.xconf\"\n+          xpointer=\"xpointer(/*/*)\"\n+        >\n           <xi:fallback>\n             <lenya:name name=\"{@name}\"/>\n           </xi:fallback>\n         </xi:include>\n-    </lenya:publication>\n-  </xsl:for-each>\n-</lenya:publications>\n+      </lenya:publication>\n+    </xsl:for-each>\n+  </lenya:publications>\n </xsl:template>\n \n </xsl:stylesheet>", "filename": "src/webapp/lenya/xslt/util/aggregate-publications.xsl"}, {"additions": 191, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/xslt/util/introduction.xsl", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/xslt/util/introduction.xsl", "sha": "da71ba3748e9ad4c52136e1c3fb8d82889d27cfd", "changes": 191, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/xslt/util/introduction.xsl?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -0,0 +1,191 @@\n+<?xml version=\"1.0\"?>\n+<!--\n+  Licensed to the Apache Software Foundation (ASF) under one or more\n+  contributor license agreements.  See the NOTICE file distributed with\n+  this work for additional information regarding copyright ownership.\n+  The ASF licenses this file to You under the Apache License, Version 2.0\n+  (the \"License\"); you may not use this file except in compliance with\n+  the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+-->\n+\n+<!-- $Id: publication.xsl 473861 2006-11-12 03:51:14Z gregor $ -->\n+\n+<xsl:stylesheet\n+    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" version=\"1.0\"\n+    xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.1\"\n+    xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\n+    xmlns:xhtml=\"http://www.w3.org/1999/xhtml\"\n+    xmlns:i18n=\"http://apache.org/cocoon/i18n/2.1\"\n+    xmlns=\"http://www.w3.org/1999/xhtml\"\n+>\n+\n+\n+<xsl:key name=\"workflows\" match=\"lenya:resource-type\" use=\"@workflow\"/>   \n+\n+<xsl:template match=\"/*\">\n+<page:page>\n+  <page:title>Apache Lenya - <xsl:value-of select=\"lenya:publication/lenya:name\"/></page:title>\n+  <page:head/>\n+  <page:body>\n+    <div class=\"lenya-sidebar\">\n+      <div class=\"lenya-sidebar-heading\">This&#160;Publication</div>\n+      <ul>\n+        <li><a href=\"authoring/\">Login&#160;as&#160;Editor</a></li>\n+        <li><a href=\"live/\">Live&#160;View</a></li>\n+      </ul>\n+      <div class=\"lenya-publication-item\"><a href=\"../index.html\">Other&#160;Publications</a></div>\n+      <div class=\"lenya-publication-item\"><a href=\"http://lenya.apache.org/docs/index.html\">Documentation</a></div>\n+      <div class=\"lenya-publication-item\"><a href=\"http://wiki.apache.org/lenya\">Wiki</a></div>\n+    </div>\n+\n+    <div class=\"lenya-frontpage\">\n+      <h2><i18n:text>Publication properties</i18n:text>:</h2>\n+      <xsl:apply-templates select=\"lenya:publication\"/>\n+      <xsl:apply-templates select=\"page:page\"/>\n+      \n+    </div>\n+  </page:body>\n+</page:page>\n+</xsl:template>\n+\n+<xsl:template match=\"lenya:publication\">\n+  <table class=\"lenya-table-list-noborder\">\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Name</i18n:text></th>\n+      <td class=\"border\"><xsl:value-of select=\"lenya:name\"/></td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Revision</i18n:text></th>\n+      <td class=\"border\"><xsl:value-of select=\"lenya:version\"/></td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Description</i18n:text></th>\n+      <td class=\"border\"><xsl:value-of select=\"lenya:description\"/></td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Available languages</i18n:text></th>\n+      <td class=\"border\">\n+        <xsl:for-each select=\"lenya:languages/lenya:language\">\n+          <xsl:choose>\n+            <xsl:when test=\"@default\">\n+              <strong><xsl:value-of select=\".\"/></strong>\n+            </xsl:when>\n+            <xsl:otherwise>\n+              <xsl:value-of select=\".\"/>\n+            </xsl:otherwise>\n+          </xsl:choose>\n+          <xsl:if test=\"position() != last()\">\n+            <xsl:text>, </xsl:text>\n+          </xsl:if>\n+        </xsl:for-each>\n+      </td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Available resource types</i18n:text></th>\n+      <td class=\"border\">\n+        <xsl:if test=\"lenya:templates/lenya:template\">\n+          <i18n:text>Inherited: see template publication</i18n:text><br/>\n+        </xsl:if>\n+        <xsl:for-each \n+          select=\"lenya:resource-types/lenya:resource-type[generate-id(.)=generate-id(key('workflows', @workflow)[1])]\"\n+        >\n+          <xsl:sort select=\"@workflow\"/>\n+          <xsl:for-each select=\"key('workflows', @workflow)\">\n+            <xsl:sort select=\"@name\"/>\n+            <xsl:value-of select=\"@name\"/>\n+            <xsl:if test=\"position() != last()\">\n+              <xsl:text>, </xsl:text>\n+            </xsl:if>\n+          </xsl:for-each>\n+          <xsl:text> (Workflow: </xsl:text>\n+          <xsl:value-of select=\"@workflow\"/>\n+          <xsl:text>)</xsl:text>\n+          <xsl:if test=\"position() != last()\">\n+            <xsl:text>;</xsl:text><br />\n+          </xsl:if>\n+        </xsl:for-each>\n+      </td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Required Lenya version</i18n:text></th>\n+      <td class=\"border\"><xsl:value-of select=\"lenya:lenya-version\"/></td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Required Lenya revision</i18n:text></th>\n+      <td class=\"border\"><xsl:value-of select=\"lenya:lenya-revision\"/></td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Required Cocoon version</i18n:text></th>\n+      <td class=\"border\"><xsl:value-of select=\"lenya:cocoon-version\"/></td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Modules used</i18n:text></th>\n+      <td class=\"border\">\n+        <xsl:if test=\"lenya:templates/lenya:template\">\n+          <i18n:text>Inherited: see template publication</i18n:text><br/>\n+        </xsl:if>\n+        <xsl:for-each select=\"lenya:modules/lenya:module\">\n+          <xsl:value-of select=\"@name\"/>\n+          <xsl:if test=\"position() != last()\">\n+            <xsl:text>, </xsl:text>\n+          </xsl:if>\n+        </xsl:for-each>\n+      </td>\n+    </tr>\n+    <tr>\n+      <th style=\"white-space: nowrap;\"><i18n:text>Template used</i18n:text></th>\n+      <td class=\"border\">\n+        <xsl:choose>\n+          <xsl:when test=\"lenya:template\">\n+            <a href=\"../{lenya:template/@id}/introduction.html\">\n+              <xsl:value-of select=\"lenya:template/@id\"/>\n+            </a>\n+          </xsl:when>\n+          <xsl:otherwise>\n+            <i18n:text>none</i18n:text>\n+          </xsl:otherwise>\n+        </xsl:choose>\n+      </td>\n+    </tr>\n+  </table>\n+</xsl:template>\n+\n+<xsl:template match=\"page:page\">\n+<!-- FIXME: aggregate-fallback seems to return the last document twice.\n+     The position predicate is just a quick workaround and needs to be fixed! -->\n+  <xsl:for-each select=\"page:body[position() &lt; last()]\">\n+    <xsl:apply-templates select=\"*\"/>\n+  </xsl:for-each>\n+</xsl:template>\n+\n+<!-- we are aggretating into a new context: \n+     (another good reason to move to xhtml2) -->\n+<xsl:template match=\"xhtml:h1\">\n+  <h2><xsl:apply-templates select=\"@*|node()\"/></h2>\n+</xsl:template>\n+<xsl:template match=\"xhtml:h2\">\n+  <h3><xsl:apply-templates select=\"@*|node()\"/></h3>\n+</xsl:template>\n+<xsl:template match=\"xhtml:h3\">\n+  <h4><xsl:apply-templates select=\"@*|node()\"/></h4>\n+</xsl:template>\n+<xsl:template match=\"xhtml:h4\">\n+  <h5><xsl:apply-templates select=\"@*|node()\"/></h5>\n+</xsl:template>\n+<xsl:template match=\"xhtml:h5|xhtml:h6\">\n+  <h6><xsl:apply-templates select=\"@*|node()\"/></h6>\n+</xsl:template>\n+\n+<xsl:template match=\"@*|node()\">\n+  <xsl:copy><xsl:apply-templates select=\"@*|node()\"/></xsl:copy>\n+</xsl:template>\n+\n+</xsl:stylesheet>", "filename": "src/webapp/lenya/xslt/util/introduction.xsl"}, {"additions": 0, "raw_url": "https://github.com/apache/lenya/raw/0db5be126f05d2c026e5cf63ef6ded6b2d3556a9/src/webapp/lenya/xslt/util/publication.xsl", "blob_url": "https://github.com/apache/lenya/blob/0db5be126f05d2c026e5cf63ef6ded6b2d3556a9/src/webapp/lenya/xslt/util/publication.xsl", "sha": "9de100f04553eb3a31a12b4a56cda35f8aeb363a", "changes": 122, "status": "removed", "deletions": 122, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/xslt/util/publication.xsl?ref=0db5be126f05d2c026e5cf63ef6ded6b2d3556a9", "patch": "@@ -1,122 +0,0 @@\n-<?xml version=\"1.0\"?>\n-<!--\n-  Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n--->\n-\n-<!-- $Id$ -->\n-\n-<xsl:stylesheet\n-    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" version=\"1.0\"\n-    xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.0\"\n-    xmlns=\"http://www.w3.org/1999/xhtml\"\n-    xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\n->\n-\n-<xsl:template match=\"/\">\n-  <xsl:apply-templates select=\"/lenya:publication\"/>\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:publication\">\n-<page:page>\n-  <page:title>Lenya CMS Publication: <xsl:value-of select=\"lenya:name\"/></page:title>\n-  <page:body>\n-\n-<div class=\"lenya-sidebar\">\n-<div class=\"lenya-sidebar-heading\">This&#160;Publication</div>\n-<ul>\n-  <li><a href=\"authoring/\">Login&#160;as&#160;Editor</a></li>\n-</ul>\n-<div class=\"lenya-publication-item\"><a href=\"../index.html\">Other&#160;Publications</a></div>\n-<div class=\"lenya-publication-item\"><a href=\"http://lenya.apache.org/docs/index.html\">Documentation</a></div>\n-<div class=\"lenya-publication-item\"><a href=\"http://wiki.apache.org/lenya\">Wiki</a></div>\n-</div>\n-\n-<div class=\"lenya-frontpage\">\n-<h2><xsl:value-of select=\"lenya:name\"/></h2>\n-\n-<xsl:apply-templates select=\"lenya:pub-version\"/>\n-\n-<xsl:apply-templates select=\"lenya:description\"/>\n-\n-<h3>Requirements and Dependencies</h3>\n-<p>\n-<xsl:apply-templates select=\"lenya:lenya-version\"/>\n-<xsl:apply-templates select=\"lenya:cocoon-version\"/>\n-<xsl:apply-templates select=\"lenya:modules\"/>\n-</p>\n-\n-<xsl:apply-templates select=\"lenya:readme\"/>\n-<xsl:apply-templates select=\"lenya:tests\"/>\n-</div>\n-\n-</page:body>\n-</page:page>\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:description\">\n-<h3>About</h3>\n-<p>\n-  <xsl:apply-templates />\n-</p>\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:readme\">\n-<h3>Readme</h3>\n-  <xsl:apply-templates />\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:version|lenya:lenya-version\">\n-Lenya: <strong><xsl:value-of select=\".\"/></strong> <xsl:apply-templates select=\"../lenya:lenya-revision\"/><br/>\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:lenya-revision\">\n-(Revision: <xsl:value-of select=\".\"/>)\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:cocoon-version\">\n-Cocoon: <strong><xsl:value-of select=\".\"/></strong><br/>\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:modules\">\n-Modules:\n-<ul>\n-<xsl:for-each select=\"lenya:module\">\n-  <li><xsl:value-of select=\".\"/></li>\n-</xsl:for-each>\n-</ul>\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:pub-version\">\n-Publication Version: <strong><xsl:value-of select=\".\"/></strong><br/>\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:tests\">\n-<a name=\"lenya:tests\" />\n-<h3>Tests</h3>\n-<ol>\n-  <xsl:apply-templates select=\"lenya:test\"/>\n-</ol>\n-</xsl:template>\n-\n-<xsl:template match=\"lenya:test\">\n-  <li><xsl:apply-templates /></li>\n-</xsl:template>\n-\n-<xsl:template match=\"@*|node()\">\n-  <xsl:copy><xsl:apply-templates select=\"@*|node()\"/></xsl:copy>\n-</xsl:template>\n-\n-</xsl:stylesheet>", "filename": "src/webapp/lenya/xslt/util/publication.xsl"}, {"additions": 51, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/xslt/util/welcome.xsl", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/lenya/xslt/util/welcome.xsl", "sha": "a77f0b6190f052c3c90f46ce554a3d778c4d6fd9", "changes": 82, "status": "modified", "deletions": 31, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/lenya/xslt/util/welcome.xsl?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -19,50 +19,70 @@\n <!-- $Id$ -->\n \n <xsl:stylesheet version=\"1.0\"\n+    xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.1\"\n+    xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\n+    xmlns:xhtml=\"http://www.w3.org/1999/xhtml\"\n     xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\n-    xmlns:lenya=\"http://apache.org/cocoon/lenya/publication/1.0\"\n     xmlns=\"http://www.w3.org/1999/xhtml\"\n-    xmlns:xhtml=\"http://www.w3.org/1999/xhtml\"\n-    xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\n-    >\n+>\n \n-<xsl:template match=\"lenya:lenya\">\n+<xsl:template match=\"/*\">\n   <page:page>\n-    \n-  <page:title>Apache Lenya - Content Management System</page:title>\n-  <page:head>\n-    <xhtml:meta http-equiv=\"cache-control\" content=\"no-cache\"/>\n-    <xhtml:meta http-equiv=\"pragma\" content=\"no-cache\"/>\n-  </page:head>  \n-  <page:body>\n-    <xsl:apply-templates select=\"xhtml:div[@class = 'lenya-frontpage']\"/>\n-    <xsl:apply-templates select=\"lenya:publications\"/>\n-  </page:body>\n+    <page:title>Apache Lenya - Content Management System</page:title>\n+    <page:head>\n+      <xhtml:meta http-equiv=\"cache-control\" content=\"no-cache\"/>\n+      <xhtml:meta http-equiv=\"pragma\" content=\"no-cache\"/>\n+    </page:head>  \n+    <page:body>\n+      <xsl:apply-templates select=\"lenya:publications\"/>\n+      <xsl:apply-templates select=\"page:page\"/>\n+    </page:body>\n   </page:page>\n </xsl:template>\n \n <xsl:template match=\"lenya:publications\">\n-<div class=\"lenya-sidebar\">\n-<div class=\"lenya-sidebar-heading\">Publications</div>\n+  <div class=\"lenya-sidebar\">\n+  <div class=\"lenya-sidebar-heading\">Publications</div>\n   <div class=\"lenya-publication-item\">\n     <strong><a href=\"index.html?lenya.usecase=templating.createPublicationFromTemplate\">New publication</a></strong>\n   </div>\n-<xsl:for-each select=\"lenya:publication\">\n-  <xsl:choose>\n-    <xsl:when test=\"lenya:publication/@lenya:show = 'false'\">\n-      <!-- do not list this publication. Might be a \"template\" publication -->\n-    </xsl:when>\n-    <xsl:otherwise>\n-      <div class=\"lenya-publication-item\">\n-        <a href=\"{@pid}/introduction.html\">\n-        <xsl:value-of select=\"lenya:publication/lenya:name|lenya:publication/lenya:name/@name\"/></a>\n-      </div>\n-    </xsl:otherwise>\n-  </xsl:choose>\n-</xsl:for-each>\n-</div>\n+  <!-- do not list publications with @show=\"false\" \n+     (can be used to hide template publications -->\n+  <xsl:for-each select=\"lenya:publication[not(@show) or @show != 'false']\">\n+    <div class=\"lenya-publication-item\">\n+      <a>\n+        <xsl:attribute name=\"href\"><xsl:value-of select=\"@dirname\"/><xsl:text>/introduction.html</xsl:text></xsl:attribute>\n+        <xsl:attribute name=\"title\"><xsl:value-of select=\"lenya:description\"/></xsl:attribute>\n+        <xsl:value-of select=\"lenya:name\"/>\n+      </a>\n+    </div>\n+  </xsl:for-each>\n+  </div>\n+</xsl:template>\n+\n+<xsl:template match=\"page:page\">\n+   <xsl:apply-templates select=\"page:body/*\"/>\n </xsl:template>\n \n+<!-- we are aggretating into a new context: \n+     (another good reason to move to xhtml2) -->\n+<xsl:template match=\"xhtml:h1\">\n+  <h2><xsl:apply-templates select=\"@*|node()\"/></h2>\n+</xsl:template>\n+<xsl:template match=\"xhtml:h2\">\n+  <h3><xsl:apply-templates select=\"@*|node()\"/></h3>\n+</xsl:template>\n+<xsl:template match=\"xhtml:h3\">\n+  <h4><xsl:apply-templates select=\"@*|node()\"/></h4>\n+</xsl:template>\n+<xsl:template match=\"xhtml:h4\">\n+  <h5><xsl:apply-templates select=\"@*|node()\"/></h5>\n+</xsl:template>\n+<xsl:template match=\"xhtml:h5|xhtml:h6\">\n+  <h6><xsl:apply-templates select=\"@*|node()\"/></h6>\n+</xsl:template>\n+\n+\n <xsl:template match=\"@*|node()\">\n   <xsl:copy><xsl:apply-templates select=\"@*|node()\"/></xsl:copy>\n </xsl:template>", "filename": "src/webapp/lenya/xslt/util/welcome.xsl"}, {"additions": 71, "raw_url": "https://github.com/apache/lenya/raw/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/readme.xml", "blob_url": "https://github.com/apache/lenya/blob/ea6bb10fdbc9f699d0cd422bf3524d677a36eca9/src/webapp/readme.xml", "sha": "bad4cdc1a9a30292e8c0ff6742ba6829c3a3fe81", "changes": 71, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/lenya/contents/src/webapp/readme.xml?ref=ea6bb10fdbc9f699d0cd422bf3524d677a36eca9", "patch": "@@ -0,0 +1,71 @@\n+<?xml version=\"1.0\"?>\n+<!--\n+  Licensed to the Apache Software Foundation (ASF) under one or more\n+  contributor license agreements.  See the NOTICE file distributed with\n+  this work for additional information regarding copyright ownership.\n+  The ASF licenses this file to You under the Apache License, Version 2.0\n+  (the \"License\"); you may not use this file except in compliance with\n+  the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+-->\n+\n+<!-- $Id: introduction.xml 473861 2006-11-12 03:51:14Z gregor $ -->\n+\n+<page:page \n+  xmlns:page=\"http://apache.org/cocoon/lenya/cms-page/1.0\"\n+  xmlns=\"http://www.w3.org/1999/xhtml\"\n+>\n+  <page:head/>\n+  <page:body>\n+    <h1>README: Apache Lenya</h1>\n+    <h2>Note to developers</h2>\n+    <p>\n+      Please use this new README to inform users\n+      about changes in the code or behaviour of Lenya. It is located under\n+      <code>src/webapp/readme.xml</code>. Its contents will be shown on the global \n+      welcome page, and also on the introduction page of every publication.\n+    </p>\n+    <h2>Important note for beta testers of Lenya 1.4</h2>\n+    <p><strong><em>You need to update your custom publication.xconf files!</em></strong></p>\n+    <p>\n+      As of revision FIXME, the file <code>$YOURPUB/publication.xml</code>\n+      is no longer used. Its contents should be moved to <code>$YOURPUB/config/publication.xconf.</code>\n+      To accomodate this, the format of <code>publication.xconf</code> has changed a bit (see\n+      below).<br />\n+      Sorry for the breakage, but we were able to eliminate a lot of old ad-hoc code\n+      and duplication with this change, and the new xconf file looks a lot nicer and more intuitive.\n+    </p>\n+    <p>\n+      <em>Most important changes:</em> All elements in <code>publication.xconf</code> \n+      must now be in the namespace <code>http://apache.org/cocoon/lenya/publication/1.1</code>,\n+      and <code>&lt;module/&gt;</code>, <code>&lt;proxy/&gt;</code>, and \n+      <code>&lt;resource-type&gt;</code> elements must now be grouped \n+      in <code>&lt;modules/&gt;</code>, <code>&lt;proxies/&gt;</code>, \n+      and <code>&lt;resource-types/&gt;</code>. See the default publication\n+      for an example.<br />\n+      You can use the RNG schema at <code>webapp/lenya/resources/schemas/publication.rng</code>\n+      to verify that your file is correct:\n+      <blockquote>\n+        <code>\n+          cd $LENYA_HOME<br />\n+          java -jar lib/jing-20030619.jar src/webapp/lenya/resources/schemas/publication.rng $YOURPUB/config/publication.xconf\n+        </code>\n+      </blockquote>\n+    </p>\n+    <h2>New per-publication <code>readme.xml</code></h2>\n+    <p>\n+      If you want to provide a custom README for your publication (maybe you\n+      have used the old &lt;lenya:readme/&gt; in the now gone\n+      publication.xml), you can put it in <code>$YOURPUB/readme.xml</code>. \n+      It is now a standard Lenya CMS page in the\n+      <code>http://apache.org/cocoon/lenya/cms-page/1.0</code> namespace.\n+    </p>  \n+  </page:body>\n+</page:page>", "filename": "src/webapp/readme.xml"}], "repo": "lenya"}]
