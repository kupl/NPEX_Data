[{"commit": "https://github.com/apache/gora/commit/33bab4a3e4711028adc30766b0cc797dab4604ba", "parent": "https://github.com/apache/gora/commit/1fe93b6e00c706a862def239ccbbd0bc0821a017", "message": "GORA-499 Fix for a potential NPE", "bug_id": "gora_1", "file": [{"additions": 2, "raw_url": "https://github.com/apache/gora/raw/33bab4a3e4711028adc30766b0cc797dab4604ba/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraClient.java", "blob_url": "https://github.com/apache/gora/blob/33bab4a3e4711028adc30766b0cc797dab4604ba/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraClient.java", "sha": "1f9d614229651d352bc815f846a744baef758b28", "changes": 4, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraClient.java?ref=33bab4a3e4711028adc30766b0cc797dab4604ba", "patch": "@@ -208,10 +208,10 @@ public void checkKeyspace() {\n       ccl.setReadCfConsistencyLevels(clmap);\n       ccl.setWriteCfConsistencyLevels(clmap);\n       // Operations consistency levels\n-      String opConsisLvl = (readOpConsLvl!=null || !readOpConsLvl.isEmpty())?readOpConsLvl:DEFAULT_HECTOR_CONSIS_LEVEL;\n+      String opConsisLvl = (readOpConsLvl!=null && !readOpConsLvl.isEmpty())?readOpConsLvl:DEFAULT_HECTOR_CONSIS_LEVEL;\n       ccl.setDefaultReadConsistencyLevel(HConsistencyLevel.valueOf(opConsisLvl));\n       LOG.debug(\"Hector read consistency configured to '\" + opConsisLvl + \"'.\");\n-      opConsisLvl = (writeOpConsLvl!=null || !writeOpConsLvl.isEmpty())?writeOpConsLvl:DEFAULT_HECTOR_CONSIS_LEVEL;\n+      opConsisLvl = (writeOpConsLvl!=null && !writeOpConsLvl.isEmpty())?writeOpConsLvl:DEFAULT_HECTOR_CONSIS_LEVEL;\n       ccl.setDefaultWriteConsistencyLevel(HConsistencyLevel.valueOf(opConsisLvl));\n       LOG.debug(\"Hector write consistency configured to '\" + opConsisLvl + \"'.\");\n ", "filename": "gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraClient.java"}], "repo": "gora"}, {"commit": "https://github.com/apache/gora/commit/b7fb9eea768a6daac93d1835726c737153f45ef4", "parent": "https://github.com/apache/gora/commit/96e623b035b2ab35fca15d03b790bee55636efcd", "message": "GORA_447 NPE Fix", "bug_id": "gora_2", "file": [{"additions": 17, "raw_url": "https://github.com/apache/gora/raw/b7fb9eea768a6daac93d1835726c737153f45ef4/gora-core/src/main/java/org/apache/gora/memory/store/MemStore.java", "blob_url": "https://github.com/apache/gora/blob/b7fb9eea768a6daac93d1835726c737153f45ef4/gora-core/src/main/java/org/apache/gora/memory/store/MemStore.java", "sha": "481b2a7d67f034970d17ad13afbe19c1ad82811f", "changes": 23, "status": "modified", "deletions": 6, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-core/src/main/java/org/apache/gora/memory/store/MemStore.java?ref=b7fb9eea768a6daac93d1835726c737153f45ef4", "patch": "@@ -106,13 +106,24 @@ public boolean delete(K key) {\n \n   @Override\n   public long deleteByQuery(Query<K, T> query) {\n-    try{\n+    try {\n       long deletedRows = 0;\n-      Result<K,T> result = query.execute();\n-\n-      while(result.next()) {\n-        if(delete(result.getKey()))\n-          deletedRows++;\n+      Result<K, T> result = query.execute();\n+\n+      String[] fields = getFieldsToQuery(query.getFields());\n+      boolean isAllFields = Arrays.equals(fields, getFields());\n+\n+      while (result.next()) {\n+        if (isAllFields) {\n+          if (delete(result.getKey())) {\n+            deletedRows++;\n+            continue;\n+          }\n+        }\n+        for (String field : fields) {\n+          result.get().clearField(field);\n+        }\n+        deletedRows++;\n       }\n       return deletedRows;\n     } catch (Exception e) {", "filename": "gora-core/src/main/java/org/apache/gora/memory/store/MemStore.java"}, {"additions": 7, "raw_url": "https://github.com/apache/gora/raw/b7fb9eea768a6daac93d1835726c737153f45ef4/gora-core/src/main/java/org/apache/gora/persistency/Persistent.java", "blob_url": "https://github.com/apache/gora/blob/b7fb9eea768a6daac93d1835726c737153f45ef4/gora-core/src/main/java/org/apache/gora/persistency/Persistent.java", "sha": "9d4b6015d8e21de908671c60d902693f07c1cd4c", "changes": 7, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-core/src/main/java/org/apache/gora/persistency/Persistent.java?ref=b7fb9eea768a6daac93d1835726c737153f45ef4", "patch": "@@ -35,6 +35,13 @@\n */\n   void clear();\n \n+  /**\n+* Clears the inner state of the object based on field without any modification to the actual\n+* data on the data store. This method should be called before re-using the existing fields on\n+* object to hold the data for another result.\n+*/\n+  void clearField(String Field);\n+\n   /**\n * Returns whether the field has been modified.\n *", "filename": "gora-core/src/main/java/org/apache/gora/persistency/Persistent.java"}, {"additions": 11, "raw_url": "https://github.com/apache/gora/raw/b7fb9eea768a6daac93d1835726c737153f45ef4/gora-core/src/main/java/org/apache/gora/persistency/impl/PersistentBase.java", "blob_url": "https://github.com/apache/gora/blob/b7fb9eea768a6daac93d1835726c737153f45ef4/gora-core/src/main/java/org/apache/gora/persistency/impl/PersistentBase.java", "sha": "d436d5658d4e0dabea3ffce851465a6206f43414", "changes": 11, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-core/src/main/java/org/apache/gora/persistency/impl/PersistentBase.java?ref=b7fb9eea768a6daac93d1835726c737153f45ef4", "patch": "@@ -196,6 +196,17 @@ public void clear() {\n     clearDirty();\n   }\n \n+  @Override\n+  public void clearField(String field) {\n+    Collection<Field> unmanagedFields = getUnmanagedFields();\n+    Field specificField = getSchema().getField(field);\n+    if (unmanagedFields.contains(specificField)) {\n+      put(specificField.pos(), PersistentData.get().deepCopy(specificField.schema(),\n+              PersistentData.get().getDefaultValue(specificField)));\n+    }\n+    clearDirynessIfFieldIsDirtyable(specificField.pos());\n+  }\n+\n   @Override\n   public boolean equals(Object that) {\n     if (that == this) {", "filename": "gora-core/src/main/java/org/apache/gora/persistency/impl/PersistentBase.java"}, {"additions": 9, "raw_url": "https://github.com/apache/gora/raw/b7fb9eea768a6daac93d1835726c737153f45ef4/gora-core/src/test/java/org/apache/gora/memory/store/MemStoreTest.java", "blob_url": "https://github.com/apache/gora/blob/b7fb9eea768a6daac93d1835726c737153f45ef4/gora-core/src/test/java/org/apache/gora/memory/store/MemStoreTest.java", "sha": "49db17a2e2cadcdd5de74e51675b5c4570868ac1", "changes": 15, "status": "modified", "deletions": 6, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-core/src/test/java/org/apache/gora/memory/store/MemStoreTest.java?ref=b7fb9eea768a6daac93d1835726c737153f45ef4", "patch": "@@ -22,6 +22,8 @@\n import org.apache.gora.examples.WebPageDataCreator;\n import org.apache.gora.examples.generated.Employee;\n import org.apache.gora.examples.generated.WebPage;\n+import org.apache.gora.persistency.BeanFactory;\n+import org.apache.gora.persistency.impl.BeanFactoryImpl;\n import org.apache.gora.query.Query;\n import org.apache.gora.store.DataStore;\n import org.apache.gora.store.DataStoreFactory;\n@@ -69,7 +71,7 @@ public void setUp() throws Exception {\n   @SuppressWarnings(\"unchecked\")\n   @Override\n   protected DataStore<String, WebPage> createWebPageDataStore() throws IOException {\n-    return DataStoreFactory.getDataStore(MemStore.class, String.class, Employee.class, conf);\n+    return DataStoreFactory.getDataStore(MemStore.class, String.class, WebPage.class, conf);\n   }\n \n   @Test\n@@ -110,11 +112,12 @@ public void testDeleteByQueryFields() {}\n   @Test\n   public void testGetWithFields() {}\n \n-  @Ignore(\"GORA-447\")\n   @Test\n   public void testMemStoreDeleteByQueryFields() throws Exception {\n \n     DataStore<String, WebPage> store = new MemStore<>();\n+    BeanFactory<String, WebPage> beanFactory = new BeanFactoryImpl<>(String.class, WebPage.class);\n+    store.setBeanFactory(beanFactory);\n     Query<String, WebPage> query;\n \n     //test 5 - delete all with some fields\n@@ -124,9 +127,9 @@ public void testMemStoreDeleteByQueryFields() throws Exception {\n     query.setFields(\"outlinks\", \"parsedContent\", \"content\");\n     \n     Query<String, WebPage> newQuery = store.newQuery();\n-    newQuery.setStartKey(URLS[0]);\n-    newQuery.setEndKey(URLS[9]);\n-    //newQuery.setFields(\"outlinks\", \"parsedContent\", \"content\");\n+    newQuery.setStartKey(SORTED_URLS[0]);\n+    newQuery.setEndKey(SORTED_URLS[9]);\n+    newQuery.setFields(\"outlinks\", \"parsedContent\", \"content\");\n \n     DataStoreTestUtil.assertNumResults(newQuery, URLS.length);\n     store.deleteByQuery(query);\n@@ -178,7 +181,7 @@ public void testMemStoreDeleteByQueryFields() throws Exception {\n     for (int i = 0; i < URLS.length; i++) {\n       WebPage page = store.get(URLS[i]);\n       assertNotNull(page);\n-      if( URLS[i].compareTo(startKey) < 0 || URLS[i].compareTo(endKey) >= 0) {\n+      if( URLS[i].compareTo(startKey) < 0 || URLS[i].compareTo(endKey) > 0) {\n         //not deleted\n         DataStoreTestUtil.assertWebPage(page, i);\n       } else {", "filename": "gora-core/src/test/java/org/apache/gora/memory/store/MemStoreTest.java"}, {"additions": 2, "raw_url": "https://github.com/apache/gora/raw/b7fb9eea768a6daac93d1835726c737153f45ef4/gora-dynamodb/src/examples/java/org/apache/gora/dynamodb/example/generated/Person.java", "blob_url": "https://github.com/apache/gora/blob/b7fb9eea768a6daac93d1835726c737153f45ef4/gora-dynamodb/src/examples/java/org/apache/gora/dynamodb/example/generated/Person.java", "sha": "f9c3ca67f6e10944cf7cdb25ac1cbe464251459c", "changes": 2, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-dynamodb/src/examples/java/org/apache/gora/dynamodb/example/generated/Person.java?ref=b7fb9eea768a6daac93d1835726c737153f45ef4", "patch": "@@ -51,6 +51,8 @@ public void setDirty(boolean pDirty){}\n     @Override\n     public void clear() { }\n     @Override\n+    public void clearField(String Field) { }\n+    @Override\n     public Person clone() { return null; }\n     @Override\n     public boolean isDirty() { return false; }", "filename": "gora-dynamodb/src/examples/java/org/apache/gora/dynamodb/example/generated/Person.java"}, {"additions": 2, "raw_url": "https://github.com/apache/gora/raw/b7fb9eea768a6daac93d1835726c737153f45ef4/gora-dynamodb/src/examples/java/org/apache/gora/dynamodb/example/generated/Webpage.java", "blob_url": "https://github.com/apache/gora/blob/b7fb9eea768a6daac93d1835726c737153f45ef4/gora-dynamodb/src/examples/java/org/apache/gora/dynamodb/example/generated/Webpage.java", "sha": "e3b6024ae7089a8cbf4d9605f539e86516db53a5", "changes": 2, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-dynamodb/src/examples/java/org/apache/gora/dynamodb/example/generated/Webpage.java?ref=b7fb9eea768a6daac93d1835726c737153f45ef4", "patch": "@@ -44,6 +44,8 @@ public void setDirty(boolean pDirty){}\n     @Override\n     public void clear() { }\n     @Override\n+    public void clearField(String Field) { }\n+    @Override\n     public Webpage clone() { return null; }\n     @Override\n     public boolean isDirty() { return false; }", "filename": "gora-dynamodb/src/examples/java/org/apache/gora/dynamodb/example/generated/Webpage.java"}, {"additions": 2, "raw_url": "https://github.com/apache/gora/raw/b7fb9eea768a6daac93d1835726c737153f45ef4/gora-dynamodb/src/main/java/org/apache/gora/dynamodb/compiler/GoraDynamoDBCompiler.java", "blob_url": "https://github.com/apache/gora/blob/b7fb9eea768a6daac93d1835726c737153f45ef4/gora-dynamodb/src/main/java/org/apache/gora/dynamodb/compiler/GoraDynamoDBCompiler.java", "sha": "906773b57d590c5b17e79e10a0afd8e170b61eab", "changes": 2, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-dynamodb/src/main/java/org/apache/gora/dynamodb/compiler/GoraDynamoDBCompiler.java?ref=b7fb9eea768a6daac93d1835726c737153f45ef4", "patch": "@@ -291,6 +291,8 @@ private void setDefaultMethods(int pIden, String tabName) throws IOException {\n     line(pIden, \"@Override\");\n     line(pIden, \"public void clear() { }\");\n     line(pIden, \"@Override\");\n+    line(pIden, \"public void clearField(String Field) { }\");\n+    line(pIden, \"@Override\");\n     line(pIden, \"public \" + tabName + \" clone() { return null; }\");\n     line(pIden, \"@Override\");\n     line(pIden, \"public boolean isDirty() { return false; }\");", "filename": "gora-dynamodb/src/main/java/org/apache/gora/dynamodb/compiler/GoraDynamoDBCompiler.java"}], "repo": "gora"}, {"commit": "https://github.com/apache/gora/commit/b0d69051961c797200ec92b37a1557f1be1c2c58", "parent": "https://github.com/apache/gora/commit/570662b02bbe0a0bc10ea0490b323630fb9c0646", "message": "GORA-447 NPE fix removed Persistant API change", "bug_id": "gora_3", "file": [{"additions": 16, "raw_url": "https://github.com/apache/gora/raw/b0d69051961c797200ec92b37a1557f1be1c2c58/gora-core/src/main/java/org/apache/gora/memory/store/MemStore.java", "blob_url": "https://github.com/apache/gora/blob/b0d69051961c797200ec92b37a1557f1be1c2c58/gora-core/src/main/java/org/apache/gora/memory/store/MemStore.java", "sha": "19e3bc0b427f612230ca9762baf97eef9c19813a", "changes": 27, "status": "modified", "deletions": 11, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-core/src/main/java/org/apache/gora/memory/store/MemStore.java?ref=b0d69051961c797200ec92b37a1557f1be1c2c58", "patch": "@@ -19,11 +19,7 @@\n package org.apache.gora.memory.store;\n \n import java.io.IOException;\n-import java.util.ArrayList;\n-import java.util.Arrays;\n-import java.util.Iterator;\n-import java.util.List;\n-import java.util.NavigableMap;\n+import java.util.*;\n import java.util.concurrent.ConcurrentNavigableMap;\n import java.util.concurrent.ConcurrentSkipListMap;\n \n@@ -117,13 +113,20 @@ public long deleteByQuery(Query<K, T> query) {\n         if (isAllFields) {\n           if (delete(result.getKey())) {\n             deletedRows++;\n-            continue;\n+          }\n+        } else {\n+          ArrayList<String> excludedFields = new ArrayList<>();\n+          for (String field : getFields()){\n+            if (!Arrays.asList(fields).contains(field)){\n+              excludedFields.add(field);\n+            }\n+          }\n+          T newClonedObj = getPersistent(result.get(),excludedFields.toArray(new String[excludedFields.size()]));\n+          if (delete(result.getKey())) {\n+            put(result.getKey(),newClonedObj);\n+            deletedRows++;\n           }\n         }\n-        for (String field : fields) {\n-          result.get().clearField(field);\n-        }\n-        deletedRows++;\n       }\n       return deletedRows;\n     } catch (Exception e) {\n@@ -190,7 +193,9 @@ public T get(K key, String[] fields) {\n       return obj;\n     }\n     T newObj = AvroUtils.deepClonePersistent(obj);\n-    for (Field otherField : otherFields) {\n+    newObj.clear();\n+    for (String field : fields) {\n+      Field otherField = obj.getSchema().getField(field);\n       int index = otherField.pos();\n       newObj.put(index, obj.get(index));\n     }", "filename": "gora-core/src/main/java/org/apache/gora/memory/store/MemStore.java"}, {"additions": 0, "raw_url": "https://github.com/apache/gora/raw/b0d69051961c797200ec92b37a1557f1be1c2c58/gora-core/src/main/java/org/apache/gora/persistency/Persistent.java", "blob_url": "https://github.com/apache/gora/blob/b0d69051961c797200ec92b37a1557f1be1c2c58/gora-core/src/main/java/org/apache/gora/persistency/Persistent.java", "sha": "bd520a9273583e991e82f7ace785cee5cc126d15", "changes": 7, "status": "modified", "deletions": 7, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-core/src/main/java/org/apache/gora/persistency/Persistent.java?ref=b0d69051961c797200ec92b37a1557f1be1c2c58", "patch": "@@ -35,13 +35,6 @@\n */\n   void clear();\n \n-  /**\n-* Clears the inner state of the object based on field without any modification to the actual\n-* data on the data store. This method should be called before re-using the existing fields on\n-* object to hold the data for another result.\n-*/\n-  void clearField(String Field);\n-\n   /**\n * Returns whether the field has been modified.\n *", "filename": "gora-core/src/main/java/org/apache/gora/persistency/Persistent.java"}, {"additions": 0, "raw_url": "https://github.com/apache/gora/raw/b0d69051961c797200ec92b37a1557f1be1c2c58/gora-core/src/main/java/org/apache/gora/persistency/impl/PersistentBase.java", "blob_url": "https://github.com/apache/gora/blob/b0d69051961c797200ec92b37a1557f1be1c2c58/gora-core/src/main/java/org/apache/gora/persistency/impl/PersistentBase.java", "sha": "56c481660e3a80869683e0bcd0d5e1ec2c38a523", "changes": 11, "status": "modified", "deletions": 11, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-core/src/main/java/org/apache/gora/persistency/impl/PersistentBase.java?ref=b0d69051961c797200ec92b37a1557f1be1c2c58", "patch": "@@ -196,17 +196,6 @@ public void clear() {\n     clearDirty();\n   }\n \n-  @Override\n-  public void clearField(String field) {\n-    Collection<Field> unmanagedFields = getUnmanagedFields();\n-    Field specificField = getSchema().getField(field);\n-    if (unmanagedFields.contains(specificField)) {\n-      put(specificField.pos(), PersistentData.get().deepCopy(specificField.schema(),\n-              PersistentData.get().getDefaultValue(specificField)));\n-    }\n-    clearDirynessIfFieldIsDirtyable(specificField.pos());\n-  }\n-\n   @Override\n   public boolean equals(Object that) {\n     if (that == this) {", "filename": "gora-core/src/main/java/org/apache/gora/persistency/impl/PersistentBase.java"}, {"additions": 22, "raw_url": "https://github.com/apache/gora/raw/b0d69051961c797200ec92b37a1557f1be1c2c58/gora-core/src/test/java/org/apache/gora/memory/store/MemStoreTest.java", "blob_url": "https://github.com/apache/gora/blob/b0d69051961c797200ec92b37a1557f1be1c2c58/gora-core/src/test/java/org/apache/gora/memory/store/MemStoreTest.java", "sha": "8e94662d2cd9ccef073ea4d6f58605ec9b546b62", "changes": 26, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-core/src/test/java/org/apache/gora/memory/store/MemStoreTest.java?ref=b0d69051961c797200ec92b37a1557f1be1c2c58", "patch": "@@ -38,6 +38,7 @@\n \n import static org.apache.gora.examples.WebPageDataCreator.SORTED_URLS;\n import static org.apache.gora.examples.WebPageDataCreator.URLS;\n+import static org.apache.gora.examples.WebPageDataCreator.URL_INDEXES;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertNotNull;\n import static org.junit.Assert.assertNull;\n@@ -52,7 +53,7 @@\n public class MemStoreTest extends DataStoreTestBase {\n \n   private static final Logger LOG = LoggerFactory.getLogger(MemStoreTest.class);\n-  \n+\n   private static final int NUM_KEYS = 4;\n \n   private Configuration conf;\n@@ -108,9 +109,26 @@ public void testPutGet() throws Exception {\n   @Test\n   public void testDeleteByQueryFields() {}\n \n-  @Ignore(\"GORA-447\")\n   @Test\n-  public void testGetWithFields() {}\n+  public void testGetWithFields() throws Exception {\n+\n+    DataStore<String, WebPage> store = new MemStore<>();\n+    BeanFactory<String, WebPage> beanFactory = new BeanFactoryImpl<>(String.class, WebPage.class);\n+    store.setBeanFactory(beanFactory);\n+    WebPageDataCreator.createWebPageData(store);\n+    String[] interestFields = new String[2];\n+    interestFields[0] = \"url\";\n+    interestFields[1] = \"content\";\n+    WebPage page = store.get(URLS[1], interestFields);\n+    assertNotNull(page);\n+    assertNotNull(page.getUrl());\n+    assertEquals(page.getUrl().toString(), URLS[1]);\n+    assertNotNull(page.getContent());\n+    assertEquals(\"Map of Outlinks should have a size of '0' as it is omitted at retrieval\",\n+            0, page.getOutlinks().size());\n+    assertEquals(\"Map of Parsed Content should have a size of '0' as it is omitted at retrieval\",\n+            0, page.getParsedContent().size());\n+  }\n \n   @Test\n   public void testMemStoreDeleteByQueryFields() throws Exception {\n@@ -125,7 +143,7 @@ public void testMemStoreDeleteByQueryFields() throws Exception {\n \n     query = store.newQuery();\n     query.setFields(\"outlinks\", \"parsedContent\", \"content\");\n-    \n+\n     Query<String, WebPage> newQuery = store.newQuery();\n     newQuery.setStartKey(SORTED_URLS[0]);\n     newQuery.setEndKey(SORTED_URLS[9]);", "filename": "gora-core/src/test/java/org/apache/gora/memory/store/MemStoreTest.java"}, {"additions": 0, "raw_url": "https://github.com/apache/gora/raw/b0d69051961c797200ec92b37a1557f1be1c2c58/gora-dynamodb/src/examples/java/org/apache/gora/dynamodb/example/generated/Person.java", "blob_url": "https://github.com/apache/gora/blob/b0d69051961c797200ec92b37a1557f1be1c2c58/gora-dynamodb/src/examples/java/org/apache/gora/dynamodb/example/generated/Person.java", "sha": "471fb59bf14e9852dfd2776f1a35437c56969da8", "changes": 2, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-dynamodb/src/examples/java/org/apache/gora/dynamodb/example/generated/Person.java?ref=b0d69051961c797200ec92b37a1557f1be1c2c58", "patch": "@@ -51,8 +51,6 @@ public void setDirty(boolean pDirty){}\n     @Override\n     public void clear() { }\n     @Override\n-    public void clearField(String Field) { }\n-    @Override\n     public Person clone() { return null; }\n     @Override\n     public boolean isDirty() { return false; }", "filename": "gora-dynamodb/src/examples/java/org/apache/gora/dynamodb/example/generated/Person.java"}, {"additions": 0, "raw_url": "https://github.com/apache/gora/raw/b0d69051961c797200ec92b37a1557f1be1c2c58/gora-dynamodb/src/examples/java/org/apache/gora/dynamodb/example/generated/Webpage.java", "blob_url": "https://github.com/apache/gora/blob/b0d69051961c797200ec92b37a1557f1be1c2c58/gora-dynamodb/src/examples/java/org/apache/gora/dynamodb/example/generated/Webpage.java", "sha": "df9eb806b1df5c5adc51e90747e8d50a12f81b6d", "changes": 2, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-dynamodb/src/examples/java/org/apache/gora/dynamodb/example/generated/Webpage.java?ref=b0d69051961c797200ec92b37a1557f1be1c2c58", "patch": "@@ -44,8 +44,6 @@ public void setDirty(boolean pDirty){}\n     @Override\n     public void clear() { }\n     @Override\n-    public void clearField(String Field) { }\n-    @Override\n     public Webpage clone() { return null; }\n     @Override\n     public boolean isDirty() { return false; }", "filename": "gora-dynamodb/src/examples/java/org/apache/gora/dynamodb/example/generated/Webpage.java"}, {"additions": 0, "raw_url": "https://github.com/apache/gora/raw/b0d69051961c797200ec92b37a1557f1be1c2c58/gora-dynamodb/src/main/java/org/apache/gora/dynamodb/compiler/GoraDynamoDBCompiler.java", "blob_url": "https://github.com/apache/gora/blob/b0d69051961c797200ec92b37a1557f1be1c2c58/gora-dynamodb/src/main/java/org/apache/gora/dynamodb/compiler/GoraDynamoDBCompiler.java", "sha": "be38e361e591dacc942490897191c7080f0ddcda", "changes": 2, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-dynamodb/src/main/java/org/apache/gora/dynamodb/compiler/GoraDynamoDBCompiler.java?ref=b0d69051961c797200ec92b37a1557f1be1c2c58", "patch": "@@ -291,8 +291,6 @@ private void setDefaultMethods(int pIden, String tabName) throws IOException {\n     line(pIden, \"@Override\");\n     line(pIden, \"public void clear() { }\");\n     line(pIden, \"@Override\");\n-    line(pIden, \"public void clearField(String Field) { }\");\n-    line(pIden, \"@Override\");\n     line(pIden, \"public \" + tabName + \" clone() { return null; }\");\n     line(pIden, \"@Override\");\n     line(pIden, \"public boolean isDirty() { return false; }\");", "filename": "gora-dynamodb/src/main/java/org/apache/gora/dynamodb/compiler/GoraDynamoDBCompiler.java"}], "repo": "gora"}, {"commit": "https://github.com/apache/gora/commit/d61a1735e3fdaeff00c4ecad85905e335651bafa", "parent": "https://github.com/apache/gora/commit/e00f420fbc0d3d89c4c8cc76509d501622c17b3e", "message": "GORA-350 fixed. NPE within CassandraClient.getFamilyMap.", "bug_id": "gora_4", "file": [{"additions": 0, "raw_url": "https://github.com/apache/gora/raw/d61a1735e3fdaeff00c4ecad85905e335651bafa/gora-cassandra/src/main/java/org/apache/gora/cassandra/query/CassandraResult.java", "blob_url": "https://github.com/apache/gora/blob/d61a1735e3fdaeff00c4ecad85905e335651bafa/gora-cassandra/src/main/java/org/apache/gora/cassandra/query/CassandraResult.java", "sha": "46dad15816581c0ff65382a82581480ebb6ef24d", "changes": 2, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-cassandra/src/main/java/org/apache/gora/cassandra/query/CassandraResult.java?ref=d61a1735e3fdaeff00c4ecad85905e335651bafa", "patch": "@@ -107,8 +107,6 @@ private void updatePersistent() throws IOException {\n           int pos = this.persistent.getSchema().getField(fieldName).pos();\n           Field field = fields.get(pos);\n           Type fieldType = field.schema().getType();\n-          // LOG.info(StringSerializer.get().fromByteBuffer(cassandraColumn.getName())\n-          // + fieldName + \" \" + fieldType.name());\n           if (fieldType.equals(Type.UNION)) {\n             //getting UNION stored type\n             CassandraColumn cc = getUnionTypeColumn(fieldName", "filename": "gora-cassandra/src/main/java/org/apache/gora/cassandra/query/CassandraResult.java"}, {"additions": 2, "raw_url": "https://github.com/apache/gora/raw/d61a1735e3fdaeff00c4ecad85905e335651bafa/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraClient.java", "blob_url": "https://github.com/apache/gora/blob/d61a1735e3fdaeff00c4ecad85905e335651bafa/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraClient.java", "sha": "1d56e32be5de223ae131e2b05833082fab300d26", "changes": 4, "status": "modified", "deletions": 2, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraClient.java?ref=d61a1735e3fdaeff00c4ecad85905e335651bafa", "patch": "@@ -478,7 +478,7 @@ private String getMappingColumn(String pField){\n         map.put(family, list);\n       }\n       if (persistentSchema.getField(field).schema().getType() == Type.UNION)\n-        list.add(column + CassandraStore.UNION_COL_SUFIX);\n+        list.add(field + CassandraStore.UNION_COL_SUFIX);\n       if (column != null) {\n         list.add(column);\n       }\n@@ -510,7 +510,7 @@ public CassandraMapping getCassandraMapping(){\n       String family = this.getMappingFamily(field);\n       String column = this.getMappingColumn(field);\n       if (persistentSchema.getField(field).schema().getType() == Type.UNION)\n-        map.put(family + \":\" + column + CassandraStore.UNION_COL_SUFIX, field + CassandraStore.UNION_COL_SUFIX);\n+        map.put(family + \":\" + field + CassandraStore.UNION_COL_SUFIX, field + CassandraStore.UNION_COL_SUFIX);\n       map.put(family + \":\" + column, field);\n     }\n     ", "filename": "gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraClient.java"}, {"additions": 1, "raw_url": "https://github.com/apache/gora/raw/d61a1735e3fdaeff00c4ecad85905e335651bafa/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraStore.java", "blob_url": "https://github.com/apache/gora/blob/d61a1735e3fdaeff00c4ecad85905e335651bafa/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraStore.java", "sha": "ffb4af0eefad651f5207fea57193d8f17e30893a", "changes": 16, "status": "modified", "deletions": 15, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraStore.java?ref=d61a1735e3fdaeff00c4ecad85905e335651bafa", "patch": "@@ -47,7 +47,6 @@\n import org.apache.avro.specific.SpecificData;\n import org.apache.avro.specific.SpecificDatumWriter;\n import org.apache.avro.util.Utf8;\n-import org.apache.commons.lang.ArrayUtils;\n import org.apache.gora.cassandra.query.CassandraQuery;\n import org.apache.gora.cassandra.query.CassandraResult;\n import org.apache.gora.cassandra.query.CassandraResultSet;\n@@ -314,20 +313,7 @@ public T get(K key, String[] fields) {\n     if (fields == null){\n       fields = this.getFields();\n     }\n-    // Generating UnionFields\n-    ArrayList<String> unionFields = new ArrayList<String>();\n-    for (String field: fields){\n-      Field schemaField =this.fieldMap.get(field);\n-      Type type = schemaField.schema().getType();\n-      if (type.getName().equals(\"UNION\".toLowerCase())){\n-        unionFields.add(field+UNION_COL_SUFIX);\n-      }\n-    }\n-    \n-    String[] arr = unionFields.toArray(new String[unionFields.size()]);\n-    String[] both = (String[]) ArrayUtils.addAll(fields, arr);\n-    \n-    query.setFields(both);\n+    query.setFields(fields);\n \n     query.setLimit(1);\n     Result<K,T> result = execute(query);", "filename": "gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraStore.java"}], "repo": "gora"}, {"commit": "https://github.com/apache/gora/commit/b79fc898f83994ebf61a2065a69055d0513bbdb5", "parent": "https://github.com/apache/gora/commit/b5ba30c0999088d587755ad5cfdff97faaeb3fea", "message": "Temp fix for GORA-447 Fix NPE within MemStoreTest.testMemStoreDeleteByQueryFields and failed assertion within MemStoreTest.testGetWithFields", "bug_id": "gora_5", "file": [{"additions": 6, "raw_url": "https://github.com/apache/gora/raw/b79fc898f83994ebf61a2065a69055d0513bbdb5/gora-core/src/test/java/org/apache/gora/memory/store/MemStoreTest.java", "blob_url": "https://github.com/apache/gora/blob/b79fc898f83994ebf61a2065a69055d0513bbdb5/gora-core/src/test/java/org/apache/gora/memory/store/MemStoreTest.java", "sha": "0c56d8e1faccf07c4b6816681ef197281af720e7", "changes": 7, "status": "modified", "deletions": 1, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-core/src/test/java/org/apache/gora/memory/store/MemStoreTest.java?ref=b79fc898f83994ebf61a2065a69055d0513bbdb5", "patch": "@@ -102,10 +102,15 @@ public void testPutGet() throws Exception {\n     store.close();\n   }\n \n-  @Ignore(\"This test assumes that \")\n+  @Ignore(\"GORA-447\")\n   @Test\n   public void testDeleteByQueryFields() {}\n \n+  @Ignore(\"GORA-447\")\n+  @Test\n+  public void testGetWithFields() {}\n+\n+  @Ignore(\"GORA-447\")\n   @Test\n   public void testMemStoreDeleteByQueryFields() throws Exception {\n ", "filename": "gora-core/src/test/java/org/apache/gora/memory/store/MemStoreTest.java"}], "repo": "gora"}, {"commit": "https://github.com/apache/gora/commit/89c025d2f9e4ba19378eb15537104c8775bf2474", "parent": "https://github.com/apache/gora/commit/22b5cf8e5bcd0c974167a1a5cf03a0771f30790a", "message": "GORA-364 MemStore.get fails with NPE when key is not set", "bug_id": "gora_6", "file": [{"additions": 2, "raw_url": "https://github.com/apache/gora/raw/89c025d2f9e4ba19378eb15537104c8775bf2474/CHANGES.txt", "blob_url": "https://github.com/apache/gora/blob/89c025d2f9e4ba19378eb15537104c8775bf2474/CHANGES.txt", "sha": "01e14f9767b28aa8b7daed642ae99ccb66401b88", "changes": 2, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/gora/contents/CHANGES.txt?ref=89c025d2f9e4ba19378eb15537104c8775bf2474", "patch": "@@ -4,6 +4,8 @@\n \n Current Development 0.5-SNAPSHOT\n \n+* GORA-364 MemStore.get fails with NPE when key is not set (Gerhard Gossen via lewismc)\n+\n * GORA-189 Embrace all text-like parameters in generated Persistent subclasses by Compiler CharSequence (lewismc)\n \n * GORA-361 AvroUtils.deepClonePersistent needs to flush BinaryEncoder (Gerhard Gossen via hsaputra)", "filename": "CHANGES.txt"}, {"additions": 3, "raw_url": "https://github.com/apache/gora/raw/89c025d2f9e4ba19378eb15537104c8775bf2474/gora-core/src/main/java/org/apache/gora/memory/store/MemStore.java", "blob_url": "https://github.com/apache/gora/blob/89c025d2f9e4ba19378eb15537104c8775bf2474/gora-core/src/main/java/org/apache/gora/memory/store/MemStore.java", "sha": "56ba4e3b2ee8d9f892b13abb929945b657d5cbcc", "changes": 3, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-core/src/main/java/org/apache/gora/memory/store/MemStore.java?ref=89c025d2f9e4ba19378eb15537104c8775bf2474", "patch": "@@ -139,6 +139,9 @@ public long deleteByQuery(Query<K, T> query) {\n   @Override\n   public T get(K key, String[] fields) {\n     T obj = map.get(key);\n+    if (obj == null) {\n+      return null;\n+    }\n     return getPersistent(obj, getFieldsToQuery(fields));\n   }\n ", "filename": "gora-core/src/main/java/org/apache/gora/memory/store/MemStore.java"}, {"additions": 31, "raw_url": "https://github.com/apache/gora/raw/89c025d2f9e4ba19378eb15537104c8775bf2474/gora-core/src/test/java/org/apache/gora/memory/store/MemStoreTest.java", "blob_url": "https://github.com/apache/gora/blob/89c025d2f9e4ba19378eb15537104c8775bf2474/gora-core/src/test/java/org/apache/gora/memory/store/MemStoreTest.java", "sha": "f715280faf4924587a35442fe594d8625a2ab9e4", "changes": 31, "status": "added", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-core/src/test/java/org/apache/gora/memory/store/MemStoreTest.java?ref=89c025d2f9e4ba19378eb15537104c8775bf2474", "patch": "@@ -0,0 +1,31 @@\n+package org.apache.gora.memory.store;\n+\n+import org.apache.gora.examples.generated.WebPage;\n+import org.apache.gora.store.DataStore;\n+import org.junit.Test;\n+\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assume.assumeTrue;\n+\n+public class MemStoreTest {\n+\n+  @Test\n+  public void testGetMissingValue() {\n+    DataStore<String, WebPage> store = new MemStore<String, WebPage>();\n+    WebPage nullWebPage = store.get(\"missing\", new String[0]);\n+    assertNull(nullWebPage);\n+    store.close();\n+  }\n+\n+  @Test\n+  public void testPutGet() throws Exception {\n+    String key = \"org.apache.gora:http:/\";\n+    DataStore<String, WebPage> store = new MemStore<String, WebPage>();\n+    assumeTrue(store.get(key, new String[0]) == null);\n+    store.put(key, WebPage.newBuilder().build());\n+    assertNotNull(store.get(key, new String[0]));\n+    store.close();\n+  }\n+\n+}", "filename": "gora-core/src/test/java/org/apache/gora/memory/store/MemStoreTest.java"}], "repo": "gora"}, {"commit": "https://github.com/apache/gora/commit/692f89574beef37409e29720c7ca73f5e548482b", "parent": "https://github.com/apache/gora/commit/3ba3bf581eeb49170c0952bb2707d7eb54173cd1", "message": "GORA-283 avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/gora/trunk@1558595 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "gora_7", "file": [{"additions": 2, "raw_url": "https://github.com/apache/gora/raw/692f89574beef37409e29720c7ca73f5e548482b/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraStore.java", "blob_url": "https://github.com/apache/gora/blob/692f89574beef37409e29720c7ca73f5e548482b/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraStore.java", "sha": "bd6604f27c7851a263cb26d45e13df9d2086024d", "changes": 5, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraStore.java?ref=692f89574beef37409e29720c7ca73f5e548482b", "patch": "@@ -435,11 +435,10 @@ private void addOrUpdateField(K key, Field field, Object value) {\n         LOG.debug(\"Union with value: \" + value.toString() + \" at index: \" + getUnionSchema(value, schema) + \" supported for field: \" + field.name());\n         this.cassandraClient.addColumn(key, field.name(), value);\n       } else {\n-        LOG.warn(\"Union with value: \" + value.toString() + \" at index: \" + getUnionSchema(value, schema) + \" not supported for field: \" + field.name());\n+        LOG.warn(\"Union with 'null' value not supported for field: \" + field.name());\n       }\n     default:\n-      LOG.warn(\"Type: \" + type.name() + \" with value: \" + value.toString() + \n-          \" not considered for field: \" + field.name() + \". Please report this to dev@gora.apache.org\");\n+      LOG.warn(\"Type: \" + type.name() + \" not considered for field: \" + field.name() + \". Please report this to dev@gora.apache.org\");\n     }\n   }\n ", "filename": "gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraStore.java"}], "repo": "gora"}, {"commit": "https://github.com/apache/gora/commit/10a701b87343716607435e5a37282fef618e4a03", "parent": "https://github.com/apache/gora/commit/c401e929da396fcd3c902ae76a71ba981ff2d67e", "message": "GORA-283 avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/gora/trunk@1558595 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "gora_8", "file": [{"additions": 2, "raw_url": "https://github.com/apache/gora/raw/10a701b87343716607435e5a37282fef618e4a03/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraStore.java", "blob_url": "https://github.com/apache/gora/blob/10a701b87343716607435e5a37282fef618e4a03/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraStore.java", "sha": "bd6604f27c7851a263cb26d45e13df9d2086024d", "changes": 5, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraStore.java?ref=10a701b87343716607435e5a37282fef618e4a03", "patch": "@@ -435,11 +435,10 @@ private void addOrUpdateField(K key, Field field, Object value) {\n         LOG.debug(\"Union with value: \" + value.toString() + \" at index: \" + getUnionSchema(value, schema) + \" supported for field: \" + field.name());\n         this.cassandraClient.addColumn(key, field.name(), value);\n       } else {\n-        LOG.warn(\"Union with value: \" + value.toString() + \" at index: \" + getUnionSchema(value, schema) + \" not supported for field: \" + field.name());\n+        LOG.warn(\"Union with 'null' value not supported for field: \" + field.name());\n       }\n     default:\n-      LOG.warn(\"Type: \" + type.name() + \" with value: \" + value.toString() + \n-          \" not considered for field: \" + field.name() + \". Please report this to dev@gora.apache.org\");\n+      LOG.warn(\"Type: \" + type.name() + \" not considered for field: \" + field.name() + \". Please report this to dev@gora.apache.org\");\n     }\n   }\n ", "filename": "gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraStore.java"}], "repo": "gora"}, {"commit": "https://github.com/apache/gora/commit/47794859f50ad5298bb5941e9262ebe98cca20d9", "parent": "https://github.com/apache/gora/commit/ddff02db5dd8d93903a1312e999af7867fd3b62f", "message": "GORA-283 avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/gora/trunk@1558595 13f79535-47bb-0310-9956-ffa450edef68", "bug_id": "gora_9", "file": [{"additions": 2, "raw_url": "https://github.com/apache/gora/raw/47794859f50ad5298bb5941e9262ebe98cca20d9/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraStore.java", "blob_url": "https://github.com/apache/gora/blob/47794859f50ad5298bb5941e9262ebe98cca20d9/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraStore.java", "sha": "bd6604f27c7851a263cb26d45e13df9d2086024d", "changes": 5, "status": "modified", "deletions": 3, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraStore.java?ref=47794859f50ad5298bb5941e9262ebe98cca20d9", "patch": "@@ -435,11 +435,10 @@ private void addOrUpdateField(K key, Field field, Object value) {\n         LOG.debug(\"Union with value: \" + value.toString() + \" at index: \" + getUnionSchema(value, schema) + \" supported for field: \" + field.name());\n         this.cassandraClient.addColumn(key, field.name(), value);\n       } else {\n-        LOG.warn(\"Union with value: \" + value.toString() + \" at index: \" + getUnionSchema(value, schema) + \" not supported for field: \" + field.name());\n+        LOG.warn(\"Union with 'null' value not supported for field: \" + field.name());\n       }\n     default:\n-      LOG.warn(\"Type: \" + type.name() + \" with value: \" + value.toString() + \n-          \" not considered for field: \" + field.name() + \". Please report this to dev@gora.apache.org\");\n+      LOG.warn(\"Type: \" + type.name() + \" not considered for field: \" + field.name() + \". Please report this to dev@gora.apache.org\");\n     }\n   }\n ", "filename": "gora-cassandra/src/main/java/org/apache/gora/cassandra/store/CassandraStore.java"}], "repo": "gora"}, {"commit": "https://github.com/apache/gora/commit/f267370f1bb3a3bc3c69550be8c2d9d7d33affc7", "parent": "https://github.com/apache/gora/commit/0126ecd900ec6c9b036db4312073d5ec8ad5f1ca", "message": "GORA-389: Document or List mapping change cause NPE in clearDirty()\n\nThis close PR #15\n\nSquashed commit of the following:\n\ncommit f07ac202b1890afd27d5e071dff5eafdc34bc044\nAuthor: Damien Raude-Morvan <drazzib@drazzib.com>\nDate:   Sat Nov 1 12:16:38 2014 +0100\n\n    GORA-389 Add MongoStore specific tests for Map/List handling\n\ncommit 75805e2eaf3c1c69573dc1b2b2df12a25aec8d25\nAuthor: Damien Raude-Morvan <damien@dictanova.com>\nDate:   Wed Oct 8 20:03:36 2014 +0200\n\n    Don't perform clearDirty() multiple times.\n\ncommit d7a6a4794f2fef492f1e116e1108b59d8e9c81bb\nAuthor: Damien Raude-Morvan <damien@dictanova.com>\nDate:   Wed Oct 8 20:04:06 2014 +0200\n\n    Return empty DirtyListWrapper or DirtyMapWrapper instead of null.", "bug_id": "gora_10", "file": [{"additions": 0, "raw_url": "https://github.com/apache/gora/raw/f267370f1bb3a3bc3c69550be8c2d9d7d33affc7/gora-mongodb/src/main/java/org/apache/gora/mongodb/query/MongoDBResult.java", "blob_url": "https://github.com/apache/gora/blob/f267370f1bb3a3bc3c69550be8c2d9d7d33affc7/gora-mongodb/src/main/java/org/apache/gora/mongodb/query/MongoDBResult.java", "sha": "5524345ac8fb00d683847eb4756a1702cbb2efca", "changes": 4, "status": "modified", "deletions": 4, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-mongodb/src/main/java/org/apache/gora/mongodb/query/MongoDBResult.java?ref=f267370f1bb3a3bc3c69550be8c2d9d7d33affc7", "patch": "@@ -74,10 +74,6 @@ protected boolean nextInner() throws IOException {\n     key = (K) obj.get(\"_id\");\n     persistent = ((MongoStore<K, T>) getDataStore()).newInstance(obj,\n         getQuery().getFields());\n-    if (persistent != null) {\n-      persistent.clearDirty();\n-    }\n-\n     return persistent != null;\n   }\n ", "filename": "gora-mongodb/src/main/java/org/apache/gora/mongodb/query/MongoDBResult.java"}, {"additions": 14, "raw_url": "https://github.com/apache/gora/raw/f267370f1bb3a3bc3c69550be8c2d9d7d33affc7/gora-mongodb/src/main/java/org/apache/gora/mongodb/store/MongoStore.java", "blob_url": "https://github.com/apache/gora/blob/f267370f1bb3a3bc3c69550be8c2d9d7d33affc7/gora-mongodb/src/main/java/org/apache/gora/mongodb/store/MongoStore.java", "sha": "2eea3b89d5fd0196019c2bd9dbe216da874115cd", "changes": 33, "status": "modified", "deletions": 19, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-mongodb/src/main/java/org/apache/gora/mongodb/store/MongoStore.java?ref=f267370f1bb3a3bc3c69550be8c2d9d7d33affc7", "patch": "@@ -369,13 +369,8 @@ public T get(final K key, final String[] fields) {\n     }\n     // Execute the query\n     DBObject res = mongoClientColl.findOne(q, proj);\n-    // Build the corresponding persistent and clears its states\n-    T persistent = newInstance(res, dbFields);\n-    if (persistent != null) {\n-      persistent.clearDirty();\n-    }\n-    // Done\n-    return persistent;\n+    // Build the corresponding persistent\n+    return newInstance(res, dbFields);\n   }\n \n   /**\n@@ -666,14 +661,14 @@ private Object fromMongoRecord(final Schema fieldSchema, final String docf,\n     return result;\n   }\n \n-  private Object fromMongoList(final String docf, final Schema fieldSchema,\n-      final BSONDecorator easybson, final Field f) {\n+  /* pp */ Object fromMongoList(final String docf, final Schema fieldSchema,\n+                       final BSONDecorator easybson, final Field f) {\n     List<Object> list = easybson.getDBList(docf);\n+    List<Object> rlist = new ArrayList<Object>();\n     if (list == null) {\n-      return null;\n+      return new DirtyListWrapper(rlist);\n     }\n \n-    List<Object> rlist = new ArrayList<Object>();\n \n     for (Object item : list) {\n       DocumentFieldType storeType = mapping.getDocumentFieldType(docf);\n@@ -684,13 +679,13 @@ private Object fromMongoList(final String docf, final Schema fieldSchema,\n     return new DirtyListWrapper<Object>(rlist);\n   }\n \n-  private Object fromMongoMap(final String docf, final Schema fieldSchema,\n-      final BSONDecorator easybson, final Field f) {\n+  /* pp */ Object fromMongoMap(final String docf, final Schema fieldSchema,\n+                      final BSONDecorator easybson, final Field f) {\n     BasicDBObject map = easybson.getDBObject(docf);\n+    Map<Utf8, Object> rmap = new HashMap<Utf8, Object>();\n     if (map == null) {\n-      return null;\n+        return new DirtyMapWrapper(rmap);\n     }\n-    Map<Utf8, Object> rmap = new HashMap<Utf8, Object>();\n     for (Entry<String, Object> e : map.entrySet()) {\n       String mapKey = e.getKey();\n       String decodedMapKey = decodeFieldKey(mapKey);\n@@ -960,12 +955,12 @@ private Object stringToMongo(final Schema fieldSchema,\n   private BasicDBObject mapToMongo(final String docf,\n       final Map<CharSequence, ?> value, final Schema fieldSchema,\n       final Type fieldType) {\n+    BasicDBObject map = new BasicDBObject();\n     // Handle null case\n     if (value == null)\n-      return null;\n+      return map;\n \n     // Handle regular cases\n-    BasicDBObject map = new BasicDBObject();\n     for (Entry<CharSequence, ?> e : value.entrySet()) {\n       String mapKey = e.getKey().toString();\n       String encodedMapKey = encodeFieldKey(mapKey);\n@@ -993,12 +988,12 @@ private BasicDBObject mapToMongo(final String docf,\n    */\n   private BasicDBList listToMongo(final String docf, final Collection<?> array,\n       final Schema fieldSchema, final Type fieldType) {\n+    BasicDBList list = new BasicDBList();\n     // Handle null case\n     if (array == null)\n-      return null;\n+      return list;\n \n     // Handle regular cases\n-    BasicDBList list = new BasicDBList();\n     for (Object item : array) {\n       DocumentFieldType storeType = mapping.getDocumentFieldType(docf);\n       Object result = toDBObject(docf, fieldSchema, fieldType, storeType, item);", "filename": "gora-mongodb/src/main/java/org/apache/gora/mongodb/store/MongoStore.java"}, {"additions": 46, "raw_url": "https://github.com/apache/gora/raw/f267370f1bb3a3bc3c69550be8c2d9d7d33affc7/gora-mongodb/src/test/java/org/apache/gora/mongodb/store/TestMongoStore.java", "blob_url": "https://github.com/apache/gora/blob/f267370f1bb3a3bc3c69550be8c2d9d7d33affc7/gora-mongodb/src/test/java/org/apache/gora/mongodb/store/TestMongoStore.java", "sha": "0f01173939e677f4bb04528b37e996b2c37c5017", "changes": 46, "status": "modified", "deletions": 0, "contents_url": "https://api.github.com/repos/apache/gora/contents/gora-mongodb/src/test/java/org/apache/gora/mongodb/store/TestMongoStore.java?ref=f267370f1bb3a3bc3c69550be8c2d9d7d33affc7", "patch": "@@ -17,15 +17,22 @@\n  */\n package org.apache.gora.mongodb.store;\n \n+import static org.junit.Assert.assertNotNull;\n+\n import java.io.IOException;\n \n import org.apache.gora.examples.generated.Employee;\n import org.apache.gora.examples.generated.WebPage;\n import org.apache.gora.mongodb.GoraMongodbTestDriver;\n+import org.apache.gora.mongodb.utils.BSONDecorator;\n import org.apache.gora.store.DataStore;\n import org.apache.gora.store.DataStoreTestBase;\n import org.junit.Before;\n import org.junit.Ignore;\n+import org.junit.Test;\n+\n+import com.mongodb.BasicDBList;\n+import com.mongodb.BasicDBObject;\n \n public class TestMongoStore extends DataStoreTestBase {\n \n@@ -74,4 +81,43 @@ public void testGet3UnionField() throws IOException, Exception {\n     // MongoStore doesn't support 3 types union field yet\n   }\n \n+  @Test\n+  public void testFromMongoList_null() throws Exception {\n+    MongoStore store = new MongoStore();\n+    BasicDBObject noField = new BasicDBObject();\n+    String field = \"myField\";\n+    Object item = store.fromMongoList(field, null, new BSONDecorator(noField),\n+        null);\n+    assertNotNull(item);\n+  }\n+\n+  @Test\n+  public void testFromMongoList_empty() throws Exception {\n+    MongoStore store = new MongoStore();\n+    String field = \"myField\";\n+    BasicDBObject emptyField = new BasicDBObject(field, new BasicDBList());\n+    Object item = store.fromMongoList(field, null,\n+        new BSONDecorator(emptyField), null);\n+    assertNotNull(item);\n+  }\n+\n+  @Test\n+  public void testFromMongoMap_null() throws Exception {\n+    MongoStore store = new MongoStore();\n+    BasicDBObject noField = new BasicDBObject();\n+    String field = \"myField\";\n+    Object item = store.fromMongoMap(field, null, new BSONDecorator(noField),\n+        null);\n+    assertNotNull(item);\n+  }\n+\n+  @Test\n+  public void testFromMongoMap_empty() throws Exception {\n+    MongoStore store = new MongoStore();\n+    String field = \"myField\";\n+    BasicDBObject emptyField = new BasicDBObject(field, new BasicDBObject());\n+    Object item = store.fromMongoMap(field, null,\n+        new BSONDecorator(emptyField), null);\n+    assertNotNull(item);\n+  }\n }", "filename": "gora-mongodb/src/test/java/org/apache/gora/mongodb/store/TestMongoStore.java"}], "repo": "gora"}]
