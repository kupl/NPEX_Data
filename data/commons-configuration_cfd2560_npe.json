[
    {
        "repo": "commons-configuration",
        "commit": "https://github.com/apache/commons-configuration/commit/cfd2560843033325d5ed7001f363e93fd5294000",
        "bug_id": "commons-configuration_cfd2560",
        "message": "CONFIGURATION-301: Fix for NPE when saving an XMLConfiguration constructed from a HierarchicalConfiguration\n\ngit-svn-id: https://svn.apache.org/repos/asf/commons/proper/configuration/trunk@603841 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/commons-configuration/commit/7a5182133f90f7d5d9981c5f0be59c315e0828ec",
        "patched_files": [
            "changes.xml",
            "XMLConfiguration.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 5,
                "raw_url": "https://github.com/apache/commons-configuration/raw/cfd2560843033325d5ed7001f363e93fd5294000/src/java/org/apache/commons/configuration/XMLConfiguration.java",
                "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/java/org/apache/commons/configuration/XMLConfiguration.java?ref=cfd2560843033325d5ed7001f363e93fd5294000",
                "filename": "src/java/org/apache/commons/configuration/XMLConfiguration.java",
                "deletions": 2,
                "sha": "041fb2f7e9386b2d55ba6a104c37cb2c7a69031a",
                "blob_url": "https://github.com/apache/commons-configuration/blob/cfd2560843033325d5ed7001f363e93fd5294000/src/java/org/apache/commons/configuration/XMLConfiguration.java",
                "patch": "@@ -200,6 +200,7 @@ public XMLConfiguration(HierarchicalConfiguration c)\n     {\n         super(c);\n         clearReferences(getRootNode());\n+        setRootElementName(getRootNode().getName());\n     }\n \n     /**\n@@ -1266,8 +1267,10 @@ static void updateAttribute(Node node, String name, char listDelimiter)\n          */\n         private Element getElement(Node node)\n         {\n-            // special treatement for root node of the hierarchy\n-            return (node.getName() != null) ? (Element) node.getReference() : document.getDocumentElement();\n+            // special treatment for root node of the hierarchy\n+            return (node.getName() != null && node.getReference() != null) ? (Element) node\n+                    .getReference()\n+                    : document.getDocumentElement();\n         }\n     }\n ",
                "changes": 7
            },
            {
                "status": "modified",
                "additions": 17,
                "raw_url": "https://github.com/apache/commons-configuration/raw/cfd2560843033325d5ed7001f363e93fd5294000/src/test/org/apache/commons/configuration/TestXMLConfiguration.java",
                "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/src/test/org/apache/commons/configuration/TestXMLConfiguration.java?ref=cfd2560843033325d5ed7001f363e93fd5294000",
                "filename": "src/test/org/apache/commons/configuration/TestXMLConfiguration.java",
                "deletions": 0,
                "sha": "ac379d31c7d6b7c2dcce37c83384b2e5f2401606",
                "blob_url": "https://github.com/apache/commons-configuration/blob/cfd2560843033325d5ed7001f363e93fd5294000/src/test/org/apache/commons/configuration/TestXMLConfiguration.java",
                "patch": "@@ -1278,6 +1278,23 @@ public void testRegisterEntityIdNull() throws IOException\n         }\n     }\n \n+    /**\n+     * Tests saving a configuration that was created from a hierarchical\n+     * configuration. This test exposes bug CONFIGURATION-301.\n+     */\n+    public void testSaveAfterCreateWithCopyConstructor()\n+            throws ConfigurationException\n+    {\n+        HierarchicalConfiguration hc = conf.configurationAt(\"element2\");\n+        conf = new XMLConfiguration(hc);\n+        conf.save(testSaveConf);\n+        XMLConfiguration checkConfig = new XMLConfiguration();\n+        checkConfig.setFile(testSaveConf);\n+        checkSavedConfig(checkConfig);\n+        assertEquals(\"Wrong name of root element\", \"element2\", checkConfig\n+                .getRootElementName());\n+    }\n+\n     /**\n      * Prepares a configuration object for testing a reload operation.\n      *",
                "changes": 17
            },
            {
                "status": "modified",
                "additions": 5,
                "raw_url": "https://github.com/apache/commons-configuration/raw/cfd2560843033325d5ed7001f363e93fd5294000/xdocs/changes.xml",
                "contents_url": "https://api.github.com/repos/apache/commons-configuration/contents/xdocs/changes.xml?ref=cfd2560843033325d5ed7001f363e93fd5294000",
                "filename": "xdocs/changes.xml",
                "deletions": 0,
                "sha": "a4616673ec529ae41c6acadd2ab846abdbeca978",
                "blob_url": "https://github.com/apache/commons-configuration/blob/cfd2560843033325d5ed7001f363e93fd5294000/xdocs/changes.xml",
                "patch": "@@ -23,6 +23,11 @@\n \n   <body>\n     <release version=\"1.6\" date=\"in SVN\" description=\"\">\n+      <action dev=\"oheger\" type=\"fix\" issue=\"CONFIGURATION-301\">\n+        Fixed a NullPointerException that could be thrown under certain\n+        circumstances when saving an XMLConfiguration that was created using\n+        the constructor that takes a HierarchicalConfiguration.\n+      </action>\n     </release>\n \n     <release version=\"1.5\" date=\"2007-11-24\" description=\"Many smaller bugfixes\">",
                "changes": 5
            }
        ],
        "unit_tests": [
            "TestXMLConfiguration.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "src/test/org/apache/commons/configuration/TestXMLConfiguration.java",
        "buggy_files": [
            "xdocs/changes.xml",
            "src/java/org/apache/commons/configuration/XMLConfiguration.java"
        ],
        "fixed": true
    }
]