{
    "directory-fortress-core_510d6f2": {
        "repo": "directory-fortress-core",
        "message": "FC-246 - fix NPE in addRoleConstraint when user not assigned to any roles",
        "commit": "https://github.com/apache/directory-fortress-core/commit/510d6f257f7d93c2951f8b9e3884ad41048d30df",
        "parent": "https://github.com/apache/directory-fortress-core/commit/b65e204e2d8069b261f4993dec1d9102dbbd8a81",
        "bug_id": "directory-fortress-core_510d6f2",
        "file": [
            {
                "sha": "968a5c29d5bba7dad7c450edc7ce8a86d549a7ab",
                "filename": "src/main/java/org/apache/directory/fortress/core/impl/AdminMgrImpl.java",
                "blob_url": "https://github.com/apache/directory-fortress-core/blob/510d6f257f7d93c2951f8b9e3884ad41048d30df/src/main/java/org/apache/directory/fortress/core/impl/AdminMgrImpl.java",
                "raw_url": "https://github.com/apache/directory-fortress-core/raw/510d6f257f7d93c2951f8b9e3884ad41048d30df/src/main/java/org/apache/directory/fortress/core/impl/AdminMgrImpl.java",
                "status": "modified",
                "changes": 3,
                "additions": 2,
                "contents_url": "https://api.github.com/repos/apache/directory-fortress-core/contents/src/main/java/org/apache/directory/fortress/core/impl/AdminMgrImpl.java?ref=510d6f257f7d93c2951f8b9e3884ad41048d30df",
                "patch": "@@ -461,7 +461,8 @@ public RoleConstraint addRoleConstraint( UserRole uRole, RoleConstraint roleCons\n         // Validate the user-role assignment exists:\n         List<String> assignedRoles = userP.getAssignedRoles( new User( uRole.getUserId() ) );\n         assertContext( CLS_NM, methodName, uRole, GlobalErrIds.URLE_NULL );\n-        if ( ! assignedRoles.stream().anyMatch( uRole.getName()::equalsIgnoreCase) )\n+        // Do not assign role constraint to user if not assigned the role itself.\n+        if ( CollectionUtils.isEmpty( assignedRoles ) || !assignedRoles.stream().anyMatch( uRole.getName()::equalsIgnoreCase) )\n         {\n             String error =  methodName + \" user [\" + uRole.getUserId() + \"] not assigned role [\" + uRole.getName() + \"]\";\n             LOG.error( error );",
                "deletions": 1
            }
        ],
        "patched_files": [
            "AdminMgrImpl.java"
        ],
        "unit_tests": [
            "AdminMgrImplTest.java"
        ]
    }
}