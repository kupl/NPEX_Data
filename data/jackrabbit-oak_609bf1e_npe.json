[
    {
        "repo": "jackrabbit-oak",
        "commit": "https://github.com/apache/jackrabbit-oak/commit/609bf1e8b6e9d0edaee161a66cd492f2c36fb8eb",
        "bug_id": "jackrabbit-oak_609bf1e",
        "message": "OAK-6486: NPE in CompositeNodeStore\n\nDon't use lazy loading for the CompositeNodeBuilder#getBaseState()\n\ngit-svn-id: https://svn.apache.org/repos/asf/jackrabbit/oak/trunk@1802912 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/jackrabbit-oak/commit/dd00cdfd720893ec08f67d108bc5787bf3cf5008",
        "patched_files": [
            "CompositeNodeBuilder.java",
            "CompositeNodeStore.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 3,
                "raw_url": "https://github.com/apache/jackrabbit-oak/raw/609bf1e8b6e9d0edaee161a66cd492f2c36fb8eb/oak-store-composite/src/main/java/org/apache/jackrabbit/oak/composite/CompositeNodeBuilder.java",
                "contents_url": "https://api.github.com/repos/apache/jackrabbit-oak/contents/oak-store-composite/src/main/java/org/apache/jackrabbit/oak/composite/CompositeNodeBuilder.java?ref=609bf1e8b6e9d0edaee161a66cd492f2c36fb8eb",
                "filename": "oak-store-composite/src/main/java/org/apache/jackrabbit/oak/composite/CompositeNodeBuilder.java",
                "deletions": 3,
                "sha": "4f66417530a626a9b236a2b821008897a4a7fedd",
                "blob_url": "https://github.com/apache/jackrabbit-oak/blob/609bf1e8b6e9d0edaee161a66cd492f2c36fb8eb/oak-store-composite/src/main/java/org/apache/jackrabbit/oak/composite/CompositeNodeBuilder.java",
                "patch": "@@ -84,7 +84,7 @@ private CompositeNodeBuilder(String path, Map<MountedNodeStore, NodeBuilder> nod\n \n     @Override\n     public CompositeNodeState getNodeState() {\n-        return new CompositeNodeState(path, new IdentityHashMap<>(buildersToNodeStates(nodeBuilders)), ctx);\n+        return new CompositeNodeState(path, buildersToNodeStates(nodeBuilders), ctx);\n     }\n \n     @Override\n@@ -93,7 +93,7 @@ public CompositeNodeState getBaseState() {\n     }\n \n     private static Map<MountedNodeStore, NodeState> buildersToNodeStates(Map<MountedNodeStore, NodeBuilder> builders) {\n-        return transformValues(builders, new Function<NodeBuilder, NodeState>() {\n+        return new IdentityHashMap<>(transformValues(builders, new Function<NodeBuilder, NodeState>() {\n             @Override\n             public NodeState apply(NodeBuilder input) {\n                 if (input.exists()) {\n@@ -102,7 +102,7 @@ public NodeState apply(NodeBuilder input) {\n                     return MISSING_NODE;\n                 }\n             }\n-        });\n+        }));\n     }\n \n     private static Map<MountedNodeStore, NodeState> buildersToBaseStates(Map<MountedNodeStore, NodeBuilder> builders) {",
                "changes": 6
            },
            {
                "status": "modified",
                "additions": 1,
                "raw_url": "https://github.com/apache/jackrabbit-oak/raw/609bf1e8b6e9d0edaee161a66cd492f2c36fb8eb/oak-store-composite/src/main/java/org/apache/jackrabbit/oak/composite/CompositeNodeStore.java",
                "contents_url": "https://api.github.com/repos/apache/jackrabbit-oak/contents/oak-store-composite/src/main/java/org/apache/jackrabbit/oak/composite/CompositeNodeStore.java?ref=609bf1e8b6e9d0edaee161a66cd492f2c36fb8eb",
                "filename": "oak-store-composite/src/main/java/org/apache/jackrabbit/oak/composite/CompositeNodeStore.java",
                "deletions": 1,
                "sha": "cbbb348ae84af52539f12fc6de311db5d1393974",
                "blob_url": "https://github.com/apache/jackrabbit-oak/blob/609bf1e8b6e9d0edaee161a66cd492f2c36fb8eb/oak-store-composite/src/main/java/org/apache/jackrabbit/oak/composite/CompositeNodeStore.java",
                "patch": "@@ -324,7 +324,7 @@ public NodeState retrieve(String checkpoint) {\n             LOG.warn(\"Checkpoint {} doesn't exist. Debug info:\\n{}\", checkpoint, checkpointDebugInfo());\n             return null;\n         }\n-        return new CompositeNodeState(\"/\", nodeStates, ctx);\n+        return ctx.createRootNodeState(nodeStates);\n     }\n \n     @Override",
                "changes": 2
            },
            {
                "status": "modified",
                "additions": 1,
                "raw_url": "https://github.com/apache/jackrabbit-oak/raw/609bf1e8b6e9d0edaee161a66cd492f2c36fb8eb/oak-store-composite/src/test/java/org/apache/jackrabbit/oak/composite/CompositeChildrenCountTest.java",
                "contents_url": "https://api.github.com/repos/apache/jackrabbit-oak/contents/oak-store-composite/src/test/java/org/apache/jackrabbit/oak/composite/CompositeChildrenCountTest.java?ref=609bf1e8b6e9d0edaee161a66cd492f2c36fb8eb",
                "filename": "oak-store-composite/src/test/java/org/apache/jackrabbit/oak/composite/CompositeChildrenCountTest.java",
                "deletions": 1,
                "sha": "48ade28651a67f98ee1da953175b6dcea4c26ebc",
                "blob_url": "https://github.com/apache/jackrabbit-oak/blob/609bf1e8b6e9d0edaee161a66cd492f2c36fb8eb/oak-store-composite/src/test/java/org/apache/jackrabbit/oak/composite/CompositeChildrenCountTest.java",
                "patch": "@@ -169,7 +169,7 @@ public TestingNodeState configureMount(String mountPath, String... children) {\n         }\n \n         public CompositeNodeState getNodeState() {\n-            return new CompositeNodeState(\"/\", rootStates, ctx);\n+            return ctx.createRootNodeState(rootStates);\n         }\n \n         public CompositeNodeStoreBuilder clear() {",
                "changes": 2
            }
        ],
        "unit_tests": [
            "CompositeNodeStoreTest.java",
            "CompositeChildrenCountTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "oak-store-composite/src/test/java/org/apache/jackrabbit/oak/composite/CompositeChildrenCountTest.java",
        "buggy_files": [
            "oak-store-composite/src/main/java/org/apache/jackrabbit/oak/composite/CompositeNodeBuilder.java",
            "oak-store-composite/src/main/java/org/apache/jackrabbit/oak/composite/CompositeNodeStore.java"
        ],
        "fixed": true
    }
]