[
    {
        "repo": "sling-org-apache-sling-resourceresolver",
        "commit": "https://github.com/apache/sling-org-apache-sling-resourceresolver/commit/d6f6fac59575bc6ee867e9348a453722dc693e8d",
        "bug_id": "sling-org-apache-sling-resourceresolver_d6f6fac",
        "message": "SLING-4847 - NullPointerException in MapEntries handleEvent\n\ngit-svn-id: https://svn.apache.org/repos/asf/sling/trunk@1688777 13f79535-47bb-0310-9956-ffa450edef68",
        "parent": "https://github.com/apache/sling-org-apache-sling-resourceresolver/commit/1d39cd1de8080d1d1ced8671eeb1c2b9e0e9d7d7",
        "patched_files": [
            "MapEntries.java"
        ],
        "file": [
            {
                "status": "modified",
                "additions": 12,
                "raw_url": "https://github.com/apache/sling-org-apache-sling-resourceresolver/raw/d6f6fac59575bc6ee867e9348a453722dc693e8d/src/main/java/org/apache/sling/resourceresolver/impl/mapping/MapEntries.java",
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-resourceresolver/contents/src/main/java/org/apache/sling/resourceresolver/impl/mapping/MapEntries.java?ref=d6f6fac59575bc6ee867e9348a453722dc693e8d",
                "filename": "src/main/java/org/apache/sling/resourceresolver/impl/mapping/MapEntries.java",
                "deletions": 9,
                "sha": "33bb9a57afe91942fac96353554148888fd6b713",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-resourceresolver/blob/d6f6fac59575bc6ee867e9348a453722dc693e8d/src/main/java/org/apache/sling/resourceresolver/impl/mapping/MapEntries.java",
                "patch": "@@ -297,17 +297,20 @@ private boolean doNodeAdded(String path, boolean refreshed) {\n         }\n         try {\n             Resource resource = resolver.getResource(path);\n-            final ValueMap props = resource.adaptTo(ValueMap.class);\n-            if (props.containsKey(PROP_VANITY_PATH)) {\n-                doAddVanity(path);\n-            }\n-            if (props.containsKey(ResourceResolverImpl.PROP_ALIAS)) {\n-                doAddAlias(path);\n-            }\n-            if (path.startsWith(this.mapRoot)) {\n-                doUpdateConfiguration();\n+            if (resource != null) {\n+                final ValueMap props = resource.adaptTo(ValueMap.class);\n+                if (props.containsKey(PROP_VANITY_PATH)) {\n+                    doAddVanity(path);\n+                }\n+                if (props.containsKey(ResourceResolverImpl.PROP_ALIAS)) {\n+                    doAddAlias(path);\n+                }\n+                if (path.startsWith(this.mapRoot)) {\n+                    doUpdateConfiguration();\n+                }\n             }\n             sendChangeEvent();\n+            \n         } finally {\n             this.initializing.unlock();\n         }",
                "changes": 21
            },
            {
                "status": "modified",
                "additions": 9,
                "raw_url": "https://github.com/apache/sling-org-apache-sling-resourceresolver/raw/d6f6fac59575bc6ee867e9348a453722dc693e8d/src/test/java/org/apache/sling/resourceresolver/impl/mapping/MapEntriesTest.java",
                "contents_url": "https://api.github.com/repos/apache/sling-org-apache-sling-resourceresolver/contents/src/test/java/org/apache/sling/resourceresolver/impl/mapping/MapEntriesTest.java?ref=d6f6fac59575bc6ee867e9348a453722dc693e8d",
                "filename": "src/test/java/org/apache/sling/resourceresolver/impl/mapping/MapEntriesTest.java",
                "deletions": 0,
                "sha": "0651607e0a8f3ac057c1f459c6777346a49b9a28",
                "blob_url": "https://github.com/apache/sling-org-apache-sling-resourceresolver/blob/d6f6fac59575bc6ee867e9348a453722dc693e8d/src/test/java/org/apache/sling/resourceresolver/impl/mapping/MapEntriesTest.java",
                "patch": "@@ -1359,4 +1359,13 @@ public void test_isValidVanityPath() throws Exception {\n         when(resource.adaptTo(ValueMap.class)).thenReturn(mock(ValueMap.class));\n         assertTrue((Boolean)method.invoke(mapEntries, resource));\n     }\n+    \n+    @Test\n+    //SLING-4847\n+    public void test_doNodeAdded1() throws Exception { \n+        Method method = MapEntries.class.getDeclaredMethod(\"doNodeAdded\", String.class, boolean.class);\n+        method.setAccessible(true);\n+        Boolean resfreshed = (Boolean ) method.invoke(mapEntries, \"/node\", true);\n+        assertTrue(resfreshed.booleanValue());\n+    }\n }",
                "changes": 9
            }
        ],
        "unit_tests": [
            "MapEntriesTest.java"
        ]
    },
    {
        "buggy": false,
        "test_file": "src/test/java/org/apache/sling/resourceresolver/impl/mapping/MapEntriesTest.java",
        "buggy_files": [
            "src/main/java/org/apache/sling/resourceresolver/impl/mapping/MapEntries.java"
        ],
        "fixed": true
    }
]