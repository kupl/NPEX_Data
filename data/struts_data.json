[
    {
        "parent": "https://github.com/apache/struts/commit/11999d148ef879683195a8327ac67001d391a0c2",
        "bug_id": "struts_1",
        "file": [
            {
                "additions": 10,
                "sha": "52437895a41e5cd8f33716e5828b0f1fab243a76",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/84cf17ebb1a63188bb7204636d08ae4f7544f09d/core/src/main/java/com/opensymphony/xwork2/ognl/OgnlUtil.java",
                "deletions": 5,
                "filename": "core/src/main/java/com/opensymphony/xwork2/ognl/OgnlUtil.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/com/opensymphony/xwork2/ognl/OgnlUtil.java?ref=84cf17ebb1a63188bb7204636d08ae4f7544f09d",
                "patch": "@@ -194,11 +194,16 @@ protected void setDisallowProxyMemberAccess(String disallowProxyMemberAccess) {\n      */\n     @Inject(value = StrutsConstants.STRUTS_OGNL_EXPRESSION_MAX_LENGTH, required = false)\n     protected void applyExpressionMaxLength(String maxLength) {\n-        if (maxLength == null || maxLength.isEmpty()) {\n-            // user is going to disable this functionality\n-            Ognl.applyExpressionMaxLength(null);\n-        } else {\n-            Ognl.applyExpressionMaxLength(Integer.parseInt(maxLength));\n+        try {\n+            if (maxLength == null || maxLength.isEmpty()) {\n+                // user is going to disable this functionality\n+                Ognl.applyExpressionMaxLength(null);\n+            } else {\n+                Ognl.applyExpressionMaxLength(Integer.parseInt(maxLength));\n+            }\n+        } catch (Exception ex) {\n+            LOG.warn(\"Unable to set OGNL Expression Max Length {}.\", maxLength);  // Help configuration debugging.\n+            throw ex;\n         }\n     }\n ",
                "changes": 15,
                "blob_url": "https://github.com/apache/struts/blob/84cf17ebb1a63188bb7204636d08ae4f7544f09d/core/src/main/java/com/opensymphony/xwork2/ognl/OgnlUtil.java"
            },
            {
                "additions": 2,
                "sha": "c44744b59c986ee7a40ac0410ecf227211486eb3",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/84cf17ebb1a63188bb7204636d08ae4f7544f09d/core/src/main/java/com/opensymphony/xwork2/ognl/OgnlValueStack.java",
                "deletions": 2,
                "filename": "core/src/main/java/com/opensymphony/xwork2/ognl/OgnlValueStack.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/com/opensymphony/xwork2/ognl/OgnlValueStack.java?ref=84cf17ebb1a63188bb7204636d08ae4f7544f09d",
                "patch": "@@ -203,7 +203,7 @@ protected void handleRuntimeException(String expr, Object value, boolean throwEx\n     }\n \n     protected void handleOgnlException(String expr, Object value, boolean throwExceptionOnFailure, OgnlException e) {\n-        if (e.getReason() instanceof SecurityException) {\n+        if (e != null && e.getReason() instanceof SecurityException) {\n             LOG.warn(\"Could not evaluate this expression due to security constraints: [{}]\", expr, e);\n         }\n     \tboolean shouldLog = shouldLogMissingPropertyWarning(e);\n@@ -329,7 +329,7 @@ private Object tryFindValueWhenExpressionIsNotNull(String expr, Class asType) th\n \n     protected Object handleOgnlException(String expr, boolean throwExceptionOnFailure, OgnlException e) {\n         Object ret = null;\n-        if (e.getReason() instanceof SecurityException) {\n+        if (e != null && e.getReason() instanceof SecurityException) {\n             LOG.warn(\"Could not evaluate this expression due to security constraints: [{}]\", expr, e);\n         } else {\n             ret = findInContext(expr);",
                "changes": 4,
                "blob_url": "https://github.com/apache/struts/blob/84cf17ebb1a63188bb7204636d08ae4f7544f09d/core/src/main/java/com/opensymphony/xwork2/ognl/OgnlValueStack.java"
            },
            {
                "additions": 4,
                "sha": "ed850bdc5090e1324ed9c1f709dc888053761d9a",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/84cf17ebb1a63188bb7204636d08ae4f7544f09d/core/src/main/resources/struts-default.xml",
                "deletions": 0,
                "filename": "core/src/main/resources/struts-default.xml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/resources/struts-default.xml?ref=84cf17ebb1a63188bb7204636d08ae4f7544f09d",
                "patch": "@@ -45,6 +45,7 @@\n                 java.lang.ClassLoader,\n                 java.lang.Shutdown,\n                 java.lang.ProcessBuilder,\n+                sun.misc.Unsafe,\n                 com.opensymphony.xwork2.ActionContext\" />\n \n     <!-- this must be valid regex, each '.' in package name must be escaped! -->\n@@ -56,11 +57,14 @@\n               value=\"\n                 ognl.,\n                 java.io.,\n+                java.net.,\n+                java.nio.,\n                 javax.,\n                 freemarker.core.,\n                 freemarker.template.,\n                 freemarker.ext.jsp.,\n                 freemarker.ext.rhino.,\n+                sun.misc.,\n                 sun.reflect.,\n                 javassist.,\n                 org.apache.velocity.,",
                "changes": 4,
                "blob_url": "https://github.com/apache/struts/blob/84cf17ebb1a63188bb7204636d08ae4f7544f09d/core/src/main/resources/struts-default.xml"
            }
        ],
        "repo": "struts",
        "message": "Minor follow-up changes to PR #371\n- added some additional exclusions in struts-default.xml.\n- added log warning that specifies the value of maxLength involved if\n  applyExpressionMaxLength(maxLength) fails.\n- added null guards to two handleOgnlException() methods that could\n  result in an NPE with #371 changes (a null OgnlException parameter\n  was permissible previously, correct or not).\n\n(cherry picked from commit e2b644a)",
        "commit": "https://github.com/apache/struts/commit/84cf17ebb1a63188bb7204636d08ae4f7544f09d"
    },
    {
        "parent": "https://github.com/apache/struts/commit/a29292046298cd634dc52cec2ae9f0033a249336",
        "bug_id": "struts_2",
        "file": [
            {
                "additions": 26,
                "sha": "00b651db1f19ff70596923496bf2f022ac7c0734",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/6e691ffdbf8f8c673d0d851482bf0a1ea1a4fc2d/plugins/jasperreports/pom.xml",
                "deletions": 0,
                "filename": "plugins/jasperreports/pom.xml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/jasperreports/pom.xml?ref=6e691ffdbf8f8c673d0d851482bf0a1ea1a4fc2d",
                "patch": "@@ -49,6 +49,32 @@\n                 </exclusion>\n             </exclusions>\n         </dependency>\n+        <dependency>\n+            <groupId>org.apache.struts</groupId>\n+            <artifactId>struts2-junit-plugin</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>javax.servlet</groupId>\n+            <artifactId>jsp-api</artifactId>\n+            <scope>provided</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>javax.servlet</groupId>\n+            <artifactId>javax.servlet-api</artifactId>\n+            <version>3.1.0</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.springframework</groupId>\n+            <artifactId>spring-web</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.easymock</groupId>\n+            <artifactId>easymock</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n     </dependencies>\n     <properties>\n     \t<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>",
                "changes": 26,
                "blob_url": "https://github.com/apache/struts/blob/6e691ffdbf8f8c673d0d851482bf0a1ea1a4fc2d/plugins/jasperreports/pom.xml"
            },
            {
                "additions": 4,
                "sha": "c79e1b6c7761aa11d10b8e2ac09e6ff63d8c9f4e",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/6e691ffdbf8f8c673d0d851482bf0a1ea1a4fc2d/plugins/jasperreports/src/main/java/org/apache/struts2/views/jasperreports/JasperReportsResult.java",
                "deletions": 1,
                "filename": "plugins/jasperreports/src/main/java/org/apache/struts2/views/jasperreports/JasperReportsResult.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/jasperreports/src/main/java/org/apache/struts2/views/jasperreports/JasperReportsResult.java?ref=6e691ffdbf8f8c673d0d851482bf0a1ea1a4fc2d",
                "patch": "@@ -384,7 +384,10 @@ protected void doExecute(String finalLocation, ActionInvocation invocation) thro\n             throw new ServletException(e.getMessage(), e);\n         } finally {\n             try {\n-                conn.close();\n+                if (conn != null) {\n+                    // avoid NPE if connection was not used for the report\n+                    conn.close();\n+                }\n             } catch (Exception e) {\n                 LOG.warn(\"Could not close db connection properly\", e);\n             }",
                "changes": 5,
                "blob_url": "https://github.com/apache/struts/blob/6e691ffdbf8f8c673d0d851482bf0a1ea1a4fc2d/plugins/jasperreports/src/main/java/org/apache/struts2/views/jasperreports/JasperReportsResult.java"
            },
            {
                "additions": 89,
                "sha": "1bf55acf88b68b09edd2c08d73692a6610220101",
                "status": "added",
                "raw_url": "https://github.com/apache/struts/raw/6e691ffdbf8f8c673d0d851482bf0a1ea1a4fc2d/plugins/jasperreports/src/test/java/org/apache/struts2/views/jasperreports/JasperReportsResultTest.java",
                "deletions": 0,
                "filename": "plugins/jasperreports/src/test/java/org/apache/struts2/views/jasperreports/JasperReportsResultTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/jasperreports/src/test/java/org/apache/struts2/views/jasperreports/JasperReportsResultTest.java?ref=6e691ffdbf8f8c673d0d851482bf0a1ea1a4fc2d",
                "patch": "@@ -0,0 +1,89 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.struts2.views.jasperreports;\n+\n+import com.opensymphony.xwork2.ActionContext;\n+import com.opensymphony.xwork2.mock.MockActionInvocation;\n+import com.opensymphony.xwork2.util.ClassLoaderUtil;\n+import com.opensymphony.xwork2.util.ValueStack;\n+import net.sf.jasperreports.engine.JasperCompileManager;\n+import org.apache.struts2.StrutsStatics;\n+import org.apache.struts2.StrutsTestCase;\n+import org.easymock.IAnswer;\n+import org.springframework.mock.web.MockHttpServletRequest;\n+import org.springframework.mock.web.MockHttpServletResponse;\n+import org.springframework.mock.web.MockServletContext;\n+\n+import java.net.URL;\n+import java.sql.Connection;\n+\n+import static org.easymock.EasyMock.createMock;\n+import static org.easymock.EasyMock.expectLastCall;\n+import static org.easymock.EasyMock.replay;\n+import static org.easymock.EasyMock.verify;\n+\n+public class JasperReportsResultTest extends StrutsTestCase {\n+    private MockActionInvocation invocation;\n+    private ValueStack stack;\n+\n+    public void testConnClose() throws Exception {\n+        JasperReportsResult result = new JasperReportsResult();\n+        URL url = ClassLoaderUtil.getResource(\"org/apache/struts2/views/jasperreports/empty.jrxml\", this.getClass());\n+        JasperCompileManager.compileReportToFile(url.getFile(), url.getFile() + \".jasper\");\n+        result.setLocation(\"org/apache/struts2/views/jasperreports/empty.jrxml.jasper\");\n+        result.setFormat(JasperReportConstants.FORMAT_XML);\n+\n+        Connection connection = createMock(Connection.class);\n+        final Boolean[] closed = {false};\n+        connection.close();\n+        expectLastCall().andAnswer(new IAnswer() {\n+            @Override\n+            public Object answer() throws Throwable {\n+                closed[0] = true;\n+                return null;\n+            }\n+        });\n+        replay(connection);\n+\n+        stack.push(connection);\n+        result.setConnection(\"top\");\n+\n+        assertFalse(closed[0]);\n+        result.execute(this.invocation);\n+        verify(connection);\n+        assertTrue(closed[0]);\n+    }\n+\n+    @Override\n+    protected void setUp() throws Exception {\n+        super.setUp();\n+        MockHttpServletResponse response = new MockHttpServletResponse();\n+        MockHttpServletRequest request = new MockHttpServletRequest();\n+        request.setRequestURI(\"http://sumeruri\");\n+        ActionContext context = ActionContext.getContext();\n+        context.put(StrutsStatics.HTTP_RESPONSE, response);\n+        context.put(StrutsStatics.HTTP_REQUEST, request);\n+        this.stack = context.getValueStack();\n+        MockServletContext servletContext = new MockServletContext();\n+        context.put(StrutsStatics.SERVLET_CONTEXT, servletContext);\n+        this.invocation = new MockActionInvocation();\n+        this.invocation.setInvocationContext(context);\n+        this.invocation.setStack(this.stack);\n+    }\n+}",
                "changes": 89,
                "blob_url": "https://github.com/apache/struts/blob/6e691ffdbf8f8c673d0d851482bf0a1ea1a4fc2d/plugins/jasperreports/src/test/java/org/apache/struts2/views/jasperreports/JasperReportsResultTest.java"
            },
            {
                "additions": 23,
                "sha": "816d8609f49bee1bd5a82cdea4241e5894fcba9f",
                "status": "added",
                "raw_url": "https://github.com/apache/struts/raw/6e691ffdbf8f8c673d0d851482bf0a1ea1a4fc2d/plugins/jasperreports/src/test/resources/org/apache/struts2/views/jasperreports/empty.jrxml",
                "deletions": 0,
                "filename": "plugins/jasperreports/src/test/resources/org/apache/struts2/views/jasperreports/empty.jrxml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/jasperreports/src/test/resources/org/apache/struts2/views/jasperreports/empty.jrxml?ref=6e691ffdbf8f8c673d0d851482bf0a1ea1a4fc2d",
                "patch": "@@ -0,0 +1,23 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+-->\n+<jasperReport xmlns=\"http://jasperreports.sourceforge.net/jasperreports\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd\" name=\"test\" pageWidth=\"842\" pageHeight=\"595\" orientation=\"Landscape\" columnWidth=\"802\" leftMargin=\"20\" rightMargin=\"20\" topMargin=\"20\" bottomMargin=\"20\" uuid=\"e65f69ca-7c62-4b4b-abc6-2e1a8710f23e\">\n+</jasperReport>\n\\ No newline at end of file",
                "changes": 23,
                "blob_url": "https://github.com/apache/struts/blob/6e691ffdbf8f8c673d0d851482bf0a1ea1a4fc2d/plugins/jasperreports/src/test/resources/org/apache/struts2/views/jasperreports/empty.jrxml"
            }
        ],
        "repo": "struts",
        "message": "Merge pull request #212 from zepernick/master\n\nWW-4923 Null check to avoid NPE when not passing a JDBC connection",
        "commit": "https://github.com/apache/struts/commit/6e691ffdbf8f8c673d0d851482bf0a1ea1a4fc2d"
    },
    {
        "parent": "https://github.com/apache/struts/commit/2dd9cb555a857f3b8da221193b28aa8c398fd186",
        "bug_id": "struts_3",
        "file": [
            {
                "additions": 3,
                "sha": "253048bc4037f7b640df0ad3e29af08787e6f3b0",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/413d67bd28ea414e586e596a50d68d9d2d0312a2/xwork-core/src/main/java/com/opensymphony/xwork2/config/providers/XmlConfigurationProvider.java",
                "deletions": 1,
                "filename": "xwork-core/src/main/java/com/opensymphony/xwork2/config/providers/XmlConfigurationProvider.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/main/java/com/opensymphony/xwork2/config/providers/XmlConfigurationProvider.java?ref=413d67bd28ea414e586e596a50d68d9d2d0312a2",
                "patch": "@@ -37,11 +37,13 @@\n import com.opensymphony.xwork2.util.location.LocationUtils;\n import com.opensymphony.xwork2.util.logging.Logger;\n import com.opensymphony.xwork2.util.logging.LoggerFactory;\n+\n import org.w3c.dom.Document;\n import org.w3c.dom.Element;\n import org.w3c.dom.Node;\n import org.w3c.dom.NodeList;\n import org.xml.sax.InputSource;\n+import org.apache.commons.lang3.ObjectUtils;\n import org.apache.commons.lang3.StringUtils;\n \n import java.io.IOException;\n@@ -426,7 +428,7 @@ protected void addAction(Element actionElement, PackageConfig.Builder packageCon\n         } else {\n             if (!verifyAction(className, name, location)) {\n                 if (LOG.isErrorEnabled())\n-                    LOG.error(\"Unable to verify action [#0] with class [#1], from [#2]\", name, className, location.toString());\n+                    LOG.error(\"Unable to verify action [#0] with class [#1], from [#2]\", name, className, location);\n                 return;\n             }\n         }",
                "changes": 4,
                "blob_url": "https://github.com/apache/struts/blob/413d67bd28ea414e586e596a50d68d9d2d0312a2/xwork-core/src/main/java/com/opensymphony/xwork2/config/providers/XmlConfigurationProvider.java"
            },
            {
                "additions": 2,
                "sha": "ab6efc0c359042c9ffc5841fb2d95878a3336392",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/413d67bd28ea414e586e596a50d68d9d2d0312a2/xwork-core/src/main/java/com/opensymphony/xwork2/conversion/impl/NumberConverter.java",
                "deletions": 0,
                "filename": "xwork-core/src/main/java/com/opensymphony/xwork2/conversion/impl/NumberConverter.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/main/java/com/opensymphony/xwork2/conversion/impl/NumberConverter.java?ref=413d67bd28ea414e586e596a50d68d9d2d0312a2",
                "patch": "@@ -95,6 +95,8 @@ protected boolean isInRange(Number value, String stringValue, Class toType) {\n                 bigValue = new BigInteger(stringValue);\n                 lowerBound = BigInteger.valueOf(Long.MIN_VALUE);\n                 upperBound = BigInteger.valueOf(Long.MAX_VALUE);\n+            } else {\n+                throw new IllegalArgumentException(\"Unexpected numeric type: \" + toType.getName());\n             }\n         } catch (NumberFormatException e) {\n             //shoult it fail here? BigInteger doesnt seem to be so nice parsing numbers as NumberFormat",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/413d67bd28ea414e586e596a50d68d9d2d0312a2/xwork-core/src/main/java/com/opensymphony/xwork2/conversion/impl/NumberConverter.java"
            },
            {
                "additions": 4,
                "sha": "1203a49d810f2c4cc65cefe524b8f0919f2e1669",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/413d67bd28ea414e586e596a50d68d9d2d0312a2/xwork-core/src/main/java/com/opensymphony/xwork2/util/NamedVariablePatternMatcher.java",
                "deletions": 1,
                "filename": "xwork-core/src/main/java/com/opensymphony/xwork2/util/NamedVariablePatternMatcher.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/main/java/com/opensymphony/xwork2/util/NamedVariablePatternMatcher.java?ref=413d67bd28ea414e586e596a50d68d9d2d0312a2",
                "patch": "@@ -80,7 +80,10 @@ public CompiledPattern compilePattern(String data) {\n                 char c = data.charAt(x);\n                 switch (c) {\n                     case '{' :  varName = new StringBuilder(); break;\n-                    case '}' :  varNames.add(varName.toString());\n+                    case '}' :  if (varName == null) {\n+                                    throw new IllegalArgumentException(\"Mismatched braces in pattern\");\n+                                }\n+                                varNames.add(varName.toString());\n                                 regex.append(\"([^/]+)\");\n                                 varName = null;\n                                 break;",
                "changes": 5,
                "blob_url": "https://github.com/apache/struts/blob/413d67bd28ea414e586e596a50d68d9d2d0312a2/xwork-core/src/main/java/com/opensymphony/xwork2/util/NamedVariablePatternMatcher.java"
            },
            {
                "additions": 2,
                "sha": "47e764253325cf46498dedd58f34804d8a80bd60",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/413d67bd28ea414e586e596a50d68d9d2d0312a2/xwork-core/src/main/java/com/opensymphony/xwork2/util/finder/ResourceFinder.java",
                "deletions": 5,
                "filename": "xwork-core/src/main/java/com/opensymphony/xwork2/util/finder/ResourceFinder.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/main/java/com/opensymphony/xwork2/util/finder/ResourceFinder.java?ref=413d67bd28ea414e586e596a50d68d9d2d0312a2",
                "patch": "@@ -1000,9 +1000,8 @@ private static void readJarDirectoryEntries(URL location, String basePath, Set<S\n     private Properties loadProperties(URL resource) throws IOException {\n         InputStream in = resource.openStream();\n \n-        BufferedInputStream reader = null;\n+        BufferedInputStream reader = new BufferedInputStream(in);\n         try {\n-            reader = new BufferedInputStream(in);\n             Properties properties = new Properties();\n             properties.load(reader);\n \n@@ -1018,12 +1017,10 @@ private Properties loadProperties(URL resource) throws IOException {\n \n     private String readContents(URL resource) throws IOException {\n         InputStream in = resource.openStream();\n-        BufferedInputStream reader = null;\n         StringBuilder sb = new StringBuilder();\n \n+        BufferedInputStream reader = new BufferedInputStream(in);\n         try {\n-            reader = new BufferedInputStream(in);\n-\n             int b = reader.read();\n             while (b != -1) {\n                 sb.append((char) b);",
                "changes": 7,
                "blob_url": "https://github.com/apache/struts/blob/413d67bd28ea414e586e596a50d68d9d2d0312a2/xwork-core/src/main/java/com/opensymphony/xwork2/util/finder/ResourceFinder.java"
            },
            {
                "additions": 6,
                "sha": "fd2c55d4b60a6573e58ad5294d2aa7c8ddfa07c2",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/413d67bd28ea414e586e596a50d68d9d2d0312a2/xwork-core/src/main/java/com/opensymphony/xwork2/util/location/LocationUtils.java",
                "deletions": 6,
                "filename": "xwork-core/src/main/java/com/opensymphony/xwork2/util/location/LocationUtils.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/main/java/com/opensymphony/xwork2/util/location/LocationUtils.java?ref=413d67bd28ea414e586e596a50d68d9d2d0312a2",
                "patch": "@@ -263,14 +263,14 @@ public static Location getLocation(Object obj, String description) {\n                     newFinders.remove(ref);\n                     finders = newFinders;\n                 }\n-            }\n-            \n-            Location result = finder.getLocation(obj, description);\n-            if (result != null) {\n-                return result;\n+            } else {\n+                Location result = finder.getLocation(obj, description);\n+                if (result != null) {\n+                    return result;\n+                }\n             }\n         }\n-        \n+\n         if (obj instanceof Throwable) {\n         \t\tThrowable t = (Throwable) obj;\n         \t\tStackTraceElement[] stack = t.getStackTrace();",
                "changes": 12,
                "blob_url": "https://github.com/apache/struts/blob/413d67bd28ea414e586e596a50d68d9d2d0312a2/xwork-core/src/main/java/com/opensymphony/xwork2/util/location/LocationUtils.java"
            },
            {
                "additions": 19,
                "sha": "3e284e5b8247be74e2d638a4f1b9f2079e3dc578",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/413d67bd28ea414e586e596a50d68d9d2d0312a2/xwork-core/src/test/java/com/opensymphony/xwork2/util/NamedVariablePatternMatcherTest.java",
                "deletions": 3,
                "filename": "xwork-core/src/test/java/com/opensymphony/xwork2/util/NamedVariablePatternMatcherTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/test/java/com/opensymphony/xwork2/util/NamedVariablePatternMatcherTest.java?ref=413d67bd28ea414e586e596a50d68d9d2d0312a2",
                "patch": "@@ -15,16 +15,23 @@\n  */\n package com.opensymphony.xwork2.util;\n \n-import com.opensymphony.xwork2.util.NamedVariablePatternMatcher.CompiledPattern;\n-import junit.framework.TestCase;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n \n import java.util.Arrays;\n import java.util.HashMap;\n import java.util.Map;\n import java.util.regex.Pattern;\n \n-public class NamedVariablePatternMatcherTest extends TestCase {\n+import org.junit.Test;\n+\n+import com.opensymphony.xwork2.util.NamedVariablePatternMatcher.CompiledPattern;\n+\n+public class NamedVariablePatternMatcherTest {\n \n+    @Test\n     public void testCompile() {\n         NamedVariablePatternMatcher matcher = new NamedVariablePatternMatcher();\n \n@@ -46,6 +53,14 @@ public void testCompile() {\n         assertFalse(pattern.getPattern().matcher(\"foo/star/jie\").matches());\n     }\n \n+    @Test(expected = IllegalArgumentException.class)\n+    public void testCompileWithMismatchedBracketsParses() {\n+        NamedVariablePatternMatcher matcher = new NamedVariablePatternMatcher();\n+\n+        matcher.compilePattern(\"}\");\n+    }\n+\n+    @Test\n     public void testMatch() {\n         NamedVariablePatternMatcher matcher = new NamedVariablePatternMatcher();\n \n@@ -56,6 +71,7 @@ public void testMatch() {\n         assertEquals(\"baz\", vars.get(\"bar\"));\n     }\n \n+    @Test\n     public void testIsLiteral() {\n         NamedVariablePatternMatcher matcher = new NamedVariablePatternMatcher();\n ",
                "changes": 22,
                "blob_url": "https://github.com/apache/struts/blob/413d67bd28ea414e586e596a50d68d9d2d0312a2/xwork-core/src/test/java/com/opensymphony/xwork2/util/NamedVariablePatternMatcherTest.java"
            }
        ],
        "repo": "struts",
        "message": "WW-4360 Fixes potential NullPointerExceptions",
        "commit": "https://github.com/apache/struts/commit/413d67bd28ea414e586e596a50d68d9d2d0312a2"
    },
    {
        "parent": "https://github.com/apache/struts/commit/02c347afd4e83ea147be434739ceaeb83044393a",
        "bug_id": "struts_4",
        "file": [
            {
                "additions": 4,
                "sha": "bb089158db58f146a65c5ccdc25f4966286010d7",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/8bf6605e6bc08cbc3e7bfd70d03ac5f988808405/plugins/jasperreports/src/main/java/org/apache/struts2/views/jasperreports/JasperReportsResult.java",
                "deletions": 1,
                "filename": "plugins/jasperreports/src/main/java/org/apache/struts2/views/jasperreports/JasperReportsResult.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/jasperreports/src/main/java/org/apache/struts2/views/jasperreports/JasperReportsResult.java?ref=8bf6605e6bc08cbc3e7bfd70d03ac5f988808405",
                "patch": "@@ -384,7 +384,10 @@ protected void doExecute(String finalLocation, ActionInvocation invocation) thro\n             throw new ServletException(e.getMessage(), e);\n         } finally {\n             try {\n-                conn.close();\n+                if(conn != null) {\n+                    // avoid NPE if connection was not used for the report\n+                    conn.close();\n+                }\n             } catch (Exception e) {\n                 LOG.warn(\"Could not close db connection properly\", e);\n             }",
                "changes": 5,
                "blob_url": "https://github.com/apache/struts/blob/8bf6605e6bc08cbc3e7bfd70d03ac5f988808405/plugins/jasperreports/src/main/java/org/apache/struts2/views/jasperreports/JasperReportsResult.java"
            }
        ],
        "repo": "struts",
        "message": "WW-4923 Null check to avoid NPE when not passing a JDBC connection to the jasper report",
        "commit": "https://github.com/apache/struts/commit/8bf6605e6bc08cbc3e7bfd70d03ac5f988808405"
    },
    {
        "parent": "https://github.com/apache/struts/commit/413d67bd28ea414e586e596a50d68d9d2d0312a2",
        "bug_id": "struts_5",
        "file": [
            {
                "additions": 2,
                "sha": "a61d5e2a6e021d2daadbee15751be0ef3652cfa4",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/47d1fe04dc1790473e9bd464d84e65ca76368ba5/xwork-core/src/main/java/com/opensymphony/xwork2/config/providers/XmlConfigurationProvider.java",
                "deletions": 1,
                "filename": "xwork-core/src/main/java/com/opensymphony/xwork2/config/providers/XmlConfigurationProvider.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/main/java/com/opensymphony/xwork2/config/providers/XmlConfigurationProvider.java?ref=47d1fe04dc1790473e9bd464d84e65ca76368ba5",
                "patch": "@@ -427,8 +427,9 @@ protected void addAction(Element actionElement, PackageConfig.Builder packageCon\n \n         } else {\n             if (!verifyAction(className, name, location)) {\n-                if (LOG.isErrorEnabled())\n+                if (LOG.isErrorEnabled()) {\n                     LOG.error(\"Unable to verify action [#0] with class [#1], from [#2]\", name, className, location);\n+                }\n                 return;\n             }\n         }",
                "changes": 3,
                "blob_url": "https://github.com/apache/struts/blob/47d1fe04dc1790473e9bd464d84e65ca76368ba5/xwork-core/src/main/java/com/opensymphony/xwork2/config/providers/XmlConfigurationProvider.java"
            }
        ],
        "repo": "struts",
        "message": "WW-4360 Fixes potential NullPointerExceptions\n\nThis closes #16",
        "commit": "https://github.com/apache/struts/commit/47d1fe04dc1790473e9bd464d84e65ca76368ba5"
    },
    {
        "parent": "https://github.com/apache/struts/commit/f2ad93a0d64b127829e8777a06af4c20dcd7af85",
        "bug_id": "struts_6",
        "file": [
            {
                "additions": 1,
                "sha": "025e54528ea93b2a2ae041a6387dfa7337e0864f",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/.gitignore",
                "deletions": 0,
                "filename": ".gitignore",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/.gitignore?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -63,3 +63,4 @@ bundles/target\n plugins/target\n target\n plugins/testng/test-output\n+test-output",
                "changes": 1,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/.gitignore"
            },
            {
                "additions": 7,
                "sha": "5ba7076caa4d1b1764e25cbb3dfc111c6848d3db",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/.travis.yml",
                "deletions": 1,
                "filename": ".travis.yml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/.travis.yml?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -5,12 +5,18 @@ jdk:\n   - openjdk7\n   - oraclejdk8\n   - oraclejdk9\n+  - oraclejdk11\n \n install: true\n script: mvn test -DskipAssembly\n \n after_success:\n-  - mvn clean cobertura:cobertura org.eluder.coveralls:coveralls-maven-plugin:report com.updateimpact:updateimpact-maven-plugin:submit -Ptravis-coveralls,update-impact -DskipAssembly\n+  # TODO delete following if statement after fix of https://github.com/cobertura/cobertura/issues/271\n+  - if [ \"$TRAVIS_JDK_VERSION\" == \"openjdk8\" ] || [ \"$TRAVIS_JDK_VERSION\" == \"oraclejdk8\" ]; then\n+      mvn clean cobertura:cobertura org.eluder.coveralls:coveralls-maven-plugin:report com.updateimpact:updateimpact-maven-plugin:submit -Ptravis-coveralls,update-impact -DskipAssembly\n+    else\n+      echo \"Not reporting coverage for $TRAVIS_JDK_VERSION due to incomatibility or to save performance\";\n+    fi\n \n env:\n   global:",
                "changes": 8,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/.travis.yml"
            },
            {
                "additions": 1,
                "sha": "3e6e4a17661b367aa3473543290353ba26461c1a",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/assembly/src/main/assembly/min-lib.xml",
                "deletions": 2,
                "filename": "assembly/src/main/assembly/min-lib.xml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/assembly/src/main/assembly/min-lib.xml?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -38,9 +38,8 @@\n         <include>org.apache.commons:commons-lang3</include>\n         <include>org.apache.logging.log4j:log4j-api</include>\n         <include>ognl:ognl</include>\n-        <include>org.javassist:javassist</include>\n         <include>commons-fileupload:commons-fileupload</include>\n-        <include>commons-io:commons-io</include>\n+        <include>org.apache.commons:commons-io</include>\n       </includes>\n     </dependencySet>\n   </dependencySets>",
                "changes": 3,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/assembly/src/main/assembly/min-lib.xml"
            },
            {
                "additions": 3,
                "sha": "f5e0dac0a729c473b8a697c5472338baf0992876",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/pom.xml",
                "deletions": 3,
                "filename": "core/pom.xml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/pom.xml?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -339,13 +339,13 @@\n \n         <dependency>\n             <groupId>org.mockito</groupId>\n-            <artifactId>mockito-all</artifactId>\n+            <artifactId>mockito-core</artifactId>\n             <scope>test</scope>\n         </dependency>\n \n         <dependency>\n-            <groupId>org.easytesting</groupId>\n-            <artifactId>fest-assert</artifactId>\n+            <groupId>org.assertj</groupId>\n+            <artifactId>assertj-core</artifactId>\n             <scope>test</scope>\n         </dependency>\n ",
                "changes": 6,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/pom.xml"
            },
            {
                "additions": 137,
                "sha": "8cb69cbefd6798a2c5403e2f60a3835f03f588cb",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/src/main/java/com/opensymphony/xwork2/util/ClassPathFinder.java",
                "deletions": 142,
                "filename": "core/src/main/java/com/opensymphony/xwork2/util/ClassPathFinder.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/com/opensymphony/xwork2/util/ClassPathFinder.java?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -36,158 +36,153 @@\n /**\n  * This class is an utility class that will search through the classpath\n  * for files whose names match the given pattern. The filename is tested\n- * using the given implementation of {@link com.opensymphony.xwork2.util.PatternMatcher} by default it \n+ * using the given implementation of {@link com.opensymphony.xwork2.util.PatternMatcher} by default it\n  * uses {@link com.opensymphony.xwork2.util.WildcardHelper}\n  */\n public class ClassPathFinder {\n-\t\n-\t/**\n+\n+    /**\n      * The String pattern to test against.\n      */\n-\tprivate String pattern ;\n-\t\n-\tprivate int[] compiledPattern ;\n-\t\n-\t/**\n+    private String pattern;\n+\n+    private int[] compiledPattern;\n+\n+    /**\n      * The PatternMatcher implementation to use\n      */\n-\tprivate PatternMatcher<int[]> patternMatcher = new WildcardHelper();\n-\n-\tprivate Vector<String> compared = new Vector<>();\n-\t\n-\t/**\n-\t * @return the pattern in use\n-\t */\n-\tpublic String getPattern() {\n-\t\treturn pattern;\n-\t}\n-\n-\t/**\n-\t * @param pattern the String pattern for comparing filenames\n-\t */\n-\tpublic void setPattern(String pattern) {\n-\t\tthis.pattern = pattern;\n-\t}\n-\n-\t/**\n+    private PatternMatcher<int[]> patternMatcher = new WildcardHelper();\n+\n+    private Vector<String> compared = new Vector<>();\n+\n+    /**\n+     * @return the pattern in use\n+     */\n+    public String getPattern() {\n+        return pattern;\n+    }\n+\n+    /**\n+     * @param pattern the String pattern for comparing filenames\n+     */\n+    public void setPattern(String pattern) {\n+        this.pattern = pattern;\n+    }\n+\n+    /**\n      * Builds a {@link java.util.Vector} containing Strings which each name a file\n-     * who's name matches the pattern set by setPattern(String). The classpath is \n+     * who's name matches the pattern set by setPattern(String). The classpath is\n      * searched recursively, so use with caution.\n      *\n      * @return Vector&lt;String&gt; containing matching filenames\n      */\n-\tpublic Vector<String> findMatches() {\n-\t\tVector<String> matches = new Vector<>();\n-\t\tURL[] parentUrls = getClassLoaderURLs();\n-\t\tcompiledPattern = patternMatcher.compilePattern(pattern);\n-\t\tfor (URL url : parentUrls) {\n-\t\t\tif (!\"file\".equals(url.getProtocol())) {\n-\t\t\t\tcontinue ;\n-\t\t\t}\n-\t\t\tURI entryURI ;\n-\t\t\ttry {\n-\t\t\t\tentryURI = url.toURI();\n-\t\t\t} catch (URISyntaxException e) {\n-\t\t\t\tcontinue;\n-\t\t\t}\n-\t\t\tFile entry = new File(entryURI);\n-\t\t\tif (entry.isFile() && entry.toString().endsWith(\".jar\")) {\n-\t\t\t\ttry {\n-\t\t\t\t\tZipInputStream zip = new ZipInputStream(new FileInputStream(entry));\n-\t\t\t\t\tfor (ZipEntry zipEntry = zip.getNextEntry(); zipEntry != null; zipEntry = zip.getNextEntry()) {\n-\t\t\t\t\t\tboolean doesMatch = patternMatcher.match(new HashMap<String, String>(), zipEntry.getName(), compiledPattern);\n-\t\t\t\t\t\tif (doesMatch) {\n-\t\t\t\t\t\t\tmatches.add(zipEntry.getName());\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t} catch (IOException e) {\n-\t\t\t\t\te.printStackTrace();\n-\t\t\t\t}\n-\t\t\t} else {\n-\t\t\t\tVector<String> results = checkEntries(entry.list(), entry, \"\");\n-\t\t\t\tif (results != null) {\n-\t\t\t\t\tmatches.addAll(results);\n-\t\t\t\t}\n-\t\t\t}\n-\t\t}\n-\t\treturn matches;\n-\t}\n-\t\n-\tprivate Vector<String> checkEntries(String[] entries, File parent, String prefix) {\n-\t\t\n-\t\tif (entries == null ) {\n-\t\t\treturn null;\n-\t\t}\n-\n-\t\tVector<String> matches = new Vector<>();\n-\t\tfor (String listEntry : entries) {\n-\t\t\tFile tempFile ;\n-\t\t\tif (!\"\".equals(prefix) ) {\n-\t\t\t\ttempFile = new File(parent, prefix + \"/\" + listEntry);\n-\t\t\t}\n-\t\t\telse {\n-\t\t\t\ttempFile = new File(parent, listEntry);\n-\t\t\t}\n-\t\t\tif (tempFile.isDirectory() && \n-\t\t\t\t\t!(\".\".equals(listEntry) || \"..\".equals(listEntry)) ) {\n-\t\t\t\tif\t(!\"\".equals(prefix) ) {\n-\t\t\t\t\tmatches.addAll(checkEntries(tempFile.list(), parent, prefix + \"/\" + listEntry));\n-\t\t\t\t}\n-\t\t\t\telse {\n-\t\t\t\t\tmatches.addAll(checkEntries(tempFile.list(), parent, listEntry));\n-\t\t\t\t}\n-\t\t\t}\n-\t\t\telse {\n-\t\t\t\t\n-\t\t\t\tString entryToCheck ;\n-\t\t\t\tif (\"\".equals(prefix)) {\n-\t\t\t\t\tentryToCheck = listEntry ;\n-\t\t\t\t}\n-\t\t\t\telse {\n-\t\t\t\t\tentryToCheck = prefix + \"/\" + listEntry ;\n-\t\t\t\t}\n-\t\t\t\t\n-\t\t\t\tif (compared.contains(entryToCheck) ) {\n-\t\t\t\t\tcontinue;\n-\t\t\t\t}\n-\t\t\t\telse {\n-\t\t\t\t\tcompared.add(entryToCheck) ;\n-\t\t\t\t}\n-\t\t\t\t\n-\t\t\t\tboolean doesMatch = patternMatcher.match(new HashMap<String,String>(), entryToCheck, compiledPattern);\n-\t\t\t\tif (doesMatch) {\n-\t\t\t\t\tmatches.add(entryToCheck);\n-\t\t\t\t}\n-\t\t\t}\n-\t\t}\n-\t\treturn matches ;\n-\t}\n-\n-\t/**\n-\t * @param patternMatcher the PatternMatcher implementation to use when comparing filenames\n-\t */\n-\tpublic void setPatternMatcher(PatternMatcher<int[]> patternMatcher) {\n-\t\tthis.patternMatcher = patternMatcher;\n-\t}\n-\n-\tprivate URL[] getClassLoaderURLs() {\n-\t\tURL[] urls;\n-\t\tClassLoader loader = Thread.currentThread().getContextClassLoader();\n-\n-\t\tif (!(loader instanceof URLClassLoader)) {\n-\t\t\tloader = ClassPathFinder.class.getClassLoader();\n-\t\t}\n-\n-\t\tif (loader instanceof URLClassLoader) {\n-\t\t\turls = ((URLClassLoader) loader).getURLs();\n-\t\t} else {    //jdk9 or later\n-\t\t\ttry {\n-\t\t\t\turls = Collections.list(loader.getResources(\"\")).toArray(new URL[0]);\n-\t\t\t} catch (IOException e) {\n-\t\t\t\tthrow new XWorkException(\"unable to get ClassLoader URLs\", e);\n-\t\t\t}\n-\t\t}\n-\n-\t\treturn urls;\n-\t}\n+    public Vector<String> findMatches() {\n+        Vector<String> matches = new Vector<>();\n+        URL[] parentUrls = getClassLoaderURLs();\n+        compiledPattern = patternMatcher.compilePattern(pattern);\n+        for (URL url : parentUrls) {\n+            if (!\"file\".equals(url.getProtocol())) {\n+                continue;\n+            }\n+            URI entryURI;\n+            try {\n+                entryURI = url.toURI();\n+            } catch (URISyntaxException e) {\n+                continue;\n+            }\n+            File entry = new File(entryURI);\n+            if (entry.isFile() && entry.toString().endsWith(\".jar\")) {\n+                try {\n+                    ZipInputStream zip = new ZipInputStream(new FileInputStream(entry));\n+                    for (ZipEntry zipEntry = zip.getNextEntry(); zipEntry != null; zipEntry = zip.getNextEntry()) {\n+                        boolean doesMatch = patternMatcher.match(new HashMap<String, String>(), zipEntry.getName(), compiledPattern);\n+                        if (doesMatch) {\n+                            matches.add(zipEntry.getName());\n+                        }\n+                    }\n+                } catch (IOException e) {\n+                    e.printStackTrace();\n+                }\n+            } else {\n+                Vector<String> results = checkEntries(entry.list(), entry, \"\");\n+                if (results != null) {\n+                    matches.addAll(results);\n+                }\n+            }\n+        }\n+        return matches;\n+    }\n+\n+    private Vector<String> checkEntries(String[] entries, File parent, String prefix) {\n+\n+        if (entries == null) {\n+            return null;\n+        }\n+\n+        Vector<String> matches = new Vector<>();\n+        for (String listEntry : entries) {\n+            File tempFile;\n+            if (!\"\".equals(prefix)) {\n+                tempFile = new File(parent, prefix + \"/\" + listEntry);\n+            } else {\n+                tempFile = new File(parent, listEntry);\n+            }\n+            if (tempFile.isDirectory() &&\n+                !(\".\".equals(listEntry) || \"..\".equals(listEntry))) {\n+                if (!\"\".equals(prefix)) {\n+                    matches.addAll(checkEntries(tempFile.list(), parent, prefix + \"/\" + listEntry));\n+                } else {\n+                    matches.addAll(checkEntries(tempFile.list(), parent, listEntry));\n+                }\n+            } else {\n+\n+                String entryToCheck;\n+                if (\"\".equals(prefix)) {\n+                    entryToCheck = listEntry;\n+                } else {\n+                    entryToCheck = prefix + \"/\" + listEntry;\n+                }\n+\n+                if (compared.contains(entryToCheck)) {\n+                    continue;\n+                } else {\n+                    compared.add(entryToCheck);\n+                }\n+\n+                boolean doesMatch = patternMatcher.match(new HashMap<String, String>(), entryToCheck, compiledPattern);\n+                if (doesMatch) {\n+                    matches.add(entryToCheck);\n+                }\n+            }\n+        }\n+        return matches;\n+    }\n+\n+    /**\n+     * @param patternMatcher the PatternMatcher implementation to use when comparing filenames\n+     */\n+    public void setPatternMatcher(PatternMatcher<int[]> patternMatcher) {\n+        this.patternMatcher = patternMatcher;\n+    }\n+\n+    private URL[] getClassLoaderURLs() {\n+        URL[] urls;\n+        ClassLoader loader = Thread.currentThread().getContextClassLoader();\n+\n+        if (!(loader instanceof URLClassLoader)) {\n+            loader = ClassPathFinder.class.getClassLoader();\n+        }\n+\n+        if (loader instanceof URLClassLoader) {\n+            urls = ((URLClassLoader) loader).getURLs();\n+        } else {    //jdk9 or later\n+            try {\n+                urls = Collections.list(loader.getResources(\"\")).toArray(new URL[0]);\n+            } catch (IOException e) {\n+                throw new XWorkException(\"unable to get ClassLoader URLs\", e);\n+            }\n+        }\n+\n+        return urls;\n+    }\n }",
                "changes": 279,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/src/main/java/com/opensymphony/xwork2/util/ClassPathFinder.java"
            },
            {
                "additions": 21,
                "sha": "99aa541332b84e8cf1bbf6a348cbc23c28ae22d3",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/src/test/java/com/opensymphony/xwork2/ognl/OgnlUtilTest.java",
                "deletions": 23,
                "filename": "core/src/test/java/com/opensymphony/xwork2/ognl/OgnlUtilTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/com/opensymphony/xwork2/ognl/OgnlUtilTest.java?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -27,9 +27,9 @@\n import com.opensymphony.xwork2.util.*;\n import com.opensymphony.xwork2.util.reflection.ReflectionContextState;\n import ognl.*;\n-import org.apache.struts2.TestUtils;\n \n import java.lang.reflect.Method;\n+import java.text.DateFormat;\n import java.util.*;\n \n public class OgnlUtilTest extends XWorkTestCase {\n@@ -373,24 +373,8 @@ public void testSetPropertiesDate() {\n         cal.set(Calendar.YEAR, 1982);\n \n         assertEquals(cal.getTime(), foo.getBirthday());\n-        \n-        //UK style test\n-        if (TestUtils.isJdk9OrLater()) {\n-            /* In JDK 9 and later, the default locale data uses data derived from the\n-            Unicode Consortium's Common Locale Data Repository (CLDR). The short date-time format is \u2039{1}, {0}\u203a in the\n-            CLDR locale, as opposed to {1} {0} in the JRE locale data.\n-            Please refer : http://www.oracle.com/technetwork/java/javase/9-relnote-issues-3704069.html#JDK-8008577 */\n-            props.put(\"event\", \"18/10/2006, 14:23:45\");\n-            props.put(\"meeting\", \"09/09/2006, 14:30\");\n-        }\n-        else {\n-            props.put(\"event\", \"18/10/2006 14:23:45\");\n-            props.put(\"meeting\", \"09/09/2006 14:30\");\n-        }\n-        context.put(ActionContext.LOCALE, Locale.UK);\n \n-        ognlUtil.setProperties(props, foo, context);\n-        \n+        //UK style test\n         cal = Calendar.getInstance();\n         cal.clear();\n         cal.set(Calendar.MONTH, Calendar.OCTOBER);\n@@ -399,18 +383,32 @@ public void testSetPropertiesDate() {\n         cal.set(Calendar.HOUR_OF_DAY, 14);\n         cal.set(Calendar.MINUTE, 23);\n         cal.set(Calendar.SECOND, 45);\n-        \n-        assertEquals(cal.getTime(), foo.getEvent());\n-        \n+\n+        Date eventTime = cal.getTime();\n+        String formatted = DateFormat.getDateTimeInstance(DateFormat.SHORT, DateFormat.MEDIUM, Locale.UK)\n+                .format(eventTime);\n+        props.put(\"event\", formatted);\n+\n         cal = Calendar.getInstance();\n         cal.clear();\n         cal.set(Calendar.MONTH, Calendar.SEPTEMBER);\n         cal.set(Calendar.DAY_OF_MONTH, 9);\n         cal.set(Calendar.YEAR, 2006);\n         cal.set(Calendar.HOUR_OF_DAY, 14);\n         cal.set(Calendar.MINUTE, 30);\n-        \n-        assertEquals(cal.getTime(), foo.getMeeting());\n+\n+        Date meetingTime = cal.getTime();\n+        formatted = DateFormat.getDateTimeInstance(DateFormat.SHORT, DateFormat.MEDIUM, Locale.UK)\n+                .format(meetingTime);\n+        props.put(\"meeting\", formatted);\n+\n+        context.put(ActionContext.LOCALE, Locale.UK);\n+\n+        ognlUtil.setProperties(props, foo, context);\n+\n+        assertEquals(eventTime, foo.getEvent());\n+\n+        assertEquals(meetingTime, foo.getMeeting());\n         \n         //test RFC 3339 date format for JSON\n         props.put(\"event\", \"1996-12-19T16:39:57Z\");",
                "changes": 44,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/src/test/java/com/opensymphony/xwork2/ognl/OgnlUtilTest.java"
            },
            {
                "additions": 1,
                "sha": "fdc5416b4188dff567fe6af94ebec35bb9775682",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/src/test/java/com/opensymphony/xwork2/util/AnnotationUtilsTest.java",
                "deletions": 1,
                "filename": "core/src/test/java/com/opensymphony/xwork2/util/AnnotationUtilsTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/com/opensymphony/xwork2/util/AnnotationUtilsTest.java?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -30,7 +30,7 @@\n import java.util.List;\n import java.util.Set;\n \n-import static org.fest.assertions.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThat;\n \n public class AnnotationUtilsTest extends TestCase {\n ",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/src/test/java/com/opensymphony/xwork2/util/AnnotationUtilsTest.java"
            },
            {
                "additions": 10,
                "sha": "17a9deb25b9099774e87d16efd235558b6aaace7",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/src/test/java/com/opensymphony/xwork2/util/ClassPathFinderTest.java",
                "deletions": 5,
                "filename": "core/src/test/java/com/opensymphony/xwork2/util/ClassPathFinderTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/com/opensymphony/xwork2/util/ClassPathFinderTest.java?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -22,6 +22,7 @@\n import org.apache.commons.io.IOUtils;\n \n import java.io.IOException;\n+import java.io.InputStream;\n import java.net.URL;\n import java.util.Enumeration;\n import java.util.HashMap;\n@@ -62,12 +63,14 @@ public void testFinderNotURLClassLoader() throws Exception {\n         NotURLClassLoader loader = new NotURLClassLoader(Thread.currentThread().getContextClassLoader());\n         Thread.currentThread().setContextClassLoader(loader);\n \n-        Class<?> clazz = loader.loadClass(ClassPathFinderTest.class.getName());\n-        Object test = clazz.getConstructor().newInstance();\n+        try {\n+            Class<?> clazz = loader.loadClass(ClassPathFinderTest.class.getName());\n+            Object test = clazz.getConstructor().newInstance();\n \n-        clazz.getMethod(\"testFinder\").invoke(test);\n-\n-        Thread.currentThread().setContextClassLoader(loader.parentClassLoader);\n+            clazz.getMethod(\"testFinder\").invoke(test);\n+        } finally {\n+            Thread.currentThread().setContextClassLoader(loader.parentClassLoader);\n+        }\n     }\n \n \n@@ -89,6 +92,8 @@ public void testFinderNotURLClassLoader() throws Exception {\n                     loadedClasses.put(name, defineClass(name, classBits, 0, classBits.length));\n                 } catch (IOException e) {\n                     throw new ClassNotFoundException(\"class \" + name + \" is not findable\", e);\n+                } catch (Exception e) {\n+                    loadedClasses.put(name, parentClassLoader.loadClass(name));\n                 }\n             }\n ",
                "changes": 15,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/src/test/java/com/opensymphony/xwork2/util/ClassPathFinderTest.java"
            },
            {
                "additions": 12,
                "sha": "20a21ce7cd76911fc8edfe66e2209ed8aa0e678a",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/src/test/java/com/opensymphony/xwork2/util/fs/JarEntryRevisionTest.java",
                "deletions": 10,
                "filename": "core/src/test/java/com/opensymphony/xwork2/util/fs/JarEntryRevisionTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/com/opensymphony/xwork2/util/fs/JarEntryRevisionTest.java?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -34,6 +34,7 @@\n import java.net.URLStreamHandler;\n import java.nio.file.Files;\n import java.nio.file.Path;\n+import java.nio.file.Paths;\n import java.util.jar.Attributes;\n import java.util.jar.JarOutputStream;\n import java.util.jar.Manifest;\n@@ -49,10 +50,13 @@ public void setUp() throws Exception {\n         fileManager = container.getInstance(FileManagerFactory.class).getFileManager();\n     }\n \n-    private void createJarFile(long time) throws Exception {\n+    private String createJarFile(long time) throws Exception {\n         Manifest manifest = new Manifest();\n         manifest.getMainAttributes().put(Attributes.Name.MANIFEST_VERSION, \"1.0\");\n-        FileOutputStream fos = new FileOutputStream(\"target/JarEntryRevisionTest_testNeedsReloading.jar\", false);\n+        Path jarPath = Paths.get(Thread.currentThread().getContextClassLoader()\n+                .getResource(\"xwork-jar.jar\").toURI()).getParent();\n+        File jarFile = jarPath.resolve(\"JarEntryRevisionTest_testNeedsReloading.jar\").toFile();\n+        FileOutputStream fos = new FileOutputStream(jarFile, false);\n         JarOutputStream target = new JarOutputStream(fos, manifest);\n         target.putNextEntry(new ZipEntry(\"com/opensymphony/xwork2/util/fs/\"));\n         ZipEntry entry = new ZipEntry(\"com/opensymphony/xwork2/util/fs/JarEntryRevisionTest.class\");\n@@ -64,13 +68,14 @@ private void createJarFile(long time) throws Exception {\n         target.closeEntry();\n         target.close();\n         fos.close();\n+\n+        return jarFile.toURI().toURL().toExternalForm();\n     }\n \n     public void testNeedsReloading() throws Exception {\n         long now = System.currentTimeMillis();\n \n-        createJarFile(now);\n-        URL url = new URL(\"jar:file:target/JarEntryRevisionTest_testNeedsReloading.jar!/com/opensymphony/xwork2/util/fs/JarEntryRevisionTest.class\");\n+        URL url = new URL(\"jar:\" + createJarFile(now) + \"!/com/opensymphony/xwork2/util/fs/JarEntryRevisionTest.class\");\n         Revision entry = JarEntryRevision.build(url, fileManager);\n         assert entry != null;\n         assertFalse(entry.needsReloading());\n@@ -82,9 +87,8 @@ public void testNeedsReloading() throws Exception {\n     public void testNeedsReloadingWithContainerProvidedURLConnection() throws Exception {\n         long now = System.currentTimeMillis();\n \n-        createJarFile(now);\n         URL url = new URL(null,\n-                \"jar:file:target/JarEntryRevisionTest_testNeedsReloading.jar!/com/opensymphony/xwork2/util/fs/JarEntryRevisionTest.class\",\n+                \"jar:\" + createJarFile(now) + \"!/com/opensymphony/xwork2/util/fs/JarEntryRevisionTest.class\",\n                 new ContainerProvidedURLStreamHandler());\n         Revision entry = JarEntryRevision.build(url, fileManager);\n         assert entry != null;\n@@ -97,17 +101,15 @@ public void testNeedsReloadingWithContainerProvidedURLConnection() throws Except\n     public void testNeedsReloadingWithContainerProvidedURLConnectionEmptyProtocol() throws Exception {\n         long now = System.currentTimeMillis();\n \n-        createJarFile(now);\n-        File targetDir = new File(\"target\");\n-        String targetUrlStr = targetDir.toURI().toURL().toString();\n+        String targetUrlStr = createJarFile(now);\n         if (targetUrlStr.startsWith(\"file:\")) {\n             targetUrlStr = targetUrlStr.substring(5);//emptying protocol; we expect framework will fix it\n         }\n         if (targetUrlStr.startsWith(\"/\")) {\n             targetUrlStr = targetUrlStr.substring(1);//we expect framework will fix it also\n         }\n         URL url = new URL(null,\n-                \"zip:\" + targetUrlStr + \"JarEntryRevisionTest_testNeedsReloading.jar!/com/opensymphony/xwork2/util/fs/JarEntryRevisionTest.class\",\n+                \"zip:\" + targetUrlStr + \"!/com/opensymphony/xwork2/util/fs/JarEntryRevisionTest.class\",\n                 new ContainerProvidedURLStreamHandler());\n         Revision entry = JarEntryRevision.build(url, fileManager);\n         assert entry != null;",
                "changes": 22,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/src/test/java/com/opensymphony/xwork2/util/fs/JarEntryRevisionTest.java"
            },
            {
                "additions": 0,
                "sha": "32f5630daa8ac237eb6c77494c55f80ed28d1f52",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/src/test/java/org/apache/struts2/TestUtils.java",
                "deletions": 16,
                "filename": "core/src/test/java/org/apache/struts2/TestUtils.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/org/apache/struts2/TestUtils.java?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -91,20 +91,4 @@ public static String readContent(URL url)\n \n         return buffer.toString();\n     }\n-\n-    public static boolean isJdk9OrLater() {\n-        ClassLoader loader = Thread.currentThread().getContextClassLoader();\n-\n-        if(loader instanceof URLClassLoader) {\n-            return false;\n-        }\n-\n-        loader = TestUtils.class.getClassLoader();\n-\n-        if(loader instanceof URLClassLoader) {\n-            return false;\n-        }\n-\n-        return true;\n-    }\n }",
                "changes": 16,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/src/test/java/org/apache/struts2/TestUtils.java"
            },
            {
                "additions": 1,
                "sha": "b88d2b36bac257f0b2e49e97529b47e3dd5b416f",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/src/test/java/org/apache/struts2/conversion/UploadedFileConverterTest.java",
                "deletions": 1,
                "filename": "core/src/test/java/org/apache/struts2/conversion/UploadedFileConverterTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/org/apache/struts2/conversion/UploadedFileConverterTest.java?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -29,7 +29,7 @@\n import java.util.Collections;\n import java.util.Map;\n \n-import static org.fest.assertions.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThat;\n \n public class UploadedFileConverterTest {\n ",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/src/test/java/org/apache/struts2/conversion/UploadedFileConverterTest.java"
            },
            {
                "additions": 3,
                "sha": "0c5538a6cd01227990cbf2f5a63529f85dac91fb",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/src/test/java/org/apache/struts2/views/freemarker/FreemarkerThemeTemplateLoaderTest.java",
                "deletions": 6,
                "filename": "core/src/test/java/org/apache/struts2/views/freemarker/FreemarkerThemeTemplateLoaderTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/org/apache/struts2/views/freemarker/FreemarkerThemeTemplateLoaderTest.java?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -22,18 +22,15 @@\n import org.apache.struts2.StrutsInternalTestCase;\n import org.apache.struts2.components.template.Template;\n import org.apache.struts2.components.template.TemplateEngine;\n-import org.hamcrest.BaseMatcher;\n-import org.hamcrest.Description;\n-import org.hamcrest.Matcher;\n import org.hamcrest.core.IsEqual;\n-import org.mockito.Matchers;\n \n import java.util.HashMap;\n import java.util.Map;\n \n-import static org.fest.assertions.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThat;\n import static org.mockito.Mockito.mock;\n import static org.mockito.Mockito.when;\n+import static org.mockito.hamcrest.MockitoHamcrest.argThat;\n \n public class FreemarkerThemeTemplateLoaderTest extends StrutsInternalTestCase {\n \n@@ -65,7 +62,7 @@ public void testThemeExpansionTokenWithParent() throws Exception {\n         TemplateEngine engine = mock(TemplateEngine.class);\n         Map<String, String> props = new HashMap<String, String>();\n         props.put(\"parent\", \"foo/foo\");\n-        when(engine.getThemeProps(Matchers.argThat(new IsEqual<Template>(new Template(\"template\", \"foo/bar\", \"text.ftl\"))))).thenReturn(props);\n+        when(engine.getThemeProps(argThat(new IsEqual<>(new Template(\"template\", \"foo/bar\", \"text.ftl\"))))).thenReturn(props);\n         loader.setTemplateEngine(engine);\n \n         TemplateLoader parent = mock(TemplateLoader.class);",
                "changes": 9,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/core/src/test/java/org/apache/struts2/views/freemarker/FreemarkerThemeTemplateLoaderTest.java"
            },
            {
                "additions": 31,
                "sha": "f304f79b016e24d9ce3b2ed577d6e5c88ae7013e",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/plugins/bean-validation/pom.xml",
                "deletions": 0,
                "filename": "plugins/bean-validation/pom.xml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/bean-validation/pom.xml?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -61,6 +61,37 @@\n             <scope>test</scope>\n         </dependency>\n \n+        <!--\n+         The Java EE API modules listed below are all marked @Deprecated(forRemoval=true), because they are scheduled\n+         for removal in Java 11. So the -add-module approach will no longer work in Java 11 out of the box.\n+         What we will need to do in Java 11 and forward is include our own copy of the Java EE APIs on the class path\n+         or module path. For example, we can add the JAX-B APIs as a maven dependency like this:\n+        -->\n+        <dependency>\n+            <groupId>javax.xml.bind</groupId>\n+            <artifactId>jaxb-api</artifactId>\n+            <version>2.3.1</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.sun.xml.bind</groupId>\n+            <artifactId>jaxb-core</artifactId>\n+            <version>2.3.0.1</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.sun.xml.bind</groupId>\n+            <artifactId>jaxb-impl</artifactId>\n+            <version>2.3.1</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>javax.activation</groupId>\n+            <artifactId>activation</artifactId>\n+            <version>1.1.1</version>\n+            <scope>test</scope>\n+        </dependency>\n+\n     </dependencies>\n \n </project>\n\\ No newline at end of file",
                "changes": 31,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/plugins/bean-validation/pom.xml"
            },
            {
                "additions": 7,
                "sha": "dbc8070113c8046388249c70b8128b64e17ef1e7",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/plugins/embeddedjsp/src/test/java/org/apache/struts2/EmbeddedJSPResultTest.java",
                "deletions": 5,
                "filename": "plugins/embeddedjsp/src/test/java/org/apache/struts2/EmbeddedJSPResultTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/embeddedjsp/src/test/java/org/apache/struts2/EmbeddedJSPResultTest.java?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -231,12 +231,14 @@ public void testNotURLClassLoader() throws Exception {\n         NotURLClassLoader loader = new NotURLClassLoader(parentClassLoader);\r\n         Thread.currentThread().setContextClassLoader(loader);\r\n \r\n-        result.setLocation(\"org/apache/struts2/tag0.jsp\");\r\n-        result.execute(null);\r\n-\r\n-        assertEquals(\"Thissessionisnotsecure.OtherText\", StringUtils.deleteWhitespace(response.getContentAsString()));\r\n+        try {\r\n+            result.setLocation(\"org/apache/struts2/tag0.jsp\");\r\n+            result.execute(null);\r\n \r\n-        Thread.currentThread().setContextClassLoader(parentClassLoader);\r\n+            assertEquals(\"Thissessionisnotsecure.OtherText\", StringUtils.deleteWhitespace(response.getContentAsString()));\r\n+        } finally {\r\n+            Thread.currentThread().setContextClassLoader(parentClassLoader);\r\n+        }\r\n     }\r\n \r\n     @Override\r",
                "changes": 12,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/plugins/embeddedjsp/src/test/java/org/apache/struts2/EmbeddedJSPResultTest.java"
            },
            {
                "additions": 2,
                "sha": "a89b221a33a9dfc88f1fa3610f0e9f0ac4a7139a",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/plugins/json/pom.xml",
                "deletions": 2,
                "filename": "plugins/json/pom.xml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/json/pom.xml?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -101,8 +101,8 @@\n         </dependency>\n \n         <dependency>\n-            <groupId>org.easytesting</groupId>\n-            <artifactId>fest-assert</artifactId>\n+            <groupId>org.assertj</groupId>\n+            <artifactId>assertj-core</artifactId>\n             <scope>test</scope>\n         </dependency>\n ",
                "changes": 4,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/plugins/json/pom.xml"
            },
            {
                "additions": 1,
                "sha": "a4fd58d2d3d0e8a4897ca78bcaa8806bef3d6ead",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/plugins/json/src/test/java/org/apache/struts2/json/JSONValidationInterceptorTest.java",
                "deletions": 1,
                "filename": "plugins/json/src/test/java/org/apache/struts2/json/JSONValidationInterceptorTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/json/src/test/java/org/apache/struts2/json/JSONValidationInterceptorTest.java?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -39,7 +39,7 @@\n import java.util.HashMap;\n import java.util.Map;\n \n-import static org.fest.assertions.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThat;\n \n public class JSONValidationInterceptorTest extends StrutsTestCase {\n ",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/plugins/json/src/test/java/org/apache/struts2/json/JSONValidationInterceptorTest.java"
            },
            {
                "additions": 2,
                "sha": "33324af2a3a6658c7edbb0fa2a7210f963d2a21a",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/plugins/rest/pom.xml",
                "deletions": 2,
                "filename": "plugins/rest/pom.xml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/rest/pom.xml?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -80,8 +80,8 @@\n         </dependency>\n \n         <dependency>\n-            <groupId>org.easytesting</groupId>\n-            <artifactId>fest-assert</artifactId>\n+            <groupId>org.assertj</groupId>\n+            <artifactId>assertj-core</artifactId>\n             <scope>test</scope>\n         </dependency>\n ",
                "changes": 4,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/plugins/rest/pom.xml"
            },
            {
                "additions": 1,
                "sha": "befefee73dcd8daa031a93a4befcaf2e1b2c556b",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/plugins/rest/src/test/java/org/apache/struts2/rest/handler/JacksonXmlHandlerTest.java",
                "deletions": 1,
                "filename": "plugins/rest/src/test/java/org/apache/struts2/rest/handler/JacksonXmlHandlerTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/rest/src/test/java/org/apache/struts2/rest/handler/JacksonXmlHandlerTest.java?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -28,7 +28,7 @@\n import java.io.Writer;\n import java.util.Arrays;\n \n-import static org.fest.assertions.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThat;\n \n public class JacksonXmlHandlerTest extends XWorkTestCase {\n ",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/plugins/rest/src/test/java/org/apache/struts2/rest/handler/JacksonXmlHandlerTest.java"
            },
            {
                "additions": 11,
                "sha": "02fcdf65bae417371aab9f41921b196b5a0db5a4",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2a60c1eee69f976a6e20f20add04cdc39b757ead/pom.xml",
                "deletions": 8,
                "filename": "pom.xml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/pom.xml?ref=2a60c1eee69f976a6e20f20add04cdc39b757ead",
                "patch": "@@ -110,6 +110,7 @@\n \n         <!-- Sonar -->\n         <sonar.host.url>https://builds.apache.org/analysis/</sonar.host.url>\n+        <maven-surefire-plugin.version>2.22.1</maven-surefire-plugin.version>\n     </properties>\n \n     <profiles>\n@@ -169,6 +170,7 @@\n             </activation>\n             <properties>\n                 <!-- coverall version 4.3.0 does not work with java 9, see https://github.com/trautonen/coveralls-maven-plugin/issues/112 -->\n+                <!-- TODO delete coveralls.skip property after fix of https://github.com/cobertura/cobertura/issues/271 -->\n                 <coveralls.skip>true</coveralls.skip>\n             </properties>\n             <build>\n@@ -178,7 +180,8 @@\n                             <groupId>org.apache.maven.plugins</groupId>\n                             <artifactId>maven-surefire-plugin</artifactId>\n                             <configuration>\n-                                <argLine>--add-modules java.activation --add-modules java.xml.bind</argLine>\n+                                <!-- TODO delete forkCount=0 after fix of https://issues.apache.org/jira/browse/SUREFIRE-1588 -->\n+                                <forkCount>0</forkCount>\n                             </configuration>\n                         </plugin>\n                     </plugins>\n@@ -233,12 +236,12 @@\n                 <plugin>\n                     <groupId>org.apache.maven.plugins</groupId>\n                     <artifactId>maven-surefire-plugin</artifactId>\n-                    <version>2.22.1</version>\n+                    <version>${maven-surefire-plugin.version}</version>\n                     <dependencies>\n                         <dependency>\n                             <groupId>org.apache.maven.surefire</groupId>\n                             <artifactId>surefire-junit47</artifactId>\n-                            <version>2.22.1</version>\n+                            <version>${maven-surefire-plugin.version}</version>\n                         </dependency>\n                     </dependencies>\n                     <configuration>\n@@ -972,16 +975,16 @@\n             </dependency>\n \n             <dependency>\n-                <groupId>org.easytesting</groupId>\n-                <artifactId>fest-assert</artifactId>\n-                <version>1.4</version>\n+                <groupId>org.assertj</groupId>\n+                <artifactId>assertj-core</artifactId>\n+                <version>2.9.1</version>\n                 <scope>test</scope>\n             </dependency>\n \n             <dependency>\n                 <groupId>org.mockito</groupId>\n-                <artifactId>mockito-all</artifactId>\n-                <version>1.10.19</version>\n+                <artifactId>mockito-core</artifactId>\n+                <version>2.23.0</version>\n                 <scope>test</scope>\n             </dependency>\n ",
                "changes": 19,
                "blob_url": "https://github.com/apache/struts/blob/2a60c1eee69f976a6e20f20add04cdc39b757ead/pom.xml"
            }
        ],
        "repo": "struts",
        "message": "[WW-4981] Adds support for JDK11  (#270)\n\n* Upgrades test dependencies\r\n\r\n* Drops unused lib\r\n\r\n* Uses AssertJ instead of FestAssert\r\n\r\n* Upgrades Surefire Maven Plugin to 2.22.1\r\n\r\n* Downgrades to AssertJ 2.x to support JDK7\r\n\r\n* decouple tests from java version\r\n\r\nRefactor a java 9 conditional test to work always with any java version\r\n\r\nSee also WW-4845\r\n\r\n* fix NullPointerException in NotURLClassLoader tests\r\n\r\nAlso includes a few improvements\r\n\r\nSee also WW-4845\r\n\r\n* do not specify threadCount & forkMode which breaks tests in java 9\r\n\r\nSee also WW-4845\r\n\r\n* pass all current tests with java 11\r\n\r\nSee also WW-4981\r\n\r\n* fix an odd path problem in java 9\r\n\r\nSee also WW-4845\r\n\r\n* gitignore test-output\r\n\r\nSee also WW-4981\r\n\r\n* ask travis an oracle jdk 11 build\r\n\r\nSee also WW-4981\r\n\r\n* ask travis to report coverage only in latest working jdk, jdk8\r\n\r\nSee also WW-4845",
        "commit": "https://github.com/apache/struts/commit/2a60c1eee69f976a6e20f20add04cdc39b757ead"
    },
    {
        "parent": "https://github.com/apache/struts/commit/ce4f192676aeb433f8aa020977b62cda0fedf27b",
        "bug_id": "struts_7",
        "file": [
            {
                "additions": 3,
                "sha": "dcf671e5e8a220925c3fafdfd6d82074c7c75b85",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/d3eb1fc5955f793d18aea5c43d0ca077e0a8794b/apps/showcase/src/main/java/org/apache/struts2/showcase/fileupload/MultipleFileUploadUsingArrayAction.java",
                "deletions": 3,
                "filename": "apps/showcase/src/main/java/org/apache/struts2/showcase/fileupload/MultipleFileUploadUsingArrayAction.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/apps/showcase/src/main/java/org/apache/struts2/showcase/fileupload/MultipleFileUploadUsingArrayAction.java?ref=d3eb1fc5955f793d18aea5c43d0ca077e0a8794b",
                "patch": "@@ -32,9 +32,9 @@\n  */\n public class MultipleFileUploadUsingArrayAction extends ActionSupport {\n \n-\tprivate File[] uploads;\n-\tprivate String[] uploadFileNames;\n-\tprivate String[] uploadContentTypes;\n+\tprivate File[] uploads = new File[0];\n+\tprivate String[] uploadFileNames = new String[0];\n+\tprivate String[] uploadContentTypes = new String[0];\n \n \n \tpublic String upload() throws Exception {",
                "changes": 6,
                "blob_url": "https://github.com/apache/struts/blob/d3eb1fc5955f793d18aea5c43d0ca077e0a8794b/apps/showcase/src/main/java/org/apache/struts2/showcase/fileupload/MultipleFileUploadUsingArrayAction.java"
            },
            {
                "additions": 2,
                "sha": "33be370ba419425e09da00c88526402ddf1e8b5c",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/d3eb1fc5955f793d18aea5c43d0ca077e0a8794b/apps/showcase/src/main/resources/struts-fileupload.xml",
                "deletions": 0,
                "filename": "apps/showcase/src/main/resources/struts-fileupload.xml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/apps/showcase/src/main/resources/struts-fileupload.xml?ref=d3eb1fc5955f793d18aea5c43d0ca077e0a8794b",
                "patch": "@@ -40,6 +40,7 @@\n \t\t</action>\n \t\t\n \t\t<action name=\"doMultipleUploadUsingList\" class=\"org.apache.struts2.showcase.fileupload.MultipleFileUploadUsingListAction\" method=\"upload\">\n+                        <result name=\"input\">/WEB-INF/fileupload/multipleUploadUsingList.jsp</result>\n \t\t\t<result>/WEB-INF/fileupload/multiple-success.jsp</result>\n \t\t</action>\n \n@@ -49,6 +50,7 @@\n \t\t</action>\n \n \t\t<action name=\"doMultipleUploadUsingArray\" class=\"org.apache.struts2.showcase.fileupload.MultipleFileUploadUsingArrayAction\" method=\"upload\">\n+                        <result name=\"input\">/WEB-INF/fileupload/multipleUploadUsingArray.jsp</result>\n \t\t\t<result>/WEB-INF/fileupload/multiple-success.jsp</result>\n \t\t</action>\n ",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/d3eb1fc5955f793d18aea5c43d0ca077e0a8794b/apps/showcase/src/main/resources/struts-fileupload.xml"
            },
            {
                "additions": 14,
                "sha": "a0d52a67772e5a5eea91902a14e1c4a438a37462",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/d3eb1fc5955f793d18aea5c43d0ca077e0a8794b/apps/showcase/src/main/webapp/WEB-INF/tags/non-ui/ifTag/testIf.jsp",
                "deletions": 0,
                "filename": "apps/showcase/src/main/webapp/WEB-INF/tags/non-ui/ifTag/testIf.jsp",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/apps/showcase/src/main/webapp/WEB-INF/tags/non-ui/ifTag/testIf.jsp?ref=d3eb1fc5955f793d18aea5c43d0ca077e0a8794b",
                "patch": "@@ -18,6 +18,7 @@\n * under the License.\n */\n -->\n+<%@page import=\"org.apache.struts2.showcase.hangman.HangmanConstants\" %>\n <%@taglib prefix=\"s\" uri=\"/struts-tags\" %>\n <html>\n <head>\n@@ -635,5 +636,18 @@\n \t\t</div>\n \t</div>\n </div>\n+<br>\n+<br>\n+    <p>\n+        A secondary test for this JSP visually verifies expression access to a public constant.\n+        A direct access to the same public constant via scriptlet provides secondary verification.\n+    </p>\n+<br>\n+<div>\n+    Test public static (constant) access (expression).  Value: <s:property default=\"unavailable\" value=\"@org.apache.struts2.showcase.hangman.HangmanConstants@HANGMAN_SESSION_KEY\" />\n+</div>\n+<div>\n+    Test public static (constant) access (scriptlet).  Value: <%=org.apache.struts2.showcase.hangman.HangmanConstants.HANGMAN_SESSION_KEY%>\n+</div>\n </body>\n </html>",
                "changes": 14,
                "blob_url": "https://github.com/apache/struts/blob/d3eb1fc5955f793d18aea5c43d0ca077e0a8794b/apps/showcase/src/main/webapp/WEB-INF/tags/non-ui/ifTag/testIf.jsp"
            },
            {
                "additions": 10,
                "sha": "d92ce008a9f717e48462f9005619cc27c9e7dcc4",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/d3eb1fc5955f793d18aea5c43d0ca077e0a8794b/core/src/main/java/org/apache/struts2/config/entities/ConstantConfig.java",
                "deletions": 0,
                "filename": "core/src/main/java/org/apache/struts2/config/entities/ConstantConfig.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/config/entities/ConstantConfig.java?ref=d3eb1fc5955f793d18aea5c43d0ca077e0a8794b",
                "patch": "@@ -91,6 +91,7 @@\n     private BeanConfig localeProvider;\n     private BeanConfig localeProviderFactory;\n     private String mapperIdParameterName;\n+    private Boolean ognlAllowStaticFieldAccess;\n     private Boolean ognlAllowStaticMethodAccess;\n     private BeanConfig actionValidatorManager;\n     private BeanConfig valueStackFactory;\n@@ -219,6 +220,7 @@ private String classesToString(Set<Class<?>> classes) {\n         map.put(StrutsConstants.STRUTS_LOCALE_PROVIDER, beanConfToString(localeProvider));\n         map.put(StrutsConstants.STRUTS_LOCALE_PROVIDER_FACTORY, beanConfToString(localeProviderFactory));\n         map.put(StrutsConstants.STRUTS_ID_PARAMETER_NAME, mapperIdParameterName);\n+        map.put(StrutsConstants.STRUTS_ALLOW_STATIC_FIELD_ACCESS, Objects.toString(ognlAllowStaticFieldAccess, null));\n         map.put(StrutsConstants.STRUTS_ALLOW_STATIC_METHOD_ACCESS, Objects.toString(ognlAllowStaticMethodAccess, null));\n         map.put(StrutsConstants.STRUTS_ACTIONVALIDATORMANAGER, beanConfToString(actionValidatorManager));\n         map.put(StrutsConstants.STRUTS_VALUESTACKFACTORY, beanConfToString(valueStackFactory));\n@@ -824,6 +826,14 @@ public void setMapperIdParameterName(String mapperIdParameterName) {\n         this.mapperIdParameterName = mapperIdParameterName;\n     }\n \n+    public Boolean getOgnlAllowStaticFieldAccess() {\n+        return ognlAllowStaticFieldAccess;\n+    }\n+\n+    public void setOgnlAllowStaticFieldAccess(Boolean ognlAllowStaticFieldAccess) {\n+        this.ognlAllowStaticFieldAccess = ognlAllowStaticFieldAccess;\n+    }\n+\n     public Boolean getOgnlAllowStaticMethodAccess() {\n         return ognlAllowStaticMethodAccess;\n     }",
                "changes": 10,
                "blob_url": "https://github.com/apache/struts/blob/d3eb1fc5955f793d18aea5c43d0ca077e0a8794b/core/src/main/java/org/apache/struts2/config/entities/ConstantConfig.java"
            },
            {
                "additions": 3,
                "sha": "a441e77ba4db83bdb440a1ba222c4ead35f0420c",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/d3eb1fc5955f793d18aea5c43d0ca077e0a8794b/core/src/main/resources/org/apache/struts2/default.properties",
                "deletions": 0,
                "filename": "core/src/main/resources/org/apache/struts2/default.properties",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/resources/org/apache/struts2/default.properties?ref=d3eb1fc5955f793d18aea5c43d0ca077e0a8794b",
                "patch": "@@ -203,6 +203,9 @@ struts.xslt.nocache=false\n ### Whether to always select the namespace to be everything before the last slash or not\n struts.mapper.alwaysSelectFullNamespace=false\n \n+### Whether to allow static field access in OGNL expressions or not\n+struts.ognl.allowStaticFieldAccess=true\n+\n ### Whether to allow static method access in OGNL expressions or not\n struts.ognl.allowStaticMethodAccess=false\n ",
                "changes": 3,
                "blob_url": "https://github.com/apache/struts/blob/d3eb1fc5955f793d18aea5c43d0ca077e0a8794b/core/src/main/resources/org/apache/struts2/default.properties"
            },
            {
                "additions": 289,
                "sha": "b10cba7c61f9726330cfa94c98086a66ac12d331",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/d3eb1fc5955f793d18aea5c43d0ca077e0a8794b/core/src/test/java/com/opensymphony/xwork2/ognl/OgnlValueStackTest.java",
                "deletions": 5,
                "filename": "core/src/test/java/com/opensymphony/xwork2/ognl/OgnlValueStackTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/com/opensymphony/xwork2/ognl/OgnlValueStackTest.java?ref=d3eb1fc5955f793d18aea5c43d0ca077e0a8794b",
                "patch": "@@ -19,15 +19,15 @@\n package com.opensymphony.xwork2.ognl;\n \n import com.opensymphony.xwork2.*;\n-import com.opensymphony.xwork2.config.ConfigurationManager;\n-import com.opensymphony.xwork2.config.ConfigurationProvider;\n-import com.opensymphony.xwork2.config.providers.XmlConfigurationProvider;\n+import com.opensymphony.xwork2.config.ConfigurationException;\n import com.opensymphony.xwork2.conversion.impl.XWorkConverter;\n-import com.opensymphony.xwork2.inject.Container;\n+import com.opensymphony.xwork2.inject.ContainerBuilder;\n import com.opensymphony.xwork2.ognl.accessor.CompoundRootAccessor;\n+import com.opensymphony.xwork2.test.StubConfigurationProvider;\n import com.opensymphony.xwork2.test.TestBean2;\n import com.opensymphony.xwork2.util.*;\n import com.opensymphony.xwork2.util.Foo;\n+import com.opensymphony.xwork2.util.location.LocatableProperties;\n import com.opensymphony.xwork2.util.reflection.ReflectionContextState;\n import ognl.PropertyAccessor;\n \n@@ -36,17 +36,33 @@\n import java.util.HashMap;\n import java.util.LinkedHashMap;\n import java.util.Map;\n+import org.apache.struts2.StrutsConstants;\n \n \n /**\n  * Unit test for OgnlValueStack.\n  */\n public class OgnlValueStackTest extends XWorkTestCase {\n \n+    // Fields for static field access test\n+    public static final String STATIC_FINAL_PUBLIC_ATTRIBUTE = \"Static_Final_Public_Attribute\";\n+    static final String STATIC_FINAL_PACKAGE_ATTRIBUTE = \"Static_Final_Package_Attribute\";\n+    protected static final String STATIC_FINAL_PROTECTED_ATTRIBUTE = \"Static_Final_Protected_Attribute\";\n+    private static final String STATIC_FINAL_PRIVATE_ATTRIBUTE = \"Static_Final_Private_Attribute\";\n+    public static String STATIC_PUBLIC_ATTRIBUTE = \"Static_Public_Attribute\";\n+    static String STATIC_PACKAGE_ATTRIBUTE = \"Static_Package_Attribute\";\n+    protected static String STATIC_PROTECTED_ATTRIBUTE = \"Static_Protected_Attribute\";\n+    private static String STATIC_PRIVATE_ATTRIBUTE = \"Static_Private_Attribute\";\n+\n+\n     public static Integer staticNullMethod() {\n         return null;\n     }\n \n+    public static Integer staticInteger100Method() {\n+        return 100;\n+    }\n+\n     private OgnlUtil ognlUtil;\n \n     @Override\n@@ -66,9 +82,38 @@ private OgnlValueStack createValueStack(boolean allowStaticMethodAccess, boolean\n                 container.getInstance(TextProvider.class, \"system\"), allowStaticMethodAccess, allowStaticFieldAccess);\n         container.inject(stack);\n         ognlUtil.setAllowStaticMethodAccess(Boolean.toString(allowStaticMethodAccess));\n+        ognlUtil.setAllowStaticFieldAccess(Boolean.toString(allowStaticFieldAccess));\n         return stack;\n     }\n \n+    /**\n+     * @return current OgnlValueStackFactory instance from current container\n+     */\n+    private OgnlValueStackFactory getValueStackFactory() {\n+        return (OgnlValueStackFactory) container.getInstance(ValueStackFactory.class);\n+    }\n+\n+    /**\n+     * Reloads container and gets a new OgnlValueStackFactory with specified new configuration.\n+     * Intended for testing OgnlValueStack instance(s) that are minimally configured.\n+     * This should help ensure no underlying configuration/injection side-effects are responsible\n+     * for the behaviour of fundamental access control flags).\n+     * \n+     * @param allowStaticMethod new allowStaticMethod configuration\n+     * @param allowStaticField new allowStaticField configuration\n+     * @return a new OgnlValueStackFactory with specified new configuration\n+     */\n+    private OgnlValueStackFactory reloadValueStackFactory(Boolean allowStaticMethod, Boolean allowStaticField) {\n+        try {\n+            reloadTestContainerConfiguration(allowStaticMethod, allowStaticField);\n+        }\n+        catch (Exception ex) {\n+            fail(\"Unable to reload container configuration and configure ognlValueStackFactory - exception: \" + ex);\n+        }\n+\n+        return getValueStackFactory();\n+    }\n+\n     public void testExpOverridesCanStackExpUp() throws Exception {\n         Map expr1 = new LinkedHashMap();\n         expr1.put(\"expr1\", \"'expr1value'\");\n@@ -580,7 +625,7 @@ public void testNullMethod() {\n         OgnlValueStack stack = createValueStack();\n         stack.push(dog);\n         assertNull(stack.findValue(\"nullMethod()\"));\n-        assertNull(stack.findValue(\"@com.opensymphony.xwork2.util.OgnlValueStackTest@staticNullMethod()\"));\n+        assertNull(stack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@staticNullMethod()\"));\n     }\n \n     public void testPetSoarBug() {\n@@ -980,6 +1025,245 @@ public void testWarnAboutInvalidProperties() {\n         assertEquals(null, stack.findValue(\"address.country.name\", String.class));\n     }\n \n+   /**\n+     * Test a default OgnlValueStackFactory and OgnlValueStack generated by it\n+     * when a default configuration is used.\n+     */\n+    public void testOgnlValueStackFromOgnlValueStackFactoryDefaultConfig() {\n+        OgnlValueStackFactory ognlValueStackFactory = getValueStackFactory();\n+        OgnlValueStack ognlValueStack = (OgnlValueStack) ognlValueStackFactory.createValueStack();\n+        Object accessedValue;\n+\n+        // An OgnlValueStackFactory using a container config with default (from XWorkConfigurationProvider)\n+        // static access flag values present should prevent staticMethodAccess but allow staticFieldAccess.\n+        assertFalse(\"OgnlValueStackFactory staticMethodAccess (default flags) not false?\", ognlValueStackFactory.containerAllowsStaticMethodAccess());\n+        assertTrue(\"OgnlValueStackFactory staticFieldAccess (default flags) not true?\", ognlValueStackFactory.containerAllowsStaticFieldAccess());\n+        // An OgnlValueStack created from the above OgnlValueStackFactory should allow public field access,\n+        // but prevent non-public field access.  It should also deny static method access.\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@staticInteger100Method()\");\n+        assertNull(\"able to access static method (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PUBLIC_ATTRIBUTE\");\n+        assertEquals(\"accessed static final public field value not equal to actual?\", accessedValue, STATIC_FINAL_PUBLIC_ATTRIBUTE);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PUBLIC_ATTRIBUTE\");\n+        assertEquals(\"accessed static public field value not equal to actual?\", accessedValue, STATIC_PUBLIC_ATTRIBUTE);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PACKAGE_ATTRIBUTE\");\n+        assertNull(\"accessed final package field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PACKAGE_ATTRIBUTE\");\n+        assertNull(\"accessed package field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PROTECTED_ATTRIBUTE\");\n+        assertNull(\"accessed final protected field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PROTECTED_ATTRIBUTE\");\n+        assertNull(\"accessed protected field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PRIVATE_ATTRIBUTE\");\n+        assertNull(\"accessed final private field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PRIVATE_ATTRIBUTE\");\n+        assertNull(\"accessed private field (result not null) ?\", accessedValue);\n+    }\n+\n+    /**\n+     * Test a raw OgnlValueStackFactory and OgnlValueStack generated by it\n+     * when no static access flags are set (not present in configuration).\n+     */\n+    public void testOgnlValueStackFromOgnlValueStackFactoryNoFlagsSet() {\n+        OgnlValueStackFactory ognlValueStackFactory = reloadValueStackFactory(null, null);\n+        OgnlValueStack ognlValueStack = (OgnlValueStack) ognlValueStackFactory.createValueStack();\n+        Object accessedValue;\n+\n+        // An OgnlValueStackFactory using a container config with no static access flag values present\n+        // (such as from a DefaultConfiguration vs. XWorkConfigurationProvider) should\n+        // prevent staticMethodAccess AND prevent staticFieldAccess.\n+        // Note: Under normal circumstances, explicit static access configuration flags should be present,\n+        // but this specific check verifies what happens if those configuration flags are not present.\n+        assertFalse(\"OgnlValueStackFactory staticMethodAccess (no flag present) not false?\", ognlValueStackFactory.containerAllowsStaticMethodAccess());\n+        assertFalse(\"OgnlValueStackFactory staticFieldAccess (no flag present) not false?\", ognlValueStackFactory.containerAllowsStaticFieldAccess());\n+        // An OgnlValueStack created from the above OgnlValueStackFactory should prevent public field access,\n+        // and prevent non-public field access.  It should also deny static method access.\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@staticInteger100Method()\");\n+        assertNull(\"able to access static method (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PUBLIC_ATTRIBUTE\");\n+        assertNull(\"able to access static final public field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PUBLIC_ATTRIBUTE\");\n+        assertNull(\"able to access static public field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PACKAGE_ATTRIBUTE\");\n+        assertNull(\"accessed final package field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PACKAGE_ATTRIBUTE\");\n+        assertNull(\"accessed package field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PROTECTED_ATTRIBUTE\");\n+        assertNull(\"accessed final protected field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PROTECTED_ATTRIBUTE\");\n+        assertNull(\"accessed protected field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PRIVATE_ATTRIBUTE\");\n+        assertNull(\"accessed final private field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PRIVATE_ATTRIBUTE\");\n+        assertNull(\"accessed private field (result not null) ?\", accessedValue);\n+    }\n+\n+    /**\n+     * Test a raw OgnlValueStackFactory and OgnlValueStack generated by it\n+     * when both static access flags are set to false.\n+     */\n+    public void testOgnlValueStackFromOgnlValueStackFactoryNoStaticAccess() {\n+        OgnlValueStackFactory ognlValueStackFactory = reloadValueStackFactory(false, false);\n+        OgnlValueStack ognlValueStack = (OgnlValueStack) ognlValueStackFactory.createValueStack();\n+        Object accessedValue;\n+\n+        // An OgnlValueStackFactory using a container config with both static access flags set false should\n+        // prevent staticMethodAccess AND prevent staticFieldAccess.\n+        assertFalse(\"OgnlValueStackFactory staticMethodAccess (set false) not false?\", ognlValueStackFactory.containerAllowsStaticMethodAccess());\n+        assertFalse(\"OgnlValueStackFactory staticFieldAccess (set false) not false?\", ognlValueStackFactory.containerAllowsStaticFieldAccess());\n+        // An OgnlValueStack created from the above OgnlValueStackFactory should prevent public field access,\n+        // and prevent non-public field access.  It should also deny static method access.\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@staticInteger100Method()\");\n+        assertNull(\"able to access static method (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PUBLIC_ATTRIBUTE\");\n+        assertNull(\"able to access static final public field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PUBLIC_ATTRIBUTE\");\n+        assertNull(\"able to access static public field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PACKAGE_ATTRIBUTE\");\n+        assertNull(\"accessed final package field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PACKAGE_ATTRIBUTE\");\n+        assertNull(\"accessed package field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PROTECTED_ATTRIBUTE\");\n+        assertNull(\"accessed final protected field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PROTECTED_ATTRIBUTE\");\n+        assertNull(\"accessed protected field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PRIVATE_ATTRIBUTE\");\n+        assertNull(\"accessed final private field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PRIVATE_ATTRIBUTE\");\n+        assertNull(\"accessed private field (result not null) ?\", accessedValue);\n+    }\n+\n+    /**\n+     * Test a raw OgnlValueStackFactory and OgnlValueStack generated by it\n+     * when both static access flags are set to true.\n+     */\n+    public void testOgnlValueStackFromOgnlValueStackFactoryAllStaticAccess() {\n+        OgnlValueStackFactory ognlValueStackFactory = reloadValueStackFactory(true, true);\n+        OgnlValueStack ognlValueStack = (OgnlValueStack) ognlValueStackFactory.createValueStack();\n+        Object accessedValue;\n+\n+        // An OgnlValueStackFactory using a container config with both static access flags set true should\n+        // allow both staticMethodAccess AND staticFieldAccess.\n+        assertTrue(\"OgnlValueStackFactory staticMethodAccess (set true) not true?\", ognlValueStackFactory.containerAllowsStaticMethodAccess());\n+        assertTrue(\"OgnlValueStackFactory staticFieldAccess (set true) not true?\", ognlValueStackFactory.containerAllowsStaticFieldAccess());\n+        // An OgnlValueStack created from the above OgnlValueStackFactory should allow public field access,\n+        // but prevent non-public field access.  It should also allow static method access.\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@staticInteger100Method()\");\n+        assertNotNull(\"unable to access static method (result null) ?\", accessedValue);\n+        assertEquals(\"accessed static method result not equal to expected?\", accessedValue, staticInteger100Method());\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PUBLIC_ATTRIBUTE\");\n+        assertEquals(\"accessed static final public field value not equal to actual?\", accessedValue, STATIC_FINAL_PUBLIC_ATTRIBUTE);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PUBLIC_ATTRIBUTE\");\n+        assertEquals(\"accessed static public field value not equal to actual?\", accessedValue, STATIC_PUBLIC_ATTRIBUTE);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PACKAGE_ATTRIBUTE\");\n+        assertNull(\"accessed final package field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PACKAGE_ATTRIBUTE\");\n+        assertNull(\"accessed package field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PROTECTED_ATTRIBUTE\");\n+        assertNull(\"accessed final protected field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PROTECTED_ATTRIBUTE\");\n+        assertNull(\"accessed protected field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PRIVATE_ATTRIBUTE\");\n+        assertNull(\"accessed final private field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PRIVATE_ATTRIBUTE\");\n+        assertNull(\"accessed private field (result not null) ?\", accessedValue);\n+    }\n+\n+    /**\n+     * Test a raw OgnlValueStackFactory and OgnlValueStack generated by it\n+     * when static method access flag is true, static field access flag is false.\n+     */\n+    public void testOgnlValueStackFromOgnlValueStackFactoryOnlyStaticMethodAccess() {\n+        OgnlValueStackFactory ognlValueStackFactory = reloadValueStackFactory(true, false);\n+        OgnlValueStack ognlValueStack = (OgnlValueStack) ognlValueStackFactory.createValueStack();\n+        Object accessedValue;\n+\n+        // An OgnlValueStackFactory using a container config with static method access flag true, static field access false should\n+        // allow staticMethodAccess but deny staticFieldAccess.\n+        assertTrue(\"OgnlValueStackFactory staticMethodAccess (set true) not true?\", ognlValueStackFactory.containerAllowsStaticMethodAccess());\n+        assertFalse(\"OgnlValueStackFactory staticFieldAccess (set false) not false?\", ognlValueStackFactory.containerAllowsStaticFieldAccess());\n+        // An OgnlValueStack created from the above OgnlValueStackFactory should deny public field access,\n+        // and also prevent non-public field access.  It should also allow static method access.\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@staticInteger100Method()\");\n+        assertNotNull(\"unable to access static method (result null) ?\", accessedValue);\n+        assertEquals(\"accessed static method result not equal to expected?\", accessedValue, staticInteger100Method());\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PUBLIC_ATTRIBUTE\");\n+        assertNull(\"able to access static final public field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PUBLIC_ATTRIBUTE\");\n+        assertNull(\"able to access static public field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PACKAGE_ATTRIBUTE\");\n+        assertNull(\"accessed final package field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PACKAGE_ATTRIBUTE\");\n+        assertNull(\"accessed package field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PROTECTED_ATTRIBUTE\");\n+        assertNull(\"accessed final protected field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PROTECTED_ATTRIBUTE\");\n+        assertNull(\"accessed protected field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PRIVATE_ATTRIBUTE\");\n+        assertNull(\"accessed final private field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PRIVATE_ATTRIBUTE\");\n+        assertNull(\"accessed private field (result not null) ?\", accessedValue);\n+    }\n+\n+    /**\n+     * Test a raw OgnlValueStackFactory and OgnlValueStack generated by it\n+     * when static method access flag is false, static field access flag is true.\n+     */\n+    public void testOgnlValueStackFromOgnlValueStackFactoryOnlyStaticFieldAccess() {\n+        OgnlValueStackFactory ognlValueStackFactory = reloadValueStackFactory(false, true);\n+        OgnlValueStack ognlValueStack = (OgnlValueStack) ognlValueStackFactory.createValueStack();\n+        Object accessedValue;\n+\n+        // An OgnlValueStackFactory using a container config with static method access flag false, static field access true should\n+        // deny staticMethodAccess but allow staticFieldAccess.\n+        assertFalse(\"OgnlValueStackFactory staticMethodAccess (set false) not false?\", ognlValueStackFactory.containerAllowsStaticMethodAccess());\n+        assertTrue(\"OgnlValueStackFactory staticFieldAccess (set true) not true?\", ognlValueStackFactory.containerAllowsStaticFieldAccess());\n+        // An OgnlValueStack created from the above OgnlValueStackFactory should allow public field access,\n+        // but prevent non-public field access.  It should also deny static method access.\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@staticInteger100Method()\");\n+        assertNull(\"able to access static method (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PUBLIC_ATTRIBUTE\");\n+        assertEquals(\"accessed static final public field value not equal to actual?\", accessedValue, STATIC_FINAL_PUBLIC_ATTRIBUTE);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PUBLIC_ATTRIBUTE\");\n+        assertEquals(\"accessed static public field value not equal to actual?\", accessedValue, STATIC_PUBLIC_ATTRIBUTE);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PACKAGE_ATTRIBUTE\");\n+        assertNull(\"accessed final package field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PACKAGE_ATTRIBUTE\");\n+        assertNull(\"accessed package field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PROTECTED_ATTRIBUTE\");\n+        assertNull(\"accessed final protected field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PROTECTED_ATTRIBUTE\");\n+        assertNull(\"accessed protected field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_FINAL_PRIVATE_ATTRIBUTE\");\n+        assertNull(\"accessed final private field (result not null) ?\", accessedValue);\n+        accessedValue = ognlValueStack.findValue(\"@com.opensymphony.xwork2.ognl.OgnlValueStackTest@STATIC_PRIVATE_ATTRIBUTE\");\n+        assertNull(\"accessed private field (result not null) ?\", accessedValue);\n+    }\n+\n+    private void reloadTestContainerConfiguration(Boolean allowStaticMethod, Boolean allowStaticField) throws Exception {\n+        loadConfigurationProviders(new StubConfigurationProvider() {\n+            @Override\n+            public void register(ContainerBuilder builder,\n+                                 LocatableProperties props) throws ConfigurationException {\n+                // null values simulate undefined (by removing).\n+                // undefined values then should be evaluated to false\n+                if (props.containsKey(StrutsConstants.STRUTS_ALLOW_STATIC_METHOD_ACCESS)) {\n+                    props.remove(StrutsConstants.STRUTS_ALLOW_STATIC_METHOD_ACCESS);\n+                }\n+                if (props.containsKey(StrutsConstants.STRUTS_ALLOW_STATIC_FIELD_ACCESS)) {\n+                    props.remove(StrutsConstants.STRUTS_ALLOW_STATIC_FIELD_ACCESS);\n+                }\n+                if (allowStaticMethod != null) {\n+                    props.setProperty(StrutsConstants.STRUTS_ALLOW_STATIC_METHOD_ACCESS, \"\" + allowStaticMethod);\n+                }\n+                if (allowStaticField != null) {\n+                    props.setProperty(StrutsConstants.STRUTS_ALLOW_STATIC_FIELD_ACCESS, \"\" + allowStaticField);\n+                }\n+            }\n+        });\n+        ognlUtil = container.getInstance(OgnlUtil.class);\n+    }\n+\n     class BadJavaBean {\n         private int count;\n         private int count2;",
                "changes": 294,
                "blob_url": "https://github.com/apache/struts/blob/d3eb1fc5955f793d18aea5c43d0ca077e0a8794b/core/src/test/java/com/opensymphony/xwork2/ognl/OgnlValueStackTest.java"
            }
        ],
        "repo": "struts",
        "message": "Fix for default (un-configured) allowStaticFieldAccess state, Showcase Application in 2.6.x (#334)\n\n* Fix for default un-configured allowStaticFieldAccess state:\r\n1) Ensure OgnlValueStackFactory returns true for allowStaticFieldAccess when not configured (consistency - same as OgnlUtil does).\r\n2) Add test to OgnlValueStackTest for the no allowStaticXXX flags present.\r\n\r\nMinor config fixes for the Showcase Application in 2.6.x:\r\n1) File upload examples.  Multiple file upload missing result page (list and array), added missing JSP.  Added missing input results in configuration.\r\n2) File upload examples.  Fixed NPE for multiple file upload (array version) when no files selected.\r\n3) Add manual test for public constant access via expression (to If tag JSP).\r\n\r\n* Added missed logic elements from PR#320 (identified by Y. Zamani):\r\n1) Added ognlAllowStaticFieldAccess field and getter/setter to ConstantConfig.\r\n2) Added allowStaticFieldAccess (set to true) to default.properties.\r\n\r\n* Follow-up commit:\r\n- Fixed wrong package reference in testNullMethod(), as well as in new tets.\r\n- Added additional tests to cover the full set of static access flag combinations.\r\n\r\n* Follow-up commit:\r\n- Fixed createValueStack() not setting allowStaticFieldAccess parameter.\r\n- Removed 3 unused import statement.\r\n- Refactored OgnlValueStackFactory creation logic into two utility methods: getValueStackFactory(), reloadValueStackFactory()\r\n- Added one additional test with a raw OgnlValueStackFactory generated OgnlValueStack (staticMethodAccess false, staticFieldAccess true).\r\n  Test confirms same result as with a default OgnlValueStackFactory.",
        "commit": "https://github.com/apache/struts/commit/d3eb1fc5955f793d18aea5c43d0ca077e0a8794b"
    },
    {
        "parent": "https://github.com/apache/struts/commit/ae5605ff8872daa08f12c84fb7a2b30f5f57e8ea",
        "bug_id": "struts_8",
        "file": [
            {
                "additions": 12,
                "sha": "69d3c62cb80a290a5ae398cad1b79ab09f590306",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1ff8a88a9df4b5cb9ffbdbb21028dc61d3236b01/core/src/main/java/org/apache/struts2/conversion/UploadedFileConverter.java",
                "deletions": 8,
                "filename": "core/src/main/java/org/apache/struts2/conversion/UploadedFileConverter.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/conversion/UploadedFileConverter.java?ref=1ff8a88a9df4b5cb9ffbdbb21028dc61d3236b01",
                "patch": "@@ -36,18 +36,22 @@\n     @Override\n     public Object convertValue(Map<String, Object> context, Object target, Member member, String propertyName, Object value, Class toType) {\n         if (File.class.equals(toType)) {\n-            LOG.warn(\"Converting {} into {}, consider switching to {} and do not access {} directly!\",\n+            LOG.debug(\"Converting {} into {}, consider switching to {} and do not access {} directly!\",\n                     File.class.getName(), UploadedFile.class.getName(), UploadedFile.class.getName(), File.class.getName());\n \n+            Object obj;\n             if (value.getClass().isArray() && Array.getLength(value) == 1) {\n-                Object obj = Array.get(value, 0);\n-                if (obj instanceof UploadedFile) {\n-                    UploadedFile file = (UploadedFile) obj;\n-                    if (file.getContent() instanceof File) {\n-                        return file.getContent();\n-                    }\n-                    return new File(file.getAbsolutePath());\n+                obj = Array.get(value, 0);\n+            } else {\n+                obj = value;\n+            }\n+\n+            if (obj instanceof UploadedFile) {\n+                UploadedFile file = (UploadedFile) obj;\n+                if (file.getContent() instanceof File) {\n+                    return file.getContent();\n                 }\n+                return new File(file.getAbsolutePath());\n             }\n         }\n ",
                "changes": 20,
                "blob_url": "https://github.com/apache/struts/blob/1ff8a88a9df4b5cb9ffbdbb21028dc61d3236b01/core/src/main/java/org/apache/struts2/conversion/UploadedFileConverter.java"
            }
        ],
        "repo": "struts",
        "message": "Fixes issue with NPE",
        "commit": "https://github.com/apache/struts/commit/1ff8a88a9df4b5cb9ffbdbb21028dc61d3236b01"
    },
    {
        "parent": "https://github.com/apache/struts/commit/f22873e127ca8c4de8b636415eb8097db77d79c6",
        "bug_id": "struts_9",
        "file": [
            {
                "additions": 5,
                "sha": "b7564a943706eabbe48cc0068b43a4a38605844b",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/a399932ae9903167d1ee647b141cc98fdf83ef6f/plugins/tiles/src/main/java/org/apache/struts2/tiles/StrutsTilesContainerFactory.java",
                "deletions": 1,
                "filename": "plugins/tiles/src/main/java/org/apache/struts2/tiles/StrutsTilesContainerFactory.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/tiles/src/main/java/org/apache/struts2/tiles/StrutsTilesContainerFactory.java?ref=a399932ae9903167d1ee647b141cc98fdf83ef6f",
                "patch": "@@ -190,9 +190,13 @@ protected LocaleResolver createLocaleResolver(ApplicationContext applicationCont\n             resources.addAll(applicationContext.getResources(definition));\n         }\n \n+        if (resources.contains(null)) {\n+            LOG.warn(\"Some resources were not found. Definitions: {}. Found resources: {}\", definitions, resources);\n+        }\n+\n         List<ApplicationResource> filteredResources = new ArrayList<>();\n         for (ApplicationResource resource : resources) {\n-            if (Locale.ROOT.equals(resource.getLocale())) {\n+            if (resource != null && Locale.ROOT.equals(resource.getLocale())) {\n                 filteredResources.add(resource);\n             }\n         }",
                "changes": 6,
                "blob_url": "https://github.com/apache/struts/blob/a399932ae9903167d1ee647b141cc98fdf83ef6f/plugins/tiles/src/main/java/org/apache/struts2/tiles/StrutsTilesContainerFactory.java"
            }
        ],
        "repo": "struts",
        "message": "WW-4743 NPE in StrutsTilesContainerFactory when resource isn't found",
        "commit": "https://github.com/apache/struts/commit/a399932ae9903167d1ee647b141cc98fdf83ef6f"
    },
    {
        "parent": "https://github.com/apache/struts/commit/e53a3406e0bc4fae4bd16799a0db5d449c44390b",
        "bug_id": "struts_10",
        "file": [
            {
                "additions": 6,
                "sha": "df6152bd52eceebacd62e61e344406c868bddfb5",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/b6a7a0e38a71707523517fa33570955c182e7bdc/plugins/tiles/src/main/java/org/apache/struts2/tiles/StrutsWildcardServletApplicationContext.java",
                "deletions": 2,
                "filename": "plugins/tiles/src/main/java/org/apache/struts2/tiles/StrutsWildcardServletApplicationContext.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/tiles/src/main/java/org/apache/struts2/tiles/StrutsWildcardServletApplicationContext.java?ref=b6a7a0e38a71707523517fa33570955c182e7bdc",
                "patch": "@@ -54,8 +54,12 @@ public StrutsWildcardServletApplicationContext(ServletContext context) {\n \n         for (Object path : context.getResourcePaths(\"/\")) {\n             try {\n-                URL url = new File(context.getRealPath(String.valueOf(path))).toURI().toURL();\n-                urls.add(url);\n+                String realPath = context.getRealPath(String.valueOf(path));\n+\n+                if (realPath != null) {\n+                    URL url = new File(realPath).toURI().toURL();\n+                    urls.add(url);\n+                }\n             } catch (MalformedURLException e) {\n                 throw new ConfigurationException(e);\n             }",
                "changes": 8,
                "blob_url": "https://github.com/apache/struts/blob/b6a7a0e38a71707523517fa33570955c182e7bdc/plugins/tiles/src/main/java/org/apache/struts2/tiles/StrutsWildcardServletApplicationContext.java"
            }
        ],
        "repo": "struts",
        "message": "WW-4622 - getRealPath NPE check",
        "commit": "https://github.com/apache/struts/commit/b6a7a0e38a71707523517fa33570955c182e7bdc"
    },
    {
        "parent": "https://github.com/apache/struts/commit/92c54de11030d6f6325386dd24ba92efb9f34a90",
        "bug_id": "struts_11",
        "file": [
            {
                "additions": 2,
                "sha": "054038f00e28e8fa80fb548ea4dca4f4b6618ee5",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/7dbe3ea8bb97cd004e77541c761bbe20e4373c3d/core/src/main/java/org/apache/struts2/util/ComponentUtils.java",
                "deletions": 2,
                "filename": "core/src/main/java/org/apache/struts2/util/ComponentUtils.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/util/ComponentUtils.java?ref=7dbe3ea8bb97cd004e77541c761bbe20e4373c3d",
                "patch": "@@ -44,11 +44,11 @@ public static boolean altSyntax(ValueStack stack) {\n      * @return true if it is an expression\r\n      */\r\n     public static boolean isExpression(String expr) {\r\n-        return expr.startsWith(\"%{\") && expr.endsWith(\"}\");\r\n+        return expr != null && expr.startsWith(\"%{\") && expr.endsWith(\"}\");\r\n     }\r\n \r\n     public static boolean containsExpression(String expr) {\r\n-        return expr.contains(\"%{\") && expr.contains(\"}\");\r\n+        return expr != null && expr.contains(\"%{\") && expr.contains(\"}\");\r\n     }\r\n \r\n }\r",
                "changes": 4,
                "blob_url": "https://github.com/apache/struts/blob/7dbe3ea8bb97cd004e77541c761bbe20e4373c3d/core/src/main/java/org/apache/struts2/util/ComponentUtils.java"
            },
            {
                "additions": 8,
                "sha": "1e05ebdfa31b0d0881fd02be00a1f594f65617d6",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/7dbe3ea8bb97cd004e77541c761bbe20e4373c3d/core/src/test/java/org/apache/struts2/util/ComponentUtilsTest.java",
                "deletions": 0,
                "filename": "core/src/test/java/org/apache/struts2/util/ComponentUtilsTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/org/apache/struts2/util/ComponentUtilsTest.java?ref=7dbe3ea8bb97cd004e77541c761bbe20e4373c3d",
                "patch": "@@ -93,6 +93,10 @@ public void testIsExpressionIsFalse() throws Exception {\n         assertFalse(actual);\r\n     }\r\n \r\n+    public void testIsExpressionIsFalseWhenNull() throws Exception {\r\n+        assertFalse(ComponentUtils.isExpression(null));\r\n+    }\r\n+\r\n     public void testContainsExpressionIsTrue() throws Exception {\r\n         // given\r\n         String anExpression = \"%{foo}\";\r\n@@ -125,6 +129,10 @@ public void testContainsExpressionIsFalse() throws Exception {\n         // then\r\n         assertFalse(actual);\r\n     }\r\n+\r\n+    public void testContainsExpressionIsFalseWhenNull() throws Exception {\r\n+        assertFalse(ComponentUtils.containsExpression(null));\r\n+    }\r\n }\r\n \r\n class MockConfigurationProvider implements ConfigurationProvider {\r",
                "changes": 8,
                "blob_url": "https://github.com/apache/struts/blob/7dbe3ea8bb97cd004e77541c761bbe20e4373c3d/core/src/test/java/org/apache/struts2/util/ComponentUtilsTest.java"
            }
        ],
        "repo": "struts",
        "message": "WW-4663 Checks if expression is null to avoid NPE",
        "commit": "https://github.com/apache/struts/commit/7dbe3ea8bb97cd004e77541c761bbe20e4373c3d"
    },
    {
        "parent": "https://github.com/apache/struts/commit/4cd9a74cb8efa8dc0d3c57ac267a70b0538f3bf0",
        "bug_id": "struts_12",
        "file": [
            {
                "additions": 4,
                "sha": "2277becce1d406fd7b5e57c6704eb8fa0e9cf2bf",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/f2f5338ded3c2256c878a9d7cb3a62c1b07ce2e7/core/src/main/java/com/opensymphony/xwork2/util/LocalizedTextUtil.java",
                "deletions": 1,
                "filename": "core/src/main/java/com/opensymphony/xwork2/util/LocalizedTextUtil.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/com/opensymphony/xwork2/util/LocalizedTextUtil.java?ref=f2f5338ded3c2256c878a9d7cb3a62c1b07ce2e7",
                "patch": "@@ -736,9 +736,12 @@ private static String getMessage(String bundleName, Locale locale, String key, V\n         if (bundle == null) {\n             return null;\n         }\n+        if (valueStack != null) \n             reloadBundles(valueStack.getContext());\n         try {\n-            String message = TextParseUtil.translateVariables(bundle.getString(key), valueStack);\n+        \tString message = bundle.getString(key);\n+        \tif (valueStack != null) \n+        \t\tmessage = TextParseUtil.translateVariables(bundle.getString(key), valueStack);\n             MessageFormat mf = buildMessageFormat(message, locale);\n             return formatWithNullDetection(mf, args);\n         } catch (MissingResourceException e) {",
                "changes": 5,
                "blob_url": "https://github.com/apache/struts/blob/f2f5338ded3c2256c878a9d7cb3a62c1b07ce2e7/core/src/main/java/com/opensymphony/xwork2/util/LocalizedTextUtil.java"
            }
        ],
        "repo": "struts",
        "message": "Improve LocalizedTextUtil.getMessage() defend NPE\n\nDefend NPE if not ValueStack presented, for example non-struts request like static util method or backend thread.",
        "commit": "https://github.com/apache/struts/commit/f2f5338ded3c2256c878a9d7cb3a62c1b07ce2e7"
    },
    {
        "parent": "https://github.com/apache/struts/commit/c167d6c855f9f3f5863d8fa20ab45aa28cb77486",
        "bug_id": "struts_13",
        "file": [
            {
                "additions": 10,
                "sha": "643d73d23788c52746a712b8370730734dacb456",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/bc8d37464756bf821acae003c6a140af6dcbaf09/core/src/main/java/org/apache/struts2/dispatcher/multipart/JakartaMultiPartRequest.java",
                "deletions": 2,
                "filename": "core/src/main/java/org/apache/struts2/dispatcher/multipart/JakartaMultiPartRequest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/dispatcher/multipart/JakartaMultiPartRequest.java?ref=bc8d37464756bf821acae003c6a140af6dcbaf09",
                "patch": "@@ -83,9 +83,17 @@ public void parse(HttpServletRequest request, String saveDir) throws IOException\n         try {\n             setLocale(request);\n             processUpload(request, saveDir);\n-        } catch (FileUploadBase.SizeLimitExceededException e) {\n+        } catch (FileUploadException e) {\n             LOG.warn(\"Request exceeded size limit!\", e);\n-            String errorMessage = buildErrorMessage(e, new Object[]{e.getPermittedSize(), e.getActualSize()});\n+            String errorMessage = null;\n+            \n+            if(e instanceof FileUploadBase.SizeLimitExceededException) {\n+                FileUploadBase.SizeLimitExceededException ex = (FileUploadBase.SizeLimitExceededException) e;\n+                errorMessage = buildErrorMessage(e, new Object[]{ex.getPermittedSize(), ex.getActualSize()});\n+            } else {\n+                errorMessage = buildErrorMessage(e, new Object[]{});\n+            }\n+            \n             if (!errors.contains(errorMessage)) {\n                 errors.add(errorMessage);\n             }",
                "changes": 12,
                "blob_url": "https://github.com/apache/struts/blob/bc8d37464756bf821acae003c6a140af6dcbaf09/core/src/main/java/org/apache/struts2/dispatcher/multipart/JakartaMultiPartRequest.java"
            }
        ],
        "repo": "struts",
        "message": "WW-4456 - Got NPE when File Upload Limitation exceeds in portal env.",
        "commit": "https://github.com/apache/struts/commit/bc8d37464756bf821acae003c6a140af6dcbaf09"
    },
    {
        "parent": "https://github.com/apache/struts/commit/532841d40f164a8d8ae6ac0b85b60d3cf6db0011",
        "bug_id": "struts_14",
        "file": [
            {
                "additions": 30,
                "sha": "96405fb379c13c92adfffe83eba02f48b46bad04",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/29de8687ddea5bc777e9401ffd4887f93333dc6b/plugins/sitemesh/src/main/java/org/apache/struts2/sitemesh/StrutsSiteMeshFactory.java",
                "deletions": 1,
                "filename": "plugins/sitemesh/src/main/java/org/apache/struts2/sitemesh/StrutsSiteMeshFactory.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/sitemesh/src/main/java/org/apache/struts2/sitemesh/StrutsSiteMeshFactory.java?ref=29de8687ddea5bc777e9401ffd4887f93333dc6b",
                "patch": "@@ -1,14 +1,36 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n package org.apache.struts2.sitemesh;\n \n import com.opensymphony.module.sitemesh.Config;\n import com.opensymphony.module.sitemesh.factory.DefaultFactory;\n+import com.opensymphony.xwork2.ActionContext;\n+import com.opensymphony.xwork2.util.logging.Logger;\n+import com.opensymphony.xwork2.util.logging.LoggerFactory;\n import org.apache.commons.lang3.ObjectUtils;\n import org.apache.struts2.ServletActionContext;\n import org.apache.struts2.StrutsStatics;\n \n-\n public class StrutsSiteMeshFactory extends DefaultFactory {\n \n+    private static final Logger LOG = LoggerFactory.getLogger(StrutsSiteMeshFactory.class);\n+\n     public StrutsSiteMeshFactory(Config config) {\n         super(config);\n     }\n@@ -22,7 +44,14 @@ public boolean shouldParsePage(String contentType) {\n     }\n \n     private boolean isInsideActionTag() {\n+        if(ActionContext.getContext() == null) {\n+            if (LOG.isTraceEnabled()) {\n+                LOG.trace(\"ActionContext is null! Not a user request?\");\n+            }\n+            return false;\n+        }\n         Object attribute = ServletActionContext.getRequest().getAttribute(StrutsStatics.STRUTS_ACTION_TAG_INVOCATION);\n         return (Boolean) ObjectUtils.defaultIfNull(attribute, Boolean.FALSE);\n     }\n+\n }",
                "changes": 31,
                "blob_url": "https://github.com/apache/struts/blob/29de8687ddea5bc777e9401ffd4887f93333dc6b/plugins/sitemesh/src/main/java/org/apache/struts2/sitemesh/StrutsSiteMeshFactory.java"
            }
        ],
        "repo": "struts",
        "message": "WW-4419 Fixes NPE when performing async request",
        "commit": "https://github.com/apache/struts/commit/29de8687ddea5bc777e9401ffd4887f93333dc6b"
    },
    {
        "parent": "https://github.com/apache/struts/commit/8fd4f8cad44c0f5aefd438d62cebc8fc287d4ea4",
        "bug_id": "struts_15",
        "file": [
            {
                "additions": 5,
                "sha": "e548a0046f0e2cae78bc341aef09e5048c7713de",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/3a29bc3575b7f63d8993baed5b372ca62922511a/core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java",
                "deletions": 2,
                "filename": "core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java?ref=3a29bc3575b7f63d8993baed5b372ca62922511a",
                "patch": "@@ -17,6 +17,7 @@\n \n import java.util.ArrayList;\n import java.util.List;\n+import java.util.concurrent.CopyOnWriteArrayList;\n \n \n /**\n@@ -25,12 +26,14 @@\n  * @author plightbo\n  * @version $Revision$\n  */\n-public class CompoundRoot extends ArrayList {\n+public class CompoundRoot extends CopyOnWriteArrayList<Object> {\n+\n+    private static final long serialVersionUID = 8563229069192473995L;\n \n     public CompoundRoot() {\n     }\n \n-    public CompoundRoot(List list) {\n+    public CompoundRoot(List<?> list) {\n         super(list);\n     }\n ",
                "changes": 7,
                "blob_url": "https://github.com/apache/struts/blob/3a29bc3575b7f63d8993baed5b372ca62922511a/core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java"
            }
        ],
        "repo": "struts",
        "message": "fix for WW-4573\n\nNPE/ concurrent modification exception\n\nusing a CopyOnWriteArrayList. This is to keep Memory consistency on the\nValueStack.",
        "commit": "https://github.com/apache/struts/commit/3a29bc3575b7f63d8993baed5b372ca62922511a"
    },
    {
        "parent": "https://github.com/apache/struts/commit/3a29bc3575b7f63d8993baed5b372ca62922511a",
        "bug_id": "struts_16",
        "file": [
            {
                "additions": 0,
                "sha": "49b47dad0866a916699a40713e828b05bcb47524",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/8d4bb890abb004a70a539ad4a3d0fc51dd53b407/core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java",
                "deletions": 1,
                "filename": "core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java?ref=8d4bb890abb004a70a539ad4a3d0fc51dd53b407",
                "patch": "@@ -15,7 +15,6 @@\n  */\n package com.opensymphony.xwork2.util;\n \n-import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CopyOnWriteArrayList;\n ",
                "changes": 1,
                "blob_url": "https://github.com/apache/struts/blob/8d4bb890abb004a70a539ad4a3d0fc51dd53b407/core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java"
            }
        ],
        "repo": "struts",
        "message": "fix for WW-4573\n\nNPE/ concurrent modification exception\n\nusing a CopyOnWriteArrayList. This is to keep Memory consistency on the\nValueStack.",
        "commit": "https://github.com/apache/struts/commit/8d4bb890abb004a70a539ad4a3d0fc51dd53b407"
    },
    {
        "parent": "https://github.com/apache/struts/commit/ec5a301b5335ef86880f5b3ec8c57c9ef42ef912",
        "bug_id": "struts_17",
        "file": [],
        "repo": "struts",
        "message": " fix for WW-4573\n\nNPE/ concurrent modification exception\n\nusing a CopyOnWriteArrayList. This is to keep Memory consistency on the\nValueStack.",
        "commit": "https://github.com/apache/struts/commit/b257250036c05233d072c69189258a69f68ee057"
    },
    {
        "parent": "https://github.com/apache/struts/commit/ec5a301b5335ef86880f5b3ec8c57c9ef42ef912",
        "bug_id": "struts_18",
        "file": [
            {
                "additions": 1,
                "sha": "7a8639f3f7e9727a428a2ab1c04ef5970b4a0290",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/cfc6f19ec7087da8496bd05a994150f8acf7f102/core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java",
                "deletions": 0,
                "filename": "core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java?ref=cfc6f19ec7087da8496bd05a994150f8acf7f102",
                "patch": "@@ -15,6 +15,7 @@\n  */\n package com.opensymphony.xwork2.util;\n \n+\n import java.util.List;\n import java.util.concurrent.CopyOnWriteArrayList;\n ",
                "changes": 1,
                "blob_url": "https://github.com/apache/struts/blob/cfc6f19ec7087da8496bd05a994150f8acf7f102/core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java"
            }
        ],
        "repo": "struts",
        "message": " fix for WW-4573\n\nNPE/ concurrent modification exception\n\nusing a CopyOnWriteArrayList. This is to keep Memory consistency on the\nValueStack.",
        "commit": "https://github.com/apache/struts/commit/cfc6f19ec7087da8496bd05a994150f8acf7f102"
    },
    {
        "parent": "https://github.com/apache/struts/commit/ac4199e0d89a763de7bfcd7c9176c09c375e1c57",
        "bug_id": "struts_19",
        "file": [
            {
                "additions": 5,
                "sha": "49b47dad0866a916699a40713e828b05bcb47524",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/ec5a301b5335ef86880f5b3ec8c57c9ef42ef912/core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java",
                "deletions": 3,
                "filename": "core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java?ref=ec5a301b5335ef86880f5b3ec8c57c9ef42ef912",
                "patch": "@@ -15,8 +15,8 @@\n  */\n package com.opensymphony.xwork2.util;\n \n-import java.util.ArrayList;\n import java.util.List;\n+import java.util.concurrent.CopyOnWriteArrayList;\n \n \n /**\n@@ -25,12 +25,14 @@\n  * @author plightbo\n  * @version $Revision$\n  */\n-public class CompoundRoot extends ArrayList {\n+public class CompoundRoot extends CopyOnWriteArrayList<Object> {\n+\n+    private static final long serialVersionUID = 8563229069192473995L;\n \n     public CompoundRoot() {\n     }\n \n-    public CompoundRoot(List list) {\n+    public CompoundRoot(List<?> list) {\n         super(list);\n     }\n ",
                "changes": 8,
                "blob_url": "https://github.com/apache/struts/blob/ec5a301b5335ef86880f5b3ec8c57c9ef42ef912/core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java"
            }
        ],
        "repo": "struts",
        "message": "fix for WW-4573\n\nNPE/ concurrent modification exception\n\nusing a CopyOnWriteArrayList. This is to keep Memory consistency on the\nValueStack.",
        "commit": "https://github.com/apache/struts/commit/ec5a301b5335ef86880f5b3ec8c57c9ef42ef912"
    },
    {
        "parent": "https://github.com/apache/struts/commit/ac4199e0d89a763de7bfcd7c9176c09c375e1c57",
        "bug_id": "struts_20",
        "file": [
            {
                "additions": 5,
                "sha": "e548a0046f0e2cae78bc341aef09e5048c7713de",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1df5a75bfcc3c1093a2516f16258bbe96d5d8dcf/core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java",
                "deletions": 2,
                "filename": "core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java?ref=1df5a75bfcc3c1093a2516f16258bbe96d5d8dcf",
                "patch": "@@ -17,6 +17,7 @@\n \n import java.util.ArrayList;\n import java.util.List;\n+import java.util.concurrent.CopyOnWriteArrayList;\n \n \n /**\n@@ -25,12 +26,14 @@\n  * @author plightbo\n  * @version $Revision$\n  */\n-public class CompoundRoot extends ArrayList {\n+public class CompoundRoot extends CopyOnWriteArrayList<Object> {\n+\n+    private static final long serialVersionUID = 8563229069192473995L;\n \n     public CompoundRoot() {\n     }\n \n-    public CompoundRoot(List list) {\n+    public CompoundRoot(List<?> list) {\n         super(list);\n     }\n ",
                "changes": 7,
                "blob_url": "https://github.com/apache/struts/blob/1df5a75bfcc3c1093a2516f16258bbe96d5d8dcf/core/src/main/java/com/opensymphony/xwork2/util/CompoundRoot.java"
            }
        ],
        "repo": "struts",
        "message": "fix for WW-4573\n\nNPE/ concurrent modification exception\n\nusing a CopyOnWriteArrayList. This is to keep Memory consistency on the\nValueStack.",
        "commit": "https://github.com/apache/struts/commit/1df5a75bfcc3c1093a2516f16258bbe96d5d8dcf"
    },
    {
        "parent": "https://github.com/apache/struts/commit/29de8687ddea5bc777e9401ffd4887f93333dc6b",
        "bug_id": "struts_21",
        "file": [
            {
                "additions": 1,
                "sha": "8317feb1a7aab7651f51df8bb60628d638bccab0",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/2bea99e96b448585caa0080ac1dc5faa1db85826/xwork-core/src/main/java/com/opensymphony/xwork2/interceptor/ParametersInterceptor.java",
                "deletions": 1,
                "filename": "xwork-core/src/main/java/com/opensymphony/xwork2/interceptor/ParametersInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/main/java/com/opensymphony/xwork2/interceptor/ParametersInterceptor.java?ref=2bea99e96b448585caa0080ac1dc5faa1db85826",
                "patch": "@@ -362,7 +362,7 @@ protected boolean isAcceptableValue(Object value) {\n         }\n         boolean result = true;\n         for (Object obj : values) {\n-            if (isExcluded(obj.toString())) {\n+            if (isExcluded(String.valueOf(obj))) {\n                 result = false;\n             }\n         }",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/2bea99e96b448585caa0080ac1dc5faa1db85826/xwork-core/src/main/java/com/opensymphony/xwork2/interceptor/ParametersInterceptor.java"
            }
        ],
        "repo": "struts",
        "message": "WW-4436 Fixes NPE and uses String.valueOf() instead of .toString()",
        "commit": "https://github.com/apache/struts/commit/2bea99e96b448585caa0080ac1dc5faa1db85826"
    },
    {
        "parent": "https://github.com/apache/struts/commit/bae28278ae8299ff6fef552cc281e1e2707b0995",
        "bug_id": "struts_22",
        "file": [
            {
                "additions": 2,
                "sha": "460c13830913135707b999318b95c43283448939",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/81f847022eaa6ca290a18a02de6cee18dbd35be4/core/src/main/java/org/apache/struts2/views/util/DefaultUrlHelper.java",
                "deletions": 2,
                "filename": "core/src/main/java/org/apache/struts2/views/util/DefaultUrlHelper.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/views/util/DefaultUrlHelper.java?ref=81f847022eaa6ca290a18a02de6cee18dbd35be4",
                "patch": "@@ -214,7 +214,7 @@ public void buildParametersString(Map<String, Object> params, StringBuilder link\n                 if (value instanceof Iterable) {\n                     for (Iterator iterator = ((Iterable) value).iterator(); iterator.hasNext();) {\n                         Object paramValue = iterator.next();\n-                        link.append(buildParameterSubstring(name, paramValue.toString()));\n+                        link.append(buildParameterSubstring(name, paramValue != null ? paramValue.toString() : StringUtils.EMPTY));\n \n                         if (iterator.hasNext()) {\n                             link.append(paramSeparator);\n@@ -224,7 +224,7 @@ public void buildParametersString(Map<String, Object> params, StringBuilder link\n                     Object[] array = (Object[]) value;\n                     for (int i = 0; i < array.length; i++) {\n                         Object paramValue = array[i];\n-                        link.append(buildParameterSubstring(name, paramValue.toString()));\n+                        link.append(buildParameterSubstring(name, paramValue != null ? paramValue.toString() : StringUtils.EMPTY));\n \n                         if (i < array.length - 1) {\n                             link.append(paramSeparator);",
                "changes": 4,
                "blob_url": "https://github.com/apache/struts/blob/81f847022eaa6ca290a18a02de6cee18dbd35be4/core/src/main/java/org/apache/struts2/views/util/DefaultUrlHelper.java"
            }
        ],
        "repo": "struts",
        "message": "WW-4182 Adds additional check to avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@1533346 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/81f847022eaa6ca290a18a02de6cee18dbd35be4"
    },
    {
        "parent": "https://github.com/apache/struts/commit/3ae920e5a3edbb8943ab6914336ad38c726dc95a",
        "bug_id": "struts_23",
        "file": [
            {
                "additions": 1,
                "sha": "fb24eb10a377b46cb71fa396608cdd16b047d8f2",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/3bf95951bc2023be25c14c449a9ea3c04565a2e9/xwork-core/src/main/java/com/opensymphony/xwork2/util/TextParseUtil.java",
                "deletions": 3,
                "filename": "xwork-core/src/main/java/com/opensymphony/xwork2/util/TextParseUtil.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/main/java/com/opensymphony/xwork2/util/TextParseUtil.java?ref=3bf95951bc2023be25c14c449a9ea3c04565a2e9",
                "patch": "@@ -153,18 +153,16 @@ public static Object translateVariables(char open, String expression, ValueStack\n      */\n     public static Object translateVariables(char[] openChars, String expression, final ValueStack stack, final Class asType, final ParsedValueEvaluator evaluator, int maxLoopCount) {\n \n-\n         ParsedValueEvaluator ognlEval = new ParsedValueEvaluator() {\n             public Object evaluate(String parsedValue) {\n                 Object o = stack.findValue(parsedValue, asType);\n-                if (evaluator != null) {\n+                if (evaluator != null && o != null) {\n                     o = evaluator.evaluate(o.toString());\n                 }\n                 return o;\n             }\n         };\n \n-\n         TextParser parser = ((Container)stack.getContext().get(ActionContext.CONTAINER)).getInstance(TextParser.class);\n \n         XWorkConverter conv = ((Container)stack.getContext().get(ActionContext.CONTAINER)).getInstance(XWorkConverter.class);",
                "changes": 4,
                "blob_url": "https://github.com/apache/struts/blob/3bf95951bc2023be25c14c449a9ea3c04565a2e9/xwork-core/src/main/java/com/opensymphony/xwork2/util/TextParseUtil.java"
            },
            {
                "additions": 18,
                "sha": "e18fb0f77a2f83b06cc010c51c4d7acc63c6c629",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/3bf95951bc2023be25c14c449a9ea3c04565a2e9/xwork-core/src/test/java/com/opensymphony/xwork2/util/TextParseUtilTest.java",
                "deletions": 0,
                "filename": "xwork-core/src/test/java/com/opensymphony/xwork2/util/TextParseUtilTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/test/java/com/opensymphony/xwork2/util/TextParseUtilTest.java?ref=3bf95951bc2023be25c14c449a9ea3c04565a2e9",
                "patch": "@@ -138,4 +138,22 @@ public void testTranslateVariablesRecursive() {\n         assertEquals(\"foo: 2\", s);\n     }\n \n+    public void testTranslateVariablesWithNull() {\n+        // given\n+        ValueStack stack = ActionContext.getContext().getValueStack();\n+        stack.push(new HashMap<String, Object>() {{ put(\"foo\", null); }});\n+\n+        TextParseUtil.ParsedValueEvaluator evaluator = new TextParseUtil.ParsedValueEvaluator() {\n+            public Object evaluate(String parsedValue) {\n+                return parsedValue;\n+            }\n+        };\n+\n+        // when\n+        Object s = TextParseUtil.translateVariables('$', \"foo: ${foo}\", stack, String.class, evaluator, 2);\n+\n+        // then\n+        assertEquals(\"foo: \", s);\n+    }\n+\n }",
                "changes": 18,
                "blob_url": "https://github.com/apache/struts/blob/3bf95951bc2023be25c14c449a9ea3c04565a2e9/xwork-core/src/test/java/com/opensymphony/xwork2/util/TextParseUtilTest.java"
            }
        ],
        "repo": "struts",
        "message": "WW-4025 Solves problem with NPE in TextParseUtil\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@1460985 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/3bf95951bc2023be25c14c449a9ea3c04565a2e9"
    },
    {
        "parent": "https://github.com/apache/struts/commit/b56b9b9ff41ae27685e079a202886c737d7c10b5",
        "bug_id": "struts_24",
        "file": [
            {
                "additions": 5,
                "sha": "b0e4f038643d145239042cea0202a3e65ce6b0e4",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/e091eb41f3da740a016bef74f65c3ed836e6b1ee/plugins/jsf/src/main/java/org/apache/struts2/jsf/StrutsNavigationHandler.java",
                "deletions": 6,
                "filename": "plugins/jsf/src/main/java/org/apache/struts2/jsf/StrutsNavigationHandler.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/jsf/src/main/java/org/apache/struts2/jsf/StrutsNavigationHandler.java?ref=e091eb41f3da740a016bef74f65c3ed836e6b1ee",
                "patch": "@@ -21,15 +21,14 @@\n \n package org.apache.struts2.jsf;\n \n-import java.util.Map;\n-\n-import javax.faces.application.NavigationHandler;\n-import javax.faces.context.FacesContext;\n-\n import com.opensymphony.xwork2.ActionContext;\n import com.opensymphony.xwork2.config.entities.ActionConfig;\n import com.opensymphony.xwork2.config.entities.ResultConfig;\n \n+import javax.faces.application.NavigationHandler;\n+import javax.faces.context.FacesContext;\n+import java.util.Map;\n+\n /**\n  * Overrides the JFS navigation by delegating the result to handling by the core\n  * result code lookup and execution.  If a result cannot be found, the previous\n@@ -60,7 +59,7 @@ public StrutsNavigationHandler(NavigationHandler handler) {\n     public void handleNavigation(FacesContext facesContext, String fromAction, String outcome) {\n         ActionContext ctx = ActionContext.getContext();\n         if (outcome != null) {\n-            if (ctx == null && ctx.getActionInvocation() == null) {\n+            if (ctx == null || ctx.getActionInvocation() == null) {\n                 delegateToParentNavigation(facesContext, fromAction, outcome);\n             } else {\n                 ActionConfig config = ctx.getActionInvocation().getProxy().getConfig();",
                "changes": 11,
                "blob_url": "https://github.com/apache/struts/blob/e091eb41f3da740a016bef74f65c3ed836e6b1ee/plugins/jsf/src/main/java/org/apache/struts2/jsf/StrutsNavigationHandler.java"
            }
        ],
        "repo": "struts",
        "message": "WW-3406 Solves NPE problem\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@1458537 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/e091eb41f3da740a016bef74f65c3ed836e6b1ee"
    },
    {
        "parent": "https://github.com/apache/struts/commit/2db92f70406af8f0c15d3d7f5ff8822c10b72715",
        "bug_id": "struts_25",
        "file": [
            {
                "additions": 1,
                "sha": "d54bd2f85aaee366d1f9db994e792ac68d99d9a0",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/09302facdaea6eedd8835e961741732b860d26e1/xwork-core/src/main/java/com/opensymphony/xwork2/conversion/annotations/TypeConversion.java",
                "deletions": 1,
                "filename": "xwork-core/src/main/java/com/opensymphony/xwork2/conversion/annotations/TypeConversion.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/main/java/com/opensymphony/xwork2/conversion/annotations/TypeConversion.java?ref=09302facdaea6eedd8835e961741732b860d26e1",
                "patch": "@@ -155,7 +155,7 @@\n \n     /**\n      * The ConversionRule can be a PROPERTY, KEY, KEY_PROPERTY, ELEMENT, COLLECTION (deprecated) or a MAP.\n-     * Note: Collection and Map vonversion rules can be determined via com.opensymphony.xwork2.util.DefaultObjectTypeDeterminer.\n+     * Note: Collection and Map conversion rules can be determined via com.opensymphony.xwork2.util.DefaultObjectTypeDeterminer.\n      *\n      * @see com.opensymphony.xwork2.conversion.impl.DefaultObjectTypeDeterminer\n      */",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/09302facdaea6eedd8835e961741732b860d26e1/xwork-core/src/main/java/com/opensymphony/xwork2/conversion/annotations/TypeConversion.java"
            },
            {
                "additions": 4,
                "sha": "1fad29ed8d94e14405a4e3c32008c8e1fae83ed3",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/09302facdaea6eedd8835e961741732b860d26e1/xwork-core/src/main/java/com/opensymphony/xwork2/conversion/impl/XWorkConverter.java",
                "deletions": 1,
                "filename": "xwork-core/src/main/java/com/opensymphony/xwork2/conversion/impl/XWorkConverter.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/main/java/com/opensymphony/xwork2/conversion/impl/XWorkConverter.java?ref=09302facdaea6eedd8835e961741732b860d26e1",
                "patch": "@@ -440,6 +440,9 @@ protected Object getConverter(Class clazz, String property) {\n                     }\n                     return converter;\n                 } catch (Throwable t) {\n+                    if (LOG.isDebugEnabled()) {\n+                        LOG.debug(\"Got exception trying to resolve convert for class [#0] and property [#1]\", t, clazz.getName(), property);\n+                    }\n                     noMapping.add(clazz);\n                 }\n             }\n@@ -753,7 +756,7 @@ else if (tc.rule().toString().equals(ConversionRule.KEY.toString())) {\n \n         if (reloadingConfigs) {\n             URL fileUrl = ClassLoaderUtil.getResource(buildConverterFilename(clazz), clazz);\n-            if (fileManager.fileNeedsReloading(fileUrl.toString())) {\n+            if (fileManager.fileNeedsReloading(fileUrl)) {\n                 mapping = buildConverterMapping(clazz);\n             }\n         }",
                "changes": 5,
                "blob_url": "https://github.com/apache/struts/blob/09302facdaea6eedd8835e961741732b860d26e1/xwork-core/src/main/java/com/opensymphony/xwork2/conversion/impl/XWorkConverter.java"
            }
        ],
        "repo": "struts",
        "message": "WW-3837 solves problem with NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@1433600 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/09302facdaea6eedd8835e961741732b860d26e1"
    },
    {
        "parent": "https://github.com/apache/struts/commit/0d93ceedf3d94ff855248d66ee394cbb53a280b6",
        "bug_id": "struts_26",
        "file": [
            {
                "additions": 10,
                "sha": "e2acee821f903753876a1dd17bd148010a68fabf",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/b86d3d13fe7090b6c56f7ca45976e46079de4671/core/src/main/java/org/apache/struts2/components/IteratorComponent.java",
                "deletions": 11,
                "filename": "core/src/main/java/org/apache/struts2/components/IteratorComponent.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/components/IteratorComponent.java?ref=b86d3d13fe7090b6c56f7ca45976e46079de4671",
                "patch": "@@ -21,19 +21,18 @@\n \n package org.apache.struts2.components;\n \n-import java.io.Writer;\n-import java.util.Iterator;\n-import java.util.List;\n-import java.util.Arrays;\n-\n+import com.opensymphony.xwork2.util.ValueStack;\n+import com.opensymphony.xwork2.util.logging.Logger;\n+import com.opensymphony.xwork2.util.logging.LoggerFactory;\n+import org.apache.struts2.util.MakeIterator;\n import org.apache.struts2.views.annotations.StrutsTag;\n import org.apache.struts2.views.annotations.StrutsTagAttribute;\n-import org.apache.struts2.util.MakeIterator;\n import org.apache.struts2.views.jsp.IteratorStatus;\n \n-import com.opensymphony.xwork2.util.ValueStack;\n-import com.opensymphony.xwork2.util.logging.Logger;\n-import com.opensymphony.xwork2.util.logging.LoggerFactory;\n+import java.io.Writer;\n+import java.util.Arrays;\n+import java.util.Iterator;\n+import java.util.List;\n \n /**\n  * <!-- START SNIPPET: javadoc -->\n@@ -357,7 +356,7 @@ public boolean end(Writer writer, String body) {\n         }\n     }\n \n-    class CounterIterator implements Iterator<Object> {\n+    static class CounterIterator implements Iterator<Object> {\n         private int step;\n         private int end;\n         private int currentIndex;\n@@ -380,7 +379,7 @@ public Object next() {\n             if (hasNext()) {\n                 int nextIndex = peekNextIndex();\n                 currentIndex += step;\n-                return value != null ? values.get(nextIndex) : nextIndex;\n+                return values != null ? values.get(nextIndex) : nextIndex;\n             } else {\n                 throw new IndexOutOfBoundsException(\"Index \" + ( currentIndex + step) + \" must be less than or equal to \" + end);\n             }",
                "changes": 21,
                "blob_url": "https://github.com/apache/struts/blob/b86d3d13fe7090b6c56f7ca45976e46079de4671/core/src/main/java/org/apache/struts2/components/IteratorComponent.java"
            },
            {
                "additions": 91,
                "sha": "02ecb1ad138624ac73b8abb456cdb8f5ce049e6d",
                "status": "added",
                "raw_url": "https://github.com/apache/struts/raw/b86d3d13fe7090b6c56f7ca45976e46079de4671/core/src/test/java/org/apache/struts2/components/IteratorComponentTest.java",
                "deletions": 0,
                "filename": "core/src/test/java/org/apache/struts2/components/IteratorComponentTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/org/apache/struts2/components/IteratorComponentTest.java?ref=b86d3d13fe7090b6c56f7ca45976e46079de4671",
                "patch": "@@ -0,0 +1,91 @@\n+package org.apache.struts2.components;\n+\n+import com.opensymphony.xwork2.ActionContext;\n+import com.opensymphony.xwork2.util.ValueStack;\n+import org.apache.struts2.StrutsTestCase;\n+\n+import java.io.StringWriter;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+public class IteratorComponentTest extends StrutsTestCase {\n+\n+    public void testIterator() throws Exception {\n+        // given\n+        final ValueStack stack = ActionContext.getContext().getValueStack();\n+        stack.push(new FooAction());\n+\n+        StringWriter out = new StringWriter();\n+\n+        IteratorComponent ic = new IteratorComponent(stack);\n+        ic.setValue(\"items\");\n+        ic.setVar(\"val\");\n+\n+        Property prop = new Property(stack);\n+\n+        ic.getComponentStack().push(prop);\n+        ic.getComponentStack().push(prop);\n+        ic.getComponentStack().push(prop);\n+        ic.getComponentStack().push(prop);\n+\n+        String body = \" \";\n+\n+        // when\n+        assertTrue(ic.start(out));\n+\n+\n+        for (int i = 0; i < 4; i++) {\n+            prop.start(out);\n+            prop.end(out, body);\n+            ic.end(out, null);\n+        }\n+\n+        // then\n+        assertEquals(\"item1 item2 item3 item4 \", out.getBuffer().toString());\n+    }\n+\n+    public void testIteratorWithBegin() throws Exception {\n+        // given\n+        final ValueStack stack = ActionContext.getContext().getValueStack();\n+        stack.push(new FooAction());\n+\n+        StringWriter out = new StringWriter();\n+\n+        IteratorComponent ic = new IteratorComponent(stack);\n+        ic.setValue(\"items\");\n+        ic.setVar(\"val\");\n+        ic.setBegin(\"1\");\n+        Property prop = new Property(stack);\n+\n+        ic.getComponentStack().push(prop);\n+        ic.getComponentStack().push(prop);\n+        ic.getComponentStack().push(prop);\n+\n+        String body = \" \";\n+\n+        // when\n+        assertTrue(ic.start(out));\n+\n+        for (int i = 0; i < 3; i++) {\n+            prop.start(out);\n+            prop.end(out, body);\n+            ic.end(out, null);\n+        }\n+\n+        // then\n+        assertEquals(\"item2 item3 item4 \", out.getBuffer().toString());\n+    }\n+\n+    static class FooAction {\n+\n+        private List items;\n+\n+        public FooAction() {\n+            items = Arrays.asList(\"item1\", \"item2\", \"item3\", \"item4\");\n+        }\n+\n+        public List getItems() {\n+            return items;\n+        }\n+    }\n+}",
                "changes": 91,
                "blob_url": "https://github.com/apache/struts/blob/b86d3d13fe7090b6c56f7ca45976e46079de4671/core/src/test/java/org/apache/struts2/components/IteratorComponentTest.java"
            }
        ],
        "repo": "struts",
        "message": "WW-3942 solves NPE in iterator tag\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@1421210 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/b86d3d13fe7090b6c56f7ca45976e46079de4671"
    },
    {
        "parent": "https://github.com/apache/struts/commit/bd48ea0521cc14add18c16a7842d76692939b216",
        "bug_id": "struts_27",
        "file": [
            {
                "additions": 2,
                "sha": "d4972d491af944f40ed32527e935a53c5242f0d0",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/491af32e40beccf899d8c044234a4e681b28af7b/core/src/main/java/org/apache/struts2/views/util/UrlHelper.java",
                "deletions": 1,
                "filename": "core/src/main/java/org/apache/struts2/views/util/UrlHelper.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/views/util/UrlHelper.java?ref=491af32e40beccf899d8c044234a4e681b28af7b",
                "patch": "@@ -36,6 +36,7 @@\n \n import org.apache.struts2.ServletActionContext;\n import org.apache.struts2.StrutsConstants;\n+import org.apache.commons.lang.xwork.StringUtils;\n \n import com.opensymphony.xwork2.ActionContext;\n import com.opensymphony.xwork2.inject.Container;\n@@ -234,7 +235,7 @@ public static void buildParametersString(Map params, StringBuilder link, String\n                             link.append(paramSeparator);\n                     }\n                 } else {\n-                    link.append(buildParameterSubstring(name, value.toString()));\n+                    link.append(buildParameterSubstring(name, value != null ? value.toString() : StringUtils.EMPTY));\n                 }\n \n                 if (iter.hasNext())",
                "changes": 3,
                "blob_url": "https://github.com/apache/struts/blob/491af32e40beccf899d8c044234a4e681b28af7b/core/src/main/java/org/apache/struts2/views/util/UrlHelper.java"
            }
        ],
        "repo": "struts",
        "message": "prevent NPE when value is null\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@819639 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/491af32e40beccf899d8c044234a4e681b28af7b"
    },
    {
        "parent": "https://github.com/apache/struts/commit/5448b555426e8b9a2f91197f30aa96482a2cbecf",
        "bug_id": "struts_28",
        "file": [
            {
                "additions": 88,
                "sha": "76e6242f1b3db944ad91ccecab48cc387abf5d67",
                "status": "added",
                "raw_url": "https://github.com/apache/struts/raw/22949c709dd0d0cea007e95aeb7771893a99d5d8/plugins/convention/src/main/java/org/apache/struts2/convention/classloader/JarResourceStore.java",
                "deletions": 0,
                "filename": "plugins/convention/src/main/java/org/apache/struts2/convention/classloader/JarResourceStore.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/convention/src/main/java/org/apache/struts2/convention/classloader/JarResourceStore.java?ref=22949c709dd0d0cea007e95aeb7771893a99d5d8",
                "patch": "@@ -0,0 +1,88 @@\n+/*\r\n+ * $Id: FileResourceStore.java 763792 2009-04-09 20:30:06Z musachy $\r\n+ *\r\n+ * Licensed to the Apache Software Foundation (ASF) under one\r\n+ * or more contributor license agreements.  See the NOTICE file\r\n+ * distributed with this work for additional information\r\n+ * regarding copyright ownership.  The ASF licenses this file\r\n+ * to you under the Apache License, Version 2.0 (the\r\n+ * \"License\"); you may not use this file except in compliance\r\n+ * with the License.  You may obtain a copy of the License at\r\n+ *\r\n+ *  http://www.apache.org/licenses/LICENSE-2.0\r\n+ *\r\n+ * Unless required by applicable law or agreed to in writing,\r\n+ * software distributed under the License is distributed on an\r\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+ * KIND, either express or implied.  See the License for the\r\n+ * specific language governing permissions and limitations\r\n+ * under the License.\r\n+ */\r\n+\r\n+package org.apache.struts2.convention.classloader;\r\n+\r\n+import com.opensymphony.xwork2.util.logging.Logger;\r\n+import com.opensymphony.xwork2.util.logging.LoggerFactory;\r\n+\r\n+import java.io.*;\r\n+import java.util.zip.ZipEntry;\r\n+import java.util.zip.ZipFile;\r\n+\r\n+/**\r\n+ * Read resources from a jar file\r\n+ */\r\n+public class JarResourceStore implements ResourceStore {\r\n+    private static final Logger LOG = LoggerFactory.getLogger(JarResourceStore.class);\r\n+\r\n+    private final File file;\r\n+\r\n+    public JarResourceStore(File file) {\r\n+        this.file = file;\r\n+    }\r\n+\r\n+    public void write(String pResourceName, byte[] pResourceData) {\r\n+    }\r\n+\r\n+    public byte[] read(String pResourceName) {\r\n+        InputStream in = null;\r\n+        try {\r\n+            ZipFile jarFile = new ZipFile(file);\r\n+            ZipEntry entry = jarFile.getEntry(pResourceName);\r\n+\r\n+            //read into byte array\r\n+            ByteArrayOutputStream out = new ByteArrayOutputStream();\r\n+            in = jarFile.getInputStream(entry);\r\n+            copy(in, out);\r\n+\r\n+            return out.toByteArray();\r\n+        } catch (Exception e) {\r\n+            if (LOG.isDebugEnabled())\r\n+                LOG.debug(\"Unable to read file [#0] from [#1]\", e, pResourceName, file.getName());\r\n+            return null;\r\n+        } finally {\r\n+            closeQuietly(in);\r\n+        }\r\n+    }\r\n+\r\n+    public static long copy(InputStream input, OutputStream output)\r\n+            throws IOException {\r\n+        byte[] buffer = new byte[1024 * 4];\r\n+        long count = 0;\r\n+        int n = 0;\r\n+        while (-1 != (n = input.read(buffer))) {\r\n+            output.write(buffer, 0, n);\r\n+            count += n;\r\n+        }\r\n+        return count;\r\n+    }\r\n+\r\n+    private void closeQuietly(InputStream is) {\r\n+        try {\r\n+            if (is != null)\r\n+                is.close();\r\n+        } catch (IOException e) {\r\n+            if (LOG.isErrorEnabled())\r\n+                LOG.error(\"Unable to close input stream\", e);\r\n+        }\r\n+    }\r\n+}\r",
                "changes": 88,
                "blob_url": "https://github.com/apache/struts/blob/22949c709dd0d0cea007e95aeb7771893a99d5d8/plugins/convention/src/main/java/org/apache/struts2/convention/classloader/JarResourceStore.java"
            },
            {
                "additions": 5,
                "sha": "716dbe15817dfb1a10d269fbaee668a0592373d5",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/22949c709dd0d0cea007e95aeb7771893a99d5d8/plugins/convention/src/main/java/org/apache/struts2/convention/classloader/ReloadingClassLoader.java",
                "deletions": 2,
                "filename": "plugins/convention/src/main/java/org/apache/struts2/convention/classloader/ReloadingClassLoader.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/convention/src/main/java/org/apache/struts2/convention/classloader/ReloadingClassLoader.java?ref=22949c709dd0d0cea007e95aeb7771893a99d5d8",
                "patch": "@@ -48,7 +48,7 @@\n     public ReloadingClassLoader(final ClassLoader pParent) {\n         super(pParent);\n         parent = pParent;\n-        URL root = pParent.getResource(\"/\");\n+        URL root = pParent.getResource(\"\");\n         try {\n             if (root != null) {\n                 stores = new ResourceStore[]{new FileResourceStore(new File(root.toURI()))};\n@@ -61,7 +61,10 @@ public ReloadingClassLoader(final ClassLoader pParent) {\n         } catch (RuntimeException e) {\n             // see WW-3121\n             // TODO: Fix this for a reloading mechanism to be marked as stable\n-            LOG.error(\"Exception while trying to build the ResourceStore for URL [#0]\", e, root.toString());\n+            if (root != null)\n+                LOG.error(\"Exception while trying to build the ResourceStore for URL [#0]\", e, root.toString());\n+            else\n+                 LOG.error(\"Exception while trying to get root resource from class loader\", e);\n             LOG.error(\"Consider setting struts.convention.classes.reload=false\");\n             throw e;\n         }",
                "changes": 7,
                "blob_url": "https://github.com/apache/struts/blob/22949c709dd0d0cea007e95aeb7771893a99d5d8/plugins/convention/src/main/java/org/apache/struts2/convention/classloader/ReloadingClassLoader.java"
            }
        ],
        "repo": "struts",
        "message": "Fix NPE from class loader and add a JarResourceStore\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@793255 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/22949c709dd0d0cea007e95aeb7771893a99d5d8"
    },
    {
        "parent": "https://github.com/apache/struts/commit/6deb1d5ea82dd0377453d9ceb64de521443b5751",
        "bug_id": "struts_29",
        "file": [
            {
                "additions": 3,
                "sha": "c103745091ecbfe81daee6186f9e9d27119de655",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/bc6d4bb804dd4b14c9b5562feee4464e3d1b5bff/core/src/main/java/org/apache/struts2/util/TokenHelper.java",
                "deletions": 0,
                "filename": "core/src/main/java/org/apache/struts2/util/TokenHelper.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/util/TokenHelper.java?ref=bc6d4bb804dd4b14c9b5562feee4464e3d1b5bff",
                "patch": "@@ -97,6 +97,9 @@ public static String getToken() {\n      * @return the token String or null, if the token could not be found\n      */\n     public static String getToken(String tokenName) {\n+        if (tokenName == null ) {\n+            return null;\n+        }\n         Map params = ActionContext.getContext().getParameters();\n         String[] tokens = (String[]) params.get(tokenName);\n         String token;",
                "changes": 3,
                "blob_url": "https://github.com/apache/struts/blob/bc6d4bb804dd4b14c9b5562feee4464e3d1b5bff/core/src/main/java/org/apache/struts2/util/TokenHelper.java"
            },
            {
                "additions": 5,
                "sha": "e9c6e75b2bcc46f70c45c625533c3eaa3144bc4d",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/bc6d4bb804dd4b14c9b5562feee4464e3d1b5bff/core/src/test/java/org/apache/struts2/util/TokenHelperTest.java",
                "deletions": 0,
                "filename": "core/src/test/java/org/apache/struts2/util/TokenHelperTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/org/apache/struts2/util/TokenHelperTest.java?ref=bc6d4bb804dd4b14c9b5562feee4464e3d1b5bff",
                "patch": "@@ -58,6 +58,11 @@ public void testValidToken() {\n         assertTrue(TokenHelper.validToken());\n     }\n \n+    public void testGetTokenDoesNotNpe() {\n+        String token = TokenHelper.getToken(null);\n+        assertTrue(token == null);\n+    }\n+\n     protected void setUp() throws Exception {\n         session = new HashMap();\n         Map params = new HashMap();",
                "changes": 5,
                "blob_url": "https://github.com/apache/struts/blob/bc6d4bb804dd4b14c9b5562feee4464e3d1b5bff/core/src/test/java/org/apache/struts2/util/TokenHelperTest.java"
            }
        ],
        "repo": "struts",
        "message": "Fixing NPE in token processing WW-3150, thanks James Peltzer\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@781798 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/bc6d4bb804dd4b14c9b5562feee4464e3d1b5bff"
    },
    {
        "parent": "https://github.com/apache/struts/commit/4f91ad5ecb23bb54acce06439d80141ddfc3ff8d",
        "bug_id": "struts_30",
        "file": [
            {
                "additions": 14,
                "sha": "b509cf1b81cf2c795b2857db2c7e8b7af87758fc",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/6862e2a5c52a7254e6374da07bb2b72a86b51dc1/core/src/main/java/org/apache/struts2/dispatcher/ServletRedirectResult.java",
                "deletions": 12,
                "filename": "core/src/main/java/org/apache/struts2/dispatcher/ServletRedirectResult.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/dispatcher/ServletRedirectResult.java?ref=6862e2a5c52a7254e6374da07bb2b72a86b51dc1",
                "patch": "@@ -167,17 +167,19 @@ protected void doExecute(String finalLocation, ActionInvocation invocation) thro\n             }\n \n             ResultConfig resultConfig = invocation.getProxy().getConfig().getResults().get(invocation.getResultCode());\n-            Map resultConfigParams = resultConfig.getParams();\n-            for (Iterator i = resultConfigParams.entrySet().iterator(); i.hasNext();) {\n-                Map.Entry e = (Map.Entry) i.next();\n-\n-                if (!getProhibitedResultParams().contains(e.getKey())) {\n-                    requestParameters.put(e.getKey().toString(),\n-                            e.getValue() == null ? \"\" :\n-                                    conditionalParse(e.getValue().toString(), invocation));\n-                    String potentialValue = e.getValue() == null ? \"\" : conditionalParse(e.getValue().toString(), invocation);\n-                    if (!supressEmptyParameters || ((potentialValue != null) && (potentialValue.length() > 0))) {\n-                        requestParameters.put(e.getKey().toString(), potentialValue);\n+            if (resultConfig != null ) {\n+                Map resultConfigParams = resultConfig.getParams();\n+                for (Iterator i = resultConfigParams.entrySet().iterator(); i.hasNext();) {\n+                    Map.Entry e = (Map.Entry) i.next();\n+\n+                    if (!getProhibitedResultParams().contains(e.getKey())) {\n+                        requestParameters.put(e.getKey().toString(),\n+                                e.getValue() == null ? \"\" :\n+                                        conditionalParse(e.getValue().toString(), invocation));\n+                        String potentialValue = e.getValue() == null ? \"\" : conditionalParse(e.getValue().toString(), invocation);\n+                        if (!supressEmptyParameters || ((potentialValue != null) && (potentialValue.length() > 0))) {\n+                            requestParameters.put(e.getKey().toString(), potentialValue);\n+                        }\n                     }\n                 }\n             }\n@@ -232,7 +234,7 @@ private static boolean isPathUrl(String url) {\n     /**\n      * Sets the supressEmptyParameters option\n      *\n-     * @param suppress The new value for this option\n+     * @param supressEmptyParameters The new value for this option\n      */\n     public void setSupressEmptyParameters(boolean supressEmptyParameters) {\n         this.supressEmptyParameters = supressEmptyParameters;",
                "changes": 26,
                "blob_url": "https://github.com/apache/struts/blob/6862e2a5c52a7254e6374da07bb2b72a86b51dc1/core/src/main/java/org/apache/struts2/dispatcher/ServletRedirectResult.java"
            }
        ],
        "repo": "struts",
        "message": "WW-3107, fixing NPE, good catch Andrey Vasenin\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@781086 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/6862e2a5c52a7254e6374da07bb2b72a86b51dc1"
    },
    {
        "parent": "https://github.com/apache/struts/commit/7653396d04ed169ad0536a347d83dac85089c49e",
        "bug_id": "struts_31",
        "file": [
            {
                "additions": 0,
                "sha": "c9e17b568fa690f0ef05940b405406e7a9c5e0d0",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/ed3d9e2fff5c655cbe5f7217384f69069bf30f5e/plugins/config-browser/src/main/java/org/apache/struts2/config_browser/ShowConfigAction.java",
                "deletions": 1,
                "filename": "plugins/config-browser/src/main/java/org/apache/struts2/config_browser/ShowConfigAction.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/config-browser/src/main/java/org/apache/struts2/config_browser/ShowConfigAction.java?ref=ed3d9e2fff5c655cbe5f7217384f69069bf30f5e",
                "patch": "@@ -48,7 +48,6 @@\n     private PropertyDescriptor[] properties;\n     private static Logger LOG = LoggerFactory.getLogger(ShowConfigAction.class);\n     \n-    private ConfigurationHelper configHelper;\n     private ObjectFactory objectFactory;\n     private ReflectionProvider reflectionProvider;\n ",
                "changes": 1,
                "blob_url": "https://github.com/apache/struts/blob/ed3d9e2fff5c655cbe5f7217384f69069bf30f5e/plugins/config-browser/src/main/java/org/apache/struts2/config_browser/ShowConfigAction.java"
            }
        ],
        "repo": "struts",
        "message": "Fixing show action NPE\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@632747 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/ed3d9e2fff5c655cbe5f7217384f69069bf30f5e"
    },
    {
        "parent": "https://github.com/apache/struts/commit/e6e4d9a1d665b0312d167d306a5cd41e0b717359",
        "bug_id": "struts_32",
        "file": [
            {
                "additions": 1,
                "sha": "c805d4eeff726b0a2f8eab77fb3bc7f980b391f2",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/3acb5e876237b87566e603a1cf9e0d3465d7fde8/core/src/main/java/org/apache/struts2/views/jsp/TagUtils.java",
                "deletions": 1,
                "filename": "core/src/main/java/org/apache/struts2/views/jsp/TagUtils.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/views/jsp/TagUtils.java?ref=3acb5e876237b87566e603a1cf9e0d3465d7fde8",
                "patch": "@@ -52,7 +52,6 @@ public static ValueStack getStack(PageContext pageContext) {\n         ValueStack stack = (ValueStack) req.getAttribute(ServletActionContext.STRUTS_VALUESTACK_KEY);\n \n         if (stack == null) {\n-            stack = Dispatcher.getInstance().getContainer().getInstance(ValueStackFactory.class).createValueStack();\n \n             HttpServletResponse res = (HttpServletResponse) pageContext.getResponse();\n             Dispatcher du = Dispatcher.getInstance();\n@@ -61,6 +60,7 @@ public static ValueStack getStack(PageContext pageContext) {\n                         \"using Struts tags without the associated filter. Struts tags are only usable when the request \"+\n                         \"has passed through its servlet filter, which initializes the Struts dispatcher needed for this tag.\");\n             }\n+            stack = du.getContainer().getInstance(ValueStackFactory.class).createValueStack();\n             Map extraContext = du.createContextMap(new RequestMap(req),\n                     req.getParameterMap(),\n                     new SessionMap(req),",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/3acb5e876237b87566e603a1cf9e0d3465d7fde8/core/src/main/java/org/apache/struts2/views/jsp/TagUtils.java"
            }
        ],
        "repo": "struts",
        "message": "eliminating NPE, from WW-1969\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@631059 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/3acb5e876237b87566e603a1cf9e0d3465d7fde8"
    },
    {
        "parent": "https://github.com/apache/struts/commit/5912c8b2a8aa0a3e0141c2da8d8d4d7bffddf8f8",
        "bug_id": "struts_33",
        "file": [
            {
                "additions": 1,
                "sha": "25be8cfb2f96299193494b1defa2542c6d42acc4",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/4d2b21c773091be8d593f1aed30b4c4ce0f61725/plugins/config-browser/src/main/java/org/apache/struts2/config_browser/ActionNamesAction.java",
                "deletions": 1,
                "filename": "plugins/config-browser/src/main/java/org/apache/struts2/config_browser/ActionNamesAction.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/config-browser/src/main/java/org/apache/struts2/config_browser/ActionNamesAction.java?ref=4d2b21c773091be8d593f1aed30b4c4ce0f61725",
                "patch": "@@ -44,7 +44,7 @@\n     private Set namespaces;\n     private String extension;\n     \n-    ConfigurationHelper configHelper;\n+    protected ConfigurationHelper configHelper;\n \n     @Inject\n     public void setConfigurationHelper(ConfigurationHelper cfg) {",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/4d2b21c773091be8d593f1aed30b4c4ce0f61725/plugins/config-browser/src/main/java/org/apache/struts2/config_browser/ActionNamesAction.java"
            },
            {
                "additions": 0,
                "sha": "969d552c3c1a094726a27d8e1cda620c9afe192a",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/4d2b21c773091be8d593f1aed30b4c4ce0f61725/plugins/config-browser/src/main/java/org/apache/struts2/config_browser/ShowConfigAction.java",
                "deletions": 5,
                "filename": "plugins/config-browser/src/main/java/org/apache/struts2/config_browser/ShowConfigAction.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/config-browser/src/main/java/org/apache/struts2/config_browser/ShowConfigAction.java?ref=4d2b21c773091be8d593f1aed30b4c4ce0f61725",
                "patch": "@@ -68,11 +68,6 @@ public String getNamespace() {\n         return namespace;\n     }\n     \n-    @Inject\n-    public void setConfigurationHelper(ConfigurationHelper cfg) {\n-        this.configHelper = cfg;\n-    }\n-    \n     @Inject\n     public void setObjectFactory(ObjectFactory fac) {\n         this.objectFactory = fac;",
                "changes": 5,
                "blob_url": "https://github.com/apache/struts/blob/4d2b21c773091be8d593f1aed30b4c4ce0f61725/plugins/config-browser/src/main/java/org/apache/struts2/config_browser/ShowConfigAction.java"
            }
        ],
        "repo": "struts",
        "message": "Fixed NPE for show config action\nWW-2439\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@615215 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/4d2b21c773091be8d593f1aed30b4c4ce0f61725"
    },
    {
        "parent": "https://github.com/apache/struts/commit/537064df23d4cbfd8e77e9660c47b37d4bae48ce",
        "bug_id": "struts_34",
        "file": [
            {
                "additions": 1,
                "sha": "61f3942572655844d80f44833bb711054af45202",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/a2a74f7c9bb25ffcf0376b3bc92cadc95fa4346b/core/src/main/java/org/apache/struts2/views/jsp/iterator/SubsetIteratorTag.java",
                "deletions": 1,
                "filename": "core/src/main/java/org/apache/struts2/views/jsp/iterator/SubsetIteratorTag.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/views/jsp/iterator/SubsetIteratorTag.java?ref=a2a74f7c9bb25ffcf0376b3bc92cadc95fa4346b",
                "patch": "@@ -194,7 +194,7 @@ public int doStartTag() throws JspException {\n \n         // source\n         Object source = null;\n-        if (sourceAttr == null && sourceAttr.length() <= 0) {\n+        if (sourceAttr == null || sourceAttr.length() == 0) {\n             source = findValue(\"top\");\n         } else {\n             source = findValue(sourceAttr);",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/a2a74f7c9bb25ffcf0376b3bc92cadc95fa4346b/core/src/main/java/org/apache/struts2/views/jsp/iterator/SubsetIteratorTag.java"
            }
        ],
        "repo": "struts",
        "message": "Fixed NPE in subset iterator tag\nWW-1932\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@540570 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/a2a74f7c9bb25ffcf0376b3bc92cadc95fa4346b"
    },
    {
        "parent": "https://github.com/apache/struts/commit/afd82ee6230a747e719fb7725b9bfa9569345bc7",
        "bug_id": "struts_35",
        "file": [
            {
                "additions": 6,
                "sha": "13b7031d7b9b9883cdc3eafaba675545b6ff9e31",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/0f2b0fb9cf302929fa9d049a314c2544de6cedbe/apps/showcase/src/main/java/org/apache/struts/action2/showcase/chat/ChatSessionListener.java",
                "deletions": 4,
                "filename": "apps/showcase/src/main/java/org/apache/struts/action2/showcase/chat/ChatSessionListener.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/apps/showcase/src/main/java/org/apache/struts/action2/showcase/chat/ChatSessionListener.java?ref=0f2b0fb9cf302929fa9d049a314c2544de6cedbe",
                "patch": "@@ -38,10 +38,12 @@ public void sessionDestroyed(HttpSessionEvent event) {\n \t\tWebApplicationContext context = WebApplicationContextUtils.getWebApplicationContext(session.getServletContext());\n \t\tif (context != null) {\n \t\t\tUser user = (User) session.getAttribute(ChatInterceptor.CHAT_USER_SESSION_KEY);\n-\t\t\tChatService service = (ChatService) context.getBean(\"chatService\");\n-\t\t\tservice.logout(user.getName());\n-\t\t\t\n-\t\t\t_log.info(\"session expired, logged user [\"+user.getName()+\"] out\");\n+\t\t\tif (user != null) {\n+\t\t\t\tChatService service = (ChatService) context.getBean(\"chatService\");\n+\t\t\t\tservice.logout(user.getName());\n+\t\t\t\t\n+\t\t\t\t_log.info(\"session expired, logged user [\"+user.getName()+\"] out\");\n+\t\t\t}\n \t\t}\n \t}\n ",
                "changes": 10,
                "blob_url": "https://github.com/apache/struts/blob/0f2b0fb9cf302929fa9d049a314c2544de6cedbe/apps/showcase/src/main/java/org/apache/struts/action2/showcase/chat/ChatSessionListener.java"
            }
        ],
        "repo": "struts",
        "message": "WW-1351\n  - checked for possible NPE being thrown\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/action2/trunk@416987 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/0f2b0fb9cf302929fa9d049a314c2544de6cedbe"
    },
    {
        "parent": "https://github.com/apache/struts/commit/f1b699876277c5ce1a31833beb2b1f2ca843a50c",
        "bug_id": "struts_36",
        "file": [
            {
                "additions": 0,
                "sha": "11328c99893da0c8b753ce62e5706ed67e8679ea",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1189735db76a6ecd869c82121a103282f53b7e45/archetypes/struts2-archetype-starter/src/main/resources/archetype-resources/src/main/resources/struts.properties",
                "deletions": 5,
                "filename": "archetypes/struts2-archetype-starter/src/main/resources/archetype-resources/src/main/resources/struts.properties",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/archetypes/struts2-archetype-starter/src/main/resources/archetype-resources/src/main/resources/struts.properties?ref=1189735db76a6ecd869c82121a103282f53b7e45",
                "patch": "@@ -4,11 +4,6 @@\n ###(can be overridden by a struts.properties file in the root of the classpath)\n ###\n \n-### Specifies the Configuration used to configure Struts 2.0\n-### one could extend org.apache.struts2.config.Configuration\n-### to build one's customize way of getting the configurations parameters into Struts 2.0\n-# struts.configuration=org.apache.struts2.config.DefaultConfiguration\n-\n ### This can be used to set your default locale and encoding scheme\n # struts.locale=en_US\n struts.i18n.encoding=UTF-8",
                "changes": 5,
                "blob_url": "https://github.com/apache/struts/blob/1189735db76a6ecd869c82121a103282f53b7e45/archetypes/struts2-archetype-starter/src/main/resources/archetype-resources/src/main/resources/struts.properties"
            },
            {
                "additions": 4,
                "sha": "72552512a39e11cac514d7c5c1ae11f386b06dcc",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1189735db76a6ecd869c82121a103282f53b7e45/core/src/main/java/org/apache/struts2/config/DefaultPropertiesProvider.java",
                "deletions": 8,
                "filename": "core/src/main/java/org/apache/struts2/config/DefaultPropertiesProvider.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/config/DefaultPropertiesProvider.java?ref=1189735db76a6ecd869c82121a103282f53b7e45",
                "patch": "@@ -29,25 +29,21 @@\n /**\n  * Loads the default properties, separate from the usual struts.properties loading\n  */\n-public class DefaultPropertiesProvider extends LegacyPropertiesConfigurationProvider {\n+public class DefaultPropertiesProvider extends PropertiesConfigurationProvider {\n \n     public void destroy() {\n     }\n \n     public void init(Configuration configuration) throws ConfigurationException {\n     }\n \n-    public void register(ContainerBuilder builder, LocatableProperties props)\n-            throws ConfigurationException {\n-        \n-        Settings defaultSettings = null;\n+    public void register(ContainerBuilder builder, LocatableProperties props) throws ConfigurationException {\n         try {\n-            defaultSettings = new PropertiesSettings(\"org/apache/struts2/default\");\n+            PropertiesSettings defaultSettings = new PropertiesSettings(\"org/apache/struts2/default\");\n+            loadSettings(props, defaultSettings);\n         } catch (Exception e) {\n             throw new ConfigurationException(\"Could not find or error in org/apache/struts2/default.properties\", e);\n         }\n-        \n-        loadSettings(props, defaultSettings);\n     }\n \n }",
                "changes": 12,
                "blob_url": "https://github.com/apache/struts/blob/1189735db76a6ecd869c82121a103282f53b7e45/core/src/main/java/org/apache/struts2/config/DefaultPropertiesProvider.java"
            },
            {
                "additions": 22,
                "sha": "2fb5f0e8fe0c46b792cefd817ec9a9939e5a8477",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1189735db76a6ecd869c82121a103282f53b7e45/core/src/main/java/org/apache/struts2/config/DefaultSettings.java",
                "deletions": 38,
                "filename": "core/src/main/java/org/apache/struts2/config/DefaultSettings.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/config/DefaultSettings.java?ref=1189735db76a6ecd869c82121a103282f53b7e45",
                "patch": "@@ -21,15 +21,16 @@\n \n package org.apache.struts2.config;\n \n+import com.opensymphony.xwork2.util.location.Location;\n+import com.opensymphony.xwork2.util.logging.Logger;\n+import com.opensymphony.xwork2.util.logging.LoggerFactory;\n+import org.apache.struts2.StrutsConstants;\n+import org.apache.struts2.security.DefaultSecurityGate;\n+\n import java.util.ArrayList;\n import java.util.Iterator;\n import java.util.StringTokenizer;\n \n-import org.apache.struts2.StrutsConstants;\n-\n-import com.opensymphony.xwork2.util.logging.Logger;\n-import com.opensymphony.xwork2.util.logging.LoggerFactory;\n-\n \n \n /**\n@@ -38,17 +39,14 @@\n  * This class creates and delegates to other settings by using an internal\n  * {@link DelegatingSettings} object.\n  */\n-public class DefaultSettings extends Settings {\n+public class DefaultSettings implements Settings {\n \n-    /**\n-     * The logging instance for this class.\n-     */\n-    protected Logger log = LoggerFactory.getLogger(this.getClass());\n+    private static final Logger LOG = LoggerFactory.getLogger(DefaultSecurityGate.class);\n \n     /**\n      * The Settings object that handles API calls.\n      */\n-    Settings delegate;\n+    private Settings delegate;\n \n     /**\n      * Constructs an instance by loading the standard property files, \n@@ -67,53 +65,39 @@ public DefaultSettings() {\n         try {\n             list.add(new PropertiesSettings(\"struts\"));\n         } catch (Exception e) {\n-            log.warn(\"DefaultSettings: Could not find or error in struts.properties\", e);\n+            LOG.warn(\"DefaultSettings: Could not find or error in struts.properties\", e);\n         }\n \n-        Settings[] settings = new Settings[list.size()];\n-        delegate = new DelegatingSettings(list.toArray(settings));\n+        delegate = new DelegatingSettings(list);\n \n         // struts.custom.properties\n-        try {\n-            StringTokenizer customProperties = new StringTokenizer(delegate.getImpl(StrutsConstants.STRUTS_CUSTOM_PROPERTIES), \",\");\n+        String files = delegate.get(StrutsConstants.STRUTS_CUSTOM_PROPERTIES);\n+        if (files != null) {\n+            StringTokenizer customProperties = new StringTokenizer(files, \",\");\n \n             while (customProperties.hasMoreTokens()) {\n                 String name = customProperties.nextToken();\n-\n                 try {\n                     list.add(new PropertiesSettings(name));\n                 } catch (Exception e) {\n-                    log.error(\"DefaultSettings: Could not find \" + name + \".properties. Skipping.\");\n+                    LOG.error(\"DefaultSettings: Could not find \" + name + \".properties. Skipping.\");\n                 }\n             }\n \n-            settings = new Settings[list.size()];\n-            delegate = new DelegatingSettings(list.toArray(settings));\n-        } catch (IllegalArgumentException e) {\n-            // Assume it's OK, since IllegalArgumentException is thrown  \n-            // when Settings is unable to find a certain setting,\n-            // like the struts.custom.properties, which is commented out\n+            delegate = new DelegatingSettings(list);\n         }\n-\n     }\n \n-    // See superclass for Javadoc\n-    public void setImpl(String name, String value) throws IllegalArgumentException, UnsupportedOperationException {\n-        delegate.setImpl(name, value);\n+    public Location getLocation(String name) {\n+        return delegate.getLocation(name);\n     }\n \n-    // See superclass for Javadoc\n-    public String getImpl(String aName) throws IllegalArgumentException {\n-        return delegate.getImpl(aName);\n+    public String get(String aName) throws IllegalArgumentException {\n+        return delegate.get(aName);\n     }\n \n-    // See superclass for Javadoc\n-    public boolean isSetImpl(String aName) {\n-        return delegate.isSetImpl(aName);\n+    public Iterator list() {\n+        return delegate.list();\n     }\n \n-    // See superclass for Javadoc\n-    public Iterator listImpl() {\n-        return delegate.listImpl();\n-    }\n }",
                "changes": 60,
                "blob_url": "https://github.com/apache/struts/blob/1189735db76a6ecd869c82121a103282f53b7e45/core/src/main/java/org/apache/struts2/config/DefaultSettings.java"
            },
            {
                "additions": 23,
                "sha": "132c24e63f8b4e58c9a6e597d8533bbf7c3e7961",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1189735db76a6ecd869c82121a103282f53b7e45/core/src/main/java/org/apache/struts2/config/DelegatingSettings.java",
                "deletions": 48,
                "filename": "core/src/main/java/org/apache/struts2/config/DelegatingSettings.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/config/DelegatingSettings.java?ref=1189735db76a6ecd869c82121a103282f53b7e45",
                "patch": "@@ -21,8 +21,11 @@\n \n package org.apache.struts2.config;\n \n+import com.opensymphony.xwork2.util.location.Location;\n+\n import java.util.HashSet;\n import java.util.Iterator;\n+import java.util.List;\n import java.util.Set;\n \n \n@@ -36,80 +39,42 @@\n  * withholding any exception until all delegates have been called.\n  *\n  */\n-class DelegatingSettings extends Settings {\n+class DelegatingSettings implements Settings {\n \n     /**\n      * The Settings objects.\n      */\n-    Settings[] delegates;\n+    List<Settings> delegates;\n \n     /**\n      * Creates a new DelegatingSettings object utilizing the list of {@link Settings} objects.\n      *\n      * @param delegates The Settings objects to use as delegates\n      */\n-    public DelegatingSettings(Settings[] delegates) {\n+    public DelegatingSettings(List<Settings> delegates) {\n         this.delegates = delegates;\n     }\n \n-    // See superclass for Javadoc\n-    public void setImpl(String name, String value) throws IllegalArgumentException, UnsupportedOperationException {\n-        IllegalArgumentException e = null;\n-\n+    public String get(String name) throws IllegalArgumentException {\n         for (Settings delegate : delegates) {\n-            try {\n-                delegate.getImpl(name); // Throws exception if not found\n-                delegate.setImpl(name, value); // Found it\n-                return; // Done\n-            } catch (IllegalArgumentException ex) {\n-                e = ex;\n-\n-                // Try next delegate\n+            String value = delegate.get(name);\n+            if (value != null) {\n+                return value;\n             }\n         }\n-\n-        throw e;\n+        return null;\n     }\n \n-    // See superclass for Javadoc\n-    public String getImpl(String name) throws IllegalArgumentException {\n-\n-        IllegalArgumentException e = null;\n \n-        for (Settings delegate : delegates) {\n-            try {\n-                return delegate.getImpl(name);  // Throws exception if not found\n-            } catch (IllegalArgumentException ex) {\n-                e = ex;\n-\n-                // Try next delegate\n-            }\n-        }\n-\n-        throw e;\n-    }\n-\n-    // See superclass for Javadoc\n-    public boolean isSetImpl(String aName) {\n-        for (Settings delegate : delegates) {\n-            if (delegate.isSetImpl(aName)) {\n-                return true;\n-            }\n-        }\n-\n-        return false;\n-    }\n-\n-    // See superclass for Javadoc\n-    public Iterator listImpl() {\n+    public Iterator list() {\n         boolean workedAtAll = false;\n \n         Set<Object> settingList = new HashSet<Object>();\n         UnsupportedOperationException e = null;\n \n         for (Settings delegate : delegates) {\n             try {\n-                Iterator list = delegate.listImpl();\n+                Iterator list = delegate.list();\n \n                 while (list.hasNext()) {\n                     settingList.add(list.next());\n@@ -129,4 +94,14 @@ public Iterator listImpl() {\n             return settingList.iterator();\n         }\n     }\n+\n+    public Location getLocation(String name) {\n+        for (Settings delegate : delegates) {\n+            Location loc = delegate.getLocation(name);\n+            if (loc != null) {\n+                return loc;\n+            }\n+        }\n+        return Location.UNKNOWN;\n+    }\n }",
                "changes": 71,
                "blob_url": "https://github.com/apache/struts/blob/1189735db76a6ecd869c82121a103282f53b7e45/core/src/main/java/org/apache/struts2/config/DelegatingSettings.java"
            },
            {
                "additions": 0,
                "sha": "f82e36fe3fe43e4ddbf399ca4f1f6c8929391777",
                "status": "removed",
                "raw_url": "https://github.com/apache/struts/raw/f1b699876277c5ce1a31833beb2b1f2ca843a50c/core/src/main/java/org/apache/struts2/config/LegacyPropertiesConfigurationProvider.java",
                "deletions": 113,
                "filename": "core/src/main/java/org/apache/struts2/config/LegacyPropertiesConfigurationProvider.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/config/LegacyPropertiesConfigurationProvider.java?ref=f1b699876277c5ce1a31833beb2b1f2ca843a50c",
                "patch": "@@ -1,113 +0,0 @@\n-/*\n- * $Id$\n- *\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *  http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- */\n-\n-package org.apache.struts2.config;\n-\n-import com.opensymphony.xwork2.config.Configuration;\n-import com.opensymphony.xwork2.config.ConfigurationException;\n-import com.opensymphony.xwork2.config.ConfigurationProvider;\n-import com.opensymphony.xwork2.inject.ContainerBuilder;\n-import com.opensymphony.xwork2.inject.Context;\n-import com.opensymphony.xwork2.inject.Factory;\n-import com.opensymphony.xwork2.util.location.LocatableProperties;\n-import com.opensymphony.xwork2.util.logging.Logger;\n-import com.opensymphony.xwork2.util.logging.LoggerFactory;\n-import org.apache.struts2.StrutsConstants;\n-\n-import java.util.Iterator;\n-import java.util.Locale;\n-import java.util.StringTokenizer;\n-\n-public class LegacyPropertiesConfigurationProvider implements ConfigurationProvider {\n-\n-    /**\n-     * The Logging instance for this class.\n-     */\n-    private static final Logger LOG = LoggerFactory.getLogger(LegacyPropertiesConfigurationProvider.class);\n-\n-    public void destroy() {\n-        Settings.reset();\n-    }\n-\n-    public void init(Configuration configuration)\n-        throws ConfigurationException {\n-        Settings.reset();\n-    }\n-    \n-    public void loadPackages()\n-            throws ConfigurationException {\n-    }\n-\n-    public boolean needsReload() {\n-        return false;\n-    }\n-\n-    public void register(ContainerBuilder builder, LocatableProperties props)\n-            throws ConfigurationException {\n-        \n-        final Settings settings = Settings.getInstance();\n-        \n-        loadSettings(props, settings);\n-        \n-        // Set default locale by lazily resolving the locale property as needed into a Locale object\n-        builder.factory(Locale.class,  new Factory<Locale>() {\n-            private Locale locale;\n-\n-            public synchronized Locale create(Context context) throws Exception {\n-                if (locale == null) {\n-                    String loc = context.getContainer().getInstance(String.class, StrutsConstants.STRUTS_LOCALE);\n-                    if (loc != null) {\n-                        StringTokenizer localeTokens = new StringTokenizer(loc, \"_\");\n-                        String lang = null;\n-                        String country = null;\n-\n-                        if (localeTokens.hasMoreTokens()) {\n-                            lang = localeTokens.nextToken();\n-                        }\n-\n-                        if (localeTokens.hasMoreTokens()) {\n-                            country = localeTokens.nextToken();\n-                        }\n-                        locale = new Locale(lang, country);\n-                    } else {\n-                        if (LOG.isInfoEnabled()) {\n-                            LOG.info(\"No locale define, substituting the default VM locale\");\n-                        }\n-                        locale = Locale.getDefault();\n-                    }\n-                }\n-                return locale;\n-            }\n-        });\n-    }\n-\n-    /**\n-     * @param props\n-     * @param settings\n-     */\n-    protected void loadSettings(LocatableProperties props, final Settings settings) {\n-        // We are calling the impl methods to get around the single instance of Settings that is expected\n-        for (Iterator i = settings.listImpl(); i.hasNext(); ) {\n-            String name = (String) i.next();\n-            props.setProperty(name, settings.getImpl(name), settings.getLocationImpl(name));\n-        }\n-    }\n-}",
                "changes": 113,
                "blob_url": "https://github.com/apache/struts/blob/f1b699876277c5ce1a31833beb2b1f2ca843a50c/core/src/main/java/org/apache/struts2/config/LegacyPropertiesConfigurationProvider.java"
            },
            {
                "additions": 62,
                "sha": "7a422328850a6aff6317983c713a198099f38a25",
                "status": "added",
                "raw_url": "https://github.com/apache/struts/raw/1189735db76a6ecd869c82121a103282f53b7e45/core/src/main/java/org/apache/struts2/config/PropertiesConfigurationProvider.java",
                "deletions": 0,
                "filename": "core/src/main/java/org/apache/struts2/config/PropertiesConfigurationProvider.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/config/PropertiesConfigurationProvider.java?ref=1189735db76a6ecd869c82121a103282f53b7e45",
                "patch": "@@ -0,0 +1,62 @@\n+/*\n+ * $Id$\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.struts2.config;\n+\n+import com.opensymphony.xwork2.config.Configuration;\n+import com.opensymphony.xwork2.config.ConfigurationException;\n+import com.opensymphony.xwork2.config.ConfigurationProvider;\n+import com.opensymphony.xwork2.inject.ContainerBuilder;\n+import com.opensymphony.xwork2.util.location.LocatableProperties;\n+\n+import java.util.Iterator;\n+\n+public class PropertiesConfigurationProvider implements ConfigurationProvider {\n+\n+    public void destroy() {\n+    }\n+\n+    public void init(Configuration configuration) throws ConfigurationException {\n+    }\n+\n+    public void loadPackages() throws ConfigurationException {\n+    }\n+\n+    public boolean needsReload() {\n+        return false;\n+    }\n+\n+    public void register(ContainerBuilder builder, LocatableProperties props) throws ConfigurationException {\n+        final DefaultSettings settings = new DefaultSettings();\n+        loadSettings(props, settings);\n+    }\n+\n+    /**\n+     * @param props\n+     * @param settings\n+     */\n+    protected void loadSettings(LocatableProperties props, final Settings settings) {\n+        for (Iterator i = settings.list(); i.hasNext(); ) {\n+            String name = (String) i.next();\n+            props.setProperty(name, settings.get(name), settings.getLocation(name));\n+        }\n+    }\n+}",
                "changes": 62,
                "blob_url": "https://github.com/apache/struts/blob/1189735db76a6ecd869c82121a103282f53b7e45/core/src/main/java/org/apache/struts2/config/PropertiesConfigurationProvider.java"
            },
            {
                "additions": 9,
                "sha": "333608bbe19cab955e7a8b588f8188f3d97b5005",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1189735db76a6ecd869c82121a103282f53b7e45/core/src/main/java/org/apache/struts2/config/PropertiesSettings.java",
                "deletions": 44,
                "filename": "core/src/main/java/org/apache/struts2/config/PropertiesSettings.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/config/PropertiesSettings.java?ref=1189735db76a6ecd869c82121a103282f53b7e45",
                "patch": "@@ -38,11 +38,11 @@\n /**\n  * A class to handle settings via a properties file.\n  */\n-class PropertiesSettings extends Settings {\n+class PropertiesSettings implements Settings {\n \n-    LocatableProperties settings;\n-    static Logger LOG = LoggerFactory.getLogger(PropertiesSettings.class);\n+    private static final Logger LOG = LoggerFactory.getLogger(PropertiesSettings.class);\n \n+    private LocatableProperties settings;\n \n     /**\n      * Creates a new properties config given the name of a properties file. The name is expected to NOT have\n@@ -86,66 +86,31 @@ public PropertiesSettings(String name) {\n     }\n \n \n-    /**\n-     * Sets a property in the properties file.\n-     *\n-     * @see #set(String, String)\n-     */\n-    public void setImpl(String aName, String aValue) {\n-        settings.setProperty(aName, aValue);\n-    }\n-\n     /**\n      * Gets a property from the properties file.\n      *\n      * @see #get(String)\n      */\n-    public String getImpl(String aName) throws IllegalArgumentException {\n-        String setting = settings.getProperty(aName);\n-\n-        if (setting == null) {\n-            throw new IllegalArgumentException(\"No such setting:\" + aName);\n-        }\n-\n-        return setting;\n+    public String get(String aName) throws IllegalArgumentException {\n+        return settings.getProperty(aName);\n     }\n     \n     /**\n      * Gets the location of a property from the properties file.\n      *\n      * @see #getLocation(String)\n      */\n-    public Location getLocationImpl(String aName) throws IllegalArgumentException {\n-        Location loc = settings.getPropertyLocation(aName);\n-\n-        if (loc == null) {\n-            if (!settings.containsKey(aName)) {\n-                throw new IllegalArgumentException(\"No such setting:\" + aName);\n-            } \n-        }\n-\n-        return loc;\n-    }\n-\n-    /**\n-     * Tests to see if a property exists in the properties file.\n-     *\n-     * @see #isSet(String)\n-     */\n-    public boolean isSetImpl(String aName) {\n-        if (settings.get(aName) != null) {\n-            return true;\n-        } else {\n-            return false;\n-        }\n+    public Location getLocation(String aName) throws IllegalArgumentException {\n+        return settings.getPropertyLocation(aName);\n     }\n \n     /**\n      * Lists all keys in the properties file.\n      *\n      * @see #list()\n      */\n-    public Iterator listImpl() {\n+    public Iterator list() {\n         return settings.keySet().iterator();\n     }\n+\n }",
                "changes": 53,
                "blob_url": "https://github.com/apache/struts/blob/1189735db76a6ecd869c82121a103282f53b7e45/core/src/main/java/org/apache/struts2/config/PropertiesSettings.java"
            },
            {
                "additions": 10,
                "sha": "03d5764e18e0c074d719ddf364871fa13f435cdb",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1189735db76a6ecd869c82121a103282f53b7e45/core/src/main/java/org/apache/struts2/config/Settings.java",
                "deletions": 264,
                "filename": "core/src/main/java/org/apache/struts2/config/Settings.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/config/Settings.java?ref=1189735db76a6ecd869c82121a103282f53b7e45",
                "patch": "@@ -21,290 +21,36 @@\n \n package org.apache.struts2.config;\n \n-import com.opensymphony.xwork2.ObjectFactory;\n import com.opensymphony.xwork2.util.location.Location;\n-import com.opensymphony.xwork2.util.logging.Logger;\n-import com.opensymphony.xwork2.util.logging.LoggerFactory;\n-import org.apache.struts2.StrutsConstants;\n \n import java.util.Iterator;\n-import java.util.Locale;\n-\n \n /**\n  * Settings retrieves and exposes default values used by the framework.\n- * An application can override a factory default and provide its own value for a setting.\n- * <p>\n- * Implementation of the class is pluggable (the default implementation is {@link DefaultSettings}).\n- * Pluggability gives applications to ability to customize how settings are retrieved.\n- * As an example, an application may wish to check some custom property store\n- * before delegating to the usual configuration and property files.\n- * <p>\n- * Key methods:\n- * <ul>\n- * <li>{@link #getLocale()}</li>\n- * <li>{@link #get(String)}</li>\n- * <li>{@link #set(String, String)}</li>\n- * <li>{@link #list()}</li>\n- * </ul>\n- * <p>\n- * Key methods for subclasses (plugins):\n- * <ul>\n- * <li>{@link #getImpl(String)}</li>\n- * <li>{@link #setImpl(String, String)}</li>\n- * <li>{@link #listImpl()}</li>\n- * <li>{@link #isSetImpl(String)}</li>\n- * </ul>\n- * @deprecated Since Struts 2.1.2\n  */\n-class Settings {\n-\n-\n-    /**\n-     * A pluggable implementation of Settings,\n-     * provided through the {@link #setInstance} method.\n-     */\n-    static Settings settingsImpl;\n-\n-    /**\n-     * An instance of {@link DefaultSettings}\n-     * to use when another implementation is not provided (plugged in).\n-     */\n-    static Settings defaultImpl;\n-\n-    /**\n-     * Guard used to protect the defaultImpl initialisation.\n-     */\n-    private static final Object DEFAULT_LOCK = new Object();\n-\n-    /**\n-     * An instance of the default locale as specified by the <code>struts.locale</code>  setting.\n-     *\n-     * @see #getLocale\n-     */\n-    static Locale locale;\n-\n-    /**\n-     * The Logging instance for this class.\n-     */\n-    private static final Logger LOG = LoggerFactory.getLogger(Settings.class);\n-\n-    /**\n-     * Registers a custom Settings implementation (plugin),\n-     * and resets the cached locale.\n-     * <p>\n-     * This method can only be called once.\n-     *\n-     * @param config a Settings implementation\n-     * @throws IllegalStateException if an error occurs when setting the settings implementation.\n-     */\n-    public static void setInstance(Settings config) throws IllegalStateException {\n-        settingsImpl = config;\n-        locale = null;\n-    }\n-\n-    /**\n-     * Provides the Settings object.\n-     * <p>\n-     * This method will substitute the default instance if another instance is not registered.\n-     *\n-     * @return the Settings object.\n-     */\n-    public static Settings getInstance() {\n-        return (settingsImpl == null) ? getDefaultInstance() : settingsImpl;\n-    }\n-\n-    /**\n-     * Provides the Struts default locale.\n-     * <p>\n-     * This method utilizes the <code>struts.locale</code> setting, which should be given\n-     * as the Java {@link java.util.Locale#toString() toString()} representation of a Locale object\n-     * (\"en\", \"de_DE\", \"_GB\", \"en_US_WIN\", \"de__POSIX\", \"fr_MAC\", and so forth).\n-     * <p>\n-     * If a <code>struts.locale</code> setting is not registered,\n-     * then the default virtual machine locale is substituted and cached.\n-     *\n-     * @return the Struts default locale if specified or the VM default locale.\n-     * @see java.util.Locale#getDefault()\n-     */\n-    public static Locale getLocale() {\n-        // Locale processing has been moved to the LegacyPropertiesConfigurationProvider\n-\n-        return locale;\n-    }\n-\n-    /**\n-     * Determines whether or not a setting has a registered value.\n-     * <p>\n-     * This method is useful for testing for the existance of setting without\n-     * throwing an IllegalArgumentException.\n-     *\n-     * @param name the name of a setting to test.\n-     * @return <code>true</code> if the setting exists and has a value, <code>false</code> otherwise.\n-     */\n-    public static boolean isSet(String name) {\n-        return getInstance().isSetImpl(name);\n-    }\n+interface Settings {\n \n     /**\n-     * Provides a setting value as a String.\n-     * <p>\n-     * The method will throw an <code>IllegalArgumentException</code> if an error occurs\n-     * while retrieveing the property or if the property doesn't exist.\n+     * Retrieve value for provided name\n      *\n-     * @param name the name of the setting to retrieve.\n-     * @return the setting value as a String.\n-     * @throws IllegalArgumentException if an error occurs retrieving the property or the property does not exist.\n+     * @param name The name of the setting value to retrieve\n+     * @return The setting value as a String or null\n      */\n-    public static String get(String name) throws IllegalArgumentException {\n-        return getInstance().getImpl(name);\n-    }\n+    String get(String name);\n \n     /**\n-     * Provides the Location of a setting.\n-     * <p>\n-     * The Location is utilized as part of precise error reporting.\n-     * <p>\n-      * This method will throw an <code>IllegalArgumentException</code> if an error occurs\n-     * while retrieving the value or if the setting doesn't exist.\n-     *\n-     * @param name the name of the property to get.\n-     * @return the Location of a property.\n-     * @throws IllegalArgumentException if an error occurs retrieving the property or the property does not exist.\n-     */\n-    public static Location getLocation(String name) throws IllegalArgumentException {\n-        return getInstance().getLocationImpl(name);\n-    }\n-\n-    /**\n-     * Provides an Iterator of all properties names.\n-     *\n-     * @return an Iterator of all properties names.\n-     */\n-    public static Iterator list() {\n-        return getInstance().listImpl();\n-    }\n-\n-    /**\n-     * Implements the {@link #isSet(String)} method.\n-     *\n-     * @param name Identifier for the setting value to change\n-     * @return True if the setting exists and has a value, false otherwise.\n-     * @see #isSet(String)\n-     */\n-    public boolean isSetImpl(String name) {\n-        // this is dumb.. maybe it should just throw an unsupported op like the rest of the *Impl\n-        // methods in this class.\n-        return false;\n-    }\n-\n-    /**\n-     * Registers a value for a setting.\n-     * <p>\n-     * This method raises an exception if an error occurs when setting the value or if the\n-     * settings implementation does not support setting values.\n-     *\n-     * @param name  the name of the setting.\n-     * @param value the value to register for the setting.\n-     * @throws IllegalArgumentException      if an error occurs when setting the value.\n-     * @throws UnsupportedOperationException if the config implementation does not support setting values.\n-     */\n-    public static void set(String name, String value) throws IllegalArgumentException, UnsupportedOperationException {\n-        getInstance().setImpl(name, value);\n-    }\n-\n-    /**\n-     * Implements the {@link #set(String, String)} method.\n-     *\n-     * @param name Identifer for the setting to change.\n-     * @param value The new value for the setting.\n-     * @throws IllegalArgumentException      if an error occurs when setting the value.\n-     * @throws UnsupportedOperationException if the config implementation does not support setting values.\n-     * @see #set(String, String)\n-     */\n-    public void setImpl(String name, String value) throws IllegalArgumentException, UnsupportedOperationException {\n-        throw new UnsupportedOperationException(\"Settings: This implementation does not support setting a value.\");\n-    }\n-\n-    /**\n-     * Implements the {@link #get(String)} method.\n-     *\n-     * @param name The name of the setting value to retreive\n-     * @return The setting value as a String\n-     * @throws IllegalArgumentException if an error occurs when retrieving the value\n-     * @see #get(String)\n-     */\n-    public String getImpl(String name) throws IllegalArgumentException {\n-        return null;\n-    }\n-\n-    /**\n-     * Implements the {@link #getLocation(String)} method.\n+     * Returns {@link com.opensymphony.xwork2.util.location.Location} of given setting\n      *\n      * @param name Name of the setting to locate\n-     * @return The location  of the setting\n-     * @throws IllegalArgumentException if an error occurs when retrieving the value\n-     * @see #getLocation(String)\n+     * @return The location  of the setting or null\n      */\n-    public Location getLocationImpl(String name) throws IllegalArgumentException {\n-        return null;\n-    }\n+    Location getLocation(String name);\n \n     /**\n-     * Implements the {@link #list()} method.\n+     * Returns {@link java.util.Iterator} with all values\n      *\n-     * @see #list()\n      * @return A list of the settings as an iterator\n      */\n-    public Iterator listImpl() {\n-        throw new UnsupportedOperationException(\"Settings: This implementation does not support listing the registered settings\");\n-    }\n-\n-    /**\n-     * Creates a default Settings object.\n-     * <p>\n-     * A default implementation may be specified by the <code>struts.configuration</code> setting;\n-     * otherwise, this method instantiates {@link DefaultSettings} as the default implementation.\n-     *\n-     * @return A default Settings object.\n-     */\n-    private static Settings getDefaultInstance() {\n-        if (defaultImpl == null) {\n-            synchronized (DEFAULT_LOCK) {\n-                if (defaultImpl == null) {\n-                    // Create bootstrap implementation\n-                    defaultImpl = new DefaultSettings();\n-\n-                    // Create default implementation\n-                    try {\n-                        String className = get(StrutsConstants.STRUTS_CONFIGURATION);\n-\n-                        if (!className.equals(defaultImpl.getClass().getName())) {\n-                            try {\n-                                // singleton instances shouldn't be built accessing request or session-specific context data\n-                                defaultImpl = (Settings) ObjectFactory.getObjectFactory().buildBean(Thread.currentThread().getContextClassLoader().loadClass(className), null);\n-                            } catch (Exception e) {\n-                                LOG.error(\"Settings: Could not instantiate the struts.configuration object, substituting the default implementation.\", e);\n-                            }\n-                        }\n-                    } catch (IllegalArgumentException ex) {\n-                        // ignore\n-                    }\n-                }\n-            }\n-        }\n-\n-        return defaultImpl;\n-    }\n-\n-    /**\n-     * Resets the default and any plugin Setting instance to null.\n-     */\n-    public static void reset() {\n-        synchronized (DEFAULT_LOCK) {\n-            defaultImpl = null;\n-        }\n-        settingsImpl = null;\n-    }\n+    Iterator list();\n \n }",
                "changes": 274,
                "blob_url": "https://github.com/apache/struts/blob/1189735db76a6ecd869c82121a103282f53b7e45/core/src/main/java/org/apache/struts2/config/Settings.java"
            },
            {
                "additions": 2,
                "sha": "520394b030ac4607f81c1162301ffac27a454f3b",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1189735db76a6ecd869c82121a103282f53b7e45/core/src/main/java/org/apache/struts2/dispatcher/Dispatcher.java",
                "deletions": 2,
                "filename": "core/src/main/java/org/apache/struts2/dispatcher/Dispatcher.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/dispatcher/Dispatcher.java?ref=1189735db76a6ecd869c82121a103282f53b7e45",
                "patch": "@@ -60,7 +60,7 @@\n import org.apache.struts2.StrutsStatics;\n import org.apache.struts2.config.BeanSelectionProvider;\n import org.apache.struts2.config.DefaultPropertiesProvider;\n-import org.apache.struts2.config.LegacyPropertiesConfigurationProvider;\n+import org.apache.struts2.config.PropertiesConfigurationProvider;\n import org.apache.struts2.config.StrutsXmlConfigurationProvider;\n import org.apache.struts2.dispatcher.mapper.ActionMapping;\n import org.apache.struts2.dispatcher.multipart.MultiPartRequest;\n@@ -374,7 +374,7 @@ private void init_DefaultProperties() {\n     }\n     \n     private void init_LegacyStrutsProperties() {\n-        configurationManager.addContainerProvider(new LegacyPropertiesConfigurationProvider());\n+        configurationManager.addContainerProvider(new PropertiesConfigurationProvider());\n     }\n \n     private void init_TraditionalXmlConfigurations() {",
                "changes": 4,
                "blob_url": "https://github.com/apache/struts/blob/1189735db76a6ecd869c82121a103282f53b7e45/core/src/main/java/org/apache/struts2/dispatcher/Dispatcher.java"
            },
            {
                "additions": 25,
                "sha": "123f8eb655ed14fa7910484ae134a11f7a76243b",
                "status": "renamed",
                "raw_url": "https://github.com/apache/struts/raw/1189735db76a6ecd869c82121a103282f53b7e45/core/src/test/java/org/apache/struts2/config/PropertiesConfigurationProviderTest.java",
                "previous_filename": "core/src/test/java/org/apache/struts2/config/LegacyPropertiesConfigurationProviderTest.java",
                "deletions": 13,
                "filename": "core/src/test/java/org/apache/struts2/config/PropertiesConfigurationProviderTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/org/apache/struts2/config/PropertiesConfigurationProviderTest.java?ref=1189735db76a6ecd869c82121a103282f53b7e45",
                "patch": "@@ -21,37 +21,35 @@\n \n package org.apache.struts2.config;\n \n-import java.util.Iterator;\n-import java.util.Locale;\n-\n-import org.apache.struts2.StrutsConstants;\n-import org.apache.struts2.StrutsTestCase;\n-\n+import com.opensymphony.xwork2.inject.Container;\n+import com.opensymphony.xwork2.inject.ContainerBuilder;\n import com.opensymphony.xwork2.util.LocalizedTextUtil;\n import com.opensymphony.xwork2.util.location.LocatableProperties;\n-import com.opensymphony.xwork2.inject.ContainerBuilder;\n-import com.opensymphony.xwork2.inject.Container;\n import junit.framework.TestCase;\n+import org.apache.struts2.StrutsConstants;\n+\n+import java.util.Locale;\n \n \n /**\n  * Unit test for {@link SettingsTest}.\n  *\n  */\n-public class LegacyPropertiesConfigurationProviderTest extends TestCase {\n+public class PropertiesConfigurationProviderTest extends TestCase {\n \n     public void testRegister_DifferentLocale() {\n \n         ContainerBuilder builder = new ContainerBuilder();\n         builder.constant(\"foo\", \"bar\");\n         builder.constant(\"struts.locale\", \"DE_de\");\n \n-        LegacyPropertiesConfigurationProvider prov = new LegacyPropertiesConfigurationProvider();\n+        PropertiesConfigurationProvider prov = new PropertiesConfigurationProvider();\n         prov.register(builder, new LocatableProperties());\n \n         Container container = builder.create(true);\n \n-        Locale locale = container.getInstance(Locale.class);\n+        String localeStr = container.getInstance(String.class, StrutsConstants.STRUTS_LOCALE);\n+        Locale locale = LocalizedTextUtil.localeFromString(localeStr, Locale.FRANCE);\n \n         assertNotNull(locale);\n         assertEquals(\"DE\", locale.getCountry());\n@@ -64,16 +62,30 @@ public void testRegister_NoLocale() {\n         ContainerBuilder builder = new ContainerBuilder();\n         builder.constant(\"foo\", \"bar\");\n \n-        LegacyPropertiesConfigurationProvider prov = new LegacyPropertiesConfigurationProvider();\n+        PropertiesConfigurationProvider prov = new PropertiesConfigurationProvider();\n         prov.register(builder, new LocatableProperties());\n \n         Container container = builder.create(true);\n \n-        Locale locale = container.getInstance(Locale.class);\n+        String localeStr = container.getInstance(String.class, StrutsConstants.STRUTS_LOCALE);\n+        Locale locale = LocalizedTextUtil.localeFromString(localeStr, Locale.getDefault());\n \n         assertNotNull(locale);\n         Locale vmLocale = Locale.getDefault();\n         assertEquals(locale, vmLocale);\n     }\n \n+    public void testDefaultSettings() throws Exception {\n+        // given\n+        PropertiesConfigurationProvider prov = new PropertiesConfigurationProvider();\n+        LocatableProperties props = new LocatableProperties();\n+        prov.register(new ContainerBuilder(), props);\n+\n+        // when\n+        Object encoding = props.get(StrutsConstants.STRUTS_I18N_ENCODING);\n+\n+        // then\n+        assertEquals(\"ISO-8859-1\", encoding);\n+    }\n+\n }",
                "changes": 38,
                "blob_url": "https://github.com/apache/struts/blob/1189735db76a6ecd869c82121a103282f53b7e45/core/src/test/java/org/apache/struts2/config/PropertiesConfigurationProviderTest.java"
            },
            {
                "additions": 19,
                "sha": "46c55811e864432c5887070a26f3220aa70d4a01",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1189735db76a6ecd869c82121a103282f53b7e45/core/src/test/java/org/apache/struts2/config/SettingsTest.java",
                "deletions": 16,
                "filename": "core/src/test/java/org/apache/struts2/config/SettingsTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/org/apache/struts2/config/SettingsTest.java?ref=1189735db76a6ecd869c82121a103282f53b7e45",
                "patch": "@@ -21,13 +21,12 @@\n \n package org.apache.struts2.config;\n \n-import java.util.Iterator;\n-import java.util.Locale;\n-\n+import com.opensymphony.xwork2.util.LocalizedTextUtil;\n import org.apache.struts2.StrutsConstants;\n import org.apache.struts2.StrutsTestCase;\n \n-import com.opensymphony.xwork2.util.LocalizedTextUtil;\n+import java.util.Iterator;\n+import java.util.Locale;\n \n \n /**\n@@ -37,34 +36,38 @@\n public class SettingsTest extends StrutsTestCase {\n \n     public void testSettings() {\n-        assertEquals(\"12345\", Settings.get(StrutsConstants.STRUTS_MULTIPART_MAXSIZE));\n-        assertEquals(\"\\temp\", Settings.get(StrutsConstants.STRUTS_MULTIPART_SAVEDIR));\n+        Settings settings = new DefaultSettings();\n \n-        assertEquals(\"test,org/apache/struts2/othertest\", Settings.get( StrutsConstants.STRUTS_CUSTOM_PROPERTIES));\n-        assertEquals(\"testvalue\", Settings.get(\"testkey\"));\n-        assertEquals(\"othertestvalue\", Settings.get(\"othertestkey\"));\n+        assertEquals(\"12345\", settings.get(StrutsConstants.STRUTS_MULTIPART_MAXSIZE));\n+        assertEquals(\"\\temp\", settings.get(StrutsConstants.STRUTS_MULTIPART_SAVEDIR));\n \n-        int count = getKeyCount();\n+        assertEquals(\"test,org/apache/struts2/othertest\", settings.get( StrutsConstants.STRUTS_CUSTOM_PROPERTIES));\n+        assertEquals(\"testvalue\", settings.get(\"testkey\"));\n+        assertEquals(\"othertestvalue\", settings.get(\"othertestkey\"));\n+\n+        int count = getKeyCount(settings);\n         assertEquals(12, count);\n     }\n \n     public void testDefaultResourceBundlesLoaded() {\n-        assertEquals(\"testmessages,testmessages2\", Settings.get(StrutsConstants.STRUTS_CUSTOM_I18N_RESOURCES));\n+        Settings settings = new DefaultSettings();\n+\n+        assertEquals(\"testmessages,testmessages2\", settings.get(StrutsConstants.STRUTS_CUSTOM_I18N_RESOURCES));\n         assertEquals(\"This is a test message\", LocalizedTextUtil.findDefaultText(\"default.testmessage\", Locale.getDefault()));\n         assertEquals(\"This is another test message\", LocalizedTextUtil.findDefaultText(\"default.testmessage2\", Locale.getDefault()));\n     }\n \n     public void testSetSettings() {\n-        Settings.setInstance(new TestSettings());\n+        Settings settings = new TestSettings();\n \n         String keyName = \"a.long.property.key.name\";\n-        assertEquals(keyName, Settings.get(keyName));\n-        assertEquals(2, getKeyCount());\n+        assertEquals(keyName, settings.get(keyName));\n+        assertEquals(2, getKeyCount(settings));\n     }\n \n-    private int getKeyCount() {\n+    private int getKeyCount(Settings settings) {\n         int count = 0;\n-        Iterator keyNames = Settings.list();\n+        Iterator keyNames = settings.list();\n \n         while (keyNames.hasNext()) {\n             keyNames.next();",
                "changes": 35,
                "blob_url": "https://github.com/apache/struts/blob/1189735db76a6ecd869c82121a103282f53b7e45/core/src/test/java/org/apache/struts2/config/SettingsTest.java"
            },
            {
                "additions": 9,
                "sha": "ec9a1aaedecb54b151dec5e7232df01d119638a5",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1189735db76a6ecd869c82121a103282f53b7e45/core/src/test/java/org/apache/struts2/config/TestSettings.java",
                "deletions": 3,
                "filename": "core/src/test/java/org/apache/struts2/config/TestSettings.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/org/apache/struts2/config/TestSettings.java?ref=1189735db76a6ecd869c82121a103282f53b7e45",
                "patch": "@@ -21,6 +21,8 @@\n \n package org.apache.struts2.config;\n \n+import com.opensymphony.xwork2.util.location.Location;\n+\n import java.util.ArrayList;\n import java.util.Iterator;\n import java.util.List;\n@@ -30,25 +32,29 @@\n  * TestSettings\n  *\n  */\n-public class TestSettings extends Settings {\n+public class TestSettings implements Settings {\n \n     /**\n      * Get a named setting.\n      *\n      * @throws IllegalArgumentException if there is no settings parameter with the given name.\n      */\n-    public String getImpl(String aName) throws IllegalArgumentException {\n+    public String get(String aName) throws IllegalArgumentException {\n         return aName;\n     }\n \n     /**\n      * List setting names\n      */\n-    public Iterator listImpl() {\n+    public Iterator list() {\n         List testList = new ArrayList();\n         testList.add(\"123\");\n         testList.add(\"testValue\");\n \n         return testList.iterator();\n     }\n+\n+    public Location getLocation(String name) {\n+        return null;\n+    }\n }",
                "changes": 12,
                "blob_url": "https://github.com/apache/struts/blob/1189735db76a6ecd869c82121a103282f53b7e45/core/src/test/java/org/apache/struts2/config/TestSettings.java"
            },
            {
                "additions": 2,
                "sha": "549e7329c9159a707a232c4840e5bd09ce785cb9",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1189735db76a6ecd869c82121a103282f53b7e45/plugins/sitegraph/src/main/java/org/apache/struts2/sitegraph/StrutsConfigRetriever.java",
                "deletions": 2,
                "filename": "plugins/sitegraph/src/main/java/org/apache/struts2/sitegraph/StrutsConfigRetriever.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/sitegraph/src/main/java/org/apache/struts2/sitegraph/StrutsConfigRetriever.java?ref=1189735db76a6ecd869c82121a103282f53b7e45",
                "patch": "@@ -29,7 +29,7 @@\n import com.opensymphony.xwork2.util.logging.LoggerFactory;\n import org.apache.struts2.config.BeanSelectionProvider;\n import org.apache.struts2.config.DefaultPropertiesProvider;\n-import org.apache.struts2.config.LegacyPropertiesConfigurationProvider;\n+import org.apache.struts2.config.PropertiesConfigurationProvider;\n import org.apache.struts2.config.StrutsXmlConfigurationProvider;\n import org.apache.struts2.sitegraph.entities.FreeMarkerView;\n import org.apache.struts2.sitegraph.entities.JspView;\n@@ -75,7 +75,7 @@ private static void initXWork() {\n             cm.addContainerProvider(new DefaultPropertiesProvider());\n             cm.addContainerProvider(new StrutsXmlConfigurationProvider(\"struts-default.xml\", false, null));\n             cm.addContainerProvider(configProvider);\n-            cm.addContainerProvider(new LegacyPropertiesConfigurationProvider());\n+            cm.addContainerProvider(new PropertiesConfigurationProvider());\n             cm.addContainerProvider(new BeanSelectionProvider());\n             isXWorkStarted = true;\n         } catch (IOException e) {",
                "changes": 4,
                "blob_url": "https://github.com/apache/struts/blob/1189735db76a6ecd869c82121a103282f53b7e45/plugins/sitegraph/src/main/java/org/apache/struts2/sitegraph/StrutsConfigRetriever.java"
            },
            {
                "additions": 17,
                "sha": "9b41eb1a654879a334a32ae05034ebdc528278e6",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1189735db76a6ecd869c82121a103282f53b7e45/xwork-core/src/main/java/com/opensymphony/xwork2/util/location/LocatableProperties.java",
                "deletions": 12,
                "filename": "xwork-core/src/main/java/com/opensymphony/xwork2/util/location/LocatableProperties.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/main/java/com/opensymphony/xwork2/util/location/LocatableProperties.java?ref=1189735db76a6ecd869c82121a103282f53b7e45",
                "patch": "@@ -19,18 +19,18 @@\n public class LocatableProperties extends Properties implements Locatable {\n \n     Location location;\n-    Map<String,Location> propLocations;\n-    \n+    Map<String, Location> propLocations;\n+\n     public LocatableProperties() {\n-        this(null);\n+        this(Location.UNKNOWN);\n     }\n-    \n+\n     public LocatableProperties(Location loc) {\n         super();\n         this.location = loc;\n-        this.propLocations = new HashMap<String,Location>();\n+        this.propLocations = new HashMap<String, Location>();\n     }\n-    \n+\n     @Override\n     public void load(InputStream in) throws IOException {\n         Reader reader = new InputStreamReader(in);\n@@ -40,12 +40,12 @@ public void load(InputStream in) throws IOException {\n             String val = pr.getPropertyValue();\n             int line = pr.getLineNumber();\n             String desc = convertCommentsToString(pr.getCommentLines());\n-            \n+\n             Location loc = new LocationImpl(desc, location.getURI(), line, 0);\n             setProperty(name, val, loc);\n         }\n     }\n-    \n+\n     String convertCommentsToString(List<String> lines) {\n         StringBuilder sb = new StringBuilder();\n         if (lines != null && lines.size() > 0) {\n@@ -55,7 +55,7 @@ String convertCommentsToString(List<String> lines) {\n         }\n         return sb.toString();\n     }\n-    \n+\n     public Object setProperty(String key, String value, Object locationObj) {\n         Object obj = super.setProperty(key, value);\n         if (location != null) {\n@@ -64,11 +64,16 @@ public Object setProperty(String key, String value, Object locationObj) {\n         }\n         return obj;\n     }\n-    \n+\n     public Location getPropertyLocation(String key) {\n-        return propLocations.get(key);\n+        Location loc = propLocations.get(key);\n+        if (loc != null) {\n+            return loc;\n+        } else {\n+            return Location.UNKNOWN;\n+        }\n     }\n-    \n+\n     public Location getLocation() {\n         return location;\n     }",
                "changes": 29,
                "blob_url": "https://github.com/apache/struts/blob/1189735db76a6ecd869c82121a103282f53b7e45/xwork-core/src/main/java/com/opensymphony/xwork2/util/location/LocatableProperties.java"
            },
            {
                "additions": 1,
                "sha": "3a1974f75f34a2ff442e857a275901e376f35fbf",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1189735db76a6ecd869c82121a103282f53b7e45/xwork-core/src/main/java/com/opensymphony/xwork2/util/location/LocationImpl.java",
                "deletions": 0,
                "filename": "xwork-core/src/main/java/com/opensymphony/xwork2/util/location/LocationImpl.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/main/java/com/opensymphony/xwork2/util/location/LocationImpl.java?ref=1189735db76a6ecd869c82121a103282f53b7e45",
                "patch": "@@ -27,6 +27,7 @@\n  * A simple immutable and serializable implementation of {@link Location}.\n  */\n public class LocationImpl implements Location, Serializable {\n+\n     private final String uri;\n     private final int line;\n     private final int column;",
                "changes": 1,
                "blob_url": "https://github.com/apache/struts/blob/1189735db76a6ecd869c82121a103282f53b7e45/xwork-core/src/main/java/com/opensymphony/xwork2/util/location/LocationImpl.java"
            }
        ],
        "repo": "struts",
        "message": "WW-4152 Solves problem with NPE as a side effect of concurrency issue, removes old code, use simpler dependency graph\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@1534634 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/1189735db76a6ecd869c82121a103282f53b7e45"
    },
    {
        "parent": "https://github.com/apache/struts/commit/fce96812709479c67d0c12a72fe9be1b9721084f",
        "bug_id": "struts_37",
        "file": [
            {
                "additions": 1,
                "sha": "899c3754d09a88180b792b69d3dd5b55c18f84bf",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/7e2f9f68626b89eca61f8b48cd72b25d5b243c7b/xwork-core/src/main/java/com/opensymphony/xwork2/util/OgnlTextParser.java",
                "deletions": 1,
                "filename": "xwork-core/src/main/java/com/opensymphony/xwork2/util/OgnlTextParser.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/main/java/com/opensymphony/xwork2/util/OgnlTextParser.java?ref=7e2f9f68626b89eca61f8b48cd72b25d5b243c7b",
                "patch": "@@ -10,7 +10,7 @@\n     public Object evaluate(char[] openChars, String expression, TextParseUtil.ParsedValueEvaluator evaluator, int maxLoopCount) {\n         // deal with the \"pure\" expressions first!\n         //expression = expression.trim();\n-        Object result = expression;\n+        Object result = expression = (expression == null) ? \"\" : expression;\n         int pos = 0;\n \n         for (char open : openChars) {",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/7e2f9f68626b89eca61f8b48cd72b25d5b243c7b/xwork-core/src/main/java/com/opensymphony/xwork2/util/OgnlTextParser.java"
            }
        ],
        "repo": "struts",
        "message": "WW-4138 Solves problem with NPE when passed expression is null\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@1508625 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/7e2f9f68626b89eca61f8b48cd72b25d5b243c7b"
    },
    {
        "parent": "https://github.com/apache/struts/commit/d72ae0cffaf82aaa00283063a96232c1110c4350",
        "bug_id": "struts_38",
        "file": [
            {
                "additions": 6,
                "sha": "f82e36fe3fe43e4ddbf399ca4f1f6c8929391777",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/46e0da8058531aa06bd282b5457e2472bfa7bd61/core/src/main/java/org/apache/struts2/config/LegacyPropertiesConfigurationProvider.java",
                "deletions": 7,
                "filename": "core/src/main/java/org/apache/struts2/config/LegacyPropertiesConfigurationProvider.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/config/LegacyPropertiesConfigurationProvider.java?ref=46e0da8058531aa06bd282b5457e2472bfa7bd61",
                "patch": "@@ -21,22 +21,21 @@\n \n package org.apache.struts2.config;\n \n-import java.util.Iterator;\n-import java.util.Locale;\n-import java.util.StringTokenizer;\n-\n import com.opensymphony.xwork2.config.Configuration;\n import com.opensymphony.xwork2.config.ConfigurationException;\n import com.opensymphony.xwork2.config.ConfigurationProvider;\n import com.opensymphony.xwork2.inject.ContainerBuilder;\n import com.opensymphony.xwork2.inject.Context;\n import com.opensymphony.xwork2.inject.Factory;\n-import com.opensymphony.xwork2.inject.Inject;\n import com.opensymphony.xwork2.util.location.LocatableProperties;\n import com.opensymphony.xwork2.util.logging.Logger;\n import com.opensymphony.xwork2.util.logging.LoggerFactory;\n import org.apache.struts2.StrutsConstants;\n \n+import java.util.Iterator;\n+import java.util.Locale;\n+import java.util.StringTokenizer;\n+\n public class LegacyPropertiesConfigurationProvider implements ConfigurationProvider {\n \n     /**\n@@ -69,10 +68,10 @@ public void register(ContainerBuilder builder, LocatableProperties props)\n         loadSettings(props, settings);\n         \n         // Set default locale by lazily resolving the locale property as needed into a Locale object\n-        builder.factory(Locale.class, new Factory() {\n+        builder.factory(Locale.class,  new Factory<Locale>() {\n             private Locale locale;\n \n-            public synchronized Object create(Context context) throws Exception {\n+            public synchronized Locale create(Context context) throws Exception {\n                 if (locale == null) {\n                     String loc = context.getContainer().getInstance(String.class, StrutsConstants.STRUTS_LOCALE);\n                     if (loc != null) {",
                "changes": 13,
                "blob_url": "https://github.com/apache/struts/blob/46e0da8058531aa06bd282b5457e2472bfa7bd61/core/src/main/java/org/apache/struts2/config/LegacyPropertiesConfigurationProvider.java"
            },
            {
                "additions": 30,
                "sha": "a654bd1ce5c2d20dce15b30f8fa2f395f1366de9",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/46e0da8058531aa06bd282b5457e2472bfa7bd61/core/src/main/java/org/apache/struts2/config/Settings.java",
                "deletions": 20,
                "filename": "core/src/main/java/org/apache/struts2/config/Settings.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/config/Settings.java?ref=46e0da8058531aa06bd282b5457e2472bfa7bd61",
                "patch": "@@ -21,16 +21,14 @@\n \n package org.apache.struts2.config;\n \n-import java.util.Iterator;\n-import java.util.Locale;\n-import java.util.StringTokenizer;\n-\n-import org.apache.struts2.StrutsConstants;\n-\n import com.opensymphony.xwork2.ObjectFactory;\n import com.opensymphony.xwork2.util.location.Location;\n import com.opensymphony.xwork2.util.logging.Logger;\n import com.opensymphony.xwork2.util.logging.LoggerFactory;\n+import org.apache.struts2.StrutsConstants;\n+\n+import java.util.Iterator;\n+import java.util.Locale;\n \n \n /**\n@@ -74,6 +72,11 @@\n      */\n     static Settings defaultImpl;\n \n+    /**\n+     * Guard used to protect the defaultImpl initialisation.\n+     */\n+    private static final Object DEFAULT_LOCK = new Object();\n+\n     /**\n      * An instance of the default locale as specified by the <code>struts.locale</code>  setting.\n      *\n@@ -267,23 +270,27 @@ public Iterator listImpl() {\n      */\n     private static Settings getDefaultInstance() {\n         if (defaultImpl == null) {\n-            // Create bootstrap implementation\n-            defaultImpl = new DefaultSettings();\n+            synchronized (DEFAULT_LOCK) {\n+                if (defaultImpl == null) {\n+                    // Create bootstrap implementation\n+                    defaultImpl = new DefaultSettings();\n \n-            // Create default implementation\n-            try {\n-                String className = get(StrutsConstants.STRUTS_CONFIGURATION);\n-\n-                if (!className.equals(defaultImpl.getClass().getName())) {\n+                    // Create default implementation\n                     try {\n-                        // singleton instances shouldn't be built accessing request or session-specific context data\n-                        defaultImpl = (Settings) ObjectFactory.getObjectFactory().buildBean(Thread.currentThread().getContextClassLoader().loadClass(className), null);\n-                    } catch (Exception e) {\n-                        LOG.error(\"Settings: Could not instantiate the struts.configuration object, substituting the default implementation.\", e);\n+                        String className = get(StrutsConstants.STRUTS_CONFIGURATION);\n+\n+                        if (!className.equals(defaultImpl.getClass().getName())) {\n+                            try {\n+                                // singleton instances shouldn't be built accessing request or session-specific context data\n+                                defaultImpl = (Settings) ObjectFactory.getObjectFactory().buildBean(Thread.currentThread().getContextClassLoader().loadClass(className), null);\n+                            } catch (Exception e) {\n+                                LOG.error(\"Settings: Could not instantiate the struts.configuration object, substituting the default implementation.\", e);\n+                            }\n+                        }\n+                    } catch (IllegalArgumentException ex) {\n+                        // ignore\n                     }\n                 }\n-            } catch (IllegalArgumentException ex) {\n-                // ignore\n             }\n         }\n \n@@ -294,7 +301,10 @@ private static Settings getDefaultInstance() {\n      * Resets the default and any plugin Setting instance to null.\n      */\n     public static void reset() {\n-        defaultImpl = null;\n+        synchronized (DEFAULT_LOCK) {\n+            defaultImpl = null;\n+        }\n         settingsImpl = null;\n     }\n+\n }",
                "changes": 50,
                "blob_url": "https://github.com/apache/struts/blob/46e0da8058531aa06bd282b5457e2472bfa7bd61/core/src/main/java/org/apache/struts2/config/Settings.java"
            }
        ],
        "repo": "struts",
        "message": "WW-3689 Adds synchronized block with global lock to avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@1485576 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/46e0da8058531aa06bd282b5457e2472bfa7bd61"
    },
    {
        "parent": "https://github.com/apache/struts/commit/e091eb41f3da740a016bef74f65c3ed836e6b1ee",
        "bug_id": "struts_39",
        "file": [
            {
                "additions": 8,
                "sha": "ccfb6349aa54d451a7d8777b6897ca479f0b439e",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/aaa27dc380f1b846eddca8a6124240595dccec79/core/src/main/java/org/apache/struts2/dispatcher/mapper/CompositeActionMapper.java",
                "deletions": 11,
                "filename": "core/src/main/java/org/apache/struts2/dispatcher/mapper/CompositeActionMapper.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/dispatcher/mapper/CompositeActionMapper.java?ref=aaa27dc380f1b846eddca8a6124240595dccec79",
                "patch": "@@ -21,18 +21,16 @@\n \n package org.apache.struts2.dispatcher.mapper;\n \n-import java.util.ArrayList;\n-import java.util.List;\n-\n-import javax.servlet.http.HttpServletRequest;\n-\n-import org.apache.struts2.StrutsConstants;\n-\n import com.opensymphony.xwork2.config.ConfigurationManager;\n import com.opensymphony.xwork2.inject.Container;\n import com.opensymphony.xwork2.inject.Inject;\n import com.opensymphony.xwork2.util.logging.Logger;\n import com.opensymphony.xwork2.util.logging.LoggerFactory;\n+import org.apache.struts2.StrutsConstants;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.ArrayList;\n+import java.util.List;\n \n /**\n  * <!-- START SNIPPET: description -->\n@@ -88,12 +86,11 @@\n     protected Container container;\n     \n     protected List<ActionMapper> actionMappers = new ArrayList<ActionMapper>();\n-    \n-    @Inject\n-    public void setContainer(Container container) {\n+\n+    public CompositeActionMapper(@Inject Container container) {\n         this.container = container;\n     }\n-    \n+\n     @Inject(StrutsConstants.STRUTS_MAPPER_COMPOSITE)\n     public void setActionMappers(String list) {\n         if (list != null) {",
                "changes": 19,
                "blob_url": "https://github.com/apache/struts/blob/aaa27dc380f1b846eddca8a6124240595dccec79/core/src/main/java/org/apache/struts2/dispatcher/mapper/CompositeActionMapper.java"
            },
            {
                "additions": 4,
                "sha": "e197550483f5b21c4f156fbdb6599e2301e3c11c",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/aaa27dc380f1b846eddca8a6124240595dccec79/core/src/test/java/org/apache/struts2/dispatcher/mapper/CompositeActionMapperTest.java",
                "deletions": 14,
                "filename": "core/src/test/java/org/apache/struts2/dispatcher/mapper/CompositeActionMapperTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/org/apache/struts2/dispatcher/mapper/CompositeActionMapperTest.java?ref=aaa27dc380f1b846eddca8a6124240595dccec79",
                "patch": "@@ -21,23 +21,14 @@\n \n package org.apache.struts2.dispatcher.mapper;\n \n-import java.util.Iterator;\n-import java.util.LinkedHashMap;\n-import java.util.List;\n-import java.util.Map;\n-\n-import javax.servlet.http.HttpServletRequest;\n-\n-import org.apache.struts2.StrutsConstants;\n-import org.springframework.mock.web.MockHttpServletRequest;\n-\n import com.mockobjects.dynamic.C;\n import com.mockobjects.dynamic.Mock;\n import com.opensymphony.xwork2.config.ConfigurationManager;\n import com.opensymphony.xwork2.inject.Container;\n-import com.opensymphony.xwork2.inject.Scope.Strategy;\n-\n import junit.framework.TestCase;\n+import org.springframework.mock.web.MockHttpServletRequest;\n+\n+import javax.servlet.http.HttpServletRequest;\n \n /**\n  *\n@@ -49,9 +40,8 @@\n     Mock mockContainer;\n     \n     public void setUp() throws Exception {\n-        compositeActionMapper = new CompositeActionMapper();\n         mockContainer = new Mock(Container.class);\n-        compositeActionMapper.setContainer((Container)mockContainer.proxy());\n+        compositeActionMapper = new CompositeActionMapper((Container)mockContainer.proxy());\n     }\n     \n ",
                "changes": 18,
                "blob_url": "https://github.com/apache/struts/blob/aaa27dc380f1b846eddca8a6124240595dccec79/core/src/test/java/org/apache/struts2/dispatcher/mapper/CompositeActionMapperTest.java"
            }
        ],
        "repo": "struts",
        "message": "WW-3994 Uses constructor injections instead property injections to avoid NPE\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@1458543 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/aaa27dc380f1b846eddca8a6124240595dccec79"
    },
    {
        "parent": "https://github.com/apache/struts/commit/186d2c1346ec44600aba36bb79594e72dce9b4b1",
        "bug_id": "struts_40",
        "file": [
            {
                "additions": 9,
                "sha": "160e5f0ae63efc0466aa53f1f42dd8505e7f7353",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/32ea57d925ab62cb0f4515b0cb6d5a18834b9a1d/plugins/json/src/main/java/org/apache/struts2/json/JSONWriter.java",
                "deletions": 10,
                "filename": "plugins/json/src/main/java/org/apache/struts2/json/JSONWriter.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/json/src/main/java/org/apache/struts2/json/JSONWriter.java?ref=32ea57d925ab62cb0f4515b0cb6d5a18834b9a1d",
                "patch": "@@ -408,27 +408,26 @@ protected void map(Map map, Method method) throws JSONException {\n             }\n \n             Object key = entry.getKey();\n+            if (key == null) {\n+                LOG.error(\"Cannot build expression for null key in #0\", exprStack);\n+                continue;\n+            }\n+\n             String expr = null;\n             if (this.buildExpr) {\n-                if (key == null) {\n-                    LOG.error(\"Cannot build expression for null key in \" + this.exprStack);\n+                expr = this.expandExpr(key.toString());\n+                if (this.shouldExcludeProperty(expr)) {\n                     continue;\n-                } else {\n-                    expr = this.expandExpr(key.toString());\n-                    if (this.shouldExcludeProperty(expr)) {\n-                        continue;\n-                    }\n-                    expr = this.setExprStack(expr);\n                 }\n+                expr = this.setExprStack(expr);\n             }\n             if (hasData) {\n                 this.add(',');\n             }\n             hasData = true;\n             if (!warnedNonString && !(key instanceof String)) {\n                 if (LOG.isWarnEnabled()) {\n-                    LOG.warn(\"JavaScript doesn't support non-String keys, using toString() on \"\n-                        + key.getClass().getName());\n+                    LOG.warn(\"JavaScript doesn't support non-String keys, using toString() on #0\", key.getClass().getName());\n                 }\n                 warnedNonString = true;\n             }",
                "changes": 19,
                "blob_url": "https://github.com/apache/struts/blob/32ea57d925ab62cb0f4515b0cb6d5a18834b9a1d/plugins/json/src/main/java/org/apache/struts2/json/JSONWriter.java"
            }
        ],
        "repo": "struts",
        "message": "Solves problem with possible NPE when key is null - https://github.com/apache/struts2/pull/4\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@1436290 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/32ea57d925ab62cb0f4515b0cb6d5a18834b9a1d"
    },
    {
        "parent": "https://github.com/apache/struts/commit/139c4d59a8c0516c7a2e888d5f94d1968286c7ce",
        "bug_id": "struts_41",
        "file": [
            {
                "additions": 1,
                "sha": "303addec9e1883312e3ae4beaaf897cd9eb5776c",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/e1788e82eb2e8c35385e8f634b72052b01859a1d/core/src/main/java/org/apache/struts2/util/TextProviderHelper.java",
                "deletions": 1,
                "filename": "core/src/main/java/org/apache/struts2/util/TextProviderHelper.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/util/TextProviderHelper.java?ref=e1788e82eb2e8c35385e8f634b72052b01859a1d",
                "patch": "@@ -94,7 +94,7 @@ public static String getText(String key, String defaultMessage, List<Object> arg\n                 } else {\n                 \tLOG.warn(\"Could not locate the message resource '\"+key+\"' as there is no TextProvider in the ValueStack.\");\n                 }\n-                if (msg.equals(defaultMessage)) {\n+                if (defaultMessage.equals(msg)) {\n                 \tLOG.warn(\"The default value expression '\"+defaultMessage+\"' was evaluated and did not match a property.  The literal value '\"+defaultMessage+\"' will be used.\");\n                 } else {\n                 \tLOG.warn(\"The default value expression '\"+defaultMessage+\"' evaluated to '\"+msg+\"'\");",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/e1788e82eb2e8c35385e8f634b72052b01859a1d/core/src/main/java/org/apache/struts2/util/TextProviderHelper.java"
            }
        ],
        "repo": "struts",
        "message": "WW-3839 solves problem with NPE when Log level is WARN\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@1364627 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/e1788e82eb2e8c35385e8f634b72052b01859a1d"
    },
    {
        "parent": "https://github.com/apache/struts/commit/660c8066e309560e846263d96369161c5939dd79",
        "bug_id": "struts_42",
        "file": [
            {
                "additions": 1,
                "sha": "c5293d797fdc81b71e79dfbe6da364990448c17a",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1b5a1e7c307cf89d13add686f38881ce508ea377/xwork-core/src/main/java/com/opensymphony/xwork2/validator/DefaultActionValidatorManager.java",
                "deletions": 1,
                "filename": "xwork-core/src/main/java/com/opensymphony/xwork2/validator/DefaultActionValidatorManager.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/main/java/com/opensymphony/xwork2/validator/DefaultActionValidatorManager.java?ref=1b5a1e7c307cf89d13add686f38881ce508ea377",
                "patch": "@@ -328,7 +328,7 @@ protected static String buildValidatorKey(Class clazz, String context) {\n     private List<ValidatorConfig> loadFile(String fileName, Class clazz, boolean checkFile) {\n         List<ValidatorConfig> retList = Collections.emptyList();\n         URL fileUrl = ClassLoaderUtil.getResource(fileName, clazz);\n-        if ((checkFile && fileManager.fileNeedsReloading(fileUrl.toString())) || !validatorFileCache.containsKey(fileName)) {\n+        if ((checkFile && fileUrl != null && fileManager.fileNeedsReloading(fileUrl.toString())) || !validatorFileCache.containsKey(fileName)) {\n             InputStream is = null;\n \n             try {",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/1b5a1e7c307cf89d13add686f38881ce508ea377/xwork-core/src/main/java/com/opensymphony/xwork2/validator/DefaultActionValidatorManager.java"
            },
            {
                "additions": 20,
                "sha": "7e8b2433d60145f1844326c0aa30ba0dfe6cf1bb",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1b5a1e7c307cf89d13add686f38881ce508ea377/xwork-core/src/test/java/com/opensymphony/xwork2/validator/DefaultActionValidatorManagerTest.java",
                "deletions": 0,
                "filename": "xwork-core/src/test/java/com/opensymphony/xwork2/validator/DefaultActionValidatorManagerTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/test/java/com/opensymphony/xwork2/validator/DefaultActionValidatorManagerTest.java?ref=1b5a1e7c307cf89d13add686f38881ce508ea377",
                "patch": "@@ -18,6 +18,7 @@\n import com.mockobjects.dynamic.C;\n import com.mockobjects.dynamic.Mock;\n import com.opensymphony.xwork2.ActionContext;\n+import com.opensymphony.xwork2.FileManagerFactory;\n import com.opensymphony.xwork2.SimpleAction;\n import com.opensymphony.xwork2.StubValueStack;\n import com.opensymphony.xwork2.TestBean;\n@@ -164,6 +165,25 @@ public void testSameAliasWithDifferentClass() {\n         mockValidatorFileParser.verify();\n     }\n \n+    /**\n+     * Test to verify WW-3850.\n+     *\n+     * @since 2.3.5\n+     */\n+    public void testBuildsValidatorsForClassError() {\n+        // for this test we need to have a file manager with reloadingConfigs to true\n+        container.getInstance(FileManagerFactory.class).getFileManager().setReloadingConfigs(\"true\");\n+        // no validator found, but no check on file since it is not in cache\n+        actionValidatorManager.getValidators(List.class, null);\n+        // this second call will try reload a not existing file\n+        // and causes a NPE (see WW-3850)\n+        try {\n+            actionValidatorManager.getValidators(List.class, null);\n+        } catch (Exception e) {\n+            fail(\"Exception occurred \" + e);\n+        }\n+    }\n+\n     /*\n     // TODO: this all need to be converted to real unit tests\n ",
                "changes": 20,
                "blob_url": "https://github.com/apache/struts/blob/1b5a1e7c307cf89d13add686f38881ce508ea377/xwork-core/src/test/java/com/opensymphony/xwork2/validator/DefaultActionValidatorManagerTest.java"
            }
        ],
        "repo": "struts",
        "message": "WW-3850 solves problem with NPE when ActionValidationManager is trying to load Object-validation.xml\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@1364079 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/1b5a1e7c307cf89d13add686f38881ce508ea377"
    },
    {
        "parent": "https://github.com/apache/struts/commit/248d0f58796bdc1195440a4dee734e99643a566b",
        "bug_id": "struts_43",
        "file": [
            {
                "additions": 6,
                "sha": "014084dd1b09b5c6248a64fac976eadabf1ce0e0",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/872a7b0b6d368494594ad535994809b3951c11e8/plugins/junit/pom.xml",
                "deletions": 1,
                "filename": "plugins/junit/pom.xml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/junit/pom.xml?ref=872a7b0b6d368494594ad535994809b3951c11e8",
                "patch": "@@ -55,7 +55,6 @@\n         <dependency>\n             <groupId>org.apache.struts</groupId>\n             <artifactId>struts2-spring-plugin</artifactId>\n-            <version>${project.version}</version>\n             <optional>true</optional>\n         </dependency>\n         <dependency>\n@@ -67,5 +66,11 @@\n             <groupId>junit</groupId>\n             <artifactId>junit</artifactId>\n         </dependency>\n+        <!-- Portlet -->\n+        <dependency>\n+            <groupId>javax.portlet</groupId>\n+            <artifactId>portlet-api</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n     </dependencies>\n </project>",
                "changes": 7,
                "blob_url": "https://github.com/apache/struts/blob/872a7b0b6d368494594ad535994809b3951c11e8/plugins/junit/pom.xml"
            },
            {
                "additions": 42,
                "sha": "fc31456bbbf0379e8518f5e9630b3c871b4b1c87",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/872a7b0b6d368494594ad535994809b3951c11e8/plugins/junit/src/main/java/org/apache/struts2/StrutsTestCase.java",
                "deletions": 12,
                "filename": "plugins/junit/src/main/java/org/apache/struts2/StrutsTestCase.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/junit/src/main/java/org/apache/struts2/StrutsTestCase.java?ref=872a7b0b6d368494594ad535994809b3951c11e8",
                "patch": "@@ -37,6 +37,7 @@\n import org.springframework.mock.web.MockHttpServletResponse;\n import org.springframework.mock.web.MockPageContext;\n import org.springframework.mock.web.MockServletContext;\n+import org.springframework.mock.web.portlet.MockPortletContext;\n \n import javax.servlet.ServletException;\n import javax.servlet.http.HttpServletRequest;\n@@ -46,7 +47,11 @@\n import java.util.Date;\n import java.util.HashMap;\n import java.util.Map;\n-import java.util.logging.*;\n+import java.util.logging.ConsoleHandler;\n+import java.util.logging.Formatter;\n+import java.util.logging.Level;\n+import java.util.logging.LogRecord;\n+import java.util.logging.Logger;\n \n /**\n  * Base test case for JUnit testing Struts.\n@@ -57,7 +62,7 @@\n     protected MockPageContext pageContext;\n     protected MockServletContext servletContext;\n     protected Map<String, String> dispatcherInitParams;\n-    \n+\n     protected DefaultResourceLoader resourceLoader = new DefaultResourceLoader();\n \n     static {\n@@ -109,10 +114,9 @@ protected String executeAction(String uri) throws ServletException, UnsupportedE\n         assertNotNull(mapping);\n         Dispatcher.getInstance().serviceAction(request, response, servletContext, mapping);\n \n-        if (response.getStatus() != HttpServletResponse.SC_OK)\n-            throw new ServletException(\"Error code [\" + response.getStatus() + \"], Error: [\"\n-                    + response.getErrorMessage() + \"]\");\n-\n+        if (response.getStatus() != HttpServletResponse.SC_OK) {\n+            throw new ServletException(\"Error code [\" + response.getStatus() + \"], Error: [\" + response.getErrorMessage() + \"]\");\n+        }\n         return response.getContentAsString();\n     }\n \n@@ -131,12 +135,9 @@ protected ActionProxy getActionProxy(String uri) {\n         ActionProxy proxy = config.getContainer().getInstance(ActionProxyFactory.class).createActionProxy(\n                 namespace, name, method, new HashMap<String, Object>(), true, false);\n \n-        ActionContext invocationContext = proxy.getInvocation().getInvocationContext();\n-        invocationContext.setParameters(new HashMap(request.getParameterMap()));\n-        // set the action context to the one used by the proxy\n-        ActionContext.setContext(invocationContext);\n+        initActionContext(proxy.getInvocation().getInvocationContext());\n \n-        // this is normaly done in onSetUp(), but we are using Struts internal\n+        // this is normally done in onSetUp(), but we are using Struts internal\n         // objects (proxy and action invocation)\n         // so we have to hack around so it works\n         ServletActionContext.setServletContext(servletContext);\n@@ -146,6 +147,29 @@ protected ActionProxy getActionProxy(String uri) {\n         return proxy;\n     }\n \n+    private void initActionContext(ActionContext actionContext) {\n+        actionContext.setParameters(new HashMap(request.getParameterMap()));\n+\n+        initMockPortletContext(actionContext);\n+        applyAdditionalParams(actionContext);\n+\n+        // set the action context to the one used by the proxy\n+        ActionContext.setContext(actionContext);\n+    }\n+\n+    private void initMockPortletContext(ActionContext actionContext) {\n+        actionContext.put(StrutsStatics.STRUTS_PORTLET_CONTEXT, new MockPortletContext());\n+    }\n+\n+    /**\n+     * Can be overwritten in subclass to provide additional context's params and settings used during action invocation\n+     *\n+     * @param context current {@link ActionContext}\n+     */\n+    protected void applyAdditionalParams(ActionContext context) {\n+        // empty be default\n+    }\n+\n     /**\n      * Finds an ActionMapping for a given request\n      */\n@@ -179,10 +203,16 @@ protected void setUp() throws Exception {\n         super.setUp();\n         initServletMockObjects();\n         setupBeforeInitDispatcher();\n-        initDispatcher(dispatcherInitParams);\n+        Dispatcher dispatcher = initDispatcher(dispatcherInitParams);\n+        setupAfterInitDispatcher(dispatcher);\n     }\n \n     protected void setupBeforeInitDispatcher() throws Exception {\n+        // empty by default\n+    }\n+\n+    protected void setupAfterInitDispatcher(Dispatcher dispatcher) {\n+        // empty by default\n     }\n \n     protected void initServletMockObjects() {",
                "changes": 54,
                "blob_url": "https://github.com/apache/struts/blob/872a7b0b6d368494594ad535994809b3951c11e8/plugins/junit/src/main/java/org/apache/struts2/StrutsTestCase.java"
            },
            {
                "additions": 38,
                "sha": "11373793cf938847dc45751cb9fad980915f7b9c",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/872a7b0b6d368494594ad535994809b3951c11e8/plugins/junit/src/test/java/org/apache/struts2/StrutsTestCaseTest.java",
                "deletions": 0,
                "filename": "plugins/junit/src/test/java/org/apache/struts2/StrutsTestCaseTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/junit/src/test/java/org/apache/struts2/StrutsTestCaseTest.java?ref=872a7b0b6d368494594ad535994809b3951c11e8",
                "patch": "@@ -21,13 +21,17 @@\n package org.apache.struts2;\r\n \r\n import com.opensymphony.xwork2.Action;\r\n+import com.opensymphony.xwork2.ActionContext;\r\n import com.opensymphony.xwork2.ActionProxy;\r\n import org.apache.struts2.dispatcher.mapper.ActionMapping;\r\n+import org.junit.Test;\r\n \r\n+import javax.portlet.PortletContext;\r\n import javax.servlet.ServletException;\r\n import java.io.UnsupportedEncodingException;\r\n \r\n public class StrutsTestCaseTest extends StrutsSpringTestCase {\r\n+\r\n     public void testGetActionMapping() {\r\n         ActionMapping mapping = getActionMapping(\"/test/testAction.action\");\r\n         assertNotNull(mapping);\r\n@@ -61,4 +65,38 @@ public void testGetValueFromStack() throws ServletException, UnsupportedEncoding\n         String name = (String) findValueAfterExecute(\"name\");\r\n         assertEquals(\"FD\", name);\r\n     }\r\n+\r\n+    @Test\r\n+    public void shouldPortletContextBeAvailable() throws Exception {\r\n+        // given\r\n+        assertNull(ActionContext.getContext().get(StrutsStatics.STRUTS_PORTLET_CONTEXT));\r\n+\r\n+        // when\r\n+        String output = executeAction(\"/test/testAction.action\");\r\n+        assertEquals(\"Hello\", output);\r\n+\r\n+        // then\r\n+        Object portletContext = ActionContext.getContext().get(StrutsStatics.STRUTS_PORTLET_CONTEXT);\r\n+        assertNotNull(portletContext);\r\n+        assertTrue(portletContext instanceof PortletContext);\r\n+    }\r\n+\r\n+    @Test\r\n+    public void shouldAdditionalContextParamsBeAvailable() throws Exception {\r\n+        // given\r\n+        String key = \"my-param\";\r\n+        assertNull(ActionContext.getContext().get(key));\r\n+\r\n+        // when\r\n+        String output = executeAction(\"/test/testAction.action\");\r\n+        assertEquals(\"Hello\", output);\r\n+\r\n+        // then\r\n+        assertNotNull(ActionContext.getContext().get(key));\r\n+    }\r\n+\r\n+    @Override\r\n+    protected void applyAdditionalParams(ActionContext context) {\r\n+        context.put(\"my-param\", new Object());\r\n+    }\r\n }\r",
                "changes": 38,
                "blob_url": "https://github.com/apache/struts/blob/872a7b0b6d368494594ad535994809b3951c11e8/plugins/junit/src/test/java/org/apache/struts2/StrutsTestCaseTest.java"
            },
            {
                "additions": 1,
                "sha": "68f2f25a19693890704f42ee6aa1b9a3cfceb0cd",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/872a7b0b6d368494594ad535994809b3951c11e8/plugins/portlet/pom.xml",
                "deletions": 2,
                "filename": "plugins/portlet/pom.xml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/portlet/pom.xml?ref=872a7b0b6d368494594ad535994809b3951c11e8",
                "patch": "@@ -18,9 +18,8 @@\n \n     <dependencies>\n         <dependency>\n-            <groupId>${project.groupId}</groupId>\n+            <groupId>org.apache.struts</groupId>\n             <artifactId>struts2-junit-plugin</artifactId>\n-            <version>${project.version}</version>\n             <scope>test</scope>\n         </dependency>\n ",
                "changes": 3,
                "blob_url": "https://github.com/apache/struts/blob/872a7b0b6d368494594ad535994809b3951c11e8/plugins/portlet/pom.xml"
            },
            {
                "additions": 5,
                "sha": "3b195c9ad9f13bbf83ceba30603698e19fc2af25",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/872a7b0b6d368494594ad535994809b3951c11e8/pom.xml",
                "deletions": 0,
                "filename": "pom.xml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/pom.xml?ref=872a7b0b6d368494594ad535994809b3951c11e8",
                "patch": "@@ -352,6 +352,11 @@\n                 <artifactId>struts2-dwr-plugin</artifactId>\n                 <version>${project.version}</version>\n             </dependency>\n+            <dependency>\n+                <groupId>org.apache.struts</groupId>\n+                <artifactId>struts2-junit-plugin</artifactId>\n+                <version>${project.version}</version>\n+            </dependency>\n \n             <dependency>\n                 <groupId>org.freemarker</groupId>",
                "changes": 5,
                "blob_url": "https://github.com/apache/struts/blob/872a7b0b6d368494594ad535994809b3951c11e8/pom.xml"
            }
        ],
        "repo": "struts",
        "message": "WW-3733 - adds missing PortletContext to ActionContext to avoid NPE during PortletResult initialisation\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@1226265 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/872a7b0b6d368494594ad535994809b3951c11e8"
    },
    {
        "parent": "https://github.com/apache/struts/commit/6854397de29a86acdb279b022d00cd5a6bb913d4",
        "bug_id": "struts_44",
        "file": [
            {
                "additions": 19,
                "sha": "dfb0c1855c47e08c2eee7cfe5f18b9a97622fa08",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/b836f6225cda70d44c99e1128019ee8b891d8f4a/xwork-core/src/main/java/com/opensymphony/xwork2/util/classloader/ResourceStoreClassLoader.java",
                "deletions": 0,
                "filename": "xwork-core/src/main/java/com/opensymphony/xwork2/util/classloader/ResourceStoreClassLoader.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/xwork-core/src/main/java/com/opensymphony/xwork2/util/classloader/ResourceStoreClassLoader.java?ref=b836f6225cda70d44c99e1128019ee8b891d8f4a",
                "patch": "@@ -41,6 +41,7 @@ private Class fastFindClass(final String name) {\n             for (final ResourceStore store : stores) {\n                 final byte[] clazzBytes = store.read(fileName);\n                 if (clazzBytes != null) {\n+                    definePackage(name);\n                     return defineClass(name, clazzBytes, 0, clazzBytes.length);\n                 }\n             }\n@@ -80,4 +81,22 @@ protected Class findClass(final String name) throws ClassNotFoundException {\n         }\n         return clazz;\n     }\n+\n+    /**\n+     * Define the package information associated with a class.\n+     *\n+     * @param className the class name of for which the package information\n+     *                  is to be determined.\n+     */\n+    protected void definePackage(String className){\n+        int classIndex = className.lastIndexOf('.');\n+        if (classIndex == -1) {\n+            return;\n+        }\n+        String packageName = className.substring(0, classIndex);\n+        if (getPackage(packageName) != null) {\n+            return;\n+        }\n+        definePackage(packageName, null, null, null, null, null, null, null);\n+    }\n }",
                "changes": 19,
                "blob_url": "https://github.com/apache/struts/blob/b836f6225cda70d44c99e1128019ee8b891d8f4a/xwork-core/src/main/java/com/opensymphony/xwork2/util/classloader/ResourceStoreClassLoader.java"
            }
        ],
        "repo": "struts",
        "message": "Applied patch to solve WW-3486 - NPE when struts.convention.classes.reload is set to true\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@1026245 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/b836f6225cda70d44c99e1128019ee8b891d8f4a"
    },
    {
        "parent": "https://github.com/apache/struts/commit/353c2f203325c906d149799a11f36a82191c9e58",
        "bug_id": "struts_45",
        "file": [
            {
                "additions": 1,
                "sha": "2952d8f4685bacec2ed0d00de2f9a0d2e506cc33",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/9f6c296d4262796bac8be0013e09dfd4dfb501e9/core/src/main/java/org/apache/struts2/util/ContainUtil.java",
                "deletions": 1,
                "filename": "core/src/main/java/org/apache/struts2/util/ContainUtil.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/util/ContainUtil.java?ref=9f6c296d4262796bac8be0013e09dfd4dfb501e9",
                "patch": "@@ -93,7 +93,7 @@ public static boolean contains(Object obj1, Object obj2) {\n                 Object value = null;\n                 value = Array.get(obj1, i);\n \n-                if (value.equals(obj2)) {\n+                if (obj2.equals(value)) {\n                     //log.debug(\"obj1 is an array and contains obj2\");\n                     return true;\n                 }",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/9f6c296d4262796bac8be0013e09dfd4dfb501e9/core/src/main/java/org/apache/struts2/util/ContainUtil.java"
            },
            {
                "additions": 4,
                "sha": "7e5d16208355193d547a7060dcd4df821637c934",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/9f6c296d4262796bac8be0013e09dfd4dfb501e9/core/src/test/java/org/apache/struts2/util/ContainUtilTest.java",
                "deletions": 0,
                "filename": "core/src/test/java/org/apache/struts2/util/ContainUtilTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/org/apache/struts2/util/ContainUtilTest.java?ref=9f6c296d4262796bac8be0013e09dfd4dfb501e9",
                "patch": "@@ -42,6 +42,10 @@ public void testNull() throws Exception {\n         assertFalse(ContainUtil.contains(null, new Object()));\n     }\n \n+    public void testNullInAray()throws Exception {\n+        assertTrue(ContainUtil.contains(new String[] {\"a\", null, \"b\"}, \"b\"));\n+    }\n+\n     public void testSimpleList() throws Exception {\n         List<String> l = new ArrayList<String>();\n         l.add(\"one\");",
                "changes": 4,
                "blob_url": "https://github.com/apache/struts/blob/9f6c296d4262796bac8be0013e09dfd4dfb501e9/core/src/test/java/org/apache/struts2/util/ContainUtilTest.java"
            }
        ],
        "repo": "struts",
        "message": "WW-3166 Prevent NPE when there is a null element in an array\n\nthanks to Zoran Avtarovski for the patch\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@802937 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/9f6c296d4262796bac8be0013e09dfd4dfb501e9"
    },
    {
        "parent": "https://github.com/apache/struts/commit/eae2fc668a26d374306ec7e074cb6db305ed26b1",
        "bug_id": "struts_46",
        "file": [
            {
                "additions": 3,
                "sha": "faa71cc26f7d6826b0bd40fa654a8a61a6bf5872",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/eca561c6747ab207f8b0c8cefb611590824511ac/core/src/main/java/org/apache/struts2/components/UrlRenderer.java",
                "deletions": 0,
                "filename": "core/src/main/java/org/apache/struts2/components/UrlRenderer.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/components/UrlRenderer.java?ref=eca561c6747ab207f8b0c8cefb611590824511ac",
                "patch": "@@ -21,6 +21,7 @@\n \n package org.apache.struts2.components;\n \n+import org.apache.struts2.dispatcher.mapper.ActionMapper;\n import java.io.Writer;\n \n /**\n@@ -49,4 +50,6 @@\n \t */\n \tvoid renderFormUrl(Form formComponent);\n \n+      void setActionMapper(ActionMapper actionMapper);\n+\n }",
                "changes": 3,
                "blob_url": "https://github.com/apache/struts/blob/eca561c6747ab207f8b0c8cefb611590824511ac/core/src/main/java/org/apache/struts2/components/UrlRenderer.java"
            },
            {
                "additions": 7,
                "sha": "ccc94801edb2bcf21b8cb555ce67f46e98c59c7a",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/eca561c6747ab207f8b0c8cefb611590824511ac/plugins/portlet/src/main/java/org/apache/struts2/components/PortletUrlRenderer.java",
                "deletions": 0,
                "filename": "plugins/portlet/src/main/java/org/apache/struts2/components/PortletUrlRenderer.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/portlet/src/main/java/org/apache/struts2/components/PortletUrlRenderer.java?ref=eca561c6747ab207f8b0c8cefb611590824511ac",
                "patch": "@@ -24,13 +24,15 @@\n import java.io.IOException;\n import java.io.Writer;\n \n+import org.apache.struts2.dispatcher.mapper.ActionMapper; \n import org.apache.struts2.StrutsException;\n import org.apache.struts2.portlet.context.PortletActionContext;\n import org.apache.struts2.portlet.util.PortletUrlHelper;\n import org.apache.commons.lang.xwork.StringUtils;\n \n import com.opensymphony.xwork2.ActionContext;\n import com.opensymphony.xwork2.ActionInvocation;\n+import com.opensymphony.xwork2.inject.Inject;\n \n /**\n  * Implementation of the {@link UrlRenderer} interface that renders URLs for portlet environments.\n@@ -48,6 +50,11 @@\n \tpublic PortletUrlRenderer() {\n \t\tthis.servletRenderer = new ServletUrlRenderer();\n \t}\n+\n+\t@Inject\n+\tpublic void setActionMapper(ActionMapper actionMapper) {\n+\t\tservletRenderer.setActionMapper(actionMapper);\n+\t}\n \t\n \t/**\n \t * {@inheritDoc}",
                "changes": 7,
                "blob_url": "https://github.com/apache/struts/blob/eca561c6747ab207f8b0c8cefb611590824511ac/plugins/portlet/src/main/java/org/apache/struts2/components/PortletUrlRenderer.java"
            }
        ],
        "repo": "struts",
        "message": "WW-3164\n\nNeed to inject ActionMapper in PortletUrlRenderer to avoid NPE when passing through to ServletUrlRenderer.\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@788633 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/eca561c6747ab207f8b0c8cefb611590824511ac"
    },
    {
        "parent": "https://github.com/apache/struts/commit/ee1b9aac9b0c0f9e5cf405bbd395cfdfb0f6a26c",
        "bug_id": "struts_47",
        "file": [
            {
                "additions": 4,
                "sha": "11926454a0b3c5ad5e3dd72e14dbe061f7d24070",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1b19830293211a03e523c61c41176c506fabe4f9/core/src/main/java/org/apache/struts2/interceptor/TokenSessionStoreInterceptor.java",
                "deletions": 4,
                "filename": "core/src/main/java/org/apache/struts2/interceptor/TokenSessionStoreInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/interceptor/TokenSessionStoreInterceptor.java?ref=1b19830293211a03e523c61c41176c506fabe4f9",
                "patch": "@@ -116,11 +116,11 @@ protected String handleInvalidToken(ActionInvocation invocation) throws Exceptio\n         String tokenName = TokenHelper.getTokenName();\n         String token = TokenHelper.getToken(tokenName);\n \n-        Map params = ac.getParameters();\n-        params.remove(tokenName);\n-        params.remove(TokenHelper.TOKEN_NAME_FIELD);\n-\n         if ((tokenName != null) && (token != null)) {\n+            Map params = ac.getParameters();\n+            params.remove(tokenName);\n+            params.remove(TokenHelper.TOKEN_NAME_FIELD);\n+\n             ActionInvocation savedInvocation = InvocationSessionStore.loadInvocation(tokenName, token);\n \n             if (savedInvocation != null) {",
                "changes": 8,
                "blob_url": "https://github.com/apache/struts/blob/1b19830293211a03e523c61c41176c506fabe4f9/core/src/main/java/org/apache/struts2/interceptor/TokenSessionStoreInterceptor.java"
            },
            {
                "additions": 4,
                "sha": "02cdc34ce51281fbded13f0c9c42a00e0f0ee3d3",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1b19830293211a03e523c61c41176c506fabe4f9/core/src/test/java/org/apache/struts2/interceptor/TokenInterceptorTest.java",
                "deletions": 3,
                "filename": "core/src/test/java/org/apache/struts2/interceptor/TokenInterceptorTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/org/apache/struts2/interceptor/TokenInterceptorTest.java?ref=1b19830293211a03e523c61c41176c506fabe4f9",
                "patch": "@@ -23,6 +23,7 @@\n \n import java.util.HashMap;\n import java.util.Map;\n+import java.util.TreeMap;\n \n import javax.servlet.http.HttpServletRequest;\n import javax.servlet.http.HttpSession;\n@@ -110,9 +111,9 @@ protected void setToken(String token) {\n     protected void setUp() throws Exception {\n         loadConfigurationProviders(new TestConfigurationProvider());\n \n-        session = new HashMap();\n-        params = new HashMap();\n-        extraContext = new HashMap();\n+        session = new TreeMap();\n+        params = new TreeMap();\n+        extraContext = new TreeMap();\n         extraContext.put(ActionContext.SESSION, session);\n         extraContext.put(ActionContext.PARAMETERS, params);\n ",
                "changes": 7,
                "blob_url": "https://github.com/apache/struts/blob/1b19830293211a03e523c61c41176c506fabe4f9/core/src/test/java/org/apache/struts2/interceptor/TokenInterceptorTest.java"
            },
            {
                "additions": 6,
                "sha": "535298f3ebca8252a25f5d0d6da4afcad35fc9cc",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/1b19830293211a03e523c61c41176c506fabe4f9/core/src/test/java/org/apache/struts2/interceptor/TokenSessionStoreInterceptorTest.java",
                "deletions": 0,
                "filename": "core/src/test/java/org/apache/struts2/interceptor/TokenSessionStoreInterceptorTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/org/apache/struts2/interceptor/TokenSessionStoreInterceptorTest.java?ref=1b19830293211a03e523c61c41176c506fabe4f9",
                "patch": "@@ -44,6 +44,12 @@ public void testCAllExecute2Times() throws Exception {\n         assertEquals(Action.SUCCESS, proxy2.execute());\n     }\n \n+    public void testNullTokenName() throws Exception {\n+        ActionProxy proxy = buildProxy(getActionName());\n+        setToken((String)null);\n+        proxy.execute();\n+    }\n+\n     protected String getActionName() {\n         return TestConfigurationProvider.TOKEN_SESSION_ACTION_NAME;\n     }",
                "changes": 6,
                "blob_url": "https://github.com/apache/struts/blob/1b19830293211a03e523c61c41176c506fabe4f9/core/src/test/java/org/apache/struts2/interceptor/TokenSessionStoreInterceptorTest.java"
            }
        ],
        "repo": "struts",
        "message": "More NPE possible in TokenSessionStoreInterceptor, updated unit tests again WW-3150\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@781838 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/1b19830293211a03e523c61c41176c506fabe4f9"
    },
    {
        "parent": "https://github.com/apache/struts/commit/bc6d4bb804dd4b14c9b5562feee4464e3d1b5bff",
        "bug_id": "struts_48",
        "file": [
            {
                "additions": 6,
                "sha": "776d17e328d77d2361ee47a345d14919c0a87baa",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/ee1b9aac9b0c0f9e5cf405bbd395cfdfb0f6a26c/core/src/test/java/org/apache/struts2/util/TokenHelperTest.java",
                "deletions": 2,
                "filename": "core/src/test/java/org/apache/struts2/util/TokenHelperTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/test/java/org/apache/struts2/util/TokenHelperTest.java?ref=ee1b9aac9b0c0f9e5cf405bbd395cfdfb0f6a26c",
                "patch": "@@ -23,6 +23,7 @@\n \n import java.util.HashMap;\n import java.util.Map;\n+import java.util.TreeMap;\n \n import junit.framework.TestCase;\n \n@@ -61,12 +62,15 @@ public void testValidToken() {\n     public void testGetTokenDoesNotNpe() {\n         String token = TokenHelper.getToken(null);\n         assertTrue(token == null);\n+\n+        String token2 = TokenHelper.getToken(\"\");\n+        assertTrue(token2 == null);\n     }\n \n     protected void setUp() throws Exception {\n         session = new HashMap();\n-        Map params = new HashMap();\n-        Map ctxMap = new HashMap();\n+        Map params = new TreeMap();\n+        Map ctxMap = new TreeMap();\n         ctxMap.put(ActionContext.SESSION, session);\n         ctxMap.put(ActionContext.PARAMETERS, params);\n         ActionContext ctx = new ActionContext(ctxMap);",
                "changes": 8,
                "blob_url": "https://github.com/apache/struts/blob/ee1b9aac9b0c0f9e5cf405bbd395cfdfb0f6a26c/core/src/test/java/org/apache/struts2/util/TokenHelperTest.java"
            }
        ],
        "repo": "struts",
        "message": "making unit test match environment that caused NPE in WW-3150\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@781805 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/ee1b9aac9b0c0f9e5cf405bbd395cfdfb0f6a26c"
    },
    {
        "parent": "https://github.com/apache/struts/commit/81f71427240cf61245498572cd115ead1d512905",
        "bug_id": "struts_49",
        "file": [
            {
                "additions": 1,
                "sha": "bf2e12976e0929849be87492cb2cb8a8ca406642",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/abbe9ac9f03a98b1428a3b57a3e07777887f02af/apps/showcase/src/main/webapp/WEB-INF/decorators/main.jsp",
                "deletions": 0,
                "filename": "apps/showcase/src/main/webapp/WEB-INF/decorators/main.jsp",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/apps/showcase/src/main/webapp/WEB-INF/decorators/main.jsp?ref=abbe9ac9f03a98b1428a3b57a3e07777887f02af",
                "patch": "@@ -95,6 +95,7 @@\n \t</div>\n     <div id=\"footer\" class=\"clearfix\">\n         <p>Copyright &copy; 2003-<s:property value=\"#dateAction.now.year + 1900\" /> The Apache Software Foundation.</p>\n+        <s:hidden name=\"project-name\" value=\"Struts 2\" />\n     </div><!-- end footer -->\n     <p/>\n ",
                "changes": 1,
                "blob_url": "https://github.com/apache/struts/blob/abbe9ac9f03a98b1428a3b57a3e07777887f02af/apps/showcase/src/main/webapp/WEB-INF/decorators/main.jsp"
            },
            {
                "additions": 3,
                "sha": "a26997fbda9f3323bc831d7c8b5810a7a6000b9e",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/abbe9ac9f03a98b1428a3b57a3e07777887f02af/core/src/main/java/org/apache/struts2/dispatcher/Dispatcher.java",
                "deletions": 2,
                "filename": "core/src/main/java/org/apache/struts2/dispatcher/Dispatcher.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/dispatcher/Dispatcher.java?ref=abbe9ac9f03a98b1428a3b57a3e07777887f02af",
                "patch": "@@ -436,7 +436,8 @@ public void serviceAction(HttpServletRequest request, HttpServletResponse respon\n \n         // If there was a previous value stack, then create a new copy and pass it in to be used by the new Action\n         ValueStack stack = (ValueStack) request.getAttribute(ServletActionContext.STRUTS_VALUESTACK_KEY);\n-        if (stack == null) {\n+        boolean nullStack = stack == null;\n+        if (nullStack) {\n             ActionContext ctx = ActionContext.getContext();\n             if (ctx != null) {\n                 stack = ctx.getValueStack();\n@@ -468,7 +469,7 @@ public void serviceAction(HttpServletRequest request, HttpServletResponse respon\n             }\n \n             // If there was a previous value stack then set it back onto the request\n-            if (stack != null) {\n+            if (!nullStack) {\n                 request.setAttribute(ServletActionContext.STRUTS_VALUESTACK_KEY, stack);\n             }\n         } catch (ConfigurationException e) {",
                "changes": 5,
                "blob_url": "https://github.com/apache/struts/blob/abbe9ac9f03a98b1428a3b57a3e07777887f02af/core/src/main/java/org/apache/struts2/dispatcher/Dispatcher.java"
            }
        ],
        "repo": "struts",
        "message": "WW-2937 Tags fail with NPE in sitemesh decorators, using legacy filters\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@729675 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/abbe9ac9f03a98b1428a3b57a3e07777887f02af"
    },
    {
        "parent": "https://github.com/apache/struts/commit/ff4c8ede2456e3d051b3e22884c124e0d42a1ef5",
        "bug_id": "struts_50",
        "file": [
            {
                "additions": 29,
                "sha": "646842bb9951bf53893f67b7180bf56c9ee40e1c",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/848b6f03ff0df96869c61d3aa510a9c3f0ae7954/plugins/jsf/src/main/java/org/apache/struts2/jsf/StrutsNavigationHandler.java",
                "deletions": 21,
                "filename": "plugins/jsf/src/main/java/org/apache/struts2/jsf/StrutsNavigationHandler.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/jsf/src/main/java/org/apache/struts2/jsf/StrutsNavigationHandler.java?ref=848b6f03ff0df96869c61d3aa510a9c3f0ae7954",
                "patch": "@@ -59,28 +59,36 @@ public StrutsNavigationHandler(NavigationHandler handler) {\n     public void handleNavigation(FacesContext facesContext, String fromAction, String outcome) {\n         ActionContext ctx = ActionContext.getContext();\n         if (outcome != null) {\n-            ActionConfig config = ctx.getActionInvocation().getProxy().getConfig();\n-            Map results = config.getResults();\n-\n-            ResultConfig resultConfig = null;\n-\n-            synchronized (config) {\n-                try {\n-                    resultConfig = (ResultConfig) results.get(outcome);\n-                } catch (NullPointerException e) {\n-                }\n-                if (resultConfig == null) {\n-                    // If no result is found for the given resultCode, try to get a wildcard '*' match.\n-                    resultConfig = (ResultConfig) results.get(\"*\");\n-                }\n-            }\n-            if (resultConfig != null) {\n-                ctx.getActionInvocation().setResultCode(outcome);\n-            } else {\n-                // Failing over to parent handler\n-                parent.handleNavigation(facesContext, fromAction, outcome);\n-            }\n+        \tif (ctx == null && ctx.getActionInvocation() == null) {\n+        \t\tdelegateToParentNavigation(facesContext, fromAction, outcome);\n+        \t} else {\n+\t            ActionConfig config = ctx.getActionInvocation().getProxy().getConfig();\n+\t            Map results = config.getResults();\n+\t\n+\t            ResultConfig resultConfig = null;\n+\t\n+\t            synchronized (config) {\n+\t                try {\n+\t                    resultConfig = (ResultConfig) results.get(outcome);\n+\t                } catch (NullPointerException e) {\n+\t                }\n+\t                if (resultConfig == null) {\n+\t                    // If no result is found for the given resultCode, try to get a wildcard '*' match.\n+\t                    resultConfig = (ResultConfig) results.get(\"*\");\n+\t                }\n+\t            }\n+\t            if (resultConfig != null) {\n+\t                ctx.getActionInvocation().setResultCode(outcome);\n+\t            } else {\n+\t                delegateToParentNavigation(facesContext, fromAction, outcome);\n+\t            }\n+        \t}\n         }\n     }\n \n+\tprivate void delegateToParentNavigation(FacesContext facesContext, String fromAction, String outcome) {\n+\t\t// Failing over to parent handler\n+\t\tparent.handleNavigation(facesContext, fromAction, outcome);\n+\t}\n+\n }",
                "changes": 50,
                "blob_url": "https://github.com/apache/struts/blob/848b6f03ff0df96869c61d3aa510a9c3f0ae7954/plugins/jsf/src/main/java/org/apache/struts2/jsf/StrutsNavigationHandler.java"
            }
        ],
        "repo": "struts",
        "message": "Fixing NPE for navigations that don't involve a Struts 2 action\nWW-2572\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@649812 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/848b6f03ff0df96869c61d3aa510a9c3f0ae7954"
    },
    {
        "parent": "https://github.com/apache/struts/commit/588dfb56f73517be4f2ba5611f289ae142fdf3b6",
        "bug_id": "struts_51",
        "file": [
            {
                "additions": 3,
                "sha": "04095b30e45b7c16ab91611c384b663abfcb558d",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/7bf30eacb34b311ce4437bd1546ef076ea212e66/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/AbstractRemoteBean.java",
                "deletions": 1,
                "filename": "plugins/dojo/src/main/java/org/apache/struts2/dojo/components/AbstractRemoteBean.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/AbstractRemoteBean.java?ref=7bf30eacb34b311ce4437bd1546ef076ea212e66",
                "patch": "@@ -109,8 +109,10 @@ public void evaluateExtraParams() {\n             addParameter(\"parseContent\", findValue(parseContent, Boolean.class));\n         else\n             addParameter(\"parseContent\", true);\n+\n+        Boolean parseContent = (Boolean)stack.getContext().get(Head.PARSE_CONTENT);\n+        boolean generateId = (parseContent != null ? !parseContent : false);\n         \n-        boolean generateId = !(Boolean)stack.getContext().get(Head.PARSE_CONTENT);\n         addParameter(\"pushId\", generateId);\n         if ((this.id == null || this.id.length() == 0) && generateId) {\n             // resolves Math.abs(Integer.MIN_VALUE) issue reported by FindBugs ",
                "changes": 4,
                "blob_url": "https://github.com/apache/struts/blob/7bf30eacb34b311ce4437bd1546ef076ea212e66/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/AbstractRemoteBean.java"
            }
        ],
        "repo": "struts",
        "message": "Fix NPE when PARSE_CONTENT parameter not in context\nWW-2398\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@628302 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/7bf30eacb34b311ce4437bd1546ef076ea212e66"
    },
    {
        "parent": "https://github.com/apache/struts/commit/f5a88391e19eb3055ad650db72c7acac3615ef1b",
        "bug_id": "struts_52",
        "file": [
            {
                "additions": 3,
                "sha": "961720f6272b81991f7a651fb9bd0ffd7dc60b25",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/b1546d7382039d1b0bb46e5f023347a4fdc75e79/core/src/main/java/org/apache/struts2/interceptor/FileUploadInterceptor.java",
                "deletions": 2,
                "filename": "core/src/main/java/org/apache/struts2/interceptor/FileUploadInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/interceptor/FileUploadInterceptor.java?ref=b1546d7382039d1b0bb46e5f023347a4fdc75e79",
                "patch": "@@ -274,8 +274,9 @@ public String intercept(ActionInvocation invocation) throws Exception {\n             File[] file = multiWrapper.getFiles(inputValue);\n             for (int index = 0; index < file.length; index++) {\n                 File currentFile = file[index];\n-                LOG.info(getTextMessage(\"struts.messages.removing.file\", new Object[]{inputValue, currentFile}, ActionContext.getContext().getLocale()));\n-\n+                if(LOG.isInfoEnabled()) {\n+                \tLOG.info(getTextMessage(\"struts.messages.removing.file\", new Object[]{inputValue, currentFile}, ActionContext.getContext().getLocale()));\n+                }\n                 if ((currentFile != null) && currentFile.isFile()) {\n                     currentFile.delete();\n                 }",
                "changes": 5,
                "blob_url": "https://github.com/apache/struts/blob/b1546d7382039d1b0bb46e5f023347a4fdc75e79/core/src/main/java/org/apache/struts2/interceptor/FileUploadInterceptor.java"
            }
        ],
        "repo": "struts",
        "message": "WW-2240 Temporary workaround for NPE problems when doing info logging. Patch by Benjamin McCann\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@615436 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/b1546d7382039d1b0bb46e5f023347a4fdc75e79"
    },
    {
        "parent": "https://github.com/apache/struts/commit/4a55d03e9a88ca0326a9308cfdf1b51b5a51d199",
        "bug_id": "struts_53",
        "file": [
            {
                "additions": 7,
                "sha": "278017765d1b86d5452696cbc86c87758592583e",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/8d4d13147d673ce80059c4586d3e1817eb8e4264/core/src/main/java/org/apache/struts2/components/OptGroup.java",
                "deletions": 0,
                "filename": "core/src/main/java/org/apache/struts2/components/OptGroup.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/components/OptGroup.java?ref=8d4d13147d673ce80059c4586d3e1817eb8e4264",
                "patch": "@@ -32,6 +32,8 @@\n import org.apache.struts2.views.annotations.StrutsTag;\n import org.apache.struts2.views.annotations.StrutsTagAttribute;\n \n+import com.opensymphony.xwork2.inject.Container;\n+import com.opensymphony.xwork2.inject.Inject;\n import com.opensymphony.xwork2.util.ValueStack;\n \n /**\n@@ -90,6 +92,11 @@ protected String getDefaultTemplate() {\n             }\n         };\n     }\n+    \n+    @Inject\n+    public void setContainer(Container container) {\n+        container.inject(internalUiBean);\n+    }\n \n     public boolean end(Writer writer, String body) {\n         Select select = (Select) findAncestor(Select.class);",
                "changes": 7,
                "blob_url": "https://github.com/apache/struts/blob/8d4d13147d673ce80059c4586d3e1817eb8e4264/core/src/main/java/org/apache/struts2/components/OptGroup.java"
            },
            {
                "additions": 1,
                "sha": "e89affa6bd81ab78f1f91ec2412c5c8a93b5cfa5",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/8d4d13147d673ce80059c4586d3e1817eb8e4264/core/src/main/java/org/apache/struts2/dispatcher/ServletRedirectResult.java",
                "deletions": 1,
                "filename": "core/src/main/java/org/apache/struts2/dispatcher/ServletRedirectResult.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/dispatcher/ServletRedirectResult.java?ref=8d4d13147d673ce80059c4586d3e1817eb8e4264",
                "patch": "@@ -85,7 +85,7 @@\n \n     protected boolean prependServletContext = true;\n \n-    private ActionMapper actionMapper;\n+    protected ActionMapper actionMapper;\n \n     public ServletRedirectResult() {\n         super();",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/8d4d13147d673ce80059c4586d3e1817eb8e4264/core/src/main/java/org/apache/struts2/dispatcher/ServletRedirectResult.java"
            }
        ],
        "repo": "struts",
        "message": "Fixed optgroup throwing NPE, added file missing from commit fixing servlet action redirect\nWW-1670 WW-1662\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@501746 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/8d4d13147d673ce80059c4586d3e1817eb8e4264"
    },
    {
        "parent": "https://github.com/apache/struts/commit/02424af910b1bfa291bf6b85deb6cfbac7ae4ae8",
        "bug_id": "struts_54",
        "file": [
            {
                "additions": 7,
                "sha": "cb8501ce919aff933e7bfdb3ddb1e0c37c09420a",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/9ed7fce11aca24c1f951a49cec9599ba5de7bd91/core/src/main/java/org/apache/struts2/dispatcher/ServletRedirectResult.java",
                "deletions": 2,
                "filename": "core/src/main/java/org/apache/struts2/dispatcher/ServletRedirectResult.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/dispatcher/ServletRedirectResult.java?ref=9ed7fce11aca24c1f951a49cec9599ba5de7bd91",
                "patch": "@@ -27,6 +27,7 @@\n import org.apache.commons.logging.LogFactory;\n import org.apache.struts2.ServletActionContext;\n import org.apache.struts2.dispatcher.mapper.ActionMapper;\n+import org.apache.struts2.dispatcher.mapper.ActionMapping;\n \n import com.opensymphony.xwork2.ActionContext;\n import com.opensymphony.xwork2.ActionInvocation;\n@@ -123,8 +124,12 @@ protected void doExecute(String finalLocation, ActionInvocation invocation) thro\n \n         if (isPathUrl(finalLocation)) {\n             if (!finalLocation.startsWith(\"/\")) {\n-                String namespace = actionMapper.getMapping(\n-                        request, Dispatcher.getInstance().getConfigurationManager()).getNamespace();\n+                ActionMapping mapping = actionMapper.getMapping(\n+                        request, Dispatcher.getInstance().getConfigurationManager()); \n+                String namespace = null;\n+                if (mapping != null) {\n+                    namespace = mapping.getNamespace();\n+                }\n \n                 if ((namespace != null) && (namespace.length() > 0) && (!\"/\".equals(namespace))) {\n                     finalLocation = namespace + \"/\" + finalLocation;",
                "changes": 9,
                "blob_url": "https://github.com/apache/struts/blob/9ed7fce11aca24c1f951a49cec9599ba5de7bd91/core/src/main/java/org/apache/struts2/dispatcher/ServletRedirectResult.java"
            }
        ],
        "repo": "struts",
        "message": "Fixed NPE when action mapper for current request is null\nWW-1662\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@498087 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/9ed7fce11aca24c1f951a49cec9599ba5de7bd91"
    },
    {
        "parent": "https://github.com/apache/struts/commit/bbc2a4cf27681747454596c4e62f87ee594f92eb",
        "bug_id": "struts_55",
        "file": [
            {
                "additions": 1,
                "sha": "0abe5c719dfc8fc3251d08fbad67e9f9e83427d5",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/99924c4d0602ff5df20f80787af361116b0cc8bd/core/src/main/java/org/apache/struts2/config/PropertiesSettings.java",
                "deletions": 0,
                "filename": "core/src/main/java/org/apache/struts2/config/PropertiesSettings.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts2/config/PropertiesSettings.java?ref=99924c4d0602ff5df20f80787af361116b0cc8bd",
                "patch": "@@ -56,6 +56,7 @@ public PropertiesSettings(String name) {\n         \n         if (settingsUrl == null) {\n             LOG.debug(name + \".properties missing\");\n+            settings = new LocatableProperties();\n             return;\n         }\n         ",
                "changes": 1,
                "blob_url": "https://github.com/apache/struts/blob/99924c4d0602ff5df20f80787af361116b0cc8bd/core/src/main/java/org/apache/struts2/config/PropertiesSettings.java"
            },
            {
                "additions": 2,
                "sha": "a4ff961fe6e8c3fe83ca67bef0779d80544c9afe",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/99924c4d0602ff5df20f80787af361116b0cc8bd/core/src/main/resources/struts-default.xml",
                "deletions": 2,
                "filename": "core/src/main/resources/struts-default.xml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/resources/struts-default.xml?ref=99924c4d0602ff5df20f80787af361116b0cc8bd",
                "patch": "@@ -20,8 +20,8 @@\n     <bean type=\"org.apache.struts2.dispatcher.mapper.ActionMapper\" name=\"restful\" class=\"org.apache.struts2.dispatcher.mapper.RestfulActionMapper\" />\n     <bean type=\"org.apache.struts2.dispatcher.mapper.ActionMapper\" name=\"restful2\" class=\"org.apache.struts2.dispatcher.mapper.Restful2ActionMapper\" />\n     \n-    <bean type=\"org.apache.struts2.dispatcher.multipart.MultiPartRequest\" name=\"struts\" class=\"org.apache.struts2.dispatcher.multipart.JakartaMultiPartRequest\" scope=\"default\"/>\n-    <bean type=\"org.apache.struts2.dispatcher.multipart.MultiPartRequest\" name=\"jakarta\" class=\"org.apache.struts2.dispatcher.multipart.JakartaMultiPartRequest\" scope=\"default\"/>\n+    <bean type=\"org.apache.struts2.dispatcher.multipart.MultiPartRequest\" name=\"struts\" class=\"org.apache.struts2.dispatcher.multipart.JakartaMultiPartRequest\" scope=\"default\" optional=\"true\"/>\n+    <bean type=\"org.apache.struts2.dispatcher.multipart.MultiPartRequest\" name=\"jakarta\" class=\"org.apache.struts2.dispatcher.multipart.JakartaMultiPartRequest\" scope=\"default\" optional=\"true\" />\n     \n     <bean class=\"org.apache.struts2.views.freemarker.FreemarkerManager\" name=\"struts\" optional=\"true\"/>\n     <bean class=\"org.apache.struts2.views.velocity.VelocityManager\" name=\"struts\" optional=\"true\" />",
                "changes": 4,
                "blob_url": "https://github.com/apache/struts/blob/99924c4d0602ff5df20f80787af361116b0cc8bd/core/src/main/resources/struts-default.xml"
            }
        ],
        "repo": "struts",
        "message": "Fixed NPE when struts.properties is missing, made multipart optional since fileupload isn't always available\nWW-1498\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@476374 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/99924c4d0602ff5df20f80787af361116b0cc8bd"
    },
    {
        "parent": "https://github.com/apache/struts/commit/d8e5ea68d9bb3eac8206b27c7c78835706643f1f",
        "bug_id": "struts_56",
        "file": [
            {
                "additions": 6,
                "sha": "c970c58380c16f4feb45d2262a164f765982e95a",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/3dbd0294e83f964702101bb732d7eb1ac133e157/plugins/convention/src/main/java/org/apache/struts2/convention/classloader/ReloadingClassLoader.java",
                "deletions": 1,
                "filename": "plugins/convention/src/main/java/org/apache/struts2/convention/classloader/ReloadingClassLoader.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/convention/src/main/java/org/apache/struts2/convention/classloader/ReloadingClassLoader.java?ref=3dbd0294e83f964702101bb732d7eb1ac133e157",
                "patch": "@@ -50,7 +50,12 @@ public ReloadingClassLoader(final ClassLoader pParent) {\n         parent = pParent;\n         URL root = pParent.getResource(\"/\");\n         try {\n-            stores = new ResourceStore[]{new FileResourceStore(new File(root.toURI()))};\n+            if (root != null) {\n+                stores = new ResourceStore[]{new FileResourceStore(new File(root.toURI()))};\n+            }\n+            else {\n+                throw new StrutsException(\"Unable to start the reloadable class loader, consider setting 'struts.convention.classes.reload' to false\");\n+            }\n         } catch (URISyntaxException e) {\n             throw new StrutsException(\"Unable to start the reloadable class loader, consider setting 'struts.convention.classes.reload' to false\", e);\n         } catch (RuntimeException e) {",
                "changes": 7,
                "blob_url": "https://github.com/apache/struts/blob/3dbd0294e83f964702101bb732d7eb1ac133e157/plugins/convention/src/main/java/org/apache/struts2/convention/classloader/ReloadingClassLoader.java"
            }
        ],
        "repo": "struts",
        "message": "WW-3163, fixing NPE, but throwing StrutsException instead, not a great fix, but when I get a chance to work closer with JBoss, I will come back to this\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@786061 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/3dbd0294e83f964702101bb732d7eb1ac133e157"
    },
    {
        "parent": "https://github.com/apache/struts/commit/a0c5ea1944f745a01544d748ed911081f406d499",
        "bug_id": "struts_57",
        "file": [
            {
                "additions": 2,
                "sha": "9068a37537051ea11f678d7af2857fe5d64589e8",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/b95f8dfc5055e6a0db22af2c70b41f172c804c60/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/AbstractRemoteBean.java",
                "deletions": 1,
                "filename": "plugins/dojo/src/main/java/org/apache/struts2/dojo/components/AbstractRemoteBean.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/AbstractRemoteBean.java?ref=b95f8dfc5055e6a0db22af2c70b41f172c804c60",
                "patch": "@@ -110,8 +110,9 @@ public void evaluateExtraParams() {\n         else\n             addParameter(\"parseContent\", true);\n \n+        // generate a random ID if not explicitly set and not parsing the content\n         Boolean parseContent = (Boolean)stack.getContext().get(Head.PARSE_CONTENT);\n-        boolean generateId = (parseContent != null ? !parseContent : false);\n+        boolean generateId = (parseContent != null ? !parseContent : true);\n         \n         addParameter(\"pushId\", generateId);\n         if ((this.id == null || this.id.length() == 0) && generateId) {",
                "changes": 3,
                "blob_url": "https://github.com/apache/struts/blob/b95f8dfc5055e6a0db22af2c70b41f172c804c60/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/AbstractRemoteBean.java"
            },
            {
                "additions": 4,
                "sha": "9236f9cc9c60828fc19529d99652714be3470cfd",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/b95f8dfc5055e6a0db22af2c70b41f172c804c60/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/Autocompleter.java",
                "deletions": 1,
                "filename": "plugins/dojo/src/main/java/org/apache/struts2/dojo/components/Autocompleter.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/Autocompleter.java?ref=b95f8dfc5055e6a0db22af2c70b41f172c804c60",
                "patch": "@@ -324,7 +324,10 @@ public void evaluateExtraParams() {\n         if (resultsLimit != null)\n             addParameter(\"searchLimit\", findString(resultsLimit));\n         \n-        boolean generateId = !(Boolean)stack.getContext().get(Head.PARSE_CONTENT);\n+        // generate a random ID if not explicitly set and not parsing the content\n+        Boolean parseContent = (Boolean)stack.getContext().get(Head.PARSE_CONTENT);\n+        boolean generateId = (parseContent != null ? !parseContent : true);\n+        \n         addParameter(\"pushId\", generateId);\n         if ((this.id == null || this.id.length() == 0) && generateId) {\n             // resolves Math.abs(Integer.MIN_VALUE) issue reported by FindBugs ",
                "changes": 5,
                "blob_url": "https://github.com/apache/struts/blob/b95f8dfc5055e6a0db22af2c70b41f172c804c60/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/Autocompleter.java"
            },
            {
                "additions": 4,
                "sha": "2286f5b7a6d9dbd72a95fe7317cd61824a463713",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/b95f8dfc5055e6a0db22af2c70b41f172c804c60/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/DateTimePicker.java",
                "deletions": 1,
                "filename": "plugins/dojo/src/main/java/org/apache/struts2/dojo/components/DateTimePicker.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/DateTimePicker.java?ref=b95f8dfc5055e6a0db22af2c70b41f172c804c60",
                "patch": "@@ -264,7 +264,10 @@ public void evaluateParams() {\n             }\n         }\n         \n-        boolean generateId = !(Boolean)stack.getContext().get(Head.PARSE_CONTENT);\n+        // generate a random ID if not explicitly set and not parsing the content\n+        Boolean parseContent = (Boolean)stack.getContext().get(Head.PARSE_CONTENT);\n+        boolean generateId = (parseContent != null ? !parseContent : true);\n+        \n         addParameter(\"pushId\", generateId);\n         if ((this.id == null || this.id.length() == 0) && generateId) {\n             // resolves Math.abs(Integer.MIN_VALUE) issue reported by FindBugs ",
                "changes": 5,
                "blob_url": "https://github.com/apache/struts/blob/b95f8dfc5055e6a0db22af2c70b41f172c804c60/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/DateTimePicker.java"
            },
            {
                "additions": 5,
                "sha": "8c260794726ca8ea140f3866c2ba1f3f5df64113",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/b95f8dfc5055e6a0db22af2c70b41f172c804c60/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/Submit.java",
                "deletions": 2,
                "filename": "plugins/dojo/src/main/java/org/apache/struts2/dojo/components/Submit.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/Submit.java?ref=b95f8dfc5055e6a0db22af2c70b41f172c804c60",
                "patch": "@@ -236,8 +236,11 @@ public void evaluateExtraParams() {\n         \n         if (ajaxAfterValidation != null)\n             addParameter(\"ajaxAfterValidation\", findValue(ajaxAfterValidation, Boolean.class));\n-        \n-        boolean generateId = !(Boolean)stack.getContext().get(Head.PARSE_CONTENT);\n+\n+        // generate a random ID if not explicitly set and not parsing the content \n+        Boolean parseContent = (Boolean)stack.getContext().get(Head.PARSE_CONTENT);\n+        boolean generateId = (parseContent != null ? !parseContent : true);\n+\n         addParameter(\"pushId\", generateId);\n         if ((this.id == null || this.id.length() == 0) && generateId) {\n             // resolves Math.abs(Integer.MIN_VALUE) issue reported by FindBugs ",
                "changes": 7,
                "blob_url": "https://github.com/apache/struts/blob/b95f8dfc5055e6a0db22af2c70b41f172c804c60/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/Submit.java"
            },
            {
                "additions": 4,
                "sha": "80a25c7b1b007651130384643a23913de158d639",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/b95f8dfc5055e6a0db22af2c70b41f172c804c60/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/TabbedPanel.java",
                "deletions": 1,
                "filename": "plugins/dojo/src/main/java/org/apache/struts2/dojo/components/TabbedPanel.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/TabbedPanel.java?ref=b95f8dfc5055e6a0db22af2c70b41f172c804c60",
                "patch": "@@ -128,7 +128,10 @@ protected void evaluateExtraParams() {\n             addParameter(\"useSelectedTabCookie\", findString(useSelectedTabCookie));\n         }\n \n-        boolean generateId = !(Boolean)stack.getContext().get(Head.PARSE_CONTENT);\n+        // generate a random ID if not explicitly set and not parsing the content\n+        Boolean parseContent = (Boolean)stack.getContext().get(Head.PARSE_CONTENT);\n+        boolean generateId = (parseContent != null ? !parseContent : true);\n+        \n         addParameter(\"pushId\", generateId);\n         if ((this.id == null || this.id.length() == 0) && generateId) {\n             // resolves Math.abs(Integer.MIN_VALUE) issue reported by FindBugs ",
                "changes": 5,
                "blob_url": "https://github.com/apache/struts/blob/b95f8dfc5055e6a0db22af2c70b41f172c804c60/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/TabbedPanel.java"
            },
            {
                "additions": 4,
                "sha": "4b5b0db3880f5f3a48167c629df3add1f1e79fd0",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/b95f8dfc5055e6a0db22af2c70b41f172c804c60/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/TextArea.java",
                "deletions": 1,
                "filename": "plugins/dojo/src/main/java/org/apache/struts2/dojo/components/TextArea.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/TextArea.java?ref=b95f8dfc5055e6a0db22af2c70b41f172c804c60",
                "patch": "@@ -47,7 +47,10 @@ public TextArea(ValueStack stack, HttpServletRequest request,\n     public void evaluateExtraParams() {\n         super.evaluateExtraParams();\n \n-        boolean generateId = !(Boolean)stack.getContext().get(Head.PARSE_CONTENT);\n+        // generate a random ID if not explicitly set and not parsing the content\n+        Boolean parseContent = (Boolean)stack.getContext().get(Head.PARSE_CONTENT);\n+        boolean generateId = (parseContent != null ? !parseContent : true);\n+        \n         addParameter(\"pushId\", generateId);\n         if ((this.id == null || this.id.length() == 0) && generateId) {\n             // resolves Math.abs(Integer.MIN_VALUE) issue reported by FindBugs ",
                "changes": 5,
                "blob_url": "https://github.com/apache/struts/blob/b95f8dfc5055e6a0db22af2c70b41f172c804c60/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/TextArea.java"
            },
            {
                "additions": 5,
                "sha": "1272b61614061385bdfb12d581515d957581ed52",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/b95f8dfc5055e6a0db22af2c70b41f172c804c60/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/Tree.java",
                "deletions": 2,
                "filename": "plugins/dojo/src/main/java/org/apache/struts2/dojo/components/Tree.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/Tree.java?ref=b95f8dfc5055e6a0db22af2c70b41f172c804c60",
                "patch": "@@ -253,8 +253,11 @@ protected void evaluateExtraParams() {\n             addParameter(\"href\", findString(href));\n         if (errorNotifyTopics != null)\n             addParameter(\"errorNotifyTopics\", findString(errorNotifyTopics));\n-        \n-        boolean generateId = !(Boolean)stack.getContext().get(Head.PARSE_CONTENT);\n+                \n+        // generate a random ID if not explicitly set and not parsing the content\n+        Boolean parseContent = (Boolean)stack.getContext().get(Head.PARSE_CONTENT);\n+        boolean generateId = (parseContent != null ? !parseContent : true);\n+\n         addParameter(\"pushId\", generateId);\n         if ((this.id == null || this.id.length() == 0) && generateId) {\n             // resolves Math.abs(Integer.MIN_VALUE) issue reported by FindBugs ",
                "changes": 7,
                "blob_url": "https://github.com/apache/struts/blob/b95f8dfc5055e6a0db22af2c70b41f172c804c60/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/Tree.java"
            },
            {
                "additions": 4,
                "sha": "8a24ae946152c3d2891180e371ef47c8141e4346",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/b95f8dfc5055e6a0db22af2c70b41f172c804c60/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/TreeNode.java",
                "deletions": 1,
                "filename": "plugins/dojo/src/main/java/org/apache/struts2/dojo/components/TreeNode.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/TreeNode.java?ref=b95f8dfc5055e6a0db22af2c70b41f172c804c60",
                "patch": "@@ -115,7 +115,10 @@ protected String getDefaultTemplate() {\n     protected void evaluateExtraParams() {\n         super.evaluateExtraParams();\n         \n-        boolean generateId = !(Boolean)stack.getContext().get(Head.PARSE_CONTENT);\n+        // generate a random ID if not explicitly set and not parsing the content\n+        Boolean parseContent = (Boolean)stack.getContext().get(Head.PARSE_CONTENT);\n+        boolean generateId = (parseContent != null ? !parseContent : true);\n+\n         addParameter(\"pushId\", generateId);\n         if ((this.id == null || this.id.length() == 0) && generateId) {\n             // resolves Math.abs(Integer.MIN_VALUE) issue reported by FindBugs ",
                "changes": 5,
                "blob_url": "https://github.com/apache/struts/blob/b95f8dfc5055e6a0db22af2c70b41f172c804c60/plugins/dojo/src/main/java/org/apache/struts2/dojo/components/TreeNode.java"
            }
        ],
        "repo": "struts",
        "message": "WW-2498 Minor change to avoid NPE when parseContent attribute is missing on dojo tags or in the context. Defaults to false if null.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@629326 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/b95f8dfc5055e6a0db22af2c70b41f172c804c60"
    },
    {
        "parent": "https://github.com/apache/struts/commit/e2b0819538f4b81aae99cf310643fee2a7568e86",
        "bug_id": "struts_58",
        "file": [
            {
                "additions": 124,
                "sha": "e273104ae24ddaee0cea43d13691638def4d918a",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/137da15d07cbaac9618f59af10fdf19819985ba8/plugins/jfreechart/src/main/java/org/apache/struts2/dispatcher/ChartResult.java",
                "deletions": 47,
                "filename": "plugins/jfreechart/src/main/java/org/apache/struts2/dispatcher/ChartResult.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/jfreechart/src/main/java/org/apache/struts2/dispatcher/ChartResult.java?ref=137da15d07cbaac9618f59af10fdf19819985ba8",
                "patch": "@@ -26,88 +26,165 @@\n import org.jfree.chart.ChartUtilities;\n import org.jfree.chart.JFreeChart;\n \n-import javax.servlet.http.HttpServletResponse;\n import java.io.OutputStream;\n \n-\n /**\n+ * <!-- START SNIPPET: description -->\n+ * <p/>\n  * A custom Result type for chart data. Built on top of\n  * <a href=\"http://www.jfree.org/jfreechart/\" target=\"_blank\">JFreeChart</a>. When executed\n- * this Result will write the given chart as a PNG to the servlet output stream.\n+ * this Result will write the given chart as a PNG or JPG to the servlet output stream.\n+ * <p/>\n+ * <!-- END SNIPPET: description -->\n+ * <p/>\n+ * <b>This result type takes the following parameters:</b>\n+ * <p/>\n+ * <!-- START SNIPPET: params -->\n+ * <p/>\n+ * <ul>\n+ * <p/>\n+ * <li><b>value</b> - the name of the JFreeChart object on the ValueStack, defaults to 'chart'.</li>\n+ * <p/>\n+ * <li><b>type</b> - the render type for this chart. Can be jpg (or jpeg) or png. Defaults to png.</li>\n+ * <p/>\n+ * <li><b>width (required)</b> - the width (in pixels) of the rendered chart.</li>\n+ * <p/>\n+ * <li><b>height (required)</b> - the height (in pixels) of the rendered chart.</li>\n+ * <p/>\n+ * </ul>\n+ * <!-- END SNIPPET: params -->\n+ * <p/>\n+ * <b>Example:</b>\n+ * <p/>\n+ * <pre><!-- START SNIPPET: example -->\n+ * public class ExampleChartAction extends ActionSupport {\n+ *\n+ *\t    private JFreeChart chart;\n+ *\n+ *\t    public String execute() throws Exception {\n+ *\t\t    // chart creation logic...\n+ *\t\t    XYSeries dataSeries = new XYSeries(new Integer(1)); // pass a key for this serie\n+ *\t\t    for (int i = 0; i <= 100; i++) {\n+ *\t\t\t    dataSeries.add(i, RandomUtils.nextInt());\n+ *\t\t    }\n+ *\t\t    XYSeriesCollection xyDataset = new XYSeriesCollection(dataSeries);\n+ *\n+ *\t\t    ValueAxis xAxis = new NumberAxis(\"Raw Marks\");\n+ *\t\t    ValueAxis yAxis = new NumberAxis(\"Moderated Marks\");\n+ *\n+ *\t\t    // set my chart variable\n+ *\t\t    chart =\n+ *\t\t\t    new JFreeChart( \"Moderation Function\", JFreeChart.DEFAULT_TITLE_FONT,\n+ *\t\t\t\t    new XYPlot( xyDataset, xAxis, yAxis, new StandardXYItemRenderer(StandardXYItemRenderer.LINES)),\n+ *\t\t\t\t    false);\n+ *\t\t    chart.setBackgroundPaint(java.awt.Color.white);\n  *\n+ *\t\t    return SUCCESS;\n+ *\t    }\n+ * \n+ *      // this method will get called if we specify &lt;param name=\"value\"&gt;chart&lt;/param&gt;\n+ *\t    public JFreeChart getChart() {\n+ *\t\t    return chart;\n+ *\t    }\n+ *  }\n+ *\n+ * &lt;result name=\"success\" type=\"chart\"&gt;\n+ *   &lt;param name=\"value\"&gt;chart&lt;/param&gt;\n+ *   &lt;param name=\"type\"&gt;png&lt;/param&gt;\n+ *   &lt;param name=\"width\"&gt;640&lt;/param&gt;\n+ *   &lt;param name=\"height\"&gt;480&lt;/param&gt;\n+ * &lt;/result&gt;\n+ * <!-- END SNIPPET: example --></pre>\n  */\n public class ChartResult implements Result {\n \n     private static final long serialVersionUID = -6484761870055986612L;\n+    private static final String DEFAULT_TYPE = \"png\";\n+    private static final String DEFAULT_VALUE = \"chart\";\n+\n+    private JFreeChart chart; // the JFreeChart to render\n+    Integer height, width;\n+    String type = DEFAULT_TYPE; // supported are jpg, jpeg or png, defaults to png\n+    String value = DEFAULT_VALUE; // defaults to 'chart'\n \n-    JFreeChart chart;\n-    boolean chartSet = false;\n-    private int height;\n-    private int width;\n+    // CONSTRUCTORS ----------------------------\n \n     public ChartResult() {\n         super();\n     }\n \n     public ChartResult(JFreeChart chart, int height, int width) {\n-        setChart(chart);\n+        this.chart = chart;\n         this.height = height;\n         this.width = width;\n     }\n \n-    /**\n-     * Sets the JFreeChart to use.\n-     *\n-     * @param chart a JFreeChart object.\n-     */\n-    public ChartResult setChart(JFreeChart chart) {\n-        this.chart = chart;\n-        chartSet = true;\n-        return this;\n+    // ACCESSORS ----------------------------\n+\n+    public Integer getHeight() {\n+        return height;\n     }\n \n-    /**\n-     * Sets the chart height.\n-     *\n-     * @param height the height of the chart in pixels.\n-     */\n-    public ChartResult setHeight(int height) {\n+    public void setHeight(Integer height) {\n         this.height = height;\n-        return this;\n     }\n \n-    /**\n-     * Sets the chart width.\n-     *\n-     * @param width the width of the chart in pixels.\n-     */\n-    public ChartResult setWidth(int width) {\n+    public Integer getWidth() {\n+        return width;\n+    }\n+\n+    public void setWidth(Integer width) {\n         this.width = width;\n-        return this;\n     }\n \n+    public String getType() {\n+        return type;\n+    }\n+\n+    public void setType(String type) {\n+        this.type = type;\n+    }\n+\n+    public String getValue() {\n+        return value;\n+    }\n+\n+    public void setValue(String value) {\n+        this.value = value;\n+    }\n+\n+    // OTHER METHODS -----------------------\n+\n+    // Required by com.opensymphony.xwork2.Result\n+\n     /**\n-     * Executes the result. Writes the given chart as a PNG to the servlet output stream.\n+     * Executes the result. Writes the given chart as a PNG or JPG to the servlet output stream.\n      *\n      * @param invocation an encapsulation of the action execution state.\n      * @throws Exception if an error occurs when creating or writing the chart to the servlet output stream.\n      */\n     public void execute(ActionInvocation invocation) throws Exception {\n-        JFreeChart chart = null;\n-\n-        if (chartSet) {\n-            chart = this.chart;\n-        } else {\n-            chart = (JFreeChart) invocation.getStack().findValue(\"chart\");\n-        }\n+        chart = (JFreeChart) invocation.getStack().findValue(value, JFreeChart.class);\n+        if (chart == null) // we need to have a chart object - if not, blow up\n+            throw new NullPointerException(\"No JFreeChart object found on the stack with name \" + value);\n+        // make sure we have some value for the width and height\n+        if (height == null)\n+            throw new NullPointerException(\"No height parameter was given.\");\n+        if (width == null)\n+            throw new NullPointerException(\"No width parameter was given.\");\n \n-        if (chart == null) {\n-            throw new NullPointerException(\"No chart found\");\n+        // get a reference to the servlet output stream to write our chart image to\n+        OutputStream os = ServletActionContext.getResponse().getOutputStream();\n+        try {\n+            // check the type to see what kind of output we have to produce\n+            if (\"png\".equalsIgnoreCase(type))\n+                ChartUtilities.writeChartAsPNG(os, chart, width, height);\n+            else if (\"jpg\".equalsIgnoreCase(type) || \"jpeg\".equalsIgnoreCase(type))\n+                ChartUtilities.writeChartAsJPEG(os, chart, width, height);\n+            else\n+                throw new IllegalArgumentException(type + \" is not a supported render type (only JPG and PNG are).\");\n+        } finally {\n+            if (os != null) os.flush();\n         }\n-\n-        HttpServletResponse response = ServletActionContext.getResponse();\n-        OutputStream os = response.getOutputStream();\n-        ChartUtilities.writeChartAsPNG(os, chart, width, height);\n-        os.flush();\n     }\n-}\n+}\n\\ No newline at end of file",
                "changes": 171,
                "blob_url": "https://github.com/apache/struts/blob/137da15d07cbaac9618f59af10fdf19819985ba8/plugins/jfreechart/src/main/java/org/apache/struts2/dispatcher/ChartResult.java"
            }
        ],
        "repo": "struts",
        "message": "Made some minimal changes to improve the JFreeChart Result:\n- chart getter can be specified\n- type (png/jpg) can be specified\n- throws NPEs if required fields are missing\n- added example configuration and Action\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/struts2/trunk@573912 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/137da15d07cbaac9618f59af10fdf19819985ba8"
    },
    {
        "parent": "https://github.com/apache/struts/commit/6251303f170eb6fbbf98ae5b1b25b749f8bde0d4",
        "bug_id": "struts_59",
        "file": [
            {
                "additions": 22,
                "sha": "494fd398c7ef19b2a71ec04dad612920a6a81dc9",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/79fbee4f2c788be976eee02baa55e727c20a47a1/core/src/main/java/org/apache/struts/action2/interceptor/ExecuteAndWaitInterceptor.java",
                "deletions": 6,
                "filename": "core/src/main/java/org/apache/struts/action2/interceptor/ExecuteAndWaitInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts/action2/interceptor/ExecuteAndWaitInterceptor.java?ref=79fbee4f2c788be976eee02baa55e727c20a47a1",
                "patch": "@@ -22,6 +22,7 @@\n import com.opensymphony.xwork.ActionProxy;\n import com.opensymphony.xwork.config.entities.ResultConfig;\n import com.opensymphony.xwork.interceptor.Interceptor;\n+import com.opensymphony.xwork.interceptor.MethodFilterInterceptor;\n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n \n@@ -157,7 +158,7 @@\n  * <!-- END SNIPPET: example -->\n  *\n  */\n-public class ExecuteAndWaitInterceptor implements Interceptor {\n+public class ExecuteAndWaitInterceptor extends MethodFilterInterceptor {\n \t\n \tprivate static final long serialVersionUID = -2754639196749652512L;\n \n@@ -177,22 +178,31 @@ protected BackgroundProcess getNewBackgroundProcess(String name, ActionInvocatio\n         return new BackgroundProcess(name + \"BackgroundThread\", actionInvocation, threadPriority);\n     }\n \n-    public String intercept(ActionInvocation actionInvocation) throws Exception {\n+    protected String doIntercept(ActionInvocation actionInvocation) throws Exception {\n         ActionProxy proxy = actionInvocation.getProxy();\n         String name = proxy.getActionName();\n         ActionContext context = actionInvocation.getInvocationContext();\n         Map session = context.getSession();\n \n+        Boolean secondTime = (Boolean) context.get(KEY);\n+        if (secondTime == null) {\n+            context.put(KEY, true);\n+            secondTime = false;\n+        } else {\n+            secondTime = true;\n+        }\n+\n         synchronized (session) {\n             BackgroundProcess bp = (BackgroundProcess) session.get(KEY + name);\n \n-            if (bp == null) {\n+            if (secondTime && bp == null) {\n                 bp = getNewBackgroundProcess(name, actionInvocation, threadPriority);\n                 session.put(KEY + name, bp);\n                 performInitialDelay(bp); // first time let some time pass before showing wait page\n+                secondTime = false;\n             }\n \n-            if (!bp.isDone()) {\n+            if (!secondTime && bp != null && !bp.isDone()) {\n                 actionInvocation.getStack().push(bp.getAction());\n                 Map results = proxy.getConfig().getResults();\n                 if (!results.containsKey(WAIT)) {\n@@ -202,12 +212,12 @@ public String intercept(ActionInvocation actionInvocation) throws Exception {\n                             \"'! This requires FreeMarker support and won't work if you don't have it installed\");\n                     // no wait result? hmm -- let's try to do dynamically put it in for you!\n                     ResultConfig rc = new ResultConfig(WAIT, \"org.apache.struts.action2.views.freemarker.FreemarkerResult\",\n-                            Collections.singletonMap(\"location\", \"org/apache/struts/action2/interceptor/wait.ftl\"));\n+                            Collections.singletonMap(\"location\", \"/org/apache/struts/action2/interceptor/wait.ftl\"));\n                     results.put(WAIT, rc);\n                 }\n \n                 return WAIT;\n-            } else {\n+            } else if (!secondTime && bp != null && bp.isDone()) {\n                 session.remove(KEY + name);\n                 actionInvocation.getStack().push(bp.getAction());\n \n@@ -217,6 +227,12 @@ public String intercept(ActionInvocation actionInvocation) throws Exception {\n                 }\n \n                 return bp.getResult();\n+            } else {\n+                // this is the first instance of the interceptor and there is no existing action\n+                // already run in the background, so let's just let this pass through. We assume\n+                // the action invocation will be run in the background on the subsequent pass through\n+                // this interceptor\n+                return actionInvocation.invoke();\n             }\n         }\n     }",
                "changes": 28,
                "blob_url": "https://github.com/apache/struts/blob/79fbee4f2c788be976eee02baa55e727c20a47a1/core/src/main/java/org/apache/struts/action2/interceptor/ExecuteAndWaitInterceptor.java"
            },
            {
                "additions": 2,
                "sha": "666db064c427a2feb659fe9cd92f89f2ab0b4864",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/79fbee4f2c788be976eee02baa55e727c20a47a1/core/src/main/java/org/apache/struts/action2/quickstart/MultiWebApplicationContext.java",
                "deletions": 2,
                "filename": "core/src/main/java/org/apache/struts/action2/quickstart/MultiWebApplicationContext.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts/action2/quickstart/MultiWebApplicationContext.java?ref=79fbee4f2c788be976eee02baa55e727c20a47a1",
                "patch": "@@ -87,8 +87,8 @@ public Resource getResource(String uriInContext) throws IOException {\n         // Alright, let's just hack this to work in IDEA\n         if (uriInContext.equals(\"/struts-action\")) {\n             // we do this check to support both \"quickstart:showcase\" and \"quickstart\" (using quickstart.xml)\n-            if (new File(\"../../action/src/main/resources/META-INF/taglib.tld\").exists()) {\n-                return FileResource.newResource(\"../../action/src/main/resources/META-INF/taglib.tld\");\n+            if (new File(\"../../core/src/main/resources/META-INF/taglib.tld\").exists()) {\n+                return FileResource.newResource(\"../../core/src/main/resources/META-INF/taglib.tld\");\n             } else {\n                 return FileResource.newResource(\"src/main/resources/META-INF/taglib.tld\");\n             }",
                "changes": 4,
                "blob_url": "https://github.com/apache/struts/blob/79fbee4f2c788be976eee02baa55e727c20a47a1/core/src/main/java/org/apache/struts/action2/quickstart/MultiWebApplicationContext.java"
            },
            {
                "additions": 2,
                "sha": "6455beed7bb8b1d5d439bbd101e989ccdd8dd926",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/79fbee4f2c788be976eee02baa55e727c20a47a1/core/src/main/java/org/apache/struts/action2/quickstart/QuickStart.java",
                "deletions": 1,
                "filename": "core/src/main/java/org/apache/struts/action2/quickstart/QuickStart.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/java/org/apache/struts/action2/quickstart/QuickStart.java?ref=79fbee4f2c788be976eee02baa55e727c20a47a1",
                "patch": "@@ -174,7 +174,8 @@ public static void main(String[] args) throws FileNotFoundException, MalformedUR\n         System.out.println(\"\");\n         System.out.println(\"********************************************************\");\n         System.out.println(\"Quick-started at http://localhost:\" + c.getPort() + c.getContext());\n-        System.out.println(\"You may now edit your Java source files and web files.\");\n+        System.out.println(\"You may now edit your Java classes and web files without\");\n+        System.out.println(\" deploying or restarting.\");\n         System.out.println(\"********************************************************\");\n     }\n ",
                "changes": 3,
                "blob_url": "https://github.com/apache/struts/blob/79fbee4f2c788be976eee02baa55e727c20a47a1/core/src/main/java/org/apache/struts/action2/quickstart/QuickStart.java"
            },
            {
                "additions": 1,
                "sha": "43968b077791d7a241b5bd4d4e3672fceb1f8823",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/79fbee4f2c788be976eee02baa55e727c20a47a1/core/src/main/resources/org/apache/struts/action2/interceptor/debugging/console.ftl",
                "deletions": 1,
                "filename": "core/src/main/resources/org/apache/struts/action2/interceptor/debugging/console.ftl",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/resources/org/apache/struts/action2/interceptor/debugging/console.ftl?ref=79fbee4f2c788be976eee02baa55e727c20a47a1",
                "patch": "@@ -1,7 +1,7 @@\n <html>\n <head>\n     <script language=\"javascript\">\n-    var baseUrl = \"<@ww.url value=\"/struts\"/>\";\n+    var baseUrl = \"<@saf.url value=\"/struts\" includeParams=\"none\"/>\";\n     window.open(baseUrl+\"/webconsole.html\", 'OGNL Console','width=500,height=450,'+\n         'status=no,toolbar=no,menubar=no');\n     </script>    ",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/79fbee4f2c788be976eee02baa55e727c20a47a1/core/src/main/resources/org/apache/struts/action2/interceptor/debugging/console.ftl"
            },
            {
                "additions": 1,
                "sha": "b0f0003bc0ae3c48b9f0d665e849b120915222b5",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/79fbee4f2c788be976eee02baa55e727c20a47a1/core/src/main/resources/org/apache/struts/action2/interceptor/wait.ftl",
                "deletions": 1,
                "filename": "core/src/main/resources/org/apache/struts/action2/interceptor/wait.ftl",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/resources/org/apache/struts/action2/interceptor/wait.ftl?ref=79fbee4f2c788be976eee02baa55e727c20a47a1",
                "patch": "@@ -1,6 +1,6 @@\n <html>\n     <head>\n-        <meta http-equiv=\"refresh\" content=\"5;url=<@ww.url includeParams=\"all\"/>\"/>\n+        <meta http-equiv=\"refresh\" content=\"5;url=<@saf.url includeParams=\"none\"/>\"/>\n     </head>\n     <body>\n         Please wait while we process your request...",
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/79fbee4f2c788be976eee02baa55e727c20a47a1/core/src/main/resources/org/apache/struts/action2/interceptor/wait.ftl"
            },
            {
                "additions": 12,
                "sha": "609a9b3885a1630b0f38bf8780b8b86324e7740d",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/79fbee4f2c788be976eee02baa55e727c20a47a1/core/src/main/resources/struts-default.xml",
                "deletions": 7,
                "filename": "core/src/main/resources/struts-default.xml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core/src/main/resources/struts-default.xml?ref=79fbee4f2c788be976eee02baa55e727c20a47a1",
                "patch": "@@ -94,13 +94,6 @@\n                 <interceptor-ref name=\"basicStack\"/>\n             </interceptor-stack>\n \n-            <!-- Sample execute and wait stack.\n-                 Note: execAndWait should always be the *last* interceptor. -->\n-            <interceptor-stack name=\"executeAndWaitStack\">\n-                <interceptor-ref name=\"basicStack\"/>\n-                <interceptor-ref name=\"execAndWait\"/>\n-            </interceptor-stack>\n-\n             <!-- An example of the params-prepare-params trick. This stack\n                  is exactly the same as the defaultStack, except that it\n                  includes one extra interceptor before the prepare interceptor:\n@@ -172,6 +165,18 @@\n             <interceptor-stack name=\"completeStack\">\n                 <interceptor-ref name=\"defaultStack\"/>\n             </interceptor-stack>\n+\n+            <!-- Sample execute and wait stack.\n+                 Note: execAndWait should always be the *last* interceptor. -->\n+            <interceptor-stack name=\"executeAndWaitStack\">\n+                <interceptor-ref name=\"execAndWait\">\n+                    <param name=\"excludeMethods\">input,back,cancel</param>\n+                </interceptor-ref>\n+                <interceptor-ref name=\"defaultStack\"/>\n+                <interceptor-ref name=\"execAndWait\">\n+                    <param name=\"excludeMethods\">input,back,cancel</param>\n+                </interceptor-ref>\n+            </interceptor-stack>\n         </interceptors>\n \n         <default-interceptor-ref name=\"defaultStack\"/>",
                "changes": 19,
                "blob_url": "https://github.com/apache/struts/blob/79fbee4f2c788be976eee02baa55e727c20a47a1/core/src/main/resources/struts-default.xml"
            }
        ],
        "repo": "struts",
        "message": "- avoid NPE in XworkException\n- executeAndWait interceptor is smarter now (works with validation). it's still ugly, but much better\n- console doesn't spit out the full URL w/ params\n- some fixes left over from refactoring in quickstart\n\ngit-svn-id: https://svn.apache.org/repos/asf/struts/action2/trunk@407897 13f79535-47bb-0310-9956-ffa450edef68",
        "commit": "https://github.com/apache/struts/commit/79fbee4f2c788be976eee02baa55e727c20a47a1"
    },
    {
        "parent": "https://github.com/apache/struts/commit/266f83f15ca8338047a0bdb34a38ebfc8c894a6a",
        "bug_id": "struts_60",
        "file": [
            {
                "additions": 3,
                "sha": "29eb052f69e94b06893ed6ce1513252f2b335d9d",
                "status": "modified",
                "raw_url": "https://github.com/apache/struts/raw/7bce8ef6a84a2ddf5d79f89337e08bec223c3730/plugins/sitemesh/src/main/java/org/apache/struts2/sitemesh/StrutsSiteMeshFactory.java",
                "deletions": 0,
                "filename": "plugins/sitemesh/src/main/java/org/apache/struts2/sitemesh/StrutsSiteMeshFactory.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins/sitemesh/src/main/java/org/apache/struts2/sitemesh/StrutsSiteMeshFactory.java?ref=7bce8ef6a84a2ddf5d79f89337e08bec223c3730",
                "patch": "@@ -2,6 +2,7 @@\n \n import com.opensymphony.module.sitemesh.Config;\n import com.opensymphony.module.sitemesh.factory.DefaultFactory;\n+import com.opensymphony.xwork2.ActionContext;\n import org.apache.commons.lang3.ObjectUtils;\n import org.apache.struts2.ServletActionContext;\n import org.apache.struts2.StrutsStatics;\n@@ -22,6 +23,8 @@ public boolean shouldParsePage(String contentType) {\n     }\n \n     private boolean isInsideActionTag() {\n+        if(ActionContext.getContext() == null)\n+    \t\treturn false;\n         Object attribute = ServletActionContext.getRequest().getAttribute(StrutsStatics.STRUTS_ACTION_TAG_INVOCATION);\n         return (Boolean) ObjectUtils.defaultIfNull(attribute, Boolean.FALSE);\n     }",
                "changes": 3,
                "blob_url": "https://github.com/apache/struts/blob/7bce8ef6a84a2ddf5d79f89337e08bec223c3730/plugins/sitemesh/src/main/java/org/apache/struts2/sitemesh/StrutsSiteMeshFactory.java"
            }
        ],
        "repo": "struts",
        "message": "Defend for NPE when performing async request\n\nwhen I combined spring async mvc with struts2 sitemesh plugin, It will throw NPE\r\n\r\njava.lang.NullPointerException\r\n\tat org.apache.struts2.ServletActionContext.getRequest(ServletActionContext.java:112)\r\n\tat org.apache.struts2.sitemesh.StrutsSiteMeshFactory.isInsideActionTag(StrutsSiteMeshFactory.java:25)\r\n\tat org.apache.struts2.sitemesh.StrutsSiteMeshFactory.shouldParsePage(StrutsSiteMeshFactory.java:21)\r\n\tat com.opensymphony.sitemesh.compatability.PageParser2ContentProcessor.handles(PageParser2ContentProcessor.java:45)\r\n\tat com.opensymphony.sitemesh.webapp.ContentBufferingResponse$1.shouldParsePage(ContentBufferingResponse.java:29)\r\n\tat com.opensymphony.module.sitemesh.filter.PageResponseWrapper.setContentType(PageResponseWrapper.java:63)\r\n\tat com.opensymphony.sitemesh.webapp.ContentBufferingResponse$2.setContentType(ContentBufferingResponse.java:39)\r\n\tat com.opensymphony.module.sitemesh.filter.PageResponseWrapper.addHeader(PageResponseWrapper.java:135)\r\n\tat javax.servlet.http.HttpServletResponseWrapper.addHeader(HttpServletResponseWrapper.java:173)\r\n\tat org.springframework.http.server.ServletServerHttpResponse.writeHeaders(ServletServerHttpResponse.java:103)\r\n\tat org.springframework.http.server.ServletServerHttpResponse.getBody(ServletServerHttpResponse.java:83)\r\n\tat org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:217)\r\n\tat org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:208)\r\n\tat org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:161)\r\n\tat org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:101)\r\n\tat org.springframework.web.servlet.mvc.method.annotation.RequestResponseBodyMethodProcessor.handleReturnValue(RequestResponseBodyMethodProcessor.java:199)\r\n\tat org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:71)\r\n\tat org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:128)\r\n\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandleMethod(RequestMappingHandlerAdapter.java:781)\r\n\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:721)\r\n\tat org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:83)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:943)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:877)\r\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:966)\r\n\tat org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:857)\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:620)\r\n\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:842)\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:727)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:303)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)\r\n\tat org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:748)\r\n\tat org.apache.catalina.core.ApplicationDispatcher.doDispatch(ApplicationDispatcher.java:659)\r\n\tat org.apache.catalina.core.ApplicationDispatcher.dispatch(ApplicationDispatcher.java:625)\r\n\tat org.apache.catalina.core.AsyncContextImpl$1.run(AsyncContextImpl.java:239)\r\n\tat org.apache.catalina.core.AsyncContextImpl.doInternalDispatch(AsyncContextImpl.java:382)\r\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:215)\r\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:122)\r\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:171)\r\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:103)\r\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:116)\r\n\tat org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:299)\r\n\tat org.apache.coyote.http11.AbstractHttp11Processor.asyncDispatch(AbstractHttp11Processor.java:1652)\r\n\tat org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:603)\r\n\tat org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:314)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\r\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\r\n\tat java.lang.Thread.run(Thread.java:745)",
        "commit": "https://github.com/apache/struts/commit/7bce8ef6a84a2ddf5d79f89337e08bec223c3730"
    }
]