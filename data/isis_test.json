{
    "isis_05a7221": {
        "bug_id": "isis_05a7221",
        "commit": "https://github.com/apache/isis/commit/05a72212c6f2985ff16ed281d2f55f13a8c7e391",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/isis/blob/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/metamodel/src/main/java/org/apache/isis/metamodel/facets/object/entity/EntityFacet.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/metamodel/facets/object/entity/EntityFacet.java?ref=05a72212c6f2985ff16ed281d2f55f13a8c7e391",
                "deletions": 0,
                "filename": "core/metamodel/src/main/java/org/apache/isis/metamodel/facets/object/entity/EntityFacet.java",
                "patch": "@@ -22,6 +22,7 @@\n import java.lang.reflect.Method;\n \n import org.apache.isis.metamodel.facetapi.Facet;\n+import org.apache.isis.metamodel.spec.EntityState;\n import org.apache.isis.metamodel.spec.ObjectSpecification;\n \n /**\n@@ -35,6 +36,8 @@\n     Object fetchByIdentifier(ObjectSpecification spec, String identifier);\n     \n     void persist(ObjectSpecification spec, Object pojo);\n+    \n+    EntityState getEntityState(Object pojo);\n \n     /**\n      * Whether given method originates from byte code mangling.",
                "raw_url": "https://github.com/apache/isis/raw/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/metamodel/src/main/java/org/apache/isis/metamodel/facets/object/entity/EntityFacet.java",
                "sha": "d7446e5f6a926c89775aeb460ab6f83b1de79329",
                "status": "modified"
            },
            {
                "additions": 50,
                "blob_url": "https://github.com/apache/isis/blob/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/metamodel/src/main/java/org/apache/isis/metamodel/objectmanager/ObjectCreator_builtinHandlers.java",
                "changes": 94,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/metamodel/objectmanager/ObjectCreator_builtinHandlers.java?ref=05a72212c6f2985ff16ed281d2f55f13a8c7e391",
                "deletions": 44,
                "filename": "core/metamodel/src/main/java/org/apache/isis/metamodel/objectmanager/ObjectCreator_builtinHandlers.java",
                "patch": "@@ -24,7 +24,8 @@\n import org.apache.isis.applib.events.lifecycle.AbstractLifecycleEvent;\n import org.apache.isis.applib.services.command.Command;\n import org.apache.isis.applib.services.eventbus.EventBusService;\n-import org.apache.isis.commons.exceptions.IsisException;\n+import org.apache.isis.commons.internal.base._Casts;\n+import org.apache.isis.commons.internal.exceptions._Exceptions;\n import org.apache.isis.commons.internal.factory.InstanceUtil;\n import org.apache.isis.metamodel.MetaModelContext;\n import org.apache.isis.metamodel.facets.object.callbacks.CallbackFacet;\n@@ -63,9 +64,9 @@ public ManagedObject handle(ObjectCreator.Request objectCreateRequest) {\n             \n             val spec = objectCreateRequest.getObjectSpecification();\n             \n-            if (log.isDebugEnabled()) {\n-                log.debug(\"creating instance of {}\", spec);\n-            }\n+            //if (log.isDebugEnabled()) {\n+                log.info(\"creating instance of {}\", spec);\n+            //}\n             \n             val pojo = instantiateAndInjectServices(spec);\n \n@@ -75,14 +76,40 @@ public ManagedObject handle(ObjectCreator.Request objectCreateRequest) {\n         \n         //  -- HELPER\n         \n-        private ManagedObject initializePropertiesAndDoCallback(final ManagedObject adapter) {\n+        private Object instantiateAndInjectServices(ObjectSpecification spec) {\n+\n+            val type = spec.getCorrespondingClass();\n+            if (type.isArray()) {\n+                return Array.newInstance(type.getComponentType(), 0);\n+            }\n+\n+            if (Modifier.isAbstract(type.getModifiers())) {\n+                throw _Exceptions.unrecoverable(\"Cannot create an instance of an abstract class: \" + type);\n+            }\n+\n+            try {\n+                \n+                val newInstance = type.newInstance();\n+                metaModelContext.getServiceInjector().injectServicesInto(newInstance);\n+                return newInstance;    \n+                \n+            } catch (IllegalAccessException | InstantiationException e) {\n+                throw _Exceptions.unrecoverable(\n+                        \"Failed to create instance of type \" + spec.getFullIdentifier(), e);\n+            }\n+\n+        }\n+        \n+        private ManagedObject initializePropertiesAndDoCallback(ManagedObject adapter) {\n \n             // initialize new object\n             adapter.getSpecification().streamAssociations(Contributed.EXCLUDED)\n             .forEach(field->field.toDefault(adapter));\n \n-            val pojo = adapter.getPojo();\n-            metaModelContext.getServiceInjector().injectServicesInto(pojo);\n+             val pojo = adapter.getPojo();\n+            \n+            //XXX pojo already got everything injected above\n+            //metaModelContext.getServiceInjector().injectServicesInto(pojo);\n \n             CallbackFacet.Util.callCallback(adapter, CreatedCallbackFacet.class);\n \n@@ -113,51 +140,30 @@ private ManagedObject initializePropertiesAndDoCallback(final ManagedObject adap\n             return adapter;\n         }\n         \n-        private Object instantiateAndInjectServices(final ObjectSpecification objectSpec) {\n-\n-            final Class<?> correspondingClass = objectSpec.getCorrespondingClass();\n-            if (correspondingClass.isArray()) {\n-                return Array.newInstance(correspondingClass.getComponentType(), 0);\n-            }\n-\n-            final Class<?> cls = correspondingClass;\n-            if (Modifier.isAbstract(cls.getModifiers())) {\n-                throw new IsisException(\"Cannot create an instance of an abstract class: \" + cls);\n-            }\n-\n-            final Object newInstance;\n-            try {\n-                newInstance = cls.newInstance();\n-            } catch (final IllegalAccessException | InstantiationException e) {\n-                throw new IsisException(\"Failed to create instance of type \" + objectSpec.getFullIdentifier(), e);\n-            }\n-\n-            metaModelContext.getServiceInjector().injectServicesInto(newInstance);\n-            return newInstance;\n-\n-        }\n-        \n-        @SuppressWarnings({ \"unchecked\", \"rawtypes\" })\n         private void postLifecycleEventIfRequired(\n                 ManagedObject adapter,\n                 Class<? extends LifecycleEventFacet> lifecycleEventFacetClass) {\n             \n             val lifecycleEventFacet = adapter.getSpecification().getFacet(lifecycleEventFacetClass);\n-            if(lifecycleEventFacet != null) {\n-                final Class<? extends AbstractLifecycleEvent<?>> eventType = lifecycleEventFacet.getEventType();\n-                val instance = (AbstractLifecycleEvent) InstanceUtil.createInstance(eventType);\n-                val pojo = adapter.getPojo();\n-                postEvent(instance, pojo);\n+            if(lifecycleEventFacet == null) {\n+                return;\n             }\n+            \n+            val eventType = lifecycleEventFacet.getEventType();\n+            val instance = InstanceUtil.createInstance(eventType);\n+            val pojo = adapter.getPojo();\n+            postEvent(_Casts.uncheckedCast(instance), pojo);\n+            \n         }\n \n-        private void postEvent(final AbstractLifecycleEvent<Object> event, final Object pojo) {\n-            val eventBusService = metaModelContext.getServiceRegistry()\n-                    .lookupServiceElseFail(EventBusService.class);\n-            if(eventBusService!=null) {\n-                event.initSource(pojo);\n-                eventBusService.post(event);\n-            }\n+        private <T> void postEvent(AbstractLifecycleEvent<T> event, T pojo) {\n+            \n+            metaModelContext.getServiceRegistry()\n+                .lookupService(EventBusService.class)\n+                .ifPresent(eventBusService->{\n+                    event.initSource(pojo);\n+                    eventBusService.post(event);\n+                });\n         }\n         \n ",
                "raw_url": "https://github.com/apache/isis/raw/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/metamodel/src/main/java/org/apache/isis/metamodel/objectmanager/ObjectCreator_builtinHandlers.java",
                "sha": "ae5d93dd12a4cc9316dcb222b2988c85f4917c2f",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/isis/blob/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/metamodel/src/main/java/org/apache/isis/metamodel/spec/EntityState.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/metamodel/spec/EntityState.java?ref=05a72212c6f2985ff16ed281d2f55f13a8c7e391",
                "deletions": 1,
                "filename": "core/metamodel/src/main/java/org/apache/isis/metamodel/spec/EntityState.java",
                "patch": "@@ -21,7 +21,7 @@\n /**\n  * @since 2.0\n  */\n-public enum ManagedObjectState {\n+public enum EntityState {\n \n     not_Persistable,\n     persistable_Attached,",
                "previous_filename": "core/metamodel/src/main/java/org/apache/isis/metamodel/spec/ManagedObjectState.java",
                "raw_url": "https://github.com/apache/isis/raw/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/metamodel/src/main/java/org/apache/isis/metamodel/spec/EntityState.java",
                "sha": "6f2c852d8171226eef096da4436e3d7af867753a",
                "status": "renamed"
            },
            {
                "additions": 19,
                "blob_url": "https://github.com/apache/isis/blob/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/metamodel/src/main/java/org/apache/isis/metamodel/spec/ManagedObject.java",
                "changes": 37,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/metamodel/spec/ManagedObject.java?ref=05a72212c6f2985ff16ed281d2f55f13a8c7e391",
                "deletions": 18,
                "filename": "core/metamodel/src/main/java/org/apache/isis/metamodel/spec/ManagedObject.java",
                "patch": "@@ -22,7 +22,6 @@\n import java.util.Collection;\n import java.util.Collections;\n import java.util.List;\n-import java.util.Optional;\n import java.util.function.Function;\n import java.util.function.Predicate;\n import java.util.stream.Collectors;\n@@ -302,31 +301,33 @@ static boolean isNull(ManagedObject adapter) {\n         return adapter.getPojo()==null;\n     }\n     \n-    // -- DEPRECATIONS (in an attempt to decouple the metamodel from ObjectAdapter)\n-    @Deprecated\n-    static Optional<ObjectAdapter> promote(ManagedObject managedObject) {\n-        return Optional.ofNullable(managedObject)\n-        .filter(mo->mo instanceof ObjectAdapter) \n-        .map(ObjectAdapter.class::cast);\n-    }\n-\n-    // -- DEPRECATIONS - SPECIALIZED\n+    // -- DEPRECATIONS (REFACTORING)\n     \n     @Deprecated\n     static boolean _isDestroyed(ManagedObject adapter) {\n-        return ManagedObject.promote(adapter)\n-                .map(ObjectAdapter::isDestroyed)\n-                .orElseGet(()->!ManagedObject._oid(adapter).isPersistent());\n+        \n+        if(adapter==null || adapter.getPojo()==null) {\n+            return false;\n+        }\n+        \n+        val spec = adapter.getSpecification();\n+        if(!spec.isEntity()) {\n+            // services and view models are treated as persistent objects\n+            return false;\n+        }\n+        \n+        val entityFacet = spec.getFacet(EntityFacet.class);\n+        if(entityFacet==null) {\n+            return false;\n+        }\n+        \n+        val entityState = entityFacet.getEntityState(adapter.getPojo());\n+        return entityState == EntityState.persistable_Destroyed;\n     }\n \n     @Deprecated\n     static RootOid _collectionOidIfAny(ManagedObject adapter) {\n         return _rootOidIfAny(adapter);\n-//        val oid = ManagedObject.promote(adapter).getOid();\n-//        if(!(oid instanceof RootOid)) {\n-//            return null;\n-//        }\n-//        return (RootOid) oid;\n     }\n \n     @Deprecated",
                "raw_url": "https://github.com/apache/isis/raw/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/metamodel/src/main/java/org/apache/isis/metamodel/spec/ManagedObject.java",
                "sha": "28b8434c51cb60be3dbb29beab71d0ee8c38438a",
                "status": "modified"
            },
            {
                "additions": 9,
                "blob_url": "https://github.com/apache/isis/blob/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/plugins/jdo/common/src/main/java/org/apache/isis/jdo/metamodel/facets/object/persistencecapable/JdoPersistenceCapableFacetImpl.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/plugins/jdo/common/src/main/java/org/apache/isis/jdo/metamodel/facets/object/persistencecapable/JdoPersistenceCapableFacetImpl.java?ref=05a72212c6f2985ff16ed281d2f55f13a8c7e391",
                "deletions": 0,
                "filename": "core/plugins/jdo/common/src/main/java/org/apache/isis/jdo/metamodel/facets/object/persistencecapable/JdoPersistenceCapableFacetImpl.java",
                "patch": "@@ -28,6 +28,7 @@\n import org.apache.isis.jdo.metamodel.IsisJdoMetamodelPlugin;\n import org.apache.isis.metamodel.adapter.oid.Oid;\n import org.apache.isis.metamodel.facetapi.FacetHolder;\n+import org.apache.isis.metamodel.spec.EntityState;\n import org.apache.isis.metamodel.spec.ObjectSpecification;\n \n import lombok.val;\n@@ -86,6 +87,12 @@ public void persist(ObjectSpecification spec, Object pojo) {\n         //TODO don't bypass domain logic !? \n         persistenceSession.getJdoPersistenceManager().makePersistent(pojo);\n     }\n+    \n+    @Override\n+    public EntityState getEntityState(Object pojo) {\n+        val persistenceSession = super.getPersistenceSessionJdo();\n+        return persistenceSession.getEntityState(pojo);\n+    }\n \n     // -- HELPER\n     \n@@ -109,4 +116,6 @@ public boolean isProxyEnhancement(Method method) {\n     }\n \n \n+\n+\n }",
                "raw_url": "https://github.com/apache/isis/raw/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/plugins/jdo/common/src/main/java/org/apache/isis/jdo/metamodel/facets/object/persistencecapable/JdoPersistenceCapableFacetImpl.java",
                "sha": "67c09e0126029c298f46d7aaac86d737bf8c84f2",
                "status": "modified"
            },
            {
                "additions": 8,
                "blob_url": "https://github.com/apache/isis/blob/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/plugins/jdo/datanucleus-5/src/main/java/org/apache/isis/jdo/persistence/PersistenceSession5.java",
                "changes": 16,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/plugins/jdo/datanucleus-5/src/main/java/org/apache/isis/jdo/persistence/PersistenceSession5.java?ref=05a72212c6f2985ff16ed281d2f55f13a8c7e391",
                "deletions": 8,
                "filename": "core/plugins/jdo/datanucleus-5/src/main/java/org/apache/isis/jdo/persistence/PersistenceSession5.java",
                "patch": "@@ -82,7 +82,7 @@\n import org.apache.isis.metamodel.services.container.query.QueryCardinality;\n import org.apache.isis.metamodel.spec.FreeStandingList;\n import org.apache.isis.metamodel.spec.ManagedObject;\n-import org.apache.isis.metamodel.spec.ManagedObjectState;\n+import org.apache.isis.metamodel.spec.EntityState;\n import org.apache.isis.metamodel.spec.ObjectSpecification;\n import org.apache.isis.runtime.memento.Data;\n import org.apache.isis.runtime.persistence.FixturesInstalledState;\n@@ -550,7 +550,7 @@ public Object fetchPersistentPojo(final RootOid rootOid) {\n     @Override\n     public void refreshRoot(final Object domainObject) {\n \n-        val state = stateOf(domainObject);\n+        val state = getEntityState(domainObject);\n         val isRepresentingPersistent = state.isAttached() || state.isDestroyed();  \n \n         if(!isRepresentingPersistent) {\n@@ -740,7 +740,7 @@ public String identifierFor(final Object pojo) {\n      */\n     @Override\n     public void invokeIsisPersistingCallback(final Persistable pojo) {\n-        if (stateOf(pojo).isDetached()) {\n+        if (getEntityState(pojo).isDetached()) {\n             val managedObject = ManagedObject.of(specificationLoader::loadSpecification, pojo);\n \n             // persisting\n@@ -835,7 +835,7 @@ public void ensureRootObject(final Persistable pojo) {\n     }\n \n     @Override\n-    public ManagedObjectState stateOf(@Nullable Object pojo) {\n+    public EntityState getEntityState(@Nullable Object pojo) {\n \n         // guard against misuse\n         if(pojo instanceof ObjectAdapter) {\n@@ -846,15 +846,15 @@ public ManagedObjectState stateOf(@Nullable Object pojo) {\n             val persistable = (Persistable) pojo;\n             val isDeleted = persistable.dnIsDeleted();\n             if(isDeleted) {\n-                return ManagedObjectState.persistable_Destroyed;\n+                return EntityState.persistable_Destroyed;\n             }\n             val isPersistent = persistable.dnIsPersistent();\n             if(isPersistent) {\n-                return ManagedObjectState.persistable_Attached;\n+                return EntityState.persistable_Attached;\n             }\n-            return ManagedObjectState.persistable_Detached;\n+            return EntityState.persistable_Detached;\n         }\n-        return ManagedObjectState.not_Persistable;\n+        return EntityState.not_Persistable;\n     }\n \n     @Override",
                "raw_url": "https://github.com/apache/isis/raw/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/plugins/jdo/datanucleus-5/src/main/java/org/apache/isis/jdo/persistence/PersistenceSession5.java",
                "sha": "7bbddca1cfbdbf84de1c7085b7cc5f21f28978d9",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/isis/blob/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/runtime/src/main/java/org/apache/isis/runtime/memento/ObjectAdapterMementoDefault.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/runtime/memento/ObjectAdapterMementoDefault.java?ref=05a72212c6f2985ff16ed281d2f55f13a8c7e391",
                "deletions": 0,
                "filename": "core/runtime/src/main/java/org/apache/isis/runtime/memento/ObjectAdapterMementoDefault.java",
                "patch": "@@ -560,6 +560,10 @@ public ManagedObject getObjectAdapter(\n             SpecificationLoader specificationLoader) {\n         \n         val spec = specificationLoader.loadSpecification(objectSpecId);\n+        if(spec==null) {\n+            // eg. ill-formed request\n+            return null;\n+        }\n         \n         // intercept when trivial\n         if(spec.getBeanSort().isManagedBean()) {",
                "raw_url": "https://github.com/apache/isis/raw/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/runtime/src/main/java/org/apache/isis/runtime/memento/ObjectAdapterMementoDefault.java",
                "sha": "074e70011c9e24db06a5c63ad530284f1d87aaf2",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/isis/blob/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/runtime/src/main/java/org/apache/isis/runtime/persistence/adapter/PojoAdapter.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/runtime/persistence/adapter/PojoAdapter.java?ref=05a72212c6f2985ff16ed281d2f55f13a8c7e391",
                "deletions": 3,
                "filename": "core/runtime/src/main/java/org/apache/isis/runtime/persistence/adapter/PojoAdapter.java",
                "patch": "@@ -148,7 +148,7 @@ public boolean isTransient() {\n             return false;\n         }\n \n-        val state = persistenceSession.stateOf(pojo);\n+        val state = persistenceSession.getEntityState(pojo);\n         return state.isDetached();\n     }\n \n@@ -162,7 +162,7 @@ public boolean isRepresentingPersistent() {\n         if(persistenceSession==null) {\n             return false;\n         }\n-        val state = persistenceSession.stateOf(pojo);\n+        val state = persistenceSession.getEntityState(pojo);\n         val isRepresentingPersistent = state.isAttached() || state.isDestroyed();\n         return isRepresentingPersistent;\n     }\n@@ -177,7 +177,7 @@ public boolean isDestroyed() {\n         if(persistenceSession==null) {\n             return false;\n         }\n-        val state = persistenceSession.stateOf(pojo);\n+        val state = persistenceSession.getEntityState(pojo);\n         return state.isDestroyed();\n     }\n ",
                "raw_url": "https://github.com/apache/isis/raw/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/runtime/src/main/java/org/apache/isis/runtime/persistence/adapter/PojoAdapter.java",
                "sha": "80e6f6c583c474d0c2a61299760fabcea547c900",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/runtime/src/main/java/org/apache/isis/runtime/system/persistence/PersistenceSession.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/runtime/system/persistence/PersistenceSession.java?ref=05a72212c6f2985ff16ed281d2f55f13a8c7e391",
                "deletions": 2,
                "filename": "core/runtime/src/main/java/org/apache/isis/runtime/system/persistence/PersistenceSession.java",
                "patch": "@@ -32,7 +32,7 @@\n import org.apache.isis.metamodel.adapter.ObjectAdapterProvider;\n import org.apache.isis.metamodel.adapter.oid.Oid;\n import org.apache.isis.metamodel.adapter.oid.RootOid;\n-import org.apache.isis.metamodel.spec.ManagedObjectState;\n+import org.apache.isis.metamodel.spec.EntityState;\n import org.apache.isis.metamodel.spec.ObjectSpecification;\n import org.apache.isis.runtime.memento.Data;\n import org.apache.isis.runtime.persistence.FixturesInstalledState;\n@@ -87,7 +87,7 @@ default void refreshRootInTransaction(final Object domainObject) {\n     /**\n      * @since 2.0\n      */\n-    ManagedObjectState stateOf(Object pojo);\n+    EntityState getEntityState(Object pojo);\n \n     /** whether pojo is recognized by the persistence layer, that is, it has an ObjectId\n      * @since 2.0*/",
                "raw_url": "https://github.com/apache/isis/raw/05a72212c6f2985ff16ed281d2f55f13a8c7e391/core/runtime/src/main/java/org/apache/isis/runtime/system/persistence/PersistenceSession.java",
                "sha": "cb329d1ed0ad0ad15e292d65c1cf8e27d25227fa",
                "status": "modified"
            }
        ],
        "message": "ISIS-2177: some fixes\n\nre-implement code for proper object deleted detection\nprevent NPE on ill-formed request",
        "parent": "https://github.com/apache/isis/commit/162066f17351b4db79e53986bbf6807ad84217d4",
        "patched_files": [
            "PojoAdapter.java"
        ],
        "repo": "isis",
        "unit_tests": [
            "PojoAdapterTest.java"
        ]
    },
    "isis_0be6486": {
        "bug_id": "isis_0be6486",
        "commit": "https://github.com/apache/isis/commit/0be6486e8e853cf85f0f4acf3fbbdffbdd85b273",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/0be6486e8e853cf85f0f4acf3fbbdffbdd85b273/core/applib/src/main/java/org/apache/isis/applib/services/exceprecog/ExceptionRecognizerComposite.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/applib/src/main/java/org/apache/isis/applib/services/exceprecog/ExceptionRecognizerComposite.java?ref=0be6486e8e853cf85f0f4acf3fbbdffbdd85b273",
                "deletions": 1,
                "filename": "core/applib/src/main/java/org/apache/isis/applib/services/exceprecog/ExceptionRecognizerComposite.java",
                "patch": "@@ -117,7 +117,8 @@ public final Recognition recognize2(final Throwable ex) {\n     private void injectServicesIfNecessary() {\n         if(!injected) {\n             for (final ExceptionRecognizer ers : exceptionRecognizers) {\n-                container.injectServicesInto(ers);\n+                if (container != null)\n+                    container.injectServicesInto(ers);\n             }\n             injected = true;\n         }",
                "raw_url": "https://github.com/apache/isis/raw/0be6486e8e853cf85f0f4acf3fbbdffbdd85b273/core/applib/src/main/java/org/apache/isis/applib/services/exceprecog/ExceptionRecognizerComposite.java",
                "sha": "9232744f1c8a4605da839fb79de7660192578774",
                "status": "modified"
            }
        ],
        "message": "ISIS-1108: adding NPE guard to allow for the usage of ExceptionRecognizerComposite whereby it is simply instantiated and used as a wrapper around other instances of ExceptionRecognizer that have already been injected into.\n\nThis is done in several places in the Wicket viewer: EntityPropertiesForm, ActionPanel, WebRequestCycleForIsis",
        "parent": "https://github.com/apache/isis/commit/e9d63719a3ed8c1b4ca0bc63993b29ea65be94f2",
        "patched_files": [
            "ExceptionRecognizerComposite.java"
        ],
        "repo": "isis",
        "unit_tests": [
            "ExceptionRecognizerCompositeTest.java"
        ]
    },
    "isis_2acc1da": {
        "bug_id": "isis_2acc1da",
        "commit": "https://github.com/apache/isis/commit/2acc1da22593a254f20cdb714e2066aa96f9bdc3",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/2acc1da22593a254f20cdb714e2066aa96f9bdc3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/object/objectspecid/classname/ObjectSpecIdFacetDerivedFromClassNameFactory.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/object/objectspecid/classname/ObjectSpecIdFacetDerivedFromClassNameFactory.java?ref=2acc1da22593a254f20cdb714e2066aa96f9bdc3",
                "deletions": 1,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/object/objectspecid/classname/ObjectSpecIdFacetDerivedFromClassNameFactory.java",
                "patch": "@@ -74,7 +74,8 @@ public void process(final ProcessClassContext processClassContaxt) {\n     private static ObjectSpecIdFacet createObjectSpecIdFacet(final FacetHolder facetHolder, final Class<?> substitutedClass) {\n         final boolean isService = isService(facetHolder);\n         if (isService) {\n-            final String id = ServiceUtil.idOfType(substitutedClass);\n+            \n+            final String id = ServiceUtil.getExplicitelySpecifiedIdOfType(substitutedClass).orElse(null);\n             if (id != null) {\n                 return new ObjectSpecIdFacetDerivedFromDomainServiceAnnotationElseGetId(id, facetHolder);\n             }",
                "raw_url": "https://github.com/apache/isis/raw/2acc1da22593a254f20cdb714e2066aa96f9bdc3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/object/objectspecid/classname/ObjectSpecIdFacetDerivedFromClassNameFactory.java",
                "sha": "4d3d2ee74c8cd54a5eaf90977336a788f4423140",
                "status": "modified"
            },
            {
                "additions": 27,
                "blob_url": "https://github.com/apache/isis/blob/2acc1da22593a254f20cdb714e2066aa96f9bdc3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/services/ServiceUtil.java",
                "changes": 53,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/services/ServiceUtil.java?ref=2acc1da22593a254f20cdb714e2066aa96f9bdc3",
                "deletions": 26,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/services/ServiceUtil.java",
                "patch": "@@ -16,11 +16,10 @@\n  *  specific language governing permissions and limitations\n  *  under the License.\n  */\n-\n package org.apache.isis.core.metamodel.services;\n \n import java.lang.reflect.Method;\n-import java.util.function.Supplier;\n+import java.util.Optional;\n \n import org.apache.isis.applib.annotation.DomainService;\n import org.apache.isis.commons.internal.base._Strings;\n@@ -33,36 +32,39 @@\n     private ServiceUtil() {\n     }\n \n-    public static String idOfType(final Class<?> serviceClass) {\n-        \n-        final String serviceType = serviceTypeUsingAnnotation(serviceClass);\n-        if (serviceType != null) {\n-            return serviceType;\n-        }\n-\n-        return serviceTypeUsingIdGetterOrElseGet(serviceClass, ()->serviceClass.newInstance(), ()->null);\n-    }\n-\n     public static String idOfPojo(final Object serviceObject) {\n         final Class<?> serviceClass = serviceObject.getClass();\n-        final String serviceType = serviceTypeUsingAnnotation(serviceClass);\n-        if(serviceType != null) {\n-            return serviceType;\n-        }\n-\n-        return serviceTypeUsingIdGetterOrElseGet(serviceClass, ()->serviceObject, ()->normalize(serviceClass));\n+        return explicitelySpecifiedIdOfType(serviceClass, ()->serviceObject)\n+                .orElseGet(()->normalize(serviceClass));\n     }\n     \n     public static String idOfSpec(final ObjectSpecification serviceSpec) {\n-        return idOfType(serviceSpec.getCorrespondingClass());\n+        final Class<?> serviceClass = serviceSpec.getCorrespondingClass();\n+        return explicitelySpecifiedIdOfType(serviceClass, serviceClass::newInstance)\n+                .orElseGet(()->normalize(serviceClass));\n+    }\n+    \n+    public static String idOfAdapter(final ManagedObject serviceAdapter) {\n+        return idOfPojo(serviceAdapter.getPojo());\n     }\n     \n-    public static String idOfAdapter(final ManagedObject adapter) {\n-        return idOfPojo(adapter.getPojo());\n+    public static Optional<String> getExplicitelySpecifiedIdOfType(final Class<?> serviceClass) {\n+        return explicitelySpecifiedIdOfType(serviceClass, serviceClass::newInstance);\n     }\n     \n     // -- HELPER\n \n+    private static Optional<String> explicitelySpecifiedIdOfType(\n+            final Class<?> serviceClass, \n+            final _Functions.CheckedSupplier<Object> serviceInstanceSupplier) {\n+        \n+        final String serviceType = serviceTypeUsingAnnotation(serviceClass);\n+        if (serviceType != null) {\n+            return Optional.of(serviceType);\n+        }\n+        return serviceTypeUsingIdGetter(serviceClass, serviceInstanceSupplier);\n+    }\n+    \n     private static String serviceTypeUsingAnnotation(final Class<?> serviceClass) {\n         final String serviceType;\n         final DomainService domainService = serviceClass.getAnnotation(DomainService.class);\n@@ -75,17 +77,16 @@ private static String serviceTypeUsingAnnotation(final Class<?> serviceClass) {\n         return null;\n     }\n \n-    private static String serviceTypeUsingIdGetterOrElseGet(\n+    private static Optional<String> serviceTypeUsingIdGetter(\n             final Class<?> serviceClass, \n-            final _Functions.CheckedSupplier<Object> objectSupplier,\n-            final Supplier<String> orElse\n+            final _Functions.CheckedSupplier<Object> serviceInstanceSupplier\n             ) {\n         \n         try {\n             final Method m = serviceClass.getMethod(\"getId\");\n-            return (String) m.invoke(objectSupplier.get());\n+            return Optional.ofNullable((String) m.invoke(serviceInstanceSupplier.get()));\n         } catch (Exception e) {\n-            return orElse.get();\n+            return Optional.empty();\n         }\n     }\n     ",
                "raw_url": "https://github.com/apache/isis/raw/2acc1da22593a254f20cdb714e2066aa96f9bdc3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/services/ServiceUtil.java",
                "sha": "769fa6c6b08868d06fc7fd763b16d6c0903f01a1",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/isis/blob/2acc1da22593a254f20cdb714e2066aa96f9bdc3/core/metamodel/src/test/java/org/apache/isis/core/metamodel/services/ServiceUtil_Test.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/test/java/org/apache/isis/core/metamodel/services/ServiceUtil_Test.java?ref=2acc1da22593a254f20cdb714e2066aa96f9bdc3",
                "deletions": 4,
                "filename": "core/metamodel/src/test/java/org/apache/isis/core/metamodel/services/ServiceUtil_Test.java",
                "patch": "@@ -63,7 +63,7 @@ public void annotated() throws Exception {\n                 is(equalTo(\"foo.SomeServiceAnnotated\")));\n \n         assertThat(\n-                ServiceUtil.idOfType(SomeServiceAnnotated.class),\n+                ServiceUtil.getExplicitelySpecifiedIdOfType(SomeServiceAnnotated.class).orElse(null),\n                 is(equalTo(\"foo.SomeServiceAnnotated\")));\n     }\n \n@@ -75,7 +75,7 @@ public void id() throws Exception {\n                 is(equalTo(\"bar.SomeServiceWithId\")));\n \n         assertThat(\n-                ServiceUtil.idOfType(SomeServiceWithId.class),\n+                ServiceUtil.getExplicitelySpecifiedIdOfType(SomeServiceWithId.class).orElse(null),\n                 is(equalTo(\"bar.SomeServiceWithId\")));\n     }\n \n@@ -87,7 +87,7 @@ public void annotated_precedence_over_id() throws Exception {\n                 is(equalTo(\"bop.SomeServiceAnnotated\")));\n \n         assertThat(\n-                ServiceUtil.idOfType(SomeServiceAnnotatedAndWithId.class),\n+                ServiceUtil.getExplicitelySpecifiedIdOfType(SomeServiceAnnotatedAndWithId.class).orElse(null),\n                 is(equalTo(\"bop.SomeServiceAnnotated\")));\n     }\n \n@@ -97,7 +97,7 @@ public void fallback_to_fqcn_for_obj_but_to_null_for_service() throws Exception\n                 ServiceUtil.idOfPojo(new SomeServiceWithoutAnnotationOrId()),\n                 is(equalTo(\"org.apache.isis.core.metamodel.services.ServiceUtil_Test$SomeServiceWithoutAnnotationOrId\")));\n         assertThat(\n-                ServiceUtil.idOfType(SomeServiceWithoutAnnotationOrId.class),\n+                ServiceUtil.getExplicitelySpecifiedIdOfType(SomeServiceWithoutAnnotationOrId.class).orElse(null),\n                 is(nullValue()));\n     }\n ",
                "raw_url": "https://github.com/apache/isis/raw/2acc1da22593a254f20cdb714e2066aa96f9bdc3/core/metamodel/src/test/java/org/apache/isis/core/metamodel/services/ServiceUtil_Test.java",
                "sha": "cd266fb629d26a099f9314ab1efa251f330220a1",
                "status": "modified"
            }
        ],
        "message": "ISIS-1976: further cleanup ServiceUtil, fixes a NPE regression\n\nTask-Url: https://issues.apache.org/jira/browse/ISIS-1976",
        "parent": "https://github.com/apache/isis/commit/ed4ae6668e7e30ed2f313df7058a5a6078f6fc16",
        "patched_files": [
            "ServiceUtil.java",
            "ObjectSpecIdFacetDerivedFromClassNameFactory.java"
        ],
        "repo": "isis",
        "unit_tests": [
            "ServiceUtil_Test.java",
            "ObjectSpecIdFacetDerivedFromClassNameFactoryTest.java"
        ]
    },
    "isis_51f9408": {
        "bug_id": "isis_51f9408",
        "commit": "https://github.com/apache/isis/commit/51f9408a54f79df5986631106ce89d0c203eed0c",
        "file": [
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/isis/blob/51f9408a54f79df5986631106ce89d0c203eed0c/core/viewer-wicket-model/src/main/java/org/apache/isis/viewer/wicket/model/models/ActionModel.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/viewer-wicket-model/src/main/java/org/apache/isis/viewer/wicket/model/models/ActionModel.java?ref=51f9408a54f79df5986631106ce89d0c203eed0c",
                "deletions": 0,
                "filename": "core/viewer-wicket-model/src/main/java/org/apache/isis/viewer/wicket/model/models/ActionModel.java",
                "patch": "@@ -25,6 +25,8 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Map.Entry;\n+import java.util.Optional;\n+import java.util.function.Function;\n import java.util.regex.Matcher;\n import java.util.regex.Pattern;\n import java.util.stream.Stream;\n@@ -471,7 +473,9 @@ private ObjectAdapter executeAction() {\n                 final Object routeTo = routingService.route(result);\n                 return routeTo != null? getPersistenceSession().adapterFor(routeTo): null;\n             })\n+            .map(Optional::ofNullable)\n             .findFirst()\n+            .flatMap(Function.identity())\n             .orElse(resultAdapter);\n         \n     }",
                "raw_url": "https://github.com/apache/isis/raw/51f9408a54f79df5986631106ce89d0c203eed0c/core/viewer-wicket-model/src/main/java/org/apache/isis/viewer/wicket/model/models/ActionModel.java",
                "sha": "5109b8cb66c8763eb62cc91a2f37788b83afdd07",
                "status": "modified"
            }
        ],
        "message": "ISIS-2066: fixes NPE occurring when invoke an action that returns null\n\nfix as per the idiom described here: https://stackoverflow.com/a/32476601/56880",
        "parent": "https://github.com/apache/isis/commit/4cd48b5b943f94aa3ce8a1fb19f0d693db4f9737",
        "patched_files": [
            "ActionModel.java"
        ],
        "repo": "isis",
        "unit_tests": [
            "ActionModelTest.java"
        ]
    },
    "isis_6427dfb": {
        "bug_id": "isis_6427dfb",
        "commit": "https://github.com/apache/isis/commit/6427dfb1a4f2296c6aeaf6bf240af8a0cd2822cd",
        "file": [
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/isis/blob/6427dfb1a4f2296c6aeaf6bf240af8a0cd2822cd/component/viewer/wicket/model/src/main/java/org/apache/isis/viewer/wicket/model/mementos/ObjectAdapterMemento.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/component/viewer/wicket/model/src/main/java/org/apache/isis/viewer/wicket/model/mementos/ObjectAdapterMemento.java?ref=6427dfb1a4f2296c6aeaf6bf240af8a0cd2822cd",
                "deletions": 0,
                "filename": "component/viewer/wicket/model/src/main/java/org/apache/isis/viewer/wicket/model/mementos/ObjectAdapterMemento.java",
                "patch": "@@ -65,6 +65,7 @@ public static ObjectAdapterMemento createPersistent(final RootOid rootOid) {\n     }\n \n \n+\n     enum Type {\n         /**\n          * The {@link ObjectAdapter} that this is the memento for directly has\n@@ -349,6 +350,10 @@ public boolean equals(Object obj) {\n \n     @Override\n     public String toString() {\n+        return asString();\n+    }\n+\n+    public String asString() {\n         return type.toString(this);\n     }\n ",
                "raw_url": "https://github.com/apache/isis/raw/6427dfb1a4f2296c6aeaf6bf240af8a0cd2822cd/component/viewer/wicket/model/src/main/java/org/apache/isis/viewer/wicket/model/mementos/ObjectAdapterMemento.java",
                "sha": "72658fd4a9482756ee00923d06b58b8e279b6d56",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/6427dfb1a4f2296c6aeaf6bf240af8a0cd2822cd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/widgets/ObjectAdapterMementoProviderAbstract.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/widgets/ObjectAdapterMementoProviderAbstract.java?ref=6427dfb1a4f2296c6aeaf6bf240af8a0cd2822cd",
                "deletions": 2,
                "filename": "component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/widgets/ObjectAdapterMementoProviderAbstract.java",
                "patch": "@@ -34,7 +34,7 @@\n \n     private static final long serialVersionUID = 1L;\n     \n-    private static final String NULL_PLACEHOLDER = \"$$_isis_null_$$\";\n+    protected static final String NULL_PLACEHOLDER = \"$$_isis_null_$$\";\n     private static final String NULL_DISPLAY_TEXT = \"\";\n \n     private final ScalarModel scalarModel;\n@@ -50,7 +50,7 @@ protected String getDisplayText(ObjectAdapterMemento choice) {\n \n     @Override\n     protected Object getId(ObjectAdapterMemento choice) {\n-        return choice != null? choice.toString(): NULL_PLACEHOLDER;\n+        return choice != null? choice.asString(): NULL_PLACEHOLDER;\n     }\n \n     @Override",
                "raw_url": "https://github.com/apache/isis/raw/6427dfb1a4f2296c6aeaf6bf240af8a0cd2822cd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/widgets/ObjectAdapterMementoProviderAbstract.java",
                "sha": "956b4369239f52c82db71dbf268384cff5bcc935",
                "status": "modified"
            },
            {
                "additions": 42,
                "blob_url": "https://github.com/apache/isis/blob/6427dfb1a4f2296c6aeaf6bf240af8a0cd2822cd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/widgets/valuechoices/ValueChoicesSelect2Panel.java",
                "changes": 64,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/widgets/valuechoices/ValueChoicesSelect2Panel.java?ref=6427dfb1a4f2296c6aeaf6bf240af8a0cd2822cd",
                "deletions": 22,
                "filename": "component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/widgets/valuechoices/ValueChoicesSelect2Panel.java",
                "patch": "@@ -18,21 +18,19 @@\n \n import java.util.Collection;\n import java.util.List;\n-\n+import com.google.common.base.Function;\n import com.google.common.base.Predicate;\n import com.google.common.collect.Collections2;\n import com.google.common.collect.Lists;\n import com.vaynberg.wicket.select2.ChoiceProvider;\n import com.vaynberg.wicket.select2.Select2Choice;\n-\n import org.apache.wicket.AttributeModifier;\n import org.apache.wicket.Component;\n import org.apache.wicket.behavior.Behavior;\n import org.apache.wicket.markup.html.basic.Label;\n import org.apache.wicket.markup.html.form.FormComponentLabel;\n import org.apache.wicket.model.IModel;\n import org.apache.wicket.model.Model;\n-\n import org.apache.isis.core.metamodel.adapter.ObjectAdapter;\n import org.apache.isis.core.metamodel.adapter.mgr.AdapterManager.ConcurrencyChecking;\n import org.apache.isis.viewer.wicket.model.mementos.ObjectAdapterMemento;\n@@ -135,31 +133,52 @@ protected Component addComponentForCompact() {\n \n     \n     protected ChoiceProvider<ObjectAdapterMemento> newChoiceProvider(final List<ObjectAdapterMemento> choicesMementos) {\n-        ChoiceProvider<ObjectAdapterMemento> provider = new ObjectAdapterMementoProviderAbstract(getScalarModel()) {\n+        return new FixedObjectAdapterMementoProvider(getScalarModel(), choicesMementos);\n+    }\n+\n+\n+    static class FixedObjectAdapterMementoProvider extends ObjectAdapterMementoProviderAbstract {\n \n-            private static final long serialVersionUID = 1L;\n+        private static final long serialVersionUID = 1L;\n+        private final List<ObjectAdapterMemento> choicesMementos;\n \n-            @Override\n-            public Collection<ObjectAdapterMemento> toChoices(final Collection<String> ids) {\n-                final List<ObjectAdapterMemento> mementos = obtainMementos(null);\n-                final Predicate<ObjectAdapterMemento> predicate = new Predicate<ObjectAdapterMemento>() {\n+        public FixedObjectAdapterMementoProvider(\n+                final ScalarModel scalarModel,\n+                final List<ObjectAdapterMemento> choicesMementos) {\n+            super(scalarModel);\n+            this.choicesMementos = choicesMementos;\n+        }\n \n-                    @Override\n-                    public boolean apply(ObjectAdapterMemento input) {\n-                        final String id = (String) getId(input);\n-                        return ids.contains(id);\n+        @Override\n+        public Collection<ObjectAdapterMemento> toChoices(final Collection<String> ids) {\n+            final List<ObjectAdapterMemento> mementos = obtainMementos(null);\n+\n+            final Predicate<ObjectAdapterMemento> lookupOam = new Predicate<ObjectAdapterMemento>() {\n+                @Override\n+                public boolean apply(ObjectAdapterMemento input) {\n+                    final String id = (String) getId(input);\n+                    return ids.contains(id);\n+                }\n+            };\n+\n+            final Function<String, ObjectAdapterMemento> toOam = new Function<String, ObjectAdapterMemento>() {\n+                @Override\n+                public ObjectAdapterMemento apply(String input) {\n+                    if (NULL_PLACEHOLDER.equals(input)) {\n+                        return null;\n                     }\n-                };\n-                return Collections2.filter(mementos, predicate); \n-            }\n+                    final Collection<ObjectAdapterMemento> filteredCollection = Collections2.filter(mementos, lookupOam);\n+                    return filteredCollection.iterator().next();\n+                }\n+            };\n+            return Collections2.transform(ids, toOam);\n+        }\n \n-            @Override\n-            protected List<ObjectAdapterMemento> obtainMementos(String term) {\n-                return choicesMementos;\n-            }\n+        @Override\n+        protected List<ObjectAdapterMemento> obtainMementos(String term) {\n+            return choicesMementos;\n+        }\n \n-        };\n-        return provider;\n     }\n \n     @Override\n@@ -246,4 +265,5 @@ public void setPending(ObjectAdapterMemento pending) {\n     public ScalarModel getScalarModel() {\n         return scalarModel;\n     }\n+\n }",
                "raw_url": "https://github.com/apache/isis/raw/6427dfb1a4f2296c6aeaf6bf240af8a0cd2822cd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/widgets/valuechoices/ValueChoicesSelect2Panel.java",
                "sha": "c2a382d405f2bdca5a8fbc08ae2020f63bceea40",
                "status": "modified"
            },
            {
                "additions": 64,
                "blob_url": "https://github.com/apache/isis/blob/6427dfb1a4f2296c6aeaf6bf240af8a0cd2822cd/component/viewer/wicket/ui/src/test/java/org/apache/isis/viewer/wicket/ui/components/widgets/valuechoices/FixedObjectAdapterMementoProviderTest.java",
                "changes": 64,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/component/viewer/wicket/ui/src/test/java/org/apache/isis/viewer/wicket/ui/components/widgets/valuechoices/FixedObjectAdapterMementoProviderTest.java?ref=6427dfb1a4f2296c6aeaf6bf240af8a0cd2822cd",
                "deletions": 0,
                "filename": "component/viewer/wicket/ui/src/test/java/org/apache/isis/viewer/wicket/ui/components/widgets/valuechoices/FixedObjectAdapterMementoProviderTest.java",
                "patch": "@@ -0,0 +1,64 @@\n+package org.apache.isis.viewer.wicket.ui.components.widgets.valuechoices;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import com.google.common.collect.Lists;\n+import org.jmock.Expectations;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.apache.isis.core.unittestsupport.jmocking.JUnitRuleMockery2;\n+import org.apache.isis.viewer.wicket.model.mementos.ObjectAdapterMemento;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.nullValue;\n+\n+public class FixedObjectAdapterMementoProviderTest {\n+\n+    @Rule\n+    public JUnitRuleMockery2 context = JUnitRuleMockery2.createFor(JUnitRuleMockery2.Mode.INTERFACES_AND_CLASSES);\n+\n+    private List<ObjectAdapterMemento> mementos;\n+\n+    private ObjectAdapterMemento mockMemento1;\n+    private ObjectAdapterMemento mockMemento2;\n+    private ValueChoicesSelect2Panel.FixedObjectAdapterMementoProvider provider;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        mockMemento1 = mock(\"mockMemento1\");\n+        mockMemento2 = mock(\"mockMemento2\");\n+\n+        mementos = Lists.newArrayList(\n+                mockMemento1, mockMemento2\n+        );\n+\n+        provider = new ValueChoicesSelect2Panel.FixedObjectAdapterMementoProvider(null, mementos);\n+    }\n+\n+    @Test\n+    public void whenInList() throws Exception {\n+        final Collection<ObjectAdapterMemento> mementos = provider.toChoices(Collections.singletonList(\"mockMemento1\"));\n+        Assert.assertThat(mementos.size(), is(1));\n+        Assert.assertThat(mementos.iterator().next(), is(mockMemento1));\n+    }\n+\n+    @Test\n+    public void whenNullPlaceholder() throws Exception {\n+        final Collection<ObjectAdapterMemento> mementos = provider.toChoices(Collections.singletonList(\"$$_isis_null_$$\"));\n+        Assert.assertThat(mementos.size(), is(1));\n+        Assert.assertThat(mementos.iterator().next(), is(nullValue()));\n+    }\n+\n+    private ObjectAdapterMemento mock(final String id) {\n+        final ObjectAdapterMemento mock = context.mock(ObjectAdapterMemento.class, id);\n+        context.checking(new Expectations() {{\n+            allowing(mock).asString();\n+            will(returnValue(id));\n+        }});\n+        return mock;\n+    }\n+\n+}\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/isis/raw/6427dfb1a4f2296c6aeaf6bf240af8a0cd2822cd/component/viewer/wicket/ui/src/test/java/org/apache/isis/viewer/wicket/ui/components/widgets/valuechoices/FixedObjectAdapterMementoProviderTest.java",
                "sha": "93f662e21324eca3e6fac2fde3eb93dce26ed53a",
                "status": "added"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/isis/blob/6427dfb1a4f2296c6aeaf6bf240af8a0cd2822cd/example/application/simple_wicket_restful_jdo/fixture/src/main/java/fixture/simple/SimpleObjectsFixturesService.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/example/application/simple_wicket_restful_jdo/fixture/src/main/java/fixture/simple/SimpleObjectsFixturesService.java?ref=6427dfb1a4f2296c6aeaf6bf240af8a0cd2822cd",
                "deletions": 8,
                "filename": "example/application/simple_wicket_restful_jdo/fixture/src/main/java/fixture/simple/SimpleObjectsFixturesService.java",
                "patch": "@@ -18,8 +18,6 @@\n  */\n package fixture.simple;\n \n-import dom.simple.SimpleObjects;\n-\n import java.util.List;\n import org.apache.isis.applib.annotation.DomainService;\n import org.apache.isis.applib.annotation.MemberOrder;\n@@ -65,11 +63,5 @@ public Object installFixturesAndReturnFirst() {\n         return run.get(0).getObject();\n     }\n \n-    // //////////////////////////////////////\n-\n-    private SimpleObjects simpleObjects;\n-    public void injectSimpleObjects(SimpleObjects simpleObjects) {\n-        this.simpleObjects = simpleObjects;\n-    }\n \n }",
                "raw_url": "https://github.com/apache/isis/raw/6427dfb1a4f2296c6aeaf6bf240af8a0cd2822cd/example/application/simple_wicket_restful_jdo/fixture/src/main/java/fixture/simple/SimpleObjectsFixturesService.java",
                "sha": "12a9e2ba3b81c596642755c0d8de1aba2b398ad1",
                "status": "modified"
            }
        ],
        "message": "ISIS-835: fixed NPE, drop down for strings now ok for actions...\n\n... though still has an issue as a property (new value is just ignored).",
        "parent": "https://github.com/apache/isis/commit/ef5168feb0164e7f6b52454d2f1fda9c61a4be2b",
        "patched_files": [
            "ObjectAdapterMementoProviderAbstract.java",
            "ObjectAdapterMemento.java",
            "SimpleObjectsFixturesService.java",
            "ValueChoicesSelect2Panel.java"
        ],
        "repo": "isis",
        "unit_tests": [
            "FixedObjectAdapterMementoProviderTest.java"
        ]
    },
    "isis_7ba8fd6": {
        "bug_id": "isis_7ba8fd6",
        "commit": "https://github.com/apache/isis/commit/7ba8fd644d7a85a9a86a4406363871b62fa6cda6",
        "file": [
            {
                "additions": 16,
                "blob_url": "https://github.com/apache/isis/blob/7ba8fd644d7a85a9a86a4406363871b62fa6cda6/core/runtime/src/test/java/org/apache/isis/core/runtime/services/eventbus/EventBusServiceDefaultTest.java",
                "changes": 22,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/test/java/org/apache/isis/core/runtime/services/eventbus/EventBusServiceDefaultTest.java?ref=7ba8fd644d7a85a9a86a4406363871b62fa6cda6",
                "deletions": 6,
                "filename": "core/runtime/src/test/java/org/apache/isis/core/runtime/services/eventbus/EventBusServiceDefaultTest.java",
                "patch": "@@ -16,19 +16,21 @@\n  */\n package org.apache.isis.core.runtime.services.eventbus;\n \n-import java.util.Collections;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.nullValue;\n+import static org.junit.Assert.assertThat;\n \n-import com.google.common.collect.ImmutableMap;\n-import com.google.common.eventbus.Subscribe;\n+import java.util.Collections;\n+import java.util.List;\n \n+import org.apache.isis.applib.services.registry.ServiceRegistry;\n import org.junit.Before;\n import org.junit.Rule;\n import org.junit.Test;\n import org.junit.rules.ExpectedException;\n \n-import static org.hamcrest.Matchers.is;\n-import static org.hamcrest.Matchers.nullValue;\n-import static org.junit.Assert.assertThat;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.eventbus.Subscribe;\n \n public class EventBusServiceDefaultTest {\n \n@@ -37,6 +39,14 @@\n     @Before\n     public void setUp() throws Exception {\n         eventBusService = new EventBusServiceDefault() {\n+        \t{\n+        \t\tserviceRegistry = new ServiceRegistry() {\n+\t\t\t\t\t@Override public <T> Iterable<T> lookupServices(Class<T> service) { return null; }\n+\t\t\t\t\t@Override public <T> T lookupService(Class<T> service) { return null; }\n+\t\t\t\t\t@Override public <T> T injectServicesInto(T domainObject) {\treturn null; }\n+\t\t\t\t\t@Override public List<Object> getRegisteredServices() { return null; }\n+\t\t\t\t}; \n+        \t}\n         };\n     }\n ",
                "raw_url": "https://github.com/apache/isis/raw/7ba8fd644d7a85a9a86a4406363871b62fa6cda6/core/runtime/src/test/java/org/apache/isis/core/runtime/services/eventbus/EventBusServiceDefaultTest.java",
                "sha": "c919cf11ecf9d80d596777353d098aaa3e95d46a",
                "status": "modified"
            }
        ],
        "message": "ISIS-1845 fix EventBusServiceDefaultTest NPE",
        "parent": "https://github.com/apache/isis/commit/25f8b31600325efba432d9423fd7edb182e663ff",
        "patched_files": [],
        "repo": "isis",
        "unit_tests": [
            "EventBusServiceDefaultTest.java"
        ]
    },
    "isis_813a313": {
        "bug_id": "isis_813a313",
        "commit": "https://github.com/apache/isis/commit/813a313023c5a3285828174a53507df556196ecd",
        "file": [
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/applib/src/main/java/org/apache/isis/applib/annotation/Programmatic.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/applib/src/main/java/org/apache/isis/applib/annotation/Programmatic.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 1,
                "filename": "core/applib/src/main/java/org/apache/isis/applib/annotation/Programmatic.java",
                "patch": "@@ -44,7 +44,7 @@\n  * being discouraged because of the name clash with <tt>org.junit.Ignore</tt>).\n  */\n @Inherited\n-@Target({ ElementType.METHOD, ElementType.TYPE })\n+@Target({ ElementType.METHOD, ElementType.TYPE, ElementType.FIELD })\n @Retention(RetentionPolicy.RUNTIME)\n public @interface Programmatic {\n ",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/applib/src/main/java/org/apache/isis/applib/annotation/Programmatic.java",
                "sha": "80fe4cea3456a6893c834be058ca31f0e9be1a34",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/applib/src/main/java/org/apache/isis/applib/fixturescripts/BuilderScriptAbstract.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/applib/src/main/java/org/apache/isis/applib/fixturescripts/BuilderScriptAbstract.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 0,
                "filename": "core/applib/src/main/java/org/apache/isis/applib/fixturescripts/BuilderScriptAbstract.java",
                "patch": "@@ -24,6 +24,7 @@\n \n import org.apache.isis.applib.annotation.Programmatic;\n \n+@Programmatic\n public abstract class BuilderScriptAbstract<T,F extends BuilderScriptAbstract<T,F>>\n         extends FixtureScript implements WithPrereqs<T,F>, FixtureScriptWithExecutionStrategy {\n ",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/applib/src/main/java/org/apache/isis/applib/fixturescripts/BuilderScriptAbstract.java",
                "sha": "ff5fa4d9ad4f7dea67794dee0f39761ce1a98397",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/applib/src/main/java/org/apache/isis/applib/fixturescripts/clock/ClockFixture.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/applib/src/main/java/org/apache/isis/applib/fixturescripts/clock/ClockFixture.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 0,
                "filename": "core/applib/src/main/java/org/apache/isis/applib/fixturescripts/clock/ClockFixture.java",
                "patch": "@@ -23,12 +23,14 @@\n import org.joda.time.format.DateTimeFormat;\n import org.joda.time.format.DateTimeFormatter;\n \n+import org.apache.isis.applib.annotation.Programmatic;\n import org.apache.isis.applib.clock.Clock;\n import org.apache.isis.applib.fixtures.FixtureClock;\n import org.apache.isis.applib.fixturescripts.FixtureScript;\n import org.apache.isis.applib.fixturescripts.FixtureScriptWithExecutionStrategy;\n import org.apache.isis.applib.fixturescripts.FixtureScripts;\n \n+@Programmatic\n class ClockFixture extends FixtureScript implements FixtureScriptWithExecutionStrategy {\n \n     static ClockFixture setTo(final String date) {",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/applib/src/main/java/org/apache/isis/applib/fixturescripts/clock/ClockFixture.java",
                "sha": "e09c5b4f4a4972b6c24a127c093114c1136d4c93",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/applib/src/main/java/org/apache/isis/applib/fixturescripts/clock/TickingClockFixture.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/applib/src/main/java/org/apache/isis/applib/fixturescripts/clock/TickingClockFixture.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 0,
                "filename": "core/applib/src/main/java/org/apache/isis/applib/fixturescripts/clock/TickingClockFixture.java",
                "patch": "@@ -23,6 +23,7 @@\n import org.joda.time.format.DateTimeFormat;\n import org.joda.time.format.DateTimeFormatter;\n \n+import org.apache.isis.applib.annotation.Programmatic;\n import org.apache.isis.applib.clock.Clock;\n import org.apache.isis.applib.fixtures.FixtureClock;\n import org.apache.isis.applib.fixtures.TickingFixtureClock;\n@@ -31,6 +32,7 @@\n import org.apache.isis.applib.fixturescripts.FixtureScripts;\n \n \n+@Programmatic\n public class TickingClockFixture\n         extends FixtureScript\n         implements FixtureScriptWithExecutionStrategy {",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/applib/src/main/java/org/apache/isis/applib/fixturescripts/clock/TickingClockFixture.java",
                "sha": "c4d372003c8161e59b3d28badf97d544d3bcd314",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/applib/src/main/java/org/apache/isis/applib/fixturescripts/setup/PersonaEnumPersistAll.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/applib/src/main/java/org/apache/isis/applib/fixturescripts/setup/PersonaEnumPersistAll.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 0,
                "filename": "core/applib/src/main/java/org/apache/isis/applib/fixturescripts/setup/PersonaEnumPersistAll.java",
                "patch": "@@ -22,12 +22,14 @@\n \n import com.google.common.collect.Lists;\n \n+import org.apache.isis.applib.annotation.Programmatic;\n import org.apache.isis.applib.fixturescripts.BuilderScriptAbstract;\n import org.apache.isis.applib.fixturescripts.FixtureScript;\n import org.apache.isis.applib.fixturescripts.FixtureScriptWithExecutionStrategy;\n import org.apache.isis.applib.fixturescripts.FixtureScripts;\n import org.apache.isis.applib.fixturescripts.PersonaWithBuilderScript;\n \n+@Programmatic\n public class PersonaEnumPersistAll<E extends Enum<E> & PersonaWithBuilderScript<T,F>, T, F extends BuilderScriptAbstract<T,F>>\n         extends FixtureScript\n         implements FixtureScriptWithExecutionStrategy {",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/applib/src/main/java/org/apache/isis/applib/fixturescripts/setup/PersonaEnumPersistAll.java",
                "sha": "55061a54939083503638763214184256fe5574b9",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/applib/src/main/java/org/apache/isis/applib/fixturescripts/teardown/TeardownFixtureAbstract.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/applib/src/main/java/org/apache/isis/applib/fixturescripts/teardown/TeardownFixtureAbstract.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 0,
                "filename": "core/applib/src/main/java/org/apache/isis/applib/fixturescripts/teardown/TeardownFixtureAbstract.java",
                "patch": "@@ -23,9 +23,11 @@\n \n import com.google.common.base.Strings;\n \n+import org.apache.isis.applib.annotation.Programmatic;\n import org.apache.isis.applib.fixturescripts.FixtureScript;\n import org.apache.isis.applib.services.jdosupport.IsisJdoSupport;\n \n+@Programmatic\n public abstract class TeardownFixtureAbstract extends FixtureScript {\n \n     protected void deleteFrom(final Class cls) {",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/applib/src/main/java/org/apache/isis/applib/fixturescripts/teardown/TeardownFixtureAbstract.java",
                "sha": "b9d131adc31d2bcabe9cccd4ca5e3a2f1ff047a6",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/applib/src/main/java/org/apache/isis/applib/services/metamodel/MetaModelService6.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/applib/src/main/java/org/apache/isis/applib/services/metamodel/MetaModelService6.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 1,
                "filename": "core/applib/src/main/java/org/apache/isis/applib/services/metamodel/MetaModelService6.java",
                "patch": "@@ -73,7 +73,7 @@ private Config newConfigWith(final int x) {\n         }\n \n         public Config withPackagePrefix(final String packagePrefix) {\n-            final List<String> prefixes = Lists.newArrayList(packagePrefix);\n+            final List<String> prefixes = Lists.newArrayList(this.packagePrefixes);\n             prefixes.add(packagePrefix);\n             return new Config(mask, prefixes);\n         }",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/applib/src/main/java/org/apache/isis/applib/services/metamodel/MetaModelService6.java",
                "sha": "ccabfd629aa04c281d7772b3989a7788fcc928a9",
                "status": "modified"
            },
            {
                "additions": 31,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/applib/src/test/java/org/apache/isis/applib/services/metamodel/MetaModelService6_Config_Test.java",
                "changes": 34,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/applib/src/test/java/org/apache/isis/applib/services/metamodel/MetaModelService6_Config_Test.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 3,
                "filename": "core/applib/src/test/java/org/apache/isis/applib/services/metamodel/MetaModelService6_Config_Test.java",
                "patch": "@@ -2,6 +2,7 @@\n \n import org.junit.Test;\n \n+import static org.hamcrest.Matchers.emptyCollectionOf;\n import static org.hamcrest.Matchers.equalTo;\n import static org.hamcrest.Matchers.is;\n import static org.junit.Assert.assertNotSame;\n@@ -18,11 +19,38 @@ public void ignore_noop() throws Exception {\n         assertThat(config.isIgnoreNoop(), is(equalTo(false)));\n \n         // and when\n-        MetaModelService6.Config flags2 = config.withIgnoreNoop();\n+        MetaModelService6.Config config2 = config.withIgnoreNoop();\n \n         // then\n-        assertNotSame(config, flags2);\n+        assertNotSame(config, config2);\n         assertThat(config.isIgnoreNoop(), is(equalTo(false)));\n-        assertThat(flags2.isIgnoreNoop(), is(equalTo(true)));\n+        assertThat(config2.isIgnoreNoop(), is(equalTo(true)));\n+    }\n+\n+    @Test\n+    public void packages_prefixes() throws Exception {\n+\n+        // when\n+        MetaModelService6.Config config = new MetaModelService6.Config();\n+        // then\n+        assertThat(config.getPackagePrefixes(), is(emptyCollectionOf(String.class)));\n+\n+        // and when\n+        MetaModelService6.Config config2 = config.withPackagePrefix(\"org.foo\");\n+\n+        // then\n+        assertNotSame(config, config2);\n+        assertThat(config2.getPackagePrefixes().size(), is(equalTo(1)));\n+        assertThat(config2.getPackagePrefixes().get(0), is(equalTo(\"org.foo\")));\n+\n+        // and when\n+        MetaModelService6.Config config3 = config2.withPackagePrefix(\"org.bar\");\n+\n+        // then\n+        assertNotSame(config, config3);\n+        assertNotSame(config2, config3);\n+        assertThat(config3.getPackagePrefixes().size(), is(equalTo(2)));\n+        assertThat(config3.getPackagePrefixes().get(0), is(equalTo(\"org.foo\")));\n+        assertThat(config3.getPackagePrefixes().get(1), is(equalTo(\"org.bar\")));\n     }\n }\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/applib/src/test/java/org/apache/isis/applib/services/metamodel/MetaModelService6_Config_Test.java",
                "sha": "97f59ea8f9e8b544bec41a039fdc35b6469ee758",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/Annotations.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/Annotations.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 0,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/Annotations.java",
                "patch": "@@ -34,6 +34,7 @@\n import org.apache.isis.applib.annotation.Collection;\n import org.apache.isis.applib.annotation.CollectionLayout;\n import org.apache.isis.applib.annotation.MemberOrder;\n+import org.apache.isis.applib.annotation.Programmatic;\n import org.apache.isis.applib.annotation.Property;\n import org.apache.isis.applib.annotation.PropertyLayout;\n import org.apache.isis.applib.annotation.Title;\n@@ -281,6 +282,7 @@ public Field getField() {\n                     PropertyLayout.class,\n                     Collection.class,\n                     CollectionLayout.class,\n+                    Programmatic.class,\n                     MemberOrder.class,\n                     javax.annotation.Nullable.class,\n                     Title.class,",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/Annotations.java",
                "sha": "dcf04d93b48e32a0bd15e636d2a02c3e8ae4ec22",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/collections/disabled/fromimmutable/DisabledFacetOnCollectionDerivedFromImmutableFactory.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/collections/disabled/fromimmutable/DisabledFacetOnCollectionDerivedFromImmutableFactory.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 7,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/collections/disabled/fromimmutable/DisabledFacetOnCollectionDerivedFromImmutableFactory.java",
                "patch": "@@ -21,17 +21,11 @@\n \n import org.apache.isis.core.metamodel.facetapi.FacetUtil;\n import org.apache.isis.core.metamodel.facetapi.FeatureType;\n-import org.apache.isis.core.metamodel.facets.FacetFactory;\n import org.apache.isis.core.metamodel.facets.FacetFactoryAbstract;\n import org.apache.isis.core.metamodel.facets.FacetedMethod;\n import org.apache.isis.core.metamodel.facets.object.immutable.ImmutableFacet;\n import org.apache.isis.core.metamodel.spec.ObjectSpecification;\n \n-/**\n- * REVIEW: I'm not sure this {@link FacetFactory} actually makes sense. Just\n- * because a type is immutable, doesn't imply that the property can't change the\n- * instance that it refers to?\n- */\n public class DisabledFacetOnCollectionDerivedFromImmutableFactory extends FacetFactoryAbstract {\n \n     public DisabledFacetOnCollectionDerivedFromImmutableFactory() {\n@@ -40,7 +34,8 @@ public DisabledFacetOnCollectionDerivedFromImmutableFactory() {\n \n     @Override\n     public void process(final ProcessMethodContext processMethodContext) {\n-        final ObjectSpecification spec = getSpecificationLoader().loadSpecification(processMethodContext.getMethod().getDeclaringClass());\n+        final Class<?> declaringClass = processMethodContext.getMethod().getDeclaringClass();\n+        final ObjectSpecification spec = getSpecificationLoader().loadSpecification(declaringClass);\n         if (spec.containsDoOpFacet(ImmutableFacet.class)) {\n             final ImmutableFacet immutableFacet = spec.getFacet(ImmutableFacet.class);\n             final FacetedMethod facetHolder = processMethodContext.getFacetHolder();",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/collections/disabled/fromimmutable/DisabledFacetOnCollectionDerivedFromImmutableFactory.java",
                "sha": "e09f26347d9257024a171a14a04efba99dc1a0b3",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/members/describedas/annotprop/DescribedAsFacetOnMemberFactory.java",
                "changes": 19,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/members/describedas/annotprop/DescribedAsFacetOnMemberFactory.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 16,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/members/describedas/annotprop/DescribedAsFacetOnMemberFactory.java",
                "patch": "@@ -32,7 +32,6 @@\n import org.apache.isis.core.metamodel.facets.FacetFactoryAbstract;\n import org.apache.isis.core.metamodel.facets.all.describedas.DescribedAsFacet;\n import org.apache.isis.core.metamodel.services.ServicesInjector;\n-import org.apache.isis.core.metamodel.spec.ObjectSpecification;\n import org.apache.isis.core.metamodel.specloader.validator.MetaModelValidatorComposite;\n import org.apache.isis.core.metamodel.specloader.validator.MetaModelValidatorForDeprecatedAnnotation;\n \n@@ -52,10 +51,9 @@ public void process(final ProcessMethodContext processMethodContext) {\n         if(facet == null) {\n             facet = validator.flagIfPresent(createFromAnnotationIfPossible(processMethodContext), processMethodContext);\n         }\n-        if (facet == null) {\n-            facet = createFromAnnotationOnReturnTypeIfPossible(processMethodContext);\n-        }\n-        \n+\n+        // facet derived from type moved to post-processor\n+\n         // no-op if null\n         FacetUtil.addFacet(facet);\n     }\n@@ -82,17 +80,6 @@ private static DescribedAsFacet createFromAnnotationIfPossible(final ProcessMeth\n         return annotation == null ? null : new DescribedAsFacetOnMemberAnnotation(annotation.value(), processMethodContext.getFacetHolder());\n     }\n \n-    private DescribedAsFacet createFromAnnotationOnReturnTypeIfPossible(final ProcessMethodContext processMethodContext) {\n-        final Class<?> returnType = processMethodContext.getMethod().getReturnType();\n-        final DescribedAsFacet returnTypeDescribedAsFacet = getDescribedAsFacet(returnType);\n-        return returnTypeDescribedAsFacet != null ? new DescribedAsFacetOnMemberDerivedFromType(returnTypeDescribedAsFacet, processMethodContext.getFacetHolder()) : null;\n-    }\n-    \n-    private DescribedAsFacet getDescribedAsFacet(final Class<?> type) {\n-        final ObjectSpecification paramTypeSpec = getSpecificationLoader().loadSpecification(type);\n-        return paramTypeSpec.getFacet(DescribedAsFacet.class);\n-    }\n-\n \n     @Override\n     public void refineMetaModelValidator(final MetaModelValidatorComposite metaModelValidator, final IsisConfiguration configuration) {",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/members/describedas/annotprop/DescribedAsFacetOnMemberFactory.java",
                "sha": "55b87d0eef5e7c1af921fcdea71c7cd5702a1540",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/object/objectspecid/classname/ObjectSpecIdFacetDerivedFromClassNameFactory.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/object/objectspecid/classname/ObjectSpecIdFacetDerivedFromClassNameFactory.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 1,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/object/objectspecid/classname/ObjectSpecIdFacetDerivedFromClassNameFactory.java",
                "patch": "@@ -24,6 +24,7 @@\n import javax.xml.bind.annotation.XmlType;\n \n import org.apache.isis.applib.annotation.NatureOfService;\n+import org.apache.isis.applib.fixturescripts.FixtureScript;\n import org.apache.isis.core.commons.config.IsisConfiguration;\n import org.apache.isis.core.metamodel.facetapi.FacetHolder;\n import org.apache.isis.core.metamodel.facetapi.FacetUtil;\n@@ -118,7 +119,10 @@ private void validate(\n                             return;\n                         }\n                         ObjectSpecIdFacet objectSpecIdFacet = objectSpec.getFacet(ObjectSpecIdFacet.class);\n-                        if(objectSpecIdFacet instanceof ObjectSpecIdFacetDerivedFromClassName) {\n+                        if(objectSpecIdFacet instanceof ObjectSpecIdFacetDerivedFromClassName &&\n+                           // as a special case, don't enforce this for fixture scripts... we never invoke actions on fixture scripts anyway\n+                           !FixtureScript.class.isAssignableFrom(objectSpec.getCorrespondingClass()) ) {\n+\n                             validationFailures.add(\n                                     \"%s: the object type must be specified explicitly ('%s' config property).  Defaulting the object type from the package/class/package name can lead to data migration issues for apps deployed to production (if the class is subsequently refactored).  Use @Discriminator, @DomainObject(objectType=...) or @PersistenceCapable(schema=...) to specify explicitly.\",\n                                     objectSpec.getFullIdentifier(), ISIS_REFLECTOR_VALIDATOR_EXPLICIT_OBJECT_TYPE_KEY);",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/object/objectspecid/classname/ObjectSpecIdFacetDerivedFromClassNameFactory.java",
                "sha": "312b8caf854ee4b1d82e7f5757dd1aa539230e8a",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/param/defaults/fromtype/ActionParameterDefaultFacetDerivedFromTypeFactory.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/param/defaults/fromtype/ActionParameterDefaultFacetDerivedFromTypeFactory.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 2,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/param/defaults/fromtype/ActionParameterDefaultFacetDerivedFromTypeFactory.java",
                "patch": "@@ -23,10 +23,10 @@\n import org.apache.isis.core.metamodel.facetapi.FeatureType;\n import org.apache.isis.core.metamodel.facets.FacetFactoryAbstract;\n import org.apache.isis.core.metamodel.facets.actions.defaults.ActionDefaultsFacet;\n-import org.apache.isis.core.metamodel.spec.ObjectSpecification;\n import org.apache.isis.core.metamodel.facets.object.defaults.DefaultedFacet;\n+import org.apache.isis.core.metamodel.spec.ObjectSpecification;\n \n-public class ActionParameterDefaultFacetDerivedFromTypeFactory extends FacetFactoryAbstract {\n+public class ActionParameterDefaultFacetDerivedFromTypeFactory extends FacetFactoryAbstract  {\n \n     public ActionParameterDefaultFacetDerivedFromTypeFactory() {\n         super(FeatureType.PARAMETERS_ONLY);",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/param/defaults/fromtype/ActionParameterDefaultFacetDerivedFromTypeFactory.java",
                "sha": "4ec136edb7990e77653e851b0380256b233627ce",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/properties/disabled/fromimmutable/DisabledFacetOnPropertyDerivedFromImmutableFactory.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/properties/disabled/fromimmutable/DisabledFacetOnPropertyDerivedFromImmutableFactory.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 7,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/properties/disabled/fromimmutable/DisabledFacetOnPropertyDerivedFromImmutableFactory.java",
                "patch": "@@ -21,18 +21,12 @@\n \n import org.apache.isis.core.metamodel.facetapi.FacetUtil;\n import org.apache.isis.core.metamodel.facetapi.FeatureType;\n-import org.apache.isis.core.metamodel.facets.FacetFactory;\n import org.apache.isis.core.metamodel.facets.FacetFactoryAbstract;\n import org.apache.isis.core.metamodel.facets.FacetedMethod;\n import org.apache.isis.core.metamodel.facets.members.disabled.DisabledFacet;\n import org.apache.isis.core.metamodel.facets.object.immutable.ImmutableFacet;\n import org.apache.isis.core.metamodel.spec.ObjectSpecification;\n \n-/**\n- * REVIEW: I'm not sure this {@link FacetFactory} actually makes sense. Just\n- * because a type is immutable, doesn't imply that the property can't change the\n- * instance that it refers to?\n- */\n public class DisabledFacetOnPropertyDerivedFromImmutableFactory extends FacetFactoryAbstract {\n \n     public DisabledFacetOnPropertyDerivedFromImmutableFactory() {\n@@ -41,7 +35,9 @@ public DisabledFacetOnPropertyDerivedFromImmutableFactory() {\n \n     @Override\n     public void process(final ProcessMethodContext processMethodContext) {\n-        final ObjectSpecification spec = getSpecificationLoader().loadSpecification(processMethodContext.getMethod().getDeclaringClass());\n+        final Class<?> declaringClass = processMethodContext.getMethod().getDeclaringClass();\n+        final ObjectSpecification spec = getSpecificationLoader().loadSpecification(\n+                declaringClass);\n         if (spec.containsDoOpFacet(ImmutableFacet.class)) {\n             final ImmutableFacet immutableFacet = spec.getFacet(ImmutableFacet.class);\n             final FacetedMethod facetHolder = processMethodContext.getFacetHolder();",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/properties/disabled/fromimmutable/DisabledFacetOnPropertyDerivedFromImmutableFactory.java",
                "sha": "93b92544703ee73291acb7c6a55555db31e2e803",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/properties/typicallen/fromtype/TypicalLengthFacetOnPropertyDerivedFromType.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/properties/typicallen/fromtype/TypicalLengthFacetOnPropertyDerivedFromType.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 1,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/properties/typicallen/fromtype/TypicalLengthFacetOnPropertyDerivedFromType.java",
                "patch": "@@ -38,7 +38,7 @@ public TypicalLengthFacetOnPropertyDerivedFromType(final TypicalLengthFacet typi\n     @Override\n     public int value() {\n         final MultiLineFacet facet = getFacetHolder().getFacet(MultiLineFacet.class);\n-        return facet.numberOfLines() * typicalLengthFacet.value();\n+        return (facet != null ? facet.numberOfLines() : 1) * typicalLengthFacet.value();\n     }\n \n     @Override public void appendAttributesTo(final Map<String, Object> attributeMap) {",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/properties/typicallen/fromtype/TypicalLengthFacetOnPropertyDerivedFromType.java",
                "sha": "f6ea2def80a2f69f285c60ee8592cd3fa65a98eb",
                "status": "modified"
            },
            {
                "additions": 309,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/postprocessors/param/ActionCollectionParameterDefaultsAndChoicesPostProcessor.java",
                "changes": 335,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/postprocessors/param/ActionCollectionParameterDefaultsAndChoicesPostProcessor.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 26,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/postprocessors/param/ActionCollectionParameterDefaultsAndChoicesPostProcessor.java",
                "patch": "@@ -31,9 +31,40 @@\n import org.apache.isis.core.metamodel.deployment.DeploymentCategoryProvider;\n import org.apache.isis.core.metamodel.facetapi.Facet;\n import org.apache.isis.core.metamodel.facetapi.FacetUtil;\n+import org.apache.isis.core.metamodel.facets.FacetedMethod;\n+import org.apache.isis.core.metamodel.facets.TypedHolder;\n+import org.apache.isis.core.metamodel.facets.actions.defaults.ActionDefaultsFacet;\n+import org.apache.isis.core.metamodel.facets.all.describedas.DescribedAsFacet;\n+import org.apache.isis.core.metamodel.facets.collections.disabled.fromimmutable.DisabledFacetOnCollectionDerivedFromImmutable;\n+import org.apache.isis.core.metamodel.facets.collections.disabled.fromimmutable.DisabledFacetOnCollectionDerivedFromImmutableFactory;\n+import org.apache.isis.core.metamodel.facets.members.describedas.annotprop.DescribedAsFacetOnMemberDerivedFromType;\n+import org.apache.isis.core.metamodel.facets.members.describedas.annotprop.DescribedAsFacetOnMemberFactory;\n+import org.apache.isis.core.metamodel.facets.members.disabled.DisabledFacet;\n+import org.apache.isis.core.metamodel.facets.object.defaults.DefaultedFacet;\n+import org.apache.isis.core.metamodel.facets.object.immutable.ImmutableFacet;\n+import org.apache.isis.core.metamodel.facets.object.immutable.immutableannot.CopyImmutableFacetOntoMembersFactory;\n+import org.apache.isis.core.metamodel.facets.objectvalue.choices.ChoicesFacet;\n+import org.apache.isis.core.metamodel.facets.objectvalue.typicallen.TypicalLengthFacet;\n import org.apache.isis.core.metamodel.facets.param.autocomplete.ActionParameterAutoCompleteFacet;\n import org.apache.isis.core.metamodel.facets.param.choices.ActionParameterChoicesFacet;\n+import org.apache.isis.core.metamodel.facets.param.choices.enums.ActionParameterChoicesFacetDerivedFromChoicesFacet;\n+import org.apache.isis.core.metamodel.facets.param.choices.enums.ActionParameterChoicesFacetDerivedFromChoicesFacetFactory;\n import org.apache.isis.core.metamodel.facets.param.defaults.ActionParameterDefaultsFacet;\n+import org.apache.isis.core.metamodel.facets.param.defaults.fromtype.ActionParameterDefaultFacetDerivedFromTypeFacets;\n+import org.apache.isis.core.metamodel.facets.param.describedas.annotderived.DescribedAsFacetOnParameterAnnotationElseDerivedFromTypeFactory;\n+import org.apache.isis.core.metamodel.facets.param.describedas.annotderived.DescribedAsFacetOnParameterDerivedFromType;\n+import org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromType;\n+import org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromTypeFacetFactory;\n+import org.apache.isis.core.metamodel.facets.properties.choices.PropertyChoicesFacet;\n+import org.apache.isis.core.metamodel.facets.properties.choices.enums.PropertyChoicesFacetDerivedFromChoicesFacet;\n+import org.apache.isis.core.metamodel.facets.properties.choices.enums.PropertyChoicesFacetDerivedFromChoicesFacetFactory;\n+import org.apache.isis.core.metamodel.facets.properties.defaults.PropertyDefaultFacet;\n+import org.apache.isis.core.metamodel.facets.properties.defaults.fromtype.PropertyDefaultFacetDerivedFromDefaultedFacet;\n+import org.apache.isis.core.metamodel.facets.properties.defaults.fromtype.PropertyDefaultFacetDerivedFromTypeFactory;\n+import org.apache.isis.core.metamodel.facets.properties.disabled.fromimmutable.DisabledFacetOnPropertyDerivedFromImmutable;\n+import org.apache.isis.core.metamodel.facets.properties.disabled.fromimmutable.DisabledFacetOnPropertyDerivedFromImmutableFactory;\n+import org.apache.isis.core.metamodel.facets.properties.typicallen.fromtype.TypicalLengthFacetOnPropertyDerivedFromType;\n+import org.apache.isis.core.metamodel.facets.properties.typicallen.fromtype.TypicalLengthFacetOnPropertyDerivedFromTypeFacetFactory;\n import org.apache.isis.core.metamodel.progmodel.ObjectSpecificationPostProcessor;\n import org.apache.isis.core.metamodel.services.ServicesInjector;\n import org.apache.isis.core.metamodel.services.ServicesInjectorAware;\n@@ -43,11 +74,18 @@\n import org.apache.isis.core.metamodel.spec.feature.Contributed;\n import org.apache.isis.core.metamodel.spec.feature.ObjectAction;\n import org.apache.isis.core.metamodel.spec.feature.ObjectActionParameter;\n+import org.apache.isis.core.metamodel.spec.feature.ObjectAssociation;\n+import org.apache.isis.core.metamodel.spec.feature.ObjectMember;\n import org.apache.isis.core.metamodel.spec.feature.OneToManyAssociation;\n+import org.apache.isis.core.metamodel.spec.feature.OneToOneAssociation;\n import org.apache.isis.core.metamodel.specloader.SpecificationLoader;\n+import org.apache.isis.core.metamodel.specloader.specimpl.ObjectActionParameterAbstract;\n+import org.apache.isis.core.metamodel.specloader.specimpl.ObjectMemberAbstract;\n \n /**\n  * Sets up all the {@link Facet}s for an action in a single shot.\n+ *\n+ * TODO: rename this class because it does much more than its name suggests.\n  */\n public class ActionCollectionParameterDefaultsAndChoicesPostProcessor implements ObjectSpecificationPostProcessor,\n         ServicesInjectorAware {\n@@ -67,9 +105,49 @@ public void postProcess(final ObjectSpecification objectSpecification) {\n         // and all the collections of this type\n         final List<OneToManyAssociation> collections = objectSpecification.getCollections(Contributed.INCLUDED);\n \n+        // and all the properties of this type\n+        final List<OneToOneAssociation> properties = objectSpecification.getProperties(Contributed.INCLUDED);\n+\n+        // for each action, ...\n+        for (final ObjectAction objectAction : objectActions) {\n+\n+            // ... for each action parameter\n+            final List<ObjectActionParameter> parameters = objectAction.getParameters();\n+\n+            for (final ObjectActionParameter parameter : parameters) {\n+\n+                deriveParameterDefaultFacetFromType(parameter);\n+                deriveParameterChoicesFromExistingChoices(parameter);\n+                deriveParameterDescribedAsFromType(parameter);\n+                deriveParameterTypicalLengthFromType(parameter);\n+            }\n+\n+            deriveActionDescribedAsFromType(objectAction);\n+\n+            // previously was also copying ImmutableFacet from spec onto Action (as for properties and collections ...\n+            // corresponds to CopyImmutableFacetOntoMembersFactory.  However, ImmutableFacet only ever disables for\n+            // properties and collections, so no point in copying over.\n+\n+        }\n+\n+        // for each property, ...\n+        for (final OneToOneAssociation property : properties) {\n+            derivePropertyChoicesFromExistingChoices(property);\n+            derivePropertyDefaultsFromType(property);\n+            derivePropertyTypicalLengthFromType(property);\n+            derivePropertyOrCollectionDescribedAsFromType(property);\n+            derivePropertyOrCollectionImmutableFromSpec(property);\n+            derivePropertyDisabledFromImmutable(property);\n+        }\n+\n+\n         // for each collection, ...\n         for (final OneToManyAssociation collection : collections) {\n \n+            derivePropertyOrCollectionDescribedAsFromType(collection);\n+            derivePropertyOrCollectionImmutableFromSpec(collection);\n+            deriveCollectionDisabledFromImmutable(collection);\n+\n             // ... see if any of its actions has a collection parameter of the same type\n             //\n             // eg Order#getItems() and Order#removeItems(List<OrderItem>)\n@@ -100,56 +178,261 @@ public void postProcess(final ObjectSpecification objectSpecification) {\n                 // this will cause the UI to render the collection with toggleboxes\n                 // with a thread-local used to provide the selected objects\n                 for (final ObjectActionParameter collectionParam : compatibleCollectionParams) {\n-                    addDefaultsFacetIfNoneAlready(collectionParam);\n+                    addCollectionParamDefaultsFacetIfNoneAlready(collectionParam);\n                 }\n \n                 // for compatible collection parameters, install a choices facet (if there isn't one already)\n                 // using the associated collection for its values\n                 for (final ObjectActionParameter collectionParam : compatibleCollectionParams) {\n-                    addChoicesFacetIfNoneAlready(collection, collectionParam);\n+                    addCollectionParamChoicesFacetIfNoneAlready(collection, collectionParam);\n                 }\n \n                 // similarly for compatible scalar parameters, install a choices facet (if there isn't one already)\n                 // using the associated collection for its values.\n                 for (final ObjectActionParameter scalarParam : compatibleScalarParams) {\n-                    addChoicesFacetIfNoneAlready(collection, scalarParam);\n+                    addCollectionParamChoicesFacetIfNoneAlready(collection, scalarParam);\n                 }\n             }\n         }\n     }\n \n-    private void addDefaultsFacetIfNoneAlready(final ObjectActionParameter collectionParam) {\n-        final ActionParameterDefaultsFacet defaultsFacet =\n-                collectionParam.getFacet(ActionParameterDefaultsFacet.class);\n-        if (existsAndNotDerived(defaultsFacet)) {\n-            // don't overwrite existing facet\n-        } else {\n-            FacetUtil.addFacet(new ActionParameterDefaultsFacetFromAssociatedCollection(collectionParam));\n+    private FacetedMethod facetedMethodFor(final ObjectMember objectMember) {\n+        // TODO: hacky, need to copy facet onto underlying peer, not to the action/association itself.\n+        final ObjectMemberAbstract objectActionImpl = (ObjectMemberAbstract) objectMember;\n+        return objectActionImpl.getFacetedMethod();\n+    }\n+    private TypedHolder peerFor(final ObjectActionParameter param) {\n+        // TODO: hacky, need to copy facet onto underlying peer, not to the param itself.\n+        final ObjectActionParameterAbstract objectActionImpl = (ObjectActionParameterAbstract) param;\n+        return objectActionImpl.getPeer();\n+    }\n+\n+    /**\n+     * Replaces some of the functionality in {@link DescribedAsFacetOnMemberFactory}.\n+     */\n+    private void deriveActionDescribedAsFromType(final ObjectAction objectAction) {\n+        if(objectAction.containsDoOpFacet(DescribedAsFacet.class)) {\n+            return;\n+        }\n+        final ObjectSpecification returnSpec = objectAction.getReturnType();\n+        final DescribedAsFacet specFacet = returnSpec.getFacet(DescribedAsFacet.class);\n+        //TODO: this ought to check if a do-op; if you come across this, you can probably change it (just taking smaller steps for now)\n+        //if(existsAndIsDoOp(specFacet)) {\n+        if(specFacet != null) {\n+            FacetUtil.addFacet(new DescribedAsFacetOnMemberDerivedFromType(specFacet, facetedMethodFor(objectAction)));\n         }\n     }\n \n-    private void addChoicesFacetIfNoneAlready(\n-            final OneToManyAssociation otma,\n-            final ObjectActionParameter scalarOrCollectionParam) {\n+    /**\n+     * Replaces {@link org.apache.isis.core.metamodel.facets.param.defaults.fromtype.ActionParameterDefaultFacetDerivedFromTypeFactory}\n+     */\n+    private void deriveParameterDefaultFacetFromType(final ObjectActionParameter parameter) {\n \n-        final ActionParameterChoicesFacet choicesFacet = scalarOrCollectionParam\n-                .getFacet(ActionParameterChoicesFacet.class);\n-        final ActionParameterAutoCompleteFacet autoCompleteFacet = scalarOrCollectionParam\n-                .getFacet(ActionParameterAutoCompleteFacet.class);\n+        if (parameter.containsDoOpFacet(ActionDefaultsFacet.class)) {\n+            return;\n+        }\n+\n+        // this loop within the outer loop (for every param) is really weird,\n+        // but arises from porting the old facet factory\n+        final ObjectAction objectAction = parameter.getAction();\n+        final List<ObjectSpecification> parameterSpecs = objectAction.getParameterTypes();\n+        final DefaultedFacet[] parameterTypeDefaultedFacets = new DefaultedFacet[parameterSpecs.size()];\n+        boolean hasAtLeastOneDefault = false;\n+        for (int i = 0; i < parameterSpecs.size(); i++) {\n+            final ObjectSpecification parameterSpec = parameterSpecs.get(i);\n+            parameterTypeDefaultedFacets[i] = parameterSpec.getFacet(DefaultedFacet.class);\n+            hasAtLeastOneDefault = hasAtLeastOneDefault | (parameterTypeDefaultedFacets[i] != null);\n+        }\n+        if (hasAtLeastOneDefault) {\n+            FacetUtil.addFacet(\n+                new ActionParameterDefaultFacetDerivedFromTypeFacets(parameterTypeDefaultedFacets, peerFor(parameter)));\n+        }\n+    }\n+\n+    /**\n+     * Replaces {@link ActionParameterChoicesFacetDerivedFromChoicesFacetFactory}.\n+     */\n+    private void deriveParameterChoicesFromExistingChoices(final ObjectActionParameter parameter) {\n+        if(parameter.containsDoOpFacet(ActionParameterChoicesFacet.class)) {\n+            return;\n+        }\n+        final ObjectSpecification paramSpec = parameter.getSpecification();\n+        final ChoicesFacet specFacet = paramSpec.getFacet(ChoicesFacet.class);\n+        if(existsAndIsDoOp(specFacet)) {\n+            FacetUtil.addFacet(\n+                new ActionParameterChoicesFacetDerivedFromChoicesFacet(\n+                    peerFor(parameter),\n+                    getDeploymentCategory(), specificationLoader, authenticationSessionProvider, adapterManager));\n+        }\n+    }\n \n-        if (existsAndNotDerived(choicesFacet) || existsAndNotDerived(autoCompleteFacet)) {\n-            // don't overwrite existing choices or autoComplete facet\n-        } else {\n+    /**\n+     * Replaces {@link DescribedAsFacetOnParameterAnnotationElseDerivedFromTypeFactory}\n+     */\n+    private void deriveParameterDescribedAsFromType(final ObjectActionParameter parameter) {\n+        if(parameter.containsDoOpFacet(DescribedAsFacet.class)) {\n+            return;\n+        }\n+        final ObjectSpecification paramSpec = parameter.getSpecification();\n+        final DescribedAsFacet specFacet = paramSpec.getFacet(DescribedAsFacet.class);\n+\n+        //TODO: this ought to check if a do-op; if you come across this, you can probably change it (just taking smaller steps for now)\n+        //if(existsAndIsDoOp(specFacet)) {\n+        if(specFacet != null) {\n+            FacetUtil.addFacet(new DescribedAsFacetOnParameterDerivedFromType(specFacet, peerFor(parameter)));\n+        }\n+    }\n+\n+    /**\n+     * Replaces {@link TypicalLengthFacetOnParameterDerivedFromTypeFacetFactory}\n+     */\n+    private void deriveParameterTypicalLengthFromType(final ObjectActionParameter parameter) {\n+        if(parameter.containsDoOpFacet(TypicalLengthFacet.class)) {\n+            return;\n+        }\n+        final ObjectSpecification paramSpec = parameter.getSpecification();\n+        final TypicalLengthFacet specFacet = paramSpec.getFacet(TypicalLengthFacet.class);\n+        if(existsAndIsDoOp(specFacet)) {\n+            FacetUtil.addFacet(new TypicalLengthFacetOnParameterDerivedFromType(specFacet, peerFor(parameter)));\n+        }\n+    }\n+\n+    /**\n+     * Replaces {@link PropertyChoicesFacetDerivedFromChoicesFacetFactory}\n+     */\n+    private void derivePropertyChoicesFromExistingChoices(final OneToOneAssociation property) {\n+        if(property.containsDoOpFacet(PropertyChoicesFacet.class)) {\n+            return;\n+        }\n+        final ObjectSpecification propertySpec = property.getSpecification();\n+        final ChoicesFacet specFacet = propertySpec.getFacet(ChoicesFacet.class);\n+        if(existsAndIsDoOp(specFacet)) {\n             FacetUtil.addFacet(\n-                    new ActionParameterChoicesFacetFromParentedCollection(\n-                            scalarOrCollectionParam, otma,\n-                            getDeploymentCategory(), specificationLoader,\n-                            authenticationSessionProvider, adapterManager ));\n+                    new PropertyChoicesFacetDerivedFromChoicesFacet(facetedMethodFor(property), specificationLoader));\n         }\n     }\n \n-    private static boolean existsAndNotDerived(final Facet facet) {\n-        return facet != null && !facet.isNoop() && !facet.isNoop();\n+    /**\n+     * Replaces {@link PropertyDefaultFacetDerivedFromTypeFactory}\n+     */\n+    private void derivePropertyDefaultsFromType(final OneToOneAssociation property) {\n+        if(property.containsDoOpFacet(PropertyDefaultFacet.class)) {\n+            return;\n+        }\n+        final ObjectSpecification propertySpec = property.getSpecification();\n+        final DefaultedFacet specFacet = propertySpec.getFacet(DefaultedFacet.class);\n+        if(existsAndIsDoOp(specFacet)) {\n+            FacetUtil.addFacet(\n+                new PropertyDefaultFacetDerivedFromDefaultedFacet(\n+                        specFacet, facetedMethodFor(property), adapterManager));\n+        }\n+    }\n+\n+    /**\n+     * replaces {@link TypicalLengthFacetOnPropertyDerivedFromTypeFacetFactory}\n+     */\n+    private void derivePropertyTypicalLengthFromType(final OneToOneAssociation property) {\n+        if(property.containsDoOpFacet(TypicalLengthFacet.class)) {\n+            return;\n+        }\n+        final ObjectSpecification propertySpec = property.getSpecification();\n+        final TypicalLengthFacet specFacet = propertySpec.getFacet(TypicalLengthFacet.class);\n+        if(existsAndIsDoOp(specFacet)) {\n+            FacetUtil.addFacet(\n+                    new TypicalLengthFacetOnPropertyDerivedFromType(specFacet, facetedMethodFor(property)));\n+        }\n+    }\n+\n+    /**\n+     * Replaces some of the functionality in {@link DescribedAsFacetOnMemberFactory}.\n+     */\n+    private void derivePropertyOrCollectionDescribedAsFromType(final ObjectAssociation objectAssociation) {\n+        if(objectAssociation.containsDoOpFacet(DescribedAsFacet.class)) {\n+            return;\n+        }\n+        final ObjectSpecification returnSpec = objectAssociation.getSpecification();\n+        final DescribedAsFacet specFacet = returnSpec.getFacet(DescribedAsFacet.class);\n+        //TODO: this ought to check if a do-op; if you come across this, you can probably change it (just taking smaller steps for now)\n+        //if(existsAndIsDoOp(specFacet)) {\n+        if(specFacet != null) {\n+            FacetUtil.addFacet(\n+                    new DescribedAsFacetOnMemberDerivedFromType(specFacet, facetedMethodFor(objectAssociation)));\n+        }\n+    }\n+\n+    /**\n+     * Replaces {@link DisabledFacetOnPropertyDerivedFromImmutableFactory}\n+     */\n+    private void derivePropertyDisabledFromImmutable(final OneToOneAssociation property) {\n+        if(property.containsDoOpFacet(DisabledFacet.class)) {\n+            return;\n+        }\n+        final ObjectSpecification onType = property.getOnType();\n+        final ImmutableFacet specFacet = onType.getFacet(ImmutableFacet.class);\n+        if(existsAndIsDoOp(specFacet)) {\n+            FacetUtil.addFacet(\n+                    new DisabledFacetOnPropertyDerivedFromImmutable(specFacet, facetedMethodFor(property)));\n+        }\n+    }\n+\n+    /**\n+     * Replaces {@link CopyImmutableFacetOntoMembersFactory}\n+     *\n+     * TODO: this looks to be redundant, see {@link #derivePropertyDisabledFromImmutable(OneToOneAssociation)} and {@link #deriveCollectionDisabledFromImmutable(OneToManyAssociation)}.  What differs is the implementation of the disabling facet (DisabledFacetOn... vs ImmutableFacetFor...).\n+     */\n+    private void derivePropertyOrCollectionImmutableFromSpec(final ObjectAssociation objectAssociation) {\n+        if(objectAssociation.containsDoOpFacet(DisabledFacet.class)) {\n+            return;\n+        }\n+        final ObjectSpecification owningSpec = objectAssociation.getOnType();\n+        final ImmutableFacet specFacet = owningSpec.getFacet(ImmutableFacet.class);\n+        if(existsAndIsDoOp(specFacet)) {\n+            specFacet.copyOnto(facetedMethodFor(objectAssociation));\n+        }\n+    }\n+\n+\n+    /**\n+     * Replaces {@link DisabledFacetOnCollectionDerivedFromImmutableFactory}\n+     */\n+    private void deriveCollectionDisabledFromImmutable(final OneToManyAssociation collection) {\n+        if(collection.containsDoOpFacet(DisabledFacet.class)) {\n+            return;\n+        }\n+        final ObjectSpecification onType = collection.getOnType();\n+        final ImmutableFacet specFacet = onType.getFacet(ImmutableFacet.class);\n+        if(existsAndIsDoOp(specFacet)) {\n+            FacetUtil.addFacet(\n+                    new DisabledFacetOnCollectionDerivedFromImmutable(specFacet, facetedMethodFor(collection)));\n+        }\n+    }\n+\n+\n+\n+    private void addCollectionParamDefaultsFacetIfNoneAlready(final ObjectActionParameter collectionParam) {\n+        if(collectionParam.containsDoOpFacet(ActionParameterDefaultsFacet.class)) {\n+            return;\n+        }\n+        FacetUtil.addFacet(new ActionParameterDefaultsFacetFromAssociatedCollection(collectionParam));\n+    }\n+\n+    private void addCollectionParamChoicesFacetIfNoneAlready(\n+            final OneToManyAssociation otma,\n+            final ObjectActionParameter scalarOrCollectionParam) {\n+        if (scalarOrCollectionParam.containsDoOpFacet(ActionParameterChoicesFacet.class) ||\n+            scalarOrCollectionParam.containsDoOpFacet(ActionParameterAutoCompleteFacet.class)) {\n+            return;\n+        }\n+\n+        FacetUtil.addFacet(\n+                new ActionParameterChoicesFacetFromParentedCollection(\n+                        scalarOrCollectionParam, otma,\n+                        getDeploymentCategory(), specificationLoader,\n+                        authenticationSessionProvider, adapterManager ));\n+    }\n+\n+    private static boolean existsAndIsDoOp(final Facet facet) {\n+        return facet != null && !facet.isNoop();\n     }\n \n     private List<ActionType> inferActionTypes() {",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/postprocessors/param/ActionCollectionParameterDefaultsAndChoicesPostProcessor.java",
                "sha": "b9e79ea58c0c8cba81befcc5a5863af8cb36f56c",
                "status": "modified"
            },
            {
                "additions": 21,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/services/metamodel/MetaModelExporter.java",
                "changes": 22,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/services/metamodel/MetaModelExporter.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 1,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/services/metamodel/MetaModelExporter.java",
                "patch": "@@ -91,7 +91,7 @@ MetamodelDto exportMetaModel(final MetaModelService6.Config config) {\n \n         // phase 1: create a domainClassType for each ObjectSpecification\n         // these are added into a map for lookups in phase 2\n-        Map<ObjectSpecification, DomainClassDto> domainClassByObjectSpec = Maps.newHashMap();\n+        final Map<ObjectSpecification, DomainClassDto> domainClassByObjectSpec = Maps.newHashMap();\n         for (final ObjectSpecification specification : specificationLookup.allSpecifications()) {\n             if(notInPackagePrefixes(specification, config)) {\n                 continue;\n@@ -119,6 +119,26 @@ MetamodelDto exportMetaModel(final MetaModelService6.Config config) {\n             addFacetsAndMembersTo(specification, domainClassByObjectSpec, config);\n         }\n \n+        // phase 2.5: check no duplicates\n+        final Map<String, ObjectSpecification> objectSpecificationByDomainClassId = Maps.newHashMap();\n+        final List<String> buf = Lists.newArrayList();\n+        for (final Map.Entry<ObjectSpecification, DomainClassDto> entry : domainClassByObjectSpec.entrySet()) {\n+            final ObjectSpecification objectSpecification = entry.getKey();\n+            final DomainClassDto domainClassDto = entry.getValue();\n+            final String id = domainClassDto.getId();\n+            final ObjectSpecification existing = objectSpecificationByDomainClassId.get(id);\n+            if(existing != null) {\n+                if(!existing.getCorrespondingClass().isEnum()) {\n+                    buf.add(String.format(\"%s mapped to %s and %s\", id, existing, objectSpecification));\n+                }\n+            } else {\n+                objectSpecificationByDomainClassId.put(id, objectSpecification);\n+            }\n+        }\n+        if(buf.size() > 0) {\n+            throw new IllegalStateException(Joiner.on(\"\\n\").join(buf));\n+        }\n+\n         // phase 3: now copy all domain classes into the metamodel\n         for (final DomainClassDto domainClass : Lists.newArrayList(domainClassByObjectSpec.values())) {\n             metamodelDto.getDomainClassDto().add(domainClass);",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/services/metamodel/MetaModelExporter.java",
                "sha": "27736d439cc2f1bdd406641f3fe577c55b7ce40e",
                "status": "modified"
            },
            {
                "additions": 20,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/SpecificationCacheDefault.java",
                "changes": 27,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/SpecificationCacheDefault.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 7,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/SpecificationCacheDefault.java",
                "patch": "@@ -32,12 +32,13 @@\n /**\n  * This is populated in two parts.\n  *\n- * Initially the #specByClassName is populated using {@link #cache(String, ObjectSpecification)}.  This allows\n- * {@link #allSpecifications()} to return a list of specs.\n+ * Initially the <tt>specByClassName</tt> map is populated using {@link #cache(String, ObjectSpecification)}.\n+ * This allows {@link #allSpecifications()} to return a list of specs.\n+ * Later on, {@link #init()} called which populates #classNameBySpecId.\n  *\n- * Later on, {@link #init(Map)} is called which populates #classNameBySpecId.\n+ * Attempting to call {@link #getByObjectType(ObjectSpecId)} before {@link #init() initialisation} will result in an\n+ * {@link IllegalStateException}.\n  *\n- * TODO: the information passed to #init actually comes from the cache itself (the caller calls #allSpecifications() first) so this could be simplified\n  */\n class SpecificationCacheDefault {\n     \n@@ -70,9 +71,21 @@ public ObjectSpecification getByObjectType(ObjectSpecId objectSpecID) {\n         return className != null ? specByClassName.get(className) : null;\n     }\n \n-    /**\n-     */\n-    synchronized void init(final Map<ObjectSpecId, ObjectSpecification> specById) {\n+    synchronized void init() {\n+        final Collection<ObjectSpecification> objectSpecifications = allSpecifications();\n+        final Map<ObjectSpecId, ObjectSpecification> specById = Maps.newHashMap();\n+        for (final ObjectSpecification objSpec : objectSpecifications) {\n+            final ObjectSpecId objectSpecId = objSpec.getSpecId();\n+            if (objectSpecId == null) {\n+                continue;\n+            }\n+            specById.put(objectSpecId, objSpec);\n+        }\n+\n+        internalInit(specById);\n+    }\n+\n+    void internalInit(final Map<ObjectSpecId, ObjectSpecification> specById) {\n         final Map<ObjectSpecId, String> classNameBySpecId = Maps.newHashMap();\n         final Map<String, ObjectSpecification> specByClassName = Maps.newHashMap();\n         for (ObjectSpecId objectSpecId : specById.keySet()) {",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/SpecificationCacheDefault.java",
                "sha": "544721402c70b72f335deced9b391fd4916e86ef",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/SpecificationLoader.java",
                "changes": 24,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/SpecificationLoader.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 19,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/SpecificationLoader.java",
                "patch": "@@ -19,7 +19,6 @@\n import java.util.Collection;\n import java.util.Collections;\n import java.util.List;\n-import java.util.Map;\n import java.util.concurrent.Callable;\n import java.util.concurrent.Future;\n \n@@ -28,7 +27,6 @@\n import com.google.common.collect.FluentIterable;\n import com.google.common.collect.ImmutableList;\n import com.google.common.collect.Lists;\n-import com.google.common.collect.Maps;\n \n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n@@ -145,7 +143,7 @@ protected void finalize() throws Throwable {\n     //endregion\n \n \n-    //region > init\n+    //region > internalInit\n \n     private State state;\n \n@@ -249,7 +247,7 @@ public String toString() {\n \n \n         // for debugging only\n-        final Collection<ObjectSpecification> cachedSpecificationsAfter = allCachedSpecifications();\n+        final Collection<ObjectSpecification> cachedSpecificationsAfter = cache.allSpecifications();\n         ImmutableList<ObjectSpecification> cachedAfterNotBefore = FluentIterable.from(cachedSpecificationsAfter)\n                 .filter(new Predicate<ObjectSpecification>() {\n                     @Override\n@@ -261,10 +259,10 @@ public boolean apply(final ObjectSpecification objectSpecification) {\n                 cachedSpecificationsAfter.size(), cachedAfterNotBefore.size()));\n \n \n-        // only after full introspection has occured do we cache ObjectSpecifications\n+        // only after full introspection has occurred do we cache ObjectSpecifications\n         // by their ObjectSpecId.\n         // the cache (SpecificationCacheDefault will fail-fast as not initialized\n-        cacheBySpecId(specificationsFromRegistry);\n+        cache.init();\n \n     }\n \n@@ -285,18 +283,6 @@ private void loadSpecificationsFor(\n         }\n     }\n \n-    private void cacheBySpecId(final Collection<ObjectSpecification> objectSpecifications) {\n-        final Map<ObjectSpecId, ObjectSpecification> specById = Maps.newHashMap();\n-        for (final ObjectSpecification objSpec : objectSpecifications) {\n-            final ObjectSpecId objectSpecId = objSpec.getSpecId();\n-            if (objectSpecId == null) {\n-                continue;\n-            }\n-            specById.put(objectSpecId, objSpec);\n-        }\n-\n-        cache.init(specById);\n-    }\n \n \n \n@@ -360,7 +346,7 @@ public void validateAndAssert() {\n         ValidationFailures validationFailures = validate();\n         validationFailures.assertNone();\n \n-        cacheBySpecId(allCachedSpecifications());\n+        cache.init();\n     }\n \n     @Programmatic",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/SpecificationLoader.java",
                "sha": "2ce4dbceb5c4e567e0db9c9c7bf2f834e3aa9a0c",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/ObjectActionContributee.java",
                "changes": 9,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/ObjectActionContributee.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 7,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/ObjectActionContributee.java",
                "patch": "@@ -34,7 +34,6 @@\n import org.apache.isis.core.metamodel.facetapi.FeatureType;\n import org.apache.isis.core.metamodel.facetapi.MultiTypedFacet;\n import org.apache.isis.core.metamodel.facets.FacetedMethodParameter;\n-import org.apache.isis.core.metamodel.facets.TypedHolder;\n import org.apache.isis.core.metamodel.interactions.InteractionUtils;\n import org.apache.isis.core.metamodel.interactions.UsabilityContext;\n import org.apache.isis.core.metamodel.interactions.VisibilityContext;\n@@ -125,19 +124,15 @@ public int getContributeeParamPosition() {\n                 continue;\n             }\n \n-            final TypedHolder paramPeer = paramPeers.get(serviceParamNum);\n-            final ObjectSpecification specification = ObjectMemberAbstract\n-                    .getSpecification(getSpecificationLoader(), paramPeer.getType());\n-\n             final ObjectActionParameterAbstract serviceParameter =\n                     (ObjectActionParameterAbstract) serviceParameters.get(serviceParamNum);\n \n             final ObjectActionParameterContributee contributedParam =\n                     serviceParameter.getPeer().getFeatureType() == FeatureType.ACTION_PARAMETER_SCALAR\n                             ? new OneToOneActionParameterContributee(\n-                                    getServiceAdapter(), serviceParameter, contributeeParamNum, this)\n+                                    servicePojo, serviceParameter, contributeeParamNum, this)\n                             : new OneToManyActionParameterContributee(\n-                                    getServiceAdapter(), serviceParameter, contributeeParamNum, this);\n+                                    servicePojo, serviceParameter, contributeeParamNum, this);\n \n             contributeeParameters.add(contributedParam);\n ",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/ObjectActionContributee.java",
                "sha": "b0156e9dc55fe0b1f1b80fe47b4e774bffb13e22",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/ObjectActionParameterAbstract.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/ObjectActionParameterAbstract.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 1,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/ObjectActionParameterAbstract.java",
                "patch": "@@ -121,7 +121,7 @@ public ObjectAction getAction() {\n      * NOT API, but exposed for the benefit of {@link ObjectActionParameterContributee}\n      * and {@link ObjectActionParameterMixedIn}.\n      */\n-    TypedHolder getPeer() {\n+    public TypedHolder getPeer() {\n         return peer;\n     }\n ",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/ObjectActionParameterAbstract.java",
                "sha": "4c1fd0288d653ffae99198a985de0ee7481bb4d2",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/ObjectActionParameterContributeeAbstract.java",
                "changes": 15,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/ObjectActionParameterContributeeAbstract.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 5,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/ObjectActionParameterContributeeAbstract.java",
                "patch": "@@ -28,17 +28,18 @@\n         extends ObjectActionParameterAbstract\n         implements ObjectActionParameterContributee {\n \n-    private final ObjectAdapter serviceAdapter;\n+    private final Object servicePojo;\n     private final ObjectActionParameter serviceActionParameter;\n     private final ObjectActionContributee contributeeAction;\n \n     public ObjectActionParameterContributeeAbstract(\n-            final FeatureType featureType, final ObjectAdapter serviceAdapter,\n+            final FeatureType featureType,\n+            final Object servicePojo,\n             final ObjectActionParameterAbstract serviceActionParameter,\n             final int contributeeParamNumber,\n             final ObjectActionContributee contributeeAction) {\n         super(featureType, contributeeParamNumber, contributeeAction, serviceActionParameter.getPeer());\n-        this.serviceAdapter = serviceAdapter;\n+        this.servicePojo = servicePojo;\n         this.serviceActionParameter = serviceActionParameter;\n         this.contributeeAction = contributeeAction;\n     }\n@@ -48,12 +49,16 @@ public ObjectActionParameterContributeeAbstract(\n             final ObjectAdapter adapter,\n             final String searchArg,\n             final InteractionInitiatedBy interactionInitiatedBy) {\n-        return serviceActionParameter.getAutoComplete(serviceAdapter, searchArg,\n+        return serviceActionParameter.getAutoComplete(getServiceAdapter(), searchArg,\n                 interactionInitiatedBy);\n     }\n \n+    protected ObjectAdapter getServiceAdapter() {\n+        return getObjectPersistor().adapterFor(servicePojo);\n+    }\n+\n     protected ObjectAdapter targetForDefaultOrChoices(final ObjectAdapter adapter) {\n-        return serviceAdapter;\n+        return getServiceAdapter();\n     }\n \n     protected List<ObjectAdapter> argsForDefaultOrChoices(",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/ObjectActionParameterContributeeAbstract.java",
                "sha": "3527c891a629629eb7a8e69e1cb931a049a5b1a7",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/ObjectMemberAbstract.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/ObjectMemberAbstract.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 0,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/ObjectMemberAbstract.java",
                "patch": "@@ -117,6 +117,9 @@ public FeatureType getFeatureType() {\n \n     //region > Facets\n \n+    /**\n+     * Not API.\n+     */\n     public FacetedMethod getFacetedMethod() {\n         return facetedMethod;\n     }",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/ObjectMemberAbstract.java",
                "sha": "fe9b14de29ac541b547291c05a1498253dad42db",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToManyActionParameterContributee.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToManyActionParameterContributee.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 3,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToManyActionParameterContributee.java",
                "patch": "@@ -16,7 +16,6 @@\n  */\n package org.apache.isis.core.metamodel.specloader.specimpl;\n \n-import org.apache.isis.core.metamodel.adapter.ObjectAdapter;\n import org.apache.isis.core.metamodel.facetapi.FeatureType;\n import org.apache.isis.core.metamodel.facets.collparam.semantics.CollectionSemantics;\n import org.apache.isis.core.metamodel.facets.collparam.semantics.CollectionSemanticsFacet;\n@@ -27,11 +26,11 @@\n         implements OneToManyActionParameter {\n \n     public OneToManyActionParameterContributee(\n-            final ObjectAdapter serviceAdapter,\n+            final Object servicePojo,\n             final ObjectActionParameterAbstract serviceActionParameter,\n             final int contributeeParamNumber,\n             final ObjectActionContributee contributeeAction) {\n-        super(FeatureType.ACTION_PARAMETER_COLLECTION, serviceAdapter, serviceActionParameter, contributeeParamNumber, contributeeAction);\n+        super(FeatureType.ACTION_PARAMETER_COLLECTION, servicePojo, serviceActionParameter, contributeeParamNumber, contributeeAction);\n     }\n \n     @Override",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToManyActionParameterContributee.java",
                "sha": "ed5e622eb7be8ec0621b8994fa770a50360197ba",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToManyAssociationContributee.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToManyAssociationContributee.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 0,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToManyAssociationContributee.java",
                "patch": "@@ -123,6 +123,11 @@ public ObjectAdapter get(final ObjectAdapter ownerAdapter, final InteractionInit\n         return serviceAction.execute(getServiceAdapter(), null, new ObjectAdapter[]{ownerAdapter}, interactionInitiatedBy);\n     }\n \n+    @Override\n+    public ObjectSpecification getOnType() {\n+        return serviceAction.getOnType();\n+    }\n+\n     @Override\n     public Identifier getIdentifier() {\n         return identifier;",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToManyAssociationContributee.java",
                "sha": "4c53dac79c20edc96fbb157b00ec4e8f3bfd49a9",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToManyAssociationMixedIn.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToManyAssociationMixedIn.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 1,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToManyAssociationMixedIn.java",
                "patch": "@@ -206,10 +206,14 @@ protected FacetHolder getFacetHolder() {\n         return facetHolder;\n     }\n \n+    @Override\n+    public ObjectSpecification getOnType() {\n+        return mixedInType;\n+    }\n+\n     @Override\n     public ObjectSpecification getMixinType() {\n         return getSpecificationLoader().loadSpecification(mixinType);\n-\n     }\n \n     //endregion",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToManyAssociationMixedIn.java",
                "sha": "f71777e53a3f522bb2ea98a2e254056c78dc94ee",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToOneActionParameterContributee.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToOneActionParameterContributee.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 3,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToOneActionParameterContributee.java",
                "patch": "@@ -16,7 +16,6 @@\n  */\n package org.apache.isis.core.metamodel.specloader.specimpl;\n \n-import org.apache.isis.core.metamodel.adapter.ObjectAdapter;\n import org.apache.isis.core.metamodel.facetapi.FeatureType;\n import org.apache.isis.core.metamodel.spec.feature.OneToOneActionParameter;\n \n@@ -25,11 +24,11 @@\n         implements OneToOneActionParameter {\n \n     public OneToOneActionParameterContributee(\n-            final ObjectAdapter serviceAdapter,\n+            final Object servicePojo,\n             final ObjectActionParameterAbstract serviceActionParameter,\n             final int contributeeParamNumber,\n             final ObjectActionContributee contributeeAction) {\n-        super(FeatureType.ACTION_PARAMETER_SCALAR, serviceAdapter, serviceActionParameter, contributeeParamNumber, contributeeAction);\n+        super(FeatureType.ACTION_PARAMETER_SCALAR, servicePojo, serviceActionParameter, contributeeParamNumber, contributeeAction);\n     }\n \n ",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToOneActionParameterContributee.java",
                "sha": "b98d326d3a0234e9e97c6e3f157c9dc0145be878",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToOneAssociationContributee.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToOneAssociationContributee.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 0,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToOneAssociationContributee.java",
                "patch": "@@ -105,6 +105,11 @@ public ObjectAdapter get(final ObjectAdapter ownerAdapter, final InteractionInit\n         return serviceAction.execute(getServiceAdapter(), null, new ObjectAdapter[]{ownerAdapter}, interactionInitiatedBy);\n     }\n \n+    @Override\n+    public ObjectSpecification getOnType() {\n+        return serviceAction.getOnType();\n+    }\n+\n     @Override\n     public Identifier getIdentifier() {\n         return identifier;",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/OneToOneAssociationContributee.java",
                "sha": "fdb3b1ba1808fac1054baeda8d7aa9292841c4e2",
                "status": "modified"
            },
            {
                "additions": 46,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/dflt/ObjectSpecificationDefault.java",
                "changes": 57,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/dflt/ObjectSpecificationDefault.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 11,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/dflt/ObjectSpecificationDefault.java",
                "patch": "@@ -31,9 +31,11 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+import org.apache.isis.applib.annotation.HomePage;\n import org.apache.isis.applib.annotation.NatureOfService;\n import org.apache.isis.applib.filter.Filter;\n import org.apache.isis.applib.filter.Filters;\n+import org.apache.isis.applib.fixturescripts.FixtureScript;\n import org.apache.isis.core.commons.lang.StringExtensions;\n import org.apache.isis.core.commons.util.ToString;\n import org.apache.isis.core.metamodel.adapter.ObjectAdapter;\n@@ -45,6 +47,7 @@\n import org.apache.isis.core.metamodel.facets.all.i18n.PluralFacetTranslated;\n import org.apache.isis.core.metamodel.facets.all.named.NamedFacet;\n import org.apache.isis.core.metamodel.facets.all.named.NamedFacetInferred;\n+import org.apache.isis.core.metamodel.facets.object.domainservice.DomainServiceFacet;\n import org.apache.isis.core.metamodel.facets.object.mixin.MixinFacet;\n import org.apache.isis.core.metamodel.facets.object.plural.PluralFacet;\n import org.apache.isis.core.metamodel.facets.object.plural.inferred.PluralFacetInferred;\n@@ -206,17 +209,20 @@ private void addNamedFacetAndPluralFacetIfRequired() {\n \n     //region > create associations and actions\n     private List<ObjectAssociation> createAssociations(Properties properties) {\n-        final List<FacetedMethod> associationFacetedMethods = facetedMethodsBuilder.getAssociationFacetedMethods(properties);\n         final List<ObjectAssociation> associations = Lists.newArrayList();\n-        for (FacetedMethod facetedMethod : associationFacetedMethods) {\n-            final ObjectAssociation association = createAssociation(facetedMethod);\n-            if(association != null) {\n-                associations.add(association);\n+        if(skipAssociationsAndActions()) {\n+            // add no associations\n+        } else {\n+            final List<FacetedMethod> associationFacetedMethods = facetedMethodsBuilder.getAssociationFacetedMethods(properties);\n+            for (FacetedMethod facetedMethod : associationFacetedMethods) {\n+                final ObjectAssociation association = createAssociation(facetedMethod);\n+                if(association != null) {\n+                    associations.add(association);\n+                }\n             }\n         }\n         return associations;\n     }\n-    \n \n     private ObjectAssociation createAssociation(final FacetedMethod facetMethod) {\n         if (facetMethod.getFeatureType().isCollection()) {\n@@ -229,12 +235,16 @@ private ObjectAssociation createAssociation(final FacetedMethod facetMethod) {\n     }\n \n     private List<ObjectAction> createActions(Properties metadataProperties) {\n-        final List<FacetedMethod> actionFacetedMethods = facetedMethodsBuilder.getActionFacetedMethods(metadataProperties);\n         final List<ObjectAction> actions = Lists.newArrayList();\n-        for (FacetedMethod facetedMethod : actionFacetedMethods) {\n-            final ObjectAction action = createAction(facetedMethod);\n-            if(action != null) {\n-                actions.add(action);\n+        if(skipAssociationsAndActions()) {\n+            // create no actions\n+        } else {\n+            final List<FacetedMethod> actionFacetedMethods = facetedMethodsBuilder.getActionFacetedMethods(metadataProperties);\n+            for (FacetedMethod facetedMethod : actionFacetedMethods) {\n+                final ObjectAction action = createAction(facetedMethod);\n+                if(action != null) {\n+                    actions.add(action);\n+                }\n             }\n         }\n         return actions;\n@@ -249,6 +259,31 @@ private ObjectAction createAction(final FacetedMethod facetedMethod) {\n         }\n     }\n \n+    private boolean skipAssociationsAndActions() {\n+        return isFixtureScript() || isDomainServiceWithDomainNatureOfServiceNotHomePage();\n+    }\n+\n+    // TODO: this is a bit horrible; maybe instead introduce a new NatureOfService for home page services (also for seed services?)\n+    private boolean isDomainServiceWithDomainNatureOfServiceNotHomePage() {\n+        final DomainServiceFacet domainServiceFacet = this.getFacet(DomainServiceFacet.class);\n+        if (domainServiceFacet == null) {\n+            return false;\n+        }\n+        if (domainServiceFacet.getNatureOfService() != NatureOfService.DOMAIN) {\n+            return false;\n+        }\n+        // domain services that have a single method annotated with @HomePage ARE introspected.\n+        final Method[] methods = getCorrespondingClass().getDeclaredMethods();\n+        if (methods.length != 1) {\n+            return true;\n+        }\n+        return methods[0].getAnnotation(HomePage.class) == null;\n+    }\n+\n+    private boolean isFixtureScript() {\n+        return FixtureScript.class.isAssignableFrom(getCorrespondingClass());\n+    }\n+\n     //endregion\n \n     //region > isXxx",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/specimpl/dflt/ObjectSpecificationDefault.java",
                "sha": "28b5a3983380987b302115bd4fba7c9941aa19ef",
                "status": "modified"
            },
            {
                "additions": 11,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/progmodels/dflt/ProgrammingModelFacetsJava5.java",
                "changes": 32,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/progmodels/dflt/ProgrammingModelFacetsJava5.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 21,
                "filename": "core/metamodel/src/main/java/org/apache/isis/progmodels/dflt/ProgrammingModelFacetsJava5.java",
                "patch": "@@ -41,7 +41,6 @@\n import org.apache.isis.core.metamodel.facets.collections.accessor.CollectionAccessorFacetViaAccessorFactory;\n import org.apache.isis.core.metamodel.facets.collections.clear.CollectionClearFacetFactory;\n import org.apache.isis.core.metamodel.facets.collections.collection.CollectionAnnotationFacetFactory;\n-import org.apache.isis.core.metamodel.facets.collections.disabled.fromimmutable.DisabledFacetOnCollectionDerivedFromImmutableFactory;\n import org.apache.isis.core.metamodel.facets.collections.javautilcollection.CollectionFacetFactory;\n import org.apache.isis.core.metamodel.facets.collections.layout.CollectionLayoutFacetFactory;\n import org.apache.isis.core.metamodel.facets.collections.modify.CollectionAddToRemoveFromAndValidateFacetFactory;\n@@ -103,7 +102,6 @@\n import org.apache.isis.core.metamodel.facets.object.ignore.javalang.RemoveMethodsFacetFactory;\n import org.apache.isis.core.metamodel.facets.object.ignore.jdo.RemoveJdoEnhancementTypesFacetFactory;\n import org.apache.isis.core.metamodel.facets.object.ignore.jdo.RemoveJdoPrefixedMethodsFacetFactory;\n-import org.apache.isis.core.metamodel.facets.object.immutable.immutableannot.CopyImmutableFacetOntoMembersFactory;\n import org.apache.isis.core.metamodel.facets.object.immutable.immutablemarkerifc.ImmutableFacetMarkerInterfaceFactory;\n import org.apache.isis.core.metamodel.facets.object.mask.annotation.MaskFacetOnTypeAnnotationFactory;\n import org.apache.isis.core.metamodel.facets.object.maxlen.annotation.MaxLengthFacetOnTypeAnnotationFactory;\n@@ -132,30 +130,22 @@\n import org.apache.isis.core.metamodel.facets.object.value.annotcfg.ValueFacetAnnotationOrConfigurationFactory;\n import org.apache.isis.core.metamodel.facets.param.autocomplete.method.ActionParameterAutoCompleteFacetViaMethodFactory;\n import org.apache.isis.core.metamodel.facets.param.bigdecimal.javaxvaldigits.BigDecimalFacetOnParameterFromJavaxValidationAnnotationFactory;\n-import org.apache.isis.core.metamodel.facets.param.choices.enums.ActionParameterChoicesFacetDerivedFromChoicesFacetFactory;\n import org.apache.isis.core.metamodel.facets.param.choices.method.ActionChoicesFacetViaMethodFactory;\n import org.apache.isis.core.metamodel.facets.param.choices.methodnum.ActionParameterChoicesFacetViaMethodFactory;\n-import org.apache.isis.core.metamodel.facets.param.defaults.fromtype.ActionParameterDefaultFacetDerivedFromTypeFactory;\n import org.apache.isis.core.metamodel.facets.param.defaults.methodnum.ActionParameterDefaultsFacetViaMethodFactory;\n-import org.apache.isis.core.metamodel.postprocessors.param.ActionCollectionParameterDefaultsAndChoicesPostProcessor;\n-import org.apache.isis.core.metamodel.facets.param.describedas.annotderived.DescribedAsFacetOnParameterAnnotationElseDerivedFromTypeFactory;\n import org.apache.isis.core.metamodel.facets.param.layout.ParameterLayoutFacetFactory;\n import org.apache.isis.core.metamodel.facets.param.mandatory.dflt.MandatoryFacetOnParametersDefaultFactory;\n import org.apache.isis.core.metamodel.facets.param.multiline.annotation.MultiLineFacetOnParameterAnnotationFactory;\n import org.apache.isis.core.metamodel.facets.param.named.annotation.NamedFacetOnParameterAnnotationFactory;\n import org.apache.isis.core.metamodel.facets.param.parameter.ParameterAnnotationFacetFactory;\n import org.apache.isis.core.metamodel.facets.param.renderedasdaybefore.annotation.RenderedAsDayBeforeFacetOnParameterAnnotationFactory;\n import org.apache.isis.core.metamodel.facets.param.typicallen.annotation.TypicalLengthFacetOnParameterAnnotationFactory;\n-import org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromTypeFacetFactory;\n import org.apache.isis.core.metamodel.facets.param.validating.maskannot.MaskFacetOnParameterAnnotationFactory;\n import org.apache.isis.core.metamodel.facets.properties.accessor.PropertyAccessorFacetViaAccessorFactory;\n import org.apache.isis.core.metamodel.facets.properties.autocomplete.method.PropertyAutoCompleteFacetMethodFactory;\n import org.apache.isis.core.metamodel.facets.properties.bigdecimal.javaxvaldigits.BigDecimalFacetOnPropertyFromJavaxValidationDigitsAnnotationFactory;\n-import org.apache.isis.core.metamodel.facets.properties.choices.enums.PropertyChoicesFacetDerivedFromChoicesFacetFactory;\n import org.apache.isis.core.metamodel.facets.properties.choices.method.PropertyChoicesFacetViaMethodFactory;\n-import org.apache.isis.core.metamodel.facets.properties.defaults.fromtype.PropertyDefaultFacetDerivedFromTypeFactory;\n import org.apache.isis.core.metamodel.facets.properties.defaults.method.PropertyDefaultFacetViaMethodFactory;\n-import org.apache.isis.core.metamodel.facets.properties.disabled.fromimmutable.DisabledFacetOnPropertyDerivedFromImmutableFactory;\n import org.apache.isis.core.metamodel.facets.properties.disabled.inferred.DisabledFacetOnPropertyInferredFactory;\n import org.apache.isis.core.metamodel.facets.properties.mandatory.dflt.MandatoryFacetOnProperyDefaultFactory;\n import org.apache.isis.core.metamodel.facets.properties.mandatory.staticmethod.MandatoryFacetOnPropertyStaticMethodFactory;\n@@ -164,7 +154,6 @@\n import org.apache.isis.core.metamodel.facets.properties.propertylayout.PropertyLayoutFacetFactory;\n import org.apache.isis.core.metamodel.facets.properties.renderedasdaybefore.annotation.RenderedAsDayBeforeAnnotationOnPropertyFacetFactory;\n import org.apache.isis.core.metamodel.facets.properties.typicallen.annotation.TypicalLengthOnPropertyFacetFactory;\n-import org.apache.isis.core.metamodel.facets.properties.typicallen.fromtype.TypicalLengthFacetOnPropertyDerivedFromTypeFacetFactory;\n import org.apache.isis.core.metamodel.facets.properties.update.PropertyModifyFacetFactory;\n import org.apache.isis.core.metamodel.facets.properties.update.PropertySetAndClearFacetFactory;\n import org.apache.isis.core.metamodel.facets.properties.validating.dflt.PropertyValidateFacetDefaultFactory;\n@@ -210,6 +199,7 @@\n import org.apache.isis.core.metamodel.facets.value.timestampsql.JavaSqlTimeStampValueFacetUsingSemanticsProviderFactory;\n import org.apache.isis.core.metamodel.facets.value.url.URLValueFacetUsingSemanticsProviderFactory;\n import org.apache.isis.core.metamodel.facets.value.uuid.UUIDValueFacetUsingSemanticsProviderFactory;\n+import org.apache.isis.core.metamodel.postprocessors.param.ActionCollectionParameterDefaultsAndChoicesPostProcessor;\n import org.apache.isis.core.metamodel.progmodel.ObjectSpecificationPostProcessor;\n import org.apache.isis.core.metamodel.progmodel.ProgrammingModelAbstract;\n \n@@ -254,8 +244,8 @@ public ProgrammingModelFacetsJava5(final DeprecatedPolicy deprecatedPolicy) {\n \n         // enum support\n         addFactory(new EnumFacetUsingValueFacetUsingSemanticsProviderFactory());\n-        addFactory(new ActionParameterChoicesFacetDerivedFromChoicesFacetFactory());\n-        addFactory(new PropertyChoicesFacetDerivedFromChoicesFacetFactory());\n+        // addFactory(new ActionParameterChoicesFacetDerivedFromChoicesFacetFactory()); ... moved into post-processor, see below\n+        // addFactory(new PropertyChoicesFacetDerivedFromChoicesFacetFactory()); ... moved into post-processor, see below\n \n         // properties\n         addFactory(new PropertyAccessorFacetViaAccessorFactory());\n@@ -329,13 +319,13 @@ public ProgrammingModelFacetsJava5(final DeprecatedPolicy deprecatedPolicy) {\n         addFactory(new ChoicesFacetFromBoundedMarkerInterfaceFactory());\n \n         addFactory(new DefaultedFacetAnnotationElseConfigurationFactory());\n-        addFactory(new PropertyDefaultFacetDerivedFromTypeFactory());\n-        addFactory(new ActionParameterDefaultFacetDerivedFromTypeFactory());\n+        //addFactory(new PropertyDefaultFacetDerivedFromTypeFactory()); ... logic moved to post-processor\n+        //addFactory(new ActionParameterDefaultFacetDerivedFromTypeFactory()); ... logic moved to post-processor\n \n         \n         addFactory(new DescribedAsFacetOnTypeAnnotationFactory());\n         addFactory(new DescribedAsFacetOnMemberFactory());\n-        addFactory(new DescribedAsFacetOnParameterAnnotationElseDerivedFromTypeFactory());\n+        //addFactory(new DescribedAsFacetOnParameterAnnotationElseDerivedFromTypeFactory()); ... logic moved to post-processor\n \n         addFactory(new BigDecimalFacetOnParameterFromJavaxValidationAnnotationFactory());\n         addFactory(new BigDecimalFacetOnPropertyFromJavaxValidationDigitsAnnotationFactory());\n@@ -372,7 +362,7 @@ public ProgrammingModelFacetsJava5(final DeprecatedPolicy deprecatedPolicy) {\n         addFactory(new HiddenObjectFacetViaMethodFactory());\n         addFactory(new DisabledObjectFacetViaMethodFactory());\n \n-        addFactory(new CopyImmutableFacetOntoMembersFactory());\n+        // addFactory(new CopyImmutableFacetOntoMembersFactory()); ... logic moved to post-processor\n         addFactory(new ImmutableFacetMarkerInterfaceFactory());\n \n         addFactory(new RecreatableObjectFacetFactory());\n@@ -460,8 +450,8 @@ public ProgrammingModelFacetsJava5(final DeprecatedPolicy deprecatedPolicy) {\n         \n         addFactory(new RegExFacetOnTypeAnnotationFactory());\n \n-        addFactory(new TypicalLengthFacetOnPropertyDerivedFromTypeFacetFactory());\n-        addFactory(new TypicalLengthFacetOnParameterDerivedFromTypeFacetFactory());\n+        // addFactory(new TypicalLengthFacetOnPropertyDerivedFromTypeFacetFactory()); ... logic moved to post-processor\n+        // addFactory(new TypicalLengthFacetOnParameterDerivedFromTypeFacetFactory()); ... logic moved to post-processor\n \n         \n         addFactory(new TypicalLengthFacetOnTypeAnnotationFactory());\n@@ -528,8 +518,8 @@ public ProgrammingModelFacetsJava5(final DeprecatedPolicy deprecatedPolicy) {\n         // so we can dogfood the applib \"value\" types\n         addFactory(new ValueFacetAnnotationOrConfigurationFactory());\n \n-        addFactory(new DisabledFacetOnPropertyDerivedFromImmutableFactory());\n-        addFactory(new DisabledFacetOnCollectionDerivedFromImmutableFactory());\n+        // addFactory(new DisabledFacetOnPropertyDerivedFromImmutableFactory()); ... logic moved to post-processor\n+        // addFactory(new DisabledFacetOnCollectionDerivedFromImmutableFactory()); ... logic moved to post-processor\n \n         // should come near the end, after any facets that install PropertySetterFacet have run.\n         addFactory(new DisabledFacetOnPropertyInferredFactory());",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/main/java/org/apache/isis/progmodels/dflt/ProgrammingModelFacetsJava5.java",
                "sha": "ab64d00bacbc9d5a872a5a2eb237fe3c4b447974",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/test/java/org/apache/isis/core/metamodel/specloader/SpecificationCacheDefaultTest.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/test/java/org/apache/isis/core/metamodel/specloader/SpecificationCacheDefaultTest.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 3,
                "filename": "core/metamodel/src/test/java/org/apache/isis/core/metamodel/specloader/SpecificationCacheDefaultTest.java",
                "patch": "@@ -23,15 +23,15 @@\n \n import com.google.common.collect.Maps;\n \n-import org.apache.isis.core.metamodel.spec.ObjectSpecId;\n-import org.apache.isis.core.metamodel.spec.ObjectSpecification;\n import org.jmock.Expectations;\n import org.jmock.auto.Mock;\n import org.junit.After;\n import org.junit.Before;\n import org.junit.Rule;\n import org.junit.Test;\n \n+import org.apache.isis.core.metamodel.spec.ObjectSpecId;\n+import org.apache.isis.core.metamodel.spec.ObjectSpecification;\n import org.apache.isis.core.unittestsupport.jmocking.JUnitRuleMockery2;\n import org.apache.isis.core.unittestsupport.jmocking.JUnitRuleMockery2.Mode;\n \n@@ -109,7 +109,7 @@ public void getByObjectType_whenSet() {\n         Map<ObjectSpecId, ObjectSpecification> specByObjectType = Maps.newHashMap();\n         specByObjectType.put(ObjectSpecId.of(\"CUS\"), customerSpec);\n         \n-        specificationCache.init(specByObjectType);\n+        specificationCache.internalInit(specByObjectType);\n         final ObjectSpecification objectSpec = specificationCache.getByObjectType(ObjectSpecId.of(\"CUS\"));\n         \n         assertSame(objectSpec, customerSpec);",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/metamodel/src/test/java/org/apache/isis/core/metamodel/specloader/SpecificationCacheDefaultTest.java",
                "sha": "4ea86195b07bc98b603903125ff55180575879d6",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/runtime/src/main/java/org/apache/isis/core/runtime/system/session/IsisSessionFactoryBuilder.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/system/session/IsisSessionFactoryBuilder.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 1,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/system/session/IsisSessionFactoryBuilder.java",
                "patch": "@@ -260,6 +260,7 @@ public String toString() {\n             );\n \n             ThreadPoolSupport.getInstance().joinGatherFailures(futures);\n+            specificationLoader.postProcess();\n \n             persistenceSessionFactory.catalogNamedQueries(specificationLoader);\n \n@@ -269,7 +270,6 @@ public String toString() {\n                     new Runnable() {\n                         @Override\n                         public void run() {\n-                            specificationLoader.postProcess();\n                             try {\n                                 specificationLoader.validateAndAssert();\n ",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/runtime/src/main/java/org/apache/isis/core/runtime/system/session/IsisSessionFactoryBuilder.java",
                "sha": "6ca987e12e48d8a7eaa78a587ca1aef8578fc814",
                "status": "modified"
            },
            {
                "additions": 58,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/runtime/src/main/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProvider.java",
                "changes": 75,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProvider.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 17,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProvider.java",
                "patch": "@@ -41,17 +41,23 @@\n \n import org.apache.isis.applib.AppManifest;\n import org.apache.isis.applib.annotation.DomainObject;\n+import org.apache.isis.applib.annotation.DomainObjectLayout;\n import org.apache.isis.applib.annotation.DomainService;\n+import org.apache.isis.applib.annotation.DomainServiceLayout;\n import org.apache.isis.applib.annotation.Mixin;\n import org.apache.isis.applib.annotation.Nature;\n+import org.apache.isis.applib.annotation.Programmatic;\n import org.apache.isis.applib.annotation.ViewModel;\n+import org.apache.isis.applib.annotation.ViewModelLayout;\n+import org.apache.isis.applib.fixturescripts.DiscoverableFixtureScript;\n import org.apache.isis.applib.fixturescripts.FixtureScript;\n import org.apache.isis.applib.services.classdiscovery.ClassDiscoveryServiceUsingReflections;\n import org.apache.isis.core.commons.config.IsisConfiguration;\n import org.apache.isis.core.commons.config.IsisConfigurationDefault;\n import org.apache.isis.core.commons.factory.InstanceUtil;\n import org.apache.isis.core.commons.lang.ClassUtil;\n import org.apache.isis.core.metamodel.facetapi.MetaModelRefiner;\n+import org.apache.isis.core.metamodel.facets.Annotations;\n import org.apache.isis.core.metamodel.layoutmetadata.LayoutMetadataReader;\n import org.apache.isis.core.metamodel.progmodel.ProgrammingModel;\n import org.apache.isis.core.metamodel.services.ServicesInjector;\n@@ -144,27 +150,53 @@ private void findAndRegisterTypes(final AppManifest appManifest) {\n \n         final Reflections reflections = new Reflections(moduleAndFrameworkPackages);\n \n-        final Set<Class<?>> domainServiceTypes = reflections.getTypesAnnotatedWith(DomainService.class);\n-        final Set<Class<?>> persistenceCapableTypes = reflections.getTypesAnnotatedWith(PersistenceCapable.class);\n-        final Set<Class<? extends FixtureScript>> fixtureScriptTypes = reflections.getSubTypesOf(FixtureScript.class);\n+        final Set<Class<?>> domainServiceTypes = Sets.newLinkedHashSet();\n+        domainServiceTypes.addAll(reflections.getTypesAnnotatedWith(DomainService.class));\n+        domainServiceTypes.addAll(reflections.getTypesAnnotatedWith(DomainServiceLayout.class));\n+\n+        final Set<Class<?>> persistenceCapableTypes = Sets.newLinkedHashSet();\n+        persistenceCapableTypes.addAll(reflections.getTypesAnnotatedWith(PersistenceCapable.class));\n+\n+        // the fixtureScript types are introspected just to provide a drop-down when running fixture scripts\n+        // in prototyping mode (though they may be introspected lazily if actually run).\n+        // we therefore try to limit the set of fixture types eagerly introspected at startup\n+        final Set<Class<? extends FixtureScript>> fixtureScriptTypes = Sets.newLinkedHashSet();\n+        fixtureScriptTypes.addAll(\n+            FluentIterable.from(reflections.getSubTypesOf(FixtureScript.class)).\n+                filter(new Predicate<Class<?>>(){\n+                    @Override\n+                    public boolean apply(@Nullable final Class<?> aClass) {\n+                        // ignore as a fixture script if annotated with @Programmatic\n+                        // (though directly implementing DiscoverableFixtureScript takes precedence and will NOT ignore)\n+                        return DiscoverableFixtureScript.class.isAssignableFrom(aClass) ||\n+                        Annotations.getAnnotation(aClass, Programmatic.class) == null;\n+                    }\n+                })\n+                .toList());\n+\n+        final Set<Class<?>> domainObjectTypes = Sets.newLinkedHashSet();\n+        domainObjectTypes.addAll(reflections.getTypesAnnotatedWith(DomainObject.class));\n+        domainObjectTypes.addAll(reflections.getTypesAnnotatedWith(DomainObjectLayout.class));\n \n         final Set<Class<?>> mixinTypes = Sets.newHashSet();\n         mixinTypes.addAll(reflections.getTypesAnnotatedWith(Mixin.class));\n-\n-        final Set<Class<?>> domainObjectTypes = reflections.getTypesAnnotatedWith(DomainObject.class);\n         mixinTypes.addAll(\n                 Lists.newArrayList(Iterables.filter(domainObjectTypes, new Predicate<Class<?>>() {\n                     @Override\n                     public boolean apply(@Nullable final Class<?> input) {\n                         if(input == null) { return false; }\n                         final DomainObject annotation = input.getAnnotation(DomainObject.class);\n-                        return annotation.nature() == Nature.MIXIN;\n+                        return annotation != null && annotation.nature() == Nature.MIXIN;\n                     }\n                 }))\n         );\n \n-        final Set<Class<?>> viewModelTypes = reflections.getTypesAnnotatedWith(ViewModel.class);\n-        final Set<Class<?>> xmlElementTypes = reflections.getTypesAnnotatedWith(XmlElement.class);\n+        final Set<Class<?>> viewModelTypes = Sets.newLinkedHashSet();\n+        viewModelTypes.addAll(reflections.getTypesAnnotatedWith(ViewModel.class));\n+        viewModelTypes.addAll(reflections.getTypesAnnotatedWith(ViewModelLayout.class));\n+\n+        final Set<Class<?>> xmlElementTypes = Sets.newLinkedHashSet();\n+        xmlElementTypes.addAll(reflections.getTypesAnnotatedWith(XmlElement.class));\n \n         // add in any explicitly registered services...\n         domainServiceTypes.addAll(appManifest.getAdditionalServices());\n@@ -183,27 +215,28 @@ public String apply(@Nullable final String s) {\n                 }\n             }).toList();\n \n-        registry.setDomainServiceTypes(within(packagesWithDotSuffix, domainServiceTypes));\n-        registry.setPersistenceCapableTypes(within(packagesWithDotSuffix, persistenceCapableTypes));\n-        registry.setFixtureScriptTypes(within(packagesWithDotSuffix, fixtureScriptTypes));\n-        registry.setMixinTypes(within(packagesWithDotSuffix, mixinTypes));\n-        registry.setDomainObjectTypes(within(packagesWithDotSuffix, domainObjectTypes));\n-        registry.setViewModelTypes(within(packagesWithDotSuffix, viewModelTypes));\n-        registry.setXmlElementTypes(within(packagesWithDotSuffix, xmlElementTypes));\n+        registry.setDomainServiceTypes(withinPackageAndNotAnonymous(packagesWithDotSuffix, domainServiceTypes));\n+        registry.setPersistenceCapableTypes(withinPackageAndNotAnonymous(packagesWithDotSuffix, persistenceCapableTypes));\n+        registry.setFixtureScriptTypes(withinPackageAndNotAnonymous(packagesWithDotSuffix, fixtureScriptTypes));\n+        registry.setMixinTypes(withinPackageAndNotAnonymous(packagesWithDotSuffix, mixinTypes));\n+        registry.setDomainObjectTypes(withinPackageAndNotAnonymous(packagesWithDotSuffix, domainObjectTypes));\n+        registry.setViewModelTypes(withinPackageAndNotAnonymous(packagesWithDotSuffix, viewModelTypes));\n+        registry.setXmlElementTypes(withinPackageAndNotAnonymous(packagesWithDotSuffix, xmlElementTypes));\n     }\n \n-    static <T> Set<Class<? extends T>> within(\n+    static <T> Set<Class<? extends T>> withinPackageAndNotAnonymous(\n             final List<String> packagesWithDotSuffix,\n             final Set<Class<? extends T>> classes) {\n         Set<Class<? extends T>> classesWithin = Sets.newLinkedHashSet();\n         for (Class<? extends T> clz : classes) {\n             final String className = clz.getName();\n-            if(containedWithin(packagesWithDotSuffix, className)) {\n+            if(containedWithin(packagesWithDotSuffix, className) && notAnonymous(clz)) {\n                 classesWithin.add(clz);\n             }\n         }\n         return classesWithin;\n     }\n+\n     static private boolean containedWithin(final List<String> packagesWithDotSuffix, final String className) {\n         for (String packageWithDotSuffix : packagesWithDotSuffix) {\n             if(className.startsWith(packageWithDotSuffix)) {\n@@ -213,6 +246,14 @@ static private boolean containedWithin(final List<String> packagesWithDotSuffix,\n         return false;\n     }\n \n+    private static <T> boolean notAnonymous(final Class<? extends T> clz) {\n+        try {\n+            return !clz.isAnonymousClass();\n+        } catch(NoClassDefFoundError error) {\n+            return false; // ignore, assume anonymous\n+        }\n+    }\n+\n     private void specifyServicesAndRegisteredEntitiesUsing(final AppManifest appManifest) {\n         final Iterable<String> packageNames = modulePackageNamesFrom(appManifest);\n         final String packageNamesCsv = Joiner.on(',').join(packageNames);",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/runtime/src/main/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProvider.java",
                "sha": "680cf05e43f3731c9b51a41ecf7af620bd557c97",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/core/runtime/src/test/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProvider_within_Test.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/test/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProvider_within_Test.java?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 1,
                "filename": "core/runtime/src/test/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProvider_within_Test.java",
                "patch": "@@ -40,7 +40,7 @@ public void within() throws Exception {\n         final String budgetAssignmentPackageWithDot =\n                 SomeServiceNotToInclude.class.getPackage().getName()  + \".\";\n \n-        final Set<Class<?>> within = IsisComponentProvider.within(Arrays.asList(budgetPackageWithDot),\n+        final Set<Class<?>> within = IsisComponentProvider.withinPackageAndNotAnonymous(Arrays.asList(budgetPackageWithDot),\n                 Sets.newHashSet(SomeServiceToInclude.class, SomeServiceNotToInclude.class));\n \n         Assert.assertThat(within.size(), is(equalTo(1)));",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/core/runtime/src/test/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProvider_within_Test.java",
                "sha": "88816e2b8c845d8f9ac08f9e5675bda84ad2964a",
                "status": "modified"
            },
            {
                "additions": 304,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/example/application/simpleapp/application/src/test/java/domainapp/application/integtests/mml/approved/domainapp.application.fixture.scenarios.DomainAppDemo.xml",
                "changes": 304,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/example/application/simpleapp/application/src/test/java/domainapp/application/integtests/mml/approved/domainapp.application.fixture.scenarios.DomainAppDemo.xml?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 0,
                "filename": "example/application/simpleapp/application/src/test/java/domainapp/application/integtests/mml/approved/domainapp.application.fixture.scenarios.DomainAppDemo.xml",
                "patch": "@@ -0,0 +1,304 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n+<mml:domainClassDto id=\"domainapp.application.fixture.scenarios.DomainAppDemo\" xmlns:mml=\"http://isis.apache.org/schema/metamodel\">\n+    <mml:facets>\n+        <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.named.NamedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.all.i18n.NamedFacetTranslated\">\n+            <mml:attr name=\"context\">domainapp.application.fixture.scenarios.DomainAppDemo</mml:attr>\n+            <mml:attr name=\"originalText\">Script</mml:attr>\n+            <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.object.domainobjectlayout.NamedFacetForViewModelLayoutAnnotation</mml:attr>\n+        </mml:facet>\n+        <mml:facet id=\"org.apache.isis.core.metamodel.facets.object.bookmarkpolicy.BookmarkPolicyFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.object.bookmarkpolicy.BookmarkPolicyFacetFallback\">\n+            <mml:attr name=\"bookmarkPolicy\">NEVER</mml:attr>\n+        </mml:facet>\n+        <mml:facet id=\"org.apache.isis.core.metamodel.facets.object.grid.GridFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.object.grid.GridFacetDefault\"/>\n+        <mml:facet id=\"org.apache.isis.core.metamodel.facets.object.membergroups.MemberGroupLayoutFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.object.membergroups.annotprop.MemberGroupLayoutFacetFallback\">\n+            <mml:attr name=\"columns\">[4,0,0,8]</mml:attr>\n+            <mml:attr name=\"left\">General</mml:attr>\n+        </mml:facet>\n+        <mml:facet id=\"org.apache.isis.core.metamodel.facets.object.notpersistable.NotPersistableFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.fallback.NotPersistableFacetNull\">\n+            <mml:attr name=\"disabling\">true</mml:attr>\n+        </mml:facet>\n+        <mml:facet id=\"org.apache.isis.core.metamodel.facets.object.objectspecid.ObjectSpecIdFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.object.objectspecid.classname.ObjectSpecIdFacetDerivedFromClassName\">\n+            <mml:attr name=\"derived\">true</mml:attr>\n+            <mml:attr name=\"value\">domainapp.application.fixture.scenarios.DomainAppDemo</mml:attr>\n+        </mml:facet>\n+        <mml:facet id=\"org.apache.isis.core.metamodel.facets.object.objectvalidprops.ObjectValidPropertiesFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.object.objectvalidprops.impl.ObjectValidPropertiesFacetImpl\">\n+            <mml:attr name=\"validating\">true</mml:attr>\n+        </mml:facet>\n+        <mml:facet id=\"org.apache.isis.core.metamodel.facets.object.paged.PagedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.fallback.PagedFacetFromConfiguration\">\n+            <mml:attr name=\"derived\">true</mml:attr>\n+            <mml:attr name=\"value\">25</mml:attr>\n+        </mml:facet>\n+        <mml:facet id=\"org.apache.isis.core.metamodel.facets.object.plural.PluralFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.all.i18n.PluralFacetTranslated\">\n+            <mml:attr name=\"context\">domainapp.application.fixture.scenarios.DomainAppDemo</mml:attr>\n+            <mml:attr name=\"derived\">true</mml:attr>\n+            <mml:attr name=\"originalText\">Script</mml:attr>\n+        </mml:facet>\n+        <mml:facet id=\"org.apache.isis.core.metamodel.facets.object.title.TitleFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.object.title.annotation.TitleFacetViaTitleAnnotation\">\n+            <mml:attr name=\"components\"></mml:attr>\n+        </mml:facet>\n+        <mml:facet id=\"org.apache.isis.core.metamodel.facets.object.viewmodel.ViewModelFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.object.recreatable.RecreatableObjectFacetForRecreatableObjectInterface\">\n+            <mml:attr name=\"recreationMechanism\">INITIALIZES</mml:attr>\n+        </mml:facet>\n+        <mml:facet id=\"org.apache.isis.core.runtime.authorization.standard.AuthorizationFacet\" fqcn=\"org.apache.isis.core.runtime.authorization.standard.AuthorizationFacetImpl\">\n+            <mml:attr name=\"disabling\">true</mml:attr>\n+            <mml:attr name=\"hiding\">true</mml:attr>\n+        </mml:facet>\n+    </mml:facets>\n+    <mml:properties/>\n+    <mml:collections/>\n+    <mml:actions>\n+        <mml:act id=\"downloadLayoutXml\">\n+            <mml:facets>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.action.hidden.HiddenFacetForActionAnnotation\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.hidden.HiddenFacetForActionAnnotation\">\n+                    <mml:attr name=\"hiding\">true</mml:attr>\n+                    <mml:attr name=\"when\">ALWAYS</mml:attr>\n+                    <mml:attr name=\"where\">NOWHERE</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.action.invocation.ActionDomainEventFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.invocation.ActionDomainEventFacetForActionAnnotation\">\n+                    <mml:attr name=\"disabling\">true</mml:attr>\n+                    <mml:attr name=\"hiding\">true</mml:attr>\n+                    <mml:attr name=\"validating\">true</mml:attr>\n+                    <mml:attr name=\"value\">org.apache.isis.applib.services.layout.Object_downloadLayoutXml.ActionDomainEvent</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.action.invocation.ActionInvocationFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.invocation.ActionInvocationFacetForDomainEventFromActionAnnotation\">\n+                    <mml:attr name=\"eventType\">org.apache.isis.applib.services.layout.Object_downloadLayoutXml.ActionDomainEvent</mml:attr>\n+                    <mml:attr name=\"intent.act\">EXECUTE</mml:attr>\n+                    <mml:attr name=\"methods\">public java.lang.Object org.apache.isis.applib.services.layout.Object_downloadLayoutXml.act(java.lang.String,org.apache.isis.applib.services.layout.LayoutService$Style)</mml:attr>\n+                    <mml:attr name=\"onType\">org.apache.isis.applib.services.layout.Object_downloadLayoutXml</mml:attr>\n+                    <mml:attr name=\"returnType\">java.lang.Object</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.bulk.BulkFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.bulk.BulkFacetForActionAnnotation\">\n+                    <mml:attr name=\"value\">REGULAR_ONLY</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.notcontributed.NotContributedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.layout.NotContributedFacetForActionLayoutAnnotation\">\n+                    <mml:attr name=\"as\">ASSOCIATION</mml:attr>\n+                    <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.actions.notcontributed.derived.NotContributedFacetDerivedFromMixinFacet</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.position.ActionPositionFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.layout.ActionPositionFacetForActionLayoutAnnotation\">\n+                    <mml:attr name=\"position\">PANEL_DROPDOWN</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.prototype.PrototypeFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.prototype.PrototypeFacetForActionAnnotation\">\n+                    <mml:attr name=\"deploymentCategory\">PRODUCTION</mml:attr>\n+                    <mml:attr name=\"hiding\">true</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.semantics.ActionSemanticsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.semantics.ActionSemanticsFacetForActionAnnotation\">\n+                    <mml:attr name=\"value\">SAFE</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.named.NamedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.all.i18n.NamedFacetTranslated\">\n+                    <mml:attr name=\"context\">domainapp.application.fixture.scenarios.DomainAppDemo#downloadLayoutXml()</mml:attr>\n+                    <mml:attr name=\"originalText\">Download Layout Xml</mml:attr>\n+                    <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.all.named.NamedFacetInferred</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.collections.collection.defaultview.DefaultViewFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.collections.layout.DefaultViewFacetForCollectionLayoutAnnotation\">\n+                    <mml:attr name=\"value\">hidden</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.members.cssclassfa.CssClassFaFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.layout.CssClassFaFacetForActionLayoutAnnotation\">\n+                    <mml:attr name=\"position\">LEFT</mml:attr>\n+                    <mml:attr name=\"value\">fa fa-fw fa-download</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.members.order.MemberOrderFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.members.order.annotprop.MemberOrderFacetAnnotation\">\n+                    <mml:attr name=\"name\">datanucleusIdLong</mml:attr>\n+                    <mml:attr name=\"originalName\">datanucleusIdLong</mml:attr>\n+                    <mml:attr name=\"sequence\">700.1</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.object.bookmarkpolicy.BookmarkPolicyFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.object.bookmarkpolicy.BookmarkPolicyFacetFallback\">\n+                    <mml:attr name=\"bookmarkPolicy\">NEVER</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.object.promptStyle.PromptStyleFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.object.promptStyle.PromptStyleFacetFallBackToInline\">\n+                    <mml:attr name=\"derived\">true</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.properties.renderunchanged.UnchangingFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.properties.propertylayout.UnchangingFacetOnPropertyFromLayoutProperties\">\n+                    <mml:attr name=\"value\">false</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.runtime.authorization.standard.AuthorizationFacet\" fqcn=\"org.apache.isis.core.runtime.authorization.standard.AuthorizationFacetImpl\">\n+                    <mml:attr name=\"disabling\">true</mml:attr>\n+                    <mml:attr name=\"hiding\">true</mml:attr>\n+                </mml:facet>\n+            </mml:facets>\n+            <mml:returnType>java.lang.Object</mml:returnType>\n+            <mml:params>\n+                <mml:param xsi:type=\"mml:scalarParam\" id=\"fileName\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n+                    <mml:facets>\n+                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.named.NamedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.all.i18n.NamedFacetTranslated\">\n+                            <mml:attr name=\"context\">org.apache.isis.applib.services.layout.Object_downloadLayoutXml#act(java.lang.String,org.apache.isis.applib.services.layout.LayoutService$Style)</mml:attr>\n+                            <mml:attr name=\"originalText\">File name</mml:attr>\n+                            <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.param.layout.NamedFacetForParameterLayoutAnnotation</mml:attr>\n+                        </mml:facet>\n+                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.objectvalue.labelat.LabelAtFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.layout.LabelAtFacetForParameterLayoutAnnotation\">\n+                            <mml:attr name=\"label\">DEFAULT</mml:attr>\n+                            <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.param.layout.LabelAtFacetForParameterLayoutAnnotation</mml:attr>\n+                        </mml:facet>\n+                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.objectvalue.mandatory.MandatoryFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.objectvalue.mandatory.MandatoryFacetDefault\">\n+                            <mml:attr name=\"inverted\">false</mml:attr>\n+                            <mml:attr name=\"semantics\">REQUIRED</mml:attr>\n+                            <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.objectvalue.mandatory.MandatoryFacetDefault</mml:attr>\n+                            <mml:attr name=\"validating\">true</mml:attr>\n+                        </mml:facet>\n+                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.param.defaults.ActionParameterDefaultsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.defaults.methodnum.ActionParameterDefaultsFacetViaMethod\">\n+                            <mml:attr name=\"intent.default0Act\">DEFAULTS</mml:attr>\n+                            <mml:attr name=\"methods\">public java.lang.String org.apache.isis.applib.services.layout.Object_downloadLayoutXml.default0Act()</mml:attr>\n+                        </mml:facet>\n+                    </mml:facets>\n+                    <mml:type>java.lang.String</mml:type>\n+                </mml:param>\n+                <mml:param xsi:type=\"mml:scalarParam\" id=\"style\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n+                    <mml:facets>\n+                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.objectvalue.mandatory.MandatoryFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.objectvalue.mandatory.MandatoryFacetDefault\">\n+                            <mml:attr name=\"inverted\">false</mml:attr>\n+                            <mml:attr name=\"semantics\">REQUIRED</mml:attr>\n+                            <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.objectvalue.mandatory.MandatoryFacetDefault</mml:attr>\n+                            <mml:attr name=\"validating\">true</mml:attr>\n+                        </mml:facet>\n+                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.param.defaults.ActionParameterDefaultsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.defaults.methodnum.ActionParameterDefaultsFacetViaMethod\">\n+                            <mml:attr name=\"intent.default1Act\">DEFAULTS</mml:attr>\n+                            <mml:attr name=\"methods\">public org.apache.isis.applib.services.layout.LayoutService$Style org.apache.isis.applib.services.layout.Object_downloadLayoutXml.default1Act()</mml:attr>\n+                        </mml:facet>\n+                    </mml:facets>\n+                    <mml:type>org.apache.isis.applib.services.layout.LayoutService$Style</mml:type>\n+                </mml:param>\n+            </mml:params>\n+        </mml:act>\n+        <mml:act id=\"openRestApi\">\n+            <mml:facets>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.action.hidden.HiddenFacetForActionAnnotation\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.hidden.HiddenFacetForActionAnnotation\">\n+                    <mml:attr name=\"hiding\">true</mml:attr>\n+                    <mml:attr name=\"when\">ALWAYS</mml:attr>\n+                    <mml:attr name=\"where\">NOWHERE</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.action.invocation.ActionDomainEventFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.invocation.ActionDomainEventFacetForActionAnnotation\">\n+                    <mml:attr name=\"disabling\">true</mml:attr>\n+                    <mml:attr name=\"hiding\">true</mml:attr>\n+                    <mml:attr name=\"validating\">true</mml:attr>\n+                    <mml:attr name=\"value\">org.apache.isis.applib.services.layout.Object_openRestApi.ActionDomainEvent</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.action.invocation.ActionInvocationFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.invocation.ActionInvocationFacetForDomainEventFromActionAnnotation\">\n+                    <mml:attr name=\"eventType\">org.apache.isis.applib.services.layout.Object_openRestApi.ActionDomainEvent</mml:attr>\n+                    <mml:attr name=\"intent.act\">EXECUTE</mml:attr>\n+                    <mml:attr name=\"methods\">public java.net.URL org.apache.isis.applib.services.layout.Object_openRestApi.act() throws java.net.MalformedURLException</mml:attr>\n+                    <mml:attr name=\"onType\">org.apache.isis.applib.services.layout.Object_openRestApi</mml:attr>\n+                    <mml:attr name=\"returnType\">java.net.URL</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.bulk.BulkFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.bulk.BulkFacetForActionAnnotation\">\n+                    <mml:attr name=\"value\">REGULAR_ONLY</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.notcontributed.NotContributedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.layout.NotContributedFacetForActionLayoutAnnotation\">\n+                    <mml:attr name=\"as\">ASSOCIATION</mml:attr>\n+                    <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.actions.notcontributed.derived.NotContributedFacetDerivedFromMixinFacet</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.position.ActionPositionFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.layout.ActionPositionFacetForActionLayoutAnnotation\">\n+                    <mml:attr name=\"position\">PANEL_DROPDOWN</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.prototype.PrototypeFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.prototype.PrototypeFacetForActionAnnotation\">\n+                    <mml:attr name=\"deploymentCategory\">PRODUCTION</mml:attr>\n+                    <mml:attr name=\"hiding\">true</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.semantics.ActionSemanticsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.semantics.ActionSemanticsFacetForActionAnnotation\">\n+                    <mml:attr name=\"value\">SAFE</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.named.NamedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.all.i18n.NamedFacetTranslated\">\n+                    <mml:attr name=\"context\">domainapp.application.fixture.scenarios.DomainAppDemo#openRestApi()</mml:attr>\n+                    <mml:attr name=\"originalText\">Open Rest Api</mml:attr>\n+                    <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.all.named.NamedFacetInferred</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.collections.collection.defaultview.DefaultViewFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.collections.layout.DefaultViewFacetForCollectionLayoutAnnotation\">\n+                    <mml:attr name=\"value\">hidden</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.members.cssclassfa.CssClassFaFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.layout.CssClassFaFacetForActionLayoutAnnotation\">\n+                    <mml:attr name=\"position\">LEFT</mml:attr>\n+                    <mml:attr name=\"value\">fa fa-fw fa-external-link</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.members.order.MemberOrderFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.members.order.annotprop.MemberOrderFacetAnnotation\">\n+                    <mml:attr name=\"name\">datanucleusIdLong</mml:attr>\n+                    <mml:attr name=\"originalName\">datanucleusIdLong</mml:attr>\n+                    <mml:attr name=\"sequence\">750.1</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.object.bookmarkpolicy.BookmarkPolicyFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.object.bookmarkpolicy.BookmarkPolicyFacetFallback\">\n+                    <mml:attr name=\"bookmarkPolicy\">NEVER</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.object.promptStyle.PromptStyleFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.object.promptStyle.PromptStyleFacetFallBackToInline\">\n+                    <mml:attr name=\"derived\">true</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.properties.renderunchanged.UnchangingFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.properties.propertylayout.UnchangingFacetOnPropertyFromLayoutProperties\">\n+                    <mml:attr name=\"value\">false</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.runtime.authorization.standard.AuthorizationFacet\" fqcn=\"org.apache.isis.core.runtime.authorization.standard.AuthorizationFacetImpl\">\n+                    <mml:attr name=\"disabling\">true</mml:attr>\n+                    <mml:attr name=\"hiding\">true</mml:attr>\n+                </mml:facet>\n+            </mml:facets>\n+            <mml:returnType>java.net.URL</mml:returnType>\n+            <mml:params/>\n+        </mml:act>\n+        <mml:act id=\"rebuildMetamodel\">\n+            <mml:facets>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.action.hidden.HiddenFacetForActionAnnotation\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.hidden.HiddenFacetForActionAnnotation\">\n+                    <mml:attr name=\"hiding\">true</mml:attr>\n+                    <mml:attr name=\"when\">ALWAYS</mml:attr>\n+                    <mml:attr name=\"where\">NOWHERE</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.action.invocation.ActionDomainEventFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.invocation.ActionDomainEventFacetForActionAnnotation\">\n+                    <mml:attr name=\"disabling\">true</mml:attr>\n+                    <mml:attr name=\"hiding\">true</mml:attr>\n+                    <mml:attr name=\"validating\">true</mml:attr>\n+                    <mml:attr name=\"value\">org.apache.isis.applib.services.layout.Object_rebuildMetamodel.ActionDomainEvent</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.action.invocation.ActionInvocationFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.invocation.ActionInvocationFacetForDomainEventFromActionAnnotation\">\n+                    <mml:attr name=\"eventType\">org.apache.isis.applib.services.layout.Object_rebuildMetamodel.ActionDomainEvent</mml:attr>\n+                    <mml:attr name=\"intent.act\">EXECUTE</mml:attr>\n+                    <mml:attr name=\"methods\">public void org.apache.isis.applib.services.layout.Object_rebuildMetamodel.act()</mml:attr>\n+                    <mml:attr name=\"onType\">org.apache.isis.applib.services.layout.Object_rebuildMetamodel</mml:attr>\n+                    <mml:attr name=\"returnType\">void</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.bulk.BulkFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.bulk.BulkFacetForActionAnnotation\">\n+                    <mml:attr name=\"value\">REGULAR_ONLY</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.notcontributed.NotContributedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.layout.NotContributedFacetForActionLayoutAnnotation\">\n+                    <mml:attr name=\"as\">ASSOCIATION</mml:attr>\n+                    <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.actions.notcontributed.derived.NotContributedFacetDerivedFromMixinFacet</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.position.ActionPositionFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.layout.ActionPositionFacetForActionLayoutAnnotation\">\n+                    <mml:attr name=\"position\">PANEL_DROPDOWN</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.prototype.PrototypeFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.prototype.PrototypeFacetForActionAnnotation\">\n+                    <mml:attr name=\"deploymentCategory\">PRODUCTION</mml:attr>\n+                    <mml:attr name=\"hiding\">true</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.semantics.ActionSemanticsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.semantics.ActionSemanticsFacetForActionAnnotation\">\n+                    <mml:attr name=\"value\">IDEMPOTENT</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.named.NamedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.all.i18n.NamedFacetTranslated\">\n+                    <mml:attr name=\"context\">domainapp.application.fixture.scenarios.DomainAppDemo#rebuildMetamodel()</mml:attr>\n+                    <mml:attr name=\"originalText\">Rebuild Metamodel</mml:attr>\n+                    <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.all.named.NamedFacetInferred</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.collections.collection.defaultview.DefaultViewFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.collections.layout.DefaultViewFacetForCollectionLayoutAnnotation\">\n+                    <mml:attr name=\"value\">hidden</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.members.cssclassfa.CssClassFaFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.layout.CssClassFaFacetForActionLayoutAnnotation\">\n+                    <mml:attr name=\"position\">LEFT</mml:attr>\n+                    <mml:attr name=\"value\">fa fa-fw fa-refresh</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.members.order.MemberOrderFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.members.order.annotprop.MemberOrderFacetAnnotation\">\n+                    <mml:attr name=\"name\">datanucleusIdLong</mml:attr>\n+                    <mml:attr name=\"originalName\">datanucleusIdLong</mml:attr>\n+                    <mml:attr name=\"sequence\">800.1</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.object.bookmarkpolicy.BookmarkPolicyFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.object.bookmarkpolicy.BookmarkPolicyFacetFallback\">\n+                    <mml:attr name=\"bookmarkPolicy\">NEVER</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.object.promptStyle.PromptStyleFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.object.promptStyle.PromptStyleFacetFallBackToInline\">\n+                    <mml:attr name=\"derived\">true</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.properties.renderunchanged.UnchangingFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.properties.propertylayout.UnchangingFacetOnPropertyFromLayoutProperties\">\n+                    <mml:attr name=\"value\">false</mml:attr>\n+                </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.runtime.authorization.standard.AuthorizationFacet\" fqcn=\"org.apache.isis.core.runtime.authorization.standard.AuthorizationFacetImpl\">\n+                    <mml:attr name=\"disabling\">true</mml:attr>\n+                    <mml:attr name=\"hiding\">true</mml:attr>\n+                </mml:facet>\n+            </mml:facets>\n+            <mml:returnType>void</mml:returnType>\n+            <mml:params/>\n+        </mml:act>\n+    </mml:actions>\n+</mml:domainClassDto>",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/example/application/simpleapp/application/src/test/java/domainapp/application/integtests/mml/approved/domainapp.application.fixture.scenarios.DomainAppDemo.xml",
                "sha": "4258961c2d0bc2b5bad2c5cd4883f0af2fa2fc08",
                "status": "added"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/example/application/simpleapp/application/src/test/java/domainapp/application/integtests/mml/approved/domainapp.application.services.homepage.HomePageViewModel.xml",
                "changes": 24,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/example/application/simpleapp/application/src/test/java/domainapp/application/integtests/mml/approved/domainapp.application.services.homepage.HomePageViewModel.xml?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 24,
                "filename": "example/application/simpleapp/application/src/test/java/domainapp/application/integtests/mml/approved/domainapp.application.services.homepage.HomePageViewModel.xml",
                "patch": "@@ -168,7 +168,6 @@\n                 <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.semantics.ActionSemanticsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.semantics.ActionSemanticsFacetForActionAnnotation\">\n                     <mml:attr name=\"value\">SAFE</mml:attr>\n                 </mml:facet>\n-                <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.describedas.DescribedAsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.members.describedas.annotprop.DescribedAsFacetOnMemberDerivedFromType\"/>\n                 <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.named.NamedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.all.i18n.NamedFacetTranslated\">\n                     <mml:attr name=\"context\">domainapp.application.services.homepage.HomePageViewModel#downloadLayoutXml()</mml:attr>\n                     <mml:attr name=\"originalText\">Download Layout Xml</mml:attr>\n@@ -204,11 +203,6 @@\n             <mml:params>\n                 <mml:param xsi:type=\"mml:scalarParam\" id=\"fileName\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n                     <mml:facets>\n-                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.defaults.ActionDefaultsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.defaults.fromtype.ActionParameterDefaultFacetDerivedFromTypeFacets\">\n-                            <mml:attr name=\"defaultFacets\">org.apache.isis.core.metamodel.facets.object.defaults.DefaultedFacetUsingDefaultsProvider;org.apache.isis.core.metamodel.facets.object.defaults.DefaultedFacetUsingDefaultsProvider</mml:attr>\n-                            <mml:attr name=\"derived\">true</mml:attr>\n-                        </mml:facet>\n-                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.describedas.DescribedAsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.describedas.annotderived.DescribedAsFacetOnParameterDerivedFromType\"/>\n                         <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.named.NamedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.all.i18n.NamedFacetTranslated\">\n                             <mml:attr name=\"context\">org.apache.isis.applib.services.layout.Object_downloadLayoutXml#act(java.lang.String,org.apache.isis.applib.services.layout.LayoutService$Style)</mml:attr>\n                             <mml:attr name=\"originalText\">File name</mml:attr>\n@@ -224,11 +218,6 @@\n                             <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.objectvalue.mandatory.MandatoryFacetDefault</mml:attr>\n                             <mml:attr name=\"validating\">true</mml:attr>\n                         </mml:facet>\n-                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.objectvalue.typicallen.TypicalLengthFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromType\">\n-                            <mml:attr name=\"derived\">true</mml:attr>\n-                            <mml:attr name=\"typicalLengthFacet\">org.apache.isis.core.metamodel.facets.object.value.TypicalLengthFacetUsingParser</mml:attr>\n-                            <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromType</mml:attr>\n-                        </mml:facet>\n                         <mml:facet id=\"org.apache.isis.core.metamodel.facets.param.defaults.ActionParameterDefaultsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.defaults.methodnum.ActionParameterDefaultsFacetViaMethod\">\n                             <mml:attr name=\"intent.default0Act\">DEFAULTS</mml:attr>\n                             <mml:attr name=\"methods\">public java.lang.String org.apache.isis.applib.services.layout.Object_downloadLayoutXml.default0Act()</mml:attr>\n@@ -238,23 +227,12 @@\n                 </mml:param>\n                 <mml:param xsi:type=\"mml:scalarParam\" id=\"style\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n                     <mml:facets>\n-                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.defaults.ActionDefaultsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.defaults.fromtype.ActionParameterDefaultFacetDerivedFromTypeFacets\">\n-                            <mml:attr name=\"defaultFacets\">org.apache.isis.core.metamodel.facets.object.defaults.DefaultedFacetUsingDefaultsProvider;org.apache.isis.core.metamodel.facets.object.defaults.DefaultedFacetUsingDefaultsProvider</mml:attr>\n-                            <mml:attr name=\"derived\">true</mml:attr>\n-                        </mml:facet>\n-                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.describedas.DescribedAsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.describedas.annotderived.DescribedAsFacetOnParameterDerivedFromType\"/>\n                         <mml:facet id=\"org.apache.isis.core.metamodel.facets.objectvalue.mandatory.MandatoryFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.objectvalue.mandatory.MandatoryFacetDefault\">\n                             <mml:attr name=\"inverted\">false</mml:attr>\n                             <mml:attr name=\"semantics\">REQUIRED</mml:attr>\n                             <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.objectvalue.mandatory.MandatoryFacetDefault</mml:attr>\n                             <mml:attr name=\"validating\">true</mml:attr>\n                         </mml:facet>\n-                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.objectvalue.typicallen.TypicalLengthFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromType\">\n-                            <mml:attr name=\"derived\">true</mml:attr>\n-                            <mml:attr name=\"typicalLengthFacet\">org.apache.isis.core.metamodel.facets.object.value.TypicalLengthFacetUsingParser</mml:attr>\n-                            <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromType</mml:attr>\n-                        </mml:facet>\n-                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.param.choices.ActionParameterChoicesFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.choices.enums.ActionParameterChoicesFacetDerivedFromChoicesFacet\"/>\n                         <mml:facet id=\"org.apache.isis.core.metamodel.facets.param.defaults.ActionParameterDefaultsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.defaults.methodnum.ActionParameterDefaultsFacetViaMethod\">\n                             <mml:attr name=\"intent.default1Act\">DEFAULTS</mml:attr>\n                             <mml:attr name=\"methods\">public org.apache.isis.applib.services.layout.LayoutService$Style org.apache.isis.applib.services.layout.Object_downloadLayoutXml.default1Act()</mml:attr>\n@@ -301,7 +279,6 @@\n                 <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.semantics.ActionSemanticsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.semantics.ActionSemanticsFacetForActionAnnotation\">\n                     <mml:attr name=\"value\">SAFE</mml:attr>\n                 </mml:facet>\n-                <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.describedas.DescribedAsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.members.describedas.annotprop.DescribedAsFacetOnMemberDerivedFromType\"/>\n                 <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.named.NamedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.all.i18n.NamedFacetTranslated\">\n                     <mml:attr name=\"context\">domainapp.application.services.homepage.HomePageViewModel#openRestApi()</mml:attr>\n                     <mml:attr name=\"originalText\">Open Rest Api</mml:attr>\n@@ -373,7 +350,6 @@\n                 <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.semantics.ActionSemanticsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.semantics.ActionSemanticsFacetForActionAnnotation\">\n                     <mml:attr name=\"value\">IDEMPOTENT</mml:attr>\n                 </mml:facet>\n-                <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.describedas.DescribedAsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.members.describedas.annotprop.DescribedAsFacetOnMemberDerivedFromType\"/>\n                 <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.named.NamedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.all.i18n.NamedFacetTranslated\">\n                     <mml:attr name=\"context\">domainapp.application.services.homepage.HomePageViewModel#rebuildMetamodel()</mml:attr>\n                     <mml:attr name=\"originalText\">Rebuild Metamodel</mml:attr>",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/example/application/simpleapp/application/src/test/java/domainapp/application/integtests/mml/approved/domainapp.application.services.homepage.HomePageViewModel.xml",
                "sha": "0548356a395042b1f572e9c815d7635c04631838",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/example/application/simpleapp/application/src/test/java/domainapp/application/integtests/mml/approved/domainapp.modules.simple.dom.impl.SimpleObject.xml",
                "changes": 36,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/example/application/simpleapp/application/src/test/java/domainapp/application/integtests/mml/approved/domainapp.modules.simple.dom.impl.SimpleObject.xml?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 36,
                "filename": "example/application/simpleapp/application/src/test/java/domainapp/application/integtests/mml/approved/domainapp.modules.simple.dom.impl.SimpleObject.xml",
                "patch": "@@ -602,7 +602,6 @@\n                 <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.semantics.ActionSemanticsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.semantics.ActionSemanticsFacetForActionAnnotation\">\n                     <mml:attr name=\"value\">SAFE</mml:attr>\n                 </mml:facet>\n-                <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.describedas.DescribedAsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.members.describedas.annotprop.DescribedAsFacetOnMemberDerivedFromType\"/>\n                 <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.named.NamedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.all.i18n.NamedFacetTranslated\">\n                     <mml:attr name=\"context\">domainapp.modules.simple.dom.impl.SimpleObject#downloadJdoMetadata()</mml:attr>\n                     <mml:attr name=\"originalText\">Download Jdo Metadata</mml:attr>\n@@ -638,11 +637,6 @@\n             <mml:params>\n                 <mml:param xsi:type=\"mml:scalarParam\" id=\"fileName\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n                     <mml:facets>\n-                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.defaults.ActionDefaultsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.defaults.fromtype.ActionParameterDefaultFacetDerivedFromTypeFacets\">\n-                            <mml:attr name=\"defaultFacets\">org.apache.isis.core.metamodel.facets.object.defaults.DefaultedFacetUsingDefaultsProvider</mml:attr>\n-                            <mml:attr name=\"derived\">true</mml:attr>\n-                        </mml:facet>\n-                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.describedas.DescribedAsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.describedas.annotderived.DescribedAsFacetOnParameterDerivedFromType\"/>\n                         <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.named.NamedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.all.i18n.NamedFacetTranslated\">\n                             <mml:attr name=\"context\">org.apache.isis.core.metamodel.services.jdosupport.Persistable_downloadJdoMetadata#act(java.lang.String)</mml:attr>\n                             <mml:attr name=\"originalText\">File name</mml:attr>\n@@ -658,11 +652,6 @@\n                             <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.objectvalue.mandatory.MandatoryFacetDefault</mml:attr>\n                             <mml:attr name=\"validating\">true</mml:attr>\n                         </mml:facet>\n-                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.objectvalue.typicallen.TypicalLengthFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromType\">\n-                            <mml:attr name=\"derived\">true</mml:attr>\n-                            <mml:attr name=\"typicalLengthFacet\">org.apache.isis.core.metamodel.facets.object.value.TypicalLengthFacetUsingParser</mml:attr>\n-                            <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromType</mml:attr>\n-                        </mml:facet>\n                         <mml:facet id=\"org.apache.isis.core.metamodel.facets.param.defaults.ActionParameterDefaultsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.defaults.methodnum.ActionParameterDefaultsFacetViaMethod\">\n                             <mml:attr name=\"intent.default0Act\">DEFAULTS</mml:attr>\n                             <mml:attr name=\"methods\">public java.lang.String org.apache.isis.core.metamodel.services.jdosupport.Persistable_downloadJdoMetadata.default0Act()</mml:attr>\n@@ -709,7 +698,6 @@\n                 <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.semantics.ActionSemanticsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.semantics.ActionSemanticsFacetForActionAnnotation\">\n                     <mml:attr name=\"value\">SAFE</mml:attr>\n                 </mml:facet>\n-                <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.describedas.DescribedAsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.members.describedas.annotprop.DescribedAsFacetOnMemberDerivedFromType\"/>\n                 <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.named.NamedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.all.i18n.NamedFacetTranslated\">\n                     <mml:attr name=\"context\">domainapp.modules.simple.dom.impl.SimpleObject#downloadLayoutXml()</mml:attr>\n                     <mml:attr name=\"originalText\">Download Layout Xml</mml:attr>\n@@ -745,11 +733,6 @@\n             <mml:params>\n                 <mml:param xsi:type=\"mml:scalarParam\" id=\"fileName\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n                     <mml:facets>\n-                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.defaults.ActionDefaultsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.defaults.fromtype.ActionParameterDefaultFacetDerivedFromTypeFacets\">\n-                            <mml:attr name=\"defaultFacets\">org.apache.isis.core.metamodel.facets.object.defaults.DefaultedFacetUsingDefaultsProvider;org.apache.isis.core.metamodel.facets.object.defaults.DefaultedFacetUsingDefaultsProvider</mml:attr>\n-                            <mml:attr name=\"derived\">true</mml:attr>\n-                        </mml:facet>\n-                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.describedas.DescribedAsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.describedas.annotderived.DescribedAsFacetOnParameterDerivedFromType\"/>\n                         <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.named.NamedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.all.i18n.NamedFacetTranslated\">\n                             <mml:attr name=\"context\">org.apache.isis.applib.services.layout.Object_downloadLayoutXml#act(java.lang.String,org.apache.isis.applib.services.layout.LayoutService$Style)</mml:attr>\n                             <mml:attr name=\"originalText\">File name</mml:attr>\n@@ -765,11 +748,6 @@\n                             <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.objectvalue.mandatory.MandatoryFacetDefault</mml:attr>\n                             <mml:attr name=\"validating\">true</mml:attr>\n                         </mml:facet>\n-                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.objectvalue.typicallen.TypicalLengthFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromType\">\n-                            <mml:attr name=\"derived\">true</mml:attr>\n-                            <mml:attr name=\"typicalLengthFacet\">org.apache.isis.core.metamodel.facets.object.value.TypicalLengthFacetUsingParser</mml:attr>\n-                            <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromType</mml:attr>\n-                        </mml:facet>\n                         <mml:facet id=\"org.apache.isis.core.metamodel.facets.param.defaults.ActionParameterDefaultsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.defaults.methodnum.ActionParameterDefaultsFacetViaMethod\">\n                             <mml:attr name=\"intent.default0Act\">DEFAULTS</mml:attr>\n                             <mml:attr name=\"methods\">public java.lang.String org.apache.isis.applib.services.layout.Object_downloadLayoutXml.default0Act()</mml:attr>\n@@ -779,23 +757,12 @@\n                 </mml:param>\n                 <mml:param xsi:type=\"mml:scalarParam\" id=\"style\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n                     <mml:facets>\n-                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.defaults.ActionDefaultsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.defaults.fromtype.ActionParameterDefaultFacetDerivedFromTypeFacets\">\n-                            <mml:attr name=\"defaultFacets\">org.apache.isis.core.metamodel.facets.object.defaults.DefaultedFacetUsingDefaultsProvider;org.apache.isis.core.metamodel.facets.object.defaults.DefaultedFacetUsingDefaultsProvider</mml:attr>\n-                            <mml:attr name=\"derived\">true</mml:attr>\n-                        </mml:facet>\n-                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.describedas.DescribedAsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.describedas.annotderived.DescribedAsFacetOnParameterDerivedFromType\"/>\n                         <mml:facet id=\"org.apache.isis.core.metamodel.facets.objectvalue.mandatory.MandatoryFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.objectvalue.mandatory.MandatoryFacetDefault\">\n                             <mml:attr name=\"inverted\">false</mml:attr>\n                             <mml:attr name=\"semantics\">REQUIRED</mml:attr>\n                             <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.objectvalue.mandatory.MandatoryFacetDefault</mml:attr>\n                             <mml:attr name=\"validating\">true</mml:attr>\n                         </mml:facet>\n-                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.objectvalue.typicallen.TypicalLengthFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromType\">\n-                            <mml:attr name=\"derived\">true</mml:attr>\n-                            <mml:attr name=\"typicalLengthFacet\">org.apache.isis.core.metamodel.facets.object.value.TypicalLengthFacetUsingParser</mml:attr>\n-                            <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromType</mml:attr>\n-                        </mml:facet>\n-                        <mml:facet id=\"org.apache.isis.core.metamodel.facets.param.choices.ActionParameterChoicesFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.choices.enums.ActionParameterChoicesFacetDerivedFromChoicesFacet\"/>\n                         <mml:facet id=\"org.apache.isis.core.metamodel.facets.param.defaults.ActionParameterDefaultsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.defaults.methodnum.ActionParameterDefaultsFacetViaMethod\">\n                             <mml:attr name=\"intent.default1Act\">DEFAULTS</mml:attr>\n                             <mml:attr name=\"methods\">public org.apache.isis.applib.services.layout.LayoutService$Style org.apache.isis.applib.services.layout.Object_downloadLayoutXml.default1Act()</mml:attr>\n@@ -842,7 +809,6 @@\n                 <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.semantics.ActionSemanticsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.semantics.ActionSemanticsFacetForActionAnnotation\">\n                     <mml:attr name=\"value\">SAFE</mml:attr>\n                 </mml:facet>\n-                <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.describedas.DescribedAsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.members.describedas.annotprop.DescribedAsFacetOnMemberDerivedFromType\"/>\n                 <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.named.NamedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.all.i18n.NamedFacetTranslated\">\n                     <mml:attr name=\"context\">domainapp.modules.simple.dom.impl.SimpleObject#openRestApi()</mml:attr>\n                     <mml:attr name=\"originalText\">Open Rest Api</mml:attr>\n@@ -914,7 +880,6 @@\n                 <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.semantics.ActionSemanticsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.semantics.ActionSemanticsFacetForActionAnnotation\">\n                     <mml:attr name=\"value\">IDEMPOTENT</mml:attr>\n                 </mml:facet>\n-                <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.describedas.DescribedAsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.members.describedas.annotprop.DescribedAsFacetOnMemberDerivedFromType\"/>\n                 <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.named.NamedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.all.i18n.NamedFacetTranslated\">\n                     <mml:attr name=\"context\">domainapp.modules.simple.dom.impl.SimpleObject#rebuildMetamodel()</mml:attr>\n                     <mml:attr name=\"originalText\">Rebuild Metamodel</mml:attr>\n@@ -1060,7 +1025,6 @@\n                         <mml:facet id=\"org.apache.isis.core.metamodel.facets.objectvalue.typicallen.TypicalLengthFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromType\">\n                             <mml:attr name=\"derived\">true</mml:attr>\n                             <mml:attr name=\"typicalLengthFacet\">org.apache.isis.core.metamodel.facets.object.value.TypicalLengthFacetUsingParser</mml:attr>\n-                            <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromType</mml:attr>\n                         </mml:facet>\n                         <mml:facet id=\"org.apache.isis.core.metamodel.facets.param.defaults.ActionParameterDefaultsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.defaults.methodnum.ActionParameterDefaultsFacetViaMethod\">\n                             <mml:attr name=\"intent.default0UpdateName\">DEFAULTS</mml:attr>",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/example/application/simpleapp/application/src/test/java/domainapp/application/integtests/mml/approved/domainapp.modules.simple.dom.impl.SimpleObject.xml",
                "sha": "ad36bf29160c6f5ce9742ac95ef7307ca7aa1b59",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/isis/blob/813a313023c5a3285828174a53507df556196ecd/example/application/simpleapp/application/src/test/java/domainapp/application/integtests/mml/approved/domainapp.modules.simple.dom.impl.SimpleObjects.xml",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/example/application/simpleapp/application/src/test/java/domainapp/application/integtests/mml/approved/domainapp.modules.simple.dom.impl.SimpleObjects.xml?ref=813a313023c5a3285828174a53507df556196ecd",
                "deletions": 2,
                "filename": "example/application/simpleapp/application/src/test/java/domainapp/application/integtests/mml/approved/domainapp.modules.simple.dom.impl.SimpleObjects.xml",
                "patch": "@@ -88,6 +88,7 @@\n                 <mml:facet id=\"org.apache.isis.core.metamodel.facets.actions.semantics.ActionSemanticsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.actions.action.semantics.ActionSemanticsFacetForActionAnnotation\">\n                     <mml:attr name=\"value\">NON_IDEMPOTENT</mml:attr>\n                 </mml:facet>\n+                <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.describedas.DescribedAsFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.members.describedas.annotprop.DescribedAsFacetOnMemberDerivedFromType\"/>\n                 <mml:facet id=\"org.apache.isis.core.metamodel.facets.all.named.NamedFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.all.i18n.NamedFacetTranslated\">\n                     <mml:attr name=\"context\">domainapp.modules.simple.dom.impl.SimpleObjects#create()</mml:attr>\n                     <mml:attr name=\"originalText\">Create</mml:attr>\n@@ -141,7 +142,6 @@\n                         <mml:facet id=\"org.apache.isis.core.metamodel.facets.objectvalue.typicallen.TypicalLengthFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromType\">\n                             <mml:attr name=\"derived\">true</mml:attr>\n                             <mml:attr name=\"typicalLengthFacet\">org.apache.isis.core.metamodel.facets.object.value.TypicalLengthFacetUsingParser</mml:attr>\n-                            <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromType</mml:attr>\n                         </mml:facet>\n                     </mml:facets>\n                     <mml:type>java.lang.String</mml:type>\n@@ -245,7 +245,6 @@\n                         <mml:facet id=\"org.apache.isis.core.metamodel.facets.objectvalue.typicallen.TypicalLengthFacet\" fqcn=\"org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromType\">\n                             <mml:attr name=\"derived\">true</mml:attr>\n                             <mml:attr name=\"typicalLengthFacet\">org.apache.isis.core.metamodel.facets.object.value.TypicalLengthFacetUsingParser</mml:attr>\n-                            <mml:attr name=\"underlyingFacet\">org.apache.isis.core.metamodel.facets.param.typicallen.fromtype.TypicalLengthFacetOnParameterDerivedFromType</mml:attr>\n                         </mml:facet>\n                     </mml:facets>\n                     <mml:type>java.lang.String</mml:type>",
                "raw_url": "https://github.com/apache/isis/raw/813a313023c5a3285828174a53507df556196ecd/example/application/simpleapp/application/src/test/java/domainapp/application/integtests/mml/approved/domainapp.modules.simple.dom.impl.SimpleObjects.xml",
                "sha": "f73b959a4865b67f90a45743781805b9227a7481",
                "status": "modified"
            }
        ],
        "message": "ISIS-1974: fixes to ensure new algorithm generates same metamodel as previously.\n\nMore or less, that is.\n\nThe main change here is that some facet factories have been reimplemented in the SpecLoader PostProcessor, namely those that derive facets on object members based on the facets from the type of those members ... typical length, described as, immutable => disabled, param defaults.\n- for now, the unused facets have been left in the codebase, commented out of ProgrammingModelFacetsJava5; the post-processor's name (ActionCollectionParameterDefaultsAndChoicesPostProcessor) is unchanged even though it now does much more than it used to\n\nThis results in some minor differences... ImmutableFacet is no longer always installed, for example, if DisabledFacet is present instead.\n\nIn addition to the PostProcessor changes:\n- call post processing without requiring there to be an open session.  Note that this requires a minor refactor in OneTo{One/Many}ActionParameterContributee - these take the servicePojo rather than the serviceAdapter\n- refactor SpecificationCacheDefault, init() semantics are now cleaner\n  - it no longer takes a map (and the old init is now internalInit)\n  - SpecificationLoader#cacheBySpecId now removed - this is basically what is in the new version of init in SpecificationCacheDefault\n- also search for @DomainServiceLayout, @DomainObjectLayout, @ViewModelLayout to find classes to introspect during bootstrapping\n- don't introspect @Programmatic fixture scripts (unless they are explicitly discoverable by implementing DiscoverableFixtureScript)\n- don't create any associations/actions for any domain services that have a nature of DOMAIN (unless they are also @HomePage domain service)\n- don't create any associations/actions for fixture scripts\n- OneTo{One/Many}AssociationContributee now implement getOnType (was throwing an NPE) & OneToManyAssociationMixedIn now implements getOnType (OTOAMI was already)\n  - these are to allow the implementatoin of the post-processor to look up the parent spec if the member is a mixin or contributee\n- MetaModelExporter now includes a check that the objectSpecId -> ObjectSpecification is one-to-one.\n  - this is what precipitated the refactoring of SpecificationCacheDefault\n- adds a guard in TypicalLengthFacetOnPropertyDerivedFromType, which was NPE'ing\n- in the metamodel validator, as an ugly special case, allow ObjectSpecIdFacet to be derived from class name\n  - seems ok, since no longer have actoins on fixture scripts in the metamodel.  Also, there are fixtures in the incode platform that fall foul of this check\n- allow @Programmatic to be specified on fields\n- annotate various fixture scripts as @Programmatic (so that they will be skipped completely from the metamodel)\n  - BuilderFixtureScript, TeardownFixtureScriptAbstract, PersonaEnumPersistAll, ClockFixture, TickingClockFixture\n- fixed bug with MetaModelService6.Config class for getPackagePrefixes()\n-",
        "parent": "https://github.com/apache/isis/commit/7864506fab5c4aa9599d220e9b0481f8eb2511d5",
        "patched_files": [
            "SpecificationCacheDefault.java",
            "OneToManyAssociationContributee.java",
            "ObjectMemberAbstract.java",
            "DescribedAsFacetOnMemberFactory.java",
            "BuilderScriptAbstract.java",
            "OneToOneActionParameterContributee.java",
            "ObjectSpecificationDefault.java",
            "DisabledFacetOnCollectionDerivedFromImmutableFactory.java",
            "MetaModelExporter.java",
            "ObjectActionParameterAbstract.java",
            "ClockFixture.java",
            "ActionParameterDefaultFacetDerivedFromTypeFactory.java",
            "ObjectActionContributee.java",
            "ActionCollectionParameterDefaultsAndChoicesPostProcessor.java",
            "Programmatic.java",
            "ObjectActionParameterContributeeAbstract.java",
            "TeardownFixtureAbstract.java",
            "DisabledFacetOnPropertyDerivedFromImmutableFactory.java",
            "ProgrammingModelFacetsJava5.java",
            "domainapp.java",
            "IsisComponentProvider.java",
            "OneToOneAssociationContributee.java",
            "TickingClockFixture.java",
            "TypicalLengthFacetOnPropertyDerivedFromType.java",
            "SpecificationLoader.java",
            "OneToManyAssociationMixedIn.java",
            "MetaModelService6.java",
            "IsisSessionFactoryBuilder.java",
            "PersonaEnumPersistAll.java",
            "ObjectSpecIdFacetDerivedFromClassNameFactory.java",
            "Annotations.java",
            "OneToManyActionParameterContributee.java"
        ],
        "repo": "isis",
        "unit_tests": [
            "MetaModelService6_Config_Test.java",
            "AnnotationsTest.java",
            "ObjectMemberAbstractTest.java",
            "ObjectSpecIdFacetDerivedFromClassNameFactoryTest.java",
            "IsisComponentProvider_within_Test.java",
            "SpecificationCacheDefaultTest.java"
        ]
    },
    "isis_8b7267e": {
        "bug_id": "isis_8b7267e",
        "commit": "https://github.com/apache/isis/commit/8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd",
        "file": [
            {
                "additions": 13,
                "blob_url": "https://github.com/apache/isis/blob/8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/collectioncontents/ajaxtable/CollectionContentsAsAjaxTablePanel.css",
                "changes": 13,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/collectioncontents/ajaxtable/CollectionContentsAsAjaxTablePanel.css?ref=8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd",
                "deletions": 0,
                "filename": "component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/collectioncontents/ajaxtable/CollectionContentsAsAjaxTablePanel.css",
                "patch": "@@ -139,3 +139,16 @@\n .collectionContentsAsAjaxTablePanel .table-responsive {\n \toverflow-x: auto;\n }\n+\n+.collectionContentsAsAjaxTablePanel table tbody tr:last-child td {\n+    border-bottom: none;\n+}\n+\n+.collectionContentsAsAjaxTablePanel table tfoot tr:first-child td {\n+    border-top: none;\n+    border-bottom: none;\n+}\n+\n+.collectionContentsAsAjaxTablePanel .table {\n+    margin-bottom: 0px;\n+}\n\\ No newline at end of file",
                "raw_url": "https://github.com/apache/isis/raw/8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/collectioncontents/ajaxtable/CollectionContentsAsAjaxTablePanel.css",
                "sha": "66587b75e64a47b9b2b358bd5d43913bb53b89ac",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/isis/blob/8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/collectioncontents/ajaxtable/CollectionContentsAsAjaxTablePanel.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/collectioncontents/ajaxtable/CollectionContentsAsAjaxTablePanel.java?ref=8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd",
                "deletions": 6,
                "filename": "component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/collectioncontents/ajaxtable/CollectionContentsAsAjaxTablePanel.java",
                "patch": "@@ -45,7 +45,6 @@\n import org.apache.isis.viewer.wicket.model.isis.WicketViewerSettings;\n import org.apache.isis.viewer.wicket.model.mementos.ObjectAdapterMemento;\n import org.apache.isis.viewer.wicket.model.models.EntityCollectionModel;\n-import org.apache.isis.viewer.wicket.ui.components.collection.bulk.BulkActionsHelper;\n import org.apache.isis.viewer.wicket.ui.components.collection.bulk.BulkActionsProvider;\n import org.apache.isis.viewer.wicket.ui.components.collection.count.CollectionCountProvider;\n import org.apache.isis.viewer.wicket.ui.components.collectioncontents.ajaxtable.columns.ColumnAbstract;\n@@ -64,17 +63,12 @@\n     private static final long serialVersionUID = 1L;\n \n     private static final String ID_TABLE = \"table\";\n-    private static final String ID_ACTION_PROMPT_MODAL_WINDOW = \"actionPromptModalWindow\";\n-    private static final String ID_ENTITY_ACTIONS = \"entityActions\";\n \n     private IsisAjaxFallbackDataTable<ObjectAdapter,String> dataTable;\n \n-    private final BulkActionsHelper bulkActionsHelper;\n-\n \n     public CollectionContentsAsAjaxTablePanel(final String id, final EntityCollectionModel model) {\n         super(id, model);\n-        bulkActionsHelper = new BulkActionsHelper(model);\n     }\n     \n     @Override",
                "raw_url": "https://github.com/apache/isis/raw/8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/collectioncontents/ajaxtable/CollectionContentsAsAjaxTablePanel.java",
                "sha": "44669cd9d8688772591e0dc1a5103dfe169b88f6",
                "status": "modified"
            },
            {
                "additions": 23,
                "blob_url": "https://github.com/apache/isis/blob/8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/collectioncontents/multiple/CollectionContentsMultipleViewsPanel.java",
                "changes": 43,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/collectioncontents/multiple/CollectionContentsMultipleViewsPanel.java?ref=8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd",
                "deletions": 20,
                "filename": "component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/collectioncontents/multiple/CollectionContentsMultipleViewsPanel.java",
                "patch": "@@ -33,8 +33,8 @@\n import org.apache.isis.viewer.wicket.ui.ComponentFactory;\n import org.apache.isis.viewer.wicket.ui.ComponentType;\n import org.apache.isis.viewer.wicket.ui.components.collection.count.CollectionCountProvider;\n-import org.apache.isis.viewer.wicket.ui.components.collection.selector.CollectionSelectorPanel;\n import org.apache.isis.viewer.wicket.ui.components.collection.selector.CollectionSelectorHelper;\n+import org.apache.isis.viewer.wicket.ui.components.collection.selector.CollectionSelectorPanel;\n import org.apache.isis.viewer.wicket.ui.components.collection.selector.CollectionSelectorProvider;\n import org.apache.isis.viewer.wicket.ui.panels.PanelAbstract;\n import org.apache.isis.viewer.wicket.ui.panels.PanelUtil;\n@@ -163,31 +163,34 @@ public void onEvent(IEvent<?> event) {\n                 if(view >= 0 && view < componentFactories.size()) {\n                     underlyingViewNum = view;\n                 }\n-            } catch(NumberFormatException ex) {\n-                // ignore\n-            }\n-        }\n \n-        final EntityCollectionModel dummyModel = getModel().asDummy();\n-        for(int i=0; i<MAX_NUM_UNDERLYING_VIEWS; i++) {\n-            final Component component = underlyingViews[i];\n-            if(component == null) {\n-                continue;\n-            }\n-            final boolean isSelected = i == underlyingViewNum;\n-            applyCssVisibility(component, isSelected);\n-            component.setDefaultModel(isSelected? getModel(): dummyModel);\n-        }\n \n-        this.selectedComponentFactory = ignoreFactory;\n-        this.selectedComponent = underlyingViews[underlyingViewNum];\n+                final EntityCollectionModel dummyModel = getModel().asDummy();\n+                for(int i=0; i<MAX_NUM_UNDERLYING_VIEWS; i++) {\n+                    final Component component = underlyingViews[i];\n+                    if(component == null) {\n+                        continue;\n+                    }\n+                    final boolean isSelected = i == underlyingViewNum;\n+                    applyCssVisibility(component, isSelected);\n+                    component.setDefaultModel(isSelected? getModel(): dummyModel);\n+                }\n+\n+                this.selectedComponentFactory = ignoreFactory;\n+                this.selectedComponent = underlyingViews[underlyingViewNum];\n \n \n-        final AjaxRequestTarget target = uiHintEvent.getTarget();\n-        if(target != null) {\n-            target.add(this, selectorDropdownPanel);\n+                final AjaxRequestTarget target = uiHintEvent.getTarget();\n+                if(target != null) {\n+                    target.add(this, selectorDropdownPanel);\n+                }\n+\n+            } catch(NumberFormatException ex) {\n+                // ignore\n+            }\n         }\n \n+\n     }\n \n ",
                "raw_url": "https://github.com/apache/isis/raw/8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/collectioncontents/multiple/CollectionContentsMultipleViewsPanel.java",
                "sha": "9e60554cf00490cb7cb590976173818a0bfccac1",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/isis/blob/8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/scalars/ScalarPanelAbstract.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/scalars/ScalarPanelAbstract.java?ref=8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd",
                "deletions": 8,
                "filename": "component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/scalars/ScalarPanelAbstract.java",
                "patch": "@@ -22,10 +22,7 @@\n import de.agilecoders.wicket.core.markup.html.bootstrap.common.NotificationPanel;\n \n import java.util.List;\n-\n import com.google.common.collect.Lists;\n-\n-import org.apache.wicket.AttributeModifier;\n import org.apache.wicket.Component;\n import org.apache.wicket.MarkupContainer;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n@@ -38,7 +35,6 @@\n import org.apache.wicket.markup.html.form.LabeledWebMarkupContainer;\n import org.apache.wicket.markup.html.panel.Fragment;\n import org.apache.wicket.model.Model;\n-\n import org.apache.isis.applib.annotation.Where;\n import org.apache.isis.core.metamodel.adapter.ObjectAdapter;\n import org.apache.isis.core.metamodel.facets.members.cssclass.CssClassFacet;\n@@ -47,8 +43,10 @@\n import org.apache.isis.core.runtime.system.context.IsisContext;\n import org.apache.isis.viewer.wicket.model.links.LinkAndLabel;\n import org.apache.isis.viewer.wicket.model.mementos.ObjectAdapterMemento;\n-import org.apache.isis.viewer.wicket.model.models.*;\n+import org.apache.isis.viewer.wicket.model.models.ActionPromptProvider;\n+import org.apache.isis.viewer.wicket.model.models.EntityModel;\n import org.apache.isis.viewer.wicket.model.models.EntityModel.RenderingHint;\n+import org.apache.isis.viewer.wicket.model.models.ScalarModel;\n import org.apache.isis.viewer.wicket.ui.components.additionallinks.AdditionalLinksPanel;\n import org.apache.isis.viewer.wicket.ui.components.additionallinks.EntityActionUtil;\n import org.apache.isis.viewer.wicket.ui.components.scalars.TextFieldValueModel.ScalarModelProvider;\n@@ -348,9 +346,6 @@ protected void applyLabelAtRule(Label scalarName, MarkupContainer formGroup) {\n \n         final LabelAtFacet facet = getModel().getFacet(LabelAtFacet.class);\n \n-        // TODO mgrigorov: Remove this. It is for debugging\n-        scalarName.add(new AttributeModifier(\"title\", \"labelAt=\" + (facet != null? facet.value(): \"(null)\")));\n-\n         if (facet != null) {\n             switch (facet.value()) {\n                 case LEFT:",
                "raw_url": "https://github.com/apache/isis/raw/8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/scalars/ScalarPanelAbstract.java",
                "sha": "6f6e6fe93857e5412f7ce9da85390e2885f0f3bf",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/isis/blob/8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/standalonecollection/StandaloneCollectionPanel.html",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/standalonecollection/StandaloneCollectionPanel.html?ref=8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd",
                "deletions": 4,
                "filename": "component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/standalonecollection/StandaloneCollectionPanel.html",
                "patch": "@@ -30,11 +30,11 @@\n                 <div class=\"iconAndTitle panel-heading actionPanelHeaderNew\">\n                     <span wicket:id=\"actionName\" class=\"actionName panel-title\">[action name]</span>\n \n-                    <div class=\"pull-right\">\n+                    <div class=\"btn-group\">\n+                        <div wicket:id=\"additionalLinks\"></div>\n+                    </div>\n \n-                        <div class=\"btn-group\">\n-                            <div wicket:id=\"additionalLinks\"></div>\n-                        </div>\n+                    <div class=\"pull-right\">\n                         <div class=\"btn-group\">\n                             <span wicket:id=\"selectorDropdown\"/>\n                         </div>",
                "raw_url": "https://github.com/apache/isis/raw/8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/standalonecollection/StandaloneCollectionPanel.html",
                "sha": "a86f6ccdcd715ba16e4f0eaf048daf5273e1c168",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/isis/blob/8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/standalonecollection/StandaloneCollectionPanel.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/standalonecollection/StandaloneCollectionPanel.java?ref=8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd",
                "deletions": 1,
                "filename": "component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/standalonecollection/StandaloneCollectionPanel.java",
                "patch": "@@ -65,6 +65,7 @@\n     private final ActionPromptModalWindow actionPromptModalWindow;\n     private final CollectionSelectorPanel selectorDropdownPanel;\n     private final BulkActionsHelper bulkActionsHelper;\n+    private AdditionalLinksPanel additionalLinks;\n \n     /**\n      * note that the bulk actions components are added in {@link #configureBulkActions(org.apache.isis.viewer.wicket.ui.components.collectioncontents.ajaxtable.columns.ObjectAdapterToggleboxColumn)}.\n@@ -152,6 +153,9 @@ public void onSelected(\n     @Override\n     public void configureBulkActions(final ObjectAdapterToggleboxColumn toggleboxColumn) {\n \n+        if(additionalLinks != null) {\n+            return;\n+        }\n         final BulkActionsLinkFactory linkFactory =\n                 new BulkActionsLinkFactory(getModel(), toggleboxColumn);\n \n@@ -164,7 +168,7 @@ public LinkAndLabel apply(ObjectAction objectAction) {\n             }\n         });\n \n-        AdditionalLinksPanel additionalLinks = new AdditionalLinksPanel(ID_ADDITIONAL_LINKS, links);\n+        additionalLinks = new AdditionalLinksPanel(ID_ADDITIONAL_LINKS, links);\n         addOrReplace(additionalLinks);\n \n ",
                "raw_url": "https://github.com/apache/isis/raw/8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/components/standalonecollection/StandaloneCollectionPanel.java",
                "sha": "c1b333d88e52b2fc9e2bc41dd5d032cac50268a1",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/isis/blob/8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/pages/PageAbstract.html",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/pages/PageAbstract.html?ref=8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd",
                "deletions": 1,
                "filename": "component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/pages/PageAbstract.html",
                "patch": "@@ -94,7 +94,7 @@\n                             </ul>\n                             <ul class=\"nav navbar-nav navbar-right\">\n                                 <p class=\"navbar-text powered-by\">Powered by:</p>\n-                                <li><a href=\"http://isis.apache.org\" target=\"_blank\">Apache Isis &#174;</a></li>\n+                                <li><a href=\"http://isis.apache.org\" target=\"_blank\">Apache Isis &#8482;</a></li>\n                                 <li><a wicket:id=\"aboutLink\" class=\"navbar-right\">About</a></li>\n                                 <li wicket:id=\"themePicker\"></li>\n                             </ul>",
                "raw_url": "https://github.com/apache/isis/raw/8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/pages/PageAbstract.html",
                "sha": "90c217558ff2232cc10b08ef6fb05d2f3cdfd977",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/isis/blob/8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/pages/bootstrap-overrides.css",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/pages/bootstrap-overrides.css?ref=8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd",
                "deletions": 1,
                "filename": "component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/pages/bootstrap-overrides.css",
                "patch": "@@ -89,7 +89,7 @@ div.label-left.form-group {\n div.label-left label.control-label {\n     width: 30%;\n     float: left;\n-    padding-top: 7px;\n+    padding-top: 2px;\n     padding-left: 10px;\n     text-align: start;\n }\n@@ -163,3 +163,12 @@ div.label-left .choicesPlaceholder {\n .standaloneCollectionPanel .panel-heading {\n     padding-bottom: 15px;\n }\n+\n+.standaloneCollectionPanel .additionalLinkList {\n+    margin-left: 50px;\n+}\n+\n+.referencePanel .entityLinkSelect2Panel .entityImage {\n+    width: 20px;\n+    height: 20px;\n+}",
                "raw_url": "https://github.com/apache/isis/raw/8b7267e60e4f84ce627220c4c0e88dbf25c5bcfd/component/viewer/wicket/ui/src/main/java/org/apache/isis/viewer/wicket/ui/pages/bootstrap-overrides.css",
                "sha": "51c53d3525978d6b9616b19dc843bca899e8d808",
                "status": "modified"
            }
        ],
        "message": "ISIS-537: fixes for standalone collections; minor layout improvements\n\n- NPE when switch back to standalone collection (table view) after alternate view (excel)\n- after switch view of one collection, the \"other\" collections were no longer showing the correct view (lost their state)\n- remove bottom border for tables\n- render bulk actions to left, not right.\n- change powered by to use TM rather than (R).\n- remove debug message left over",
        "parent": "https://github.com/apache/isis/commit/62d77af98dd28f12fc0ea2d075d6d6c18005af06",
        "patched_files": [
            "PageAbstract.java"
        ],
        "repo": "isis",
        "unit_tests": [
            "PageAbstractTest.java"
        ]
    },
    "isis_a129fd2": {
        "bug_id": "isis_a129fd2",
        "commit": "https://github.com/apache/isis/commit/a129fd2d5b3817d682aa128086d2cfa3a02854a3",
        "file": [
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/integtestsupport/src/main/java/org/apache/isis/core/integtestsupport/IsisComponentProviderDefault.java",
                "changes": 223,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/integtestsupport/src/main/java/org/apache/isis/core/integtestsupport/IsisComponentProviderDefault.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 220,
                "filename": "core/integtestsupport/src/main/java/org/apache/isis/core/integtestsupport/IsisComponentProviderDefault.java",
                "patch": "@@ -19,52 +19,17 @@\n \n package org.apache.isis.core.integtestsupport;\n \n-import java.util.Collection;\n import java.util.List;\n-import java.util.Set;\n-\n-import com.google.common.collect.Lists;\n-import com.google.common.collect.Sets;\n \n import org.apache.isis.applib.AppManifest;\n import org.apache.isis.applib.fixtures.InstallableFixture;\n-import org.apache.isis.applib.fixturescripts.FixtureScript;\n import org.apache.isis.core.commons.config.IsisConfiguration;\n-import org.apache.isis.core.commons.config.IsisConfigurationDefault;\n-import org.apache.isis.core.commons.resource.ResourceStreamSourceContextLoaderClassPath;\n-import org.apache.isis.core.metamodel.facetapi.MetaModelRefiner;\n-import org.apache.isis.core.metamodel.facetdecorator.FacetDecorator;\n-import org.apache.isis.core.metamodel.layoutmetadata.LayoutMetadataReader;\n-import org.apache.isis.core.metamodel.layoutmetadata.json.LayoutMetadataReaderFromJson;\n-import org.apache.isis.core.metamodel.metamodelvalidator.dflt.MetaModelValidatorDefault;\n import org.apache.isis.core.metamodel.progmodel.ProgrammingModel;\n-import org.apache.isis.core.metamodel.services.ServicesInjectorSpi;\n-import org.apache.isis.core.metamodel.spec.SpecificationLoaderSpi;\n import org.apache.isis.core.metamodel.specloader.validator.MetaModelValidator;\n-import org.apache.isis.core.runtime.authentication.AuthenticationManager;\n-import org.apache.isis.core.runtime.authentication.standard.AuthenticationManagerStandard;\n-import org.apache.isis.core.runtime.authentication.standard.Authenticator;\n-import org.apache.isis.core.runtime.authorization.AuthorizationManager;\n-import org.apache.isis.core.runtime.authorization.standard.AuthorizationManagerStandard;\n-import org.apache.isis.core.runtime.fixtures.FixturesInstaller;\n-import org.apache.isis.core.runtime.fixtures.FixturesInstallerFromConfiguration;\n-import org.apache.isis.core.runtime.persistence.internal.RuntimeContextFromSession;\n-import org.apache.isis.core.runtime.services.ServicesInstallerFromConfiguration;\n-import org.apache.isis.core.runtime.services.ServicesInstallerFromConfigurationAndAnnotation;\n import org.apache.isis.core.runtime.system.DeploymentType;\n-import org.apache.isis.core.runtime.system.IsisSystemException;\n-import org.apache.isis.core.runtime.system.persistence.PersistenceSessionFactory;\n-import org.apache.isis.core.runtime.systemusinginstallers.IsisComponentProviderAbstract;\n-import org.apache.isis.core.runtime.transaction.facetdecorator.standard.StandardTransactionFacetDecorator;\n-import org.apache.isis.core.security.authentication.AuthenticatorBypass;\n-import org.apache.isis.objectstore.jdo.datanucleus.DataNucleusPersistenceMechanismInstaller;\n-import org.apache.isis.progmodels.dflt.JavaReflectorHelper;\n-import org.apache.isis.progmodels.dflt.ProgrammingModelFacetsJava5;\n-\n-public class IsisComponentProviderDefault extends IsisComponentProviderAbstract {\n+import org.apache.isis.core.runtime.systemusinginstallers.IsisComponentProviderDefault2;\n \n-    private final ProgrammingModel programmingModel;\n-    private final MetaModelValidator metaModelValidator;\n+public class IsisComponentProviderDefault extends IsisComponentProviderDefault2 {\n \n     public IsisComponentProviderDefault(\n             final DeploymentType deploymentType,\n@@ -74,189 +39,7 @@ public IsisComponentProviderDefault(\n             final IsisConfiguration configurationOverride,\n             final ProgrammingModel programmingModelOverride,\n             final MetaModelValidator metaModelValidatorOverride) {\n-        super(deploymentType, appManifestIfAny);\n-\n-        this.configuration = elseDefault(configurationOverride);\n-\n-        final String fixtureClassNamesCsv;\n-        if(appManifest != null) {\n-\n-            putAppManifestKey(appManifest);\n-            registerPackageNames(appManifest);\n-            specifyServicesAndRegisteredEntitiesUsing(appManifest);\n-\n-            List<Class<? extends FixtureScript>> fixtureClasses = appManifest.getFixtures();\n-            fixtureClassNamesCsv = classNamesFrom(fixtureClasses);\n-\n-            overrideConfigurationUsing(appManifest);\n-\n-            this.services = createServices(configuration);\n-\n-        } else {\n-            fixtureClassNamesCsv = classNamesFrom(fixturesOverride);\n-\n-            this.services = elseDefault(servicesOverride, configuration);\n-        }\n-\n-        putConfigurationProperty(FixturesInstallerFromConfiguration.FIXTURES, fixtureClassNamesCsv);\n-        this.fixturesInstaller = createFixturesInstaller(configuration);\n-\n-        // integration tests ignore appManifest for authentication and authorization.\n-        this.authenticationManager = createAuthenticationManager(configuration);\n-        this.authorizationManager = createAuthorizationManager(configuration);\n-\n-        this.programmingModel = elseDefault(programmingModelOverride, configuration);\n-        this.metaModelValidator = elseDefault(metaModelValidatorOverride);\n-\n-    }\n-\n-\n-\n-    //region > appManifest\n-\n-    private List<Object> createServices(final IsisConfiguration configuration) {\n-        final ServicesInstallerFromConfigurationAndAnnotation servicesInstaller =\n-                new ServicesInstallerFromConfigurationAndAnnotation();\n-        servicesInstaller.setConfiguration(configuration);\n-        return servicesInstaller.getServices();\n-    }\n-\n-\n-    @Override\n-    protected void doPutConfigurationProperty(final String key, final String value) {\n-        // bit hacky :-(\n-        IsisConfigurationDefault configurationDefault = (IsisConfigurationDefault) this.configuration;\n-        configurationDefault.put(key, value);\n-    }\n-\n-    //endregion\n-\n-    /**\n-     * Default will read <tt>isis.properties</tt> (and other optional property files) from the &quot;config&quot;\n-     * package on the current classpath.\n-     */\n-    private static IsisConfigurationDefault elseDefault(final IsisConfiguration configuration) {\n-        return configuration != null\n-                ? (IsisConfigurationDefault) configuration\n-                : new IsisConfigurationDefault(ResourceStreamSourceContextLoaderClassPath.create(\"config\"));\n-    }\n-\n-    private static List<Object> elseDefault(\n-            final List<Object> servicesOverride,\n-            final IsisConfiguration configuration) {\n-        return servicesOverride != null\n-                ? servicesOverride\n-                : createDefaultServices(configuration);\n-    }\n-\n-    private static List<Object> createDefaultServices(\n-            final IsisConfiguration configuration) {\n-        final ServicesInstallerFromConfiguration servicesInstaller = new ServicesInstallerFromConfiguration();\n-        servicesInstaller.setConfiguration(configuration);\n-        return servicesInstaller.getServices();\n-    }\n-\n+        super(deploymentType, appManifestIfAny, servicesOverride, fixturesOverride, configurationOverride, programmingModelOverride, metaModelValidatorOverride);\n \n-    private static ProgrammingModel elseDefault(final ProgrammingModel programmingModel, final IsisConfiguration configuration) {\n-        return programmingModel != null\n-                ? programmingModel\n-                : createDefaultProgrammingModel(configuration);\n     }\n-\n-    // TODO: this is duplicating logic in JavaReflectorInstallerNoDecorators; need to unify.\n-    private static ProgrammingModel createDefaultProgrammingModel(final IsisConfiguration configuration) {\n-        final ProgrammingModelFacetsJava5 programmingModel = new ProgrammingModelFacetsJava5();\n-\n-        ProgrammingModel.Util.includeFacetFactories(configuration, programmingModel);\n-        ProgrammingModel.Util.excludeFacetFactories(configuration, programmingModel);\n-        return programmingModel;\n-    }\n-\n-    private static MetaModelValidator elseDefault(final MetaModelValidator metaModelValidator) {\n-        return metaModelValidator != null\n-                ? metaModelValidator\n-                : new MetaModelValidatorDefault();\n-    }\n-\n-    private static FixturesInstaller createFixturesInstaller(final IsisConfiguration configuration) {\n-        final FixturesInstallerFromConfiguration fixturesInstallerFromConfiguration = new FixturesInstallerFromConfiguration();\n-        fixturesInstallerFromConfiguration.setConfiguration(configuration);\n-        return fixturesInstallerFromConfiguration;\n-    }\n-\n-    /**\n-     * The standard authentication manager, configured with the default authenticator (allows all requests through).\n-     */\n-    private static AuthenticationManager createAuthenticationManager(final IsisConfiguration configuration) {\n-        final AuthenticationManagerStandard authenticationManager = new AuthenticationManagerStandard(configuration);\n-        Authenticator authenticator = new AuthenticatorBypass(configuration);\n-        authenticationManager.addAuthenticator(authenticator);\n-        return authenticationManager;\n-    }\n-\n-    /**\n-     * The standard authorization manager, allowing all access.\n-     */\n-    private static AuthorizationManager createAuthorizationManager(final IsisConfiguration configuration) {\n-        return new AuthorizationManagerStandard(configuration);\n-    }\n-\n-\n-    @Override\n-    public DeploymentType getDeploymentType() {\n-        return deploymentType;\n-    }\n-\n-    @Override\n-    public IsisConfigurationDefault getConfiguration() {\n-        return configuration;\n-    }\n-\n-    @Override\n-    public List<Object> provideServices() {\n-        return services;\n-    }\n-\n-    @Override\n-    public FixturesInstaller provideFixturesInstaller()  {\n-        return fixturesInstaller;\n-    }\n-\n-    @Override\n-    public SpecificationLoaderSpi provideSpecificationLoaderSpi(\n-            Collection<MetaModelRefiner> metaModelRefiners) throws IsisSystemException {\n-\n-        final Set<FacetDecorator> facetDecorators = Sets\n-                .newHashSet((FacetDecorator) new StandardTransactionFacetDecorator(getConfiguration()));\n-        final List<LayoutMetadataReader> layoutMetadataReaders =\n-                Lists.<LayoutMetadataReader>newArrayList(new LayoutMetadataReaderFromJson());\n-\n-        return JavaReflectorHelper\n-                .createObjectReflector(\n-                        programmingModel,\n-                        metaModelRefiners,\n-                        facetDecorators, layoutMetadataReaders,\n-                        metaModelValidator,\n-                        getConfiguration());\n-    }\n-\n-    @Override\n-    public AuthenticationManager provideAuthenticationManager(DeploymentType deploymentType) {\n-        return authenticationManager;\n-    }\n-\n-    @Override\n-    public AuthorizationManager provideAuthorizationManager(DeploymentType deploymentType) {\n-        return authorizationManager;\n-    }\n-\n-    @Override\n-    public PersistenceSessionFactory providePersistenceSessionFactory(\n-            DeploymentType deploymentType,\n-            final ServicesInjectorSpi servicesInjectorSpi,\n-            final RuntimeContextFromSession runtimeContext) {\n-        DataNucleusPersistenceMechanismInstaller installer = new DataNucleusPersistenceMechanismInstaller();\n-        return installer.createPersistenceSessionFactory(deploymentType, servicesInjectorSpi, getConfiguration(), runtimeContext);\n-    }\n-\n }",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/integtestsupport/src/main/java/org/apache/isis/core/integtestsupport/IsisComponentProviderDefault.java",
                "sha": "172016080875420c39be12b2cb0ec7e8b17f3daf",
                "status": "modified"
            },
            {
                "additions": 47,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/maven-plugin/src/main/java/org/apache/isis/tool/mavenplugin/IsisMojoAbstract.java",
                "changes": 74,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/maven-plugin/src/main/java/org/apache/isis/tool/mavenplugin/IsisMojoAbstract.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 27,
                "filename": "core/maven-plugin/src/main/java/org/apache/isis/tool/mavenplugin/IsisMojoAbstract.java",
                "patch": "@@ -31,14 +31,18 @@\n import org.apache.maven.plugins.annotations.Parameter;\n import org.apache.maven.project.MavenProject;\n \n+import org.apache.isis.applib.AppManifest;\n import org.apache.isis.core.commons.config.IsisConfiguration;\n import org.apache.isis.core.commons.config.IsisConfigurationBuilderDefault;\n+import org.apache.isis.core.commons.factory.InstanceUtil;\n import org.apache.isis.core.metamodel.app.IsisMetaModel;\n-import org.apache.isis.core.metamodel.runtimecontext.noruntime.RuntimeContextNoRuntime;\n-import org.apache.isis.core.metamodel.services.ServicesInjectorDefault;\n+import org.apache.isis.core.metamodel.specloader.ObjectReflectorDefault;\n import org.apache.isis.core.runtime.services.ServicesInstaller;\n import org.apache.isis.core.runtime.services.ServicesInstallerFromAnnotation;\n import org.apache.isis.core.runtime.services.ServicesInstallerFromConfigurationAndAnnotation;\n+import org.apache.isis.core.runtime.system.DeploymentType;\n+import org.apache.isis.core.runtime.system.IsisSystem;\n+import org.apache.isis.core.runtime.systemusinginstallers.IsisComponentProviderDefault2;\n import org.apache.isis.progmodels.dflt.ProgrammingModelFacetsJava5;\n import org.apache.isis.tool.mavenplugin.util.IsisMetaModels;\n import org.apache.isis.tool.mavenplugin.util.MavenProjects;\n@@ -53,6 +57,9 @@\n     @Parameter(required = true, readonly = false, property = \"isisConfigDir\")\n     private String isisConfigDir;\n \n+    @Parameter(required = false, readonly = false, property = \"appManifest\")\n+    private String appManifest;\n+\n     private final MetaModelProcessor metaModelProcessor;\n     private final ContextForMojo context;\n \n@@ -64,30 +71,49 @@ protected IsisMojoAbstract(final MetaModelProcessor metaModelProcessor) {\n     public void execute() throws MojoExecutionException, MojoFailureException {\n \n         final Plugin plugin = MavenProjects.lookupPlugin(mavenProject, CURRENT_PLUGIN_KEY);\n-        final List<Object> serviceList = plugin != null ? serviceListFor(plugin) : null;\n-        if(serviceList == null || serviceList.size() == 0) {\n-            return;\n-        }\n-        getLog().info(\"Found \" + serviceList.size() + \" services\");\n \n-        usingIsisMetaModel(serviceList, metaModelProcessor);\n-    }\n+        if(this.appManifest != null) {\n+\n+            final AppManifest manifest = InstanceUtil.createInstance(this.appManifest, AppManifest.class);\n+            final IsisComponentProviderDefault2 componentProvider = new IsisComponentProviderDefault2(\n+                    DeploymentType.UNIT_TESTING, manifest, null, null, null, null, null);\n+\n+            final IsisSystem isisSystem = new IsisSystem(componentProvider);\n+            try {\n+                isisSystem.init();\n+\n+            } catch(RuntimeException ex) {\n+                ;\n+                // ignore\n+            } finally {\n+                isisSystem.shutdown();\n+            }\n+\n+            final ObjectReflectorDefault specificationLoader =\n+                    (ObjectReflectorDefault) isisSystem.getSessionFactory().getSpecificationLoader();\n+            metaModelProcessor.process(specificationLoader, context);\n+\n \n-    private void usingIsisMetaModel(\n-            final List<Object> serviceList,\n-            final MetaModelProcessor metaModelProcessor) throws MojoExecutionException, MojoFailureException {\n+        } else {\n \n-        IsisMetaModel isisMetaModel = null;\n-        try {\n-            isisMetaModel = bootstrapIsis(serviceList);\n-            metaModelProcessor.process(isisMetaModel, context);\n-        } finally {\n-            IsisMetaModels.disposeSafely(isisMetaModel);\n+            final IsisConfiguration isisConfiguration = getIsisConfiguration();\n+            final List<Object> serviceList = plugin != null ? serviceListFor(plugin, isisConfiguration) : null;\n+            if (serviceList == null || serviceList.size() == 0) {\n+                return;\n+            }\n+            getLog().info(\"Found \" + serviceList.size() + \" services\");\n+\n+            IsisMetaModel isisMetaModel = null;\n+            try {\n+                isisMetaModel = bootstrapIsis(serviceList);\n+                metaModelProcessor.process((ObjectReflectorDefault) isisMetaModel.getSpecificationLoader(), context);\n+            } finally {\n+                IsisMetaModels.disposeSafely(isisMetaModel);\n+            }\n         }\n     }\n \n-    private List<Object> serviceListFor(Plugin plugin) throws MojoFailureException {\n-        IsisConfiguration isisConfiguration = getIsisConfiguration();\n+    private List<Object> serviceListFor(Plugin plugin, final IsisConfiguration isisConfiguration) throws MojoFailureException {\n \n         final ServicesInstaller servicesInstaller;\n         if(isisConfiguration == null) {\n@@ -126,13 +152,7 @@ private File getIsisConfigDir() {\n     }\n \n     private static IsisMetaModel bootstrapIsis(List<Object> serviceList) {\n-        final RuntimeContextNoRuntime runtimeContext =\n-                new RuntimeContextNoRuntime(\n-                new ServicesInjectorDefault(serviceList));\n-        IsisMetaModel isisMetaModel = new IsisMetaModel(\n-                runtimeContext,\n-                                            new ProgrammingModelFacetsJava5(),\n-                                            serviceList);\n+        IsisMetaModel isisMetaModel = new IsisMetaModel(new ProgrammingModelFacetsJava5(), serviceList);\n         isisMetaModel.init();\n         return isisMetaModel;\n     }",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/maven-plugin/src/main/java/org/apache/isis/tool/mavenplugin/IsisMojoAbstract.java",
                "sha": "10344a89a42c29eb61bc756631c37b6c93b25ba8",
                "status": "modified"
            },
            {
                "additions": 13,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/maven-plugin/src/main/java/org/apache/isis/tool/mavenplugin/IsisMojoValidate.java",
                "changes": 19,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/maven-plugin/src/main/java/org/apache/isis/tool/mavenplugin/IsisMojoValidate.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 6,
                "filename": "core/maven-plugin/src/main/java/org/apache/isis/tool/mavenplugin/IsisMojoValidate.java",
                "patch": "@@ -19,13 +19,14 @@\n package org.apache.isis.tool.mavenplugin;\n \n import java.util.Collection;\n-import org.apache.maven.plugin.MojoExecutionException;\n+\n import org.apache.maven.plugin.MojoFailureException;\n import org.apache.maven.plugins.annotations.LifecyclePhase;\n import org.apache.maven.plugins.annotations.Mojo;\n import org.apache.maven.plugins.annotations.ResolutionScope;\n-import org.apache.isis.core.metamodel.app.IsisMetaModel;\n+\n import org.apache.isis.core.metamodel.spec.ObjectSpecification;\n+import org.apache.isis.core.metamodel.specloader.ObjectReflectorDefault;\n import org.apache.isis.core.metamodel.specloader.validator.ValidationFailures;\n \n @Mojo(\n@@ -42,14 +43,20 @@ protected IsisMojoValidate() {\n     }\n \n     static class ValidateMetaModelProcessor implements MetaModelProcessor {\n+\n+\n         @Override\n-        public void process(final IsisMetaModel isisMetaModel, final Context context) throws MojoFailureException, MojoExecutionException {\n-            final Collection<ObjectSpecification> objectSpecifications = isisMetaModel.getSpecificationLoader().allSpecifications();\n+        public void process(\n+                final ObjectReflectorDefault specificationLoader,\n+                final Context context)\n+                throws MojoFailureException {\n+\n+            final ValidationFailures validationFailures = specificationLoader.validate();\n+\n+            final Collection<ObjectSpecification> objectSpecifications = specificationLoader.allSpecifications();\n             for (ObjectSpecification objectSpecification : objectSpecifications) {\n                 context.getLog().debug(\"loaded: \" + objectSpecification.getFullIdentifier());\n             }\n-\n-            final ValidationFailures validationFailures = isisMetaModel.getValidationFailures();\n             if (validationFailures.occurred()) {\n                 context.throwFailureException(validationFailures.getNumberOfMessages() + \" problems found.\", validationFailures.getMessages());\n             }",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/maven-plugin/src/main/java/org/apache/isis/tool/mavenplugin/IsisMojoValidate.java",
                "sha": "2286ff1148002f686d34579d622d2711d257e11c",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/maven-plugin/src/main/java/org/apache/isis/tool/mavenplugin/MetaModelProcessor.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/maven-plugin/src/main/java/org/apache/isis/tool/mavenplugin/MetaModelProcessor.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 2,
                "filename": "core/maven-plugin/src/main/java/org/apache/isis/tool/mavenplugin/MetaModelProcessor.java",
                "patch": "@@ -19,11 +19,13 @@\n package org.apache.isis.tool.mavenplugin;\n \n import java.util.Set;\n+\n import org.apache.maven.plugin.MojoExecutionException;\n import org.apache.maven.plugin.MojoFailureException;\n import org.apache.maven.plugin.logging.Log;\n import org.apache.maven.project.MavenProject;\n-import org.apache.isis.core.metamodel.app.IsisMetaModel;\n+\n+import org.apache.isis.core.metamodel.specloader.ObjectReflectorDefault;\n \n interface MetaModelProcessor {\n \n@@ -42,5 +44,6 @@\n         void throwExecutionException(final String errorMessage, final Exception e) throws MojoExecutionException;\n     }\n \n-    public void process(final IsisMetaModel isisMetaModel, final Context context) throws MojoFailureException, MojoExecutionException;\n+    void process(final ObjectReflectorDefault specificationLoader, final Context context) throws MojoFailureException;\n+\n }",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/maven-plugin/src/main/java/org/apache/isis/tool/mavenplugin/MetaModelProcessor.java",
                "sha": "bd6f457a62be105fbd3e86af6e7782c6e5012837",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/commons/authentication/AuthenticationSessionProvider.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/commons/authentication/AuthenticationSessionProvider.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 2,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/commons/authentication/AuthenticationSessionProvider.java",
                "patch": "@@ -16,9 +16,9 @@\n  */\n package org.apache.isis.core.commons.authentication;\n \n-import org.apache.isis.core.commons.components.Injectable;\n+public interface AuthenticationSessionProvider {\n \n-public interface AuthenticationSessionProvider extends Injectable {\n+    void injectInto(final Object candidate);\n \n     /**\n      * Provided by <tt>AuthenticationManager</tt> when used by framework.",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/commons/authentication/AuthenticationSessionProvider.java",
                "sha": "fa03a54a52989e38372735f3e7bfac14c1b37204",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/isis/blob/39771a14da83a397ab2d6654cda79b2f94332b42/core/metamodel/src/main/java/org/apache/isis/core/commons/components/Injectable.java",
                "changes": 31,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/commons/components/Injectable.java?ref=39771a14da83a397ab2d6654cda79b2f94332b42",
                "deletions": 31,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/commons/components/Injectable.java",
                "patch": "@@ -1,31 +0,0 @@\n-/*\n- *  Licensed to the Apache Software Foundation (ASF) under one\n- *  or more contributor license agreements.  See the NOTICE file\n- *  distributed with this work for additional information\n- *  regarding copyright ownership.  The ASF licenses this file\n- *  to you under the Apache License, Version 2.0 (the\n- *  \"License\"); you may not use this file except in compliance\n- *  with the License.  You may obtain a copy of the License at\n- *\n- *        http://www.apache.org/licenses/LICENSE-2.0\n- *\n- *  Unless required by applicable law or agreed to in writing,\n- *  software distributed under the License is distributed on an\n- *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- *  KIND, either express or implied.  See the License for the\n- *  specific language governing permissions and limitations\n- *  under the License.\n- */\n-\n-package org.apache.isis.core.commons.components;\n-\n-\n-public interface Injectable {\n-\n-    /**\n-     * Will inject itself into the candidate if the candidate implements the\n-     * corresponding <tt>*Aware</tt> type.\n-     */\n-    void injectInto(Object candidate);\n-\n-}",
                "raw_url": "https://github.com/apache/isis/raw/39771a14da83a397ab2d6654cda79b2f94332b42/core/metamodel/src/main/java/org/apache/isis/core/commons/components/Injectable.java",
                "sha": "5a91c2c63b8e3ecc4760410e4193b6ea9d7b8a3d",
                "status": "removed"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/commons/components/package-info.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/commons/components/package-info.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 3,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/commons/components/package-info.java",
                "patch": "@@ -33,9 +33,8 @@\n  * </ul>\n  * \n  * <p>\n- * Many {@link org.apache.isis.core.commons.components.Component}s may also be\n- * {@link org.apache.isis.core.commons.components.Injectable}, meaning that\n- * they know hot to inject themselves to a candidate object &quot;if appropriate&quot;.\n+ * Many {@link org.apache.isis.core.commons.components.Component}s may also be injectable,\n+ * meaning that they know hot to inject themselves to a candidate object &quot;if appropriate&quot;.\n  * The convention adopted in most cases is for an object requiring injection of\n  * component <tt>Xxx</tt> to implement an <tt>XxxAware</tt> interface that\n  * defines a <tt>setXxx(Xxx)</tt> method.",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/commons/components/package-info.java",
                "sha": "cafacb2438dcfd53f0f3e76ad7ae04ba1fda791b",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/commons/config/IsisConfiguration.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/commons/config/IsisConfiguration.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 2,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/commons/config/IsisConfiguration.java",
                "patch": "@@ -24,7 +24,7 @@\n import java.util.Iterator;\n import java.util.Map;\n \n-import org.apache.isis.core.commons.components.Injectable;\n+import org.apache.isis.core.commons.components.ApplicationScopedComponent;\n import org.apache.isis.core.commons.debug.DebuggableWithTitle;\n import org.apache.isis.core.commons.resource.ResourceStreamSource;\n \n@@ -42,7 +42,9 @@\n  * Thus the {@link IsisConfiguration} held by different components may vary, but\n  * with each being a possible superset of the previous.\n  */\n-public interface IsisConfiguration extends DebuggableWithTitle, Injectable, Iterable<String> {\n+public interface IsisConfiguration extends DebuggableWithTitle, Iterable<String>, ApplicationScopedComponent {\n+\n+    void injectInto(Object candidate);\n \n     /**\n      * Creates a new IsisConfiguration containing the properties starting with",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/commons/config/IsisConfiguration.java",
                "sha": "d2bf8abea10fa7e77e975944f71bb77b0ac45132",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/commons/config/IsisConfigurationBuilder.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/commons/config/IsisConfigurationBuilder.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 2,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/commons/config/IsisConfigurationBuilder.java",
                "patch": "@@ -19,7 +19,6 @@\n \n package org.apache.isis.core.commons.config;\n \n-import org.apache.isis.core.commons.components.Injectable;\n import org.apache.isis.core.commons.resource.ResourceStreamSource;\n import org.apache.isis.core.commons.resource.ResourceStreamSourceChainOfResponsibility;\n \n@@ -33,7 +32,9 @@\n  * @see IsisConfiguration for more details on the mutable/immutable pair\n  *      pattern.\n  */\n-public interface IsisConfigurationBuilder extends Injectable {\n+public interface IsisConfigurationBuilder {\n+\n+    void injectInto(Object candidate);\n \n     /**\n      * Returns a currently known {@link IsisConfiguration}.",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/commons/config/IsisConfigurationBuilder.java",
                "sha": "c118c87101b38d2444cfa5a98c34895a40bbb08f",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/commons/config/IsisConfigurationBuilderResourceStreams.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/commons/config/IsisConfigurationBuilderResourceStreams.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 1,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/commons/config/IsisConfigurationBuilderResourceStreams.java",
                "patch": "@@ -243,7 +243,6 @@ public void dumpResourcesToLog() {\n     // Injectable\n     // ////////////////////////////////////////////////////////////\n \n-    @Override\n     public void injectInto(final Object candidate) {\n         if (IsisConfigurationBuilderAware.class.isAssignableFrom(candidate.getClass())) {\n             final IsisConfigurationBuilderAware cast = IsisConfigurationBuilderAware.class.cast(candidate);",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/commons/config/IsisConfigurationBuilderResourceStreams.java",
                "sha": "48c282eabc76031b1b11cd992ad2f7e5586ad6da",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/adapter/mgr/AdapterManager.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/adapter/mgr/AdapterManager.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 2,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/adapter/mgr/AdapterManager.java",
                "patch": "@@ -22,12 +22,11 @@\n import java.util.concurrent.Callable;\n \n import org.apache.isis.applib.annotation.ActionSemantics;\n-import org.apache.isis.core.commons.components.Injectable;\n import org.apache.isis.core.metamodel.adapter.ObjectAdapter;\n import org.apache.isis.core.metamodel.adapter.oid.Oid;\n import org.apache.isis.core.metamodel.spec.feature.OneToManyAssociation;\n \n-public interface AdapterManager extends Injectable {\n+public interface AdapterManager {\n \n     /**\n      * Gets the {@link ObjectAdapter adapter} for the {@link Oid} if it exists",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/adapter/mgr/AdapterManager.java",
                "sha": "4a66f50d9eccec9b24d9b78e49be91dc49305670",
                "status": "modified"
            },
            {
                "additions": 46,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/app/IsisMetaModel.java",
                "changes": 186,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/app/IsisMetaModel.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 140,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/app/IsisMetaModel.java",
                "patch": "@@ -20,33 +20,31 @@\n package org.apache.isis.core.metamodel.app;\n \n import java.util.Arrays;\n-import java.util.Collections;\n import java.util.List;\n import java.util.Set;\n import java.util.TreeSet;\n+\n import com.google.common.collect.Lists;\n+\n import org.apache.isis.core.commons.components.ApplicationScopedComponent;\n-import org.apache.isis.core.commons.config.IsisConfiguration;\n import org.apache.isis.core.commons.config.IsisConfigurationDefault;\n+import org.apache.isis.core.metamodel.deployment.DeploymentCategory;\n import org.apache.isis.core.metamodel.facetdecorator.FacetDecorator;\n import org.apache.isis.core.metamodel.layoutmetadata.LayoutMetadataReader;\n import org.apache.isis.core.metamodel.layoutmetadata.json.LayoutMetadataReaderFromJson;\n import org.apache.isis.core.metamodel.progmodel.ProgrammingModel;\n import org.apache.isis.core.metamodel.runtimecontext.RuntimeContext;\n-import org.apache.isis.core.metamodel.runtimecontext.ServicesInjector;\n+import org.apache.isis.core.metamodel.runtimecontext.noruntime.RuntimeContextNoRuntime;\n import org.apache.isis.core.metamodel.services.ServicesInjectorDefault;\n-import org.apache.isis.core.metamodel.services.container.DomainObjectContainerDefault;\n+import org.apache.isis.core.metamodel.services.ServicesInjectorSpi;\n import org.apache.isis.core.metamodel.spec.ObjectSpecification;\n import org.apache.isis.core.metamodel.spec.SpecificationLoaderSpi;\n import org.apache.isis.core.metamodel.specloader.ObjectReflectorDefault;\n-import org.apache.isis.core.metamodel.specloader.validator.MetaModelValidator;\n import org.apache.isis.core.metamodel.specloader.validator.MetaModelValidatorComposite;\n import org.apache.isis.core.metamodel.specloader.validator.ValidationFailures;\n \n-import static org.apache.isis.core.commons.ensure.Ensure.ensureThatArg;\n import static org.apache.isis.core.commons.ensure.Ensure.ensureThatState;\n import static org.hamcrest.CoreMatchers.is;\n-import static org.hamcrest.CoreMatchers.notNullValue;\n \n /**\n  * Facade for the entire Isis metamodel and supporting components.\n@@ -57,51 +55,65 @@\n  */\n public class IsisMetaModel implements ApplicationScopedComponent {\n \n+\n     private static enum State {\n         NOT_INITIALIZED, INITIALIZED, SHUTDOWN;\n     }\n \n-    private final List<Object> services = Lists.newArrayList();\n-\n     private State state = State.NOT_INITIALIZED;\n \n-    private ObjectReflectorDefault reflector;\n+    private final ServicesInjectorSpi servicesInjector;\n+\n+    private ObjectReflectorDefault specificationLoader;\n     private RuntimeContext runtimeContext;\n \n-    private IsisConfiguration configuration;\n+    private IsisConfigurationDefault configuration;\n     private ProgrammingModel programmingModel;\n     private Set<FacetDecorator> facetDecorators;\n     private MetaModelValidatorComposite metaModelValidator;\n \n     private ValidationFailures validationFailures;\n \n-    public IsisMetaModel(final RuntimeContext runtimeContext, ProgrammingModel programmingModel, final List<Object> services) {\n-        this(runtimeContext, programmingModel, services.toArray());\n+    public IsisMetaModel(\n+            final ProgrammingModel programmingModel,\n+            final List<Object> services) {\n+        this(programmingModel, services.toArray());\n     }\n     \n     public IsisMetaModel(\n-            final RuntimeContext runtimeContext,\n             final ProgrammingModel programmingModel,\n             final Object... services) {\n-        this.runtimeContext = runtimeContext;\n \n-        this.services.add(new DomainObjectContainerDefault());\n-        this.services.addAll(Arrays.asList(services));\n+        this.programmingModel = programmingModel;\n+\n+        final List<Object> serviceList = Lists.newArrayList();\n+        serviceList.addAll(Arrays.asList(services));\n+        this.servicesInjector = new ServicesInjectorDefault(serviceList);\n \n         this.configuration = new IsisConfigurationDefault();\n \n         this.facetDecorators = new TreeSet<>();\n-        setProgrammingModelFacets(programmingModel);\n \n         this.metaModelValidator = new MetaModelValidatorComposite();\n-        programmingModel.refineMetaModelValidator(metaModelValidator, configuration);\n+        this.programmingModel.refineMetaModelValidator(metaModelValidator, configuration);\n+\n+        final DeploymentCategory deploymentCategory = DeploymentCategory.PRODUCTION;\n+        final List<LayoutMetadataReader> layoutMetadataReaders =\n+                Lists.<LayoutMetadataReader>newArrayList(new LayoutMetadataReaderFromJson());\n+\n+        this.specificationLoader = new ObjectReflectorDefault(\n+                deploymentCategory, configuration,\n+                this.programmingModel, facetDecorators,\n+                metaModelValidator, layoutMetadataReaders);\n+        specificationLoader.setServiceInjector(servicesInjector);\n+\n+        this.runtimeContext = new RuntimeContextNoRuntime(\n+                deploymentCategory, configuration, servicesInjector, specificationLoader);\n+\n     }\n \n-    /**\n-     * The list of classes representing services.\n-     */\n-    public List<Object> getServices() {\n-        return Collections.unmodifiableList(services);\n+    public ServicesInjectorSpi getServicesInjector() {\n+        return servicesInjector;\n     }\n \n     // ///////////////////////////////////////////////////////\n@@ -111,27 +123,17 @@ public IsisMetaModel(\n     public void init() {\n         ensureNotInitialized();\n \n-        final List<LayoutMetadataReader> layoutMetadataReaders = Lists.<LayoutMetadataReader>newArrayList(\n-                new LayoutMetadataReaderFromJson());\n+        runtimeContext.injectInto(specificationLoader);\n \n-        reflector = new ObjectReflectorDefault(configuration, programmingModel, facetDecorators, metaModelValidator, layoutMetadataReaders);\n+        specificationLoader.initialize();\n \n-        final ServicesInjectorDefault servicesInjector = new ServicesInjectorDefault(services);\n-        reflector.setServiceInjector(servicesInjector);\n-        \n-        runtimeContext.injectInto(reflector);\n-        reflector.injectInto(runtimeContext);\n-\n-        reflector.initialize();\n-\n-        validationFailures = reflector.validate();\n-        runtimeContext.init();\n-\n-        for (final Object service : services) {\n-            final ObjectSpecification serviceSpec = reflector.loadSpecification(service.getClass());\n+        for (final Object service : servicesInjector.getRegisteredServices()) {\n+            final ObjectSpecification serviceSpec = specificationLoader.loadSpecification(service.getClass());\n             serviceSpec.markAsService();\n         }\n \n+        validationFailures = specificationLoader.validate();\n+\n         state = State.INITIALIZED;\n     }\n     \n@@ -144,113 +146,15 @@ public void shutdown() {\n         state = State.SHUTDOWN;\n     }\n \n-    // ///////////////////////////////////////////////////////\n-    // SpecificationLoader\n-    // ///////////////////////////////////////////////////////\n \n     /**\n      * Available once {@link #init() initialized}.\n      */\n     public SpecificationLoaderSpi getSpecificationLoader() {\n-        return reflector;\n-    }\n-\n-\n-    // ///////////////////////////////////////////////////////\n-    // DependencyInjector\n-    // ///////////////////////////////////////////////////////\n-\n-    /**\n-     * Available once {@link #init() initialized}.\n-     */\n-    public ServicesInjector getDependencyInjector() {\n-        ensureInitialized();\n-        return runtimeContext.getServicesInjector();\n+        return specificationLoader;\n     }\n \n-    // ///////////////////////////////////////////////////////\n-    // Override defaults\n-    // ///////////////////////////////////////////////////////\n-\n-    /**\n-     * The {@link IsisConfiguration} in force, either defaulted or specified\n-     * {@link #setConfiguration(IsisConfiguration) explicitly.}\n-     */\n-    public IsisConfiguration getConfiguration() {\n-        return configuration;\n-    }\n-\n-    /**\n-     * Optionally specify the {@link IsisConfiguration}.\n-     * \n-     * <p>\n-     * Call prior to {@link #init()}.\n-     */\n-    public void setConfiguration(final IsisConfiguration configuration) {\n-        ensureNotInitialized();\n-        ensureThatArg(configuration, is(notNullValue()));\n-        this.configuration = configuration;\n-    }\n-\n-    /**\n-     * The {@link ProgrammingModel} in force, either defaulted or specified\n-     * {@link #setProgrammingModelFacets(ProgrammingModel) explicitly}.\n-     */\n-    public ProgrammingModel getProgrammingModelFacets() {\n-        return programmingModel;\n-    }\n-\n-    /**\n-     * Optionally specify the {@link ProgrammingModel}.\n-     * \n-     * <p>\n-     * Call prior to {@link #init()}.\n-     */\n-    public void setProgrammingModelFacets(final ProgrammingModel programmingModel) {\n-        ensureNotInitialized();\n-        ensureThatArg(programmingModel, is(notNullValue()));\n-        this.programmingModel = programmingModel;\n-    }\n-\n-    /**\n-     * The {@link FacetDecorator}s in force, either defaulted or specified\n-     * {@link #setFacetDecorators(Set) explicitly}.\n-     */\n-    public Set<FacetDecorator> getFacetDecorators() {\n-        return Collections.unmodifiableSet(facetDecorators);\n-    }\n-\n-    /**\n-     * Optionally specify the {@link FacetDecorator}s.\n-     * \n-     * <p>\n-     * Call prior to {@link #init()}.\n-     */\n-    public void setFacetDecorators(final Set<FacetDecorator> facetDecorators) {\n-        ensureNotInitialized();\n-        ensureThatArg(facetDecorators, is(notNullValue()));\n-        this.facetDecorators = facetDecorators;\n-    }\n-\n-    /**\n-     * The {@link MetaModelValidator} in force, either defaulted or specified\n-     * {@link #setMetaModelValidator(org.apache.isis.core.metamodel.specloader.validator.MetaModelValidatorComposite) explicitly}.\n-     */\n-    public MetaModelValidatorComposite getMetaModelValidator() {\n-        return metaModelValidator;\n-    }\n-\n-    /**\n-     * Optionally specify the {@link MetaModelValidator}.\n-     * @param metaModelValidator\n-     */\n-    public void setMetaModelValidator(final MetaModelValidatorComposite metaModelValidator) {\n-        this.metaModelValidator = metaModelValidator;\n-    }\n-\n-    // ///////////////////////////////////////////////////////\n-    // State management\n-    // ///////////////////////////////////////////////////////\n+    //region > State management\n \n     private State ensureNotInitialized() {\n         return ensureThatState(state, is(State.NOT_INITIALIZED));\n@@ -260,4 +164,6 @@ private State ensureInitialized() {\n         return ensureThatState(state, is(State.INITIALIZED));\n     }\n \n+    //endregion\n+\n }",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/app/IsisMetaModel.java",
                "sha": "476b3563c709eca19b7b00ef8f0541eea1399f64",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/deployment/DeploymentCategoryProvider.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/deployment/DeploymentCategoryProvider.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 3,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/deployment/DeploymentCategoryProvider.java",
                "patch": "@@ -19,8 +19,9 @@\n \n package org.apache.isis.core.metamodel.deployment;\n \n-import org.apache.isis.core.commons.components.Injectable;\n+public interface DeploymentCategoryProvider {\n \n-public interface DeploymentCategoryProvider extends Injectable {\n-    public DeploymentCategory getDeploymentCategory();\n+    void injectInto(final Object candidate);\n+\n+    DeploymentCategory getDeploymentCategory();\n }",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/deployment/DeploymentCategoryProvider.java",
                "sha": "8949bd0ed3593344781f199f405eb7152b767f1c",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/deployment/DeploymentCategoryProviderAbstract.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/deployment/DeploymentCategoryProviderAbstract.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 1,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/deployment/DeploymentCategoryProviderAbstract.java",
                "patch": "@@ -18,7 +18,6 @@\n \n public abstract class DeploymentCategoryProviderAbstract implements DeploymentCategoryProvider {\n \n-    @Override\n     public void injectInto(final Object candidate) {\n         if (DeploymentCategoryAware.class.isAssignableFrom(candidate.getClass())) {\n             final DeploymentCategoryAware cast = DeploymentCategoryAware.class.cast(candidate);",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/deployment/DeploymentCategoryProviderAbstract.java",
                "sha": "1ca19049a313ccba4d9714b7ac72c8f9a1db3214",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/object/ignore/javalang/RemoveInjectMethodsFacetFactory.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/object/ignore/javalang/RemoveInjectMethodsFacetFactory.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 1,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/object/ignore/javalang/RemoveInjectMethodsFacetFactory.java",
                "patch": "@@ -23,9 +23,13 @@\n import java.util.List;\n import org.apache.isis.core.metamodel.facetapi.FeatureType;\n import org.apache.isis.core.metamodel.facets.FacetFactoryAbstract;\n+import org.apache.isis.core.metamodel.spec.InjectorMethodEvaluator;\n+import org.apache.isis.core.metamodel.specloader.InjectorMethodEvaluatorDefault;\n \n public class RemoveInjectMethodsFacetFactory extends FacetFactoryAbstract  {\n \n+    private final InjectorMethodEvaluator injectorMethodEvaluator = new InjectorMethodEvaluatorDefault();\n+\n     public RemoveInjectMethodsFacetFactory() {\n         super(FeatureType.OBJECTS_ONLY);\n     }\n@@ -36,7 +40,7 @@ public void process(final ProcessClassContext processClassContext) {\n         for (Class<? extends Object> serviceClass : serviceClasses) {\n             Method[] methods = processClassContext.getCls().getMethods();\n             for (Method method : methods) {\n-                if(getSpecificationLoader().isInjectorMethodFor(method, serviceClass)) {\n+                if(injectorMethodEvaluator.isInjectorMethodFor(method, serviceClass)) {\n                     processClassContext.removeMethod(method);\n                 }\n             }",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/object/ignore/javalang/RemoveInjectMethodsFacetFactory.java",
                "sha": "8113493e6b69d7c65a8472c41bf6215e18bace04",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/ConfigurationService.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/ConfigurationService.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 5,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/ConfigurationService.java",
                "patch": "@@ -18,14 +18,11 @@\n \n import java.util.List;\n \n-import org.apache.isis.core.commons.components.Injectable;\n import org.apache.isis.core.commons.config.IsisConfiguration;\n \n-public interface ConfigurationService extends Injectable {\n+public interface ConfigurationService {\n \n-    // //////////////////////////////////////////////////////////////////\n-    // properties\n-    // //////////////////////////////////////////////////////////////////\n+    void injectInto(final Object candidate);\n \n     /**\n      * Provided by {@link RuntimeContextAbstract} itself, cloned properties from",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/ConfigurationService.java",
                "sha": "1fa57b1be210524af6ea344296690fee3d406860",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/LocalizationProvider.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/LocalizationProvider.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 2,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/LocalizationProvider.java",
                "patch": "@@ -20,9 +20,10 @@\n package org.apache.isis.core.metamodel.runtimecontext;\n \n import org.apache.isis.applib.profiles.Localization;\n-import org.apache.isis.core.commons.components.Injectable;\n \n-public interface LocalizationProvider extends Injectable {\n+public interface LocalizationProvider {\n+\n+    void injectInto(final Object candidate);\n \n     Localization getLocalization();\n ",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/LocalizationProvider.java",
                "sha": "040a90aee001890488507cf0984d118833fd89d1",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/MessageBrokerService.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/MessageBrokerService.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 2,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/MessageBrokerService.java",
                "patch": "@@ -16,9 +16,9 @@\n  */\n package org.apache.isis.core.metamodel.runtimecontext;\n \n-import org.apache.isis.core.commons.components.Injectable;\n+public interface MessageBrokerService {\n \n-public interface MessageBrokerService extends Injectable {\n+    void injectInto(final Object candidate);\n \n     /**\n      * Provided by <tt>MessageBroker</tt> when used by framework.",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/MessageBrokerService.java",
                "sha": "d33e32738c2e8391640ce236ab3c90f8dc693eac",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/PersistenceSessionService.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/PersistenceSessionService.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 2,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/PersistenceSessionService.java",
                "patch": "@@ -20,13 +20,13 @@\n \n import org.apache.isis.applib.query.Query;\n import org.apache.isis.applib.services.bookmark.Bookmark;\n-import org.apache.isis.core.commons.components.Injectable;\n import org.apache.isis.core.metamodel.adapter.ObjectAdapter;\n import org.apache.isis.core.metamodel.adapter.mgr.AdapterManager;\n import org.apache.isis.core.metamodel.spec.ObjectSpecification;\n \n-public interface PersistenceSessionService extends AdapterManager, Injectable {\n+public interface PersistenceSessionService extends AdapterManager {\n \n+    void injectInto(final Object candidate);\n \n     // ///////////////////////////////////////////\n     // Instantiate",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/PersistenceSessionService.java",
                "sha": "ec5eede8c53aa4e01b38b32faf99fe27102f450e",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/RuntimeContext.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/RuntimeContext.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 3,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/RuntimeContext.java",
                "patch": "@@ -22,7 +22,6 @@\n import org.apache.isis.core.commons.authentication.AuthenticationSession;\n import org.apache.isis.core.commons.authentication.AuthenticationSessionProvider;\n import org.apache.isis.core.commons.components.ApplicationScopedComponent;\n-import org.apache.isis.core.commons.components.Injectable;\n import org.apache.isis.core.metamodel.deployment.DeploymentCategoryProvider;\n import org.apache.isis.core.metamodel.spec.SpecificationLoader;\n import org.apache.isis.core.metamodel.transactions.TransactionStateProvider;\n@@ -31,9 +30,9 @@\n  * Decouples the metamodel from a runtime.\n  * \n  */\n-public interface RuntimeContext extends Injectable, ApplicationScopedComponent {\n+public interface RuntimeContext extends ApplicationScopedComponent {\n \n-    public void init();\n+    void injectInto(Object candidate);\n \n     // //////////////////////////////////////\n     // application-scoped",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/RuntimeContext.java",
                "sha": "3b0d6048ab5844931fa45bc9b8c4cda9b8bf1a65",
                "status": "modified"
            },
            {
                "additions": 10,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/RuntimeContextAbstract.java",
                "changes": 112,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/RuntimeContextAbstract.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 102,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/RuntimeContextAbstract.java",
                "patch": "@@ -19,42 +19,35 @@\n \n package org.apache.isis.core.metamodel.runtimecontext;\n \n-import java.lang.reflect.Method;\n-import java.util.Collection;\n-import java.util.List;\n-\n import org.apache.isis.core.commons.config.IsisConfigurationDefault;\n import org.apache.isis.core.metamodel.deployment.DeploymentCategory;\n import org.apache.isis.core.metamodel.deployment.DeploymentCategoryProvider;\n import org.apache.isis.core.metamodel.deployment.DeploymentCategoryProviderAbstract;\n-import org.apache.isis.core.metamodel.spec.ObjectSpecId;\n-import org.apache.isis.core.metamodel.spec.ObjectSpecification;\n-import org.apache.isis.core.metamodel.spec.SpecificationLoader;\n-import org.apache.isis.core.metamodel.spec.SpecificationLoaderDelegator;\n import org.apache.isis.core.metamodel.spec.SpecificationLoaderSpi;\n-import org.apache.isis.core.metamodel.spec.SpecificationLoaderSpiAware;\n-\n-public abstract class RuntimeContextAbstract implements RuntimeContext, SpecificationLoaderSpiAware {\n \n-    private final SpecificationLoaderDelegator specificationLookupDelegator = new SpecificationLoaderDelegator();\n+public abstract class RuntimeContextAbstract implements RuntimeContext {\n \n     private final DeploymentCategory deploymentCategory;\n     private final IsisConfigurationDefault configuration;\n     private final ServicesInjector servicesInjector;\n+    private final SpecificationLoaderSpi specificationLoader;\n \n     public RuntimeContextAbstract(\n             final DeploymentCategory deploymentCategory,\n             final IsisConfigurationDefault configuration,\n-            final ServicesInjector servicesInjector) {\n+            final ServicesInjector servicesInjector,\n+            final SpecificationLoaderSpi specificationLoader) {\n         this.deploymentCategory = deploymentCategory;\n         this.configuration = configuration;\n         this.servicesInjector = servicesInjector;\n+        this.specificationLoader = specificationLoader;\n     }\n \n \n     @Override\n     public DeploymentCategoryProvider getDeploymentCategoryProvider() {\n         return new DeploymentCategoryProviderAbstract() {\n+\n             @Override\n             public DeploymentCategory getDeploymentCategory() {\n                 return deploymentCategory;\n@@ -73,14 +66,13 @@ public ServicesInjector getServicesInjector() {\n         return servicesInjector;\n     }\n \n-    public void init() {\n-    }\n-\n-    public void shutdown() {\n+    @Override\n+    public SpecificationLoaderSpi getSpecificationLoader() {\n+        return specificationLoader;\n     }\n \n \n-    @Override\n+    //@Override\n     public void injectInto(final Object candidate) {\n         if (RuntimeContextAware.class.isAssignableFrom(candidate.getClass())) {\n             final RuntimeContextAware cast = RuntimeContextAware.class.cast(candidate);\n@@ -101,88 +93,4 @@ protected void injectSubcomponentsInto(final Object candidate) {\n         getSpecificationLoader().injectInto(candidate);\n     }\n \n-    @Override\n-    public SpecificationLoader getSpecificationLoader() {\n-        return specificationLookupDelegator;\n-    }\n-\n-    /**\n-     * Is injected into when the reflector is initialized.\n-     */\n-    @Override\n-    public void setSpecificationLoaderSpi(final SpecificationLoaderSpi specificationLoader) {\n-        this.specificationLookupDelegator.setDelegate(new SpecificationLoader() {\n-\n-            @Override\n-            public void injectInto(final Object candidate) {\n-                specificationLoader.injectInto(candidate);\n-            }\n-\n-            @Override\n-            public ObjectSpecification loadSpecification(final Class<?> cls) {\n-                return specificationLoader.loadSpecification(cls);\n-            }\n-\n-            @Override\n-            public Collection<ObjectSpecification> allSpecifications() {\n-                return specificationLoader.allSpecifications();\n-            }\n-\n-            @Override\n-            public ObjectSpecification lookupBySpecId(ObjectSpecId objectSpecId) {\n-                return specificationLoader.lookupBySpecId(objectSpecId);\n-            }\n-\n-            @Override\n-            public ObjectSpecification loadSpecification(String fullyQualifiedClassName) {\n-                return specificationLoader.loadSpecification(fullyQualifiedClassName);\n-            }\n-\n-            @Override\n-            public boolean loadSpecifications(List<Class<?>> typesToLoad) {\n-                return specificationLoader.loadSpecifications(typesToLoad);\n-            }\n-\n-            @Override\n-            public boolean loadSpecifications(List<Class<?>> typesToLoad, Class<?> typeToIgnore) {\n-                return specificationLoader.loadSpecifications(typesToLoad, typeToIgnore);\n-            }\n-\n-            @Override\n-            public boolean loaded(Class<?> cls) {\n-                return specificationLoader.loaded(cls);\n-            }\n-\n-            @Override\n-            public boolean loaded(String fullyQualifiedClassName) {\n-                return specificationLoader.loaded(fullyQualifiedClassName);\n-            }\n-\n-            @Override\n-            public ObjectSpecification introspectIfRequired(ObjectSpecification spec) {\n-                return specificationLoader.introspectIfRequired(spec);\n-            }\n-\n-            @Override\n-            public List<Class<?>> getServiceClasses() {\n-                return specificationLoader.getServiceClasses();\n-            }\n-\n-            @Override\n-            public boolean isServiceClass(Class<?> cls) {\n-                return specificationLoader.isServiceClass(cls);\n-            }\n-\n-            @Override\n-            public void invalidateCache(Class<?> domainClass) {\n-                specificationLoader.invalidateCache(domainClass);\n-            }\n-\n-            @Override\n-            public boolean isInjectorMethodFor(Method method, Class<? extends Object> serviceClass) {\n-                return specificationLoader.isInjectorMethodFor(method, serviceClass);\n-            }\n-        });\n-    }\n-\n }",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/RuntimeContextAbstract.java",
                "sha": "e6470902441a94e0e48780a501d067789049912a",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/ServicesInjector.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/ServicesInjector.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 2,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/ServicesInjector.java",
                "patch": "@@ -17,12 +17,14 @@\n package org.apache.isis.core.metamodel.runtimecontext;\n \n import java.util.List;\n+\n import org.apache.isis.applib.annotation.Programmatic;\n import org.apache.isis.applib.services.exceprecog.ExceptionRecognizer;\n import org.apache.isis.applib.services.publish.PublishingService;\n-import org.apache.isis.core.commons.components.Injectable;\n \n-public interface ServicesInjector extends Injectable {\n+public interface ServicesInjector {\n+\n+    void injectInto(final Object candidate);\n \n     /**\n      * All registered services, as an immutable {@link List}.",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/ServicesInjector.java",
                "sha": "5a2439d448929ca5f8233a22203f910fd9212d16",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/noruntime/RuntimeContextNoRuntime.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/noruntime/RuntimeContextNoRuntime.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 4,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/noruntime/RuntimeContextNoRuntime.java",
                "patch": "@@ -42,6 +42,7 @@\n import org.apache.isis.core.metamodel.runtimecontext.RuntimeContextAbstract;\n import org.apache.isis.core.metamodel.runtimecontext.ServicesInjector;\n import org.apache.isis.core.metamodel.spec.ObjectSpecification;\n+import org.apache.isis.core.metamodel.spec.SpecificationLoaderSpi;\n import org.apache.isis.core.metamodel.spec.feature.OneToManyAssociation;\n import org.apache.isis.core.metamodel.transactions.TransactionState;\n import org.apache.isis.core.metamodel.transactions.TransactionStateProvider;\n@@ -55,15 +56,17 @@\n     private final MessageBrokerServiceAbstract messageBrokerService;\n \n     public RuntimeContextNoRuntime(\n-            final ServicesInjector servicesInjector) {\n-        this(DeploymentCategory.PRODUCTION, new IsisConfigurationDefault(null), servicesInjector);\n+            final ServicesInjector servicesInjector,\n+            final SpecificationLoaderSpi specificationLoader) {\n+        this(DeploymentCategory.PRODUCTION, new IsisConfigurationDefault(null), servicesInjector, specificationLoader);\n     }\n \n     public RuntimeContextNoRuntime(\n             final DeploymentCategory deploymentCategory,\n             final IsisConfigurationDefault isisConfiguration,\n-            final ServicesInjector servicesInjector) {\n-        super(deploymentCategory, isisConfiguration, servicesInjector);\n+            final ServicesInjector servicesInjector,\n+            final SpecificationLoaderSpi specificationLoader) {\n+        super(deploymentCategory, isisConfiguration, servicesInjector, specificationLoader);\n         authenticationSessionProvider = new AuthenticationSessionProviderAbstract() {\n             @Override\n             public AuthenticationSession getAuthenticationSession() {",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/runtimecontext/noruntime/RuntimeContextNoRuntime.java",
                "sha": "355c41886058525dce616773b1bd5e6e30dcd212",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/services/ServicesInjectorDefault.java",
                "changes": 14,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/services/ServicesInjectorDefault.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 11,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/services/ServicesInjectorDefault.java",
                "patch": "@@ -56,7 +56,7 @@\n /**\n  * Must be a thread-safe.\n  */\n-public class ServicesInjectorDefault implements ServicesInjectorSpi, SpecificationLoaderAware {\n+public class ServicesInjectorDefault implements ServicesInjectorSpi {\n \n     private static final Logger LOG = LoggerFactory.getLogger(ServicesInjectorDefault.class);\n \n@@ -73,6 +73,8 @@\n \n     private final Map<Class<?>, Object> serviceByConcreteType = Maps.newHashMap();\n \n+    private final InjectorMethodEvaluator injectorMethodEvaluator;\n+\n     public ServicesInjectorDefault(final List<Object> services) {\n         this(services, null);\n     }\n@@ -452,14 +454,4 @@ public boolean apply(final Object input) {\n \n     //endregion\n \n-    //region > injected dependencies\n-\n-    private InjectorMethodEvaluator injectorMethodEvaluator;\n-\n-    @Override\n-    public void setSpecificationLoader(final SpecificationLoader specificationLookup) {\n-        injectorMethodEvaluator = specificationLookup;\n-    }\n-\n-    //endregion\n }",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/services/ServicesInjectorDefault.java",
                "sha": "8761a9b4eb2285a4cbca76ab929b5d5d05ac30ca",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/services/ServicesInjectorSpi.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/services/ServicesInjectorSpi.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 2,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/services/ServicesInjectorSpi.java",
                "patch": "@@ -20,7 +20,6 @@\n package org.apache.isis.core.metamodel.services;\n \n import org.apache.isis.core.commons.components.ApplicationScopedComponent;\n-import org.apache.isis.core.commons.components.Injectable;\n import org.apache.isis.core.metamodel.runtimecontext.ServicesInjector;\n \n /**\n@@ -29,7 +28,7 @@\n  * <p>\n  * Can be considered a mutable SPI to the {@link org.apache.isis.core.metamodel.runtimecontext.ServicesInjector} immutable API.\n  */\n-public interface ServicesInjectorSpi extends ApplicationScopedComponent, Injectable, ServicesInjector {\n+public interface ServicesInjectorSpi extends ApplicationScopedComponent, ServicesInjector {\n \n     public void init();\n ",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/services/ServicesInjectorSpi.java",
                "sha": "9bf8d01a8bee80a25b7d6e530b935e8320429936",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/SpecificationLoader.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/SpecificationLoader.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 2,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/SpecificationLoader.java",
                "patch": "@@ -18,11 +18,11 @@\n \n import java.util.Collection;\n import java.util.List;\n-import org.apache.isis.core.commons.components.Injectable;\n+\n import org.apache.isis.core.metamodel.facets.FacetFactory;\n import org.apache.isis.core.metamodel.facets.object.autocomplete.AutoCompleteFacet;\n \n-public interface SpecificationLoader extends Injectable, InjectorMethodEvaluator {\n+public interface SpecificationLoader {\n \n     ObjectSpecification lookupBySpecId(ObjectSpecId objectSpecId);\n ",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/SpecificationLoader.java",
                "sha": "271a389196f3b786d62e88e5ba14a3520c490143",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/SpecificationLoaderAbstract.java",
                "changes": 1,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/SpecificationLoaderAbstract.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 1,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/SpecificationLoaderAbstract.java",
                "patch": "@@ -18,7 +18,6 @@\n \n public abstract class SpecificationLoaderAbstract implements SpecificationLoader {\n \n-    @Override\n     public void injectInto(final Object candidate) {\n         if (SpecificationLoaderAware.class.isAssignableFrom(candidate.getClass())) {\n             final SpecificationLoaderAware cast = SpecificationLoaderAware.class.cast(candidate);",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/SpecificationLoaderAbstract.java",
                "sha": "5447e123dfafa6b46dc57f3cc75b2a66c6c9a9dd",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/isis/blob/39771a14da83a397ab2d6654cda79b2f94332b42/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/SpecificationLoaderDelegator.java",
                "changes": 112,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/SpecificationLoaderDelegator.java?ref=39771a14da83a397ab2d6654cda79b2f94332b42",
                "deletions": 112,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/SpecificationLoaderDelegator.java",
                "patch": "@@ -1,112 +0,0 @@\n-/**\n- *  Licensed to the Apache Software Foundation (ASF) under one or more\n- *  contributor license agreements.  See the NOTICE file distributed with\n- *  this work for additional information regarding copyright ownership.\n- *  The ASF licenses this file to You under the Apache License, Version 2.0\n- *  (the \"License\"); you may not use this file except in compliance with\n- *  the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- *  Unless required by applicable law or agreed to in writing, software\n- *  distributed under the License is distributed on an \"AS IS\" BASIS,\n- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- *  See the License for the specific language governing permissions and\n- *  limitations under the License.\n- */\n-package org.apache.isis.core.metamodel.spec;\n-\n-import java.lang.reflect.Method;\n-import java.util.Collection;\n-import java.util.List;\n-\n-/**\n- * Allows a {@link SpecificationLoader} to be provided even if the concrete\n- * implementation is only available later.\n- */\n-public class SpecificationLoaderDelegator extends SpecificationLoaderAbstract {\n-\n-    private SpecificationLoader specificationLoaderDelegate;\n-\n-    public void setDelegate(final SpecificationLoader specificationLoaderDelegate) {\n-        this.specificationLoaderDelegate = specificationLoaderDelegate;\n-    }\n-\n-    @Override\n-    public ObjectSpecification loadSpecification(final Class<?> cls) {\n-        if (specificationLoaderDelegate == null) {\n-            throw new IllegalStateException(\"No SpecificationLookup provided\");\n-        }\n-        return specificationLoaderDelegate.loadSpecification(cls);\n-    }\n-\n-    @Override\n-    public Collection<ObjectSpecification> allSpecifications() {\n-        return specificationLoaderDelegate.allSpecifications();\n-    }\n-\n-    @Override\n-    public ObjectSpecification lookupBySpecId(ObjectSpecId objectSpecId) {\n-        return specificationLoaderDelegate.lookupBySpecId(objectSpecId);\n-    }\n-\n-    @Override\n-    public boolean loadSpecifications(List<Class<?>> typesToLoad, Class<?> typeToIgnore) {\n-        return specificationLoaderDelegate.loadSpecifications(typesToLoad, typeToIgnore);\n-    }\n-\n-    @Override\n-    public ObjectSpecification loadSpecification(String fullyQualifiedClassName) {\n-        return specificationLoaderDelegate.loadSpecification(fullyQualifiedClassName);\n-    }\n-\n-    @Override\n-    public boolean loaded(Class<?> cls) {\n-        return specificationLoaderDelegate.loaded(cls);\n-    }\n-\n-    @Override\n-    public boolean loaded(String fullyQualifiedClassName) {\n-        return specificationLoaderDelegate.loaded(fullyQualifiedClassName);\n-    }\n-\n-    @Override\n-    public boolean loadSpecifications(List<Class<?>> typesToLoad) {\n-        return specificationLoaderDelegate.loadSpecifications(typesToLoad);\n-    }\n-\n-    @Override\n-    public ObjectSpecification introspectIfRequired(ObjectSpecification spec) {\n-        return specificationLoaderDelegate.introspectIfRequired(spec);\n-    }\n-\n-    @Override\n-    public List<Class<?>> getServiceClasses() {\n-        return specificationLoaderDelegate.getServiceClasses();\n-    }\n-    @Override\n-    public boolean isServiceClass(Class<?> cls) {\n-        return specificationLoaderDelegate.isServiceClass(cls);\n-    }\n-\n-    @Override\n-    public void invalidateCache(Class<?> domainClass) {\n-        specificationLoaderDelegate.invalidateCache(domainClass);\n-    }\n-\n-    @Override\n-    public boolean isInjectorMethodFor(Method method, Class<? extends Object> serviceClass) {\n-        return specificationLoaderDelegate.isInjectorMethodFor(method, serviceClass);\n-    }\n-\n-    @Override\n-    public void injectInto(Object candidate) {\n-        super.injectInto(candidate);\n-        if(specificationLoaderDelegate != null) {\n-            specificationLoaderDelegate.injectInto(candidate);\n-        }\n-    }\n-\n-\n-\n-}",
                "raw_url": "https://github.com/apache/isis/raw/39771a14da83a397ab2d6654cda79b2f94332b42/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/SpecificationLoaderDelegator.java",
                "sha": "7dec35b3966baa456dcaaee9edc072b26e6dfeee",
                "status": "removed"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/SpecificationLoaderSpi.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/SpecificationLoaderSpi.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 1,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/SpecificationLoaderSpi.java",
                "patch": "@@ -25,12 +25,13 @@\n \n public interface SpecificationLoaderSpi extends ApplicationScopedComponent, DebuggableWithTitle, SpecificationLoader {\n \n+    void injectInto(final Object candidate);\n+\n     public void init();\n     public void shutdown();\n \n     /**\n      * Specify the services to pro-actively prime the cache, and to initialize them also.\n-     * @param services\n      */\n     void setServiceInjector(ServicesInjectorSpi services);\n ",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/SpecificationLoaderSpi.java",
                "sha": "130ced23218de3a9fc510e73542ed6beed764f58",
                "status": "modified"
            },
            {
                "additions": 16,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/ObjectReflectorDefault.java",
                "changes": 57,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/ObjectReflectorDefault.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 41,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/ObjectReflectorDefault.java",
                "patch": "@@ -19,7 +19,6 @@\n \n package org.apache.isis.core.metamodel.specloader;\n \n-import java.lang.reflect.Method;\n import java.util.Collection;\n import java.util.Collections;\n import java.util.List;\n@@ -57,7 +56,6 @@\n import org.apache.isis.core.metamodel.runtimecontext.noruntime.RuntimeContextNoRuntime;\n import org.apache.isis.core.metamodel.services.ServicesInjectorSpi;\n import org.apache.isis.core.metamodel.spec.FreeStandingList;\n-import org.apache.isis.core.metamodel.spec.InjectorMethodEvaluator;\n import org.apache.isis.core.metamodel.spec.ObjectSpecId;\n import org.apache.isis.core.metamodel.spec.ObjectSpecification;\n import org.apache.isis.core.metamodel.spec.ObjectSpecificationDependencies;\n@@ -118,23 +116,12 @@\n \n     private final ClassSubstitutor classSubstitutor = new ClassSubstitutor();\n \n-    /**\n-     * Injected in the constructor.\n-     */\n+    private final DeploymentCategory deploymentCategory;\n     private final IsisConfiguration configuration;\n-    /**\n-     * Injected in the constructor.\n-     */\n     private final ProgrammingModel programmingModel;\n-\n-    /**\n-     * Defaulted in the constructor.\n-     */\n     private final FacetProcessor facetProcessor;\n \n     /**\n-     * Initialized in the constructor.\n-     * \n      * <p>\n      * {@link FacetDecorator}s must be added prior to {@link #init()\n      * initialization.}\n@@ -146,9 +133,8 @@\n      * {@link RuntimeContextNoRuntime}) otherwise.\n      * \n      * <p>\n-     * Should be injected when used by framework, but will default to a no-op\n-     * implementation if the metamodel is being used standalone (eg for a\n-     * code-generator).\n+     * Should be injected when used by framework, but will default to a no-op implementation if the metamodel is\n+     * being used standalone (eg for a code-generator).\n      */\n     private RuntimeContext runtimeContext;\n \n@@ -163,26 +149,29 @@\n      * Populated in {@link SpecificationLoaderSpi#setServiceInjector(org.apache.isis.core.metamodel.services.ServicesInjectorSpi)}.\n      */\n     private ServicesInjectorSpi servicesInjector;\n-\n+    private ValidationFailures validationFailures;\n \n     // /////////////////////////////////////////////////////////////\n     // Constructor\n     // /////////////////////////////////////////////////////////////\n \n     public ObjectReflectorDefault(\n+            final DeploymentCategory deploymentCategory,\n             final IsisConfiguration configuration,\n             final ProgrammingModel programmingModel,\n             final Set<FacetDecorator> facetDecorators,\n             final MetaModelValidator metaModelValidator,\n             final List<LayoutMetadataReader> layoutMetadataReaders) {\n \n+        ensureThatArg(deploymentCategory, is(notNullValue()));\n         ensureThatArg(configuration, is(notNullValue()));\n         ensureThatArg(programmingModel, is(notNullValue()));\n         ensureThatArg(facetDecorators, is(notNullValue()));\n         ensureThatArg(metaModelValidator, is(notNullValue()));\n         ensureThatArg(layoutMetadataReaders, is(notNullValue()));\n         ensureThatArg(layoutMetadataReaders, is(not(emptyCollectionOf(LayoutMetadataReader.class))));\n \n+        this.deploymentCategory = deploymentCategory;\n         this.configuration = configuration;\n         this.programmingModel = programmingModel;\n \n@@ -227,8 +216,10 @@ public void validateAndAssert() {\n     }\n \n     public ValidationFailures validate() {\n-        ValidationFailures validationFailures = new ValidationFailures();\n-        metaModelValidator.validate(validationFailures);\n+        if(validationFailures == null) {\n+            validationFailures = new ValidationFailures();\n+            metaModelValidator.validate(validationFailures);\n+        }\n         return validationFailures;\n     }\n \n@@ -239,10 +230,9 @@ public void initialize() {\n \n         // default subcomponents\n         if (runtimeContext == null) {\n-            runtimeContext = new RuntimeContextNoRuntime(servicesInjector);\n+            runtimeContext = new RuntimeContextNoRuntime(servicesInjector, this);\n         }\n-        injectInto(runtimeContext);\n-        injectInto(specificationTraverser);\n+\n         injectInto(metaModelValidator);\n \n         // wire subcomponents into each other\n@@ -323,13 +313,6 @@ public void invalidateCache(final Class<?> cls) {\n         }\n     }\n \n-    //region > isInjectorMethodFor\n-    private final InjectorMethodEvaluator injectorMethodEvaluator = new InjectorMethodEvaluatorDefault();\n-\n-    public boolean isInjectorMethodFor(Method method, final Class<?> serviceClass) {\n-        return injectorMethodEvaluator.isInjectorMethodFor(method, serviceClass);\n-    }\n-    //endregion\n \n     private void recache(final ObjectSpecification newSpec) {\n         getCache().recache(newSpec);\n@@ -443,17 +426,13 @@ public boolean loadSpecifications(final List<Class<?>> typesToLoad) {\n     private ObjectSpecification createSpecification(final Class<?> cls) {\n \n         final ServicesInjector servicesInjector = getRuntimeContext().getServicesInjector();\n-        final PersistenceSessionService persistenceSessionService =\n-                getRuntimeContext().getPersistenceSessionService();\n+        final PersistenceSessionService persistenceSessionService = getRuntimeContext().getPersistenceSessionService();\n \n         final ObjectSpecificationDependencies specContext =\n-                new ObjectSpecificationDependencies(\n-                        getDeploymentCategory(), servicesInjector, this, facetProcessor);\n+                new ObjectSpecificationDependencies(deploymentCategory, servicesInjector, this, facetProcessor);\n \n         final ObjectMemberDependencies objectMemberDependencies =\n-                new ObjectMemberDependencies(\n-                this, servicesInjector,\n-                        persistenceSessionService);\n+                new ObjectMemberDependencies(this, servicesInjector, persistenceSessionService);\n \n         // ... and create the specs\n         if (FreeStandingList.class.isAssignableFrom(cls)) {\n@@ -467,10 +446,6 @@ private ObjectSpecification createSpecification(final Class<?> cls) {\n         }\n     }\n \n-    private DeploymentCategory getDeploymentCategory() {\n-        return runtimeContext.getDeploymentCategoryProvider().getDeploymentCategory();\n-    }\n-\n     private Class<?> loadBuiltIn(final String className) throws ClassNotFoundException {\n         final Class<?> builtIn = ClassUtil.getBuiltIn(className);\n         if (builtIn != null) {",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/ObjectReflectorDefault.java",
                "sha": "04ff7c933735a7c9a7d875682afa6721f84d2a7d",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/ObjectReflectorInstaller.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/ObjectReflectorInstaller.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 1,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/ObjectReflectorInstaller.java",
                "patch": "@@ -21,6 +21,7 @@\n \n import java.util.Collection;\n import org.apache.isis.core.commons.components.Installer;\n+import org.apache.isis.core.metamodel.deployment.DeploymentCategory;\n import org.apache.isis.core.metamodel.facetapi.MetaModelRefiner;\n import org.apache.isis.core.metamodel.spec.SpecificationLoaderSpi;\n \n@@ -31,7 +32,9 @@\n \n     static String TYPE = \"reflector\";\n \n-    SpecificationLoaderSpi createReflector(Collection<MetaModelRefiner> metaModelRefiners);\n+    SpecificationLoaderSpi createReflector(\n+            final DeploymentCategory deploymentCategory,\n+            final Collection<MetaModelRefiner> metaModelRefiners);\n \n     void addFacetDecoratorInstaller(final FacetDecoratorInstaller decoratorInstaller);\n ",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/specloader/ObjectReflectorInstaller.java",
                "sha": "b132603768932819e25bf4ff2eea0221c8585858",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/transactions/TransactionStateProvider.java",
                "changes": 5,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/core/metamodel/transactions/TransactionStateProvider.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 2,
                "filename": "core/metamodel/src/main/java/org/apache/isis/core/metamodel/transactions/TransactionStateProvider.java",
                "patch": "@@ -19,8 +19,9 @@\n \n package org.apache.isis.core.metamodel.transactions;\n \n-import org.apache.isis.core.commons.components.Injectable;\n+public interface TransactionStateProvider {\n+\n+    void injectInto(final Object candidate);\n \n-public interface TransactionStateProvider extends Injectable {\n     public TransactionState getTransactionState();\n }",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/core/metamodel/transactions/TransactionStateProvider.java",
                "sha": "18a2ed5b989f5da6737a52b302a77ba0e4dd4fd5",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/progmodels/dflt/JavaReflectorHelper.java",
                "changes": 10,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/progmodels/dflt/JavaReflectorHelper.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 3,
                "filename": "core/metamodel/src/main/java/org/apache/isis/progmodels/dflt/JavaReflectorHelper.java",
                "patch": "@@ -25,6 +25,7 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.apache.isis.core.commons.config.IsisConfiguration;\n+import org.apache.isis.core.metamodel.deployment.DeploymentCategory;\n import org.apache.isis.core.metamodel.facetapi.MetaModelRefiner;\n import org.apache.isis.core.metamodel.facetdecorator.FacetDecorator;\n import org.apache.isis.core.metamodel.layoutmetadata.LayoutMetadataReader;\n@@ -42,12 +43,13 @@\n     private JavaReflectorHelper(){}\n     \n     public static SpecificationLoaderSpi createObjectReflector(\n+            final DeploymentCategory deploymentCategory,\n+            final IsisConfiguration configuration,\n             final ProgrammingModel programmingModel,\n             final Collection<MetaModelRefiner> metaModelRefiners,\n             final Set<FacetDecorator> facetDecorators,\n             final List<LayoutMetadataReader> layoutMetadataReaders,\n-            final MetaModelValidator mmv,\n-            final IsisConfiguration configuration) {\n+            final MetaModelValidator mmv) {\n \n         MetaModelValidatorComposite metaModelValidator = MetaModelValidatorComposite.asComposite(mmv);\n         for (MetaModelRefiner metaModelRefiner : metaModelRefiners) {\n@@ -60,7 +62,9 @@ public static SpecificationLoaderSpi createObjectReflector(\n             programmingModel.refineMetaModelValidator(metaModelValidator, configuration);\n         }\n \n-        return new ObjectReflectorDefault(configuration, programmingModel, facetDecorators, metaModelValidator, layoutMetadataReaders);\n+        return new ObjectReflectorDefault(\n+                deploymentCategory, configuration,\n+                programmingModel, facetDecorators, metaModelValidator, layoutMetadataReaders);\n     }\n \n }",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/progmodels/dflt/JavaReflectorHelper.java",
                "sha": "61dae2052c530478d6dc7cacf560f2b0844fea38",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/progmodels/dflt/JavaReflectorInstallerNoDecorators.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/main/java/org/apache/isis/progmodels/dflt/JavaReflectorInstallerNoDecorators.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 2,
                "filename": "core/metamodel/src/main/java/org/apache/isis/progmodels/dflt/JavaReflectorInstallerNoDecorators.java",
                "patch": "@@ -32,6 +32,7 @@\n import org.apache.isis.core.commons.config.InstallerAbstract;\n import org.apache.isis.core.commons.config.IsisConfiguration;\n import org.apache.isis.core.commons.factory.InstanceUtil;\n+import org.apache.isis.core.metamodel.deployment.DeploymentCategory;\n import org.apache.isis.core.metamodel.facetapi.MetaModelRefiner;\n import org.apache.isis.core.metamodel.facetdecorator.FacetDecorator;\n import org.apache.isis.core.metamodel.facets.FacetFactory;\n@@ -73,14 +74,16 @@ public JavaReflectorInstallerNoDecorators(final String name) {\n     // /////////////////////////////////////////////////////\n \n     @Override\n-    public SpecificationLoaderSpi createReflector(final Collection<MetaModelRefiner> metaModelRefiners) {\n+    public SpecificationLoaderSpi createReflector(\n+            final DeploymentCategory deploymentCategory,\n+            final Collection<MetaModelRefiner> metaModelRefiners) {\n \n         final ProgrammingModel programmingModel = createProgrammingModel(getConfiguration());\n         final Set<FacetDecorator> facetDecorators = createFacetDecorators(getConfiguration());\n         final MetaModelValidator mmv = createMetaModelValidator(getConfiguration());\n         final List<LayoutMetadataReader> layoutMetadataReaders = createLayoutMetadataReaders(getConfiguration());\n \n-        return JavaReflectorHelper.createObjectReflector(programmingModel, metaModelRefiners, facetDecorators, layoutMetadataReaders, mmv, getConfiguration());\n+        return JavaReflectorHelper.createObjectReflector(deploymentCategory, getConfiguration(), programmingModel, metaModelRefiners, facetDecorators, layoutMetadataReaders, mmv);\n     }\n \n ",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/main/java/org/apache/isis/progmodels/dflt/JavaReflectorInstallerNoDecorators.java",
                "sha": "f287ec045c059fa87e9e6e72724bc121bbdf9ecc",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/test/java/org/apache/isis/core/metamodel/app/IsisMetaModelBaseTest_constructDefaults.java",
                "changes": 26,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/test/java/org/apache/isis/core/metamodel/app/IsisMetaModelBaseTest_constructDefaults.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 24,
                "filename": "core/metamodel/src/test/java/org/apache/isis/core/metamodel/app/IsisMetaModelBaseTest_constructDefaults.java",
                "patch": "@@ -23,15 +23,12 @@\n import org.junit.Before;\n import org.junit.Rule;\n import org.junit.Test;\n+\n import org.apache.isis.core.metamodel.progmodel.ProgrammingModel;\n import org.apache.isis.core.metamodel.runtimecontext.RuntimeContext;\n import org.apache.isis.core.unittestsupport.jmocking.JUnitRuleMockery2;\n import org.apache.isis.core.unittestsupport.jmocking.JUnitRuleMockery2.Mode;\n \n-import static org.hamcrest.CoreMatchers.is;\n-import static org.hamcrest.CoreMatchers.notNullValue;\n-import static org.junit.Assert.assertThat;\n-\n public class IsisMetaModelBaseTest_constructDefaults {\n \n     @Rule\n@@ -48,28 +45,9 @@\n     @Before\n     public void setUp() {\n         context.ignoring(mockProgrammingModel);\n-        metaModel = new IsisMetaModel(mockContext, mockProgrammingModel);\n+        metaModel = new IsisMetaModel(mockProgrammingModel);\n     }\n \n-    @Test\n-    public void shouldDefaultConfiguration() {\n-        assertThat(metaModel.getConfiguration(), is(notNullValue()));\n-    }\n-\n-    @Test\n-    public void shouldDefaultProgrammingModelFacets() {\n-        assertThat(metaModel.getProgrammingModelFacets(), is(notNullValue()));\n-    }\n-\n-    @Test\n-    public void shouldDefaultFacetDecorators() {\n-        assertThat(metaModel.getFacetDecorators(), is(notNullValue()));\n-    }\n-\n-    @Test\n-    public void shouldHaveNoFacetDecorators() {\n-        assertThat(metaModel.getFacetDecorators().size(), is(0));\n-    }\n \n     @Test(expected = IllegalStateException.class)\n     public void shouldNotBeAbleToShutdown() {",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/test/java/org/apache/isis/core/metamodel/app/IsisMetaModelBaseTest_constructDefaults.java",
                "sha": "3dd2ad2bb54313c4d295b62088e7ed9be6656f4c",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/test/java/org/apache/isis/core/metamodel/app/IsisMetaModelTest_constructWithServices.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/test/java/org/apache/isis/core/metamodel/app/IsisMetaModelTest_constructWithServices.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 3,
                "filename": "core/metamodel/src/test/java/org/apache/isis/core/metamodel/app/IsisMetaModelTest_constructWithServices.java",
                "patch": "@@ -62,13 +62,13 @@ public void setUp() throws Exception {\n \n     @Test\n     public void shouldSucceedWithoutThrowingAnyExceptions() {\n-        metaModel = new IsisMetaModel(mockContext, mockProgrammingModel);\n+        metaModel = new IsisMetaModel(mockProgrammingModel);\n     }\n \n     @Test\n     public void shouldBeAbleToRegisterServices() {\n-        metaModel = new IsisMetaModel(mockContext, mockProgrammingModel, mockService1, mockService2);\n-        final List<Object> services = metaModel.getServices();\n+        metaModel = new IsisMetaModel(mockProgrammingModel, mockService1, mockService2);\n+        final List<Object> services = metaModel.getServicesInjector().getRegisteredServices();\n         assertThat(services.size(), is(3));\n         assertThat(services, IsisMatchers.containsObjectOfType(SomeRepo.class));\n         assertThat(services, IsisMatchers.containsObjectOfType(SomeOtherRepo.class));",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/test/java/org/apache/isis/core/metamodel/app/IsisMetaModelTest_constructWithServices.java",
                "sha": "85730670b4ce5cb031ac5898adbe0b702c1c7c3b",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/test/java/org/apache/isis/core/metamodel/app/IsisMetaModelTest_getDomainObjectContainer.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/test/java/org/apache/isis/core/metamodel/app/IsisMetaModelTest_getDomainObjectContainer.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 1,
                "filename": "core/metamodel/src/test/java/org/apache/isis/core/metamodel/app/IsisMetaModelTest_getDomainObjectContainer.java",
                "patch": "@@ -45,7 +45,7 @@\n \n     @Before\n     public void setUp() {\n-        metaModel = new IsisMetaModel(mockContext, mockProgrammingModel);\n+        metaModel = new IsisMetaModel(mockProgrammingModel);\n         expectingMetaModelToBeInitialized();\n         metaModel.init();\n     }",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/test/java/org/apache/isis/core/metamodel/app/IsisMetaModelTest_getDomainObjectContainer.java",
                "sha": "929fcca299fef24a5edbf6f1214bf5c3f943e523",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/isis/blob/39771a14da83a397ab2d6654cda79b2f94332b42/core/metamodel/src/test/java/org/apache/isis/core/metamodel/app/IsisMetaModelTest_init.java",
                "changes": 171,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/test/java/org/apache/isis/core/metamodel/app/IsisMetaModelTest_init.java?ref=39771a14da83a397ab2d6654cda79b2f94332b42",
                "deletions": 171,
                "filename": "core/metamodel/src/test/java/org/apache/isis/core/metamodel/app/IsisMetaModelTest_init.java",
                "patch": "@@ -1,171 +0,0 @@\n-/*\n- *  Licensed to the Apache Software Foundation (ASF) under one\n- *  or more contributor license agreements.  See the NOTICE file\n- *  distributed with this work for additional information\n- *  regarding copyright ownership.  The ASF licenses this file\n- *  to you under the Apache License, Version 2.0 (the\n- *  \"License\"); you may not use this file except in compliance\n- *  with the License.  You may obtain a copy of the License at\n- *\n- *        http://www.apache.org/licenses/LICENSE-2.0\n- *\n- *  Unless required by applicable law or agreed to in writing,\n- *  software distributed under the License is distributed on an\n- *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- *  KIND, either express or implied.  See the License for the\n- *  specific language governing permissions and limitations\n- *  under the License.\n- */\n-\n-package org.apache.isis.core.metamodel.app;\n-\n-import java.util.TreeSet;\n-\n-import com.google.common.collect.Lists;\n-\n-import org.jmock.Expectations;\n-import org.jmock.Sequence;\n-import org.jmock.auto.Mock;\n-import org.junit.Before;\n-import org.junit.Ignore;\n-import org.junit.Rule;\n-import org.junit.Test;\n-\n-import org.apache.isis.core.commons.authentication.AuthenticationSessionProvider;\n-import org.apache.isis.core.commons.config.IsisConfiguration;\n-import org.apache.isis.core.metamodel.runtimecontext.MessageBrokerService;\n-import org.apache.isis.core.metamodel.adapter.mgr.AdapterManager;\n-import org.apache.isis.core.metamodel.deployment.DeploymentCategory;\n-import org.apache.isis.core.metamodel.deployment.DeploymentCategoryProviderAbstract;\n-import org.apache.isis.core.metamodel.facetdecorator.FacetDecorator;\n-import org.apache.isis.core.metamodel.progmodel.ProgrammingModel;\n-import org.apache.isis.core.metamodel.runtimecontext.RuntimeContext;\n-import org.apache.isis.core.metamodel.runtimecontext.ServicesInjector;\n-import org.apache.isis.core.metamodel.spec.SpecificationLoader;\n-import org.apache.isis.core.unittestsupport.jmocking.IsisActions;\n-import org.apache.isis.core.unittestsupport.jmocking.JUnitRuleMockery2;\n-import org.apache.isis.core.unittestsupport.jmocking.JUnitRuleMockery2.Mode;\n-\n-public class IsisMetaModelTest_init {\n-\n-    @Rule\n-    public JUnitRuleMockery2 context = JUnitRuleMockery2.createFor(Mode.INTERFACES_AND_CLASSES);\n-\n-    @Mock\n-    private IsisConfiguration mockConfiguration;\n-    @Mock\n-    private ProgrammingModel mockProgrammingModelFacets;\n-    @Mock\n-    private AuthenticationSessionProvider mockAuthenticationSessionProvider;\n-    @Mock\n-    private SpecificationLoader mockSpecificationLoader;\n-    @Mock\n-    private AdapterManager mockAdapterManager;\n-    @Mock\n-    private MessageBrokerService mockMessageBrokerService;\n-    @Mock\n-    private ServicesInjector mockDependencyInjector;\n-    @Mock\n-    private FacetDecorator mockFacetDecorator;\n-    @Mock\n-    private RuntimeContext mockRuntimeContext;\n-\n-    private IsisMetaModel metaModel;\n-\n-    @Before\n-    public void setUp() {\n-        expectingMetaModelToBeInitialized();\n-        metaModel = new IsisMetaModel(mockRuntimeContext, mockProgrammingModelFacets);\n-    }\n-\n-    private void expectingMetaModelToBeInitialized() {\n-        final Sequence initSequence = context.sequence(\"init\");\n-        context.checking(new Expectations() {\n-            {\n-                allowing(mockRuntimeContext).injectInto(with(any(Object.class)));\n-                will(IsisActions.injectInto());\n-                \n-                allowing(mockRuntimeContext).getAuthenticationSessionProvider();\n-                will(returnValue(mockAuthenticationSessionProvider));\n-\n-                allowing(mockRuntimeContext).getSpecificationLoader();\n-                will(returnValue(mockSpecificationLoader));\n-\n-                allowing(mockRuntimeContext).getMessageBrokerService();\n-                will(returnValue(mockMessageBrokerService));\n-\n-                allowing(mockRuntimeContext).getServicesInjector();\n-                will(returnValue(mockDependencyInjector));\n-\n-                allowing(mockRuntimeContext).getDeploymentCategoryProvider();\n-                will(returnValue(new DeploymentCategoryProviderAbstract() {\n-                    @Override\n-                    public DeploymentCategory getDeploymentCategory() {\n-                        return DeploymentCategory.PRODUCTION;\n-                    }\n-                }));\n-\n-                oneOf(mockProgrammingModelFacets).init();\n-                inSequence(initSequence);\n-                \n-                oneOf(mockProgrammingModelFacets).getList();\n-                inSequence(initSequence);\n-                will(returnValue(Lists.newArrayList()));\n-                \n-                oneOf(mockRuntimeContext).init();\n-                inSequence(initSequence);\n-            }\n-        });\n-        context.ignoring(mockProgrammingModelFacets);\n-    }\n-\n-    @Ignore // too much effort, not used\n-    @Test\n-    public void shouldSucceedWithoutThrowingAnyExceptions() {\n-        metaModel.init();\n-    }\n-\n-    @Ignore // too much effort, not used\n-    @Test(expected = IllegalStateException.class)\n-    public void shouldNotBeAbleToChangeConfiguration() {\n-        metaModel.init();\n-        metaModel.setConfiguration(mockConfiguration);\n-    }\n-\n-    @Ignore // too much effort, not used\n-    @Test(expected = IllegalStateException.class)\n-    public void shouldNotBeAbleToChangeProgrammingModelFacets() {\n-        metaModel.init();\n-        metaModel.setProgrammingModelFacets(mockProgrammingModelFacets);\n-    }\n-\n-    @Ignore // too much effort, not used\n-    @Test(expected = IllegalStateException.class)\n-    public void shouldNotBeAbleToChangeFacetDecorators() {\n-        metaModel.init();\n-        metaModel.setFacetDecorators(new TreeSet<FacetDecorator>());\n-    }\n-\n-    @Ignore // too much effort, not used\n-    @Test(expected = UnsupportedOperationException.class)\n-    public void shouldNotBeAbleToAddToFacetDecorators() {\n-        metaModel.init();\n-        metaModel.getFacetDecorators().add(mockFacetDecorator);\n-    }\n-\n-    @Ignore // too much effort, not used\n-    @Test(expected = IllegalStateException.class)\n-    public void shouldNotBeAbleToInitializeAgain() {\n-        metaModel.init();\n-        //\n-        metaModel.init();\n-    }\n-\n-    @Ignore // too much effort, not used\n-    @Test\n-    public void shouldPrime() {\n-        metaModel.init();\n-\n-    }\n-\n-}",
                "raw_url": "https://github.com/apache/isis/raw/39771a14da83a397ab2d6654cda79b2f94332b42/core/metamodel/src/test/java/org/apache/isis/core/metamodel/app/IsisMetaModelTest_init.java",
                "sha": "ff17185b8bedf1de038c18479fc732bd9c097f6e",
                "status": "removed"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/test/java/org/apache/isis/core/metamodel/facets/ProgrammableReflector.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/test/java/org/apache/isis/core/metamodel/facets/ProgrammableReflector.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 8,
                "filename": "core/metamodel/src/test/java/org/apache/isis/core/metamodel/facets/ProgrammableReflector.java",
                "patch": "@@ -80,14 +80,6 @@ public boolean loaded(final String fullyQualifiedClassName) {\n     public void injectInto(final Object candidate) {\n     }\n \n-    //region > isInjectorMethodFor\n-\n-    private final Map<Method, Map<Class<?>, Boolean>> isInjectorMethod = Maps.newConcurrentMap();\n-\n-    public boolean isInjectorMethodFor(Method method, final Class<?> serviceClass) {\n-        return false;\n-    }\n-    //endregion\n \n     @Override\n     public void setRuntimeContext(final RuntimeContext runtimeContext) {",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/test/java/org/apache/isis/core/metamodel/facets/ProgrammableReflector.java",
                "sha": "9f15094bc508d849845a9e2232ac8e260c063a93",
                "status": "modified"
            },
            {
                "additions": 18,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/test/java/org/apache/isis/core/metamodel/specloader/ObjectReflectorDefaultTestAbstract.java",
                "changes": 35,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/test/java/org/apache/isis/core/metamodel/specloader/ObjectReflectorDefaultTestAbstract.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 17,
                "filename": "core/metamodel/src/test/java/org/apache/isis/core/metamodel/specloader/ObjectReflectorDefaultTestAbstract.java",
                "patch": "@@ -30,6 +30,7 @@\n import org.junit.Test;\n import org.junit.rules.ExpectedException;\n import org.apache.isis.core.commons.config.IsisConfiguration;\n+import org.apache.isis.core.metamodel.deployment.DeploymentCategory;\n import org.apache.isis.core.metamodel.facetapi.Facet;\n import org.apache.isis.core.metamodel.facetdecorator.FacetDecorator;\n import org.apache.isis.core.metamodel.facets.actcoll.typeof.TypeOfFacet;\n@@ -79,14 +80,16 @@ public void setUp() throws Exception {\n             }\n         });\n \n-        runtimeContext = new RuntimeContextNoRuntime(new ServicesInjectorDefault(Collections.emptyList()));\n-        final ObjectReflectorDefault reflector = \n-                new ObjectReflectorDefault(\n+        final ObjectReflectorDefault reflector =\n+                new ObjectReflectorDefault(DeploymentCategory.PRODUCTION,\n                         mockConfiguration,\n                         new ProgrammingModelFacetsJava5(),\n                         new HashSet<FacetDecorator>(),\n                         new MetaModelValidatorDefault(),\n                         Lists.<LayoutMetadataReader>newArrayList(new LayoutMetadataReaderFromJson()));\n+        runtimeContext =\n+                new RuntimeContextNoRuntime(\n+                        new ServicesInjectorDefault(Collections.emptyList()), reflector);\n         reflector.setRuntimeContext(runtimeContext);\n         reflector.setServiceInjector(new ServicesInjectorDefault(Collections.<Object>singletonList(new DomainObjectContainerDefault())));\n         reflector.init();\n@@ -101,27 +104,25 @@ public void testLayoutMetadataReaderEmptyList() {\n         expectedException.expect(IllegalArgumentException.class);\n         expectedException.expectMessage(\"illegal argument, expected: is not an empty collection\");\n \n-        new ObjectReflectorDefault(\n-            mockConfiguration,\n-            new ProgrammingModelFacetsJava5(),\n-            new HashSet<FacetDecorator>(),\n-            new MetaModelValidatorDefault(),\n-            Lists.<LayoutMetadataReader>newArrayList()\n-        );\n+        new ObjectReflectorDefault(DeploymentCategory.PRODUCTION ,\n+                mockConfiguration,\n+                new ProgrammingModelFacetsJava5(),\n+                new HashSet<FacetDecorator>(),\n+                new MetaModelValidatorDefault(),\n+                Lists.<LayoutMetadataReader>newArrayList());\n     }\n \n     @Test\n     public void testLayoutMetadataReaderNull() {\n         expectedException.expect(IllegalArgumentException.class);\n         expectedException.expectMessage(\"illegal argument, expected: is not null\");\n \n-        new ObjectReflectorDefault(\n-            mockConfiguration,\n-            new ProgrammingModelFacetsJava5(),\n-            new HashSet<FacetDecorator>(),\n-            new MetaModelValidatorDefault(),\n-            null\n-        );\n+        new ObjectReflectorDefault(DeploymentCategory.PRODUCTION,\n+                mockConfiguration,\n+                new ProgrammingModelFacetsJava5(),\n+                new HashSet<FacetDecorator>(),\n+                new MetaModelValidatorDefault(),\n+                null);\n     }\n \n     @Test",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/test/java/org/apache/isis/core/metamodel/specloader/ObjectReflectorDefaultTestAbstract.java",
                "sha": "914dcd25404c0ed6805f1570f91849986b89e663",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/test/java/org/apache/isis/core/metamodel/testspec/ObjectSpecificationStub.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/metamodel/src/test/java/org/apache/isis/core/metamodel/testspec/ObjectSpecificationStub.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 1,
                "filename": "core/metamodel/src/test/java/org/apache/isis/core/metamodel/testspec/ObjectSpecificationStub.java",
                "patch": "@@ -72,7 +72,8 @@\n \n     public ObjectSpecificationStub(final Class<?> type) {\n         this(type.getName());\n-        runtimeContext = new RuntimeContextNoRuntime(new ServicesInjectorDefault(Collections.emptyList()));\n+        runtimeContext = new RuntimeContextNoRuntime(\n+                new ServicesInjectorDefault(Collections.emptyList()), null);\n     }\n \n     @Override",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/metamodel/src/test/java/org/apache/isis/core/metamodel/testspec/ObjectSpecificationStub.java",
                "sha": "a56a549a2f4083af9971100bcba511d5dee62423",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/installerregistry/InstallerLookup.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/installerregistry/InstallerLookup.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 7,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/installerregistry/InstallerLookup.java",
                "patch": "@@ -33,7 +33,6 @@\n import org.slf4j.LoggerFactory;\n \n import org.apache.isis.core.commons.components.ApplicationScopedComponent;\n-import org.apache.isis.core.commons.components.Injectable;\n import org.apache.isis.core.commons.components.Installer;\n import org.apache.isis.core.commons.config.IsisConfiguration;\n import org.apache.isis.core.commons.config.IsisConfigurationBuilder;\n@@ -91,7 +90,7 @@\n  * even if it has not been registered in <tt>installer-registry.properties</tt>\n  * : just specify the {@link Installer}'s fully qualified class name.\n  */\n-public class InstallerLookup implements InstallerRepository, ApplicationScopedComponent, IsisConfigurationBuilderAware, Injectable, SystemDependencyInjector {\n+public class InstallerLookup implements InstallerRepository, ApplicationScopedComponent, IsisConfigurationBuilderAware, SystemDependencyInjector {\n \n     private static final Logger LOG = LoggerFactory.getLogger(InstallerLookup.class);\n \n@@ -323,7 +322,6 @@ public void putConfigurationProperty(final String key, final String value) {\n         return candidate;\n     }\n \n-    @Override\n     public void injectInto(final Object candidate) {\n         if (SystemDependencyInjectorAware.class.isAssignableFrom(candidate.getClass())) {\n             final SystemDependencyInjectorAware cast = SystemDependencyInjectorAware.class.cast(candidate);\n@@ -347,10 +345,6 @@ public void injectInto(final Object candidate) {\n      */\n     private IsisConfigurationBuilder isisConfigurationBuilder;\n \n-    public IsisConfigurationBuilder getConfigurationBuilder() {\n-        return isisConfigurationBuilder;\n-    }\n-\n     @Override\n     @Inject\n     public void setConfigurationBuilder(final IsisConfigurationBuilder configurationLoader) {",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/installerregistry/InstallerLookup.java",
                "sha": "2124c1fe1a8fbe6943ba42110db637cd00f435ea",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/installerregistry/installerapi/PersistenceMechanismInstaller.java",
                "changes": 4,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/installerregistry/installerapi/PersistenceMechanismInstaller.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 3,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/installerregistry/installerapi/PersistenceMechanismInstaller.java",
                "patch": "@@ -23,7 +23,6 @@\n import org.apache.isis.core.commons.config.IsisConfigurationBuilderAware;\n import org.apache.isis.core.commons.config.IsisConfigurationDefault;\n import org.apache.isis.core.metamodel.services.ServicesInjectorSpi;\n-import org.apache.isis.core.runtime.persistence.internal.RuntimeContextFromSession;\n import org.apache.isis.core.runtime.system.DeploymentType;\n import org.apache.isis.core.runtime.system.persistence.PersistenceSession;\n import org.apache.isis.core.runtime.system.persistence.PersistenceSessionFactory;\n@@ -37,8 +36,7 @@\n \n     PersistenceSessionFactory createPersistenceSessionFactory(\n             final DeploymentType deploymentType,\n-            final ServicesInjectorSpi servicesInjector,\n             final IsisConfigurationDefault configuration,\n-            final RuntimeContextFromSession runtimeContext);\n+            final ServicesInjectorSpi servicesInjector);\n \n }",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/installerregistry/installerapi/PersistenceMechanismInstaller.java",
                "sha": "0cec1f8c0d6b346ea276d89a3853032ca7de02c4",
                "status": "modified"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/persistence/adapter/PojoAdapter.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/persistence/adapter/PojoAdapter.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 1,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/persistence/adapter/PojoAdapter.java",
                "patch": "@@ -428,7 +428,7 @@ public ObjectSpecification getElementSpecification() {\n      *\n      * <p>\n      *     Specifically, if an action which has been annotated (is copied by {@link org.apache.isis.core.metamodel.facets.actions.action.invocation.ActionInvocationFacet action invocation facet}), and for a parented collection\n-     *     (is copied by the {@link org.apache.isis.core.runtime.persistence.adaptermanager.AdapterManagerDefault adapter manager} when {@link org.apache.isis.core.runtime.persistence.adaptermanager.AdapterManagerDefault#adapterFor(Object, ObjectAdapter, OneToManyAssociation) creating} an adapter for a collection.\n+     *     (is copied by the {@link PersistenceSession} when {@link PersistenceSession#adapterFor(Object, ObjectAdapter, OneToManyAssociation) creating} an adapter for a collection.\n      * </p>\n      */\n     @Override",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/persistence/adapter/PojoAdapter.java",
                "sha": "85dbd3e6660088582567d063ab1ed375ee248087",
                "status": "modified"
            },
            {
                "additions": 0,
                "blob_url": "https://github.com/apache/isis/blob/39771a14da83a397ab2d6654cda79b2f94332b42/core/runtime/src/main/java/org/apache/isis/core/runtime/persistence/adaptermanager/AdapterManagerDefault.java",
                "changes": 136,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/persistence/adaptermanager/AdapterManagerDefault.java?ref=39771a14da83a397ab2d6654cda79b2f94332b42",
                "deletions": 136,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/persistence/adaptermanager/AdapterManagerDefault.java",
                "patch": "@@ -1,136 +0,0 @@\n-/*\n- *  Licensed to the Apache Software Foundation (ASF) under one\n- *  or more contributor license agreements.  See the NOTICE file\n- *  distributed with this work for additional information\n- *  regarding copyright ownership.  The ASF licenses this file\n- *  to you under the Apache License, Version 2.0 (the\n- *  \"License\"); you may not use this file except in compliance\n- *  with the License.  You may obtain a copy of the License at\n- *\n- *        http://www.apache.org/licenses/LICENSE-2.0\n- *\n- *  Unless required by applicable law or agreed to in writing,\n- *  software distributed under the License is distributed on an\n- *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- *  KIND, either express or implied.  See the License for the\n- *  specific language governing permissions and limitations\n- *  under the License.\n- */\n-\n-package org.apache.isis.core.runtime.persistence.adaptermanager;\n-\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n-\n-import org.apache.isis.core.commons.components.SessionScopedComponent;\n-import org.apache.isis.core.metamodel.adapter.ObjectAdapter;\n-import org.apache.isis.core.metamodel.adapter.mgr.AdapterManager;\n-import org.apache.isis.core.metamodel.adapter.mgr.AdapterManagerAware;\n-import org.apache.isis.core.metamodel.adapter.oid.Oid;\n-import org.apache.isis.core.metamodel.spec.feature.OneToManyAssociation;\n-import org.apache.isis.core.runtime.system.persistence.PersistenceSession;\n-\n-/**\n- * Responsible for managing the {@link ObjectAdapter adapter}s and {@link Oid\n- * identities} for each and every POJO that is being used by the framework.\n- *\n- * <p>\n- * It provides a consistent set of adapters in memory, providing an\n- * {@link ObjectAdapter adapter} for the POJOs that are in use ensuring that the\n- * same object is not loaded twice into memory.\n- *\n- * <p>\n- * Each POJO is given an {@link ObjectAdapter adapter} so that the framework can\n- * work with the POJOs even though it does not understand their types. Each POJO\n- * maps to an {@link ObjectAdapter adapter} and these are reused.\n- */\n-public class AdapterManagerDefault implements AdapterManager,\n-        SessionScopedComponent {\n-\n-    private static final Logger LOG = LoggerFactory.getLogger(AdapterManagerDefault.class);\n-\n-    //region > constructor and fields\n-\n-    private final PersistenceSession persistenceSession;\n-\n-    /**\n-     * For object store implementations (eg JDO) that do not provide any mechanism\n-     * to allow transient objects to be reattached.\n-     * \n-     * @see <a href=\"http://www.datanucleus.org/servlet/forum/viewthread_thread,7238_lastpage,yes#35976\">this thread</a>\n-     */\n-    public AdapterManagerDefault(\n-            final PersistenceSession persistenceSession) {\n-        this.persistenceSession = persistenceSession;\n-\n-    }\n-    //endregion\n-\n-    //region > open, close\n-    public void open() {\n-    }\n-\n-    public void close() {\n-    }\n-    //endregion\n-\n-    //region > getAdapterFor\n-    @Override\n-    public ObjectAdapter getAdapterFor(final Object pojo) {\n-        return persistenceSession.getAdapterFor(pojo);\n-    }\n-\n-    @Override\n-    public ObjectAdapter getAdapterFor(final Oid oid) {\n-        return persistenceSession.getAdapterFor(oid);\n-    }\n-    //endregion\n-\n-    //region > adapterFor\n-\n-    @Override\n-    public ObjectAdapter adapterFor(final Object pojo) {\n-        return persistenceSession.adapterFor(pojo);\n-    }\n-\n-    @Override\n-    public ObjectAdapter adapterFor(\n-            final Object pojo, final ObjectAdapter parentAdapter, final OneToManyAssociation collection) {\n-        return persistenceSession.adapterFor(pojo, parentAdapter, collection);\n-    }\n-\n-    //endregion\n-\n-\n-    //region > mapRecreatedPojo\n-\n-    @Override\n-    public ObjectAdapter mapRecreatedPojo(final Oid oid, final Object recreatedPojo) {\n-        return persistenceSession.mapRecreatedPojo(oid, recreatedPojo);\n-    }\n-\n-    //endregion\n-\n-    //region > removeAdapter\n-    @Override\n-    public void removeAdapter(final ObjectAdapter adapter) {\n-        persistenceSession.removeAdapter(adapter);\n-    }\n-\n-    //endregion\n-\n-\n-    //region > Injectable\n-\n-    @Override\n-    public void injectInto(final Object candidate) {\n-        if (AdapterManagerAware.class.isAssignableFrom(candidate.getClass())) {\n-            final AdapterManagerAware cast = AdapterManagerAware.class.cast(candidate);\n-            cast.setAdapterManager(this);\n-        }\n-    }\n-    //endregion\n-\n-\n-\n-}",
                "raw_url": "https://github.com/apache/isis/raw/39771a14da83a397ab2d6654cda79b2f94332b42/core/runtime/src/main/java/org/apache/isis/core/runtime/persistence/adaptermanager/AdapterManagerDefault.java",
                "sha": "6e13b6ab10bf22b008f17092b400dfb483e8b501",
                "status": "removed"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/persistence/internal/RuntimeContextFromSession.java",
                "changes": 7,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/persistence/internal/RuntimeContextFromSession.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 3,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/persistence/internal/RuntimeContextFromSession.java",
                "patch": "@@ -31,7 +31,6 @@\n import org.apache.isis.core.commons.authentication.MessageBroker;\n import org.apache.isis.core.commons.config.IsisConfigurationDefault;\n import org.apache.isis.core.metamodel.adapter.ObjectAdapter;\n-import org.apache.isis.core.metamodel.adapter.mgr.AdapterManager;\n import org.apache.isis.core.metamodel.adapter.mgr.AdapterManagerAware;\n import org.apache.isis.core.metamodel.adapter.oid.Oid;\n import org.apache.isis.core.metamodel.deployment.DeploymentCategory;\n@@ -44,6 +43,7 @@\n import org.apache.isis.core.metamodel.runtimecontext.RuntimeContextAbstract;\n import org.apache.isis.core.metamodel.runtimecontext.ServicesInjector;\n import org.apache.isis.core.metamodel.spec.ObjectSpecification;\n+import org.apache.isis.core.metamodel.spec.SpecificationLoaderSpi;\n import org.apache.isis.core.metamodel.spec.feature.OneToManyAssociation;\n import org.apache.isis.core.metamodel.transactions.TransactionState;\n import org.apache.isis.core.metamodel.transactions.TransactionStateProvider;\n@@ -73,8 +73,9 @@\n     public RuntimeContextFromSession(\n             final DeploymentCategory deploymentCategory,\n             final IsisConfigurationDefault configuration,\n-            final ServicesInjector servicesInjector) {\n-        super(deploymentCategory, configuration, servicesInjector);\n+            final ServicesInjector servicesInjector,\n+            final SpecificationLoaderSpi specificationLoader) {\n+        super(deploymentCategory, configuration, servicesInjector, specificationLoader);\n \n         this.authenticationSessionProvider = new AuthenticationSessionProviderAbstract() {\n ",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/persistence/internal/RuntimeContextFromSession.java",
                "sha": "f2cb9bc1a98145cbeabf206916cde5f60ebb89a3",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/runner/IsisInjectModule.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/runner/IsisInjectModule.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 3,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/runner/IsisInjectModule.java",
                "patch": "@@ -48,20 +48,20 @@ private static InstallerLookup defaultInstallerLookup() {\n         return new InstallerLookup();\n     }\n \n-    private static IsisConfigurationBuilderDefault defaultConfigurationBuider() {\n+    private static IsisConfigurationBuilderDefault defaultConfigurationBuilder() {\n         return new IsisConfigurationBuilderDefault();\n     }\n \n     public IsisInjectModule(final DeploymentType deploymentType) {\n-        this(deploymentType, defaultConfigurationBuider(), defaultInstallerLookup());\n+        this(deploymentType, defaultConfigurationBuilder(), defaultInstallerLookup());\n     }\n \n     public IsisInjectModule(final DeploymentType deploymentType, final IsisConfigurationBuilder isisConfigurationBuilder) {\n         this(deploymentType, isisConfigurationBuilder, defaultInstallerLookup());\n     }\n \n     public IsisInjectModule(final DeploymentType deploymentType, final InstallerLookup installerLookup) {\n-        this(deploymentType, defaultConfigurationBuider(), installerLookup);\n+        this(deploymentType, defaultConfigurationBuilder(), installerLookup);\n     }\n \n     public IsisInjectModule(final DeploymentType deploymentType, final IsisConfigurationBuilder isisConfigurationBuilder, final InstallerLookup installerLookup) {",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/runner/IsisInjectModule.java",
                "sha": "bb9695bbaa3028bdf64be24ec912fa6576d30154",
                "status": "modified"
            },
            {
                "additions": 49,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/IsisSystem.java",
                "changes": 75,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/system/IsisSystem.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 26,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/system/IsisSystem.java",
                "patch": "@@ -54,6 +54,7 @@\n import org.apache.isis.core.runtime.system.internal.IsisTimeZoneInitializer;\n import org.apache.isis.core.runtime.system.persistence.PersistenceSession;\n import org.apache.isis.core.runtime.system.persistence.PersistenceSessionFactory;\n+import org.apache.isis.core.runtime.system.persistence.PersistenceSessionFactoryMetamodelRefiner;\n import org.apache.isis.core.runtime.system.session.IsisSessionFactory;\n import org.apache.isis.core.runtime.system.transaction.IsisTransactionManager;\n import org.apache.isis.core.runtime.system.transaction.IsisTransactionManagerException;\n@@ -137,7 +138,8 @@ public void init() {\n             final SpecificationLoaderSpi specificationLoader = sessionFactory.getSpecificationLoader();\n             specificationLoader.validateAndAssert();\n \n-            serviceInitializer = initializeServices();\n+            // store simply so can do postConstruct when shutdown\n+            this.serviceInitializer = initializeServices();\n \n             installFixturesIfRequired();\n \n@@ -152,35 +154,52 @@ public void init() {\n \n     private IsisSessionFactory createSessionFactory(final DeploymentType deploymentType) throws IsisSystemException {\n \n+        // configuration\n         final IsisConfigurationDefault configuration = isisComponentProvider.getConfiguration();\n-        final List<Object> services = isisComponentProvider.provideServices();\n-\n-        ServicesInjectorSpi servicesInjectorSpi = new ServicesInjectorDefault(services);\n-        servicesInjectorSpi.addFallbackIfRequired(FixtureScripts.class, new FixtureScriptsDefault());\n-        servicesInjectorSpi.validateServices();\n-\n-        final RuntimeContextFromSession runtimeContext = new RuntimeContextFromSession(deploymentType.getDeploymentCategory(), configuration, servicesInjectorSpi);\n \n-        final PersistenceSessionFactory persistenceSessionFactory =\n-                isisComponentProvider.providePersistenceSessionFactory(deploymentType, servicesInjectorSpi, runtimeContext);\n+        // services\n+        final List<Object> services = isisComponentProvider.provideServices();\n+        ServicesInjectorDefault servicesInjector = new ServicesInjectorDefault(services);\n+        servicesInjector.addFallbackIfRequired(FixtureScripts.class, new FixtureScriptsDefault());\n+        servicesInjector.validateServices();\n \n+        // authentication, authorization\n         final AuthenticationManager authenticationManager =\n                 isisComponentProvider.provideAuthenticationManager(deploymentType);\n         final AuthorizationManager authorizationManager =\n                 isisComponentProvider.provideAuthorizationManager(deploymentType);\n \n+        // specificationLoader\n         final Collection<MetaModelRefiner> metaModelRefiners =\n-                refiners(authenticationManager, authorizationManager, persistenceSessionFactory);\n+                refiners(authenticationManager, authorizationManager,\n+                        new PersistenceSessionFactoryMetamodelRefiner());\n         final SpecificationLoaderSpi specificationLoader =\n-                isisComponentProvider.provideSpecificationLoaderSpi(metaModelRefiners);\n+                isisComponentProvider.provideSpecificationLoaderSpi(deploymentType, metaModelRefiners);\n+\n+        specificationLoader.setServiceInjector(servicesInjector);\n \n-        // bind metamodel to the (runtime) framework\n+        // persistenceSessionFactory\n+        final PersistenceSessionFactory persistenceSessionFactory =\n+                isisComponentProvider.providePersistenceSessionFactory(\n+                        deploymentType, servicesInjector, specificationLoader);\n+\n+        // runtimeContext\n+        final RuntimeContextFromSession runtimeContext =\n+                new RuntimeContextFromSession(\n+                        deploymentType.getDeploymentCategory(), configuration,\n+                        servicesInjector, specificationLoader);\n+\n+        // wire up components and components into services...\n         runtimeContext.injectInto(specificationLoader);\n \n+        for (Object service : servicesInjector.getRegisteredServices()) {\n+            runtimeContext.injectInto(service);\n+        }\n+\n+        // finally instantiate\n         return new IsisSessionFactory (\n-                deploymentType, configuration, specificationLoader,\n-                authenticationManager, authorizationManager,\n-                persistenceSessionFactory);\n+                deploymentType, configuration, servicesInjector, specificationLoader,\n+                authenticationManager, authorizationManager, persistenceSessionFactory);\n     }\n \n     private static Collection<MetaModelRefiner> refiners(Object... possibleRefiners ) {\n@@ -307,20 +326,24 @@ public void shutdown() {\n     private void shutdownServices(final ServiceInitializer serviceInitializer) {\n \n         // call @PostDestroy (in a session)\n-        IsisContext.openSession(new InitialisationSession());\n-        try {\n-            getTransactionManager().startTransaction();\n+        if(serviceInitializer != null) {\n+            IsisContext.openSession(new InitialisationSession());\n             try {\n-                serviceInitializer.preDestroy();\n+                getTransactionManager().startTransaction();\n+                try {\n \n-            } catch(RuntimeException ex) {\n-                getTransactionManager().getTransaction().setAbortCause(new IsisTransactionManagerException(ex));\n+                    serviceInitializer.preDestroy();\n+\n+                } catch (RuntimeException ex) {\n+                    getTransactionManager().getTransaction().setAbortCause(\n+                            new IsisTransactionManagerException(ex));\n+                } finally {\n+                    // will commit or abort\n+                    getTransactionManager().endTransaction();\n+                }\n             } finally {\n-                // will commit or abort\n-                getTransactionManager().endTransaction();\n+                IsisContext.closeSession();\n             }\n-        } finally {\n-            IsisContext.closeSession();\n         }\n     }\n ",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/IsisSystem.java",
                "sha": "794c0939ac2e8f221aeac5cda737c485548b5802",
                "status": "modified"
            },
            {
                "additions": 5,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/context/IsisContextThreadLocal.java",
                "changes": 18,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/system/context/IsisContextThreadLocal.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 13,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/system/context/IsisContextThreadLocal.java",
                "patch": "@@ -117,6 +117,11 @@ public void debugData(final DebugBuilder debug) {\n         }\n     }\n \n+\n+    // /////////////////////////////////////////////////////////\n+    // open, close\n+    // /////////////////////////////////////////////////////////\n+\n     @Override\n     protected IsisSession getSessionInstance(final String executionContextId) {\n         for (final IsisSession data : sessionsByThread.values()) {\n@@ -127,10 +132,6 @@ protected IsisSession getSessionInstance(final String executionContextId) {\n         return null;\n     }\n \n-    // /////////////////////////////////////////////////////////\n-    // open, close\n-    // /////////////////////////////////////////////////////////\n-\n     /**\n      * Is only intended to be called through\n      * {@link IsisContext#openSession(AuthenticationSession)}.\n@@ -154,15 +155,6 @@ public IsisSession openSessionInstance(final AuthenticationSession authenticatio\n         }\n     }\n \n-    protected IsisSession createAndOpenSession(final Thread thread, final AuthenticationSession authenticationSession) {\n-        final IsisSession session = getSessionFactoryInstance().openSession(authenticationSession);\n-        session.open();\n-        if (LOG.isInfoEnabled()) {\n-            LOG.info(\"  opening session \" + session + \" (count \" + sessionsByThread.size() + \") for \" + authenticationSession.getUserName());\n-        }\n-        return session;\n-    }\n-\n     private IsisSession saveSession(final Thread thread, final IsisSession session) {\n         synchronized (sessionsByThread) {\n             sessionsByThread.put(thread, session);",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/context/IsisContextThreadLocal.java",
                "sha": "1e25e5e24ec06deb9e57d3b5b556942632b568b6",
                "status": "modified"
            },
            {
                "additions": 43,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/PersistenceSession.java",
                "changes": 81,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/PersistenceSession.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 38,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/PersistenceSession.java",
                "patch": "@@ -28,6 +28,7 @@\n import javax.jdo.FetchGroup;\n import javax.jdo.FetchPlan;\n import javax.jdo.PersistenceManager;\n+import javax.jdo.PersistenceManagerFactory;\n \n import com.google.common.collect.Lists;\n import com.google.common.collect.Maps;\n@@ -43,7 +44,6 @@\n import org.apache.isis.applib.services.exceprecog.ExceptionRecognizer;\n import org.apache.isis.applib.services.exceprecog.ExceptionRecognizer2;\n import org.apache.isis.core.commons.authentication.AuthenticationSession;\n-import org.apache.isis.core.commons.components.ApplicationScopedComponent;\n import org.apache.isis.core.commons.components.SessionScopedComponent;\n import org.apache.isis.core.commons.config.IsisConfiguration;\n import org.apache.isis.core.commons.config.IsisConfigurationDefault;\n@@ -101,9 +101,6 @@\n import org.apache.isis.core.runtime.persistence.PojoRefreshException;\n import org.apache.isis.core.runtime.persistence.UnsupportedFindException;\n import org.apache.isis.core.runtime.persistence.adapter.PojoAdapter;\n-import org.apache.isis.core.runtime.persistence.adaptermanager.OidAdapterHashMap;\n-import org.apache.isis.core.runtime.persistence.adaptermanager.PojoAdapterHashMap;\n-import org.apache.isis.core.runtime.persistence.adaptermanager.RootAndCollectionAdapters;\n import org.apache.isis.core.runtime.persistence.container.DomainObjectContainerResolve;\n import org.apache.isis.core.runtime.persistence.objectstore.transaction.CreateObjectCommand;\n import org.apache.isis.core.runtime.persistence.objectstore.transaction.DestroyObjectCommand;\n@@ -113,6 +110,9 @@\n import org.apache.isis.core.runtime.persistence.query.PersistenceQueryFindUsingApplibQueryDefault;\n import org.apache.isis.core.runtime.runner.opts.OptionHandlerFixtureAbstract;\n import org.apache.isis.core.runtime.system.context.IsisContext;\n+import org.apache.isis.core.runtime.system.persistence.adaptermanager.OidAdapterHashMap;\n+import org.apache.isis.core.runtime.system.persistence.adaptermanager.PojoAdapterHashMap;\n+import org.apache.isis.core.runtime.system.persistence.adaptermanager.RootAndCollectionAdapters;\n import org.apache.isis.core.runtime.system.transaction.IsisTransaction;\n import org.apache.isis.core.runtime.system.transaction.IsisTransactionManager;\n import org.apache.isis.core.runtime.system.transaction.TransactionalClosure;\n@@ -132,6 +132,11 @@\n import static org.hamcrest.CoreMatchers.notNullValue;\n import static org.hamcrest.CoreMatchers.nullValue;\n \n+/**\n+ * A wrapper around the JDO {@link PersistenceManager}, which also manages concurrency\n+ * and maintains an identity map of {@link ObjectAdapter adapter}s and {@link Oid\n+ * identities} for each and every POJO that is being used by the framework.\n+ */\n public class PersistenceSession implements TransactionalResource, SessionScopedComponent, DebuggableWithTitle, AdapterManager,\n         MessageBrokerService, PersistenceSessionService, ConfigurationService {\n \n@@ -153,19 +158,23 @@\n \n     //region > constructor, fields, finalize()\n \n-    private final PersistenceSessionFactory persistenceSessionFactory;\n+    private final FixturesInstalledFlag fixturesInstalledFlag;\n \n     private final PersistenceQueryFactory persistenceQueryFactory;\n     private final IsisConfigurationDefault configuration;\n     private final SpecificationLoaderSpi specificationLoader;\n     private final AuthenticationSession authenticationSession;\n \n     private final ServicesInjectorSpi servicesInjector;\n+    /**\n+     * Used to create the {@link #persistenceManager} when {@link #open()}ed.\n+     */\n+    private final PersistenceManagerFactory jdoPersistenceManagerFactory;\n \n     // not final only for testing purposes\n     private IsisTransactionManager transactionManager;\n \n-    private final OidMarshaller oidMarshaller;\n+    private final OidMarshaller oidMarshaller = new OidMarshaller();\n \n     /**\n      * populated only when {@link #open()}ed.\n@@ -178,7 +187,6 @@\n     private final Map<Class<?>, PersistenceQueryProcessor<?>> persistenceQueryProcessorByClass = Maps.newHashMap();\n \n     private final Map<ObjectSpecId, RootOid> registeredServices = Maps.newHashMap();\n-    private final DataNucleusApplicationComponents applicationComponents;\n \n     private final boolean concurrencyCheckingGloballyEnabled;\n \n@@ -187,38 +195,32 @@\n      * persisted objects and persist changes to the object that are saved.\n      */\n     public PersistenceSession(\n-            final PersistenceSessionFactory persistenceSessionFactory,\n             final IsisConfigurationDefault configuration,\n+            final ServicesInjectorSpi servicesInjector,\n             final SpecificationLoaderSpi specificationLoader,\n-            final AuthenticationSession authenticationSession) {\n+            final AuthenticationSession authenticationSession,\n+            final PersistenceManagerFactory jdoPersistenceManagerFactory,\n+            final FixturesInstalledFlag fixturesInstalledFlag) {\n \n-        ensureThatArg(persistenceSessionFactory, is(not(nullValue())), \"persistence session factory required\");\n+        if (LOG.isDebugEnabled()) {\n+            LOG.debug(\"creating \" + this);\n+        }\n \n         // injected\n         this.configuration = configuration;\n         this.specificationLoader = specificationLoader;\n         this.authenticationSession = authenticationSession;\n-        this.persistenceSessionFactory = persistenceSessionFactory;\n+        this.fixturesInstalledFlag = fixturesInstalledFlag;\n \n-        this.servicesInjector = persistenceSessionFactory.getServicesInjector();\n-        this.applicationComponents = persistenceSessionFactory.getApplicationComponents();\n+        this.servicesInjector = servicesInjector;\n+        this.jdoPersistenceManagerFactory = jdoPersistenceManagerFactory;\n \n         // sub-components\n-\n-        this.oidMarshaller = new OidMarshaller();\n-\n-\n-        this.persistenceQueryFactory = new PersistenceQueryFactory(this, getSpecificationLoader());\n-        this.transactionManager = new IsisTransactionManager(this, servicesInjector);\n+        this.persistenceQueryFactory = new PersistenceQueryFactory(this, this.specificationLoader);\n+        this.transactionManager = new IsisTransactionManager(this, this.servicesInjector);\n \n         setState(State.NOT_INITIALIZED);\n \n-        // to implement DomainObjectServices\n-\n-        if (LOG.isDebugEnabled()) {\n-            LOG.debug(\"creating \" + this);\n-        }\n-\n         final boolean concurrencyCheckingGloballyDisabled =\n                 configuration.getBoolean(\"isis.persistor.disableConcurrencyChecking\", false);\n         this.concurrencyCheckingGloballyEnabled = !concurrencyCheckingGloballyDisabled;\n@@ -235,12 +237,15 @@ protected void finalize() throws Throwable {\n \n     //region > open\n \n+    /**\n+     * Only populated once {@link #open()}'d\n+     */\n     public PersistenceManager getPersistenceManager() {\n         return persistenceManager;\n     }\n \n     /**\n-     * Injects components, calls  {@link org.apache.isis.core.commons.components.SessionScopedComponent#open()} on subcomponents, and then creates service\n+     * Injects components, calls open on subcomponents, and then creates service\n      * adapters.\n      */\n     public void open() {\n@@ -253,10 +258,10 @@ public void open() {\n         oidAdapterMap.open();\n         pojoAdapterMap.open();\n \n-        persistenceManager = applicationComponents.getPersistenceManagerFactory().getPersistenceManager();\n+        persistenceManager = jdoPersistenceManagerFactory.getPersistenceManager();\n \n         final IsisLifecycleListener2 isisLifecycleListener = new IsisLifecycleListener2(this);\n-        persistenceManager.addInstanceLifecycleListener(isisLifecycleListener, (Class[])null);\n+        persistenceManager.addInstanceLifecycleListener(isisLifecycleListener, (Class[]) null);\n \n         persistenceQueryProcessorByClass.put(\n                 PersistenceQueryFindAllInstances.class,\n@@ -308,8 +313,7 @@ private void initServices() {\n     //region > close\n \n     /**\n-     * Calls {@link org.apache.isis.core.commons.components.SessionScopedComponent#close()}\n-     * on the subcomponents.\n+     * Closes the subcomponents.\n      *\n      * <p>\n      * Automatically {@link IsisTransactionManager#endTransaction() ends\n@@ -347,6 +351,8 @@ public void close() {\n             LOG.error(\n                 \"close: failed to close JDO persistenceManager; continuing to avoid memory leakage\");\n         }\n+        // TODO: REVIEW ... ??? this is a guess: don't set to null, because we need for -> transactionManager -> transaction -> messageBroker\n+        // persistenceManager = null;\n \n         try {\n             oidAdapterMap.close();\n@@ -657,8 +663,7 @@ private RootOid getOidForService(final ObjectSpecification serviceSpec) {\n      * up objects.\n      * \n      * <p>\n-     * This method is called only once after the\n-     * {@link ApplicationScopedComponent#init()} has been called. If this flag\n+     * This method is called only once after the init has been called. If this flag\n      * returns <code>false</code> the framework will run the fixtures to\n      * initialise the persistor.\n      * \n@@ -674,10 +679,10 @@ private RootOid getOidForService(final ObjectSpecification serviceSpec) {\n      * @see FixturesInstalledFlag\n      */\n     public boolean isFixturesInstalled() {\n-        if (persistenceSessionFactory.isFixturesInstalled() == null) {\n-            persistenceSessionFactory.setFixturesInstalled(objectStoreIsFixturesInstalled());\n+        if (fixturesInstalledFlag.isFixturesInstalled() == null) {\n+            fixturesInstalledFlag.setFixturesInstalled(objectStoreIsFixturesInstalled());\n         }\n-        return persistenceSessionFactory.isFixturesInstalled();\n+        return fixturesInstalledFlag.isFixturesInstalled();\n     }\n \n \n@@ -900,7 +905,7 @@ public void refreshRoot(final ObjectAdapter adapter) {\n      * Makes an {@link ObjectAdapter} persistent. The specified object should be\n      * stored away via this object store's persistence mechanism, and have a\n      * new and unique OID assigned to it. The object, should also be added to\n-     * the {@link org.apache.isis.core.runtime.persistence.adaptermanager.AdapterManagerDefault} as the object is implicitly 'in use'.\n+     * the {@link PersistenceSession} as the object is implicitly 'in use'.\n      *\n      * <p>\n      * If the object has any associations then each of these, where they aren't\n@@ -1166,7 +1171,7 @@ public void debugData(final DebugBuilder debug) {\n         debug.appendln();\n \n         debug.appendTitle(\"Services\");\n-        for (final Object servicePojo : persistenceSessionFactory.getServicesInjector().getRegisteredServices()) {\n+        for (final Object servicePojo : servicesInjector.getRegisteredServices()) {\n             final String id = ServiceUtil.id(servicePojo);\n             final Class<? extends Object> serviceClass = servicePojo.getClass();\n             final ObjectSpecification serviceSpecification = getSpecificationLoader().loadSpecification(serviceClass);\n@@ -1210,7 +1215,7 @@ protected AuthenticationSession getAuthenticationSession() {\n      * The configured {@link ServicesInjectorSpi}.\n      */\n     public ServicesInjectorSpi getServicesInjector() {\n-        return persistenceSessionFactory.getServicesInjector();\n+        return servicesInjector;\n     }\n \n ",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/PersistenceSession.java",
                "sha": "4327cf477002b6d7a3b0aaab8dc5ae6f9247d0d6",
                "status": "modified"
            },
            {
                "additions": 14,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/PersistenceSessionFactory.java",
                "changes": 128,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/PersistenceSessionFactory.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 114,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/PersistenceSessionFactory.java",
                "patch": "@@ -22,45 +22,26 @@\n import java.util.Map;\n import java.util.Set;\n \n+import javax.jdo.PersistenceManagerFactory;\n+\n import org.datanucleus.PropertyNames;\n import org.datanucleus.api.jdo.JDOPersistenceManagerFactory;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n-import org.apache.isis.applib.clock.Clock;\n-import org.apache.isis.applib.fixtures.FixtureClock;\n import org.apache.isis.core.commons.authentication.AuthenticationSession;\n import org.apache.isis.core.commons.components.ApplicationScopedComponent;\n import org.apache.isis.core.commons.config.IsisConfiguration;\n import org.apache.isis.core.commons.config.IsisConfigurationDefault;\n-import org.apache.isis.core.metamodel.facetapi.MetaModelRefiner;\n-import org.apache.isis.core.metamodel.progmodel.ProgrammingModel;\n import org.apache.isis.core.metamodel.services.ServicesInjectorSpi;\n import org.apache.isis.core.metamodel.spec.SpecificationLoaderSpi;\n-import org.apache.isis.core.metamodel.spec.SpecificationLoaderSpiAware;\n-import org.apache.isis.core.metamodel.specloader.validator.MetaModelValidatorComposite;\n import org.apache.isis.core.runtime.persistence.FixturesInstalledFlag;\n-import org.apache.isis.core.runtime.persistence.internal.RuntimeContextFromSession;\n import org.apache.isis.core.runtime.system.DeploymentType;\n import org.apache.isis.objectstore.jdo.datanucleus.DataNucleusPersistenceMechanismInstaller;\n import org.apache.isis.objectstore.jdo.datanucleus.JDOStateManagerForIsis;\n-import org.apache.isis.objectstore.jdo.metamodel.facets.object.auditable.AuditableAnnotationInJdoApplibFacetFactory;\n-import org.apache.isis.objectstore.jdo.metamodel.facets.object.auditable.AuditableMarkerInterfaceInJdoApplibFacetFactory;\n-import org.apache.isis.objectstore.jdo.metamodel.facets.object.datastoreidentity.JdoDatastoreIdentityAnnotationFacetFactory;\n-import org.apache.isis.objectstore.jdo.metamodel.facets.object.discriminator.JdoDiscriminatorAnnotationFacetFactory;\n-import org.apache.isis.objectstore.jdo.metamodel.facets.object.persistencecapable.JdoPersistenceCapableAnnotationFacetFactory;\n-import org.apache.isis.objectstore.jdo.metamodel.facets.object.query.JdoQueryAnnotationFacetFactory;\n-import org.apache.isis.objectstore.jdo.metamodel.facets.object.version.JdoVersionAnnotationFacetFactory;\n-import org.apache.isis.objectstore.jdo.metamodel.facets.prop.column.BigDecimalDerivedFromJdoColumnAnnotationFacetFactory;\n-import org.apache.isis.objectstore.jdo.metamodel.facets.prop.column.MandatoryFromJdoColumnAnnotationFacetFactory;\n-import org.apache.isis.objectstore.jdo.metamodel.facets.prop.column.MaxLengthDerivedFromJdoColumnAnnotationFacetFactory;\n-import org.apache.isis.objectstore.jdo.metamodel.facets.prop.notpersistent.JdoNotPersistentAnnotationFacetFactory;\n-import org.apache.isis.objectstore.jdo.metamodel.facets.prop.primarykey.JdoPrimaryKeyAnnotationFacetFactory;\n-import org.apache.isis.objectstore.jdo.metamodel.specloader.validator.JdoMetaModelValidator;\n import org.apache.isis.objectstore.jdo.service.RegisterEntities;\n \n-public class PersistenceSessionFactory implements MetaModelRefiner,\n-        SpecificationLoaderSpiAware, ApplicationScopedComponent, FixturesInstalledFlag {\n+public class PersistenceSessionFactory implements ApplicationScopedComponent, FixturesInstalledFlag {\n \n     private static final Logger LOG = LoggerFactory.getLogger(PersistenceSessionFactory.class);\n \n@@ -69,32 +50,11 @@\n     private final DeploymentType deploymentType;\n     private final IsisConfigurationDefault configuration;\n \n-    private final ServicesInjectorSpi servicesInjector;\n-    private final RuntimeContextFromSession runtimeContext;\n-\n-    private SpecificationLoaderSpi specificationLoader;\n-\n     public PersistenceSessionFactory(\n             final DeploymentType deploymentType,\n-            final ServicesInjectorSpi servicesInjector,\n-            final IsisConfigurationDefault isisConfiguration,\n-            final RuntimeContextFromSession runtimeContext) {\n+            final IsisConfigurationDefault isisConfiguration) {\n         this.deploymentType = deploymentType;\n         this.configuration = isisConfiguration;\n-        this.servicesInjector = servicesInjector;\n-        this.runtimeContext = runtimeContext;\n-    }\n-\n-    public DeploymentType getDeploymentType() {\n-        return deploymentType;\n-    }\n-\n-    public IsisConfigurationDefault getConfiguration() {\n-        return configuration;\n-    }\n-\n-    public ServicesInjectorSpi getServicesInjector() {\n-        return servicesInjector;\n     }\n \n     //endregion\n@@ -104,29 +64,6 @@ public ServicesInjectorSpi getServicesInjector() {\n     private DataNucleusApplicationComponents applicationComponents;\n \n     public final void init() {\n-\n-        // a bit of a workaround, but required if anything in the metamodel (for\n-        // example, a\n-        // ValueSemanticsProvider for a date value type) needs to use the Clock\n-        // singleton\n-        // we do this after loading the services to allow a service to prime a\n-        // different clock\n-        // implementation (eg to use an NTP time service).\n-        if (!deploymentType.isProduction() && !Clock.isInitialized()) {\n-            FixtureClock.initialize();\n-        }\n-\n-        runtimeContext.injectInto(servicesInjector);\n-\n-        // wire up components\n-        getSpecificationLoader().injectInto(runtimeContext);\n-\n-        for (Object service : servicesInjector.getRegisteredServices()) {\n-            runtimeContext.injectInto(service);\n-        }\n-\n-        servicesInjector.init();\n-\n         this.applicationComponents = createDataNucleusApplicationComponents(configuration);\n     }\n \n@@ -215,49 +152,24 @@ public final void shutdown() {\n \n     //endregion\n \n-    //region > MetaModelRefiner impl\n-\n-    @Override\n-    public void refineProgrammingModel(ProgrammingModel programmingModel, IsisConfiguration configuration) {\n-        programmingModel.addFactory(\n-                JdoPersistenceCapableAnnotationFacetFactory.class, ProgrammingModel.Position.BEGINNING);\n-        programmingModel.addFactory(JdoDatastoreIdentityAnnotationFacetFactory.class);\n-\n-        programmingModel.addFactory(JdoPrimaryKeyAnnotationFacetFactory.class);\n-        programmingModel.addFactory(JdoNotPersistentAnnotationFacetFactory.class);\n-        programmingModel.addFactory(JdoDiscriminatorAnnotationFacetFactory.class);\n-        programmingModel.addFactory(JdoVersionAnnotationFacetFactory.class);\n-\n-        programmingModel.addFactory(JdoQueryAnnotationFacetFactory.class);\n-\n-        programmingModel.addFactory(BigDecimalDerivedFromJdoColumnAnnotationFacetFactory.class);\n-        programmingModel.addFactory(MaxLengthDerivedFromJdoColumnAnnotationFacetFactory.class);\n-        // must appear after JdoPrimaryKeyAnnotationFacetFactory (above)\n-        // and also MandatoryFacetOnPropertyMandatoryAnnotationFactory\n-        // and also PropertyAnnotationFactory\n-        programmingModel.addFactory(MandatoryFromJdoColumnAnnotationFacetFactory.class);\n-\n-        programmingModel.addFactory(AuditableAnnotationInJdoApplibFacetFactory.class);\n-        programmingModel.addFactory(AuditableMarkerInterfaceInJdoApplibFacetFactory.class);\n-    }\n-\n-    @Override\n-    public void refineMetaModelValidator(MetaModelValidatorComposite metaModelValidator, IsisConfiguration configuration) {\n-        metaModelValidator.add(new JdoMetaModelValidator());\n-    }\n-\n-    //endregion\n-\n-    //region > createPersisenceSession\n \n+    //region > createPersistenceSession\n \n     /**\n      * Called by {@link org.apache.isis.core.runtime.system.session.IsisSessionFactory#openSession(AuthenticationSession)}.\n      */\n     public PersistenceSession createPersistenceSession(\n+            final ServicesInjectorSpi servicesInjector,\n             final SpecificationLoaderSpi specificationLoader,\n             final AuthenticationSession authenticationSession) {\n-        return new PersistenceSession(this, getConfiguration(), specificationLoader, authenticationSession);\n+\n+        final FixturesInstalledFlag fixturesInstalledFlag = this;\n+        final PersistenceManagerFactory persistenceManagerFactory =\n+                applicationComponents.getPersistenceManagerFactory();\n+\n+        return new PersistenceSession(\n+                configuration, servicesInjector, specificationLoader,\n+                authenticationSession, persistenceManagerFactory, fixturesInstalledFlag);\n     }\n \n     DataNucleusApplicationComponents getApplicationComponents() {\n@@ -282,17 +194,5 @@ public void setFixturesInstalled(final Boolean fixturesInstalled) {\n \n     //endregion\n \n-    //region > dependencies (from init)\n-\n-    protected SpecificationLoaderSpi getSpecificationLoader() {\n-        return specificationLoader;\n-    }\n-\n-    @Override\n-    public void setSpecificationLoaderSpi(final SpecificationLoaderSpi specificationLoader) {\n-        this.specificationLoader = specificationLoader;\n-    }\n-\n-    //endregion\n \n }",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/PersistenceSessionFactory.java",
                "sha": "713dff1db0c293342dd3b07ef063d4310f855fb2",
                "status": "modified"
            },
            {
                "additions": 53,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/PersistenceSessionFactoryMetamodelRefiner.java",
                "changes": 53,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/PersistenceSessionFactoryMetamodelRefiner.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 0,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/PersistenceSessionFactoryMetamodelRefiner.java",
                "patch": "@@ -0,0 +1,53 @@\n+package org.apache.isis.core.runtime.system.persistence;\n+\n+import org.apache.isis.core.commons.config.IsisConfiguration;\n+import org.apache.isis.core.metamodel.facetapi.MetaModelRefiner;\n+import org.apache.isis.core.metamodel.progmodel.ProgrammingModel;\n+import org.apache.isis.core.metamodel.specloader.validator.MetaModelValidatorComposite;\n+import org.apache.isis.objectstore.jdo.metamodel.facets.object.auditable.AuditableAnnotationInJdoApplibFacetFactory;\n+import org.apache.isis.objectstore.jdo.metamodel.facets.object.auditable.AuditableMarkerInterfaceInJdoApplibFacetFactory;\n+import org.apache.isis.objectstore.jdo.metamodel.facets.object.datastoreidentity.JdoDatastoreIdentityAnnotationFacetFactory;\n+import org.apache.isis.objectstore.jdo.metamodel.facets.object.discriminator.JdoDiscriminatorAnnotationFacetFactory;\n+import org.apache.isis.objectstore.jdo.metamodel.facets.object.persistencecapable.JdoPersistenceCapableAnnotationFacetFactory;\n+import org.apache.isis.objectstore.jdo.metamodel.facets.object.query.JdoQueryAnnotationFacetFactory;\n+import org.apache.isis.objectstore.jdo.metamodel.facets.object.version.JdoVersionAnnotationFacetFactory;\n+import org.apache.isis.objectstore.jdo.metamodel.facets.prop.column.BigDecimalDerivedFromJdoColumnAnnotationFacetFactory;\n+import org.apache.isis.objectstore.jdo.metamodel.facets.prop.column.MandatoryFromJdoColumnAnnotationFacetFactory;\n+import org.apache.isis.objectstore.jdo.metamodel.facets.prop.column.MaxLengthDerivedFromJdoColumnAnnotationFacetFactory;\n+import org.apache.isis.objectstore.jdo.metamodel.facets.prop.notpersistent.JdoNotPersistentAnnotationFacetFactory;\n+import org.apache.isis.objectstore.jdo.metamodel.facets.prop.primarykey.JdoPrimaryKeyAnnotationFacetFactory;\n+import org.apache.isis.objectstore.jdo.metamodel.specloader.validator.JdoMetaModelValidator;\n+\n+public class PersistenceSessionFactoryMetamodelRefiner implements MetaModelRefiner {\n+\n+    @Override\n+    public void refineProgrammingModel(ProgrammingModel programmingModel, IsisConfiguration configuration) {\n+        programmingModel.addFactory(\n+                JdoPersistenceCapableAnnotationFacetFactory.class, ProgrammingModel.Position.BEGINNING);\n+        programmingModel.addFactory(JdoDatastoreIdentityAnnotationFacetFactory.class);\n+\n+        programmingModel.addFactory(JdoPrimaryKeyAnnotationFacetFactory.class);\n+        programmingModel.addFactory(JdoNotPersistentAnnotationFacetFactory.class);\n+        programmingModel.addFactory(JdoDiscriminatorAnnotationFacetFactory.class);\n+        programmingModel.addFactory(JdoVersionAnnotationFacetFactory.class);\n+\n+        programmingModel.addFactory(JdoQueryAnnotationFacetFactory.class);\n+\n+        programmingModel.addFactory(BigDecimalDerivedFromJdoColumnAnnotationFacetFactory.class);\n+        programmingModel.addFactory(MaxLengthDerivedFromJdoColumnAnnotationFacetFactory.class);\n+        // must appear after JdoPrimaryKeyAnnotationFacetFactory (above)\n+        // and also MandatoryFacetOnPropertyMandatoryAnnotationFactory\n+        // and also PropertyAnnotationFactory\n+        programmingModel.addFactory(MandatoryFromJdoColumnAnnotationFacetFactory.class);\n+\n+        programmingModel.addFactory(AuditableAnnotationInJdoApplibFacetFactory.class);\n+        programmingModel.addFactory(AuditableMarkerInterfaceInJdoApplibFacetFactory.class);\n+    }\n+\n+    @Override\n+    public void refineMetaModelValidator(\n+            MetaModelValidatorComposite metaModelValidator,\n+            IsisConfiguration configuration) {\n+        metaModelValidator.add(new JdoMetaModelValidator());\n+    }\n+}",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/PersistenceSessionFactoryMetamodelRefiner.java",
                "sha": "f8b44282d409e05525ec93549c2e17152a605580",
                "status": "added"
            },
            {
                "additions": 13,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/adaptermanager/OidAdapterHashMap.java",
                "changes": 30,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/adaptermanager/OidAdapterHashMap.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 17,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/adaptermanager/OidAdapterHashMap.java",
                "patch": "@@ -17,7 +17,7 @@\n  *  under the License.\n  */\n \n-package org.apache.isis.core.runtime.persistence.adaptermanager;\n+package org.apache.isis.core.runtime.system.persistence.adaptermanager;\n \n import java.util.Iterator;\n import java.util.Map;\n@@ -43,25 +43,22 @@\n \n     private final Map<Oid, ObjectAdapter> adapterByOidMap = Maps.newHashMapWithExpectedSize(DEFAULT_OID_ADAPTER_MAP_SIZE);\n \n-\n-    // ///////////////////////////////////////////////////////\n-    // open, close\n-    // ///////////////////////////////////////////////////////\n+    //region > open, close\n \n     public void open() {\n         // nothing to do\n     }\n \n     public void close() {\n-        LOG.debug(\"close\");\n+        if(LOG.isDebugEnabled()) {\n+            LOG.debug(\"close\");\n+        }\n         adapterByOidMap.clear();\n     }\n \n+    //endregion\n \n-    // ///////////////////////////////////////////////////////\n-    // add, remove\n-    // ///////////////////////////////////////////////////////\n-\n+    //region > add, remove\n     /**\n      * Add an adapter for a given oid\n      */\n@@ -90,26 +87,24 @@ public boolean remove(final Oid oid) {\n         return adapterByOidMap.remove(oid) != null;\n     }\n \n+    //endregion\n \n+    //region > getAdapter, iterator\n     /**\n      * Get the adapter identified by the specified OID.\n      */\n     public ObjectAdapter getAdapter(final Oid oid) {\n         return adapterByOidMap.get(oid);\n     }\n \n-    // ///////////////////////////////////////////////////////\n-    // iterator\n-    // ///////////////////////////////////////////////////////\n-\n     @Override\n     public Iterator<Oid> iterator() {\n         return adapterByOidMap.keySet().iterator();\n     }\n \n-    // ///////////////////////////////////////////////////////\n-    // debugging\n-    // ///////////////////////////////////////////////////////\n+    //endregion\n+\n+    //region > debugging\n \n     @Override\n     public String debugTitle() {\n@@ -131,5 +126,6 @@ public void debugData(final DebugBuilder debug) {\n         }\n     }\n \n+    //endregion\n \n }",
                "previous_filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/persistence/adaptermanager/OidAdapterHashMap.java",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/adaptermanager/OidAdapterHashMap.java",
                "sha": "684e25bbb94f03593588646da4ca123bc840d02c",
                "status": "renamed"
            },
            {
                "additions": 23,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/adaptermanager/PojoAdapterHashMap.java",
                "changes": 45,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/adaptermanager/PojoAdapterHashMap.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 22,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/adaptermanager/PojoAdapterHashMap.java",
                "patch": "@@ -17,7 +17,7 @@\n  *  under the License.\n  */\n \n-package org.apache.isis.core.runtime.persistence.adaptermanager;\n+package org.apache.isis.core.runtime.system.persistence.adaptermanager;\n \n import java.util.Iterator;\n import java.util.Map;\n@@ -57,10 +57,7 @@ public boolean equals(final Object obj) {\n \n     protected final Map<Object, ObjectAdapter> adapterByPojoMap;\n \n-    // ///////////////////////////////////////////////////////////////////////////\n-    // Constructors, finalize\n-    // ///////////////////////////////////////////////////////////////////////////\n-\n+    //region > Constructors, finalize\n     public PojoAdapterHashMap() {\n         this(DEFAULT_POJO_ADAPTER_MAP_SIZE);\n     }\n@@ -72,26 +69,28 @@ public PojoAdapterHashMap(final int capacity) {\n     @Override\n     protected void finalize() throws Throwable {\n         super.finalize();\n-        LOG.debug(\"finalizing hash of pojos\");\n+        if(LOG.isDebugEnabled()) {\n+            LOG.debug(\"finalizing hash of pojos\");\n+        }\n     }\n+    //endregion\n \n-    // ///////////////////////////////////////////////////////////////////////////\n-    // open, close\n-    // ///////////////////////////////////////////////////////////////////////////\n+    //region > open, close\n \n     public void open() {\n         // nothing to do\n     }\n \n     public void close() {\n-        LOG.debug(\"close\");\n+        if(LOG.isDebugEnabled()) {\n+            LOG.debug(\"close\");\n+        }\n         adapterByPojoMap.clear();\n     }\n \n+    //endregion\n \n-    // ///////////////////////////////////////////////////////////////////////////\n-    // add, remove\n-    // ///////////////////////////////////////////////////////////////////////////\n+    //region > add, remove\n \n     public void add(final Object pojo, final ObjectAdapter adapter) {\n         adapterByPojoMap.put(key(pojo), adapter);\n@@ -109,9 +108,9 @@ public void remove(final ObjectAdapter object) {\n         adapterByPojoMap.remove(key(object.getObject()));\n     }\n \n-    // ///////////////////////////////////////////////////////////////////////////\n-    // get, contains\n-    // ///////////////////////////////////////////////////////////////////////////\n+    //endregion\n+\n+    //region > getAdapter, containsPojo\n \n     public boolean containsPojo(final Object pojo) {\n         return adapterByPojoMap.containsKey(key(pojo));\n@@ -121,10 +120,9 @@ public ObjectAdapter getAdapter(final Object pojo) {\n         return adapterByPojoMap.get(key(pojo));\n     }\n \n-    // ///////////////////////////////////////////////////////////////////////////\n-    // elements\n-    // ///////////////////////////////////////////////////////////////////////////\n+    //endregion\n \n+    //region > iterator, key\n     @Override\n     public Iterator<ObjectAdapter> iterator() {\n         return adapterByPojoMap.values().iterator();\n@@ -134,9 +132,9 @@ private Object key(final Object pojo) {\n         return new IdentityHashKey(pojo);\n     }\n \n-    // ///////////////////////////////////////////////////////////////////////////\n-    // Debugging\n-    // ///////////////////////////////////////////////////////////////////////////\n+    //endregion\n+\n+    //region > Debugging\n \n     @Override\n     public void debugData(final DebugBuilder debug) {\n@@ -157,4 +155,7 @@ public void debugData(final DebugBuilder debug) {\n     public String debugTitle() {\n         return \"POJO Adapter Hashtable\";\n     }\n+\n+    //endregion\n+\n }",
                "previous_filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/persistence/adaptermanager/PojoAdapterHashMap.java",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/adaptermanager/PojoAdapterHashMap.java",
                "sha": "9a810a47e5def3ce08ffa38c5a498af864811b69",
                "status": "renamed"
            },
            {
                "additions": 1,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/adaptermanager/RootAndCollectionAdapters.java",
                "changes": 2,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/adaptermanager/RootAndCollectionAdapters.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 1,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/adaptermanager/RootAndCollectionAdapters.java",
                "patch": "@@ -17,7 +17,7 @@\n  *  under the License.\n  */\n \n-package org.apache.isis.core.runtime.persistence.adaptermanager;\n+package org.apache.isis.core.runtime.system.persistence.adaptermanager;\n \n import java.util.Collections;\n import java.util.Iterator;",
                "previous_filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/persistence/adaptermanager/RootAndCollectionAdapters.java",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/persistence/adaptermanager/RootAndCollectionAdapters.java",
                "sha": "4a35fe011d9a6f22371914410042bcc87d87bd13",
                "status": "renamed"
            },
            {
                "additions": 24,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/session/IsisSessionFactory.java",
                "changes": 29,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/system/session/IsisSessionFactory.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 5,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/system/session/IsisSessionFactory.java",
                "patch": "@@ -24,6 +24,8 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+import org.apache.isis.applib.clock.Clock;\n+import org.apache.isis.applib.fixtures.FixtureClock;\n import org.apache.isis.core.commons.authentication.AuthenticationSession;\n import org.apache.isis.core.commons.components.ApplicationScopedComponent;\n import org.apache.isis.core.commons.config.IsisConfiguration;\n@@ -68,6 +70,7 @@\n     private final DeploymentType deploymentType;\n     private final IsisConfiguration configuration;\n     private final SpecificationLoaderSpi specificationLoaderSpi;\n+    private final ServicesInjectorSpi servicesInjector;\n     private final AuthenticationManager authenticationManager;\n     private final AuthorizationManager authorizationManager;\n     private final PersistenceSessionFactory persistenceSessionFactory;\n@@ -76,6 +79,7 @@\n     public IsisSessionFactory(\n             final DeploymentType deploymentType,\n             final IsisConfiguration configuration,\n+            final ServicesInjectorSpi servicesInjector,\n             final SpecificationLoaderSpi specificationLoader,\n             final AuthenticationManager authenticationManager,\n             final AuthorizationManager authorizationManager,\n@@ -84,6 +88,7 @@ public IsisSessionFactory(\n         ensureThatArg(deploymentType, is(not(nullValue())));\n         ensureThatArg(configuration, is(not(nullValue())));\n         ensureThatArg(specificationLoader, is(not(nullValue())));\n+        ensureThatArg(servicesInjector, is(not(nullValue())));\n         ensureThatArg(authenticationManager, is(not(nullValue())));\n         ensureThatArg(authorizationManager, is(not(nullValue())));\n         ensureThatArg(persistenceSessionFactory, is(not(nullValue())));\n@@ -93,8 +98,9 @@ public IsisSessionFactory(\n         this.specificationLoaderSpi = specificationLoader;\n         this.authenticationManager = authenticationManager;\n         this.authorizationManager = authorizationManager;\n+        this.servicesInjector = servicesInjector;\n         this.persistenceSessionFactory = persistenceSessionFactory;\n-        this.oidMarshaller = new OidMarshaller();;\n+        this.oidMarshaller = new OidMarshaller();\n     }\n \n \n@@ -107,8 +113,17 @@ public IsisSessionFactory(\n      * Wires components as necessary, and then init}ializes all.\n      */\n     public void init() {\n-        final ServicesInjectorSpi servicesInjector = persistenceSessionFactory.getServicesInjector();\n-        specificationLoaderSpi.setServiceInjector(servicesInjector);\n+\n+        // a bit of a workaround, but required if anything in the metamodel (for\n+        // example, a\n+        // ValueSemanticsProvider for a date value type) needs to use the Clock\n+        // singleton\n+        // we do this after loading the services to allow a service to prime a\n+        // different clock\n+        // implementation (eg to use an NTP time service).\n+        if (!deploymentType.isProduction() && !Clock.isInitialized()) {\n+            FixtureClock.initialize();\n+        }\n \n         specificationLoaderSpi.init();\n \n@@ -117,6 +132,9 @@ public void init() {\n \n         authenticationManager.init();\n         authorizationManager.init();\n+\n+        servicesInjector.init();\n+\n         persistenceSessionFactory.init();\n     }\n \n@@ -135,7 +153,8 @@ public void shutdown() {\n      */\n     public IsisSession openSession(final AuthenticationSession authenticationSession) {\n         final PersistenceSession persistenceSession =\n-                persistenceSessionFactory.createPersistenceSession(getSpecificationLoader(), authenticationSession);\n+                persistenceSessionFactory.createPersistenceSession(\n+                        servicesInjector, getSpecificationLoader(), authenticationSession);\n         ensureThatArg(persistenceSession, is(not(nullValue())));\n \n         return newIsisSession(authenticationSession, persistenceSession);\n@@ -199,7 +218,7 @@ public PersistenceSessionFactory getPersistenceSessionFactory() {\n     }\n \n     public List<Object> getServices() {\n-        return getPersistenceSessionFactory().getServicesInjector().getRegisteredServices();\n+        return servicesInjector.getRegisteredServices();\n     }\n \n     /**",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/system/session/IsisSessionFactory.java",
                "sha": "48267b15311927e7d28cf5bf32980363e3339429",
                "status": "modified"
            },
            {
                "additions": 4,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProvider.java",
                "changes": 8,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProvider.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 4,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProvider.java",
                "patch": "@@ -22,15 +22,13 @@\n import java.util.Collection;\n import java.util.List;\n \n-import org.apache.isis.core.commons.config.IsisConfiguration;\n import org.apache.isis.core.commons.config.IsisConfigurationDefault;\n import org.apache.isis.core.metamodel.facetapi.MetaModelRefiner;\n import org.apache.isis.core.metamodel.services.ServicesInjectorSpi;\n import org.apache.isis.core.metamodel.spec.SpecificationLoaderSpi;\n import org.apache.isis.core.runtime.authentication.AuthenticationManager;\n import org.apache.isis.core.runtime.authorization.AuthorizationManager;\n import org.apache.isis.core.runtime.fixtures.FixturesInstaller;\n-import org.apache.isis.core.runtime.persistence.internal.RuntimeContextFromSession;\n import org.apache.isis.core.runtime.system.DeploymentType;\n import org.apache.isis.core.runtime.system.IsisSystemException;\n import org.apache.isis.core.runtime.system.persistence.PersistenceSessionFactory;\n@@ -51,12 +49,14 @@\n \n     FixturesInstaller provideFixturesInstaller();\n \n-    SpecificationLoaderSpi provideSpecificationLoaderSpi(Collection<MetaModelRefiner> metaModelRefiners)\n+    SpecificationLoaderSpi provideSpecificationLoaderSpi(\n+            final DeploymentType deploymentType,\n+            Collection<MetaModelRefiner> metaModelRefiners)\n             throws IsisSystemException;\n \n     PersistenceSessionFactory providePersistenceSessionFactory(\n             final DeploymentType deploymentType,\n             final ServicesInjectorSpi servicesInjectorSpi,\n-            final RuntimeContextFromSession runtimeContext);\n+            final SpecificationLoaderSpi specificationLoader);\n \n }",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProvider.java",
                "sha": "b2bbeb0fae8dd6c26ee0941725dadd15b007c20f",
                "status": "modified"
            },
            {
                "additions": 287,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProviderDefault2.java",
                "changes": 287,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProviderDefault2.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 0,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProviderDefault2.java",
                "patch": "@@ -0,0 +1,287 @@\n+/*\n+ *  Licensed to the Apache Software Foundation (ASF) under one\n+ *  or more contributor license agreements.  See the NOTICE file\n+ *  distributed with this work for additional information\n+ *  regarding copyright ownership.  The ASF licenses this file\n+ *  to you under the Apache License, Version 2.0 (the\n+ *  \"License\"); you may not use this file except in compliance\n+ *  with the License.  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+\n+package org.apache.isis.core.runtime.systemusinginstallers;\n+\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Set;\n+\n+import com.google.common.collect.Lists;\n+import com.google.common.collect.Sets;\n+\n+import org.apache.isis.applib.AppManifest;\n+import org.apache.isis.applib.fixtures.InstallableFixture;\n+import org.apache.isis.applib.fixturescripts.FixtureScript;\n+import org.apache.isis.core.commons.config.IsisConfiguration;\n+import org.apache.isis.core.commons.config.IsisConfigurationDefault;\n+import org.apache.isis.core.commons.resource.ResourceStreamSourceContextLoaderClassPath;\n+import org.apache.isis.core.metamodel.deployment.DeploymentCategory;\n+import org.apache.isis.core.metamodel.facetapi.MetaModelRefiner;\n+import org.apache.isis.core.metamodel.facetdecorator.FacetDecorator;\n+import org.apache.isis.core.metamodel.layoutmetadata.LayoutMetadataReader;\n+import org.apache.isis.core.metamodel.layoutmetadata.json.LayoutMetadataReaderFromJson;\n+import org.apache.isis.core.metamodel.metamodelvalidator.dflt.MetaModelValidatorDefault;\n+import org.apache.isis.core.metamodel.progmodel.ProgrammingModel;\n+import org.apache.isis.core.metamodel.services.ServicesInjectorSpi;\n+import org.apache.isis.core.metamodel.spec.SpecificationLoaderSpi;\n+import org.apache.isis.core.metamodel.specloader.validator.MetaModelValidator;\n+import org.apache.isis.core.runtime.authentication.AuthenticationManager;\n+import org.apache.isis.core.runtime.authentication.AuthenticationRequest;\n+import org.apache.isis.core.runtime.authentication.standard.AuthenticationManagerStandard;\n+import org.apache.isis.core.runtime.authentication.standard.Authenticator;\n+import org.apache.isis.core.runtime.authentication.standard.AuthenticatorAbstract;\n+import org.apache.isis.core.runtime.authorization.AuthorizationManager;\n+import org.apache.isis.core.runtime.authorization.standard.AuthorizationManagerStandard;\n+import org.apache.isis.core.runtime.fixtures.FixturesInstaller;\n+import org.apache.isis.core.runtime.fixtures.FixturesInstallerFromConfiguration;\n+import org.apache.isis.core.runtime.services.ServicesInstallerFromConfiguration;\n+import org.apache.isis.core.runtime.services.ServicesInstallerFromConfigurationAndAnnotation;\n+import org.apache.isis.core.runtime.system.DeploymentType;\n+import org.apache.isis.core.runtime.system.IsisSystemException;\n+import org.apache.isis.core.runtime.system.persistence.PersistenceSessionFactory;\n+import org.apache.isis.core.runtime.transaction.facetdecorator.standard.StandardTransactionFacetDecorator;\n+import org.apache.isis.objectstore.jdo.datanucleus.DataNucleusPersistenceMechanismInstaller;\n+import org.apache.isis.progmodels.dflt.JavaReflectorHelper;\n+import org.apache.isis.progmodels.dflt.ProgrammingModelFacetsJava5;\n+\n+public class IsisComponentProviderDefault2 extends IsisComponentProviderAbstract {\n+\n+    private final ProgrammingModel programmingModel;\n+    private final MetaModelValidator metaModelValidator;\n+\n+    public IsisComponentProviderDefault2(\n+            final DeploymentType deploymentType,\n+            final AppManifest appManifestIfAny,\n+            final List<Object> servicesOverride,\n+            final List<InstallableFixture> fixturesOverride,\n+            final IsisConfiguration configurationOverride,\n+            final ProgrammingModel programmingModelOverride,\n+            final MetaModelValidator metaModelValidatorOverride) {\n+        super(deploymentType, appManifestIfAny);\n+\n+        this.configuration = elseDefault(configurationOverride);\n+\n+        final String fixtureClassNamesCsv;\n+        if(appManifest != null) {\n+\n+            putAppManifestKey(appManifest);\n+            registerPackageNames(appManifest);\n+            specifyServicesAndRegisteredEntitiesUsing(appManifest);\n+\n+            List<Class<? extends FixtureScript>> fixtureClasses = appManifest.getFixtures();\n+            fixtureClassNamesCsv = classNamesFrom(fixtureClasses);\n+\n+            overrideConfigurationUsing(appManifest);\n+\n+            this.services = createServices(configuration);\n+\n+        } else {\n+            fixtureClassNamesCsv = classNamesFrom(fixturesOverride);\n+\n+            this.services = elseDefault(servicesOverride, configuration);\n+        }\n+\n+        putConfigurationProperty(FixturesInstallerFromConfiguration.FIXTURES, fixtureClassNamesCsv);\n+        this.fixturesInstaller = createFixturesInstaller(configuration);\n+\n+        // integration tests ignore appManifest for authentication and authorization.\n+        this.authenticationManager = createAuthenticationManager(configuration);\n+        this.authorizationManager = createAuthorizationManager(configuration);\n+\n+        this.programmingModel = elseDefault(programmingModelOverride, configuration);\n+        this.metaModelValidator = elseDefault(metaModelValidatorOverride);\n+\n+    }\n+\n+\n+\n+    //region > appManifest\n+\n+    private List<Object> createServices(final IsisConfiguration configuration) {\n+        final ServicesInstallerFromConfigurationAndAnnotation servicesInstaller =\n+                new ServicesInstallerFromConfigurationAndAnnotation();\n+        servicesInstaller.setConfiguration(configuration);\n+        return servicesInstaller.getServices();\n+    }\n+\n+\n+    @Override\n+    protected void doPutConfigurationProperty(final String key, final String value) {\n+        // bit hacky :-(\n+        IsisConfigurationDefault configurationDefault = (IsisConfigurationDefault) this.configuration;\n+        configurationDefault.put(key, value);\n+    }\n+\n+    //endregion\n+\n+    /**\n+     * Default will read <tt>isis.properties</tt> (and other optional property files) from the &quot;config&quot;\n+     * package on the current classpath.\n+     */\n+    private static IsisConfigurationDefault elseDefault(final IsisConfiguration configuration) {\n+        return configuration != null\n+                ? (IsisConfigurationDefault) configuration\n+                : new IsisConfigurationDefault(ResourceStreamSourceContextLoaderClassPath.create(\"config\"));\n+    }\n+\n+    private static List<Object> elseDefault(\n+            final List<Object> servicesOverride,\n+            final IsisConfiguration configuration) {\n+        return servicesOverride != null\n+                ? servicesOverride\n+                : createDefaultServices(configuration);\n+    }\n+\n+    private static List<Object> createDefaultServices(\n+            final IsisConfiguration configuration) {\n+        final ServicesInstallerFromConfiguration servicesInstaller = new ServicesInstallerFromConfiguration();\n+        servicesInstaller.setConfiguration(configuration);\n+        return servicesInstaller.getServices();\n+    }\n+\n+\n+    private static ProgrammingModel elseDefault(final ProgrammingModel programmingModel, final IsisConfiguration configuration) {\n+        return programmingModel != null\n+                ? programmingModel\n+                : createDefaultProgrammingModel(configuration);\n+    }\n+\n+    // TODO: this is duplicating logic in JavaReflectorInstallerNoDecorators; need to unify.\n+    private static ProgrammingModel createDefaultProgrammingModel(final IsisConfiguration configuration) {\n+        final ProgrammingModelFacetsJava5 programmingModel = new ProgrammingModelFacetsJava5();\n+\n+        ProgrammingModel.Util.includeFacetFactories(configuration, programmingModel);\n+        ProgrammingModel.Util.excludeFacetFactories(configuration, programmingModel);\n+        return programmingModel;\n+    }\n+\n+    private static MetaModelValidator elseDefault(final MetaModelValidator metaModelValidator) {\n+        return metaModelValidator != null\n+                ? metaModelValidator\n+                : new MetaModelValidatorDefault();\n+    }\n+\n+    private static FixturesInstaller createFixturesInstaller(final IsisConfiguration configuration) {\n+        final FixturesInstallerFromConfiguration fixturesInstallerFromConfiguration = new FixturesInstallerFromConfiguration();\n+        fixturesInstallerFromConfiguration.setConfiguration(configuration);\n+        return fixturesInstallerFromConfiguration;\n+    }\n+\n+    /**\n+     * The standard authentication manager, configured with the default authenticator (allows all requests through).\n+     */\n+    private static AuthenticationManager createAuthenticationManager(final IsisConfiguration configuration) {\n+        final AuthenticationManagerStandard authenticationManager = new AuthenticationManagerStandard(configuration);\n+        Authenticator authenticator = new AuthenticatorBypass(configuration);\n+        authenticationManager.addAuthenticator(authenticator);\n+        return authenticationManager;\n+    }\n+\n+    private static class AuthenticatorBypass extends AuthenticatorAbstract {\n+\n+        public AuthenticatorBypass(final IsisConfiguration configuration) {\n+            super(configuration);\n+        }\n+\n+        @Override\n+        public boolean isValid(final AuthenticationRequest request) {\n+            return true;\n+        }\n+\n+        @Override\n+        public boolean canAuthenticate(final Class<? extends AuthenticationRequest> authenticationRequestClass) {\n+            return true;\n+        }\n+\n+    }\n+\n+\n+    /**\n+     * The standard authorization manager, allowing all access.\n+     */\n+    private static AuthorizationManager createAuthorizationManager(final IsisConfiguration configuration) {\n+        return new AuthorizationManagerStandard(configuration);\n+    }\n+\n+\n+    @Override\n+    public DeploymentType getDeploymentType() {\n+        return deploymentType;\n+    }\n+\n+    @Override\n+    public IsisConfigurationDefault getConfiguration() {\n+        return configuration;\n+    }\n+\n+    @Override\n+    public List<Object> provideServices() {\n+        return services;\n+    }\n+\n+    @Override\n+    public FixturesInstaller provideFixturesInstaller()  {\n+        return fixturesInstaller;\n+    }\n+\n+    @Override\n+    public SpecificationLoaderSpi provideSpecificationLoaderSpi(\n+            final DeploymentType deploymentType,\n+            Collection<MetaModelRefiner> metaModelRefiners) throws IsisSystemException {\n+\n+        final DeploymentCategory deploymentCategory = deploymentType.getDeploymentCategory();\n+\n+        final Set<FacetDecorator> facetDecorators =\n+                Sets.newHashSet((FacetDecorator) new StandardTransactionFacetDecorator(getConfiguration()));\n+        final List<LayoutMetadataReader> layoutMetadataReaders =\n+                Lists.<LayoutMetadataReader>newArrayList(new LayoutMetadataReaderFromJson());\n+\n+        return JavaReflectorHelper\n+                .createObjectReflector(\n+                        deploymentCategory, getConfiguration(), programmingModel,\n+                        metaModelRefiners,\n+                        facetDecorators, layoutMetadataReaders,\n+                        metaModelValidator\n+                );\n+    }\n+\n+    @Override\n+    public AuthenticationManager provideAuthenticationManager(DeploymentType deploymentType) {\n+        return authenticationManager;\n+    }\n+\n+    @Override\n+    public AuthorizationManager provideAuthorizationManager(DeploymentType deploymentType) {\n+        return authorizationManager;\n+    }\n+\n+    @Override\n+    public PersistenceSessionFactory providePersistenceSessionFactory(\n+            DeploymentType deploymentType,\n+            final ServicesInjectorSpi servicesInjectorSpi,\n+            final SpecificationLoaderSpi specificationLoader) {\n+        DataNucleusPersistenceMechanismInstaller installer =\n+                new DataNucleusPersistenceMechanismInstaller();\n+        return installer.createPersistenceSessionFactory(\n+                deploymentType, configuration, servicesInjectorSpi\n+        );\n+    }\n+\n+}",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProviderDefault2.java",
                "sha": "2f112c485185e5c04b312ef87cee1062e6dd7cd3",
                "status": "added"
            },
            {
                "additions": 6,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProviderUsingInstallers.java",
                "changes": 12,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProviderUsingInstallers.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 6,
                "filename": "core/runtime/src/main/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProviderUsingInstallers.java",
                "patch": "@@ -34,7 +34,6 @@\n import org.apache.isis.core.runtime.fixtures.FixturesInstallerFromConfiguration;\n import org.apache.isis.core.runtime.installerregistry.InstallerLookup;\n import org.apache.isis.core.runtime.installerregistry.installerapi.PersistenceMechanismInstaller;\n-import org.apache.isis.core.runtime.persistence.internal.RuntimeContextFromSession;\n import org.apache.isis.core.runtime.services.ServicesInstaller;\n import org.apache.isis.core.runtime.services.ServicesInstallerFromConfigurationAndAnnotation;\n import org.apache.isis.core.runtime.system.DeploymentType;\n@@ -168,19 +167,20 @@ protected void doPutConfigurationProperty(final String key, final String value)\n \n     @Override\n     public SpecificationLoaderSpi provideSpecificationLoaderSpi(\n+            final DeploymentType deploymentType,\n             final Collection<MetaModelRefiner> metaModelRefiners) {\n-        return reflectorInstaller.createReflector(metaModelRefiners);\n+        return reflectorInstaller.createReflector(deploymentType.getDeploymentCategory(), metaModelRefiners);\n     }\n \n \n     @Override\n     public PersistenceSessionFactory providePersistenceSessionFactory(\n             final DeploymentType deploymentType,\n             final ServicesInjectorSpi servicesInjectorSpi,\n-            final RuntimeContextFromSession runtimeContext) {\n-        return persistenceMechanismInstaller.createPersistenceSessionFactory(deploymentType, servicesInjectorSpi,\n-                getConfiguration(),\n-                runtimeContext);\n+            final SpecificationLoaderSpi specificationLoader) {\n+        return persistenceMechanismInstaller.createPersistenceSessionFactory(\n+                    deploymentType, getConfiguration(),\n+                    servicesInjectorSpi);\n     }\n \n     //region > helpers",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/core/runtime/systemusinginstallers/IsisComponentProviderUsingInstallers.java",
                "sha": "ea2afe41a431cec8ac03cb4a3d7a200ea0005e3d",
                "status": "modified"
            },
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/objectstore/jdo/datanucleus/DataNucleusPersistenceMechanismInstaller.java",
                "changes": 6,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/main/java/org/apache/isis/objectstore/jdo/datanucleus/DataNucleusPersistenceMechanismInstaller.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 4,
                "filename": "core/runtime/src/main/java/org/apache/isis/objectstore/jdo/datanucleus/DataNucleusPersistenceMechanismInstaller.java",
                "patch": "@@ -29,7 +29,6 @@\n import org.apache.isis.core.metamodel.services.ServicesInjectorSpi;\n import org.apache.isis.core.metamodel.spec.SpecificationLoaderSpi;\n import org.apache.isis.core.runtime.installerregistry.installerapi.PersistenceMechanismInstaller;\n-import org.apache.isis.core.runtime.persistence.internal.RuntimeContextFromSession;\n import org.apache.isis.core.runtime.system.DeploymentType;\n import org.apache.isis.core.runtime.system.context.IsisContext;\n import org.apache.isis.core.runtime.system.persistence.PersistenceSessionFactory;\n@@ -68,11 +67,10 @@ public DataNucleusPersistenceMechanismInstaller() {\n     @Override\n     public PersistenceSessionFactory createPersistenceSessionFactory(\n             final DeploymentType deploymentType,\n-            final ServicesInjectorSpi servicesInjector,\n             final IsisConfigurationDefault configuration,\n-            final RuntimeContextFromSession runtimeContext) {\n+            final ServicesInjectorSpi servicesInjector) {\n \n-        return new PersistenceSessionFactory(deploymentType, servicesInjector, configuration, runtimeContext);\n+        return new PersistenceSessionFactory(deploymentType, configuration);\n     }\n     //endregion\n ",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/main/java/org/apache/isis/objectstore/jdo/datanucleus/DataNucleusPersistenceMechanismInstaller.java",
                "sha": "07cf7833fbe72b52861ea9fd739abf051ecd8690",
                "status": "modified"
            },
            {
                "additions": 7,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/test/java/org/apache/isis/core/runtime/context/IsisContextTest.java",
                "changes": 11,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/test/java/org/apache/isis/core/runtime/context/IsisContextTest.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 4,
                "filename": "core/runtime/src/test/java/org/apache/isis/core/runtime/context/IsisContextTest.java",
                "patch": "@@ -29,6 +29,7 @@\n import org.apache.isis.core.commons.config.IsisConfiguration;\n import org.apache.isis.core.commons.config.IsisConfigurationDefault;\n import org.apache.isis.core.metamodel.adapter.oid.OidMarshaller;\n+import org.apache.isis.core.metamodel.services.ServicesInjectorSpi;\n import org.apache.isis.core.metamodel.spec.SpecificationLoaderSpi;\n import org.apache.isis.core.runtime.authentication.AuthenticationManager;\n import org.apache.isis.core.runtime.authentication.standard.SimpleSession;\n@@ -56,6 +57,8 @@\n     @Mock\n     private SpecificationLoaderSpi mockSpecificationLoader;\n \n+    @Mock\n+    protected ServicesInjectorSpi mockServicesInjector;\n     @Mock\n     protected PersistenceSessionFactory mockPersistenceSessionFactory;\n     @Mock\n@@ -91,10 +94,10 @@ public void setUp() throws Exception {\n                 mockSpecificationLoader,\n                 mockAuthenticationManager,\n                 mockAuthorizationManager,\n-                mockContainer)\n-        ;\n+                mockContainer);\n \n-        sessionFactory = new IsisSessionFactory(DeploymentType.UNIT_TESTING, configuration, mockSpecificationLoader, mockAuthenticationManager, mockAuthorizationManager, mockPersistenceSessionFactory);\n+        sessionFactory = new IsisSessionFactory(DeploymentType.UNIT_TESTING, configuration, mockServicesInjector,\n+                mockSpecificationLoader, mockAuthenticationManager, mockAuthorizationManager, mockPersistenceSessionFactory);\n         authSession = new SimpleSession(\"tester\", Collections.<String>emptyList());\n         \n         IsisContext.setConfiguration(configuration);\n@@ -121,7 +124,7 @@ public void openSession_getSpecificationLoader() {\n         // expecting\n         context.checking(new Expectations() {{\n             one(mockPersistenceSessionFactory)\n-                    .createPersistenceSession(mockSpecificationLoader, authSession);\n+                    .createPersistenceSession(mockServicesInjector, mockSpecificationLoader, authSession);\n             will(returnValue(mockPersistenceSession));\n         }});\n ",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/test/java/org/apache/isis/core/runtime/context/IsisContextTest.java",
                "sha": "51afc3aaff93bf6d3550c88eb742403940971c80",
                "status": "modified"
            },
            {
                "additions": 17,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/test/java/org/apache/isis/core/runtime/system/persistence/PersistenceSessionTest.java",
                "changes": 29,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/runtime/src/test/java/org/apache/isis/core/runtime/system/persistence/PersistenceSessionTest.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 12,
                "filename": "core/runtime/src/test/java/org/apache/isis/core/runtime/system/persistence/PersistenceSessionTest.java",
                "patch": "@@ -21,6 +21,8 @@\n \n import java.util.Collections;\n \n+import javax.jdo.PersistenceManagerFactory;\n+\n import org.jmock.Expectations;\n import org.jmock.Sequence;\n import org.jmock.auto.Mock;\n@@ -39,11 +41,11 @@\n import org.apache.isis.core.metamodel.deployment.DeploymentCategory;\n import org.apache.isis.core.metamodel.runtimecontext.RuntimeContext;\n import org.apache.isis.core.metamodel.services.ServicesInjectorDefault;\n+import org.apache.isis.core.metamodel.services.ServicesInjectorSpi;\n import org.apache.isis.core.metamodel.services.container.DomainObjectContainerDefault;\n import org.apache.isis.core.metamodel.spec.SpecificationLoaderSpi;\n import org.apache.isis.core.metamodel.specloader.InjectorMethodEvaluatorDefault;\n import org.apache.isis.core.runtime.persistence.adapter.PojoAdapter;\n-import org.apache.isis.core.runtime.persistence.adaptermanager.AdapterManagerDefault;\n import org.apache.isis.core.runtime.persistence.internal.RuntimeContextFromSession;\n import org.apache.isis.core.runtime.persistence.objectstore.transaction.CreateObjectCommand;\n import org.apache.isis.core.runtime.persistence.objectstore.transaction.DestroyObjectCommand;\n@@ -61,7 +63,6 @@\n     public JUnitRuleMockery2 context = JUnitRuleMockery2.createFor(Mode.INTERFACES_AND_CLASSES);\n \n     private ServicesInjectorDefault servicesInjector;\n-    private AdapterManagerDefault adapterManager;\n \n     \n     private PersistenceSession persistenceSession;\n@@ -94,17 +95,20 @@\n     @Mock\n     private RuntimeContext mockRuntimeContext;\n \n+    @Mock\n+    private ServicesInjectorSpi mockServicesInjector;\n+\n     @Mock\n     private IsisConfigurationDefault mockConfiguration;\n-    \n+\n+    @Mock\n+    private PersistenceManagerFactory mockPersistenceManager;\n+\n     @Mock\n     private MessageBroker mockMessageBroker;\n-    \n \n     private IsisMetaModel isisMetaModel;\n \n-\n-\n     public static class Customer {\n     }\n \n@@ -120,7 +124,7 @@ public void setUp() throws Exception {\n         context.ignoring(mockConfiguration);\n         context.ignoring(mockAuditingService3);\n \n-        isisMetaModel = new IsisMetaModel(mockRuntimeContext, new ProgrammingModelFacetsJava5(), new CustomerRepository());\n+        isisMetaModel = new IsisMetaModel(new ProgrammingModelFacetsJava5(), new CustomerRepository());\n         isisMetaModel.init();\n         \n         context.checking(new Expectations() {\n@@ -140,24 +144,25 @@ public void setUp() throws Exception {\n                 new RuntimeContextFromSession(\n                         DeploymentCategory.PRODUCTION,\n                         mockConfiguration,\n-                        servicesInjector);\n+                        servicesInjector,\n+                        mockSpecificationLoader);\n         final DomainObjectContainerDefault container = new DomainObjectContainerDefault();\n \n         runtimeContext.injectInto(container);\n \n         servicesInjector = new ServicesInjectorDefault(\n                 Collections.<Object>singletonList(container),new InjectorMethodEvaluatorDefault());\n \n-        persistenceSession = new PersistenceSession(mockPersistenceSessionFactory, mockConfiguration,\n-                mockSpecificationLoader, mockAuthenticationSession) {\n+        persistenceSession = new PersistenceSession(mockConfiguration, mockServicesInjector, mockSpecificationLoader,\n+                mockAuthenticationSession,\n+                mockPersistenceManager, mockPersistenceSessionFactory\n+        ) {\n             @Override\n             protected SpecificationLoaderSpi getSpecificationLoader() {\n                 return isisMetaModel.getSpecificationLoader();\n             }\n             \n         };\n-        adapterManager = new AdapterManagerDefault(persistenceSession\n-        );\n \n         context.checking(new Expectations(){{\n             allowing(mockAuthenticationSession).getUserName();",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/core/runtime/src/test/java/org/apache/isis/core/runtime/system/persistence/PersistenceSessionTest.java",
                "sha": "35a3dbe69efbde19734e1b70305db4f1d51694ca",
                "status": "modified"
            },
            {
                "additions": 3,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/example/application/simpleapp/dom/pom.xml",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/example/application/simpleapp/dom/pom.xml?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 0,
                "filename": "example/application/simpleapp/dom/pom.xml",
                "patch": "@@ -153,6 +153,7 @@\n                 </dependency>\n             </dependencies>\n         </profile>\n+\n         <profile>\n             <id>isis-validate</id>\n             <activation>\n@@ -165,6 +166,7 @@\n                         <artifactId>isis-maven-plugin</artifactId>\n                         <version>${isis.version}</version>\n                         <configuration>\n+                            <appManifest>domainapp.dom.DomainAppDomManifest</appManifest>\n                             <isisConfigDir>../webapp/src/main/webapp/WEB-INF</isisConfigDir>\n                         </configuration>\n                         <dependencies>\n@@ -195,6 +197,7 @@\n                 </plugins>\n             </build>\n         </profile>\n+\n     </profiles>\n \n </project>",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/example/application/simpleapp/dom/pom.xml",
                "sha": "c671ddecd88c7b686067e485ae34afdea1f78e28",
                "status": "modified"
            },
            {
                "additions": 92,
                "blob_url": "https://github.com/apache/isis/blob/a129fd2d5b3817d682aa128086d2cfa3a02854a3/example/application/simpleapp/dom/src/main/java/domainapp/dom/DomainAppDomManifest.java",
                "changes": 92,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/example/application/simpleapp/dom/src/main/java/domainapp/dom/DomainAppDomManifest.java?ref=a129fd2d5b3817d682aa128086d2cfa3a02854a3",
                "deletions": 0,
                "filename": "example/application/simpleapp/dom/src/main/java/domainapp/dom/DomainAppDomManifest.java",
                "patch": "@@ -0,0 +1,92 @@\n+/*\n+ *  Licensed to the Apache Software Foundation (ASF) under one\n+ *  or more contributor license agreements.  See the NOTICE file\n+ *  distributed with this work for additional information\n+ *  regarding copyright ownership.  The ASF licenses this file\n+ *  to you under the Apache License, Version 2.0 (the\n+ *  \"License\"); you may not use this file except in compliance\n+ *  with the License.  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package domainapp.dom;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.isis.applib.AppManifest;\n+import org.apache.isis.applib.fixturescripts.FixtureScript;\n+\n+/**\n+ * Bootstrap the application.\n+ */\n+public class DomainAppDomManifest implements AppManifest {\n+\n+    /**\n+     * Load all services and entities found in (the packages and subpackages within) these modules\n+     */\n+    @Override\n+    public List<Class<?>> getModules() {\n+        return Arrays.asList(\n+                DomainAppDomainModule.class  // domain (entities and repositories)\n+        );\n+    }\n+\n+    /**\n+     * No additional services.\n+     */\n+    @Override\n+    public List<Class<?>> getAdditionalServices() {\n+        return Collections.emptyList();\n+    }\n+\n+    /**\n+     * Use shiro for authentication.\n+     *\n+     * <p>\n+     *     NB: this is ignored for integration tests, which always use \"bypass\".\n+     * </p>\n+     */\n+    @Override\n+    public String getAuthenticationMechanism() {\n+        return \"shiro\";\n+    }\n+\n+    /**\n+     * Use shiro for authorization.\n+     *\n+     * <p>\n+     *     NB: this is ignored for integration tests, which always use \"bypass\".\n+     * </p>\n+     */\n+    @Override\n+    public String getAuthorizationMechanism() {\n+        return \"shiro\";\n+    }\n+\n+    /**\n+     * No fixtures.\n+     */\n+    @Override\n+    public List<Class<? extends FixtureScript>> getFixtures() {\n+        return Collections.emptyList();\n+    }\n+\n+    /**\n+     * No overrides.\n+     */\n+    @Override\n+    public Map<String, String> getConfigurationProperties() {\n+        return null;\n+    }\n+\n+}",
                "raw_url": "https://github.com/apache/isis/raw/a129fd2d5b3817d682aa128086d2cfa3a02854a3/example/application/simpleapp/dom/src/main/java/domainapp/dom/DomainAppDomManifest.java",
                "sha": "c32996f5f0aced4f9d601d925e5bea077ad770b5",
                "status": "added"
            }
        ],
        "message": "ISIS-1194: simplfying the bootstrap and wiring of components, in particular around PersistenceSessionFactory\n\nspecifically:\n- IsisSessionFactory\n  - now passed in the ServicesInjector (rather than obtaining it from the PersistenceSessionFactory)\n  - initialization of FixtureClock done in IsisSessionFactory rather than PersistenceSessionFactory\n- IsisSystem\n  - createSessionFactory(), changed the order in order to remove some bidir relationships\n  - in shutdownServices, avoid NPE if the serviceInitializer was never instantiated during init()\n- PersistenceSessionFactory\n- no longer implements MetaModelRefiner, instead moved out to separate class (PersistenceSessionFactoryMetamodelRefiner)\n    - this allows us to break the bidir between PersistenceSessionFactory and SpecificationLoader\n  - no longer requires a RuntimeContext\n  - no longer requires a ServicesInjector (is provided by IsisSessionFactory when #createPersistenceSession() is called to pass onto the created PersistenceSession)\n  - no longer implements SpecificationLoaderAware, nor requires a SpecificationLoader (is provided by IsisSessionFactory when #createPerisistenceSession is called)\n- similar changes to IsisMetaModel, in its constructor an init() method, to wire up components in the correct order\n- PersistenceSession\n  - no longer holds reference to PersistenceSessionFactory (though does only as FixturesInstallerFlag in order that PSF can continue to cache whether fixtures installed)\n  - is passed in the JDO PersistenceManagerFactory from Isis' PSF (rather than accessing the PSF's DataNucleusApplicationComponents, which is now wholly internal to PSF)\n  - is passed in the ServicesInjector directly (rather than obtain from Isis' PSF)\n- RuntimeContextAbstract\n  - now also passed in SpecificationLoader into its constructor (required reordering of IsisSessionFactory#init to be able to do this)\n  - thereby remove the whole SpecificationLookupDelegator contrivance\n- JavaReflectorHelper\n  - pass through deploymentType to ObjectReflectorDefault\n- ObjectReflectorDefault\n  - removal of isInjectorMethodFor, instead have callers instantiate the InjectorMethodEvaluatorDefault directly\n\nalso, to make caller hierarchy more useful::\n- changed ApplicationScopedComponent and SessionScopedComponent into marker interfaces\n- removed Injectable, pushed injectInto(Object) into subtypes\n\nalso:\n- enhanced IsisMojoAbstract and IsisMojoValidate (maven-isis-plugin)\n  - to accept an appManifest in the pom.xml\n  - use an AppManifest rather than MetaModel to bootstrap the system and validate\n- moved IsisComponentProviderDefault from core-integtest into core-runtime (renamed as ...Default2), so can be used by maven-isis-plugin\n\nalso:\n- deleted AdapterManagerDefault, no longer used",
        "parent": "https://github.com/apache/isis/commit/39771a14da83a397ab2d6654cda79b2f94332b42",
        "patched_files": [
            "IsisConfigurationBuilderResourceStreams.java",
            "IsisComponentProviderUsingInstallers.java",
            "JavaReflectorHelper.java",
            "PersistenceSession.java",
            "ServicesInjectorSpi.java",
            "ServicesInjectorDefault.java",
            "PersistenceSessionFactory.java",
            "IsisContext.java",
            "IsisComponentProviderDefault.java",
            "RemoveInjectMethodsFacetFactory.java",
            "RuntimeContextFromSession.java",
            "IsisMojoAbstract.java",
            "IsisSystem.java",
            "IsisContextThreadLocal.java",
            "IsisMetaModelBaseTest_constructDefaults.java",
            "IsisConfiguration.java",
            "IsisSessionFactory.java",
            "ObjectReflectorDefault.java",
            "InstallerLookup.java",
            "ObjectReflectorDefaultTestAbstract.java",
            "IsisComponentProvider.java",
            "pom.java",
            "DeploymentCategoryProvider.java",
            "LocalizationProvider.java",
            "TransactionStateProvider.java",
            "DataNucleusPersistenceMechanismInstaller.java",
            "PojoAdapter.java",
            "OidAdapterHashMap.java",
            "PojoAdapterHashMap.java",
            "PersistenceSessionFactoryMetamodelRefiner.java",
            "Injectable.java",
            "SpecificationLoaderDelegator.java",
            "SpecificationLoaderSpi.java",
            "IsisMetaModelTest_constructWithServices.java",
            "IsisMetaModel.java",
            "PersistenceSessionService.java",
            "IsisComponentProviderDefault2.java",
            "AdapterManager.java",
            "MessageBrokerService.java",
            "RuntimeContextAbstract.java",
            "RuntimeContext.java",
            "ConfigurationService.java",
            "IsisConfigurationBuilder.java",
            "AuthenticationSessionProvider.java",
            "JavaReflectorInstallerNoDecorators.java",
            "ProgrammableReflector.java",
            "AdapterManagerDefault.java",
            "DeploymentCategoryProviderAbstract.java",
            "IsisMojoValidate.java",
            "IsisMetaModelTest_getDomainObjectContainer.java",
            "DomainAppDomManifest.java",
            "RuntimeContextNoRuntime.java",
            "SpecificationLoader.java",
            "PersistenceMechanismInstaller.java",
            "IsisInjectModule.java",
            "RootAndCollectionAdapters.java",
            "SpecificationLoaderAbstract.java",
            "MetaModelProcessor.java",
            "package-info.java",
            "ObjectSpecificationStub.java",
            "ServicesInjector.java",
            "ObjectReflectorInstaller.java",
            "IsisMetaModelTest_init.java"
        ],
        "repo": "isis",
        "unit_tests": [
            "IsisContextTest.java",
            "PersistenceSessionTest.java",
            "PojoAdapterTest.java"
        ]
    },
    "isis_d3b8dec": {
        "bug_id": "isis_d3b8dec",
        "commit": "https://github.com/apache/isis/commit/d3b8deccb8cab77c6a358c56386dfa00544ee938",
        "file": [
            {
                "additions": 2,
                "blob_url": "https://github.com/apache/isis/blob/d3b8deccb8cab77c6a358c56386dfa00544ee938/core/applib/src/main/java/org/apache/isis/applib/services/exceprecog/ExceptionRecognizerComposite.java",
                "changes": 3,
                "contents_url": "https://api.github.com/repos/apache/isis/contents/core/applib/src/main/java/org/apache/isis/applib/services/exceprecog/ExceptionRecognizerComposite.java?ref=d3b8deccb8cab77c6a358c56386dfa00544ee938",
                "deletions": 1,
                "filename": "core/applib/src/main/java/org/apache/isis/applib/services/exceprecog/ExceptionRecognizerComposite.java",
                "patch": "@@ -117,7 +117,8 @@ public final Recognition recognize2(final Throwable ex) {\n     private void injectServicesIfNecessary() {\n         if(!injected) {\n             for (final ExceptionRecognizer ers : exceptionRecognizers) {\n-                container.injectServicesInto(ers);\n+                if (container != null)\n+                    container.injectServicesInto(ers);\n             }\n             injected = true;\n         }",
                "raw_url": "https://github.com/apache/isis/raw/d3b8deccb8cab77c6a358c56386dfa00544ee938/core/applib/src/main/java/org/apache/isis/applib/services/exceprecog/ExceptionRecognizerComposite.java",
                "sha": "9232744f1c8a4605da839fb79de7660192578774",
                "status": "modified"
            }
        ],
        "message": "ExceptionRecognizerComposite: NPE if container is null\n\nI have implemented ApplicationTenancy.\r\nWhen directly introducing the URL of an entity whose access is forbidden for me (i.e., http://localhost:8080/entity/KIT_:L_2) throws a NullPointerException.\r\nPerhaps the root cause is different.\r\nBut simply by evaluating if is null, it properly shows the error message (\"Not authorized or no such object\") instead of a HTTP 500 with a NullPointerException in the log.",
        "parent": "https://github.com/apache/isis/commit/dd1754e4facc65d9c0bf6a105d008662e0e79d7e",
        "patched_files": [
            "ExceptionRecognizerComposite.java"
        ],
        "repo": "isis",
        "unit_tests": [
            "ExceptionRecognizerCompositeTest.java"
        ]
    }
}