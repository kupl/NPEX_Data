<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>ClusterInfoProvider.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">pinot-tools</a> &gt; <a href="../index.html" class="el_bundle">pinot-controller</a> &gt; <a href="index.source.html" class="el_package">com.linkedin.pinot.controller.helix.core.minion</a> &gt; <span class="el_source">ClusterInfoProvider.java</span></div><h1>ClusterInfoProvider.java</h1><pre class="source lang-java linenums">/**
 * Copyright (C) 2014-2016 LinkedIn Corp. (pinot-core@linkedin.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.linkedin.pinot.controller.helix.core.minion;

import com.google.common.base.Preconditions;
import com.linkedin.pinot.common.config.PinotTaskConfig;
import com.linkedin.pinot.common.config.TableConfig;
import com.linkedin.pinot.common.config.TableNameBuilder;
import com.linkedin.pinot.common.data.Schema;
import com.linkedin.pinot.common.metadata.ZKMetadataProvider;
import com.linkedin.pinot.common.metadata.segment.OfflineSegmentZKMetadata;
import com.linkedin.pinot.common.metadata.segment.RealtimeSegmentZKMetadata;
import com.linkedin.pinot.controller.ControllerConf;
import com.linkedin.pinot.controller.helix.core.PinotHelixResourceManager;
import com.linkedin.pinot.controller.helix.core.minion.generator.PinotTaskGenerator;
import java.util.List;
import java.util.Map;
import javax.annotation.Nonnull;
import javax.annotation.Nullable;
import org.apache.helix.task.TaskState;


/**
 * The class &lt;code&gt;ClusterInfoProvider&lt;/code&gt; is an abstraction on top of {@link PinotHelixResourceManager} and
 * {@link PinotHelixTaskResourceManager} which provides cluster information for {@link PinotTaskGenerator}.
 */
public class ClusterInfoProvider {
  private final PinotHelixResourceManager _pinotHelixResourceManager;
  private final PinotHelixTaskResourceManager _pinotHelixTaskResourceManager;
  private final ControllerConf _controllerConf;

  public ClusterInfoProvider(@Nonnull PinotHelixResourceManager pinotHelixResourceManager,
<span class="fc" id="L46">      @Nonnull PinotHelixTaskResourceManager pinotHelixTaskResourceManager, @Nonnull ControllerConf controllerConf) {</span>
<span class="fc" id="L47">    _pinotHelixResourceManager = pinotHelixResourceManager;</span>
<span class="fc" id="L48">    _pinotHelixTaskResourceManager = pinotHelixTaskResourceManager;</span>
<span class="fc" id="L49">    _controllerConf = controllerConf;</span>
<span class="fc" id="L50">  }</span>

  /**
   * Get the table config for the given table name with type suffix.
   *
   * @param tableNameWithType Table name with type suffix
   * @return Table config
   */
  @Nullable
  public TableConfig getTableConfig(@Nonnull String tableNameWithType) {
<span class="nc" id="L60">    return _pinotHelixResourceManager.getTableConfig(tableNameWithType);</span>
  }

  /**
   * Get the table schema for the given table name with or without type suffix.
   *
   * @param tableName Table name with or without type suffix
   * @return Table schema
   */
  @Nullable
  public Schema getTableSchema(@Nonnull String tableName) {
<span class="nc" id="L71">    return _pinotHelixResourceManager.getTableSchema(tableName);</span>
  }

  /**
   * Get all segments' metadata for the given OFFLINE table name.
   *
   * @param offlineTableName Offline table name
   * @return List of segments' metadata
   */
  @Nonnull
  public List&lt;OfflineSegmentZKMetadata&gt; getOfflineSegmentsMetadata(@Nonnull String offlineTableName) {
<span class="nc" id="L82">    Preconditions.checkArgument(TableNameBuilder.OFFLINE.tableHasTypeSuffix(offlineTableName));</span>
<span class="nc" id="L83">    return ZKMetadataProvider.getOfflineSegmentZKMetadataListForTable(_pinotHelixResourceManager.getPropertyStore(),</span>
        offlineTableName);
  }

  /**
   * Get all segments' metadata for the given REALTIME table name.
   *
   * @param realtimeTableName Realtime table name
   * @return List of segments' metadata
   */
  @Nonnull
  public List&lt;RealtimeSegmentZKMetadata&gt; getRealtimeSegmentsMetadata(@Nonnull String realtimeTableName) {
<span class="nc" id="L95">    Preconditions.checkArgument(TableNameBuilder.REALTIME.tableHasTypeSuffix(realtimeTableName));</span>
<span class="nc" id="L96">    return ZKMetadataProvider.getRealtimeSegmentZKMetadataListForTable(_pinotHelixResourceManager.getPropertyStore(),</span>
        realtimeTableName);
  }

  /**
   * Get all tasks' state for the given task type.
   *
   * @param taskType Task type
   * @return Map from task name to task state
   */
  @Nonnull
  public Map&lt;String, TaskState&gt; getTaskStates(@Nonnull String taskType) {
<span class="nc" id="L108">    return _pinotHelixTaskResourceManager.getTaskStates(taskType);</span>
  }

  /**
   * Get the child task configs for the given task name.
   *
   * @param taskName Task name
   * @return List of child task configs
   */
  @Nonnull
  public List&lt;PinotTaskConfig&gt; getTaskConfigs(@Nonnull String taskName) {
<span class="nc" id="L119">    return _pinotHelixTaskResourceManager.getTaskConfigs(taskName);</span>
  }

  /**
   * Get the VIP URL for the controllers.
   *
   * @return VIP URL
   */
  @Nonnull
  public String getVipUrl() {
<span class="nc" id="L129">    return _controllerConf.generateVipUrl();</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>