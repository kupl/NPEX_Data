<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>PinotDataType.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">pinot-tools</a> &gt; <a href="../index.html" class="el_bundle">pinot-core</a> &gt; <a href="index.source.html" class="el_package">com.linkedin.pinot.core.data.extractors</a> &gt; <span class="el_source">PinotDataType.java</span></div><h1>PinotDataType.java</h1><pre class="source lang-java linenums">/**
 * Copyright (C) 2014-2016 LinkedIn Corp. (pinot-core@linkedin.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.linkedin.pinot.core.data.extractors;

import com.google.common.base.Preconditions;
import com.linkedin.pinot.common.data.FieldSpec;


/**
 *  The &lt;code&gt;PinotDataType&lt;/code&gt; enum represents the data type of a value in a row from recordReader and provides
 *  utility methods to convert value across types if applicable.
 *  &lt;p&gt;
 *  We don't use &lt;code&gt;PinotDataType&lt;/code&gt; to maintain type information, but use it to help organize the data and use
 *  {@link com.linkedin.pinot.common.data.FieldSpec.DataType} to maintain type information separately across
 *  various readers.
 *  &lt;p&gt;NOTE:
 *  &lt;p&gt;- a. we will silently lose information if a conversion causes us to do so (e.g. Integer to Byte).
 *  &lt;p&gt;- b. We will throw exceptions if a conversion is not possible (e.g. Boolean to Byte).
 *  &lt;p&gt;- c. we will throw exceptions if the conversion throw exceptions (e.g. String -&gt; Short, where parsing string
 *  throw exceptions)
 */
<span class="pc" id="L35">public enum PinotDataType {</span>
<span class="fc" id="L36">  BOOLEAN {</span>
    @Override
    public Boolean toBoolean(Object value) {
<span class="nc" id="L39">      return (Boolean) value;</span>
    }

    @Override
    public Byte toByte(Object value) {
<span class="nc" id="L44">      throw new UnsupportedOperationException(&quot;Cannot convert value: &quot; + value + &quot; from: BOOLEAN to: BYTE&quot;);</span>
    }

    @Override
    public Character toCharacter(Object value) {
<span class="nc" id="L49">      throw new UnsupportedOperationException(&quot;Cannot convert value: &quot; + value + &quot; from: BOOLEAN to: CHARACTER&quot;);</span>
    }

    @Override
    public Short toShort(Object value) {
<span class="nc" id="L54">      throw new UnsupportedOperationException(&quot;Cannot convert value: &quot; + value + &quot; from: BOOLEAN to: SHORT&quot;);</span>
    }

    @Override
    public Integer toInteger(Object value) {
<span class="fc" id="L59">      throw new UnsupportedOperationException(&quot;Cannot convert value: &quot; + value + &quot; from: BOOLEAN to: INTEGER&quot;);</span>
    }

    @Override
    public Long toLong(Object value) {
<span class="fc" id="L64">      throw new UnsupportedOperationException(&quot;Cannot convert value: &quot; + value + &quot; from: BOOLEAN to: LONG&quot;);</span>
    }

    @Override
    public Float toFloat(Object value) {
<span class="fc" id="L69">      throw new UnsupportedOperationException(&quot;Cannot convert value: &quot; + value + &quot; from: BOOLEAN to: FLOAT&quot;);</span>
    }

    @Override
    public Double toDouble(Object value) {
<span class="fc" id="L74">      throw new UnsupportedOperationException(&quot;Cannot convert value: &quot; + value + &quot; from: BOOLEAN to: DOUBLE&quot;);</span>
    }

    @Override
    public Boolean convert(Object value, PinotDataType sourceType) {
<span class="nc" id="L79">      return sourceType.toBoolean(value);</span>
    }
  },

<span class="fc" id="L83">  BYTE {</span>
    @Override
    public Byte toByte(Object value) {
<span class="nc" id="L86">      return (Byte) value;</span>
    }

    @Override
    public Character toCharacter(Object value) {
<span class="nc" id="L91">      return (char) ((Byte) value).shortValue();</span>
    }

    @Override
    public Short toShort(Object value) {
<span class="nc" id="L96">      return ((Byte) value).shortValue();</span>
    }

    @Override
    public Integer toInteger(Object value) {
<span class="fc" id="L101">      return ((Byte) value).intValue();</span>
    }

    @Override
    public Long toLong(Object value) {
<span class="fc" id="L106">      return ((Byte) value).longValue();</span>
    }

    @Override
    public Float toFloat(Object value) {
<span class="fc" id="L111">      return ((Byte) value).floatValue();</span>
    }

    @Override
    public Double toDouble(Object value) {
<span class="fc" id="L116">      return ((Byte) value).doubleValue();</span>
    }

    @Override
    public Byte convert(Object value, PinotDataType sourceType) {
<span class="nc" id="L121">      return sourceType.toByte(value);</span>
    }
  },

<span class="fc" id="L125">  CHARACTER {</span>
    @Override
    public Byte toByte(Object value) {
<span class="nc" id="L128">      return (byte) ((Character) value).charValue();</span>
    }

    @Override
    public Character toCharacter(Object value) {
<span class="nc" id="L133">      return (Character) value;</span>
    }

    @Override
    public Short toShort(Object value) {
<span class="nc" id="L138">      return (short) ((Character) value).charValue();</span>
    }

    @Override
    public Integer toInteger(Object value) {
<span class="fc" id="L143">      return (int) ((Character) value);</span>
    }

    @Override
    public Long toLong(Object value) {
<span class="fc" id="L148">      return (long) ((Character) value);</span>
    }

    @Override
    public Float toFloat(Object value) {
<span class="fc" id="L153">      return (float) ((Character) value);</span>
    }

    @Override
    public Double toDouble(Object value) {
<span class="fc" id="L158">      return (double) ((Character) value);</span>
    }

    @Override
    public Character convert(Object value, PinotDataType sourceType) {
<span class="nc" id="L163">      return sourceType.toCharacter(value);</span>
    }
  },

<span class="fc" id="L167">  SHORT {</span>
    @Override
    public Byte toByte(Object value) {
<span class="nc" id="L170">      return ((Short) value).byteValue();</span>
    }

    @Override
    public Character toCharacter(Object value) {
<span class="nc" id="L175">      return (char) ((Short) value).shortValue();</span>
    }

    @Override
    public Short toShort(Object value) {
<span class="nc" id="L180">      return (Short) value;</span>
    }

    @Override
    public Integer toInteger(Object value) {
<span class="fc" id="L185">      return ((Short) value).intValue();</span>
    }

    @Override
    public Long toLong(Object value) {
<span class="fc" id="L190">      return ((Short) value).longValue();</span>
    }

    @Override
    public Float toFloat(Object value) {
<span class="fc" id="L195">      return ((Short) value).floatValue();</span>
    }

    @Override
    public Double toDouble(Object value) {
<span class="fc" id="L200">      return ((Short) value).doubleValue();</span>
    }

    @Override
    public Short convert(Object value, PinotDataType sourceType) {
<span class="nc" id="L205">      return sourceType.toShort(value);</span>
    }
  },

<span class="fc" id="L209">  INTEGER {</span>
    @Override
    public Byte toByte(Object value) {
<span class="nc" id="L212">      return ((Integer) value).byteValue();</span>
    }

    @Override
    public Character toCharacter(Object value) {
<span class="nc" id="L217">      return (char) ((Integer) value).shortValue();</span>
    }

    @Override
    public Short toShort(Object value) {
<span class="nc" id="L222">      return ((Integer) value).shortValue();</span>
    }

    @Override
    public Integer toInteger(Object value) {
<span class="fc" id="L227">      return (Integer) value;</span>
    }

    @Override
    public Long toLong(Object value) {
<span class="fc" id="L232">      return ((Integer) value).longValue();</span>
    }

    @Override
    public Float toFloat(Object value) {
<span class="fc" id="L237">      return ((Integer) value).floatValue();</span>
    }

    @Override
    public Double toDouble(Object value) {
<span class="fc" id="L242">      return ((Integer) value).doubleValue();</span>
    }

    @Override
    public Integer convert(Object value, PinotDataType sourceType) {
<span class="fc" id="L247">      return sourceType.toInteger(value);</span>
    }
  },

<span class="fc" id="L251">  LONG {</span>
    @Override
    public Byte toByte(Object value) {
<span class="nc" id="L254">      return ((Long) value).byteValue();</span>
    }

    @Override
    public Character toCharacter(Object value) {
<span class="nc" id="L259">      return (char) ((Long) value).shortValue();</span>
    }

    @Override
    public Short toShort(Object value) {
<span class="nc" id="L264">      return ((Long) value).shortValue();</span>
    }

    @Override
    public Integer toInteger(Object value) {
<span class="fc" id="L269">      return ((Long) value).intValue();</span>
    }

    @Override
    public Long toLong(Object value) {
<span class="fc" id="L274">      return (Long) value;</span>
    }

    @Override
    public Float toFloat(Object value) {
<span class="fc" id="L279">      return ((Long) value).floatValue();</span>
    }

    @Override
    public Double toDouble(Object value) {
<span class="fc" id="L284">      return ((Long) value).doubleValue();</span>
    }

    @Override
    public Long convert(Object value, PinotDataType sourceType) {
<span class="fc" id="L289">      return sourceType.toLong(value);</span>
    }
  },

<span class="fc" id="L293">  FLOAT {</span>
    @Override
    public Byte toByte(Object value) {
<span class="nc" id="L296">      return ((Float) value).byteValue();</span>
    }

    @Override
    public Character toCharacter(Object value) {
<span class="nc" id="L301">      return (char) ((Float) value).shortValue();</span>
    }

    @Override
    public Short toShort(Object value) {
<span class="nc" id="L306">      return ((Float) value).shortValue();</span>
    }

    @Override
    public Integer toInteger(Object value) {
<span class="fc" id="L311">      return ((Float) value).intValue();</span>
    }

    @Override
    public Long toLong(Object value) {
<span class="fc" id="L316">      return ((Float) value).longValue();</span>
    }

    @Override
    public Float toFloat(Object value) {
<span class="fc" id="L321">      return (Float) value;</span>
    }

    @Override
    public Double toDouble(Object value) {
<span class="fc" id="L326">      return ((Float) value).doubleValue();</span>
    }

    @Override
    public Float convert(Object value, PinotDataType sourceType) {
<span class="fc" id="L331">      return sourceType.toFloat(value);</span>
    }
  },

<span class="fc" id="L335">  DOUBLE {</span>
    @Override
    public Byte toByte(Object value) {
<span class="nc" id="L338">      return ((Double) value).byteValue();</span>
    }

    @Override
    public Character toCharacter(Object value) {
<span class="nc" id="L343">      return (char) ((Double) value).shortValue();</span>
    }

    @Override
    public Short toShort(Object value) {
<span class="nc" id="L348">      return ((Double) value).shortValue();</span>
    }

    @Override
    public Integer toInteger(Object value) {
<span class="fc" id="L353">      return ((Double) value).intValue();</span>
    }

    @Override
    public Long toLong(Object value) {
<span class="fc" id="L358">      return ((Double) value).longValue();</span>
    }

    @Override
    public Float toFloat(Object value) {
<span class="fc" id="L363">      return ((Double) value).floatValue();</span>
    }

    @Override
    public Double toDouble(Object value) {
<span class="fc" id="L368">      return (Double) value;</span>
    }

    @Override
    public Double convert(Object value, PinotDataType sourceType) {
<span class="fc" id="L373">      return sourceType.toDouble(value);</span>
    }
  },

<span class="fc" id="L377">  STRING {</span>
    @Override
    public Boolean toBoolean(Object value) {
<span class="nc" id="L380">      return Boolean.parseBoolean((String) value);</span>
    }

    @Override
    public Byte toByte(Object value) {
<span class="nc" id="L385">      return Byte.parseByte((String) value);</span>
    }

    @Override
    public Character toCharacter(Object value) {
<span class="nc" id="L390">      return ((String) value).charAt(0);</span>
    }

    @Override
    public Short toShort(Object value) {
<span class="nc" id="L395">      return Short.parseShort((String) value);</span>
    }

    @Override
    public Integer toInteger(Object value) {
<span class="fc" id="L400">      return Integer.parseInt((String) value);</span>
    }

    @Override
    public Long toLong(Object value) {
<span class="fc" id="L405">      return Long.parseLong((String) value);</span>
    }

    @Override
    public Float toFloat(Object value) {
<span class="fc" id="L410">      return Float.parseFloat((String) value);</span>
    }

    @Override
    public Double toDouble(Object value) {
<span class="fc" id="L415">      return Double.parseDouble((String) value);</span>
    }

    @Override
    public String convert(Object value, PinotDataType sourceType) {
<span class="fc" id="L420">      return sourceType.toString(value);</span>
    }
  },

<span class="fc" id="L424">  OBJECT {</span>
    @Override
    public Byte toByte(Object value) {
<span class="nc" id="L427">      throw new UnsupportedOperationException(&quot;Cannot convert value: &quot; + value + &quot; from: OBJECT to: BYTE&quot;);</span>
    }

    @Override
    public Character toCharacter(Object value) {
<span class="nc" id="L432">      throw new UnsupportedOperationException(&quot;Cannot convert value: &quot; + value + &quot; from: OBJECT to: CHARACTER&quot;);</span>
    }

    @Override
    public Short toShort(Object value) {
<span class="nc" id="L437">      throw new UnsupportedOperationException(&quot;Cannot convert value: &quot; + value + &quot; from: OBJECT to: SHORT&quot;);</span>
    }

    @Override
    public Integer toInteger(Object value) {
<span class="fc" id="L442">      throw new UnsupportedOperationException(&quot;Cannot convert value: &quot; + value + &quot; from: OBJECT to: INTEGER&quot;);</span>
    }

    @Override
    public Long toLong(Object value) {
<span class="fc" id="L447">      throw new UnsupportedOperationException(&quot;Cannot convert value: &quot; + value + &quot; from: OBJECT to: LONG&quot;);</span>
    }

    @Override
    public Float toFloat(Object value) {
<span class="fc" id="L452">      throw new UnsupportedOperationException(&quot;Cannot convert value: &quot; + value + &quot; from: OBJECT to: FLOAT&quot;);</span>
    }

    @Override
    public Double toDouble(Object value) {
<span class="fc" id="L457">      throw new UnsupportedOperationException(&quot;Cannot convert value: &quot; + value + &quot; from: OBJECT to: DOUBLE&quot;);</span>
    }

    @Override
    public Object convert(Object value, PinotDataType sourceType) {
<span class="nc" id="L462">      throw new UnsupportedOperationException(&quot;Cannot convert value: &quot; + value + &quot;from: &quot; + sourceType + &quot; to: OBJECT&quot;);</span>
    }
  },

<span class="fc" id="L466">  BYTE_ARRAY {</span>
    @Override
    public Byte[] convert(Object value, PinotDataType sourceType) {
<span class="nc" id="L469">      return sourceType.toByteArray(value);</span>
    }
  },

<span class="fc" id="L473">  CHARACTER_ARRAY {</span>
    @Override
    public Character[] convert(Object value, PinotDataType sourceType) {
<span class="nc" id="L476">      return sourceType.toCharacterArray(value);</span>
    }
  },

<span class="fc" id="L480">  SHORT_ARRAY {</span>
    @Override
    public Short[] convert(Object value, PinotDataType sourceType) {
<span class="nc" id="L483">      return sourceType.toShortArray(value);</span>
    }
  },

<span class="fc" id="L487">  INTEGER_ARRAY {</span>
    @Override
    public Integer[] convert(Object value, PinotDataType sourceType) {
<span class="fc" id="L490">      return sourceType.toIntegerArray(value);</span>
    }
  },

<span class="fc" id="L494">  LONG_ARRAY {</span>
    @Override
    public Long[] convert(Object value, PinotDataType sourceType) {
<span class="fc" id="L497">      return sourceType.toLongArray(value);</span>
    }
  },

<span class="fc" id="L501">  FLOAT_ARRAY {</span>
    @Override
    public Float[] convert(Object value, PinotDataType sourceType) {
<span class="fc" id="L504">      return sourceType.toFloatArray(value);</span>
    }
  },

<span class="fc" id="L508">  DOUBLE_ARRAY {</span>
    @Override
    public Double[] convert(Object value, PinotDataType sourceType) {
<span class="fc" id="L511">      return sourceType.toDoubleArray(value);</span>
    }
  },

<span class="fc" id="L515">  STRING_ARRAY {</span>
    @Override
    public Boolean toBoolean(Object value) {
<span class="nc" id="L518">      return STRING.toBoolean(((Object[]) value)[0]);</span>
    }

    @Override
    public String[] convert(Object value, PinotDataType sourceType) {
<span class="fc" id="L523">      return sourceType.toStringArray(value);</span>
    }
  },

<span class="fc" id="L527">  OBJECT_ARRAY {</span>
    @Override
    public Object[] convert(Object value, PinotDataType sourceType) {
<span class="nc" id="L530">      throw new UnsupportedOperationException(</span>
          &quot;Cannot convert value: &quot; + value + &quot;from: &quot; + sourceType + &quot; to: OBJECT_ARRAY&quot;);
    }
  };

  public Boolean toBoolean(Object value) {
<span class="nc" id="L536">    throw new UnsupportedOperationException(&quot;Cannot convert value: &quot; + value + &quot; from: &quot; + this + &quot; to: BOOLEAN&quot;);</span>
  }

  public Byte toByte(Object value) {
<span class="nc" id="L540">    return getSingleValueType().toByte(((Object[]) value)[0]);</span>
  }

  public Character toCharacter(Object value) {
<span class="nc" id="L544">    return getSingleValueType().toCharacter(((Object[]) value)[0]);</span>
  }

  public Short toShort(Object value) {
<span class="nc" id="L548">    return getSingleValueType().toShort(((Object[]) value)[0]);</span>
  }

  public Integer toInteger(Object value) {
<span class="fc" id="L552">    return getSingleValueType().toInteger(((Object[]) value)[0]);</span>
  }

  public Long toLong(Object value) {
<span class="fc" id="L556">    return getSingleValueType().toLong(((Object[]) value)[0]);</span>
  }

  public Float toFloat(Object value) {
<span class="fc" id="L560">    return getSingleValueType().toFloat(((Object[]) value)[0]);</span>
  }

  public Double toDouble(Object value) {
<span class="fc" id="L564">    return getSingleValueType().toDouble(((Object[]) value)[0]);</span>
  }

  public String toString(Object value) {
<span class="fc bfc" id="L568" title="All 2 branches covered.">    if (isSingleValue()) {</span>
<span class="fc" id="L569">      return value.toString();</span>
    } else {
<span class="fc" id="L571">      return ((Object[]) value)[0].toString();</span>
    }
  }

  public Byte[] toByteArray(Object value) {
<span class="nc bnc" id="L576" title="All 2 branches missed.">    if (isSingleValue()) {</span>
<span class="nc" id="L577">      return new Byte[]{toByte(value)};</span>
    } else {
<span class="nc" id="L579">      Object[] valueArray = (Object[]) value;</span>
<span class="nc" id="L580">      int length = valueArray.length;</span>
<span class="nc" id="L581">      Byte[] byteArray = new Byte[length];</span>
<span class="nc" id="L582">      PinotDataType singleValueType = getSingleValueType();</span>
<span class="nc bnc" id="L583" title="All 2 branches missed.">      for (int i = 0; i &lt; length; i++) {</span>
<span class="nc" id="L584">        byteArray[i] = singleValueType.toByte(valueArray[i]);</span>
      }
<span class="nc" id="L586">      return byteArray;</span>
    }
  }

  public Character[] toCharacterArray(Object value) {
<span class="nc bnc" id="L591" title="All 2 branches missed.">    if (isSingleValue()) {</span>
<span class="nc" id="L592">      return new Character[]{toCharacter(value)};</span>
    } else {
<span class="nc" id="L594">      Object[] valueArray = (Object[]) value;</span>
<span class="nc" id="L595">      int length = valueArray.length;</span>
<span class="nc" id="L596">      Character[] characterArray = new Character[length];</span>
<span class="nc" id="L597">      PinotDataType singleValueType = getSingleValueType();</span>
<span class="nc bnc" id="L598" title="All 2 branches missed.">      for (int i = 0; i &lt; length; i++) {</span>
<span class="nc" id="L599">        characterArray[i] = singleValueType.toCharacter(valueArray[i]);</span>
      }
<span class="nc" id="L601">      return characterArray;</span>
    }
  }

  public Short[] toShortArray(Object value) {
<span class="nc bnc" id="L606" title="All 2 branches missed.">    if (isSingleValue()) {</span>
<span class="nc" id="L607">      return new Short[]{toShort(value)};</span>
    } else {
<span class="nc" id="L609">      Object[] valueArray = (Object[]) value;</span>
<span class="nc" id="L610">      int length = valueArray.length;</span>
<span class="nc" id="L611">      Short[] shortArray = new Short[length];</span>
<span class="nc" id="L612">      PinotDataType singleValueType = getSingleValueType();</span>
<span class="nc bnc" id="L613" title="All 2 branches missed.">      for (int i = 0; i &lt; length; i++) {</span>
<span class="nc" id="L614">        shortArray[i] = singleValueType.toShort(valueArray[i]);</span>
      }
<span class="nc" id="L616">      return shortArray;</span>
    }
  }

  public Integer[] toIntegerArray(Object value) {
<span class="fc bfc" id="L621" title="All 2 branches covered.">    if (isSingleValue()) {</span>
<span class="fc" id="L622">      return new Integer[]{toInteger(value)};</span>
    } else {
<span class="fc" id="L624">      Object[] valueArray = (Object[]) value;</span>
<span class="fc" id="L625">      int length = valueArray.length;</span>
<span class="fc" id="L626">      Integer[] integerArray = new Integer[length];</span>
<span class="fc" id="L627">      PinotDataType singleValueType = getSingleValueType();</span>
<span class="fc bfc" id="L628" title="All 2 branches covered.">      for (int i = 0; i &lt; length; i++) {</span>
<span class="fc" id="L629">        integerArray[i] = singleValueType.toInteger(valueArray[i]);</span>
      }
<span class="fc" id="L631">      return integerArray;</span>
    }
  }

  public Long[] toLongArray(Object value) {
<span class="fc bfc" id="L636" title="All 2 branches covered.">    if (isSingleValue()) {</span>
<span class="fc" id="L637">      return new Long[]{toLong(value)};</span>
    } else {
<span class="fc" id="L639">      Object[] valueArray = (Object[]) value;</span>
<span class="fc" id="L640">      int length = valueArray.length;</span>
<span class="fc" id="L641">      Long[] longArray = new Long[length];</span>
<span class="fc" id="L642">      PinotDataType singleValueType = getSingleValueType();</span>
<span class="fc bfc" id="L643" title="All 2 branches covered.">      for (int i = 0; i &lt; length; i++) {</span>
<span class="fc" id="L644">        longArray[i] = singleValueType.toLong(valueArray[i]);</span>
      }
<span class="fc" id="L646">      return longArray;</span>
    }
  }

  public Float[] toFloatArray(Object value) {
<span class="fc bfc" id="L651" title="All 2 branches covered.">    if (isSingleValue()) {</span>
<span class="fc" id="L652">      return new Float[]{toFloat(value)};</span>
    } else {
<span class="fc" id="L654">      Object[] valueArray = (Object[]) value;</span>
<span class="fc" id="L655">      int length = valueArray.length;</span>
<span class="fc" id="L656">      Float[] floatArray = new Float[length];</span>
<span class="fc" id="L657">      PinotDataType singleValueType = getSingleValueType();</span>
<span class="fc bfc" id="L658" title="All 2 branches covered.">      for (int i = 0; i &lt; length; i++) {</span>
<span class="fc" id="L659">        floatArray[i] = singleValueType.toFloat(valueArray[i]);</span>
      }
<span class="fc" id="L661">      return floatArray;</span>
    }
  }

  public Double[] toDoubleArray(Object value) {
<span class="fc bfc" id="L666" title="All 2 branches covered.">    if (isSingleValue()) {</span>
<span class="fc" id="L667">      return new Double[]{toDouble(value)};</span>
    } else {
<span class="fc" id="L669">      Object[] valueArray = (Object[]) value;</span>
<span class="fc" id="L670">      int length = valueArray.length;</span>
<span class="fc" id="L671">      Double[] doubleArray = new Double[length];</span>
<span class="fc" id="L672">      PinotDataType singleValueType = getSingleValueType();</span>
<span class="fc bfc" id="L673" title="All 2 branches covered.">      for (int i = 0; i &lt; length; i++) {</span>
<span class="fc" id="L674">        doubleArray[i] = singleValueType.toDouble(valueArray[i]);</span>
      }
<span class="fc" id="L676">      return doubleArray;</span>
    }
  }

  public String[] toStringArray(Object value) {
<span class="fc bfc" id="L681" title="All 2 branches covered.">    if (isSingleValue()) {</span>
<span class="fc" id="L682">      return new String[]{toString(value)};</span>
    } else {
<span class="fc" id="L684">      Object[] valueArray = (Object[]) value;</span>
<span class="fc" id="L685">      int length = valueArray.length;</span>
<span class="fc" id="L686">      String[] stringArray = new String[length];</span>
<span class="fc" id="L687">      PinotDataType singleValueType = getSingleValueType();</span>
<span class="fc bfc" id="L688" title="All 2 branches covered.">      for (int i = 0; i &lt; length; i++) {</span>
<span class="fc" id="L689">        stringArray[i] = singleValueType.toString(valueArray[i]);</span>
      }
<span class="fc" id="L691">      return stringArray;</span>
    }
  }

  public abstract Object convert(Object value, PinotDataType sourceType);

  public boolean isSingleValue() {
<span class="fc bfc" id="L698" title="All 2 branches covered.">    return this.ordinal() &lt; BYTE_ARRAY.ordinal();</span>
  }

  public PinotDataType getSingleValueType() {
<span class="pc bpc" id="L702" title="1 of 10 branches missed.">    switch (this) {</span>
      case BYTE_ARRAY:
<span class="fc" id="L704">        return BYTE;</span>
      case CHARACTER_ARRAY:
<span class="fc" id="L706">        return CHARACTER;</span>
      case SHORT_ARRAY:
<span class="fc" id="L708">        return SHORT;</span>
      case INTEGER_ARRAY:
<span class="fc" id="L710">        return INTEGER;</span>
      case LONG_ARRAY:
<span class="fc" id="L712">        return LONG;</span>
      case FLOAT_ARRAY:
<span class="fc" id="L714">        return FLOAT;</span>
      case DOUBLE_ARRAY:
<span class="fc" id="L716">        return DOUBLE;</span>
      case STRING_ARRAY:
<span class="fc" id="L718">        return STRING;</span>
      case OBJECT_ARRAY:
<span class="fc" id="L720">        return OBJECT;</span>
      default:
<span class="pc" id="L722">        throw new UnsupportedOperationException(&quot;Cannot get single-value type for: &quot; + this);</span>
    }
  }

  public static PinotDataType getPinotDataType(FieldSpec fieldSpec) {
<span class="fc" id="L727">    FieldSpec.DataType dataType = fieldSpec.getDataType();</span>
<span class="pc bpc" id="L728" title="5 of 10 branches missed.">    switch (dataType) {</span>
      case BOOLEAN:
<span class="nc" id="L730">        Preconditions.checkArgument(fieldSpec.isSingleValueField());</span>
<span class="nc" id="L731">        return PinotDataType.BOOLEAN;</span>
      case BYTE:
<span class="nc bnc" id="L733" title="All 2 branches missed.">        return fieldSpec.isSingleValueField() ? PinotDataType.BYTE : PinotDataType.BYTE_ARRAY;</span>
      case CHAR:
<span class="nc bnc" id="L735" title="All 2 branches missed.">        return fieldSpec.isSingleValueField() ? PinotDataType.CHARACTER : PinotDataType.CHARACTER_ARRAY;</span>
      case SHORT:
<span class="nc bnc" id="L737" title="All 2 branches missed.">        return fieldSpec.isSingleValueField() ? PinotDataType.SHORT : PinotDataType.SHORT_ARRAY;</span>
      case INT:
<span class="fc bfc" id="L739" title="All 2 branches covered.">        return fieldSpec.isSingleValueField() ? PinotDataType.INTEGER : PinotDataType.INTEGER_ARRAY;</span>
      case LONG:
<span class="fc bfc" id="L741" title="All 2 branches covered.">        return fieldSpec.isSingleValueField() ? PinotDataType.LONG : PinotDataType.LONG_ARRAY;</span>
      case FLOAT:
<span class="fc bfc" id="L743" title="All 2 branches covered.">        return fieldSpec.isSingleValueField() ? PinotDataType.FLOAT : PinotDataType.FLOAT_ARRAY;</span>
      case DOUBLE:
<span class="fc bfc" id="L745" title="All 2 branches covered.">        return fieldSpec.isSingleValueField() ? PinotDataType.DOUBLE : PinotDataType.DOUBLE_ARRAY;</span>
      case STRING:
<span class="fc bfc" id="L747" title="All 2 branches covered.">        return fieldSpec.isSingleValueField() ? PinotDataType.STRING : PinotDataType.STRING_ARRAY;</span>
      default:
<span class="nc" id="L749">        throw new UnsupportedOperationException(</span>
            &quot;Unsupported data type: &quot; + dataType + &quot; in field: &quot; + fieldSpec.getName());
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>