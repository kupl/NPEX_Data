<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>JSONUtil.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">pinot-distribution</a> &gt; <a href="../index.html" class="el_bundle">pinot-common</a> &gt; <a href="index.source.html" class="el_package">com.linkedin.pinot.pql.parsers.utils</a> &gt; <span class="el_source">JSONUtil.java</span></div><h1>JSONUtil.java</h1><pre class="source lang-java linenums">/**
 * Copyright (C) 2014-2016 LinkedIn Corp. (pinot-core@linkedin.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.linkedin.pinot.pql.parsers.utils;

import java.lang.reflect.Array;
import java.util.Collection;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.TreeSet;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.parser.ParserConfig;
import com.alibaba.fastjson.util.FieldInfo;
import com.alibaba.fastjson.util.TypeUtils;


<span class="nc" id="L35">public class JSONUtil {</span>
  public static class FastJSONObject extends JSONObject {
    private com.alibaba.fastjson.JSONObject _inner;

<span class="nc" id="L39">    public FastJSONObject() {</span>
<span class="nc" id="L40">      _inner = new com.alibaba.fastjson.JSONObject();</span>
<span class="nc" id="L41">    }</span>

<span class="nc" id="L43">    public FastJSONObject(String str) throws JSONException {</span>
      try {
<span class="nc" id="L45">        _inner = (com.alibaba.fastjson.JSONObject) JSON.parse(str);</span>
<span class="nc" id="L46">      } catch (Exception e) {</span>
<span class="nc" id="L47">        throw new JSONException(e);</span>
<span class="nc" id="L48">      }</span>
<span class="nc" id="L49">    }</span>

<span class="nc" id="L51">    public FastJSONObject(Map value) {</span>
<span class="nc bnc" id="L52" title="All 2 branches missed.">      if (value instanceof com.alibaba.fastjson.JSONObject) {</span>
<span class="nc" id="L53">        _inner = (com.alibaba.fastjson.JSONObject) value;</span>
      } else {
<span class="nc" id="L55">        _inner = (com.alibaba.fastjson.JSONObject) toJSON(value);</span>
      }
<span class="nc" id="L57">    }</span>

<span class="nc" id="L59">    public FastJSONObject(com.alibaba.fastjson.JSONObject inner) {</span>
<span class="nc" id="L60">      _inner = inner;</span>
<span class="nc" id="L61">    }</span>

    public com.alibaba.fastjson.JSONObject getInnerJSONObject() {
<span class="nc" id="L64">      return _inner;</span>
    }

    /**
     * Accumulate values under a key. It is similar to the put method except
     * that if there is already an object stored under the key then a
     * JSONArray is stored under the key to hold all of the accumulated values.
     * If there is already a JSONArray, then the new value is appended to it.
     * In contrast, the put method replaces the previous value.
     *
     * If only one value is accumulated that is not a JSONArray, then the
     * result will be the same as using put. But if multiple values are
     * accumulated, then the result will be like append.
     * @param key   A key string.
     * @param value An object to be accumulated under the key.
     * @return this.
     * @throws JSONException If the value is an invalid number
     *  or if the key is null.
     */
    @Override
    public JSONObject accumulate(String key, Object value) throws JSONException {
<span class="nc" id="L85">      Object object = _inner.get(key);</span>
<span class="nc bnc" id="L86" title="All 2 branches missed.">      if (object == null) {</span>
<span class="nc" id="L87">        com.alibaba.fastjson.JSONArray array = new com.alibaba.fastjson.JSONArray();</span>
<span class="nc" id="L88">        array.add(value);</span>
<span class="nc" id="L89">        _inner.put(key, array);</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">      } else if (object instanceof com.alibaba.fastjson.JSONArray) {</span>
<span class="nc" id="L91">        ((com.alibaba.fastjson.JSONArray) object).add(value);</span>
      } else {
<span class="nc" id="L93">        com.alibaba.fastjson.JSONArray array = new com.alibaba.fastjson.JSONArray();</span>
<span class="nc" id="L94">        array.add(object);</span>
<span class="nc" id="L95">        array.add(value);</span>
<span class="nc" id="L96">        _inner.put(key, array);</span>
      }
<span class="nc" id="L98">      return this;</span>
    }

    /**
     * Append values to the array under a key. If the key does not exist in the
     * JSONObject, then the key is put in the JSONObject with its value being a
     * JSONArray containing the value parameter. If the key was already
     * associated with a JSONArray, then the value parameter is appended to it.
     * @param key   A key string.
     * @param value An object to be accumulated under the key.
     * @return this.
     * @throws JSONException If the key is null or if the current value
     *  associated with the key is not a JSONArray.
     */
    @Override
    public JSONObject append(String key, Object value) throws JSONException {
<span class="nc" id="L114">      Object object = _inner.get(key);</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">      if (object == null) {</span>
<span class="nc" id="L116">        com.alibaba.fastjson.JSONArray array = new com.alibaba.fastjson.JSONArray();</span>
<span class="nc" id="L117">        array.add(value);</span>
<span class="nc" id="L118">        _inner.put(key, array);</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">      } else if (object instanceof com.alibaba.fastjson.JSONArray) {</span>
<span class="nc" id="L120">        ((com.alibaba.fastjson.JSONArray) object).add(value);</span>
      } else {
<span class="nc" id="L122">        throw new JSONException(&quot;JSONObject[&quot; + key + &quot;] is not a JSONArray.&quot;);</span>
      }
<span class="nc" id="L124">      return this;</span>
    }

    /**
     * Get the value object associated with a key.
     *
     * @param key   A key string.
     * @return    The object associated with the key.
     * @throws    JSONException if the key is not found.
     */
    @Override
    public Object get(String key) throws JSONException {
<span class="nc" id="L136">      Object object = this.opt(key);</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">      if (object == null) {</span>
<span class="nc" id="L138">        throw new JSONException(&quot;JSONObject[&quot; + key + &quot;] not found.&quot;);</span>
      }
<span class="nc" id="L140">      return object;</span>
    }

    /**
     * Get the JSONArray value associated with a key.
     *
     * @param key   A key string.
     * @return    A JSONArray which is the value.
     * @throws    JSONException if the key is not found or
     *  if the value is not a JSONArray.
     */
    @Override
    public JSONArray getJSONArray(String key) throws JSONException {
<span class="nc" id="L153">      Object object = this.get(key);</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">      if (object instanceof com.alibaba.fastjson.JSONArray) {</span>
<span class="nc" id="L155">        return new FastJSONArray((com.alibaba.fastjson.JSONArray) object);</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">      } else if (object instanceof Collection) {</span>
<span class="nc" id="L157">        return new FastJSONArray((com.alibaba.fastjson.JSONArray) toJSON(object));</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">      } else if (object instanceof JSONArray) {</span>
<span class="nc" id="L159">        return (JSONArray) object;</span>
      }
<span class="nc" id="L161">      throw new JSONException(&quot;JSONObject[&quot; + quote(key) + &quot;] is not a JSONArray.&quot;);</span>
    }

    /**
     * Get the JSONObject value associated with a key.
     *
     * @param key   A key string.
     * @return    A JSONObject which is the value.
     * @throws    JSONException if the key is not found or
     *  if the value is not a JSONObject.
     */
    @Override
    public JSONObject getJSONObject(String key) throws JSONException {
<span class="nc" id="L174">      Object object = this.get(key);</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">      if (object instanceof com.alibaba.fastjson.JSONObject) {</span>
<span class="nc" id="L176">        return new FastJSONObject((com.alibaba.fastjson.JSONObject) object);</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">      } else if (object instanceof Map) {</span>
<span class="nc" id="L178">        return new FastJSONObject((com.alibaba.fastjson.JSONObject) toJSON(object));</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">      } else if (object instanceof JSONObject) {</span>
<span class="nc" id="L180">        return (JSONObject) object;</span>
      }
<span class="nc" id="L182">      throw new JSONException(&quot;JSONObject[&quot; + quote(key) + &quot;] is not a JSONObject.&quot;);</span>
    }

    /**
     * Determine if the JSONObject contains a specific key.
     * @param key   A key string.
     * @return    true if the key exists in the JSONObject.
     */
    @Override
    public boolean has(String key) {
<span class="nc" id="L192">      return _inner.containsKey(key);</span>
    }

    /**
     * Get an enumeration of the keys of the JSONObject.
     *
     * @return An iterator of the keys.
     */
    @Override
    public Iterator keys() {
<span class="nc" id="L202">      return _inner.keySet().iterator();</span>
    }

    @Override
    public Iterator sortedKeys() {
<span class="nc" id="L207">      return new TreeSet(_inner.keySet()).iterator();</span>
    }

    /**
     * Get the number of keys stored in the JSONObject.
     *
     * @return The number of keys in the JSONObject.
     */
    @Override
    public int length() {
<span class="nc" id="L217">      return _inner.size();</span>
    }

    /**
     * Produce a JSONArray containing the names of the elements of this
     * JSONObject.
     * @return A JSONArray containing the key strings, or null if the JSONObject
     * is empty.
     */
    @Override
    public JSONArray names() {
<span class="nc" id="L228">      JSONArray ja = new FastJSONArray();</span>
<span class="nc" id="L229">      Iterator keys = this.keys();</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">      while (keys.hasNext()) {</span>
<span class="nc" id="L231">        ja.put(keys.next());</span>
      }
<span class="nc bnc" id="L233" title="All 2 branches missed.">      return ja.length() == 0 ? null : ja;</span>
    }

    /**
     * Get an optional value associated with a key.
     * @param key   A key string.
     * @return    An object which is the value, or null if there is no value.
     */
    @Override
    public Object opt(String key) {
<span class="nc bnc" id="L243" title="All 2 branches missed.">      if (key == null) {</span>
<span class="nc" id="L244">        return null;</span>
      }

<span class="nc" id="L247">      Object object = _inner.get(key);</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">      if (object == null) {</span>
<span class="nc" id="L249">        return null;</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">      } else if (object instanceof com.alibaba.fastjson.JSONObject) {</span>
<span class="nc" id="L251">        return new FastJSONObject((com.alibaba.fastjson.JSONObject) object);</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">      } else if (object instanceof com.alibaba.fastjson.JSONArray) {</span>
<span class="nc" id="L253">        return new FastJSONArray((com.alibaba.fastjson.JSONArray) object);</span>
<span class="nc bnc" id="L254" title="All 2 branches missed.">      } else if (object instanceof Map) {</span>
<span class="nc" id="L255">        return new FastJSONObject((com.alibaba.fastjson.JSONObject) toJSON(object));</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">      } else if (object instanceof Collection) {</span>
<span class="nc" id="L257">        return new FastJSONArray((com.alibaba.fastjson.JSONArray) toJSON(object));</span>
      }
<span class="nc" id="L259">      return object;</span>
    }

    /**
     * Get an optional JSONArray associated with a key.
     * It returns null if there is no such key, or if its value is not a
     * JSONArray.
     *
     * @param key   A key string.
     * @return    A JSONArray which is the value.
     */
    @Override
    public JSONArray optJSONArray(String key) {
      try {
<span class="nc" id="L273">        return this.getJSONArray(key);</span>
<span class="nc" id="L274">      } catch (Exception e) {</span>
<span class="nc" id="L275">        return null;</span>
      }
    }

    /**
     * Get an optional JSONObject associated with a key.
     * It returns null if there is no such key, or if its value is not a
     * JSONObject.
     *
     * @param key   A key string.
     * @return    A JSONObject which is the value.
     */
    @Override
    public JSONObject optJSONObject(String key) {
      try {
<span class="nc" id="L290">        return this.getJSONObject(key);</span>
<span class="nc" id="L291">      } catch (Exception e) {</span>
<span class="nc" id="L292">        return null;</span>
      }
    }

    /**
     * Get an optional string associated with a key.
     * It returns the defaultValue if there is no such key.
     *
     * @param key   A key string.
     * @param defaultValue   The default.
     * @return    A string which is the value.
     */
    @Override
    public String optString(String key, String defaultValue) {
<span class="nc" id="L306">      Object object = this.opt(key);</span>
<span class="nc bnc" id="L307" title="All 4 branches missed.">      if (object == null || NULL.equals(object)) {</span>
<span class="nc" id="L308">        return defaultValue;</span>
      }
<span class="nc" id="L310">      return object.toString();</span>
    }

    /**
     * Put a key/value pair in the JSONObject, where the value will be a
     * JSONArray which is produced from a Collection.
     * @param key   A key string.
     * @param value A Collection value.
     * @return    this.
     * @throws JSONException
     */
    @Override
    public JSONObject put(String key, Collection value) throws JSONException {
<span class="nc" id="L323">      this.put(key, (Object) value);</span>
<span class="nc" id="L324">      return this;</span>
    }

    /**
     * Put a key/value pair in the JSONObject, where the value will be a
     * JSONObject which is produced from a Map.
     * @param key   A key string.
     * @param value A Map value.
     * @return    this.
     * @throws JSONException
     */
    @Override
    public JSONObject put(String key, Map value) throws JSONException {
<span class="nc" id="L337">      this.put(key, (Object) value);</span>
<span class="nc" id="L338">      return this;</span>
    }

    /**
     * Put a key/value pair in the JSONObject. If the value is null,
     * then the key will be removed from the JSONObject if it is present.
     * @param key   A key string.
     * @param value An object which is the value. It should be of one of these
     *  types: Boolean, Double, Integer, JSONArray, JSONObject, Long, String,
     *  or the JSONObject.NULL object.
     * @return this.
     * @throws JSONException If the value is non-finite number
     *  or if the key is null.
     */
    @Override
    public JSONObject put(String key, Object value) throws JSONException {
<span class="nc bnc" id="L354" title="All 2 branches missed.">      if (key == null) {</span>
<span class="nc" id="L355">        throw new JSONException(&quot;Null key.&quot;);</span>
      }
<span class="nc bnc" id="L357" title="All 2 branches missed.">      if (value != null) {</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">        if (value instanceof FastJSONObject) {</span>
<span class="nc" id="L359">          _inner.put(key, ((FastJSONObject) value).getInnerJSONObject());</span>
<span class="nc bnc" id="L360" title="All 2 branches missed.">        } else if (value instanceof FastJSONArray) {</span>
<span class="nc" id="L361">          _inner.put(key, ((FastJSONArray) value).getInnerJSONArray());</span>
        } else {
<span class="nc bnc" id="L363" title="All 4 branches missed.">          if (value instanceof JSONObject || value instanceof JSONArray) {</span>
<span class="nc" id="L364">            throw new JSONException(&quot;the value is not fast version of JSONObjects: &quot; + value);</span>
          }
<span class="nc" id="L366">          _inner.put(key, toJSON(value));</span>
        }
      } else {
<span class="nc" id="L369">        this.remove(key);</span>
      }
<span class="nc" id="L371">      return this;</span>
    }

    /**
     * Remove a name and its value, if present.
     * @param key The name to be removed.
     * @return The value that was associated with the name,
     * or null if there was no value.
     */
    @Override
    public Object remove(String key) {
<span class="nc" id="L382">      return _inner.remove(key);</span>
    }

    /**
     * Make a JSON text of this JSONObject. For compactness, no whitespace
     * is added. If this would not result in a syntactically correct JSON text,
     * then null will be returned instead.
     * &lt;p&gt;
     * Warning: This method assumes that the data structure is acyclical.
     *
     * @return a printable, displayable, portable, transmittable
     *  representation of the object, beginning
     *  with &lt;code&gt;{&lt;/code&gt;&amp;nbsp;&lt;small&gt;(left brace)&lt;/small&gt; and ending
     *  with &lt;code&gt;}&lt;/code&gt;&amp;nbsp;&lt;small&gt;(right brace)&lt;/small&gt;.
     */
    @Override
    public String toString() {
      try {
<span class="nc" id="L400">        return _inner.toString();</span>
<span class="nc" id="L401">      } catch (Exception e) {</span>
<span class="nc" id="L402">        return null;</span>
      }
    }

    /**
     * Not a prettyprinted JSON text, just the same as toString().
     */
    @Override
    public String toString(int indentFactor) throws JSONException {
<span class="nc" id="L411">      return _inner.toString();</span>
    }
  }

<span class="nc" id="L415">  public static class FastJSONArray extends JSONArray {</span>
    private com.alibaba.fastjson.JSONArray _inner;

    /**
     * Construct an empty JSONArray.
     */
<span class="nc" id="L421">    public FastJSONArray() {</span>
<span class="nc" id="L422">      _inner = new com.alibaba.fastjson.JSONArray();</span>
<span class="nc" id="L423">    }</span>

<span class="nc" id="L425">    public FastJSONArray(String str) throws JSONException {</span>
      try {
<span class="nc" id="L427">        _inner = (com.alibaba.fastjson.JSONArray) JSON.parse(str);</span>
<span class="nc" id="L428">      } catch (Exception e) {</span>
<span class="nc" id="L429">        throw new JSONException(e);</span>
<span class="nc" id="L430">      }</span>
<span class="nc" id="L431">    }</span>

<span class="nc" id="L433">    public FastJSONArray(Collection value) {</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">      if (value instanceof com.alibaba.fastjson.JSONArray) {</span>
<span class="nc" id="L435">        _inner = (com.alibaba.fastjson.JSONArray) value;</span>
      } else {
<span class="nc" id="L437">        _inner = (com.alibaba.fastjson.JSONArray) toJSON(value);</span>
      }
<span class="nc" id="L439">    }</span>

<span class="nc" id="L441">    public FastJSONArray(com.alibaba.fastjson.JSONArray inner) {</span>
<span class="nc" id="L442">      _inner = inner;</span>
<span class="nc" id="L443">    }</span>

    public com.alibaba.fastjson.JSONArray getInnerJSONArray() {
<span class="nc" id="L446">      return _inner;</span>
    }

    /**
     * Get the object value associated with an index.
     * @param index
     *  The index must be between 0 and length() - 1.
     * @return An object value.
     * @throws JSONException If there is no value for the index.
     */
    @Override
    public Object get(int index) throws JSONException {
<span class="nc" id="L458">      Object object = this.opt(index);</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">      if (object == null) {</span>
<span class="nc" id="L460">        throw new JSONException(&quot;JSONArray[&quot; + index + &quot;] not found.&quot;);</span>
      }
<span class="nc" id="L462">      return object;</span>
    }

    /**
     * Get the JSONArray associated with an index.
     * @param index The index must be between 0 and length() - 1.
     * @return    A JSONArray value.
     * @throws JSONException If there is no value for the index. or if the
     * value is not a JSONArray
     */
    @Override
    public JSONArray getJSONArray(int index) throws JSONException {
<span class="nc" id="L474">      Object object = this.get(index);</span>
<span class="nc bnc" id="L475" title="All 2 branches missed.">      if (object instanceof com.alibaba.fastjson.JSONArray) {</span>
<span class="nc" id="L476">        return new FastJSONArray((com.alibaba.fastjson.JSONArray) object);</span>
<span class="nc bnc" id="L477" title="All 2 branches missed.">      } else if (object instanceof Collection) {</span>
<span class="nc" id="L478">        return new FastJSONArray((com.alibaba.fastjson.JSONArray) toJSON(object));</span>
<span class="nc bnc" id="L479" title="All 2 branches missed.">      } else if (object instanceof JSONArray) {</span>
<span class="nc" id="L480">        return (JSONArray) object;</span>
      }
<span class="nc" id="L482">      throw new JSONException(&quot;JSONArray[&quot; + index + &quot;] is not a JSONArray.&quot;);</span>
    }

    /**
     * Get the JSONObject associated with an index.
     * @param index subscript
     * @return    A JSONObject value.
     * @throws JSONException If there is no value for the index or if the
     * value is not a JSONObject
     */
    @Override
    public JSONObject getJSONObject(int index) throws JSONException {
<span class="nc" id="L494">      Object object = this.get(index);</span>
<span class="nc bnc" id="L495" title="All 2 branches missed.">      if (object instanceof com.alibaba.fastjson.JSONObject) {</span>
<span class="nc" id="L496">        return new FastJSONObject((com.alibaba.fastjson.JSONObject) object);</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">      } else if (object instanceof Map) {</span>
<span class="nc" id="L498">        return new FastJSONObject((com.alibaba.fastjson.JSONObject) toJSON(object));</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">      } else if (object instanceof JSONObject) {</span>
<span class="nc" id="L500">        return (JSONObject) object;</span>
      }
<span class="nc" id="L502">      throw new JSONException(&quot;JSONArray[&quot; + index + &quot;] is not a JSONObject.&quot;);</span>
    }

    /**
     * Get the number of elements in the JSONArray, included nulls.
     *
     * @return The length (or size).
     */
    @Override
    public int length() {
<span class="nc" id="L512">      return _inner.size();</span>
    }

    /**
     * Get the optional object value associated with an index.
     * @param index The index must be between 0 and length() - 1.
     * @return    An object value, or null if there is no
     *        object at that index.
     */
    @Override
    public Object opt(int index) {
<span class="nc bnc" id="L523" title="All 4 branches missed.">      if (index &lt; 0 || index &gt;= this.length()) {</span>
<span class="nc" id="L524">        return null;</span>
      }
<span class="nc" id="L526">      Object object = _inner.get(index);</span>
<span class="nc bnc" id="L527" title="All 2 branches missed.">      if (object == null) {</span>
<span class="nc" id="L528">        return null;</span>
<span class="nc bnc" id="L529" title="All 2 branches missed.">      } else if (object instanceof com.alibaba.fastjson.JSONObject) {</span>
<span class="nc" id="L530">        return new FastJSONObject((com.alibaba.fastjson.JSONObject) object);</span>
<span class="nc bnc" id="L531" title="All 2 branches missed.">      } else if (object instanceof com.alibaba.fastjson.JSONArray) {</span>
<span class="nc" id="L532">        return new FastJSONArray((com.alibaba.fastjson.JSONArray) object);</span>
<span class="nc bnc" id="L533" title="All 2 branches missed.">      } else if (object instanceof Map) {</span>
<span class="nc" id="L534">        return new FastJSONObject((com.alibaba.fastjson.JSONObject) toJSON(object));</span>
<span class="nc bnc" id="L535" title="All 2 branches missed.">      } else if (object instanceof Collection) {</span>
<span class="nc" id="L536">        return new FastJSONArray((com.alibaba.fastjson.JSONArray) toJSON(object));</span>
      }
<span class="nc" id="L538">      return object;</span>
    }

    /**
     * Get the optional JSONArray associated with an index.
     * @param index subscript
     * @return    A JSONArray value, or null if the index has no value,
     * or if the value is not a JSONArray.
     */
    @Override
    public JSONArray optJSONArray(int index) {
      try {
<span class="nc" id="L550">        return this.getJSONArray(index);</span>
<span class="nc" id="L551">      } catch (Exception e) {</span>
<span class="nc" id="L552">        return null;</span>
      }
    }

    /**
     * Get the optional JSONObject associated with an index.
     * Null is returned if the key is not found, or null if the index has
     * no value, or if the value is not a JSONObject.
     *
     * @param index The index must be between 0 and length() - 1.
     * @return    A JSONObject value.
     */
    @Override
    public JSONObject optJSONObject(int index) {
      try {
<span class="nc" id="L567">        return this.getJSONObject(index);</span>
<span class="nc" id="L568">      } catch (Exception e) {</span>
<span class="nc" id="L569">        return null;</span>
      }
    }

    /**
     * Get the optional string associated with an index.
     * The defaultValue is returned if the key is not found.
     *
     * @param index The index must be between 0 and length() - 1.
     * @param defaultValue   The default value.
     * @return    A String value.
     */
    @Override
    public String optString(int index, String defaultValue) {
<span class="nc" id="L583">      Object object = this.opt(index);</span>
<span class="nc bnc" id="L584" title="All 4 branches missed.">      if (object == null || JSONObject.NULL.equals(object)) {</span>
<span class="nc" id="L585">        return defaultValue;</span>
      }
<span class="nc" id="L587">      return object.toString();</span>
    }

    /**
     * Put a value in the JSONArray, where the value will be a
     * JSONArray which is produced from a Collection.
     * @param value A Collection value.
     * @return    this.
     */
    @Override
    public JSONArray put(Collection value) {
<span class="nc" id="L598">      this.put((Object) value);</span>
<span class="nc" id="L599">      return this;</span>
    }

    /**
     * Put a value in the JSONArray, where the value will be a
     * JSONObject which is produced from a Map.
     * @param value A Map value.
     * @return    this.
     */
    @Override
    public JSONArray put(Map value) {
<span class="nc" id="L610">      this.put((Object) value);</span>
<span class="nc" id="L611">      return this;</span>
    }

    /**
     * Append an object value. This increases the array's length by one.
     * @param value An object value.  The value should be a
     *  Boolean, Double, Integer, JSONArray, JSONObject, Long, or String, or the
     *  JSONObject.NULL object.
     * @return this.
     */
    @Override
    public JSONArray put(Object value) {
<span class="nc bnc" id="L623" title="All 2 branches missed.">      if (value instanceof FastJSONObject) {</span>
<span class="nc" id="L624">        _inner.add(((FastJSONObject) value).getInnerJSONObject());</span>
<span class="nc bnc" id="L625" title="All 2 branches missed.">      } else if (value instanceof FastJSONArray) {</span>
<span class="nc" id="L626">        _inner.add(((FastJSONArray) value).getInnerJSONArray());</span>
      } else {
<span class="nc bnc" id="L628" title="All 4 branches missed.">        if (value instanceof JSONObject || value instanceof JSONArray) {</span>
<span class="nc" id="L629">          throw new IllegalArgumentException(&quot;the value is not fast version of JSONObjects: &quot; + value);</span>
        }
<span class="nc" id="L631">        _inner.add(toJSON(value));</span>
      }
<span class="nc" id="L633">      return this;</span>
    }

    /**
     * Put a value in the JSONArray, where the value will be a
     * JSONArray which is produced from a Collection.
     * @param index The subscript.
     * @param value A Collection value.
     * @return    this.
     * @throws JSONException If the index is negative or if the value is
     * not finite.
     */
    @Override
    public JSONArray put(int index, Collection value) throws JSONException {
<span class="nc" id="L647">      this.put(index, (Object) value);</span>
<span class="nc" id="L648">      return this;</span>
    }

    /**
     * Put a value in the JSONArray, where the value will be a
     * JSONObject that is produced from a Map.
     * @param index The subscript.
     * @param value The Map value.
     * @return    this.
     * @throws JSONException If the index is negative or if the the value is
     *  an invalid number.
     */
    @Override
    public JSONArray put(int index, Map value) throws JSONException {
<span class="nc" id="L662">      this.put(index, (Object) value);</span>
<span class="nc" id="L663">      return this;</span>
    }

    /**
     * Put or replace an object value in the JSONArray. If the index is greater
     *  than the length of the JSONArray, then null elements will be added as
     *  necessary to pad it out.
     * @param index The subscript.
     * @param value The value to put into the array. The value should be a
     *  Boolean, Double, Integer, JSONArray, JSONObject, Long, or String, or the
     *  JSONObject.NULL object.
     * @return this.
     * @throws JSONException If the index is negative or if the the value is
     *  an invalid number.
     */
    @Override
    public JSONArray put(int index, Object value) throws JSONException {
<span class="nc bnc" id="L680" title="All 2 branches missed.">      if (index &lt; 0) {</span>
<span class="nc" id="L681">        throw new JSONException(&quot;JSONArray[&quot; + index + &quot;] not found.&quot;);</span>
      }
<span class="nc bnc" id="L683" title="All 2 branches missed.">      if (index &lt; this.length()) {</span>
<span class="nc bnc" id="L684" title="All 2 branches missed.">        if (value instanceof FastJSONObject) {</span>
<span class="nc" id="L685">          _inner.set(index, ((FastJSONObject) value).getInnerJSONObject());</span>
<span class="nc bnc" id="L686" title="All 2 branches missed.">        } else if (value instanceof FastJSONArray) {</span>
<span class="nc" id="L687">          _inner.set(index, ((FastJSONArray) value).getInnerJSONArray());</span>
        } else {
<span class="nc bnc" id="L689" title="All 4 branches missed.">          if (value instanceof JSONObject || value instanceof JSONArray) {</span>
<span class="nc" id="L690">            throw new IllegalArgumentException(&quot;the value is not fast version of JSONObjects: &quot; + value);</span>
          }
<span class="nc" id="L692">          _inner.set(index, value);</span>
        }
      } else {
<span class="nc bnc" id="L695" title="All 2 branches missed.">        while (index != this.length()) {</span>
<span class="nc" id="L696">          this.put(JSONObject.NULL);</span>
        }
<span class="nc" id="L698">        this.put(value);</span>
      }
<span class="nc" id="L700">      return this;</span>
    }

    /**
     * Remove an index and close the hole.
     * @param index The index of the element to be removed.
     * @return The value that was associated with the index,
     * or null if there was no value.
     */
    public Object remove(int index) {
<span class="nc" id="L710">      Object o = this.opt(index);</span>
<span class="nc" id="L711">      _inner.remove(index);</span>
<span class="nc" id="L712">      return o;</span>
    }

    /**
     * Make a JSON text of this JSONArray. For compactness, no
     * unnecessary whitespace is added. If it is not possible to produce a
     * syntactically correct JSON text then null will be returned instead. This
     * could occur if the array contains an invalid number.
     * &lt;p&gt;
     * Warning: This method assumes that the data structure is acyclical.
     *
     * @return a printable, displayable, transmittable
     *  representation of the array.
     */
    @Override
    public String toString() {
      try {
<span class="nc" id="L729">        return _inner.toString();</span>
<span class="nc" id="L730">      } catch (Exception e) {</span>
<span class="nc" id="L731">        return null;</span>
      }
    }

    /**
     * Not a prettyprinted JSON text, just the same as toString().
     */
    @Override
    public String toString(int indentFactor) throws JSONException {
<span class="nc" id="L740">      return this.toString();</span>
    }
  }

  public static String normalize(String str) {
<span class="nc" id="L745">    return str.replaceAll(&quot;[\\s\\\\]*\n[\\s\\\\]*&quot;, &quot; &quot;);</span>
  }

  @SuppressWarnings(&quot;unchecked&quot;)
  public static Object toJSON(Object javaObject) {
<span class="nc bnc" id="L750" title="All 2 branches missed.">    if (javaObject == null) {</span>
<span class="nc" id="L751">      return null;</span>
    }

<span class="nc bnc" id="L754" title="All 2 branches missed.">    if (javaObject instanceof JSON) {</span>
<span class="nc" id="L755">      return javaObject;</span>
    }

<span class="nc bnc" id="L758" title="All 2 branches missed.">    if (javaObject instanceof FastJSONObject) {</span>
<span class="nc" id="L759">      return ((FastJSONObject) javaObject).getInnerJSONObject();</span>
    }

<span class="nc bnc" id="L762" title="All 2 branches missed.">    if (javaObject instanceof FastJSONArray) {</span>
<span class="nc" id="L763">      return ((FastJSONArray) javaObject).getInnerJSONArray();</span>
    }

<span class="nc bnc" id="L766" title="All 2 branches missed.">    if (javaObject instanceof Map) {</span>
<span class="nc" id="L767">      Map&lt;Object, Object&gt; map = (Map&lt;Object, Object&gt;) javaObject;</span>

<span class="nc" id="L769">      com.alibaba.fastjson.JSONObject json = new com.alibaba.fastjson.JSONObject(map.size());</span>

<span class="nc bnc" id="L771" title="All 2 branches missed.">      for (Map.Entry&lt;Object, Object&gt; entry : map.entrySet()) {</span>
<span class="nc" id="L772">        Object key = entry.getKey();</span>
<span class="nc" id="L773">        String jsonKey = TypeUtils.castToString(key);</span>
<span class="nc" id="L774">        Object jsonValue = toJSON(entry.getValue());</span>
<span class="nc" id="L775">        json.put(jsonKey, jsonValue);</span>
<span class="nc" id="L776">      }</span>

<span class="nc" id="L778">      return json;</span>
    }

<span class="nc bnc" id="L781" title="All 2 branches missed.">    if (javaObject instanceof Collection) {</span>
<span class="nc" id="L782">      Collection&lt;Object&gt; collection = (Collection&lt;Object&gt;) javaObject;</span>

<span class="nc" id="L784">      com.alibaba.fastjson.JSONArray array = new com.alibaba.fastjson.JSONArray(collection.size());</span>

<span class="nc bnc" id="L786" title="All 2 branches missed.">      for (Object item : collection) {</span>
<span class="nc" id="L787">        Object jsonValue = toJSON(item);</span>
<span class="nc" id="L788">        array.add(jsonValue);</span>
<span class="nc" id="L789">      }</span>

<span class="nc" id="L791">      return array;</span>
    }

<span class="nc" id="L794">    Class&lt;?&gt; clazz = javaObject.getClass();</span>

<span class="nc bnc" id="L796" title="All 2 branches missed.">    if (clazz.isEnum()) {</span>
<span class="nc" id="L797">      return ((Enum&lt;?&gt;) javaObject).name();</span>
    }

<span class="nc bnc" id="L800" title="All 2 branches missed.">    if (clazz.isArray()) {</span>
<span class="nc" id="L801">      int len = Array.getLength(javaObject);</span>

<span class="nc" id="L803">      com.alibaba.fastjson.JSONArray array = new com.alibaba.fastjson.JSONArray(len);</span>

<span class="nc bnc" id="L805" title="All 2 branches missed.">      for (int i = 0; i &lt; len; ++i) {</span>
<span class="nc" id="L806">        Object item = Array.get(javaObject, i);</span>
<span class="nc" id="L807">        Object jsonValue = toJSON(item);</span>
<span class="nc" id="L808">        array.add(jsonValue);</span>
      }

<span class="nc" id="L811">      return array;</span>
    }

<span class="nc bnc" id="L814" title="All 2 branches missed.">    if (ParserConfig.getGlobalInstance().isPrimitive(clazz)) {</span>
<span class="nc" id="L815">      return javaObject;</span>
    }

    try {
<span class="nc" id="L819">      List&lt;FieldInfo&gt; getters = TypeUtils.computeGetters(clazz, null);</span>

<span class="nc" id="L821">      com.alibaba.fastjson.JSONObject json = new com.alibaba.fastjson.JSONObject(getters.size());</span>

<span class="nc bnc" id="L823" title="All 2 branches missed.">      for (FieldInfo field : getters) {</span>
<span class="nc" id="L824">        Object value = field.get(javaObject);</span>
<span class="nc" id="L825">        Object jsonValue = toJSON(value);</span>

<span class="nc" id="L827">        json.put(field.getName(), jsonValue);</span>
<span class="nc" id="L828">      }</span>

<span class="nc" id="L830">      return json;</span>
<span class="nc" id="L831">    } catch (Exception e) {</span>
<span class="nc" id="L832">      throw new com.alibaba.fastjson.JSONException(&quot;toJSON error&quot;, e);</span>
    }
  }

  public static boolean optBooleanValue(com.alibaba.fastjson.JSONObject json, String key)
      throws com.alibaba.fastjson.JSONException {
<span class="nc" id="L838">    return optBooleanValue(json, key, false);</span>
  }

  public static boolean optBooleanValue(com.alibaba.fastjson.JSONObject json, String key, boolean defaultValue)
      throws com.alibaba.fastjson.JSONException {
<span class="nc" id="L843">    Boolean val = json.getBoolean(key);</span>
<span class="nc bnc" id="L844" title="All 2 branches missed.">    if (val == null)</span>
<span class="nc" id="L845">      return defaultValue;</span>
<span class="nc" id="L846">    return val.booleanValue();</span>
  }

  public static boolean optBooleanValue(com.alibaba.fastjson.JSONArray json, int index)
      throws com.alibaba.fastjson.JSONException {
<span class="nc" id="L851">    return optBooleanValue(json, index, false);</span>
  }

  public static boolean optBooleanValue(com.alibaba.fastjson.JSONArray json, int index, boolean defaultValue)
      throws com.alibaba.fastjson.JSONException {
<span class="nc" id="L856">    Boolean val = json.getBoolean(index);</span>
<span class="nc bnc" id="L857" title="All 2 branches missed.">    if (val == null)</span>
<span class="nc" id="L858">      return defaultValue;</span>
<span class="nc" id="L859">    return val.booleanValue();</span>
  }

  public static com.alibaba.fastjson.JSONObject optJSONObject(com.alibaba.fastjson.JSONObject json, String key)
      throws com.alibaba.fastjson.JSONException {
<span class="nc" id="L864">    Object obj = json.get(key);</span>
<span class="nc bnc" id="L865" title="All 2 branches missed.">    if (obj == null)</span>
<span class="nc" id="L866">      return null;</span>

<span class="nc bnc" id="L868" title="All 2 branches missed.">    if (!(obj instanceof com.alibaba.fastjson.JSONObject)) {</span>
      try {
<span class="nc" id="L870">        return (com.alibaba.fastjson.JSONObject) toJSON(obj);</span>
<span class="nc" id="L871">      } catch (Exception e) {</span>
<span class="nc" id="L872">        return null;</span>
      }
    }

<span class="nc" id="L876">    return (com.alibaba.fastjson.JSONObject) obj;</span>
  }

  public static com.alibaba.fastjson.JSONObject optJSONObject(com.alibaba.fastjson.JSONArray json, int index)
      throws com.alibaba.fastjson.JSONException {
<span class="nc" id="L881">    Object obj = json.get(index);</span>
<span class="nc bnc" id="L882" title="All 2 branches missed.">    if (obj == null)</span>
<span class="nc" id="L883">      return null;</span>

<span class="nc bnc" id="L885" title="All 2 branches missed.">    if (!(obj instanceof com.alibaba.fastjson.JSONObject)) {</span>
      try {
<span class="nc" id="L887">        return (com.alibaba.fastjson.JSONObject) toJSON(obj);</span>
<span class="nc" id="L888">      } catch (Exception e) {</span>
<span class="nc" id="L889">        return null;</span>
      }
    }

<span class="nc" id="L893">    return (com.alibaba.fastjson.JSONObject) obj;</span>
  }

  public static com.alibaba.fastjson.JSONArray optJSONArray(com.alibaba.fastjson.JSONObject json, String key)
      throws com.alibaba.fastjson.JSONException {
<span class="nc" id="L898">    Object obj = json.get(key);</span>
<span class="nc bnc" id="L899" title="All 2 branches missed.">    if (obj == null)</span>
<span class="nc" id="L900">      return null;</span>

<span class="nc bnc" id="L902" title="All 2 branches missed.">    if (!(obj instanceof com.alibaba.fastjson.JSONArray)) {</span>
      try {
<span class="nc" id="L904">        return (com.alibaba.fastjson.JSONArray) toJSON(obj);</span>
<span class="nc" id="L905">      } catch (Exception e) {</span>
<span class="nc" id="L906">        return null;</span>
      }
    }

<span class="nc" id="L910">    return (com.alibaba.fastjson.JSONArray) obj;</span>
  }

  public static com.alibaba.fastjson.JSONArray optJSONArray(com.alibaba.fastjson.JSONArray json, int index)
      throws com.alibaba.fastjson.JSONException {
<span class="nc" id="L915">    Object obj = json.get(index);</span>
<span class="nc bnc" id="L916" title="All 2 branches missed.">    if (obj == null)</span>
<span class="nc" id="L917">      return null;</span>

<span class="nc bnc" id="L919" title="All 2 branches missed.">    if (!(obj instanceof com.alibaba.fastjson.JSONArray)) {</span>
      try {
<span class="nc" id="L921">        return (com.alibaba.fastjson.JSONArray) toJSON(obj);</span>
<span class="nc" id="L922">      } catch (Exception e) {</span>
<span class="nc" id="L923">        return null;</span>
      }
    }

<span class="nc" id="L927">    return (com.alibaba.fastjson.JSONArray) obj;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>