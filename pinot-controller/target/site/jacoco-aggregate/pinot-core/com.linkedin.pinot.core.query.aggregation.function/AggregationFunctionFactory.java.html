<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>AggregationFunctionFactory.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">pinot-controller</a> &gt; <a href="../index.html" class="el_bundle">pinot-core</a> &gt; <a href="index.source.html" class="el_package">com.linkedin.pinot.core.query.aggregation.function</a> &gt; <span class="el_source">AggregationFunctionFactory.java</span></div><h1>AggregationFunctionFactory.java</h1><pre class="source lang-java linenums">/**
 * Copyright (C) 2014-2016 LinkedIn Corp. (pinot-core@linkedin.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.linkedin.pinot.core.query.aggregation.function;

import com.linkedin.pinot.core.query.exception.BadQueryRequestException;
import javax.annotation.Nonnull;


/**
 * Factory class to create instances of aggregation function of the given name.
 */
public class AggregationFunctionFactory {
<span class="nc" id="L26">  private AggregationFunctionFactory() {</span>
<span class="nc" id="L27">  }</span>

<span class="fc" id="L29">  public enum AggregationFunctionType {</span>
    // Single-value aggregation functions.
<span class="fc" id="L31">    COUNT(&quot;count&quot;),</span>
<span class="fc" id="L32">    MIN(&quot;min&quot;),</span>
<span class="fc" id="L33">    MAX(&quot;max&quot;),</span>
<span class="fc" id="L34">    SUM(&quot;sum&quot;),</span>
<span class="fc" id="L35">    AVG(&quot;avg&quot;),</span>
<span class="fc" id="L36">    MINMAXRANGE(&quot;minMaxRange&quot;),</span>
<span class="fc" id="L37">    DISTINCTCOUNT(&quot;distinctCount&quot;),</span>
<span class="fc" id="L38">    DISTINCTCOUNTHLL(&quot;distinctCountHLL&quot;),</span>
<span class="fc" id="L39">    FASTHLL(&quot;fastHLL&quot;),</span>
<span class="fc" id="L40">    PERCENTILE10(&quot;percentile10&quot;),</span>
<span class="fc" id="L41">    PERCENTILE20(&quot;percentile20&quot;),</span>
<span class="fc" id="L42">    PERCENTILE30(&quot;percentile30&quot;),</span>
<span class="fc" id="L43">    PERCENTILE40(&quot;percentile40&quot;),</span>
<span class="fc" id="L44">    PERCENTILE50(&quot;percentile50&quot;),</span>
<span class="fc" id="L45">    PERCENTILE60(&quot;percentile60&quot;),</span>
<span class="fc" id="L46">    PERCENTILE70(&quot;percentile70&quot;),</span>
<span class="fc" id="L47">    PERCENTILE80(&quot;percentile80&quot;),</span>
<span class="fc" id="L48">    PERCENTILE90(&quot;percentile90&quot;),</span>
<span class="fc" id="L49">    PERCENTILE95(&quot;percentile95&quot;),</span>
<span class="fc" id="L50">    PERCENTILE99(&quot;percentile99&quot;),</span>
<span class="fc" id="L51">    PERCENTILEEST10(&quot;percentileEst10&quot;),</span>
<span class="fc" id="L52">    PERCENTILEEST20(&quot;percentileEst20&quot;),</span>
<span class="fc" id="L53">    PERCENTILEEST30(&quot;percentileEst30&quot;),</span>
<span class="fc" id="L54">    PERCENTILEEST40(&quot;percentileEst40&quot;),</span>
<span class="fc" id="L55">    PERCENTILEEST50(&quot;percentileEst50&quot;),</span>
<span class="fc" id="L56">    PERCENTILEEST60(&quot;percentileEst60&quot;),</span>
<span class="fc" id="L57">    PERCENTILEEST70(&quot;percentileEst70&quot;),</span>
<span class="fc" id="L58">    PERCENTILEEST80(&quot;percentileEst80&quot;),</span>
<span class="fc" id="L59">    PERCENTILEEST90(&quot;percentileEst90&quot;),</span>
<span class="fc" id="L60">    PERCENTILEEST95(&quot;percentileEst95&quot;),</span>
<span class="fc" id="L61">    PERCENTILEEST99(&quot;percentileEst99&quot;),</span>
    // Multi-value aggregation functions.
<span class="fc" id="L63">    COUNTMV(&quot;countMV&quot;),</span>
<span class="fc" id="L64">    MINMV(&quot;minMV&quot;),</span>
<span class="fc" id="L65">    MAXMV(&quot;maxMV&quot;),</span>
<span class="fc" id="L66">    SUMMV(&quot;sumMV&quot;),</span>
<span class="fc" id="L67">    AVGMV(&quot;avgMV&quot;),</span>
<span class="fc" id="L68">    MINMAXRANGEMV(&quot;minMaxRangeMV&quot;),</span>
<span class="fc" id="L69">    DISTINCTCOUNTMV(&quot;distinctCountMV&quot;),</span>
<span class="fc" id="L70">    DISTINCTCOUNTHLLMV(&quot;distinctCountHLLMV&quot;),</span>
<span class="fc" id="L71">    FASTHLLMV(&quot;fastHLLMV&quot;),</span>
<span class="fc" id="L72">    PERCENTILE10MV(&quot;percentile10MV&quot;),</span>
<span class="fc" id="L73">    PERCENTILE20MV(&quot;percentile20MV&quot;),</span>
<span class="fc" id="L74">    PERCENTILE30MV(&quot;percentile30MV&quot;),</span>
<span class="fc" id="L75">    PERCENTILE40MV(&quot;percentile40MV&quot;),</span>
<span class="fc" id="L76">    PERCENTILE50MV(&quot;percentile50MV&quot;),</span>
<span class="fc" id="L77">    PERCENTILE60MV(&quot;percentile60MV&quot;),</span>
<span class="fc" id="L78">    PERCENTILE70MV(&quot;percentile70MV&quot;),</span>
<span class="fc" id="L79">    PERCENTILE80MV(&quot;percentile80MV&quot;),</span>
<span class="fc" id="L80">    PERCENTILE90MV(&quot;percentile90MV&quot;),</span>
<span class="fc" id="L81">    PERCENTILE95MV(&quot;percentile95MV&quot;),</span>
<span class="fc" id="L82">    PERCENTILE99MV(&quot;percentile99MV&quot;),</span>
<span class="fc" id="L83">    PERCENTILEEST10MV(&quot;percentileEst10MV&quot;),</span>
<span class="fc" id="L84">    PERCENTILEEST20MV(&quot;percentileEst20MV&quot;),</span>
<span class="fc" id="L85">    PERCENTILEEST30MV(&quot;percentileEst30MV&quot;),</span>
<span class="fc" id="L86">    PERCENTILEEST40MV(&quot;percentileEst40MV&quot;),</span>
<span class="fc" id="L87">    PERCENTILEEST50MV(&quot;percentileEst50MV&quot;),</span>
<span class="fc" id="L88">    PERCENTILEEST60MV(&quot;percentileEst60MV&quot;),</span>
<span class="fc" id="L89">    PERCENTILEEST70MV(&quot;percentileEst70MV&quot;),</span>
<span class="fc" id="L90">    PERCENTILEEST80MV(&quot;percentileEst80MV&quot;),</span>
<span class="fc" id="L91">    PERCENTILEEST90MV(&quot;percentileEst90MV&quot;),</span>
<span class="fc" id="L92">    PERCENTILEEST95MV(&quot;percentileEst95MV&quot;),</span>
<span class="fc" id="L93">    PERCENTILEEST99MV(&quot;percentileEst99MV&quot;);</span>

    private final String _name;

<span class="fc" id="L97">    AggregationFunctionType(@Nonnull String name) {</span>
<span class="fc" id="L98">      _name = name;</span>
<span class="fc" id="L99">    }</span>

    @Nonnull
    public String getName() {
<span class="fc" id="L103">      return _name;</span>
    }

    public boolean isOfType(AggregationFunctionType... aggregationFunctionTypes) {
<span class="fc bfc" id="L107" title="All 2 branches covered.">      for (AggregationFunctionType aggFuncType : aggregationFunctionTypes) {</span>
<span class="fc bfc" id="L108" title="All 2 branches covered.">        if (this.equals(aggFuncType)) {</span>
<span class="fc" id="L109">          return true;</span>
        }
      }
<span class="fc" id="L112">      return false;</span>
    }
  }

  /**
   * Given the name of aggregation function, create and return a new instance of the corresponding aggregation function.
   */
  @Nonnull
  public static AggregationFunction getAggregationFunction(@Nonnull String functionName) {
    AggregationFunctionType aggregationFunctionType;
    try {
<span class="fc" id="L123">      aggregationFunctionType = AggregationFunctionType.valueOf(functionName.toUpperCase());</span>
<span class="nc" id="L124">    } catch (Exception e) {</span>
<span class="nc" id="L125">      throw new BadQueryRequestException(&quot;Invalid aggregation function name: &quot; + functionName);</span>
<span class="fc" id="L126">    }</span>
<span class="pc bpc" id="L127" title="30 of 63 branches missed.">    switch (aggregationFunctionType) {</span>
      case COUNT:
<span class="fc" id="L129">        return new CountAggregationFunction();</span>
      case MIN:
<span class="fc" id="L131">        return new MinAggregationFunction();</span>
      case MAX:
<span class="fc" id="L133">        return new MaxAggregationFunction();</span>
      case SUM:
<span class="fc" id="L135">        return new SumAggregationFunction();</span>
      case AVG:
<span class="fc" id="L137">        return new AvgAggregationFunction();</span>
      case MINMAXRANGE:
<span class="fc" id="L139">        return new MinMaxRangeAggregationFunction();</span>
      case DISTINCTCOUNT:
<span class="fc" id="L141">        return new DistinctCountAggregationFunction();</span>
      case DISTINCTCOUNTHLL:
<span class="fc" id="L143">        return new DistinctCountHLLAggregationFunction();</span>
      case FASTHLL:
<span class="fc" id="L145">        return new FastHLLAggregationFunction();</span>
      case PERCENTILE10:
<span class="nc" id="L147">        return new PercentileAggregationFunction(10);</span>
      case PERCENTILE20:
<span class="nc" id="L149">        return new PercentileAggregationFunction(20);</span>
      case PERCENTILE30:
<span class="nc" id="L151">        return new PercentileAggregationFunction(30);</span>
      case PERCENTILE40:
<span class="nc" id="L153">        return new PercentileAggregationFunction(40);</span>
      case PERCENTILE50:
<span class="fc" id="L155">        return new PercentileAggregationFunction(50);</span>
      case PERCENTILE60:
<span class="nc" id="L157">        return new PercentileAggregationFunction(60);</span>
      case PERCENTILE70:
<span class="nc" id="L159">        return new PercentileAggregationFunction(70);</span>
      case PERCENTILE80:
<span class="nc" id="L161">        return new PercentileAggregationFunction(80);</span>
      case PERCENTILE90:
<span class="fc" id="L163">        return new PercentileAggregationFunction(90);</span>
      case PERCENTILE95:
<span class="fc" id="L165">        return new PercentileAggregationFunction(95);</span>
      case PERCENTILE99:
<span class="fc" id="L167">        return new PercentileAggregationFunction(99);</span>
      case PERCENTILEEST10:
<span class="nc" id="L169">        return new PercentileEstAggregationFunction(10);</span>
      case PERCENTILEEST20:
<span class="nc" id="L171">        return new PercentileEstAggregationFunction(20);</span>
      case PERCENTILEEST30:
<span class="nc" id="L173">        return new PercentileEstAggregationFunction(30);</span>
      case PERCENTILEEST40:
<span class="nc" id="L175">        return new PercentileEstAggregationFunction(40);</span>
      case PERCENTILEEST50:
<span class="fc" id="L177">        return new PercentileEstAggregationFunction(50);</span>
      case PERCENTILEEST60:
<span class="nc" id="L179">        return new PercentileEstAggregationFunction(60);</span>
      case PERCENTILEEST70:
<span class="nc" id="L181">        return new PercentileEstAggregationFunction(70);</span>
      case PERCENTILEEST80:
<span class="nc" id="L183">        return new PercentileEstAggregationFunction(80);</span>
      case PERCENTILEEST90:
<span class="fc" id="L185">        return new PercentileEstAggregationFunction(90);</span>
      case PERCENTILEEST95:
<span class="fc" id="L187">        return new PercentileEstAggregationFunction(95);</span>
      case PERCENTILEEST99:
<span class="fc" id="L189">        return new PercentileEstAggregationFunction(99);</span>
      case COUNTMV:
<span class="fc" id="L191">        return new CountMVAggregationFunction();</span>
      case MINMV:
<span class="fc" id="L193">        return new MinMVAggregationFunction();</span>
      case MAXMV:
<span class="fc" id="L195">        return new MaxMVAggregationFunction();</span>
      case SUMMV:
<span class="fc" id="L197">        return new SumMVAggregationFunction();</span>
      case AVGMV:
<span class="fc" id="L199">        return new AvgMVAggregationFunction();</span>
      case MINMAXRANGEMV:
<span class="fc" id="L201">        return new MinMaxRangeMVAggregationFunction();</span>
      case DISTINCTCOUNTMV:
<span class="fc" id="L203">        return new DistinctCountMVAggregationFunction();</span>
      case DISTINCTCOUNTHLLMV:
<span class="fc" id="L205">        return new DistinctCountHLLMVAggregationFunction();</span>
      case FASTHLLMV:
<span class="nc" id="L207">        return new FastHLLMVAggregationFunction();</span>
      case PERCENTILE10MV:
<span class="nc" id="L209">        return new PercentileMVAggregationFunction(10);</span>
      case PERCENTILE20MV:
<span class="nc" id="L211">        return new PercentileMVAggregationFunction(20);</span>
      case PERCENTILE30MV:
<span class="nc" id="L213">        return new PercentileMVAggregationFunction(30);</span>
      case PERCENTILE40MV:
<span class="nc" id="L215">        return new PercentileMVAggregationFunction(40);</span>
      case PERCENTILE50MV:
<span class="fc" id="L217">        return new PercentileMVAggregationFunction(50);</span>
      case PERCENTILE60MV:
<span class="nc" id="L219">        return new PercentileMVAggregationFunction(60);</span>
      case PERCENTILE70MV:
<span class="nc" id="L221">        return new PercentileMVAggregationFunction(70);</span>
      case PERCENTILE80MV:
<span class="nc" id="L223">        return new PercentileMVAggregationFunction(80);</span>
      case PERCENTILE90MV:
<span class="fc" id="L225">        return new PercentileMVAggregationFunction(90);</span>
      case PERCENTILE95MV:
<span class="fc" id="L227">        return new PercentileMVAggregationFunction(95);</span>
      case PERCENTILE99MV:
<span class="fc" id="L229">        return new PercentileMVAggregationFunction(99);</span>
      case PERCENTILEEST10MV:
<span class="nc" id="L231">        return new PercentileEstMVAggregationFunction(10);</span>
      case PERCENTILEEST20MV:
<span class="nc" id="L233">        return new PercentileEstMVAggregationFunction(20);</span>
      case PERCENTILEEST30MV:
<span class="nc" id="L235">        return new PercentileEstMVAggregationFunction(30);</span>
      case PERCENTILEEST40MV:
<span class="nc" id="L237">        return new PercentileEstMVAggregationFunction(40);</span>
      case PERCENTILEEST50MV:
<span class="fc" id="L239">        return new PercentileEstMVAggregationFunction(50);</span>
      case PERCENTILEEST60MV:
<span class="nc" id="L241">        return new PercentileEstMVAggregationFunction(60);</span>
      case PERCENTILEEST70MV:
<span class="nc" id="L243">        return new PercentileEstMVAggregationFunction(70);</span>
      case PERCENTILEEST80MV:
<span class="nc" id="L245">        return new PercentileEstMVAggregationFunction(80);</span>
      case PERCENTILEEST90MV:
<span class="fc" id="L247">        return new PercentileEstMVAggregationFunction(90);</span>
      case PERCENTILEEST95MV:
<span class="fc" id="L249">        return new PercentileEstMVAggregationFunction(95);</span>
      case PERCENTILEEST99MV:
<span class="fc" id="L251">        return new PercentileEstMVAggregationFunction(99);</span>
      default:
<span class="nc" id="L253">        throw new UnsupportedOperationException();</span>
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>