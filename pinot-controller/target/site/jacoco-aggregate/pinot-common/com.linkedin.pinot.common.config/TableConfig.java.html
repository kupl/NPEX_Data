<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>TableConfig.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">pinot-controller</a> &gt; <a href="../index.html" class="el_bundle">pinot-common</a> &gt; <a href="index.source.html" class="el_package">com.linkedin.pinot.common.config</a> &gt; <span class="el_source">TableConfig.java</span></div><h1>TableConfig.java</h1><pre class="source lang-java linenums">/**
 * Copyright (C) 2014-2016 LinkedIn Corp. (pinot-core@linkedin.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.linkedin.pinot.common.config;

import com.google.common.base.Preconditions;
import com.linkedin.pinot.common.data.StarTreeIndexSpec;
import com.linkedin.pinot.common.utils.CommonConstants.Helix.TableType;
import com.linkedin.pinot.common.utils.EqualityUtils;
import com.linkedin.pinot.startree.hll.HllConfig;
import java.io.IOException;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import javax.annotation.Nonnull;
import javax.annotation.Nullable;
import org.apache.helix.ZNRecord;
import org.codehaus.jackson.map.ObjectMapper;
import org.json.JSONException;
import org.json.JSONObject;


public class TableConfig {
<span class="fc" id="L37">  private static final ObjectMapper OBJECT_MAPPER = new ObjectMapper();</span>

  private static final String TABLE_NAME_KEY = &quot;tableName&quot;;
  private static final String TABLE_TYPE_KEY = &quot;tableType&quot;;
  private static final String VALIDATION_CONFIG_KEY = &quot;segmentsConfig&quot;;
  private static final String TENANT_CONFIG_KEY = &quot;tenants&quot;;
  private static final String INDEXING_CONFIG_KEY = &quot;tableIndexConfig&quot;;
  private static final String CUSTOM_CONFIG_KEY = &quot;metadata&quot;;
  private static final String QUOTA_CONFIG_KEY = &quot;quota&quot;;
  private static final String TASK_CONFIG_KEY = &quot;task&quot;;
  private static final String ROUTING_CONFIG_KEY = &quot;routing&quot;;

  private String _tableName;
  private TableType _tableType;
  private SegmentsValidationAndRetentionConfig _validationConfig;
  private TenantConfig _tenantConfig;
  private IndexingConfig _indexingConfig;
  private TableCustomConfig _customConfig;
  private QuotaConfig _quotaConfig;
  private TableTaskConfig _taskConfig;
  private RoutingConfig _routingConfig;

  private TableConfig(@Nonnull String tableName, @Nonnull TableType tableType,
      @Nonnull SegmentsValidationAndRetentionConfig validationConfig, @Nonnull TenantConfig tenantConfig,
      @Nonnull IndexingConfig indexingConfig, @Nonnull TableCustomConfig customConfig,
<span class="fc" id="L62">      @Nullable QuotaConfig quotaConfig, @Nullable TableTaskConfig taskConfig, @Nullable RoutingConfig routingConfig) {</span>
<span class="fc" id="L63">    _tableName = TableNameBuilder.forType(tableType).tableNameWithType(tableName);</span>
<span class="fc" id="L64">    _tableType = tableType;</span>
<span class="fc" id="L65">    _validationConfig = validationConfig;</span>
<span class="fc" id="L66">    _tenantConfig = tenantConfig;</span>
<span class="fc" id="L67">    _indexingConfig = indexingConfig;</span>
<span class="fc" id="L68">    _customConfig = customConfig;</span>
<span class="fc" id="L69">    _quotaConfig = quotaConfig;</span>
<span class="fc" id="L70">    _taskConfig = taskConfig;</span>
<span class="fc" id="L71">    _routingConfig = routingConfig;</span>
<span class="fc" id="L72">  }</span>

  // For backward compatible
  @Deprecated
  @Nonnull
  public static TableConfig init(@Nonnull String jsonConfigString)
      throws IOException, JSONException {
<span class="nc" id="L79">    return fromJSONConfig(new JSONObject(jsonConfigString));</span>
  }

  @Nonnull
  public static TableConfig fromJSONConfig(@Nonnull JSONObject jsonConfig)
      throws IOException, JSONException {
<span class="fc" id="L85">    TableType tableType = TableType.valueOf(jsonConfig.getString(TABLE_TYPE_KEY).toUpperCase());</span>
<span class="fc" id="L86">    String tableName = TableNameBuilder.forType(tableType).tableNameWithType(jsonConfig.getString(TABLE_NAME_KEY));</span>
<span class="fc" id="L87">    SegmentsValidationAndRetentionConfig validationConfig =</span>
        OBJECT_MAPPER.readValue(jsonConfig.getJSONObject(VALIDATION_CONFIG_KEY).toString(),
            SegmentsValidationAndRetentionConfig.class);
<span class="fc" id="L90">    TenantConfig tenantConfig =</span>
        OBJECT_MAPPER.readValue(jsonConfig.getJSONObject(TENANT_CONFIG_KEY).toString(), TenantConfig.class);
<span class="fc" id="L92">    IndexingConfig indexingConfig =</span>
        OBJECT_MAPPER.readValue(jsonConfig.getJSONObject(INDEXING_CONFIG_KEY).toString(), IndexingConfig.class);
<span class="fc" id="L94">    TableCustomConfig customConfig =</span>
        OBJECT_MAPPER.readValue(jsonConfig.getJSONObject(CUSTOM_CONFIG_KEY).toString(), TableCustomConfig.class);
<span class="fc" id="L96">    QuotaConfig quotaConfig = null;</span>
<span class="fc bfc" id="L97" title="All 2 branches covered.">    if (jsonConfig.has(QUOTA_CONFIG_KEY)) {</span>
<span class="fc" id="L98">      quotaConfig = OBJECT_MAPPER.readValue(jsonConfig.getJSONObject(QUOTA_CONFIG_KEY).toString(), QuotaConfig.class);</span>
<span class="fc" id="L99">      quotaConfig.validate();</span>
    }
<span class="fc" id="L101">    TableTaskConfig taskConfig = null;</span>
<span class="pc bpc" id="L102" title="1 of 2 branches missed.">    if (jsonConfig.has(TASK_CONFIG_KEY)) {</span>
<span class="nc" id="L103">      taskConfig = OBJECT_MAPPER.readValue(jsonConfig.getJSONObject(TASK_CONFIG_KEY).toString(), TableTaskConfig.class);</span>
    }
<span class="fc" id="L105">    RoutingConfig routingConfig = null;</span>
<span class="fc bfc" id="L106" title="All 2 branches covered.">    if (jsonConfig.has(ROUTING_CONFIG_KEY)) {</span>
<span class="fc" id="L107">      routingConfig =</span>
          OBJECT_MAPPER.readValue(jsonConfig.getJSONObject(ROUTING_CONFIG_KEY).toString(), RoutingConfig.class);
    }

<span class="fc" id="L111">    return new TableConfig(tableName, tableType, validationConfig, tenantConfig, indexingConfig, customConfig,</span>
        quotaConfig, taskConfig, routingConfig);
  }

  @Nonnull
  public static JSONObject toJSONConfig(@Nonnull TableConfig tableConfig)
      throws IOException, JSONException {
<span class="fc" id="L118">    JSONObject jsonConfig = new JSONObject();</span>
<span class="fc" id="L119">    jsonConfig.put(TABLE_NAME_KEY, tableConfig._tableName);</span>
<span class="fc" id="L120">    jsonConfig.put(TABLE_TYPE_KEY, tableConfig._tableType.toString());</span>
<span class="fc" id="L121">    jsonConfig.put(VALIDATION_CONFIG_KEY,</span>
        new JSONObject(OBJECT_MAPPER.writeValueAsString(tableConfig._validationConfig)));
<span class="fc" id="L123">    jsonConfig.put(TENANT_CONFIG_KEY, new JSONObject(OBJECT_MAPPER.writeValueAsString(tableConfig._tenantConfig)));</span>
<span class="fc" id="L124">    jsonConfig.put(INDEXING_CONFIG_KEY, new JSONObject(OBJECT_MAPPER.writeValueAsString(tableConfig._indexingConfig)));</span>
<span class="fc" id="L125">    jsonConfig.put(CUSTOM_CONFIG_KEY, new JSONObject(OBJECT_MAPPER.writeValueAsString(tableConfig._customConfig)));</span>
<span class="fc bfc" id="L126" title="All 2 branches covered.">    if (tableConfig._quotaConfig != null) {</span>
<span class="fc" id="L127">      jsonConfig.put(QUOTA_CONFIG_KEY, new JSONObject(OBJECT_MAPPER.writeValueAsString(tableConfig._quotaConfig)));</span>
    }
<span class="pc bpc" id="L129" title="1 of 2 branches missed.">    if (tableConfig._taskConfig != null) {</span>
<span class="nc" id="L130">      jsonConfig.put(TASK_CONFIG_KEY, new JSONObject(OBJECT_MAPPER.writeValueAsString(tableConfig._taskConfig)));</span>
    }
<span class="pc bpc" id="L132" title="1 of 2 branches missed.">    if (tableConfig._routingConfig != null) {</span>
<span class="fc" id="L133">      jsonConfig.put(ROUTING_CONFIG_KEY, new JSONObject(OBJECT_MAPPER.writeValueAsString(tableConfig._routingConfig)));</span>
    }
<span class="fc" id="L135">    return jsonConfig;</span>
  }

  @Nonnull
  public static TableConfig fromZnRecord(@Nonnull ZNRecord znRecord)
      throws IOException, JSONException {
<span class="fc" id="L141">    Map&lt;String, String&gt; simpleFields = znRecord.getSimpleFields();</span>
<span class="fc" id="L142">    TableType tableType = TableType.valueOf(simpleFields.get(TABLE_TYPE_KEY).toUpperCase());</span>
<span class="fc" id="L143">    String tableName = TableNameBuilder.forType(tableType).tableNameWithType(simpleFields.get(TABLE_NAME_KEY));</span>
<span class="fc" id="L144">    SegmentsValidationAndRetentionConfig validationConfig =</span>
        OBJECT_MAPPER.readValue(simpleFields.get(VALIDATION_CONFIG_KEY), SegmentsValidationAndRetentionConfig.class);
<span class="fc" id="L146">    TenantConfig tenantConfig = OBJECT_MAPPER.readValue(simpleFields.get(TENANT_CONFIG_KEY), TenantConfig.class);</span>
<span class="fc" id="L147">    IndexingConfig indexingConfig =</span>
        OBJECT_MAPPER.readValue(simpleFields.get(INDEXING_CONFIG_KEY), IndexingConfig.class);
<span class="fc" id="L149">    TableCustomConfig customConfig =</span>
        OBJECT_MAPPER.readValue(simpleFields.get(CUSTOM_CONFIG_KEY), TableCustomConfig.class);
<span class="fc" id="L151">    QuotaConfig quotaConfig = null;</span>
<span class="fc" id="L152">    String quotaConfigString = simpleFields.get(QUOTA_CONFIG_KEY);</span>
<span class="fc bfc" id="L153" title="All 2 branches covered.">    if (quotaConfigString != null) {</span>
<span class="fc" id="L154">      quotaConfig = OBJECT_MAPPER.readValue(quotaConfigString, QuotaConfig.class);</span>
<span class="fc" id="L155">      quotaConfig.validate();</span>
    }
<span class="fc" id="L157">    TableTaskConfig taskConfig = null;</span>
<span class="fc" id="L158">    String taskConfigString = simpleFields.get(TASK_CONFIG_KEY);</span>
<span class="pc bpc" id="L159" title="1 of 2 branches missed.">    if (taskConfigString != null) {</span>
<span class="nc" id="L160">      taskConfig = OBJECT_MAPPER.readValue(taskConfigString, TableTaskConfig.class);</span>
    }
<span class="fc" id="L162">    String routingConfigString = simpleFields.get(ROUTING_CONFIG_KEY);</span>

<span class="fc" id="L164">    RoutingConfig routingConfig = null;</span>
<span class="pc bpc" id="L165" title="1 of 2 branches missed.">    if (routingConfigString != null) {</span>
<span class="fc" id="L166">      routingConfig = OBJECT_MAPPER.readValue(routingConfigString, RoutingConfig.class);</span>
    }

<span class="fc" id="L169">    return new TableConfig(tableName, tableType, validationConfig, tenantConfig, indexingConfig, customConfig,</span>
        quotaConfig, taskConfig, routingConfig);
  }

  @Nonnull
  public static ZNRecord toZnRecord(@Nonnull TableConfig tableConfig)
      throws IOException {
<span class="fc" id="L176">    ZNRecord znRecord = new ZNRecord(tableConfig.getTableName());</span>
<span class="fc" id="L177">    Map&lt;String, String&gt; simpleFields = new HashMap&lt;&gt;();</span>
<span class="fc" id="L178">    simpleFields.put(TABLE_NAME_KEY, tableConfig._tableName);</span>
<span class="fc" id="L179">    simpleFields.put(TABLE_TYPE_KEY, tableConfig._tableType.toString());</span>
<span class="fc" id="L180">    simpleFields.put(VALIDATION_CONFIG_KEY, OBJECT_MAPPER.writeValueAsString(tableConfig._validationConfig));</span>
<span class="fc" id="L181">    simpleFields.put(TENANT_CONFIG_KEY, OBJECT_MAPPER.writeValueAsString(tableConfig._tenantConfig));</span>
<span class="fc" id="L182">    simpleFields.put(INDEXING_CONFIG_KEY, OBJECT_MAPPER.writeValueAsString(tableConfig._indexingConfig));</span>
<span class="fc" id="L183">    simpleFields.put(CUSTOM_CONFIG_KEY, OBJECT_MAPPER.writeValueAsString(tableConfig._customConfig));</span>
<span class="fc bfc" id="L184" title="All 2 branches covered.">    if (tableConfig._quotaConfig != null) {</span>
<span class="fc" id="L185">      simpleFields.put(QUOTA_CONFIG_KEY, OBJECT_MAPPER.writeValueAsString(tableConfig._quotaConfig));</span>
    }
<span class="pc bpc" id="L187" title="1 of 2 branches missed.">    if (tableConfig._taskConfig != null) {</span>
<span class="nc" id="L188">      simpleFields.put(TASK_CONFIG_KEY, OBJECT_MAPPER.writeValueAsString(tableConfig._taskConfig));</span>
    }
<span class="pc bpc" id="L190" title="1 of 2 branches missed.">    if (tableConfig._routingConfig != null) {</span>
<span class="fc" id="L191">      simpleFields.put(ROUTING_CONFIG_KEY, OBJECT_MAPPER.writeValueAsString(tableConfig._routingConfig));</span>
    }
<span class="fc" id="L193">    znRecord.setSimpleFields(simpleFields);</span>
<span class="fc" id="L194">    return znRecord;</span>
  }

  @Nonnull
  public String getTableName() {
<span class="fc" id="L199">    return _tableName;</span>
  }

  public void setTableName(@Nonnull String tableName) {
<span class="fc" id="L203">    _tableName = tableName;</span>
<span class="fc" id="L204">  }</span>

  @Nonnull
  public TableType getTableType() {
<span class="fc" id="L208">    return _tableType;</span>
  }

  public void setTableType(@Nonnull TableType tableType) {
<span class="nc" id="L212">    _tableType = tableType;</span>
<span class="nc" id="L213">  }</span>

  @Nonnull
  public SegmentsValidationAndRetentionConfig getValidationConfig() {
<span class="fc" id="L217">    return _validationConfig;</span>
  }

  public void setValidationConfig(@Nonnull SegmentsValidationAndRetentionConfig validationConfig) {
<span class="nc" id="L221">    _validationConfig = validationConfig;</span>
<span class="nc" id="L222">  }</span>

  @Nonnull
  public TenantConfig getTenantConfig() {
<span class="fc" id="L226">    return _tenantConfig;</span>
  }

  public void setTenantConfig(@Nonnull TenantConfig tenantConfig) {
<span class="fc" id="L230">    _tenantConfig = tenantConfig;</span>
<span class="fc" id="L231">  }</span>

  @Nonnull
  public IndexingConfig getIndexingConfig() {
<span class="fc" id="L235">    return _indexingConfig;</span>
  }

  public void setIndexingConfig(@Nonnull IndexingConfig indexingConfig) {
<span class="fc" id="L239">    _indexingConfig = indexingConfig;</span>
<span class="fc" id="L240">  }</span>

  @Nonnull
  public TableCustomConfig getCustomConfig() {
<span class="fc" id="L244">    return _customConfig;</span>
  }

  public void setCustomConfig(@Nonnull TableCustomConfig customConfig) {
<span class="nc" id="L248">    _customConfig = customConfig;</span>
<span class="nc" id="L249">  }</span>

  @Nullable
  public QuotaConfig getQuotaConfig() {
<span class="fc" id="L253">    return _quotaConfig;</span>
  }

  public void setQuotaConfig(@Nullable QuotaConfig quotaConfig) {
<span class="fc" id="L257">    _quotaConfig = quotaConfig;</span>
<span class="fc" id="L258">  }</span>

  @Nullable
  public TableTaskConfig getTaskConfig() {
<span class="nc" id="L262">    return _taskConfig;</span>
  }

  public void setTaskConfig(@Nullable TableTaskConfig taskConfig) {
<span class="nc" id="L266">    _taskConfig = taskConfig;</span>
<span class="nc" id="L267">  }</span>

  public RoutingConfig getRoutingConfig() {
<span class="nc" id="L270">    return _routingConfig;</span>
  }

  public void setRoutingConfig(RoutingConfig routingConfig) {
<span class="nc" id="L274">    _routingConfig = routingConfig;</span>
<span class="nc" id="L275">  }</span>

  @Nonnull
  public String toJSONConfigString()
      throws IOException, JSONException {
<span class="fc" id="L280">    return toJSONConfig(this).toString();</span>
  }

  @Override
  public String toString() {
    try {
<span class="nc" id="L286">      return toJSONConfig(this).toString(2);</span>
<span class="nc" id="L287">    } catch (Exception e) {</span>
<span class="nc" id="L288">      return e.toString();</span>
    }
  }

  @Override
  public boolean equals(Object o) {
<span class="nc bnc" id="L294" title="All 2 branches missed.">    if (EqualityUtils.isSameReference(this, o)) {</span>
<span class="nc" id="L295">      return true;</span>
    }

<span class="nc bnc" id="L298" title="All 2 branches missed.">    if (EqualityUtils.isNullOrNotSameClass(this, o)) {</span>
<span class="nc" id="L299">      return false;</span>
    }

<span class="nc" id="L302">    TableConfig that = (TableConfig) o;</span>

<span class="nc bnc" id="L304" title="All 18 branches missed.">    return EqualityUtils.isEqual(_tableName, that._tableName) &amp;&amp;</span>
        EqualityUtils.isEqual(_tableType, that._tableType) &amp;&amp;
        EqualityUtils.isEqual(_validationConfig, that._validationConfig) &amp;&amp;
        EqualityUtils.isEqual(_tenantConfig, that._tenantConfig) &amp;&amp;
        EqualityUtils.isEqual(_indexingConfig, that._indexingConfig) &amp;&amp;
        EqualityUtils.isEqual( _customConfig, that._customConfig) &amp;&amp;
        EqualityUtils.isEqual(_quotaConfig, that._quotaConfig) &amp;&amp;
        EqualityUtils.isEqual(_taskConfig, that._taskConfig) &amp;&amp;
        EqualityUtils.isEqual(_routingConfig, that._routingConfig);
  }

  @Override
  public int hashCode() {
<span class="nc" id="L317">    int result = EqualityUtils.hashCodeOf(_tableName);</span>
<span class="nc" id="L318">    result = EqualityUtils.hashCodeOf(result, _tableType);</span>
<span class="nc" id="L319">    result = EqualityUtils.hashCodeOf(result, _validationConfig);</span>
<span class="nc" id="L320">    result = EqualityUtils.hashCodeOf(result, _tenantConfig);</span>
<span class="nc" id="L321">    result = EqualityUtils.hashCodeOf(result, _indexingConfig);</span>
<span class="nc" id="L322">    result = EqualityUtils.hashCodeOf(result, _customConfig);</span>
<span class="nc" id="L323">    result = EqualityUtils.hashCodeOf(result, _quotaConfig);</span>
<span class="nc" id="L324">    result = EqualityUtils.hashCodeOf(result, _taskConfig);</span>
<span class="nc" id="L325">    result = EqualityUtils.hashCodeOf(result, _routingConfig);</span>
<span class="nc" id="L326">    return result;</span>
  }

  public static class Builder {
    private static final String DEFAULT_SEGMENT_PUSH_TYPE = &quot;APPEND&quot;;
    private static final String REFRESH_SEGMENT_PUSH_TYPE = &quot;REFRESH&quot;;
    private static final String DEFAULT_SEGMENT_ASSIGNMENT_STRATEGY = &quot;BalanceNumSegmentAssignmentStrategy&quot;;
    private static final String DEFAULT_STREAM_PARTITION_ASSIGNMENT_STRATEGY = &quot;UniformStreamPartitionAssignment&quot;;
    private static final String DEFAULT_NUM_REPLICAS = &quot;1&quot;;
    private static final String DEFAULT_LOAD_MODE = &quot;HEAP&quot;;
    private static final String MMAP_LOAD_MODE = &quot;MMAP&quot;;

    private final TableType _tableType;
    private String _tableName;
    private boolean _isLLC;

    // Validation config related
    private String _timeColumnName;
    private String _timeType;
    private String _retentionTimeUnit;
    private String _retentionTimeValue;
    private String _segmentPushFrequency;
<span class="fc" id="L348">    private String _segmentPushType = DEFAULT_SEGMENT_PUSH_TYPE;</span>
<span class="fc" id="L349">    private String _segmentAssignmentStrategy = DEFAULT_SEGMENT_ASSIGNMENT_STRATEGY;</span>
    private String _schemaName;
<span class="fc" id="L351">    private String _numReplicas = DEFAULT_NUM_REPLICAS;</span>

    // Tenant config related
    private String _brokerTenant;
    private String _serverTenant;

    // Indexing config related
<span class="fc" id="L358">    private String _loadMode = DEFAULT_LOAD_MODE;</span>
    private String _segmentVersion;
    private String _sortedColumn;
    private List&lt;String&gt; _invertedIndexColumns;
    private List&lt;String&gt; _noDictionaryColumns;
    private List&lt;String&gt; _onHeapDictionaryColumns;
    private Map&lt;String, String&gt; _streamConfigs;
<span class="fc" id="L365">    private String _streamPartitionAssignmentStrategy = DEFAULT_STREAM_PARTITION_ASSIGNMENT_STRATEGY;</span>

    private TableCustomConfig _customConfig;
    private QuotaConfig _quotaConfig;
    private TableTaskConfig _taskConfig;
    private RoutingConfig _routingConfig;
    private HllConfig _hllConfig;
    private StarTreeIndexSpec _starTreeIndexSpec;

<span class="fc" id="L374">    public Builder(TableType tableType) {</span>
<span class="fc" id="L375">      _tableType = tableType;</span>
<span class="fc" id="L376">    }</span>

    public Builder setTableName(String tableName) {
<span class="fc" id="L379">      _tableName = tableName;</span>
<span class="fc" id="L380">      return this;</span>
    }

    public Builder setLLC(boolean isLLC) {
<span class="pc bpc" id="L384" title="1 of 2 branches missed.">      Preconditions.checkState(_tableType == TableType.REALTIME);</span>
<span class="fc" id="L385">      _isLLC = isLLC;</span>
<span class="fc" id="L386">      return this;</span>
    }

    public Builder setTimeColumnName(String timeColumnName) {
<span class="fc" id="L390">      _timeColumnName = timeColumnName;</span>
<span class="fc" id="L391">      return this;</span>
    }

    public Builder setTimeType(String timeType) {
<span class="fc" id="L395">      _timeType = timeType;</span>
<span class="fc" id="L396">      return this;</span>
    }

    public Builder setRetentionTimeUnit(String retentionTimeUnit) {
<span class="fc" id="L400">      _retentionTimeUnit = retentionTimeUnit;</span>
<span class="fc" id="L401">      return this;</span>
    }

    public Builder setRetentionTimeValue(String retentionTimeValue) {
<span class="fc" id="L405">      _retentionTimeValue = retentionTimeValue;</span>
<span class="fc" id="L406">      return this;</span>
    }

    public Builder setSegmentPushType(String segmentPushType) {
<span class="nc bnc" id="L410" title="All 2 branches missed.">      if (REFRESH_SEGMENT_PUSH_TYPE.equalsIgnoreCase(segmentPushType)) {</span>
<span class="nc" id="L411">        _segmentPushType = REFRESH_SEGMENT_PUSH_TYPE;</span>
      } else {
<span class="nc" id="L413">        _segmentPushType = DEFAULT_SEGMENT_PUSH_TYPE;</span>
      }
<span class="nc" id="L415">      return this;</span>
    }

    public Builder setSegmentPushFrequency(String segmentPushFrequency) {
<span class="nc" id="L419">      _segmentPushFrequency = segmentPushFrequency;</span>
<span class="nc" id="L420">      return this;</span>
    }

    public Builder setSegmentAssignmentStrategy(String segmentAssignmentStrategy) {
<span class="fc" id="L424">      _segmentAssignmentStrategy = segmentAssignmentStrategy;</span>
<span class="fc" id="L425">      return this;</span>
    }

    public Builder setSchemaName(String schemaName) {
<span class="nc" id="L429">      _schemaName = schemaName;</span>
<span class="nc" id="L430">      return this;</span>
    }

    public Builder setNumReplicas(int numReplicas) {
<span class="pc bpc" id="L434" title="1 of 2 branches missed.">      Preconditions.checkArgument(numReplicas &gt; 0);</span>
<span class="fc" id="L435">      _numReplicas = String.valueOf(numReplicas);</span>
<span class="fc" id="L436">      return this;</span>
    }

    public Builder setBrokerTenant(String brokerTenant) {
<span class="fc" id="L440">      _brokerTenant = brokerTenant;</span>
<span class="fc" id="L441">      return this;</span>
    }

    public Builder setServerTenant(String serverTenant) {
<span class="fc" id="L445">      _serverTenant = serverTenant;</span>
<span class="fc" id="L446">      return this;</span>
    }

    public Builder setLoadMode(String loadMode) {
<span class="nc bnc" id="L450" title="All 2 branches missed.">      if (MMAP_LOAD_MODE.equalsIgnoreCase(loadMode)) {</span>
<span class="nc" id="L451">        _loadMode = MMAP_LOAD_MODE;</span>
      } else {
<span class="nc" id="L453">        _loadMode = DEFAULT_LOAD_MODE;</span>
      }
<span class="nc" id="L455">      return this;</span>
    }

    public Builder setSegmentVersion(String segmentVersion) {
<span class="nc" id="L459">      _segmentVersion = segmentVersion;</span>
<span class="nc" id="L460">      return this;</span>
    }

    public Builder setSortedColumn(String sortedColumn) {
<span class="nc" id="L464">      _sortedColumn = sortedColumn;</span>
<span class="nc" id="L465">      return this;</span>
    }

    public Builder setInvertedIndexColumns(List&lt;String&gt; invertedIndexColumns) {
<span class="nc" id="L469">      _invertedIndexColumns = invertedIndexColumns;</span>
<span class="nc" id="L470">      return this;</span>
    }

    public Builder setNoDictionaryColumns(List&lt;String&gt; noDictionaryColumns) {
<span class="nc" id="L474">      _noDictionaryColumns = noDictionaryColumns;</span>
<span class="nc" id="L475">      return this;</span>
    }

    public Builder setOnHeapDictionaryColumns(List&lt;String&gt; onHeapDictionaryColumns) {
<span class="nc" id="L479">      _onHeapDictionaryColumns = onHeapDictionaryColumns;</span>
<span class="nc" id="L480">      return this;</span>
    }

    public Builder setStreamPartitionAssignmentStrategy(String streamPartitionAssignmentStrategy) {
<span class="fc" id="L484">      _streamPartitionAssignmentStrategy = streamPartitionAssignmentStrategy;</span>
<span class="fc" id="L485">      return this;</span>
    }

    public Builder setStreamConfigs(Map&lt;String, String&gt; streamConfigs) {
<span class="pc bpc" id="L489" title="1 of 2 branches missed.">      Preconditions.checkState(_tableType == TableType.REALTIME);</span>
<span class="fc" id="L490">      _streamConfigs = streamConfigs;</span>
<span class="fc" id="L491">      return this;</span>
    }

    public Builder setCustomConfig(TableCustomConfig customConfig) {
<span class="nc" id="L495">      _customConfig = customConfig;</span>
<span class="nc" id="L496">      return this;</span>
    }

    public Builder setQuotaConfig(QuotaConfig quotaConfig) {
<span class="fc" id="L500">      _quotaConfig = quotaConfig;</span>
<span class="fc" id="L501">      return this;</span>
    }

    public Builder setTaskConfig(TableTaskConfig taskConfig) {
<span class="nc" id="L505">      _taskConfig = taskConfig;</span>
<span class="nc" id="L506">      return this;</span>
    }

    public Builder setRoutingConfig(RoutingConfig routingConfig) {
<span class="nc" id="L510">      _routingConfig = routingConfig;</span>
<span class="nc" id="L511">      return this;</span>
    }

    public TableConfig build()
        throws IOException, JSONException {
      // Validation config
<span class="fc" id="L517">      SegmentsValidationAndRetentionConfig validationConfig = new SegmentsValidationAndRetentionConfig();</span>
<span class="fc" id="L518">      validationConfig.setTimeColumnName(_timeColumnName);</span>
<span class="fc" id="L519">      validationConfig.setTimeType(_timeType);</span>
<span class="fc" id="L520">      validationConfig.setRetentionTimeUnit(_retentionTimeUnit);</span>
<span class="fc" id="L521">      validationConfig.setRetentionTimeValue(_retentionTimeValue);</span>
<span class="fc" id="L522">      validationConfig.setSegmentPushFrequency(_segmentPushFrequency);</span>
<span class="fc" id="L523">      validationConfig.setSegmentPushType(_segmentPushType);</span>
<span class="fc" id="L524">      validationConfig.setSegmentAssignmentStrategy(_segmentAssignmentStrategy);</span>
<span class="fc" id="L525">      validationConfig.setSchemaName(_schemaName);</span>
<span class="fc" id="L526">      validationConfig.setReplication(_numReplicas);</span>
<span class="fc bfc" id="L527" title="All 2 branches covered.">      if (_isLLC) {</span>
<span class="fc" id="L528">        validationConfig.setReplicasPerPartition(_numReplicas);</span>
      }

      // Tenant config
<span class="fc" id="L532">      TenantConfig tenantConfig = new TenantConfig();</span>
<span class="fc" id="L533">      tenantConfig.setBroker(_brokerTenant);</span>
<span class="fc" id="L534">      tenantConfig.setServer(_serverTenant);</span>

      // Indexing config
<span class="fc" id="L537">      IndexingConfig indexingConfig = new IndexingConfig();</span>
<span class="fc" id="L538">      indexingConfig.setLoadMode(_loadMode);</span>
<span class="fc" id="L539">      indexingConfig.setSegmentFormatVersion(_segmentVersion);</span>
<span class="pc bpc" id="L540" title="1 of 2 branches missed.">      if (_sortedColumn != null) {</span>
<span class="nc" id="L541">        indexingConfig.setSortedColumn(Collections.singletonList(_sortedColumn));</span>
      }
<span class="fc" id="L543">      indexingConfig.setInvertedIndexColumns(_invertedIndexColumns);</span>
<span class="fc" id="L544">      indexingConfig.setNoDictionaryColumns(_noDictionaryColumns);</span>
<span class="fc" id="L545">      indexingConfig.setOnHeapDictionaryColumns(_onHeapDictionaryColumns);</span>
<span class="fc" id="L546">      indexingConfig.setStreamConfigs(_streamConfigs);</span>
<span class="fc" id="L547">      StreamConsumptionConfig streamConsumptionConfig = new StreamConsumptionConfig();</span>
<span class="fc" id="L548">      streamConsumptionConfig.setStreamPartitionAssignmentStrategy(_streamPartitionAssignmentStrategy);</span>
<span class="fc" id="L549">      indexingConfig.setStreamConsumptionConfig(streamConsumptionConfig);</span>
      // TODO: set SegmentPartitionConfig here

<span class="fc bfc" id="L552" title="All 2 branches covered.">      if (_customConfig == null) {</span>
<span class="fc" id="L553">        _customConfig = new TableCustomConfig();</span>
<span class="fc" id="L554">        _customConfig.setCustomConfigs(new HashMap&lt;String, String&gt;());</span>
      }

<span class="fc bfc" id="L557" title="All 2 branches covered.">      if (_routingConfig == null) {</span>
<span class="fc" id="L558">        _routingConfig = new RoutingConfig();</span>
      }

<span class="fc" id="L561">      return new TableConfig(_tableName, _tableType, validationConfig, tenantConfig, indexingConfig, _customConfig,</span>
          _quotaConfig, _taskConfig, _routingConfig);
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>