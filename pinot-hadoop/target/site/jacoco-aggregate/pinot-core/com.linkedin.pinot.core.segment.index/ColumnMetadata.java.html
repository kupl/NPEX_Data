<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>ColumnMetadata.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">pinot-hadoop</a> &gt; <a href="../index.html" class="el_bundle">pinot-core</a> &gt; <a href="index.source.html" class="el_package">com.linkedin.pinot.core.segment.index</a> &gt; <span class="el_source">ColumnMetadata.java</span></div><h1>ColumnMetadata.java</h1><pre class="source lang-java linenums">/**
 * Copyright (C) 2014-2016 LinkedIn Corp. (pinot-core@linkedin.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.linkedin.pinot.core.segment.index;

import com.linkedin.pinot.common.config.ColumnPartitionConfig;
import com.linkedin.pinot.common.data.DateTimeFieldSpec;
import com.linkedin.pinot.common.data.DimensionFieldSpec;
import com.linkedin.pinot.common.data.FieldSpec;
import com.linkedin.pinot.common.data.FieldSpec.DataType;
import com.linkedin.pinot.common.data.FieldSpec.FieldType;
import com.linkedin.pinot.common.data.MetricFieldSpec;
import com.linkedin.pinot.common.data.MetricFieldSpec.DerivedMetricType;
import com.linkedin.pinot.common.data.TimeFieldSpec;
import com.linkedin.pinot.core.data.partition.PartitionFunction;
import com.linkedin.pinot.core.data.partition.PartitionFunctionFactory;
import com.linkedin.pinot.core.segment.creator.impl.V1Constants;
import com.linkedin.pinot.startree.hll.HllSizeUtils;
import java.lang.reflect.Field;
import java.util.List;
import java.util.concurrent.TimeUnit;
import org.apache.commons.configuration.PropertiesConfiguration;
import org.apache.commons.lang.StringEscapeUtils;
import org.apache.commons.lang.math.IntRange;
import org.codehaus.jackson.annotate.JsonProperty;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import static com.linkedin.pinot.core.segment.creator.impl.V1Constants.MetadataKeys.Column.*;
import static com.linkedin.pinot.core.segment.creator.impl.V1Constants.MetadataKeys.Segment.SEGMENT_PADDING_CHARACTER;
import static com.linkedin.pinot.core.segment.creator.impl.V1Constants.MetadataKeys.Segment.TIME_UNIT;


public class ColumnMetadata {
<span class="fc" id="L47">  private static final Logger LOGGER = LoggerFactory.getLogger(ColumnMetadata.class);</span>

  private final FieldSpec fieldSpec;
  private final String columnName;
  private final int cardinality;
  private final int totalDocs;
  private final int totalRawDocs;
  private final int totalAggDocs;
  private final DataType dataType;
  private final int bitsPerElement;
  private final int stringColumnMaxLength;
  private final FieldType fieldType;
  private final boolean isSorted;
  @JsonProperty
  private final boolean containsNulls;
  @JsonProperty
  private final boolean hasDictionary;
  @JsonProperty
  private final boolean hasInvertedIndex;
  private final boolean isSingleValue;
  private final int maxNumberOfMultiValues;
  private final int totalNumberOfEntries;
  private final boolean isAutoGenerated;
  private final String defaultNullValueString;
  private final TimeUnit timeUnit;
  private final char paddingCharacter;
  private final DerivedMetricType derivedMetricType;
  private final int fieldSize;
  private final String originColumnName;
  private final Comparable minValue;
  private final Comparable maxValue;
  private final PartitionFunction partitionFunction;
  private final int numPartitions;
  private final List&lt;IntRange&gt; partitionRanges;
  private final String dateTimeFormat;
  private final String dateTimeGranularity;

  public static ColumnMetadata fromPropertiesConfiguration(String column, PropertiesConfiguration config) {
<span class="fc" id="L85">    Builder builder = new Builder();</span>

<span class="fc" id="L87">    builder.setColumnName(column);</span>
<span class="fc" id="L88">    builder.setCardinality(config.getInt(getKeyFor(column, CARDINALITY)));</span>
<span class="fc" id="L89">    int totalDocs = config.getInt(getKeyFor(column, TOTAL_DOCS));</span>
<span class="fc" id="L90">    builder.setTotalDocs(totalDocs);</span>
<span class="fc" id="L91">    builder.setTotalRawDocs(config.getInt(getKeyFor(column, TOTAL_RAW_DOCS), totalDocs));</span>
<span class="fc" id="L92">    builder.setTotalAggDocs(config.getInt(getKeyFor(column, TOTAL_AGG_DOCS), 0));</span>
<span class="fc" id="L93">    DataType dataType = DataType.valueOf(config.getString(getKeyFor(column, DATA_TYPE)).toUpperCase());</span>
<span class="fc" id="L94">    builder.setDataType(dataType);</span>
<span class="fc" id="L95">    builder.setBitsPerElement(config.getInt(getKeyFor(column, BITS_PER_ELEMENT)));</span>
<span class="fc" id="L96">    builder.setStringColumnMaxLength(config.getInt(getKeyFor(column, DICTIONARY_ELEMENT_SIZE)));</span>
<span class="fc" id="L97">    builder.setFieldType(FieldType.valueOf(config.getString(getKeyFor(column, COLUMN_TYPE)).toUpperCase()));</span>
<span class="fc" id="L98">    builder.setIsSorted(config.getBoolean(getKeyFor(column, IS_SORTED)));</span>
<span class="fc" id="L99">    builder.setContainsNulls(config.getBoolean(getKeyFor(column, HAS_NULL_VALUE)));</span>
<span class="fc" id="L100">    builder.setHasDictionary(config.getBoolean(getKeyFor(column, HAS_DICTIONARY), true));</span>
<span class="fc" id="L101">    builder.setHasInvertedIndex(config.getBoolean(getKeyFor(column, HAS_INVERTED_INDEX)));</span>
<span class="fc" id="L102">    builder.setSingleValue(config.getBoolean(getKeyFor(column, IS_SINGLE_VALUED)));</span>
<span class="fc" id="L103">    builder.setMaxNumberOfMultiValues(config.getInt(getKeyFor(column, MAX_MULTI_VALUE_ELEMTS)));</span>
<span class="fc" id="L104">    builder.setTotalNumberOfEntries(config.getInt(getKeyFor(column, TOTAL_NUMBER_OF_ENTRIES)));</span>
<span class="fc" id="L105">    builder.setAutoGenerated(config.getBoolean(getKeyFor(column, IS_AUTO_GENERATED), false));</span>
<span class="fc" id="L106">    builder.setDefaultNullValueString(config.getString(getKeyFor(column, DEFAULT_NULL_VALUE), null));</span>
<span class="fc" id="L107">    builder.setTimeUnit(TimeUnit.valueOf(config.getString(TIME_UNIT, &quot;DAYS&quot;).toUpperCase()));</span>
<span class="fc" id="L108">    char paddingCharacter = V1Constants.Str.LEGACY_STRING_PAD_CHAR;</span>
<span class="fc bfc" id="L109" title="All 2 branches covered.">    if (config.containsKey(SEGMENT_PADDING_CHARACTER)) {</span>
<span class="fc" id="L110">      String padding = config.getString(SEGMENT_PADDING_CHARACTER);</span>
<span class="fc" id="L111">      paddingCharacter = StringEscapeUtils.unescapeJava(padding).charAt(0);</span>
    }
<span class="fc" id="L113">    builder.setPaddingCharacter(paddingCharacter);</span>

<span class="fc" id="L115">    String dateTimeFormat = config.getString(getKeyFor(column, DATETIME_FORMAT), null);</span>
<span class="pc bpc" id="L116" title="1 of 2 branches missed.">    if (dateTimeFormat != null) {</span>
<span class="nc" id="L117">      builder.setDateTimeFormat(dateTimeFormat);</span>
    }

<span class="fc" id="L120">    String dateTimeGranularity = config.getString(getKeyFor(column, DATETIME_GRANULARITY), null);</span>
<span class="pc bpc" id="L121" title="1 of 2 branches missed.">    if (dateTimeGranularity != null) {</span>
<span class="nc" id="L122">      builder.setDateTimeGranularity(dateTimeGranularity);</span>
    }

    // DERIVED_METRIC_TYPE property is used to check whether this field is derived or not
    // ORIGIN_COLUMN property is used to indicate the origin field of this derived metric
<span class="fc" id="L127">    String typeStr = config.getString(getKeyFor(column, DERIVED_METRIC_TYPE), null);</span>
<span class="fc bfc" id="L128" title="All 2 branches covered.">    DerivedMetricType derivedMetricType = (typeStr == null) ? null : DerivedMetricType.valueOf(typeStr.toUpperCase());</span>

<span class="fc bfc" id="L130" title="All 2 branches covered.">    if (derivedMetricType != null) {</span>
<span class="pc bpc" id="L131" title="1 of 2 branches missed.">      switch (derivedMetricType) {</span>
        case HLL:
          try {
<span class="fc" id="L134">            final int hllLog2m = config.getInt(V1Constants.MetadataKeys.Segment.SEGMENT_HLL_LOG2M);</span>
<span class="fc" id="L135">            builder.setFieldSize(HllSizeUtils.getHllFieldSizeFromLog2m(hllLog2m));</span>
<span class="fc" id="L136">            final String originColumnName = config.getString(getKeyFor(column, ORIGIN_COLUMN));</span>
<span class="fc" id="L137">            builder.setOriginColumnName(originColumnName);</span>
<span class="nc" id="L138">          } catch (RuntimeException e) {</span>
<span class="nc" id="L139">            LOGGER.error(</span>
                &quot;Column: &quot; + column + &quot; is HLL derived column, but missing log2m, fieldSize or originColumnName.&quot;);
<span class="nc" id="L141">            throw e;</span>
<span class="fc" id="L142">          }</span>
          break;
        default:
<span class="nc" id="L145">          throw new IllegalArgumentException(&quot;Column: &quot; + column + &quot; with derived metric Type: &quot; + derivedMetricType</span>
              + &quot; is not supported in building column metadata.&quot;);
      }
<span class="fc" id="L148">      builder.setDerivedMetricType(derivedMetricType);</span>
    }

    // Set min/max value if available.
<span class="fc" id="L152">    String minString = config.getString(getKeyFor(column, MIN_VALUE), null);</span>
<span class="fc" id="L153">    String maxString = config.getString(getKeyFor(column, MAX_VALUE), null);</span>
<span class="pc bpc" id="L154" title="1 of 4 branches missed.">    if ((minString != null) &amp;&amp; (maxString != null)) {</span>
<span class="pc bpc" id="L155" title="3 of 6 branches missed.">      switch (dataType) {</span>
        case INT:
<span class="fc" id="L157">          builder.setMinValue(Integer.valueOf(minString));</span>
<span class="fc" id="L158">          builder.setMaxValue(Integer.valueOf(maxString));</span>
<span class="fc" id="L159">          break;</span>
        case LONG:
<span class="fc" id="L161">          builder.setMinValue(Long.valueOf(minString));</span>
<span class="fc" id="L162">          builder.setMaxValue(Long.valueOf(maxString));</span>
<span class="fc" id="L163">          break;</span>
        case FLOAT:
<span class="nc" id="L165">          builder.setMinValue(Float.valueOf(minString));</span>
<span class="nc" id="L166">          builder.setMaxValue(Float.valueOf(maxString));</span>
<span class="nc" id="L167">          break;</span>
        case DOUBLE:
<span class="nc" id="L169">          builder.setMinValue(Double.valueOf(minString));</span>
<span class="nc" id="L170">          builder.setMaxValue(Double.valueOf(maxString));</span>
<span class="nc" id="L171">          break;</span>
        case STRING:
<span class="fc" id="L173">          builder.setMinValue(minString);</span>
<span class="fc" id="L174">          builder.setMaxValue(maxString);</span>
<span class="fc" id="L175">          break;</span>
        default:
<span class="nc" id="L177">          throw new IllegalStateException(&quot;Unsupported data type: &quot; + dataType + &quot; for column: &quot; + column);</span>
      }
    }

<span class="fc" id="L181">    String partitionFunctionName =</span>
        config.getString(getKeyFor(column, V1Constants.MetadataKeys.Column.PARTITION_FUNCTION));
<span class="fc bfc" id="L183" title="All 2 branches covered.">    if (partitionFunctionName != null) {</span>
<span class="fc" id="L184">      int numPartitions = config.getInt(getKeyFor(column, V1Constants.MetadataKeys.Column.NUM_PARTITIONS));</span>
<span class="fc" id="L185">      PartitionFunction partitionFunction =</span>
          PartitionFunctionFactory.getPartitionFunction(partitionFunctionName, numPartitions);
<span class="fc" id="L187">      builder.setPartitionFunction(partitionFunction);</span>
<span class="fc" id="L188">      builder.setNumPartitions(numPartitions);</span>

<span class="fc" id="L190">      String[] valueString = config.getStringArray(getKeyFor(column, V1Constants.MetadataKeys.Column.PARTITION_VALUES));</span>
<span class="fc" id="L191">      builder.setPartitionValues(ColumnPartitionConfig.rangesFromString(valueString));</span>
    }

<span class="fc" id="L194">    return builder.build();</span>
  }

  public PartitionFunction getPartitionFunction() {
<span class="fc" id="L198">    return partitionFunction;</span>
  }

  public int getNumPartitions() {
<span class="fc" id="L202">    return numPartitions;</span>
  }

  public List&lt;IntRange&gt; getPartitionRanges() {
<span class="fc" id="L206">    return partitionRanges;</span>
  }

<span class="fc" id="L209">  public static class Builder {</span>
    private String columnName;
    private int cardinality;
    private int totalDocs;
    private int totalRawDocs;
    private int totalAggDocs;
    private DataType dataType;
    private int bitsPerElement;
    private int stringColumnMaxLength;
    private FieldType fieldType;
    private boolean isSorted;
    private boolean containsNulls;
    private boolean hasDictionary;
    private boolean hasInvertedIndex;
    private boolean isSingleValue;
    private int maxNumberOfMultiValues;
    private int totalNumberOfEntries;
    private boolean isAutoGenerated;
    private String defaultNullValueString;
    private TimeUnit timeUnit;
    private char paddingCharacter;
    private DerivedMetricType derivedMetricType;
    private int fieldSize;
    private String originColumnName;
    private Comparable minValue;
    private Comparable maxValue;
    private PartitionFunction partitionFunction;
<span class="fc" id="L236">    private List&lt;IntRange&gt; partitionValues = null;</span>
    private int numPartitions;
    private String dateTimeFormat;
    private String dateTimeGranularity;

    public Builder setColumnName(String columnName) {
<span class="fc" id="L242">      this.columnName = columnName;</span>
<span class="fc" id="L243">      return this;</span>
    }

    public Builder setCardinality(int cardinality) {
<span class="fc" id="L247">      this.cardinality = cardinality;</span>
<span class="fc" id="L248">      return this;</span>
    }

    public Builder setTotalDocs(int totalDocs) {
<span class="fc" id="L252">      this.totalDocs = totalDocs;</span>
<span class="fc" id="L253">      return this;</span>
    }

    public Builder setTotalRawDocs(int totalRawDocs) {
<span class="fc" id="L257">      this.totalRawDocs = totalRawDocs;</span>
<span class="fc" id="L258">      return this;</span>
    }

    public Builder setTotalAggDocs(int totalAggDocs) {
<span class="fc" id="L262">      this.totalAggDocs = totalAggDocs;</span>
<span class="fc" id="L263">      return this;</span>
    }

    public Builder setDataType(DataType dataType) {
<span class="fc" id="L267">      this.dataType = dataType.getStoredType();</span>
<span class="fc" id="L268">      return this;</span>
    }

    public Builder setBitsPerElement(int bitsPerElement) {
<span class="fc" id="L272">      this.bitsPerElement = bitsPerElement;</span>
<span class="fc" id="L273">      return this;</span>
    }

    public Builder setStringColumnMaxLength(int stringColumnMaxLength) {
<span class="fc" id="L277">      this.stringColumnMaxLength = stringColumnMaxLength;</span>
<span class="fc" id="L278">      return this;</span>
    }

    public Builder setFieldType(FieldType fieldType) {
<span class="fc" id="L282">      this.fieldType = fieldType;</span>
<span class="fc" id="L283">      return this;</span>
    }

    public Builder setIsSorted(boolean isSorted) {
<span class="fc" id="L287">      this.isSorted = isSorted;</span>
<span class="fc" id="L288">      return this;</span>
    }

    public Builder setContainsNulls(boolean containsNulls) {
<span class="fc" id="L292">      this.containsNulls = containsNulls;</span>
<span class="fc" id="L293">      return this;</span>
    }

    public Builder setHasDictionary(boolean hasDictionary) {
<span class="fc" id="L297">      this.hasDictionary = hasDictionary;</span>
<span class="fc" id="L298">      return this;</span>
    }

    public Builder setHasInvertedIndex(boolean hasInvertedIndex) {
<span class="fc" id="L302">      this.hasInvertedIndex = hasInvertedIndex;</span>
<span class="fc" id="L303">      return this;</span>
    }

    public Builder setSingleValue(boolean singleValue) {
<span class="fc" id="L307">      this.isSingleValue = singleValue;</span>
<span class="fc" id="L308">      return this;</span>
    }

    public Builder setMaxNumberOfMultiValues(int maxNumberOfMultiValues) {
<span class="fc" id="L312">      this.maxNumberOfMultiValues = maxNumberOfMultiValues;</span>
<span class="fc" id="L313">      return this;</span>
    }

    public Builder setTotalNumberOfEntries(int totalNumberOfEntries) {
<span class="fc" id="L317">      this.totalNumberOfEntries = totalNumberOfEntries;</span>
<span class="fc" id="L318">      return this;</span>
    }

    public Builder setAutoGenerated(boolean isAutoGenerated) {
<span class="fc" id="L322">      this.isAutoGenerated = isAutoGenerated;</span>
<span class="fc" id="L323">      return this;</span>
    }

    public Builder setDefaultNullValueString(String defaultNullValueString) {
<span class="fc" id="L327">      this.defaultNullValueString = defaultNullValueString;</span>
<span class="fc" id="L328">      return this;</span>
    }

    public Builder setTimeUnit(TimeUnit timeUnit) {
<span class="fc" id="L332">      this.timeUnit = timeUnit;</span>
<span class="fc" id="L333">      return this;</span>
    }

    public Builder setPaddingCharacter(char paddingCharacter) {
<span class="fc" id="L337">      this.paddingCharacter = paddingCharacter;</span>
<span class="fc" id="L338">      return this;</span>
    }

    public Builder setDerivedMetricType(DerivedMetricType derivedMetricType) {
<span class="fc" id="L342">      this.derivedMetricType = derivedMetricType;</span>
<span class="fc" id="L343">      return this;</span>
    }

    public Builder setFieldSize(int fieldSize) {
<span class="fc" id="L347">      this.fieldSize = fieldSize;</span>
<span class="fc" id="L348">      return this;</span>
    }

    public Builder setOriginColumnName(String originColumnName) {
<span class="fc" id="L352">      this.originColumnName = originColumnName;</span>
<span class="fc" id="L353">      return this;</span>
    }

    public Builder setMinValue(Comparable minValue) {
<span class="fc" id="L357">      this.minValue = minValue;</span>
<span class="fc" id="L358">      return this;</span>
    }

    public Builder setMaxValue(Comparable maxValue) {
<span class="fc" id="L362">      this.maxValue = maxValue;</span>
<span class="fc" id="L363">      return this;</span>
    }

    public Builder setPartitionFunction(PartitionFunction partitionFunction) {
<span class="fc" id="L367">      this.partitionFunction = partitionFunction;</span>
<span class="fc" id="L368">      return this;</span>
    }

    public void setNumPartitions(int numPartitions) {
<span class="fc" id="L372">      this.numPartitions = numPartitions;</span>
<span class="fc" id="L373">    }</span>

    public Builder setPartitionValues(List&lt;IntRange&gt; partitionValues) {
<span class="fc" id="L376">      this.partitionValues = partitionValues;</span>
<span class="fc" id="L377">      return this;</span>
    }

    public Builder setDateTimeFormat(String dateTimeFormat) {
<span class="nc" id="L381">      this.dateTimeFormat = dateTimeFormat;</span>
<span class="nc" id="L382">      return this;</span>
    }

    public Builder setDateTimeGranularity(String dateTimeGranularity) {
<span class="nc" id="L386">      this.dateTimeGranularity = dateTimeGranularity;</span>
<span class="nc" id="L387">      return this;</span>
    }

    public ColumnMetadata build() {
<span class="fc" id="L391">      return new ColumnMetadata(columnName, cardinality, totalDocs, totalRawDocs, totalAggDocs, dataType,</span>
          bitsPerElement, stringColumnMaxLength, fieldType, isSorted, containsNulls, hasDictionary, hasInvertedIndex,
          isSingleValue, maxNumberOfMultiValues, totalNumberOfEntries, isAutoGenerated, defaultNullValueString,
          timeUnit, paddingCharacter, derivedMetricType, fieldSize, originColumnName, minValue, maxValue,
          partitionFunction, numPartitions, partitionValues, dateTimeFormat, dateTimeGranularity);
    }
  }

  private ColumnMetadata(String columnName, int cardinality, int totalDocs, int totalRawDocs, int totalAggDocs,
      DataType dataType, int bitsPerElement, int stringColumnMaxLength, FieldType fieldType, boolean isSorted,
      boolean hasNulls, boolean hasDictionary, boolean hasInvertedIndex, boolean isSingleValue,
      int maxNumberOfMultiValues, int totalNumberOfEntries, boolean isAutoGenerated, String defaultNullValueString,
      TimeUnit timeUnit, char paddingCharacter, DerivedMetricType derivedMetricType, int fieldSize,
      String originColumnName, Comparable minValue, Comparable maxValue, PartitionFunction partitionFunction,
<span class="fc" id="L405">      int numPartitions, List&lt;IntRange&gt; partitionRanges, String dateTimeFormat, String dateTimeGranularity) {</span>
<span class="fc" id="L406">    this.columnName = columnName;</span>
<span class="fc" id="L407">    this.cardinality = cardinality;</span>
<span class="fc" id="L408">    this.totalDocs = totalDocs;</span>
<span class="fc" id="L409">    this.totalRawDocs = totalRawDocs;</span>
<span class="fc" id="L410">    this.totalAggDocs = totalAggDocs;</span>
<span class="fc" id="L411">    this.dataType = dataType;</span>
<span class="fc" id="L412">    this.bitsPerElement = bitsPerElement;</span>
<span class="fc" id="L413">    this.stringColumnMaxLength = stringColumnMaxLength;</span>
<span class="fc" id="L414">    this.fieldType = fieldType;</span>
<span class="fc" id="L415">    this.isSorted = isSorted;</span>
<span class="fc" id="L416">    this.containsNulls = hasNulls;</span>
<span class="fc" id="L417">    this.hasDictionary = hasDictionary;</span>
<span class="fc" id="L418">    this.hasInvertedIndex = hasInvertedIndex;</span>
<span class="fc" id="L419">    this.isSingleValue = isSingleValue;</span>
<span class="fc" id="L420">    this.maxNumberOfMultiValues = maxNumberOfMultiValues;</span>
<span class="fc" id="L421">    this.totalNumberOfEntries = totalNumberOfEntries;</span>
<span class="fc" id="L422">    this.isAutoGenerated = isAutoGenerated;</span>
<span class="fc" id="L423">    this.defaultNullValueString = defaultNullValueString;</span>
<span class="fc" id="L424">    this.timeUnit = timeUnit;</span>
<span class="fc" id="L425">    this.paddingCharacter = paddingCharacter;</span>
<span class="fc" id="L426">    this.derivedMetricType = derivedMetricType;</span>
<span class="fc" id="L427">    this.fieldSize = fieldSize;</span>
<span class="fc" id="L428">    this.originColumnName = originColumnName;</span>
<span class="fc" id="L429">    this.minValue = minValue;</span>
<span class="fc" id="L430">    this.maxValue = maxValue;</span>
<span class="fc" id="L431">    this.partitionFunction = partitionFunction;</span>
<span class="fc" id="L432">    this.numPartitions = numPartitions;</span>
<span class="fc" id="L433">    this.partitionRanges = partitionRanges;</span>
<span class="fc" id="L434">    this.dateTimeFormat = dateTimeFormat;</span>
<span class="fc" id="L435">    this.dateTimeGranularity = dateTimeGranularity;</span>

<span class="pc bpc" id="L437" title="2 of 5 branches missed.">    switch (fieldType) {</span>
      case DIMENSION:
<span class="fc" id="L439">        this.fieldSpec = new DimensionFieldSpec(columnName, dataType, isSingleValue);</span>
<span class="fc" id="L440">        break;</span>
      case METRIC:
<span class="fc bfc" id="L442" title="All 2 branches covered.">        if (derivedMetricType == null) {</span>
<span class="fc" id="L443">          this.fieldSpec = new MetricFieldSpec(columnName, dataType);</span>
        } else {
<span class="fc" id="L445">          this.fieldSpec = new MetricFieldSpec(columnName, dataType, fieldSize, derivedMetricType);</span>
        }
<span class="fc" id="L447">        break;</span>
      case TIME:
<span class="fc" id="L449">        this.fieldSpec = new TimeFieldSpec(columnName, dataType, timeUnit);</span>
<span class="fc" id="L450">        break;</span>
      case DATE_TIME:
<span class="nc" id="L452">        this.fieldSpec = new DateTimeFieldSpec(columnName, dataType, dateTimeFormat, dateTimeGranularity);</span>
<span class="nc" id="L453">        break;</span>
      default:
<span class="nc" id="L455">        throw new RuntimeException(&quot;Unsupported field type: &quot; + fieldType);</span>
    }
<span class="fc" id="L457">  }</span>

  public String getColumnName() {
<span class="fc" id="L460">    return columnName;</span>
  }

  /**
   * When a realtime segment has no-dictionary columns, the cardinality for those columns will be
   * set to Constants.UNKNOWN_CARDINALITY
   *
   * @return The cardinality of the column.
   */
  public int getCardinality() {
<span class="fc" id="L470">    return cardinality;</span>
  }

  public int getTotalDocs() {
<span class="fc" id="L474">    return totalDocs;</span>
  }

  public int getTotalRawDocs() {
<span class="fc" id="L478">    return totalRawDocs;</span>
  }

  public int getTotalAggDocs() {
<span class="fc" id="L482">    return totalAggDocs;</span>
  }

  public DataType getDataType() {
<span class="fc" id="L486">    return dataType;</span>
  }

  public int getBitsPerElement() {
<span class="fc" id="L490">    return bitsPerElement;</span>
  }

  public int getStringColumnMaxLength() {
<span class="fc" id="L494">    return stringColumnMaxLength;</span>
  }

  public FieldType getFieldType() {
<span class="fc" id="L498">    return fieldType;</span>
  }

  public boolean isSorted() {
<span class="fc" id="L502">    return isSorted;</span>
  }

  public boolean hasNulls() {
<span class="fc" id="L506">    return containsNulls;</span>
  }

  public boolean hasDictionary() {
<span class="fc" id="L510">    return hasDictionary;</span>
  }

  public boolean hasInvertedIndex() {
<span class="fc" id="L514">    return hasInvertedIndex;</span>
  }

  public boolean isSingleValue() {
<span class="fc" id="L518">    return isSingleValue;</span>
  }

  public int getMaxNumberOfMultiValues() {
<span class="fc" id="L522">    return maxNumberOfMultiValues;</span>
  }

  public int getTotalNumberOfEntries() {
<span class="fc" id="L526">    return totalNumberOfEntries;</span>
  }

  public boolean isAutoGenerated() {
<span class="fc" id="L530">    return isAutoGenerated;</span>
  }

  public String getDefaultNullValueString() {
<span class="fc" id="L534">    return defaultNullValueString;</span>
  }

  public TimeUnit getTimeUnit() {
<span class="fc" id="L538">    return timeUnit;</span>
  }

  public char getPaddingCharacter() {
<span class="fc" id="L542">    return paddingCharacter;</span>
  }

  public DerivedMetricType getDerivedMetricType() {
<span class="fc" id="L546">    return derivedMetricType;</span>
  }

  public String getOriginColumnName() {
<span class="fc" id="L550">    return originColumnName;</span>
  }

  public FieldSpec getFieldSpec() {
<span class="fc" id="L554">    return fieldSpec;</span>
  }

  public Comparable getMinValue() {
<span class="fc" id="L558">    return minValue;</span>
  }

  public Comparable getMaxValue() {
<span class="fc" id="L562">    return maxValue;</span>
  }

  public String getDateTimeFormat() {
<span class="fc" id="L566">    return dateTimeFormat;</span>
  }

  public String getDateTimeGranularity() {
<span class="fc" id="L570">    return dateTimeGranularity;</span>
  }

  @Override
  public String toString() {
<span class="nc" id="L575">    final StringBuilder result = new StringBuilder();</span>
<span class="nc" id="L576">    final String newLine = System.getProperty(&quot;line.separator&quot;);</span>

<span class="nc" id="L578">    result.append(this.getClass().getName());</span>
<span class="nc" id="L579">    result.append(&quot; Object {&quot;);</span>
<span class="nc" id="L580">    result.append(newLine);</span>

    //determine fields declared in this class only (no fields of superclass)
<span class="nc" id="L583">    final Field[] fields = this.getClass().getDeclaredFields();</span>

    //print field names paired with their values
<span class="nc bnc" id="L586" title="All 2 branches missed.">    for (final Field field : fields) {</span>
<span class="nc" id="L587">      result.append(&quot;  &quot;);</span>
      try {
<span class="nc" id="L589">        result.append(field.getName());</span>
<span class="nc" id="L590">        result.append(&quot;: &quot;);</span>
        //requires access to private field:
<span class="nc" id="L592">        result.append(field.get(this));</span>
<span class="nc" id="L593">      } catch (final IllegalAccessException ex) {</span>
<span class="nc bnc" id="L594" title="All 2 branches missed.">        if (LOGGER.isErrorEnabled()) {</span>
<span class="nc" id="L595">          LOGGER.error(&quot;Unable to access field &quot; + field, ex);</span>
        }
<span class="nc" id="L597">        result.append(&quot;[ERROR]&quot;);</span>
<span class="nc" id="L598">      }</span>
<span class="nc" id="L599">      result.append(newLine);</span>
    }
<span class="nc" id="L601">    result.append(&quot;}&quot;);</span>

<span class="nc" id="L603">    return result.toString();</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>