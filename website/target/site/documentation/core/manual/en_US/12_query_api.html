<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Query API</title>
<link rel="stylesheet" href="css/blazebit.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="prettify/prettify.min.css">
<script src="prettify/prettify.min.js"></script>
<script src="prettify/lang-ext.js"></script>
<script>document.addEventListener('DOMContentLoaded', prettyPrint)</script>
<link rel="shortcut icon" href="images/favicon.png">
</head>
<body class="book toc2 toc-left">

<div class="brand">
    <a class="vendor" href="https://blazebit.com">
        <strong>Blazebit.com</strong>
    </a>
    <a class="logo" href="https://persistence.blazebit.com">
        <strong>blaze-persistence</strong>
    </a>
</div>
<br/>

<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#query-api">Query API</a>
<ul class="sectlevel2">
<li><a href="#parameter-binding">Parameter binding</a></li>
<li><a href="#query-properties">Query properties</a></li>
<li><a href="#query-result-caching">Query result caching</a></li>
<li><a href="#query-api-limitations">Limitations</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="query-api"><a class="anchor" href="#query-api"></a>Query API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The central element to the construction of criteria or query builders is the <a href="{core_jdoc}/persistence/CriteriaBuilderFactory.html"><code>CriteriaBuilderFactory</code></a>.
The factory provides methods for constructing <a href="#DML statements">[DML statements]</a>, <a href="#set-operations">left nested set operations</a> and
<a href="{core_jdoc}/persistence/CriteriaBuilderFactory.html#create(javax.persistence.EntityManager,%20java.lang.Class)"><code>CriteriaBuilder</code></a> instances for <code>SELECT</code> statements.</p>
</div>
<div class="paragraph">
<p>The top level query builders allow access to the query string and also to construct JPA <code>javax.persistence.Query</code> or <code>javax.persistence.TypedQuery</code> instances through the interfaces</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="{core_jdoc}/persistence/Queryable.html"><code>Queryable</code></a></p>
</li>
<li>
<p><a href="{core_jdoc}/persistence/Executable.html"><code>Executable</code></a></p>
</li>
<li>
<p><a href="{core_jdoc}/persistence/ModificationCriteriaBuilder.html"><code>ModificationCriteriaBuilder</code></a></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
    <pre class="prettyprint javaext lang-javaext">String queryString = cbf.create(em, Cat.class, "cat")
    .getQueryString();
TypedQuery&lt;Cat&gt; query = em.createQuery(queryString, Cat.class);</pre>
</div>
</div>
<div class="paragraph">
<p>The possibility to access the query string is a convenience for debugging or monitoring, but queries should always be constructed via the respective query construction methods.
If advanced features like CTEs, Set-Operations or others are used, the query string returned really is just a <em>logical representation</em> of the query structure,
so don&#8217;t rely on the query string being compilable through <code>EntityManager#createQuery()</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The constructed JPA query instances for queries that use some of the advanced features currently do not support query hints or unwrapping.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
    <pre class="prettyprint javaext lang-javaext">TypedQuery&lt;Cat&gt; query = cbf.create(em, Cat.class, "cat")
    .getTypedQuery();</pre>
</div>
</div>
<div class="paragraph">
<p>Queries should always be created that way and also can be reused for the transaction just like any other query.</p>
</div>
<div class="paragraph">
<p>{projectname} also offers convenience methods on the top level query builder interfaces to execute the queries</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="{core_jdoc}/persistence/Queryable.html#getSingleResult()"><code>getSingleResult()</code></a> is equivalent to <code>getTypedQuery().getSingleResult()</code></p>
</li>
<li>
<p><a href="{core_jdoc}/persistence/Queryable.html#getResultList()"><code>getResultList()</code></a> is equivalent to <code>getTypedQuery().getResultList()</code></p>
</li>
<li>
<p><a href="{core_jdoc}/persistence/Executable.html#executeUpdate()"><code>executeUpdate()</code></a> is equivalent to <code>getQuery().executeUpdate()</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
    <pre class="prettyprint javaext lang-javaext">List&lt;Cat&gt; query = cbf.create(em, Cat.class, "cat")
    .getResultList();</pre>
</div>
</div>
<div class="sect2">
<h3 id="parameter-binding"><a class="anchor" href="#parameter-binding"></a>Parameter binding</h3>
<div class="paragraph">
<p>Apart from support for binding parameters on the constructed JPA query, {projectname} also allows to bind parameters on the query builder itself.
All query builders(including subquery and other builders) support setting parameters through the same <a href="{core_jdoc}/persistence/ParameterHolder.html#setParameter(java.lang.String,%20java.lang.Object)"><code>setParameter()</code></a> API that is offered by the JPA query API.
In addition to that, it is also possible to inspect the parameters and the bound values while building through <a href="{core_jdoc}/persistence/ParameterHolder.html#getParameters()"><code>getParameters()</code></a>.</p>
</div>
<div class="listingblock">
<div class="content">
    <pre class="prettyprint javaext lang-javaext">List&lt;Cat&gt; query = cbf.create(em, Cat.class, "cat")
    .where("name").eqExpression(":nameParam")
    .setParameter("nameParam", "Billy")
    .getResultList();</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Beware that positional parameters are not supported!
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="query-properties"><a class="anchor" href="#query-properties"></a>Query properties</h3>
<div class="paragraph">
<p>As mentioned in the <a href="#configuration">configuration chapter</a>, a query builder can be further configured via the <a href="{core_jdoc}/persistence/CommonQueryBuilder.html#setProperty(java.lang.String,%20java.lang.String)"><code>setProperty(String, String)</code></a> method.
This allows for disabling optimizations when encountering bugs or fine tuning on a case by case basis.</p>
</div>
<div class="paragraph">
<p>If you encounter, that you make use of a configuration very often, you should consider configuring the property globally via the <a href="{core_jdoc}/persistence/spi/CriteriaBuilderConfiguration.html"><code>CriteriaBuilderConfiguration</code></a>
and only switch to a different value when needed.</p>
</div>
</div>
<div class="sect2">
<h3 id="query-result-caching"><a class="anchor" href="#query-result-caching"></a>Query result caching</h3>
<div class="paragraph">
<p>Query result caching can be enabled by invoking the <a href="{core_jdoc}/persistence/CommonQueryBuilder.html#setCacheable(boolean)"><code>setCacheable(boolean)</code></a> method on a query builder.</p>
</div>
<div class="paragraph">
<p>Note that additional configuration might be required for the caching to work properly. For details, refer to the documentation of your JPA provider.</p>
</div>
</div>
<div class="sect2">
<h3 id="query-api-limitations"><a class="anchor" href="#query-api-limitations"></a>Limitations</h3>
<div class="paragraph">
<p>Although we try to adopt or at least allow the use of JPA provider extension there are some limitations to the query API that are known and currently not addressed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No support for iterative result processing i.e. <em>scrolling</em> yet. See <a href="https://github.com/Blazebit/blaze-persistence/issues/254">#254</a></p>
</li>
<li>
<p>No support for passing query hints</p>
</li>
<li>
<p>No way for query caching for static queries that use advanced features. This is going to be addressed as part of <a href="https://github.com/Blazebit/blaze-persistence/issues/252">#252</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-08-05 16:46:14 KST
</div>
</div>
</body>
</html>